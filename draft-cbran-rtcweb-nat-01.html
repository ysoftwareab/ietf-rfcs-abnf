<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>RTC-Web Network Address Translation</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Connection Management Requirements">
<link href="#rfc.section.4" rel="Chapter" title="4 ICE Within the Web Browser (Open Issue)">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Option 1: Full ICE in the Web Browser">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Issue 1: ICE Timing and Pacing Requirements">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Issue 2: Compatibility, Fixes and Update Rollout">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Proposed Model">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Option 2: STUN in the Web Browser, ICE as JavaScript Library">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Issue 1: Hampers Innovation">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Issue 2: Unnecessary Cost in some Cases">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Issue 3: Limits Adaptability">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Proposed Model">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Option 3: Defer to W3C WebRTC Working Group">
<link href="#rfc.section.5" rel="Chapter" title="5 Negotiation Architecture">
<link href="#rfc.section.6" rel="Chapter" title="6 Legacy VoIP Interoperability">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document outlines the network address translation (NAT) mechanisms and requirements for RTC-Web client applications." />
  <meta name="description" content="This document outlines the network address translation (NAT) mechanisms and requirements for RTC-Web client applications." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">C. Bran</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M.K. Kaufman</td>
</tr>
<tr>
<td class="left">Expires: March 11, 2012</td>
<td class="right">Skype</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">C. Jennings</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J.R. Rosenberg</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Skype</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 08, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">RTC-Web Network Address Translation<br />
  <span class="filename">draft-cbran-rtcweb-nat-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document outlines the network address translation (NAT) mechanisms and requirements for RTC-Web client applications.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 11, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may not be modified, and derivative works of it may not be created, and it may not be published except as an Internet-Draft.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Connection Management Requirements</a>
</li>
<li>4.   <a href="#rfc.section.4">ICE Within the Web Browser (Open Issue)</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Option 1: Full ICE in the Web Browser</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Issue 1: ICE Timing and Pacing Requirements</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Issue 2: Compatibility, Fixes and Update Rollout</a>
</li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Proposed Model</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Option 2: STUN in the Web Browser, ICE as JavaScript Library</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Issue 1: Hampers Innovation</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Issue 2: Unnecessary Cost in some Cases</a>
</li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">Issue 3: Limits Adaptability</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Proposed Model</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Option 3: Defer to W3C WebRTC Working Group</a>
</li>
<li>5.   <a href="#rfc.section.5">Negotiation Architecture</a>
</li>
<li>6.   <a href="#rfc.section.6">Legacy VoIP Interoperability</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">An integral part of the success and adoption of the Real-Time Communications Web (RTC-WEB) will be the ability for RTC-Web applications to have native, secure Network Address Translation (NAT) traversal capabilities. This specification proposes NAT traversal requirements and implementation specification for RTC-Web client applications.</p>
<p id="rfc.section.1.p.2">The NAT requirements fit into a series of specifications have been created to address RTC-Web codec, security, data transmission, non-media data, signaling and negotiation and use case requirements. More information on the RTC-Web can be found here:</p>
<p id="rfc.section.1.p.3">[TODO put links to supporting drafts here]</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Connection Management Requirements</h1>
<p id="rfc.section.3.p.1">It is quite probable that many RTC-WEB client applications, such as web browsers will be deployed behind a NAT. To set up secure data plane sessions, all RTC-WEB client application implementations are REQUIRED to implement ICE <a href="#RFC5245">[RFC5245]</a> or ICE-Lite Section 2.7 of <a href="#RFC5245">[RFC5245]</a>. Implicit to supporting ICE, all RTC-WEB client applications are REQUIRED to implement Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs) (STUN) <a href="#RFC3489">[RFC3489]</a> and Traversal Using Relays around NAT (TURN) <a href="#RFC5766">[RFC5766]</a>.</p>
<p id="rfc.section.3.p.2">There are two deployment scenarios for RTC-WEB client applications.  The first scenario is when applications are deployed behind NAT and have to worry about NAT traversal. The second scenario is when the application is not behind a NAT, such as an RTC-WEB application that is always connected to the public Internet. As stated in section 2.7 of <a href="#RFC5245">[RFC5245]</a>, ICE requires that both endpoints to support it in order for ICE to be used on a call.</p>
<p id="rfc.section.3.p.3">With regards to RTC-WEB client applications that are deployed behind a NAT or do not have a public IP address are REQUIRED to support ICE <a href="#RFC5245">[RFC5245]</a>, applications that have a public IP address are REQUIRED to support ICE-Lite and MAY fully support ICE.  RTC-WEB client applications that fully support ICE are REQUIRED to support AGGRESSIVE NOMINATION, and MAY support REGULAR NOMINATION.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> ICE Within the Web Browser (Open Issue)</h1>
<p id="rfc.section.4.p.1">While there seems to be rough consensus that ICE<a href="#RFC5245">[RFC5245]</a> should be the adopted as the recommendation for NAT<a href="#RFC4787">[RFC4787]</a> traversal for RTC-Web applications, currently there is an open issue as to what parts of ICE should be implemented within RTC-Web capable web browsers.</p>
<p id="rfc.section.4.p.2">To date there has been three proposals for the RTC-Web ICE implementation.</p>
<p id="rfc.section.4.p.3">The first proposal would place a full implementation of ICE within the browser and expose native ICE APIs via JavaScript calls.</p>
<p id="rfc.section.4.p.4">The second proposal would place a full implementation of STUN<a href="#RFC3489">[RFC3489]</a> in the browser and expose native STUN APIs via JavaScript calls. In the second proposal ICE would be implemented as a JavaScript library that uses the browser&#8217;s native STUN APIs.</p>
<p id="rfc.section.4.p.5">The third proposal is to defer the browser ICE implementation requirements to the W3C WebRTC working group.</p>
<p id="rfc.section.4.p.6">This section will be updated as the topic is vetted out on the mailing list.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Option 1: Full ICE in the Web Browser</h1>
<p id="rfc.section.4.1.p.1">This section proposes implementing full ICE in the web browser and exposing native ICE APIs reasoning behind requiring RTC-Web web apps to use a JavaScript library for ICE negotiation falls along two primary assumptions.</p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> Issue 1: ICE Timing and Pacing Requirements</h1>
<p id="rfc.section.4.1.1.p.1">The ICE pacing requirements have a lower bound of 20 ms as stated in <a href="#RFC5245">[RFC5245]</a>, section B.1., Pacing of STUN Transactions. At the writing of this document it is unclear if the resolution of modern JavaScript timers across the major operating systems could meet the lower boundary requirements for ICE. It has been suggested that the best way to determine if the ICE timing and pacing requirements were actually feasible is to create browser ready sample applications. The sample applications could be used to prove or disprove the feasibility of ICE as a JavaScript library.</p>
<p id="rfc.section.4.1.1.p.2">To fairly evaluate a JavaScript ICE implementation the testing environment should try to emulate a real-world usage scenario. The following suggestions should be integrated into the test plan.</p>
<p></p>

<ul>
<li>The device and or computing environment. Areas to consider here are the OS, use of virtualization, browser vendor, hardware platform (notebook, desktop, tablet, netbook, smart phone, etc) and network connectivity.</li>
<li>Testing performance under real-world web page conditions.  Real-world web pages often include inline advertisements. Web pages with advertisements will include advertiser-bundled JavaScripts,which can be quite large and take a long time to execute. Long running JavaScripts scripts can prevent web application timers from firing in correctly. Any feasibility testing must cover the combination of JavaScript ICE with one or more long running JavaScripts</li>
</ul>
<p id="rfc.section.4.1.1.p.4">A JavaScript ICE implementation should not be considered as a viable recommendation of this draft until it two things happen.</p>
<p></p>

<ul>
<li>A working prototype is built - a working prototype would have a browser with a STUN implementation and accompanying ICE JavaScript library</li>
<li>Testing and proving the prototype is capable of handling the ICE timing and pacing requirements within a real-world environment</li>
</ul>
<p></p>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> Issue 2: Compatibility, Fixes and Update Rollout</h1>
<p id="rfc.section.4.1.2.p.1">It has been proposed that JavaScript ICE libraries would be easier to manage with regards to compatibility and updates when compared to ICE native within the web browser. While JavaScript libraries would make it easy to add fixes and enhancements to an ICE implementation this approach will not scale when it comes to interoperability and rapid deployment. With ICE as a JavaScript library, there can literally be a copy of the library on a per website basis, given that there are over 250 million individual websites on the internet, in addition to the millions of intranet hosted sites, upgrading a JavaScript library will simply not scale in a time friendly manner.</p>
<p id="rfc.section.4.1.2.p.2">With ICE native within the browser, there are fewer than a dozen implementations world wide that have to interoperate with each other, which means that enhancements to ICE can be coordinated between browser vendors. When it comes time to enhance or fix a defect with the browser's native ICE implementation, updates to browsers can be deployed, at scale, to hundreds of millions of users in the span of a few weeks. The rapid updates have proven effective and most if not all the major browser vendors have short term update mechanisms.</p>
<p id="rfc.section.4.1.2.p.3">Given that web browsers will be the dominant RTC-Web endpoint and that a native implementation of ICE within the browser will significantly narrow the complexities of ICE interoperability, defect fixes and enhancements at scale it is RECOMMENDED that ICE be implemented natively within all RTC-Web client applications.</p>
<p id="rfc.section.4.1.2.p.4">A question may arise regarding the above recommendation if a JavaScript ICE library could meet the ICE performance requirements.  While such a library may meet the ICE performance requirements, until a deployment solution is proposed to propagate bug fixes and enhancements to the JavaScript library at internet scale, a JavaScript library approach would be an inferior recommendation compared to the native in the browser approach.</p>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> Proposed Model</h1>
<p id="rfc.section.4.1.3.p.1">The model proposed here is that the web browser support a full ICE implementation and expose APIs that to programmatically set up an ICE session. With a full ICE implementation in the web browser, a STUN implementation would be implicit and therefore STUN APIs could also be exposed to give developers the flexibility of having a native NAT traversal mechanism.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Option 2: STUN in the Web Browser, ICE as JavaScript Library</h1>
<p id="rfc.section.4.2.p.1">This section discusses several drawbacks to including a full ICE implementation in the browser and proposes a full STUN implementation in the browser and ICE via a JavaScript library.</p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#sec-drawbacks" id="sec-drawbacks">Issue 1: Hampers Innovation</a>
</h1>
<p id="rfc.section.4.2.1.p.1">One of the benefits of ICE is that it allows local implementation flexibility in the way candidates are gathered, offered and prioritized. However, once ICE is baked into the browser, it is no longer possible for that innovation to take place - or at least, it leaves the hands of the voice application providers. To date, there has been variability in this aspect of implementation, with different providers tuning it to tweak their needs and deployments.</p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> Issue 2: Unnecessary Cost in some Cases</h1>
<p id="rfc.section.4.2.2.p.1">There is a broad array of use cases for VoIP. It is used for everything from consumer Internet services (like Skype) to small business phone systems. Though clearly global consumer Internet services require the kind of traversal technology provided by full ICE, it is not needed in other cases. One such use case is, in fact, enterprise telephony, where users make calls within the confines of their corporate network, and remote access is supported through VPN.  Today, VoIP endpoints in these environments do not generally use ICE.</p>
<p id="rfc.section.4.2.2.p.2">As such, if an enterprise communications application wanted to utilize browser RTC, it would need to support ICE even though it was not strictly required. Is there a penalty to support of ICE? The enterprise would need to deploy STUN and TURN servers, which would not actually be needed. ICE also typically increases call setup delay (though the degree to which it does it is dependent on the network conditions the users are in), those increases would be for no benefit in the enterprise deployment scenario.</p>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> Issue 3: Limits Adaptability</h1>
<p id="rfc.section.4.2.3.p.1">ICE was not the IETFs first attempt at techniques for firewall and NAT traversal. Basic STUN <a href="#RFC3489">[RFC3489]</a> was defined in 2003, and it solved the problem by attempting to characterize NATs. It failed for a variety of reasons. However, one of the key lessons of STUN was that its technique for classifying NATs - breaking them into four different NAT varieties - proved brittle. In reality, the market saw changes in the types of implementations, and NATs appeared which met none of the classifications. For this reason, ICE abandoned the classification approach and instead moved towards a model of connectivity checking.</p>
<p id="rfc.section.4.2.3.p.2">As a consequence, ICE has greater reliability than pure STUN, but its effectiveness in achieving direct p2p connections is still based on some underlying assumptions around NAT types. Its design is most effective for NATs whose behavior is endpoint-independent mapping, and whose filtering policy is either endpoint-independent or address-dependent <a href="#RFC4787">[RFC4787]</a>.</p>
<p id="rfc.section.4.2.3.p.3">With the ongoing exhaustion of the IPv4 address space, we can anticipate even further reliance on NAT and the likely appearance of carrier NATs of differing varieties. This is likely to change the nature of NAT behaviors seen in the real world. The right way to deal with this is to adapt ICE's behavior, using differing allocation techniques and assigning different priorities. For example, ICE currently does not enable direct p2p connections in cases where NATs have mapping policies which are endpoint dependent but utilize sequential port allocation. If, despite the recommendations of RFC4787, such NAT types become increasingly prevalent, ICE's effectiveness will decline and more connections will be relayed. With ICE literally baked into web browsers, it will become harder to adapt its algorithms to work best under the conditions of the modern Internet.</p>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> Proposed Model</h1>
<p id="rfc.section.4.2.4.p.1">The model proposed here is that the browser itself support STUN only. APIs are provided which allow for initiation of a STUN transaction. The results of this transaction are then passed to the browser application (notably, the reflexive address). The browser API allows the browser application to set attribute/value pairs in the message. Similarly, on the receive-side, APIs are defined for allowing an application to register callbacks for receipt of a STUN request. Those callbacks provide the application information on the source IP and port, amongst other information.</p>
<p id="rfc.section.4.2.4.p.2">For security purposes, the browser will refuse to send, or accept, media to or from a peer to which a STUN transaction has not completed successfully. This ensures that the browser cannot be used as a DoS tool to launch a voice hammer attack.</p>
<p id="rfc.section.4.2.4.p.3">What about TURN? In this model, TURN is mostly implemented on top of the browsers STUN implementation. The Javascript code in the browser can generate Allocate requests, and be informed of the results. The only exception to this is that the browser has to be told whether or not to encapsulate media in Send transactions, or to use an allocated channel. The browser API provides a switch which allows the application to tell the browser which encapsulation to use for media.</p>
<p id="rfc.section.4.2.4.p.4">In a server-mediated environment, TURN might also be unnecessary.  A call setup service can communicate directly with the relay service to establish a transparent UDP tunnel through one or more relays, the STUN connectivity checks may be sent through this tunnel, and no TURN encapsulation support is needed in the browser. The Javascript-initiated STUN connectivity tests may also be used to authenticate the browser to the tunnel service.</p>
<p id="rfc.section.4.2.4.p.5">With this model, there is now a great deal of flexibility in how NAT traversal can be done. Some of the models which can now be supported are:</p>
<p></p>

<dl>
<dt>ICE in JavaScript:</dt>
<dd style="margin-left: 8">A full ICE implementation is possible in JavaScript itself. Because the implementation resides in JavaScript, it is trivially changed at any time.</dd>
<dt>Server-Based ICE:</dt>
<dd style="margin-left: 8">A full ICE implementation can execute in the server, using remote-control commands to inform the browser to send STUN transactions, and passing the results from the browser back to the server. In essence - MGCP for ICE.</dd>
<dt>STUN-Only:</dt>
<dd style="margin-left: 8">For deployments where the peer is always publicly reachable from clients - such as enterprises or PSTN termination services - the JavaScript can do a single STUN transaction to create a permission in the browser, and then proceed to send media.</dd>
<dt>Non-ICE:</dt>
<dd style="margin-left: 8">Protocols similar to ICE, but not otherwise compliant, can also be implemented. Negotiation of which NAT traversal mechanism is needed, is done by the application outside of the browser.</dd>
</dl>
<p id="rfc.section.4.2.4.p.7">This model addresses all of the concerns outlined in <a href="#sec-drawbacks">Section 4.2.1</a>. Now, if changes in NAT types occur over time, new Javascript or server code can be deployed which uses different prioritization, or even performs new allocation models.  For example, port-predictive allocations can be added in this model, without upgrading the browser. Since the browser has the barest minimum necessary for security and functional purposes, innovation is possible to a greater degree. Finally, implementations can be only as complex as is needed for the task at hand.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Option 3: Defer to W3C WebRTC Working Group</h1>
<p id="rfc.section.4.3.p.1">This section proposes that the IETF defer the implementation of ICE to the W3C WebRTC working group.</p>
<p id="rfc.section.4.3.p.2">Given that RTC-Web is being designed to run on more than just web browsers, the opinion here is that it should not be the role of this working group to make a set of requirements for a specific RTC-Web client application implementation.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Negotiation Architecture</h1>
<p id="rfc.section.5.p.1">[WORK IN PROGRESS]</p>
<p id="rfc.section.5.p.2">An example of this will be showing how a RTC-Web capable web browser does signaling and negotiation to set up a DTLS [REF] connection using ICE. Once the DTLS connection has been established, the RTC-Web client application will use the secure channel for SIP signaling and media transmission.</p>
<p id="rfc.section.5.p.3">[TODO - add architecture diagram and content]</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Legacy VoIP Interoperability</h1>
<p id="rfc.section.6.p.1">There is no way to meet all the security requirements and maintain comparability with all legacy VoIP equipment. This draft tries to minimize the impedance mismatch. The requirements here would allow interoperability with legacy VoIP equipment as long as that equipment either directly supported, or was fronted by an SBC that supported ICE or ICE-Lite.</p>
<p id="rfc.section.6.p.2">Support for ICE-Lite has historically been lacking in VoIP equipment, this is changing and ICE-Lite becoming increasingly prevalent, particularly on devices designed to sit on the edge of a domain and connect to remote user agents that may be behind NATs. Given the increasing adoption of ICE-Lite, it could be conjectured that a substantial fraction of VoIP equipment meets the RTC-WEB interoperability list.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This document makes no request of IANA.</p>
<p id="rfc.section.7.p.2">Note to RFC Editor: this section may be removed on publication as an RFC.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">To guard against spoofing RTC-Web client applications are REQUIRED to:</p>
<p></p>

<ul>
<li>Internally encapsulate the generation of STUN transaction IDs</li>
<li>Block read/write access to the generated STUN transaction IDs</li>
</ul>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">This draft incorporates ideas and text from the IETF mailing list. In particularly we would like to acknowledge, and say thanks for, work we incorporated from Timothy Terriberry and Christopher Blizzard.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5245">[RFC5245]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3489">[RFC3489]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Weinberger, J.</a>, <a>Huitema, C.</a> and <a>R. Mahy</a>, "<a href="http://tools.ietf.org/html/rfc3489">STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs)</a>", RFC 3489, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5766">[RFC5766]</b></td>
<td class="top">
<a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>J. Rosenberg</a>, "<a href="http://tools.ietf.org/html/rfc5766">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>", RFC 5766, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4787">[RFC4787]</b></td>
<td class="top">
<a>Audet, F.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>", BCP 127, RFC 4787, January 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Cary Bran</span> 
	  <span class="n hidden">
		<span class="family-name">Bran</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>170 West Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 206 256-3502</span>

<span class="vcardline">EMail: <a href="mailto:cbran@cisco.com">cbran@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Matthew Kaufman</span> 
	  <span class="n hidden">
		<span class="family-name">Kaufman</span>
	  </span>
	</span>
	<span class="org vcardline">Skype</span>
	<span class="adr">
	  <span>3210 Porter Drive</span>

	  <span class="vcardline">
		<span class="locality">Palo Alto</span>,  
		<span class="region">California</span> 
		<span class="code">94304</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 831 440 8771</span>

<span class="vcardline">EMail: <a href="mailto:matthew.kaufman@skype.net">matthew.kaufman@skype.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Cullen Jennings</span> 
	  <span class="n hidden">
		<span class="family-name">Jennings</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>170 West Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 408 421-9990</span>

<span class="vcardline">EMail: <a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jonathan Rosenberg</span> 
	  <span class="n hidden">
		<span class="family-name">Rosenberg</span>
	  </span>
	</span>
	<span class="org vcardline">Skype</span>
	<span class="adr">
	  <span>3210 Porter Drive</span>

	  <span class="vcardline">
		<span class="locality">Palo Alto</span>,  
		<span class="region">California</span> 
		<span class="code">94304</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jdrosen@skype.net">jdrosen@skype.net</a></span>

  </address>
</div>

</body>
</html>