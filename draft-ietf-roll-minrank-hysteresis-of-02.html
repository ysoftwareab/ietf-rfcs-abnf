<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The Minimum Rank Objective Function with Hysteresis</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 The Minimum Rank Objective Function with Hysteresis">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Computing the Path cost">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Parent Selection">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Computing Rank">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Advertising the Path Cost">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Working Without Metric Containers">
<link href="#rfc.section.4" rel="Chapter" title="4 Using MRHOF for Metric Maximization">
<link href="#rfc.section.5" rel="Chapter" title="5 Settings of RPL parameters">
<link href="#rfc.section.6" rel="Chapter" title="6 MRHOF Variables and Parameters">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Routing Protocol for Low Power and Lossy Networks (RPL) uses objective functions to construct routes that optimize or constrain the routes it selects and uses. This specification describes the Minimum Rank Objective Function with Hysteresis (MRHOF), an objective function that selects routes that minimize a metric, while using hysteresis to reduce churn in response to small metric changes. MRHOF works with metrics that are additive along a route, and the metric it uses is determined by the metrics RPL Destination Information Object (DIO) messages advertise." />
  <meta name="description" content="The Routing Protocol for Low Power and Lossy Networks (RPL) uses objective functions to construct routes that optimize or constrain the routes it selects and uses. This specification describes the Minimum Rank Objective Function with Hysteresis (MRHOF), an objective function that selects routes that minimize a metric, while using hysteresis to reduce churn in response to small metric changes. MRHOF works with metrics that are additive along a route, and the metric it uses is determined by the metrics RPL Destination Information Object (DIO) messages advertise." />
  <meta name="keywords" content="Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Networking Working Group</td>
<td class="right">O.G. Gnawali</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">P.L. Levis</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Stanford University</td>
</tr>
<tr>
<td class="left">Expires: October 29, 2011</td>
<td class="right">April 27, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The Minimum Rank Objective Function with Hysteresis<br />
  <span class="filename">draft-ietf-roll-minrank-hysteresis-of-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Routing Protocol for Low Power and Lossy Networks (RPL) uses objective functions to construct routes that optimize or constrain the routes it selects and uses. This specification describes the Minimum Rank Objective Function with Hysteresis (MRHOF), an objective function that selects routes that minimize a metric, while using hysteresis to reduce churn in response to small metric changes. MRHOF works with metrics that are additive along a route, and the metric it uses is determined by the metrics RPL Destination Information Object (DIO) messages advertise.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 29, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">The Minimum Rank Objective Function with Hysteresis</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Computing the Path cost</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Parent Selection</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Computing Rank</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Advertising the Path Cost</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Working Without Metric Containers</a>
</li>
<li>4.   <a href="#rfc.section.4">Using MRHOF for Metric Maximization</a>
</li>
<li>5.   <a href="#rfc.section.5">Settings of RPL parameters</a>
</li>
<li>6.   <a href="#rfc.section.6">MRHOF Variables and Parameters</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">An objective function specifies how RPL <a href="#I-D.ietf-roll-rpl">[I-D.ietf-roll-rpl]</a> selects paths.  Objective functions can choose paths based on routing metrics or constraints. For example, if an RPL instance uses an objective function that minimizes hop-count, RPL will select paths with minimum hop count.</p>
<p id="rfc.section.1.p.2">The nodes running RPL might use a number of metrics to describe a link or a node <a href="#I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</a> and make it available for route selection. These metrics are advertised in RPL Destination Information Object (DIO) messages using a Metric Container suboption. An objective function can use these metrics to choose routes.</p>
<p id="rfc.section.1.p.3">To decouple the details of an individual metric or objective function from forwarding and routing, RPL describes routes through a value called Rank. Rank, roughly speaking, corresponds to the distance associated with a route. An objective function is responsible for computing a node's advertised Rank value based on the Rank of its potential parents, metrics, and other network properties.</p>
<p id="rfc.section.1.p.4">This specification describes MRHOF, an objective function for RPL. MRHOF uses hysteresis while selecting the path with the smallest metric value. The metric that MRHOF uses is determined by the metrics in the DIO Metric Container. For example, the use of MRHOF with the latency metric allows RPL to find stable minimum-latency paths from the nodes to a root in the DAG instance. The use of MRHOF with the ETX metric allows RPL to find the stable minimum-ETX paths from the nodes to a root in the DAG instance.</p>
<p id="rfc.section.1.p.5">MRHOF can only be used with an additive metric that must be minimized on the paths selected for routing.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<p id="rfc.section.2.p.2">This terminology used in this document is consistent with the terminologies described in <a href="#I-D.ietf-roll-terminology">[I-D.ietf-roll-terminology]</a>, <a href="#I-D.ietf-roll-rpl">[I-D.ietf-roll-rpl]</a>, and <a href="#I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</a>.</p>
<p id="rfc.section.2.p.3">This document introduces two terms:</p>
<p></p>

<dl>
<dt>Selected metric:</dt>
<dd style="margin-left: 6">The metric chosen by the network operator to use for path selection. This metric can be any additive metric listed in <a href="#I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</a>.</dd>
</dl>
<p></p>

<dl>
<dt>Path cost:</dt>
<dd style="margin-left: 6">Path cost quantifies a property of an end-to-end path. Path cost is obtained by summing up the selected metric of the links or nodes along the path. Path cost can be used by RPL to compare different paths.</dd>
</dl>
<p></p>

<dl>
<dt>Worst parent:</dt>
<dd style="margin-left: 6">The node in the parent set with the largest path cost.</dd>
</dl>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> The Minimum Rank Objective Function with Hysteresis</h1>
<p id="rfc.section.3.p.1">The Minimum Rank Objective Function with Hysteresis, MRHOF, is designed to find the paths with the smallest path cost while preventing excessive churn in the network. It does so by finding the minimum cost path and switching to that path only if it is shorter (in terms of path cost) than the current path by at least a given threshold. MRHOF may be used with any additive metric listed in <a href="#I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</a> as long the routing objective is to minimize the given routing metric.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Computing the Path cost</h1>
<p id="rfc.section.3.1.p.1">Nodes compute the path cost for each candidate neighbor reachable on an interface. The Path cost represents the cost of the path, in terms of the selected metric, from a node to the root of the DODAG through the neighbor. </p>
<p id="rfc.section.3.1.p.2">Root nodes (Grounded or Floating) set the variable cur_min_path_cost to MIN_PATH_COST.</p>
<p id="rfc.section.3.1.p.3">A non-root node computes the path cost for a path to the root through each candidate neighbor by adding these two components:</p>
<p></p>

<ol>
<li>If the selected metric is a link metric, the selected metric for the link to a candidate neighbor.  If the selected metric is a node metric, the selected metric for the node.</li>
<li>The value of the selected metric in the metric container in the DIO sent by that neighbor.</li>
</ol>
<p id="rfc.section.3.1.p.5">A node SHOULD compute the path cost for the path through each candidate neighbor reachable through an interface. If a node cannot compute the path cost for the path through a candidate neighbor, the node MUST NOT select the candidate neighbor as its preferred parent, with one exception. If the node does not have metrics to compute the path cost through any of the candidate neighbors, it MUST join one of the candidate neighbors as a leaf node.</p>
<p id="rfc.section.3.1.p.6">If the selected metric is a link metric and the metric of the link to a neighbor is not available, the path cost for the path through that neighbor SHOULD be set to MAX_PATH_COST. This cost value will prevent this path from being considered for path selection.</p>
<p id="rfc.section.3.1.p.7">If the selected metric is a node metric, and the metric is not available, the path cost through all the neighbors SHOULD be set to MAX_PATH_COST.</p>
<p id="rfc.section.3.1.p.8">The path cost corresponding to a neighbor SHOULD be re-computed each time:</p>
<p></p>

<ol>
<li>The selected metric of the link to the candidate neighbor is updated.</li>
<li>If the selected metric is a node metric and the metric is updated.</li>
<li>A node receives a new metric advertisement from the candidate neighbor.</li>
</ol>
<p id="rfc.section.3.1.p.10">This computation MAY also be performed periodically. Too much delay in updating the path cost after the metric is updated or a new metric advertisement is received can lead to stale Rank or parent set.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Parent Selection</h1>
<p id="rfc.section.3.2.p.1">After computing the path cost for all the candidate neighbors reachable through an interface for the current DODAG iteration, a node selects the preferred parent. This process is called parent selection. Parent Selection SHOULD be performed each time:</p>
<p></p>

<ol>
<li>The path cost for an existing candidate neighbor, including the preferred parent, changes. This condition can be checked immediately after the path cost is computed.</li>
<li>A new candidate neighbor is inserted into the neighbor table.</li>
</ol>
<p id="rfc.section.3.2.p.3">The parent selection MAY be deferred until a later time. Deferring the parent selection can delay the use of better paths available in the network.</p>
<p id="rfc.section.3.2.p.4">A node MUST select a candidate neighbor as its preferred parent if the path cost corresponding to that neighbor is smaller than the path cost corresponding to the rest of the neighbors, except as indicated below:</p>
<p></p>

<ol>
<li>If the smallest path cost for paths through the candidate neighbors is smaller than cur_min_path_cost by less than PARENT_SWITCH_THRESHOLD, the node MAY continue to use the current preferred parent.</li>
<li>If there are multiple paths with the smallest path cost and the smallest path cost is smaller than cur_min_path_cost by at least PARENT_SWITCH_THRESHOLD, a node MAY use a different objective function to select the preferred parent among the candidate neighbors on the path with the minimum cost.</li>
<li>A node MAY declare itself as a Floating root, and hence no preferred parent, depending on the configuration.</li>
<li>If the selected metric for a link is greater than MAX_LINK_METRIC, the node SHOULD exclude that link from consideration for parent selection.</li>
<li>If cur_min_path_cost is greater than MAX_PATH_COST, the node MAY declare itself as a Floating root.</li>
<li>If the configuration disallows a node to be a Floating root and no neighbors are discovered, the node does not have a preferred parent, and MUST set cur_min_path_cost to MAX_PATH_COST.</li>
</ol>
<p id="rfc.section.3.2.p.6">Except in the cases above, the candidate neighbor on the path with the smallest path cost is the preferred parent. A node MAY include a total of PARENT_SET_SIZE candidate neighbors in the parent set. The cost of path through the nodes in the parent set is smaller than or equal to the cost of the paths through any of the nodes that are not in the parent set. If the cost of the path through the preferred parent and the worst parent is too large, a node MAY keep a smaller parent set.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Computing Rank</h1>
<p id="rfc.section.3.3.p.1">The DAG roots set their rank to MIN_PATH_COST for the selected metric.</p>
<p id="rfc.section.3.3.p.2">Once a non-root node selects its parent set, it can use the following table to covert the the path cost of the worst parent (written as Cost in the table) to its rank:</p>
<div id="#rfc.table.1"></div>
<div id="#costrank"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Conversion of metric to rank.</caption>
<thead><tr>
<th class="center">Node/link Metric</th>
<th class="center">Rank</th>
</tr></thead>
<tbody>
<tr>
<td class="center">Node Energy</td>
<td class="center">255 - Cost</td>
</tr>
<tr>
<td class="center">Hop-Count</td>
<td class="center">Cost</td>
</tr>
<tr>
<td class="center">Latency</td>
<td class="center">Cost/65536</td>
</tr>
<tr>
<td class="center">Link Quality Level</td>
<td class="center">Cost</td>
</tr>
<tr>
<td class="center">ETX</td>
<td class="center">Cost</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.3.p.3">Nodes MUST support at least one of the above metrics. Nodes SHOULD support the ETX metric.</p>
<p id="rfc.section.3.3.p.4">Node rank is undefined for these node/link metrics: Node state and attributes, throughput, and link color. If the rank is undefined, the node MUST join one of the neighbors as a leaf node.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Advertising the Path Cost</h1>
<p id="rfc.section.3.4.p.1">Once the preferred parent is selected, the node sets its cur_min_path_cost variable to the path cost corresponding to the preferred parent. Thus, cur_min_path_cost is the cost of the minimum cost path from the node to the root. The value of the cur_min_path_cost is carried in the metric container corresponding to the selected metric when DIO messages are sent.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> Working Without Metric Containers</h1>
<p id="rfc.section.3.5.p.1">In the absence of metric container, MRHOF uses ETX as its metric. It locally computes the ETX of links to its neighbors and adds this value to their advertised Rank to compute the associated Rank of routes.  Once parent selection and rank computation is performed using the ETX metric, the node advertises a Rank equal to the ETX cost and SHOULD NOT include a metric container in its DIO messages.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Using MRHOF for Metric Maximization</h1>
<p id="rfc.section.4.p.1">MRHOF cannot be directly used for parent selection using metrics which require finding paths with maximum value of the selected metric, such as path reliability. It is possible to convert such a metric maximization problem to a metric minimization problem and use MRHOF provided:</p>
<p></p>

<ul class="empty">
<li>There is a fixed and well-known maximum metric value corresponding to the best path. This is the path cost for the DAG root. Example, the best link reliability has a value of 1.</li>
<li>Metrics are all positive. Example, link reliability is always positive.</li>
</ul>
<p id="rfc.section.4.p.3">For metrics meeting the above conditions, the problem of maximizing the metric value is equivalent to minimizing the negative of the metric value. MRHOF is not required to work with these metrics.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Settings of RPL parameters</h1>
<p id="rfc.section.5.p.1">The MinHopRankIncrease parameter MUST be set to 1.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> MRHOF Variables and Parameters</h1>
<p id="rfc.section.6.p.1">MRHOF uses the following variable:</p>
<p></p>

<ul class="empty"><li>cur_min_path_cost: The cost of the path from a node through its preferred parent to the root computed at the last parent selection.</li></ul>
<p id="rfc.section.6.p.3">MRHOF uses the following parameters:</p>
<p></p>

<ul class="empty">
<li>MAX_LINK_METRIC: Maximum allowed value for the selected link metric for each link on the path.</li>
<li>MAX_PATH_COST: Maximum allowed value for the path metric of a selected path.</li>
<li>MIN_PATH_COST: The minimum allowed value for the path metric of the selected path.</li>
<li>PARENT_SWITCH_THRESHOLD: The difference between metric of the path through the preferred parent and the minimum-metric path in order to trigger the selection of a new preferred parent.</li>
<li>PARENT_SET_SIZE: The number of candidate parents, including the preferred parent, in the parent set.</li>
</ul>
<p id="rfc.section.6.p.5">The parameter values are assigned depending on the selected metric. The best values for these parameters should be experimentally determined. The working group has long experience routing with the ETX metric. Based on those experiences, these ETX parameters are known to work in many settings:</p>
<p></p>

<ul class="empty">
<li>MAX_LINK_METRIC: 10. Disallow links with greater than 10 expected transmission count on the selected path.</li>
<li>MAX_PATH_COST: 100. Disallow paths with greater than 100 expected transmission count.</li>
<li>MIN_PATH_COST: 0. At root, the expected transmission count is 0.</li>
<li>PARENT_SWITCH_THRESHOLD: 1.5. Switch to a new path only if it is expected to require at least 1.5 fewer transmission than the current path.</li>
<li>PARENT_SET_SIZE: 3. If the preferred parent is not available, two candidate parents are still available without triggering a new round of route discovery.</li>
</ul>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">Thanks to Antonio Grilo, Nicolas Tsiftes, Matteo Paris, JP Vasseur, and Phoebus Chen for their comments.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This specification requires an allocated OCP. A value of 1 is requested.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.9.p.1">Security considerations to be developed in accordance to the output of the WG.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-roll-rpl">[I-D.ietf-roll-rpl]</b></td>
<td class="top">
<a>Winter, T</a>, <a>Thubert, P</a> and <a>R Team</a>, "<a href="http://tools.ietf.org/html/draft-ietf-roll-rpl-05">RPL: IPv6 Routing Protocol for Low power and Lossy Networks</a>", Internet-Draft draft-ietf-roll-rpl-05, December 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</b></td>
<td class="top">
<a>Vasseur, J</a> and <a>D Networks</a>, "<a href="http://tools.ietf.org/html/draft-ietf-roll-routing-metrics-01">Routing Metrics used for Path Calculation in Low Power and Lossy Networks</a>", Internet-Draft draft-ietf-roll-routing-metrics-01, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-roll-terminology">[I-D.ietf-roll-terminology]</b></td>
<td class="top">
<a>Vasseur, J</a>, "<a href="http://tools.ietf.org/html/draft-ietf-roll-terminology-01">Terminology in Low power And Lossy Networks</a>", Internet-Draft draft-ietf-roll-terminology-01, May 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Omprakash Gnawali</span> 
	  <span class="n hidden">
		<span class="family-name">Gnawali</span>
	  </span>
	</span>
	<span class="org vcardline">Stanford University</span>
	<span class="adr">
	  <span>S255 Clark Center, 318 Campus Drive</span>

	  <span class="vcardline">
		<span class="locality">Stanford</span>,  
		<span class="region">CA</span> 
		<span class="code">94305</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 650 725 6086</span>

<span class="vcardline">EMail: <a href="mailto:gnawali@cs.stanford.edu">gnawali@cs.stanford.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Philip Levis</span> 
	  <span class="n hidden">
		<span class="family-name">Levis</span>
	  </span>
	</span>
	<span class="org vcardline">Stanford University</span>
	<span class="adr">
	  <span>358 Gates Hall, Stanford University</span>

	  <span class="vcardline">
		<span class="locality">Stanford</span>,  
		<span class="region">CA</span> 
		<span class="code">94305</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pal@cs.stanford.edu">pal@cs.stanford.edu</a></span>

  </address>
</div>

</body>
</html>