data = from[read_index++];
last_code = code;
code_index = write_index++;
code = 1;
code = from[read_index] ^ mask;
last_code = code;
