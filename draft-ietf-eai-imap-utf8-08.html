<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IMAP Support for UTF-8</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IMAP Support for UTF-8">
<meta name="keywords" content="I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Resnick</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Qualcomm Incorporated</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc3501'>3501</a> (if&nbsp;approved)</td><td class="header">C. Newman</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">Sun Microsystems</td></tr>
<tr><td class="header">Expires: March 9, 2010</td><td class="header">September 05, 2009</td></tr>
</table></td></tr></table>
<h1><br />IMAP Support for UTF-8<br />draft-ietf-eai-imap-utf8-08</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on March 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This specification extends the Internet Message Access Protocol version 4rev1 (IMAP4rev1) to support unencoded international characters in user names, mail addresses and message headers.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Conventions Used in this Document<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#utf8capa">3.</a>&nbsp;
UTF8 IMAP Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
IMAP UTF-8 Quoted Strings<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#utf8-parameter">3.2.</a>&nbsp;
UTF8 Parameter to SELECT and EXAMINE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#list-response">3.3.</a>&nbsp;
UTF-8 LIST and LSUB Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.4.</a>&nbsp;
UTF-8 Interaction with IMAP4 LIST Command Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#list-select">3.4.1.</a>&nbsp;
UTF8 and UTF8ONLY LIST Selection Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#list-return">3.4.2.</a>&nbsp;
UTF8 LIST Return Option<br />
<a href="#anchor5">4.</a>&nbsp;
UTF8=APPEND Capability<br />
<a href="#anchor6">5.</a>&nbsp;
UTF8=USER Capability<br />
<a href="#anchor7">6.</a>&nbsp;
UTF8=ALL Capability<br />
<a href="#anchor8">7.</a>&nbsp;
UTF8=ONLY Capability<br />
<a href="#upconvert">8.</a>&nbsp;
Up-Conversion Server Requirements<br />
<a href="#anchor9">9.</a>&nbsp;
Issues with UTF-8 Header Mailstore<br />
<a href="#anchor10">10.</a>&nbsp;
IANA Considerations<br />
<a href="#security">11.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#anchor13">Appendix&nbsp;A.</a>&nbsp;
Design Rationale<br />
<a href="#anchor14">Appendix&nbsp;B.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Conventions Used in this Document</h3>

<p>The key words "MUST", "MUST NOT", "SHOULD", "SHOULD NOT", and "MAY"
in this document are to be interpreted as defined in
<a class='info' href='#RFC2119'>"Key words for use in RFCs to Indicate
Requirement Levels"<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>The formal syntax use the <a class='info' href='#RFC5234'>Augmented
Backus-Naur Form (ABNF)<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5234] notation including the core rules
defined in Appendix B of RFC 4234. In addition, rules from <a class='info' href='#RFC3501'>IMAP4rev1<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3501], <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629], <a class='info' href='#RFC4466'>Collected extensions to IMAP4 ABNF<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a> [RFC4466], and <a class='info' href='#RFC5258'>IMAP4 LIST Command Extensions<span> (</span><span class='info'>Leiba, B. and A. Melnikov, &ldquo;Internet Message Access Protocol version 4 - LIST Command Extensions,&rdquo; June&nbsp;2008.</span><span>)</span></a> [RFC5258] are also referenced.
</p>
<p>In examples, "C:" and "S:" indicate lines sent by the client and
server respectively. If a single "C:" or "S:" label applies to multiple
lines, then the line breaks between those lines are for editorial
clarity only and are not part of the actual protocol exchange.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>This specification extends <a class='info' href='#RFC3501'>IMAP4rev1<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3501] to
permit unencoded <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629] in headers as described in <a class='info' href='#RFC5335'>Internationalized Email Headers<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a> [RFC5335]. It also adds a mechanism to support mailbox names, login names and passwords using the UTF-8 charset. This specification creates five new IMAP capabilities to allow servers to advertise these new extensions, along with two new IMAP list extensions and a new IMAP list return option.
</p>
<a name="utf8capa"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
UTF8 IMAP Capability</h3>

<p>The basic "UTF8" capability indicates the server supports UTF-8 quoted strings, the "UTF8" parameter to SELECT and EXAMINE, and UTF-8 responses from the LIST and LSUB commands.
</p>
<p>A client MUST use the "ENABLE UTF8" command (defined in <a class='info' href='#RFC5161'>[RFC5161]<span> (</span><span class='info'>Gulbrandsen, A. and A. Melnikov, &ldquo;The IMAP ENABLE Extension,&rdquo; March&nbsp;2008.</span><span>)</span></a>) to indicate to the server that the client accepts UTF-8 quoted-strings. The "ENABLE UTF8" command MUST only be used in the authenticated state.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
IMAP UTF-8 Quoted Strings</h3>

<p>The <a class='info' href='#RFC3501'>IMAP4rev1<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3501] base specification forbids the use of 8-bit characters in atoms or quoted strings. Thus a UTF-8 string can only be sent as a literal. This can be inconvenient from a coding standpoint, and unless the server offers <a class='info' href='#RFC2088'>IMAP4 non-synchronizing literals<span> (</span><span class='info'>Myers, J., &ldquo;IMAP4 non-synchronizing literals,&rdquo; January&nbsp;1997.</span><span>)</span></a> [RFC2088], this requires an extra round trip for each UTF-8 string sent by the client. When the IMAP server advertises the "UTF8" capability, it informs the client that it supports native UTF-8 quoted-strings with the following syntax:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  <dfn>string</dfn>        =/ <cite class='id'>utf8-quoted</cite>

  <dfn>utf8-quoted</dfn>   = "<span class='str'>*</span>" <cite class='key'>DQUOTE</cite> <span class='rep'>*</span><cite class='id'>UQUOTED-CHAR</cite> <cite class='key'>DQUOTE</cite>

  <dfn>UQUOTED-CHAR</dfn>  = <cite class='id'>QUOTED-CHAR</cite> / <cite class='id'>UTF8-2</cite> / <cite class='id'>UTF8-3</cite> / <cite class='id'>UTF8-4</cite>
             <em>; UTF8-2, UTF8-3, and UTF8-4 are as defined in RFC 3629</em>
</pre></div>
<p>When this quoting mechanism is used by the client (specifically an
octet sequence beginning with *" and ending with "), then the server
MUST reject octet sequences with the high bit set that fail to comply
with the formal syntax in <a class='info' href='#RFC3629'>[RFC3629]<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> with a
BAD response.
</p>
<p>The IMAP server MUST NOT send utf8-quoted syntax to the client unless
the client has indicated support for that syntax by using the "ENABLE UTF8" command.
</p>
<p>If the server advertises the UTF8 capability, the client MAY use utf8-quoted syntax with any IMAP argument that permits a string (including astring and nstring). However, if characters outside the US-ASCII repertoire are used in an inappropriate place, the results would be the same as if other syntacticly valid but semantically invalid characters were used. For example, if  the client includes UTF-8 characters in the user or password arguments (and the server has not advertised UTF8-USER), the LOGIN command will fail as it would with any other invalid user name or password. Specific cases where UTF-8 characters are permitted or not permitted are described in the following paragraphs.
</p>
<p>All IMAP servers that advertise the UTF8 capability SHOULD accept UTF-8 in mailbox names, and those that also support the "Mailbox International Naming Convention" described in RFC 3501 section 5.1.3 MUST accept utf8-quoted mailbox names and convert them to the appropriate internal format. Mailbox names MUST comply with the Net-Unicode Definition (section 2 of <a class='info' href='#RFC5198'>[RFC5198]<span> (</span><span class='info'>Klensin, J. and M. Padlipsky, &ldquo;Unicode Format for Network Interchange,&rdquo; March&nbsp;2008.</span><span>)</span></a>) with the specific exception that they MUST NOT contain control characters (0000-001F, 0080-009F), delete (007F), line separator (2028) or paragraph separator (2029).
</p>
<p>An IMAP client MUST NOT issue a SEARCH command that uses a mixture of 
utf8-quoted syntax and a SEARCH CHARSET other than UTF-8. If an IMAP server receives such a SEARCH command, it SHOULD reject the command with a BAD response (due to the conflicting charset labels).
</p>
<a name="utf8-parameter"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
UTF8 Parameter to SELECT and EXAMINE</h3>

<p>The "UTF8" capability also indicates the server supports the UTF8 parameter to SELECT and EXAMINE. When a mailbox is selected with the UTF8 parameter, it alters the behavior of all IMAP commands related to message sizes, message headers and MIME body headers so they refer to the message with UTF-8 headers. If the mailstore is not UTF-8 header native and the SELECT or EXAMINE command with UTF-8 header modifier succeeds, then the server MUST return results as if the mailstore was UTF-8 header native with upconversion requirements as described in <a class='info' href='#upconvert'>Section&nbsp;8<span> (</span><span class='info'>Up-Conversion Server Requirements</span><span>)</span></a>. The server MAY reject the SELECT or EXAMINE command with the [NOT-UTF-8] response code, unless the UTF8=ALL or UTF8=ONLY capability is advertised.
</p>
<p>Servers MAY include mailboxes that can only be selected or examined if the UTF8 parameter is provided. However, such mailboxes MUST NOT be included in the output of an unextended LIST, LSUB or equivalent command. If a client attempts to SELECT or EXAMINE such mailboxes without the UTF8 parameter, the server MUST reject the command with a [UTF-8-ONLY] response code. As a result, such mailboxes will not accessible by IMAP clients written prior to this specification and are discouraged unless the server advertises UTF8=ONLY or the server implements <a class='info' href='#RFC5258'>IMAP4 LIST Command Extensions<span> (</span><span class='info'>Leiba, B. and A. Melnikov, &ldquo;Internet Message Access Protocol version 4 - LIST Command Extensions,&rdquo; June&nbsp;2008.</span><span>)</span></a> [RFC5258].
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  <dfn>utf8-select-param</dfn> = "<span class='str'>UTF8</span>"
            <em>;; Conforms to &lt;select-param&gt; from RFC 4466</em>
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  C: a SELECT newmailbox (UTF8)
  S: ...
  S: a OK SELECT completed
  C: b FETCH 1 (SIZE ENVELOPE BODY)
  S: ... &lt; UTF-8 header native results &gt;
  S: b OK FETCH completed

  C: c EXAMINE legacymailbox (UTF8)
  S: c NO [NOT-UTF-8] Mailbox does not support UTF-8 access

  C: d SELECT funky-new-mailbox
  S: d NO [UTF-8-ONLY] Mailbox requires UTF-8 client
</pre></div>
<a name="list-response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
UTF-8 LIST and LSUB Responses</h3>

<p>After an IMAP client successfully issues an "ENABLE UTF8" command, the server MUST NOT return in LIST results any mailbox names to the client following the IMAP4 Mailbox International Naming Convention. Instead, the server MUST return any mailbox names with characters outside the US-ASCII repertoire using utf8-quoted syntax. (The IMAP4 Mailbox International Naming Convention has proved problematic in the past, so the desire is to make this syntax obsolete as quickly as possible.)
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
UTF-8 Interaction with IMAP4 LIST Command Extensions</h3>

<p>When an IMAP server advertises both the "UTF8" capability and the <a class='info' href='#RFC5258'>"LIST-EXTENEDED"<span> (</span><span class='info'>Leiba, B. and A. Melnikov, &ldquo;Internet Message Access Protocol version 4 - LIST Command Extensions,&rdquo; June&nbsp;2008.</span><span>)</span></a> [RFC5258] capability, the server MUST support the LIST extensions described in this section.
</p>
<a name="list-select"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.1"></a><h3>3.4.1.&nbsp;
UTF8 and UTF8ONLY LIST Selection Options</h3>

<p>The UTF8 LIST selection option tells the server to include mailboxes that only support UTF-8 headers in the output of the list command. The UTF8ONLY LIST selection option tells the server to include all mailboxes that support UTF-8 headers and to exclude mailboxes that don't support UTF-8 headers. Note that UTF8ONLY implies UTF8 so it is not necessary for the client to request both.
Use of either selection option will also result in UTF-8 mailbox names in the result as described in <a class='info' href='#list-response'>Section&nbsp;3.3<span> (</span><span class='info'>UTF-8 LIST and LSUB Responses</span><span>)</span></a> and implies the UTF8 List return option described in <a class='info' href='#list-return'>Section&nbsp;3.4.2<span> (</span><span class='info'>UTF8 LIST Return Option</span><span>)</span></a>.
</p>
<a name="list-return"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.2"></a><h3>3.4.2.&nbsp;
UTF8 LIST Return Option</h3>

<p>If the client supplies the UTF8 LIST return option, then the server MUST include either the \NoUTF8 or the \UTF8Only mailbox attribute as appropriate. The \NoUTF8 mailbox attribute indicates an attempt to SELECT or EXAMINE that mailbox with the UTF8 parameter will fail with a [NOT-UTF-8] response code. The \UTF8Only mailbox attribute indicates an attempt to SELECT or EXAMINE that mailbox without the UTF8 parameter will fail with a [UTF-8-ONLY] response code. Note that computing this information may be expensive on some server implementations so this return option should not be used unless necessary.
</p>
<p>The <a class='info' href='#RFC5234'>ABNF<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5234] for these LIST extensions follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  <dfn>list-select-independent-opt</dfn> =/ "<span class='str'>UTF8</span>"

  <dfn>list-select-base-opt</dfn>        =/ "<span class='str'>UTF8ONLY</span>"

  <dfn>mbx-list-oflag</dfn>              =/ "<span class='str'>\NoUTF8</span>" / "<span class='str'>\UTF8Only</span>"

  <dfn>return-option</dfn>               =/ "<span class='str'>UTF8</span>"

  <dfn>resp-text-code</dfn>              =/ "<span class='str'>NOT-UTF-8</span>" / "<span class='str'>UTF-8-ONLY</span>"
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
UTF8=APPEND Capability</h3>

<p>If the UTF8=APPEND capability is advertised, then the server accepts UTF-8 headers in the APPEND command message argument. A client that sends a message with UTF-8 headers to the server MUST send them using the UTF8 APPEND data extension. If the server also advertises the CATENATE capability (as specified in <a class='info' href='#RFC4469'>[RFC4469]<span> (</span><span class='info'>Resnick, P., &ldquo;Internet Message Access Protocol (IMAP) CATENATE             Extension,&rdquo; April&nbsp;2006.</span><span>)</span></a>), the client can use the same data extension to include such a message in a CATENATE message part. The ABNF for the APPEND data extension and CATENATE extension follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  <dfn>utf8-literal</dfn>   = "<span class='str'>UTF8</span>" <cite class='key'>SP</cite> "<span class='str'>(</span>" <cite class='id'>literal8</cite> "<span class='str'>)</span>"

  <dfn>append-data</dfn>    =/ <cite class='id'>utf8-literal</cite>

  <dfn>cat-part</dfn>       =/ <cite class='id'>utf8-literal</cite>
</pre></div>
<p>A server that advertises UTF8=APPEND has to comply with the requirements of the IMAP base specification and <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> for message fetching. Mechanisms for 7-bit downgrading to help comply with the standards are discussed in <a class='info' href='#RFC5504'>Downgrading mechanism for Internationalized eMail Address (IMA)<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5504].
</p>
<p>IMAP servers that do not advertise the UTF8=APPEND or UTF8=ONLY capability SHOULD reject an APPEND command that includes any 8-bit in the message headers with a "NO" response.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
UTF8=USER Capability</h3>

<p>If the UTF8=USER capability is advertised, that indicates the server
accepts UTF-8 user names and passwords and applies <a class='info' href='#RFC4013'>SASLprep<span> (</span><span class='info'>Zeilenga, K., &ldquo;SASLprep: Stringprep Profile for User Names and Passwords,&rdquo; February&nbsp;2005.</span><span>)</span></a> [RFC4013] to both arguments of the LOGIN
command. The server MUST reject UTF-8 that fails to comply with the formal syntax in <a class='info' href='#RFC3629'>RFC 3629<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629].
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
UTF8=ALL Capability</h3>

<p>This capability indicates all server mailboxes support UTF-8 headers. Specifically, SELECT and EXAMINE with the UTF8 parameter will never fail with a [NOT-UTF-8] response code.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
UTF8=ONLY Capability</h3>

<p>This capability permits an IMAP server to advertise that it does not support the international mailbox name convention (modified UTF-7), and does not permit selection or examination of any mailbox unless the UTF8 parameter is provided. As this is an incompatible change to IMAP, a clear warning is necessary. IMAP clients that find implementation of the UTF8 capability problematic are encouraged to at least detect the UTF8=ONLY capability and provide an informative error message to the end-user.
</p>
<p>When an IMAP mailbox internally uses UTF-8 header native storage, the down-conversion step necessary to permit selection or examination of the mailbox in a backwards compatible fashion will become more difficult to support. Although it is hoped deployed IMAP servers do not advertise UTF8=ONLY for some years, this capability is intended to minimize the disruption when legacy support finally goes away.
</p>
<p>The UTF8=ONLY capability implies the UTF8 base capability, the UTF8=ALL capability and the UTF8=APPEND capability. A server that advertises UTF8=ONLY need not advertise the three implicit capabilities.
</p>
<a name="upconvert"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Up-Conversion Server Requirements</h3>

<p>When an IMAP4 server uses a traditional mailbox format that includes
7-bit headers and it chooses to permit access to that mailbox with
the UTF8 parameter, it MUST support minimal up-conversion as described in
this section.
</p>
<p>The server MUST support up-conversion of the following address header-fields in the message header: From, Sender, To, CC, Bcc, Resent-From, Resent-Sender, Resent-To, Resent-CC, Resent-Bcc, and Reply-To. This up-conversion MUST include address local-parts in fields downgraded according to <a class='info' href='#RFC5504'>[RFC5504]<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a>, address domains encoded according to <a class='info' href='#RFC3490'>IDNA<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3490], and <a class='info' href='#RFC2047'>MIME header encoding<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> [RFC2047] of display-names and any <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> comments.
</p>
<p>The following charsets MUST be supported for up-conversion of <a class='info' href='#RFC2047'>MIME header encoding<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> [RFC2047]: UTF-8, US-ASCII, ISO-8859-1, ISO-8859-2, ISO-8859-3, ISO-8859-4, ISO-8859-5, ISO-8859-6, ISO-8859-7, ISO-8859-8, ISO-8859-9, ISO-8859-10, ISO-8859-14, and ISO-8859-15.
Other widely deployed MIME charsets SHOULD be supported.
</p>
<p>Up-conversion of MIME header encoding of the following headers MUST also be implemented: Subject, Date (<a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> comments only), Comments, Keywords, Content-Description.
</p>
<p>Server implementations also SHOULD up-convert all <a class='info' href='#RFC2045'>MIME body headers<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a> [RFC2045], SHOULD up-convert or remove the deprecated (and misused) <a class='info' href='#RFC1341'>"name" parameter<span> (</span><span class='info'>Borenstein, N. and N. Freed, &ldquo;MIME (Multipurpose Internet Mail Extensions): Mechanisms for Specifying and Describing the Format of Internet Message Bodies,&rdquo; June&nbsp;1992.</span><span>)</span></a> [RFC1341] on Content-Type and MUST up-convert the <a class='info' href='#RFC2183'>Content-Disposition<span> (</span><span class='info'>Troost, R., Dorner, S., and K. Moore, &ldquo;Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field,&rdquo; August&nbsp;1997.</span><span>)</span></a> [RFC2183] "filename" parameter, except when any of these are contained within a multipart/signed MIME body part (see below). These parameters can be encoded using the standard <a class='info' href='#RFC2231'>MIME parameter encoding<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a> [RFC2231] mechanism, or via non-standard use of <a class='info' href='#RFC2047'>MIME header encoding<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> [RFC2047] in quoted strings.
</p>
<p>The IMAP server MUST NOT perform up-conversion of headers and content of multipart/signed, as well as Original-Recipient and Return-Path.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Issues with UTF-8 Header Mailstore</h3>

<p>When an IMAP server uses a mailbox format that supports UTF-8 headers
and it permits selection or examination of that mailbox without the UTF8
parameter, it is the responsibility of the server to comply with the
<a class='info' href='#RFC3501'>IMAP4rev1<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3501] base specification and <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> with respect to all header information
transmitted over the wire. Mechanisms for 7-bit downgrading to help
comply with the standards are discussed in <a class='info' href='#RFC5504'>"Downgrading Mechanism for Email Address Internationalization"<span> (</span><span class='info'>Fujiwara, K. and Y. Yoneya, &ldquo;Downgrading Mechanism for Email Address Internationalization,&rdquo; March&nbsp;2009.</span><span>)</span></a> [RFC5504].
</p>
<p>An IMAP server with a mailbox that supports UTF-8 headers MUST
comply with the protocol requirements implicit from <a class='info' href='#upconvert'>Section&nbsp;8<span> (</span><span class='info'>Up-Conversion Server Requirements</span><span>)</span></a>. However, the code necessary for such compliance
need not be part of the IMAP server itself in this case. For example,
the minimal required up-conversion could be performed when a message is
inserted into the IMAP-accessible mailbox.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>This adds five new capabilities ("UTF8", "UTF8=USER", "UTF8=APPEND", "UTF8=ALL", "UTF8=ONLY") to the <a class='info' href='#RFC3501'>IMAP4rev1 capability registry<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> [RFC3501].
</p>
<p>This adds two new IMAP4 list selection options and one new IMAP4 list return option.
</p>
<ol class="text">
<li>LIST-EXTENDED option name: UTF8<br />
<br />

LIST-EXTENDED option type: SELECTION<br />
<br />

Implied return options(s): UTF8<br />
<br />

LIST-EXTENDED option description: Causes the LIST response to include mailboxes that mandate the UTF8 SELECT/EXAMINE parameter.<br />
<br />

Published specification: RFC XXXX, <a class='info' href='#list-select'>Section&nbsp;3.4.1<span> (</span><span class='info'>UTF8 and UTF8ONLY LIST Selection Options</span><span>)</span></a><br />
<br />

Security considerations: RFC XXXX, <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a><br />
<br />

Intended usage: COMMON<br />
<br />

Person an email address to contact for further information:
see Authors' Addresses at the end of this specification<br />
<br />

Owner/Change controller: iesg@ietf.org
</li>
<li>LIST-EXTENDED option name: UTF8ONLY<br />
<br />

LIST-EXTENDED option type: SELECTION<br />
<br />

Implied return options(s): UTF8<br />
<br />

LIST-EXTENDED option description: Causes the LIST response to include mailboxes that mandate the UTF8 SELECT/EXAMINE parameter and exclude mailboxes that do not support the UTF8 SELECT/EXAMINE parameter.<br />
<br />

Published specification: RFC XXXX, <a class='info' href='#list-select'>Section&nbsp;3.4.1<span> (</span><span class='info'>UTF8 and UTF8ONLY LIST Selection Options</span><span>)</span></a><br />
<br />

Security considerations: RFC XXXX, <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a><br />
<br />

Intended usage: COMMON<br />
<br />

Person an email address to contact for further information:
see Authors' Addresses at the end of this specification<br />
<br />

Owner/Change controller: iesg@ietf.org
</li>
<li>LIST-EXTENDED option name: UTF8<br />
<br />

LIST-EXTENDED option type: RETURN<br />
<br />

Implied return options(s): none<br />
<br />

LIST-EXTENDED option description: Causes the LIST response to include \NoUTF8 and \UTF8Only mailbox attributes.<br />
<br />

Published specification: RFC XXXX, <a class='info' href='#list-select'>Section&nbsp;3.4.1<span> (</span><span class='info'>UTF8 and UTF8ONLY LIST Selection Options</span><span>)</span></a><br />
<br />

Security considerations: RFC XXXX, <a class='info' href='#security'>Section&nbsp;11<span> (</span><span class='info'>Security Considerations</span><span>)</span></a><br />
<br />

Intended usage: COMMON<br />
<br />

Person an email address to contact for further information:
see Authors' Addresses at the end of this specification<br />
<br />

Owner/Change controller: iesg@ietf.org
</li>
</ol>

<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Security Considerations</h3>

<p>The security considerations of <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629]
and <a class='info' href='#RFC4013'>SASLprep<span> (</span><span class='info'>Zeilenga, K., &ldquo;SASLprep: Stringprep Profile for User Names and Passwords,&rdquo; February&nbsp;2005.</span><span>)</span></a> [RFC4013] apply to this specification,
particularly with respect to use of UTF-8 in user names and passwords. 
Otherwise, this is not believed to alter the security considerations of
IMAP4rev1.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1341">[RFC1341]</a></td>
<td class="author-text"><a href="mailto:nsb@bellcore.com">Borenstein, N.</a> and <a href="mailto:ned@innosoft.com">N. Freed</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1341">MIME (Multipurpose Internet Mail Extensions): Mechanisms for Specifying and Describing the Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;1341, June&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1341.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc1341.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc1341.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2047">[RFC2047]</a></td>
<td class="author-text"><a href="mailto:moore@cs.utk.edu">Moore, K.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2047">MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text</a>,&rdquo; RFC&nbsp;2047, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2047.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2047.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2047.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2183">[RFC2183]</a></td>
<td class="author-text"><a href="mailto:rens@century.com">Troost, R.</a>, <a href="mailto:sdorner@qualcomm.com">Dorner, S.</a>, and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2183">Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</a>,&rdquo; RFC&nbsp;2183, August&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2183.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2183.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2183.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2231">[RFC2231]</a></td>
<td class="author-text"><a href="mailto:ned.freed@innosoft.com">Freed, N.</a> and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2231">MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations</a>,&rdquo; RFC&nbsp;2231, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2231.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2231.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2231.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3490">[RFC3490]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3490.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3629">[RFC3629]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4013">[RFC4013]</a></td>
<td class="author-text">Zeilenga, K., &ldquo;<a href="http://tools.ietf.org/html/rfc4013">SASLprep: Stringprep Profile for User Names and Passwords</a>,&rdquo; RFC&nbsp;4013, February&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4013.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4466">[RFC4466]</a></td>
<td class="author-text">Melnikov, A. and C. Daboo, &ldquo;<a href="http://tools.ietf.org/html/rfc4466">Collected Extensions to IMAP4 ABNF</a>,&rdquo; RFC&nbsp;4466, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4466.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4469">[RFC4469]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4469">Internet Message Access Protocol (IMAP) CATENATE
            Extension</a>,&rdquo; RFC&nbsp;4469, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4469.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4469.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4469.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5161">[RFC5161]</a></td>
<td class="author-text">Gulbrandsen, A. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5161">The IMAP ENABLE Extension</a>,&rdquo; RFC&nbsp;5161, March&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5161.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5198">[RFC5198]</a></td>
<td class="author-text">Klensin, J. and M. Padlipsky, &ldquo;<a href="http://tools.ietf.org/html/rfc5198">Unicode Format for Network Interchange</a>,&rdquo; RFC&nbsp;5198, March&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5198.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5258">[RFC5258]</a></td>
<td class="author-text">Leiba, B. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5258">Internet Message Access Protocol version 4 - LIST Command Extensions</a>,&rdquo; RFC&nbsp;5258, June&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5258.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5322">[RFC5322]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5335">[RFC5335]</a></td>
<td class="author-text">Abel, Y., &ldquo;<a href="http://tools.ietf.org/html/rfc5335">Internationalized Email Headers</a>,&rdquo; RFC&nbsp;5335, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5335.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5504">[RFC5504]</a></td>
<td class="author-text">Fujiwara, K. and Y. Yoneya, &ldquo;<a href="http://tools.ietf.org/html/rfc5504">Downgrading Mechanism for Email Address Internationalization</a>,&rdquo; RFC&nbsp;5504, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5504.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2049">[RFC2049]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2049">Multipurpose Internet Mail Extensions (MIME) Part Five: Conformance Criteria and Examples</a>,&rdquo; RFC&nbsp;2049, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2049.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2049.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2049.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2088">[RFC2088]</a></td>
<td class="author-text"><a href="mailto:jgm+@cmu.edu">Myers, J.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2088">IMAP4 non-synchronizing literals</a>,&rdquo; RFC&nbsp;2088, January&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2088.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2277">[RFC2277]</a></td>
<td class="author-text"><a href="mailto:Harald.T.Alvestrand@uninett.no">Alvestrand, H.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2277">IETF Policy on Character Sets and Languages</a>,&rdquo; BCP&nbsp;18, RFC&nbsp;2277, January&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2277.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2277.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2277.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-eai-pop">[I-D.ietf-eai-pop]</a></td>
<td class="author-text">Gellens, R. and C. Newman, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-eai-pop-09.txt">POP3 Support for UTF-8</a>,&rdquo; draft-ietf-eai-pop-09 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-eai-pop-09.txt">TXT</a>).</td></tr>
</table>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Design Rationale</h3>

<p>This non-normative section discusses the reasons behind some of the design choices in the above specification.
</p>
<p>The basic approach of advertising the ability to access a mailbox in UTF-8 mode is intended to permit graceful upgrade, including servers that support multiple mailbox formats. In particular, it would be undesirable to force conversion of an entire server mailstore to UTF-8 headers, so being able to phase-in support for new mailboxes and gradually migrate old mailboxes is permitted by this design.
</p>
<p>UTF8=USER is optional because many identity systems are US-ASCII only, so it's helpful to inform the client up-front that UTF-8 won't work.
</p>
<p>UTF8=APPEND is optional because it effectively requires IMAP server support for down-conversion, which is a much more complex operation than up-conversion.
</p>
<p>The UTF8=ONLY mechanism simplifies diagnosis of interoperability problems when legacy support goes away. In the situation where backwards compatibility is broken anyway, just-send-UTF-8 IMAP has the advantage that it might work with some legacy clients. However, the difficulty of diagnosing interoperability problems caused by a just-send-UTF-8 IMAP mechanism is the reason the UTF8=ONLY capability mechanism was chosen.
</p>
<p>The up-conversion requirements are designed to balance the desire to deprecate and eventually eliminate complicated encodings (like MIME header encodings) without creating a significant deployment burden for servers. As
IMAP4 servers already require a MIME parser, this includes additional server up-conversion requirements not present in <a class='info' href='#I-D.ietf-eai-pop'>POP3 Support for UTF-8<span> (</span><span class='info'>Gellens, R. and C. Newman, &ldquo;POP3 Support for UTF-8,&rdquo; October&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;eai&#8209;pop].
</p>
<p>The set of mandatory charsets comes from two sources: <a class='info' href='#RFC2049'>MIME requirements<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Five: Conformance Criteria and Examples,&rdquo; November&nbsp;1996.</span><span>)</span></a> [RFC2049] and <a class='info' href='#RFC2277'>IETF Policy on Character Sets<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a> [RFC2277]. Including a requirement to up-convert widely deployed encoded ideographic charsets to UTF-8 would be reasonable for most scenarios, but may require unacceptable table sizes for some embedded devices. The open-ended recommendation to support widely deployed charsets avoids the political ramifications of attempting to list such charsets. The authors believe market forces, existing open-source software, and public conversion tables are sufficient to deploy the appropriate charsets.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Acknowledgments</h3>

<p>TBD.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pete Resnick</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qualcomm Incorporated</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5775 Morehouse Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Diego, CA  92121-1714</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 858 651 4478</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text">presnick@qualcomm.com</td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.qualcomm.com/~presnick/">http://www.qualcomm.com/~presnick/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Newman</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3401 Centrelake Dr., Suite 410</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ontario, CA  91761</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text">chris.newman@sun.com</td></tr>
</table>
</body></html>
