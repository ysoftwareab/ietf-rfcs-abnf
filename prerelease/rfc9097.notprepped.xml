<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE rfc SYSTEM "rfc2629-xhtml.ent">

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" docName="draft-ietf-ippm-capacity-metric-method-12"
number="9097" ipr="trust200902"  updates="" obsoletes="" submissionType="IETF" category="std" consensus="true" xml:lang="en" tocInclude="true" tocDepth="3" symRefs="true" sortRefs="true" version="3">

  <!-- xml2rfc v2v3 conversion 3.8.0 -->
  <front>
    <title abbrev="IP Capacity Metrics/Methods">Metrics and Methods for
    One-Way IP Capacity</title>
    <seriesInfo name="RFC" value="9097"/>
    <author fullname="Al Morton" initials="A." surname="Morton">
      <organization>AT&amp;T Labs</organization>
      <address>
        <postal>
          <street>200 Laurel Avenue South</street>
          <city>Middletown</city>
          <region>NJ</region>
          <code>07748</code>
          <country>United States of America</country>
        </postal>
        <phone>+1 732 420 1571</phone>
        <email>acm@research.att.com</email>
      </address>
    </author>
    <author fullname="RÃ¼diger Geib" initials="R." surname="Geib">
      <organization>Deutsche Telekom</organization>
      <address>
        <postal>
          <street>Heinrich Hertz Str. 3-7</street>
          <city>Darmstadt</city>
          <code>64295</code>
          <country>Germany</country>
        </postal>
        <phone>+49 6151 5812747</phone>
        <email>Ruediger.Geib@telekom.de</email>
      </address>
    </author>
    <author fullname="Len Ciavattone" initials="L." surname="Ciavattone">
      <organization>AT&amp;T Labs</organization>
      <address>
        <postal>
          <street>200 Laurel Avenue South</street>
          <city>Middletown</city>
          <region>NJ</region>
          <code>07748</code>
          <country>United States of America</country>
        </postal>
        <phone>+1 732 420 1239</phone>
        <email>lencia@att.com</email>
      </address>
    </author>
    <date month="November" year="2021"/>

<keyword>IP Layer</keyword>
<keyword>Performance</keyword>
<keyword>Speed</keyword>
<keyword>Access</keyword>

    <abstract>
      <t>This memo revisits the problem of Network Capacity Metrics first
      examined in RFC 5136. This memo specifies a more practical Maximum
      IP-Layer Capacity Metric definition catering to measurement 
      and outlines the corresponding Methods of Measurement.</t>
    </abstract>
  </front>
  <middle>
    <section numbered="true" toc="default">
      <name>Introduction</name>
      <t>The IETF's efforts to define Network Capacity and Bulk Transport Capacity (BTC) have
      been chartered and progressed for over twenty years. Over that time, the
      performance community has seen the development of Informative definitions in
      <xref target="RFC3148" format="default"/> for the Framework for Bulk Transport Capacity, <xref target="RFC5136"/> for Network Capacity and Maximum IP-Layer Capacity, and the Experimental metric definitions and methods in
"<xref target="RFC8337" format="title"/>" <xref target="RFC8337" format="default"/>.</t>
      <t>This memo revisits the problem of Network Capacity Metrics examined
      first in <xref target="RFC3148" format="default"/> and later in <xref target="RFC5136" format="default"/>.
      Maximum IP-Layer Capacity and Bulk Transfer Capacity <xref target="RFC3148" format="default"/> (goodput) are different metrics. Maximum IP-Layer Capacity is
      like the theoretical goal for goodput. There are many metrics in <xref target="RFC5136" format="default"/>, such as Available Capacity. Measurements depend on
      the network path under test and the use case. Here, the main use case is
      to assess the Maximum Capacity of one or more networks where the
      subscriber receives specific performance assurances, sometimes referred
      to as Internet access, or where a limit of the technology used on a
      path is being tested. For example, when a user subscribes to a 1 Gbps
      service, then the user, the Service Provider, and possibly other parties
      want to assure that the specified performance level is delivered. When a test confirms
      the subscribed performance level, a tester can seek the location of
      a bottleneck elsewhere.</t>
      <t>This memo recognizes the importance of a definition of a Maximum
      IP-Layer Capacity Metric at a time when Internet subscription speeds
      have increased dramatically -- a definition that is both practical and
      effective for the performance community's needs, including Internet
      users. The metric definitions are intended to use Active Methods of
      Measurement <xref target="RFC7799" format="default"/>, and a Method of Measurement is
      included for each metric.</t>
      <t>The most direct Active Measurement of IP-Layer Capacity would use IP
      packets, but in practice a transport header is needed to traverse
      address and port translators. UDP offers the most direct assessment
      possibility, and in the measurement study to investigate whether UDP is viable as a general Internet transport protocol <xref target="copycat" format="default"/>, the authors found that a high percentage of paths tested
      support UDP transport. A number of liaison statements have been exchanged on this
      topic <xref target="LS-SG12-A" format="default"/> <xref target="LS-SG12-B" format="default"/>, discussing
      the laboratory and field tests that support the UDP-based approach to
      IP-Layer Capacity measurement.</t>
      <t>This memo also recognizes the updates to the IP Performance
      Metrics (IPPM) Framework <xref target="RFC2330" format="default"/> that have been published since 1998. In particular, it makes use of <xref target="RFC7312" format="default"/> for the Advanced Stream and
      Sampling Framework and <xref target="RFC8468" format="default"/> for its IPv4, IPv6, and
      IPv4-IPv6 Coexistence Updates.</t>
      <t><xref target="app-a-load-rate-adj-pseudocode"/> describes the load rate adjustment algorithm, using
      pseudocode. <xref target="app-b-rfc8085-udp"/> discusses the algorithm's compliance with <xref target="RFC8085" format="default"/>.</t>
      <section numbered="true" toc="default">
        <name>Requirements Language</name>
       <t>The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
       "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>",
       "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>",
       "<bcp14>SHOULD NOT</bcp14>",
       "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
       "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document
       are to be interpreted as described in BCP&nbsp;14
       <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only
       when, they appear in all capitals, as shown here.</t>
      </section>
    </section>
    <section anchor="sec-2-scope" numbered="true" toc="default">
      <name>Scope, Goals, and Applicability</name>
      <t>The scope of this memo is to define Active Measurement metrics and
      corresponding methods to unambiguously determine Maximum IP-Layer
      Capacity and useful secondary metrics.</t>
      <t>Another goal is to harmonize the specified Metric and Method across
      the industry, and this memo is the vehicle that captures IETF consensus,
      possibly resulting in changes to the specifications of other Standards
      Development Organizations (SDOs) (through each SDO's normal contribution
      process or through liaison exchange).</t>
      <t>Secondary goals are to add considerations for test procedures and to
      provide interpretation of the Maximum IP-Layer Capacity results (to
      identify cases where more testing is warranted, possibly with alternate
      configurations). Fostering the development of protocol support for this
      Metric and Method of Measurement is also a goal of this memo (all active
      testing protocols currently defined by the IPPM WG are UDP based,
      meeting a key requirement of these methods). The supporting protocol
      development to measure this metric according to the specified method is
      a key future contribution to Internet measurement.</t>
      <t>The load rate adjustment algorithm's scope is limited to helping
      determine the Maximum IP-Layer Capacity in the context of an infrequent,
      diagnostic, short-term measurement. It is <bcp14>RECOMMENDED</bcp14> to discontinue
      non-measurement traffic that shares a subscriber's dedicated resources
      while testing: measurements may not be accurate, and throughput of
      competing elastic traffic may be greatly reduced.</t>
      <t>The primary application of the Metrics and Methods of Measurement
      described here is the same as what is described in <xref target="RFC7497" sectionFormat="of" section="2"/>, where:</t>

        <blockquote>The access portion of the network is the focus of this problem
          statement. The user typically subscribes to a service with
          bidirectional [Internet] access partly described by rates in bits per
          second.</blockquote>
      <t>In addition, the use of the load rate adjustment algorithm
      described in <xref target="load-rate-adj"/> has the following additional applicability
      limitations:</t>
      <ul spacing="normal">
      <li>It <bcp14>MUST</bcp14> only be used in the application of diagnostic and operations
      measurements as described in this memo.</li>
      <li>It <bcp14>MUST</bcp14> only be used in circumstances consistent with
      <xref target="sec-cons"/> ("Security Considerations").</li>
      <li>If a network operator is certain of the IP-Layer Capacity to be
      validated, then testing <bcp14>MAY</bcp14> start with a fixed-rate test at the IP-Layer
      Capacity and avoid activating the load adjustment algorithm. However,
      the stimulus for a diagnostic test (such as a subscriber request)
      strongly implies that there is no certainty, and the load adjustment
      algorithm is <bcp14>RECOMMENDED</bcp14>.</li>
      </ul>
      <t>Further, the Metrics and Methods of Measurement are intended for use
      where specific exact path information is unknown within a range of
      possible values:</t>
      <ul spacing="normal">
      <li>The subscriber's exact Maximum IP-Layer Capacity is unknown (which
      is sometimes the case; service rates can be increased due to upgrades
      without a subscriber's request or increased to provide a surplus to compensate
      for possible underestimates of TCP-based testing).</li>
      <li>The size of the bottleneck buffer is unknown.</li>
      </ul>
      <t>Finally, the measurement system's load rate adjustment algorithm
      <bcp14>SHALL NOT</bcp14> be provided with the exact capacity value to be validated a&nbsp;priori. This restriction fosters a fair result and removes an
      opportunity for nefarious operation enabled by knowledge of the correct answer.</t>
    </section>
    <section numbered="true" toc="default">
      <name>Motivation</name>
      <t>As with any problem that has been worked on for many years in various
      SDOs without any special attempts at coordination, various solutions for
      Metrics and Methods have emerged.</t>
      <t>There are five factors that have changed (or began to change) in the
      2013-2019 time frame, and the presence of any one of them on the path
      requires features in the measurement design to account for the
      changes:

</t>
      <ol spacing="normal" type="1"><li>Internet access is no longer the bottleneck for many users (but
          subscribers expect network providers to honor contracted
          performance).</li>
        <li>Both transfer rate and latency are important to a user's
          satisfaction.</li>
        <li>UDP's role in transport is growing in areas where TCP once
          dominated.</li>
        <li>Content and applications are moving physically closer to
          users.</li>
        <li>There is less emphasis on ISP gateway measurements, possibly due
          to less traffic crossing ISP gateways in the future.</li>
      </ol>
    </section>
    <section anchor="gen-params-defs" numbered="true" toc="default">
      <name>General Parameters and Definitions</name>
      <t>This section lists the <bcp14>REQUIRED</bcp14> input factors to specify a Sender or
      Receiver metric.</t>
      <dl spacing="normal">
        <dt>Src:</dt><dd>One of the addresses of a host (such as a globally routable
          IP address).</dd>
        <dt>Dst:</dt><dd>One of the addresses of a host (such as a globally routable
          IP address).</dd>
        <dt>MaxHops:</dt><dd>The limit on the number of Hops a specific packet may
          visit as it traverses from the host at Src to the host at Dst
          (implemented in the TTL or Hop Limit).</dd>
        <dt>T0:</dt><dd>The time at the start of a measurement interval, when packets
          are first transmitted from the Source.</dd>
        <dt>I:</dt><dd>The nominal duration of a measurement interval at the
          Destination (default 10 sec).</dd>
        <dt>dt:</dt><dd>The nominal duration of m equal sub-intervals in I at the
          Destination (default 1 sec).</dd>
        <dt>dtn:</dt><dd>The beginning boundary of a specific sub-interval, n, one of
          m sub-intervals in I.</dd>
        <dt>FT:</dt><dd>The feedback time interval between status feedback messages
          communicating measurement results, sent from the Receiver to control
          the Sender. The results are evaluated throughout the test to
          determine how to adjust the current offered load rate at the Sender
          (default 50 msec).</dd>
        <dt>Tmax:</dt><dd>A maximum waiting time for test packets to arrive at the
          Destination, set sufficiently long to disambiguate packets with long
          delays from packets that are discarded (lost), such that the
          distribution of one-way delay is not truncated.</dd>
        <dt>F:</dt><dd>The number of different flows synthesized by the method
          (default one flow).</dd>
        <dt>Flow:</dt><dd>The stream of packets with the same n-tuple of designated
          header fields that (when held constant) result in identical
          treatment in a multipath decision (such as the decision taken in
          load balancing). Note: The IPv6 flow label <bcp14>SHOULD</bcp14> be included in the
          flow definition when routers have complied with the guidelines provided in <xref target="RFC6438" format="default"/>.</dd>
        <dt>Type-P:</dt><dd>The complete description of the test packets for which
          this assessment applies (including the flow-defining fields). Note
          that the UDP transport layer is one requirement for test packets
          specified below. Type-P is a concept parallel to "population of
          interest" as defined in Clause 6.1.1 of <xref target="Y.1540" format="default"/>.</dd>
        <dt>Payload Content:</dt><dd>An aspect of the Type-P Parameter that 
can help to improve measurement determinism. Specifying packet payload content
helps to ensure IPPM Framework-conforming Metrics and Methods. If
          there is payload compression in the path and tests intend to
          characterize a possible advantage due to compression, then payload
          content <bcp14>SHOULD</bcp14> be supplied by a pseudorandom sequence generator, by
          using part of a compressed file, or by other means. See
          <xref target="RFC7312" sectionFormat="of" section="3.1.2"/>.</dd>
        <dt>PM:</dt><dd>A list of fundamental metrics, such as loss, delay, and
          reordering, and corresponding target performance threshold(s). At least
          one fundamental metric and target performance threshold <bcp14>MUST</bcp14> be
          supplied (such as one-way IP packet loss <xref target="RFC7680" format="default"/>
          equal to zero).</dd>
      </dl>
      <t>A non-Parameter that is required for several metrics is
      defined below:</t>
      <dl spacing="normal">
        <dt>T:</dt><dd>The host time of the <strong>first</strong> test packet's <strong>arrival</strong> as
          measured at the Destination Measurement Point, or MP(Dst). There may
          be other packets sent between Source and Destination hosts that are
          excluded, so this is the time of arrival of the first packet used
          for measurement of the metric.</dd>
      </dl>
      <t>Note that timestamp format and resolution, sequence numbers,
      etc. will be established by the chosen test protocol standard or
      implementation.</t>
    </section>
    <section numbered="true" toc="default">
      <name>IP-Layer Capacity Singleton Metric Definitions</name>
      <t>This section sets requirements for the Singleton metric that supports
      the Maximum IP-Layer Capacity Metric definitions in <xref target="max-ip-metric-defs"/>.</t>
      <section numbered="true" toc="default">
        <name>Formal Name</name>
        <t>"Type-P-One-way-IP-Capacity" is the formal name; it is informally called "IP-Layer Capacity".</t>
        <t>Note that Type-P depends on the chosen method.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Parameters</name>
        <t>This section lists the <bcp14>REQUIRED</bcp14> input factors to specify the
        metric, beyond those listed in <xref target="gen-params-defs"/>.</t>
        <t>No additional Parameters are needed.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Metric Definitions</name>
        <t>This section defines the <bcp14>REQUIRED</bcp14> aspects of the measurable
        IP-Layer Capacity Metric (unless otherwise indicated) for measurements
        between specified Source and Destination hosts:</t>
        <t>Define the IP-Layer Capacity, C(T,dt,PM), to be the number of
        IP-Layer bits (including header and data fields) in packets that can
        be transmitted from the Src host and correctly received by the Dst
        host during one contiguous sub-interval, dt in length. The IP-Layer
        Capacity depends on the Src and Dst hosts, the host addresses, and the
        path between the hosts.</t>
        <t>The number of these IP-Layer bits is designated n0[dtn,dtn+1] for a
        specific dt.</t>
        <t>When the packet size is known and of fixed size, the packet count
        during a single sub-interval dt multiplied by the total bits in IP
        header and data fields is equal to n0[dtn,dtn+1].</t>
        <t>Anticipating a Sample of Singletons, the number of sub-intervals
        with duration dt <bcp14>MUST</bcp14> be set to a natural number m, so that T+I = T +
        m*dt with dtn+1 - dtn = dt for 1 &lt;= n &lt;= m.</t>
        <t>Parameter PM represents other performance metrics (see <xref target="sec5-4-rt-delay"/>
        below); their measurement results <bcp14>SHALL</bcp14> be collected during
        measurement of IP-Layer Capacity and associated with the corresponding
        dtn for further evaluation and reporting. Users <bcp14>SHALL</bcp14> specify the
        Parameter Tmax as required by each metric's reference definition.</t>
        <t>Mathematically, this definition is represented as (for each n):</t>
        <figure>
          <name>Equation for IP-Layer Capacity</name>
          <artwork align="center" name="" type="ascii-art" alt=""><![CDATA[
                 ( n0[dtn,dtn+1] )
 C(T,dt,PM) = -------------------------
                        dt
]]></artwork>
        </figure>
        <t>and:</t>
        <ul spacing="normal">
          <li>n0 is the total number of IP-Layer header and payload bits that
            can be transmitted in standard-formed packets <xref target="RFC8468" format="default"/> from the Src host and correctly received by the
            Dst host during one contiguous sub-interval, dt in length, during
            the interval [T,T+I].</li>
          <li>C(T,dt,PM), the IP-Layer Capacity, corresponds to the value of
            n0 measured in any sub-interval beginning at dtn, divided by the
            length of the sub-interval, dt.</li>
          <li>PM represents other performance metrics (see <xref target="sec5-4-rt-delay"/>
            below); their measurement results <bcp14>SHALL</bcp14> be collected during
            measurement of IP-Layer Capacity and associated with the
            corresponding dtn for further evaluation and reporting.</li>
          <li>All sub-intervals <bcp14>MUST</bcp14> be of equal duration. Choosing dt as
            non-overlapping consecutive time intervals allows for a simple
            implementation.</li>
          <li>The bit rate of the physical interface of the measurement
            devices <bcp14>MUST</bcp14> be higher than the smallest of the links on the path
            whose C(T,I,PM) is to be measured (the bottleneck link).</li>
        </ul>
        <t>Measurements according to this definition <bcp14>SHALL</bcp14> use the UDP
        transport layer. Standard-formed packets are specified in <xref target="RFC8468" sectionFormat="of" section="5"/>. The measurement <bcp14>SHOULD</bcp14> use a randomized
        Source port or equivalent technique, and <bcp14>SHOULD</bcp14> send responses from
        the Source address matching the test packet Destination address.</t>
        <t>Some effects of compression on measurement are discussed in
<xref target="RFC8468" sectionFormat="of" section="6"/>.</t>
      </section>
      <section anchor="sec5-4-rt-delay" numbered="true" toc="default">
        <name>Related Round-Trip Delay and One-Way Loss Definitions</name>
        <t>RTD[dtn,dtn+1] is defined as a Sample of the Round-Trip Delay <xref target="RFC2681" format="default"/> between the Src host and the Dst
        host during the interval [T,T+I] (that contains equal non-overlapping
        intervals of dt). The "reasonable period of time" mentioned in <xref target="RFC2681" format="default"/> is the Parameter Tmax in this memo. The statistics
        used to summarize RTD[dtn,dtn+1] <bcp14>MAY</bcp14> include the minimum, maximum,
        median, mean, and the range = (maximum - minimum). Some of these statistics are needed for load adjustment purposes (<xref target="load-rate-adj"/>), measurement qualification (<xref target="meas-qual-verif"/>), and reporting (<xref target="rpt-formats"/>).
</t>
        <t>OWL[dtn,dtn+1] is defined as a Sample of the One-Way Loss <xref target="RFC7680" format="default"/> between the Src host and the Dst host
        during the interval [T,T+I] (that contains equal non-overlapping
        intervals of dt). The statistics used to summarize OWL[dtn,dtn+1] <bcp14>MAY</bcp14>
        include the count of lost packets and the ratio of lost packets.</t>
        <t>Other metrics <bcp14>MAY</bcp14> be measured: one-way reordering, duplication, and
        delay variation.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Discussion</name>
        <t>See the corresponding section for Maximum IP-Layer Capacity (<xref target="Maximum-IP-Layer-Capacity-Discussion" format="default"/>).
</t>
      </section>
      <section numbered="true" toc="default">
        <name>Reporting the Metric</name>
        <t>The IP-Layer Capacity <bcp14>SHOULD</bcp14> be reported with at least
        single-Megabit resolution, in units of Megabits per second (Mbps) (which,
        to avoid any confusion, is 1,000,000 bits per second).</t>
        <t>The related One-Way Loss metric and Round-Trip Delay measurements
        for the same Singleton <bcp14>SHALL</bcp14> be reported, also with meaningful
        resolution for the values measured.</t>
        <t>Individual Capacity measurements <bcp14>MAY</bcp14> be reported in a manner
        consistent with the Maximum IP-Layer Capacity; see <xref target="rpt-formats"/>.</t>
      </section>
    </section>
    <section anchor="max-ip-metric-defs" numbered="true" toc="default">
      <name>Maximum IP-Layer Capacity Metric Definitions (Statistics)</name>
      <t>This section sets requirements for the following components to
      support the Maximum IP-Layer Capacity Metric.</t>
      <section numbered="true" toc="default">
        <name>Formal Name</name>
        <t>"Type-P-One-way-Max-IP-Capacity" is the formal name; it is informally called "Maximum IP-Layer Capacity".</t>
        <t>Note that Type-P depends on the chosen method.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Parameters</name>
        <t>This section lists the <bcp14>REQUIRED</bcp14> input factors to specify the
        metric, beyond those listed in <xref target="gen-params-defs"/>.</t>
        <t>No additional Parameters or definitions are needed.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Metric Definitions</name>
        <t>This section defines the <bcp14>REQUIRED</bcp14> aspects of the Maximum IP-Layer
        Capacity Metric (unless otherwise indicated) for measurements between
        specified Source and Destination hosts:</t>
        <t>Define the Maximum IP-Layer Capacity, Maximum_C(T,I,PM), to be the
        maximum number of IP-Layer bits n0[dtn,dtn+1] divided by dt that can
        be transmitted in packets from the Src host and correctly received by
        the Dst host, over all dt-length intervals in [T,T+I] and meeting
        the PM criteria. An equivalent definition would be the maximum of a Sample of size m of Singletons
        C(T,I,PM) collected during the interval [T,T+I] and meeting the PM
        criteria.</t>
        <t>The number of sub-intervals with duration dt <bcp14>MUST</bcp14> be set to a
        natural number m, so that T+I = T + m*dt with dtn+1 - dtn = dt for 1
        &lt;= n &lt;= m.</t>
        <t>Parameter PM represents the other performance metrics (see
        <xref target="sec6-4-rt-delay"/> below) and their measurement results for the Maximum IP-Layer
        Capacity. At least one target performance threshold (PM criterion)
        <bcp14>MUST</bcp14> be defined. If more than one metric and target performance
        threshold is defined, then the sub-interval with the maximum number of
        bits transmitted <bcp14>MUST</bcp14> meet all the target performance thresholds.
        Users <bcp14>SHALL</bcp14> specify the Parameter Tmax as required by each metric's
        reference definition.</t>
        <t>Mathematically, this definition can be represented as:</t>
        <figure>
          <name>Equation for Maximum Capacity</name>
          <artwork align="center" name="" type="ascii-art" alt=""><![CDATA[
                        max  ( n0[dtn,dtn+1] )
                        [T,T+I]
  Maximum_C(T,I,PM) = -------------------------
                                 dt

  where:

    T                                      T+I
    _________________________________________
    |   |   |   |   |   |   |   |   |   |   |
dtn=1   2   3   4   5   6   7   8   9  10  n+1
                                       n=m
]]></artwork>
        </figure>
        <t>and:</t>
        <ul spacing="normal">
          <li>n0 is the total number of IP-Layer header and payload bits that
            can be transmitted in standard-formed packets from the Src host
            and correctly received by the Dst host during one contiguous
            sub-interval, dt in length, during the interval [T,T+I].</li>
          <li>Maximum_C(T,I,PM), the Maximum IP-Layer Capacity, corresponds to
            the maximum value of n0 measured in any sub-interval beginning at
            dtn, divided by the constant length of all sub-intervals, dt.</li>
          <li>PM represents the other performance metrics (see <xref target="sec6-4-rt-delay"/>)
            and their measurement results for the Maximum IP-Layer Capacity.
            At least one target performance threshold (PM criterion) <bcp14>MUST</bcp14> be
            defined.</li>
          <li>All sub-intervals <bcp14>MUST</bcp14> be of equal duration. Choosing dt as
            non-overlapping consecutive time intervals allows for a simple
            implementation.</li>
          <li>The bit rate of the physical interface of the measurement
            systems <bcp14>MUST</bcp14> be higher than the smallest of the links on the path
            whose Maximum_C(T,I,PM) is to be measured (the bottleneck
            link).</li>
        </ul>
        <t>In this definition, the m sub-intervals can be viewed as trials
        when the Src host varies the transmitted packet rate, searching for
        the maximum n0 that meets the PM criteria measured at the Dst host in
        a test of duration I. When the transmitted packet rate is held
        constant at the Src host, the m sub-intervals may also be viewed as
        trials to evaluate the stability of n0 and metric(s) in the PM list
        over all dt-length intervals in I.</t>
        <t>Measurements according to these definitions <bcp14>SHALL</bcp14> use the UDP
        transport layer.</t>
      </section>
      <section anchor="sec6-4-rt-delay" numbered="true" toc="default">
        <name>Related Round-Trip Delay and One-Way Loss Definitions</name>
        <t>RTD[dtn,dtn+1] and OWL[dtn,dtn+1] are defined in <xref target="sec5-4-rt-delay"/>. Here,
        the test intervals are increased to match the capacity Samples,
        RTD[T,I] and OWL[T,I].</t>
        <t>The interval dtn,dtn+1 where Maximum_C(T,I,PM) occurs is the
        reporting sub-interval for RTD[dtn,dtn+1] and OWL[dtn,dtn+1] within RTD[T,I] and OWL[T,I].</t>
        <t>Other metrics <bcp14>MAY</bcp14> be measured: one-way reordering, duplication, and
        delay variation.</t>
      </section>
      <section numbered="true" toc="default" anchor="Maximum-IP-Layer-Capacity-Discussion">
        <name>Discussion</name>
        <t>If traffic conditioning (e.g., shaping, policing) applies along a
        path for which Maximum_C(T,I,PM) is to be determined, different values
        for dt <bcp14>SHOULD</bcp14> be picked and measurements executed during multiple
        intervals [T,T+I]. Each duration dt <bcp14>SHOULD</bcp14> be chosen so that it is an
        integer multiple of increasing values k times serialization delay of a
        Path MTU (PMTU) at the physical interface speed where traffic conditioning is
        expected. This should avoid taking configured burst tolerance
        Singletons as a valid Maximum_C(T,I,PM) result.</t>
        <t>A Maximum_C(T,I,PM) without any indication of bottleneck
        congestion, be that increased latency, packet loss, or Explicit Congestion
        Notification (ECN) marks during a measurement interval, I, is likely an
        underestimate of Maximum_C(T,I,PM).</t>
      </section>
      <section anchor="sec6-6-rpt-the-metric" numbered="true" toc="default">
        <name>Reporting the Metric</name>
        <t>The IP-Layer Capacity <bcp14>SHOULD</bcp14> be reported with at least
        single-Megabit resolution, in units of Megabits per second (Mbps) (which,
        to avoid any confusion, is 1,000,000 bits per second).</t>
        <t>The related One-Way Loss metric and Round-Trip Delay measurements
        for the same Singleton <bcp14>SHALL</bcp14> be reported, also with meaningful
        resolution for the values measured.</t>
        <t>When there are demonstrated and repeatable Capacity modes in the
        Sample, the Maximum IP-Layer Capacity <bcp14>SHALL</bcp14> be reported for each
        mode, along with the relative time from the beginning of the stream
        that the mode was observed to be present. Bimodal Maximum IP-Layer
        Capacities have been observed with some services, sometimes called a
        "turbo mode" intending to deliver short transfers more quickly or
        reduce the initial buffering time for some video streams. Note that
        modes lasting less than duration dt will not be detected.</t>
        <t>Some transmission technologies have multiple methods of operation
        that may be activated when channel conditions degrade or improve, and
        these transmission methods may determine the Maximum IP-Layer
        Capacity. Examples include line-of-sight microwave modulator
        constellations, or cellular modem technologies where the changes may
        be initiated by a user moving from one coverage area to another.
        Operation in the different transmission methods may be observed over
        time, but the modes of Maximum IP-Layer Capacity will not be activated
        deterministically as with the "turbo mode" described in the paragraph
        above.</t>
      </section>
    </section>
    <section anchor="ip-layer-sender-br" numbered="true" toc="default">
      <name>IP-Layer Sender Bit Rate Singleton Metric Definitions</name>
      <t>This section sets requirements for the following components to
      support the IP-Layer Sender Bit Rate Metric. This metric helps to check
      that the Sender actually generated the desired rates during a test, and
      measurement takes place at the interface between the Src host and the network path (or as
      close as practical within the Src host). It is not a metric for path
      performance.</t>
      <section numbered="true" toc="default">
        <name>Formal Name</name>
        <t>"Type-P-IP-Sender-Bit-Rate" is the formal name; it is informally called the "IP-Layer Sender Bit Rate".</t>
        <t>Note that Type-P depends on the chosen method.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Parameters</name>
        <t>This section lists the <bcp14>REQUIRED</bcp14> input factors to specify the
        metric, beyond those listed in <xref target="gen-params-defs"/>.</t>
        <dl spacing="normal">
          <dt>S:</dt><dd>The duration of the measurement interval at the Source.</dd>
          <dt>st:</dt><dd>The nominal duration of N sub-intervals in S (default st =
            0.05 seconds).</dd>
          <dt>stn:</dt><dd>The beginning boundary of a specific sub-interval, n, one
            of N sub-intervals in S.</dd>
	</dl>
        <t>S <bcp14>SHALL</bcp14> be longer than I, primarily to account for on-demand
        activation of the path, or any preamble to testing required, and the
        delay of the path.</t>
        <t>st <bcp14>SHOULD</bcp14> be much smaller than the sub-interval dt and on the same
        order as FT; otherwise, the rate measurement will include many rate
        adjustments and include more time smoothing, possibly smoothing the interval that contains the Maximum
        IP-Layer Capacity (and therefore losing relevance). The st Parameter does not have relevance when the
        Source is transmitting at a fixed rate throughout S.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Metric Definition</name>
        <t>This section defines the <bcp14>REQUIRED</bcp14> aspects of the IP-Layer Sender
        Bit Rate Metric (unless otherwise indicated) for measurements at the
        specified Source on packets addressed for the intended Destination
        host and matching the required Type-P:</t>
        <t>Define the IP-Layer Sender Bit Rate, B(S,st), to be the number of
        IP-Layer bits (including header and data fields) that are transmitted
        from the Source with address pair Src and Dst during one contiguous
        sub-interval, st, during the test interval S (where S <bcp14>SHALL</bcp14> be longer
        than I) and where the fixed-size packet count during that single
        sub-interval st also provides the number of IP-Layer bits in any
        interval, [stn,stn+1].</t>
        <t>Measurements according to this definition <bcp14>SHALL</bcp14> use the UDP
        transport layer. Any feedback from the Dst host to the Src host received by the
        Src host during an interval [stn,stn+1] <bcp14>SHOULD NOT</bcp14> result in an
        adaptation of the Src host traffic conditioning during this interval
        (rate adjustment occurs on st interval boundaries).</t>
      </section>
      <section numbered="true" toc="default">
        <name>Discussion</name>
        <t>Both the Sender and Receiver (or Source and Destination) bit rates <bcp14>SHOULD</bcp14> be assessed as part of an IP-Layer Capacity measurement.
        Otherwise, an unexpected sending rate limitation could produce an
        erroneous Maximum IP-Layer Capacity measurement.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Reporting the Metric</name>
        <t>The IP-Layer Sender Bit Rate <bcp14>SHALL</bcp14> be reported with meaningful
        resolution, in units of Megabits per second (which, to avoid any confusion,
        is 1,000,000 bits per second).</t>
        <t>Individual IP-Layer Sender Bit Rate measurements are discussed
        further in <xref target="rpt-formats"/>.</t>
      </section>
    </section>
    <section numbered="true" toc="default">
      <name>Method of Measurement</name>
      <t>It is <bcp14>REQUIRED</bcp14> per the architecture of the method that two cooperating hosts operate in the roles of Src (test packet Sender) and Dst (Receiver)
      with a measured path and return path between them.</t>
      <t>The duration of a test, Parameter I, <bcp14>MUST</bcp14> be constrained in a
      production network, since this is an active test method and it will
      likely cause congestion on the path from the Src host to the Dst host during a test.</t>
      <section anchor="load-rate-adj" numbered="true" toc="default">
        <name>Load Rate Adjustment Algorithm</name>
        <t>The algorithm described in this section <bcp14>MUST NOT</bcp14> be used as a
        general Congestion Control Algorithm (CCA). As stated in 
        <xref target="sec-2-scope"/> ("Scope, Goals, and Applicability"), the load rate adjustment algorithm's goal is to help
        determine the Maximum IP-Layer Capacity in the context of an
        infrequent, diagnostic, short-term measurement. There is a trade-off
        between test duration (also the test data volume) and algorithm
        aggressiveness (speed of ramp-up and ramp-down to the Maximum IP-Layer
        Capacity). The Parameter values chosen below strike a well-tested
        balance among these factors.</t>
        <t>A table <bcp14>SHALL</bcp14> be pre-built (by the test administrator), defining all the
        offered load rates that will be supported (R1 through Rn, in ascending
        order, corresponding to indexed rows in the table). It is <bcp14>RECOMMENDED</bcp14>
        that rates begin with 0.5 Mbps at index zero, use 1 Mbps at index one,
        and then continue in 1 Mbps increments to 1 Gbps. Above 1 Gbps, and up
        to 10 Gbps, it is <bcp14>RECOMMENDED</bcp14> that 100 Mbps increments be used. Above
        10 Gbps, increments of 1 Gbps are <bcp14>RECOMMENDED</bcp14>. A higher initial
        IP-Layer Sender Bit Rate might be configured when the test operator is
        certain that the Maximum IP-Layer Capacity is well above the initial
        IP-Layer Sender Bit Rate and factors such as test duration and total
        test traffic play an important role. The sending rate table <bcp14>SHOULD</bcp14>
        bracket the Maximum Capacity where it will make measurements, including
        constrained rates less than 500 kbps if applicable.</t>
        <t>Each rate is defined as datagrams of size ss, sent as a burst of
        count cc, each time interval tt (the default for tt is 100 microsec, a likely
        system tick interval). While it is advantageous to use datagrams of as
        large a size as possible, it may be prudent to use a slightly smaller
        maximum that allows for secondary protocol headers and/or tunneling
        without resulting in IP-Layer fragmentation. Selection of a new rate
        is indicated by a calculation on the current row, Rx. For example:</t>
        <dl newline="false" spacing="normal">
        <dt>"Rx+1":</dt><dd>The Sender uses the next-higher rate in the table.</dd>
        <dt>"Rx-10":</dt><dd>The Sender uses the rate 10 rows lower in the table.</dd>
	</dl>
        <t>At the beginning of a test, the Sender begins sending at rate R1
        and the Receiver starts a feedback timer of duration FT (while
        awaiting inbound datagrams). As datagrams are received, they are
        checked for sequence number anomalies (loss, out-of-order,
        duplication, etc.) and the delay range is measured (one-way or
        round-trip). This information is accumulated until the feedback timer
        FT expires and a status feedback message is sent from the Receiver
        back to the Sender, to communicate this information. The accumulated
        statistics are then reset by the Receiver for the next feedback
        interval. As feedback messages are received back at the Sender, they
        are evaluated to determine how to adjust the current offered load rate
        (Rx).</t>
        <t>If the feedback indicates that no sequence number anomalies were
        detected AND the delay range was below the lower threshold, the
        offered load rate is increased. If congestion has not been confirmed
        up to this point (see below for the method for declaring congestion), the
        offered load rate is increased by more than one rate setting (e.g., Rx+10).
        This allows the offered load to quickly reach a near-maximum rate.
        Conversely, if congestion has been previously confirmed, the offered
        load rate is only increased by one (Rx+1). However, if a rate
        threshold above a high sending rate (such as 1 Gbps) is
        exceeded, the offered load rate is only increased by one (Rx+1) 
        in any congestion state.</t>
        <t>If the feedback indicates that sequence number anomalies were
        detected OR the delay range was above the upper threshold, the offered
        load rate is decreased. The <bcp14>RECOMMENDED</bcp14> threshold values are 10 for
        sequence number gaps and 30 msec for lower and 90 msec for upper delay
        thresholds, respectively. Also, if congestion is now confirmed for the
        first time by the current feedback message being processed, then the
        offered load rate is decreased by more than one rate setting (e.g., Rx-30).
        This one-time reduction is intended to compensate for the fast initial
        ramp-up. In all other cases, the offered load rate is only decreased
        by one (Rx-1).</t>
        <t>If the feedback indicates that there were no sequence number
        anomalies AND the delay range was above the lower threshold but below
        the upper threshold, the offered load rate is not changed. This allows
        time for recent changes in the offered load rate to stabilize and for the
        feedback to represent current conditions more accurately.</t>
        <t>Lastly, the method for inferring congestion is that there were
        sequence number anomalies AND/OR the delay range was above the upper
        threshold for three consecutive feedback intervals. The algorithm
        described above is also illustrated in Annex B of ITU-T Recommendation Y.1540, 2020
        version <xref target="Y.1540" format="default"/> and is implemented in <xref target="app-a-load-rate-adj-pseudocode"/> ("Load Rate Adjustment Pseudocode")
        in this memo.</t>
        <t>The load rate adjustment algorithm <bcp14>MUST</bcp14> include timers that stop
        the test when received packet streams cease unexpectedly. The timeout
        thresholds are provided in <xref target="load-rate-adj-params"/>, along with values for all
        other Parameters and variables described in this section. Operations of
        non-obvious Parameters appear below:</t>
        <dl newline="true" spacing="normal">
          <dt>load packet timeout:</dt>
          <dd>The load packet
            timeout <bcp14>SHALL</bcp14> be reset to the configured value each time a load
            packet is received. If the timeout expires, the Receiver <bcp14>SHALL</bcp14> be
            closed and no further feedback sent.</dd>
          <dt>feedback message timeout:</dt>
          <dd>The feedback
            message timeout <bcp14>SHALL</bcp14> be reset to the configured value each time a
            feedback message is received. If the timeout expires, the Sender
            <bcp14>SHALL</bcp14> be closed and no further load packets sent.</dd>
        </dl>
        <table align="center" anchor="load-rate-adj-params">
          <name>Parameters for Load Rate Adjustment Algorithm</name>
          <thead>
            <tr>
              <th align="left">Parameter</th>
              <th align="left">Default</th>
              <th align="left">Tested Range or Values</th>
              <th align="left">Expected Safe Range (not entirely tested, other
          values <bcp14>NOT RECOMMENDED</bcp14>)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left">FT, feedback time interval</td>
              <td align="left">50 msec</td>
              <td align="left">20 msec, 50 msec, 100 msec</td>
              <td align="left">20 msec &lt;= FT &lt;= 250 msec; larger values may slow the rate
          increase and fail to find the max</td>
            </tr>
            <tr>
              <td align="left">Feedback message timeout (stop test)</td>
              <td align="left">L*FT, L=20 (1 sec with FT=50 msec)</td>
              <td align="left">L=100 with FT=50 msec (5 sec)</td>
              <td align="left">0.5 sec &lt;= L*FT &lt;= 30 sec; upper limit for very unreliable
          test paths only</td>
            </tr>
            <tr>
              <td align="left">Load packet timeout (stop test)</td>
              <td align="left">1 sec</td>
              <td align="left">5 sec</td>
              <td align="left">0.250-30 sec; upper limit for very unreliable test paths
          only</td>
            </tr>
            <tr>
              <td align="left">Table index 0</td>
              <td align="left">0.5 Mbps</td>
              <td align="left">0.5 Mbps</td>
              <td align="left">When testing &lt;= 10 Gbps</td>
            </tr>
            <tr>
              <td align="left">Table index 1</td>
              <td align="left">1 Mbps</td>
              <td align="left">1 Mbps</td>
              <td align="left">When testing &lt;= 10 Gbps</td>
            </tr>
            <tr>
              <td align="left">Table index (step) size</td>
              <td align="left">1 Mbps</td>
              <td align="left">1 Mbps &lt;= rate &lt;= 1 Gbps</td>
              <td align="left">Same as tested</td>
            </tr>
            <tr>
              <td align="left">Table index (step) size, rate &gt; 1 Gbps</td>
              <td align="left">100 Mbps</td>
              <td align="left">1 Gbps &lt;= rate &lt;= 10 Gbps</td>
              <td align="left">Same as tested</td>
            </tr>
            <tr>
              <td align="left">Table index (step) size, rate &gt; 10 Gbps</td>
              <td align="left">1 Gbps</td>
              <td align="left">Untested</td>
              <td align="left">&gt;10 Gbps</td>
            </tr>
            <tr>
              <td align="left">ss, UDP payload size, bytes</td>
              <td align="left">None</td>
              <td align="left">&lt;=1222</td>
              <td align="left">Recommend max at largest value that avoids fragmentation; using a payload size that is too small might result in unexpected Sender
          limitations</td>
            </tr>
            <tr>
              <td align="left">cc, burst count</td>
              <td align="left">None</td>
              <td align="left">1 &lt;= cc &lt;= 100</td>
              <td align="left">Same as tested. Vary cc as needed to create the desired maximum
          sending rate. Sender buffer size may limit cc in the implementation</td>
            </tr>
            <tr>
              <td align="left">tt, burst interval</td>
              <td align="left">100 microsec</td>
              <td align="left">100 microsec, 1 msec</td>
              <td align="left">Available range of "tick" values (HZ param)</td>
            </tr>
            <tr>
              <td align="left">Low delay range threshold</td>
              <td align="left">30 msec</td>
              <td align="left">5 msec, 30 msec</td>
              <td align="left">Same as tested</td>
            </tr>
            <tr>
              <td align="left">High delay range threshold</td>
              <td align="left">90 msec</td>
              <td align="left">10 msec, 90 msec</td>
              <td align="left">Same as tested</td>
            </tr>
            <tr>
              <td align="left">Sequence error threshold</td>
              <td align="left">10</td>
              <td align="left">0, 1, 5, 10, 100</td>
              <td align="left">Same as tested</td>
            </tr>
            <tr>
              <td align="left">Consecutive errored status report threshold</td>
              <td align="left">3</td>
              <td align="left">2, 3, 4, 5</td>
              <td align="left">Use values &gt;1 to avoid misinterpreting transient loss</td>
            </tr>
            <tr>
              <td align="left">Fast mode increase, in table index steps</td>
              <td align="left">10</td>
              <td align="left">10</td>
              <td align="left">2 &lt;= steps &lt;= 30</td>
            </tr>
            <tr>
              <td align="left">Fast mode decrease, in table index steps</td>
              <td align="left">3 * Fast mode increase</td>
              <td align="left">3 * Fast mode increase</td>
              <td align="left">Same as tested</td>
            </tr>
          </tbody>
        </table>
        <t>As a consequence of default parameterization, the Number of table
        steps in total for rates less than 10 Gbps is 1090 (excluding index 0).</t>
        <t>A related Sender backoff response to network conditions occurs when
        one or more status feedback messages fail to arrive at the Sender.</t>
        <t>If no status feedback messages arrive at the Sender for the
        interval greater than the Lost Status Backoff timeout:</t>
        <artwork name="" type="ascii-art" align="left" alt=""><![CDATA[           UDRT + (2+w)*FT = Lost Status Backoff timeout

   where:

   UDRT = upper delay range threshold (default 90 msec)
   FT   = feedback time interval (default 50 msec)
   w    = number of repeated timeouts (w=0 initially, w++ on each 
          timeout, and reset to 0 when a message is received)
]]></artwork>
        <t>Beginning when the last message (of any type) was successfully
        received at the Sender:</t>
        <t>The offered load <bcp14>SHALL</bcp14> then be decreased, following the same
        process as when the feedback indicates the presence of one or more
        sequence number anomalies OR the delay range was above the upper
        threshold (as described above), with the same load rate adjustment
        algorithm variables in their current state. This means that lost status feedback messages OR sequence errors OR delay variation can result in rate reduction and congestion confirmation.</t>
        <t>The <bcp14>RECOMMENDED</bcp14> initial value for w is 0, taking a Round-Trip Time
        (RTT) of less than FT into account. A test with an RTT longer than FT is a
        valid reason to increase the initial value of w appropriately.
        Variable w <bcp14>SHALL</bcp14> be incremented by one whenever the Lost Status Backoff
        timeout is exceeded. So, with FT = 50 msec and UDRT = 90 msec, a status
        feedback message loss would be declared at 190 msec following a
        successful message, again at 50 msec after that (240 msec total), and so
        on.</t>
        <t>Also, if congestion is now confirmed for the first time by a Lost
        Status Backoff timeout, then the offered load rate is decreased by
        more than one rate setting (e.g., Rx-30). This one-time reduction is intended
        to compensate for the fast initial ramp-up. In all other cases, the
        offered load rate is only decreased by one (Rx-1).</t>
        <t><xref target="app-b-rfc8085-udp"/> discusses compliance with the applicable mandatory
        requirements of <xref target="RFC8085" format="default"/>, consistent with the goals of
        the IP-Layer Capacity Metric and Method, including the load rate
        adjustment algorithm described in this section.</t>
      </section>
      <section anchor="meas-qual-verif" numbered="true" toc="default">
        <name>Measurement Qualification or Verification</name>
        <t>It is of course necessary to calibrate the equipment performing the
        IP-Layer Capacity measurement, to ensure that the expected capacity
        can be measured accurately and that equipment choices (processing
        speed, interface bandwidth, etc.) are suitably matched to the
        measurement range.</t>
        <t>When assessing a maximum rate as the metric specifies, artificially
        high (optimistic) values might be measured until some buffer on the
        path is filled. Other causes include bursts of back-to-back packets
        with idle intervals delivered by a path, while the measurement
        interval (dt) is small and aligned with the bursts. The artificial
        values might result in an unsustainable Maximum Capacity observed
        when the Method of Measurement is searching for the maximum, and that
        would not do. This situation is different from the bimodal service
        rates (discussed in "<xref target="sec6-6-rpt-the-metric" format="title"/>", <xref target="sec6-6-rpt-the-metric" format="default"/>), which are characterized by a
        multi-second duration (much longer than the measured RTT) and
        repeatable behavior.</t>
        <t>There are many ways that the Method of Measurement could handle
        this false-max issue. The default value for measurement of Singletons
        (dt = 1 second) has proven to be of practical value during tests of
        this method, allows the bimodal service rates to be characterized, and
        has an obvious alignment with the reporting units (Mbps).</t>
        <t>Another approach comes from <xref target="RFC2544" sectionFormat="of" section="24"/>
        and its discussion of trial duration, where relatively short trials
        conducted as part of the search are followed by longer trials to make
        the final determination. In the production network, measurements of
        Singletons and Samples (the terms for trials and tests of Lab
        Benchmarking) must be limited in duration because they may affect
        service. But there is sufficient value in repeating a Sample
        with a fixed sending rate determined by the previous search for the
        Maximum IP-Layer Capacity, to qualify the result in terms of the other
        performance metrics measured at the same time.</t>
        <t>A Qualification measurement for the search result is a subsequent
        measurement, sending at a fixed 99.x percent of the Maximum IP-Layer
        Capacity for I, or an indefinite period. The same Maximum Capacity
        Metric is applied, and the Qualification for the result is a Sample
        without supra-threshold packet losses or a growing minimum delay trend in subsequent
        Singletons (or each dt of the measurement interval, I). Samples
        exhibiting supra-threshold packet losses or increasing queue occupation require a repeated
        search and/or test at a reduced fixed Sender rate for Qualification.</t>
        <t>Here, as with any Active Capacity test, the test duration must be
        kept short. Ten-second tests for each direction of transmission are
        common today. The default measurement interval specified here is I =
        10 seconds. The combination of a fast and congestion-aware search
        method and user-network coordination makes a unique contribution to
        production testing. The Maximum IP Capacity Metric and Method for
        assessing performance is very different from the classic Throughput Metric and Methods provided in <xref target="RFC2544" format="default"/>: it uses
        near-real-time load adjustments that are sensitive to loss and delay,
        similar to other congestion control algorithms used on the Internet
        every day, along with limited duration. On the other hand, Throughput measurements <xref target="RFC2544" format="default"/> can produce sustained
        overload conditions for extended periods of time. Individual trials in
        a test governed by a binary search can last 60 seconds for each step,
        and the final confirmation trial may be even longer. This is very
        different from "normal" traffic levels, but overload conditions are
        not a concern in the isolated test environment. The concerns raised in
        <xref target="RFC6815" format="default"/> were that the methods discussed in <xref target="RFC2544" format="default"/> would be let loose on production networks, and instead the authors
        challenged the standards community to develop Metrics and Methods like
        those described in this memo.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Measurement Considerations</name>
        <t>In general, the widespread measurements that this memo encourages
        will encounter widespread behaviors. The bimodal IP Capacity
        behaviors already discussed in <xref target="sec6-6-rpt-the-metric"/> are good examples.</t>
        <t>In general, it is <bcp14>RECOMMENDED</bcp14> to locate test endpoints as close to
        the intended measured link(s) as practical (for reasons of scale, this is not always possible; there is a limit on the number of test
        endpoints coming from many perspectives -- for example, management and measurement traffic). The testing operator <bcp14>MUST</bcp14> set a value for the
        MaxHops Parameter, based on the expected path length. This Parameter
        can keep measurement traffic from straying too far beyond the intended
        path.</t>
        <t>The measured path may be stateful based on many factors, and the
        Parameter "Time of day" when a test starts may not be enough
        information. Repeatable testing may require knowledge of the time from the
        beginning of a measured flow -- and how the flow is constructed,
        including how much traffic has already been sent on that flow when a
        state change is observed -- because the state change may be based on
        time, bytes sent, or both. Both load packets and status feedback
        messages <bcp14>MUST</bcp14> contain sequence numbers; this helps with measurements
        based on those packets.</t>
        <t>Many different types of traffic shapers and on-demand
        communications access technologies may be encountered, as anticipated
        in <xref target="RFC7312" format="default"/>, and play a key role in measurement
        results. Methods <bcp14>MUST</bcp14> be prepared to provide a short preamble
        transmission to activate on-demand communications access and to
        discard the preamble from subsequent test results.</t>
        <t>The following conditions might be encountered during measurement, where
        packet losses may occur independently of the measurement sending
        rate:</t>
        <ol spacing="normal" type="1"><li>Congestion of an interconnection or backbone interface may
            appear as packet losses distributed over time in the test stream,
            due to much-higher-rate interfaces in the backbone.</li>
          <li>Packet loss due to the use of Random Early Detection (RED) or other
            active queue management may or may not affect the measurement flow
            if competing background traffic (other flows) is simultaneously
            present.</li>
          <li>There may be only a small delay variation independent of the sending
            rate under these conditions as well.</li>
          <li>Persistent competing traffic on measurement paths that include
            shared transmission media may cause random packet losses in the
            test stream.</li>
        </ol>
        <t>It is possible to mitigate these conditions using the
        flexibility of the load rate adjustment algorithm described in
        <xref target="load-rate-adj"/> above (tuning specific Parameters).</t>
        <t>If the measurement flow burst duration happens to be on the order
        of or smaller than the burst size of a shaper or a policer in the
        path, then the line rate might be measured rather than the bandwidth
        limit imposed by the shaper or policer. If this condition is
        suspected, alternate configurations <bcp14>SHOULD</bcp14> be used.</t>
        <t>In general, results depend on the sending stream's characteristics;
        the measurement community has known this for a long time and needs to
        keep it foremost in mind. Although the default is a single flow (F=1) for
        testing, the use of multiple flows may be advantageous for the following
        reasons:</t>
        <ol spacing="normal" type="1"><li>The test hosts may be able to create a higher load than with a
            single flow, or parallel test hosts may be used to generate one flow
            each.</li>
          <li>Link aggregation may be present (flow-based load balancing), and multiple flows are needed to occupy each member of
            the aggregate.</li>
          <li>Internet access policies may limit the IP-Layer Capacity
            depending on the Type-P of the packets, possibly reserving capacity
            for various stream types.</li>
        </ol>
        <t>Each flow would be controlled using its own implementation of
        the load rate adjustment (search) algorithm.</t>
        <t>It is obviously counterproductive to run more than one independent
        and concurrent test (regardless of the number of flows in the test
        stream) attempting to measure the <strong>maximum</strong> capacity on a single path.
        The number of concurrent, independent tests of a path <bcp14>SHALL</bcp14> be limited
        to one.</t>
        <t>Tests of a v4-v6 transition mechanism might well be the intended
        subject of a capacity test. As long as both IPv4 packets and IPv6 packets
        sent/received are standard-formed, this should be allowed (and
        the change in header size easily accounted for on a per-packet
        basis).</t>
        <t>As testing continues, implementers should expect the methods to evolve. The ITU-T has published a supplement (Supplement 60) to the Y-series
        of ITU-T Recommendations, "Interpreting ITU-T Y.1540 maximum IP-layer
        capacity measurements" <xref target="Y.Sup60" format="default"/>, which is the result
        of continued testing with the metric. Those results have improved
        the methods described here.</t>
      </section>
    </section>
    <section anchor="rpt-formats" numbered="true" toc="default">
      <name>Reporting Formats</name>
      <t>The Singleton IP-Layer Capacity results <bcp14>SHOULD</bcp14> be accompanied by the
      context under which they were measured.</t>
      <ul spacing="normal">
        <li>Timestamp (especially the time when the maximum was observed in
          dtn).</li>
        <li>Source and Destination (by IP or other meaningful ID).</li>
        <li>Other inner Parameters of the test case (<xref target="gen-params-defs"/>).</li>
        <li>Outer Parameters, such as "test conducted in motion" or other
          factors belonging to the context of the measurement.</li>
        <li>Result validity (indicating cases where the process was somehow
          interrupted or the attempt failed).</li>
        <li>A field where unusual circumstances could be documented, and
          another one for "ignore / mask out" purposes in further processing.</li>
      </ul>
      <t>The Maximum IP-Layer Capacity results <bcp14>SHOULD</bcp14> be reported in tabular
  format. There <bcp14>SHOULD</bcp14> be a column that identifies the test Phase.
  There <bcp14>SHOULD</bcp14> be a column listing the number of flows used in that Phase.
  The remaining columns <bcp14>SHOULD</bcp14> report the following results for the aggregate 
  of all flows, including the Maximum IP-Layer Capacity, the Loss Ratio,
  the RTT minimum, RTT maximum, and other metrics tested having similar 
  relevance.</t>
      <t>As mentioned in <xref target="sec6-6-rpt-the-metric"/>, bimodal (or multi-modal) maxima <bcp14>SHALL</bcp14>
      be reported for each mode separately.</t>
      <table align="center">
        <name>Maximum IP-Layer Capacity Results</name>
        <thead>
          <tr>
            <th align="left">Phase</th>
            <th align="left">Number of Flows</th>
            <th align="left">Maximum IP-Layer Capacity (Mbps)</th>
            <th align="left">Loss Ratio</th>
            <th align="left">RTT min (msec)</th>
            <th align="left">RTT max (msec)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">Search</td>
            <td align="left">1</td>
            <td align="left">967.31</td>
            <td align="left">0.0002</td>
            <td align="left">30</td>
            <td align="left">58</td>
          </tr>
          <tr>
            <td align="left">Verify</td>
            <td align="left">1</td>
            <td align="left">966.00</td>
            <td align="left">0.0000</td>
            <td align="left">30</td>
            <td align="left">38</td>
          </tr>
        </tbody>
      </table>
      <t>Static and configuration Parameters:</t>
      <t>The sub-interval time, dt, <bcp14>MUST</bcp14> accompany a report of Maximum
      IP-Layer Capacity results, as well as the remaining Parameters from <xref target="gen-params-defs"/> ("General Parameters and Definitions").</t>
      <t>The PM list metrics corresponding to the sub-interval where the
      Maximum Capacity occurred <bcp14>MUST</bcp14> accompany a report of Maximum IP-Layer
      Capacity results, for each test Phase.</t>
      <t>The IP-Layer Sender Bit Rate results <bcp14>SHOULD</bcp14> be reported in tabular format. 
  There <bcp14>SHOULD</bcp14> be a column that identifies the test Phase. 
  There <bcp14>SHOULD</bcp14> be a column listing each individual (numbered) flow used
  in that Phase, or the aggregate of flows in that Phase. A corresponding column <bcp14>SHOULD</bcp14> identify the
  specific sending rate sub-interval, stn, for each flow and aggregate. A final column <bcp14>SHOULD</bcp14> report the 
  IP-Layer Sender Bit Rate results for each flow used, or the aggregate of all flows.</t>
      <table align="center">
        <name>IP-Layer Sender Bit Rate Results (Example with Two Flows and st = 0.05 (sec))</name>
        <thead>
          <tr>
            <th align="left">Phase</th>
            <th align="left">Flow Number or Aggregate</th>
            <th align="left">stn (sec)</th>
            <th align="left">Sender Bit Rate (Mbps)</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td align="left">Search</td>
            <td align="left">1</td>
            <td align="left">0.00</td>
            <td align="left">345</td>
          </tr>
          <tr>
            <td align="left">Search</td>
            <td align="left">2</td>
            <td align="left">0.00</td>
            <td align="left">289</td>
          </tr>
          <tr>
            <td align="left">Search</td>
            <td align="left">Agg</td>
            <td align="left">0.00</td>
            <td align="left">634</td>
          </tr>
          <tr>
            <td align="left">Search</td>
            <td align="left">1</td>
            <td align="left">0.05</td>
            <td align="left">499</td>
          </tr>
          <tr>
            <td align="left">Search</td>
            <td align="left">...</td>
            <td align="left">0.05</td>
            <td align="left">...</td>
          </tr>
        </tbody>
      </table>
      <t>Static and configuration Parameters:</t>
      <t>The sub-interval duration, st, <bcp14>MUST</bcp14> accompany a report of Sender IP-Layer
      Bit Rate results.</t>
      <t>Also, the values of the remaining Parameters from <xref target="gen-params-defs"/> ("General Parameters and Definitions") <bcp14>MUST</bcp14> be reported.</t>
      <section numbered="true" toc="default">
        <name>Configuration and Reporting Data Formats</name>
        <t>As a part of the multi-Standards Development Organization (SDO)
        harmonization of this Metric and Method of Measurement, one of the
        areas where the Broadband Forum (BBF) contributed its expertise was in
        the definition of an information model and data model for
        configuration and reporting. These models are consistent with the
        metric Parameters and default values specified as lists in this memo.
        <xref target="TR-471" format="default"/> provides the information model that was used
        to prepare a full data model in related BBF work. The BBF has also
        carefully considered topics within its purview, such as the placement of
        measurement systems within the Internet access architecture. For
        example, timestamp resolution requirements that influence the choice
        of the test protocol are provided in Table 2 of <xref target="TR-471" format="default"/>.</t>
      </section>
    </section>
    <section anchor="sec-cons" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>Active Metrics and Active Measurements have a long history of security
      considerations. The security considerations that apply to any Active
      Measurement of live paths are relevant here. See <xref target="RFC4656" format="default"/> and <xref target="RFC5357" format="default"/>.</t>
      <t>When considering the privacy of those involved in measurement or those
      whose traffic is measured, the sensitive information available to
      potential observers is greatly reduced when using active techniques
      that are within this scope of work. Passive observations of user
      traffic for measurement purposes raise many privacy issues. We refer the
      reader to the privacy considerations described in the Large-scale
      Measurement of Broadband Performance (LMAP) Framework <xref target="RFC7594" format="default"/>, which covers active and passive techniques.</t>
      <t>There are some new considerations for Capacity measurement as
      described in this memo.</t>
      <ol spacing="normal" type="1"><li>Cooperating Source and Destination hosts and agreements to test
          the path between the hosts are <bcp14>REQUIRED</bcp14>. Hosts perform in either the
          Src role or the Dst role.</li>
        <li>It is <bcp14>REQUIRED</bcp14> to have a user client-initiated setup handshake
          between cooperating hosts that allows firewalls to control inbound
          unsolicited UDP traffic that goes to either a control port
          (expected and with authentication) or ephemeral ports that are only
          created as needed. Firewalls protecting each host can both continue
          to do their job normally.</li>
        <li>Client-server authentication and integrity protection for
          feedback messages conveying measurements are <bcp14>RECOMMENDED</bcp14>.</li>
        <li>Hosts <bcp14>MUST</bcp14> limit the number of simultaneous tests to avoid
          resource exhaustion and inaccurate results.</li>
        <li>Senders <bcp14>MUST</bcp14> be rate limited. This can be accomplished using a
          pre-built table defining all the offered load rates that will be
          supported (<xref target="load-rate-adj"/>). The recommended load control search
          algorithm results in "ramp-up" from the lowest rate in the
          table.</li>
        <li>Service subscribers with limited data volumes who conduct
          extensive capacity testing might experience the effects of Service
          Provider controls on their service. Testing with the Service
          Provider's measurement hosts <bcp14>SHOULD</bcp14> be limited in frequency and/or
          overall volume of test traffic (for example, the range of duration
          values, I, <bcp14>SHOULD</bcp14> be limited).</li>
      </ol>
      <t>The exact specification of these features is left for future
      protocol development.</t>
    </section>
    <section anchor="IANA" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>This document has no IANA actions.</t>
    </section>
  </middle>
  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2330.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7680.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8468.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6438.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4737.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4656.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2681.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5357.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7497.xml"/>
      </references>
      <references>
        <name>Informative References</name>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2544.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3148.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5136.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6815.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7312.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7594.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7799.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8085.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8337.xml"/>

        <reference anchor="copycat" target="https://irtf.org/anrw/2017/anrw17-final5.pdf">
          <front>
            <title>copycat: Testing Differential Treatment of New Transport
          Protocols in the Wild</title>
            <author fullname="Korian Edeline" initials="K." surname="Edeline">
              <organization/>
            </author>
            <author fullname="Mirja KÃ¼hlewind" initials="M." surname="KÃ¼hlewind">
              <organization/>
            </author>
            <author fullname="Brian Trammell" initials="B." surname="Trammell">
              <organization/>
            </author>
            <author fullname="Benoit Donnet" initials="B." surname="Donnet">
              <organization/>
            </author>
            <date month="July" year="2017"/>
          </front>
          <refcontent>ANRW '17</refcontent>
         <seriesInfo name="DOI" value="10.1145/3106328.3106330"/>
        </reference>

        <reference anchor="Y.Sup60" target="https://www.itu.int/rec/T-REC-Y.Sup60/en">
          <front>
            <title>Interpreting ITU-T Y.1540 maximum IP-layer capacity measurements</title>
            <author>
              <organization>ITU-T</organization>
            </author>
            <date month="October" year="2021"/>
          </front>
         <refcontent>ITU-T Recommendation Y.Sup60</refcontent>
        </reference>
        <reference anchor="TR-471" target="https://www.broadband-forum.org/technical/download/TR-471.pdf">
          <front>
            <title>Maximum IP-Layer Capacity Metric, Related Metrics, and Measurements</title>
            <author fullname="Al Morton" initials="A." surname="Morton">
              <organization>AT&amp;T Labs</organization>
            </author>
            <date month="July" year="2020"/>
          </front>
        <refcontent>Broadband Forum TR-471</refcontent>

        </reference>

        <reference anchor="Y.1540" target="https://www.itu.int/rec/T-REC-Y.1540-201912-I/en">
          <front>
            <title>Internet protocol data communication service - IP packet
          transfer and availability performance parameters</title>
            <author><organization>ITU-T</organization></author>
            <date month="December" year="2019"/>
          </front>
         <refcontent>ITU-T Recommendation Y.1540</refcontent>
        </reference>

        <reference anchor="LS-SG12-B" target="https://datatracker.ietf.org/liaison/1645/">
          <front>
            <title>Liaison statement: LS on harmonization of IP Capacity and Latency Parameters: Consent of Draft Rec. Y.1540 on IP packet transfer performance parameters and New Annex A with Lab &amp; Field Evaluation Plans</title>
            <author/>
            <date month="May" year="2019"/>
          </front>
          <refcontent>From ITU-T-SG-12</refcontent>
        </reference>

        <reference anchor="LS-SG12-A" target="https://datatracker.ietf.org/liaison/1632/">
          <front>
            <title>Liaison statement: LS - Harmonization of IP Capacity and Latency Parameters: Revision of Draft Rec. Y.1540 on IP packet transfer performance parameters and New Annex A with Lab Evaluation Plan</title>
            <author/>
            <date month="March" year="2019"/>
          </front>
         <refcontent>From ITU-T SG 12</refcontent>
        </reference>
      </references>
    </references>

    <section anchor="app-a-load-rate-adj-pseudocode" numbered="true" toc="default">
      <name>Load Rate Adjustment Pseudocode</name>
      <t>This appendix provides a pseudocode implementation of the algorithm
      described in <xref target="load-rate-adj"/>.</t>

<sourcecode name="pseudocode-for-algorithm" type="pseudocode"><![CDATA[
Rx = 0              # The current sending rate (equivalent to a row 
                    # of the table)

seqErr = 0          # Measured count that includes Loss or Reordering
                    # or Duplication impairments (all appear
                    # initially as errors in the packet sequence
                    # numbering)

seqErrThresh = 10   # Threshold on seqErr count that includes Loss or
                    # Reordering or Duplication impairments (all
                    # appear initially as errors in the packet
                    # sequence numbering)

delay = 0           # Measured Range of Round Trip Delay (RTD), msec

lowThresh = 30      # Low threshold on the Range of RTD, msec

upperThresh = 90    # Upper threshold on the Range of RTD, msec

hSpeedThresh = 1    # Threshold for transition between sending rate 
                    # step sizes (such as 1 Mbps and 100 Mbps), Gbps

slowAdjCount = 0    # Measured Number of consecutive status reports
                    # indicating loss and/or delay variation above 
                    # upperThresh

slowAdjThresh = 3   # Threshold on slowAdjCount used to infer 
                    # congestion. Use values > 1 to avoid 
                    # misinterpreting transient loss.

highSpeedDelta = 10 # The number of rows to move in a single 
                    # adjustment when initially increasing offered 
                    # load (to ramp up quickly) 

maxLoadRates = 2000 # Maximum table index (rows)

if ( seqErr <= seqErrThresh && delay < lowThresh ) {
        if ( Rx < hSpeedThresh && slowAdjCount < slowAdjThresh ) {
                        Rx += highSpeedDelta;
                        slowAdjCount = 0;
        } else {
                        if ( Rx < maxLoadRates - 1 )
                                        Rx++;
        }
} else if ( seqErr > seqErrThresh || delay > upperThresh ) {
        slowAdjCount++;
        if ( Rx < hSpeedThresh && slowAdjCount == slowAdjThresh ) {
                        if ( Rx > highSpeedDelta * 3 )
                                        Rx -= highSpeedDelta * 3;
                        else
                                        Rx = 0;
        } else {
                        if ( Rx > 0 )
                                        Rx--;
        }
}
]]></sourcecode>

    </section>
    <section anchor="app-b-rfc8085-udp" numbered="true" toc="default">
      <name>RFC 8085 UDP Guidelines Check</name>
      <t><xref target="RFC8085" sectionFormat="of" section="3.1"/>
(BCP 145), which provides UDP usage guidelines, focuses
      primarily on congestion control. The guidelines appear in
      mandatory (<bcp14>MUST</bcp14>) and recommendation (<bcp14>SHOULD</bcp14>) categories.</t>
      <section numbered="true" toc="default">
        <name>Assessment of Mandatory Requirements</name>
        <t>The mandatory requirements in <xref target="RFC8085" sectionFormat="of" section="3"/>
        include the following:</t>
          <blockquote>Internet paths can have widely varying characteristics, ...
            Consequently, applications that may be used on the Internet <bcp14>MUST
            NOT</bcp14> make assumptions about specific path characteristics. They
            <bcp14>MUST</bcp14> instead use mechanisms that let them operate safely under
            very different path conditions. Typically, this requires
            conservatively probing the current conditions of the Internet path
            they communicate over to establish a transmission behavior that it
            can sustain and that is reasonably fair to other traffic sharing
            the path.</blockquote>
        <t>The purpose of the load rate adjustment algorithm described in <xref target="load-rate-adj"/> is
        to probe the network and enable Maximum IP-Layer Capacity measurements
        with as few assumptions about the measured path as possible and
        within the range of applications described in <xref target="sec-2-scope"/>.
        There is tension between the goals of probing conservatism and
        minimization of both the traffic dedicated to testing (especially with
        Gigabit rate measurements) and the duration of the test (which is one contributing
        factor to the overall algorithm fairness).</t>
        <t>The text of <xref target="RFC8085" sectionFormat="of" section="3"/>
 goes on to
        recommend alternatives to UDP to meet the mandatory requirements, but
        none are suitable for the scope and purpose of the Metrics and Methods
        in this memo.  In fact, ad hoc TCP-based methods fail to achieve the
        measurement accuracy repeatedly proven in comparison measurements with
        the running code <xref target="LS-SG12-A" format="default"/> <xref target="LS-SG12-B" format="default"/>
          <xref target="Y.Sup60" format="default"/>. Also, the UDP aspect of these methods is
        present primarily to support modern Internet transmission where a
        transport protocol is required <xref target="copycat" format="default"/>; the metric is
        based on the IP Layer, and UDP allows simple correlation to the
        IP Layer.</t>
        <t><xref target="RFC8085" sectionFormat="of" section="3.1.1"/> discusses protocol timer
        guidelines:</t>
          <blockquote>Latency samples <bcp14>MUST NOT</bcp14> be derived from ambiguous
            transactions. The canonical example is in a protocol that
            retransmits data, but subsequently cannot determine which copy is
            being acknowledged.</blockquote>
        <t>Both load packets and status feedback messages <bcp14>MUST</bcp14> contain
        sequence numbers; this helps with measurements based on those
        packets, and there are no retransmissions needed.</t>
          <blockquote>When a latency estimate is used to arm a timer that provides
            loss detection -- with or without retransmission -- expiry of the
            timer <bcp14>MUST</bcp14> be interpreted as an indication of congestion in the
            network, causing the sending rate to be adapted to a safe
            conservative rate ...</blockquote>
        <t>The methods described in this memo use timers for sending rate
        backoff when status feedback messages are lost (Lost Status Backoff
        timeout) and for stopping a test when connectivity is lost for a
        longer interval (feedback message or load packet timeouts).</t>
        <t>This memo does not foresee any specific benefit of using Explicit Congestion
        Notification (ECN).</t>
        <t><xref target="RFC8085" sectionFormat="of" section="3.2"/> discusses message size
        guidelines:</t>
          <blockquote>To determine an appropriate UDP payload size, applications <bcp14>MUST</bcp14>
            subtract the size of the IP header (which includes any IPv4
            optional headers or IPv6 extension headers) as well as the length
            of the UDP header (8 bytes) from the PMTU size.</blockquote>

        <t>The method uses a sending rate table with a maximum UDP payload
        size that anticipates significant header overhead and avoids
        fragmentation.</t>
        <t><xref target="RFC8085" sectionFormat="of" section="3.3"/> provides reliability
        guidelines:</t>
          <blockquote>Applications that do require reliable message delivery <bcp14>MUST</bcp14>
            implement an appropriate mechanism themselves.</blockquote>
        <t>The IP-Layer Capacity Metrics and Methods do not require reliable
        delivery.</t>
          <blockquote>Applications that require ordered delivery <bcp14>MUST</bcp14> reestablish
            datagram ordering themselves.</blockquote>
        <t>The IP-Layer Capacity Metrics and Methods do not need to
        reestablish packet order; it is preferable to measure packet reordering
        if it occurs <xref target="RFC4737" format="default"/>.</t>
      </section>
      <section numbered="true" toc="default">
        <name>Assessment of Recommendations</name>
        <t>The load rate adjustment algorithm's goal is to determine the
        Maximum IP-Layer Capacity in the context of an infrequent, diagnostic,
        short-term measurement. This goal is a global exception to many <bcp14>SHOULD</bcp14>-level requirements as listed in <xref target="RFC8085" format="default"/>, of which many are
        intended for long-lived flows that must coexist with other traffic in a
        more or less fair way. However, the algorithm (as specified in
        <xref target="load-rate-adj"/> and <xref target="app-a-load-rate-adj-pseudocode"/> above) reacts to indications of congestion in
        clearly defined ways.</t>
        <t>A specific recommendation is provided as an example. <xref target="RFC8085" sectionFormat="of" section="3.1.5"/> (regarding the implications of RTT and loss measurements on congestion control) says:</t>
          <blockquote>A congestion control [algorithm] designed for UDP <bcp14>SHOULD</bcp14> respond as quickly
            as possible when it experiences congestion, and it <bcp14>SHOULD</bcp14> take
            into account both the loss rate and the response time when
            choosing a new rate.</blockquote>
        <t>The load rate adjustment algorithm responds to loss and RTT
        measurements with a clear and concise rate reduction when warranted,
        and the response makes use of direct measurements (more exact than can
        be inferred from TCP ACKs).</t>
        <t><xref target="RFC8085" sectionFormat="of" section="3.1.5"/> goes on to specify the following:</t>
          <blockquote>The implemented congestion control scheme <bcp14>SHOULD</bcp14> result in
            bandwidth (capacity) use that is comparable to that of TCP within
            an order of magnitude, so that it does not starve other flows
            sharing a common bottleneck.</blockquote>
        <t>This is a requirement for coexistent streams, and not for
        diagnostic and infrequent measurements using short durations. The rate
        oscillations during short tests allow other packets to pass and
        don't starve other flows.</t>
        <t>Ironically, ad hoc TCP-based measurements of "Internet Speed" are
        also designed to work around this <bcp14>SHOULD</bcp14>-level requirement, by
        launching many flows (9, for example) to increase the outstanding data
        dedicated to testing.</t>
        <t>The load rate adjustment algorithm cannot become a TCP-like
        congestion control, or it will have the same weaknesses of TCP when
        trying to make a Maximum IP-Layer Capacity measurement and will not
        achieve the goal. The results of the referenced testing <xref target="LS-SG12-A" format="default"/> <xref target="LS-SG12-B" format="default"/> <xref target="Y.Sup60" format="default"/> supported this statement hundreds of times, with
        comparisons to multi-connection TCP-based measurements.</t>
        <t>A brief review of requirements from <xref target="RFC8085"/> follows (marked "Yes" when this memo is compliant, or "NA" (Not Applicable)):</t>

<table anchor="recs-rfc8085">
  <name>Summary of Key Guidelines from RFC 8085</name>
  <thead>
    <tr>
      <th>Yes?</th>
      <th>Recommendation in RFC 8085</th>
      <th>Section</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Yes</td>
      <td><bcp14>MUST</bcp14> tolerate a wide range of Internet path conditions</td>
      <td><xref target="RFC8085" section="3" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> use a full-featured transport (e.g., TCP)</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> control rate of transmission</td>
      <td><xref target="RFC8085" section="3.1" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> perform congestion control over all traffic</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <th></th>
      <th>For bulk transfers,</th>
      <th><xref target="RFC8085" section="3.1.2" sectionFormat="bare"/></th>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> consider implementing TFRC</td>
      <td></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>else, <bcp14>SHOULD</bcp14> in other ways use bandwidth similar to TCP</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <th></th>
      <th>For non-bulk transfers,</th>
      <th><xref target="RFC8085" section="3.1.3" sectionFormat="bare"/></th>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> measure RTT and transmit max. 1 datagram/RTT</td>
      <td><xref target="RFC8085" section="3.1.1" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>else, <bcp14>SHOULD</bcp14> send at most 1 datagram every 3 seconds</td>
      <td></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> back-off retransmission timers following loss</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> provide mechanisms to regulate the bursts of transmission</td>
      <td><xref target="RFC8085" section="3.1.6" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>MAY</bcp14> implement ECN; a specific set of application mechanisms are <bcp14>REQUIRED</bcp14> if ECN is used</td>
      <td><xref target="RFC8085" section="3.1.7" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td>For DiffServ, <bcp14>SHOULD NOT</bcp14> rely on implementation of PHBs</td>
      <td><xref target="RFC8085" section="3.1.8" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td>For QoS-enabled paths, <bcp14>MAY</bcp14> choose not to use CC</td>
      <td><xref target="RFC8085" section="3.1.9" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD NOT</bcp14> rely solely on QoS for their capacity</td>
      <td><xref target="RFC8085" section="3.1.10" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>non-CC controlled flows <bcp14>SHOULD</bcp14> implement a transport circuit breaker</td>
      <td></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>MAY</bcp14> implement a circuit breaker for other applications</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <th></th>
      <th>For tunnels carrying IP traffic,</th>
      <th><xref target="RFC8085" section="3.1.11" sectionFormat="bare"/></th>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD NOT</bcp14> perform congestion control</td>
      <td></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>MUST</bcp14> correctly process the IP ECN field</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <th></th>
      <th>For non-IP tunnels or rate not determined by traffic,</th>
      <th><xref target="RFC8085" section="3.1.11" sectionFormat="bare"/></th>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> perform CC or use circuit breaker</td>
      <td></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> restrict types of traffic transported by the tunnel</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD NOT</bcp14> send datagrams that exceed the PMTU, i.e.,</td>
      <td><xref target="RFC8085" section="3.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> discover PMTU or send datagrams &lt; minimum PMTU</td>
      <td></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>Specific application mechanisms are <bcp14>REQUIRED</bcp14> if PLPMTUD is used</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> handle datagram loss, duplication, reordering</td>
      <td><xref target="RFC8085" section="3.3" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> be robust to delivery delays up to 2 minutes</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> enable IPv4 UDP checksum</td>
      <td><xref target="RFC8085" section="3.4" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> enable IPv6 UDP checksum; specific application mechanisms are <bcp14>REQUIRED</bcp14> if a zero IPv6 UDP checksum is used</td>
      <td><xref target="RFC8085" section="3.4.1" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> provide protection from off-path attacks</td>
      <td><xref target="RFC8085" section="5.1" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td></td>
      <td>else, <bcp14>MAY</bcp14> use UDP-Lite with suitable checksum coverage</td>
      <td><xref target="RFC8085" section="3.4.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD NOT</bcp14> always send middlebox keep-alive messages</td>
      <td><xref target="RFC8085" section="3.5" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>MAY</bcp14> use keep-alives when needed (min. interval 15 sec)</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td>Applications specified for use in limited use (or controlled environments) <bcp14>SHOULD</bcp14> identify equivalent mechanisms and describe their use case</td>
      <td><xref target="RFC8085" section="3.6" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>Bulk-multicast apps <bcp14>SHOULD</bcp14> implement congestion control</td>
      <td><xref target="RFC8085" section="4.1.1" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>Low volume multicast apps <bcp14>SHOULD</bcp14> implement congestion control</td>
      <td><xref target="RFC8085" section="4.1.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td>Multicast apps <bcp14>SHOULD</bcp14> use a safe PMTU</td>
      <td><xref target="RFC8085" section="4.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> avoid using multiple ports</td>
      <td><xref target="RFC8085" section="5.1.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>MUST</bcp14> check received IP source address</td>
      <td></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> validate payload in ICMP messages</td>
      <td><xref target="RFC8085" section="5.2" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td colspan="3"></td>
    </tr>
    <tr>
      <td>Yes</td>
      <td><bcp14>SHOULD</bcp14> use a randomized Source port or equivalent technique, and, for client/server applications, <bcp14>SHOULD</bcp14> send responses from source address matching request</td>
      <td><xref target="RFC8085" section="6" sectionFormat="bare"/></td>
    </tr>
    <tr>
      <td>NA</td>
      <td><bcp14>SHOULD</bcp14> use standard IETF security protocols when needed</td>
      <td><xref target="RFC8085" section="6" sectionFormat="bare"/></td>
    </tr>
  </tbody>
</table>
      </section>
    </section>

    <section numbered="false" toc="default">
      <name>Acknowledgments</name>
      <t>Thanks to <contact fullname="Joachim Fabini"/>, <contact fullname="Matt Mathis"/>, <contact fullname="J. Ignacio Alvarez-Hamelin"/>,
      <contact fullname="Wolfgang Balzer"/>, <contact fullname="Frank Brockners"/>, <contact fullname="Greg Mirsky"/>, <contact fullname="Martin Duke"/>, <contact fullname="Murray Kucherawy"/>, and <contact fullname="Benjamin Kaduk"/> for their extensive comments on this memo
      and related topics. In a second round of reviews, we acknowledge <contact fullname="Magnus Westerlund"/>, <contact fullname="Lars Eggert"/>, and <contact fullname="Zaheduzzaman Sarker"/>.</t>
    </section>
  </back>
</rfc>
