<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE rfc [
 <!ENTITY nbsp    "&#160;">
 <!ENTITY zwsp   "&#8203;">
 <!ENTITY nbhy   "&#8209;">
 <!ENTITY wj     "&#8288;">
]>

<rfc xmlns:xi="http://www.w3.org/2001/XInclude" docName="draft-ietf-dtn-bpbis-31" number="9171"
submissionType="IETF" category="std" consensus="true" ipr="trust200902" obsoletes="" updates="" xml:lang="en" symRefs="true" sortRefs="true" tocInclude="true" tocDepth="5" version="3">

  <!-- xml2rfc v2v3 conversion 3.7.0 -->
  <!-- Generated by id2xml 1.5.0 on 2021-04-05T23:37:33Z -->
        <front>
    <title>Bundle Protocol Version 7</title>
    <seriesInfo name="RFC" value="9171"/>
    <author initials="S." surname="Burleigh" fullname="Scott Burleigh">
      <organization>IPNGROUP</organization>
      <address>
        <postal>
          <street>1435 Woodhurst Blvd.</street>
          <city>McLean</city>
          <region>VA</region>
          <code>22102</code>
          <country>United States of America</country>
        </postal>
        <email>sburleig.sb@gmail.com</email>
      </address>
    </author>
    <author initials="K." surname="Fall" fullname="Kevin Fall">
      <organization>Roland Computing Services</organization>
      <address>
        <postal>
          <street>3871 Piedmont Ave. Suite 8</street>
          <city>Oakland</city>
          <region>CA</region>
          <code>94611</code>
          <country>United States of America</country>
        </postal>
        <email>kfall+rcs@kfall.com</email>
      </address>
    </author>
    <author initials="E." surname="Birrane, III" fullname="Edward J. Birrane, III">
      <organization abbrev="APL, Johns Hopkins University">Johns Hopkins University Applied Physics Laboratory</organization>
      <address>
        <postal>
          <street>11100 Johns Hopkins Rd</street>
          <city>Laurel</city>
          <region>MD</region>
          <code>20723</code>
          <country>United States of America</country>
        </postal>
        <phone>+1 443 778 7423</phone>
        <email>Edward.Birrane@jhuapl.edu
        </email>
      </address>
    </author>
    <date year="2022" month="January"/>
    <workgroup>Networking Working Group</workgroup>

<keyword>Delay-tolerant networking</keyword>
<keyword>disruption-tolerant networking</keyword>

    <abstract>
      <t>
   This document presents a specification for the Bundle
   Protocol, adapted from the experimental Bundle Protocol
   specification developed by the Delay-Tolerant Networking Research
   Group of the Internet Research Task Force and documented in RFC
   5050.

</t>
    </abstract>
  </front>
  <middle>
    <section anchor="sect-1" numbered="true" toc="default">
      <name>Introduction</name>
      <t>
   Since the publication of the Bundle Protocol specification
   (Experimental RFC 5050 <xref target="RFC5050" format="default"/>) in 2007, the Delay-Tolerant
   Networking (DTN) Bundle Protocol (BP) has been implemented in multiple
   programming languages and deployed to a wide variety of computing
   platforms.  This implementation and deployment experience has
   identified opportunities for making the protocol simpler, more
   capable, and easier to use.  The present document, standardizing the
   Bundle Protocol, is adapted from RFC 5050 in that context,
   reflecting lessons learned.  Significant changes from the Bundle
   Protocol specification defined in RFC 5050 are listed in <xref target="app-a"/>.</t>
      <t>
   This document describes BP version 7 (BPv7).</t>
      <t>
   Delay-Tolerant Networking is a network architecture providing
   communications in and/or through highly stressed environments.
   Stressed networking environments include those with intermittent
   connectivity, large and/or variable delays, and high bit error
   rates.  To provide its services, BP may be viewed as sitting at the
   application layer of some number of constituent networks, forming a
   store-carry-forward overlay network.  Key capabilities of BP
   include:

      </t>
      <ul spacing="normal">
        <li>Ability to use physical motility for the movement of data.</li>
        <li>Ability to move the responsibility for error control from one
            node to another.</li>
        <li>Ability to cope with intermittent connectivity, including cases
           where the sender and receiver are not concurrently present in
           the network.</li>
        <li>Ability to take advantage of scheduled, predicted, and
           opportunistic connectivity, whether bidirectional or
           unidirectional, in addition to continuous connectivity.</li>
        <li>Late binding of overlay-network endpoint identifiers to
           underlying constituent network addresses.</li>
      </ul>
      <t>
   For descriptions of these capabilities and the rationale for the DTN
   architecture, see <xref target="RFC4838"/> and <xref target="SIGC"/>.</t>
      <t>
   BP's location within the standard protocol stack is as shown in <xref target="fig-1"/>.
   BP uses underlying "integrated" transport and/or network protocols for
   communications within a given constituent network.  The layer at which
   those underlying protocols are located is here termed the "convergence
   layer", and the interface between the Bundle Protocol and a specific
   underlying protocol is termed a "convergence-layer adapter".</t>
      <t>
   <xref target="fig-1"/> shows three distinct transport and network protocols
   (denoted T1/N1, T2/N2, and T3/N3).</t>
      <figure anchor="fig-1">
        <name>The Bundle Protocol in the Protocol Stack Model</name>
        <artwork name="" type="ascii-art" align="left" alt=""><![CDATA[
+-----------+                                         +-----------+
|   BP app  |                                         |   BP app  |
+---------v-|   +->>>>>>>>>>v-+     +->>>>>>>>>>v-+   +-^---------+
|   BP    v |   | ^    BP   v |     | ^   BP    v |   | ^   BP    |
+---------v-+   +-^---------v-+     +-^---------v-+   +-^---------+
| T1      v |   + ^  T1/T2  v |     + ^  T2/T3  v |   | ^ T3      |
+---------v-+   +-^---------v-+     +-^---------v +   +-^---------+
| N1      v |   | ^  N1/N2  v |     | ^  N2/N3  v |   | ^ N3      |
+---------v-+   +-^---------v +     +-^---------v-+   +-^---------+
|         >>>>>>>>^         >>>>>>>>>>^         >>>>>>>>^         |
+-----------+   +-------------+     +-------------+   +-----------+
|                     |                     |                     |
|<---- A network ---->|                     |<---- A network ---->|
|                     |                     |                     |
]]></artwork>
      </figure>
      <t>
   This document describes the format of the protocol data units (PDUs)
   (called "bundles") passed between entities participating in BP
   communications.</t>
      <t>
   The entities are referred to as "bundle nodes". This document does
   not address:

      </t>
      <ul spacing="normal">
        <li>Operations in the convergence-layer adapters that bundle nodes use
        to transport data through specific types of internets.  (However, the
        document does discuss the services that must be provided by each
        adapter at the convergence layer.)</li>
        <li>The bundle route computation algorithm.</li>
        <li>Mechanisms for populating the routing or forwarding information
           bases of bundle nodes.</li>
        <li>The mechanisms for securing bundles en route.</li>
        <li> The mechanisms for managing bundle nodes.</li>
      </ul>
      <t>
   Note that implementations of the specification presented in this
   document will not be interoperable with implementations of RFC 5050.</t>
    </section>
    <section anchor="sect-2" numbered="true" toc="default">
      <name>Conventions Used in This Document</name>
       <t>The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
       "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>",
       "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>",
       "<bcp14>SHOULD NOT</bcp14>",
       "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
       "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document
       are to be interpreted as described in BCP&nbsp;14
       <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only
       when, they appear in all capitals, as shown here.</t>
    </section>
    <section anchor="sect-3" numbered="true" toc="default">
      <name>Service Description</name>
      <section anchor="sect-3.1" numbered="true" toc="default">
        <name>Definitions</name>
       
          <dl>
  <dt>Bundle:</dt>
   <dd>A bundle is a PDU of BP, so named because
   negotiation of the parameters of a data exchange may be impractical
   in a delay-tolerant network: it is often better practice to "bundle"
   with a unit of application data all metadata that might be needed in
   order to make the data immediately usable when delivered to the
   application. Each bundle comprises a sequence of two or more
   "blocks" of protocol data, which serve various purposes.</dd>
        
   <dt>Block:</dt>
   <dd>A Bundle Protocol block is one of the protocol data
   structures that together constitute a well-formed bundle.</dd>

   <dt>Application Data Unit:</dt>
   <dd>An application data unit (ADU) is the unit
   of data whose conveyance to the bundle's destination is the purpose
   for the transmission of some bundle that is not a fragment (as
   defined below).</dd>
        
   <dt>Bundle payload:</dt>
   <dd>A bundle payload (or simply "payload") is the
   content of the bundle's payload block. The terms "bundle content",
   "bundle payload", and "payload" are used interchangeably in this
   document.  For a bundle that is not a fragment (as defined below),
   the payload is an ADU.</dd>
        
   <dt>Partial payload:</dt>
   <dd>A partial payload is a payload that comprises
   either the first N bytes or the last N bytes of some other payload
   of length M, such that 0 &lt; N &lt; M.  Note that every partial payload is a payload and therefore can be further subdivided into partial payloads.</dd>
        
   <dt>Fragment:</dt>
   <dd>A fragment, a.k.a. "fragmentary bundle", is a bundle
   whose payload block contains a partial payload.</dd>
        
   <dt>Bundle node:</dt>
   <dd>A bundle node (or, in the context of this document,
   simply a "node") is any entity that can send and/or receive bundles.
   Each bundle node has three conceptual components, defined below, as
   shown in <xref target="fig-2"/>: a "Bundle Protocol Agent", a set of zero or more
   "convergence-layer adapters", and an "application agent".
 ("CL1 PDUs" are the PDUs of the convergence-layer protocol used in network 1.)</dd>
 </dl>
 
        <figure anchor="fig-2">
          <name>Components of a Bundle Node</name>
          <artwork name="" type="ascii-art" align="left" alt=""><![CDATA[
+-----------------------------------------------------------+
|Node                                                       |
|                                                           |
| +-------------------------------------------------------+ |
| |Application Agent                                      | |
| |                                                       | |
| | +--------------------------+ +----------------------+ | |
| | |Administrative element    | |Application-specific  | | |
| | |                          | |element               | | |
| | |                          | |                      | | |
| | +--------------------------+ +----------------------+ | |
| |                ^                          ^           | |
| |           Admin|records        Application|data       | |
| |                |                          |           | |
| +----------------v--------------------------v-----------+ |
|                               ^                           |
|                               | ADUs                      |
|                               |                           |
| +-----------------------------v-------------------------+ |
| |Bundle Protocol Agent                                  | |
| |                                                       | |
| |                                                       | |
| +-------------------------------------------------------+ |
|        ^                 ^                        ^       |
|        | Bundles         | Bundles        Bundles |       |
|        |                 |                        |       |
| +------v-----+     +-----v------+           +-----v-----+ |
| |CLA 1       |     |CLA 2       |           |CLA n      | |
| |            |     |            |   . . .   |           | |
| |            |     |            |           |           | |
+-+------------+-----+------------+-----------+-----------+-+
         ^                 ^                        ^
      CL1|PDUs          CL2|PDUs                 CLn|PDUs
         |                 |                        |
  +------v-----+     +-----v------+           +-----v-----+
   Network 1          Network 2                Network n
]]></artwork>
        </figure>
        <dl>
        <dt>Bundle Protocol Agent:</dt>
   <dd>The Bundle Protocol Agent (BPA) of a node is
   the node component that offers the BP services and executes the
   procedures of the Bundle Protocol.</dd>
        <dt>Convergence-layer adapter:</dt>
   <dd>A convergence-layer adapter (CLA) is a
   node component that sends and receives bundles on behalf of the BPA,
   utilizing the services of some "integrated" protocol stack that is
   supported in one of the networks within which the node is
   functionally located.</dd>
        <dt>Application agent:</dt>
   <dd>The application agent (AA) of a node is the node
   component that utilizes the BP services to effect communication for
   some user purpose. The application agent in turn has two elements:
   an administrative element and an application-specific element.</dd>
        <dt>Application-specific element:</dt>
   <dd>The application-specific element of
   an AA is the node component that constructs, requests transmission
   of, accepts delivery of, and processes units of user application
   data.</dd>
        <dt>Administrative element:</dt>
   <dd>The administrative element of an AA is the
   node component that constructs and requests transmission of
   administrative records (defined below), including status reports,
   and accepts delivery of and processes any administrative records
   that the node receives.</dd>
        <dt>Administrative record:</dt>
   <dd>A BP administrative record is an ADU that is exchanged between the administrative elements of
   nodes' application agents for some BP administrative purpose.  The
   only administrative record defined in this specification is the
   status report, discussed later.</dd>
   <dt>Bundle endpoint:</dt>
   <dd>A bundle endpoint (or simply "endpoint") is a set
   of zero or more bundle nodes that all identify themselves for BP
   purposes by some common identifier, called a "bundle endpoint ID"
   (or, in this document, simply "endpoint ID"); endpoint IDs are
   described in detail in <xref target="sect-4.2.5.1"/>.</dd>
        <dt>Singleton endpoint:</dt>
   <dd>A singleton endpoint is an endpoint that always
   contains exactly one member.</dd>
        <dt>Registration:</dt>
   <dd>A registration is the state machine characterizing a
   given node's membership in a given endpoint.  Any single
   registration has an associated delivery failure action as defined
   below and must at any time be in one of two states: Active or
   Passive.  Registrations are local; information about a node's
   registrations is not expected to be available at other nodes, and
   the Bundle Protocol does not include a mechanism for distributing
   information about registrations.</dd>
        <dt>Delivery:</dt>
   <dd>A bundle is considered to have been delivered at a node
   subject to a registration as soon as the ADU that
   is the payload of the bundle, together with any relevant metadata
   (an implementation matter), has been presented to the node's
   application agent in a manner consistent with the state of that
   registration.</dd>
        <dt>Deliverability:</dt>
   <dd>A bundle is considered "deliverable" subject to a
   registration if and only if (a) the bundle's destination endpoint is
   the endpoint with which the registration is associated, (b) the
   bundle has not yet been delivered subject to this registration, and
   (c) the bundle has not yet been "abandoned" (as defined below)
   subject to this registration.</dd>
        <dt>Abandonment:</dt>
   <dd>To abandon a bundle subject to some registration is to
   assert that the bundle is not deliverable subject to that
   registration.</dd>
        <dt>Delivery failure action:</dt>
   <dd>The delivery failure action of a
   registration is the action that is to be taken when a bundle that is
   "deliverable" subject to that registration is received at a time
   when the registration is in the Passive state.</dd>
        <dt>Destination:</dt>
   <dd>The destination of a bundle is the endpoint comprising
   the node(s) at which the bundle is to be delivered (as defined
   above).</dd>
        <dt>Transmission:</dt>
   <dd>A transmission is an attempt by a node's BPA to cause
   copies of a bundle to be delivered to one or more of the nodes that
   are members of some endpoint (the bundle's destination) in response
   to a transmission request issued by the node's application agent.</dd>
        <dt>Forwarding:</dt>
   <dd>To forward a bundle to a node is to invoke the services
   of one or more CLAs in a sustained effort to cause a copy of the
   bundle to be received by that node.</dd>
        <dt>Discarding:</dt>
   <dd>To discard a bundle is to cease all operations on the
   bundle and functionally erase all references to it.  The specific
   procedures by which this is accomplished are an implementation
   matter.</dd>
        <dt>Retention constraint:</dt>
   <dd>A retention constraint is an element of the
   state of a bundle that prevents the bundle from being discarded.
   That is, a bundle cannot be discarded while it has any retention
   constraints.</dd>
        <dt>Deletion:</dt>
   <dd>To delete a bundle is to remove unconditionally all of
   the bundle's retention constraints, enabling the bundle to be
   discarded.</dd>
 </dl>
      </section>
      <section anchor="sect-3.2" numbered="true" toc="default">
        <name>Discussion of BP Concepts</name>
        <t>
   Multiple instances of the same bundle (the same unit of DTN protocol
   data) might exist concurrently in different parts of a network --
   possibly differing in some blocks -- in the memory local to one or
   more bundle nodes and/or in transit between nodes. In the context of
   the operation of a bundle node, a bundle is an instance (copy), in
   that node's local memory, of some bundle that is in the network.</t>
        <t>
   The payload for a bundle forwarded in response to a bundle
   transmission request is the ADU whose location is
   provided as a parameter to that request. The payload for a bundle
   forwarded in response to reception of a bundle is the payload of the
   received bundle.</t>
        <t>
   In the most familiar case, a bundle node is instantiated as a single
   process running on a general-purpose computer, but in general the
   definition is meant to be broader: a bundle node might alternatively
   be a thread, an object in an object-oriented operating system, a
   special-purpose hardware device, etc.</t>
        <t>
   The manner in which the functions of the BPA are performed is wholly
   an implementation matter. For example, BPA functionality might be
   coded into each node individually; it might be implemented as a
   shared library that is used in common by any number of bundle nodes
   on a single computer; it might be implemented as a daemon whose
   services are invoked via inter-process or network communication by
   any number of bundle nodes on one or more computers; it might be
   implemented in hardware.</t>
        <t>
   Every CLA implements its own thin layer of protocol, interposed
   between BP and the (usually "top") protocol(s) of the underlying
   integrated protocol stack; this "CL protocol" may only serve to
   multiplex and demultiplex bundles to and from the underlying integrated
   protocol, or it may offer additional CL-specific functionality. The
   manner in which a CLA sends and receives bundles, as well as the
   definitions of CLAs and CL protocols, are beyond the scope of this
   specification.</t>
        <t>
   Note that the administrative element of a node's application agent
   may itself, in some cases, function as a CLA.
   That is, outgoing bundles may be "tunneled" through encapsulating
   bundles:

        </t>
        <ul spacing="normal">
          <li>An outgoing bundle constitutes a byte array. This byte array may,
          like any other, be presented to the BPA as an
          ADU that is to be transmitted to some endpoint.</li>
          <li>The original bundle thus forms the payload of an encapsulating
          bundle that is forwarded using some other convergence-layer
          protocol(s).</li>
          <li>When the encapsulating bundle is received, its payload is
          delivered to the peer application agent administrative element,
          which then instructs the BPA to dispatch that
          original bundle in the usual way.</li>
        </ul>
        <t>
   The purposes for which this technique may be useful (such as cross-domain
   security) are beyond the scope of this specification.</t>
        <t>
   The only interface between the BPA and the application-specific
   element of the AA is the BP service interface. But between the BPA
   and the administrative element of the AA there is a (conceptual)
   private control interface in addition to the BP service interface.
   This private control interface enables the BPA and the
   administrative element of the AA to direct each other to take action
   under specific circumstances.</t>
        <t>
   In the case of a node that serves simply as a BP "router", the AA may have
   no application-specific element at all. The application-specific elements
   of other nodes' AAs may perform arbitrarily complex application functions,
   perhaps even offering multiplexed DTN communication services to a number of
   other applications. As with the BPA, the manner in which the AA performs
   its functions is wholly an implementation matter.</t>
        <t>
   Singletons are the most familiar sort of endpoint, but in general
   the endpoint notion is meant to be broader. For example, the nodes
   in a sensor network might constitute a set of bundle nodes that are
   all registered in a single common endpoint and will all receive any
   data delivered at that endpoint. <strong>Note</strong> too that any given bundle
   node might be registered in multiple bundle endpoints and receive
   all data delivered at each of those endpoints.
</t>
   <t>
     
   Recall that every node, by definition, includes an application agent, which
   in turn includes an administrative element, which exchanges administrative
   records with the administrative elements of other nodes.  As such, every
   node is permanently, structurally registered in the singleton endpoint at
   which administrative records received from other nodes are delivered.
   Registration in no other endpoint can ever be assumed to be permanent.
   This endpoint, termed the node's "administrative endpoint", is therefore
   uniquely and permanently associated with the node, and for this reason the
   ID of a node's administrative endpoint may always serve as the "node ID"
   (see <xref target="sect-4.2.5.2"/>) of the node.
</t>
        <t>
   The destination of every bundle is an endpoint, which may or may not
   be singleton.  The source of every bundle is a node, identified by
   node ID.  Note, though, that the source node ID asserted in a given
   bundle may be the null endpoint ID (as described later) rather than
   the ID of the source node; bundles for which the asserted source
   node ID is the null endpoint ID are termed "anonymous" bundles.</t>
        <t>
   Any number of transmissions may be concurrently undertaken by the
   BPA of a given node.</t>

   <t>When the BPA of a node determines that it must forward a bundle either 
   to a node that is a member of the bundle's destination endpoint or to 
   some intermediate forwarding node, the BPA invokes the services of one 
   or more CLAs in a sustained effort to cause a copy of the bundle to be 
   received by that node.</t>

   <t>Upon reception, the processing of a bundle depends on whether or not 
   the receiving node is registered in the bundle's destination endpoint.
 If it is, and if
   the payload of the bundle is non-fragmentary (possibly as a result
   of successful payload reassembly from fragmentary payloads,
   including the original payload of the newly received bundle), then
   the bundle is normally delivered to the node's application agent
   subject to the registration characterizing the node's membership in
   the destination endpoint.</t>
        <t>
   The Bundle Protocol itself does not ensure delivery of a bundle to
   its destination.  Data loss along the path to the destination node
   can be minimized by utilizing reliable convergence-layer protocols
   between neighbors on all segments of the end-to-end path; however, for
   end-to-end bundle delivery assurance it will be necessary to develop
   extensions to the Bundle Protocol and/or application-layer
   mechanisms.</t>
        <t>
   The Bundle Protocol is designed for extensibility.  Bundle Protocol
   extensions, documented elsewhere, may extend this specification by
   defining additional:

        </t>
        <ul spacing="normal">
          <li>blocks</li>
          <li>administrative records</li>
          <li>bundle processing control flags</li>
          <li>block processing control flags</li>
          <li>types of bundle status reports</li>
          <li>bundle status report reason codes</li>
          <li>mandates and constraints on processing that
        conformant BPAs must perform at specified points in
        the inbound and outbound bundle processing cycles</li>
        </ul>
      </section>
      <section anchor="sect-3.3" numbered="true" toc="default">
        <name>Services Offered by Bundle Protocol Agents</name>
        <t>
   The BPA of each node is expected to provide the following services
   to the node's application agent:

        </t>
        <ul spacing="normal">
          <li>commencing a registration (registering the node in an endpoint).</li>
          <li>terminating a registration.</li>
          <li>switching a registration between Active and Passive states.</li>
          <li>transmitting a bundle to an identified bundle endpoint.</li>
          <li>canceling a transmission.</li>
          <li>polling a registration that is in the Passive state.</li>
          <li>delivering a received bundle.</li>
        </ul>
        <t>   Note that the details of registration functionality are an
   implementation matter and are beyond the scope of this
   specification.</t>
      </section>
    </section>
    <section anchor="sect-4" numbered="true" toc="default">
      <name>Bundle Format</name>
      <section anchor="sect-4.1" numbered="true" toc="default">
        <name>Bundle Structure</name>
        <t>
   The format of bundles <bcp14>SHALL</bcp14> conform to the Concise Binary Object
   Representation (CBOR) <xref target="RFC8949" format="default"/>.</t>
        <t>
   Cryptographic verification of a block is possible only if the
   sequence of octets on which the verifying node computes its hash --
   the canonicalized representation of the block -- is identical to the
   sequence of octets on which the hash declared for that block was
   computed.  To ensure that blocks are always in canonical
   representation when they are transmitted and received, the CBOR
   encodings of the values of all fields in all blocks <bcp14>MUST</bcp14>
   conform to the core deterministic encoding requirements as specified in <xref target="RFC8949" format="default"/>, except that indefinite-length items are not prohibited.</t>
        <t>
   Each bundle <bcp14>SHALL</bcp14> be a concatenated sequence of at least two blocks,
   represented as a CBOR indefinite-length array.  The first block in
   the sequence (the first item of the array) <bcp14>MUST</bcp14> be a primary bundle
   block in CBOR encoding as described below; the bundle <bcp14>MUST</bcp14>
   have exactly one primary bundle block. The primary block <bcp14>MUST</bcp14> be
   followed by one or more canonical bundle blocks (additional array
   items) in CBOR encoding as described in <xref target="sect-4.3.2"/>.  Every
   block following the primary block <bcp14>SHALL</bcp14> be the CBOR encoding
   of a canonical block.  The last such block <bcp14>MUST</bcp14> be a payload block;
   the bundle <bcp14>MUST</bcp14> have exactly one payload block.  The payload block
   <bcp14>SHALL</bcp14> be followed by a CBOR "break" stop code, terminating the
   array.</t>
   <aside><t>
   (Note that, while CBOR permits considerable flexibility in the
   encoding of bundles, this flexibility must not be interpreted as
   inviting increased complexity in PDU structure.)</t></aside>
        <t>
   Associated with each block of a bundle is a block number.  The block
   number uniquely identifies the block within the bundle, enabling
   blocks (notably Bundle Protocol Security blocks) to reference other
   blocks in the same bundle without ambiguity.  The block number of
   the primary block is implicitly zero; the block numbers of all other
   blocks are explicitly stated in block headers as noted below. Block
   numbering is unrelated to the order in which blocks are sequenced in
   the bundle. The block number of the payload block is always 1.</t>
        <t>
   An implementation of the Bundle Protocol <bcp14>MAY</bcp14> discard any sequence of
   bytes that does not conform to the Bundle Protocol specification.</t>
        <t>
   An implementation of the Bundle Protocol <bcp14>MAY</bcp14> accept a sequence of
   bytes that does not conform to the Bundle Protocol specification
   (e.g., one that represents data elements in fixed-length arrays
   rather than indefinite-length arrays) and transform it into
   conformant BP structure before processing it.  Procedures for
   accomplishing such a transformation are beyond the scope of this
   specification.</t>
      </section>
      <section anchor="sect-4.2" numbered="true" toc="default">
        <name>BP Fundamental Data Structures</name>
        <section anchor="sect-4.2.1" numbered="true" toc="default">
          <name>CRC Type</name>
          <t>
   CRC type is an unsigned integer type code for which the following
   values (and no others) are valid:

          </t>
          <ul spacing="normal">
            <li>0 indicates "no Cyclic Redundancy Check (CRC) is present."</li>
            <li>1 indicates "a standard X-25 CRC-16 is present." <xref target="CRC16"/></li>
            <li>2 indicates "a standard CRC32C (Castagnoli) CRC-32 is present."
        <xref target="RFC4960" format="default"/></li>
          </ul>
          <t>
   CRC type <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer.</t>
          <t>
   For examples of CRC32C CRCs, see <xref target="RFC7143" sectionFormat="of" section="A.4"/>.</t>
          <t>
   Note that more robust protection of BP data integrity, as needed,
   may be provided by means of Block Integrity Blocks (BIBs) as defined in the
   Bundle Protocol Security specification <xref target="RFC9172"/>.
          </t>
        </section>
        <section anchor="sect-4.2.2" numbered="true" toc="default">
          <name>CRC</name>
          <t>
   The CRC <bcp14>SHALL</bcp14> be omitted from a block if and only if the block's CRC
   type code is zero.</t>
          <t>
   When not omitted, the CRC <bcp14>SHALL</bcp14> be represented as a CBOR byte string
   of two bytes (that is, CBOR additional information 2, if CRC type is
   1) or of four bytes (that is, CBOR additional information 4, if CRC
   type is 2); in each case, the sequence of bytes <bcp14>SHALL</bcp14> constitute an
   unsigned integer value (of 16 or 32 bits, respectively) in network
   byte order.</t>
        </section>
        <section anchor="sect-4.2.3" numbered="true" toc="default">
          <name>Bundle Processing Control Flags</name>
          <t>
   Bundle processing control flags assert properties of the bundle as a
   whole rather than of any particular block of the bundle.  They are
   conveyed in the primary block of the bundle.</t>
          <t>
   The following properties are asserted by the bundle processing
   control flags:

          </t>
          <ul spacing="normal">
            <li>The bundle is a fragment.  (Boolean)</li>
            <li>The bundle's payload is an administrative record.  (Boolean)</li>
            <li>The bundle must not be fragmented.  (Boolean)</li>
            <li>Acknowledgment by the user application is requested.  (Boolean)</li>
            <li>Status time is requested in all status reports.  (Boolean)</li>
            <li>
              <t>Flags requesting types of status reports (all Boolean):

              </t>
              <ul spacing="normal">
                <li>Request reporting of bundle reception.</li>
                <li>Request reporting of bundle forwarding.</li>
                <li>Request reporting of bundle delivery.</li>
                <li>Request reporting of bundle deletion.</li>
              </ul>
            </li>
          </ul>
          <t>
   If the bundle processing control flags indicate that the bundle's
   ADU is an administrative record, then all status
   report request flag values <bcp14>MUST</bcp14> be zero.</t>
          <t>
   If the bundle's source node is omitted (i.e., the source node ID is the ID
   of the null endpoint, which has no members as discussed below; this option
   enables anonymous bundle transmission), then the bundle is not uniquely
   identifiable and all Bundle Protocol features that rely on bundle identity
   must therefore be disabled: the "Bundle must not be fragmented" flag value
   <bcp14>MUST</bcp14> be 1, and all status report request flag values <bcp14>MUST</bcp14> be zero.</t>
          <t>
   Bundle processing control flags that are unrecognized <bcp14>MUST</bcp14> be
   ignored, as future definitions of additional flags might not be
   integrated simultaneously into the Bundle Protocol implementations
   operating at all nodes.</t>
          <t>
   The bundle processing control flags <bcp14>SHALL</bcp14> be represented as a CBOR
   unsigned integer item, the value of which <bcp14>SHALL</bcp14> be processed as a
   bit field indicating the control flag values as follows (note that
   bit numbering in this instance is reversed from the usual practice,
   beginning with the low-order bit instead of the high-order bit, in
   recognition of the potential definition of additional control flag
   values in the future):

          </t>
          <dl spacing="normal">
            <dt>Bit 0 (the low-order bit, 0x000001):</dt>
            <dd>Bundle is a fragment.</dd>
            <dt>Bit 1 (0x000002):</dt>
            <dd>ADU is an administrative record.</dd>
            <dt>Bit 2 (0x000004):</dt>
            <dd>Bundle must not be fragmented.</dd>
            <dt>Bit 3 (0x000008):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 4 (0x000010):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 5 (0x000020):</dt>
            <dd>Acknowledgement by application is requested.</dd>
            <dt>Bit 6 (0x000040):</dt>
            <dd>Status time requested in reports.</dd>
            <dt>Bit 7 (0x000080):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 8 (0x000100):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 9 (0x000200):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 10 (0x000400):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 11 (0x000800):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 12 (0x001000):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 13 (0x002000):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 14 (0x004000):</dt>
            <dd>Request reporting of bundle reception.</dd>
            <dt>Bit 15 (0x008000):</dt>
            <dd>Reserved.</dd>
            <dt>Bit 16 (0x010000):</dt>
            <dd>Request reporting of bundle forwarding.</dd>
            <dt>Bit 17 (0x020000):</dt>
            <dd>Request reporting of bundle delivery.</dd>
            <dt>Bit 18 (0x040000):</dt>
            <dd>Request reporting of bundle deletion.</dd>
            <dt>Bits 19-20:</dt>
            <dd>Reserved.</dd>
            <dt>Bits 21-63:</dt>
            <dd>Unassigned.</dd>
          </dl>
        </section>
        <section anchor="sect-4.2.4" numbered="true" toc="default">
          <name>Block Processing Control Flags</name>
          <t>
   The block processing control flags assert properties of canonical
   bundle blocks.  They are conveyed in the header of the block to
   which they pertain.</t>
          <t>
   Block processing control flags that are unrecognized <bcp14>MUST</bcp14> be
   ignored, as future definitions of additional flags might not be
   integrated simultaneously into the Bundle Protocol implementations
   operating at all nodes.</t>
          <t>
   The block processing control flags <bcp14>SHALL</bcp14> be represented as a CBOR
   unsigned integer item, the value of which <bcp14>SHALL</bcp14> be processed as a
   bit field indicating the control flag values as follows (note that
   bit numbering in this instance is reversed from the usual practice,
   beginning with the low-order bit instead of the high-order bit, for
   agreement with the bit numbering of the bundle processing control
   flags):</t>
          <dl spacing="normal">
          <dt>Bit 0 (the low-order bit, 0x01):</dt>
           <dd>Block must be replicated in every fragment.</dd>
          <dt>Bit 1 (0x02):</dt>
           <dd>Transmit status report if block can't be processed.</dd>
          <dt>Bit 2 (0x04):</dt>
           <dd>Delete bundle if block can't be processed.</dd>
          <dt>Bit 3 (0x08):</dt>
           <dd>Reserved.</dd>
          <dt>Bit 4 (0x10):</dt>
           <dd>Discard block if it can't be processed.</dd>
          <dt>Bit 5 (0x20):</dt>
           <dd>Reserved.</dd>
          <dt>Bit 6 (0x40):</dt>
           <dd>Reserved.</dd>
          <dt>Bits 7-63:</dt>
           <dd>Unassigned.</dd>
          </dl>
          <t>
   For each bundle whose bundle processing control flags indicate that
   the bundle's ADU is an administrative record, or
   whose source node ID is the null endpoint ID as defined below, the
   value of the "Transmit status report if block can't be processed"
   flag in every canonical block of the bundle <bcp14>MUST</bcp14> be zero.</t>
        </section>
        <section anchor="sect-4.2.5" numbered="true" toc="default">
          <name>Identifiers</name>
          <section anchor="sect-4.2.5.1" numbered="true" toc="default">
            <name>Endpoint ID</name>
            <t>
   The destinations of bundles are bundle endpoints, identified by text
   strings termed "endpoint IDs" (see <xref target="sect-3.1" format="default"/>). Each endpoint ID
   (EID) is a Uniform Resource Identifier <xref target="RFC3986" format="default"/>. As such, each
   endpoint ID can be characterized as having this general structure:</t>
            <t>
   &lt; scheme name &gt; : &lt; scheme-specific part, or "SSP" &gt;</t>
            <t>
   The scheme identified by the &lt; scheme name &gt; in an endpoint ID is a
   set of syntactic and semantic rules that fully explain how to parse
   and interpret the scheme-specific part (SSP). Each scheme that may be used to form a BP
   endpoint ID must be added to the "Bundle Protocol URI Scheme Types" registry,
   maintained by IANA as described in <xref target="sect-9.6" format="default"/>;
   association of a unique URI scheme code number with each scheme name
   in this registry helps to enable compact representation of endpoint
   IDs in bundle blocks.  Note that the set of allowable schemes is
   effectively unlimited. Any scheme conforming to <xref target="RFC7595" format="default"/> may be
   added to the registry of URI scheme code numbers and thereupon used in a
   Bundle Protocol endpoint ID.</t>
            <t>
   Each entry in the registry of URI scheme code numbers <bcp14>MUST</bcp14> contain a
   reference to a scheme code number definition document, which defines
   the manner in which the scheme-specific part of any URI formed in
   that scheme is parsed and interpreted and <bcp14>MUST</bcp14> be CBOR encoded for transmission as a BP endpoint ID.  The scheme
   code number definition document may also contain information as to
   (a) which convergence-layer protocol(s) may be used to forward a
   bundle to a BP destination endpoint identified by such an ID and
   (b) how the ID of the convergence-layer protocol endpoint to use for
   that purpose can be inferred from that destination endpoint ID.</t>
            <t>
   Note that, although endpoint IDs are URIs, implementations of the BP
   service interface may support expression of endpoint IDs in some
   internationalized manner (e.g., Internationalized Resource
   Identifiers (IRIs); see <xref target="RFC3987" format="default"/>).</t>
            <t>
   Each BP endpoint ID (EID) <bcp14>SHALL</bcp14> be represented as a CBOR array
   comprising two items.</t>
            <t>
   The first item of the array <bcp14>SHALL</bcp14> be the code number identifying the
   endpoint ID's URI scheme, as defined in the registry of URI scheme
   code numbers for the Bundle Protocol.  Each URI scheme code number <bcp14>SHALL</bcp14>
   be represented as a CBOR unsigned integer.</t>
            <t>
   The second item of the array <bcp14>SHALL</bcp14> be the applicable CBOR
   encoding of the scheme-specific part of the EID, defined
   as noted in the references(s) for the URI scheme code number 
   registry entry for the EID's URI scheme.</t>
            <section anchor="sect-4.2.5.1.1" numbered="true" toc="default">
              <name>The dtn URI Scheme</name>
              <t>
   The "dtn" scheme supports the identification of BP endpoints by
   arbitrarily expressive character strings.  It is specified as
   follows:</t>
              <dl>
  <dt>Scheme syntax:</dt>
   <dd>This specification uses the Augmented Backus-Naur
  Form (ABNF) notation of <xref target="RFC5234" format="default"/>.</dd>
              </dl>
              <sourcecode type="abnf"><![CDATA[
dtn-uri = "dtn:" ("none" / dtn-hier-part)

dtn-hier-part = "//" node-name name-delim demux ; a path-rootless

node-name = reg-name

name-delim = "/"

demux = *VCHAR
]]></sourcecode>
              <dl>
   <dt>Scheme semantics:</dt>
   <dd>URIs of the dtn scheme are used as endpoint
   identifiers in the Delay-Tolerant Networking (DTN) Bundle Protocol
   (BP) as described in the present document.</dd>
              </dl>
              <t>
   The endpoint ID "dtn:none" identifies the "null endpoint", the
   endpoint that by definition never has any members.</t>
              <t>
   All BP endpoints identified by all other dtn-scheme endpoint IDs for which
   the first character of demux is a character other than '~' (tilde) are
   singleton endpoints. All BP endpoints identified by dtn-scheme endpoint IDs
   for which the first character <strong>is</strong> '~' (tilde) are <strong>not</strong> singleton
   endpoints.</t>
              <t>
   A dtn-scheme endpoint ID for which the demux is of length zero <bcp14>MAY</bcp14>
   identify the administrative endpoint for the node identified by
   node-name, and as such may serve as a node ID.  No dtn-scheme
   endpoint ID for which the demux is of non-zero length may do so.</t>
              <t>
   Note that these syntactic rules impose constraints on dtn-scheme
   endpoint IDs that were not imposed by the original specification of
   the dtn scheme as provided in <xref target="RFC5050" format="default"/>.  It is believed that the
   dtn-scheme endpoint IDs employed by BP applications conforming to
   <xref target="RFC5050" format="default"/> are in most cases unlikely to be in violation of these
   rules, but the developers of such applications are advised of the
   potential for compromised interoperation.</t>
  <dl>
   <dt>Encoding considerations:</dt>
   <dd>For transmission as a BP endpoint ID, the 
   scheme-specific part of a URI of the dtn scheme <bcp14>SHALL</bcp14> be represented
   as a CBOR text string unless the EID's SSP is "none", in which case
   the SSP <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer with the
   value zero.  For all other purposes, URIs of the dtn scheme are
   encoded exclusively in US-ASCII characters.</dd>
   <dt>Interoperability considerations:</dt>
   <dd>None.</dd>
     <dt>Security considerations:</dt>
     <dd>
     <t><br/></t>
       <dl>
        <dt>Reliability and consistency:</dt>
   <dd>None of the BP endpoints identified by the
   URIs of the dtn scheme are guaranteed to be reachable at any time, and the
   identity of the processing entities operating on those endpoints is never
   guaranteed by the Bundle Protocol itself. Verification of the signature provided by the Block Integrity Block targeting the bundle's primary block, as defined by Bundle Protocol Security <xref target="RFC9172"/>, is required for this purpose.</dd>
              <dt>Malicious construction:</dt>
   <dd>Malicious construction of a conformant
   dtn-scheme URI is limited to the malicious selection of node names and the
   malicious selection of demux strings.  That is, a maliciously constructed
   dtn-scheme URI could be used to direct a bundle to an endpoint that might
   be damaged by the arrival of that bundle or, alternatively, to declare a
   false source for a bundle and thereby cause incorrect processing at a node
   that receives the bundle.  In both cases (and indeed in all bundle
   processing), the node that receives a bundle should verify its authenticity
   and validity before operating on it in any way.</dd>
              <dt>Back-end transcoding:</dt>
   <dd>The limited expressiveness of URIs of the dtn
   scheme effectively eliminates the possibility of threat due to errors in
   back-end transcoding.</dd>
              <dt>Rare IP address formats:</dt>
   <dd>Not relevant, as IP addresses do not appear
   anywhere in conformant dtn-scheme URIs.</dd>
              <dt>Sensitive information:</dt>
   <dd>Because dtn-scheme URIs are used only to
   represent the identities of Bundle Protocol endpoints, the risk of
   disclosure of sensitive information due to interception of these URIs is
   minimal.  Examination of dtn-scheme URIs could be used to support traffic
   analysis; where traffic analysis is a plausible danger, bundles should be
   conveyed by secure convergence-layer protocols that do not expose endpoint
   IDs.</dd>
              <dt>Semantic attacks:</dt>
   <dd>The simplicity of dtn-scheme URI syntax minimizes the
   possibility of misinterpretation of a URI by a human user.</dd>
       </dl>
     </dd>
   </dl>
            </section>
            <section anchor="sect-4.2.5.1.2" numbered="true" toc="default">
              <name>The ipn URI Scheme</name>
              <t>
   The "ipn" scheme supports the identification of BP endpoints by
   pairs of unsigned integers, for compact representation in bundle
   blocks.  It is specified as follows:</t>
              <dl>
   <dt>Scheme syntax:</dt>
   <dd>This specification uses the Augmented Backus-Naur
   Form (ABNF) notation of <xref target="RFC5234" format="default"/>, including the core ABNF syntax
   rule for DIGIT defined by that specification.</dd>
              </dl>
              <sourcecode type="abnf"><![CDATA[
ipn-uri = "ipn:" ipn-hier-part

ipn-hier-part = node-nbr nbr-delim service-nbr ; a path-rootless

node-nbr = 1*DIGIT

nbr-delim = "."

service-nbr = 1*DIGIT
]]></sourcecode>
              <dl>
  <dt>Scheme semantics:</dt>
   <dd>URIs of the ipn scheme are used as endpoint
   identifiers in the Delay-Tolerant Networking (DTN) Bundle Protocol
   (BP) as described in the present document.</dd>
              </dl>
              <t>
   All BP endpoints identified by ipn-scheme endpoint IDs are singleton
   endpoints.</t>
              <t>
   An ipn-scheme endpoint ID for which service-nbr is zero <bcp14>MAY</bcp14> identify
   the administrative endpoint for the node identified by node-nbr, and
   as such may serve as a node ID.  No ipn-scheme endpoint ID for which
   service-nbr is non-zero may do so.</t>
   <dl>
   <dt>Encoding considerations:</dt>
   <dd>For transmission as a BP endpoint ID, the
   scheme-specific part of a URI of the ipn scheme <bcp14>SHALL</bcp14> be
   represented as a CBOR array comprising two items.  The first item of
   this array <bcp14>SHALL</bcp14> be the EID's node number (a number that identifies
   the node) represented as a CBOR unsigned integer.  The second item
   of this array <bcp14>SHALL</bcp14> be the EID's service number (a number that
   identifies some application service) represented as a CBOR unsigned
   integer.  For all other purposes, URIs of the ipn scheme are encoded
   exclusively in US-ASCII characters.</dd>
   <dt>Interoperability considerations:</dt>
   <dd>None.</dd>
     <dt>Security considerations:</dt>
     <dd>
       <t><br/></t>
     <dl>
     <dt>Reliability and consistency:</dt>
   <dd>None of the BP endpoints identified by the
   URIs of the ipn scheme are guaranteed to be reachable at any time, and the
   identity of the processing entities operating on those endpoints is never
   guaranteed by the Bundle Protocol itself. Verification of the signature provided by the Block Integrity Block targeting the bundle's primary block, as defined by Bundle Protocol Security <xref target="RFC9172" format="default"/>, is
   required for this purpose.</dd>
              <dt>Malicious construction:</dt>
   <dd>Malicious construction of a conformant
   ipn-scheme URI is limited to the malicious selection of node numbers and
   the malicious selection of service numbers.  That is, a maliciously
   constructed ipn-scheme URI could be used to direct a bundle to an endpoint
   that might be damaged by the arrival of that bundle or, alternatively, to
   declare a false source for a bundle and thereby cause incorrect processing
   at a node that receives the bundle.  In both cases (and indeed in all
   bundle processing), the node that receives a bundle should verify its
   authenticity and validity before operating on it in any way.</dd>
              <dt>Back-end transcoding:</dt>
   <dd>The limited expressiveness of URIs of the ipn
   scheme effectively eliminates the possibility of threat due to errors in
   back-end transcoding.</dd>
              <dt>Rare IP address formats:</dt>
   <dd>Not relevant, as IP addresses do not appear
   anywhere in conformant ipn-scheme URIs.</dd>
              <dt>Sensitive information:</dt>
   <dd>Because ipn-scheme URIs are used only to
   represent the identities of Bundle Protocol endpoints, the risk of
   disclosure of sensitive information due to interception of these URIs is
   minimal.  Examination of ipn-scheme URIs could be used to support traffic
   analysis; where traffic analysis is a plausible danger, bundles should be
   conveyed by secure convergence-layer protocols that do not expose endpoint
   IDs.</dd>
              <dt>Semantic attacks:</dt>
   <dd>The simplicity of ipn-scheme URI syntax minimizes the
   possibility of misinterpretation of a URI by a human user.
 </dd>
</dl>
</dd>
</dl>
            </section>
          </section>
          <section anchor="sect-4.2.5.2" numbered="true" toc="default">
            <name>Node ID</name>
            <t>
   For many purposes of the Bundle Protocol, it is important to identify
   the node that is operative in some context.</t>
            <t>
   As discussed in <xref target="sect-3.1"/>, nodes are distinct from endpoints;
   specifically, an endpoint is a set of zero or more nodes.  But
   rather than define a separate namespace for node identifiers, we
   instead use endpoint identifiers to identify nodes as discussed in
   <xref target="sect-3.2"/>. Formally:</t>

   <ul spacing="normal">
    <li>Every node is, by definition, permanently registered in the
    singleton endpoint at which administrative records are delivered
    to its application agent's administrative element, termed the
    node's "administrative endpoint".</li>
    <li>As such, the EID of a node's administrative endpoint <bcp14>SHALL</bcp14>
    uniquely identify that node.</li>
    <li>The EID of any singleton endpoint is allowed to serve as a "node ID"
   identifying the node that is the sole member of that endpoint.</li>
   </ul>

          </section>
        </section>
        <section anchor="sect-4.2.6" numbered="true" toc="default">
          <name>DTN Time</name>
          <t>
   A DTN time is an unsigned integer indicating the number of
   milliseconds that have elapsed since the DTN Epoch, 2000-01-01
   00:00:00 +0000 (UTC).  DTN time is not affected by leap seconds.</t>
          <t>
   Each DTN time <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer item.
   Implementers need to be aware that DTN time values conveyed in CBOR
   encoding in bundles will nearly always exceed (2<sup>32</sup> - 1); the
   manner in which a DTN time value is represented in memory is an
   implementation matter.  The DTN time value zero indicates that the
   time is unknown.</t>
        </section>
        <section anchor="sect-4.2.7" numbered="true" toc="default">
          <name>Creation Timestamp</name>
          <t>
   Each bundle's creation timestamp <bcp14>SHALL</bcp14> be represented as a CBOR
   array comprising two items.</t>
          <t>
   The first item of the array, termed "bundle creation time", <bcp14>SHALL</bcp14> be
   the DTN time at which the transmission request was received that
   resulted in the creation of the bundle, represented as a CBOR
   unsigned integer.</t>
          <t>
   The second item of the array, termed the creation timestamp's
   "sequence number", <bcp14>SHALL</bcp14> be the latest value (as of the time at
   which the transmission request was received) of a monotonically
   increasing positive integer counter managed by the source node's
   BPA, represented as a CBOR unsigned integer.  The
   sequence counter <bcp14>MAY</bcp14> be reset to zero whenever the current time
   advances by one millisecond.</t>
          <t>
   For nodes that lack accurate clocks, it is recommended that bundle
   creation time be set to zero and that the counter used as the source
   of the bundle sequence count never be reset to zero.</t>
          <t>
   Note that, in general, the creation of two distinct bundles with the
   same source node ID and bundle creation timestamp may result in
   unexpected network behavior and/or suboptimal performance. The
   combination of source node ID and bundle creation timestamp serves
   to identify a single transmission request, enabling it to be
   acknowledged by the receiving application (provided the source node
   ID is not the null endpoint ID).</t>
        </section>
        <section anchor="sect-4.2.8" numbered="true" toc="default">
          <name>Block-Type-Specific Data</name>
          <t>
   Block-type-specific data in each block (other than the primary
   block) <bcp14>SHALL</bcp14> be the applicable CBOR encoding of the content of
   the block.  Details of this representation are included in the
   specification defining the block type.</t>
        </section>
      </section>
      <section anchor="sect-4.3" numbered="true" toc="default">
        <name>Block Structures</name>
        <t>
   This section describes the primary block in detail and non-primary
   blocks in general. Rules for processing these blocks appear in
   <xref target="sect-5"/>.</t>
        <t>
   Note that supplementary DTN protocol specifications (including, but
   not restricted to, Bundle Protocol Security <xref target="RFC9172" format="default"/>) may require
   that BP implementations conforming to those protocols construct and
   process additional blocks.</t>
        <section anchor="sect-4.3.1" numbered="true" toc="default">
          <name>Primary Bundle Block</name>
          <t>
   The primary bundle block contains the basic information needed to
   forward bundles to their destinations.</t>
          <t>
   Each primary block <bcp14>SHALL</bcp14> be represented as a CBOR array; the number
   of elements in the array <bcp14>SHALL</bcp14> be 8 (if the bundle is not a fragment
   and the block has no CRC), 9 (if the block has a CRC and the bundle
   is not a fragment), 10 (if the bundle is a fragment and the block
   has no CRC), or 11 (if the bundle is a fragment and the block has a
   CRC).</t>
          <t>
   The primary block of each bundle <bcp14>SHALL</bcp14> be immutable.  The CBOR-
   encoded values of all fields in the primary block <bcp14>MUST</bcp14> remain
   unchanged from the time the block is created to the time it is
   delivered.</t>
          <t>
   The fields of the primary bundle block <bcp14>SHALL</bcp14> be as follows, listed
          in the order in which they <bcp14>MUST</bcp14> appear:</t>

          <dl>
          <dt>Version:</dt>
   <dd>An unsigned integer value indicating the version of the
   Bundle Protocol that constructed this block. The present document
   describes BPv7. This version number <bcp14>SHALL</bcp14> be
   represented as a CBOR unsigned integer item.</dd>
          <dt>Bundle Processing Control Flags:</dt>
   <dd>The bundle processing control flags
   are discussed in <xref target="sect-4.2.3" format="default"/>.</dd>
          <dt>CRC Type:</dt>
   <dd>CRC type codes are discussed in <xref target="sect-4.2.1" format="default"/>.  The
   CRC type code for the primary block <bcp14>MAY</bcp14> be zero if the bundle
   contains a BPSec Block Integrity Block <xref target="RFC9172" format="default"/> 
   whose target is the
   primary block; otherwise, the CRC type code for the primary block
   <bcp14>MUST</bcp14> be non-zero.</dd>
          <dt>Destination EID:</dt>
   <dd>The Destination EID field identifies the bundle
   endpoint that is the bundle's destination, i.e., the endpoint that
   contains the node(s) at which the bundle is to be delivered.</dd>
          <dt>Source node ID:</dt>
   <dd>The Source node ID field identifies the bundle node
   at which the bundle was initially transmitted, except that source
   node ID may be the null endpoint ID in the event that the bundle's
   source chooses to remain anonymous.</dd>
          <dt>Report-to EID:</dt>
   <dd>The Report-to EID field identifies the bundle
   endpoint to which status reports pertaining to the forwarding and
   delivery of this bundle are to be transmitted.</dd>
          <dt>Creation Timestamp:</dt>
   <dd>The creation timestamp comprises two unsigned
   integers that, together with the source node ID and (if the bundle
   is a fragment) the fragment offset and payload length, serve to
   identify the bundle. See <xref target="sect-4.2.7"/> for the definition of this
   field.</dd>
          <dt>Lifetime:</dt>
   <dd>
         <t>The Lifetime field is an unsigned integer that indicates
   the time at which the bundle's payload will no longer be useful,
   encoded as a number of milliseconds past the creation time. (For
   high-rate deployments with very brief disruptions, fine-grained
   expression of bundle lifetime may be useful.)  When a bundle's age
   exceeds its lifetime, bundle nodes need no longer retain or forward
   the bundle; the bundle <bcp14>SHOULD</bcp14> be deleted from the network.</t>
          <t>
   If the asserted lifetime for a received bundle is so lengthy that
   retention of the bundle until its expiration time might degrade
   operation of the node at which the bundle is received, or if the
   BPA of that node determines that the bundle must
   be deleted in order to prevent network performance degradation
   (e.g., the bundle appears to be part of a denial-of-service attack),
   then that BPA <bcp14>MAY</bcp14> impose a temporary overriding
   lifetime of shorter duration; such an overriding lifetime <bcp14>SHALL NOT</bcp14>
   replace the lifetime asserted in the bundle but <bcp14>SHALL</bcp14> serve as the
   bundle's effective lifetime while the bundle resides at that node.
   Procedures for imposing lifetime overrides are beyond the scope of
   this specification.</t>
          <t>
   For bundles originating at nodes that lack accurate clocks, it is
   recommended that bundle age be obtained from the Bundle Age
   extension block (see <xref target="sect-4.4.2"/>) rather than from the difference
   between current time and bundle creation time.  Bundle lifetime
   <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer item.</t>
   </dd>
  <dt>Fragment offset:</dt>
   <dd>If and only if the bundle processing control flags
   of this primary block indicate that the bundle is a fragment, 
   fragment offset <bcp14>SHALL</bcp14> be present in the primary block. Fragment
   offset <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer indicating
   the offset from the start of the original ADU at
   which the bytes comprising the payload of this bundle were located.</dd>
        
   <dt>Total Application Data Unit Length:</dt>
   <dd>If and only if the bundle
   processing control flags of this primary block indicate that the
   bundle is a fragment, total application data unit length <bcp14>SHALL</bcp14> be
   present in the primary block. Total application data unit length
   <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer indicating the total
   length of the original ADU of which this bundle's
   payload is a part.</dd>
      
   <dt>CRC:</dt>
   <dd>A CRC <bcp14>SHALL</bcp14> be present in the primary block unless the bundle includes
   a BPSec Block Integrity Block <xref target="RFC9172" format="default"/> whose
   target is the primary block, in which case a CRC <bcp14>MAY</bcp14> be present in the
   primary block.  The length and nature of the CRC <bcp14>SHALL</bcp14> be as indicated by
   the CRC type.  The CRC <bcp14>SHALL</bcp14> be computed over the concatenation of all
   bytes (including CBOR "break" characters) of the primary block including
   the CRC field itself, which, for this purpose, <bcp14>SHALL</bcp14> be temporarily populated
   with all bytes set to zero.</dd>
 </dl>
 
        </section>
        <section anchor="sect-4.3.2" numbered="true" toc="default">
          <name>Canonical Bundle Block Format</name>
          <t>
   Every block other than the primary block (all such blocks are termed
   "canonical" blocks) <bcp14>SHALL</bcp14> be represented as a CBOR array; the number
   of elements in the array <bcp14>SHALL</bcp14> be 5 (if CRC type is zero) or 6
   (otherwise).</t>
          <t>
   The fields of every canonical block <bcp14>SHALL</bcp14> be as follows, listed in
   the order in which they <bcp14>MUST</bcp14> appear:</t>
          <dl>
           <dt>Block type code:</dt><dd>An unsigned integer. Bundle block type code 1
        indicates that the block is a Bundle Payload Block. Other block type codes
        are described in <xref target="sect-9.1" format="default"/>.
        Block type codes 192 through 255 are not reserved and
        are available for private and/or experimental use.  All other block
        type code values are reserved for future use.</dd>
           <dt>Block number:</dt><dd>An unsigned integer as discussed in <xref target="sect-4.1"/>.  The block
        number <bcp14>SHALL</bcp14> be represented as a CBOR unsigned integer.</dd>
           <dt>Block processing control flags:</dt><dd>As discussed in <xref target="sect-4.2.4"/>.</dd>
           <dt>CRC type:</dt><dd>As discussed in <xref target="sect-4.2.1" format="default"/>.</dd>
           <dt>Block-type-specific data:</dt><dd>Represented as a single definite-length
        CBOR byte string, i.e., a CBOR byte string that is not of indefinite
        length.  For each type of block, the block-type-specific data byte
        string is the serialization, in a block-type-specific manner, of the
        data conveyed by that type of block; definitions of blocks are
        required to define the manner in which block-type-specific data are
        serialized within the block-type-specific data field. For the Bundle Payload
        Block in particular (block type 1), the block-type-specific data
        field, termed the "payload", <bcp14>SHALL</bcp14> be an ADU, or
        some contiguous extent thereof, represented as a definite-length CBOR
        byte string.</dd>
           <dt>If and only if the value of the CRC type field of this block is
        non-zero:</dt><dd>A CRC. If present, the length and nature of the CRC <bcp14>SHALL</bcp14> be
        as indicated by the CRC type and the CRC <bcp14>SHALL</bcp14> be computed over the
        concatenation of all bytes of the block (including CBOR "break"
        characters) including the CRC field itself, which, for this purpose,
        <bcp14>SHALL</bcp14> be temporarily populated with all bytes set to zero.</dd>
       </dl>
        </section>
      </section>
      <section anchor="sect-4.4" numbered="true" toc="default">
        <name>Extension Blocks</name>
        <t>"Extension blocks" are all blocks other than the primary and payload
   blocks. Three types of extension blocks are defined below.  All
   implementations of the Bundle Protocol specification (the present
   document) <bcp14>MUST</bcp14> include procedures for recognizing, parsing, and
   acting on, but not necessarily producing, these types of extension
   blocks.</t>
        <t>
   The specifications for additional types of extension blocks must
   indicate whether or not BP implementations conforming to those
   specifications must recognize, parse, act on, and/or produce blocks
   of those types.  As not all nodes will necessarily instantiate BP
   implementations that conform to those additional specifications, it
   is possible for a node to receive a bundle that includes extension
   blocks that the node cannot process. The values of the block
   processing control flags indicate the action to be taken by the
   BPA when this is the case.</t>
        <t>
   No mandated procedure in this specification is unconditionally
   dependent on the absence or presence of any extension block.
   Therefore, any BPA <bcp14>MAY</bcp14> insert or remove any
   extension block in any bundle, subject to all mandates in the Bundle
   Protocol specification and all extension block specifications to
   which the node's BP implementation conforms.  Note that removal of
   an extension block will probably disable one or more elements of
   bundle processing that were intended by the BPA that inserted that
   block.  In particular, note that removal of an extension block that
   is one of the targets of a BPSec security block may render the
   bundle unverifiable.</t>
        <t>
   The following extension blocks are defined in the current document.</t>
        <section anchor="sect-4.4.1" numbered="true" toc="default">
          <name>Previous Node</name>
          <t>
   The Previous Node Block, block type 6, identifies the node that
   forwarded this bundle to the local node (i.e., to the node at which
   the bundle currently resides); its block-type-specific data is the
   node ID of that forwarder node.  That node ID <bcp14>SHALL</bcp14> conform to <xref target="sect-4.2.5.2" format="default"/>.
   If the local
   node is the source of the bundle, then the bundle <bcp14>MUST NOT</bcp14> contain
   any Previous Node Block.  Otherwise, the bundle <bcp14>SHOULD</bcp14> contain one
   (1) occurrence of this type of block and <bcp14>MUST NOT</bcp14> contain more than
   one.</t>
        </section>
        <section anchor="sect-4.4.2" numbered="true" toc="default">
          <name>Bundle Age</name>
          <t>
   The Bundle Age Block, block type 7, contains the number of
   milliseconds that have elapsed between the time the bundle was
   created and the time at which it was most recently forwarded.  It is
   intended for use by nodes lacking access to an accurate clock, to
   aid in determining the time at which a bundle's lifetime expires.
   The block-type-specific data of this block is an unsigned integer
   containing the age of the bundle in milliseconds, which <bcp14>SHALL</bcp14> be
   represented as a CBOR unsigned integer item. (The age of the bundle
   is the sum of all known intervals of the bundle's residence at
   forwarding nodes, up to the time at which the bundle was most
   recently forwarded, plus the summation of signal propagation time
   over all episodes of transmission between forwarding nodes.
   Determination of these values is an implementation matter.) If the
   bundle's creation time is zero, then the bundle <bcp14>MUST</bcp14> contain exactly
   one (1) occurrence of this type of block; otherwise, the bundle <bcp14>MAY</bcp14>
   contain at most one (1) occurrence of this type of block.  A bundle
   <bcp14>MUST NOT</bcp14> contain multiple occurrences of the Bundle Age Block, as
   this could result in processing anomalies.</t>
        </section>
        <section anchor="sect-4.4.3" numbered="true" toc="default">
          <name>Hop Count</name>
          <t>
   The Hop Count Block, block type 10, contains two unsigned integers:
   hop limit and hop count.  A "hop" is here defined as an occasion on
   which a bundle was forwarded from one node to another node.  The hop
   limit <bcp14>MUST</bcp14> be in the range 1 through 255. The hop limit value <bcp14>SHOULD
   NOT</bcp14> be changed at any time after creation of the Hop Count Block;
   the hop count value <bcp14>SHOULD</bcp14> initially be zero and <bcp14>SHOULD</bcp14> be increased
   by 1 on each hop.</t>
          <t>
   The Hop Count Block is mainly intended as a safety mechanism, a
   means of identifying bundles for removal from the network that can
   never be delivered due to a persistent forwarding error.  The hop count
   is particularly valuable as a defense against routing anomalies that
   might cause a bundle to be forwarded in a cyclical "ping-pong"
   fashion between two nodes.  When a bundle's hop count exceeds its
   hop limit, the bundle <bcp14>SHOULD</bcp14> be deleted for the reason "Hop limit exceeded", following the Bundle Deletion procedure defined in
   <xref target="sect-5.10" format="default"/>.</t>
          <t>
   Procedures for determining the appropriate hop limit for a bundle
   are beyond the scope of this specification.</t>
          <t>
   The block-type-specific data in a Hop Count Block <bcp14>SHALL</bcp14> be
   represented as a CBOR array comprising two items.  The first item of
   this array <bcp14>SHALL</bcp14> be the bundle's hop limit, represented as a CBOR
   unsigned integer.  The second item of this array <bcp14>SHALL</bcp14> be the
   bundle's hop count, represented as a CBOR unsigned integer. A bundle
   <bcp14>MAY</bcp14> contain one occurrence of this type of block but <bcp14>MUST NOT</bcp14>
   contain more than one.</t>
        </section>
      </section>
    </section>
    <section anchor="sect-5" numbered="true" toc="default">
      <name>Bundle Processing</name>
      <t>
   The bundle-processing procedures mandated in this section and in
   <xref target="sect-6" format="default"/> govern the operation of the BPA and the
   application agent administrative element of each bundle node. They
   are neither exhaustive nor exclusive. Supplementary DTN protocol
   specifications (including, but not restricted to, Bundle Protocol 
   Security <xref target="RFC9172" format="default"/>) may augment, override, or supersede the
   mandates of this document.</t>
      <section anchor="sect-5.1" numbered="true" toc="default">
        <name>Generation of Administrative Records</name>
        <t>
   All transmission of bundles is in response to bundle transmission
   requests presented by nodes' application agents. When required to
   "generate" an administrative record (such as a bundle status
   report), the BPA itself is responsible for causing
   a new bundle to be transmitted, conveying that record. In concept,
   the BPA discharges this responsibility by
   directing the administrative element of the node's application agent
   to construct the record and request its transmission as detailed in
   <xref target="sect-6" format="default"/>. In practice, the manner in which administrative
   record generation is accomplished is an implementation matter,
   provided the constraints noted in <xref target="sect-6" format="default"/> are observed.</t>
        <t>
   Status reports are relatively small bundles.  Moreover, even when
   the generation of status reports is enabled, the decision on whether
   or not to generate a requested status report is left to the
   discretion of the BPA.  Nonetheless, note that
   requesting status reports for any single bundle might easily result
   in the generation of (1 + (2 *(N-1))) status report bundles, where N
   is the number of nodes on the path from the bundle's source to its
   destination, inclusive.  That is, the requesting of status reports
   for large numbers of bundles could result in an unacceptable
   increase in the bundle traffic in the network. For this reason, the
   generation of status reports <bcp14>MUST</bcp14> be disabled by default and enabled
   only when the risk of excessive network traffic is deemed
   acceptable.  Mechanisms that could assist in assessing and
   mitigating this risk, such as pre-placed agreements authorizing the
   generation of status reports under specified circumstances, are
   beyond the scope of this specification.</t>

   <t>Notes on administrative record terminology:</t>
        <ul spacing="normal">
          <li>A "bundle reception status report" is a bundle status report with
          the "Reporting node received bundle" flag set to 1.</li>
          <li>A "bundle forwarding status report" is a bundle status report
          with the "Reporting node forwarded the bundle" flag set to 1.</li>
          <li>A "bundle delivery status report" is a bundle status report with
          the "Reporting node delivered the bundle" flag set to 1.</li>
          <li>A "bundle deletion status report" is a bundle status report with
          the "Reporting node deleted the bundle" flag set to 1.</li>
        </ul>
      </section>
      <section anchor="sect-5.2" numbered="true" toc="default">
        <name>Bundle Transmission</name>
        <t>
        The steps in processing a bundle transmission request are as follows:</t>
        <ol type="Step %d:" indent="9">
        <li>
   Transmission of the bundle is initiated. An outbound bundle
   <bcp14>MUST</bcp14> be created per the parameters of the bundle transmission
   request, with the retention constraint "Dispatch pending". The
   source node ID of the bundle <bcp14>MUST</bcp14> be either (a) the null endpoint ID,
   indicating that the source of the bundle is anonymous or (b) the
   EID of a singleton endpoint whose only member is the node of which
   the BPA is a component.</li>
        
  <li> Processing proceeds from Step 1 of <xref target="sect-5.4" format="default"/>.</li>
        </ol>
        
      </section>
      <section anchor="sect-5.3" numbered="true" toc="default">
        <name>Bundle Dispatching</name>
        <t>
   (Note that this procedure is initiated only following completion of
   Step 4 of <xref target="sect-5.6" format="default"/>.)</t>
        <t>
        The steps in dispatching a bundle are as follows:</t>
        <ol type="Step %d:" indent="9">
        <li>
  If the bundle's destination endpoint is an endpoint of which
   the node is a member, the Bundle Delivery procedure defined in
   <xref target="sect-5.7" format="default"/> <bcp14>MUST</bcp14> be followed and, for the purposes of all subsequent
   processing of this bundle at this node, the node's membership in the
   bundle's destination endpoint <bcp14>SHALL</bcp14> be disavowed; specifically, even
   though the node is a member of the bundle's destination endpoint,
   the node <bcp14>SHALL NOT</bcp14> undertake to forward the bundle to itself in the
   course of performing the procedure described in <xref target="sect-5.4" format="default"/>.</li>
        
          <li> Processing proceeds from Step 1 of <xref target="sect-5.4" format="default"/>.</li>
        </ol>
        
      </section>
      <section anchor="sect-5.4" numbered="true" toc="default">
        <name>Bundle Forwarding</name>
        <t>
        The steps in forwarding a bundle are as follows:</t>
        <ol type="Step %d:" indent="9">
        
  <li>The retention constraint "Forward pending" <bcp14>MUST</bcp14> be added to
   the bundle, and the bundle's "Dispatch pending" retention constraint
   <bcp14>MUST</bcp14> be removed.</li>
   <li><t>The BPA <bcp14>MUST</bcp14> determine whether or not
   forwarding is contraindicated (that is, rendered inadvisable) for
   any of the reasons listed in the IANA "Bundle Status Report Reason Codes" registry 
   (see <xref target="sect-9.5"/>), whose initial contents
   are listed in  <xref target="tab-1"/>. In particular:</t>
      
        <ul spacing="normal">
          <li>The BPA <bcp14>MAY</bcp14> choose to either forward the bundle
          directly to its destination node(s) (if possible) or forward the
          bundle to some other node(s) for further forwarding. The manner in
          which this decision is made may depend on the scheme name in the
          destination endpoint ID and/or on other state but in any case is
          beyond the scope of this document; one possible mechanism is
          described in <xref target="SABR"/>. If the BPA elects to forward the bundle to some
          other node(s) for further forwarding but finds it impossible to
          select any node(s) to forward the bundle to, then forwarding is
          contraindicated.</li>
          <li>Provided the BPA succeeded in selecting the
          node or nodes to forward the bundle to, the BPA <bcp14>MUST</bcp14>
          subsequently select the CLA(s) whose services
          will enable the node to send the bundle to those nodes.  The manner
          in which specific appropriate CLAs are
          selected is beyond the scope of this document; the TCP
          CLA <xref target="RFC9174" format="default"/> <bcp14>MUST</bcp14>
          be implemented when some or all of the bundles forwarded by the
          BPA must be forwarded via the Internet but may not
          be appropriate for the forwarding of any particular bundle. If the
          agent finds it impossible to select any appropriate CLA(s) to use in forwarding this bundle, then forwarding
          is contraindicated.</li>
        </ul>
        </li>
        
        <li>
   If forwarding of the bundle is determined to be
   contraindicated for any of the reasons listed in the IANA "Bundle Status Report
   Reason Codes" registry (see <xref target="sect-9.5"/>), then
   the Forwarding Contraindicated procedure defined in <xref target="sect-5.4.1" format="default"/>
   <bcp14>MUST</bcp14> be followed; the remaining steps of this Bundle Forwarding procedure are skipped at this time.</li>
        
  <li><t>For each node selected for forwarding, the BPA <bcp14>MUST</bcp14> invoke the services of the selected CLA(s) in order to effect the sending of the bundle to that
   node. Determining the time at which the BPA
   invokes CLA services is a BPA implementation
   matter.  Determining the time at which each CLA subsequently responds to this service invocation by sending
   the bundle is a CLA implementation matter.
  Note that:</t>
  
        <ul spacing="normal">
          <li>If the bundle has a Previous Node Block, as defined in <xref target="sect-4.4.1"/>,
          then that block <bcp14>MUST</bcp14> be removed from the bundle before the
          bundle is forwarded.</li>
          <li>If the BPA is configured to attach Previous
          Node Blocks to forwarded bundles, then a Previous Node Block
          containing the node ID of the forwarding node <bcp14>MUST</bcp14> be inserted into
          the bundle before the bundle is forwarded.</li>
          <li>If the bundle has a Bundle Age Block, as defined in <xref target="sect-4.4.2"/>,
          then at the last possible moment before the CLA initiates
          conveyance of the bundle via the CL protocol the bundle age value
          <bcp14>MUST</bcp14> be increased by the difference between the current time and the
          time at which the bundle was received (or, if the local node is the
          source of the bundle, created).</li>
        </ul>
        </li>
        <li>
   When all selected CLAs have informed
   the BPA that they have concluded their data-sending procedures
   with regard to this bundle, processing may depend on the results of those
   procedures.</li>
        </ol>
       <t> 
   If completion of the data-sending procedures by all selected
   CLAs has not resulted in successful forwarding
   of the bundle (an implementation-specific determination that is
   beyond the scope of this specification), then the BPA <bcp14>MAY</bcp14> choose (in an implementation-specific manner, again beyond
   the scope of this specification) to initiate another attempt to
   forward the bundle.  In that event, processing proceeds from Step 4.
   The minimum number of times a given node will initiate another
   forwarding attempt for any single bundle in this event (a number
   that may be zero) is a node configuration parameter that must be
   exposed to other nodes in the network to the extent that this is
   required by the operating environment.</t>
        <t>
   If completion of the data-sending procedures by all selected
   CLAs <strong>HAS</strong> resulted in successful forwarding of
   the bundle, or if it has not but the BPA does not
   choose to initiate another attempt to forward the bundle, then:
        </t>
        <ul spacing="normal">
          <li>If the "request reporting of bundle forwarding" flag in the
          bundle's status report request field is set to 1 and status
          reporting is enabled, then a bundle forwarding status report <bcp14>SHOULD</bcp14>
          be generated, destined for the bundle's report-to endpoint ID. The
          reason code on this bundle forwarding status report <bcp14>MUST</bcp14> be "no
          additional information".</li>
          <li>If any applicable Bundle Protocol extensions mandate generation
          of status reports upon conclusion of convergence-layer data-sending
          procedures, all such status reports <bcp14>SHOULD</bcp14> be generated with
          extension-mandated reason codes.</li>
          <li>The bundle's "Forward pending" retention constraint <bcp14>MUST</bcp14> be
          removed.</li>
        </ul>
        <section anchor="sect-5.4.1" numbered="true" toc="default">
          <name>Forwarding Contraindicated</name>
          <t>
   The steps in responding to contraindication of forwarding are as follows:</t>
   
     <ol type="Step %d:" indent="9">
  <li>The BPA <bcp14>MUST</bcp14> determine whether or not to
   declare failure in forwarding the bundle. Note: This decision is
   likely to be influenced by the reason for which forwarding is
   contraindicated.</li>
          <li>
   If forwarding failure is declared, then the Forwarding
          Failed procedure defined in <xref target="sect-5.4.2" format="default"/> <bcp14>MUST</bcp14> be followed.</li>
     </ol>
          <t>
   Otherwise, when -- at some future time -- the forwarding of this
   bundle ceases to be contraindicated, processing proceeds from Step 4
          of <xref target="sect-5.4" format="default"/>.</t>
          
        </section>
        <section anchor="sect-5.4.2" numbered="true" toc="default">
          <name>Forwarding Failed</name>
          <t>
   The steps in responding to a declaration of forwarding failure are as follows:</t>
   
     <ol type="Step %d:" indent="9">
   <li>The BPA <bcp14>MAY</bcp14> forward the bundle back to the
   node that sent it, as identified by the Previous Node Block, if
   present.  This forwarding, if performed, <bcp14>SHALL</bcp14> be accomplished by
   performing Step 4 and Step 5 of <xref target="sect-5.4"/> where the sole node
   selected for forwarding <bcp14>SHALL</bcp14> be the node that sent the bundle.</li>
          <li>
   If the bundle's destination endpoint is an endpoint of which
   the node is a member, then the bundle's "Forward pending" retention
   constraint <bcp14>MUST</bcp14> be removed. Otherwise, the bundle <bcp14>MUST</bcp14> be deleted:
   the Bundle Deletion procedure defined in <xref target="sect-5.10" format="default"/> <bcp14>MUST</bcp14> be
   followed, citing the reason for which forwarding was determined to
          be contraindicated.</li>
     </ol>
        </section>
      </section>
      <section anchor="sect-5.5" numbered="true" toc="default">
        <name>Bundle Expiration</name>
        <t>
   A bundle expires when the bundle's age exceeds its lifetime as
   specified in the primary bundle block or as overridden by the BPA. Bundle age <bcp14>MAY</bcp14> be determined by subtracting the
   bundle's creation timestamp time from the current time if (a) that
   timestamp time is not zero and (b) the local node's clock is known
   to be accurate; otherwise, bundle age <bcp14>MUST</bcp14> be obtained from the
   Bundle Age extension block.  Bundle expiration <bcp14>MAY</bcp14> occur at any
   point in the processing of a bundle. When a bundle expires, the
   BPA <bcp14>MUST</bcp14> delete the bundle for the reason
   "Lifetime expired" (when the expired lifetime is the lifetime as
   specified in the primary block) or "Traffic pared" (when the expired
   lifetime is a lifetime override as imposed by the BPA): the Bundle Deletion procedure defined in <xref target="sect-5.10" format="default"/> <bcp14>MUST</bcp14>
   be followed.</t>
      </section>
      <section anchor="sect-5.6" numbered="true" toc="default">
        <name>Bundle Reception</name>
        <t>
   The steps in processing a bundle that has been received from another
   node are as follows:</t>
        <ol type="Step %d:" indent="9">
   <li>The retention constraint "Dispatch pending" <bcp14>MUST</bcp14> be added to
   the bundle.</li>
        <li>
   If the "request reporting of bundle reception" flag in the
   bundle's status report request field is set to 1 and status
   reporting is enabled, then a bundle reception status report with
   reason code "No additional information" <bcp14>SHOULD</bcp14> be generated,
   destined for the bundle's report-to endpoint ID.</li>
        <li>
   CRCs <bcp14>SHOULD</bcp14> be computed for every block of the bundle that
   has an attached CRC.  If any block of the bundle is malformed
   according to this specification (including syntactically invalid
   CBOR), or if any block has an attached CRC and the CRC computed for
   this block upon reception differs from that attached CRC, then the
   BPA <bcp14>MUST</bcp14> delete the bundle for the reason "Block unintelligible".  The Bundle Deletion procedure defined in <xref target="sect-5.10" format="default"/> <bcp14>MUST</bcp14> be followed, and all remaining steps of the Bundle
   Reception procedure <bcp14>MUST</bcp14> be skipped.</li>
        <li>
   <t>For each block in the bundle that is an extension block that
   the BPA cannot process:</t>

        
        <ul spacing="normal">
          <li>If the block processing control flags in that block indicate that a
          status report is requested in this event and if status reporting is
          enabled, then a bundle reception status report with reason code
          "Block unsupported" <bcp14>SHOULD</bcp14> be generated, destined for the bundle's
          report-to endpoint ID.</li>
          <li>If the block processing control flags in that block indicate that the
          bundle must be deleted in this event, then the BPA
          <bcp14>MUST</bcp14> delete the bundle for the reason "Block unsupported"; the
          Bundle Deletion procedure defined in <xref target="sect-5.10" format="default"/> <bcp14>MUST</bcp14>
          be followed, and all remaining steps of the Bundle Reception
          procedure <bcp14>MUST</bcp14> be skipped.</li>
          <li>If the block processing control flags in that block do <strong>NOT</strong> indicate that
          the bundle must be deleted in this event but do indicate that the
          block must be discarded, then the BPA <bcp14>MUST</bcp14> remove
          this block from the bundle.</li>
          <li>If the block processing control flags in that block neither indicate that
          the bundle must be deleted nor indicate that the block must be
          discarded, then processing continues with the next extension block
          that the BPA cannot process, if any; otherwise,
          processing proceeds from Step 5.</li>
        </ul>
        </li>
        
        <li>
        Processing proceeds from Step 1 of <xref target="sect-5.3" format="default"/>.</li>
        </ol>
        
      </section>
      <section anchor="sect-5.7" numbered="true" toc="default">
        <name>Local Bundle Delivery</name>
        <t>
   The steps in processing a bundle that is destined for an endpoint of
        which this node is a member are as follows:</t>
        <ol type="Step %d:" indent="9">
        <li>
   If the received bundle is a fragment, the ADU Reassembly procedure described in <xref target="sect-5.9" format="default"/> <bcp14>MUST</bcp14> be followed.
   If this procedure results in reassembly of the entire original
   ADU, processing of the fragmentary bundle whose
   payload has been replaced by the reassembled ADU
   (whether this bundle or a previously received fragment) proceeds
   from Step 2; otherwise, the retention constraint "Reassembly pending" <bcp14>MUST</bcp14> be added to the bundle, and all remaining steps of this
   procedure <bcp14>MUST</bcp14> be skipped.</li>
        <li>
   <t>Delivery depends on the state of the registration whose
   endpoint ID matches that of the destination of the bundle:</t>

        
        <ul spacing="normal">
          <li>An additional implementation-specific delivery deferral procedure
          <bcp14>MAY</bcp14> optionally be associated with the registration.</li>
          <li>If the registration is in the Active state, then the bundle <bcp14>MUST</bcp14>
          be delivered automatically as soon as it is the next bundle that is
          due for delivery according to the BPA's bundle delivery scheduling
          policy (an implementation matter).</li>
          <li>
            <t>If the registration is in the Passive state, or if delivery of
          the bundle fails for some implementation-specific reason, then the
          registration's delivery failure action <bcp14>MUST</bcp14> be taken. The
          delivery failure action <bcp14>MUST</bcp14> be one of the following:
            </t>
            <ul spacing="normal">
              <li>Defer delivery of the bundle subject to this registration
               until (a) this bundle is the least recently received of all
               bundles currently deliverable subject to this registration and
               (b) either the registration is polled or the registration
               is in the Active state, and also perform any additional
               delivery deferral procedure associated with the registration,
               or</li>
              <li>Abandon delivery of the bundle subject to this registration
               (as defined in <xref target="sect-3.1"/>).</li>
            </ul>
          </li>
        </ul>
        </li>
     
        <li>
   As soon as the bundle has been delivered, if the "request reporting of bundle delivery" flag in the bundle's status report
   request field is set to 1 and bundle status reporting is enabled,
   then a bundle delivery status report <bcp14>SHOULD</bcp14> be generated, destined
   for the bundle's report-to endpoint ID. Note that this status report
   only states that the payload has been delivered to the application
        agent, not that the application agent has processed that payload.</li>
      </ol>
      
      </section>
      <section anchor="sect-5.8" numbered="true" toc="default">
        <name>Bundle Fragmentation</name>
        <t>
   It may at times be advantageous for BPAs to reduce
   the sizes of bundles in order to forward them. This might be the
   case, for example, if a node to which a bundle is to be forwarded is
   accessible only via intermittent contacts and no upcoming contact is
   long enough to enable the forwarding of the entire bundle.</t>
        <t>
   The size of a bundle can be reduced by "fragmenting" the bundle. To
   fragment a bundle whose payload is of size M is to replace it with
   two "fragments" -- new bundles with the same source node ID and
   creation timestamp as the original bundle -- whose payloads <bcp14>MUST</bcp14> be
   the first N and the last (M - N) bytes of the original bundle's
   payload, where 0 &lt; N &lt; M.</t>
        <t>
   Note that fragments are bundles and therefore may themselves be
   fragmented, so multiple episodes of fragmentation may in effect
   replace the original bundle with more than two fragments. (However,
   there is only one "level" of fragmentation, as in IP fragmentation.)</t>
        <t>
   Any bundle whose primary block's bundle processing control flags do <strong>NOT</strong>
   indicate that it must not be fragmented <bcp14>MAY</bcp14> be fragmented at any
   time, for any purpose, at the discretion of the BPA.  <strong>NOTE</strong>, however, that some combinations of bundle
   fragmentation, replication, and routing might result in unexpected
   traffic patterns.</t>
        <t>
   Fragmentation <bcp14>SHALL</bcp14> be constrained as follows:

        </t>
        <ul spacing="normal">
          <li>The concatenation of the payloads of all fragments produced by
          fragmentation <bcp14>MUST</bcp14> always be identical to the payload of the
          fragmented bundle (that is, the bundle that is being
          fragmented). Note that the payloads of fragments resulting from
          different fragmentation episodes, in different parts of the network,
          may be overlapping subsets of the fragmented bundle's payload.</li>
          <li>The primary block of each fragment <bcp14>MUST</bcp14> differ from that of the
          fragmented bundle, in that the bundle processing control flags of the
          fragment <bcp14>MUST</bcp14> indicate that the bundle is a fragment and both
          fragment offset and total application data unit length must be
          provided.  Additionally, the CRC of the primary block of the
          fragmented bundle, if any, <bcp14>MUST</bcp14> be replaced in each fragment by a
          new CRC computed for the primary block of that fragment.</li>
          <li>The payload blocks of fragments will differ from that of the
          fragmented bundle as noted above.</li>
          <li>If the fragmented bundle is not a fragment or is the fragment
          with offset zero, then all extension blocks of the fragmented bundle
          <bcp14>MUST</bcp14> be replicated in the fragment whose offset is zero.</li>
          <li>Each of the fragmented bundle's extension blocks whose "Block
          must be replicated in every fragment" flag is set to 1 <bcp14>MUST</bcp14> be
          replicated in every fragment. </li>
          <li>Beyond these rules, rules for the replication of extension blocks
          in the fragments must be defined in the specifications for those
          extension block types.</li>
        </ul>
      </section>
      <section anchor="sect-5.9" numbered="true" toc="default">
        <name>Application Data Unit Reassembly</name>
        <t>
   Note that the Bundle Fragmentation procedure described in <xref target="sect-5.8"/>
   may result in the replacement of a single original bundle with an
   arbitrarily large number of fragmentary bundles.  In order to be
   delivered at a destination node, the original bundle's payload must
   be reassembled from the payloads of those fragments.</t>
        <t>
   The "material extents" of a received fragment's payload are all
   continuous sequences of bytes in that payload that do not overlap
   with the material extents of the payloads of any previously received
   fragments with the same source node ID and creation timestamp.  If
   the concatenation -- as informed by fragment offsets and payload
   lengths -- of the material extents of the payloads of this fragment
   and all previously received fragments with the same source node ID
   and creation timestamp as this fragment forms a continuous byte
   array whose length is equal to the total application data unit
   length noted in the fragment's primary block, then:

        </t>
        <ul spacing="normal">
          <li>This byte array -- the reassembled ADU --
          <bcp14>MUST</bcp14> replace the payload of that fragment whose material extents
          include the extent at offset zero.  Note that this will enable
          delivery of the reconstituted original bundle as described in Step 1
          of <xref target="sect-5.7"/>.</li>
          <li>The "Reassembly pending" retention constraint <bcp14>MUST</bcp14> be removed
          from every other fragment with the same source node ID and creation
          timestamp as this fragment.</li>
        </ul>
        <t>
   Note: Reassembly of ADUs from fragments occurs at
   the nodes that are members of destination endpoints as necessary; an
   ADU <bcp14>MAY</bcp14> also be reassembled at some other node on
   the path to the destination.</t>
      </section>
      <section anchor="sect-5.10" numbered="true" toc="default">
        <name>Bundle Deletion</name>
        <t>
        The steps in deleting a bundle are as follows:</t>
        <ol type="Step %d:" indent="9">
        <li>
   If the "request reporting of bundle deletion" flag in the
   bundle's status report request field is set to 1 and if status
   reporting is enabled, then a bundle deletion status report citing
   the reason for deletion <bcp14>SHOULD</bcp14> be generated, destined for the
   bundle's report-to endpoint ID.</li>
        <li>
        All of the bundle's retention constraints <bcp14>MUST</bcp14> be removed.</li>
        </ol>
      </section>
      <section anchor="sect-5.11" numbered="true" toc="default">
        <name>Discarding a Bundle</name>
        <t>
   As soon as a bundle has no remaining retention constraints, it <bcp14>MAY</bcp14> be
   discarded, thereby releasing any persistent storage that may have
   been allocated to it.</t>
      </section>
      <section anchor="sect-5.12" numbered="true" toc="default">
        <name>Canceling a Transmission</name>
        <t>
   When requested to cancel a specified transmission, where the bundle
   created upon initiation of the indicated transmission has not yet
   been discarded, the BPA <bcp14>MUST</bcp14> delete that bundle
   for the reason "Transmission canceled". For this purpose, the
   procedure defined in <xref target="sect-5.10" format="default"/> <bcp14>MUST</bcp14> be followed.</t>
      </section>
    </section>
    <section anchor="sect-6" numbered="true" toc="default">
      <name>Administrative Record Processing</name>
      <section anchor="sect-6.1" numbered="true" toc="default">
        <name>Administrative Records</name>
        <t>
   Administrative records are standard ADUs that are
   used in providing some of the features of the Bundle Protocol.
   Bundle Protocol administrative record types are registered in the
   IANA "Bundle Administrative Record Types" registry <xref target="RFC5050"/>;
   of these, only administrative record type 1, "Bundle status report", is defined
   for BPv7 at this time. Note that additional types of administrative
   records may be defined by supplementary DTN protocol specification
   documents.</t>
        <t>
   Every administrative record consists of:

        </t>
        <ul spacing="normal">
          <li>A record type code (an unsigned integer for which valid values are
          as defined below).</li>
          <li>Record content in type-specific format.</li>
        </ul>
        <t>
   Each BP administrative record <bcp14>SHALL</bcp14> be represented as a CBOR array
   comprising two items.</t>
        <t>
   The first item of the array <bcp14>SHALL</bcp14> be a record type code, which <bcp14>SHALL</bcp14>
   be represented as a CBOR unsigned integer.</t>
        <t>
   The second element of this array <bcp14>SHALL</bcp14> be the applicable CBOR
   encoding of the content of the record.  Details of the CBOR
   encoding of administrative record type 1 are provided below.
   Details of the CBOR encoding of other types of administrative
   records are included in the specifications defining those
   records.</t>
        <section anchor="sect-6.1.1" numbered="true" toc="default">
          <name>Bundle Status Reports</name>
          <t>
   The transmission of "bundle status reports" under specified
   conditions is an option that can be invoked when transmission of a
   bundle is requested. These reports are intended to provide
   information about how bundles are progressing through the system,
   including notices of receipt, forwarding, final delivery, and
   deletion. They are transmitted to the report-to endpoints of
   bundles.</t>
          <t>
   Each bundle status report <bcp14>SHALL</bcp14> be represented as a CBOR array.  The
   number of elements in the array <bcp14>SHALL</bcp14> be either 6 (if the subject
   bundle is a fragment) or 4 (otherwise).</t>
          <t>
   The first element of the bundle status report <bcp14>SHALL</bcp14> be bundle
   status information represented as a CBOR array of at least four
   elements.  The first four elements of the bundle status information
   shall provide information on the following four status
   assertions, in this order:

          </t>
          <ul spacing="normal">
            <li>Reporting node received bundle.</li>
            <li>Reporting node forwarded the bundle.</li>
            <li>Reporting node delivered the bundle.</li>
            <li>Reporting node deleted the bundle.</li>
          </ul>
          <t>
   Each element of the bundle status information <bcp14>SHALL</bcp14> be a bundle
   status item encoded as a CBOR array.</t>
   <t>The number of elements in
   each bundle status item <bcp14>SHALL</bcp14> be either 2 (if the value of the first element of
   the bundle status item is 1 AND the "Report status time" flag was
   set to 1 in the bundle processing control flags of the bundle whose status
   is being reported) or 1 (otherwise).</t>
   <t>The first element of each bundle status item <bcp14>SHALL</bcp14>
   be a status indicator, a Boolean value indicating whether or not the
   corresponding bundle status is asserted, encoded as a CBOR Boolean value.
   If present, the second element of each bundle status item
   <bcp14>SHALL</bcp14> indicate the time (as reported by the local system clock;
   this is an implementation matter) at which the indicated status was asserted for
   this bundle, represented as a DTN time as described in <xref target="sect-4.2.6" format="default"/>.</t>
          <t>
   The second element of the bundle status report <bcp14>SHALL</bcp14> be the
   bundle status report reason code explaining the value of the status
   indicator, represented as a CBOR unsigned integer. Valid status
   report reason codes are registered in the IANA "Bundle Status Report
   Reason Codes" subregistry in the "Bundle Protocol" registry (see <xref target="sect-9.5"/>).  The initial contents of that registry are listed in <xref target="tab-1"/>, but the list of status report reason codes provided here is
   neither exhaustive nor exclusive; supplementary DTN protocol
   specifications (including, but not restricted to, Bundle Protocol 
   Security <xref target="RFC9172" format="default"/>) may define additional reason codes.</t>
          <table anchor="tab-1" align="left">
            <name>Status Report Reason Codes</name>
            <thead>
              <tr>
                <th>Value</th>
                <th>Meaning</th>
              </tr>
              </thead>
            <tbody>
              <tr>
              <td>0</td>
              <td>No additional information.</td>
              </tr>
          <tr>
            <td>1</td>
            <td>Lifetime expired.</td>
          </tr>
          <tr>
            <td>2</td>
            <td>Forwarded over unidirectional link.</td>
          </tr>
          <tr>
            <td>3</td>
            <td>Transmission canceled.</td>
          </tr>
          <tr>
            <td>4</td>
            <td>Depleted storage.</td>
          </tr>
          <tr>
            <td>5</td>
            <td>Destination endpoint ID unavailable.</td>
          </tr>
          <tr>
            <td>6</td>
            <td>No known route to destination from here.</td>
          </tr>
          <tr>
            <td>7</td>
            <td>No timely contact with next node on route.</td>
          </tr>
          <tr>
            <td>8</td>
            <td>Block unintelligible.</td>
          </tr>
          <tr>
            <td>9</td>
            <td>Hop limit exceeded.</td>
          </tr>
          <tr>
            <td>10</td>
            <td>Traffic pared (e.g., status reports).</td>
          </tr>
          <tr>
            <td>11</td>
            <td>Block unsupported.</td>
          </tr>
          <tr>
           <td>17-254</td>
           <td>Unassigned</td>
          </tr>
          <tr>
            <td>255</td>
            <td>Reserved</td>
          </tr>
            </tbody>
          </table>

          <t>
   The third element of the bundle status report <bcp14>SHALL</bcp14> be the source
   node ID identifying the source of the bundle whose status is being
   reported, represented as described in <xref target="sect-4.2.5.1.1" format="default"/>.</t>
          <t>
   The fourth element of the bundle status report <bcp14>SHALL</bcp14> be the
   creation timestamp of the bundle whose status is being reported,
   represented as described in <xref target="sect-4.2.7" format="default"/>.</t>
          <t>
   The fifth element of the bundle status report <bcp14>SHALL</bcp14> be present if
   and only if the bundle whose status is being reported contained a
   fragment offset.  If present, it <bcp14>SHALL</bcp14> be the subject bundle's
   fragment offset represented as a CBOR unsigned integer item.</t>
          <t>
   The sixth element of the bundle status report <bcp14>SHALL</bcp14> be present if
   and only if the bundle whose status is being reported contained a
   fragment offset.  If present, it <bcp14>SHALL</bcp14> be the length of the subject
   bundle's payload represented as a CBOR unsigned integer item.</t>
          <t>
   Note that the forwarding parameters (such as lifetime, applicable
   security measures, etc.) of the bundle whose status is being
   reported <bcp14>MAY</bcp14> be reflected in the parameters governing the forwarding
   of the bundle that conveys a status report, but this is an
   implementation matter.  Bundle Protocol deployment experience to
   date has not been sufficient to suggest any clear guidance on this
   topic.</t>
        </section>
      </section>
      <section anchor="sect-6.2" numbered="true" toc="default">
        <name>Generation of Administrative Records</name>
        <t>
   Whenever the application agent's administrative element is directed
   by the BPA to generate an administrative record,
        the following procedure must be followed:</t>
        <ol type="Step %d:" indent="9">
        <li>
   The administrative record must be constructed. If the
   administrative record references a bundle and the referenced bundle
   is a fragment, the administrative record <bcp14>MUST</bcp14> contain the fragment
   offset and fragment length.</li>
        <li>
   A request for transmission of a bundle whose payload is this
   administrative record <bcp14>MUST</bcp14> be presented to the BPA.</li>
        </ol>
      </section>
    </section>
    <section anchor="sect-7" numbered="true" toc="default">
      <name>Services Required of the Convergence Layer</name>
      <section anchor="sect-7.1" numbered="true" toc="default">
        <name>The Convergence Layer</name>
        <t>
   The successful operation of the end-to-end Bundle Protocol depends
   on the operation of underlying protocols at what is termed the
   "convergence layer"; these protocols accomplish communication
   between nodes. A wide variety of protocols may serve this purpose,
   so long as each CLA provides a
   defined minimal set of services to the BPA. This
   convergence-layer service specification enumerates those services.</t>
      </section>
      <section anchor="sect-7.2" numbered="true" toc="default">
        <name>Summary of Convergence-Layer Services</name>
        <t>
   Each CLA is expected to provide the
   following services to the BPA:

        </t>
        <ul spacing="normal">
          <li>sending a bundle to a bundle node that is reachable via the
          convergence-layer protocol.</li>
          <li>notifying the BPA of the disposition of its
          data-sending procedures with regard to a bundle, upon concluding
          those procedures.</li>
          <li>delivering to the BPA a bundle that was sent by
          a bundle node via the convergence-layer protocol.</li>
        </ul>
        <t>
   The convergence-layer service interface specified here is neither
   exhaustive nor exclusive. That is, supplementary DTN protocol
   specifications (including, but not restricted to, Bundle Protocol 
   Security <xref target="RFC9172" format="default"/>) may expect CLAs
   that serve BP implementations conforming to those protocols to
   provide additional services such as reporting on the transmission
   and/or reception progress of individual bundles (at completion
   and/or incrementally), retransmitting data that were lost in
   transit, discarding bundle-conveying data units that the
   convergence-layer protocol determines are corrupt or inauthentic, or reporting
   on the integrity and/or authenticity of delivered bundles.</t>
        <t>
   In addition, the Bundle Protocol relies on the capabilities of protocols at the
   convergence layer to minimize congestion in the store-carry-forward overlay
   network.  The potentially long round-trip times characterizing
   delay-tolerant networks are incompatible with end-to-end, reactive
   congestion-control mechanisms, so convergence-layer protocols <bcp14>MUST</bcp14> provide
   rate limiting or congestion control.</t>
      </section>
    </section>
    <section anchor="sect-8" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>
   The Bundle Protocol security architecture and the available security
   services are specified in an accompanying document, the Bundle Protocol Security
   (BPSec) specification <xref target="RFC9172" format="default"/>.  Whenever Bundle
   Protocol security services (as opposed to the security services
   provided by overlying application protocols or underlying
   convergence-layer protocols) are required, those services <bcp14>SHALL</bcp14> be
   provided by BPSec rather than by some other mechanism with the same
   or similar scope.</t>
      <t>
   A Bundle Protocol Agent (BPA) that sources, cryptographically
   verifies, and/or accepts a bundle <bcp14>MUST</bcp14> implement support for BPSec.
   Use of BPSec for any single bundle is optional.</t>
      <t>
   The BPSec extensions to the Bundle Protocol enable each block of a
   bundle (other than a BPSec extension block) to be individually
   authenticated by a signature block (Block Integrity Block, or BIB)
   and also enable each block of a bundle other than the primary block
   (and the BPSec extension blocks themselves) to be individually
   encrypted by a Block Confidentiality Block (BCB).</t>
      <t>
   Because the security mechanisms are extension blocks that are
   themselves inserted into the bundle, the protections they afford
   apply while the bundle is at rest, awaiting transmission at the next
   forwarding opportunity, as well as in transit.</t>
      <t>
   Additionally, convergence-layer protocols that ensure authenticity
   of communication between adjacent nodes in a BP network topology
   <bcp14>SHOULD</bcp14> be used where available, to minimize the ability of
   unauthenticated nodes to introduce inauthentic traffic into the
   network.  Convergence-layer protocols that ensure confidentiality of
   communication between adjacent nodes in a BP network topology <bcp14>SHOULD</bcp14>
   also be used where available, to minimize exposure of the bundle's
   primary block and other cleartext blocks, thereby offering some
   defense against traffic analysis.</t>
      <t>
   In order to provide authenticity and/or confidentiality of
   communication between BP nodes, the convergence-layer protocol
   requires as input the name or names of the expected communication peer(s).
   These must be supplied by the CLA. Details of
   the means by which the CLA determines which CL endpoint name(s) must
   be provided to the CL protocol are out of scope for this
   specification. Note, though, that when the CL endpoint names are a
   function of BP endpoint IDs, the correctness and authenticity of
   that mapping will be vital to the overall security properties that
   the CL provides to the system.</t>
      <t>
   Note that, while the primary block must remain in the clear for
   routing purposes, the Bundle Protocol could be protected against
   traffic analysis to some extent by using bundle-in-bundle
   encapsulation <xref target="I-D.ietf-dtn-bibect" format="default"/> to tunnel bundles to a safe forward
   distribution point: the encapsulated bundle could form the payload
   of an encapsulating bundle, and that payload block could be
   encrypted by a BCB.</t>
      <t>
   Note that the generation of bundle status reports is disabled by
   default because malicious initiation of bundle status reporting
   could result in the transmission of extremely large numbers of
   bundles, effecting a denial-of-service attack.  Imposing bundle
   lifetime overrides would constitute one defense against such an
   attack.</t>
      <t>
   Note also that the reception of large numbers of fragmentary bundles
   with very long lifetimes could constitute a denial-of-service
   attack, occupying storage while pending reassembly that will never
   occur.  Imposing bundle lifetime overrides would, again, constitute
   one defense against such an attack.</t>
      <t>
   This protocol makes use of absolute timestamps for several purposes.
   Provisions are included for nodes without accurate clocks to retain
   most of the protocol functionality, but nodes that are unaware that
   their clock is inaccurate may exhibit unexpected behavior.</t>
    </section>
    <section anchor="sect-9" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <t>
   The Bundle Protocol includes fields requiring registries managed by
   IANA.</t>
      <section anchor="sect-9.1" numbered="true" toc="default">
        <name>Bundle Block Types</name>
        <t>
   The "Bundle Block Types" subregistry in the "Bundle Protocol"
   registry has been augmented by adding a column identifying the version of
   the Bundle Protocol (Bundle Protocol Version) that applies to the
   values.  IANA has added the following values, as
   described in <xref target="sect-4.3.1"/>, to the "Bundle Block Types" registry
   with a value of "7" for the Bundle Protocol Version. IANA
   has set the Bundle Protocol Version to "6" or "6,7" for 
   preexisting values in the "Bundle Block Types" registry,
   as shown below.</t>
   <table align="left">
    <name>"Bundle Block Types" Registry</name>
     <thead>
       <tr>
         <th>Bundle Protocol Version</th>
         <th>Value</th>
         <th>Description</th>
         <th>Reference</th>
       </tr>
     </thead>
     <tbody>
       <tr>
           <td>none</td>
         <td>0</td>
         <td>Reserved</td>
         <td><xref target="RFC6255"/></td>
       </tr>
       <tr>
         
         <td>6,7</td>
         <td>1</td>
           <td>Bundle Payload Block</td>
           <td><xref target="RFC5050"/> [RFC9171]</td>
       </tr>
       <tr>
         
         <td>6</td>
         <td>2</td>
         <td>Bundle Authentication Block</td>
         <td><xref target="RFC6257"/></td>
       </tr>
       <tr>
         
         <td>6</td>
         <td>3</td>
         <td>Payload Integrity Block</td>
         <td><xref target="RFC6257"/></td>
       </tr>
       <tr>
         
         <td>6</td><td>4</td>
         <td>Payload Confidentiality Block</td>
         <td><xref target="RFC6257"/></td>
       </tr>
         <tr>
           
           <td>6</td>
           <td>5</td>
           <td>Previous-Hop Insertion Block</td>
           <td><xref target="RFC6259"/></td>
         </tr>
         <tr>
           
           <td>7</td>
           <td>6</td>
           <td>Previous node (proximate sender)</td>
           <td>[RFC9171]</td>
         </tr>
         <tr>
           
           
           <td>7</td>
           <td>7</td>
           <td>Bundle age (in milliseconds)</td>
           <td>[RFC9171]</td>
         </tr>
         <tr>
           
           <td>6</td>
           <td>8</td>
           <td>Metadata Extension Block</td>
           <td><xref target="RFC6258"/></td>
         </tr>
         <tr>
           
           <td>6</td>
           <td>9</td>
           <td>Extension Security Block</td>
           <td><xref target="RFC6257"/></td>
         </tr>
         <tr>
           
           <td>7</td>
           <td>10</td>
           <td>Hop count (#prior xmit attempts)</td>
           <td>[RFC9171]</td>
         </tr>
         <tr>
           <td>7</td>
           <td>11-191</td>
           <td>Unassigned</td>
           <td></td>
         </tr>
         <tr>
           
           <td>6,7</td>
           <td>192-255</td>
           <td>Reserved for Private and/or Experimental Use</td>
           <td><xref target="RFC5050"/> [RFC9171]</td>
         </tr>

     </tbody>
</table>
      </section>
      <section anchor="sect-9.2" numbered="true" toc="default">
        <name>Primary Bundle Protocol Version</name>
        <t>
   IANA has added the following value to the "Primary Bundle
   Protocol Version" subregistry in the "Bundle Protocol" registry.</t>
   <table align="left">
    <name>"Primary Bundle Protocol Version" Registry</name>
     <thead>
       <tr>
         <th>Value</th>
         <th>Description</th>
         <th>Reference</th>
       </tr>
     </thead>
     <tbody>
       <tr>
         <td>7</td>
         <td>Assigned</td>
         <td>[RFC9171]</td>
       </tr>
     </tbody>
   </table>
        <t> Values 8-255 (rather than 7-255) are now Unassigned.</t>
      </section>
      <section anchor="sect-9.3" numbered="true" toc="default">
        <name>Bundle Processing Control Flags</name>
        <t>
   The "Bundle Processing Control Flags" subregistry in the "Bundle
   Protocol" registry has been augmented by adding a column identifying the
   version of the Bundle Protocol (Bundle Protocol Version) that
   applies to the new values.  IANA has added the following
   values, as described in <xref target="sect-4.2.3"/>, to the "Bundle Processing
   Control Flags" registry with a value of "7" for the Bundle Protocol Version.
 IANA has set the Bundle Protocol Version to the value "6" or "6,7" for preexisting values in the "Bundle Processing
   Control Flags" registry, as shown below.</t> 
        <table align="left">
          <name>"Bundle Processing Control Flags" Registry</name>
          <thead>
            <tr>
              <th>Bundle Protocol Version</th>
              <th>Bit Position (right to left)</th>
              <th>Description</th>
              <th>Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>6,7</td>
              <td>0</td>
              <td>Bundle is a fragment</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>1</td>
              <td>ADU is an administrative record</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>2</td>
              <td>Bundle must not be fragmented</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6</td>
              <td>3</td>
              <td>Custody transfer is requested</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>
              <td>6</td>
              <td>4</td>
              <td>Destination endpoint is a singleton</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>
              <td>6,7</td>
              <td>5</td>
              <td>Acknowledgement by application is requested</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>7</td>
              <td>6</td>
              <td>Status time requested in reports</td>
              <td>[RFC9171]</td>
              </tr><tr>
              <td>6</td>
              <td>7-8</td>
              <td>Class of service: priority</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>
              <td>6</td>
              <td>9-13</td>
              <td>Class of service: reserved</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>
              <td>6,7</td>
              <td>14</td>
              <td>Request reporting of bundle reception</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6</td>
              <td>15</td>
              <td>Request reporting of custody acceptance</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>
              <td>6,7</td>
              <td>16</td>
              <td>Request reporting of bundle forwarding</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>17</td>
              <td>Request reporting of bundle delivery</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>18</td>
              <td>Request reporting of bundle deletion</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>19</td>
              <td>Reserved</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td>6,7</td>
              <td>20</td>
              <td>Reserved</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>
              <td></td>
              <td>21-63</td>
              <td>Unassigned</td>
              <td></td>
            </tr>
 </tbody>
        </table>
      </section>
      <section anchor="sect-9.4" numbered="true" toc="default">
        <name>Block Processing Control Flags</name>
        <t>
   The "Block Processing Control Flags" subregistry in the "Bundle
   Protocol" registry has been augmented by adding a column identifying the
   version of the Bundle Protocol (Bundle Protocol Version) that
   applies to the related BP version.  IANA has set the Bundle Protocol 
   Version to the value "6" or "6,7" for preexisting values in the "Bundle Processing
   Control Flags" registry, as shown below.</t>

   <table align="left">
          <name>"Block Processing Control Flags" Registry</name>
          <thead>
            <tr>
              <th>Bundle Protocol Version</th>
              <th><t>Bit Position (right to left)</t></th>
              <th>Description</th>
              <th>Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>

              <td>6,7</td>
              <td>0</td>
              <td>Block must be replicated in every fragment</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>1</td>
              <td>Transmit status report if block  can't be processed</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>2</td>
              <td>Delete bundle if block can't be processed</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6</td>
              <td>3</td>
              <td>Last block</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>

              <td>6,7</td>
              <td>4</td>
              <td>Discard block if it can't be processed</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6</td>
              <td>5</td>
              <td>Block was forwarded without being processed</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>

              <td>6</td>
              <td>6</td>
              <td>Block contains an EID-reference field</td>
              <td><xref target="RFC5050"/></td>
              </tr><tr>

              <td></td>
              <td>7-63</td>
              <td>Unassigned</td>
              <td></td>
            </tr>
          </tbody>
             
        </table>
      </section>
      <section anchor="sect-9.5" numbered="true" toc="default">
        <name>Bundle Status Report Reason Codes</name>
        <t>
   The "Bundle Status Report Reason Codes" subregistry in the "Bundle
   Protocol" registry has been augmented by adding a column identifying the
   version of the Bundle Protocol (Bundle Protocol Version) that
   applies to the new values.  IANA has added the following
   values, as described in <xref target="sect-6.1.1"/>, to the "Bundle Status Report
   Reason Codes" registry with a value of "7" for the Bundle Protocol Version.  IANA has set the Bundle Protocol
   Version to the value "6,7" for preexisting values in the "Bundle Status 
   Report Reason Codes" registry, as shown below.</t>
        <table align="left">
          <name>"Bundle Status Report Reason Codes" Registry</name>
          <thead>
            <tr>
              <th>Bundle Protocol Version</th>
              <th>Value</th>
              <th>Description</th>
              <th>Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>6,7</td>
              <td>0</td>
              <td>No additional information</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>1</td>
              <td>Lifetime expired</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>2</td>
              <td>Forwarded over unidirectional link</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>3</td>
              <td>Transmission canceled</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>4</td>
              <td>Depleted storage</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>


              <td>6,7</td>
              <td>5</td>
              <td>Destination endpoint ID unavailable</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>6</td>
              <td>No known route to destination from here</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>7</td>
              <td>No timely contact with next node on route</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>6,7</td>
              <td>8</td>
              <td>Block unintelligible</td>
              <td><xref target="RFC5050"/> [RFC9171]</td>
              </tr><tr>

              <td>7</td>
              <td>9</td>
              <td>Hop limit exceeded</td>
              <td>[RFC9171]</td>
              </tr><tr>

              <td>7</td>
              <td>10</td>
              <td>Traffic pared</td>
              <td>[RFC9171]</td>
              </tr><tr>

              <td>7</td>
              <td>11</td>
              <td>Block unsupported</td>
              <td>[RFC9171]</td>
              </tr><tr>

              <td></td>
              <td>17-254</td>
              <td>Unassigned</td>
              <td></td>
              </tr><tr>

              <td>6,7</td>
              <td>255</td>
              <td>Reserved</td>
              <td><xref target="RFC6255"/> [RFC9171]</td>
              </tr>
          </tbody>
        </table>
      </section>
      <section anchor="sect-9.6" numbered="true" toc="default">
        <name>Bundle Protocol URI Scheme Types</name>
        <t>
   The Bundle Protocol has a URI scheme type field -- an unsigned
   integer of indefinite length -- for which IANA has created,
   and will maintain, a new "Bundle Protocol URI Scheme Types" subregistry in the
   "Bundle Protocol" registry.  The "Bundle Protocol URI Scheme Types"
   registry governs a namespace of unsigned integers.  Initial values for
   the "Bundle Protocol URI Scheme Types" registry are given below.</t>
        <t>
   The registration policy for this registry is Standards Action <xref target="RFC8126"/>. The
   allocation should only be granted for a Standards Track RFC approved
   by the IESG.</t>
        <t>
   The range of values is provided as unsigned integers.</t>
        <t>
   Each assignment consists of a URI scheme type name and its
   associated description, a reference to the document that defines the
   URI scheme, and a reference to the document that defines the use of
   this URI scheme in BP endpoint IDs (including the CBOR
   encoding of those endpoint IDs in transmitted bundles).</t>
        <table align="left">
          <name>"Bundle Protocol URI Scheme Types" Registry</name>
          <thead>
            <tr>
              <th>Value</th>
              <th>Description</th>
              <th>BP Utilization Reference</th>
              <th>URI Definition Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0</td>
              <td>Reserved</td>
              <td>n/a</td>
              <td></td>
              </tr>
            <tr>
              <td>1</td>
              <td>dtn</td>
              <td>[RFC9171]</td>
              <td>[RFC9171]</td>
              </tr>
            <tr>
              <td>2</td>
              <td>ipn</td>
              <td>[RFC9171]</td>
              <td><xref target="RFC6260"/> [RFC9171]</td>
              </tr>
            <tr>
              <td>3-254</td>
              <td>Unassigned</td>
              <td>n/a</td>
              <td></td>
              </tr>
            <tr>
              <td>255-65535</td>
              <td>Reserved</td>
              <td>n/a</td>
              <td></td>
              </tr>
            <tr>
              <td>&gt;65535</td>
              <td>Reserved for Private Use</td>
              <td>n/a</td>
              <td></td>
              </tr>
          </tbody>
        </table>
      </section>
      <section anchor="sect-9.7" numbered="true" toc="default">
        <name>dtn URI Scheme</name>
        <t>
   In the "Uniform Resource Identifier (URI) Schemes" (uri-schemes)
   registry, IANA has updated the registration of the URI
   scheme with the string "dtn" as the scheme name, as follows:</t>
        <dl>
        <dt>URI scheme name:</dt>
          <dd>"dtn"</dd>
        <dt>Status:</dt>
          <dd>Permanent</dd>
        <dt>Applications and/or protocols that use this URI scheme name:</dt>
          <dd>The Delay-Tolerant Networking (DTN) Bundle Protocol (BP).</dd>
        <dt>Contact:</dt>
          <dd><t><contact fullname="Scott Burleigh"/>
          &lt;sburleig.sb@gmail.com&gt;</t>
          </dd>
        <dt>Change controller:</dt>
          <dd>IETF (iesg@ietf.org)</dd>
        <dt>Reference:</dt>
          <dd>[RFC9171]</dd>
        </dl>

      </section>
      <section anchor="sect-9.8" numbered="true" toc="default">
        <name>ipn URI Scheme</name>
        <t>
   In the "Uniform Resource Identifier (URI) Schemes" (uri-schemes)
   registry, IANA has updated the registration of the URI
   scheme with the string "ipn" as the scheme name, originally
   documented in RFC 6260 <xref target="RFC6260" format="default"/>, as follows.</t>
        <dl>
        <dt>URI scheme name:</dt>
          <dd>"ipn"</dd>
        <dt>Status:</dt>
          <dd>Permanent</dd>
        <dt>Applications and/or protocols that use this URI scheme name:</dt>
          <dd>The Delay-Tolerant Networking (DTN) Bundle Protocol (BP).</dd>
        <dt>Contact:</dt>
          <dd><t><contact fullname="Scott Burleigh"/>
          &lt;sburleig.sb@gmail.com&gt;</t>
          </dd>
        <dt>Change controller:</dt>
          <dd>IETF (iesg@ietf.org)</dd>
        <dt>Reference:</dt>
          <dd>[RFC9171]</dd>
        </dl>
      </section>
    </section>
  </middle>
  <back>
   
<displayreference target="RFC3986" to="URI"/>
<displayreference target="RFC4838" to="ARCH"/>
<displayreference target="RFC7595" to="URIREG"/>
<displayreference target="RFC9172" to="BPSEC"/>
<displayreference target="RFC9174" to="TCPCL"/>
<displayreference target="I-D.ietf-dtn-bibect" to="BIBE"/>

 <references>
      <name>References</name>
      <references>
        <name>Normative References</name>

<!-- draft-ietf-dtn-bpsec ([BPSEC] per orig.; RFC 9172) -->
<reference anchor='RFC9172' target="https://www.rfc-editor.org/info/rfc9172">
   <front>
      <title>Bundle Protocol Security (BPSec)</title>
      <author initials='E' surname='Birrane, III' fullname='Edward J. Birrane, III'>
         <organization />
      </author>
      <author initials='K' surname='McKeever' fullname='Kenneth McKeever'>
         <organization />
      </author>
      <date month='January' year='2022' />
   </front>
   <seriesInfo name="RFC" value="9172"/>
   <seriesInfo name="DOI" value="10.17487/RFC9172"/>
</reference>

<reference anchor="CRC16" target="https://www.itu.int/rec/T-REC-X.25-199610-I/">
   <front> 
   <title>X.25: Interface between Data Terminal Equipment (DTE) and Data Circuit-terminating Equipment (DCE) for terminals operating in the packet mode and connected to public data networks by dedicated circuit</title>
      <author>
          <organization>ITU-T</organization>
      </author> 
      <date month="October" year="1996"/> 
   </front>
   <seriesInfo name="ITU-T Recommendation" value="X.25"/>
   <refcontent>p. 9, Section 2.2.7.4</refcontent>
</reference>

        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4960.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5234.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8949.xml"/>

<reference anchor="SABR" target="https://public.ccsds.org/Pubs/734x3b1.pdf">
   <front> 
      <title>Schedule-Aware Bundle Routing</title> 
      <author>
          <organization>Consultative Committee for Space Data Systems</organization>
      </author> 
      <date month="July" year="2019"/> 
   </front> 
   <seriesInfo name="CCSDS Recommended Standard" value="734.3-B-1"/> 
</reference>

<!-- draft-ietf-dtn-tcpclv4 ([TCPCL] per orig.; RFC 9174) -->
<reference anchor='RFC9174' target="https://www.rfc-editor.org/info/rfc9174">
   <front>
      <title>Delay-Tolerant Networking TCP Convergence-Layer Protocol Version 4</title>
      <author initials='B' surname='Sipos' fullname='Brian Sipos'>
         <organization />
      </author>
      <author initials='M' surname='Demmer' fullname='Michael Demmer'>
         <organization />
      </author>
      <author initials='J' surname='Ott' fullname='Jörg Ott'>
         <organization />
      </author>
      <author initials='S' surname='Perreault' fullname='Simon Perreault'>
         <organization />
      </author>
      <date month='January' year='2022' />
   </front>
   <seriesInfo name="RFC" value="9174"/>
   <seriesInfo name="DOI" value="10.17487/RFC9174"/>
</reference>

        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3986.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7595.xml"/>
      </references>
      <references>
        <name>Informative References</name>

<!-- draft-ietf-dtn-bibect ([BIBE]; Expired) -->
        <xi:include href="https://datatracker.ietf.org/doc/bibxml3/reference.I-D.ietf-dtn-bibect.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.3987.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.4838.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.5050.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6255.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6257.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6258.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6259.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6260.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7143.xml"/>
        <xi:include href="https://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.8126.xml"/>

<reference anchor="SIGC" target="https://dl.acm.org/doi/10.1145/863955.863960">
    <front>
        <title>A Delay-Tolerant Network Architecture for Challenged Internets</title>
        <author initials="K" surname="Fall" fullname="Kevin Fall">
            <organization></organization>
        </author>
        <date month="August" year="2003"/>
    </front>
    <seriesInfo name="DOI" value="10.1145/863955.863960"/>
    <refcontent>SIGCOMM 2003</refcontent>
</reference>

        </references>
    </references>
    <section anchor="app-a" numbered="true" toc="default">
      <name>Significant Changes from RFC 5050</name>
      <t>
This document makes the following significant changes from RFC 5050:
      </t>
      <ul spacing="normal">
        <li>Clarifies the difference between transmission and forwarding.</li>
        <li>Migrates custody transfer to the bundle-in-bundle encapsulation
          specification <xref target="I-D.ietf-dtn-bibect" format="default"/>.</li>
        <li>Introduces the concept of "node ID" as functionally distinct from
          endpoint ID, while having the same syntax.</li>
        <li>Restructures primary block, making it immutable.  Adds optional
          CRC.</li>
        <li>Adds optional CRCs to non-primary blocks.</li>
        <li>Adds block ID number to canonical block format (to support
          BPSec).</li>
        <li>Adds definition of Bundle Age extension block.</li>
        <li>Adds definition of Previous Node extension block.</li>
        <li>Adds definition of Hop Count extension block.</li>
        <li>Removes Quality of Service markings.</li>
        <li>Changes from Self-Delimiting Numeric Values (SDNVs) to CBOR encoding.</li>
        <li>Adds lifetime overrides.</li>
        <li>Clarifies that time values are denominated in milliseconds, not seconds.</li>
      </ul>
    </section>
    <section anchor="app-c" numbered="true" toc="default">
      <name>CDDL Expression</name>
      <t>
   For informational purposes, Carsten Bormann and Brian Sipos have
   kindly provided an expression of the Bundle Protocol specification
   in the Concise Data Definition Language (CDDL).  That CDDL
   expression is presented below.  Note that wherever the CDDL
   expression is in disagreement with the textual representation of the
   BP specification presented in the earlier sections of this document,
   the textual representation rules.</t>
      <sourcecode type="cddl"><![CDATA[
   bpv7_start = bundle / #6.55799(bundle)

   ; Times before 2000 are invalid

   dtn-time = uint

   ; CRC enumerated type

   crc-type = &(

     crc-none: 0,

     crc-16bit: 1,

     crc-32bit: 2

   )

   ; Either 16-bit or 32-bit

   crc-value = (bstr .size 2) / (bstr .size 4)

   creation-timestamp = [

     dtn-time, ; absolute time of creation

     sequence: uint ; sequence within the time

   ]

   eid = $eid .within eid-structure

   eid-structure = [

     uri-code: uint,

     SSP: any

   ]

   $eid /= [

     uri-code: 1,

     SSP: (tstr / 0)

   ]

   $eid /= [

     uri-code: 2,

     SSP: [

       nodenum: uint,

       servicenum: uint

     ]

   ]

   ; The root bundle array

   bundle = [primary-block, *extension-block, payload-block]

   primary-block = [

     version: 7,

     bundle-control-flags,

     crc-type,

     destination: eid,

     source-node: eid,

     report-to: eid,

     creation-timestamp,

     lifetime: uint,

     ? (

       fragment-offset: uint,

       total-application-data-length: uint

     ),

     ? crc-value,

   ]

   bundle-control-flags = uint .bits bundleflagbits

   bundleflagbits = &(

     reserved: 20,

     reserved: 19,

     bundle-deletion-status-reports-are-requested: 18,

     bundle-delivery-status-reports-are-requested: 17,

     bundle-forwarding-status-reports-are-requested: 16,

     reserved: 15,

     bundle-reception-status-reports-are-requested: 14,

     reserved: 13,

     reserved: 12,

     reserved: 11,

     reserved: 10,

     reserved: 9,

     reserved: 8,

     reserved: 7,

     status-time-is-requested-in-all-status-reports: 6,

     user-application-acknowledgement-is-requested: 5,

     reserved: 4,

     reserved: 3,

     bundle-must-not-be-fragmented: 2,

     payload-is-an-administrative-record: 1,

     bundle-is-a-fragment: 0

   )

   ; Abstract shared structure of all non-primary blocks

   canonical-block-structure = [

     block-type-code: uint,

     block-number: uint,

     block-control-flags,

     crc-type,

     ; Each block type defines the content within the byte string

     block-type-specific-data,

     ? crc-value

   ]

   block-control-flags = uint .bits blockflagbits

   blockflagbits = &(

     reserved: 7,

     reserved: 6,

     reserved: 5,

     block-must-be-removed-from-bundle-if-it-cannot-be-processed: 4,

     reserved: 3,

     bundle-must-be-deleted-if-block-cannot-be-processed: 2,

     status-report-must-be-transmitted-if-block-cannot-be-processed:
     1,

     block-must-be-replicated-in-every-fragment: 0

   )

   block-type-specific-data = bstr / #6.24(bstr)

   ; Actual CBOR data embedded in a byte string, with optional tag to
   indicate so.

   ; Additional plain bstr allows ciphertext data.

   embedded-cbor<Item> = (bstr .cbor Item) / #6.24(bstr .cbor Item) /
   bstr

   ; Extension block type, which does not specialize other than the
   code/number

   extension-block =
   $extension-block .within canonical-block-structure

   ; Generic shared structure of all non-primary blocks

   extension-block-use<CodeValue, BlockData> = [

     block-type-code: CodeValue,

     block-number: (uint .gt 1),

     block-control-flags,

     crc-type,

     BlockData,

     ? crc-value

   ]

   ; Payload block type

   payload-block = payload-block-structure .within canonical-block-
   structure

   payload-block-structure = [

     block-type-code: 1,

     block-number: 1,

     block-control-flags,

     crc-type,

     $payload-block-data,

     ? crc-value

   ]

   ; Arbitrary payload data, including non-CBOR byte string

   $payload-block-data /= block-type-specific-data

   ; Administrative record as a payload data specialization

   $payload-block-data /= embedded-cbor<admin-record>

   admin-record = $admin-record .within admin-record-structure

   admin-record-structure = [

     record-type-code: uint,

     record-content: any

   ]

   ; Only one defined record type

   $admin-record /= [1, status-record-content]

   status-record-content = [

     bundle-status-information,

     status-report-reason-code: uint,

     source-node-eid: eid,

     subject-creation-timestamp: creation-timestamp,

     ? (

       subject-payload-offset: uint,

       subject-payload-length: uint

     )

   ]

   bundle-status-information = [

     reporting-node-received-bundle: status-info-content,

     reporting-node-forwarded-bundle: status-info-content,

     reporting-node-delivered-bundle: status-info-content,

     reporting-node-deleted-bundle: status-info-content

   ]

   status-info-content = [

     status-indicator: bool,

     ? timestamp: dtn-time

   ]

   ; Previous Node extension block

   $extension-block /=

     extension-block-use<6, embedded-cbor<ext-data-previous-node>>

   ext-data-previous-node = eid

   ; Bundle Age extension block

   $extension-block /=

     extension-block-use<7, embedded-cbor<ext-data-bundle-age>>

   ext-data-bundle-age = uint

   ; Hop Count extension block

   $extension-block /=

     extension-block-use<10, embedded-cbor<ext-data-hop-count>>

   ext-data-hop-count = [

     hop-limit: uint,

     hop-count: uint

   ]
]]></sourcecode>
    </section>

    <section anchor="acks-section" numbered="false" toc="default">
      <name>Acknowledgments</name>
      <t>
   This work is freely adapted from RFC 5050, which was an effort of
   the Delay-Tolerant Networking Research Group. The following DTNRG
   participants contributed significant technical material and/or
   inputs to that document: <contact fullname="Dr. Vinton Cerf"/> of Google;
   <contact fullname="Scott Burleigh"/>, <contact fullname="Adrian Hooke"/>, and
   <contact fullname="Leigh Torgerson"/> of the Jet Propulsion Laboratory;
   <contact fullname="Michael Demmer"/> of the University of California at Berkeley;
   <contact fullname="Robert Durst"/>, <contact fullname="Keith Scott"/>, and
   <contact fullname="Susan Symington"/> of The MITRE Corporation;
   <contact fullname="Kevin Fall"/> of Carnegie Mellon University;
   <contact fullname="Stephen Farrell"/> of Trinity College Dublin;
   <contact fullname="Howard Weiss"/> and <contact fullname="Peter Lovell"/> of
   SPARTA, Inc.;
   and <contact fullname="Manikantan Ramadas"/> of Ohio University.</t>
   <t>Scott Burleigh would like to thank the Jet Propulsion Laboratory, California Institute of Technology, for its generous and sustained support of this work.</t>
    </section>
  </back>
</rfc>
