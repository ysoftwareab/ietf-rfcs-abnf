<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The UP PIO Field: Finding Up in an Unmanaged Network</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Format">
<link href="#rfc.section.3" rel="Chapter" title="3 Use Cases">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Default Route">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Walled Garden ">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 ULA">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Delegated Prefix">
<link href="#rfc.section.4" rel="Chapter" title="4 Implementation">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Host Behavior">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Tie Breaking">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Multiple Paths">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Route Withdrawal">
<link href="#rfc.section.5" rel="Chapter" title="5 Examples">
<link href="#rfc.section.6" rel="Chapter" title="6 Evaluation">
<link href="#rfc.section.7" rel="Chapter" title="7 Additional Work Required">
<link href="#rfc.section.8" rel="Chapter" title="8 Alternatives">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="It is difficult to find a path through an unmanaged network with multiple routers. This document describes a new Prefix Information Option field which can provide information to routers to find a path." />
  <meta name="description" content="It is difficult to find a path through an unmanaged network with multiple routers. This document describes a new Prefix Information Option field which can provide information to routers to find a path." />
  <meta name="keywords" content="UP prefix information" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">L. Howard</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Time Warner Cable</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">November 17, 2011</td>
</tr>
<tr>
<td class="left">Expires: May 20, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The UP PIO Field: Finding Up in an Unmanaged Network<br />
  <span class="filename">draft-howard-up-pio-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>It is difficult to find a path through an unmanaged network with multiple routers. This document describes a new Prefix Information Option field which can provide information to routers to find a path.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 20, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Format</a>
</li>
<li>3.   <a href="#rfc.section.3">Use Cases</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Default Route</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Walled Garden </a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">ULA</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Delegated Prefix</a>
</li>
<li>4.   <a href="#rfc.section.4">Implementation</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Host Behavior</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Tie Breaking</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Multiple Paths</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Route Withdrawal</a>
</li>
<li>5.   <a href="#rfc.section.5">Examples</a>
</li>
<li>6.   <a href="#rfc.section.6">Evaluation</a>
</li>
<li>7.   <a href="#rfc.section.7">Additional Work Required</a>
</li>
<li>8.   <a href="#rfc.section.8">Alternatives</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Introduction" id="Introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This document describes a new Prefix Information Option field to be used in unmanaged networks (such as home networks) to find a path to a given prefix. This PIO field is not intended to replace dynamic routing protocols, and will not find the best path to a given destination, though it can provide useful information to routers.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119<a href="#RFC2119">.</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Format</h1>
<div id="#rfc.figure.1"></div>
<pre>       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |     Type      |    Length     | Prefix Length |L|A|R|U| Rsvd1 |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                         Valid Lifetime                        |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                       Preferred Lifetime                      |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | Distance      |           Reserved2                           |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |                                                               |
      +                                                               +
      |                                                               |
      +                            Prefix                             +
      |                                                               |
      +                                                               +
      |                                                               |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.2.p.1">The use of L and A bits are specified in rfc4861. The use of the R bit is specified in rfc3775.</p>
<p id="rfc.section.2.p.2">This format represents the following changes over those RFCs: </p>

<ul class="empty">
<li>Upstream Prefix (U) 1-bit router address flag. When this UP bit is set to 1, indicates that the prefix was learned, rather than configured.</li>
<li>Rsvd1 Reduced from a 5-bit field to a 4-bit field to account for the addition of the above bit.</li>
<li>Distance An 8-bit metric used to determine distance and prevent loops.</li>
</ul>

<p>The UP bit is used to find a path through an unmanaged network.  When a router learns prefix information from a Router Advertisement with the UP bit sent, the router SHOULD add that prefix to its own RAs. When sending RAs containing the learned prefix, it MUST increment the Distance value by one.</p>
<p></p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Use Cases</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Default Route</h1>
<p id="rfc.section.3.1.p.1">The most common implementation of this field would be the advertisement of a default route, where Prefix Length = 0 and Prefix = 0. An Internet access provider could use Router Advertisements to customer gateways with the UP bit set, and a distance of 0, to indicate the border of the administrative domain and the default gateway for the customer access router. That customer access router, having learned the default gateway, SHOULD add the prefix to its routing table, then SHOULD include this information in its own RAs.  When the router sends RAs including this prefix, it MUST increment the Distance in those RAs to indicate that it is one hop further than the origin or the prefix.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Walled Garden </h1>
<p id="rfc.section.3.2.p.1">For a network provider who does not provide a default route, the UP option can be used to indicate that a prefix is available. For instance, an operator who only wanted traffic for its hosted services on 2001:db8::/32, would send an RA for that prefix to the access gateway, with Distance=0. That gateway SHOULD add the prefix to its routing table, then SHOULD include the prefix in its own RAs, and MUST increment the Distance in those RAs to indicate that it is one hop away from the border.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> ULA</h1>
<p id="rfc.section.3.3.p.1">Unique Local Addresses may be used for a variety of reasons <a href="#RFC6204">[RFC6204]</a>. When a router generates a ULA prefix, it MUST include that prefix in RAs. It SHOULD include the UP option field, with a Distance = 0. When another router learns that prefix, it SHOULD add the prefix to its routing table, then SHOULD include the prefix in its own RAs, and MUST increment the Distance in those RAs to indicate that it is one hop away from the border.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Delegated Prefix</h1>
<p id="rfc.section.3.4.p.1">In home network scenarios, routers are often also DHCPv6 servers.  When a device is a DHCPv6-PD server, and receives a prefix to be used for host address assignments (regardless of setting of M-bit), if that device is also the router for that prefix, that router becomes authoritative for the prefix. "Authoritative for the prefix" is analogous to the notion of the "delegating router" responding to a request from the "requesting router" per <a href="#RFC3633">[RFC3633]</a>. In other words, when a router receives Prefix Delegation, it SHOULD include that prefix in its RAs, and SHOULD set the Distance to 0. Note that other values are possible, but reduce the possible diameter of the network.</p>
<p id="rfc.section.3.4.p.2">Note that in this way, more specific routes may be propagated through the network via Router Advertisements. The longest match rule applies, and establishes the route preference. See Examples section.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Implementation</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Host Behavior</h1>
<p id="rfc.section.4.1.p.1">Hosts use RAs and the PIO to find their next hop, and for address autoconfiguration. Nothing in the use of the UP bit changes these behaviors, though it is possible that hosts will learn multiple prefixes, and might have multiple paths to the same prefix. It is expected that these are harmless. Details of path selection are left to implementers.</p>
<p id="rfc.section.4.1.p.2">A host MAY use the Distance metric to select a better bath for a prefix. A host might learn multiple prefixes from which SLAAC may be used. This is not a new function introduced with the UP bit, and host behavior is expected to be unchanged.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Tie Breaking</h1>
<p id="rfc.section.4.2.p.1">When a router learns the same prefix from two other routers, and both RAs have the same Distance, a tie-breaker mechanism is required.  The tie-breaker could be arbitrary, such as the time the RA was received, or it could be based on (e.g.) the Preferred Lifetime value, the layer 2 link type, or other suitable informationr. Implementers MUST have a tie-breaker rule or rules to resolve all ties.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Multiple Paths</h1>
<p id="rfc.section.4.3.p.1">A router receiving multiple RAs for the same prefix may choose to discard the path not chosen, or may add the route to its routing table with a higher Administrative Distance.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Route Withdrawal</h1>
<p id="rfc.section.4.4.p.1">As with other RAs, when an RA is received from a router with no information for a prefix, even if that router had previously provided prefix information, the receiver SHOULD remove references to that prefix from its routing table. Similarly, if no RAs are received from a router, the prefix SHOULD be removed. Further, it SHOULD send RAs without that prefix.</p>
<p id="rfc.section.4.4.p.2">When the Valid Lifetime has passed, the route MUST be removed. When the Preferred Lifetime has passed, the route MAY be lowered in preference.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Examples" id="Examples">Examples</a>
</h1>
<p id="rfc.section.5.p.1">Consider the example in Figure 1, in which a network has two upstream ISPs, ISP A and ISP B. A different router connects to each ISP. Routers A and B connect to their respective upstream ISPs, and a Router C and Router D connect to the same link. Routers C and D share another link, causing a potential loop situation. A Host #1 connects to the shared link between Routers A, B, C, and D. A Host #2 connects to the shared link between Routers C and D.</p>
<div id="#rfc.figure.2"></div>
<pre>   +----+-----+                              +-----+----+    \
   |   ISP A  |                              |   ISP B  |     \
   |          |                              |          |     | Service
   +----+-----+                              +-----+----+     | Provider
        |                                          |          | Network
        |                                          |          / 
        |                                          |         / 
   +----+-----+                              +-----+----+    \
   | Router A |                              | Router B |     \
   |          |                              |          |      |
   +----+-----+                              +-----+----+      |
        |                                          |           | Home
        |                                          |           | Network
    ----+---------------------+--------------------+---        |
        |                     |                    |           |
   +----+-----+          +----+-----+        +-----+----+      |
   |IPv6 Host |          | Router C |        | Router D |      |
   |    #1    |          |          |---+----|          |     /
   +----------+          +----------+   |    +----------+    /
                                        |
                                        |
                                  +-----+----+    
                                  | IPv6 Host|    
                                  |   #2     |    
                                  +-----+----+      
</pre>
<p id="rfc.section.5.p.2">Suppose ISP A and ISP B both provide a default route via Router Advertisements. Further suppose that ISP A delegates (via DHCPv6) the prefix 2001:db8:000a::/48, and ISP B delegates the prefix 2001:db8:0000:00b0::/56.</p>
<p id="rfc.section.5.p.3">Router A sends 0::/0 with UP bit and Distance=1, and sends 2001:db8:a::/48 with UP bit and Distance=0.</p>

<ul class="empty">
<li>Router B receives the RA. It prefers the default route from ISP B, because its Distance=0. It learns prefix 2001:db8:a::/48 and adds it to its routing table.</li>
<li>Router C and Router D receive the RA. They each install the default route and the /48 prefix in their routing tables.</li>
<li>Host #1 might configure an address from the prefix via DHCP or SLAAC.</li>
</ul>
<p id="rfc.section.5.p.4">Router B sends 0::/0 with UP bit and Distance=1, and sends 2001:db8:0:b0::/56 with UP bit and Distance=0.</p>

<ul class="empty">
<li>Router A receives the RA. It prefers the default route from ISP A, because its Distance=0. It learns prefix 2001:db8:b0::/56 and adds it to its routing table.</li>
<li>Router C and Router D receive the RA. They compare the default route to the existing default route. Each applies its tie-breaking rule, and installs the winning route. Suppose they have different methods, and Router C uses the default to Router A, and Router D uses the default to Router B. They each add the /56 prefix to their routing tables.</li>
<li>Host #1 might configure an additional address from the prefix via DHCP or SLAAC. Whether it does is beyond the scope of this document.</li>
</ul>
<p id="rfc.section.5.p.5">Router C sends 0::/0 with UP bit and Distance=2, and sends 2001:db8:a::/48 with UP bit and Distance=2, and sends 2001:db8:0:b0::/56 with UP bit and Distance=2.</p>

<ul class="empty">
<li>Routers A and B receive the RAs, but ignore the duplicate prefixes within them because they already have those prefixes with a shorter Distance.</li>
<li>Router D receives the RA for 0::/0, but already has a route with a lower Distance. Router D receives the RA for 2001:db8:a::/48, but already has a route with a lower Distance (from Router A, where Distance=0). Router D receives the RA for 2001:db8:0:b::/56, but already has a route with a lower Distance (from Router B, where Distance=0).</li>
</ul>
<p id="rfc.section.5.p.6">Router C then receives delegated prefix 2001:db8:a:c::/64. Host #2 gets an address for this prefix, either via SLAAC or DHCP. Router C sends RAs for 2001:db8:a:c::/64 with UP bit and Distance=0. The host also receives RAs for the /64 prefix.</p>

<ul class="empty">
<li>Router D receives the RA for 2001:db8:a:c::/64. It is a longer (more specific prefix) than its previous 2001:db8:a::/48 route, so it adds the more specific to its routing table.</li>
<li>Routers A and B receive the RA for 2001:db8:a:c::/64. It is a longer (more specific prefix) than their previous 2001:db8:a::/48 route, so they add the more specific to its routing table. They will update their own RAs, but Routers C and D already have routes with lower Distance.</li>
<li>If Router A or Router B sends the more-specific prefix to the ISP, the ISP MAY choose to add the route or ignore it if a route preferred by policy exists (for the delegated prefix).</li>
</ul>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Evaluation</h1>
<p id="rfc.section.6.p.1">Here follows an evaluation of whether this solution meets all of the Homenet routing requirements.</p>

<ul class="empty">
<li>Can Host #1 reach Host #2? Yes, via a path through either router.</li>
<li>Is the network border clear? Yes, as Distance=0 for the shortest prefix.</li>
<li>Can it handle a router being added? Yes, the new router will learn prefixes via RAs quickly.</li>
<li>Can it handle a router being moved? Yes, with some delay in relearning the routes. If Host #2 were a Router E, and it was moved to the shared ABCD link without the router or interface going down long enough for RAs to be missed, it might propagate RAs learned from Routers C and D. It would have a higher Distance for the shorter prefixes (the /0, /48, /56), so neighboring routers would ignore its RAs. If it were two layers deeper in the network, such that it had a Distance=2 for a more-specific, which was better than the Distance previously seen by Routers A and B, neighbors would prefer its RAs. However, it would stop sending those RAs once it stopped receiving them. The router would continue sending RAs for its delegated prefix for as long as it had that prefix; this problem is related to addressing, not routing.</li>
<li>Can it handle a router being removed? Yes. Some routers may install multiple routes; as soon as they miss seeing an RA for a prefix, they will have a back route. Other routers may have to wait until they see a new RA before having a backup path to the prefix.</li>
<li>Will it work in a no-configuration environment? Yes.</li>
<li>Can it support multiple upstream networks? Yes. It does not solve address configuration or source selection issues, but those are not routing problems per se.</li>
<li>Does it work if prefix delegation is not hierarchical? Yes. Each prefix has its own Prefix Information Option, each with its own Distance.</li>
<li>Can another path be found in case of failure? Yes, within a couple of RA intervals.</li>
<li>Does it prevent loops? Yes.</li>
<li>Does it allow for stable prefixes through reboots? Yes, though paths will have to be rediscovered, through the period configured for Router Advertisement transmissions.</li>
<li>Is it lightweight/cheap? Yes. A simple addition to the PIO, which already exists. Some additional routing decision-tree logic is required for comparing best paths, tie-breaking among equal paths, etc.</li>
<li>Can it handle multiple-dwelling units, or other potentially dense networks? Each upstream router will increment Distance, so each router should choose the shortest upstream path. However, a host with no router could end up choosing a neighbor's router instead of their ISP. The solution is no chattier than existing RAs.</li>
<li>Can it stand up to wireless networks, and networks with wired and wireless segments? Yes, with consideration for multiple-dwelling units.</li>
<li>Can it stand up to unintentional connections of networks? Yes.  Although the Distance would seem to limit the diameter of the network to 255 segments, when each router is given a subnet prefix, it resets the Distance to 0 for its prefix. Thus, the Diameter is a wide as prefix topology allows.</li>
</ul>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Additional Work Required</h1>
<p id="rfc.section.7.p.1">This option essentially overloads the PIO to be a lightweight distance-vector routing protocol of sorts. As such, it needs to avoid the problems of distance-vector protocols, such as the count-to-infinity problem. Several possibilities exist to mitigate this problem:</p>

<ul class="empty">
<li>Use a smaller possible infinity (i.e., change the Distance field to be a 4-bit field)</li>
<li>Shorten the RA transmission intervals</li>
<li>Split horizon (do not advertise a prefix out the interface it was learned) with poison reverse (when a neighbor is lost, send an RA with Distance=255) could be used</li>
</ul>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Alternatives</h1>
<p id="rfc.section.8.p.1">An extension of rfc4191, Default Router Preferences and More-Specific Routes, with its definition of a Route Information Option, might be a closer approximation to the distance-vector protocol described here.</p>
<p id="rfc.section.8.p.2">A link-state protocol would solve standard problems with distance-vector protocols. However, most link-state protocols are much heavier implementations.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Security Considerations</h1>
<p id="rfc.section.9.p.1">By using unsecured Router Advertisements, attacks that compromise RAs would have an extended effect. Use of SeND should mitigate these attacks.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> IANA Considerations</h1>
<p id="rfc.section.10.p.1">There are no IANA considerations or implications that arise from this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Key words for use in RFCs to Indicate Requirement Levels</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="RFC3775">[RFC3775]</b></td>
<td class="top">
<a>Mobility Support in IPv6</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="RFC2461">[RFC2461]</b></td>
<td class="top">
<a>Neighbor Discovery for IP Version 6 (IPv6)</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Neighbor Discovery for IP version 6 (IPv6)</a>", .</td>, "</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3633">[RFC3633]</b></td>
<td class="top">
<a>IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="RFC6204">[RFC6204]</b></td>
<td class="top">
<a>Cisco Systems, Inc.</a><a>Cisco Systems, Inc.</a><a>CableLabs</a><a>AT&amp;T</a><a>Cisco Systems, Inc.</a>, "<a>Basic Requirements for IPv6 Customer Edge Routers</a>", .</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Lee Howard</span> 
	  <span class="n hidden">
		<span class="family-name">Howard</span>
	  </span>
	</span>
	<span class="org vcardline">Time Warner Cable</span>
	<span class="adr">
	  <span>13820 Sunrise Valley Drive</span>

	  <span class="vcardline">
		<span class="locality">Herndon</span>,  
		<span class="region">VA</span> 
		<span class="code">20171</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 703 345 3513</span>

<span class="vcardline">EMail: <a href="mailto:lee.howard@twcable.com">lee.howard@twcable.com</a></span>

  </address>
</div>

</body>
</html>