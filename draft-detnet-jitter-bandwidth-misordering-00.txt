



DeNet WG                                                         L. Chen
Internet-Draft                                                   S. Qian
Intended status: Standards Track                                     SEU
Expires: November 7, 2019                                          T. Ao
                                                                     ZTE
                                                             May 6, 2019


  DetNet Packet Jitter, Bandwidth and Misordering Passive Performance
                              Measurement
              draft-detnet-jitter-bandwidth-misordering-00

Abstract

   Deterministic Networking (DetNet) can provide data transmission with
   end-to-end bounded latency and extremely low packet loss for user's
   services.  In order to better control and manage deterministic
   network services.  It is necessary to measure and monitor DetNet QoS
   information.  As introduced in [I-D.chen-detnet-loss-delay], packet
   loss rates and end-to-end delay can be measured by using passive
   Performance Measurement (PM) in MPLS-based DetNet encapsulation.

   This document implement three new QoS related attribute to support
   passive Performance Measurement for DetNet service.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 7, 2019.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.





Chen, et al.            Expires November 7, 2019                [Page 1]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
     1.2.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  DetNet Control Word based PM  . . . . . . . . . . . . . . . .   3
     2.1.  Jitter  . . . . . . . . . . . . . . . . . . . . . . . . .   4
     2.2.  Used Bandwidth  . . . . . . . . . . . . . . . . . . . . .   5
     2.3.  Misordering packets . . . . . . . . . . . . . . . . . . .   6
   3.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   5.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   7
   6.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   7
     6.1.  Informative References  . . . . . . . . . . . . . . . . .   7
     6.2.  Normative References  . . . . . . . . . . . . . . . . . .   7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   8

1.  Introduction

   As defined in [I-D.ietf-detnet-architecture], DetNet can provide data
   transmission with end-to-end bounded latency and extremely low packet
   loss for user's services.  In order to ensure the efficiency and
   accuracy of information collection and management, it is necessary to
   measure and monitor DetNet QoS information.

   DetNet QoS information includes minimum and maximum delay, bounded
   jitter, packet loss ratio and an upper bound on misordering packet in
   general.  Apart from this, link bandwidth information also play an
   important role in resource allocation.

   As introduced in [I-D.chen-detnet-loss-delay], packet loss rates and
   end-to-end delay can be measured by using passive Performance
   Measurement (PM) in MPLS-based DetNet encapsulation.  Which defines
   two new flags in the d-CW(control word) and three new TLVs to LM and
   DM messages.






Chen, et al.            Expires November 7, 2019                [Page 2]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   Inspird by that, we implement protocol mechanisms to support passive
   Performance Measurement for bounded jitter, misordering packet and
   used bandwidth.

1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

1.2.  Terminology

   The terminology is defined as [I-D.ietf-detnet-architecture],
   [RFC3270], [RFC6374], [RFC2475] and [RFC2474].

2.  DetNet Control Word based PM

   MPLS-based DetNet encapsulation introduces an S-Lable and a d-CW.
   Meanwhile [I-D.chen-detnet-loss-delay] document defines two new flags
   in the d-CW.  Here this document defines a new flag in the d-CW(as
   shown in Figure 1).  The B bit is defined to indicate whether the
   bandwidth measurement is enabled.


           +-----------------+
           ~  IP/MPLS Tunnel ~
           +-----------------+ <--\
           |  Service Label  |    |
           +-----------------+    +-- Service Layer Header
      +----|  Control Word   |    |
      |    +-----------------+ <--/
      |    |     Payload     |
      |    +-----------------+
      |
      |    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      +--->|0 0 0 0|L|D|B|               Sequence Number               |
           +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Figure 1: DetNet Control Word


   where:

   o  L bit: Loss measurement indicator; 1 means the loss measurement is
      enabled, otherwise the loss measurement is not enabled.

   o  D bit: Delay measurement indicator; 1 means the delay measurement
      is enabled, otherwise the delay measurement is not enabled.  When



Chen, et al.            Expires November 7, 2019                [Page 3]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


      a node receive a packet with D bit set, it will timestamp the
      packet and copy it for further PM processing.

   o  B bit: Bandwidth measurement indicator; 1 means the bandwidth
      measurement is enabled, otherwise the bandwidth measurement is not
      enabled.

   Assume a DetNet service path between node A and node B, where node A
   is the ingress node, and node B is the egress node.  The packets with
   same interval number belong to the same measurement interval.

   [Editor notes: The detail of measurement interval and flags in DetNet
   Control Word can be found in [I-D.chen-detnet-loss-delay]]

2.1.  Jitter

   In brief, jitter can be calculated by delay.To measure the delay of a
   packet, the D bit of the d-CW MUST be set.

   If the D bit of the d-CW is set, recording both the flow-id of DetNet
   flow and the node-id of node.

   At the ingress node, record the time when sending the packet, with
   the timestamp indexed by the sequence number.  At the egress node,
   when receiving a packet with D bit set, record the time when the
   packet was received, with the timestamp indexed by the sequence
   number.

   When the measurement interval comes, all the information of node-id,
   flow-id, sequence number and timestamps need to be sent to the
   centralized controller.

   The mechanism for sending information to a centralized controller is
   out side the scope of this document.

   After that, the centralized controller can find the sequence number
   and timestamps between adjacent nodes such as AB by flow-id and node-
   id.

   Then, with the timestamps from the ingress and egress nodes, and the
   sequence number, the packet delay can be calculated as below.

   Delay[n] = B_RxT[n] - A_TxT[n], where:

   o  B_RxT[n] identifies the timestamp at node B when receiving the No.
      "n" packet;





Chen, et al.            Expires November 7, 2019                [Page 4]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   o  A_TxT[n] identifies the timestamp at node A when sending the No.
      "n" packet;

   After getting multiple sets of Delay[n] informatin, the packet jitter
   in the No. "t" measurement interval can be calculated as below.

   Jitter[t] = Max(Delay[i] - Delay[j]), where:

   o  Delay[i] identifies the No. "i" packet's delay between A and B;

   o  Delay[j] identifies the No. "j" packet's delay between A and B;

2.2.  Used Bandwidth

   To measure the used bandwidth of DetNet flows between A and B, both
   of the D bit and B bit of the d-CW MUST be set.

   If the B and D bit of the d-CW are set, recording both the flow-id of
   DetNet flow and the node-id of node.

   At the ingress node, record the time and accumulate the packet bytes
   when sending the packet, with the timestamp indexed by the sequence
   number.  At the egress node, when receiving a packet with B and D bit
   set, record the time and accumulate the packet bytes when the packet
   was received, with the timestamp indexed by the sequence number.

   When the measurement interval comes, all the information of node-id,
   flow-id, sequence number, timestamps and packet bytes need to be sent
   to the centralized controller.  Then the packet bytes need to be
   reset to zero for next measurement interval.

   After that, the centralized controller can find the sequence number,
   timestamps and packet bytes between adjacent nodes such as AB by
   flow-id and node-id.

   Then, with the timestamps and packet bytes from the ingress and
   egress nodes, and the sequence number, the used bandwidth in No. "t"
   measurement interval can be calculated as below.

   Bandwidth[t] = Max(A_TxB[t], B_RxB[t])*8/Delay [t], where:

   o  Delay [i] identifies the No. "i" packet's delay between A and B,
      the measurement method has been introduced in section 2.1;

   o  B_RxB[n] identifies the total bytes received at node B in the No.
      "n" measurement interval with the same flow-id;





Chen, et al.            Expires November 7, 2019                [Page 5]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   o  A_TxB[n] identifies the total bytes sended at node A in the No.
      "n" measurement interval with the same flow-id;

2.3.  Misordering packets

   Since the measurement of the maximum misordering packets only
   requires the sequence number of the DetNet flows, there is no need to
   additionally add a flag bit to the MPLS control word.  The D bit of
   the d-CW can re reused.

   To measure the maximum misordering packets, the D bit of the d-CW
   MUST be set.

   At the ingress node, record the time when sending the packet, with
   the timestamp indexed by the sequence number.  At the egress node,
   when receiving a packet with D bit set, record the time when the
   packet was received, with the timestamp indexed by the sequence
   number.

   When the measurement interval comes, all the information of node-id,
   flow-id, sequence number and timestamps need to be sent to the
   centralized controller.

   After that, the centralized controller can find the sequence number
   and timestamps between adjacent nodes such as AB by flow-id and node-
   id.

   A packet can be classified as a misordering packet if it has a
   sequence number smaller than its predecessors.

   Specifically, let M DetNet flows, denoted as (S1, . . . ,Sm), be the
   total number of flows sent from node A to B.

   In each flow Si consisting of K packets, we assign to each packet j a
   sequence number aj which is a successive integer from 1 to K in the
   order of the packet emission and so we create the source sequence as
   (a1, . . . ,aK).  Assume an output sequence (b1, . . . , bP) of Si
   observed at the receiving node B, where P <= K be the total number of
   packets received out of the K packets sent.  Due to loss, the amount
   K may less than P.

   The sequence is said to be in order if for any index k (1 <= k <= P)
   holds bk <= bq (0 <= q <= k), else the flow is said to reached at the
   destination midordering, and the packet k is a reordered packet in
   the reordered flow.  The total number of reordered packets in flow Si
   is written as Li.





Chen, et al.            Expires November 7, 2019                [Page 6]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   For example, for the sequence of an arrived reordered flow
   (1,2,3,5,4,7,6,8), there are 2 reordered packets (packet 4 and packet
   6), which leads to L = 2.  Note that in this document reordering does
   not correlate with loss (same as [2][8][9]).  For example, a received
   flow (1,2,3,4,5,6,8) is considered as in order.

3.  Security Considerations

   TBD.

4.  IANA Considerations

   TBD.

5.  Acknowledgements

   TBD.

6.  References

6.1.  Informative References

   [RFC2475]  Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z.,
              and W. Weiss, "An Architecture for Differentiated
              Services", RFC 2475, DOI 10.17487/RFC2475, December 1998,
              <https://www.rfc-editor.org/info/rfc2475>.

6.2.  Normative References

   [I-D.chen-detnet-loss-delay]
              Chen, M. and A. Malis, "DetNet Packet Loss and Delay
              Performance Measurement", draft-chen-detnet-loss-delay-01
              (work in progress), October 2018.

   [I-D.ietf-detnet-architecture]
              Finn, N., Thubert, P., Varga, B., and J. Farkas,
              "Deterministic Networking Architecture", draft-ietf-
              detnet-architecture-12 (work in progress), March 2019.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.








Chen, et al.            Expires November 7, 2019                [Page 7]

Internet-Draft  Packet Jitter, Bandwidth and Misordering        May 2019


   [RFC2474]  Nichols, K., Blake, S., Baker, F., and D. Black,
              "Definition of the Differentiated Services Field (DS
              Field) in the IPv4 and IPv6 Headers", RFC 2474,
              DOI 10.17487/RFC2474, December 1998,
              <https://www.rfc-editor.org/info/rfc2474>.

   [RFC3270]  Le Faucheur, F., Wu, L., Davie, B., Davari, S., Vaananen,
              P., Krishnan, R., Cheval, P., and J. Heinanen, "Multi-
              Protocol Label Switching (MPLS) Support of Differentiated
              Services", RFC 3270, DOI 10.17487/RFC3270, May 2002,
              <https://www.rfc-editor.org/info/rfc3270>.

   [RFC6374]  Frost, D. and S. Bryant, "Packet Loss and Delay
              Measurement for MPLS Networks", RFC 6374,
              DOI 10.17487/RFC6374, September 2011,
              <https://www.rfc-editor.org/info/rfc6374>.

Authors' Addresses

   Liquan Chen
   South-east University
   No.2 Sipailou
   Nanjing, Jiangsu  210096
   PR China

   Email: lqchen@seu.edu.cn


   Sijie Qian
   South-east University
   No.2 Sipailou
   Nanjing, Jiangsu  210096
   PR China

   Email: sijieqian@foxmail.com


   Ting Ao
   ZTE corporation
   No.50 Software Avenue
   Nanjing, Jiangsu  210012
   PR China

   Email: ao.ting@zte.com.cn
   URI:   http://www.zte.com.cn






Chen, et al.            Expires November 7, 2019                [Page 8]
