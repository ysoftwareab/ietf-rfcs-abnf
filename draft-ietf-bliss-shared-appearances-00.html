<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Shared Appearances of a Session Initiation Protocol (SIP)  Address of Record (AOR)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Shared Appearances of a Session Initiation Protocol (SIP)  Address of Record (AOR)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">BLISS</td><td class="header">A. Johnston, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Avaya</td></tr>
<tr><td class="header">Expires: March 29, 2009</td><td class="header">M. Soroushnejad</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">V. Venkataramanan</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Sylantro Systems Corp</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Pepper</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Citel Technologies</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Kumar</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Yahoo Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">September 25, 2008</td></tr>
</table></td></tr></table>
<h1><br />Shared Appearances of a Session Initiation Protocol (SIP)  Address of Record (AOR)<br />draft-ietf-bliss-shared-appearances-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on March 29, 2009.</p>

<h3>Abstract</h3>

<p>
This document describes the requirements and implementation of a group telephony feature commonly known as Bridged Line Appearance (BLA) or Multiple Line Appearance (MLA), or Shared Call/Line Appearance (SCA).  When implemented using the Session Initiation Protocol (SIP), it is referred to as Shared Appearances (SA) of an Address of Record (AOR) since SIP does not have the concept of lines. This feature is commonly offered in the IP Centrex services and IP-PBX offerings and is likely to be implemented on SIP IP telephones and SIP feature servers used in a business environment.  This document lists requirements and compares implementation options for this feature.  Extensions to the SIP dialog event package are proposed.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#anchor3">3.</a>&nbsp;
Usage Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Executive/Assistant Arrangement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
BLA Call Group<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Single Line Extension<br />
<a href="#anchor7">4.</a>&nbsp;
Requirements<br />
<a href="#anchor8">5.</a>&nbsp;
Normative Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.1.</a>&nbsp;
Implementation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.2.</a>&nbsp;
SA Dialog Package Extensions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.2.1.</a>&nbsp;
The &lt;appearance&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.2.</a>&nbsp;
The &lt;exclusive&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.2.3.</a>&nbsp;
The &lt;joined-dialog&gt; element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.3.</a>&nbsp;
Shared Appearance User Agents<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.4.</a>&nbsp;
Appearance Agent<br />
<a href="#anchor16">6.</a>&nbsp;
XML Schema Definition<br />
<a href="#anchor17">7.</a>&nbsp;
User Interface Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.1.</a>&nbsp;
Appearance Number Rendering<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.1.1.</a>&nbsp;
Single Appearance UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.1.2.</a>&nbsp;
Dual Appearance UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">7.1.3.</a>&nbsp;
Shared Appearance UAs with Fixed Appearance Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">7.1.4.</a>&nbsp;
Shared Appearance UAs with Variable Appearance Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">7.2.</a>&nbsp;
Call State Rendering<br />
<a href="#anchor24">8.</a>&nbsp;
Interop with non-SA UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">8.1.</a>&nbsp;
Appearance Assignment<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.2.</a>&nbsp;
Appearance Release<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">8.3.</a>&nbsp;
UAs Supporting Dialog Events but Not SA<br />
<a href="#anchor28">9.</a>&nbsp;
Provisioning Considerations<br />
<a href="#anchor29">10.</a>&nbsp;
Example Message Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">10.1.</a>&nbsp;
Registration and Subscription<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">10.2.</a>&nbsp;
Appearance Selection for Outgoing Call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">10.3.</a>&nbsp;
Taking an Appearance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">10.4.</a>&nbsp;
Appearance Selection for Incoming Call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">10.5.</a>&nbsp;
Appearance Publication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">10.6.</a>&nbsp;
Joining an Appearance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">10.7.</a>&nbsp;
Appearance Allocation - Loss of Subscription with UA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">10.8.</a>&nbsp;
Appearance Selection Contention Race Condition<br />
<a href="#anchor38">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">11.1.</a>&nbsp;
SIP Event Package Parameter: sa<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">11.2.</a>&nbsp;
URN Sub-Namespace Registration: sa-dialog-info<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">11.3.</a>&nbsp;
XML Schema Registration<br />
<a href="#anchor42">12.</a>&nbsp;
Appendix A - Incoming Appearance Assignment<br />
<a href="#anchor43">13.</a>&nbsp;
Appendix B - Implementation Options Discussion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">13.1.</a>&nbsp;
Appearance Implementation Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor45">13.1.1.</a>&nbsp;
URI parameter Approach<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor46">13.1.2.</a>&nbsp;
Dialog Package Parameter<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor47">13.1.3.</a>&nbsp;
Appearance Selections Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor51">13.2.</a>&nbsp;
Comparison<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor52">13.2.1.</a>&nbsp;
Comparison of Appearance Selection Methods<br />
<a href="#anchor53">14.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor54">15.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">16.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>  
The feature and functionality requirements for SIP user agents (UAs) supporting business telephony applications differ greatly from basic SIP user agents, both in terms of services and end user experience. In addition to basic SIP support <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, many of the services in a business environment require the support for SIP extensions such as REFER <a class='info' href='#RFC3515'>[RFC3515]<span> (</span><span class='info'>Sparks, R., &ldquo;The Session Initiation Protocol (SIP) Refer Method,&rdquo; April&nbsp;2003.</span><span>)</span></a>, SUBSCRIBE/NOTIFY primitives <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>, PUBLISH <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>, the SIP Replaces <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>,  and Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a>,  header fields, etc. Many of the popular business services have been documented in the SIP Service Examples <a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>. 

</p>
<p>
This specification details a method for implementing a group telephony feature known in telephony as Bridged Line Appearance (BLA) or Multiple Line Appearances (MLA), one of the more popular advanced features expected of SIP IP telephony devices in a business environment. Other names for this feature include Shared Call/Line Appearance (SCA), Shared Call Status and Multiple Call Appearance (MCA).  A variant of this feature is known as Single Line Extension.

</p>
<p>
This document looks at how this feature can be implemented using standard SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> in conjunction with <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a> for exchanging status among user agents, and the SIP dialog state event package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> to exchange dialog state information to achieve the same.  Different approaches will be discussed including the use of URI parameters, feature tags, and dialog package extensions along with the strengths and weaknesses of the various approaches.

</p>
<p>
A call flow for Single Line Extension was formerly included in the SIP Service Examples <a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>. However, the attempt to implement using standard SIP primitives ultimately failed, leading to its removal from that document. This document defines SIP extensions to implement this service.

</p>
<p>
In traditional telephony, the line is physical.  A common scenario is for a number of business telephones to share a single or a small number of Address of Record (AOR) URIs.  The sharing of this AOR between multiple UAs is what gives this feature its name.  In addition, an AOR can have multiple appearances on a single UA in terms of the user interface.  The appearance number relates to the user interface for the telephone - typically each appearance or an AOR has a visual display (lamp that can change color or blink) and a button (used to select the appearance). The telephony concept of line aappearance is still relevant to SIP due to the user interface considerations. It is important to keep the appearance number construct because:

</p>
<p> </p>
<ol class="text">
<li>

Human users are used to the concept and will expect it in replacement systems (e.g. an overhead page announcement says "Joe pickup line 3").

</li>
<li>

It is a useful structure for user interface representation.

</li>
</ol>

<p>

In this document, we will use the term "appearance" rather than "line appearance" since SIP does not have the concept of lines. Note that this does not mean that a conventional telephony user interface (lamps and buttons) must be used - implementations may use another metaphor as long as the appearance number is readily apparent to the user.  Each AOR has a separate appearance numbering space.  As a result, a given UA user interface may have multiple occurrences of the same appearance number, but they will be for different AORs.


</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC-2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>  and indicate requirement levels for compliant mechanisms.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Usage Scenarios</h3>

<p>
The following examples are common applications of the Shared Appearances feature and are mentioned here as informative use cases.   All these example usages can be supported by the Shared Appearances feature described in this document.  The differences relate to the user interface considerations of the device.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Executive/Assistant Arrangement</h3>

<p>
The appearances on the executive's UA may also appear on the assistant's UA.  The assistant may answer incoming calls to the executive
and then place the call on hold for the executive to pick up.  The
assistant can always see the state of all calls on the executive's UA.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
BLA Call Group</h3>

<p>
Users with similar business needs or tasks can be assigned to specific groups and share the line appearances of each other on each others SIP telephony devices.  For example, an IT department staff of five might answer a help line which has three appearances on each phone in the IT work area.  A call answered on one phone can be put on hold and picked up on another phone.  A shout or an IM to another staff member can result in them taking over a call on a particular appearance.  Another phone can request to be added to an appearance resulting in a conference call.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Single Line Extension</h3>

<p>
In this scenario, incoming calls are offered to a group of UAs.  When one answers, the other UAs are informed.  If another UA in the group selects the line (i.e. goes off hook), it is immediately bridged or joined in with the call.  This mimics the way residential telephone extensions usually operate.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requirements</h3>

<p> 
The basic requirements of the shared appearance feature can be summarized as follows:

</p>
<p>
REQ-1 Incoming calls to the AOR must be offered to a group of UAs and can be answered by any of them.

</p>
<p>
REQ-2 Each UA in the group must be able to learn the call status of the others in the group for the purpose of rendering this information to the user.

</p>
<p>
REQ-3 Calls can be joined (also called bridged or conferenced together) or can be picked up (taken) by another UA in the group in a secure way.

</p>
<p>
REQ-4 The mechanism should require the minimal amount of configuration.  UAs registering against the group AOR should be able to learn about each other and join the appearance group.

</p>
<p>
REQ-5 The mechanism must scale for large numbers of appearances, n, and large numbers of UAs, N, without introducing excessive messaging traffic.

</p>
<p>
REQ-6 Each call or session (incoming or outgoing) must be assigned a common "appearance" number from a managed pool administered for the AOR group.  Once the session has terminated, the appearance number is released back into the pool and can be reused by another incoming or outgoing session.

</p>
<p>
REQ-7 Each UA in the group must be able to learn the appearance status of the the group.

</p>
<p>
REQ-8 There must be mechanisms to resolve appearance contention among the UAs in the group.

</p>
<p>
REQ-9 The mechanism must allow all UAs receiving an incoming session request to  select the same appearance number at the time of alerting. 

</p>
<p>
REQ-10 The mechanism must have a way of reconstructing appearance state after an outage that does not result in excessive traffic and processing. 

</p>
<p>
REQ-11 The mechanism must have backwards compatibility such that a UA which is unaware of the feature can still register against the group AOR and make and receive calls.

</p>
<p>
REQ-12 The mechanism must not allow UAs outside the group to select or manipulate appearance numbers.

</p>
<p>
REQ-13 For privacy reasons, there must be a mechanism so that appearance information is not leaked outside the group of UAs. (e.g. "So who do you have on line 1?")

</p>
<p>
REQ-14 The mechanism must support a way for UAs to request exclusivity
on a line appearance. Exclusivity means that the UA requesting it
desires to  have a private conversation with the external party and
other UAs must not  be allowed to barge-in. Exclusivity may be requested
at the start of an incoming or outgoing session or during the session.
An exclusivity request may be accepted or rejected by the entity
providing the SA service. Therefore, the mechanism must provide a way
of communicating the result back to the requester UA.

</p>
<p>
REQ-15  The mechanism should support a way for a UA to select a particular appearance number for outgoing requests prior to sending the actual request.   This is often called seizure. 

</p>
<p>
REQ-16  The mechanism should support a way for a UA to select a particular appearance number and also send the request at the same time.  This is needed when a ringdown feature is combined with shared appearances - in this case, seizing the line is the same thing as dialing.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Normative Description</h3>

<p>
This section normatively describes the SA feature extensions.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Implementation</h3>

<p>
Many of the requirements for this service can be met using standard SIP mechanisms such as:

</p>
<p>
 - A SIP Forking Proxy and Registrar/Location Service meets REQ-1.

</p>
<p>
 - The SIP Dialog Package meets REQ-2.

</p>
<p>
 - The SIP Replaces and Join header fields meets REQ-3.

</p>
<p>
 - The SIP Registration Package meets REQ-4.

</p>
<p>
- The use of a State Agent for the Dialog Package meets REQ-5.

</p>
<p>
REQ-6 suggests the need for an entity which manages the appearance resource. Just as conferencing systems commonly have a single point of control, known as a focus, a Shared Appearance group has a single point of control of the appearance shared resource. This is defined as an Appearance Agent for a group. While an Appearance Agent can be part of a centralized server, it could also be co-resident in a member User Agent who has taken on this functionality for a group. The Appearance Agent learns the group state either by subscribing to the dialog state of each member UA individually or by dialog state publications from members.

</p>
<p>
While the appearance resource could be managed co-operatively by a group of UAs without any central control, this is not discussed in this draft, but instead is left as a research project for future standardization.  It is also possible that the Appearance Agent logic could be distributed in all UAs in the group.  For example, rules that govern assigning appearance numbers for incoming requests (e.g. lowest available appearance number) and rules for contention handling (e.g. when two UAs request the use of the same appearance number, hash dialog identifiers and compare with the lowest hash winning) would need to be defined and implemented.

</p>
<p>
REQs 6-13 can be implemented using a number of approaches, as discussed in the following sections.

</p>
<p>
Figure 1 illustrates the SIP components involved in supporting these common requirements of the Shared Appearance using standard SIP messages including REGISTER, INVITE, SUBSCRIBE, NOTIFY, and PUBLISH.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

+----------------------------+                            +----+
|                            |                            |    |
|     Appearance Agent       |                            | UA |
|                            |                            |    |
+----------------------------+                            +----+
    ^ ^ |1)SUBSCRIBE  ^  ^    4)NOTIFY            INVITE     |
    | | |(Event:reg)  |  | registration sip:alice@example.com|
    | | V             |  |     events                        V
    | | +--------------------+        +----------+7)Query+--------+
    | | |    (example.com)   |        |          |&lt;===== |        |
    | | |                    |3) Store| Location |       | Proxy  |
    | | |     Registrar      |=======&gt;|  Service |       |        |
    | | |                    |        |          |=====&gt; |        |
    | | +--------------------+        +----------+8)Resp +--------+
    | |     ^       ^                                       |  |
    | |     |       |  2) REGISTER (alice)                  |  |
    | |     |       |                                       |  |
    | |   +----+ +----+                                     |  |
    | |   |    | |    |                                     |  |
    | |   |UA1 | |UA2 |                                     |  |
    | |   |    | |    |                                     |  |
    | |   +----+ +----+                                     |  |
    | |    ^  ^    ^ ^                                      |  |
    | |    |  |    | |                                      |  |
    | +----+  |    | |                                      |  |
    |         |    | +--------------------------------------+  |
    |         +----+-------------------------------------------+
    |              |              8) INVITE
    +--------------+            sip:alice@example.com
    5-7) SUBSCRIBE and/or PUBLISH
         (Event:dialog)
</pre></div>
<p>
  Figure 1. 
</p>
<p>
The next section discusses normal SIP operations used to implement parts of the shared appearance feature.

</p>
<p></p>
<ol class="text">
<li>
The Appearance Agent SUBSCRIBES to the registration event package as outlined in <a class='info' href='#RFC3680'>[RFC3680]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Session Initiation Protocol (SIP) Event Package for Registrations,&rdquo; March&nbsp;2004.</span><span>)</span></a>  for contacts registered to the group AOR. Thus, it has knowledge of all User Agents registered against the AOR at any point of time. 

</li>
<li>

UAs (UA1 and UA2 in Figure 1) belong to the appearance group and, after authentication, register against the same AOR (e.g., sip:alice@example.com). 

</li>
<li>

Each registration is stored in the Location Service. 

</li>
<li>

The registrar notifies the Appearance Agent of successful registration at each UA.

</li>
<li>

UAs PUBLISH their dialog state to the State Agent in the Appearance Agent. 

</li>
<li>

The UAs SUBSCRIBE to the Appearance Agent for the state of all dialogs as defined in <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> .  The Request-URI of the SUBSCRIBE could be either the AOR of the group, the Contact URI information it received in the incoming subscription from the Appearance Agent, or a provisioned URI.

</li>
<li>

The UAs PUBLISH their dialog information to the Appearance Agent every time their dialog state changes (i.e. receive an INVITE, enter alerting state, answer a call, terminate a call, generate an INVITE, etc.)  

</li>
<li>

Forking Proxy forks an incoming INVITE for the AOR address to the registered user agents.

</li>
</ol>

<p>

The User Agents in the group could SUBSCRIBE to each other and NOTIFY dialog state events, but in a large group the User Agents have to manage a larger number of SUBSCRIPTIONS and NOTIFICATIONS. The State Agent in the Appearance Agent helps in managing large groups better. Further, the State Agent can filter dialog state events and NOTIFY User Agents of the dialog state events which are required for the application or feature. The State Agent can also SUBSCRIBE to dialog state events with filters to reduce the number of NOTIFY messages exchanged between the State Agent and the user agents in the group. This allows a group of N UAs to each only establish a pair of dialog state subscriptions (one in each direction) to learn the dialog state of all other group members. This results in 2N total subscriptions for the entire group.  A full mesh of subscriptions without a state agent would result in N(N-1) total subscriptions.

</p>
<p>

The Appearance Agent can select the appearance number for an incoming call

</p>
<p>
OPEN ISSUE: Do we want to define another mode of operation in which UAs only PUBLISH to seize a line appearance?  This assumes the Appearance Agent already knows about all dialogs related to the AOR and could publish that information to the UAs in the SA group.  This approach would simply UA operation and cleanly resolve some race conditions.  Should we define this mode in a separate draft?

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
SA Dialog Package Extensions</h3>

<p>
This specification defines three new elements as extensions to the SIP Dialog Event package <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> .  The schema is defined in Section 7.  The elements are &lt;appearance&gt;, &lt;exclusive&gt;;, and &lt;joined-dialog&gt;.  All three elements are sub-elements of the &lt;dialog&gt; element.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
The &lt;appearance&gt; element</h3>

<p>
The &lt;appearance&gt; element is used convey the appearance number.  The appearance number is a non-negative integer.  When sent in a notification in state Trying to the Appearance Agent, it is used to request an appearance number.  When sent by the Appearance Agent, it indicates that the appearance number is associated with a dialog.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
The &lt;exclusive&gt; element</h3>

<p>
The &lt;exclusive&gt; element is a boolean used indicate whether the UA will accept Join or Replaces INVITEs for this dialog. For example, some SA systems only allow call pickup when the call is on hold.  In this case, the &lt;exclusive&gt; element should be used to explicitly indicate this, rather than implicitly by the hold state.

</p>
<p>
It is important to note that this element is a hint. Although a UA may set exclusive to true, the UA must still be ready to reject an INVITE Join relating to this dialog.  Also, an INVITE Replaces might be sent to the non-SA UA to take the call.  For this reason, a UA MAY also not report full dialog identifier information to the Appearance Agent for calls set to exclusive.  If these dialog identifiers have already been shared with the Appearance Agent, the UA could send an INVITE Replaces to change them and then not report the new ones to the Appearance Agent.

</p>
<p>
If the proxy knows which dialogs are marked exclusive, the proxy MAY enforce this exclusivity by rejecting INVITE Join and INVITE Replace requests containing those dialog identifiers with a 403 Forbidden response.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
The &lt;joined-dialog&gt; element</h3>

<p>
The &lt;joined-dialog&gt; element is used convey dialog identifiers of any other dialogs which are joined (mixed or bridged) with the dialog.  Only the UA which is performing the actual media mixing should include this element in notifications to the Appearance Agent.  Note that this element should still be used even when the Join header field was not used to join the dialogs.  For example, two separate dialogs on a UA could be joined without any SIP call control operations.  The UA would report this using this header field.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Shared Appearance User Agents</h3>

<p>
User Agents that support the Shared Appearance feature MUST support
   the dialog state package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a>   with the SA extensions and the 
   "sa" dialog event package parameter defined in this draft. 

</p>
<p>

   User Agents MUST use the extended package in conjunction with 
   PUBLISH <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a> to send local status to the Appearance Agent, and 
   in conjunction with SUBSCRIBE and NOTIFY <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>   to learn the 
   status or other User Agents. The publication URI is either a provisioned value or the username 'appearance-agent'.  For example, a UA in the domain of example.com would publish dialog state to sip:appearance-agent@example.com

</p>
<p>
OPEN ISSUE: Do we need to specify a publish URI or should it be only by provisioning?  Should a UA be able to publish to its own URI for this?


</p>
<p>

   User Agents SHOULD support sending and receiving an INVITE with a Replaces 
   <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>  header to allow the Call Pickup operation. User Agents 
   MUST support sending an INVITE a Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a> header to initiate 
   bridging. User Agents MUST support receiving an INVITE with a Join 
   header, though they are not obligated to support bridging of calls, 
   either through policy, preference, or implementation limitations 
   such as bandwidth or hardware constraints.

</p>
<p>

   When publishing dialog package information, a UA MUST include all 
   dialog identification available at the time of publication, with 
   the exception that a UA may omit information if it wishes to prevent 
   other UAs from joining or picking up a call. Dialog identification 
   includes local and remote target URIs, call-id, to-tag, and 
   from-tag. When calls are placed on hold, the "+sip.rendering=no" feature tag    
   MUST be included in dialog package notifications.


</p>
<p>

   There are two exceptions to the requirement for seizing an appearance
   before sending an INVITE.  One is an emergency call, which should
   proceed regardless of the status of PUBLISH transaction.  This
   requirement applies to both clients and servers implementing this
   feature.  The other is when the INVITE is an attempt to bridge or
   take a call (i.e. contains Join or Replaces with a dialog identifier
   of another member of the SA group).  In this case, the INVITE Join or
   Replaces should be sent without selecting an appearance.  After the
   INVITE succeeds, the PUBLISH MUST be sent, reusing the appearance
   number of the dialog that has been bridged or taken.

</p>
<p>

   UAs can tell that a set of dialogs are joined (bridged or mixed)
   together by the presence of one or more &lt;joined-dialog&gt;  elements
   containing other SIP dialog identifiers.

</p>
<p>

   Prior to placing an outbound call, UAs may select or "seize" an 
   appearance number by sending a PUBLISH to the Appearance Agent 
   with an &lt;appearance&gt; identifying the appearance number selected.
   In traditional telephony terms, this corresponds to "going off hook"
   with an analog telephone. Note that when a UA selects an
   appearance prior to establishment of a dialog, not all dialog 
   information will be available. In particular, when a UA publishes 
   an attempt to select an appearance prior to knowing the destination
   very minimal dialog information may be available.

</p>
<p>

   A UA that does not need to select a particular appearance number (or
   doesn't care) would just send an INVITE as normal to place an
   outbound call. The Appearance Agent would select an available
   appearance and notify all subscribed UAs of the selection. The 
   UA placing the call then publishes the use of this appearance number.

</p>
<p>

   If an INVITE is sent and no appearance number is available, the proxy
   would reject the INVITE with a suitable response code and perhaps a
   header field indication.

</p>
<p>

   For inbound calls which contain a reference to an appearance number 
   in the INVITE, a UA MUST PUBLISH the use of an appearance number 
   after it responds with a 2xx to establish a dialog. A UA SHOULD NOT
   PUBLISH the use of an appearance number for incoming requests which
   are in the early state or which are rejected with 4xx, 5xx or 6xx
   responses, as this would create excessive traffic when a large number
   of UAs are sharing an appearance.

</p>
<p>

   The dialog state package defined in <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a> defines the set of
   messages that MAY be provided by a UA to publish state information of
   dialogs.

</p>
<p>

   A UA should only register against the AOR if it is likely the UA will
   be answering incoming calls.  If the UA is mainly going to be
   monitoring the status of the SA group calls and picking or joining
   calls, the UA SHOULD only subscribe to the Appearance Agent and not
   register against the AOR.


</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Appearance Agent</h3>

<p>
An Appearance Agent defined in this specification MUST implement a dialog package state agent for the UAs registered against the AOR.

</p>
<p>
The dialog package XML element dialog id (NOT the SIP dialog identifier consisting of the Call-ID, To tag, and From tag) is used for partial update processing.  RFC 4235 only requires the dialog id be unique for the UA, not unique across all UAs associated with the same AOR.  As a result, is possible that two UAs in a SA group might choose the same XML element dialog id for different dialogs.  If this is the case, the Appearance Agent, acting as the dialog package event state compositor may need to produce different notification documents for the UAs that have conflicting dialog package XML element dialog ids.

</p>
<p>
The Appearance Agent MUST support the appearance dialog package extensions defined in this specification.

</p>
<p>
Even in trivial deployments of two shared appearance enabled user agents, race conditions can exist when both user agents attempt to utilize an appearance simultaneously (i.e. when the NOTIFY messages, that each user agent sends to the other, are active within the network during an overlapping time period). The Appearance Agent can use any policy deemed necessary to resolve races and ensure no two user agents are not allocated the same appearance number at the same time.

</p>
<p>
Appearance Agents are responsible for resolving conflicts in the appearance resource.  If a UA requests the use of an appearance number that is in use by another UA, the Appearance Agent will respond based on the presence of the selection attribute in the &lt;appearance&gt; element as described in the previous section.

</p>
<p>
In the case where a UA is bridging two calls, the Appearance Agent may receive dialog package PUBLISHes that contain multiple dialogs with the same appearance number.  This is valid and does not represent appearance number contention.

</p>
<p>
A critical aspect for reliable operation of this feature is the ability for all user agents in the BLA group to recover from network failures caused at a single UA. For example, one of the user agents in the BLA group may have answered an incoming call, notified the dialog state to other members and then experienced a network outage. The calling UA could have detected the same (using RTP or some other means) and could have hung up. However, none of the other user agents in the BLA group would get notification of this change in dialog state and their BLA appearances could stay out of sync for a long time; depending on when the network is restored, or when the Appearance Agent attempts to refresh its dialog-state subscription with the failed UA. To recover from such a failure, UAs MUST PUBLISH with a shorter expiration (expiration interval not smaller than 300 seconds is RECOMMENDED) following the notification of a "confirmed" dialog or when a Appearance Agent honors a "trying" for call origination, with the user agents that notified it of this information.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
XML Schema Definition</h3>

<p>
   The 'appearance' and 'exclusive' elements are defined within a new XML
   namespace URI.  This namespace is "urn:ietf:params:xml:ns:sa-dialog-info".
   The schema for these elements is:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
  &lt;xs:schema
    targetNamespace="urn:ietf:params:xml:ns:sa-dialog-info-info"
    xmlns="urn:ietf:params:xml:ns:sa-dialog-info"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    elementFormDefault="qualified"&gt;


   &lt;xs:element name="joined-dialog" minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;xs:complexType&gt;
            &lt;xs:attribute name="call-id" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="local-tag" type="xs:string"
              use="mandatory"/&gt;
            &lt;xs:attribute name="remote-tag" type="xs:string"
              use="mandatory"/&gt;
           &lt;/xs:complexType&gt;
        &lt;/xs:element&gt;

        &lt;xs:element name="appearance" minOccurs="0" maxOccurs="1"&gt;
          &lt;xs:simpleType type="xs:integer"&gt;
          &lt;/xs:simpleType&gt;
        &lt;/xs:element&gt;

        &lt;xs:element name="exclusive" minOccurs="0" maxOccurs="1"&gt;
         &lt;xs:simpleType type="xs:boolean"&gt;
         &lt;/xs:simpleType&gt;
        &lt;/xs:element&gt;
  &lt;/xs:schema&gt;

</pre></div>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
User Interface Considerations</h3>

<p>
The "appearance number" allocated to a call is an important concept that
enables calls to be handled by multiple devices with heterogeneous user
interfaces in a manner that still allows users to see a consistent model.
Careful treatment of the appearance number is essential to meet the
expectations of the users.  Also, rendering the correct call/appearance state to users is also important.

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Appearance Number Rendering</h3>

<p>
Since different UAs have different user interface capabilities, it
is usual to find that some UAs have restrictions that others do not.
Perfect interoperability across all UAs is clearly not possible, but
by careful design, interoperability up to the limits of each UA can
be achieved.

</p>
<p>
The following guidelines suggest how the appearance number should be
handled in three typical user interface implementations.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Single Appearance UAs</h3>

<p>
 These devices are constrained by only having the
capability of displaying status indications for a single appearance.
Despite this, it is important that devices of this type do not ignore
the appearance number.  The UA should still send messages annotated with
an appropriate appearance number (i.e. "0").  Any call indications for
appearances other than for number "0" should be rejected with a 486 or 480 response.

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Dual Appearance UAs</h3>

<p>
These devices are essentially single appearance phones that implement call waiting.  They have a very simple user interface that allows them to switch between two appearances (toggle or flash hook) and perhaps audible tones to indicate the status of the other appearance.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.3"></a><h3>7.1.3.&nbsp;
Shared Appearance UAs with Fixed Appearance Number</h3>

<p>
This UA is the typical 'business-class' hard-phone.  A number of appearances are
typically configured statically and labeled on buttons, and calls may be managed using these configured appearances.  Any calls outside this range should be ignored, and not mapped to a free button.  Users of these devices often select specific appearance numbers for outgoing calls, and the UA will need to select the appearance number and wait for confirmation from the Appearance Agent before proceeding with calls.

</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.4"></a><h3>7.1.4.&nbsp;
Shared Appearance UAs with Variable Appearance Number</h3>

<p>
This UA is typically a soft-phone or graphically rich user interface hard-phone.  In these cases,
even the idea of an appearance index may seem unnecessary.  However,
for these phones to be able to interwork successfully with other phone
types, it is important that they still use the appearance index to govern
the order of appearance of calls in progress.  No specific guidance
on presentation is given except that the order should be consistent.
Thought should also be given to how an appearance number that has no call
associated with it should be rendered to the user.  These devices can typically make calls without waiting for confirmation from the Appearance Agent on the appearance number.

</p>
<p>
The problems faced by each style of user interface are readily seen in
this example:

</p>
<p></p>
<ol class="text">
<li>
A call arrives at the SA group, and is assigned an appearance number
of 0.  All UAs should be able to render to the user the arrival of this call.

</li>
<li>
Another call arrives at the SA group, and is assigned an appearance
number of 1.  The single appearance UA should not present this call to the user.  Other user agents should have no problems presenting this call distinctly from the first call.

</li>
<li>
The first call clears, releasing appearance number "0".  
The single appearance UA should now be indicating no calls since it is unable 
to manage calls other than on the first appearance.  Both shared appearance UAs should clearly show that appearance number 0 is now free, but that
there is still a call on appearance number 1.

</li>
<li>
A third call arrives, and is assigned the appearance number of 0.
All UAs should be able to render the arrival of this new call to the user.
Multiple appearnce UAs should continue to indicate the presence of the second
call, and should also ensure that the presentation order is related to
the appearance number and not the order of call arrival.

</li>
</ol>

<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Call State Rendering</h3>

<p>
UAs that implement the SA feature typically have a user interface that provides the state of other appearances in the group.  As dialog state NOTIFYs from the Appearance Agent are processed, this information can be rendered.  Even the simplest user interface typically has three states: idle, active, and hold.  The idle state, usually indicated by lamp off, is indicated for an appearance when the appearance number is not associated with any dialogs, as reported by the Appearance Agent.  The active state, usually indicated by a lamp on, is indicated by an appearance number being associated with at least one dialog, as reported by the Appearance Agent.  The hold state, often indicated by a blinking lamp, means the call state from the perspective of the UA in the SA group is hold.  This can be determined by the presence of the "sip+rendering=no" feature tag <a class='info' href='#RFC3840'>[RFC3840]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;Indicating User Agent Capabilities in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a> with the local target URI.  Note that the hold state of the remote target URI is not relevant to this display.  For joined dialogs, the state is rendered as hold only if all local target URIs are indicated with the "sip+rendering=no" feature tag.

</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Interop with non-SA UAs</h3>

<p>
It is desirable to allow a basic UA that does not directly
support SA to be part of a SA group. To support this the Proxy
must collaborate with the Appearance Agent. This is not required in
the basic SA architecture, consequently SA interop with non-SA UAs
will not be available in all SA deployments.

</p>
<p>
First, a UA which does not support dialog events or the SA feature will be discussed.  Then, a UA which does support dialog events but not the SA feature will be discussed.

</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Appearance Assignment</h3>

<p>
A UA that has no knowledge of appearances must have appearance numbers assigned by the Appearance Agent for both incoming and outgoing calls.  If the non-SA UA does not support Join or Replaces, all dialogs could be marked "exclusive" to indicate that these options are not available.

</p>
<p>
OPEN ISSUE: How can an Appearance Agent know that a given UA does not support the feature?  Do we need a SIP option tag for this purpose?  Do we need to be able to correlate a registration with a subscription?

</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Appearance Release</h3>

<p>
In all cases the Appearance Agent must be aware of dialog lifetime to release appearances back into the group. 

</p>
<p>
It is also desirable that any dialog state changes (such as hold, etc) be made available to other UAs in the group through the Dialog Event Package. If the Appearance Agent includes a proxy which Record-Routes for dialogs from the non-SA aware UA, the Appearance Agent will know about the state of dialogs including hold, etc.  This information could be determined from inspection of INVITE and re-INVITE messages and added to the dialog information conveyed to other UAs.  

</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
UAs Supporting Dialog Events but Not SA</h3>

<p>
Interoperability with UAs which support dialog events but not the SA feature is more straightforward.  As before, all appearance number assignment must be done by the Appearance Agent.  This type of UA will be detected by the Appearance Agent by the absence of the ma event parameter in SUBSCRIBE or PUBLISH messages.  The Appearance Agent can include appearance information in NOTIFYs - this UA will simply ignore this extra information.  This type of UA will ignore appearance number limitations and may attempt to Join or Replace dialogs marked exclusive.  As a result, the Proxy or UAs may need to reject such requests.

</p>
<p>
The need for close cooperation between the Proxy and the Appearance Agent is not needed as the Appearance Agent will learn about all dialogs from the UA itself.

</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Provisioning Considerations</h3>

<p>
TBD.

</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Example Message Flows</h3>

<p>
The next section shows call flow and message examples.  The flows and descriptions are non-normative.

</p>
<p>
EDITOR'S NOTE:  These flows need to be gone over closely to make sure they reflect the latest protocol design.

</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Registration and Subscription</h3>

<p>
Bob and Alice are in an appearance group identified by Alice's AOR. Bob REGISTERs using contact sip:bob@ua2.example.com. Furthermore, Bob REGISTERs his primary address with contact sip: bob@ua2.example.com. Alice REGISTERs with contact sip:alice@ua1.example.com. 

</p>
<p>
The Appearance Agent subscribes to dialog states of the SA AOR (i.e., sip:alice@example.com) at the User Agents for Alice and Bob. Message exchange between the Registrar, Appearance Agent, Alice, and Bob are shown below.
The call flow examples below do not show challenging of subscriptions or notifications. It should be noted that for security purposes, all subscriptions must be authorized before the same is accepted.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Registrar     Appearance Agent          Alice
|                    |                    |
|                    |                    |
|&lt;--------------------------- REGISTER F1&lt;|
|                    |                    |
|&gt;F2 200 OK -----------------------------&gt;|
|                    |                    |
|                    |&lt;----- SUBSCRIBE F3&lt;|
|                    |                    |
|                    |&gt;F4 202 Accepted --&gt;|
|                    |                    |
|                    |&gt;F5 NOTIFY --------&gt;|
|                    |                    |
|                    |&lt;-------- OK 200 F6&lt;|
|                    |                    |

Figure 2.

F1-F2: Alice registers AOR with contact: &lt;sip:alice@ua1.example.com&gt;

F1 Alice ----&gt; Registrar

REGISTER sip:registrar.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bK527b54da8ACC7B09
From: &lt;sip:alice@example.com&gt;;tag=CDF9A668-909E2BDD
To: &lt;sip:alice@example.com&gt;
CSeq: 2 REGISTER
Call-ID: d3281184-518783de-cc23d6bb@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
User-Agent: ABC-UA/1.2.3
Max-Forwards: 70
Expires: 3600
Content-Length: 0



F2 Registrar ----&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKfbf176ef7F1D5FA2
CSeq: 2 REGISTER
Call-ID: d3281184-518783de-cc23d6bb@ua1.example.com
From: &lt;sip:alice@example.com&gt;;tag=CDF9A668-909E2BDD
To: &lt;sip:alice@example.com&gt;;tag=1664573879820199
Contact:  &lt;sip:alice@ua1.example.com&gt;
Expires:  3600
Content-Length: 0



F3 to F6: Alice also subscribes to the events associated with the
Appearance AOR. Appearance Agent also notifies Alice of the status.

F3 Alice ----&gt; Appearance Agent

SUBSCRIBE sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKf10fac97E7A76D6A
From: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
To: &lt;sip:sa@stateagent.example.com&gt;
CSeq: 1 SUBSCRIBE
Call-ID: ef4704d9-bb68aa0b-474c9d94@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog
User-Agent: ABC-UA/1.2.3
Accept: application/dialog-info+xml
Max-Forwards: 70
Expires: 3700
Content-Length: 0


F4 Appearance Agent ----&gt; Alice

SIP/2.0 202 Accepted
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKf10fac97E7A76D6A
CSeq: 1 SUBSCRIBE
Call-ID: ef4704d9-bb68aa0b-474c9d94@ua1.example.com
From: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
To: &lt;sip:sa@stateagent.example.com&gt;;tag=1636248422222257
Allow-Events: dialog
Expires: 3700
Contact: &lt;sip:sa@stateagent.example.com&gt;
Content-Length: 0


F5 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:sa@stateagent.example.com&gt;;tag=1636248422222257
To: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
Call-ID: ef4704d9-bb68aa0b-474c9d94@ua1.example.com
CSeq: 2 NOTIFY
Via: SIP/2.0/UDP stateagent.example.com;branch=z9hG4bK1846984327225734
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog
Subscription-State: active
Contact: &lt;sip:sa@stateagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             version="40"
             state="full"
             entity="sip:alice@example.com"&gt;
&lt;/dialog-info&gt;


F6 Alice ----&gt; Appearance Agent

SIP/2.0 200 OK
Via: SIP/2.0/UDP stateagent.example.com;branch=z9hG4bK1846984327225734
From: &lt;sip:sa@stateagent.example.com&gt;;tag=1636248422222257
To: &lt;sip:alice@example.com&gt;;tag=925A3CAD-CEBB276E
CSeq: 2 NOTIFY
Call-ID: ef4704d9-bb68aa0b-474c9d94@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog
User-Agent: ABC-UA/1.2.3
Content-Length: 0

</pre></div>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Appearance Selection for Outgoing Call</h3>

<p>
In this scenario, Bob's UA sends out a dialog event NOTIFY with state (trying) selecting an appearance number.  After receiving the NOTIFY from the Appearance Agent confirming the appearance number, Bob's UA sends the INVITE to Carol and establishes a session.  For brevity, details of some of the messages are not included in the message flows.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |&lt;----- PUBLISH F1&lt;|
|              |               |              |                  |
|              |               |              |&gt;F2 200 OK ------&gt;|
|              |               |              |                  |
|              |               |&lt;-- NOTIFY F3&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F4 200 OK --&gt;|                  |
|              |               |              |------- NOTIFY F5&gt;|
|              |               |              |                  |
|              |               |              |&lt;F6 200 OK ------&lt;|
|              |               |              |                  |
|              |               |              |                  |
|              |&lt;------------------------------------ INVITE F11&lt;|
|              |               |              |                  |
|&lt;- INVITE F12&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F13 180  ---&gt;|               |              |                  |
|              |&gt;F14 180 Ringing -------------------------------&gt;|
|&gt;F15 200 OK -&gt;|               |              |                  |
|              |&gt;F16 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|&lt;------------------------------------------------------ ACK F17&lt;|
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |               |              |&lt;---- PUBLISH F18&lt;|
|              |               |              |                  |
|              |               |              |&gt;F19 200 OK -----&gt;|
|              |               |&lt;- NOTIFY F20&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F21 200 OK -&gt;|                  |
|              |               |              |------ NOTIFY F22&gt;|
|              |               |              |                  |
|              |               |              |&lt;F23 200 OK -----&lt;|
|              |               |              |                  |

Figure 3.

F1 to F4: Bob uses the BLA appearance of Alice on his UA to place an outgoing call (e.g., he goes off-hook). Before sending the outgoing INVITE request, Bob notifies the sate agent that Alice line appearance is in (trying) state. Appearance Agent notifies Alice of the same event by forwarding the NOTIFY payload provided by Bob after appropriately changing the dialog id field in the XML payload to a unique value towards each of the entities it is forwarding to (Alice in this example).
&lt;/t&gt;
&lt;figure&gt;&lt;artwork&gt;&lt;![CDATA[

F1 Bob ----&gt; Appearance Agent

PUBLISH sip:appearance-agent@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK61314d6446383E79
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:appearance-agent@example.com&gt;;tag=428765950880801
CSeq: 7 PUBLISH
Call-ID: 144-1289338424@example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog
User-Agent: XYZ-UA/4.5.6
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="6"
             state="partial"
             entity="sip:alice@example.com"&gt;
    &lt;dialog id="id3d4f9c83" direction="initiator"&gt;
        &lt;sa:appearance&gt;0&lt;/appearance&gt;
        &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
        &lt;state&gt;trying&lt;/state&gt;
        &lt;local&gt;
            &lt;target uri="sip:bob@example.com"&gt;
            &lt;/target&gt;
        &lt;/local&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F2 Appearance Agent ----&gt; Bob

SIP/2.0 200 OK
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK61314d6446383E79
CSeq: 7 PUBLISH
Call-ID: 144-1289338424@example.com
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:appearance-agent@example.com&gt;;tag=428765950880801
Allow-Events: dialog
Contact: &lt;sip:appearance-agent@stateagent.example.com&gt;
Content-Length: 0


F3 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:alice@example.com&gt;;tag=497585728578386
To: &lt;sip:alice@example.com&gt;;tag=633618CF-B9C2EDA4
Call-ID: a7d559db-d6d7dcad-311c9e3a@ua1.example.com
CSeq: 7 NOTIFY
Via: SIP/2.0/UDP stateagent.example.com;branch=z9hG4bK1711759878512309
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog
Subscription-State: active
Contact: &lt;sip:sa@stateagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="27"
             state="partial"
             entity="sip:alice@example.com"&gt;
    &lt;dialog id="fa02538339df3ce597f9e3e3699e28fc" direction="initiator"&gt;
            &lt;sa:appearance&gt;0&lt;/appearance&gt;
            &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
	       &lt;state&gt;trying&lt;/state&gt;
	        &lt;local&gt;
		    &lt;target uri="sip:bob@example.com"&gt;
 		    &lt;/target&gt;
		   &lt;/local&gt;
	&lt;/dialog&gt;
&lt;/dialog-info&gt;


F4 Alice ----&gt; Appearance Agent

SIP/2.0 200 OK
Via: SIP/2.0/UDP stateagent.example.com;branch=z9hG4bK1711759878512309
From: &lt;sip:alice@example.com&gt;;tag=497585728578386
To: &lt;sip:alice@example.com&gt;;tag=633618CF-B9C2EDA4
CSeq: 7 NOTIFY
Call-ID: a7d559db-d6d7dcad-311c9e3a@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog
User-Agent: ABC-UA/1.2.3
Content-Length: 0

F5 and F6:  The Appearance Agent sends a NOTIFY to Bob confirming appearance number.

F11 to F17: Bob places a call to Carol by sending the INVITE request
towards the Proxy. The INVITE (see F5 message below) includes a
P-Preferred-Identity header &lt;xref target="RFC3325" /&gt; to designate the identity to be
used as the calling party for this call (i.e., Alice instead of Bob).

F11 Bob ----&gt; Proxy

INVITE sip:carol@example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK98c87c52123A08BF
From: &lt;sip:bob@example.com&gt;;tag=15A3DE7C-9283203B
To: &lt;sip:carol@example.com&gt;
CSeq: 1 INVITE
Call-ID: f3b3cbd0-a2c5775e-5df9f8d5@ua2.example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
User-Agent: XYZ-UA/4.5.6
P-Preferred-Identity: &lt;sip:alice@example.com&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980499 1102980499 IN IP4 ua2.example.com
s=IP SIP UA
c=IN IP4 ua2.example.com
t=0 0
a=sendrecv
m=audio 2236 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000



F18 to F21: Bob notifies the Appearance Agent of the status of the
dialog (i.e., confirmed). Appearance Agent notifies Alice of the
same.

F18 Bob ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa39d3f69D4E20602
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:alice@example.com&gt;;tag=428765950880801
CSeq: 9 NOTIFY
Call-ID: 144-1289338424@example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog
User-Agent: XYZ-UA/4.5.6
Subscription-State: active;expires=3342
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="8"
             state="partial"
             entity="sip:alice@example.com"&gt;
    &lt;dialog id="id3d4f9c83"
            call-id="f3b3cbd0-a2c5775e-5df9f8d5@ua2.example.com"
            local-tag="15A3DE7C-9283203B"
            remote-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c"
            direction="initiator"&gt;
          &lt;state&gt;confirmed&lt;/state&gt;
          &lt;sa:appearance&gt;0&lt;/appearance&gt;
          &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
          &lt;local&gt;
            &lt;target uri="sip:bob@example.com"&gt;
               &lt;param pname="+sip.rendering" pval="yes"/&gt;
            &lt;/target&gt;
          &lt;/local&gt;
          &lt;remote&gt;
            &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
              &lt;target uri="sip:carol@example.com;user=phone" /&gt;
          &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Taking an Appearance</h3>

<p>
In this scenario, Bob has an established dialog with Carol.  Bob then places Carol on hold. Alice subsequently picks up the held call and has a established session with Carol. Finally, Carol hangs up. The details of the notifications amongst the user agents and the Appearance Agent in updating the status of the BLA group members are shown below. For brevity, details of some of the messages are not included in the message flows.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Carol        Proxy           Alice     Appearance Agent         Bob
|              |               |              |                  |
|              |               |              |                  |
|&lt;================= Both way RTP established ===================&gt;|
|              |               |              |                  |
|              |               |              |                  |
|              |&lt;------------------------------(hold) INVITE F16&lt;|
|&lt;- INVITE F17&lt;|               |              |                  |
|              |               |              |                  |
|&gt;F18 200 OK -&gt;|               |              |                  |
|              |&gt;F19 200 OK ------------------------------------&gt;|
|              |               |              |                  |
|&lt;------------------------------------------------------ ACK F20&lt;|
|              |               |              |                  |
|              |               |              |&lt;----- NOTIFY F21&lt;|
|              |               |              |                  |
|              |               |              |&gt;F22 200 OK -----&gt;|
|              |               |&lt;- NOTIFY F23&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F24 200 OK -&gt;|                  |
|              |&lt;-- INVITE F25&lt;|              |                  |
|&lt;- INVITE F26&lt;|(w/ Replaces)  |              |                  |
|( w/ Replaces)|               |              |                  |
|&gt;F27 200 OK -&gt;|               |              |                  |
|              |&gt;F28 200 OK --&gt;|              |                  |
|              |               |              |                  |
|&lt;-------------------- ACK F29&lt;|              |                  |
|              |               |              |                  |
|&lt;= Both way RTP established =&gt;|              |                  |
|              |               |              |                  |
|&gt;F30 BYE ----&gt;|               |              |                  |
|              |&gt;F31 BYE ---------------------------------------&gt;|
|              |               |              |                  |
|              |&lt;------------------------------------ OK 200 F32&lt;|
|&lt;- 200 OK F33&lt;|               |              |                  |
|              |               |              |                  |
|              |               |              |&lt;----- NOTIFY F34&lt;|
|              |               |              |                  |
|              |               |              |&gt;F35 200 OK -----&gt;|
|              |               |&lt;- NOTIFY F36&lt;|                  |
|              |               |              |                  |
|              |               |&gt;F37 200 OK -&gt;|                  |
|              |               |              |                  |
|              |               |&gt;F38 NOTIFY -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- 200 OK F39&lt;|                  |
|              |               |              |&gt;F40 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- 200 OK F41&lt;|
|&gt;F42 BYE ----&gt;|               |              |                  |
|              |&gt;F43 BYE -----&gt;|              |                  |
|              |               |              |                  |
|              |&lt;-- 200 OK F44&lt;|              |                  |
|&lt;--200 OK F45&lt;|               |              |                  |
|              |               |&gt;F46 NOTIFY -&gt;|                  |
|              |               |              |                  |
|              |               |&lt;- 200 OK F47&lt;|                  |
|              |               |              |&gt;F48 NOTIFY -----&gt;|
|              |               |              |                  |
|              |               |              |&lt;----- OK 200 F49&lt;|

Figure 4.

F16 to F20: Bob places Carol on hold.

F22 to F24: Bob notifies Appearance Agent of the status of the dialog to
indicate the held state. It indicates this by setting the sip.rendering
parameter in the NOTIFY payload to (no). Appearance Agent notifies
Alice of the same.

F22 Bob ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK6c78a6c5CA00520E
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: &lt;sip:alice@example.com&gt;;tag=428765950880801
CSeq: 10 NOTIFY
Call-ID: 144-1289338424@example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog
User-Agent: XYZ-UA/4.5.6
Subscription-State: active;expires=3338
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="9"
             state="partial"
             entity="sip:alice@example.com"&gt;
    &lt;dialog id="id3d4f9c83"
       call-id="f3b3cbd0-a2c5775e-5df9f8d5@ua2.example.com"
       local-tag="15A3DE7C-9283203B"
       remote-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c"
       direction="initiator"&gt;
       &lt;state&gt;confirmed&lt;/state&gt;
       &lt;sa:appearance&gt;0&lt;/appearance&gt;
       &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
       &lt;local&gt;
         &lt;target uri="sip:bob@example.com"&gt;
             &lt;param pname="+sip.rendering" pval="no"/&gt;
         &lt;/target&gt;
       &lt;/local&gt;
       &lt;remote&gt;
         &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
           &lt;target uri="sip:carol@example.com" /&gt;
        &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;




F26 to F34 : Alice picks up the held call by sending an INVITE with
Replaces: header (F26). Session is established between Alice and
Carol. The dialog between Carol and Bob is terminated.

F26 Alice ----&gt; Proxy

INVITE sip:carol@example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bK4ea695b5B376A60C
From: &lt;sip:alice@example.com&gt;;tag=8C4183CB-BCEAB710
To: &lt;sip:carol@example.com:5075&gt;
CSeq: 1 INVITE
Call-ID: 3d57cd17-47deb849-dca8b6c6@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
User-Agent: ABC-UA/1.2.3
P-Preferred-Identity: &lt;sip:alice@example.com&gt;
&lt;all-one-line&gt;
Replaces: f3b3cbd0-a2c5775e-5df9f8d5@ua2.example.com;to-tag=65a98f7c
-1dd2-11b2-88c6-b03162323164+65a98f7c;from-tag=15A3DE7C-9283203B
&lt;/all-one-line&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980497 1102980497 IN IP4 ua1.example.com
s=IP SIP UA
c=IN IP4 ua1.example.com
t=0 0
a=sendrecv
m=audio 2238 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000


F34 to F41: Bob notifies the Appearance Agent of the termination of
dialog at his UA. Alice notifies the Appearance Agent of the
confirmed state of the dialog at her UA.

F34 Bob ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bKa5d6cf61F5FBC05A
From: &lt;sip:bob@example.com&gt;;tag=44150CC6-A7B7919D
To: "State_Agent" &lt;sip:alice@example.com&gt;;tag=428765950880801
CSeq: 11 NOTIFY
Call-ID: 144-1289338424@example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog
User-Agent: XYZ-UA/4.5.6
Subscription-State: active;expires=3334
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:alice@example.com:5060"&gt;
   &lt;dialog id="id3d4f9c83"
         call-id="f3b3cbd0-a2c5775e-5df9f8d5@ua2.example.com"
         local-tag="15A3DE7C-9283203B"
         remote-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c"
         direction="initiator"&gt;
         &lt;sa:appearance&gt;0&lt;/appearance&gt;
         &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
         &lt;state&gt;terminated&lt;/state&gt;
         &lt;local&gt;
           &lt;target uri="sip:bob@example.comsip:bob@example.com"&gt;
           &lt;/target&gt;
         &lt;/local&gt;
         &lt;remote&gt;
           &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
           &lt;target uri="sip:carol@example.com" /&gt;
         &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;



F38 Alice ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bK93f44af3518A1572
From: &lt;sip:alice@example.com&gt;;tag=5861255C-14C04045
To: "State_Agent" &lt;sip:alice@example.com&gt;;tag=920163082722420
CSeq: 10 NOTIFY
Call-ID: 143-1840952798@example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog
User-Agent: ABC-UA/1.2.3
Subscription-State: active;expires=3315
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
            xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
            version="9"
             state="partial"
             entity="sip:alice@example.com:5060"&gt;
    &lt;dialog id="id402f024e"
        call-id="3d57cd17-47deb849-dca8b6c6@ua1.example.com"
        local-tag="8C4183CB-BCEAB710"
        remote-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c"
        direction="initiator"&gt;
        &lt;state&gt;confirmed&lt;/state&gt;
        &lt;sa:appearance&gt;0&lt;/appearance&gt;
        &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
        &lt;local&gt;
          &lt;target uri="sip:alice@example.com"&gt;
             &lt;param pname="+sip.rendering" pval="yes"/&gt;
          &lt;/target&gt;
        &lt;/local&gt;
        &lt;remote&gt;
           &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
           &lt;target uri="sip:carol@example.com" /&gt;
        &lt;/remote&gt;
    &lt;/dialog&gt;
&lt;/dialog-info&gt;


F42 to F59: Carol terminates the dialog with Alice. Alice notifies the
Appearance Agent of the dialog state (terminated). The Appearance Agent
notifies Bob of the same.

F46 Alice ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKa46c2f85F29F839C
From: &lt;sip:alice@example.com&gt;;tag=5861255C-14C04045
To: "State_Agent" &lt;sip:alice@example.com&gt;;tag=920163082722420
CSeq: 11 NOTIFY
Call-ID: 143-1840952798@example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
Event: dialog
User-Agent: ABC-UA/1.2.3
Subscription-State: active;expires=3311
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="10"
             state="partial"
             entity="sip:alice@example.com"&gt;
   &lt;dialog id="id402f024e"
      call-id="3d57cd17-47deb849-dca8b6c6@ua1.example.com"
      local-tag="8C4183CB-BCEAB710"
      remote-tag="65a98f7c-1dd2-11b2-88c6-b03162323164+65a98f7c"
      direction="initiator"&gt;
      &lt;state&gt;terminated&lt;/state&gt;
      &lt;sa:appearance&gt;0&lt;/appearance&gt;
      &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
      &lt;local&gt;
        &lt;target uri="sip:alice@example.com"&gt;
        &lt;/target&gt;
      &lt;/local&gt;
      &lt;remote&gt;
        &lt;identity&gt;sip:carol@example.com&lt;/identity&gt;
        &lt;target uri="sip:carol@example.com" /&gt;
      &lt;/remote&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;

</pre></div>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.4"></a><h3>10.4.&nbsp;
Appearance Selection for Incoming Call</h3>

<p>
In the call flow below Bob and Alice are in an appearance group identified by Alice's AOR. Carol places a call to Alice. Both Alice and Bob's devices are alerted of the incoming call. Bob answers the call. He then places Carol on hold. Alice picks up the held call and has a established session with Carol. Finally, Carol terminates the session.
All NOTIFY messages in the call flow below carry dialog events and only dialog states are mentioned for simplicity. For brevity, the details of some messages are not shown below.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Forking     Appearance
Carol      Proxy         Agent         Alice      Bob
|            |             |             |         |
|&gt;F1 INVITE &gt;|             |             |         |
|            |&lt; - - - - - &gt;|             |         |
|            |             |&gt;F2 NOTIFY -----------&gt;|
|            |             |             |         |
|            |             |&lt;F3 200 OK -----------&lt;|
|            |             |             |         |
|            |             |&gt;F4 NOTIFY -&gt;|         |
|            |             |             |         |
|            |             |&lt;-200 OK F5-&lt;|         |
|            |             |             |         |
|            |&gt;F6 INVITE -------------------------&gt;|
|            |             |             |         |
|            |&gt;F7 INVITE ---------------&gt;|         |
|            |             |             |         |
|&lt;- 100 F8 -&lt;|             |             |         |
|            |             |             |         |
|            |&lt;-------------------- Ringing 180 F9&lt;|
|&lt; 180 F10 -&lt;|             |             |         |
|            |&lt;--------- 180 Ringing F11&lt;|         |
|&lt; 180 F12 -&lt;|             |             |         |
|            |&lt;------------------------ 200 OK F13&lt;|
|&lt; 200 F14 -&lt;|             |             |         |
|            |             |             |         |
|            |&gt;F14 CANCEL --------------&gt;|         |
|            |             |             |         |
|            |&lt;-------------- 200 OK F15&lt;|         |
|            |             |             |         |
|            |&lt;Request Cancelled 487 F16&lt;|         |
|            |             |             |         |
|            |&gt;F17 ACK -----------------&gt;|         |
|&gt;F18 ACK --&gt;|             |             |         |
|            |&gt;F19 ACK ---------------------------&gt;|
|            |             |             |         |
|&lt;=============Both way RTP established===========&gt;|
|            |             |             |         |
|            |             |&lt;---------- NOTIFY F20&lt;|
|            |             |             |         |
|            |             |&gt;F21 200 OK ----------&gt;|
|            |             |             |         |
|            |             |&gt;F22 NOTIFY &gt;|         |
|            |             |             |         |
|            |             |&lt;- 200 F22 -&lt;|         |
|            |             |             |         |
|            |             |-------- SUBSCRIBE F23&gt;|
|            |             |                       |
|            |             |&lt;F24 200 OK ----------&lt;|
|            |             |                       |
|            |             |&lt;---------- NOTIFY F25&lt;|
|            |             |                       |
|            |             |&gt;F26 200 OK ----------&gt;|
|            |             |                       |

Figure 5.

F1 to F16: An incoming call from Carol to Alice is forked to
Bob and Alice. Both Alice and Bob indicate an incoming call
(e.g., ringing) from Carol. Bob answers the call and two-way
media is established between Carol and Bob.

F2 Proxy ----&gt; Bob

INVITE sip:alice@ua3.example.com SIP/2.0
Via: SIP/2.0/UDP ua3.example.com;branch=z9hG4bK4324ea695b5B376A
Via: SIP/2.0/UDP proxy.example.com;branch=z9hG4bK38432ji
From: &lt;sip:carol@example.com&gt;;tag=94183CB-BCEAB7
To: &lt;sip:alice@example.com&gt;
CSeq: 106 INVITE
Call-ID: 47deb849-dca8b6c6-3d342
Contact: &lt;sip:carol@ua3.example.com&gt;
Max-Forwards: 69
Alert-Info: &lt;file://ring.pcm&gt;;alert=normal;appearance=0
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980499 1102980499 IN IP4 ua3.example.com
s=
c=IN IP4 ua3.example.com
t=0 0
a=sendrecv
m=audio 2238 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000


F3 Proxy ----&gt; Alice

INVITE sip:alice@ua1.example.com SIP/2.0
Via: SIP/2.0/UDP ua3.example.com;branch=z9hG4bK4324ea695b5B376A
Via: SIP/2.0/UDP proxy.example.com;branch=z9hG4bK348281
From: &lt;sip:carol@example.com&gt;;tag=94183CB-BCEAB7
To: &lt;sip:alice@example.com&gt;
CSeq: 106 INVITE
Call-ID: 47deb849-dca8b6c6-3d342
Contact: &lt;sip:carol@ua3.example.com&gt;
Max-Forwards: 69
Alert-Info: &lt;file://ring.pcm&gt;;alert=normal;appearance=0
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1102980499 1102980499 IN IP4 ua3.example.com
s=
c=IN IP4 ua3.example.com
t=0 0
a=sendrecv
m=audio 2238 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000



F17 - F20: Bob notifies the Appearance Agent with dialog state
payload indicating the dialog in confirmed state. Appearance
Agent notifies Alice of the status of the dialog at Bob.

F17 Bob ----&gt; Appearance Agent

NOTIFY sip:sa@stateagent.example.com SIP/2.0
Via: SIP/2.0/UDP ua2.example.com;branch=z9hG4bK58a0dd68C2D63263
From: &lt;sip:bob@example.com&gt;;tag=558C18F7-DB9DF7BC
To: &lt;sip:alice@example.com&gt;;tag=1894685100249086
CSeq: 14 NOTIFY
Call-ID: 77-505889516@example.com
Contact: &lt;sip:bob@ua2.example.com&gt;
Event: dialog
User-Agent: XYZ-UA/4.5.6
Subscription-State: active;expires=3427
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
       xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
       version="13"
       state="partial"
       entity="sip:alice@example.com"&gt;
   &lt;dialog id="ida0f8dc17"
        call-id="14-1541707345@example.com"
        local-tag="44BAD75D-E3128D42"
        remote-tag="d3b06488-1dd1-11b2-88c5-b03162323164+d3e48f4c"
        direction="recipient"&gt;

      &lt;sa:appearance&gt;0&lt;/appearance&gt;
      &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
      &lt;state&gt;confirmed&lt;/state&gt;
      &lt;local&gt;
        &lt;target uri="sip:alice@example.com"&gt;
            &lt;param pname="+sip.rendering" pval="yes"/&gt;
        &lt;/target&gt;
      &lt;/local&gt;
      &lt;remote&gt;
        &lt;identity&gt;sip:carol@ua.example.com&lt;/identity&gt;
      &lt;/remote&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;


F19 Appearance Agent ----&gt; Alice

NOTIFY sip:alice@ua1.example.com SIP/2.0
From: &lt;sip:alice@example.com&gt;;tag=151702541050937
To: &lt;sip:alice@example.com&gt;;tag=18433323-C3D237CE
Call-ID: 1e361d2f-a9f51109-bafe31d4@ua1.example.com
CSeq: 12 NOTIFY
Via: SIP/2.0/UDP stateagent.example.com;branch=z9hG4bK14031499568413
Max-Forwards: 70
Content-Type: application/dialog-info+xml
Event: dialog
Subscription-State: active
Contact: &lt;sip:sa@stateagent.example.com&gt;
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="13"
             state="partial"
             entity="sip:alice@example.com"&gt;
   &lt;dialog id="2a7294823093f5274e3fd2ec54a2d76c"
        call-id="14-1541707345@example.com"
        local-tag="44BAD75D-E3128D42"
        remote-tag="d3b06488-1dd1-11b2-88c5-b03162323164+d3e48f4c"
        direction="recipient"&gt;
      &lt;sa:appearance&gt;0&lt;/appearance&gt;
      &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
      &lt;state&gt;confirmed&lt;/state&gt;
	 &lt;local&gt;
        &lt;target uri="sip:alice@example.com"&gt;
           &lt;param pname="+sip.rendering" pval="yes"/&gt;
        &lt;/target&gt;
      &lt;/local&gt;
      &lt;remote&gt;
        &lt;identity&gt;sip:carol@ua.example.com&lt;/identity&gt;
      &lt;/remote&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;


</pre></div>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.5"></a><h3>10.5.&nbsp;
Appearance Publication</h3>

<p>
This call flow shows the use of PUBLISH between the members of the appearance group and the Appearance Agent.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Carol        Proxy           Alice      Appearance Agent         Bob
  |              |               |              |                  |
  |              |               |              |&lt;----- PUBLISH F1&lt;|
  |              |               |              |                  |
  |              |               |              |&gt;F2 200 OK ------&gt;|
  |              |               |              |                  |
  |              |               |&lt;-- NOTIFY F3&lt;|                  |
  |              |               |              |                  |
  |              |               |&gt;F4 200 OK --&gt;|                  |
  |              |               |              |                  |
  |              |&lt;------------------------------------- INVITE F5&lt;|
  |              |               |              |                  |
  |&lt;-- INVITE F6&lt;|               |              |                  |
  |              |               |              |                  |
  |&gt;F7 180 Ring &gt;|               |              |                  |
  |              |&gt;F8 180 Ringing --------------------------------&gt;|
  |&gt;F9 200 OK --&gt;|               |              |                  |
  |              |&gt;F10 200 OK ------------------------------------&gt;|
  |              |               |              |                  |
  |&lt;------------------------------------------------------ ACK F11&lt;|
  |              |               |              |                  |
  |&lt;================= Both way RTP established ===================&gt;|
  |              |               |              |                  |
  |              |               |              |&lt;---- PUBLISH F12&lt;|
  |              |               |              |                  |
  |              |               |              |&gt;F13 200 OK -----&gt;|
  |              |               |&lt;- NOTIFY F14&lt;|                  |
  |              |               |              |                  |
  |              |               |&gt;F15 200 OK -&gt;|                  |
  |              |               |              |                  |
  |              |&lt;------------------------------(hold) INVITE F16&lt;|
  |&lt;- INVITE F17&lt;|               |              |                  |
  |              |               |              |                  |
  |&gt;F18 200 OK -&gt;|               |              |                  |
  |              |&gt;F19 200 OK ------------------------------------&gt;|
  |              |               |              |                  |
  |&lt;------------------------------------------------------ ACK F20&lt;|
  |              |               |              |                  |
  |              |               |              |&lt;---- PUBLISH F21&lt;|
  |              |               |              |                  |
  |              |               |              |&gt;F22 200 OK -----&gt;|
  |              |               |&lt;- NOTIFY F23&lt;|                  |
  |              |               |              |                  |
  |              |               |&gt;F24 200 OK -&gt;|                  |
  |              |&lt;-- INVITE F25&lt;|              |                  |
  |&lt;- INVITE F26&lt;|(w/ Replaces)  |              |                  |
  |( w/ Replaces)|               |              |                  |
  |&gt;F27 200 OK -&gt;|               |              |                  |
  |              |&gt;F28 200 OK --&gt;|              |                  |
  |              |               |              |                  |
  |&lt;-------------------- ACK F29&lt;|              |                  |
  |              |               |              |                  |
  |&lt;= Both way RTP established =&gt;|              |                  |
  |              |               |              |                  |
  |&gt;F30 BYE ----&gt;|               |              |                  |
  |              |&gt;F31 BYE ---------------------------------------&gt;|
  |              |               |              |                  |
  |              |&lt;------------------------------------ OK 200 F32&lt;|
  |&lt;- 200 OK F33&lt;|               |              |                  |
  |              |               |              |                  |
  |              |               |              |&lt;---- PUBLISH F34&lt;|
  |              |               |              |                  |
  |              |               |              |&gt;F35 200 OK -----&gt;|
  |              |               |&lt;- NOTIFY F36&lt;|                  |
  |              |               |              |                  |
  |              |               |&gt;F37 200 OK -&gt;|                  |
  |              |               |              |                  |
  |              |               |&gt;F38 PUBLISH &gt;|                  |
  |              |               |              |                  |
  |              |               |&lt;- 200 OK F39&lt;|                  |
  |              |               |              |&gt;F40 NOTIFY -----&gt;|
  |              |               |              |                  |
  |              |               |              |&lt;----- 200 OK F41&lt;|
  |&gt;F42 BYE ----&gt;|               |              |                  |
  |              |&gt;F43 BYE -----&gt;|              |                  |
  |              |               |              |                  |
  |              |&lt;-- 200 OK F44&lt;|              |                  |
  |&lt;--200 OK F45&lt;|               |              |                  |
  |              |               |&gt;F46 PUBLISH &gt;|                  |
  |              |               |              |                  |
  |              |               |&lt;- 200 OK F47&lt;|                  |
  |              |               |              |&gt;F48 NOTIFY -----&gt;|
  |              |               |              |                  |
  |              |               |              |&lt;----- OK 200 F49&lt;|

Figure 6.

</pre></div>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.6"></a><h3>10.6.&nbsp;
Joining an Appearance</h3>

<p>
In this call flow, a call answered by Bob is joined by Alice or "bridged".  The Join header field is used by Alice to request this bridging.  If Bob did not support media mixing, Bob could obtain conferencing resources as described in <a class='info' href='#RFC4579'>[RFC4579]<span> (</span><span class='info'>Johnston, A. and O. Levin, &ldquo;Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents,&rdquo; August&nbsp;2006.</span><span>)</span></a>.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Carol    Forking Proxy Appearance Agent  Alice      Bob
  |            |             |             |         |
  |&gt;F1 INVITE &gt;|             |             |         |
  |            |&gt;F2 INVITE -------------------------&gt;|
  |            |             |             |         |
  |            |&gt;F3 INVITE ---------------&gt;|         |
  |            |             |             |         |
  |&lt;-100Try F4&lt;|             |             |         |
  |            |             |             |         |
  |            |&lt;-------------------- Ringing 180 F5&lt;|
  |&lt;180Ring F6&lt;|             |             |         |
  |            |&lt;---------- Ringing 180 F7&lt;|         |
  |&lt;180Ring F8&lt;|             |             |         |
  |            |&lt;------------------------- 200 OK F9&lt;|
  |&lt;-200OK F10&lt;|             |             |         |
  |            |             |             |         |
  |            |&gt;F11 CANCEL --------------&gt;|         |
  |            |             |             |         |
  |            |&lt;-------------- 200 OK F12&lt;|         |
  |            |             |             |         |
  |            |&lt;Request Cancelled 487 F13&lt;|         |
  |            |             |             |         |
  |            |&gt;F14 ACK -----------------&gt;|         |
  |&gt;F15 ACK --&gt;|             |             |         |
  |            |&gt;F16 ACK ---------------------------&gt;|
  |            |             |             |         |
  |&lt;=============Both way RTP established===========&gt;|
  |            |             |             |         |
  |            |             |&lt;---------- NOTIFY F17&lt;|
  |            |             |             |         |
  |            |             |&gt;F18 200 OK ----------&gt;|
  |            |             |             |         |
  |            |             |&gt;F19 NOTIFY &gt;|         |
  |            |             |             |         |
  |            |             |&lt;- 200OK F20&lt;|         |
  |            |             |             |         |
  |            |&lt;---- INVITE (w/ Join) F21&lt;|         |
  |            |             |             |         |
  |            |&gt;F22 INVITE (w/Join)----------------&gt;|
  |            |             |             |         |
  |            |&lt;---- OK 200 Contact:Bob;isfocus F23&lt;|
  |            |             |             |         |
  |            |&gt;F24 200 OK Contact:Bob;isfocus-----&gt;|
  |            |             |             |         |
  |            |&lt;----------------- ACK F25&lt;|         |
  |            |             |             |         |
  |            |&gt;ACK F26----------------------------&gt;|
  |            |             |             |         |
  |            |&lt;-----INVITE Contact:Bob;isfocus F27&lt;|
  |&lt;-INVITE F28|             |             |         |
  |&gt;F29 200 --&gt;|             |             |         |
  |            |&gt;F30 200 OK ------------------------&gt;|
  |            |             |             |         |
  |            |&lt;--------------------------- ACK F31&lt;|
  |&lt;--- ACK F32|             |             |         |
  |            |             |             |&lt;==RTP==&gt;|
  |&lt;=============Both way RTP established===========&gt;|

Figure 7.

F21 Alice ----&gt; Proxy

INVITE sip:bob@ua.example.com SIP/2.0
Via: SIP/2.0/UDP ua1.example.com;branch=z9hG4bKcc9d727c2C29BE31
From: &lt;sip:alice@example.com&gt;;tag=605AD957-1F6305C2
To: &lt;sip:bob@ua.example.com&gt;
CSeq: 2 INVITE
Call-ID: dc95da63-60db1abd-d5a74b48@ua1.example.com
Contact: &lt;sip:alice@ua1.example.com&gt;
User-Agent: ABC-UA/1.2.3
P-Preferred-Identity: &lt;sip:alice@example.com&gt;
&lt;all-one-line&gt;
Join: 14-1541707345@example.com;to-tag=d3b06488-1dd1-11b2-88c5
-b03162323164+d3e48f4c;from-tag=44BAD75D-E3128D42
&lt;/all-one-line&gt;
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: 223

v=0
o=- 1103061265 1103061265 IN IP4 ua1.example.com
s=IP SIP UA
c=IN IP4 ua1.example.com
t=0 0
a=sendrecv
m=audio 2236 RTP/AVP 0 8 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:101 telephone-event/8000

</pre></div>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.7"></a><h3>10.7.&nbsp;
Appearance Allocation - Loss of Subscription with UA</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   UA           Appearance Agent         UA1              UA2
   |                |                |                |
   |                | F1: NOTIFY (trying)             |
   |                |&lt;---------------|                |
   |                | F2: 200 OK     |                |
   |                |---------------&gt;|                |
   |                | F3: NOTIFY (trying)             |
   |                |----------------+---------------&gt;|
   |                | F4: 200 OK     |                |
   |                |&lt;---------------+----------------|
   | F5: INVITE     |                |                |
   |&lt;--------------------------------|                |
   | F6: 180 Ringing|                |                |
   |--------------------------------&gt;|                |
   |                |                |                |
   |                |               End               |
   |                |                                 |
   |                |                                 |
   |                | F7: SUBSCRIBE x 6 retries       |
   |                |---------------&gt;                 |
   |                |                                 |
   |                | F8: NOTIFY (terminated)         |
   |                |--------------------------------&gt;|
   |                | F9: 200 OK                      |
   |                |&lt;--------------------------------|
   |                |                                 |

Figure 8.

</pre></div>
<p>
The flow shown in this figure illustrates the failure of a user agent after it has obtained an appearance number (F1-F2). Messages used to refresh the subscription from Appearance Agent to UA1 are shown at F7. When the Appearance Agent attempts to refresh its subscription but receives no response.  In this case, the Appearance Agent may apply policy and free up the appearance number as it wishes.  In this case, after a delay, the Appearance Agent frees up the appearance number and sends NOTIFY messages (F8) indicating the termination of the dialog associated with the shared line.

</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.8"></a><h3>10.8.&nbsp;
Appearance Selection Contention Race Condition</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   UA       Appearance Agent        UA1              UA2
   |                |                |                |
   |                | F1 NOTIFY (trying appearance=1) |
   |                |&lt;---------------|                |
   |                | F2 NOTIFY (trying appearance=1) |
   |                |&lt;---------------+----------------|
   |                | F3 200 OK      |                |
   |                |---------------&gt;|                |
   |                | F4 200 OK      |                |
   |                |----------------+---------------&gt;|
   |                | F5 NOTIFY  (trying appearance=1)|
   |                |---------------&gt;|                |
   |                | F6 200 OK      |                |
   |                |&lt;---------------|                |
   |                | F7 NOTIFY (trying)              |
   |                |----------------+---------------&gt;|
   |                | F8 200 OK      |                |
   |                |&lt;---------------+----------------|
   | F9 INVITE      |                |                |
   |&lt;--------------------------------|                |
   |                | F10 NOTIFY (trying appearance=2)|
   |                |&lt;---------------+----------------|
   |                | F11 200 OK     |                |
   |                |----------------+---------------&gt;|
   |                | F12 NOTIFY (trying appearance=2)|
   |                |----------------+---------------&gt;|
   |                | F13 200 OK      |               |
   |                |&lt;---------------+----------------|
   | F14 INVITE     |                |                |
   |&lt;-------------------------------------------------|
   |                |                |                |

Figure 9.

</pre></div>
<p>
This figure illustrates two user agents, UA1 and UA2, attempting to select the same appearance number (i.e. seize the same line number) simultaneously. This type of race condition is often referred to in telephony as a glare condition. Appearance Agent may use any desired policy to decide which UA receives the appearance and which does not.  In this case UA1 obtains the appearance number, as indicated by the NOTIFY from the Appearance Agent with the appearance number.  UA2 learns that it did not obtain the appearance number since its NOTIFY does not contain the appearance number from its NOTIFY.

</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p> 
This section registers the SIP Alert-Info header field parameter "appearance" and the XML namespace extensions to the SIP Dialog Package.

</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
SIP Event Package Parameter: sa</h3>

<p>
This specification also defines a new event parameter "sa" for the Dialog Package.

</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
URN Sub-Namespace Registration: sa-dialog-info</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   This section registers a new XML namespace per the procedures in
   [RFC3688].

   URI: urn:ietf:params:xml:ns:sa-dialog-info.

   Registrant Contact: IETF BLISS working group, &lt;bliss@ietf.org&gt;,
   Alan Johnston &lt;alan@sipstation.com&gt;

   XML:

   BEGIN
      &lt;?xml version="1.0"?&gt;
      &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
                "http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd"&gt;
      &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
      &lt;head&gt;
        &lt;meta http-equiv="content-type"
           content="text/html;charset=iso-8859-1"/&gt;
        &lt;title&gt;Shared Appearance Dialog Information Namespace&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;Namespace for Shared Appearance Dialog Information&lt;/h1&gt;
        &lt;h2&gt;urn:ietf:params:xml:ns:dialog-info&lt;/h2&gt;
        &lt;p&gt;See &lt;a href="ftp://ftp.rfc-editor.org/in-notes/rfcXXXX.txt"&gt;
             RFCXXXX&lt;/a&gt;.&lt;/p&gt;
      &lt;/body&gt;
      &lt;/html&gt;
   END
</pre></div>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
XML Schema Registration</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   This section registers an XML schema per the procedures in [RFC3688].

   URI: urn:ietf:params:xml:schesa:sa-dialog-info.

   Registrant Contact: IETF BLISS working group, &lt;bliss@ietf.org&gt;,
    Alan Johnston &lt;alan@sipstation.com&gt;

   The XML for this schema can be found in Section 7.

</pre></div>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Appendix A - Incoming Appearance Assignment</h3>

<p>
To best meet REQ-9, the appearance number for an incoming INVITE should be contained in the INVITE itself. 

</p>
<p> 
For the dialog package parameter approach, REQ-9 could be met in two ways.  When an incoming request is received, the Appearance Agent could send out a NOTIFY with state trying and include the appearance number to be used for this request.  Upon receipt of this NOTIFY, the UAs could begin alerting using the appearance number selected.  This approach is sub-optimal since the UAs could receive the INVITE but be unable to begin alerting if the NOTIFY from the Appearance Agent is delayed or lost

</p>
<p>
An alternative approach is to define an extension parameter for the Alert-Info header field in RFC 3261 such as:

</p>
<p>
Alert-Info: &lt;file://ring.pcm>;alert=normal;appearance=0

</p>
<p>
This Alert-Info header would indicate to place the call on the first line appearance instance.

</p>
<p>
The determination as to what value to use in the appearance parameter can be done at the proxy that forks the incoming request to all the registered UAs. There are a variety of ways the proxy can use to determine what value it should use to populate this parameter. For example, the proxy could fetch this information by initiating a SUBSCRIBE request with Expires: 0 to the Appearance Agent for the AOR to fetch the list of lines that are in use. Alternatively, it could act like a UA that is a part of the appearance group and SUBSCRIBE to the State-Agent like any other UA. This would ensure that the active dialog information is available without having to poll on a need basis. It could keep track of the list of active calls for the appearance AOR based on how many unique INVITE requests it has forked to or received from the appearance AOR. Another approach would be for the Proxy to first send the incoming INVITE to the Appearance Agent which would redirect to the appearance group URI and escape the proper Alert-Info header field for the Proxy to recurse and distribute to the other UAs in the group.

</p>
<p>
The Appearance Agent needs to know about all incoming requests to the AOR in order to select the appearance number.  One way in which this could be done is for the Appearance Agent to register against the AOR with a higher q value.  This will result in the INVITE being sent to the Appearance Agent first, then being offered to the UAs in the group. 

</p>
<p>
The changes to RFC 3261 ABNF would be:

</p>
<p>
alert-param  =  LAQUOT absoluteURI RAQUOT *( SEMI (generic-param / appearance-param) )

</p>
<p>
appearance-param = "appearance" EQUAL *DIGIT

</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Appendix B - Implementation Options Discussion</h3>

<p>
This section discusses some options on how to implement the Shared Appearances feature in SIP.  This section is non-normative.

</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1"></a><h3>13.1.&nbsp;
Appearance Implementation Options</h3>

<p>
This section discusses and compares two methods of implementing,
   conveying, and selecting appearances in SIP while meeting the
   requirements of Section 4.  One approach involves a URI parameter
   and is discussed in section 5.1.1.  The other approach uses a SIP
   dialog package extension parameter and is discussed in section
   5.1.2.  Both approaches assume the common elements and operations
   of Figure 1.  In addition, this section discusses approaches for incoming appearance indication, REQ-9, and appearance contention, REQ-8.  These approaches will be discussed for an example appearance group of N phones each with n line appearances.  The usage of the word phone does not imply that this feature is limited to telephony devices.

</p>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.1"></a><h3>13.1.1.&nbsp;
URI parameter Approach</h3>

<p>
Some implementations of this feature utilize a URI parameter such as "line=3" on the Contact URI.  Each appearance is effectively a logical UA, so each line appearance requires a separate registration.  The number of line appearances needs to be provisioned on each phone.  Each appearance also requires a separate dialog package subscription.  Even using a State Agent for the dialog package, each phone must maintain n subscriptions to the dialog package. 

</p>
<p>
This results in 2nN total subscriptions and nN registrations for this implementation.

</p>
<p>
Since Contact URI parameters will be conveyed by the dialog package, REQ-7 is met. 

</p>
<p>
REQ-10 can be met by having the Appearance Agent send a SUBSCRIBE to each UA and line number to obtain the current dialog state - this will result in nN SUBSCRIBEs and NOTIFYs.  

</p>
<p>
It is not obvious how to meet REQ-11 with this approach.  A UA registering against the AOR but does not implement the appearance URI parameter will not include a line appearance number in Contact URIs and dialog package NOTIFYs.  The Appearance Agent will have no way of indicating to the other UAs the appearance number being used by this UA, as adding a parameter to the Contact URI would cause call control operations such as Replaces and Join to fail.

</p>
<p>
REQs 12 and 13 are difficult to meet with this approach as the line appearance number will be present in the Request-URI of incoming requests and the Contact URI in INVITE and 200 OK messages.  This approach will require integrity protection of all dialog creating requests and responses, and privacy mechanisms to hide the Contact URI from other UAs.

</p>
<p>
Also, this approach will require mechanisms to protect against another UA sending an INVITE directly to a group member with the line appearance number already set.

</p>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.2"></a><h3>13.1.2.&nbsp;
Dialog Package Parameter</h3>

<p>
Instead of the URI parameter approach, consider an extension parameter "appearance" to the SIP dialog package.  The e.g.:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
             xmlns:sa="urn:ietf:params:xml:ns:sa-dialog-info"
             version="6"
             state="partial"
             entity="sip:alice@example.com"&gt;
   &lt;dialog id="id3d4f9c83" from-tag="3423" to-tag="a3f423j88uju1"
                                                     direction="initiator"&gt;
       &lt;sa:appearance&gt;2&lt;/appearance&gt;
       &lt;sa:exclusive&gt;false&lt;/exclusive&gt;
       &lt;sa:joined-dialog call-id="sdfg" from-tag="832d1" to-tag="4542454" /&gt;
       &lt;sa:joined-dialog call-id="873287876" from-tag="433" to-tag="jwjwuf5" /&gt;
       &lt;state&gt;connected&lt;/state&gt;
       &lt;local&gt;
           &lt;target uri="sip:bob@pc.example.com" /&gt;
       &lt;/local&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;
...
</pre></div>
<p>
In this approach, the appearance number is never carried in a Request-URI or Contact URI.  Instead, it is only present in dialog package NOTIFY and PUBLISH messages.  As a result, only a single registration per AOR is required.  Also, only a single dialog package subscription in each direction per AOR.

</p>
<p>
This results in 2N total subscriptions and N registrations for this approach.

</p>
<p>
If the dialog package is extended to carry the appearance number, then REQ-7 is met. 

</p>
<p>
REQ-10 can be met by having the Appearance Agent send a SUBSCRIBE to each UA and line number to obtain the current dialog state - this will result in N SUBSCRIBEs and NOTIFYs.  

</p>
<p>
REQ-11 can be met by this approach.  Even though a UA does not provide an appearance number in dialog package NOTIFYs, the Appearance Agent can assign one and include it in NOTIFYs to the other UAs.  This parameter would simply be ignored by the UAs that did not understand the parameter, and have no impact on call control operations.

</p>
<p>
REQs 12 and 13 are met because the appearance number is only conveyed in dialog package NOTIFYs.  Integrity and privacy of NOTIFY bodies can be achieved using normal SIP mechanisms independent of the security mechanisms used for other requests.

</p>
<p>
The dialog-package <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>  describes a mechanism whereby shared-line privacy REQ-14
can be accomplished by suppressing certain dialog information from being
presented to the UAs. The reasoning behind that is if the UAs were
unaware of a dialog's call-id, local-tag and remote-tag then they will
be unable to  create requests such as INVITE with Replaces <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>  and Join <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a> header fields to barge-in or pickup the line appearance. Below is a quote
from section 3.6 of  dialog-package<a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>  that describes this approach:

</p>
<p>

      Note that many implementations of "shared-lines" have a feature
      that allows details of calls on a shared address-of-record to be
      made private.  This is a completely reasonable authorization
      policy that could result in notifications that contain only the id
      attribute of the dialog element and the state element when
      shared-line privacy is requested, and notifications with more
      complete information when shared-line privacy is not requested.

</p>
<p>
There are certain fundamental drawbacks in the privacy-by-obscurity
approach described in <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> . It models exclusivity as a static property of
the appearance AOR. There are situations where exclusivity needs to be a
dynamic property (e.g. boss does not want secretary to listen-in on a
particular part of the conversation). In addition, <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>  does not address
how a UA can request exclusivity at the start of a session or
mid-session and how that request will be granted or rejected. 

</p>
<p>
Exclusivity being a dynamic property means that a UA can request it to
be turned on or off in the middle of a session. When exclusivity is
turned off all the UAs that share the line AOR will need to see the
complete dialog information. Once they have that information it can not
be taken back from them. This will not allow exclusivity to be turned on
later on in the dialog lifetime. Therefore, there needs to be a
centralized entity that will actually enforce exclusivity.

</p>
<p>
The approach proposed for meeting REQ-14 is to include an exclusivity parameter to the dialog package.  This allows a UA to request exclusivity, by setting the exclusive parameter in notifications.  This could be done prior to a call being made or answered, or during a call at any time.  A UA can remove exclusivity by sending a notification at any time during a call and setting "exclusive=no". It also allows a UA to learn that a particular dialog is exclusive by the presence of this parameter in a NOTIFY.  In addition, a UA can still apply policy to any INVITE Join or Replaces requests it receives, as per normal SIP call control mechanisms.

</p>
<p>
With this approach, the number of appearances is centrally managed and controlled by the Appearance Agent.  For UAs with soft keys or buttons, this gives a great deal of flexibility in system management.

</p>
<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.3"></a><h3>13.1.3.&nbsp;
Appearance Selections Mechanisms</h3>

<p>
Regardless of how the appearance number is conveyed by UAs, there is still the issue of how appearance numbers are selected.  For example, some UAs might have actual buttons and lamps, and pressing a particular button requires the UA to reserve a particular appearance number.  For devices with this type of user interface, the selection must be done before the user continues with the call and dials digits or a URI.  Other UAs with different user interfaces can be flexible at the time of dialing, updating the display with the appearance number at a later date.  For devices which require advance appearance selection, there are three options discussed in the following sections for meeting REQ-15.

</p>
<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.3.1"></a><h3>13.1.3.1.&nbsp;
Floor Control Appearance Selection Mechanism</h3>

<p>

This approach models each appearance number as a floor (shared resource) and uses a floor control server to arbitrate exclusive access (seizure of a particular appearance number).  This approach uses a standard SIP Event State Compositor (ESC), a standard Floor Control Server that uses the Appearance Agent as Moderator.   The Binary Floor Control Protocol (BFCP) is used between the UAs and the Floor Control Server.   A Registrar/Forking Proxy Server talks to Appearance Agent about incoming calls.  The Appearance Agent acts as a Moderator for the floor control server and tells forking proxy to insert the appearance number in incoming and outgoing requests.

</p>
<p>
Appearance numbers are allocated/selected/reserved in two ways:

</p>
<p>

For incoming calls, the Forking Proxy interacts with the Appearance Agent.  The Appearance Agent selects an appearance by taking a particular floor and marking it "moderator controlled".  This appearance number is then included by the Forking Proxy in INVITEs using the Alert-Info parameter.  When a UA answers the call, it takes the appearance number from the Alert-Info and includes it in the dialog state publication.  It then requests the floor associated with the appearance number from the floor control server, which forwards the request to the Appearance Agent (moderator).  The Appearance Agent correlates the floor control request with the dialog state notification with the dialog ID from the INVITE with the Alert-Info.  If they match, the floor is granted.  If they do not match, it means the floor request is not an answer of the call but is a random appearance selection by the UA and will be rejected.

</p>
<p>
For outgoing calls, the UA sends an INVITE and requests a particular floor from the floor control server.  Depending on the User Interface requirements, the floor request can be done before or after sending the INVITE.  The floor grant policy for most appearances is set to "first come first serve".  Once the floor has been granted and the call answered, the dialog state publication by the UA will include the appearance number.

</p>
<p>
When a call has ended, the UA releases the floor to the floor control server and this appearance is now available for incoming and outgoing calls.

</p>
<p>
When a UA in the group which does not support BFCP is in a call, the Appearance Agent will grant the floor associated with that appearance to that UA.  When that call is over, the Appearance Agent will release the floor.  Since the UA will not publish the appearance number to the ESC, the Appearance Agent will need to do that on their behalf.  If the UA does publish dialog state but without the appearance number, the Appearance Agent will still need to re-publish the dialog state including the appearance number.  UAs in the group will be able to recognize these two dialogs as one since they will have the same SIP dialog ID.

</p>
<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.3.2"></a><h3>13.1.3.2.&nbsp;
INVITE Appearance Selection Mechanism</h3>

<p>
This is an alternative approach that utilizes sending an INVITE to 
select/reserve/seize an appearance number.

</p>
<p>
A UA that does not need to select a particular appearance number (or 
doesn't care) would just send an INVITE as normal.    The Appearance 
Agent would tell the proxy which appearance number was being used by 
inserting this information in a header field in the first non-100 provisional response sent back 
to the calling UA.  The UA would then PUBLISH this appearance number to 
the Dialog Event State Compositor for the AOR which would distribute 
details of the dialog and the appearance number to the other UAs in the 
group.

</p>
<p>
If an INVITE is sent and no appearance number is available, the proxy 
would reject the INVITE with a suitable response code and perhaps a 
header field indication.

</p>
<p>
A UA that does need to select a particular appearance number would use 
an approach similar to overlap dialing (multi-stage dialing).  An INVITE 
would be sent when the appearance number is requested (i.e. when the 
button is pressed, before dialing begins).  The appearance number 
selected would be carried in the INVITE, in a header field or in the Request-URI, for 
example.  The proxy would reject the INVITE with a 484 Address 
Incomplete response (see RFC 3578) if the appearance number is 
Available and start a timer.  The UA could then resend the INVITE after the URI has been 
dialed and then PUBLISH this appearance number to the ESC.  If the 
appearance number is not available, another response code such as 403 
would be sent.  The user could then select a different appearance number 
and resend the INVITE.  If no INVITE with a matching Call-ID is received before the timer expires, the appearance seizure is cancelled and is made available for other calls.

</p>
<p>
Note that this approach does not actually require a B2BUA, but it does 
require a proxy that can act as a UAS and communicate with an Appearance 
Agent which keeps track of appearance number allocations.

</p>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.1.3.3"></a><h3>13.1.3.3.&nbsp;
PUBLISH Appearance Selection Mechanism</h3>

<p>
The approach used in previous versions of this draft is to use the PUBLISH to the event state compositor to select an appearance number.  This approach requires a special event state compositor and special behavior on the part of the UA.

</p>
<p>
In the selection of an appearance for requests initiated by UAs in the group, there is the possibility of contention where more than one UA select the same appearance number.    

</p>
<p>
One way to solve this and meet REQ-8 is to require UAs to send a notification (trying) to the Appearance Agent indicating the appearance number to be used for the session.  The Appearance Agent would confirm the allocation of the appearance number in a NOTIFY sent to the group UAs.  Should the appearance number be unavailable or otherwise not allowed, there are two options:

</p>
<p>
- The notification could be rejected with a 500 response and a Retry-After header field.  The Appearance Agent would send an immediate NOTIFY indicating that the appearance is unavailable. If the NOTIFY is received before the expiration of the Retry-After time, the notification state information would become out of date and would be discarded without resending.  The UA would select another appearance number and send another notification.

</p>
<p>
- The notification could be accepted but an immediate NOTIFY generated by the Appearance Agent indicating that the appearance is unavailable.  The UA would then select another appearance number and PUBLISH again.

</p>
<p>
UAs would wait for a notification from the Appearance Agent before sending the INVITE.

</p>
<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.2"></a><h3>13.2.&nbsp;
Comparison</h3>

<p>
In comparing the URI parameter and the dialog package parameter, there are clear differences in the number of registrations and subscriptions, with the dialog package approach requiring n times fewer in both cases.

</p>
<p>
The security model for the dialog package parameter approach is much cleaner, since only NOTIFY and PUBLISH requests need integrity and privacy.  The security model for the URI parameter approach would likely require a B2BUA which introduces many undesirable properties.

</p>
<p>
The dialog package parameter approach has better backwards compatibility than the URI parameter approach.

</p>
<p>
In summary, the dialog package parameter approach better meets REQs 5, 10, 11, 12, and 13 while the URI parameter approach better meets REQ-9.  However, the combined dialog package parameter approach and the Alert-Info parameter approach meets REQ-9.

</p>
<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13.2.1"></a><h3>13.2.1.&nbsp;
Comparison of Appearance Selection Methods</h3>

<p>
All three approaches meet REQ-15 and REQ-16.

</p>
<p>
Previous versions of this draft proposed the publish/notify method of appearance selection.  The advantage of this approach is that the appearance number is only carried in one place (dialog package XML documents) and the same protocol/mechanism is used to select and learn appearance numbers.  The disadvantage of this approach is that a specialized event state compositor must be used, since it is aware of appearance numbers.  Also, concerns have been raised about whether this approach defines new semantics for publish/notify beyond that in RFC 3265.

</p>
<p>
The floor control approach makes good reuse of existing protocols such as Binary Floor Control Protocol (BFCP) and cleanly models the state.  However, while BFCP can be used in conferencing applications, it is unlikely most UAs implementing shared appearances would utilize the protocol.  Also, having appearance state in two places (dialog package XML documents and floor control messages) complicates the application.  Also, BFCP only runs over TCP and requires a separate offer/answer exchange to establish the connection, making operation through NATs and firewalls more difficult.  The BFCP approach is also radically different from all current implementations of this feature.  As a result, standardizing this approach would likely result in an increase in feature interoperability rather than a decrease.

</p>
<p>
The INVITE selection mechanism is based on overlap dialing.  Overlap dialing is supported in very few SIP UAs and is regarded as a somewhat archaic leftover from the PSTN.  As such, it is not regarded as a good starting point for a common feature such as shared appearances.

</p>
<p>
The PUBLISH selection mechanism reuses the SIP events extensions which already must be implemented by UAs supporting this feature.  In fact, it results in no additional messages or round trips.  It is also very similar to many current feature implementations today.  Standardizing this approach is likely to increase overall interoperability of this feature.

</p>
<p>
The rest of this document will only discuss the PUBLISH appearance selection mechanism.

</p>
<a name="anchor53"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Acknowledgements</h3>

<p>
The following individuals were part of the SA Design team and have
   provided input and text to the document (in alphabetical order):

</p>
<p>
   Martin Dolly, Andrew Hutton, Raj Jain, Fernando Lombardo, Derek MacDonald,
   Bill Mitchell, Michael Procter, Theo Zowzouvillys.

</p>
<p>
   Thanks to Chris Boulton for helping with the XML schema.  

</p>
<p>
   Much of the material has been drawn from previous work by Mohsen 
   Soroushnejad, Venkatesh Venkataramanan, Paul Pepper and Anil Kumar,
   who in turn received assistance from:

</p>
<p>
   Kent Fritz, John Weald, and Sunil Veluvali of Sylantro Systems, 
   Steve Towlson, and Michael Procter of Citel Technologies, 
   Rob Harder and Hong Chen of Polycom Inc, 
   John Elwell, J D Smith of Siemens Communications, 
   Dale R. Worley of Pingtel, 
   Graeme Dollar of Yahoo Inc.

</p>
<p>
   Also thanks to Geoff Devine, Paul Kyzivat, Jerry Yin, John Elwell,
   Dan York, Spenser Dawkins, and Martin Dolly for their comments.

</p>
<a name="anchor54"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Security Considerations</h3>

<p>
Since multiple line appearance features are implemented using semantics provided by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, Event Package for Dialog State as define in , and Event Notification <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>, <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>,  security considerations in these documents apply to this draft as well.

</p>
<p>
Specifically, since dialog state information and the dialog identifiers are supplied by UA's in an appearance group to other members, the same is prone to "call hijacks". For example, a rogue UA could snoop for these identifiers and send an INVITE with Replaces header containing these call details to take over the call. As such INVITES with Replaces header MUST be authenticated using the standard mechanism (like Digest or S/MIME) described in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. before it is accepted. NOTIFY message bodies that provide the dialog state information and the dialog identifiers MAY be encrypted end-to-end using the standard mechanics.
All SUBSCRIBES between the UA's and the Appearance Agent MUST be authenticated. 

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>16.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3515">[RFC3515]</a></td>
<td class="author-text">Sparks, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3515">The Session Initiation Protocol (SIP) Refer Method</a>,&rdquo; RFC&nbsp;3515, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3515.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3265">[RFC3265]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3903">[RFC3903]</a></td>
<td class="author-text">Niemi, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3903">Session Initiation Protocol (SIP) Extension for Event State Publication</a>,&rdquo; RFC&nbsp;3903, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3903.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3891">[RFC3891]</a></td>
<td class="author-text">Mahy, R., Biggs, B., and R. Dean, &ldquo;<a href="http://tools.ietf.org/html/rfc3891">The Session Initiation Protocol (SIP) "Replaces" Header</a>,&rdquo; RFC&nbsp;3891, September&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3891.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sipping-service-examples">[I-D.ietf-sipping-service-examples]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-service-examples-15.txt">Session Initiation Protocol Service Examples</a>,&rdquo; draft-ietf-sipping-service-examples-15 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-service-examples-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4235">[RFC4235]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;<a href="http://tools.ietf.org/html/rfc4235">An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4235, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4235.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3680">[RFC3680]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3680">A Session Initiation Protocol (SIP) Event Package for Registrations</a>,&rdquo; RFC&nbsp;3680, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3680.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3911">[RFC3911]</a></td>
<td class="author-text">Mahy, R. and D. Petrie, &ldquo;<a href="http://tools.ietf.org/html/rfc3911">The Session Initiation Protocol (SIP) "Join" Header</a>,&rdquo; RFC&nbsp;3911, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3911.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3325">[RFC3325]</a></td>
<td class="author-text">Jennings, C., Peterson, J., and M. Watson, &ldquo;<a href="http://tools.ietf.org/html/rfc3325">Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks</a>,&rdquo; RFC&nbsp;3325, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3325.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4579">[RFC4579]</a></td>
<td class="author-text">Johnston, A. and O. Levin, &ldquo;<a href="http://tools.ietf.org/html/rfc4579">Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents</a>,&rdquo; BCP&nbsp;119, RFC&nbsp;4579, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4579.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3840">[RFC3840]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and P. Kyzivat, &ldquo;<a href="http://tools.ietf.org/html/rfc3840">Indicating User Agent Capabilities in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3840, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3840.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alan Johnston (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avaya</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">St. Louis, MO  63124</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:alan@sipstation.com">alan@sipstation.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mohsen Soroushnejad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sylantro Systems Corp</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mohsen.soroush@sylantro.com">mohsen.soroush@sylantro.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Venkatesh Venkataramanan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sylantro Systems Corp</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vvenkatar@gmail.com">vvenkatar@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Pepper</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Citel Technologies</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:paul.pepper@citel.com">paul.pepper@citel.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Anil Kumar</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yahoo Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:anil@yahoo-inc.com">anil@yahoo-inc.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
