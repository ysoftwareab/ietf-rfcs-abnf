<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>KX509 Kerberized Certificate Issuance Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Protocol Data">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Request Packet">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Reply Packet">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Operation">
<link href="#rfc.section.4" rel="Chapter" title="4 Acknowledgements">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Certificate Cacheing and Deployment Considerations">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Historically Used Extensions">
<link href="#rfc.appendix.Appendix%20C" rel="Chapter" title="Appendix C Issues and Changes from the Previous Draft">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This rfc describes a protocol, called kx509, for using Kerberos tickets to acquire X.509 certificates. These certificates may be used for many of the same purposes as X.509 certificates acquired by other means, but if a Kerberos infrastructure already exists then the overhead of using kx509 may be much less." />
  <meta name="description" content="This rfc describes a protocol, called kx509, for using Kerberos tickets to acquire X.509 certificates. These certificates may be used for many of the same purposes as X.509 certificates acquired by other means, but if a Kerberos infrastructure already exists then the overhead of using kx509 may be much less." />
  <meta name="keywords" content="protocol" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">H. B. Hotz</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Jet Propulsion Laboratory, California Institute of Technology</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">June 10, 2011</td>
</tr>
<tr>
<td class="left">Expires: December 12, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">KX509 Kerberized Certificate Issuance Protocol<br />
  <span class="filename">draft-hotz-kx509-03.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This rfc describes a protocol, called kx509, for using Kerberos tickets to acquire X.509 certificates. These certificates may be used for many of the same purposes as X.509 certificates acquired by other means, but if a Kerberos infrastructure already exists then the overhead of using kx509 may be much less.</p>
<p>While not (previously) standardized, this protocol is already in use at several large organizations, and certificates issued with this protocol are recognized by the International Grid Trust Federation.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 12, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Protocol Data</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Request Packet</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Reply Packet</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Operation</a>
</li>
<li>4.   <a href="#rfc.section.4">Acknowledgements</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Certificate Cacheing and Deployment Considerations</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Historically Used Extensions</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.Appendix%20C">Issues and Changes from the Previous Draft</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The two primary ways of providing cryptographically secure identification on the Internet are Kerberos tickets <a href="#RFC4120">[RFC4120]</a>, and X.509 <a href="#RFC5280">[RFC5280]</a> and <a href="#X.509">[X.509]</a> certificates.</p>
<p id="rfc.section.1.p.2">In practical IT infrastructure where both are in use, it's highly desirable to deploy their support in a way which guarantees they both authoritatively refer to the same entities. There is already a widely-adopted standard for using X.509 certificates to acquire corresponding Kerberos tickets called PKINIT <a href="#RFC4556">[RFC4556]</a>. This rfc describes the kx509 protocol for supporting the symmetric operation of acquiring X.509 certificates using Kerberos tickets.</p>
<p id="rfc.section.1.p.3">The International Grid Trust Federation <a href="#IGTF">[IGTF]</a> supports the use of Short Lived Credential Services <a href="#SLCS">[SLCS]</a> as a means to authenticate for resource usage based on other, native identity stores which an organization maintains.  X.509 certificates issued using the kx509 protocol based on a Kerberos identity is one of the recognized Credential Services. The certificate profile for that use is outside the scope of this RFC, but is described in <a href="#GRID-prof">[GRID-prof]</a>.</p>
<p id="rfc.section.1.p.4">In normal operation kx509 can be used after a Kerberos ticket-granting-ticket (TGT) is acquired, which is most likely during user login. First, the client generates a RSA public/private key-pair.  Next, using the Kerberos ticket-granting-ticket, it acquires a Kerberos service ticket for the KCA (Kerberized Certificate Authority), and uses this to send the public half of its key-pair. The KCA will decrypt the service ticket, verify the integrity of the incoming packet, determine the identity of the user, and use the session key to send back a corresponding X.509 certificate.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Protocol Data</h1>
<p id="rfc.section.2.p.1">The protocol consists of a single request/reply exchange using UDP.</p>
<p id="rfc.section.2.p.2">Both the request and the reply packet begin with four bytes of version ID information, followed by a DER encoded ASN.1 message. The first two bytes of the version ID are reserved. They MUST be set to zero when sent, and SHOULD be ignored when received. The third and fourth bytes are the major and minor version numbers. The version of the protocol described in this document is designated 2.0, so the first four bytes of the packet are 0, 0, 2, 0.</p>
<p id="rfc.section.2.p.3">Incompatible variations of this protocol MUST use a different major version number.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Request Packet</h1>
<p id="rfc.section.2.1.p.1">The request consists of a version ID, followed by a DER encoded ASN.1 message containing a Kerberos AP_REQ, integrity check data on the request, and public key generated by the client. The ASN.1 encoding is:</p>
<p></p>
<div id="#rfc.figure.1"></div>
<pre>KX509Request ::= SEQUENCE {
        ap-req OCTET STRING,
        pk-hash OCTET STRING,
        pk-key OCTET STRING,
        client-version VisibleString OPTIONAL
}</pre>
<p id="rfc.section.2.1.p.3">The ap-req is as described in <a href="#RFC4120">[RFC4120]</a> Section 5.5.1.</p>
<p id="rfc.section.2.1.p.4">The pk-hash is HMAC using SHA-1 as the underlying hash. All 160 bits are sent. The key used is the Kerberos session key. The data is the 4-byte version ID and the octet string for pk-key.</p>
<p id="rfc.section.2.1.p.5">The pk-key contains a public key. This key and its corresponding private key are generated by the client before contacting the server.  Implementations of this protocol MUST support RSA keys, in which case the key is a DER encoded RSAPublicKey as defined in <a href="#RFC3447">[RFC3447]</a>, section A.1.1, and then stored in this octet string in the request. Use of other public-key types is not defined.</p>
<p id="rfc.section.2.1.p.6">The optional client-version is described in Appendix B. It does not seem to be used in practice and should be omitted for that reason.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Reply Packet</h1>
<p id="rfc.section.2.2.p.1">The reply consists of a version ID, followed by a DER encoded ASN.1 message containing an error code, and an optional authentication hash, optional certificate, and optional error text. The service SHOULD return replies of the same version as the request where possible.</p>
<p></p>
<div id="#rfc.figure.2"></div>
<pre>KX509Response ::= SEQUENCE {
        error-code[0] INTEGER DEFAULT 0,
        hash[1] OCTET STRING OPTIONAL,
        certificate[2] OCTET STRING OPTIONAL,
        e-text[3] VisibleString OPTIONAL
}</pre>
<p id="rfc.section.2.2.p.3">Although the format of the reply contains independently optional objects, the server MUST only generate replies with one of the following allowed combinations.</p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left"></th>
<th class="left"></th>
<th class="left"></th>
<th class="left"></th>
</tr></thead>
<tbody>
<tr>
<td class="left"></td>
<td class="left">hash</td>
<td class="left">certificate</td>
<td class="left"></td>
</tr>
<tr>
<td class="left">error-code</td>
<td class="left">hash</td>
<td class="left"></td>
<td class="left">e-text</td>
</tr>
<tr>
<td class="left">error-code</td>
<td class="left"></td>
<td class="left"></td>
<td class="left">e-text</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.2.p.4">The first case is returned when the server successfully generates a certificate for the user. The certificate is a DER encoded Certificate as defined in <a href="#RFC5280">[RFC5280]</a> Section A, page 116.</p>
<p id="rfc.section.2.2.p.5">The second case is returned when the server successfully authenticates the user and their key, but is unable for some other reason to generate a certificate.</p>
<p id="rfc.section.2.2.p.6">The third case MAY be returned if the server is unable to successfully authenticate the user and intends to return some unauthenticated information to the client.</p>
<p id="rfc.section.2.2.p.7">The hash on a response is computed using SHA-1 HMAC as for the request. The data that is hashed is the concatenation of the 4-byte version ID at the beginning of the packet, the error-code (if present), and all other optional fields which are present except the hash itself. In other words, the hash is computed on the fields which are present exclusive of the overall ASN.1 wrapping. The e-text MAY be translated into other character sets for display purposes, but the hash is computed on the e-text in its VisibleString representation.</p>
<p id="rfc.section.2.2.p.8">If the e-text contains NUL characters, the client MAY ignore any part of the error message after the first NUL character for display purposes.</p>
<p id="rfc.section.2.2.p.9">As implied by the above table, if the reply does not contain a certificate it MUST contain an error message and a non-zero error code. Conversely, if a certificate is returned then the error code MUST be zero. The server SHOULD NOT send a zero error-code. The client MUST treat a missing error-code as if it were zero.</p>
<p id="rfc.section.2.2.p.10">The defined error codes are as follows:</p>
<div id="#rfc.table.2"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">error-code</th>
<th class="left">Condition</th>
<th class="left">Example</th>
</tr></thead>
<tbody>
<tr>
<td class="left">1</td>
<td class="left">Permanent problem with client request</td>
<td class="left">Incompatible version</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">Solvable problem with client request</td>
<td class="left">Expired Kerberos credentials</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">Temporary problem with client request</td>
<td class="left">Packet loss</td>
</tr>
<tr>
<td class="left">4</td>
<td class="left">Permanent problem with the server</td>
<td class="left">Internal misconfiguration</td>
</tr>
<tr>
<td class="left">5</td>
<td class="left">Temporary problem with the server</td>
<td class="left">Server overloaded</td>
</tr>
</tbody>
</table>
<p id="rfc.section.2.2.p.11">If a client error is returned, the client SHOULD NOT retry the request unless some remedial action is first taken. If error-code 3 is returned, the client MAY retry with other servers before giving up.</p>
<p id="rfc.section.2.2.p.12">If a server error is returned, it is RECOMMENDED that the client retry the request with a different server if one is known.</p>
<p id="rfc.section.2.2.p.13">Since all KCAs serving a Kerberos realm are intended to be equivalent, in accordance with <a href="#RFC5280">[RFC5280]</a> Section 4.1.2.2, the certificates returned from different KCAs serving the same Kerberos realm MUST NOT contain duplicate serial numbers.</p>
<p id="rfc.section.2.2.p.14">The returned certificate MUST identify the Kerberos client principal from the ap-req in the original KX509Request in the subject of the cert, or in a subjectAltName extension. The identification MUST be unique within the organization's deployed infrastructure. It is RECOMMENDED that a subjectAltName extension be included of type id-pkinit-san as described in <a href="#RFC4556">[RFC4556]</a> Section 3.2.2. Note that the id-pkinit-san is simply a standard representation of a Kerberos principal, and has no other implications with respect to PKINIT.</p>
<p id="rfc.section.2.2.p.15">Other extensions MAY be added according to local policy.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Protocol Operation</h1>
<p id="rfc.section.3.p.1">Absent errors, the protocol consists of a single request, sent via UDP, and a single reply, also sent via UDP.</p>
<p id="rfc.section.3.p.2">There is no special provision for requests or replies which exceed the allowable size of a UDP packet. Also some implementations have imposed hard size limits which are smaller than a typical UDP MTU, and will limit the use of extensions and the supportable key size. Even without hard limits, if the request or reply exceeds the MTU size of a UDP packet for the infrastructure in use, then the reliability of the exchange will decrease significantly.</p>
<p id="rfc.section.3.p.3">For &#8220;normal&#8221; Kerberos ap-req structures, and &#8220;normal&#8221; X.509 certificates, this is unlikely unless the Kerberos service ticket contains large amounts of authorization data.  For this reason, it is RECOMMENDED that service tickets for the KCA be issued without authorization data. If the KCA performs authorization, it should do so by other means.</p>
<p id="rfc.section.3.p.4">Before constructing the request, the client must know the canonical name(s) and port(s) of the server(s) to contact. It MAY determine them by looking up the service's SRV record as described in<a href="#RFC2782">[RFC2782]</a>. The entry to be used is _kca._udp.<em>realm</em>, where <em>realm</em> is the Kerberos realm, used as part of the DNS name.</p>
<p id="rfc.section.3.p.5">The client must then acquire a service ticket in order to construct the ap-req for the service. The Kerberos service principal name to use for this service has a first component of "kca_service". The second component and the realm of the principal follow normal Kerberos conventions.</p>
<p id="rfc.section.3.p.6">When the server receives a request, it MUST make sanity checks including at least the following:</p>
<p></p>

<ul>
<li>The AP-REQ can be decoded and is not expired.</li>
<li>If the request uses cross-realm authentication, then it satisfies the requirements of local policy and <a href="#RFC4120">[RFC4120]</a> Sections 1.2 and 2.7.</li>
<li>The request's hash is valid.</li>
</ul>

<p>The server SHOULD make other sanity checks, such as a minimum public key length, to the extent feasible.</p>
<p id="rfc.section.3.p.8">The server MAY decline to respond to an erroneous request. If it does not receive a response a client MAY retry its request, but the client SHOULD wait at least one second before doing so.</p>
<p id="rfc.section.3.p.9">The client MUST verify any hash in the reply, and MUST NOT use any certificate in a reply whose hash does not verify. The client MAY display the e-text if the hash is absent or does not verify, but SHOULD indicate the message is not authenticated.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.4.p.1">The original version of kx509 was implemented using Kerberos 4 at the University of Michigan, and was nicely documented in <a href="#KX509">[KX509]</a>. Many thanks to them for their original work, as well as the subsequent updates.</p>
<p id="rfc.section.4.p.2">While developing this document I received important corrections and comments from Jeffrey Altman, and Love Hornquist Astrand. I also received many helpful comments and corrections from Doug Engert, Jeffrey Hutzelman, Sam Hartman, Timothy J. Miller, and Chaskiel Grundman. Alan Sill provided the references to the International Grid Trust Federation and its acceptable credential services. Example network traffic was provided by Doug Engert, Marcus Watts, Matt Crawford, and Chaskiel Grundman from their deployments, and was extremely useful for verifying the reality of this specification.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">IANA is requested to add "kca_service" as a GSSAPI/Kerberos/SASL service name for a "Kerberized Certificate Authority".</p>
<p id="rfc.section.5.p.2">This service is conventionally run on UDP port 9878, but this memo does not request that IANA standardize the port number.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">The only encrypted information in the protocol is that used by Kerberos itself. The considerations for any Kerberized service apply here.</p>
<p id="rfc.section.6.p.2">The public key in the request is sent in the clear, and without any guarantees that the requestor actually possesses the corresponding private key. Therefore the only appropriate uses of the returned certificate are those where the identity of the requestor is unimportant, or the subsequent use independently guarantees that the user possesses the private key.</p>
<p id="rfc.section.6.p.3">Some information, such as the public key and certificate, is transmitted in the clear but (as the name implies) were generally intended to be publicly available. However their visibility could still raise privacy concerns. The hash is used to protect their integrity.</p>
<p id="rfc.section.6.p.4">The policies for issuing Kerberos tickets and X.509 certificates are usually expressed very differently. An implementation of this protocol should not provide a mechanism for bypassing ticket or certificate policies.</p>
<p id="rfc.section.6.p.5">In particular, if the issued certificate can be used with PKINIT, this authentication loop SHOULD NOT bypass policy limits for either X.509 certificates or Kerberos tickets.</p>
<p id="rfc.section.6.p.6">X.509 certificates are usually issued with considerably longer validity times than Kerberos tickets. Care should be taken that the issued certificate is not valid for longer than the intended policy should allow. Note that<a href="#RFC4556">[RFC4556]</a> Section 3.2.3.1 REQUIRES that the lifetime of an issued ticket not exceed the lifetime of the predecessor certificate. By analogy it is RECOMMENDED that the lifetime of an issued certificate not exceed the lifetime of the predecessor Kerberos ticket unless the implications with respect to local policy are clearly understood and allow it.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2782">[RFC2782]</b></td>
<td class="top">
<a href="mailto:arnt@troll.no" title="Troll Tech">Gulbrandsen, A.</a>, <a title="Internet Software Consortium">Vixie, P.</a> and <a href="mailto:levone@microsoft.com" title="Microsoft Corporation">L. Esibov</a>, "<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>", RFC 2782, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3447">[RFC3447]</b></td>
<td class="top">
<a>Jonsson, J.</a> and <a>B. Kaliski</a>, "<a href="http://tools.ietf.org/html/rfc3447">Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1</a>", RFC 3447, February 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4120">[RFC4120]</b></td>
<td class="top">
<a>Neuman, C.</a>, <a>Yu, T.</a>, <a>Hartman, S.</a> and <a>K. Raeburn</a>, "<a href="http://tools.ietf.org/html/rfc4120">The Kerberos Network Authentication Service (V5)</a>", RFC 4120, July 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4556">[RFC4556]</b></td>
<td class="top">
<a>Zhu, L.</a> and <a>B. Tung</a>, "<a href="http://tools.ietf.org/html/rfc4556">Public Key Cryptography for Initial Authentication in Kerberos (PKINIT)</a>", RFC 4556, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5280">[RFC5280]</b></td>
<td class="top">
<a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, May 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="X.509">[X.509]</b></td>
<td class="top">
<a>International Telecommunications Union</a>, "<a>Recommendation X.509: The Directory: Public-key and attribute certificate framework</a>", November 2008.</td>
</tr>
<tr>
<td class="reference"><b id="KX509">[KX509]</b></td>
<td class="top">
<a title="University of Michigan">Doster, W.</a>, <a title="University of Michigan">Watts, M.</a> and <a title="University of Michigan">D. Hyde</a>, "<a>The KX509 Protocol</a>", September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="IGTF">[IGTF]</b></td>
<td class="top">
<a>The International Grid Trust Federation</a>", .</td>, "</tr>
<tr>
<td class="reference"><b id="SLCS">[SLCS]</b></td>
<td class="top">
<a>Short Lived Credential Services</a>", February 2009.</td>, "</tr>
<tr>
<td class="reference"><b id="GRID-prof">[GRID-prof]</b></td>
<td class="top">
<a>GRID Certificate Profile</a>", March 2008.</td>, "</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#app-additional" id="app-additional">Certificate Cacheing and Deployment Considerations</a>
</h1>
<p id="rfc.section.Appendix A.p.1">As noted in the Security Considerations section, the functional lifetime of the acquired X.509 certificate should usually match the lifetime of its predecessor Kerberos ticket. Therefore, it is likely that X.509 certificates issued with this protocol should be deleted when the supporting Kerberos tickets are deleted. That makes the Kerberos ticket cache a reasonable location to store the certificate (and its private key).</p>
<p id="rfc.section.Appendix A.p.2">On the other hand applications, such as web browsers, probably expect certificates in different stores.</p>
<p id="rfc.section.Appendix A.p.3">A widely used solution to this dichotomy is to implement a PKCS11 library which supports the KX509-acquired credentials. The credentials remain stored in the kerberos credentials cache, but full PKI functionality is still available via a standard interface for PKI credentials.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Historically Used Extensions</h1>
<p id="rfc.section.Appendix B.p.1">A subjectAltName othername extension of type kcaAuthRealm (OID value 1.3.6.1.4.1.250.42.1) is frequently used to include the client&#8217;s realm as an ASN.1 octet string.</p>
<p id="rfc.section.Appendix B.p.2">The Microsoft-defined userPrincipalName has frequently been used for the same purpose as the id-pkinit-san.</p>
<p id="rfc.section.Appendix B.p.3">As defined in section 2.1, the historic implementations contained code for an additional client-version string in the request. If present, the KCA copied it into the issued certificate as an extension with the oid 1.3.6.1.4.1.250.42.2.</p>
<h1 id="rfc.appendix.Appendix C">
<a href="#rfc.appendix.Appendix%20C">Appendix C.</a> Issues and Changes from the Previous Draft</h1>
<p id="rfc.section.Appendix C.p.1">RFC Editor Note: Delete this appendix before final publication.</p>
<p id="rfc.section.Appendix C.p.2">Possible Issues:</p>
<p></p>

<ol>
<li>This draft only describes the existing in-the-wild protocol, which has some warts. We need an updated, standards-track protocol.</li>
<li>IANA registration of the GSSAPI/Kerberos service name is requested. Should IANA registration of the service port also be requested?</li>
<li>Should timeouts be more fully specified? Any other issues with error-handling?</li>
<li>The original UMICH code has provisions for DSA private keys in addition to RSA. Nobody seems to use DSA. Everyone seems to use RSA.  Is it worth specifying how DSA would work?</li>
</ol>
<p id="rfc.section.Appendix C.p.4">Changes from Draft -02 to Draft -03:</p>
<p></p>

<ol>
<li>The abstract was expanded.</li>
<li>Additional information was provided on traditional UDP size restrictions and their effect on reliability and key sizes in section 3.</li>
<li>The updates to the security considerations for digital signature usage were incomplete, and have been rewritten.</li>
<li>Information on an optional client version feature (which does not appear to be actually in use) was added to the request ASN.1, and Appendix B, and the title of the appendix changed.</li>
<li>As before some minor changes to wording were made for clarity, but are not believed to have changed the meaning.</li>
</ol>

<p>Changes from Draft -01 to Draft -02:</p>
<p></p>

<ol>
<li>The retry behavior was made slightly less specific.</li>
<li>The traditionally used SAN extensions were moved to a new appendix, leaving only the id-pkinit-san as the RECOMMENDED SAN.</li>
<li>The absolute prohibition against digital signatures in the Security Considerations section was relaxed since there are legitimate situations where a signature based on the KX509 certificate is still useful. (E.g. integrity protection where the actual signing identity is not important.)</li>
<li>Reference to TAGPMA in the abstract was replaced with a reference to its parent, the International Grid Trust Federation, and more detailed informative references were expanded in the Introduction.</li>
<li>Assorted other wording changes were made for clarity, but are not believed to have changed the meaning.</li>
</ol>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Henry B. Hotz</span> 
	  <span class="n hidden">
		<span class="family-name">Hotz</span>
	  </span>
	</span>
	<span class="org vcardline">Jet Propulsion Laboratory, California Institute of Technology</span>
	<span class="adr">
	  <span>4800 Oak Grove Dr.</span>

	  <span class="vcardline">
		<span class="locality">Pasadena</span>,  
		<span class="region">CA</span> 
		<span class="code">91109</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +01 818 354-4880</span>

<span class="vcardline">EMail: <a href="mailto:hotz@jpl.nasa.gov">hotz@jpl.nasa.gov</a></span>

  </address>
</div>

</body>
</html>