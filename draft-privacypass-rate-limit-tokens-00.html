<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Rate-Limited Token Issuance Protocol</title>
<meta content="Scott Hendrickson" name="author">
<meta content="Jana Iyengar" name="author">
<meta content="Tommy Pauly" name="author">
<meta content="Steven Valdez" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document specifies a variant of the Privacy Pass issuance protocol
that allows for tokens to be rate-limited on a per-origin basis. This
enables origins to use tokens for use cases that need to restrict access
from anonymous clients. 
    " name="description">
<meta content="xml2rfc 3.12.3" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-privacypass-rate-limit-tokens-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.3
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-privacypass-rate-limit-tokens-00-s39sab0w.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Rate-Limited Tokens</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hendrickson, et al.</td>
<td class="center">Expires 8 September 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-privacypass-rate-limit-tokens-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-03-07" class="published">7 March 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-09-08">8 September 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Hendrickson</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">J. Iyengar</div>
<div class="org">Fastly</div>
</div>
<div class="author">
      <div class="author-name">T. Pauly</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">S. Valdez</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Rate-Limited Token Issuance Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a variant of the Privacy Pass issuance protocol
that allows for tokens to be rate-limited on a per-origin basis. This
enables origins to use tokens for use cases that need to restrict access
from anonymous clients.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/tfpauly/privacy-proxy">https://github.com/tfpauly/privacy-proxy</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-5">
<a href="#name-status-of-this-memo-5" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 September 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-5">
<a href="#name-copyright-notice-5" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-5">
<a href="#name-table-of-contents-5" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-5" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-motivation" class="xref">Motivation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-properties-and-requirements" class="xref">Properties and Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology-3" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-configuration" class="xref">Configuration</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-token-challenge-requirement" class="xref">Token Challenge Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-issuance-protocol" class="xref">Issuance Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-state-requirements" class="xref">State Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-client-state" class="xref">Client State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-attester-state" class="xref">Attester State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="xref">5.1.3</a>.  <a href="#name-issuer-state" class="xref">Issuer State</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-issuance-http-headers" class="xref">Issuance HTTP Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-client-to-attester-request" class="xref">Client-to-Attester Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-attester-to-issuer-request" class="xref">Attester-to-Issuer Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-issuer-to-attester-response" class="xref">Issuer-to-Attester Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-attester-to-client-response" class="xref">Attester-to-Client Response</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-encrypting-origin-names" class="xref">Encrypting Origin Names</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-anonymous-issuer-origin-id-" class="xref">Anonymous Issuer Origin ID Computation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-client-behavior" class="xref">Client Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="xref">7.1.1</a>.  <a href="#name-request-key" class="xref">Request Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="xref">7.1.2</a>.  <a href="#name-request-signature" class="xref">Request Signature</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-attester-behavior-client-re" class="xref">Attester Behavior (Client Request Validation)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-issuer-behavior" class="xref">Issuer Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-attester-behavior-index-com" class="xref">Attester Behavior (Index Computation)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations-4" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-channel-security" class="xref">Channel Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-information-disclosure" class="xref">Information Disclosure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-token-request-unlinkability" class="xref">Token Request Unlinkability and Unforgeability</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-privacy-considerations-2" class="xref">Privacy Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-client-token-state-and-orig" class="xref">Client Token State and Origin Tracking</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-origin-verification" class="xref">Origin Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-client-identification-with-" class="xref">Client Identification with Unique Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-collusion-among-different-e" class="xref">Collusion Among Different Entities</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-deployment-considerations" class="xref">Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-token-key-management" class="xref">Token Key Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-iana-considerations-5" class="xref">IANA considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-token-type" class="xref">Token Type</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-http-headers" class="xref">HTTP Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-normative-references-5" class="xref">Normative References</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses-5" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction-5">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-5" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies a variant of the Privacy Pass issuance protocol
(as defined in <span>[<a href="#ARCH" class="xref">ARCH</a>]</span>) that allows
for tokens to be rate-limited on a per-origin basis. This enables origins
to use tokens for use cases that need to restrict access from anonymous clients.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The base Privacy Pass issuance protocol <span>[<a href="#ISSUANCE" class="xref">ISSUANCE</a>]</span>
defines stateless anonymous tokens, which can either be publicly verifiable
or not.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This variant build upon the publicly verifiable issuance protocol that uses
RSA Blind Signatures <span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>, and
allows tokens to be rate-limited on a per-origin basis. This means that
a client will only be able to receive a limited number of tokens associated
with a given origin server within a fixed period of time.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This issuance protocol registers the Rate-Limited Blind RSA token type
(<a href="#iana-token-type" class="xref">Section 11.1</a>), to be used with the PrivateToken HTTP authentication
scheme defined in <span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="motivation">
<section id="section-1.1">
        <h3 id="name-motivation">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
        </h3>
<p id="section-1.1-1">A client that wishes to keep its IP address private can hide its IP address
using a proxy service or a VPN. However, doing so severely limits the client's
ability to access services and content, since servers might not be able to
enforce their policies without a stable and unique client identifier.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Privacy Pass tokens in general allow clients to provide anonymous attestation
of various properties. The tokens generated by the base issuance
protocol (<span>[<a href="#ISSUANCE" class="xref">ISSUANCE</a>]</span>) can be used to verify that a client meets a particular
bar for attestation, but cannot be used by a redeeming server to rate-limit
specific clients.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">There are several common use cases for rate-limiting anonymous clients that
are common on the Internet. These routinely use client IP address tracking,
among other characteristics, to implement rate-limiting.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">One example of this use case is rate-limiting website accesses to a client to
help prevent fraud. Operations that are sensitive to fraud, such as account
creation on a website or logging into an account, often employ rate-limiting
as a defense-in-depth strategy. Additional verification can be required by these
pages when a client exceeds a set rate-limit.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Another example of this use case is a metered paywall, where an origin limits the
number of page requests from each unique user over a period of time before the
user is required to pay for access. The origin typically resets this state
periodically, say, once per month. For example, an origin may serve ten (major
content) requests in a month before a paywall is enacted. Origins may want to
differentiate quick refreshes from distinct accesses.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="properties">
<section id="section-1.2">
        <h3 id="name-properties-and-requirements">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-properties-and-requirements" class="section-name selfRef">Properties and Requirements</a>
        </h3>
<p id="section-1.2-1">For rate-limited token issuance, the Attester, Issuer, and Origin as defined in
<span>[<a href="#ARCH" class="xref">ARCH</a>]</span> each have partial knowledge of the Client's identity and actions,
and each entity only knows enough to serve its function (see <a href="#terms" class="xref">Section 2</a> for more
about the pieces of information):<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">The Attester knows the Client's identity and learns the Client's public key
(Client Key), the Issuer being targeted (Issuer Name), the period of time
for which the Issuer's policy is valid (Issuer Policy Window), the number of
tokens the Issuer is willing to issue within the current policy window, and the
number of tokens issued to a given Client for the claimed Origin in the policy
window. The Attester does not know the identity of the Origin the Client is
trying to access (Origin Name), but knows a Client-anonymized identifier for
it (Anonymous Origin ID).<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">The Issuer knows the Origin's secret (Issuer Origin Secret) and policy about client
access, and learns the Origin's identity (Origin Name) during issuance. The Issuer
does not learn the Client's identity or information about the Client's access
pattern.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">The Origin knows the Issuer to which it will delegate an incoming Client
(Issuer Name), and can verify that any tokens presented by the Client were
signed by the Issuer. The Origin does not learn which Attester was used by a
Client for issuance.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.2-3">Since an Issuer enforces policies on behalf of Origins, a Client is required to
reveal the Origin's identity to the delegated Issuer. It is a requirement of
this protocol that the Attester not learn the Origin's identity so that,
despite knowing the Client's identity, an Attester cannot track and concentrate
information about Client activity.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">An Issuer expects an Attester to verify its Clients' identities correctly, but an
Issuer cannot confirm an Attester's efficacy or the Attester-Client relationship
directly without learning the Client's identity. Similarly, an Origin does not
know the Attester's identity, but ultimately relies on the Attester to correctly
verify or authenticate a Client for the Origin's policies to be correctly
enforced. An Issuer therefore chooses to issue tokens to only known and
reputable Attesters; the Issuer can employ its own methods to determine the
reputation of a Attester.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2-5">An Attester is expected to employ a stable Client identifier, such as an IP
address, a device identifier, or an account at the Attester, that can serve as a
reasonable proxy for a user with some creation and maintenance cost on the user.<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<p id="section-1.2-6">For the Issuance protocol, a Client is expected to create and maintain stable
and explicit secrets for time periods that are on the scale of Issuer policy
windows. Changing these secrets arbitrarily during a policy window can result in
token issuance failure for the rest of the policy window; see <a href="#client-state" class="xref">Section 5.1.1</a>
for more details. A Client can use a service offered by its Attester or a
third-party to store these secrets, but it is a requirement of this protocol
that the Attester not be able to learn these secrets.<a href="#section-1.2-6" class="pilcrow">¶</a></p>
<p id="section-1.2-7">The privacy guarantees of this issuance protocol, specifically those around
separating the identity of the Client from the names of the Origins that it
accesses, are based on the expectation that there is not collusion between
the entities that know about Client identity and those that know about Origin
identity. Clients choose and share information with Attesters, and Origins
choose and share policy with Issuers; however, the Attester is generally
expected to not be colluding with Issuers or Origins. If this occurs, it
can become possible for an Attester to learn or infer which Origins a
Client is accessing, or for an Origin to learn or infer the Client
identity. For further discussion, see <a href="#collusion" class="xref">Section 9.4</a>.<a href="#section-1.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terms">
<section id="section-2">
      <h2 id="name-terminology-3">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology-3" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Unless otherwise specified, this document encodes protocol messages in TLS notation
from <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>, Section 3.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This draft includes pseudocode that uses the functions and conventions defined
in <span>[<a href="#HPKE" class="xref">HPKE</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Encoding an integer to a sequence of bytes in network byte order is described
using the function "encode(n, v)", where "n" is the number of bytes and "v" is
the integer value. The function "len()" returns the length of a sequence of bytes.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The following terms are defined in <span>[<a href="#ARCH" class="xref">ARCH</a>]</span> and are used throughout this
document:<a href="#section-2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-6.1">Client: An entity that provides authorization tokens to services
across the Internet, in return for authorization.<a href="#section-2-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-6.2">Issuer: An entity that produces Privacy Pass tokens to clients.<a href="#section-2-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-6.3">Attester: An entity that can attest to properties about the client,
including previous patterns of access.<a href="#section-2-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-6.4">Origin: The server from which the client can redeem tokens.<a href="#section-2-6.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-6.5">Issuance Protocol: The protocol exchange that involves the client,
attester, and issuer, used to generate tokens.<a href="#section-2-6.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-7">The following terms are defined in <span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span>, which defines the
interactions between clients and origins:<a href="#section-2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-8.1">Issuer Name: The name that identifies the Issuer, which is an entity
that can generate tokens for a Client using one or more issuance protocols.<a href="#section-2-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-8.2">Token Key: Keying material that can be used with an issuance protocol
to create a signed token.<a href="#section-2-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-8.3">Origin Name: The name that identifies the Origin, as included in a
TokenChallenge.<a href="#section-2-8.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-9">Additionally, this document defines several terms that are unique to the
rate-limited issuance protocol:<a href="#section-2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-10.1">Issuer Policy Window: The period over which an Issuer will track access
policy, defined in terms of seconds and represented as a uint64. The state
that the Attester keeps for a Client is specific to a policy window.
The effective policy window for a specific Client starts when the Client
first sends a request associated with an Issuer.<a href="#section-2-10.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.2">Origin Name Key: The public key used to encrypt values such as
Origin Name in requests from Clients to the Issuer, so that Attesters cannot learn
the Origin Name value. Each Origin Name Key is used across all requests on the
Issuer, for different Origins.<a href="#section-2-10.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.3">Anonymous Origin ID: An identifier that is generated by the Client and marked
on requests to the Attester, which represents a specific Origin anonymously. The Client
generates a stable Anonymous Origin ID for each Origin Name, to allow the Attester
to count token access without learning the Origin Name.<a href="#section-2-10.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.4">Client Key: A public key chosen by the Client and shared only with the Attester;
see <a href="#issuance-unlinkability" class="xref">Section 8.3</a> for more details about this restriction.<a href="#section-2-10.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.5">Client Secret: The secret key used by the Client during token issuance, whose public key
(Client Key) is shared with the Attester.<a href="#section-2-10.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.6">Issuer Origin Secret: A per-origin secret key used by the Issuer during token issuance,
whose public key is not shared with anyone.<a href="#section-2-10.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-10.7">Anonymous Issuer Origin ID: An identifier that is generated by Issuer based on an
Issuer Origin Secret that is per-Client and per-Origin. See <a href="#response-two" class="xref">Section 5.6</a> for details
of derivation.<a href="#section-2-10.7" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="setup">
<section id="section-3">
      <h2 id="name-configuration">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
      </h2>
<p id="section-3-1">Issuers MUST provide three parameters for configuration:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">Issuer Policy Window: a uint64 of seconds as defined in <a href="#terms" class="xref">Section 2</a>.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.2">Issuer Request URI: a token request URL for generating access tokens.
For example, an Issuer URL might be https://issuer.example.net/token-request. This parameter
uses resource media type "text/plain".<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.3">Origin Name Key: a <code>NameKey</code> structure as defined below to use when encrypting the Origin
Name in issuance requests. This parameter uses resource media type "application/issuer-name-key".
The Npk parameter corresponding to the HpkeKdfId can be found in <span>[<a href="#HPKE" class="xref">HPKE</a>]</span>.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
      </ol>
<div class="alignLeft art-text artwork" id="section-3-3">
<pre>
opaque HpkePublicKey[Npk]; // defined in I-D.irtf-cfrg-hpke
uint16 HpkeKemId;          // defined in I-D.irtf-cfrg-hpke
uint16 HpkeKdfId;          // defined in I-D.irtf-cfrg-hpke
uint16 HpkeAeadId;         // defined in I-D.irtf-cfrg-hpke

struct {
  uint8 key_id;
  HpkeKemId kem_id;
  HpkePublicKey public_key;
  HpkeKdfId kdf_id;
  HpkeAeadId aead_id;
} NameKey;
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">The Issuer parameters can be obtained from an Issuer via a directory object, which is a JSON
object whose field names and values are raw values and URLs for the parameters.<a href="#section-3-4" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field Name</th>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-policy-window</td>
            <td class="text-left" rowspan="1" colspan="1">Issuer Policy Window as a JSON number</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-request-uri</td>
            <td class="text-left" rowspan="1" colspan="1">Issuer Request URI resource URL as a JSON string</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">origin-name-key-uri</td>
            <td class="text-left" rowspan="1" colspan="1">Origin Name Key URI resource URL as a JSON string</td>
          </tr>
        </tbody>
      </table>
<p id="section-3-6">As an example, the Issuer's JSON directory could look like:<a href="#section-3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-7">
<pre>
 {
    "issuer-token-window": 86400,
    "issuer-request-uri": "https://issuer.example.net/token-request"
    "origin-name-key-uri": "https://issuer.example.net/name-key",
 }
</pre><a href="#section-3-7" class="pilcrow">¶</a>
</div>
<p id="section-3-8">Issuer directory resources have the media type "application/json"
and are located at the well-known location /.well-known/token-issuer-directory.<a href="#section-3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-challenge-requirements">
<section id="section-4">
      <h2 id="name-token-challenge-requirement">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-challenge-requirement" class="section-name selfRef">Token Challenge Requirements</a>
      </h2>
<p id="section-4-1">Clients receive challenges for tokens, as described in <span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">For the rate-limited token issuance protocol described in this document,
the token challenge MUST be interactive and per-origin. That is, the
TokenChallenge structure MUST contain both the redemption_nonce and
origin_name fields.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The HTTP authentication challenge also SHOULD contain the following
additional attribute:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">"origin-name-key", which contains a base64url encoding of a <code>NameKey</code> as defined
in <a href="#setup" class="xref">Section 3</a> to use when encrypting the Origin Name in issuance requests.<a href="#section-4-4.1" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="issuance">
<section id="section-5">
      <h2 id="name-issuance-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-issuance-protocol" class="section-name selfRef">Issuance Protocol</a>
      </h2>
<p id="section-5-1">This section describes the Issuance protocol for a Client to request and receive
a token from an Issuer. Token issuance involves a Client, Attester, and Issuer,
with the following steps:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">The Client sends a token request containing a token request, encrypted origin
name, and one-time-use public key and signature to the Attester<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.2">The Attester validates the request contents, specifically checking the request
signature, and proxies the request to the Issuer<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.3">The Issuer validates the request against the signature, and processes its contents,
and produces a token response sent back to the Attester<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.4">The Attester verifies the response and proxies the response to the Client<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-5-3">The Issuance protocol is designed such that Client, Attester, and Issuer learn only
what is necessary for completing the protocol; see <a href="#info-disclosure" class="xref">Section 8.2</a> for more details.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The Issuance protocol has a number of underlying cryptographic dependencies for
operation:<a href="#section-5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-5.1">RSA Blind Signatures <span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>, for issuing and constructing Tokens. This support
is the same as used in the base publicly verifiable token issuance protocol <span>[<a href="#ISSUANCE" class="xref">ISSUANCE</a>]</span><a href="#section-5-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-5.2">
          <span>[<a href="#HPKE" class="xref">HPKE</a>]</span>, for encrypting the origin server name in transit between Client and Issuer across the Attester.<a href="#section-5-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-5.3">
          <span>[<a href="#ECDSA" class="xref">ECDSA</a>]</span> signatures with key blinding, as described in <span>[<a href="#KEYBLINDING" class="xref">KEYBLINDING</a>]</span>, for verifying
correctness of Client requests.<a href="#section-5-5.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-6">Clients and Issuers are required to implement all of these dependencies, whereas Attesters are required
to implement ECDSA signature with key blinding support.<a href="#section-5-6" class="pilcrow">¶</a></p>
<div id="state-requirements">
<section id="section-5.1">
        <h3 id="name-state-requirements">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-state-requirements" class="section-name selfRef">State Requirements</a>
        </h3>
<p id="section-5.1-1">The Issuance protocol requires each participating endpoint to maintain some
necessary state, as described in this section.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="client-state">
<section id="section-5.1.1">
          <h4 id="name-client-state">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-client-state" class="section-name selfRef">Client State</a>
          </h4>
<p id="section-5.1.1-1">A Client is required to have the following information, derived from a given TokenChallenge:<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.1">Origin Name, a hostname referring to the Origin <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. This is
the value of TokenChallenge.origin_name.<a href="#section-5.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.1-2.2">Token Key, a blind signature public key corresponding to the Issuer
identified by the TokenChallenge.issuer_name.<a href="#section-5.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.1-2.3">Origin Name Key, a public key used to encrypt request information corresponding
to the Issuer identified by TokenChallenge.issuer_name.<a href="#section-5.1.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.1-3">Clients maintain a stable Client Key that they use for all communication with
a specific Attester. Client Key is a public key, where the corresponding private key
Client Secret is known only to the client.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4">If the client loses this (Client Key, Client Secret), they may generate a new tuple. The
Attester will enforce if a client is allowed to use this new Client Key. See <a href="#attester-state" class="xref">Section 5.1.2</a>
for details on this enforcement.<a href="#section-5.1.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1.1-5">Clients also need to be able to generate an Anonymous Origin ID value that corresponds
to the Origin Name, to send in requests to the Attester.<a href="#section-5.1.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1.1-6">Anonymous Origin ID MUST be a stable and unpredictable 32-byte value computed by the Client.
Clients MUST NOT change this value across token requests for the same Origin Name. Doing
so will result in token issuance failure (specifically, when an Attester rejects a request
upon detecting two Anonymous Origin ID values that map to the same Origin).<a href="#section-5.1.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1.1-7">One possible mechanism for implementing this identifier is for the Client to store a mapping
between the Origin Name and a randomly generated Anonymous Origin ID for future requests. Alternatively,
the Client can compute a PRF keyed by a per-client secret (Client Secret) over the Origin Name,
e.g., Anonymous Origin ID = HKDF(secret=Client Secret, salt="", info=Origin Name).<a href="#section-5.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attester-state">
<section id="section-5.1.2">
          <h4 id="name-attester-state">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-attester-state" class="section-name selfRef">Attester State</a>
          </h4>
<p id="section-5.1.2-1">An Attester is required to maintain state for every authenticated Client. The mechanism
of identifying a Client is specific to each Attester, and is not defined in this document.
As examples, the Attester could use device-specific certificates or account authentication
to identify a Client.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">Attesters must enforce that Clients don't change their Client Key frequently, to ensure Clients can't
regularily evade the per-client policy as seen by the issuer. Attesters MUST NOT allow Clients to
change their Client Key more than once within a policy window, or in the subsequent policy window
after a previous Client Key change. Alternative schemes where the Attester stores the encrypted
(Client Key, Client Secret) tuple on behalf of the client are possble but not described here.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3">Attesters are expected to know the Issuer Policy Window for any Issuer Name to which
they allow access. This information can be retrieved using the URIs defined in <a href="#setup" class="xref">Section 3</a>.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">For each Client-Issuer pair, an Attester maintains a policy window
start and end time for each Issuer from which a Client requests a token.<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.2-5">For each tuple of (Client Key, Anonymous Origin ID, policy window), the Attester maintains the
following state:<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-6.1">A counter of successful tokens issued<a href="#section-5.1.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.2">Whether or not a previous request was rejected by the Issuer<a href="#section-5.1.2-6.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.3">The last received Anonymous Issuer Origin ID value for this Anonymous Origin ID, if any<a href="#section-5.1.2-6.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="issuer-state">
<section id="section-5.1.3">
          <h4 id="name-issuer-state">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-issuer-state" class="section-name selfRef">Issuer State</a>
          </h4>
<p id="section-5.1.3-1">Issuers maintain a stable Issuer Origin Secret that they use in calculating values returned
to the Attester for each origin. If this value changes, it will open up a possibility
for Clients to request extra tokens for an Origin without being limited, within a
policy window. See <a href="#token-key-management" class="xref">Section 10.1</a> for details about generating and rotating
the Issuer Origin Secret.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">Issuers are expected to have the private key that corresponds to Origin Name Key,
which allows them to decrypt the Origin Name values in requests.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3-3">Issuers also need to know the set of valid Token Key public keys and corresponding
private key, for each Origin Name that is served by the Issuer. Origins SHOULD update
their view of the Token Key regularly to ensure that Client requests do not fail
after Token Key rotation.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="issuance-http-headers">
<section id="section-5.2">
        <h3 id="name-issuance-http-headers">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-issuance-http-headers" class="section-name selfRef">Issuance HTTP Headers</a>
        </h3>
<p id="section-5.2-1">The Issuance protocol defines four new HTTP headers that are used in requests
and responses between Clients, Attesters, and Issuers (see <a href="#iana-headers" class="xref">Section 11.2</a>).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The "Sec-Token-Origin" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent both on Client-to-Attester
requests (<a href="#request-one" class="xref">Section 5.3</a>) and on Issuer-to-Attester responses (<a href="#response-one" class="xref">Section 5.5</a>).
Its ABNF is:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-3">
<pre>
    Sec-Token-Origin = sf-binary
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2-4">The "Sec-Token-Client" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Attester
requests (<a href="#request-one" class="xref">Section 5.3</a>), and contains the bytes of Client Key.
Its ABNF is:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-5">
<pre>
    Sec-Token-Client = sf-binary
</pre><a href="#section-5.2-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2-6">The "Sec-Token-Request-Blind" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Attester
requests (<a href="#request-one" class="xref">Section 5.3</a>), and contains a per-request nonce value.
Its ABNF is:<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-7">
<pre>
    Sec-Token-Request-Blind = sf-binary
</pre><a href="#section-5.2-7" class="pilcrow">¶</a>
</div>
<p id="section-5.2-8">The "Sec-Token-Limit" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be an Integer. This header is sent on Issuer-to-Attester
responses (<a href="#response-one" class="xref">Section 5.5</a>), and contains the number of times a
Client can retrieve a token for the requested Origin within a policy window,
as set by the Issuer. Its ABNF is:<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-9">
<pre>
    Sec-Token-Limit = sf-integer
</pre><a href="#section-5.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="request-one">
<section id="section-5.3">
        <h3 id="name-client-to-attester-request">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-client-to-attester-request" class="section-name selfRef">Client-to-Attester Request</a>
        </h3>
<p id="section-5.3-1">The Client and Attester MUST use a secure and Attester-authenticated HTTPS
connection. They MAY use mutual authentication or mechanisms such as TLS
certificate pinning, to mitigate the risk of channel compromise; see
<a href="#sec-considerations" class="xref">Section 8</a> for additional about this channel.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">Requests to the Attester need to indicate the Issuer Name to which issuance
requests will be forwarded. Attesters SHOULD provide Clients with a URI template
that contains one variable that contains the Issuer Name, "issuer", using
Level 3 URI template encoding as defined in Section 1.2 of <span>[<a href="#RFC6570" class="xref">RFC6570</a>]</span>.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">An example of an Attester URI templates is shown below:<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-4">
<pre>
https://attester.net/token-request{?issuer}
</pre><a href="#section-5.3-4" class="pilcrow">¶</a>
</div>
<p id="section-5.3-5">Attesters and Clients MAY agree on other mechanisms to specify the Issuer Name
in requests.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">The Client first creates an issuance request message for a random value <code>nonce</code>
using the input TokenChallenge <code>challenge</code> and the Issuer key identifier <code>key_id</code>
as follows:<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-7">
<pre>
nonce = random(32)
context = SHA256(challenge)
token_input = concat(0x0003, nonce, context, key_id)
blinded_msg, blind_inv = rsabssa_blind(pkI, token_input)
</pre><a href="#section-5.3-7" class="pilcrow">¶</a>
</div>
<p id="section-5.3-8">The Client then uses Client Key to generate its one-time-use request public
key <code>request_key</code> and blind <code>request_blind</code> as described in <a href="#client-anon-issuer-origin-id" class="xref">Section 7.1</a>.<a href="#section-5.3-8" class="pilcrow">¶</a></p>
<p id="section-5.3-9">The Client then encrypts the origin name using Origin Name Key, producing
<code>encrypted_origin_name</code> as described in <a href="#encrypt-origin" class="xref">Section 6</a>.<a href="#section-5.3-9" class="pilcrow">¶</a></p>
<p id="section-5.3-10">Finally, the Client uses Client Secret to produce <code>request_signature</code>
as described in <a href="#index-proof" class="xref">Section 7.1.2</a>.<a href="#section-5.3-10" class="pilcrow">¶</a></p>
<p id="section-5.3-11">The Client then constructs a TokenRequest structure. This TokenRequest
structure is based on the publicly verifiable token issuance path in
<span>[<a href="#ISSUANCE" class="xref">ISSUANCE</a>]</span>, adding fields for the encrypted origin name and request signature.<a href="#section-5.3-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-12">
<pre>
struct {
   uint16_t token_type = 0x0003;
   uint8_t token_key_id;
   uint8_t blinded_msg[Nk];
   uint8_t request_key[49];
   uint8_t name_key_id[32];
   uint8_t encrypted_origin_name&lt;1..2^16-1&gt;;
   uint8_t request_signature[96];
} TokenRequest;
</pre><a href="#section-5.3-12" class="pilcrow">¶</a>
</div>
<p id="section-5.3-13">The structure fields are defined as follows:<a href="#section-5.3-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-14.1">"token_type" is a 2-octet integer, which matches the type in the challenge.<a href="#section-5.3-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.2">"token_key_id" is the least significant byte of the Token Key key ID, which is
generated as SHA256(public_key), where public_key is a DER-encoded SubjectPublicKeyInfo
object carrying Token Key.<a href="#section-5.3-14.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.3">"blinded_msg" is the Nk-octet request defined above.<a href="#section-5.3-14.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.4">"request_key" is computed as described in <a href="#index-request" class="xref">Section 7.1.1</a>.<a href="#section-5.3-14.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.5">"name_key_id" is a collision-resistant hash that identifies the Origin Name Key,
generated as SHA256(NameKey).<a href="#section-5.3-14.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.6">"encrypted_origin_name" is an encrypted structure that contains Origin Name,
calculated as described in <a href="#encrypt-origin" class="xref">Section 6</a>.<a href="#section-5.3-14.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-14.7">"request_signature" is computed as described in <a href="#index-proof" class="xref">Section 7.1.2</a>.<a href="#section-5.3-14.7" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-15">The Client then generates an HTTP POST request to send through the Attester to
the Issuer, with the TokenRequest as the body. The media type for this request
is "message/token-request". The Client includes the "Sec-Token-Origin" header,
whose value is Anonymous Origin ID; the "Sec-Token-Client" header, whose value is Client Key; and
the "Sec-Token-Request-Blind" header, whose value is request_blind. The Client
sends this request to the Attester's proxy URI. An example request is shown below,
where Nk = 512, the Issuer Name is "issuer.net", and the Attester URI template is
"https://attester.net/token-request{?issuer}"<a href="#section-5.3-15" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-16">
<pre>
:method = POST
:scheme = https
:authority = attester.net
:path = /token-request?issuer=issuer.net
accept = message/token-response
cache-control = no-cache, no-store
content-type = message/token-request
content-length = &lt;Length of TokenRequest&gt;
sec-token-origin = Anonymous Origin ID
sec-token-client = Client Key
sec-token-request-blind = request_blind

&lt;Bytes containing the TokenRequest&gt;
</pre><a href="#section-5.3-16" class="pilcrow">¶</a>
</div>
<p id="section-5.3-17">If the Attester detects a token_type in the TokenRequest that it does not recognize
or support, it MUST reject the request with an HTTP 400 error.<a href="#section-5.3-17" class="pilcrow">¶</a></p>
<p id="section-5.3-18">The Attester also checks to validate that the name_key_id in the client's TokenRequest
matches a known Origin Name Key public key for the Issuer. For example, the Attester can
fetch this key using the API defined in <a href="#setup" class="xref">Section 3</a>. This check is done to help ensure that
the Client has not been given a unique key that could allow the Issuer to fingerprint or target
the Client. If the key does not match, the Attester rejects the request with an HTTP
400 error. Note that this can lead to failures in the event of Issuer Origin Name Key
rotation; see <a href="#privacy-considerations" class="xref">Section 9</a> for considerations.<a href="#section-5.3-18" class="pilcrow">¶</a></p>
<p id="section-5.3-19">The Attester finally validates the Client's stable mapping request as described in
<a href="#attester-anon-issuer-origin-id" class="xref">Section 7.2</a>. If this fails, the Attester MUST return an HTTP 400
error to the Client.<a href="#section-5.3-19" class="pilcrow">¶</a></p>
<p id="section-5.3-20">If the Attester accepts the request, it will look up the state stored for this Client.
It will look up the count of previously generate tokens for this Client using the same
Anonymous Origin ID. See <a href="#attester-state" class="xref">Section 5.1.2</a> for more details.<a href="#section-5.3-20" class="pilcrow">¶</a></p>
<p id="section-5.3-21">If the Attester has stored state that a previous request for this Anonymous Origin ID was
rejected by the Issuer in the current policy window, it SHOULD reject the request without
forwarding it to the Issuer.<a href="#section-5.3-21" class="pilcrow">¶</a></p>
<p id="section-5.3-22">If the Attester detects this Client has changed their Client Key more frequently than allowed
as described in <a href="#attester-state" class="xref">Section 5.1.2</a>, it SHOULD reject the request without forwarding it to
the Issuer.<a href="#section-5.3-22" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-two">
<section id="section-5.4">
        <h3 id="name-attester-to-issuer-request">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-attester-to-issuer-request" class="section-name selfRef">Attester-to-Issuer Request</a>
        </h3>
<p id="section-5.4-1">Assuming all checks in <a href="#request-one" class="xref">Section 5.3</a> succeed, the Attester generates an HTTP POST request
to send to the Issuer with the Client's TokenRequest as the body. The Attester MUST NOT
add information that will uniquely identify a Client, or associate the request with a small
set of possible Clients. Extensions to this protocol MAY allow Attesters to add information
that can be used to separate large populations, such as providing information about the country
or region to which a Client belongs. An example request is shown below.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-2">
<pre>
:method = POST
:scheme = https
:authority = issuer.net
:path = /token-request
accept = message/token-response
cache-control = no-cache, no-store
content-type = message/token-request
content-length = &lt;Length of TokenRequest&gt;

&lt;Bytes containing the TokenRequest&gt;
</pre><a href="#section-5.4-2" class="pilcrow">¶</a>
</div>
<p id="section-5.4-3">The Attester and the Issuer MUST use a secure and Issuer-authenticated HTTPS
connection. Also, Issuers MUST authenticate Attesters, either via mutual
TLS or another form of application-layer authentication. They MAY additionally use
mechanisms such as TLS certificate pinning, to mitigate the risk of channel
compromise; see <a href="#sec-considerations" class="xref">Section 8</a> for additional about this channel.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
<p id="section-5.4-4">Upon receipt of the forwarded request, the Issuer validates the following conditions:<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-5.1">The TokenRequest contains a supported token_type<a href="#section-5.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.2">The TokenRequest.token_key_id and TokenRequest.name_key_id correspond to known
Token Keys and Origin Name Keys held by the Issuer.<a href="#section-5.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.3">The TokenRequest.encrypted_origin_name can be decrypted using the
Issuer's private key (the private key associated with Origin Name Key), and matches
an Origin Name that is served by the Issuer<a href="#section-5.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.4">The TokenRequest.blinded_msg is of the correct size<a href="#section-5.4-5.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-6">If any of these conditions is not met, the Issuer MUST return an HTTP 400 error to the Attester,
which will forward the error to the client.<a href="#section-5.4-6" class="pilcrow">¶</a></p>
<p id="section-5.4-7">The Issuer determines the correct Issuer Key by using the decrypted Origin Name value and
TokenRequest.token_key_id. If there is no Token Key whose truncated key ID matches
TokenRequest.token_key_id, the Issuer MUST return an HTTP 401 error to Attester, which will
forward the error to the client. The Attester learns that the client's view of the Origin key
was invalid in the process.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="response-one">
<section id="section-5.5">
        <h3 id="name-issuer-to-attester-response">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-issuer-to-attester-response" class="section-name selfRef">Issuer-to-Attester Response</a>
        </h3>
<p id="section-5.5-1">If the Issuer is willing to give a token to the Client, the Issuer decrypts
TokenRequest.encrypted_origin_name to discover "origin". If this fails, the Issuer rejects
the request with a 400 error. Otherwise, the Issuer validates and processes the token request
with Issuer Origin Secret corresponding to the designated Origin as described in <a href="#issuer-anon-issuer-origin-id" class="xref">Section 7.3</a>.
If this fails, the Issuer rejects the request with a 400 error. Otherwise, the output is
index_result.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<p id="section-5.5-2">The Issuer completes the issuance flow by computing a blinded response as follows:<a href="#section-5.5-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-3">
<pre>
blind_sig = rsabssa_blind_sign(skP, TokenRequest.blinded_msg)
</pre><a href="#section-5.5-3" class="pilcrow">¶</a>
</div>
<p id="section-5.5-4"><code>skP</code> is the private key corresponding to Token Key, known only to the Issuer.<a href="#section-5.5-4" class="pilcrow">¶</a></p>
<p id="section-5.5-5">The Issuer generates an HTTP response with status code 200 whose body consists of
blind_sig, with the content type set as "message/token-response", the
index_result set in the "Sec-Token-Origin" header, and the limit of tokens
allowed for a Client for the Origin within a policy window set in the
"Sec-Token-Limit" header.<a href="#section-5.5-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-6">
<pre>
:status = 200
content-type = message/token-response
content-length = &lt;Length of blind_sig&gt;
sec-token-origin = index_result
set-token-limit = Token limit

&lt;Bytes containing the blind_sig&gt;
</pre><a href="#section-5.5-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="response-two">
<section id="section-5.6">
        <h3 id="name-attester-to-client-response">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-attester-to-client-response" class="section-name selfRef">Attester-to-Client Response</a>
        </h3>
<p id="section-5.6-1">Upon receipt of a successful response from the Issuer, the Attester extracts the
"Sec-Token-Origin" header, and uses the value to determine Anonymous Issuer Origin ID
as described in <a href="#attester-output-anon-issuer-origin-id" class="xref">Section 7.4</a>.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">If the "Sec-Token-Origin" is missing, or if the same Anonymous Issuer Origin ID was previously
received in a response for a different Anonymous Origin ID within the same policy window,
the Attester MUST drop the token and respond to the client with an HTTP 400 status.
If there is not an error, the Anonymous Issuer Origin ID is stored alongside the state
for the Anonymous Origin ID.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<p id="section-5.6-3">The Attester also extracts the "Sec-Token-Limit" header, and compares the limit against the
previous count of accesses for this Client for the Anonymous Origin ID. If the count is greater
than or equal to the limit, the Attester drops the token and responds to the client with an
HTTP 429 (Too Many Requests) error.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">For all other cases, the Attester forwards all HTTP responses unmodified to the Client
as the response to the original request for this issuance.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<p id="section-5.6-5">When the Attester detects successful token issuance, it MUST increment the counter
in its state for the number of tokens issued to the Client for the Anonymous Origin ID.<a href="#section-5.6-5" class="pilcrow">¶</a></p>
<p id="section-5.6-6">Upon receipt, the Client handles the response and, if successful, processes the
body as follows:<a href="#section-5.6-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.6-7">
<pre>
authenticator = rsabssa_finalize(pkI, token_input, blind_sig, blind_inv)
</pre><a href="#section-5.6-7" class="pilcrow">¶</a>
</div>
<p id="section-5.6-8">If this succeeds, the Client then constructs a token as described in
<span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span> as follows:<a href="#section-5.6-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.6-9">
<pre>
struct {
    uint16_t token_type = 0x0003
    uint8_t nonce[32];
    uint8_t context[32];
    uint8_t token_key_id[Nid];
    uint8_t authenticator[Nk]
} Token;
</pre><a href="#section-5.6-9" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="encrypt-origin">
<section id="section-6">
      <h2 id="name-encrypting-origin-names">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-encrypting-origin-names" class="section-name selfRef">Encrypting Origin Names</a>
      </h2>
<p id="section-6-1">Given a <code>NameKey</code> (Origin Name Key), Clients produce encrypted_origin_name and authenticate
the contents of the TokenRequest using the following values:<a href="#section-6-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6-2.1">the one octet key identifier from the Name Key, keyID, with the corresponding KEM identified by kemID,
the public key from the configuration, pkI, and;<a href="#section-6-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-6-2.2">a selected combination of KDF, identified by kdfID, and AEAD, identified by aeadID.<a href="#section-6-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-6-3">Beyond the key configuration inputs, Clients also require the following inputs defined
in <a href="#request-one" class="xref">Section 5.3</a>: <code>token_key_id</code>, <code>blinded_msg</code>, <code>request_key</code>, and <code>name_key_id</code>.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Together, these are used to encapsulate Origin Name (<code>origin_name</code>) and produce
Encrypted Origin Name (<code>encrypted_origin</code>) as follows:<a href="#section-6-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6-5">
<li id="section-6-5.1">Compute an <span>[<a href="#HPKE" class="xref">HPKE</a>]</span> context using pkI, yielding context and encapsulation key enc.<a href="#section-6-5.1" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.2">Construct associated data, aad, by concatenating the values of keyID, kemID, kdfID,
aeadID, and all other values of the TokenRequest structure.<a href="#section-6-5.2" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.3">Pad origin_name with N zero bytes, where N = 31 - ((L - 1) % 32) and L is the length
of origin_name. Denote this padding process as the function <code>pad</code>.<a href="#section-6-5.3" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.4">Encrypt (seal) the padded origin_name with aad as associated data using context, yielding ciphertext ct.<a href="#section-6-5.4" class="pilcrow">¶</a>
</li>
        <li id="section-6-5.5">Concatenate the values of aad, enc, and ct, yielding encrypted_origin_name.<a href="#section-6-5.5" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-6-6">Note that enc is of fixed-length, so there is no ambiguity in parsing this structure.<a href="#section-6-6" class="pilcrow">¶</a></p>
<p id="section-6-7">In pseudocode, this procedure is as follows:<a href="#section-6-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6-8">
<pre>
enc, context = SetupBaseS(pkI, "TokenRequest")
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(2, token_type),
             encode(1, token_key_id),
             encode(Nk, blinded_msg),
             encode(49, request_key),
             encode(32, name_key_id))
ct = context.Seal(aad, pad(origin_name))
encrypted_origin_name = concat(enc, ct)
</pre><a href="#section-6-8" class="pilcrow">¶</a>
</div>
<p id="section-6-9">Issuers reverse this procedure to recover the (padded) Origin Name by computing the AAD as
described above and decrypting encrypted_origin_name with their private key skI (the private
key corresponding to pkI), and stripping off padding bytes. In pseudocode, this procedure
is as follows:<a href="#section-6-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6-10">
<pre>
enc, ct = parse(encrypted_origin_name)
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(2, token_type),
             encode(1, token_key_id),
             encode(Nk, blinded_msg),
             encode(49, request_key),
             encode(32, name_key_id))
enc, context = SetupBaseR(enc, skI, "TokenRequest")
origin_name, error = context.Open(aad, ct)
</pre><a href="#section-6-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="anon-issuer-origin-id">
<section id="section-7">
      <h2 id="name-anonymous-issuer-origin-id-">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-anonymous-issuer-origin-id-" class="section-name selfRef">Anonymous Issuer Origin ID Computation</a>
      </h2>
<p id="section-7-1">This section describes the Client, Attester, and Issuer behavior in computing
Anonymous Issuer Origin ID, the stable mapping based on client identity and
origin name. At a high level, this functionality computes y = F(x, k), where x
is a per-Client secret and k is a per-Origin secret, subject to the following constraints:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">The Attester only learns y if the Client in possession of x engages with the protocol;<a href="#section-7-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.2">The Attester prevents a Client with private input x from running the protocol for input x' that is not equal to x;<a href="#section-7-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.3">The Issuer does not learn x, nor does it learn when two requests correspond to the same private value x; and<a href="#section-7-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-2.4">Neither the Client nor Attester learn k.<a href="#section-7-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-7-3">The interaction between Client, Attester, and Issuer in computing this
functionality is shown below.<a href="#section-7-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7-4">
<pre>
Client               Attester                Issuer
    (request, signature)
  ----------------------&gt;
                           (request, signature)
                         ----------------------&gt;
                                (response)
                         &lt;----------------------
</pre><a href="#section-7-4" class="pilcrow">¶</a>
</div>
<p id="section-7-5">The protocol for computing this functionality is divided into sections for
each of the participants. <a href="#client-anon-issuer-origin-id" class="xref">Section 7.1</a> describes Client behavior
for initiating the computation with its per-Client secret, <a href="#attester-anon-issuer-origin-id" class="xref">Section 7.2</a>
describes Attester behavior for verifying Client requests, <a href="#issuer-anon-issuer-origin-id" class="xref">Section 7.3</a>
describes Issuer behavior for computing the mapping with its per-Origin secret,
and <a href="#attester-output-anon-issuer-origin-id" class="xref">Section 7.4</a> describes the final Attester step for
computing the client-origin index.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">The index computation is based on ECDSA <span>[<a href="#ECDSA" class="xref">ECDSA</a>]</span> instantiated with P-384 and SHA-384 and
extended with key blinding support as described in <span>[<a href="#KEYBLINDING" class="xref">KEYBLINDING</a>]</span>. It uses the following
functions:<a href="#section-7-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-7.1">ECDSA-KeyGen(): Generate a random ECDSA private and public key pair (sk, pk).<a href="#section-7-7.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.2">ECDSA-BlindPublicKey(pk, r): Produce a blinded public key based on the input public
key pk and blind r according to <span>[<a href="#KEYBLINDING" class="xref">KEYBLINDING</a>]</span>, Section 6.1.<a href="#section-7-7.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.3">ECDSA-Verify(pk, msg, sig): Verify the DER-encoded <span>[<a href="#X690" class="xref">X690</a>]</span> ECDSA-Sig-Value signature
sig over input message msg against the ECDSA public key pk, producing a boolean value indicating success.<a href="#section-7-7.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.4">ECDSA-BlindKeySign(sk_sign, sk_blind, msg): Sign input message msg with signing key sk_sign and
blind sk_blind according to <span>[<a href="#KEYBLINDING" class="xref">KEYBLINDING</a>]</span>, Section 6.2, and serializes the resulting signature
pair (r, s) in "raw" form, i.e., as the concatenation of two 48-byte, big endian scalars.<a href="#section-7-7.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.5">ECDSA-SerializePrivatekey(sk): Serialize an ECDSA private key using the Field-Element-to-Octet-String
conversion according to <span>[<a href="#SECG" class="xref">SECG</a>]</span>.<a href="#section-7-7.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.6">ECDSA-DeserializePrivatekey(buf): Attempt to deserialize an ECDSA private key from a 48-byte
string buf using Octet-String-to-Field-Element from <span>[<a href="#SECG" class="xref">SECG</a>]</span>. This function can fail if buf
does not represent a valid private key.<a href="#section-7-7.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.7">ECDSA-SerializePublicKey(pk): Serialize an ECDSA public key using the
compressed Elliptic-Curve-Point-to-Octet-String method according to <span>[<a href="#SECG" class="xref">SECG</a>]</span>.<a href="#section-7-7.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-7-7.8">ECDSA-DeserializePublicKey(buf): Attempt to deserialize a public key using
the compressed Octet-String-to-Elliptic-Curve-Point method according to <span>[<a href="#SECG" class="xref">SECG</a>]</span>,
and then performs partial public-key validation as defined in section 5.6.2.3.4 of
<span>[<a href="#KEYAGREEMENT" class="xref">KEYAGREEMENT</a>]</span>. This validation includes checking
that the coordinates are in the correct range, that the point is on the curve, and
that the point is not the point at infinity.<a href="#section-7-7.8" class="pilcrow">¶</a>
</li>
      </ul>
<div id="client-anon-issuer-origin-id">
<section id="section-7.1">
        <h3 id="name-client-behavior">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-client-behavior" class="section-name selfRef">Client Behavior</a>
        </h3>
<p id="section-7.1-1">This section describes the Client behavior for generating an one-time-use
request key and signature. Clients provide their Client Secret as input
to the request key generation step, and the rest of the token request inputs
to the signature generation step.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<div id="index-request">
<section id="section-7.1.1">
          <h4 id="name-request-key">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-request-key" class="section-name selfRef">Request Key</a>
          </h4>
<p id="section-7.1.1-1">Clients produce <code>request_key</code> by masking Client Key and Client Secret with a
randomly chosen blind. Let <code>pk_sign</code> and <code>sk_sign</code> denote Client Key and
Client Secret, respectively. This process is done as follows:<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.1-2">
<li id="section-7.1.1-2.1">Generate a random ECDSA private key, sk_blind.<a href="#section-7.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-7.1.1-2.2">Blind <code>pk_sign</code> with <code>sk_blind</code> to compute a blinded public key, <code>request_key</code>.<a href="#section-7.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-7.1.1-2.3">Output the blinded public key.<a href="#section-7.1.1-2.3" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-7.1.1-3">In pseudocode, this is as follows:<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.1-4">
<pre>
sk_blind = ECDSA-KeyGen()
blinded_key = ECDSA-BlindPublicKey(pk_sign, sk_blind)
request_key = ECDSA-SerializePublicKey(blinded_key)
request_blind = ECDSA-SerializePrivatekey(sk_blind)
</pre><a href="#section-7.1.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="index-proof">
<section id="section-7.1.2">
          <h4 id="name-request-signature">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-request-signature" class="section-name selfRef">Request Signature</a>
          </h4>
<p id="section-7.1.2-1">Clients produce signature of their request based on the following inputs defined in <a href="#request-one" class="xref">Section 5.3</a>:
<code>token_key_id</code>, <code>blinded_msg</code>, <code>request_key</code>, <code>name_key_id</code>, <code>encrypted_origin_name</code>.
This process requires the blind value <code>sk_blind</code> produced during the <a href="#index-request" class="xref">Section 7.1.1</a> process.
As above, let pk and sk denote Client Key and Client Secret, respectively. Given these
values, this signature process works as follows:<a href="#section-7.1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2-2">
<li id="section-7.1.2-2.1">Concatenate all signature inputs to yield a message to sign.<a href="#section-7.1.2-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-7.1.2-2.2">Compute an ECDSA signature with the blind <code>sk_blind</code> over the input message using
Client Secret, <code>sk_sign</code> as the signing key.<a href="#section-7.1.2-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-7.1.2-2.3">Output the signature.<a href="#section-7.1.2-2.3" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-7.1.2-3">In pseudocode, this is as follows:<a href="#section-7.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.2-4">
<pre>
context = concat(0x0003, // token_type
                 token_key_id,
                 blinded_msg,
                 request_key,
                 name_key_id,
                 encrypted_origin_name)
request_signature = ECDSA-BlindKeySign(sk_sign, sk_blind, context)
</pre><a href="#section-7.1.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="attester-anon-issuer-origin-id">
<section id="section-7.2">
        <h3 id="name-attester-behavior-client-re">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-attester-behavior-client-re" class="section-name selfRef">Attester Behavior (Client Request Validation)</a>
        </h3>
<p id="section-7.2-1">Given a TokenRequest request containing <code>request_key</code>, <code>request_signature</code>, and <code>request_blind</code>,
as well as Client Key <code>pk_blind</code>, Attesters verify the signature as follows:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.2-2">
<li id="section-7.2-2.1">Check that <code>request_key</code> is a valid ECDSA public key. If this fails, abort.<a href="#section-7.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.2">Check that <code>request_blind</code> is a valid ECDSA private key. If this fails, abort.<a href="#section-7.2-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.3">Blind the Client Key <code>pk_sign</code> by blind <code>sk_blind</code>, yielding a blinded key.
If this does not match <code>request_key</code>, abort.<a href="#section-7.2-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-7.2-2.4">Verify <code>request_signature</code> over the contents of the request, excluding the
signature itself, using <code>request_key</code>. If signature verification fails, abort.<a href="#section-7.2-2.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.2-3">In pseudocode, this is as follows:<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-4">
<pre>
blind_key = ECDSA-DeserializePublicKey(request_key)
sk_blind = ECDSA-DeserializePrivatekey(request_blind)
pk_blind = ECDSA-BlindPublicKey(pk_sign, sk_blind)
if pk_blind != blind_key:
  raise InvalidParameterError

context = parse(request[..len(request)-96]) // this matches context computed during signing
valid = ECDSA-Verify(blind_key, context, request_signature)
if not valid:
  raise InvalidSignatureError
</pre><a href="#section-7.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="issuer-anon-issuer-origin-id">
<section id="section-7.3">
        <h3 id="name-issuer-behavior">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-issuer-behavior" class="section-name selfRef">Issuer Behavior</a>
        </h3>
<p id="section-7.3-1">Given an Issuer Origin Secret (denoted <code>sk_origin</code>) and a TokenRequest, from which
<code>request_key</code> and <code>request_signature</code> are parsed, Issuers verify
the request signature and compute a response as follows:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3-2">
<li id="section-7.3-2.1">Check that <code>request_key</code> is a valid ECDSA public key. If this fails, abort.<a href="#section-7.3-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.3-2.2">Verify <code>request_signature</code> over the contents of the request, excluding the
signature itself, using <code>request_key</code>. If signature verification fails, abort.<a href="#section-7.3-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.3-2.3">Blind <code>request_key</code> by Issuer Origin Secret, <code>sk_origin</code>, yielding an index key.<a href="#section-7.3-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-7.3-2.4">Output the index key.<a href="#section-7.3-2.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.3-3">In pseudocode, this is as follows:<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-4">
<pre>
blind_key = ECDSA-DeserializePublicKey(request_key)
context = parse(request[..len(request)-96]) // this matches context computed during signing
valid = ECDSA-Verify(blind_key, context, request_signature)
if not valid:
  raise InvalidSignatureError

evaluated_key = ECDSA-BlindPublicKey(request_key, sk_origin)
index_key = ECDSA-SerializePublicKey(evaluated_key)
</pre><a href="#section-7.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="attester-output-anon-issuer-origin-id">
<section id="section-7.4">
        <h3 id="name-attester-behavior-index-com">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-attester-behavior-index-com" class="section-name selfRef">Attester Behavior (Index Computation)</a>
        </h3>
<p id="section-7.4-1">Given an Issuer response <code>index_key</code>, Client blind <code>sk_blind</code>, and Client
Key (denoted pk_sign), Attesters complete the Anonymous Issuer Origin ID computation as follows:<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.4-2">
<li id="section-7.4-2.1">Check that <code>index_key</code> is a valid ECDSA public key. If this fails, abort.<a href="#section-7.4-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-2.2">Unblind the <code>index_key</code> using the Client blind <code>sk_blind</code>, yielding the index result.<a href="#section-7.4-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.4-2.3">Run HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> with SHA-384 using the index result as the secret, Client Key
<code>pk_sign</code> as the salt, and ASCII string "anon_issuer_origin_id" as the info string,
yielding Anonymous Issuer Origin ID.<a href="#section-7.4-2.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.4-3">In pseudocode, this is as follows:<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-4">
<pre>
evaluated_key = ECDSA-DeserializePublicKey(request_key)
unblinded_key = ECDSA-UnblindPublicKey(evaluated_key, sk_blind)

index_result = ECDSA-SerializePublicKey(unblinded_key)
pk_encoded = ECDSA-SerializePublicKey(pk_sign)

anon_issuer_origin_id = HKDF-SHA384(secret=index_result,
                                    salt=pk_encoded,
                                    info="anon_issuer_origin_id")
</pre><a href="#section-7.4-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-8">
      <h2 id="name-security-considerations-4">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations-4" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">This section describes security considerations relevant to the use of this protocol.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="channel-security">
<section id="section-8.1">
        <h3 id="name-channel-security">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-channel-security" class="section-name selfRef">Channel Security</a>
        </h3>
<p id="section-8.1-1">An attacker that can act as an intermediate between Attester and Issuer
communication can influence or disrupt the ability for the Issuer to correctly
rate-limit token issuance.  All communication channels use server-authenticated
HTTPS. Some connections, e.g., between an Attester and an Issuer, require
mutual authentication between both endpoints. Where appropriate, endpoints
MAY use further enhancements such as TLS certificate pinning to mitigate
the risk of channel compromise.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="info-disclosure">
<section id="section-8.2">
        <h3 id="name-information-disclosure">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-information-disclosure" class="section-name selfRef">Information Disclosure</a>
        </h3>
<p id="section-8.2-1">The protocol in this document is designed such that information pertaining to issuance
of a token is limited to parties that need it for completing the protocol. In particular,
Attesters learn only the Anonymous Issuer Origin ID as described in <a href="#anon-issuer-origin-id" class="xref">Section 7</a>,
any per-Client information necessary for attestation, and the target Issuer for a given
token request. The Attester does not learn the origin name associated with a given token
request.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">The Issuer only learns the Attester that vouches for a particular Client's token request
and the origin name associated with a token request. The Issuer does not learn the
Anonymous Issuer Origin ID or any per-Client information used when creating a token request.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">The Client learns the output token. It does not learn the Anonymous Issuer Origin ID.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance-unlinkability">
<section id="section-8.3">
        <h3 id="name-token-request-unlinkability">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-token-request-unlinkability" class="section-name selfRef">Token Request Unlinkability and Unforgeability</a>
        </h3>
<p id="section-8.3-1">Client token requests are constructed such that an Issuer cannot distinguish between
any two token requests from the same Client and two requests from different Clients.
We refer to this property as issuance unlinkability. This property is achieved
by the way the tokens are constructed. In particular, TokenRequest.request_key and TokenRequest.request_signature
are the only value in a TokenRequest that is derived from per-Client information, i.e.,
the Client Secret.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">TokenRequest.request_key is computed using a freshly generated blind for each token
request. As a result, the value of TokenRequest.request_key in one token request is
statistically independent from Client Key. Similarly, TokenRequest.request_signature
is computed using the same freshly generated blind as TokenRequest.request_key for each
token request, and the resulting signature is therefore independent from signatures
produced using Client Secret. More details about this unlinkability property can be
found in <span>[<a href="#KEYBLINDING" class="xref">KEYBLINDING</a>]</span>.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">This unlinkability property is only intended for requests observed by the Issuer.
In contrast, the Attester is required to link requests from the same Client together
for the purposes of enforcing rate limits. This Attester does this by observing the
Client Key. Importantly, the Client Key is not sent to the Issuer during the issuance
flow, as doing this would allow the Issuer to trivially link two requests to the same
Client.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">The token request signature is also required to be unforgeable. Informally, unforgeability
means that no entity can produce a valid (message, signature) pair for any blinding key without
access to the private signing key. Importantly, the means the Attester cannot forge
signatures on behalf of a given Client in an attempt to learn the origin name.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9">
      <h2 id="name-privacy-considerations-2">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations-2" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">This section describes privacy considerations relevant to use of this protocol.<a href="#section-9-1" class="pilcrow">¶</a></p>
<div id="client-token-state-and-origin-tracking">
<section id="section-9.1">
        <h3 id="name-client-token-state-and-orig">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-client-token-state-and-orig" class="section-name selfRef">Client Token State and Origin Tracking</a>
        </h3>
<p id="section-9.1-1">Origins SHOULD only generate token challenges based on client action, such as when a user
loads a website. Clients SHOULD ignore token challenges if an Origin tries to force the
client to present tokens multiple times without any new client-initiated action. Failure
to do so can allow malicious origins to track clients across contexts. Specifically, an
origin can abuse per-user token limits for tracking by assigning each new client a random
token count and observing whether or not the client can successfully redeem that many
tokens in a given context. If any token redemption fails, then the origin learns information
about how many tokens that client had previously been issued.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">By rejecting repeated or duplicative challenges within a single context, the origin only
learns a single bit of information: whether or not the client had any token quota left
in the given policy window.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="origin-verification">
<section id="section-9.2">
        <h3 id="name-origin-verification">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-origin-verification" class="section-name selfRef">Origin Verification</a>
        </h3>
<p id="section-9.2-1">Rate-limited tokens are defined in terms of a Client authenticating to an Origin, where
the "origin" is used as defined in <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. In order to limit cross-origin correlation,
Clients MUST verify that the origin_name presented in the TokenChallenge structure (<span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span>)
matches the origin that is providing the HTTP authentication challenge, where the matching logic
is defined for same-origin policies in <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. Clients MAY further limit which
authentication challenges they are willing to respond to, for example by only accepting
challenges when the origin is a web site to which the user navigated.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-identification-with-unique-keys">
<section id="section-9.3">
        <h3 id="name-client-identification-with-">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-client-identification-with-" class="section-name selfRef">Client Identification with Unique Keys</a>
        </h3>
<p id="section-9.3-1">Client activity could be linked if an Origin and Issuer collude to have unique keys targeted
at specific Clients or sets of Clients.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">To mitigate the risk of a targeted Origin Name Key, the Attester can observe and validate
the token_key_id presented by the Client to the Issuer. As described in <a href="#issuance" class="xref">Section 5</a>, Attesters
MUST validate that the token_key_id in the Client's TokenRequest matches a known public key
for the Issuer. The Attester needs to support key rotation, but ought to disallow very rapid key
changes, which could indicate that an Origin is colluding with an Issuer to try to rotate the key
for each new Client in order to link the client activity.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collusion">
<section id="section-9.4">
        <h3 id="name-collusion-among-different-e">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-collusion-among-different-e" class="section-name selfRef">Collusion Among Different Entities</a>
        </h3>
<p id="section-9.4-1">Collusion among the different entities in the Privacy Pass architecture can result in
exposure of a client's per-origin access patterns.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">For this issuance protocol, Issuers and Attesters should be run by mutually distinct
organizations to limit information sharing. A single entity running an Issuer and Attester
for a single token issuance flow can view the origins being accessed by a given client.
Running the Issuer and Attester in this 'single Issuer/Attester' fashion reduces the privacy
promises of no one entity being able to learn Client browsing patterns. This may be desirable
for a redemption flow that is limited to specific Issuers and Attesters, but should be avoided
where hiding origin names from the Attester is desirable.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4-3">If a Attester and Origin are able to collude, they can correlate a client's identity
and origin access patterns through timestamp correlation. The timing of a request to an
Origin and subsequent token issuance to a Attester can reveal the Client
identity (as known to the Attester) to the Origin, especially if repeated over multiple accesses.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deploy">
<section id="section-10">
      <h2 id="name-deployment-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-deployment-considerations" class="section-name selfRef">Deployment Considerations</a>
      </h2>
<div id="token-key-management">
<section id="section-10.1">
        <h3 id="name-token-key-management">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-token-key-management" class="section-name selfRef">Token Key Management</a>
        </h3>
<p id="section-10.1-1">Issuers SHOULD generate a new (Token Key, Issuer Origin Secret) regularly, and
SHOULD maintain old and new secrets to allow for graceful updates. The RECOMMENDED
rotation interval is two times the length of the policy window for that
information. During generation, issuers must ensure the <code>token_key_id</code> (the 8-bit
prefix of SHA256(Token Key)) is different from all other <code>token_key_id</code>
values for that origin currently in rotation. One way to ensure this uniqueness
is via rejection sampling, where a new key is generated until its <code>token_key_id</code> is
unique among all currently in rotation for the origin.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations-5">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations-5" class="section-name selfRef">IANA considerations</a>
      </h2>
<div id="iana-token-type">
<section id="section-11.1">
        <h3 id="name-token-type">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-token-type" class="section-name selfRef">Token Type</a>
        </h3>
<p id="section-11.1-1">This document updates the "Token Type" Registry (<span>[<a href="#AUTHSCHEME" class="xref">AUTHSCHEME</a>]</span>) with the following value:<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<span id="name-token-types"></span><div id="aeadid-values">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-token-types" class="selfRef">Token Types</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Publicly Verifiable</th>
              <th class="text-left" rowspan="1" colspan="1">Public Metadata</th>
              <th class="text-left" rowspan="1" colspan="1">Private Metadata</th>
              <th class="text-left" rowspan="1" colspan="1">Nk</th>
              <th class="text-left" rowspan="1" colspan="1">Nid</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0003</td>
              <td class="text-left" rowspan="1" colspan="1">Rate-Limited Blind RSA</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">512</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
          </tbody>
        </table>
</div>
</section>
</div>
<div id="iana-headers">
<section id="section-11.2">
        <h3 id="name-http-headers">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-http-headers" class="section-name selfRef">HTTP Headers</a>
        </h3>
<p id="section-11.2-1">This document registers four new headers for use on the token issuance path
in the "Permanent Message Header Field Names" &lt;<span><a href="https://www.iana.org/assignments/message-headers">https://www.iana.org/assignments/message-headers</a></span>&gt;.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<span id="name-registered-http-header"></span><div id="iana-header-type-table">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-11.2-2.1">
<pre>
    +-------------------------+----------+--------+---------------+
    | Header Field Name       | Protocol | Status |   Reference   |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Origin        |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Client        |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Request-Blind |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Limit         |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-registered-http-header" class="selfRef">Registered HTTP Header</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<section id="section-12">
      <h2 id="name-normative-references-5">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-normative-references-5" class="section-name selfRef">Normative References</a>
      </h2>
<dl class="references">
<dt id="ARCH">[ARCH]</dt>
      <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Iyengar, J.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Privacy Pass Architectural Framework"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-architecture-03</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-03">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="AUTHSCHEME">[AUTHSCHEME]</dt>
      <dd>
<span class="refTitle">"The Privacy Pass HTTP Authentication Scheme"</span>, <span>n.d.</span>, <span>&lt;<a href="https://tfpauly.github.io/privacy-proxy/draft-pauly-privacypass-auth-scheme.html">https://tfpauly.github.io/privacy-proxy/draft-pauly-privacypass-auth-scheme.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BLINDSIG">[BLINDSIG]</dt>
      <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Jacobs, F.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"RSA Blind Signatures"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-rsa-blind-signatures-03</span>, <time datetime="2022-02-02" class="refDate">2 February 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-03">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ECDSA">[ECDSA]</dt>
      <dd>
<span class="refAuthor">American National Standards Institute</span>, <span class="refTitle">"Public Key Cryptography for the Financial Services Industry - The Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">ANSI ANS X9.62-2005</span>, <time datetime="2005-11" class="refDate">November 2005</time>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
      <dd>
<span class="refAuthor">Barnes, R. L.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hpke-12</span>, <time datetime="2021-09-02" class="refDate">2 September 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-12">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ISSUANCE">[ISSUANCE]</dt>
      <dd>
<span class="refAuthor">Celi, S.</span>, <span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Valdez, S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Privacy Pass Issuance Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-protocol-03</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-03">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEYAGREEMENT">[KEYAGREEMENT]</dt>
      <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for pair-wise key-establishment schemes using discrete logarithm cryptography"</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56ar3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56ar3">https://doi.org/10.6028/nist.sp.800-56ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEYBLINDING">[KEYBLINDING]</dt>
      <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Eaton, E.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Key Blinding for Signature Schemes"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-dew-cfrg-signature-key-blinding-00</span>, <time datetime="2022-03-07" class="refDate">7 March 2022</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-dew-cfrg-signature-key-blinding-00">https://datatracker.ietf.org/doc/html/draft-dew-cfrg-signature-key-blinding-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
      <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
      <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6454">[RFC6454]</dt>
      <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"The Web Origin Concept"</span>, <span class="seriesInfo">RFC 6454</span>, <span class="seriesInfo">DOI 10.17487/RFC6454</span>, <time datetime="2011-12" class="refDate">December 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6454">https://www.rfc-editor.org/rfc/rfc6454</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6570">[RFC6570]</dt>
      <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8941">[RFC8941]</dt>
      <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P-H. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 8941</span>, <span class="seriesInfo">DOI 10.17487/RFC8941</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8941">https://www.rfc-editor.org/rfc/rfc8941</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SECG">[SECG]</dt>
      <dd>
<span class="refTitle">"Elliptic Curve Cryptography, Standards for Efficient Cryptography Group, ver. 2"</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="https://secg.org/sec1-v2.pdf">https://secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS13">[TLS13]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X690">[X690]</dt>
    <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology - ASN.1 encoding Rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)"</span>, <span class="seriesInfo">ISO/IEC 8824-1:2021 </span>, <time datetime="2021-02" class="refDate">February 2021</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses-5">
<a href="#name-authors-addresses-5" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Scott Hendrickson</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:scott@shendrickson.com" class="email">scott@shendrickson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jana Iyengar</span></div>
<div dir="auto" class="left"><span class="org">Fastly</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jri@fastly.com" class="email">jri@fastly.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tommy Pauly</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tpauly@apple.com" class="email">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steven Valdez</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:svaldez@chromium.org" class="email">svaldez@chromium.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
