<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A SASL Mechanism for OAuth</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A SASL Mechanism for OAuth">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">KITTEN</td><td class="header">W. Mills</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">T. Showalter</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Yahoo Inc.</td></tr>
<tr><td class="header">Expires: January 27, 2011</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 26, 2010</td></tr>
</table></td></tr></table>
<h1><br />A SASL Mechanism for OAuth<br />draft-mills-kitten-sasl-oauth-00.txt</h1>

<h3>Abstract</h3>

<p>Simple Authentication and Security Layer (SASL) is a framework for providing authentication
        and data security services in connection-oriented protocols via replaceable mechanisms.
        OAuth is a protocol for delegated authentication and thereby provides a method for clients
        to access a protected resource on behalf of a resource owner.
</p>
<p>This document defines the use of OAuth over SASL. Thereby, it enables OAuth usage for
        non-HTTP-based application protocols. A future version of this document will describe the
        integration into the Generic Security Services Application Program Interface (GSS-APIO).
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 27, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#terminology">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
The OAuth SASL Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Initial Client Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
Server's Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.3.</a>&nbsp;
Discovery Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.4.</a>&nbsp;
Use of Signature Type Authorization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.5.</a>&nbsp;
Formal Syntax of Messages<br />
<a href="#anchor8">4.</a>&nbsp;
Implementation Requirements<br />
<a href="#anchor9">5.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.1.</a>&nbsp;
Successful Bearer Token Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.2.</a>&nbsp;
Failed Exchange<br />
<a href="#anchor12">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor13">7.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p><a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a> offers a standard mechanism for delegating
        authentication typically used for the purpose of control access to resources. The core OAuth
        specification defines a number of profiles but focuses on an HTTP-based environment. This
        mechanism takes advantage of the OAuth protocol and infrastructure to provide a way to use
        SASL <a class='info' href='#RFC4422'>[RFC4422]<span> (</span><span class='info'>Melnikov, A. and K. Zeilenga, &ldquo;Simple Authentication and Security Layer (SASL),&rdquo; June&nbsp;2006.</span><span>)</span></a> for access to resources for non-HTTP-based protocols. One
        example for such a protocol is the Internet Message Access Protocol (IMAP) <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>, which is what we use in our examples.
</p>
<p> The general authentication flow is that the application will first obtain an OAuth access
        token from an OAuth service for the resource.
        
        Once the client has obtained an OAuth access token it then connects and authenticated using
        this SASL mechanism.
</p>
<p><a class='info' href='#overview'>Figure&nbsp;1<span> (</span><span class='info'>Interworking Architecture</span><span>)</span></a> shows the relationship between SASL and OAuth graphically. Item
        (1) denotes the part of the OAuth exchange that remains unchanged from <a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a>, i.e. where the client obtains and refreshes Access Tokens.
        This document focuses on item (2) where the Access Token is presented to the resource server
        over SASL.
</p>
<p>
        <br /><hr class="insert" />
<a name="overview"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                              ----+
   +--------+                                  +---------------+  |
   |        |--(C)-- Authorization Request ---&gt;|   Resource    |  |
   |        |                                  |     Owner     |  |Plain
   |        |&lt;-(D)------ Access Grant ---------|               |  |OAuth
   |        |                                  +---------------+  |2.0
   |        |                                                     |(1)
   |        |         Client Credentials &amp;     +---------------+  |
   |        |--(E)------ Access Grant --------&gt;| Authorization |  |
   | Client |                                  |     Server    |  |
   |        |&lt;-(F)------ Access Token ---------|               |  |
   |        |      (w/ Optional Refresh Token) +---------------+  |
   |        |                                                 ----+
   |        |
   |        |                                                 ----+
   |        |        (Optional discovery)      +---------------+  |
   |        |--(A)------- User Name  ---------&gt;|               |  |
   | Client |                                  |               |  |
   |        |&lt;-(B)------ Authentication -------|               |  |
   |        |          endpoint information    |    Resource   |  |OAuth

   |        |                                  |     Server    |  |over
   |        |--(G)------ Access Token --------&gt;|               |  |SASL
   |        |                                  |               |  |
   |        |&lt;-(H)---- Protected Resource -----|               |  |(2)
   +--------+                                  +---------------+  |
                                                              ----+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Interworking Architecture&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
        </p>
<blockquote class="text">
<p>Note: The discovery procedure in OAuth is still work in progress. Hence, the discovery
            components described in this document should be considered incomplete and a tentative
            proposal. In general, there is a tradeoff between a generic, externally available
            defined discovery mechanisms (such as Webfinger using host-meta <a class='info' href='#I-D.hammer-hostmeta'>[I&#8209;D.hammer&#8209;hostmeta]<span> (</span><span class='info'>Hammer-Lahav, E., &ldquo;Web Host Metadata,&rdquo; June&nbsp;2010.</span><span>)</span></a>) and configuration information exchanged inband between
            the protocol endpoints. 
</p>
</blockquote><p>
      
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
        "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in
        RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>The reader is assumed to be familiar with the terms used in the OAuth 2.0 specification.
</p>
<p>In examples, "C:" and "S:" indicate lines sent by the client and server respectively. Line
        breaks have been inserted for readability.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
The OAuth SASL Mechanism</h3>

<p>SASL is used as a generalized authentication method in a variety of protocols. This
        document defines a mechanism to allow OAuth to be used within the SASL framework. In this
        model a client authenticates to an OAuth-capable authorization server over HTTP. This server
        then issues tokens after successfully authenticating the resource owner. Subsequently, the
        obtained token may be presented in an OAuth-authenticated request to the resource server. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Initial Client Response</h3>

<p>The client response is formatted in the style of an HTTP request, a GET line is included
          for the purposes of extensibility. The following key-value header lines are defined in the
          client response: </p>
<blockquote class="text"><dl>
<dt>User	(OPTIONAL):</dt>
<dd>Contains the user identifier being authenticated, and is
              provided to allow correct discovery information to be returned.
</dd>
<dt>Host	(REQUIRED):</dt>
<dd>Contains the host name to which the client connected.
</dd>
<dt>Authorization (REQUIRED):</dt>
<dd>Contains the authenticator as specified in
              OAuth.
</dd>
</dl></blockquote><p>
        
</p>
<p> The user name is provided before discovery information because a given server could
          allow multiple authenticators. For instance, a large ISP could provide mail service for
          several domains who manage their own user information. For instance, users at foo-example.com
          could be authenticated by an OAuth service at https://oauth.foo-example.com/, and users at
          bar-example.com could be authenticated by https://oauth.bar-example.com, but both could be served
          by a hypothetical IMAP server running at a third domain, imap.example.net. 
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Server's Response</h3>

<p>The server validates the response as per the OAuth specification. If the protected
          resource requires a signed request (using one of the available signature method), the URL
          for the resource being authenticated is reconstructed per the OAuth specification from the
          HTTP style request passed by the client. 
</p>
<p> The server responds to a successful OAuth authentication by completing the SASL
          negotiation. The OAuth token MUST carry the user id to be authenticated and the server
          MUST use the user in the OAuth credential as the user being authenticated, the assertion
          we accept is that of the OAuth token and not other information such as from the URL or
          "User:" header. 
</p>
<p> The server responds to failed authentication by sending discovery information and then
          failing the authentication. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Discovery Information</h3>

<p>The server MUST send discovery information in response to a failed OAuth 
          authentication exchange or a request with an empty Authenticate header. If discovery information is
          returned the server MUST return discovery information containing an authentication
          endpoint appropriate for the user. If the "User" header is present the discovery
          information MUST be for that user. In the absence of the "User" header the server SHOULD
          send discovery information for the user from the OAuth token. Discovery information is
          provided by the server to the client to allow a client to discover the appropriate OAuth
          authenticator service. The client then uses that information to obtain the refresh token
          and the access token needed for OAuth authentication. The client SHOULD cache and re-use
          the user specific discovery information for service endpoints. The following key-value
          pairs are defined for discovery information: </p>
<blockquote class="text"><dl>
<dt>WWW-Authenticate:</dt>
<dd> As specified in <a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a>.
</dd>
</dl></blockquote><p>
        
</p>
<p>Usage of the URL provided in the discovery information is defined in the OAuth
          specification. If the server supports multiple authenticators the discovery information
          returned for unknown users MUST be consistent with the discovery information for known
          users to prevent user enumeration. The OAuth 2.0 specification <a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a> has multiple types of authentication flows and the server
          MUST specify the supported authorization flows in the discovery information. The server
          MUST support at least one authorziation flow, and MAY support multiple flows.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Use of Signature Type Authorization</h3>

<p>OAuth supports authorization using signatures, which requires that both client and
          server construct the string to be signed. OAuth is designed for
          authentication/authorization to use a resource. SASL is designed for user authentication,
          and has no facility for being more specific. In this mechanism we require an HTTP style
          format specifically to support signature type authentication, but this is extremely
          limited. The HTTP style request is limited to a path of "/", because this mechanism is
          authenticating the user to the server. This mechanism is in the SASL model, but is
          designed so that no changes are needed if there is a revision of SASL which supports more
          specific resource authorization, e.g. IMAP access to a specific folder or FTP access
          limited to a specific directory. 
</p>
<p> So for example, given that OAuth has a port number component for the signature, on an
          IMAP server running on port 143 and given the the OAuth style authorization request (with
          long lines wrapped for readability) below: </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET / HTTP/1.1
Host: server.example.com
Authorization: Token token="vF9dft4qmT", nonce="s8djwd",
               timestamp="137131200", algorithm="hmac-sha256",
               signature="wOJIO9A2W5mFwDgiDvZbTSMK/PY="
</pre></div><p>

        
</p>
<p>The normalized request string would be constructed per <a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a>. In this example the normalized request string would be:</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
137131200,s8djwd,hmac-sha256,GET,server.example.com:143,
http://example.com/
</pre></div><p>

        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Formal Syntax of Messages</h3>

<p>
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    ;; CRLF, ... defined in RFC 5234

    client_response = header user* host authorization

    header = "GET / HTTP/1.1" CRLF

    user = 'User:' SPACE field-value CRLF

    host = 'Host:' SPACE field-value CRLF

    authorization = 'Authorization:' SPACE field-value CRLF

    field-name = *(%x20-%x39 / %x3b-%xff) ;; no ":", ascii printable

    field-value = *(%x01-%x09 / %x0b / %x0c / %x0e-%xff) CRLF
                  ;; no CR or LF

    server_discovery_info = [ "WWW-Authenticate:" SPACE
                              field_value extended* CRLF ]

    extended = field-name ":"  SPACE field-value
</pre></div><p>

        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Implementation Requirements</h3>

<p>Tokens typically have a restricted lifetime. In addition, the policy of a client MAY revoke
        a previously obtained token at any time. The client MAY request a new access token for each
        connection to a resource server be made. In use cases like IMAP where clients frequently
        make multiple connections at the same time the client it is RECOMMENDED to re-use the same
        access token, if permitted by the resource server. Clients MAY implement any of the OAuth
        profiles since they are largely outside the scope of this specification, and the mentioned
        profiles in this document are just examples. 
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Examples</h3>

<p>These example illustrate exchanges between an IMAP client and an IMAP server.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Successful Bearer Token Exchange</h3>

<p>This example shows a successful OAuth 2.0 bearer token exchange with an initial client
          response. Note that line breaks are inserted for readability.
</p>
<p>
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: * IMAP4rev1 Server Ready
C: t0 CAPABILITY
S: * CAPABILITY IMAP4rev1 AUTH=OAUTH
S: t0 OK Completed
C: t1 AUTHENTICATE OAUTH R0VUIC8gSFRUUC8xLjENClVzZXI6IHNjb290ZXJAYWx0
      YXZpc3RhLmNvbQ0KSG9zdDogaW1hcC55YWhvby5jb20NCkF1dGhvcml6YXRpb24
      6IFRva2VuIHRva2VuPSJ2RjlkZnQ0cW1UYzJOdmIzUmxja0JoYkhSaGRtbHpkR0
      V1WTI5dENnPT0iDQoNCg==
S: +
S: t1 OK SASL authentication succeeded
</pre></div><p>

        
</p>
<p>As required by IMAP <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>, the payloads are base64-encoded. The
          initial client response is: </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET / HTTP/1.1
Host: imap.example.com
Authorization: Token
token="vF9dft4qmTc2Nvb3RlckBhbHRhdmlzdGEuY29tCg=="
</pre></div><p>

        
</p>
<p>The "blank" line here is an empty response from the server. This response contains
          discovery information, in the success case no discovery information is necessary to the
          response is empty. Like other messages, and in accordance with the IMAP SASL binding, the
          empty response is base64-encoded. 
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Failed Exchange</h3>

<p>This example shows a failed exchange because of the empty Authorization header, which is
          how a client can query for discovery information. Note that line breaks are inserted for
          readability.
</p>
<p>
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
S: * IMAP4rev1 Server Ready
C: t0 CAPABILITY&amp;nbsp;
S: * CAPABILITY IMAP4rev1 AUTH=OAUTH SASL-IR
S: t0 OK Completed
C: t1 AUTHENTICATE OAUTH R0VUIC8gSFRUUC8xLjENClVzZXI6IHNjb290ZXJAYW
   x0YXZpc3RhLmNvbQ0KSG9zdDogaW1hcC55YWhvby5jb20NCkF1dGhlbnRpY2F0ZT
   ogDQoNCg==
S: + V1dXLUF1dGhlbnRpY2F0ZTogcmVhbG09ImltYXAueWFob28uY29tIiwgYXV0aH
   otdXJpPSJodHRwczovL2xvZ2luLnlhaG9vLmNvbS9vYXV0aCIsIHRva2VuLXVyaT
   0iaHR0cHM6Ly9sb2dpbi55YWhvby5jb20vb2F1dGgiLCBhbGdvcml0aG09ImhtYW
   Mtc2hhMjU2Ig0KDQo=
S: t1 NO SASL authentication failed
</pre></div><p>

        
</p>
<p> The initial client response is: </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET / HTTP/1.1
User: alice@example.com
Host: imap.example.com
Authorization:
</pre></div><p>

        
</p>
<p> The server discovery response is: </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
WWW-Authenticate: Token realm="mail",
       authz-uri="https://login.example.com/oauth",
       token-uri="https://login.example.com/oauth",
       algorithm="hmac-sha256"
</pre></div><p>

        
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p> This mechanism does not provide a security layer. The OAuth specification <a class='info' href='#I-D.ietf-oauth-v2'>[I&#8209;D.ietf&#8209;oauth&#8209;v2]<span> (</span><span class='info'>Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;The OAuth 2.0 Protocol,&rdquo; July&nbsp;2010.</span><span>)</span></a> allows for a variety of usages, and the security properties
        of these profiles varies. The usage of bearer tokens, for example, provide security features
        similar to cookies. Applications using this mechanism SHOULD exercise the same level of care
        using this mechanism as they would in using the SASL PLAIN mechanism. In particular, TLS 1.2
        MUST be implemented and its usage is RECOMMENDED unless tokens expire quickly. 
</p>
<p> A significant benefit of OAuth for usage in IMAP, POP, SMTP, or other clients that usually
        store passwords, is that the password is not stored in the client, a token is. This means
        that the password is not exposed, what we risk is a token that can be more limited or can be
        easily revoked. 
</p>
<p> It is possible that SASL will be authenticating a connection, indeed our examples are
        IMAP, and the life of that connection my outlast the life of the token used to authenticate
        it. This is a common problem in application protocols where connections are long-lived, and
        not a problem with this mechanism per se.
</p>
<p> It is possible for an application server running on Evil.example.com to tell a client to
        request a token from Good.example.org. A client following these instructions will pass a
        token from Good to Evil. This is by design, since it is possible that Good and Evil are
        merely names, not descriptive, and that this is an innocuous activity between cooperating
        two servers in different domains. For instance, a site might operate their authentication
        service in-house, but outsource their mail systems to an external entity. 
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p> The IANA is requested to register the following SASL profile: </p>
<blockquote class="text">
<p>SASL mechanism profile: OAUTH
</p>
<p>Security Considerations: See this document
</p>
<p>Published Specification: See this document
</p>
<p>For further information: Contact the authors of this document.
</p>
<p>Owner/Change controller: the IETF
</p>
<p>Note: None
</p>
</blockquote><p>
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-oauth-v2">[I-D.ietf-oauth-v2]</a></td>
<td class="author-text">Hammer-Lahav, E., Recordon, D., and D. Hardt, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-oauth-v2-10.txt">The OAuth 2.0 Protocol</a>,&rdquo; draft-ietf-oauth-v2-10 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-oauth-v2-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4422">[RFC4422]</a></td>
<td class="author-text">Melnikov, A. and K. Zeilenga, &ldquo;<a href="http://tools.ietf.org/html/rfc4422">Simple Authentication and Security Layer (SASL)</a>,&rdquo; RFC&nbsp;4422, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4422.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.hammer-hostmeta">[I-D.hammer-hostmeta]</a></td>
<td class="author-text">Hammer-Lahav, E., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-hammer-hostmeta-13.txt">Web Host Metadata</a>,&rdquo; draft-hammer-hostmeta-13 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-hammer-hostmeta-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">William Mills</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yahoo Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:wmills@yahoo-inc.com">wmills@yahoo-inc.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tim Showalter</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yahoo Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:timshow@yahoo-inc.com">timshow@yahoo-inc.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></td></tr>
</table>
</body></html>
