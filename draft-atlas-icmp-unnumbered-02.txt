


Internet                                                   A. Atlas, Ed.
Internet-Draft                                              Google, Inc.
Expires: September 5, 2007                                     R. Bonica
                                                        Juniper Networks
                                                              JR. Rivers
                                                           Nuova Systems
                                                                 N. Shen
                                                                 E. Chen
                                                           Cisco Systems
                                                           March 4, 2007


               ICMP Extensions for Unnumbered Interfaces
                     draft-atlas-icmp-unnumbered-02

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on September 5, 2007.

Copyright Notice

   Copyright (C) The IETF Trust (2007).

Abstract

   This memo defines extensions to ICMP that permit identification of
   unnumbered interfaces.  The interface the triggering IPv4 or IPv6



Atlas, et al.           Expires September 5, 2007               [Page 1]

Internet-Draft               ICMP Unnumbered                  March 2007


   packet was received upon can be identified by appending an ifIndex
   and/or a string describing the interface.  These extensions are
   defined to facilitate troubleshooting in network with unnumbered
   interfaces.  Additionally, to facilitate debugging of numbered
   interfaces, an IPv4 or IPv6 address of the interface the triggering
   IPv4 or IPv6 packet was received upon can be identified by appending
   an IPv4 or IPv6 address.


Table of Contents

   1.  Conventions Used In This Document  . . . . . . . . . . . . . .  3
   2.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  3
   3.  Application to TRACEROUTE  . . . . . . . . . . . . . . . . . .  4
   4.  Interface Information Object . . . . . . . . . . . . . . . . .  4
     4.1.  C-type meaning in an Interface Information Object  . . . .  5
     4.2.  Interface Description Sub-Object . . . . . . . . . . . . .  5
     4.3.  Interface Information Object Description . . . . . . . . .  6
     4.4.  Usage  . . . . . . . . . . . . . . . . . . . . . . . . . . 10
   5.  Security Considerations  . . . . . . . . . . . . . . . . . . . 10
   6.  IANA Considerations  . . . . . . . . . . . . . . . . . . . . . 10
   7.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . . . 11
   8.  References . . . . . . . . . . . . . . . . . . . . . . . . . . 11
     8.1.  Normative References . . . . . . . . . . . . . . . . . . . 11
     8.2.  Informative References . . . . . . . . . . . . . . . . . . 11
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 12
   Intellectual Property and Copyright Statements . . . . . . . . . . 13
























Atlas, et al.           Expires September 5, 2007               [Page 2]

Internet-Draft               ICMP Unnumbered                  March 2007


1.   Conventions Used In This Document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC2119 [RFC2119].


2.  Introduction

   IP routers use the Internet Control Message Protocol (ICMP) [RFC0792]
   to convey control information to source hosts.  Network operators use
   this information to diagnose routing problems.

   When a router generates an ICMP message, the source IP address, as
   specified in RFC1812 [RFC1812], MUST be either one of the IP
   addresses associated with the transmitting interface or, for
   unnumbered interfaces, the router's router-id.  When the transmitting
   interface is the same as the incoming interface of the packet that
   triggered the ICMP message and that interface is numbered, this
   allows easy identification of specific interface and is very useful
   for troubleshooting connectivity issues.  The transmitting and
   incoming interfaces may be different due to an asymmetric return
   path, which can occur due to asymmetric link costs or ECMP.  This
   specification provides an extension so that an IPv4 or IPv6 address
   of the incoming interface can be explicitly reported.

   When a network uses unnumbered interfaces and parallel links, it is
   not currently possible to identify the specific incoming interface of
   a packet based upon the responding ICMP message.  The extension
   defined in this memo permits an operator to identify the specific
   incoming interface traversed by a packet that triggered an ICMP
   message.

   This extension is motivated by the desire for similar information to
   that for numbered interfaces.  In the case of traceroute, the ICMP
   message contains one of the interfaces's IP address; then that IP
   address is commonly resolved via DNS to provide a meaningful name for
   the interface that is easier for humans.  One attribute permits a
   router to include a short interface description string.  Another
   attribute of the extension permits a router to include the
   interface's ifIndex; this can be used in combination with the source
   IP address for management tasks.  An interface's ifIndex may be used
   (for example, see Section 12.4.1 of RFC2328 [RFC2328]) when the
   interface is unnumbered and some identification unique to that router
   is desired.

   The inclusion of an interface description may also be useful for
   numbered interfaces that use a private IP address that DNS cannot



Atlas, et al.           Expires September 5, 2007               [Page 3]

Internet-Draft               ICMP Unnumbered                  March 2007


   resolve for supported users of traceroute and other ICMP message
   triggers.

   The ICMP message MUST include the IP header and leading payload
   octets of the original datagram.  As described in
   [I-D.bonica-internet-icmp], an ICMP Extension Structure Header MUST
   follow the octets from the original datagram and come before any ICMP
   Extension Objects.


3.  Application to TRACEROUTE

   ICMP extensions defined in this memo support enhancements to
   TRACEROUTE (the reasons are discussed in [I-D.bonica-internet-icmp]).
   The enhanced TRACEROUTE application, like older implementations,
   indicates which nodes the original datagram visited en route to its
   destination.  It differs from older implementations in that it also
   reflects the incoming interface on which the original triggering
   packet arrived, even when that interface is unnumbered.


4.  Interface Information Object

   This section defines an ICMP extension object that can be appended to
   the ICMPv4 Time Exceeded, ICMPv4 Destination Unreachable, ICMPv4
   Parameter Problem, ICMPv6 Time Exceeded, and ICMPv6 Destination
   Unreachable messages, as described in [I-D.bonica-internet-icmp].
   For the description of the Interface Information Object, the incoming
   interface is the one upon which the packet which triggered the ICMP
   message was received.  To minimize the use of extra bytes required
   for this extension, there are four different pieces of information
   that can appear in an Interface Information Object.

   1.  If the interface of interest has at least one IPv4 address and
       the triggering packet was IPv4, then one of the interface's IPv4
       addresses MAY be included.
   2.  If the interface of interest has at least one IPv6 address and
       the triggering packet was IPv6, then one of the interface's IPv6
       addresses MAY be included.
   3.  The ifIndex of the interface of interest MAY be included.  This
       is the ifIndex assigned to the interface by the router in as
       specified by the Interfaces Group MIB [RFC2863].
   4.  An interface description string of no more than 31 bytes MAY be
       included.







Atlas, et al.           Expires September 5, 2007               [Page 4]

Internet-Draft               ICMP Unnumbered                  March 2007


4.1.  C-type meaning in an Interface Information Object

   For this object, the c-type is split into two fields, a 2-bit
   interface-role field and a 6-bit included-information field.  This is
   illustrated below.

  Bit     7     6      |   5       4       3       2       1       0
       +-------+-------+-------+-------+-------+-------+-------+-------+
       | Interface Role| Rsvd  | Rsvd  | index | IPv4  | IPv6  | descr |
       +-------+-------+-------+-------+-------+-------+-------+-------+

    Interface Role :  This 2-bit field [6:7] indicates the role of the
                      interface being identified.  The enumerated values
                      are given below.
             0 : This object describes the incoming interface.
             1 : This object describes the outgoing interface.
           2-3 : Undefined by this memo and to be assigned by IANA

    Included Information: This 6-bit field [0:5] indicates what
                          information is included in the object.  The
                          information must be included in the same order
                          as the bits (from highest to lowest).

     bit
      5 : This bit is reserved for future use and MUST be set to 0.

      4 : This bit is reserved for future use and MUST be set to 0.

      3 : When set, this bit indicates that the ifIndex of the interface
          is included.  When clear, the ifIndex is not included.

      2 : When set, this indicates that an IPv4 address of the interface
          is included.  When clear, no IPv4 address is included.

      1 : When set, this indicates that an IPv6 address of the interface
          is included.  When clear, no IPv6 address is included.

      0 : When set, this indicates that an Interface Description
          Sub-object for the interface is included.  When clear, it is
          not included.

                C-Type for the Interface Information Object

4.2.  Interface Description Sub-Object

   The Interface Description Sub-Object MUST have a length that is a
   multiple of 4 bytes and MUST NOT exceed 32 bytes; the string should
   be padded with zeroes as necessary.  The description text SHOULD be



Atlas, et al.           Expires September 5, 2007               [Page 5]

Internet-Draft               ICMP Unnumbered                  March 2007


   the MIB-II ifName [RFC2863] but MAY be some other human-meaningful
   description of the interface.

   The Interface Description Sub-Object consists of two fields.  The
   first 1-byte field indicates the character set type used by the
   second field.  The second field contains the human-readable
   description text.

   byte       0          1                    31
        +--------------+----..............-------+
        | charset type |    description text     |
        +--------------+----..............-------+

                     Interface Description Sub-Object

   charset type 0 : This indicates that the human-readable description
   text MUST be provided in the US-ASCII charset [US-ASCII] using the
   Default Language [RFC2277].

   charset type 1 : This indicates that the human-readable description
   text MUST be provided in the UTF-8 charset [RFC3629] using the
   Default Language [RFC2277].

4.3.  Interface Information Object Description

   Figure 3 depicts the Interface Information Object, with some valid
   permutations.  It must be preceded by an ICMP Extension Structure
   Header and an ICMP Object Header.  Both are defined in
   [I-D.bonica-internet-icmp].

   Although all examples show an Interface Description Sub-object of
   length 32, this is only for illustration and depicts the maximum
   allowable length.

             Class-Num = 2

     Example 1: Interface with only description

             C-Type = 00000001b   // Indicates incoming interface
             Length = 36 (4 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |
      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |



Atlas, et al.           Expires September 5, 2007               [Page 6]

Internet-Draft               ICMP Unnumbered                  March 2007


      +--------------+--------------+--------------+--------------+


     Example 2: Interface with only ifIndex

             C-Type = 00001000b   // Indicates incoming interface
             Length = 8 (4 + 4)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+


     Example 3: Unnumbered Interface with ifIndex and description

             C-Type = 00001001b   // Indicates incoming interface
             Length = 40 (4 + 4 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |
      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |
      +--------------+--------------+--------------+--------------+


     Example 4: IPv4 interface with ifIndex and description

             C-Type = 00001101b   // Indicates incoming interface
             Length = 44 (4 + 4 + 4 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+
      |                    IPv4 address                           |
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |
      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |
      +--------------+--------------+--------------+--------------+



Atlas, et al.           Expires September 5, 2007               [Page 7]

Internet-Draft               ICMP Unnumbered                  March 2007


     Example 5: IPv4 interface with ifIndex

             C-Type = 00001100b   // Indicates incoming interface
             Length = 12 (4 + 4 + 4)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+
      |                    IPv4 address                           |
      +--------------+--------------+--------------+--------------+


     Example 6: IPv4 interface with description

             C-Type = 00000101b   // Indicates incoming interface
             Length = 40 (4 + 4 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    IPv4 address                           |
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |
      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |
      +--------------+--------------+--------------+--------------+


     Example 7: IPv6 interface with ifIndex and description

             C-Type = 00001011b   // Indicates incoming interface
             Length = 56 (4 + 4 + 16 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 1                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 2                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 3                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 4                   |
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |



Atlas, et al.           Expires September 5, 2007               [Page 8]

Internet-Draft               ICMP Unnumbered                  March 2007


      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |
      +--------------+--------------+--------------+--------------+


     Example 8: IPv6 interface with ifIndex

             C-Type = 00001010b   // Indicates incoming interface
             Length = 24 (4 + 4 + 16)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    Interface ifIndex                      |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 1                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 2                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 3                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 4                   |
      +--------------+--------------+--------------+--------------+


     Example 9: IPv6 interface with description

             C-Type = 00000011b   // Indicates incoming interface
             Length = 52 (4 + 16 + 32)

              0             1             2            3
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 1                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 2                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 3                   |
      +--------------+--------------+--------------+--------------+
      |                    IPv6 address, word 4                   |
      +--------------+--------------+--------------+--------------+
      |                Interface Description, word 1              |
      +--------------+--------------+--------------+--------------+
     ...                                                         ...
      +--------------+--------------+--------------+--------------+
      |                Interface Description , word 8             |
      +--------------+--------------+--------------+--------------+




Atlas, et al.           Expires September 5, 2007               [Page 9]

Internet-Draft               ICMP Unnumbered                  March 2007


                  Figure 3: Interface Information Object

4.4.  Usage

   If the incoming interface is unnumbered for the triggering packet
   type, then an Interface Information Object of c-type 8 or 9 SHOULD be
   included in the ICMPv4 or ICMPv6 Time Exceeded or ICMPv4 or ICMPv6
   Destination Unreachable message.

   If the triggering packet is IPv4 and the incoming interface has an
   IPv4 address, then an Interface Information Object of c-type 4, 5,
   12, or 13 MAY be included in the ICMPv4 Time Exceeded and ICMPv4
   Destination Unreachable messages.

   If the triggering packet is IPv6 incoming interface has an IPv6
   address, then an Interface Information Object of c-type 2, 3, 10, or
   11 MAY be included in the ICMPv6 Time Exceeded and ICMPv6 Destination
   Unreachable messages.

   In an ICMP message, more than one Interface Information Object with a
   given interface role MUST NOT be included.  Multiple Interface
   Information Objects, each with a different interface role, MAY be
   included.


5.  Security Considerations

   This extension can provide the user of traceroute with additional
   network information that is not currently available.  It may be
   desirable to provide this information to a particular network's
   operators and not to others.  If such policy controls are desirable,
   then an implementation could determine what sub-objects to include
   based upon the destination IP address of the ICMP message.  For
   instance, the ifIndex might be appropriate for all potential
   recipients; the description could be included as well if the
   destination IP address is a management address of the network that
   has administrative control of the router.


6.  IANA Considerations

   IANA should should reserve from the ICMP Extension Object registry: 2
   for the Interface Information Object.  IANA should reserve from the
   Interface ID Object's c-type, bit 0 for the inclusion of the
   description sub-object, bit 1 for inclusion of an IPv6 address, bit 2
   for inclusion of an IPv4 address, and bit 3 for inclusion of an
   ifIndex.  Bits 4 and 5 are unallocated and IANA should create a
   registry to allocate those with a requirement for standards action.



Atlas, et al.           Expires September 5, 2007              [Page 10]

Internet-Draft               ICMP Unnumbered                  March 2007


   Bit 6 and 7 form the Interface Role field.  Value 0 should be
   allocated for incoming interface; value 1 should be allocated for
   outgoing interface.  Values 2 and 3 are unallocated and IANA should
   allocate those with a requirement for standards action.
   Additionally, the Description Sub-Object has a 1 byte charset type
   field.  IANA should create a registry from it and allocate 0 for
   descriptions in ASCII and 1 for descriptions in UTF-8.  The remaining
   values should be allocated on a first come basis.


7.  Acknowledgements

   The authors would like to thank Carlos Pignataro, Sasha Vainshtein,
   and Joe Touch for their comments and suggestions.


8.  References

8.1.  Normative References

   [I-D.bonica-internet-icmp]
              Bonica, R., "Extended ICMP to Support Multi-part
              Messages", draft-bonica-internet-icmp-16 (work in
              progress), January 2007.

   [RFC0792]  Postel, J., "Internet Control Message Protocol", STD 5,
              RFC 792, September 1981.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2863]  McCloghrie, K. and F. Kastenholz, "The Interfaces Group
              MIB", RFC 2863, June 2000.

8.2.  Informative References

   [RFC1812]  Baker, F., "Requirements for IP Version 4 Routers",
              RFC 1812, June 1995.

   [RFC2277]  Alvestrand, H., "IETF Policy on Character Sets and
              Languages", BCP 18, RFC 2277, January 1998.

   [RFC2328]  Moy, J., "OSPF Version 2", STD 54, RFC 2328, April 1998.

   [RFC3629]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", STD 63, RFC 3629, November 2003.

   [US-ASCII]



Atlas, et al.           Expires September 5, 2007              [Page 11]

Internet-Draft               ICMP Unnumbered                  March 2007


              "Coded Character Set -- 7-bit American Standard Code for
              Information Interchange, ANSI X3.4-1986".


Authors' Addresses

   Alia K. Atlas (editor)
   Google, Inc.
   1600 Amphitheatre Parkway
   Mountain View, CA  94043
   USA

   Email: akatlas@google.com


   Ronald P. Bonica
   Juniper Networks
   2251 Corporate Park Drive
   Herndon, VA  20171
   USA

   Email: rbonica@juniper.net


   J.R. Rivers
   Nuova Systems

   Email: jrrivers@nuovasystems.com


   Naiming Shen
   Cisco Systems
   225 West Tasman Drive
   San Jose, CA  95134
   USA

   Email: naiming@cisco.com


   Enke Chen
   Cisco Systems
   170 West Tasman Drive
   San Jose, CA  95134
   USA

   Email: enkechen@cisco.com





Atlas, et al.           Expires September 5, 2007              [Page 12]

Internet-Draft               ICMP Unnumbered                  March 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Atlas, et al.           Expires September 5, 2007              [Page 13]

