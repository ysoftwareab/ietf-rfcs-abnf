<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Marking behaviour of PCN-nodes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Marking behaviour of PCN-nodes">
<meta name="keywords" content="Sample, Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">PCN Working Group</td><td class="header">Philip. Eardley (Editor)</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">BT</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">October 20, 2008</td></tr>
<tr><td class="header">Expires: April 23, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Marking behaviour of PCN-nodes<br />draft-ietf-pcn-marking-behaviour-01</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 23, 2009.</p>

<h3>Abstract</h3>

<p>This document standardises the two marking behaviours of PCN-nodes:
      threshold marking and excess traffic marking. Threshold marking marks
      all PCN-packets if the PCN traffic rate is greater than its configured
      rate. Excess traffic marking marks a proportion of PCN-packets, such
      that the amount marked equals the traffic rate in excess of its
      configured rate. Setting the configured rates below the physical link
      rates enables PCN-nodes to provide information to support admission
      control and flow termination in order to protect the quality of service
      of established inelastic flows.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Terminology<br />
<a href="#anchor3">2.</a>&nbsp;
Specified PCN-marking behaviour<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Behaviour aggregate classification function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
Traffic conditioning function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.</a>&nbsp;
Threshold meter function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
Excess traffic meter function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.5.</a>&nbsp;
Marking function<br />
<a href="#IANA">3.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">4.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">5.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor9">6.</a>&nbsp;
Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.1.</a>&nbsp;
Changes to -01 from -00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.2.</a>&nbsp;
Changes to -00<br />
<a href="#Authors">7.</a>&nbsp;
Authors<br />
<a href="#rfc.references1">8.</a>&nbsp;
Informative References<br />
<a href="#anchor13">Appendix&nbsp;A.</a>&nbsp;
Example algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">A.1.</a>&nbsp;
Threshold metering and marking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">A.2.</a>&nbsp;
Excess traffic metering and marking<br />
<a href="#anchor16">Appendix&nbsp;B.</a>&nbsp;
Implementation notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">B.1.</a>&nbsp;
Competing-non-PCN-traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">B.2.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">B.3.</a>&nbsp;
Behaviour aggregate classification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">B.4.</a>&nbsp;
Traffic conditioning<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">B.5.</a>&nbsp;
Threshold metering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">B.6.</a>&nbsp;
Excess traffic metering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">B.7.</a>&nbsp;
Marking<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document standardises the two marking behaviours of PCN-nodes.
      Their aim is to enable PCN-nodes to give an "early warning" of potential
      congestion before there is any significant build-up of PCN-packets in
      their queues. In summary, their objectives are:
</p>
<p></p>
<ul class="text">
<li>threshold marking: its objective is to mark all PCN-packets (with
          a "threshold-mark") whenever the rate of PCN-packets is greater than
          its configured rate ("PCN-threshold-rate");
</li>
<li>excess traffic marking: whenever the rate of PCN-packets is
          greater than its configured rate ("PCN-excess-rate"), its objective
          is to mark PCN-packets (with an "excess-traffic-mark") at a rate
          equal to the difference between the bit rate of PCN-packets and the
          PCN-excess-rate.
</li>
</ul>

<p><a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a> describes a general
      architecture for how, in a particular DiffServ domain,
      PCN-boundary-nodes convert these PCN-markings into decisions about flow
      admission and flow termination. Other documents describe the wider
      per-domain behaviour and how the PCN-markings are encoded in packet
      headers. PCN encoding uses a combination of the DSCP field and ECN field
      in the IP header to indicate that a packet is a PCN-packet and whether
      it is PCN-marked. The baseline encoding <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a> standardises two
      encoding states (PCN-marked and not-marked), whilst other documents
      define extended schemes with three encoding states (eg <a class='info' href='#I-D.moncaster-pcn-3-state-encoding'>[I&#8209;D.moncaster&#8209;pcn&#8209;3&#8209;state&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;A three state extended PCN encoding scheme,&rdquo; March&nbsp;2009.</span><span>)</span></a> defines
      PCN-threshold-marked, PCN-excess-traffic-marked and not-marked). <a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a> defines a broadly RED-like default congestion
      marking behaviour, but allows alternatives to be defined; this document
      defines such an alternative.
</p>
<p>Section 2 below specifies the functions involved, which in outline
      (see Figure 1) are:
</p>
<p></p>
<ul class="text">
<li>Behaviour aggregate classification: decide whether an incoming
          packet is a PCN-packet or not.
</li>
<li>Traffic condition (optional): drop packets if the link is
          overloaded.
</li>
<li>Threshold meter: determine whether the rate of PCN-packets is
          greater than its configured PCN-threshold-rate. The meter operates
          on the aggregate of all PCN-packets on the link, and not on
          individual flows.
</li>
<li>Excess traffic meter: measure by how much the rate of PCN-packets
          is greater than its configured PCN-excess-rate. The meter operates
          on the aggregate of all PCN-packets on the link, and not on
          individual flows.
</li>
<li>PCN-mark: actually mark the PCN-packets, if the meter functions
          indicate to do so.
</li>
</ul>

<p>
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                       +---------+   Result
                                    +-&gt;|Threshold|-------+
                                    |  |  Meter  |       |
                                    |  +---------+       V
         +---------+   +- - - - -+  |                 +------+
         |   BA    |   |         |  |                 |      |    Marked
Packet =&gt;|Classify |==&gt;|Condition|==?================&gt;|Marker|==&gt; Packet
Stream   |         |   |         |  |                 |      |    Stream
         +---------+   +- - - - -+  |                 +------+
                                    |  +---------+       ^
                                    |  | Excess  |       |
                                    +-&gt;| Traffic |-------+
                                       |  Meter  |   Result
                                       +---------+
</pre></div>
<p>Figure 1: Schematic of functions for
          PCN-marking
</p>

<p>Appendix A gives an example of algorithms that fulfil the
      specification of Section 2, and Appendix B provides some explanations of
      and comments on Section 2. Both the Appendices are informative. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Terminology</h3>

<p>In addition to the terminology defined in <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#RFC2474'>[RFC2474]<span> (</span><span class='info'>Nichols, K., Blake, S., Baker, F., and D. Black, &ldquo;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers,&rdquo; December&nbsp;1998.</span><span>)</span></a>, the following terms are defined:
</p>
<p></p>
<ul class="text">
<li>Competing-non-PCN-packet: a non PCN-packet that shares a link
            with PCN-packets and competes with them for its forwarding
            bandwidth. Competing-non-PCN-packets MUST NOT be PCN-marked (ie
            only PCN-packets can be PCN-marked). Note: In general it is not
            advised to have any competing-non-PCN-traffic.
</li>
<li>Metered-packet: a packet that is metered by the metering
            functions specified below. A PCN-packet MUST be treated as a
            metered-packet (with the minor exception noted below in Section
            2.4). A competing-non-PCN-packet MAY be treated as a
            metered-packet.
</li>
</ul>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Specified PCN-marking behaviour</h3>

<p>This section specifies the PCN-marking behaviour. The descriptions
      are functional and are not intended to restrict the implementation. The
      informative Appendixes supplement it.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Behaviour aggregate classification function</h3>

<p>A PCN-node MUST classify a packet as a PCN-packet if the value of
        its DSCP and ECN fields correspond to a PCN-enabled codepoint, as
        defined in the encoding scheme applicable to the PCN-domain. Otherwise
        the packet MUST NOT be classified as a PCN-packet.
</p>
<p>A PCN-node MUST classify a packet as a competing-non-PCN-packet if
        it is not a PCN-packet and it competes with PCN-packets for its
        forwarding bandwidth on a link. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Traffic conditioning function</h3>

<p>Note: if the PCN-node's queue overflows then naturally packets are
        dropped; traffic conditioning is action additional to this.
</p>
<p>On all links in the PCN-domain, traffic conditioning MAY be done
        by:
</p>
<p></p>
<ul class="text">
<li>metering all metered-packets to determine if the rate of
            metered-traffic is greater than its scheduling rate (ie determine
            if any packets are out-of-profile. Metering is "the process of
            measuring the temporal properties (eg rate) of a traffic stream"
            <a class='info' href='#RFC2475'>[RFC2475]<span> (</span><span class='info'>Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z., and W. Weiss, &ldquo;An Architecture for Differentiated Services,&rdquo; December&nbsp;1998.</span><span>)</span></a>.)
</li>
<li>if the rate of metered-traffic is too high, then drop
            metered-packets.
</li>
</ul><p>If the PCN-node drops PCN-packets then:</p>
<ul class="text">
<li>PCN-packets that arrive at the PCN-node already
            excess-traffic-marked SHOULD be preferentially dropped;
</li>
<li>the PCN-node's Excess traffic Meter SHOULD NOT meter the
            PCN-packets that it drops.
</li>
</ul>

<p>
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Threshold meter function</h3>

<p>A PCN-node MUST implement a Threshold Meter that has behaviour
        functionally equivalent to the following.
</p>
<p>The meter acts like a token bucket, which is sized in bits and has
        a configured bit rate, termed PCN-threshold-rate. The amount of tokens
        in the token bucket is termed TBthreshold.fill. Tokens are added at
        the PCN-threshold-rate, to a maximum value TBthreshold.max. Tokens are
        removed equal to the size in bits of the metered-packet, to a minimum
        TBthreshold.fill=0.
</p>
<p>The token bucket has a configured intermediate depth, termed
        TBthreshold.threshold. If TBthreshold.fill &lt; TBthreshold.threshold,
        then the meter indicates to the Marking function that the packet is to
        be threshold-marked; otherwise it does not.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Excess traffic meter function</h3>

<p>A PCN-packet SHOULD NOT be metered (by this excess traffic meter
        function) in the following two cases:
</p>
<p></p>
<ul class="text">
<li>If the packet is already excess-traffic-marked on arrival at
            the PCN-node;
</li>
<li>If this PCN-node drops the packet.
</li>
</ul>

<p>Otherwise the PCN-packet MUST be treated as a metered-packet, that
        is it is metered by the Excess traffic Meter.
</p>
<p>A PCN-node MUST implement an Excess traffic Meter that has
        behaviour functionally equivalent to the following.
</p>
<p>The meter acts like a token bucket, which is sized in bits and has
        a configured bit rate, termed PCN-excess-rate. The amount of tokens in
        the token bucket is termed TBexcess.fill. Tokens are added at the
        PCN-excess-rate, to a maximum value TBexcess.max. Tokens are removed
        equal to the size in bits of the metered-packet, to a minimum
        TBexcess-fill=0. If the token bucket is empty (TBexcess.fill = 0),
        then the meter indicates to the Marking function that the packet is to
        be excess-traffic-marked. The PCN-excess-rate is greater than (or
        equal to) the PCN-threshold-rate.
</p>
<p>In addition to the above, if the token bucket is within an MTU of
        being empty, then the meter SHOULD indicate to the Marking function
        that the packet is to be excess-traffic-marked; MTU means the maximum
        size of PCN-packets on the link ("packet size independent marking").
        
</p>
<p>Otherwise the meter MUST NOT indicate marking.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Marking function</h3>

<p>A PCN-node MUST NOT:
</p>
<p></p>
<ul class="text">
<li>PCN-mark a packet that is not a PCN-packet;
</li>
<li>change a non PCN-packet into a PCN-packet;
</li>
<li>change a PCN-packet into a non PCN-packet.
</li>
</ul>

<p>A PCN-packet MUST be marked to reflect the metering results by
        setting its encoding state appropriately, as specified by the specific
        encoding scheme that applies in the PCN-domain. 
</p>
<p></p>
<ul class="text">
<li>
<ul class="text">
<li>.
</li>
</ul>
</li>
</ul>

<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<p>Note to RFC Editor: this section may be removed on publication as an
      RFC.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>See <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a>
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>Michael Menth, Joe Babiarz, Anna Charny reviewed a preliminary
      version of the draft-eardley-pcn-marking-behaviour-00 draft.
</p>
<p>Thanks to those who've made comments on this draft: Michael Menth,
      Joe Babiarz, Anna Charny, Ruediger Geib, Wei Gengyu, Fortune Huang, Bob
      Briscoe, Toby Moncaster, Christian Hublet, Ingemar Johansson, Ken
      Carlberg, Georgios Karagiannis.
</p>
<p>All the work by many people in the PCN WG.
</p>
<p>
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Changes</h3>

<p>
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Changes to -01 from -00</h3>

<p>Updates as follows:
</p>
<p></p>
<ul class="text">
<li>corrected the term 'not PCN-marked' to 'not-marked'
            (throughout)
</li>
<li>re-phrased the definition of competing-non-PCN-packets 
</li>
<li>corrected the definition of metered-packet 
</li>
<li>delete most of Section 2.5 (marking function). The material
            deleted belongs as part of <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a>; other encoding
            schemes would need to include similar material. 
</li>
<li>deleted Appendix C (it was only a temporary archive of material
            concerning per domain behaviour and PCN-boundary-node
            operation)
</li>
<li>clarifications throughout
</li>
<li>made all references Informative
</li>
</ul>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Changes to -00</h3>

<p>First version of WG draft, derived from
        draft-eardley-pcn-marking-behaviour-01, with the following
        changes:
</p>
<p></p>
<ul class="text">
<li>Removed material concerning per domain behaviour and
            PCN-boundary-node operation (temporarily archived to Appendix
            C)
</li>
<li>Removed mention of downgrading as an option for per-hop traffic
            conditioning. In fact, downgrading is no longer allowed because S
            2.6 now says "A PCN-node MUST NOT ...change a PCN-packet into a
            non PCN-packet".
</li>
<li>Traffic conditioning is now a MAY. Since in general flow
            termination (not traffic conditioning) is PCN's method for
            handling problems of too much traffic.
</li>
<li>Metered-packets: competing-non-PCN-packets now MAY be metered.
            Since it is recommended that the operator doesn't allow any
            competing-non-PCN-traffic, and (if there is) there are potentially
            other ways of coping.
</li>
<li>No changes (outside traffic conditioning &amp; metering of
            competing-non-PCN-traffic) to the Normative sections of the
            draft.
</li>
<li>Appendix B.1 added about competing-non-PCN-traffic. Recommended
            that there is no such traffic, but guidance given if there is.
</li>
</ul>

<a name="Authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Authors</h3>

<p>Many people need to be added.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.briscoe-tsvwg-byte-pkt-mark">[I-D.briscoe-tsvwg-byte-pkt-mark]</a></td>
<td class="author-text">Briscoe, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-byte-pkt-mark-02.txt">Byte and Packet Congestion Notification</a>,&rdquo; draft-briscoe-tsvwg-byte-pkt-mark-02 (work in progress), February&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-byte-pkt-mark-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.briscoe-tsvwg-cl-architecture">[I-D.briscoe-tsvwg-cl-architecture]</a></td>
<td class="author-text">Briscoe, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-architecture-04.txt">An edge-to-edge Deployment Model for Pre-Congestion Notification: Admission  Control over a DiffServ Region</a>,&rdquo; draft-briscoe-tsvwg-cl-architecture-04 (work in progress), October&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-architecture-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.charny-pcn-comparison">[I-D.charny-pcn-comparison]</a></td>
<td class="author-text">Charny, A., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-charny-pcn-comparison-00.txt">Comparison of Proposed PCN Approaches</a>,&rdquo; draft-charny-pcn-comparison-00 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-charny-pcn-comparison-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-architecture">[I-D.ietf-pcn-architecture]</a></td>
<td class="author-text">Eardley, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-architecture-11.txt">Pre-Congestion Notification (PCN) Architecture</a>,&rdquo; draft-ietf-pcn-architecture-11 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-architecture-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-baseline-encoding">[I-D.ietf-pcn-baseline-encoding]</a></td>
<td class="author-text">Moncaster, T., Briscoe, B., and M. Menth, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-baseline-encoding-07.txt">Baseline Encoding and Transport of Pre-Congestion Information</a>,&rdquo; draft-ietf-pcn-baseline-encoding-07 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-baseline-encoding-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-admitted-realtime-dscp">[I-D.ietf-tsvwg-admitted-realtime-dscp]</a></td>
<td class="author-text">Baker, F., Polk, J., and M. Dolly, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-admitted-realtime-dscp-07.txt">DSCP for Capacity-Admitted Traffic</a>,&rdquo; draft-ietf-tsvwg-admitted-realtime-dscp-07 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-admitted-realtime-dscp-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.moncaster-pcn-3-state-encoding">[I-D.moncaster-pcn-3-state-encoding]</a></td>
<td class="author-text">Moncaster, T., Briscoe, B., and M. Menth, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-moncaster-pcn-3-state-encoding-01.txt">A three state extended PCN encoding scheme</a>,&rdquo; draft-moncaster-pcn-3-state-encoding-01 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-moncaster-pcn-3-state-encoding-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Menth">[Menth]</a></td>
<td class="author-text">&ldquo;<a href="http://www3.informatik.uni-wuerzburg.de/staff/menth/Publications/Menth08-PCN-Comparison.pdf">Menth</a>,&rdquo; 2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2474">[RFC2474]</a></td>
<td class="author-text"><a href="mailto:kmn@cisco.com">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:fred@cisco.com">Baker, F.</a>, and <a href="mailto:black_david@emc.com">D. Black</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>,&rdquo; RFC&nbsp;2474, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2474.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2474.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2474.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2475">[RFC2475]</a></td>
<td class="author-text"><a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:black_david@emc.com">Black, D.</a>, <a href="mailto:mark.carlson@sun.com">Carlson, M.</a>, <a href="mailto:elwynd@nortel.co.uk">Davies, E.</a>, <a href="mailto:zhwang@bell-labs.com">Wang, Z.</a>, and <a href="mailto:wweiss@lucent.com">W. Weiss</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2475">An Architecture for Differentiated Services</a>,&rdquo; RFC&nbsp;2475, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2475.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2475.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2475.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3168">[RFC3168]</a></td>
<td class="author-text">Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>,&rdquo; RFC&nbsp;3168, September&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5129">[RFC5129]</a></td>
<td class="author-text">Davie, B., Briscoe, B., and J. Tay, &ldquo;<a href="http://tools.ietf.org/html/rfc5129">Explicit Congestion Marking in MPLS</a>,&rdquo; RFC&nbsp;5129, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5129.txt">TXT</a>).</td></tr>
</table>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example algorithms</h3>

<p>Note: This Appendix is informative, not normative. It is an example
      of algorithms that implement Section 2 and is based on <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>.
</p>
<p>There is no attempt to optimise the algorithms. It implements the
      metering and marking functions together. It is assumed that three
      encoding states are available (one for threshold-marked, one for
      excess-traffic-marked and one for not-marked"). It is assumed that all
      metered-packets are PCN-packets and that the link is never
      overloaded.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Threshold metering and marking</h3>

<p>A token bucket with the following parameters:</p>
<ul class="text">
<li>TBthreshold.PCN-threshold-rate: token rate of token bucket
            (bits/second)
</li>
<li>TBthreshold.max: depth of token bucket (bits)
</li>
<li>TBthreshold.threshold: marking threshold of token bucket
            (bits)
</li>
<li>TBthreshold.lastUpdate: time the token bucket was last updated
            (seconds)
</li>
<li>TBthreshold.fill: amount of tokens in token bucket (bits)
</li>
</ul>

<p>A PCN-packet has the following parameters:</p>
<ul class="text">
<li>packet.size: the size of the PCN-packet (bits)
</li>
<li>packet.mark: the PCN encoding state of the packet
</li>
</ul>

<p>In addition there are the parameters:</p>
<ul class="text">
<li>now: the current time (seconds)
</li>
</ul>

<p>The following steps are performed when a PCN-packet arrives on a
        link:
</p>
<p></p>
<ul class="text">
<li>TBthreshold.fill = min(TBthreshold.max, TBthreshold.fill + (now
            - TBthreshold.lastUpdate) * TBthreshold.PCN-threshold-rate); //
            add tokens to token bucket
</li>
<li>TBthreshold.fill = max(0, TBthreshold.fill - packet.size); //
            remove tokens from token bucket
</li>
<li>if ((TBthreshold.fill &lt; TBthreshold.threshold) AND
            (packet.mark != excess-traffic-marked)) then packet.mark =
            threshold-marked; // do threshold marking, but don't re-mark
            packets that are already excess-traffic-marked
</li>
<li>TBthreshold.lastUpdate = now
</li>
</ul>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Excess traffic metering and marking</h3>

<p>A token bucket with the following parameters:</p>
<ul class="text">
<li>TBexcess.PCN-excess-rate: token rate of token bucket
            (bits/second)
</li>
<li>TBexcess.max: depth of TB in token bucket (bits)
</li>
<li>TBexcess.lastUpdate: time the token bucket was last updated
            (seconds)
</li>
<li>TBexcess.fill: amount of tokens in token bucket (bits)
</li>
</ul>

<p>A PCN-packet has the following parameters:</p>
<ul class="text">
<li>packet.size: the size of the PCN-packet (bits)
</li>
<li>packet.mark: the PCN encoding state of the packet
</li>
</ul>

<p>In addition there are the parameters:</p>
<ul class="text">
<li>now: the current time (seconds)
</li>
<li>MTU: the maximum transfer unit of the link (or the known
            maximum size of PCN-packets on the link) (bits)
</li>
</ul>

<p>The following steps are performed when a PCN-packet arrives on a
        link:
</p>
<p></p>
<ul class="text">
<li>TBexcess.fill = min(TBexcess.max, TBexcess.fill + (now -
            TBexcess.lastUpdate) * TBexcess.PCN-excess-rate); // add tokens to
            token bucket
</li>
<li>if (packet.mark != excess-traffic-marked) then TBexcess.fill =
            max(0, TBexcess.fill - packet.size); // remove tokens from token
            bucket, but do not meter packets that are already
            excess-traffic-marked
</li>
<li>if (TBexcess.fill &lt; MTU) then packet.mark =
            excess-traffic-marked; // do (packet size independent) excess
            traffic marking
</li>
<li>TBthreshold.lastUpdate = now
</li>
</ul>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Implementation notes</h3>

<p>Note: This Appendix is informative, not normative. It comments on
      Section 2.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Competing-non-PCN-traffic</h3>

<p>In general it is not advised to have any competing-non-PCN-traffic,
        essentially because the unpredictable amount of
        competing-non-PCN-traffic makes the PCN mechanisms less accurate and
        so reduces PCN's ability to protect the QoS of admitted PCN-flows
        <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a>. But if there is
        competing-non-PCN-traffic, then there needs to be:
</p>
<p></p>
<ol class="text">
<li>a mechanism to limit it, for example:
<ul class="text">
<li>limiting the rate at which competing-non-PCN-traffic can be
                forwarded on each link in the PCN-domain. One method for
                achieving this is to queue competing-non-PCN-packets
                separately from PCN-packets, and to limit the scheduling rate
                of the former. Another method is to police (traffic condition)
                the competing-non-PCN-traffic on each link, ie drop
                competing-non-PCN-packets in excess of some rate.
</li>
<li>policing of competing-non-PCN-traffic at the
                PCN-ingress-nodes. For example, as in the DiffServ
                architecture - although its static traffic conditioning
                agreements risk a focused overload of traffic from several
                PCN-ingress-nodes on one link.
</li>
<li>design: it is known by design that the level of
                competing-non-PCN-traffic is always very small (perhaps it
                consists of operator control messages only)
</li>
</ul>
</li>
<li>In general PCN's mechanisms should take account of
            competing-non-PCN-traffic (in order to improve the accuracy of the
            decision about whether to admit (or terminate) a PCN-flow), for
            example by:
<ul class="text">
<li>competing-non-PCN-traffic contributes to the PCN meters (ie
                competing-non-PCN-packets are treated as metered-packets).
</li>
<li>each PCN-node reduces, on its links, the PCN-threshold-rate
                and PCN-excess-rate, in order to allow 'headroom' for the
                competing-non-PCN-traffic; also limiting the maximum
                forwarding rate of competing-non-PCN-traffic to be less than
                the 'headroom'. In this case competing-non-PCN-packets are not
                treated as metered-packets.
</li>
</ul>
</li>
</ol><p>It is left up to the operator to decide on appropriate
        action. Traffic conditioning is discussed further in the separate
        section below.
</p>
<p>One specific example of competing-non-PCN-traffic occurs if the
        PCN-compatible Diffserv codepoint is the Voice-admit codepoint, and
        there is voice-admit traffic in the PCN-domain.
</p>
<p>Another example would occur if there was more than one
        PCN-compatible Diffserv codepoint in a PCN-domain. For instance,
        suppose there were two PCN-BAs treated at different priorities. Then
        as far as the lower priority PCN-BA is concerned, the higher priority
        PCN-traffic needs to be treated as competing-non-PCN-traffic.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Scope</h3>

<p>It may be known, eg by the design of the network topology, that
        some links can never be pre-congested (even in unusual circumstances,
        eg after the failure of some links). There is then no need to deploy
        PCN behaviour on those links.
</p>
<p>The meter and marker can be implemented on the ingoing or outgoing
        interface of a PCN-node. It may be that existing hardware can support
        only one meter and marker per ingoing interface and one per outgoing
        interface. Then for instance threshold metering and marking could be
        run on all the ingoing interfaces and excess traffic metering and
        marking on all the outgoing interfaces; note that the same choice must
        be made for all the links in a PCN-domain to ensure that the two
        metering behaviours are applied exactly once for all the links.
</p>
<p>Note that even if there are only two encoding states, it is still
        required that both the meters are implemented, in order to ease
        compatibility between equipment and remove a configuration option and
        associated complexity. Hardware with limited availability of token
        buckets could be configured to run only one of the meters, but it must
        be possible to enable either meter. Although this scenario means that
        the Marking function ignores indications from one of the meters, they
        might be logged or acted upon in some other way, for example by the
        management system or an explicit signalling protocol; such
        considerations are out of scope of PCN.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Behaviour aggregate classification</h3>

<p>Configuration of PCN-nodes will define what values of the DSCP and
        ECN fields indicate a PCN-packet in a particular PCN-domain.
</p>
<p>Configuration will also define what values of the DSCP and ECN
        fields indicate a competing-non-PCN-packet in a particular
        PCN-domain.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Traffic conditioning</h3>

<p>If there is no competing-non-PCN-traffic, then it is not expected
        that traffic conditioning is needed, since PCN's flow admission and
        termination mechanisms limit the amount of PCN-traffic. Even so,
        traffic conditioning still might be implemented as a back stop against
        misconfiguration of the PCN-domain, for instance.
</p>
<p>The objective of traffic conditioning is to minimise the queueing
        delay suffered by metered-traffic at a PCN-node, since PCN-traffic
        (and perhaps competing-non-PCN-traffic) is expected to be inelastic
        traffic generated by real time applications. In practice it would be
        defined as exceeding a specific traffic profile, typically based on a
        token bucket. The details will depend on how the router's
        implementation handles the two sorts of traffic <a class='info' href='#I-D.ietf-tsvwg-admitted-realtime-dscp'>[I&#8209;D.ietf&#8209;tsvwg&#8209;admitted&#8209;realtime&#8209;dscp]<span> (</span><span class='info'>Baker, F., Polk, J., and M. Dolly, &ldquo;DSCP for Capacity-Admitted Traffic,&rdquo; March&nbsp;2010.</span><span>)</span></a>:
</p>
<p></p>
<ul class="text">
<li>a common queue for PCN-traffic and competing-non-PCN-traffic,
            and a traffic conditioner for the competing-non-PCN-traffic;
</li>
<li>separate queues. In this case the amount of
            competing-non-PCN-traffic can be limited by limiting the rate at
            which the scheduler (for the competing-non-PCN-traffic) forwards
            packets.
</li>
</ul>

<p>The traffic conditioning action is to drop packets (which is often
        called "policing"). Downgrading of packets to a lower priority BA is
        left as a theoretical possibility (beware of packet mis-ordering).
        Shaping ("the process of delaying packets" <a class='info' href='#RFC2475'>[RFC2475]<span> (</span><span class='info'>Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z., and W. Weiss, &ldquo;An Architecture for Differentiated Services,&rdquo; December&nbsp;1998.</span><span>)</span></a>) is not suitable if the traffic comes from
        real time applications. In general it is reasonable for
        competing-non-PCN-traffic to get harsher treatment than PCN-traffic
        (ie competing-non-PCN-packets are preferentially dropped), because
        PCN's flow admission and termination mechanisms are stronger than the
        mechanisms that are likely to be applied to the
        competing-non-PCN-traffic. The PCN mechanisms also mean that a traffic
        conditioner should not be needed for the PCN-traffic.
</p>
<p>Preferential dropping of excess-traffic-marked packets: Section 2.3
        specifies: "If the PCN-node drops PCN-packets then ... PCN-packets
        that arrive at the PCN-node already excess-traffic-marked SHOULD be
        preferentially dropped". This avoids over-termination, with the CL/SM
        edge behaviour, in the event of multiple bottlenecks in the PCN-domain
        <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a>.
</p>
<p>Exactly what "preferentially dropped" means is left to the
        implementation. It is also left to the implementation what to do if
        there are no excess-traffic-marked PCN-packets available at a
        particular instant.
</p>
<p>Section 2.2 also specifies: "the PCN-node's Excess traffic Meter
        SHOULD NOT meter the PCN-packets that it drops." This avoids
        over-termination <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. Effectively it means
        that traffic conditioning should be done before the meter functions -
        which is natural.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.5"></a><h3>B.5.&nbsp;
Threshold metering</h3>

<p>The description is in terms of a &lsquo;token bucket with
        threshold&rsquo; (which <a class='info' href='#I-D.briscoe-tsvwg-cl-architecture'>[I&#8209;D.briscoe&#8209;tsvwg&#8209;cl&#8209;architecture]<span> (</span><span class='info'>Briscoe, B., &ldquo;An edge-to-edge Deployment Model for Pre-Congestion Notification: Admission  Control over a DiffServ Region,&rdquo; October&nbsp;2006.</span><span>)</span></a> views as a virtual
        queue). However the implementation is not standardised.
</p>
<p>Section 2.3 defines: "If TBthreshold.fill &lt;
        TBthreshold.threshold, then the meter indicates to the Marking
        function that the packet is to be threshold-marked; otherwise it does
        not." Note that the PCN-packet (that causes the token bucket to cross
        TBthreshold.threshold) is marked without explicit additional bias for
        the packet's size.
</p>
<p>The behaviour must be functionally equivalent to the description
        above. "Functionally equivalent" means the observable 'black box'
        behaviour is the same or very similar. It is intended to allow
        implementation freedom over matters such as:</p>
<ul class="text">
<li>whether tokens are added to the token bucket at regular time
            intervals or only when a packet is processed
</li>
<li>whether the new token bucket depth is calculated before or
            after it is decided whether to mark the packet. The effect of this
            is simply to shift the sequence of marks by one packet.
</li>
<li>when the token bucket is very nearly empty and a packet arrives
            larger than TBthreshold.fill, then the precise change in
            TBthreshold.fill is up to the implementation. A behaviour is
            functionally equivalent if either precisely the same set of
            packets is marked, or if the set is shifted by one packet. For
            instance, the following should all be considered as "functionally
            equivalent":
<ul class="text">
<li>set TBthreshold.fill = 0 and indicate threshold-mark to the
                Marking function.
</li>
<li>check whether TBthreshold.fill &lt; TBthreshold.threshold
                and if it is then indicate threshold-mark to the Marking
                function; then set TBthreshold.fill = 0.
</li>
<li>leave TBthreshold.fill unaltered and indicate
                threshold-mark to the Marking function.
</li>
</ul>
</li>
</ul>
<ul class="text">
<li><p>similarly, when the token bucket is very nearly full and a
            packet arrives large than (TBthreshold.max - TBthreshold.fill),
            then the precise change in TBthreshold.fill is up to the
            implementation.
</li>
<li>Note that all packets, even if already marked, are metered by
            the threshold meter function (unlike the excess traffic meter
            function - see below) - because all packets should contribute to
            the decision whether there is room for a new flow.
</li>
</ul>
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.6"></a><h3>B.6.&nbsp;
Excess traffic metering</h3>

<p>The description is in terms of a token bucket, however the
        implementation is not standardised.
</p>
<p>As in Section B.3, "functionally equivalent" allows some
        implementation flexibility when the token bucket is very nearly empty
        or very nearly full.
</p>
<p>Packet size independent marking is specified as a SHOULD in Section
        2.4 ( "if the token bucket is within an MTU of being empty, then the
        meter SHOULD indicate to the Marking function that the packet is to be
        excess-traffic-marked; MTU means the maximum size of PCN-packets on
        the link".) Without it, large packets are more likely to be
        excess-traffic-marked than small packets and this means that, with
        some edge behaviours, flows with large packets are more likely to be
        terminated than flows with small packets <a class='info' href='#I-D.briscoe-tsvwg-byte-pkt-mark'>[I&#8209;D.briscoe&#8209;tsvwg&#8209;byte&#8209;pkt&#8209;mark]<span> (</span><span class='info'>Briscoe, B., &ldquo;Byte and Packet Congestion Notification,&rdquo; February&nbsp;2008.</span><span>)</span></a> <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>.
</p>
<p>Section 2.4 specifies: "A packet SHOULD NOT be metered (by this
        excess traffic meter function) ... If the packet is already
        excess-traffic-marked on arrival at the PCN-node". This avoids
        over-termination (with some edge behaviours) in the event that the
        PCN-traffic passes through multiple bottlenecks in the PCN-domain
        <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a>. Note that an
        implementation could determine whether the packet is already
        excess-traffic-marked as an integral part of its Classification
        function.
</p>
<p>Section 2.4 specifies: "A packet SHOULD NOT be metered (by this
        excess traffic meter function) ... If this PCN-node drops the packet."
        This avoids over-termination <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. (A similar
        statement could also be made for the threshold meter function, but is
        irrelevant, as a link that is overloaded will already be substantially
        pre-congested and hence PCN-marking all packets.)
</p>
<p>Note that TBexcess.max is independent of TBthreshold.max;
        TBexcess.fill is independent of TBthreshold.fill (except in that a
        packet changes both); and the two configured rates, PCN-excess-rate
        and PCN-threshold-rate are independent (except that PCN-excess-rate
        &gt;= PCN-threshold-rate).
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.7"></a><h3>B.7.&nbsp;
Marking</h3>

<p>Section 2.5 defines: "A PCN-node MUST NOT ...change a PCN-packet
        into a non PCN-packet". This means that a PCN-node MUST NOT traffic
        condition by downgrading a PCN-packet into a lower priority DiffServ
        BA. The bullet needs to be modified if the WG decides to allow such
        traffic conditioning.
</p>
<p>Section 2.5 defines: "A PCN-node MUST NOT ...PCN-mark a packet that
        is not a PCN-packet". This means that in the scenario where
        competing-non-PCN-packets are treated as metered-packets, a meter may
        indicate a packet is to be PCN-marked, but the Marking function knows
        it cannot be marked. It is left open to the implementation exactly
        what to do in this case; one simple possibility is to mark the next
        PCN-packet. Note that unless the PCN-packets are a large fraction of
        all the metered-packets then the PCN mechanisms may not work well.
</p>
<p>Although the metering functions are described separately from the
        Marking function, they can be implemented in an integrated
        fashion.
</p>
<p>In some environments encoding states may be scarce, for example
        MPLS <a class='info' href='#RFC5129'>[RFC5129]<span> (</span><span class='info'>Davie, B., Briscoe, B., and J. Tay, &ldquo;Explicit Congestion Marking in MPLS,&rdquo; January&nbsp;2008.</span><span>)</span></a>, and then it may be preferable to
        have only two encoding states, as in the baseline encoding <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a>. In other environments
        it will be possible to use one of the extension encodings that specify
        three encoding states.
</p>
<p>Section 2.5 states: "if three encoding states are available ... if
        the threshold meter indicates marking and the excess traffic meter
        doesn't, then threshold-marking is applied; if the excess traffic
        meter indicates marking and the threshold traffic meter doesn't, then
        excess-traffic-marking is applied". The latter case seems infeasible
        but is possible for a short time - because the meters might react at
        different speeds when the traffic rate changes.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philip Eardley </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adastral Park, Martlesham Heath</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ipswich  IP5 3RE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UK</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:philip.eardley@bt.com">philip.eardley@bt.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
