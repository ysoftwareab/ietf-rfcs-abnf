<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>TEAP Update and Extensions for Bootstrapping</title>
<meta content="Eliot Lear" name="author">
<meta content="Owen Friel" name="author">
<meta content="Nancy Cam-Winget" name="author">
<meta content="Dan Harkins" name="author">
<meta content="
       In certain environments, in order for a device to establish any layer
three communications, it is necessary for that device to be properly
credentialed.  This is a relatively easy problem to solve when a
device is associated with a human being and has both input and display
functions.  It is less easy when the human, input, and display
functions are not present.  To address this case, this memo specifies
extensions to the Tunnel Extensible Authentication Protocol (TEAP)
method that leverages Bootstrapping Remote Secure Key Infrastructures
(BRSKI) in order to provide a credential to a device at layer two.
The basis of this work is that a manufacturer will introduce the
device and the local deployment through cryptographic means.  In this
sense the same trust model as BRSKI is used. 
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-lear-eap-teap-brski-06" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 57.4.0
    six 1.16.0
-->
<link href="/tmp/draft-lear-eap-teap-brski-rika4pen.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">TEAP Update and Extensions</td>
<td class="right">August 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Lear, et al.</td>
<td class="center">Expires 26 February 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-lear-eap-teap-brski-06</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfcRFC7170" class="eref">RFC7170</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-08-25" class="published">25 August 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-02-26">26 February 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Lear</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">O. Friel</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">N. Cam-Winget</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">D. Harkins</div>
<div class="org">HP Enterprise</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">TEAP Update and Extensions for Bootstrapping</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">In certain environments, in order for a device to establish any layer
three communications, it is necessary for that device to be properly
credentialed.  This is a relatively easy problem to solve when a
device is associated with a human being and has both input and display
functions.  It is less easy when the human, input, and display
functions are not present.  To address this case, this memo specifies
extensions to the Tunnel Extensible Authentication Protocol (TEAP)
method that leverages Bootstrapping Remote Secure Key Infrastructures
(BRSKI) in order to provide a credential to a device at layer two.
The basis of this work is that a manufacturer will introduce the
device and the local deployment through cryptographic means.  In this
sense the same trust model as BRSKI is used.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 26 February 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc ulBare compact">
<li class="ulEmpty toc ulBare compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-teap-brski-architecture" class="xref">TEAP BRSKI Architecture</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-brski-bootstrap-and-enroll-" class="xref">BRSKI Bootstrap and Enroll Operation</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-discovery-of-trusted-masa" class="xref">Discovery of Trusted MASA</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-executing-brski-in-a-teap-t" class="xref">Executing BRSKI in a TEAP Tunnel</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-pki-certificate-considerati" class="xref">PKI Certificate Considerations</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-teap-tunnel-establishment" class="xref">TEAP Tunnel Establishment</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-brski-trust-establishment" class="xref">BRSKI Trust Establishment</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-certificate-expiration-time" class="xref">Certificate Expiration Times</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-ldevid-subject-and-subject-" class="xref">LDevID Subject and Subject Alternative Names</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-pkcs10-retry-handling" class="xref">PKCS#10 Retry Handling</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-peer-identity" class="xref">Peer Identity</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-channel-and-crypto-binding" class="xref">Channel and Crypto Binding</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-protocol-flows" class="xref">Protocol Flows</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-teap-server-grants-access" class="xref">TEAP Server Grants Access</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-teap-server-instructs-clien" class="xref">TEAP Server Instructs Client to Perform BRSKI Flow</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-teap-server-instructs-client-" class="xref">TEAP Server Instructs Client to Reenroll</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="xref">7.4</a>.  <a href="#name-out-of-band-reenroll" class="xref">Out of Band Reenroll</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-teap-tlv-formats" class="xref">TEAP TLV Formats</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-new-tlvs" class="xref">New TLVs</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1.2.1">
                    <p id="section-toc.1-1.8.2.1.2.1.1"><a href="#section-8.1.1" class="xref">8.1.1</a>.  <a href="#name-brski-requestvoucher-tlv" class="xref">BRSKI-RequestVoucher TLV</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1.2.2">
                    <p id="section-toc.1-1.8.2.1.2.2.1"><a href="#section-8.1.2" class="xref">8.1.2</a>.  <a href="#name-brski-voucher-tlv" class="xref">BRSKI-Voucher TLV</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1.2.3">
                    <p id="section-toc.1-1.8.2.1.2.3.1"><a href="#section-8.1.3" class="xref">8.1.3</a>.  <a href="#name-csr-attributes-tlv" class="xref">CSR-Attributes TLV</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1.2.4">
                    <p id="section-toc.1-1.8.2.1.2.4.1"><a href="#section-8.1.4" class="xref">8.1.4</a>.  <a href="#name-retry-after-tlv" class="xref">Retry-After TLV</a></p>
</li>
                  <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.1.2.5">
                    <p id="section-toc.1-1.8.2.1.2.5.1"><a href="#section-8.1.5" class="xref">8.1.5</a>.  <a href="#name-nai-tlv" class="xref">NAI TLV</a></p>
</li>
                </ul>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-existing-teap-tlv-specifica" class="xref">Existing TEAP TLV Specifications</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.2.2.1">
                    <p id="section-toc.1-1.8.2.2.2.1.1"><a href="#section-8.2.1" class="xref">8.2.1</a>.  <a href="#name-pkcs10-tlv" class="xref">PKCS#10 TLV</a></p>
</li>
                </ul>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-tlv-rules" class="xref">TLV Rules</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-fragmentation" class="xref">Fragmentation</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-issues-with-provisionally-a" class="xref">Issues with Provisionally Authenticated TEAP</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-attack-against-discovery" class="xref">Attack Against Discovery</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#section-11.3" class="xref">11.3</a>.  <a href="#name-teap-server-as-registration" class="xref">TEAP Server as Registration Authority</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#section-11.4" class="xref">11.4</a>.  <a href="#name-trust-of-registrar" class="xref">Trust of Registrar</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="toc ulBare ulEmpty compact">
<li class="toc ulBare ulEmpty compact" id="section-toc.1-1.13.2.1">
                <p id="section-toc.1-1.13.2.1.1"><a href="#section-13.1" class="xref">13.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="toc ulBare ulEmpty compact" id="section-toc.1-1.13.2.2">
                <p id="section-toc.1-1.13.2.2.1"><a href="#section-13.2" class="xref">13.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-changes-from-earlier-versio" class="xref">Changes from Earlier Versions</a></p>
</li>
          <li class="ulEmpty toc ulBare compact" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1"><span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> (BRSKI) specifies a means to
provision credentials to be used as credentials to operationally
access networks.  It was designed as a standalone means where some
limited access to an IP network is already available.  This is not
always the case.  For example, IEEE 802.11 networks generally require
authentication prior to any form of address assignment.  While it is
possible to assign an IP address to a device on some form of an open
network, or to accept some sort of default credential to establish
initial IP connectivity, the steps that would then follow might well
require that the device is placed on a new network, requiring reseting
all layer three parameters.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">A more  natural approach  in such  cases is to  more tightly  bind the
provisioning  of credentials with  the authentication  mechanism.  One
such way  to do this is  to make use of  the Extensible Authentication
Protocol (EAP)  <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> and the  Tunnel Extensible Authentication
Protocol  (TEAP)  method  <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span>.    Thus  we  define  new  TEAP
Type-Length-Value  (TLV) objects  that can  be used  to  transport the
BRSKI protocol messages within the context of a TEAP TLS tunnel.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3"><span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span> discusses the notion of provisioning peers.  Several
different mechanisms are available.  Section 3.8 of that document
acknowledges the concept of not initially authenticating the outer TLS
session so that provisioning may occur.  In addition, exchange of
multiple TLV messages between client and EAP server permits multiple
provisioning steps.<a href="#section-1-3" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The reader is presumed to be familiar with EAP terminology as stated
in <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span>.  In addition, the following terms are commonly used in
this document.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-2.1">BRSKI: Bootstrapping Remote Secure Key Infrastructures, as defined in
<span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span>.  The term is also used
to refer to the flow described in that document.<a href="#section-1.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.2">EST: Enrollment over Secure Transport, as defined in <span>[<a href="#RFC7030" class="xref">RFC7030</a>]</span>.<a href="#section-1.1-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-2.3">Voucher: a signed JSON object as defined in <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>.<a href="#section-1.1-2.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="arch">
<section id="section-2">
      <h2 id="name-teap-brski-architecture">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-teap-brski-architecture" class="section-name selfRef">TEAP BRSKI Architecture</a>
      </h2>
<p id="section-2-1">The TEAP BRSKI architecture is illustrated in
<a href="#brski-architecture" class="xref">Section 3</a>. The device talks to the TEAP server via the
Authenticator using any compliant transport such as <span>[<a href="#IEEE8021X" class="xref">IEEE8021X</a>]</span>.
The architecture illustrated shows an Authenticator distinct from
the TEAP server. This is a deployment optimization and when so
deployed the communication between Authenticator and TEAP server
is a AAA protocol such as RADIUS or DIAMETER.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">The architecture illustrated shows a co-located TEAP server and
BRSKI registrar. Not only are these two functions co-located, they
MUST be the same entity. This ensures that the entity identified in
the device's voucher request (the TEAP server) is the same entity
that signs the voucher request (the registrar).<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The registrar communicates with the BRSKI MASA service for the
purposes of getting signed vouchers.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">The registrar also communicates with a Certificate Authority in order
to issue LDevIDs. The architecture shows the registrar and CA as being
two logically separate entities, however the CA may be integrated into
the registrar. The device is not explicitly aware of whether the CA
and registrar functions are integrated.<a href="#section-2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2-5">
<pre>
+--------+     +---------+     +---------+     +------+
|        |     |         |     |  TEAP   |&lt;---&gt;| MASA |
|        |     | Authen- |     | server  |     +------+
| Device |&lt;---&gt;| ticator |&lt;---&gt;|         |
|        |     |         |     |  BRSKI  |     +------+
|        |     |         |     |Registrar|&lt;---&gt;|  CA  |
+--------+     +---------+     +---------+     +------+

</pre><a href="#section-2-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="brski-architecture">
<section id="section-3">
      <h2 id="name-brski-bootstrap-and-enroll-">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-brski-bootstrap-and-enroll-" class="section-name selfRef">BRSKI Bootstrap and Enroll Operation</a>
      </h2>
<p id="section-3-1">This section summarises the current BRSKI operation. The BRSKI flow
assumes the device has an IDevID and has a manufacturer installed
trust anchor that can be used to validate the BRSKI voucher. The BRSKI
flow compromises serveral main steps from the perspective of the
device:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">Step 1: Device discovers the registrar<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">Step 2: Device establishes provisional TLS connection to registrar<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.3">Step 3: Device sends voucher request message and receives signed voucher response<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.4">Step 4: Device validates voucher and validates provisional TLS connection to registrar<a href="#section-3-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.5">Step 5: Device downloads additional local domain CA information<a href="#section-3-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.6">Step 6: Device downloads Certificate Signing Request (CSR) attributes<a href="#section-3-2.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.7">Step 7: Device does a certificate enroll to obtain an LDevID<a href="#section-3-2.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.8">Step 8: Device periodically reenrolls via EST to refresh its LDevID<a href="#section-3-2.8" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-3">Most of the operational steps require the device, and thus its internal state machine, to automatically complete the next step without being explicitly instructed to do so by the registrar. For example, the registrar does not explicitly tell the device to download additional local domain CA information, or to do an EST enroll to obtain an LDevID.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="discovery-of-trusted-masa">
<section id="section-3.1">
        <h3 id="name-discovery-of-trusted-masa">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-discovery-of-trusted-masa" class="section-name selfRef">Discovery of Trusted MASA</a>
        </h3>
<p id="section-3.1-1">BRSKI section 2.8 outlines how the Registrar discovers the correct MASA to connect with. BRSKI section 5.3 outlines how the Registrar can make policy decisions about which devices to trust.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Similar approaches are applicable for TEAP servers executing BRSKI. For example, the TEAP server may be configured with a list of trusted manufacturing CAs. During device bootstrap, only devices with an IDevID signed by a trusted manufacturing CA may be allowed to etablishes a TLS connection with the TEAP server, and the TEAP server could then extract the MASA URI from the device's IDevID.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="bint">
<section id="section-3.2">
        <h3 id="name-executing-brski-in-a-teap-t">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-executing-brski-in-a-teap-t" class="section-name selfRef">Executing BRSKI in a TEAP Tunnel</a>
        </h3>
<p id="section-3.2-1">This section outlines how the main BRSKI steps outlined above map to TEAP, and how BRSKI and enrollment can be accomplished inside a TEAP TLS tunnel. The following new TEAP TLVs are introduced:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-2.1">BRSKI-VoucherRequest<a href="#section-3.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-2.2">BRSKI-Voucher<a href="#section-3.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-2.3">CSR-Attributes<a href="#section-3.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-3">The following steps outline how the above BRSKI flow maps to TEAP.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">Step 1: Device discovers the registrar<a href="#section-3.2-4.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-5">When BRSKI is executed in a TEAP tunnel, the device exchanges BRSKI TLVs with the TEAP server. The discovery process for devices is therefore the standard wired or wireless LAN EAP server discovery process. The discovery processes outlined in section 4 of <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> are not required for initial discovery of the registrar.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-6.1">Step 2: Device establishes provisional TLS connection to registrar<a href="#section-3.2-6.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-7">The device establishes an outer TEAP tunnel with the TEAP server and
does not validate the server certificate. 
The device presents its LDevID as its identity
certificate if it has a valid LDevID, otherwise it presents its
IDevID. The TEAP server validates the device's certificate using
its implicit or explicit trust anchor database. If the device
presents an IDevID it is verified against a database of trusted
manufacturer certificates. Server policy may also be used to control
which certificate the device is allowed present, as described in
section {pki-certificate-authority-considerations}.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
<p id="section-3.2-8">If the presented credential is sufficient to grant access, the TEAP server can return a TEAP Result TLV indicating success immediately. The device may still send a Request-Action TLV including a BRSKI-VoucherRequest TLV in response to the TEAP Result TLV if it does not have, but requires, provisioning of trust anchors for validating the TEAP server certificate. Note that no inner EAP method is required for this, only an exchange of TEAP TLVs.<a href="#section-3.2-8" class="pilcrow">¶</a></p>
<p id="section-3.2-9">[todo] Question: as the device wants the server to reply with a BRSKI-Voucher TLV, does it really send a Request-Action TLV containing a BRSKI-VoucherRequest TLV, or does it send a Request-Action TLV containing a BRSKI-Voucher TLV?? The TEAP draft is a bit ambiguous here. Normally, if one end sends a Request-Action including XXX-TLV, it means it wants the far end ot send an XXX-TLV...<a href="#section-3.2-9" class="pilcrow">¶</a></p>
<p id="section-3.2-10">[todo] Question: general TEAP protocol question: does the device have to send a Request-Action w/BRSKI-VoucherRequest or can it send a BRSKI-VoucherRequest on its own? I'm not clear on this.<a href="#section-3.2-10" class="pilcrow">¶</a></p>
<p id="section-3.2-11">If the TEAP server requires that the device execute a BRSKI flow, the server sends a Request-Action TLV that includes a BRSKI-VoucherRequest TLV. For example, if the device presented its IDevID but the TEAP server requires an LDevID.<a href="#section-3.2-11" class="pilcrow">¶</a></p>
<p id="section-3.2-12">[todo] Question: to nit pick, the server should send a Request-Action TLV including a PKCS#10 TLV to tell the client to enroll. How does the server really know that the client has the correct trust established (as previously received by a BRSKI-Voucher)? If the client sends an IDevID, does server always send a Request-Action including both BRSKI-VoucherRequest and PKCS#10 TLVs? Whats the client behaviour? I assume client can spontaneously send BRSKI-VoucherRequest and/or PCSK#10 without being explicitly instructed to. Just need to get the language correct here.<a href="#section-3.2-12" class="pilcrow">¶</a></p>
<p id="section-3.2-13">The TEAP server may also require the device to reenroll, for example, if the device presented a valid LDevID that is very closed to expiration. The server may instruct a device to reenroll by sending a Request-Action TLV that includes a zero byte length PKCS#10 TLV.<a href="#section-3.2-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-14.1">Step 3: Device sends voucher request message and receives signed voucher response<a href="#section-3.2-14.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-15">The device sends a BRSKI-RequestVoucher TLV to the TEAP server. The
TEAP server forwards the RequestVoucher message to the MASA server,
and the MASA server replies with a signed voucher. The TEAP server
sends a BRSKI-Voucher TLV to the device.<a href="#section-3.2-15" class="pilcrow">¶</a></p>
<p id="section-3.2-16">If the MASA server does not issue a signed voucher, the TEAP server
sends an EAP-Error TLV with a suitable error code to the device.<a href="#section-3.2-16" class="pilcrow">¶</a></p>
<p id="section-3.2-17">For wireless devices in particular, it is important that the MASA
server only return a voucher for devices known to be associated with a
particular registrar.  In this sense, success indicates that the
device is on the correct network, while failure indicates the device
should try to provision itself within wireless networks (e.g, go to
the next SSID).<a href="#section-3.2-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-18.1">Step 4: Device validates voucher and validates provisional TLS connection to registrar<a href="#section-3.2-18.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-19">The device validates the signed voucher using its manufacturer
installed trust anchor, and uses the CA information in the voucher to
validate the TLS connection to the TEAP server.<a href="#section-3.2-19" class="pilcrow">¶</a></p>
<p id="section-3.2-20">If the device fails to validate the voucher, then it sends a TEAP-Error TLV indicating failiure to the TEAP server.<a href="#section-3.2-20" class="pilcrow">¶</a></p>
<p id="section-3.2-21">Similarly, if the device validates the voucher, but fails to validate the provisional TLS connection, then it sends a TEAP-Error TLV indicating failure to the TEAP server. Note that the outer TLS tunnel has already been established, thus allowing the client to send a TEAP-Error TLV to the server inside that tunnel to indicate that it failed to verify the provisionally accepted outer TLS tunnel server identity.<a href="#section-3.2-21" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-22.1">Step 5: Device downloads additional local domain CA information<a href="#section-3.2-22.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-23">On completion of the BRSKI flow, the device SHOULD send a
Trusted-Server-Root TLV to the TEAP server in order to discover
additional local domain CAs. This is equivalent to section [todo] from <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span>.<a href="#section-3.2-23" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-24.1">Step 6: Device downloads CSR attributes<a href="#section-3.2-24.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-25">No later than the completion of step 5, server MUST send a
CSR-Attributes TLV to peer server in order to discover the correct
fields to include when it enrolls to get an LDevID.<a href="#section-3.2-25" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-26.1">Step 7: Device does a certificate enroll to obtain an LDevID<a href="#section-3.2-26.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-27">When executing the BRSKI flow inside a TEAP tunnel, the device does
not directly leverage EST when doing its initial enroll. Instead, the
device uses the existing TEAP PKCS#10 and PCKS#7 TEAP mechanisms.<a href="#section-3.2-27" class="pilcrow">¶</a></p>
<p id="section-3.2-28">Once the BRSKI flow is complete, the device can now send a PKCS#10 TLV
to enroll and request an LDevID. If the TEAP server instructed the
device to start the BRSKI flow via a Request-Action TLV that includes
a BRSKI-RequestVoucher TLV, then the device MUST send a PKCS#10 in
order to start the enroll process. The TEAP server will handle the
PKCS#10 and ultimately return a PKCS#7 including an LDevID to the
device.<a href="#section-3.2-28" class="pilcrow">¶</a></p>
<p id="section-3.2-29">If the TEAP server granted the device access on completion of the
outer TEAP TLS tunnel in step 2 without sending a Request-Action TLV,
the device does not have to send a PKCS#10 to enroll.<a href="#section-3.2-29" class="pilcrow">¶</a></p>
<p id="section-3.2-30">At this point, the device is said to be provisioned for local network
access, and may authenticate in the future via 802.1X with its newly
acquired credentials.<a href="#section-3.2-30" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-31.1">Step 8: Device periodically reenrolls to refresh its LDevID<a href="#section-3.2-31.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-32">When a device's LDevID is close to expiration, there are two options
for re-enrollment in order to obtain a fresh LDevID. As outlined in
Step 2 above, the TEAP server may instruct the device to reenroll by
sending a Request-Action TLV including a PKCS#10 TLV. If the TEAP
server explicilty instructs the device to reenroll via these TLV
exchange, then the device MUST send a PKCS#10 to reenroll and request
a fresh LDevID.<a href="#section-3.2-32" class="pilcrow">¶</a></p>
<p id="section-3.2-33">However, the device SHOULD reenroll if it determines that its LDevID
is close to expiration without waiting for explicit instruction from
the TEAP server. There are two options to do this.<a href="#section-3.2-33" class="pilcrow">¶</a></p>
<p id="section-3.2-34">Option 1: The device reenrolls for a new LDevID directly with the EST
CA outside the context of the 802.1X TEAP flow. The device uses the
registrar discovery mechanisms oulined in
<span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> to discover the registrar
and the device sends the EST reenroll messages to the discovered
registrar endpoint. No new TEAP TLVs are defined to facilitate
discover of the registrar or EST endpoints inside the context of the
TEAP tunnel.<a href="#section-3.2-34" class="pilcrow">¶</a></p>
<p id="section-3.2-35">Option 2: When the device is performing a periodic 802.1X
authentication using its current LDevID, it reenrolls for a new LDevID
by sending a PKCS#10 TLV inside the TEAP TLS tunnel.<a href="#section-3.2-35" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="pki-certificate-considerations">
<section id="section-4">
      <h2 id="name-pki-certificate-considerati">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-pki-certificate-considerati" class="section-name selfRef">PKI Certificate Considerations</a>
      </h2>
<p id="section-4-1">There are multiple noteworthy PKI certificate handling considerations. These include:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">PKI CA handling when establishing the TEAP tunnel<a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.2">PKI CA handling establishing trust using BRSKI<a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.3">IDevID and LDevID expiration times<a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.4">Specifying LDevID Subject and Subject Alternative Names<a href="#section-4-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.5">PKCS#10 retry handling<a href="#section-4-2.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-3">These are described in more detail here.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="teap-tunnel-establishment">
<section id="section-4.1">
        <h3 id="name-teap-tunnel-establishment">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-teap-tunnel-establishment" class="section-name selfRef">TEAP Tunnel Establishment</a>
        </h3>
<p id="section-4.1-1">Because this method establishes a client identity, if the peer has not
been previously bootstrapped, or otherwise cannot successfully
authenticate, it will use a generic identity string of teap-bootstrap@TBD1
as its network access identifier (NAI).<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">BRSKI section 5.3 outlines the policy decisions a Registrar may make when deciding whether to accept connections from clients. Similarly, the TEAP server operator may configure a set of trusted CAs for validating incoming TLS connections from clients. The operator may want to 'allow any device from a specific vendor', or from a set of vendors, to access the network. Network operators may do this by restricting network access to clients that have a certificate signed by one of a small set of trusted manufacturer/supplier CAs.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">When the client sends its ClientHello to initiate TLS tunnel establishment, it is possible for the TEAP server to restrict the certificates that the client can use for tunnel establishment by including a list of CA distinguished names in the certificate_authorities field in the CertificateRequest message. The client should only continue with the handshake if it has a certificate signed by one of the indicated CAs.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">In practice, network operators will likely want to onboard devices from a large number of device manufacturers, with each manufacturer using a different root CA when issuing IDevIDs. If the number of different manufacturer root CAs is large, this could result in very large TLS handshake messages. Therefore, the TEAP server may send a CertificateRequest message and not specify any certificate_authorities, thus allowing the client present a certificate signed by any authority in its Certificate message.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">If the client has both an IDevID and an LDevID, the client should present the LDevID in preference to its IDevID, if allowed by server policy.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">Once the client has sent its TLS Finished message, the TEAP server can make a policy decision, based on the CA used to sign the client's certificate, on whether to establish the outer TLS tunnel or not.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">The TEAP server may delegate policy decisions to the MASA or CA function. For example, the TEAP server may declare EAP success and grant network access if the client presents a valid LDevID signed by a trusted domain CA. However, if the client presents an IDevID signed by a trusted manufacturer CA, the TEAP server may establish the TLS tunnel but not declare EAP success and grant network access until the client successfully completes a BRSKI Voucher exchange and PKCS#10/PKCS#7 exchange inside that tunnel.<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<p id="section-4.1-8">It is recommended that the client validate the certificate presented
by the server in the server's Certificate message, but this may not be
possible for clients that have not yet provisioned appropriate trust
anchors. If the client is in the provisioning phase and
has not yet completed a BRSKI flow, it will not have trust anchors
installed yet, and thus will not be able to validate the server's
certificate. The client must however note the certificate presented by
the server for (i) inclusion in the BRSKI-RequestVoucher TLV and for
(ii) validation once the client has discovered the local domain trust
anchors.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">If the client does not present a suitable certificate to the server, the server MUST terminate the connection and fail the EAP request. If the TEAP server is unable to validate the client's certificate using its implicit or explicit trust anchor database it MUST fail the EAP request.<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<p id="section-4.1-10">On establishment of the outer TLS tunnel, the TEAP server will make a policy decision on next steps. Possible policy decisions include:<a href="#section-4.1-10" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-11.1">Option 1: Server grants client full network access and returns EAP-Success. This will typically happen when the client presents a valid LDevID. Network policy may grant client network access based on IDevID without requiring the device to enroll to obtain an LDevID.<a href="#section-4.1-11.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-11.2">Option 2: Server requires that client perform a full BRSKI flow, and then enroll to get an LDevID. This will typically happen when the client presents a valid IDevID and network policy requires all clients to have LDevIDs. The server sends a Request-Action TLV that includes a BRSKI-RequestVoucher TLV to the client to instruct it to start the BRSKI flow.<a href="#section-4.1-11.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-11.3">Option 3: Server requires that the client reenroll to obtain a new LDevID. This could happen when the client presents a valid LDevID that is very close to expiration time, or the server's policy requires an LDevID update. The server sends an Action-Request TLV including a PKCS#10 TLV to the client to instruct it to reenroll.<a href="#section-4.1-11.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="brski-trust-establishment">
<section id="section-4.2">
        <h3 id="name-brski-trust-establishment">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-brski-trust-establishment" class="section-name selfRef">BRSKI Trust Establishment</a>
        </h3>
<p id="section-4.2-1">If the server requires that client perform a full BRSKI flow, it sends a Request-Action TLV that includes a zero byte length BRSKI-RequestVoucher TLV to the client. The client sends a new BRSKI-RequestVoucher TLV to the server, which contains all data specified in <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> section 5.2. The client includes the server certificate it received in the server's Certificate message during outer TLS tunnel establishment in the proximity-registrar-cert field. The client signs the request using its IDevID.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">The server includes all additional information as required by <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> section 5.4 and signs the request prior to forwarding to the MASA.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">The MASA responds as per <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> section 5.5. The response may indicate failure and the server should react accordingly to failures by sending a failure response to the client, and failing the TEAP method.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">If the MASA replies with a signed voucher and a successful result, the server then forwards this response to the client in a BRSKI-Voucher TLV.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">When the client receives the signed voucher, it validates the signature using its built in trust anchor list, and extracts the pinned-domain-cert field. The client must use the CA included in the pinned-domain-cert to validate the certificate that was presented by the server when establishing the outer TLS tunnel. If this certificate validation fails, the client must fail the TEAP request and not connect to the network.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">[TBD- based on client responses, the registrar sends a status update
to the MASA]<a href="#section-4.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="certificate-expiration-times">
<section id="section-4.3">
        <h3 id="name-certificate-expiration-time">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-certificate-expiration-time" class="section-name selfRef">Certificate Expiration Times</a>
        </h3>
<p id="section-4.3-1"><span>[<a href="#IEEE8021AR" class="xref">IEEE8021AR</a>]</span> section 7.2.7.2 states:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal ulEmpty">
<li class="normal ulEmpty" id="section-4.3-2.1">notAfter: The latest time a DevID is expected to be used. Devices possessing an IDevID are expected to operate indefinitely into the future and should use the value 99991231235959Z. Solutions verifying an IDevID are expected to accept this value indefinitely.<a href="#section-4.3-2.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.3-3">TEAP servers SHOULD follow the 802.1AR standard when validating IDevIDs.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">TEAP servers SHOULD reject LDevIDs with expired certificates and SHOULD NOT allow clients to connect with recently expired LDevIDs. If a client presents a recently expired LDevID it SHOULD be forced to authenticate using its IDevID and then reenroll to obtain a valid LDevID.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="ldevid-subject-and-subject-alternative-names">
<section id="section-4.4">
        <h3 id="name-ldevid-subject-and-subject-">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-ldevid-subject-and-subject-" class="section-name selfRef">LDevID Subject and Subject Alternative Names</a>
        </h3>
<p id="section-4.4-1">BRSKI section 5.9.2 specifies that the pledge MUST send a CSR Attributes request to the registrar. The registrar MAY use this mechanism to instruct the pledge about the identities it should include in the CSR request it sends as part of enrollment. The registrar may use this mechanism to tell the pledge what Subject or Subject Alternative Name identity information to include in its CSR request. This can be useful if the Subject must have a specific value in order to complete enrollment with the CA.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="pkcs10-retry-handling">
<section id="section-4.5">
        <h3 id="name-pkcs10-retry-handling">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-pkcs10-retry-handling" class="section-name selfRef">PKCS#10 Retry Handling</a>
        </h3>
<p id="section-4.5-1">They will be scenarios where the TEAP server is willing to handle a PKCS#10 request from a client and issue a certificate via a PKCS#7 response, however, the TEAP server is unable to immediately completely the request and needs to instruct the client to retry later after a specified time interval.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<p id="section-4.5-2">A new Retry-After TLV is defined that the TEAP server uses to specify a retry interval in seconds. New error codes are defined to handle these two alternate retry scenarios.<a href="#section-4.5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.5-3.1">The TEAP tunnel remains up: The client is instructed to resend the PKCS#10 request after a retry interval but inside the same TEAP tunnel. The TEAP server returns a Retry-After TLV to the client, and returns an Error TLV with a new code in the 1000-1999 range.<a href="#section-4.5-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.5-3.2">The TEAP tunnel is torn down: The client is instructed to establish a new TEAP connection and TEAP tunnel after a retry interval, and resend the PKCS#10 request indside the new tunnel.  The TEAP server returns a Retry-After TLV to the client, and returns an Error TLV with a new code in the 2000-2999 range.<a href="#section-4.5-3.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="peer-identity">
<section id="section-5">
      <h2 id="name-peer-identity">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-peer-identity" class="section-name selfRef">Peer Identity</a>
      </h2>
<p id="section-5-1">EAP <span>[<a href="#RFC3748" class="xref">RFC3748</a>]</span> recommends that "the Identity Response be used primarily for routing purposes and selecting which EAP method to use". NAI <span>[<a href="#RFC7542" class="xref">RFC7542</a>]</span> recommends ommitting the username part of an NAI in order to support username privacy, where appropriate.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">A device that has not been bootstrapped at all SHOULD send an identity of
teap-bootstrap@TBD1.  Otherwise, a device SHOULD send its configured NAI.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The TEAP server may specify an NAI that it wishes the device to use. For example, the server may want a bootstrapped device to use an NAI of "abc123@example.com", or simply an NAI of "@example.com". This could be desirable in order to facilitate roaming scenarios. The server can do this by sending the device an NAI TLV inside the TEAP tunnel.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">If the server specifies an NAI TLV, and the device handles the TLV, the device MAY use the specified NAI in all subsequent EAP authentication flows. If the device is not willing to handle the NAI TLV, it MUST reply with an Error TLV.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">Authentication servers implementing this specification MAY reply with
an Error TLV to any unrecognized NAI, or MAY attempt to bootstrap the
device, regardless of the NAI.  A device receving an Error from the
server MAY attempt a new session without the NAI in order to
bootstrap.<a href="#section-5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="channel-and-crypto-binding">
<section id="section-6">
      <h2 id="name-channel-and-crypto-binding">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-channel-and-crypto-binding" class="section-name selfRef">Channel and Crypto Binding</a>
      </h2>
<p id="section-6-1">As the TEAP BRSKI flow does not define or require an inner EAP method, there is no explicit need for exchange of Channel-Binding TLVs between the device and the TEAP server.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The TEAP BRSKI TLVs are expected to occur at the beginning of the TEAP Phase 2 and MUST occur before the final Crypto-Binding TLV.  This draft does not exclude the possibility of having other EAP methods occur following the TEAP BRSKI TLVs and as such, the Crypto-Binding TLV process rules as defined in <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span> apply.<a href="#section-6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-flows">
<section id="section-7">
      <h2 id="name-protocol-flows">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-protocol-flows" class="section-name selfRef">Protocol Flows</a>
      </h2>
<p id="section-7-1">This section outlines protocol flows that map to the three server policy
options described in section <a href="#teap-tunnel-establishment" class="xref">Section 4.1</a>. The
protocol flows illustrate a TLS1.2 exchange. Pertinent notes are
outlined in the protocol flows.<a href="#section-7-1" class="pilcrow">¶</a></p>
<div id="teap-server-grants-access">
<section id="section-7.1">
        <h3 id="name-teap-server-grants-access">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-teap-server-grants-access" class="section-name selfRef">TEAP Server Grants Access</a>
        </h3>
<p id="section-7.1-1">In this flow, the server grants access as server policy allows the client to access the network based on the identity certificate that the client presented. This means that either (i) the client has previously completed BRSKI and has presented a valid LDevID or (ii) the client presents an IDevID and network policy allows access based purely on IDevID.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<span id="name-teap-server-grants-access-2"></span><div id="flow-1">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-7.1-2.1">
<pre>
      ,------.             ,----------.
      |Client|             |TEAPServer|
      `--+---'             `----+-----'
         |     EAP-Request/     |
         |     Identity         |
         | &lt;---------------------
         |                      |
         |     EAP-Response/    |
         |     Type=Identity    |
         | ---------------------&gt;
         |                      |
         |   EAP-Request/       |
         |   Type=TEAP,         |
         |   TEAP Start,        |
         |   Authority-ID TLV   |
         | &lt;---------------------
         |                      |
         |   EAP-Response/      |
         |   Type=TEAP,         |
         |   TLS(ClientHello)   |
         | ---------------------&gt;
         |                      |
         |  EAP-Request/        |
  ,---!. |  Type=TEAP,          |
  |(1)|_\|  TLS(ServerHello,    |
  |(2)  ||  ServerKeyExchange,  |
  `-----'|  ServerHelloDone)    |
         | &lt;---------------------
         |                      |
         |  EAP-Response/       |
         |  Type=TEAP,          |
  ,---!. |  ClientKeyExchange,  |
  |(3)|_\|  CertificateVerify,  |
  `-----'|  ChangeCipherSpec,   |
         |  Finished)           |
         | ---------------------&gt;
         |                      |
         | EAP-Request/         |
         | Type=TEAP,           |
         | TLS(ChangeCipherSpec,|
         | Finished),           |
         | {Crypto-Binding TLV, |
         | Result TLV=Success}  |
         | &lt;---------------------
         |                      |
         | EAP-Response/        |
         | Type=TEAP,           |
         | {Crypto-Binding TLV, |
         | Result TLV=Success}  |
         | ---------------------&gt;
         |                      |
         |      EAP-Success     |
         | &lt;---------------------
      ,--+---.             ,----+-----.
      |Client|             |TEAPServer|
      `------'             `----------'
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-teap-server-grants-access-2" class="selfRef">TEAP Server Grants Access</a>
          </figcaption></figure>
</div>
<p id="section-7.1-3">Notes:<a href="#section-7.1-3" class="pilcrow">¶</a></p>
<p id="section-7.1-4">(1) If the client has completed the BRSKI flow and has locally significant trust anchors, it must validate the Certificate received from the server. If the client has not yet completed the BRSKI flow, then it provisionally accepts the server Certificate and must validate it later once BRSKI is complete.<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<p id="section-7.1-5">(2) The server may include certificate_authorities field in the CertificateRequest message in order to restrict the identity certificates that the device is allowed present.<a href="#section-7.1-5" class="pilcrow">¶</a></p>
<p id="section-7.1-6">(3) The device will present its LDevID, if it has one, in preference to its IDevID, if allowed by server policy.<a href="#section-7.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="teap-server-instructs-client-to-perform-brski-flow">
<section id="section-7.2">
        <h3 id="name-teap-server-instructs-clien">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-teap-server-instructs-clien" class="section-name selfRef">TEAP Server Instructs Client to Perform BRSKI Flow</a>
        </h3>
<p id="section-7.2-1">In this two part flow, the server instructs the client to perform a BRSKI flow by exchanging TLVs once the outer TLS tunnel is established.  After that, enrollment takes place.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<p id="section-7.2-2">In the first part of the flow, the MASA is depicted on the right.<a href="#section-7.2-2" class="pilcrow">¶</a></p>
<span id="name-teap-server-instructs-client"></span><div id="flow-2a">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-7.2-3.1">
<pre>
      ,------.                           ,----------.          ,----.
      |Client|                           |TEAPServer|          |MASA|
      `--+---'                           `----+-----'          `-+--'
         |            EAP-Request/            |                  |
         |            Type=Identity           |                  |
         | &lt;-----------------------------------                  |
         |                                    |                  |
         |            EAP-Response/           |                  |
         |            Type=Identity           |                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
         |          EAP-Request/              |                  |
  ,---!. |          Type=TEAP,                |                  |
  |(1)|_\|          TEAP Start,               |                  |
  `-----'|          Authority-ID TLV          |                  |
         | &lt;-----------------------------------                  |
         |                                    |                  |
         |          EAP-Response/             |                  |
         |          Type=TEAP,                |                  |
         |          TLS(ClientHello)          |                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
         |         EAP-Request/               |                  |
         |         Type=TEAP,                 |                  |
         |         TLS(ServerHello,           |                  |
         |         Certificate,               |                  |
         |         ServerKeyExchange,         |                  |
         |         CertificateRequest,        |                  |
         |         ServerHelloDone)           |                  |
         | &lt;-----------------------------------                  |
         |                                    |                  |
         |         EAP-Response/              |                  |
         |         Type=TEAP,                 |                  |
         |         TLS(Certificate            |                  |
         |         ClientKeyExchange,         |                  |
         |         CertificateVerify,         |                  |
         |         ChangeCipherSpec,          |                  |
         |         Finished)                  |                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
         |        EAP-Request/                |                  |
         |        Type=TEAP,                  |                  |
         |        TLS(ChangeCipherSpec,       |                  |
         |        Finished),                  |                  |
         |        {Crypto-Binding TLV,        |                  |
         |        Result TLV=Success}         |                  |
         | &lt;-----------------------------------                  |
         |                                    |                  |
         |        EAP-Response/               |                  |
         |        ,Type=TEAP,                 |                  |
         |        {Crypto-Binding TLV,        |                  |
         |        Result TLV=Success}         |                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
  ,-------------------------------------------------!.           |
  |At this stage the outer TLS tunnel is established|_\          |
  |The following message exchanges are for BRSKI      |          |
  `---------------------------------------------------'          |
         |      EAP-Request/                  |                  |
         |      Type=TEAP,                    |                  |
         |      {Request-Action TLV:          |                  |
         |      Status=Failure,               |                  |
  ,---!. |      Action=Process-TLV,           |                  |
  |(2)|_\|      TLV=Request-Voucher,          |                  |
  `-----'|      TLV=Trusted-Server-Root,      |                  |
         |      TLV=CSR-Attributes,           |                  |
         |      TLV=PKCS#10}                  |                  |
         | &lt;-----------------------------------                  |
         |                                    |                  |
         |        EAP-Response/               |                  |
  ,---!. |        Type=TEAP,                  |                  |
  |(3)|_\|        {Request-Voucher TLV}       |                  |
  `-----'| -----------------------------------&gt;                  |
         |                                    |                  |
         |                                    |  RequestVoucher  |
         |                                    | -----------------&gt;
         |                                    |                  |
         |                                    |      Voucher     |
         |                                    | &lt;-----------------
         |                                    |                  |
         |            EAP-Request/            |                  |
  ,---!. |            Type=TEAP,              |                  |
  |(4)|_\|            {Voucher TLV}           |                  |
  `-----'| &lt;-----------------------------------                  |
         |                                    |                  |
         | EAP-Response/                      |                  |
         | Type=TEAP,{Trusted-Server-Root TLV}|                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
         |      EAP-Request/                  |                  |
  ,---!. |      Type=TEAP,                    |                  |
  |(5)|_\|      {Trusted-Server-Root TLV}     |                  |
  `-----'| &lt;-----------------------------------                  |
         |                                    |                  |
         |   EAP-Response/                    |                  |
         |   Type=TEAP,{CSR-Attributes TLV}   |                  |
         | -----------------------------------&gt;                  |
         |                                    |                  |
         |        EAP-Request/                |                  |
         |        Type=TEAP,                  |                  |
         |        {CSR-Attributes TLV}        |                  |
         | &lt;-----------------------------------                  |
      ,--+---.                           ,----+-----.          ,-+--.
      |Client|                           |TEAPServer|          |MASA|
      `------'                           `----------'          `----'
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-teap-server-instructs-client" class="selfRef">TEAP Server Instructs Client to Perform BRSKI Flow</a>
          </figcaption></figure>
</div>
<p id="section-7.2-4">The second part of the flow depicts the CA on the right.<a href="#section-7.2-4" class="pilcrow">¶</a></p>
<span id="name-enrollment-after-brski-flow"></span><div id="flow-2b">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-7.2-5.1">
<pre>
     ,------.            ,----------.          ,--.
     |Client|            |TEAPServer|          |CA|
     `--+---'            `----+-----'          `+-'
        |    EAP-Response/    |                 |
        |    Type=TEAP        |                 |
        |    {PKCS#10 TLV}    |                 |
        | --------------------&gt;                 |
        |                     |                 |
        |                     |     PKCS#10     |
        |                     | ----------------&gt;
        |                     |                 |
        |                     |      PKCS#7     |
        |                     | &lt;----------------
        |                     |                 |
        | EAP-Request/        |                 |
        | Type=TEAP,          |                 |
        | {PKCS#7 TLV,        |                 |
        | Result TLV=Success} |                 |
        | &lt;--------------------                 |
        |                     |                 |
        | Eap-Response/       |                 |
        | Type=TEAP           |                 |
        | {Result TLV=Success}|                 |
        | --------------------&gt;                 |
        |                     |                 |
        |     EAP-Success     |                 |
        | &lt;--------------------                 |
     ,--+---.            ,----+-----.          ,+-.
     |Client|            |TEAPServer|          |CA|
     `------'            `----------'          `--'
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-enrollment-after-brski-flow" class="selfRef">Enrollment after BRSKI Flow</a>
          </figcaption></figure>
</div>
<p id="section-7.2-6">Notes:<a href="#section-7.2-6" class="pilcrow">¶</a></p>
<p id="section-7.2-7">(1) If the client has not yet completed the BRSKI flow, then it provisionally accepts the server certificate and must validate it later once BRSKI is complete. The server validates the client certificate using its trust anchor database.<a href="#section-7.2-7" class="pilcrow">¶</a></p>
<p id="section-7.2-8">(2) The server instructs the client to start the BRSKI flow by sending a Request-Action TLV that includes a BRSKI-RequestVoucher TLV. The server also instructs the client to request trust anchors, to request CSR Attrites, and to initiate a PKCS certificate enrolment. As outlined in <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span>, the Request-Action TLV is sent after the Crypto-Binding TLV and Result TLV exchange.<a href="#section-7.2-8" class="pilcrow">¶</a></p>
<p id="section-7.2-9">(3) The client includes the certificate it received from the server in the RequestVoucher message.<a href="#section-7.2-9" class="pilcrow">¶</a></p>
<p id="section-7.2-10">(4) Once the client receives and validates the voucher signed by the MASA, it must verify the certificate it previously received from the server.<a href="#section-7.2-10" class="pilcrow">¶</a></p>
<p id="section-7.2-11">(5) As outlined in <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span>, the Trusted-Server-Root TLV is exchanged after the Crypto-Binding TLV exchange, and after the client has used the Voucher to authenticate the TEAP server identity. This is equivalent to section [todo] from <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span>.<a href="#section-7.2-11" class="pilcrow">¶</a></p>
<p id="section-7.2-12">(6) There is no need for an additional Crypto-Binding TLV exchange as there is no inner EAP method. All BRSKI exchanges are simply TLVs exchanged inside the outer TLS tunnel.<a href="#section-7.2-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="teap-server-instructs-client-to-reenroll">
<section id="section-7.3">
        <h3 id="name-teap-server-instructs-client-">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-teap-server-instructs-client-" class="section-name selfRef">TEAP Server Instructs Client to Reenroll</a>
        </h3>
<p id="section-7.3-1">In this flow, the server instructs the client to reenroll and get a new LDevID by exchanging TLVs once the outer TLS tunnel is established.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<span id="name-teap-server-instructs-client-t"></span><div id="flow-3">
<figure id="figure-4">
          <div class="artwork art-text alignLeft" id="section-7.3-2.1">
<pre>
      ,------.                      ,----------.          ,--.
      |Client|                      |TEAPServer|          |CA|
      `--+---'                      `----+-----'          `+-'
         |          EAP-Request/         |                 |
         |          Identity             |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |         EAP-Response/         |                 |
         |         Type=Identity         |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         |        EAP-Request/           |                 |
         |        Type=TEAP,             |                 |
         |        TEAP Start,            |                 |
         |        Authority-ID TLV       |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |        EAP-Response/          |                 |
         |        Type=TEAP,             |                 |
         |        TLS(ClientHello)       |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         |       EAP-Request/            |                 |
         |       Type=TEAP,              |                 |
         |       TLS(ServerHello,        |                 |
         |       ServerKeyExchange,      |                 |
         |       ServerHelloDone)        |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |       EAP-Response/           |                 |
         |       Type=TEAP,              |                 |
         |       ClientKeyExchange,      |                 |
         |       CertificateVerify,      |                 |
         |       ChangeCipherSpec,       |                 |
         |       Finished)               |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         |     EAP-Request/              |                 |
         |     Type=TEAP,                |                 |
         |     TLS(ChangeCipherSpec,     |                 |
         |     Finished),                |                 |
         |     {Crypto-Binding TLV,      |                 |
         |     Result TLV=Success}       |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |      EAP-Response/            |                 |
         |      Type=TEAP,               |                 |
         |      {Crypto-Binding TLV,     |                 |
         |      Result TLV=Success}      |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         | EAP-Request/                  |                 |
         | Type=TEAP,{Request-Action TLV:|                 |
  ,---!. | Status=Failure,               |                 |
  |(1)|_\| Action=Process-TLV,           |                 |
  `-----'| TLV=PKCS#10}                  |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |         EAP-Response/         |                 |
         |         Type=TEAP             |                 |
         |         {PKCS#10 TLV}         |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         |                               |     PKCS#10     |
         |                               | ----------------&gt;
         |                               |                 |
         |                               |      PKCS#7     |
         |                               | &lt;----------------
         |                               |                 |
         |      EAP-Request/             |                 |
         |      Type=TEAP,               |                 |
         |      {PKCS#7 TLV,             |                 |
         |      Result TLV=Success}      |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |      Eap-Response/            |                 |
         |      Type=TEAP                |                 |
         |      {Result TLV=Success}     |                 |
         | ------------------------------&gt;                 |
         |                               |                 |
         |          EAP-Success          |                 |
         | &lt;------------------------------                 |
         |                               |                 |
         |          EAP-Success          |                 |
         | &lt;------------------------------                 |
      ,--+---.                      ,----+-----.          ,+-.
      |Client|                      |TEAPServer|          |CA|
      `------'                      `----------'          `--'
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-teap-server-instructs-client-t" class="selfRef">TEAP Server Instructs Client to Reenroll</a>
          </figcaption></figure>
</div>
<p id="section-7.3-3">(1) The server instructs the client to reenroll by sending a Request-Action TLV that includes a PKCS#10 TLV.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="out-of-band-reenroll">
<section id="section-7.4">
        <h3 id="name-out-of-band-reenroll">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-out-of-band-reenroll" class="section-name selfRef">Out of Band Reenroll</a>
        </h3>
<p id="section-7.4-1">This section shows how the device does a reenroll to refresh its LDEvID directly against the registrar outside the context of the TEAP tunnel.<a href="#section-7.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="teap-tlv-formats">
<section id="section-8">
      <h2 id="name-teap-tlv-formats">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-teap-tlv-formats" class="section-name selfRef">TEAP TLV Formats</a>
      </h2>
<div id="new-tlvs">
<section id="section-8.1">
        <h3 id="name-new-tlvs">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-new-tlvs" class="section-name selfRef">New TLVs</a>
        </h3>
<p id="section-8.1-1">This document defines 5 new TEAP TLVs. The following table indicates whether
the TLVs can be included in Request messages from TEAP server to
device, or Response messages from device to TEAP server.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1-2">
<pre>
+------------------------+----------+
| TLV                    | Message  |
+------------------------+----------+
| BRSKI-VoucherRequest   | Response |
| BRSKI-Voucher          | Request  |
| CSR-Attributes         | Response |
| Retry-After            | Response |
| NAI-Identity           | Request  |
+------------------------+----------+

</pre><a href="#section-8.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.1-3">These new TLVs are detailed in this section.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
<div id="brski-requestvoucher-tlv">
<section id="section-8.1.1">
          <h4 id="name-brski-requestvoucher-tlv">
<a href="#section-8.1.1" class="section-number selfRef">8.1.1. </a><a href="#name-brski-requestvoucher-tlv" class="section-name selfRef">BRSKI-RequestVoucher TLV</a>
          </h4>
<p id="section-8.1.1-1">This TLV is used by the server as part of a Request-Action TLV to
request from the peer that it initiate a voucher request.  When used
in this fashion, the length of this TLV will be set to zero. The Status field of the Request-Action TLV MUST be set to Failure.<a href="#section-8.1.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1.1-2">It is also used by the peer to initiate the voucher request.  When
used in this fashion, the length of the TLV will be set to that of the
voucher request, as encoded and described in Section 3.3 in
<span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span>.<a href="#section-8.1.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.1-3">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R| TLV=TBD1-VoucherRequest   |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-8.1.1-3" class="pilcrow">¶</a>
</div>
<p id="section-8.1.1-4">The M and R bits are always expected to be set to 0.<a href="#section-8.1.1-4" class="pilcrow">¶</a></p>
<p id="section-8.1.1-5">The server is expected to forward the voucher request to the MASA, and
then return a voucher in a BRSKI-Voucher TLV as described below.  If
it is unable to do so, it returns an TEAP Error TLV with one of
the defined errors or the following:<a href="#section-8.1.1-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.1-6">
<pre>
TBD2-MASA-Notavailable  MASA unavailable
TBD3-MASA-Refused       MASA refuses to sign the voucher

</pre><a href="#section-8.1.1-6" class="pilcrow">¶</a>
</div>
<p id="section-8.1.1-7">The peer terminates the TEAP connection, but may retry at some later
point.  The backoff mechanism for such retries should be appropriate
for the device.  Retries MUST occur no more frequently than once
every two (TBD) minutes.<a href="#section-8.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="brski-voucher-tlv">
<section id="section-8.1.2">
          <h4 id="name-brski-voucher-tlv">
<a href="#section-8.1.2" class="section-number selfRef">8.1.2. </a><a href="#name-brski-voucher-tlv" class="section-name selfRef">BRSKI-Voucher TLV</a>
          </h4>
<p id="section-8.1.2-1">This TLV is transmitted from the server to the peer.  It contains a
signed voucher, as describe in <span>[<a href="#RFC8366" class="xref">RFC8366</a>]</span>.<a href="#section-8.1.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.2-2">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R| TLV=TBD4-Voucher          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-8.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-8.1.2-3">Upon receiving this TLV the peer will validate the signature of the
voucher, using its pre-installed manufacturer trust anchor (LDevID).
It MUST also validate the certificate used by the server to establish
the TLS connection.<a href="#section-8.1.2-3" class="pilcrow">¶</a></p>
<p id="section-8.1.2-4">If successful, it installs the new trust anchor contained in the
voucher.<a href="#section-8.1.2-4" class="pilcrow">¶</a></p>
<p id="section-8.1.2-5">Otherwise, the peer transmits an TEAP error TLV with one of the
following error messages:<a href="#section-8.1.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.2-6">
<pre>
TBD5-Invalid-Signature  The signature on the voucher is invalid
TBD6-Invalid-Voucher    The form or content of the voucher is invalid
TBD7-Invalid-TLS-Signer The certificate used for the TLS connection
                        could not be validated.

</pre><a href="#section-8.1.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="csr-attributes-tlv">
<section id="section-8.1.3">
          <h4 id="name-csr-attributes-tlv">
<a href="#section-8.1.3" class="section-number selfRef">8.1.3. </a><a href="#name-csr-attributes-tlv" class="section-name selfRef">CSR-Attributes TLV</a>
          </h4>
<p id="section-8.1.3-1">The server SHALL transmit this TLV to the peer, either along with the
BRSKI-Voucher TLV or at any time earlier in a communication.  The peer
shall include attributes required by the server in any following CSR.
The value of this TLV is the base64 encoding described in Section
4.5.2 of <span>[<a href="#RFC7030" class="xref">RFC7030</a>]</span>.<a href="#section-8.1.3-1" class="pilcrow">¶</a></p>
<p id="section-8.1.3-2">The TEAP server MAY use this TLV to specify the subject identity information to include in Subject or Subjecet Alternate Name fields in any following CSR.<a href="#section-8.1.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.3-3">
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R| TLV=TBD8-CSR-Attributes |         length                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-8.1.3-3" class="pilcrow">¶</a>
</div>
<p id="section-8.1.3-4">Again, the M and R values are set to 0.  In the case where the client
is unable to provide the requested attributes, an TEAP-Error is
returned as follows:<a href="#section-8.1.3-4" class="pilcrow">¶</a></p>
<p id="section-8.1.3-5">TBD9-CSR-Attribute-Fail Unable to supply the requested attributes.<a href="#section-8.1.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retry-after-tlv">
<section id="section-8.1.4">
          <h4 id="name-retry-after-tlv">
<a href="#section-8.1.4" class="section-number selfRef">8.1.4. </a><a href="#name-retry-after-tlv" class="section-name selfRef">Retry-After TLV</a>
          </h4>
<p id="section-8.1.4-1">The server MUST transmit this TLV to the peer when repling to a PKCS#10 TLV request from the peer where the server is willing to fulfill the request and issue a certificate via a PKCS#7 response, but is unable to fulfill the request immediately. This TLV is used to tell the peer the mimimum lenght of time it MUST wait before resending the PKCS#10 request. The value of this TLV is the time in seconds that the peer MUST wait before resending the PKCS#10 request. The peer MUST resend the exact same PKCS#10 request.<a href="#section-8.1.4-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.4-2">
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R| TLV=TBD10-Retry-After   |         length                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-8.1.4-2" class="pilcrow">¶</a>
</div>
<p id="section-8.1.4-3">Again, the M and R values are set to 0.<a href="#section-8.1.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="nai-tlv">
<section id="section-8.1.5">
          <h4 id="name-nai-tlv">
<a href="#section-8.1.5" class="section-number selfRef">8.1.5. </a><a href="#name-nai-tlv" class="section-name selfRef">NAI TLV</a>
          </h4>
<p id="section-8.1.5-1">The server may use this TLV to provision a realm-specific NAI on the device.<a href="#section-8.1.5-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.1.5-2">
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R| TLV=TBD10-NAI           |         length                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Value...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre><a href="#section-8.1.5-2" class="pilcrow">¶</a>
</div>
<p id="section-8.1.5-3">Again, the M and R values are set to 0.<a href="#section-8.1.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="existing-teap-tlv-specifications">
<section id="section-8.2">
        <h3 id="name-existing-teap-tlv-specifica">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-existing-teap-tlv-specifica" class="section-name selfRef">Existing TEAP TLV Specifications</a>
        </h3>
<p id="section-8.2-1">This section documents allowed usage of existing TEAP TLVs. The definition of the TLV is not changed, however clarifications on allowed values for the TLV fields is documented.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<div id="pkcs10-tlv">
<section id="section-8.2.1">
          <h4 id="name-pkcs10-tlv">
<a href="#section-8.2.1" class="section-number selfRef">8.2.1. </a><a href="#name-pkcs10-tlv" class="section-name selfRef">PKCS#10 TLV</a>
          </h4>
<p id="section-8.2.1-1"><span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span> defines the PKCS#10 TLV as follows:<a href="#section-8.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-8.2.1-2">
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |M|R|         TLV Type          |            Length             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           PKCS#10 Data...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-

</pre><a href="#section-8.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-8.2.1-3"><span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span> does not explicitly allow a Length value of zero.<a href="#section-8.2.1-3" class="pilcrow">¶</a></p>
<p id="section-8.2.1-4">A Length value of zero is allowed for this TLV when the TEAP server sends a Request-Action TLV with a child PKCS#10 TLV to the client. In this scenario, there is no PKCS#10 Data included in the TLV. Clients MUST NOT send a zero length PKCS#10 TLV to the server.<a href="#section-8.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="tlv-rules">
<section id="section-8.3">
        <h3 id="name-tlv-rules">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-tlv-rules" class="section-name selfRef">TLV Rules</a>
        </h3>
<p id="section-8.3-1">BRSKI TLVs can only be transported inside the TLS tunnel. The following table provides a guide to which TLVs may be encapsulated in which kind of packets, and in what quantity. The messages are as follows: Request is a TEAP Request, Response is a TEAP Response, Success is a message containing a successful Result TLV, and Failure is a message containing a failed Result TLV.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The following define the meaning of the table entries in the sections below:<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">0   This TLV MUST NOT be present in the message.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">0+  Zero or more instances of this TLV MAY be present in the
    message.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<p id="section-8.3-5">0-1 Zero or one instance of this TLV MAY be present in the message.<a href="#section-8.3-5" class="pilcrow">¶</a></p>
<p id="section-8.3-6">1   Exactly one instance of this TLV MUST be present in the
    message.<a href="#section-8.3-6" class="pilcrow">¶</a></p>
<p id="section-8.3-7">Request Response Success Failure TLVs
0       0-1      0       0       BRSKI-VoucherRequest
0-1     0        0       0       BRSKI-Voucher
0       0-1      0       0       CSR-Attributes<a href="#section-8.3-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="fragmentation">
<section id="section-9">
      <h2 id="name-fragmentation">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-fragmentation" class="section-name selfRef">Fragmentation</a>
      </h2>
<p id="section-9-1">TEAP is expected to provide fragmentation support. Thus EAP-TEAP-BRSKI
does not specifically provide any, as it is only expected to be used
as an inner method to TEAP.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">The IANA is requested to add entries into the following tables:<a href="#section-10-1" class="pilcrow">¶</a></p>
<p id="section-10-2">The following new TEAP TLVs are defined:<a href="#section-10-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-10-3">
<pre>
TBD1-VoucherRequest   Described in this document.
TBD4-Voucher          Described in this document.
TBD8-CSR-Attributes   Described in this document.
TBD10-Retry-After Described in this document.

</pre><a href="#section-10-3" class="pilcrow">¶</a>
</div>
<p id="section-10-4">The following TEAP Error Codes are defined, with their meanings
listed here and in previous sections:<a href="#section-10-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-10-5">
<pre>
TBD2-MASA-Notavailable  MASA unavailable
TBD3-MASA-Refused       MASA refuses to sign the voucher
TBD5-Invalid-Signature  The signature on the voucher is invalid
TBD6-Invalid-Voucher    The form or content of the voucher is invalid
TBD7-Invalid-TLS-Signer The certificate used for the TLS connection
                        could not be validated.
TBD9-CSR-Attribute-Fail Unable to supply the requested attributes.
TBD11-Retry-PKCS#10     Retry PKCS#10 Request (1000 range code)
TBD12-Retry-PKCS#10     Retry PKCS#10 Request (2000 range code)
TBD13-NAI-Rejected      The device will not use the indicated
                        NAI (1000 range code)

</pre><a href="#section-10-5" class="pilcrow">¶</a>
</div>
<p id="section-10-6">[[ TODO: is there a registry of NAIs that map to TEAP methods? e.g. @eap-teap.net is reserved to indicate the peer wants to use TEAP method ]]<a href="#section-10-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-11">
      <h2 id="name-security-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-11-1">BRSKI <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span> provides a zero touch
  way for devices to enroll in a certification authority (CA). It assumes
  the device has IP connectivity. For networks that will not grant
  IP connectivitiy before authenticating (with a local credential)
  this poses a Catch-22- can't get on the network without a credential
  and can't get a credential without getting on the network.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">This protocol provides a way for BRSKI to be in an EAP method
  which allows the BRSKI conversation to happen as part of EAP
  authentication and prior to obtaining IP connectivity.<a href="#section-11-2" class="pilcrow">¶</a></p>
<p id="section-11-3">The  security considerations of <span>[<a href="#I-D.ietf-anima-bootstrapping-keyinfra" class="xref">I-D.ietf-anima-bootstrapping-keyinfra</a>]</span>
  apply to this protocol. Running BRSKI through EAP introduces some
  additional areas of concern though.<a href="#section-11-3" class="pilcrow">¶</a></p>
<div id="issues-with-provisionally-authenticated-teap">
<section id="section-11.1">
        <h3 id="name-issues-with-provisionally-a">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-issues-with-provisionally-a" class="section-name selfRef">Issues with Provisionally Authenticated TEAP</a>
        </h3>
<p id="section-11.1-1">This protocol establishes an unauthenticated TLS connection and passes
  data through it. Provided that the only messages passed in this state
  are self-protected BRSKI messages this does not present a problem.
  Passing any other messages or TLVs prior to authentication of the
  provisional TLS connection could potentially introduce security issues.<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<p id="section-11.1-2">While the TLS connection is unauthenticated, it must still be validated
  to the fullest extent possible. It is critical that the device and the
  TEAP server perform all steps in TLS- checking the validity of the
  presented certificate, validating the signature using the public key
  of the certificate, etc- except ensuring the trust of the presented
  certificate.<a href="#section-11.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attack-against-discovery">
<section id="section-11.2">
        <h3 id="name-attack-against-discovery">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-attack-against-discovery" class="section-name selfRef">Attack Against Discovery</a>
        </h3>
<p id="section-11.2-1">The device discovery technique specified in this protocol is the standard
  EAP server discovery process. Since it is trivial to set up an 802.11
  wireless access point and advertise any network, an attacker can impersonate
  a legitimate wireless network and attract unprovisioned pledges. Given that
  an unprovisioned device will not know the legitimate network to connect
  to, it will probably attempt the first network it finds, making the attack
  that much easier. This allows for a "rogue registrar" to provision and
  take control of the device.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<p id="section-11.2-2">If the MASA verifies ownership prior to issuance of a voucher, this attack
  can be thwarted. But if the MASA is in reduced security mode and does not
  verify ownership this attack cannot be prevented. Registrars SHOULD use the
  audit log of a MASA when deploying newly purchased equipment in order to
  mitigate this attack.<a href="#section-11.2-2" class="pilcrow">¶</a></p>
<p id="section-11.2-3">Another way to mitigate this attack is through normal "rogue AP" detection
  and prevention.<a href="#section-11.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="teap-server-as-registration-authority">
<section id="section-11.3">
        <h3 id="name-teap-server-as-registration">
<a href="#section-11.3" class="section-number selfRef">11.3. </a><a href="#name-teap-server-as-registration" class="section-name selfRef">TEAP Server as Registration Authority</a>
        </h3>
<p id="section-11.3-1">If the TEAP server is logically separate from the Certification Authority (CA)
  (see <a href="#arch" class="xref">Section 2</a>) it will be acting as a Registration Authority (RA) when it
  obtains the PKCS#10 TLV and replies with a PKCS#7 TLV (see <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span>, Sections
  4.2.16 and 4.2.17, respectively). The assurance a RA makes to a CA is that the
  public key in the presented CSR is bound to an authenticated identity in way
  that will assure non-repudiation.<a href="#section-11.3-1" class="pilcrow">¶</a></p>
<p id="section-11.3-2">To make such an assurance, the TEAP server MUST authenticate the provisional
  TLS connection with the device by validating the voucher response received
  from the MASA. In addition, it is RECOMMENDED that the TEAP server indicate
  that proof-of-possession (see <span>[<a href="#RFC7170" class="xref">RFC7170</a>]</span>, Section 3.8.2) is required by
  including the challengePassword OID in the CSR Attributes TLV.<a href="#section-11.3-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="trust-of-registrar">
<section id="section-11.4">
        <h3 id="name-trust-of-registrar">
<a href="#section-11.4" class="section-number selfRef">11.4. </a><a href="#name-trust-of-registrar" class="section-name selfRef">Trust of Registrar</a>
        </h3>
<p id="section-11.4-1">The device accepts a trusted server (CA) certificate and installs it
  in its trust anchor database during step 5 (see <a href="#bint" class="xref">Section 3.2</a>). This can
  happen only after the provisional TLS connection has been authenticated
  using the voucher and the Crypto-Binding TLV has been validated.<a href="#section-11.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="section-12">
      <h2 id="name-acknowledgments">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-12-1">The authors would like to thank Brian Weis for his assistance, and
Alan Dakok for improving language consistency.  In addition, with
ruthlessly "borrowed" the concept around NAI handling from Tuomas Aura
and Mohit Sethi.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-13">
      <h2 id="name-references">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-13.1">
        <h3 id="name-normative-references">
<a href="#section-13.1" class="section-number selfRef">13.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-anima-bootstrapping-keyinfra">[I-D.ietf-anima-bootstrapping-keyinfra]</dt>
        <dd>
<span class="refAuthor">Pritikin, M.</span>, <span class="refAuthor">Richardson, M. C.</span>, <span class="refAuthor">Eckert, T.</span>, <span class="refAuthor">Behringer, M. H.</span>, and <span class="refAuthor">K. Watsen</span>, <span class="refTitle">"Bootstrapping Remote Secure Key Infrastructure (BRSKI)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-anima-bootstrapping-keyinfra-45</span>, <time datetime="2020-11-11" class="refDate">11 November 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-anima-bootstrapping-keyinfra-45.txt">https://www.ietf.org/archive/id/draft-ietf-anima-bootstrapping-keyinfra-45.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="IEEE8021AR">[IEEE8021AR]</dt>
        <dd>
<span class="refAuthor">Institute for Electrical and Electronics Engineers</span>, <span class="refTitle">"Secure Device Identity"</span>, <time datetime="1998" class="refDate">1998</time>. </dd>
<dd class="break"></dd>
<dt id="IEEE8021X">[IEEE8021X]</dt>
        <dd>
<span class="refAuthor">Institute for Electrical and Electronics Engineers</span>, <span class="refTitle">"IEEE Standard for Local and metropolitan area networks--Port-Based Network Access Control"</span>, <time datetime="2010" class="refDate">2010</time>. </dd>
<dd class="break"></dd>
<dt id="RFC3748">[RFC3748]</dt>
        <dd>
<span class="refAuthor">Aboba, B.</span>, <span class="refAuthor">Blunk, L.</span>, <span class="refAuthor">Vollbrecht, J.</span>, <span class="refAuthor">Carlson, J.</span>, and <span class="refAuthor">H. Levkowetz, Ed.</span>, <span class="refTitle">"Extensible Authentication Protocol (EAP)"</span>, <span class="seriesInfo">RFC 3748</span>, <span class="seriesInfo">DOI 10.17487/RFC3748</span>, <time datetime="2004-06" class="refDate">June 2004</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3748">https://www.rfc-editor.org/info/rfc3748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7030">[RFC7030]</dt>
        <dd>
<span class="refAuthor">Pritikin, M., Ed.</span>, <span class="refAuthor">Yee, P., Ed.</span>, and <span class="refAuthor">D. Harkins, Ed.</span>, <span class="refTitle">"Enrollment over Secure Transport"</span>, <span class="seriesInfo">RFC 7030</span>, <span class="seriesInfo">DOI 10.17487/RFC7030</span>, <time datetime="2013-10" class="refDate">October 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7030">https://www.rfc-editor.org/info/rfc7030</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7170">[RFC7170]</dt>
        <dd>
<span class="refAuthor">Zhou, H.</span>, <span class="refAuthor">Cam-Winget, N.</span>, <span class="refAuthor">Salowey, J.</span>, and <span class="refAuthor">S. Hanna</span>, <span class="refTitle">"Tunnel Extensible Authentication Protocol (TEAP) Version 1"</span>, <span class="seriesInfo">RFC 7170</span>, <span class="seriesInfo">DOI 10.17487/RFC7170</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7170">https://www.rfc-editor.org/info/rfc7170</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8366">[RFC8366]</dt>
      <dd>
<span class="refAuthor">Watsen, K.</span>, <span class="refAuthor">Richardson, M.</span>, <span class="refAuthor">Pritikin, M.</span>, and <span class="refAuthor">T. Eckert</span>, <span class="refTitle">"A Voucher Artifact for Bootstrapping Protocols"</span>, <span class="seriesInfo">RFC 8366</span>, <span class="seriesInfo">DOI 10.17487/RFC8366</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8366">https://www.rfc-editor.org/info/rfc8366</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-13.2">
        <h3 id="name-informative-references">
<a href="#section-13.2" class="section-number selfRef">13.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC7542">[RFC7542]</dt>
      <dd>
<span class="refAuthor">DeKok, A.</span>, <span class="refTitle">"The Network Access Identifier"</span>, <span class="seriesInfo">RFC 7542</span>, <span class="seriesInfo">DOI 10.17487/RFC7542</span>, <time datetime="2015-05" class="refDate">May 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7542">https://www.rfc-editor.org/info/rfc7542</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="changes-from-earlier-versions">
<section id="appendix-A">
      <h2 id="name-changes-from-earlier-versio">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-changes-from-earlier-versio" class="section-name selfRef">Changes from Earlier Versions</a>
      </h2>
<p id="appendix-A-1">Draft -06:
  * nothing more than version bump<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">Draft -03:
  * Merge EAP server and Registrar
  * Security considerations
  * References improvements
  * Add Dan Harkins as co-author<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">Draft -02:
  * Flow corrections<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">Draft -01:
  * Add packet descriptions, IANA considerations, smooth out language.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">Draft -00:<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-6.1">Initial revision<a href="#appendix-A-6.1" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eliot Lear</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">Richtistrasse 7</span></div>
<div dir="auto" class="left">CH-<span class="postal-code">8304</span> <span class="locality">Wallisellen</span>
</div>
<div dir="auto" class="left"><span class="country-name">Switzerland</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+41%2044%20878%209200" class="tel">+41 44 878 9200</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:lear@cisco.com" class="email">lear@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Owen Friel</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">170 W. Tasman Dr.</span></div>
<div dir="auto" class="left">
<span class="locality">San Jose, CA</span>,  <span class="postal-code">95134</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ofriel@cisco.com" class="email">ofriel@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Nancy Cam-Winget</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">170 W. Tasman Dr.</span></div>
<div dir="auto" class="left">
<span class="locality">San Jose, CA</span>,  <span class="postal-code">95134</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ncamwing@cisco.com" class="email">ncamwing@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Dan Harkins</span></div>
<div dir="auto" class="left"><span class="org">HP Enterprise</span></div>
<div dir="auto" class="left"><span class="street-address">3333 Scott Boulevard</span></div>
<div dir="auto" class="left">
<span class="locality">Santa Clara, CA</span>,  <span class="postal-code">95054</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dharkins@arubanetworks.com" class="email">dharkins@arubanetworks.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
