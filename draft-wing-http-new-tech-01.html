<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Happy Eyeballs:
    Trending Towards Success (IPv6 and SCTP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Happy Eyeballs:
    Trending Towards Success (IPv6 and SCTP)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Applications Area</td><td class="header">D. Wing</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">A. Yourtchenko</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">P. Natarajan</td></tr>
<tr><td class="header">Expires:  February 21, 2011</td><td class="header">Cisco</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 20, 2010</td></tr>
</table></td></tr></table>
<h1><br />Happy Eyeballs:
    Trending Towards Success (IPv6 and SCTP)<br />draft-wing-http-new-tech-01</h1>

<h3>Abstract</h3>

<p>People like their computers to work quickly. During the transition to
      new technology, both old and new technologies have to peacefully
      co-exist. However, if users experience connection delays attributed to
      the new technology the new technology will be shunned.
</p>
<p>HTTP ("The Web") is one of the most visible and time-critical
      applications that is used by nearly every Internet user. It is critical
      that new technologies which improve HTTP not impair or delay the display
      of HTTP content. It is also important that users retain the ability to
      share URIs amongst friends and colleagues, even if the other users have
      not upgraded to the new technology.
</p>
<p>This draft makes several recommendations to ensure user satisfaction
      and a smooth transition from HTTP's pervasive IPv4 to IPv6 and from TCP
      to SCTP.
</p>
<p>The audience for this draft is application developers and content
      providers. This draft is discussed on the Applications Discuss mailing
      list, https://www.ietf.org/mailman/listinfo/apps-discuss.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 21, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Notational Conventions<br />
<a href="#problem_statement">3.</a>&nbsp;
Problem Statement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#problem_uris">3.1.</a>&nbsp;
URIs and hostnames<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#problem_ipv6">3.2.</a>&nbsp;
IPv6<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#problem_sctp">3.3.</a>&nbsp;
SCTP<br />
<a href="#anchor3">4.</a>&nbsp;
HTTP Client Recommendations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#client_v6">4.1.</a>&nbsp;
IPv6<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#client_sctp">4.2.</a>&nbsp;
SCTP<br />
<a href="#anchor4">5.</a>&nbsp;
Additional Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.1.</a>&nbsp;
Additional Network and Host Traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#abandon">5.2.</a>&nbsp;
Abandon Non-Winning Connections<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.3.</a>&nbsp;
Flush or Expire Cache<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.4.</a>&nbsp;
Determining Address Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dns_behavior">5.5.</a>&nbsp;
DNS Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.6.</a>&nbsp;
Thread safe DNS resolvers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.7.</a>&nbsp;
Middlebox Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.8.</a>&nbsp;
Multiple Interfaces<br />
<a href="#anchor11">6.</a>&nbsp;
Content Provider Recommendations<br />
<a href="#security_considerations">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor12">8.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor13">9.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informational References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In order to use HTTP successfully over IPv6 or SCTP, it is necessary
      that the user enjoys nearly identical performance as compared to their
      old technology (IPv4 and TCP). A combination of today's applications,
      IPv6 tunneling and IPv6 service providers, IPv4 NAT, and some of today's
      content providers all cause the user experience to suffer (<a class='info' href='#problem_statement'>Section&nbsp;3<span> (</span><span class='info'>Problem Statement</span><span>)</span></a>). For IPv6, Google ensures a positive
      user experience by using a DNS white list of IPv6 service providers who
      peer directly with Google <a class='info' href='#whitelist'>[whitelist]<span> (</span><span class='info'>Google, &ldquo;Google IPv6 DNS Whitelist,&rdquo; March&nbsp;2008.</span><span>)</span></a>. However,
      this is not scalable to all service providers worldwide, nor is it
      scalable for other content providers to operate their own DNS white
      list.
</p>
<p>Instead, this document suggests a mechanism for applications to
      quickly determine if IPv6, IPv4, SCTP, or TCP is the most optimal to
      connect to a server. The suggestions in this document provide a user
      experience which is superior to HTTP using TCP and IPv4, especially in
      IPv6/IPv4 transition environment with dual stack hosts (e.g., <a class='info' href='#RFC4213'>[RFC4213]<span> (</span><span class='info'>Nordmark, E. and R. Gilligan, &ldquo;Basic Transition Mechanisms for IPv6 Hosts and Routers,&rdquo; October&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>DS-Lite<span> (</span><span class='info'>Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; August&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite], <a class='info' href='#I-D.despres-6rd'>6rd<span> (</span><span class='info'>Despres, R., &ldquo;IPv6 Rapid Deployment on IPv4 infrastructures (6rd),&rdquo; April&nbsp;2009.</span><span>)</span></a> [I&#8209;D.despres&#8209;6rd]).
</p>
<p>Once a certain address family is successful, it trends towards
preferring that address family.  Thus, repeated use of the application
DOES NOT cause repeated probes over both address families.
</p>
<p>The application recommendations in this document are primarily for
      HTTP clients ("web browsers") and may also be helpful for other
      applications.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Notational Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="problem_statement"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Problem Statement</h3>

<p>As discussed in more detail in <a class='info' href='#problem_uris'>Section&nbsp;3.1<span> (</span><span class='info'>URIs and hostnames</span><span>)</span></a>,
      it is important that the same URI and hostname be used for IPv4, IPv6,
      SCTP, and TCP. Using separate namespaces causes namespace fragmentation
      and reduces the ability for users to share URIs and hostnames, and
      complicates printed material that includes the URI or hostname.
</p>
<p>As discussed in more detail in <a class='info' href='#problem_ipv6'>Section&nbsp;3.2<span> (</span><span class='info'>IPv6</span><span>)</span></a>,
      IPv6 connectivity is sometimes broken entirely or, due to tunnel
      technologies might be slower than native IPv4 connectivity. However, due
      to port limitations inherent in stateful IPv6/IPv4 translators [BEHAVE],
      it is important that web browsers begin preferring IPv6 over IPv4 in
      order to avoid those port limitations.
</p>
<p>As discussed in more detail in <a class='info' href='#problem_sctp'>Section&nbsp;3.3<span> (</span><span class='info'>SCTP</span><span>)</span></a>,
      there is no standard mechanism to indicate a host supports a non-TCP
      transport protocol, such as SCTP.
</p>
<a name="problem_uris"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
URIs and hostnames</h3>

<p>URIs are often used between users to exchange pointers to content
        -- such as on Facebook, email, instant messaging, or other systems.
        Thus, production URIs and production hostnames containing references
        to IPv4, IPv6, TCP, or SCTP will only function if the other party also
        has application, OS, and a network that can access the URI or the
        hostname.
</p>
<a name="problem_ipv6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
IPv6</h3>

<p>When IPv6 connectivity is impaired, today's IPv6-capable web
        browsers incur many seconds of delay before falling back to IPv4. This
        harms the user's experience with IPv6, which will slow the acceptance
        of IPv6, because IPv6 is frequently disabled in its entirety on the
        end systems to improve the user experience.
</p>
<p>Reasons for such failure include no connection to the IPv6
        Internet, broken 6to4 or Teredo tunnel, and broken IPv6 peering. To
        prevent this delay an experiment with IPv6 connectivity, content
        providers use a separate namespace for their web server (e.g.,
        ipv6.example.com), but doing that with production systems causes the
        problems described in <a class='info' href='#problem_uris'>Section&nbsp;3.1<span> (</span><span class='info'>URIs and hostnames</span><span>)</span></a>.
</p>
<a name="problem_sctp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
SCTP</h3>

<p>SCTP provides benefits over TCP <a class='info' href='#I-D.natarajan-http-over-sctp'>[I&#8209;D.natarajan&#8209;http&#8209;over&#8209;sctp]<span> (</span><span class='info'>Natarajan, P., Amer, P., Leighton, J., and F. Baker, &ldquo;Using SCTP as a Transport Layer Protocol for HTTP,&rdquo; July&nbsp;2009.</span><span>)</span></a>.
</p>
<p>Unlike IPv6 which has an AAAA record, there is no DNS query that
        indicates a host supports <a class='info' href='#RFC4960'>SCTP<span> (</span><span class='info'>Stewart, R., &ldquo;Stream Control Transmission Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a> [RFC4960], and HTTP
        URI scheme is not extensible to support an SRV query that could
        provide such support. Even if there was, it isn't possible to
        determine if a middlebox, such as a firewall or a NAT, would block the
        SCTP association.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
HTTP Client Recommendations</h3>

<p>To provide fast connections for users, HTTP clients should make
      connections quickly over various technologies, automatically tune itself
      to avoid flooding the network with unnecessary connections (i.e., for
      technologies that have not made successful connections), and
      occasionally flush its self-tuning.
</p>
<p>If an HTTP client supports IPv6 and SCTP (in addition to IPv4 and
      TCP), the procedures described in <a class='info' href='#client_v6'>Section&nbsp;4.1<span> (</span><span class='info'>IPv6</span><span>)</span></a> and
      <a class='info' href='#client_sctp'>Section&nbsp;4.2<span> (</span><span class='info'>SCTP</span><span>)</span></a> are performed together.
</p>
<a name="client_v6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
IPv6</h3>

<p>This section details how to provide robust dual stack service for
        both IPv6 and IPv4, so that the user perceives very fast application
        response.
</p>
<p>The HTTP client is configured with one value, P. A positive value
        indicates a preference for IPv6 and a negative value indicates a
        preference for IPv4. A value of 0 indicates equal weight, which means
        the A and AAAA queries and associated connection attempts will be sent
        as quickly as possible. The absolute value of P is the measure of a
        delay before initiating a connection attempt on the other address
        family. There are two P values maintained: one is application-wide and
        the other is specific per each destination (hostname and port).
</p>
<p>The algorithm attempts to delay the DNS query until it expects that
        address family will be necessary; that is, if the preference is
        towards IPv6, then AAAA will be queried immediately and the A query
        will be delayed.
</p>
<p>The HTTP client starts two threads in order to minimize the
        user-noticeable delay ("dead time") during the connection
        attempts:</p>
<blockquote class="text"><dl>
<dt>thread 1: (IPv6)</dt>
<dd>
<ul class="text">
<li>If P&lt;0, wait for absolute value of p*10 milliseconds
</li>
<li>send DNS query for AAAA
</li>
<li>wait until DNS response is received
</li>
<li>Attempt to connect over IPv6 using TCP
</li>
</ul>
</dd>
<dt>thread 2: (IPv4)</dt>
<dd>
<ul class="text">
<li>if P&gt;0, wait for p*10 milliseconds
</li>
<li>send DNS query for A
</li>
<li>wait until DNS response is received
</li>
<li>Attempt to connect over IPv4 using TCP
</li>
</ul>
</dd>
</dl></blockquote>

<p>The first thread that succeeds returns the completed connection to
        the parent code and aborts the other thread (<a class='info' href='#abandon'>Section&nbsp;5.2<span> (</span><span class='info'>Abandon Non-Winning Connections</span><span>)</span></a>).
</p>
<p>After a connection is successful, we want to adjust the
        application-wide preference and the per-destination preference. The
        value of P is incremented (decremented) each time an IPv6 (IPv4)
        connection is successfully made. When a connection using the
        less-preferred address family is successful, it indicates the wrong
        address family was used and the P is halved:</p>
<ul class="text">
<li>If P&gt;0 (indicating IPv6 is preferred over IPv4) and the
            first thread to finish was the IPv6 thread it indicates the IPv6
            preference is correct and we need to re-enforce this by increasing
            the application-wide P value by 1. However, if the first thread to
            finish was the IPv4 thread it indicates an IPv6 connection problem
            occurred and we need to aggressively prefer IPv4 more by halving P
            and rounding towards 0.
</li>
<li>If P&lt;0 (indicating IPv4 is preferred over IPv6) and the
            first thread to finish was the IPv4 thread it indicates the
            preference is correct and we need to re-enforce this gently by
            decreasing the application-wide P value by 1. However, if the
            first thread to finish was the IPv6 thread it indicates an IPv4
            connection problem and we need to aggressively avoid IPv4 by
            halving P and rounding towards 0.
</li>
<li>If P=0 (indicating equal preference), P is incremented if the
            first thread to complete was the IPv6 thread, or decremented if
            the first thread to complete was the IPv4 thread.
</li>
</ul><p>After adjusting P, it should never be larger than 4 seconds
        -- which is similar to the value used by many IPv6-capable HTTP
        clients to switch to an alternate A or AAAA record.
</p>
<p></p>
<blockquote class="text">
<p>Note: Proof of concept tests on fast networks show that even
            smaller value (around 0.5 seconds) is practical. More extensive
            testing would be useful to find the best upper boundary that still
            ensures a good user experience.
</p>
</blockquote>

<a name="client_sctp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
SCTP</h3>

<p>Due to the proliferation of NATs on the IPv4 Internet the best
        success for SCTP can be achieved by attempting both native SCTP
        connections and <a class='info' href='#I-D.tuexen-sctp-udp-encaps'>SCTP-over-UDP<span> (</span><span class='info'>Tuexen, M. and R. Stewart, &ldquo;UDP Encapsulation of SCTP Packets,&rdquo; July&nbsp;2010.</span><span>)</span></a> [I&#8209;D.tuexen&#8209;sctp&#8209;udp&#8209;encaps]
        connections.
</p>
<p>For SCTP the following parameters are used:</p>
<blockquote class="text"><dl>
<dt>SWAIT:</dt>
<dd>Application-wide wait time for an SCTP
            association attempt to complete. Default value of 50ms is
            RECOMMENDED.
</dd>
<dt>PREF:</dt>
<dd>This denotes per-destination transport
            preference. Possible values are "TCP", "SCTP", and "BOTH". Default
            value of "BOTH" is RECOMMENDED.
</dd>
</dl></blockquote>

<p>The HTTP client starts several threads in order to minimize the
        user-noticeable delay ("dead time") during the connection attempts.
        The client starts one or more threads based on the following
        logic:
</p>
<p>If ((PREF == BOTH) or (PREF == SCTP)) start thread 1. If making a
        connection using IPv4 start thread 2.
</p>
<p>If ((PREF == BOTH) or (PREF == TCP)) start thread 3.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>  thread 1 (SCTP):</dt>
<dd>
<ul class="text">
<li>Attempt to connect using SCTP (i.e., send SCTP INIT)
</li>
</ul>
</dd>
<dt>  thread 2 (SCTP over UDP):</dt>
<dd>
<ul class="text">
<li>Attempt to connect using SCTP over UDP (i.e., send SCTP
                INIT over UDP)
</li>
</ul>
</dd>
<dt>  thread 3 (TCP):</dt>
<dd>
<ul class="text">
<li>Attempt to connect using TCP
</li>
</ul>
</dd>
</dl></blockquote>

<p>If an SCTP association attempt was made by a thread, the HTTP
        client waits for at least K ms; K = max(SWAIT, time taken for the TCP
        connection to complete). If the TCP connection finishes during this
        wait period, the HTTP client MAY choose TCP for the current HTTP
        transfer but MUST wait until K ms to figure if the SCTP association
        can be completed.
</p>
<p>If the HTTP client did not choose TCP during the wait period and
        the SCTP association completes successfully, the HTTP client prefers
        SCTP over TCP connections and abandons the TCP connection.
</p>
<p>After a connection is successful, we want to adjust the
        per-destination preference for this destination. It is not recommended
        to dynamically adjust the application-wide default value for SWAIT. If
        the SCTP association was successful, set destination's PREF="SCTP",
        else set PREF="TCP".
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Additional Considerations</h3>

<p>This section discusses considerations and requirements that are
      common to new technology deployment.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Additional Network and Host Traffic</h3>

<p>Additional network traffic and additional server load is created
        due to these recommendations and mitigated by application-wide and
        per-destination timer adjustments. The intent of this document is to
        show how good user experience can be maintained while the
        transitioning from IPv4 to IPv6, and transitioning from TCP to SCTP.
        The good user experience is to the benefit of the user but to the
        detriment of the network and server that are serving the user.
</p>
<a name="abandon"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Abandon Non-Winning Connections</h3>

<p>It is RECOMMENDED that the non-winning connections be abandoned,
        even though they could be used to download content. This is because
        some web sites provide HTTP clients with cookies (after logging in)
        that incorporate the client's IP address, or use IP addresses to
        identify users. If some connections from the same HTTP client are
        arriving from different IP addresses, such HTTP applications will
        break. </p>
<blockquote class="text">
<p>Editor's note: If we can provide guidance to IPv6 and SCTP
            developers that connections from the same client could arrive on
            IPv4, IPv6, TCP, and SCTP we could eliminate the above paragraph.
            But could we be sure all web sites would follow such guidance?
</p>
</blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Flush or Expire Cache</h3>

<p>Because every network has different characteristics (working or
        broken IPv6 connectivity, middlebox that permits or blocks SCTP, etc.)
        the IPv6/IPv4 preference value (P) and the SCTP parameters (SWAIT and
        PREF) SHOULD be reset to their default whenever the host is connected
        to a new network. However, in some instances the application and the
        host are unaware the network connectivity has changed (e.g., when
        behind a NAT) so it is RECOMMENDED that per-destination values expire
        after 10 minutes of inactivity.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Determining Address Type</h3>

<p>[[[ IS THIS SECTION NECESSARY ??
</p>
<p>For some transitional technologies such as a dual-stack host, it is
        easy for the application to recognize the native IPv6 address (learned
        via a AAAA query) and the native IPv4 address (learned via an A
        query). For other transitional technologies <a class='info' href='#RFC2766'>[RFC2766]<span> (</span><span class='info'>Tsirtsis, G. and P. Srisuresh, &ldquo;Network Address Translation - Protocol Translation (NAT-PT),&rdquo; February&nbsp;2000.</span><span>)</span></a> it is impossible for the host to
        differentiate a transitional technology IPv6 address from a native
        IPv6 address (see Section 4.1 of <a class='info' href='#RFC4966'>[RFC4966]<span> (</span><span class='info'>Aoun, C. and E. Davies, &ldquo;Reasons to Move the Network Address Translator - Protocol Translator (NAT-PT) to Historic Status,&rdquo; July&nbsp;2007.</span><span>)</span></a>).
        Replacement transitional technologies are attempting to bridge this
        gap. It is necessary for applications to distinguish between native
        and transitional addresses in order to provide the most seamless user
        experience.
</p>
<p>]]]
</p>
<a name="dns_behavior"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
DNS Behavior</h3>

<p>Unique to DNS AAAA queries are the problems described in <a class='info' href='#RFC4074'>[RFC4074]<span> (</span><span class='info'>Morishita, Y. and T. Jinmei, &ldquo;Common Misbehavior Against DNS Queries for IPv6 Addresses,&rdquo; May&nbsp;2005.</span><span>)</span></a> which, if they still persist, require
        applications to perform an A query before the AAAA query. </p>
<blockquote class="text">
<p>[[Editor's Note: It is believed these defective DNS servers
            have long since been upgraded. If so, we can remove this
            section.]]
</p>
</blockquote>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Thread safe DNS resolvers</h3>

<p>Some applications and some OSs do not have thread safe DNS
        resolvers, which complicates implementation of simultaneous A and AAAA
        queries for IPv4/IPv6.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
Middlebox Issues</h3>

<p>Some devices are known to exhibit what amounts to a bug, when the A
        and AAAA requests are sent back-to-back over the same 4-tuple, and
        drop one of the requests or replies <a class='info' href='#DNS-middlebox'>[DNS&#8209;middlebox]<span> (</span><span class='info'>Various, &ldquo;DNS middlebox behavior with multiple queries over same source           port,&rdquo; June&nbsp;2009.</span><span>)</span></a>. However, in some cases fixing this
        behaviour may not be possible either due to the architectural
        limitations or due to the administrative constraints (location of the
        faulty device is unknown to the end hosts or not controlled by the end
        hosts). The algorithm described in this draft, in the case of this
        erroneous behaviour will eventually pace the queries such that this
        issue is will be avoided. The algorithm described in this draft also
        avoids calling the operating system's getaddrinfo() with "any", which
        should prevent the operating system from sending the A and AAAA
        queries on the same port.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8"></a><h3>5.8.&nbsp;
Multiple Interfaces</h3>

<p>Interaction of the suggestions in this document with multiple
        interfaces is for further study.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Content Provider Recommendations</h3>

<p>Content providers SHOULD provide both AAAA and A records for servers
      using the same DNS name for both IPv4 and IPv6.
</p>
<a name="security_considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>[[Placeholder.]]
</p>
<p>See <a class='info' href='#abandon'>Section&nbsp;5.2<span> (</span><span class='info'>Abandon Non-Winning Connections</span><span>)</span></a>.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>The mechanism described in this paper was inspired by Stuart
      Cheshire's discussion at the IAB Plenary at IETF72, the author's
      understanding of Safari's operation with SRV records, Interactive
      Connectivity Establishment (<a class='info' href='#I-D.ietf-mmusic-ice'>ICE<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;mmusic&#8209;ice]), and the current IPv4/IPv6
      behavior of SMTP mail transfer agents.
</p>
<p>Thanks to Fred Baker, Jeff Kinzli, Christian Kuhtz, and
      Iljitsch van Beijnum for fostering the creation of this
      document.
</p>
<p>Thanks to Scott Brim and Stig Venaas for providing feedback on the
      document.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This document has no IANA actions.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.tuexen-sctp-udp-encaps">[I-D.tuexen-sctp-udp-encaps]</a></td>
<td class="author-text">Tuexen, M. and R. Stewart, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-tuexen-sctp-udp-encaps-05.txt">UDP Encapsulation of SCTP Packets</a>,&rdquo; draft-tuexen-sctp-udp-encaps-05 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-tuexen-sctp-udp-encaps-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4960">[RFC4960]</a></td>
<td class="author-text">Stewart, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>,&rdquo; RFC&nbsp;4960, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4960.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="DNS-middlebox">[DNS-middlebox]</a></td>
<td class="author-text">Various, &ldquo;<a href="https://bugzilla.redhat.com/show_bug.cgi?id=505105">DNS middlebox behavior with multiple queries over same source
          port</a>,&rdquo; June&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.despres-6rd">[I-D.despres-6rd]</a></td>
<td class="author-text">Despres, R., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-despres-6rd-03.txt">IPv6 Rapid Deployment on IPv4 infrastructures (6rd)</a>,&rdquo; draft-despres-6rd-03 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-despres-6rd-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-softwire-dual-stack-lite">[I-D.ietf-softwire-dual-stack-lite]</a></td>
<td class="author-text">Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-06.txt">Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion</a>,&rdquo; draft-ietf-softwire-dual-stack-lite-06 (work in progress), August&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.natarajan-http-over-sctp">[I-D.natarajan-http-over-sctp]</a></td>
<td class="author-text">Natarajan, P., Amer, P., Leighton, J., and F. Baker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-natarajan-http-over-sctp-02.txt">Using SCTP as a Transport Layer Protocol for HTTP</a>,&rdquo; draft-natarajan-http-over-sctp-02 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-natarajan-http-over-sctp-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2766">[RFC2766]</a></td>
<td class="author-text"><a href="mailto:george.tsirtsis@bt.com">Tsirtsis, G.</a> and <a href="mailto:srisuresh@yahoo.com">P. Srisuresh</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2766">Network Address Translation - Protocol Translation (NAT-PT)</a>,&rdquo; RFC&nbsp;2766, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2766.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4074">[RFC4074]</a></td>
<td class="author-text">Morishita, Y. and T. Jinmei, &ldquo;<a href="http://tools.ietf.org/html/rfc4074">Common Misbehavior Against DNS Queries for IPv6 Addresses</a>,&rdquo; RFC&nbsp;4074, May&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4074.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4213">[RFC4213]</a></td>
<td class="author-text">Nordmark, E. and R. Gilligan, &ldquo;<a href="http://tools.ietf.org/html/rfc4213">Basic Transition Mechanisms for IPv6 Hosts and Routers</a>,&rdquo; RFC&nbsp;4213, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4213.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4966">[RFC4966]</a></td>
<td class="author-text">Aoun, C. and E. Davies, &ldquo;<a href="http://tools.ietf.org/html/rfc4966">Reasons to Move the Network Address Translator - Protocol Translator (NAT-PT) to Historic Status</a>,&rdquo; RFC&nbsp;4966, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4966.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="whitelist">[whitelist]</a></td>
<td class="author-text">Google, &ldquo;<a href="http://www.google.com/intl/en/ipv6">Google IPv6 DNS Whitelist</a>,&rdquo; March&nbsp;2008.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dan Wing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dwing@cisco.com">dwing@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Yourtchenko</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">De Kleetlaan, 7</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, Diegem  B-1831</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Belgium</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ayourtch@cisco.com">ayourtch@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Preethi Natarajan</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:prenatar@cisco.com">prenatar@cisco.com</a></td></tr>
</table>
</body></html>
