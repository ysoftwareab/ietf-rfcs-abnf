<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Port Control Protocol
    (PCP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Port Control Protocol
    (PCP)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">PCP working group</td><td class="header">D. Wing</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">January 4, 2011</td></tr>
<tr><td class="header">Expires: July 8, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Port Control Protocol
    (PCP)<br />draft-ietf-pcp-base-02</h1>

<h3>Abstract</h3>

<p>Port Control Protocol is an address-family independent mechanism to
      control how incoming packets are forwarded by upstream devices such as
      network address translators (NATs) and simple IPv6 firewalls.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 8, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">2.1.</a>&nbsp;
Deployment Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.2.</a>&nbsp;
Supported Transport Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mono_homed">2.3.</a>&nbsp;
Single-homed Customer Premise Network<br />
<a href="#terminology">3.</a>&nbsp;
Terminology<br />
<a href="#relationship">4.</a>&nbsp;
Relationship of PCP Server and its NAT<br />
<a href="#anchor4">5.</a>&nbsp;
Common Request and Response Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.1.</a>&nbsp;
Request Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.2.</a>&nbsp;
Response Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pcp_information_elements">5.3.</a>&nbsp;
Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#result_codes">5.4.</a>&nbsp;
Result Codes<br />
<a href="#anchor7">6.</a>&nbsp;
General Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.1.</a>&nbsp;
General PCP Client Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec_generating_request">6.1.1.</a>&nbsp;
Generating and Sending a Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.1.2.</a>&nbsp;
Processing a Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mif">6.1.3.</a>&nbsp;
Multi-interface Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.2.</a>&nbsp;
General PCP Server Operation<br />
<a href="#pin_opcodes">7.</a>&nbsp;
Pinhole Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.1.</a>&nbsp;
OpCode Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#opcode-specific-result-codes">7.2.</a>&nbsp;
OpCode-Specific Result Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#opcode_client_operation">7.3.</a>&nbsp;
OpCode-Specific Client Operation, Processing a Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#opcode_server_operation">7.4.</a>&nbsp;
OpCode-Specific Server Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.4.1.</a>&nbsp;
Maintaining Same External IP Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pinhole_lifetime">7.4.2.</a>&nbsp;
Pinhole Lifetime<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec_server_delete">7.4.3.</a>&nbsp;
Pinhole deletion<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec_subscriber_identification">7.4.4.</a>&nbsp;
Subscriber Identification<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">7.4.5.</a>&nbsp;
Subscriber Renumbering<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.4.6.</a>&nbsp;
Disambiguating Remote Peer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pin_options">7.5.</a>&nbsp;
PCP Options for PIN OpCodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#remote_peer_filter">7.5.1.</a>&nbsp;
REMOTE_PEER_FILTER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.5.2.</a>&nbsp;
REMOTE_PEER<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.5.3.</a>&nbsp;
HONOR_EXTERNAL_PORT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dynamic-interaction">7.6.</a>&nbsp;
Interaction with Dynamic Connections<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#keepalives">7.7.</a>&nbsp;
Using PCP to Eliminate Application Keepalive Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">7.8.</a>&nbsp;
PCP Mapping State Maintenance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#epoch">7.8.1.</a>&nbsp;
Epoch<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reboot">7.8.2.</a>&nbsp;
Recreating Pinholes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.8.3.</a>&nbsp;
Maintaining Pinholes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#nested_nat">7.9.</a>&nbsp;
Nested NATs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#delete">7.10.</a>&nbsp;
Pinhole Deletion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#refresh">7.11.</a>&nbsp;
Pinhole Lifetime Extension<br />
<a href="#scenarios">8.</a>&nbsp;
Deployment Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">8.1.</a>&nbsp;
Dual Stack-Lite<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">8.1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dslite_encap">8.1.2.</a>&nbsp;
Encapsulation Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dslite_plain">8.1.3.</a>&nbsp;
Plain IPv6 Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.2.</a>&nbsp;
NAT64<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">8.3.</a>&nbsp;
NAT44 and NAT444<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">8.4.</a>&nbsp;
IPv6 Firewall<br />
<a href="#upnp-interworking">9.</a>&nbsp;
Interworking with UPnP IGD 1.0 and 2.0<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">9.1.</a>&nbsp;
UPnP IGD 1.0 with AddPortMapping Action<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#upnp-2-interworking">9.2.</a>&nbsp;
UPnP IGD 2.0 with AddAnyPortMapping Action<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">9.3.</a>&nbsp;
Lifetime Maintenance<br />
<a href="#security">10.</a>&nbsp;
Security Considerations<br />
<a href="#iana">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">11.1.</a>&nbsp;
PCP Server IP address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana_port">11.2.</a>&nbsp;
Port Number<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana_opcodes">11.3.</a>&nbsp;
OpCodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana_result_codes">11.4.</a>&nbsp;
Result Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana_ie">11.5.</a>&nbsp;
Options<br />
<a href="#anchor27">12.</a>&nbsp;
Authors<br />
<a href="#anchor28">13.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#anchor31">Appendix&nbsp;A.</a>&nbsp;
Changes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">A.1.</a>&nbsp;
Changes from draft-ietf-pcp-base-01 to -02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">A.2.</a>&nbsp;
Changes from draft-ietf-pcp-base-00 to -01<br />
<a href="#discovery_analysis">Appendix&nbsp;B.</a>&nbsp;
Analysis of Techniques to Discover PCP Server<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Port Control Protocol (PCP) provides a mechanism to control how
      incoming packets are forwarded by upstream devices such as NATs and
      firewalls. PCP is primarily designed to be implemented in the context of
      both large scale NAT and small-scale NAT (e.g., residential NATs). PCP
      allows hosts to operate servers permanently (e.g., a webcam) or
      temporarily (e.g., while playing a game) when behind one or more NAT
      devices, including when behind a large-scale NAT operated by their
      Internet service provider.
</p>
<p>PCP allows applications to create pinholes from an external IP
      address to an internal IP address and port. If the PCP-controlled device
      is a NAT, a mapping is created; if the PCP-controlled device is a
      firewall, a pinhole is created in the firewall. These pinholes are
      required for successful inbound communications destined to machines
      located behind a NAT.
</p>
<p>After creating a pinhole for incoming connections, it is necessary to
      inform remote computers about the IP address and port for the incoming
      connection. This is usually done in an application-specific manner. For
      example, a computer game would use a rendezvous server specific to that
      game (or specific to that game developer), and a SIP phone would use a
      SIP proxy. PCP does not provide this rendezvous function.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Scope</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Deployment Scenarios</h3>

<p>PCP can be used in various deployment scenarios, including:</p>
<ul class="text">
<li><a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>DS-Lite<span> (</span><span class='info'>Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; August&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite],
            including a NAT and including a router behind the B4 element, and;
            
<blockquote class="text">
<p>[Ed. Note: Do we want 'NAT behind the B4 element' in our
                scope? This affects PCP server discovery, among other things.
                However, users deploy these NATs. Do we want PCP to work with
                this, detect this, or quietly fail??  
This is tracked as
PCP Issues #1 and #25 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>
</li>
<li>NAT64, both <a class='info' href='#I-D.ietf-behave-v6v4-xlate-stateful'>Stateful<span> (</span><span class='info'>Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers,&rdquo; July&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate&#8209;stateful] and
            <a class='info' href='#I-D.ietf-behave-v6v4-xlate'>Stateless<span> (</span><span class='info'>Li, X., Bao, C., and F. Baker, &ldquo;IP/ICMP Translation Algorithm,&rdquo; September&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;behave&#8209;v6v4&#8209;xlate],
            and;
</li>
<li><a class='info' href='#I-D.ietf-behave-lsn-requirements'>Large-Scale
            NAT44<span> (</span><span class='info'>Yamagata, I., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;Common requirements for IP address sharing schemes,&rdquo; October&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;behave&#8209;lsn&#8209;requirements], including nested NATs ("NAT444"), and;
</li>
<li><a class='info' href='#I-D.miles-behave-l2nat'>Layer-2 aware NAT<span> (</span><span class='info'>Miles, D. and M. Townsley, &ldquo;Layer2-Aware NAT,&rdquo; March&nbsp;2009.</span><span>)</span></a> [I&#8209;D.miles&#8209;behave&#8209;l2nat]
            and <a class='info' href='#I-D.arkko-dual-stack-extra-lite'>Dual-Stack
            Extra Lite<span> (</span><span class='info'>Arkko, J. and L. Eggert, &ldquo;Scalable Operation of Address Translators with Per-Interface Bindings,&rdquo; October&nbsp;2010.</span><span>)</span></a> [I&#8209;D.arkko&#8209;dual&#8209;stack&#8209;extra&#8209;lite], and;
</li>
<li><a class='info' href='#I-D.ietf-v6ops-cpe-simple-security'>IPv6 firewall
            control<span> (</span><span class='info'>Woodyatt, J., &ldquo;Recommended Simple Security Capabilities in Customer Premises Equipment for Providing Residential IPv6 Internet Service,&rdquo; October&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;v6ops&#8209;cpe&#8209;simple&#8209;security].
</li>
</ul>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Supported Transport Protocols</h3>

<p>The PCP OpCodes defined in this document are designed to support
        transport protocols that use a 16-bit port number (e.g., TCP, UDP,
        SCTP, DCCP). Transport protocols that do not use a port number (e.g.,
        IPsec ESP) can be wildcarded (allowing any traffic with that protocol
        to pass), provided of course the upstream device being controlled by
        PCP supports that functionality, or new PCP OpCodes can be defined to
        support those protocols.
</p>
<a name="mono_homed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Single-homed Customer Premise Network</h3>

<p>The PCP machinery assumes a single-homed host model. That is, for a
        given IP version, only one default route exists to reach the Internet.
        This is important because after a PCP pinhole is created and an
        inbound packet (e.g., TCP SYN) arrives at the host the outbound
        response (e.g., TCP SYNACK) has to go through the same path so the
        proper address rewriting takes place on that outbound response packet.
        This restriction exists because otherwise there would need to be one
        PCP server for each egress, because the host could not reliably
        determine which egress path packets would take.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Port Forwarding:</dt>
<dd>
<blockquote class="text">
<p>Port forwarding allows a host to receive traffic sent to a
              specific IP address and port.
</p>
<p>In the context of a NAT or NAPT, the internal address and
              external address are different. In the context of a firewall,
              the internal address and external address are different. In both
              contexts, if an internal host is listening to connections on a
              specific port (that is, operating as a server), the external IP
              address and port number need to be port forwarded to the
              internal IP address and port number. In the context of a NAPT,
              it is possible that both the IP address and port are modified.
              For example with a NAPT, a webcam might be listening on port 80
              on its internal address 192.168.1.1, while its
              publicly-accessible external address is 192.0.2.1 and port is
              12345. The NAT does 'port forwarding' of one to the other.
</p>
<p>In the context of a firewall, the internal address, external
              IP address, and ports are not changed.
</p>
</blockquote>
</dd>
<dt>PCP Client:</dt>
<dd>
<blockquote class="text">
<p>A PCP software instance responsible for issuing PCP requests
              to a PCP Server. One or several PCP Clients can be embedded in
              the same host. Several PCP Clients can be located in the same
              local network of a given subscriber. A PCP Client can issue PCP
              request on behalf of a third party device of the same
              subscriber. An interworking function, from UPnP IGD to PCP, or
              from PCP to PCP (for nested NATs) is another example of a PCP
              client.
</p>
</blockquote>
</dd>
<dt>PCP Server:</dt>
<dd>
<blockquote class="text">
<p>A network element which receives and processes PCP requests
              from a PCP Client. See also <a class='info' href='#relationship'>Section&nbsp;4<span> (</span><span class='info'>Relationship of PCP Server and its NAT</span><span>)</span></a>.
</p>
</blockquote>
</dd>
<dt>Mapping:</dt>
<dd>
<blockquote class="text">
<p>See also Port Forwarding. A mapping exists only in the
              context of a Network Address Translator. A NAT mapping creates a
              relationship between an internal IP transport address and an
              external IP transport address. More specifically, it creates a
              translation rule where packets destined to the external IP and
              port are translated to the internal IP and port.
</p>
</blockquote>
</dd>
<dt>Mapping Types:</dt>
<dd>
<blockquote class="text">
<p>There are three different ways to create mappings: dynamic
              (e.g., outgoing TCP SYN), PCP, and static configured (e.g., CLI
              or web page). These mappings are one and the same but their
              attributes such as lifetime or filtering might be different.
</p>
</blockquote>
</dd>
<dt>Interworking Function:</dt>
<dd>a functional element
          responsible for interworking another protocol with PCP. For example
          interworking between <a class='info' href='#IGD'>UPnP IGD<span> (</span><span class='info'>UPnP Gateway Committee, &ldquo;WANIPConnection:1,&rdquo; November&nbsp;2001.</span><span>)</span></a> [IGD] with
          PCP.
</dd>
<dt>subscriber:</dt>
<dd>an entity provided access to the network.
          In the case of a commercial ISP, this is typically a single
          home.
</dd>
<dt>host:</dt>
<dd>a device which can have packets sent to it, as a
          result of PCP operations. A host is not necessarily a PCP
          client.
</dd>
</dl></blockquote>

<a name="relationship"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Relationship of PCP Server and its NAT</h3>

<p>The PCP server receives PCP requests. The PCP server might be
      integrated within the NAT or firewall device (as shown in <a class='info' href='#diagram_pcp_server_embedded'>Figure&nbsp;1<span> (</span><span class='info'>device with Embedded PCP Server</span><span>)</span></a>) which is expected to be a
      common deployment.
</p><br /><hr class="insert" />
<a name="diagram_pcp_server_embedded"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>                         +-----------------+
+------------+           | NAT or firewall |
| PCP Client |-&lt;network&gt;-+                 +---&lt;Internet&gt;
+------------+           |  with embedded  |
                         |    PCP server   |
                         +-----------------+</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: device with Embedded PCP Server&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>However, it is useful to also model a separation of the PCP server
      from the NAT, as shown below (<a class='info' href='#diagram_pcp_server_separate'>Figure&nbsp;2<span> (</span><span class='info'>NAT with Separate PCP Server</span><span>)</span></a>). The PCP server would
      communicate with the NAT using a protocol beyond the scope of this
      document, such as a proprietary protocol or any suitable standard
      protocol for NAT control.
</p><br /><hr class="insert" />
<a name="diagram_pcp_server_separate"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>                             +-----------------+
                          +--+ NAT or firewall +---&lt;Internet&gt;
                         /   +-----------------+
+------------+          /          ^
| PCP Client +-&lt;network&gt;           | any suitable control protocol
+------------+          \          v
                         \   +------------+
                          +--+ PCP Server |
                             +------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: NAT with Separate PCP Server&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Common Request and Response Header Format</h3>

<p>All PCP messages contain a request (or response) header, opcode-
      specific information, and (optional) informational elements. The packet
      layout for the common header, and operation of the PCP client and PCP
      server are described in the following sections. The information in this
      section applies to all OpCodes. Behavior of specific OpCodes defined in
      this document is described in <a class='info' href='#pin_opcodes'>Section&nbsp;7<span> (</span><span class='info'>Pinhole Operation</span><span>)</span></a>, and
      behavior of new OpCodes are described in their own documents following a
      similar format as in <a class='info' href='#pin_opcodes'>Section&nbsp;7<span> (</span><span class='info'>Pinhole Operation</span><span>)</span></a>.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Request Header</h3>
<br /><hr class="insert" />
<a name="common_request"></a>

<p style='text-align: left'>All requests have the following format:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ver=0 |reserve|R|   OpCode    |       Reserved                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Reserved (32 bits)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
:             (optional) opcode-specific information            :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
:             (optional) PCP Options                            :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Common Request Packet Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>These fields are described below:</p>
<blockquote class="text"><dl>
<dt>Ver:</dt>
<dd>Version is 0
</dd>
<dt>reserve:</dt>
<dd>4 reserved bits, MUST be sent as 0 and MUST
            be ignored when received.
</dd>
<dt>R:</dt>
<dd>Indicates Request (0) or Response (1). All
            Requests MUST use 0.
</dd>
<dt>OpCode:</dt>
<dd>Opcodes are defined in <a class='info' href='#opcodes'>Figure&nbsp;7<span> (</span><span class='info'>OpCodes</span><span>)</span></a>. More can be defined per rules described
            in <a class='info' href='#iana'>Section&nbsp;11<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</dd>
<dt>Reserved:</dt>
<dd>16 reserved bits, MUST be sent as 0 and
            MUST be ignored when received.
</dd>
</dl></blockquote>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Response Header</h3>
<br /><hr class="insert" />
<a name="common_response"></a>

<p style='text-align: center'>All responses have the following format:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Ver=1 |reserve|R|   Opcode    |  Reserved     |  Result Code  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                             Epoch                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
:             (optional) OpCode-specific response data          :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:             (optional) Informational Elements                 :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Common Response Packet Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>These fields are described below:</p>
<blockquote class="text"><dl>
<dt>Ver:</dt>
<dd>Version is 1
</dd>
<dt>reserve:</dt>
<dd>4 reserved bits, MUST be sent as 0, MUST be
            ignored when received.
</dd>
<dt>R:</dt>
<dd>Indicates Request (0) or Response (1). All
            Responses MUST use 1.
</dd>
<dt>OpCode:</dt>
<dd>The OpCode value from the request.
</dd>
<dt>Protocol:</dt>
<dd>Protocol field, echoed exactly from the
            request
</dd>
<dt>Result Code:</dt>
<dd>The result code for this response. See
            <a class='info' href='#result_codes'>Section&nbsp;5.4<span> (</span><span class='info'>Result Codes</span><span>)</span></a> for values.
</dd>
<dt>Epoch:</dt>
<dd>The server's Epoch value. The same value is
            used for all PCP clients. See <a class='info' href='#epoch'>Section&nbsp;7.8.1<span> (</span><span class='info'>Epoch</span><span>)</span></a> for
            discussion.
</dd>
</dl></blockquote>

<a name="pcp_information_elements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Options</h3>

<p>A PCP OpCode can be extended with an Option. Options can be used in
        requests and responses. It is anticipated that Options will include
        information which are associated with the normal function of an
        OpCode. For example, an Option could indicate DSCP markings to apply
        to incoming or outgoing traffic associated with a PCP pinhole, or an
        Open could include descriptive text (e.g., "for my webcam").
</p>
<p>Options use the following Type-Length-Value format:
</p><br /><hr class="insert" />
<a name="options-layout"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Option Code  |  Reserved     |       Option-Length           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                             data                              :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Options Header&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The description of the fields is as follows:</p>
<blockquote class="text"><dl>
<dt>Option Code:</dt>
<dd>Option code, 8 bits. The first bit of
            the option code is the "P" bit, described below. Option codes MUST
            be registered with IANA following the procedure described in <a class='info' href='#iana'>Section&nbsp;11<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>.
</dd>
<dt>Reserved:</dt>
<dd>MUST be set to 0 on transmission and MUST
            be ignored on reception.
</dd>
<dt>Option-Length:</dt>
<dd>Indicates in units of 4 octets the
            length of the enclosed data. Options with length of 0 are
            allowed.
</dd>
<dt>data:</dt>
<dd>Option data. The option data MUST end on a 32
            bit boundary, padded with 0's when necessary.
</dd>
</dl></blockquote>

<p>A given Option MAY be included in a request. An Option MUST NOT
        appear in a PCP response unless solicited in the associated request.
        If a given Option was included in a request, and understood and
        processed by the PCP server, it MUST be included in the response. The
        handling of an Option by the PCP Client and Server MUST be specified
        in a appropriate document and must include whether the PCP Option can
        appear (one or more times) in a request, and indicate the contents of
        the Option in the response.
</p>
<p>If the "P" bit in the OpCode is set, </p>
<ul class="text">
<li>the PCP server MUST only generate a positive PCP response if it
            can successfully process the PCP request and this Option.
</li>
<li>if the PCP server does not implement this Option, it MUST
            generate a failure response without including this Option in the
            response.
</li>
<li>If the PCP server does implement this Option, but cannot
            perform the function indicated by this Option, it MUST generate a
            failure response and include this Option (and its arguments) in
            the response.
</li>
</ul>

<p>If the "P" bit is clear, the PCP server MAY process or ignore this
        Option.
</p>
<p>If several Options are to be included in a PCP request or response,
        the Options MAY be encoded in any order by the PCP Client. The
        response MUST encode them in the same order, but may omit some PCP
        Options in the response (e.g., to indicate the PCP server does not
        understand that Option, or that Option is not included in responses).
        A single Option MAY appear more than once, if permitted by the
        definition of the Option itself. If the Option's definition allows the
        Option to appear only once, the PCP server MUST respond to such a PCP
        request with an error message [[which error?]]
</p>
<p>To enhance interoperability, newly defined Options should avoid
        interdependencies with each other.
</p>
<p>New Options MUST include the information below:
</p>
<p></p>
<blockquote class="text">
<p>This Option:</p>
<blockquote class="text">
<p>name: &lt;mnemonic&gt;
</p>
<p>number: &lt;value&gt;
</p>
<p>purpose:
</p>
<p>is valid for OpCodes: &lt;list of OpCodes&gt;
</p>
<p>has length: &lt;rules for length&gt;
</p>
<p>appear more than once: &lt;yes/no&gt;
</p>
</blockquote>

</blockquote>

<a name="result_codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Result Codes</h3>

<p>The following result codes may be returned as a result of any
        OpCode received by the PCP server. Result codes are 8 bits long and
        the most significant bit indicates if the error is transient or
        permanent. A transient error is one that might resolve itself, such
        that an identical PCP request submitted later would be successful
        (e.g., a resource is consumed and might become available later). A
        permanent error is one that cannot reasonably be successful if an
        identical PCP request is submitted (e.g., re-sending a PCP request
        containing an OpCode the server does not support). Future result codes
        should follow this same format.
</p><br /><hr class="insert" />
<a name="figure_result_codes"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
  0 - SUCCESS, success
128 - UNSUPP_VERSION, unsupported version
129 - UNSUPP_OPCODE, unsupported OpCode
130 - UNSUPP_OPTION, unsupported Option
131 - MALFORMED_OPTION, malformed Option (e.g., exists too many
      times, invalid length)
132 - UNSPECIFIED_ERROR, server encountered unspecified error
133 - MALFORMED_REQUEST
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: PCP Result Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Additional result codes, specific to the OpCodes defined in this
        document, are listed in <a class='info' href='#opcode-specific-result-codes'>Section&nbsp;7.2<span> (</span><span class='info'>OpCode-Specific Result Codes</span><span>)</span></a>.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
General Operation</h3>

<p>PCP messages MUST be sent over UDP, and the PCP Server MUST listen
      for PCP requests on the PCP port number (<a class='info' href='#iana_port'>Section&nbsp;11.2<span> (</span><span class='info'>Port Number</span><span>)</span></a>). Every PCP request generates a response, so
      PCP does not need to run over a reliable transport protocol.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
General PCP Client Operation</h3>

<p>This section details operation specific to a PCP client, for any
        OpCode. Procedures specific to the PIN OpCodes are described in <a class='info' href='#pin_opcodes'>Section&nbsp;7<span> (</span><span class='info'>Pinhole Operation</span><span>)</span></a>.
</p>
<a name="sec_generating_request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
Generating and Sending a Request</h3>

<p>Prior to sending its first PCP message, the PCP client determines
          which servers to use. The PCP client tries the following to get a
          list of PCP servers:</p>
<ol class="text">
<li>if a PCP server is configured (e.g., in a configuration
              file), the address(es) of the PCP server(s) are used as the list
              of PCP server(s), else;
</li>
<li>if DHCP indicates the PCP server(s), the address(es) of the
              indicated PCP server(s) are used as the list of PCP server(s),
              else;
</li>
<li>if the PCP working group decides an IANA-allocated address
              for the PCP server is suitable, it is added to the list of PCP
              servers, else;
</li>
<li>the address of the default router, it is added to the list of
              PCP servers.
</li>
</ol>
<blockquote class="text">
<p><p>[Ed. Note: more discussion around these methods is necessary
              to reach consensus on the best approach(es) for PCP. Also see
              <a class='info' href='#discovery_analysis'>Appendix&nbsp;B<span> (</span><span class='info'>Analysis of Techniques to Discover PCP Server</span><span>)</span></a> for further
              analysis.  This is tracked as PCP Issue
              #1 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<p>With that list of PCP servers, the PCP client formulates its PCP
          request. The PCP request contains a PCP common header, PCP OpCode
          and payload, and optional Information Elements. It initializes a
          retransmission timer to 4 seconds. The PCP Client SHOULD be bound to
          one single UDP port which SHOULD be randomly generated as per <a class='info' href='#I-D.ietf-tsvwg-port-randomization'>[I&#8209;D.ietf&#8209;tsvwg&#8209;port&#8209;randomization]<span> (</span><span class='info'>Larsen, M. and F. Gont, &ldquo;Transport Protocol Port Randomization Recommendations,&rdquo; August&nbsp;2010.</span><span>)</span></a>. When several PCP
          Clients are embedded in the same host, each uses a distinct port
          number to disambiguate their requests and replies. The PCP client
          sends a PCP message to each server in sequence, waiting for a
          response until its timer expires. Once a PCP client has successfully
          communicated with a PCP server, it continues communicating with that
          PCP server until that PCP server becomes non-responsive, which
          causes the PCP client to attempt to re-iterate the procedure
          starting with the first PCP server on its list. If a hard ICMP error
          is received (e.g., port unreachable, network unreachable) the PCP
          client SHOULD immediately abort trying to contact that PCP server.
          If no response is received from any of those servers, it doubles its
          retransmission timer and tries each server again. This is repeated 4
          times (for a total of 5 transmissions to each server). If, after
          these transmissions, no PCP server has responded the PCP client
          SHOULD abort the procedure.
</p>
<p>Upon receiving a response (success or error), the PCP client does
          not change to a different PCP server. That is, it does not "shop
          around" trying to find a PCP server to service its (same)
          request.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
Processing a Response</h3>

<p>The PCP client receives the response and verifies the source IP
          address and port belong to the PCP server of an outstanding request.
          It validates the version number and OpCode matches an outstanding
          request. Responses longer than 1024 octets are invalid and ignored.
          The response is further matched by comparing fields in the response
          OpCode-specific data to fields in the request OpCode-specific data.
          This matching is described by the OpCode itself, see <a class='info' href='#opcode_client_operation'>Section&nbsp;7.3<span> (</span><span class='info'>OpCode-Specific Client Operation, Processing a Response</span><span>)</span></a>. After a successful match
          with an outstanding request, the PCP client checks the Epoch field
          to determine if it needs to restore its state to the PCP server (see
          <a class='info' href='#epoch'>Section&nbsp;7.8.1<span> (</span><span class='info'>Epoch</span><span>)</span></a>).
</p>
<p>If it is an error response (&gt;0), the request failed. If the
          error response is less than 128, retrying the same request sometime
          in the future might be successful. If the error response is greater
          or equal to 128, retrying the same request is unlikely to be
          successful.
</p>
<p>If it is the success response (0), the PCP client knows the
          request was successful.
</p>
<a name="mif"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
Multi-interface Issues</h3>

<p>Hosts which desire a PCP mapping might be multi-interfaced (i.e.,
          own several logical/physical interfaces). Indeed, a host can be
          dual-stack or be configured with several IP addresses. These IP
          addresses may have distinct reachability scopes (e.g., if IPv6 they
          might have global reachability scope as for GUA (Global Unicast
          Address) or limited scope such as ULA (Unique Local Address, <a class='info' href='#RFC4193'>[RFC4193]<span> (</span><span class='info'>Hinden, R. and B. Haberman, &ldquo;Unique Local IPv6 Unicast Addresses,&rdquo; October&nbsp;2005.</span><span>)</span></a>)).
</p>
<p>IPv6 addresses with global reachability scope SHOULD be used as
          internal IP address when instructing a PCP mapping in a
          PCP-controlled device. IPv6 addresses with limited scope (e.g.,
          ULA), SHOULD NOT be indicated as internal IP address in a PCP
          message.
</p>
<p>As mentioned in <a class='info' href='#mono_homed'>Section&nbsp;2.3<span> (</span><span class='info'>Single-homed Customer Premise Network</span><span>)</span></a>, only
          mono-homed CP routers are in scope. Therefore, there is no viable
          scenario where a host located behind a CP router is assigned with
          two GUA addresses belonging to the same global IPv6 prefix. </p>
<blockquote class="text">
<p>[Ed. Note: text regarding multi-homing needs work.]
</p>
</blockquote>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
General PCP Server Operation</h3>

<p>This section details operation specific to a PCP server.
</p>
<p>Upon receiving a PCP request message, the PCP Server parses and
        validates it. Requests MUST be less than or equal to 1024 octets, and
        requests MUST be at least 8 octets. Requests outside those limits are
        malformed and MUST result in a MALFORMED_REQUEST error. A valid
        request contains a valid PCP common header, one valid PCP Opcode, and
        zero or more Options (which the server might or might not comprehend).
        If an error is encountered during processing, the server generates an
        error response which is sent back to the PCP client. Processing an
        OpCode and the Options are specific to each OpCode.
</p>
<p>After successful parsing of the message, the PCP server validates
        that the internal IP address in the PCP request belongs to the same
        subscriber. This validation depends on the PCP deployment scenario;
        see <a class='info' href='#sec_subscriber_identification'>Section&nbsp;7.4.4<span> (</span><span class='info'>Subscriber Identification</span><span>)</span></a>. If the
        internal IP address in the PCP request does not belong to the
        subscriber, an error response MUST be generated with result code
        NOT_AUTHORIZED.
</p>
<a name="pin_opcodes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Pinhole Operation</h3>

<p>This document defines four OpCodes for forwarding ports and
      controlling dynamic connections. These four OpCodes share a similar
      packet layout for requests and responses. They are:
</p><br /><hr class="insert" />
<a name="opcodes"></a>

<p>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
PIN44 = 0 = IPv4 address to IPv4 address (e.g., NAT44 or firewall)
PIN46 = 1 = IPv4 address to IPv6 address (e.g., NAT46 or firewall)
PIN64 = 2 = IPv6 address to IPv4 address (e.g., NAT64 or firewall)
PIN66 = 3 = IPv6 address to IPv6 address (e.g., NAT66 or firewall)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: OpCodes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>These operation of these OpCodes is described in this section.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
OpCode Packet Format</h3>

<p>The four PIN OpCodes (PIN44, PIN46, PIN64, PIN66) share a similar
        packet layout for both requests and responses. Because of this
        similarity, they are shown together. For all of the PIN OpCodes, if
        the request's internal IP address and internal port fields both matche
        the response's external ip address and external port fields, the IP
        addresses and ports are not changed and thus the functionality is
        purely a firewall; otherwise it pertains to a network address
        translator which might also perform firewall functions.
</p>
<p>The following diagram shows the request packet format for PIN44,
        PIN46, PIN64, and PIN66. This packet format is aligned with the
        response packet format:
</p><br /><hr class="insert" />
<a name="pin_request"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Protocol     |          Reserved                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
: Pinhole Internal IP address (32 or 128, depending on OpCode)  :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
: Requested external IP address (32 or 128, depending on OpCode):
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Requested lifetime                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        internal port          |   requested external port     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: PIN OpCode Request Packet Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>These fields are described below:</p>
<blockquote class="text"><dl>
<dt>Protocol:</dt>
<dd>indicates protocol associated with this
            opcode. Values are taken from the <a class='info' href='#proto_numbers'>IANA protocol registry<span> (</span><span class='info'>IANA, &ldquo;Protocol Numbers,&rdquo; 2010.</span><span>)</span></a> [proto_numbers]. For example,
            this field contains 6 (TCP) if the opcode is intended to create a
            TCP mapping. If a particular OpCode does not need the field, it
            MUST sent as 0 and MUST be ignored when received.
</dd>
<dt>Reserved:</dt>
<dd>MUST be 0 on transmission and MUST be
            ignored on reception.
</dd>
<dt>Pinhole Internal IP Address:</dt>
<dd>Internal IP address of
            the pinhole. This can be IPv4 or IPv6, depending on the
            OpCode.
</dd>
<dt>Requested External IP Address:</dt>
<dd>Requested external IP
            address. This is useful for refreshing a mapping, especially after
            the PCP server loses state. If the PCP server can fulfill the
            request, it will do so. If the PCP client doesn't know the
            external address, or doesn't have a preference, it MUST use 0.
</dd>
<dt>Requested lifetime:</dt>
<dd>Requested lifetime of this
            pinhole, in seconds.
</dd>
<dt>internal port:</dt>
<dd>Internal port for the pinhole.
</dd>
<dt>Requested external port:</dt>
<dd>requested external port for
            the mapping. This is useful for refreshing a mapping, especially
            after the PCP server loses state. If the PCP server can fulfill
            the request, it will do so. If the PCP client doesn't know the
            external port, or doesn't have a preference, it MUST use 0.
</dd>
</dl></blockquote>

<p>The following diagram shows the response packet format for PIN44,
        PIN46, PIN64, and PIN66:
</p><br /><hr class="insert" />
<a name="pin_response"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Protocol     |          Reserved                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
: Pinhole Internal IP address (32 or 128, depending on OpCode)  :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
: Assigned external IP address (32 or 128, depending on OpCode) :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Assigned lifetime                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       internal port           |    assigned external port     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: PIN OpCode Response Packet Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>These fields are described below:</p>
<blockquote class="text"><dl>
<dt>Protocol:</dt>
<dd>Copied from the request.
</dd>
<dt>Reserved:</dt>
<dd>MUST be 0 on transmission, MUST be ignored
            on reception.
</dd>
<dt>Pinhole Internal IP address:</dt>
<dd>Copied from the
            request. IPv4 or IPv6 address is indicated by the OpCode.
</dd>
<dt>Assigned external IP address:</dt>
<dd>Assigned external IPv4
            or IPv6 address for the pinhole. IPv4 or IPv6 address is indicated
            by the OpCode
</dd>
<dt>Assigned Lifetime:</dt>
<dd>Lifetime for this mapping, in
            seconds
</dd>
<dt>Internal port:</dt>
<dd>Internal port for the pinhole, copied
            from request.
</dd>
<dt>Assigned external port:</dt>
<dd>requested external port for
            the mapping. IPv4 or IPv6 address is indicated by the OpCode
</dd>
</dl></blockquote>

<a name="opcode-specific-result-codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
OpCode-Specific Result Codes</h3>

<p>In addition to the result codes described in <a class='info' href='#figure_result_codes'>Figure&nbsp;6<span> (</span><span class='info'>PCP Result Codes</span><span>)</span></a>, the following additional result
        codes may be returned as a result of the four PIN OpCodes received by
        the PCP server.
</p><br /><hr class="insert" />
<a name="figure_pin_result_codes"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
  3 - NETWORK_FAILURE, e.g., NAT device has not obtained a DHCP lease
  4 - NO_RESOURCES, e.g., NAT device cannot create more mappings
      at this time.  This is a system-wide error, and different from
      USER_EX_QUOTA.
  5 - AMBIGUOUS, a dynamic connection already exists, and REMOTE_PEER
      was not included on the request to disambiguate the pinhole.
      If the client is attempting to query/control a dynamic
      connection, it should re-issue the request and include the
      REMOTE_PEER Option.
150 - UNSUPP_PROTOCOL, unsupported Protocol
151 - NOT_AUTHORIZED, e.g., PCP server supports mapping, but the
      feature is disabled for this PCP client, or the PCP client
      requested a pinhole that cannot be fulfilled by the PCP
      server's security policy.
152 - USER_EX_QUOTA, mapping would exceed user's port quota
153 - CANNOT_HONOR_EXTERNAL_PORT, indicates the port is already
      in use or otherwise unavailable (e.g., special port that
      cannot be allocated by the server's policy).  This error
      is only returned if the request included the Option
      HONOR_EXTERNAL_PORT.
154 - UNABLE_TO_DELETE_ALL, indicates the PCP server was not able
      to delete all pinholes.
155 - CANNOT_FORWARD_PORT_ZERO, indicates the requested external
      port 0 cannot be fulfilled, because the PCP-controlled
      device is a firewall.
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: Result Codes specific to PIN OpCodes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Other OpCodes are in result codes are defined following the
        procedure in <a class='info' href='#iana_result_codes'>Section&nbsp;11.4<span> (</span><span class='info'>Result Codes</span><span>)</span></a>.
</p>
<a name="opcode_client_operation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
OpCode-Specific Client Operation, Processing a Response</h3>

<p>This section describes the operation of a client when sending the
        OpCodes PIN44, PIN64, PIN46, or PIN66.
</p>
<p>A response is matched with a request by comparing the protocol,
        internal IP address, internal port, remote peer address and remote
        peer port. Other fields are not compared, because the PCP server
        changes those fields to provide information about the pinhole created
        by the OpCode.
</p>
<p>If a successful response, the PCP client can use the external IP
        address and port(s) as desired. Typically the PCP client will
        communicate the external IP address and port(s) to another host on the
        Internet using an application-specific rendezvous mechanism.
</p>
<p>If an unsuccessful result code greater than or equal to 128, the
        PCP client SHOULD NOT re-issue the same request. If a result code less
        than or equal to 127, the PCP client MAY, if it wishes, resend the
        same message after a delay of at least 5 seconds.
</p>
<a name="opcode_server_operation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
OpCode-Specific Server Operation</h3>

<p>This section describes the operation of a client when processing
        the OpCodes PIN44, PIN64, PIN46, or PIN66.
</p>
<p>If the requested lifetime is 0, it indicates a Delete request. This
        means the pinhole described by the internal IP address should be
        deleted, and requested external port field is ignored by the server
        (that is, it isn't validated). If the deletion request was properly
        formatted, and the associated pinhole (if present) is deleted, and a
        positive response is generated containing external port of 0 and
        lifetime of 0. If the client attempts to delete a port mapping which
        was manually assigned by some kind of configuration tool, the PCP
        server MUST respond with NOT_AUTHORZED result code. </p>
<blockquote class="text">
<p>[Ed. Note: Should we similarly return an error if
            attempting to delete mappings that were created
            dynamically (e.g., TCP SYN)?]  This is tracked as PCP
            Issues #9 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<p>A client can request the explicit deletion of all its UDP or TCP
        mappings by sending a PCP request with a PIN OpCode with external
        port, internal port, and lifetime set to 0. A client MAY choose to do
        this when it first acquires a new IP address in order to protect
        itself from port mappings that were performed by a previous owner of
        the IP address. After receiving such a deletion request, the PCP
        server and its PCP-controlled device MUST delete all the port
        mappings. The PCP server responds to such a deletion request with a
        response as described above, with the internal port set to zero. If
        the PCP server is unable to delete a port mapping, for example,
        because the mapping was manually configured by a configuration tool,
        the PCP server MUST still delete as many port mappings as possible,
        and respond with the result code UNABLE_TO_DELETE_ALL.
</p>
<p>The PCP Server MAY reduce the lifetime that was requested by the
        PCP Client. The PCP Server SHOULD NOT offer a lease lifetime greater
        than that requested by the PCP Client. See <a class='info' href='#pinhole_lifetime'>Section&nbsp;7.4.2<span> (</span><span class='info'>Pinhole Lifetime</span><span>)</span></a> for a discussion of lifetime.
</p>
<p>If the requested external port is 0, and the PCP-controlled device
        does not change port numbers (that is, it does not do port
        translation), it cannot fulfill the request. In that case, the PCP
        server MUST return the response code CANNOT_FORWARD_PORT_ZERO.
</p>
<p>If the PCP-controlled device is stateless (that is, does not
        establish any per-flow state), the PCP server simply returns an
        answer, without creating any "pinholes".
</p>
<p>If an option with value greater than 128 exists but that option
        does not make sense (e.g., the HONOR_EXTERNAL_PORT option is included
        in a request with lifetime=0 (indicating a delete request)), the
        request is invalid and generates a MALFORMED_OPTION error.
</p>
<p>If a dynamic mapping already exists for the internal IP address and
        internal port, and the REMOTE_PEER option is not included in the
        request, it is impossible to establish a pinhole. In such a case, the
        PCP server responds with the error AMBIGUOUS. The client needs to
        choose a different internal port and send a new PCP request.
</p>
<p>By default, a PCP-controlled device MUST NOT create pinholes for a
        protocol not indicated in the request. For example, if the request was
        for a TCP mapping, a UDP mapping MUST NOT be created. Nevertheless, a
        configurable feature MAY be supported by the PCP-controlled device,
        which MAY reserve (but not forward) the companion port so the same PCP
        Client can request it in the future.
</p>
<p>If all of the proceeding operations were successful (did not
        generate an error response), then the requested pinholes are created
        as described in the request and a positive response is built. This
        positive result contains the same OpCode as the request, but with the
        "R" bit set.
</p>
<p>As a side-effect of creating a pinhole, ICMP messages associated
        with the pinhole are also translated (if appropriate) and forwarded.
        This is done to ensure that ICMP messages can still be used by hosts,
        without application programmers or PCP client implementations needing
        to signal PCP separately to create ICMP pinholes for those flows. When
        the pinhole is deleted (or its lifetime expires), ICMP messages
        associated with the pinhole are no longer translated or forwarded.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.1"></a><h3>7.4.1.&nbsp;
Maintaining Same External IP Address</h3>

<p>If there are active mappings associated with a given subscriber
          (see <a class='info' href='#sec_subscriber_identification'>Section&nbsp;7.4.4<span> (</span><span class='info'>Subscriber Identification</span><span>)</span></a>) --
          created via dynamic assignment, by PCP or any other means --
          subsequent PCP mapping requests belonging to the same subscriber
          MUST use the same external IP address. This follows the intent of
          REQ-1 of <a class='info' href='#I-D.ietf-behave-lsn-requirements'>[I&#8209;D.ietf&#8209;behave&#8209;lsn&#8209;requirements]<span> (</span><span class='info'>Yamagata, I., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;Common requirements for IP address sharing schemes,&rdquo; October&nbsp;2010.</span><span>)</span></a>.
</p>
<p>Once an internal host, has no active mapping in the
          PCP-controlled device, a subsequent PCP request for that host MAY be
          assigned to a different external IP address.
</p>
<a name="pinhole_lifetime"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.2"></a><h3>7.4.2.&nbsp;
Pinhole Lifetime</h3>

<p>Once a PCP server has responded positively to a pinhole request
          for a certain lifetime, the port forwarding is active for the
          duration of the lifetime unless deleted by the PCP client or until
          the PCP server loses its state (e.g., crashes). This has
          interactions with dynamically-created mappings, see Sections <a class='info' href='#dynamic-interaction'>Section&nbsp;7.6<span> (</span><span class='info'>Interaction with Dynamic Connections</span><span>)</span></a>.
</p>
<p>The PCP Client requests a certain lifetime, and the PCP Server
          responds with the assigned lifetime. The PCP Server can minimize and
          maximize the requested lifetime. The PCP server SHOULD be
          configurable for permitted minimum and maximum lifetime, and the
          RECOMMENDED values are 120 seconds for the minimum value and 24
          hours for the maximum. It is NOT RECOMMENDED that the server allow
          long lifetimes (exceeding 24 hours), because they will consume ports
          even if the internal host is no longer interested in receiving the
          traffic or no longer connected to the network.
</p>
<p>An application that forgets its PCP-assigned mappings (e.g., the
          application or OS crashed) will request new PCP mappings (consuming
          the user's port quota (if there is a quota) and the resource limit
          for number of pinholes), and the application will also probably
          initiate dynamic connections to servers without using PCP (also
          consuming the user's port quota). PCP provides no explicit
          protection against such port consumption. In such environments, it
          is RECOMMENDED that applications use shorter PCP lifetimes to reduce
          the impact of consuming the user's port quota.
</p>
<a name="sec_server_delete"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.3"></a><h3>7.4.3.&nbsp;
Pinhole deletion</h3>

<p>A pinhole MUST be deleted by the PCP Server upon the expiry of
          its lifetime, or upon request from the PCP client.
</p>
<p>In order to prevent another subscriber from receiving unwanted
          traffic, the PCP server SHOULD NOT assign that same external port to
          another host for 120 seconds (MSL, <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>).
</p>
<p></p>
<blockquote class="text">
<p>[Ed. Note: it should (MUST?) allow the same host to
              re-acquire the same port, though.]
</p>
</blockquote>

<a name="sec_subscriber_identification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.4"></a><h3>7.4.4.&nbsp;
Subscriber Identification</h3>

<p>The PIN OpCodes require subscriber identification because they
          allocate resources to a subscriber. A PCP Client can create mappings
          in a PCP-controlled device on behalf of a third party device (e.g.,
          a computer can create PCP mappings on behalf of a webcam). However,
          a PCP client cannot open pinholes for a different subscriber. The
          mechanism to identify "same subscriber" depends on the sort of NAT
          on this network:</p>
<ul class="text">
<li>If the PCP-controlled device is a NAT64: the internal IP
              address indicated in the PCP message and the source IPv6 address
              of received PCP request MUST belong to the same IPv6 prefix. The
              length of the IPv6 prefix is the same as the length assigned to
              each subscriber on that particular network (e.g., /64), and that
              length must be configurable by the network operator.
</li>
<li>If the PCP-controlled device is a DS-Lite AFTR: DS-Lite
              (Section 11 of <a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>[I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite]<span> (</span><span class='info'>Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; August&nbsp;2010.</span><span>)</span></a>) already
              requires the tunnel transport source address be validated, and
              that same address is used by PCP to assign the tunnel-ID to the
              requested mapping (see <a class='info' href='#dslite_encap'>Section&nbsp;8.1.2<span> (</span><span class='info'>Encapsulation Mode</span><span>)</span></a> and
              <a class='info' href='#dslite_plain'>Section&nbsp;8.1.3<span> (</span><span class='info'>Plain IPv6 Mode</span><span>)</span></a>). Thus, PCP acquires the
              same security properties as DS-Lite. If address validation is
              implemented correctly, the PCP Client can not instruct mappings
              on behalf of devices of another subscriber.
</li>
<li>If LSN with a routed network (NAT44), each subscriber has a
              known set of IPv4 address (usually one IPv4 address) and all PCP
              requests MUST be sent from only one of the subscriber's IP
              addresses and MUST only open pinholes towards the subscriber's
              own IP address.
</li>
<li>If IPv6 firewall: the internal IP address indicated in the
              PCP message and the source IPv6 address of received PCP request
              MUST belong to the same IPv6 prefix. The length of the IPv6
              prefix is the same as the length assigned to each subscriber on
              that particular network (e.g., /64), and that length must be
              configurable by the network operator.
</li>
</ul>

<p>PCP-controlled devices can be a DS-Lite AFTR or an IPv4-IPv6
          interconnection node such as NAT46 or NAT64. These nodes are
          deployed by Service Providers to deliver global connectivity service
          to their customers. Appropriate functions to restrict the use of
          these resources (e.g., LSN facility) to only subscribed users should
          be supported by these devices. Access control can be implicit or
          explicit: </p>
<ul class="text">
<li>It is said to be explicit if an authorisation procedure is
              required for a user to be granted access to such resources. For
              such variant of PCP-controlled device, a subscriber can be
              identified by an IPv6 address, an IPv4 address, a MAC address,
              or any other information.
</li>
<li>For other scenarios, such as plain IPv4-in-IPv6 encapsulation
              for a DS-Lite architecture, the access to the service is based
              on the source IPv6 prefix. No per-user polices is pre-configured
              in the PCP-controlled device.
</li>
</ul>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.5"></a><h3>7.4.5.&nbsp;
Subscriber Renumbering</h3>

<p>The customer premise router might obtain a new IP prefix, either
          due to a reboot, power outage, DHCPv6 lease expiry, or other action.
          If this occurs, the ports reserved using PCP might be delivered to
          another customer who now has that (old) address. This same problem
          can occur if an IP address is re-assigned today, without PCP. The
          solution is the same as today: ISPs should not re-assign IP
          addresses.
</p>
<p>When a new IP address is assigned to a host embedding a PCP
          Client, the NAT (or firewall) controlled by the PCP server will
          continue to send traffic to the old IP address. Assuming the PCP
          client wants to continue receiving traffic, it needs to install new
          mappings. The requested external port field will not be honored by
          the PCP server, in all likelihood, because it is still being
          forwarded to the old IP address. Thus, the PCP client will assigned
          new port numbers.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4.6"></a><h3>7.4.6.&nbsp;
Disambiguating Remote Peer</h3>

<p>When operating a UDP or TCP server, one application is listening
          on a port and no other application will be assigned that port by the
          operating system. However, ephemeral connections (that is, outgoing
          connections) to different servers can share the same ephemeral port,
          even between applications. If a PCP request with a PIN OpCode is
          sent after such a dynamic connection is established (potentially by
          another application), the PCP server cannot reliable distinguish if
          the PIN request is referring to the current connection or to a new
          connection. To eliminate this ambiguity, the remote peer's IP
          address and port can be specified in the REMOTE_PEER Option.
</p>
<p>This Option does not create or modify filtering on the NAT (for
          that, use REMOTE_PEER_FILTER) and have no effect on the NAT or
          firewall's normal filtering which will be any combination of
          Endpoint-Independent Filtering, Address-Dependent Filtering, or
          Address and Port-Dependent Filtering (these terms are originally
          defined and explained in <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a>).
</p>
<a name="pin_options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
PCP Options for PIN OpCodes</h3>

<p>
</p>
<a name="remote_peer_filter"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.1"></a><h3>7.5.1.&nbsp;
REMOTE_PEER_FILTER</h3>

<p>This Option indicates packet filtering is desired. The remote
          peer port and remote peer IP Address indicate the permitted remote
          peer's source IP address and port for packets from the Internet.
          That is, packets with a source IP address, transport, or port that
          do not match those fields of the PCP request are dropped by the PCP
          server-controlled NAT/firewall device.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Reserved                   |   Remote Peer Port            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
:     Remote Peer IP address (32 bits if PIN44 or PIN64,        :
:              1 28 bits if PIN46 or PIN66)                     :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p>
</p>
<p></p>
<blockquote class="text">
<p>This Option:</p>
<blockquote class="text">
<p>value: 128
</p>
<p>is valid for OpCodes: PIN44, PIN64, PIN46, or PIN66
</p>
<p>is included in responses: MUST
</p>
<p>has length: 2 or 5
</p>
<p>may appear more than once: no
</p>
</blockquote>

</blockquote><p>Because of interactions with dynamic ports (<a class='info' href='#dynamic-interaction'>Section&nbsp;7.6<span> (</span><span class='info'>Interaction with Dynamic Connections</span><span>)</span></a>), this Option MUST only be used
          by a client that is operating a server, as this ensures that no
          other application will be assigned the same ephemeral port for its
          outgoing connection. Other use by a PCP client is NOT RECOMMENDED
          and will cause some UNSAF NAT traversal mechanisms <a class='info' href='#RFC3424'>[RFC3424]<span> (</span><span class='info'>Daigle, L. and IAB, &ldquo;IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation,&rdquo; November&nbsp;2002.</span><span>)</span></a> to fail where they would have otherwise
          succeeded, breaking other applications running on this same
          host.
</p>
<p></p>
<blockquote class="text">
<p>[Ed. Note: How do we want to remove a filter? Do we
              want to allow removing a filter at all -- is there a
              use-case for that or can the application just create a
              new mapping? If we have a use-case, perhaps use 0.0.0.0
              as the remote IP address to remove all filters?  This is
              tracked as PCP Issue
              #10 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.2"></a><h3>7.5.2.&nbsp;
REMOTE_PEER</h3>

<p>Due to a per-existing dynamic mapping, a PCP server may not be
          able to instantiate a filter on a specific port. It is thus
          recommended that applications bind to the source port (to prevent
          other applications from using that same source port) prior to using
          this PCP Option.
</p>
<p>In those situations, the Option REMOTE_PEER is necessary to
          disambiguate the mappings. This option does not change filtering
          behavior of the NAT or firewall.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Reserved                   |   Remote Peer Port            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
:                                                               :
:     Remote Peer IP address (32 bits if PIN44 or PIN64,        :
:              1 28 bits if PIN46 or PIN66)                     :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+</pre></div>
<p></p>
<blockquote class="text">
<p>This Option:</p>
<blockquote class="text">
<p>value: 129
</p>
<p>is valid for OpCodes: PIN44, PIN64, PIN46, or PIN66
</p>
<p>is included in responses: MUST
</p>
<p>has length: 2 or 5
</p>
<p>may appear more than once: no
</p>
</blockquote>

</blockquote>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5.3"></a><h3>7.5.3.&nbsp;
HONOR_EXTERNAL_PORT</h3>

<p>This option indicates the PCP client needs to have the indicated
          requested external port allocated. If the PCP server cannot provide
          that port for the exclusive use of the PCP client, the PCP server
          MUST return result code CANNOT_HONOR_EXTERNAL_PORT.
</p>
<p>This option is intended for use by <a class='info' href='#upnp-interworking'>UPnP IGD interworking<span> (</span><span class='info'>Interworking with UPnP IGD 1.0 and 2.0</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text">
<p>This Option:</p>
<blockquote class="text">
<p>value: 130
</p>
<p>is valid for OpCodes: PIN44, PIN64, PIN46, or PIN66
</p>
<p>is included in responses: MUST
</p>
<p>has length: 0
</p>
<p>may appear more than once: no
</p>
</blockquote>

</blockquote>

<a name="dynamic-interaction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Interaction with Dynamic Connections</h3>

<p>Dynamic connections are created by hosts sending a TCP or UDP
        packet across their NAT. PCP can be used with such dynamic
        connections. There are two interesting cases: PCP before a dynamic
        connection, and PCP after a dynamic connection.
</p>
<p>If two applications on the same host communicate with different
        destinations, it is possible for them to be allocated the same
        ephemeral source port -- without either of the applications using the
        REUSEADDR socket option. Thus, one application's use of PCP (to adjust
        the NAT or firewalls behavior) can affect an unrelated application on
        the same host. This is why the four PIN OpCodes include the remote
        peer fields. The remote peer fields allow the PCP server to
        disambiguate which mapping applies to the PIN OpCode message.
</p>
<p>Because PCP is not intended to adjust NAT behavior for
        dynamically-created connections, it is possible (and reasonable) for
        that second dynamic connection to be mapped to a different public
        port. Even if that occurs, the other application can issue its own PCP
        request (to determine the mapping lifetime) following the same
        procedure described in this section.
</p>
<a name="keepalives"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Using PCP to Eliminate Application Keepalive Messages</h3>

<p>Middleboxes such as NATs or firewalls need to see occasional
        traffic or will terminate their session state, causing application
        failures. To avoid this, many applications routinely generate
        keepalive traffic for the primary or sole purpose of maintaining state
        with such middleboxes. Applications can avoid such application
        keepalive traffic by using PCP.
</p>
<p>To use PCP for this function, the applications first connects to
        its server, as normal. Afterwards, it issues a PCP PIN request (PIN44,
        PIN64, PIN46, or PIN66, as appropriate) specifying the same 5-tuple as
        that connection in the PCP PIN request (internal IP address and port,
        transport protocol, and remote peer IP address and port), with the
        requested external address and requested external port fields both set
        to 0, and includes the REMOTE_PEER Option indicating the remote peer's
        IP address from the perspective of the PCP client. The PCP response
        will indicate the lifetime for that session.
</p>
<p>On many common platforms (i.e., those making use of the BSD sockets
        API), using PCP for purposes of application keepalives by issuing a
        PCP request followed by a dynamic connection to the server is
        difficult to implement properly. This is therefore NOT RECOMMENDED.
        Instead, client applications SHOULD first establish a dynamic
        connection to a server, and then issue a PCP request related to that
        connection, including the REMOTE_PEER option.
</p><br /><hr class="insert" />
<a name="keepalive-pseudocode"></a>

<p>The following pseudo-code shows how PCP can be reliably
          used with a dynamic socket, for the purposes of reducing application
          keepalive messages:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
int s = socket(...);
connect(s, &amp;remote_peer, ...);
getsockname(s, &amp;internal_address, ...);
pcp_send_request(internal_address, 0, remote_peer, lifetime);
         /* external address is set to zero */
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: Pseudo-code for using PCP to with a dynamic socket&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8"></a><h3>7.8.&nbsp;
PCP Mapping State Maintenance</h3>

<p>If an event occurs that causes the PCP server to lose state (such
        as a crash or power outage), the pinholes created by PCP are lost.
        Such loss of state is rare in a service provider environment (due to
        redundant power, disk drives for storage, etc.). But such loss of
        state is more common in a residential NAT device which does not write
        information to its non-volatile memory.
</p>
<p>The Epoch indicates if the PCP server has lost its state. If this
        occurs, the PCP client can attempt to recreate the pinholes following
        the procedures described in this section.
</p>
<a name="epoch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8.1"></a><h3>7.8.1.&nbsp;
Epoch</h3>

<p>Every PCP response sent by the PCP Server includes an Epoch
          field. This field increments by 1 every second, and indicates to the
          PCP client if PCP state needs to be restored. If the PCP Server
          resets or loses the state of its port mapping table, due to reboot,
          power failure, or any other reason, it MUST reset its Epoch time to
          0. Similarly, if the public IP address of the NAT (controlled by the
          PCP server) changes, the Epoch MUST be reset to 0.
</p>
<p>Whenever a client receives a PCP response, the client computes
          its own conservative estimate of the expected Epoch value by taking
          the Epoch value in the last packet it received from the gateway and
          adding 7/8 (87.5%) of the time elapsed since that packet was
          received. If the Epoch value in the newly received packet is less
          than the client's conservative estimate by more than one second,
          then the client concludes that the PCP server lost state, and the
          client MUST immediately renew all its active port mapping leases as
          described in <a class='info' href='#reboot'>Section&nbsp;7.8.2<span> (</span><span class='info'>Recreating Pinholes</span><span>)</span></a>.</p>
<blockquote class="text">
<p>[Ed. Note: comment from Dave Thaler: "So spoofed
              packets with Epoch=0 that look like they come from the
              server could result in a big amplification attack on the
              PCP server. How is this mitigated?". This is tracked as
              PCP Issue #21, <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="reboot"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8.2"></a><h3>7.8.2.&nbsp;
Recreating Pinholes</h3>

<p>The PCP server SHOULD store mappings in persistent storage so
          when it is powered off or rebooted, it remembers the port mapping
          state of the network. Due to the physical architecture of some PCP
          servers, this is not always achievable (e.g., some non-volatile
          memory can withstand only a certain number of writes, so writing PCP
          mappings to such memory is generally avoided).
</p>
<p>However, maintaining this state is not essential for correct
          operation. When the PCP server loses state and begins processing new
          PCP messages, its Epoch is reset to zero (per the procedure of <a class='info' href='#epoch'>Section&nbsp;7.8.1<span> (</span><span class='info'>Epoch</span><span>)</span></a>).
</p>
<p>A mapping renewal packet is formatted identically to an original
          mapping request; from the point of view of the client it is a
          renewal of an existing mapping, but from the point of view of the
          PCP server it appears as a new mapping request.
</p>
<p>This self-healing property of the protocol is very important.
</p>
<p>When a client renews its port mappings as the result of receiving
          a packet where the Epoch field indicates that a reboot or similar
          loss of state has occurred, the client MUST first delay by a random
          amount of time selected with uniform random distribution in the
          range 0 to 5 seconds, and then send its first PCP request. After
          that request is acknowledged by the PCP server, the client may then
          send its second request, and so on, as rapidly as the gateway
          allows. The requests SHOULD be issued serially, one at a time; the
          client SHOULD NOT issue multiple requests simultaneously in
          parallel.
</p>
<p></p>
<blockquote class="text">
<p>[Ed. Note: the paragraph above is copied from NAT-PMP, and
              seems to be advice specific to receiving asynchronous
              notification that the Epoch was reset. Asynchronous notification
              needs the delay described (in fact, it probably needs greater
              delay than 0-5 seconds if on a larger network) and also needs to
              discourage sending multiple PCP requests serially. However, PCP
              does not have asynchronous notification (yet), and has different
              needs/requirements for pacing. In short: the above paragraph
              needs some discussion.]
</p>
</blockquote>

<p>The discussion in this section focuses on recreating inbound port
          mappings after loss of PCP server state, because that is the more
          serious problem. Losing port mappings for outgoing connections
          destroys those currently active connections, but does not prevent
          clients from establishing new outgoing connections. In contrast,
          losing inbound port mappings not only destroys all existing inbound
          connections, but also prevents the reception of any new inbound
          connections until the port mapping is recreated. Accordingly, we
          consider recovery of inbound port mappings the more important
          priority. However, clients that want outgoing connections to survive
          a NAT gateway reboot can also achieve that using PCP. After
          initiating an outbound TCP connection (which will cause the NAT
          gateway to establish an implicit port mapping) the client should
          send the NAT gateway a port mapping request for the source port of
          its TCP connection, which will cause the NAT gateway to send a
          response giving the external port it allocated for that mapping. The
          client can then store this information, and use it later to recreate
          the mapping if it determines that the NAT gateway has lost its
          mapping state.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8.3"></a><h3>7.8.3.&nbsp;
Maintaining Pinholes</h3>

<p>A PCP client can refresh a pinhole by sending a new PCP request
          containing information from the earlier PCP response. The PCP server
          will respond indicating the new lifetime. It is possible, due to
          failure of the PCP server, that the public IP address and/or public
          port, or the PCP server itself, has changed (due to a new route to a
          different PCP server). To detect such events more quickly, the PCP
          client may find it beneficial to use shorter lifetimes (so that it
          communicates with the PCP server more often). If the PCP client has
          several pinholes, the Epoch value only needs to be retrieved for one
          of them to verify the PCP server has not lost port forwarding
          state.
</p>
<p>If the client wishes to check the PCP server's Epoch, it sends a
          PCP request for any one of the client's pinholes. This will return
          the current Epoch value. In that request the PCP client could extend
          the mapping lifetime (by asking for more time) or maintain the
          current lifetime (by asking for the same number of seconds that it
          knows are remaining of the lifetime).
</p>
<a name="nested_nat"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.9"></a><h3>7.9.&nbsp;
Nested NATs</h3>

<p></p>
<blockquote class="text">
<p>[Ed. Note: Nested NATs will be discussed in a later
            version of this document or, more likely, in a separate
            document. The mechanism to support nested NATs is to have
            each NAT implement a PCP server (to service devices and
            NATs behind it) and a PCP client (to communicate with NATs
            above it). This allows a PCP client to be unaware of the
            PCP communications going on between upstream NATs.]  This
            is tracked as PCP Issue
            #25 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="delete"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.10"></a><h3>7.10.&nbsp;
Pinhole Deletion</h3>

<p>A PCP Client can delete a pinhole immediately by sending the
        appropriate PIN OpCode with a lifetime of 0. The PCP server responds
        by returning a PIN Response with a lifetime of 0.
</p>
<p>To delete all pinholes for all hosts associated with this
        subscriber, an all-zero internal IP address is used.
</p>
<a name="refresh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.11"></a><h3>7.11.&nbsp;
Pinhole Lifetime Extension</h3>

<p>An existing mapping can have its lifetime extended by the PCP
        client. To do this, the PCP client sends a new PCP map request to the
        server indicating the internal IP address and port(s).
</p>
<p>The PCP Client SHOULD renew the mapping before its expiry time,
        otherwise it will be removed by the PCP Server (see <a class='info' href='#sec_server_delete'>Section&nbsp;7.4.3<span> (</span><span class='info'>Pinhole deletion</span><span>)</span></a>). In order to prevent excessive PCP
        chatter, it is RECOMMENDED to renew only 60 seconds before expiration
        time (to account for retransmissions that might be necessary due to
        packet loss, clock synchronization between PCP client and PCP server,
        and so on).
</p>
<a name="scenarios"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Deployment Scenarios</h3>

<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Dual Stack-Lite</h3>

<p>The interesting components in a Dual-Stack Lite deployment are the
        B4 element (which is the customer premise router) and the AFTR element
        (which is the device that both terminates the IPv6-over-IPv4 tunnel
        and also implements the large-scale NAT44 function). The B4 element
        does not need to perform a NAT function (and usually does not perform
        a NAT function), but it does operate its own DHCP server and is the
        local network's default router.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
Overview</h3>

<p>Various PCP deployment scenarios can be considered to control the
          PCP server embedded in the AFTR element:</p>
<ol class="text">
<li>UPnP IGD and NAT-PMP are used in the LAN: an interworking
              function is required to be embedded in the B4 element to ensure
              interworking between the protocol used in the LAN and PCP. UPnP
              IGD-PCP Interworking Function is described in <a class='info' href='#upnp-interworking'>Section&nbsp;9<span> (</span><span class='info'>Interworking with UPnP IGD 1.0 and 2.0</span><span>)</span></a>.
</li>
<li>Hosts behind the B4 element with either include a PCP client
              or UPnP IGD client.
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>if a UPnP IGD client, the B4 element will need to include
                  an interworking function from UPnP IGD to PCP.
</dd>
<dt>B.</dt>
<dd>if a PCP client, the PCP client will communicate directly
                  with the PCP server.
</dd>
</dl></blockquote>
</li>
<li>The B4 element include a PCP Client which is invoked by an
              HTTP-based configuration (as is common today). The internal IP
              address field in the PCP payload would be the internal host used
              in the port forwarding configuration.
</li>
</ol>

<p>Two modes are identified to forward PCP packets to a PCP Server
          controlling the provisioned AFTR as described in the following
          sub-sections.
</p>
<p></p>
<blockquote class="text">
<p>[Ed. Note: We need to decide on Encapsulation Mode or
              Plain IPv6 Mode.  This is tracked as PCP Issue
              #13 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="dslite_encap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
Encapsulation Mode</h3>

<p>In this mode, B4 element does no processing at all of the PCP
          messages, and forwards them as any other UDP traffic. With DS-Lite,
          this means that IPv4 PCP messages issued by internal PCP Clients are
          encapsulated into the IPv6 tunnel sent to the AFTR as for any other
          IPv4 packets. The AFTR decapsulates the IPv4 packets and processes
          the PCP requests (because the destination IPv4 address points to the
          PCP Server embedded in the AFTR).
</p>
<a name="dslite_plain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.3"></a><h3>8.1.3.&nbsp;
Plain IPv6 Mode</h3>

<p>Another alternative for deployment of PCP in a DS-Lite context is
          to rely on a PCP Proxy in the B4 element. Protocol exchanges between
          the PCP Proxy and the PCP Server are conveyed using plain IPv6 (no
          tunnelling is used). Nevertheless, the IPv6 address used as source
          address by the PCP Proxy MUST be the same as the one used by the B4
          element.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
NAT64</h3>

<p>Hosts behind a NAT64 device can make use of PCP in order to perform
        port reservation (to get a publicly routable IPv4 port).
</p>
<p>If the IANA-assigned IP address is used for the discovery of the
        PCP Server, that IPv4 address can be placed into the IPv6 destination
        address following that particular network's well-known prefix or
        network-specific prefix, per <a class='info' href='#RFC6052'>[RFC6052]<span> (</span><span class='info'>Bao, C., Huitema, C., Bagnulo, M., Boucadair, M., and X. Li, &ldquo;IPv6 Addressing of IPv4/IPv6 Translators,&rdquo; October&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
NAT44 and NAT444</h3>

<p>Residential subscribers in NAT44 (and NAT444) deployments are
        usually given one IPv4 address, but may also be given several IPv4
        addresses. These addresses are not routable on the IPv4 Internet, but
        are routable between the subscriber's home and the ISP's large scale
        NAT (LSN). To accommodate multiple hosts within a home, especially
        when provided insufficient IPv4 addresses for the number of devices in
        the home, subscribers operate a NAPT device. When this occurs in
        conjunction with an upstream NAT44, this is nicknamed "NAT444".</p>
<blockquote class="text">
<p>[Ed. Note: Does PCP need a mechanism to detect a
            non-PCP-supporting NAT between a PCP client and a PCP
            server? Or can that problem be detected by relying on the
            failure of PCP Server Discovery?  This is tracked as PCP
            Issue #25 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
IPv6 Firewall</h3>

<p>See <a class='info' href='#remote_peer_filter'>Section&nbsp;7.5.1<span> (</span><span class='info'>REMOTE_PEER_FILTER</span><span>)</span></a>.</p>
<blockquote class="text">
<p>[Ed. Note: this IPv6 firewall section needs more text.
This is tracked as PCP Issue
#10 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<a name="upnp-interworking"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Interworking with UPnP IGD 1.0 and 2.0</h3>

<p></p>
<blockquote class="text">
<p>[Ed. Note: This UPnP IGD Interworking section will likely be
          moved to a separate document which will fully describe how a proxy
          needs to translate UPnP IGD messages into PCP messages.  This
is tracked as PCP Issue #28 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<p>The following diagram shows how UPnP IGD can be interworked with PCP,
      using an interworking function (IWF).
</p><br /><hr class="insert" />
<a name="igd-interworking-function"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

+-------------+
| IGD Control |
|   Point     |-----+
+-------------+     |   +---------+       +--------+
                    +---| IGD-PCP |       |  PCP   |
                        |   IWF   +-------+ Server |--&lt;Internet&gt;
                    +---|         |       |        |
+-------------+     |   +---------+       +--------+
| Local Host  |-----+
+-------------+              |                  |
                             |                  |
               LAN Side      |     WAN side     |
&lt;======UPnP IGD=============&gt;|&lt;========PCP=====&gt;|
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: Network Diagram, Interworking UPnP IGD and PCP&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
UPnP IGD 1.0 with AddPortMapping Action</h3>

<p>In <a class='info' href='#IGD'>UPnP IGD 1.0<span> (</span><span class='info'>UPnP Gateway Committee, &ldquo;WANIPConnection:1,&rdquo; November&nbsp;2001.</span><span>)</span></a> [IGD] it is only possible to
        request a specific port using the AddPortMapping action. Requiring a
        specific port is incompatible with both (1) a large-scale NAT and with
        (2) widely-deployed applications. Regarding (1), another subscriber is
        likely to already be using the same port, so it will be unavailable to
        this application to operate a server. Regarding (2), if the same
        popular application exists on two devices behind the same NAPT, they
        cannot both get the same port. PCP cannot correct this behavior of
        UPnP IGD:1, but PCP does work with this behavior.
</p>
<p>Due to this incompatibility with large-scale address sharing and
        popular applications, future hosts and applications will either
        support UPnP IGD 2.0's AddAnyPort method (see <a class='info' href='#upnp-2-interworking'>Section&nbsp;9.2<span> (</span><span class='info'>UPnP IGD 2.0 with AddAnyPortMapping Action</span><span>)</span></a>) or will support PCP.
</p>
<p>When a requested port assignment fails, most UPnP IGD control
        points will retry the port assignment requesting the next higher port
        or requesting a random port. These UPnP IGD requests are translated to
        PCP requests and sent to the PCP server. The requests include the
        HONOR_EXTERNAL_PORT option, which causes the PCP server to return an
        error if it cannot allocate the requested port. The interworking
        function translates the PCP error response to a UPnP IGD error
        response. This repeats until the UPnP IGD client gives up or until the
        PCP server is able to return the requested port.
</p><br /><hr class="insert" />
<a name="message-flow-upnp-1"></a>

<p style='text-align: left'>Message flow would be similar to this:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
UPnP Control Point             in-home CPE                 PCP server
      |                            |                           |
      |-UPnP:AddPortMapping(80)---&gt;|                           |
      |                            |-PCP:request port 80------&gt;|
      |                            | HONOR_EXTERNAL_PORT       |
      |                            |                           |
      |                            |&lt;-PCP:error----------------|
      |&lt;-UPnP: unavailable---------|                           |
      |                            |                           |
      |-UPnP:AddPortMapping(3213)-&gt;|                           |
      |                            |-PCP:request port 3213----&gt;|
      |                            | HONOR_EXTERNAL_PORT       |
      |                            |                           |
      |                            |&lt;-PCP:error----------------|
      |&lt;-UPnP: unavailable---------|                           |
      |                            |                           |
     ...         ...              ...                         ...
      |                            |                           |
      |-UPnP:AddPortMapping(8921)-&gt;|                           |
      |                            |-PCP:request port 8921----&gt;|
      |                            | HONOR_EXTERNAL_PORT       |
      |                            |                           |
      |                            |&lt;-PCP:ok, port 8921--------|
      |&lt;-UPnP: ok, port 8921-------|                           |
      |                            |                           |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Message Flow: Interworking from UPnP IGD 1.0 AddPortMapping action to PCP&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="upnp-2-interworking"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
UPnP IGD 2.0 with AddAnyPortMapping Action</h3>

<p>If the UPnP IGD control point and the UPnP IGD interworking
        function both implement <a class='info' href='#IGD-2'>UPnP IGD 2.0<span> (</span><span class='info'>UPnP Gateway Committee, &ldquo;Internet Gateway Device (IGD) V 2.0,&rdquo; September&nbsp;2010.</span><span>)</span></a> [IGD&#8209;2] and
        the UPnP IGD control point uses IGD 2's new AddAnyPortMapping action,
        only one round-trip is necessary. This is because AddAnyPortMapping
        has semantics similar to PCP's semantics, allowing the PCP server to
        assign any port.
</p><br /><hr class="insert" />
<a name="message-flow-upnp-2"></a>

<p style='text-align: left'>Message flow would be similar to this:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
UPnP Control Point           in-home CPE                 PCP server
      |                           |                          |
      |-UPnP:AddAnyPortMapping()-&gt;|                          |
      |                           |-PCP:external port 0-----&gt;|
      |                           |&lt;-PCP:external port=12345-|
      |&lt;-UPnP:port=12345----------|                          |
      |                           |                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Message Flow: Interworking from UPnP IGD 2.0 AddAnyPortMapping action to PCP&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Lifetime Maintenance</h3>

<p>Neither UPnP IGD 1.0 nor 2.0 provide a lifetime. Thus, the UPnP
        IGD/PCP interworking function is responsible for extending the
        lifetime of mappings that are still interesting to the UPnP IGD
        control point.
</p>
<p></p>
<blockquote class="text">
<p>Note: It can be an implementation advantage, where possible,
            for the UPnP IGD/PCP interworking function to request a port
            mapping lifetime only while that client is active and connected.
            For example, creating a PCP mapping that is equal to the client's
            remaining DHCP lifetime is one useful approach. The UPnP IGD/PCP
            interworking function is responsible for renewing the PCP lifetime
            as necessary. For clients not using DHCP, other mechanisms to
            check on the client host's liveliness can also be useful (e.g.,
            ping, ARP, or WiFi association) can be used to discern liveliness
            of the UPnP IGD control point. However, it is NOT RECOMMENDED to
            attempt to connect to the TCP or UDP port opened on the control
            point to determine if the host still wants to receive packets, as
            the server could be temporarily down when tested, causing a false
            negative.
</p>
</blockquote>

<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>IANA is requested to perform the following actions:
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
PCP Server IP address</h3>

<p>IANA shall assign an IPv4 and an IPv6 address for PCP
        discovery.
</p>
<p>[Ed. Note: perhaps we can use the AFTR element's IPv4 address? But
        still need an IPv6 address assigned for PIN64 and PIN66.  This is
tracked as PCP Issue #8 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
<a name="iana_port"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Port Number</h3>

<p>Need a UDP port allocated.
</p>
<a name="iana_opcodes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
OpCodes</h3>

<p>IANA shall create a new protocol registry for PCP OpCodes,
        initially populated with the values in <a class='info' href='#opcodes'>Figure&nbsp;7<span> (</span><span class='info'>OpCodes</span><span>)</span></a>.
</p>
<p>New OpCodes can be created via <a class='info' href='#RFC5226'>Standards
        Action<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
</p>
<a name="iana_result_codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.4"></a><h3>11.4.&nbsp;
Result Codes</h3>

<p>IANA shall create a new registry for PCP result codes, numbered
        0-255, initially populated with the result codes from both <a class='info' href='#figure_result_codes'>Figure&nbsp;6<span> (</span><span class='info'>PCP Result Codes</span><span>)</span></a> and <a class='info' href='#figure_pin_result_codes'>Figure&nbsp;10<span> (</span><span class='info'>Result Codes specific to PIN OpCodes</span><span>)</span></a>.
</p>
<p>New Result Codes can be created via <a class='info' href='#RFC5226'>Specification Required<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
</p>
<a name="iana_ie"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.5"></a><h3>11.5.&nbsp;
Options</h3>

<p>IANA shall create a new registry for PCP Options, numbered 0-255
        with an associated mnemonic. The values 0-127 are optional-to-process,
        and 128-255 are mandatory-to-process. The initial registry contains
        the options described in <a class='info' href='#pin_options'>Section&nbsp;7.5<span> (</span><span class='info'>PCP Options for PIN OpCodes</span><span>)</span></a>.
</p>
<p>New information elements in the range 0-64 and 128-192 can be
        created via <a class='info' href='#RFC5226'>Standards Action<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226], and the
        range 64-127 and 192-255 is for <a class='info' href='#RFC5226'>Private
        Use<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a> [RFC5226].
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Authors</h3>

<p>The following individuals contributed substantial text to
        this document and are listed in alphabetical order:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>   Mohamed Boucadair
   France Telecom
   Email: mohamed.boucadair@orange-ftgroup.com

   Stuart Cheshire
   Apple Inc.
   1 Infinite Loop
   Cupertino, California 95014  USA
   Phone: +1 408 974 3207
   EMail: cheshire@apple.com

   Francis Dupont
   ISC
   Email: Francis.Dupont@fdupont.fr

   Reinaldo Penno
   Juniper Networks
   Email: rpenno@juniper.net

</pre></div>
<p>
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Acknowledgments</h3>

<p>Thanks to Alain Durand, Christian Jacquenet, and Simon Perreault for
      their comments and review. Thanks to Simon Perreault for highlighting
      the interaction of dynamic connections with PCP-created pinholes.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a></td>
<td class="author-text">Li, X., Bao, C., and F. Baker, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-23.txt">IP/ICMP Translation Algorithm</a>,&rdquo; draft-ietf-behave-v6v4-xlate-23 (work in progress), September&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-23.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a></td>
<td class="author-text">Bagnulo, M., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-12.txt">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>,&rdquo; draft-ietf-behave-v6v4-xlate-stateful-12 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-v6v4-xlate-stateful-12.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-softwire-dual-stack-lite">[I-D.ietf-softwire-dual-stack-lite]</a></td>
<td class="author-text">Durand, A., Droms, R., Woodyatt, J., and Y. Lee, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-06.txt">Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion</a>,&rdquo; draft-ietf-softwire-dual-stack-lite-06 (work in progress), August&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-port-randomization">[I-D.ietf-tsvwg-port-randomization]</a></td>
<td class="author-text">Larsen, M. and F. Gont, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-port-randomization-09.txt">Transport Protocol Port Randomization Recommendations</a>,&rdquo; draft-ietf-tsvwg-port-randomization-09 (work in progress), August&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-port-randomization-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4193">[RFC4193]</a></td>
<td class="author-text">Hinden, R. and B. Haberman, &ldquo;<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>,&rdquo; RFC&nbsp;4193, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4193.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6052">[RFC6052]</a></td>
<td class="author-text">Bao, C., Huitema, C., Bagnulo, M., Boucadair, M., and X. Li, &ldquo;<a href="http://tools.ietf.org/html/rfc6052">IPv6 Addressing of IPv4/IPv6 Translators</a>,&rdquo; RFC&nbsp;6052, October&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc6052.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="proto_numbers">[proto_numbers]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://www.iana.org/assignments/protocol-numbers/protocol-numbers.xml">Protocol Numbers</a>,&rdquo; 2010.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.arkko-dual-stack-extra-lite">[I-D.arkko-dual-stack-extra-lite]</a></td>
<td class="author-text">Arkko, J. and L. Eggert, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-arkko-dual-stack-extra-lite-03.txt">Scalable Operation of Address Translators with Per-Interface Bindings</a>,&rdquo; draft-arkko-dual-stack-extra-lite-03 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-arkko-dual-stack-extra-lite-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-lsn-requirements">[I-D.ietf-behave-lsn-requirements]</a></td>
<td class="author-text">Yamagata, I., Miyakawa, S., Nakagawa, A., and H. Ashida, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-lsn-requirements-00.txt">Common requirements for IP address sharing schemes</a>,&rdquo; draft-ietf-behave-lsn-requirements-00 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-lsn-requirements-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-v6ops-cpe-simple-security">[I-D.ietf-v6ops-cpe-simple-security]</a></td>
<td class="author-text">Woodyatt, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-v6ops-cpe-simple-security-16.txt">Recommended Simple Security Capabilities in Customer Premises Equipment for Providing Residential IPv6 Internet Service</a>,&rdquo; draft-ietf-v6ops-cpe-simple-security-16 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-v6ops-cpe-simple-security-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.miles-behave-l2nat">[I-D.miles-behave-l2nat]</a></td>
<td class="author-text">Miles, D. and M. Townsley, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-miles-behave-l2nat-00.txt">Layer2-Aware NAT</a>,&rdquo; draft-miles-behave-l2nat-00 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-miles-behave-l2nat-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IGD">[IGD]</a></td>
<td class="author-text">UPnP Gateway Committee, &ldquo;<a href="http://upnp.org/specs/gw/UPnP-gw-WANIPConnection-v1-Service.pdf">WANIPConnection:1</a>,&rdquo; November&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="IGD-2">[IGD-2]</a></td>
<td class="author-text">UPnP Gateway Committee, &ldquo;<a href="http://upnp.org/specs/gw/igd2">Internet Gateway Device (IGD) V 2.0</a>,&rdquo; September&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="PCP-Issues">[PCP-Issues]</a></td>
<td class="author-text">PCP Working Group, &ldquo;<a href="http://trac.tools.ietf.org/wg/pcp/trac/report/1">PCP Active Tickets</a>,&rdquo; January&nbsp;2011.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2608">[RFC2608]</a></td>
<td class="author-text"><a href="mailto:Erik.Guttman@sun.com">Guttman, E.</a>, <a href="mailto:cperkins@sun.com">Perkins, C.</a>, <a href="mailto:veizades@home.net">Veizades, J.</a>, and <a href="mailto:mday@vinca.com">M. Day</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2608">Service Location Protocol, Version 2</a>,&rdquo; RFC&nbsp;2608, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2608.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3424">[RFC3424]</a></td>
<td class="author-text">Daigle, L. and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc3424">IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation</a>,&rdquo; RFC&nbsp;3424, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
</table>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Changes</h3>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Changes from draft-ietf-pcp-base-01 to -02</h3>

<p></p>
<ul class="text">
<li>more error codes
</li>
<li>PCP client source port number should be random
</li>
<li>PCP message minimum 8 octets, maximum 1024 octets.
</li>
<li>tweaked a lot of text in section 7.4, "Opcode-Specific Server
            Operation".
</li>
<li>opening a pinhole also allows ICMP messages associated with
            that pinhole.
</li>
<li>HONOR_EXTERNAL_PORT value changed to the mandatory-to-process
            range.
</li>
<li>added text recommending applications that are crashing obtain
            short lifetimes, to avoid consuming subscriber's port quota.
</li>
</ul>

<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Changes from draft-ietf-pcp-base-00 to -01</h3>

<p></p>
<ul class="text">
<li>Significant document reorganization, primarily to split base
            PCP operation from OpCode operation.
</li>
<li>packet format changed to move 'protocol' outside of PCP common
            header and into the PIN* opcodes
</li>
<li>Renamed Informational Elements (IE) to Options.
</li>
<li>Added REMOTE_PEER (for disambiguation with dynamic ports),
            REMOTE_PEER_FILTER (for simple packet filtering), and
            HONOR_EXTERNAL_PORT (to optimize UPnP IGD interworking)
            options.
</li>
<li>Is NAT or router behind B4 in scope?
</li>
<li>PCP option MAY be included in a request, in which case it MUST
            appear in a response. It MUST NOT appear in a response if it
            wasn't in the request.
</li>
<li>Response code most significant bit now indicates
            permanent/temporary error
</li>
<li>PCP Options are split into mandatory-to-process ("P" bit), and
            into Specification Required and Private Use.
</li>
<li>Epoch discussion simplified.
</li>
</ul>

<a name="discovery_analysis"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Analysis of Techniques to Discover PCP Server</h3>

<p></p>
<blockquote class="text">
<p>[Ed. Note: This Appendix will be removed in a later version of
          this document. It is included here for reference and discussion
          purposes.  This is tracked as PCP Issue #8 <a class='info' href='#PCP-Issues'>[PCP&#8209;Issues]<span> (</span><span class='info'>PCP Working Group, &ldquo;PCP Active Tickets,&rdquo; January&nbsp;2011.</span><span>)</span></a>.]
</p>
</blockquote>

<p></p>
<blockquote class="text">
<p>Discussion Note: A deployment model is a non-PCP aware
          NAT in a home, and a PCP-aware large scale NAT (LSN)
          operated by the ISP.  For example, the home users purchased
          a NAT last year at a computer shop (to extend their home's
          WiFi network).  This could work by having the host use UPnP
          IGD with the in-home NAT, and the host use PCP with the
          LSN. But this deployment model is impossible with several of
          the mechanisms below. Is this deployment model important, or
          can we wait for PCP to be enabled on CPE?
</p>
</blockquote>

<p>Several mechanisms for discovering the PCP Server can be envisaged as
      listed below:
</p>
<p></p>
<ol class="text">
<li>A special-purpose IPv4 or IPv6 address, assigned by IANA, which
          is routed normally until it hits a PCP Server, which responds. 
<blockquote class="text">
<p>Analysis: This solution can be deployed in the context of
              DS-Lite architecture. Concretely, a well-known IPv4 address can
              be used to reach a PCP Server embedded in the device that embeds
              the AFTR capabilities. Since all IPv4 messages issued by a
              DS-Lite CP router will be encapsulated in IPv6, no state
              synchronisation issues will be experienced because PCP messages
              will be handled by the appropriate PCP Server.
</p>
<p>In some deployment scenarios (e.g., deployment of several
              stateful NAT64/NAT46 in the same domain), the use of this
              address is not recommended since PCP messages, issued by a given
              host, may be handled by a PCP Server embedded in a NAT node
              which is not involved to handle IP packets issued from that
              host. The use of this special-purpose IP address may induce
              session failures and therefore the customer may experience
              troubles when accessing its services.
</p>
<p>Consequently, the use of a special-purpose IPv4 address is
              suitable for DS-Lite NAT44. As for NAT46/NAT64, this is left to
              the Service Providers according to their deployment
              configuration.
</p>
<p>The special-use address MUST NOT be advertised in the global
              routing table. Packets with that destination address SHOULD be
              filtered so they are not transmitted on the Internet.
</p>
</blockquote>
</li>
<li>Assume the default router is a PCP Server, and send PCP packets
          to the IP address of the default router. 
<blockquote class="text">
<p>Analysis: This solution is not suitable for DS-Lite NAT44 nor
              for all variants of NAT64/NAT46. </p>
<blockquote class="text">
<p>In the context of DS-Lite: There is no default IPv4
                  router configured in the CP router. All outgoing IPv4
                  traffic is encapsulated in IPv6 and then forwarded to a
                  pre-configured DS-Lite AFTR device. Furthermore, if IPv6 is
                  used to reach the PCP Server, the first router may not be
                  the one which embeds the AFTR.
</p>
<p>For NAT64/NAT46 scenarios: The NAT function is not
                  embedded in the first router, therefore this solution
                  candidate does not allow to discover a valid PCP Server.
</p>
</blockquote>

<p>Therefore, this alternative is not recommended.
</p>
</blockquote>
</li>
<li>Service Location Protocol (<a class='info' href='#RFC2608'>SLP<span> (</span><span class='info'>Guttman, E., Perkins, C., Veizades, J., and M. Day, &ldquo;Service Location Protocol, Version 2,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2608]).
<blockquote class="text">
<p>Analysis: This solution is not suitable in scenarios where
              multicast is not enabled. SLP is a chatty protocol. This
              alternative is not recommended.
</p>
</blockquote>
</li>
<li>NAPTR. The host would issue a DNS query for a NAPTR record,
          formed from some bits of the host's IPv4 or IPv6 address. For
          example, a host with the IPv6 address 2001:db8:1:2:3:4:567:89ab
          would first send an NAPTR query for
          3.0.0.0.2.0.0.0.1.0.0.0.8.b.d.0.1.0.0.2.IP6.ARPA (20 elements,
          representing a /64 network prefix), which returns the PCP Server's
          IPv6 address. A similar scheme can be used with IPv4 using, for
          example, the first 24 bits of the IPv4 address.
<blockquote class="text">
<p>Analysis: This solution candidate requires more configuration
              effort by the Service Provider so as to redirect a given client
              to the appropriate PCP Server. Any change of the engineering
              policies (e.g., introduce new LSN device, load-based
              dimensioning, load-balancing, etc.) would require to update the
              zone configuration. This would be a hurdle for the flexibility
              of the operational networks. Adherence to DNS is not encouraged
              and means which allows for more flexibility are to be
              promoted.
</p>
<p>Therefore, this mechanism is not recommended.
</p>
</blockquote>
</li>
<li>New DHCPv6/DHCP option and/or a RA option to convey an FQDN of a
          PCP Server.
<blockquote class="text">
<p>Analysis: Since DS-Lite and NAT64/NAT46 are likely to be
              deployed in provider-provisioned environments, DHCP (both DHCPv6
              and IPv4 DHCP) is convenient to provision the address/FQDN of
              the PCP Server.
</p>
</blockquote>
</li>
</ol>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dan Wing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, California  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dwing@cisco.com">dwing@cisco.com</a></td></tr>
</table>
</body></html>
