<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The WebSocket Protocol as a Transport for the Session Initiation Protocol (SIP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 The WebSocket Protocol">
<link href="#rfc.section.4" rel="Chapter" title="4 The WebSocket SIP Sub-Protocol">
<link href="#rfc.section.5" rel="Chapter" title="5 SIP WebSocket Transport">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Via Transport Parameter">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 SIP URI Transport Parameter">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Sending Responses">
<link href="#rfc.section.6" rel="Chapter" title="6 Outbound and GRUU Usage">
<link href="#rfc.section.7" rel="Chapter" title="7 Locating a SIP Server">
<link href="#rfc.section.8" rel="Chapter" title="8 WebSocket Client Usage">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 WebSocket Disconnection">
<link href="#rfc.section.9" rel="Chapter" title="9 WebSocket Server Usage">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 SIP Proxy Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Connection Keep Alive">
<link href="#rfc.section.11" rel="Chapter" title="11 Authentication">
<link href="#rfc.section.12" rel="Chapter" title="12 Examples">
<link href="#rfc.section.12.1" rel="Chapter" title="12.1 Registration">
<link href="#rfc.section.12.2" rel="Chapter" title="12.2 INVITE dialog through a proxy">
<link href="#rfc.section.13" rel="Chapter" title="13 Security Considerations">
<link href="#rfc.section.13.1" rel="Chapter" title="13.1 Secure WebSocket Connection">
<link href="#rfc.section.13.2" rel="Chapter" title="13.2 WebSocket Topology Hiding">
<link href="#rfc.section.14" rel="Chapter" title="14 IANA Considerations">
<link href="#rfc.section.14.1" rel="Chapter" title="14.1 Registration of the WebSocket SIP Sub-Protocol">
<link href="#rfc.section.14.2" rel="Chapter" title="14.2 Registration of new Via transports">
<link href="#rfc.section.14.3" rel="Chapter" title="14.3 Registration of new SIP URI transport">
<link href="#rfc.section.14.4" rel="Chapter" title="14.4 Registration of new NAPTR service field values">
<link href="#rfc.section.15" rel="Chapter" title="15 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.references.1" rel="Chapter" title="16.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="16.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <meta name="viewport" content="width=600;" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies a WebSocket Sub-Protocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients and servers." />
  <meta name="description" content="This document specifies a WebSocket Sub-Protocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients and servers." />
  <meta name="keywords" content="SIP, WebSocket" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">SIPCORE Working Group</td>
<td class="right">I.B.C. Baz Castillo</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">J.L.M. Luis Millan</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">XtraTelecom S.A.</td>
</tr>
<tr>
<td class="left">Expires: May 27, 2012</td>
<td class="right">V.P. Pascual</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Acme Packet</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">November 24, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The WebSocket Protocol as a Transport for the Session Initiation Protocol (SIP)<br />
  <span class="filename">draft-ibc-sipcore-sip-websocket-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies a WebSocket Sub-Protocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients and servers.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 27, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">The WebSocket Protocol</a>
</li>
<li>4.   <a href="#rfc.section.4">The WebSocket SIP Sub-Protocol</a>
</li>
<li>5.   <a href="#rfc.section.5">SIP WebSocket Transport</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Via Transport Parameter</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">SIP URI Transport Parameter</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Sending Responses</a>
</li>
<li>6.   <a href="#rfc.section.6">Outbound and GRUU Usage</a>
</li>
<li>7.   <a href="#rfc.section.7">Locating a SIP Server</a>
</li>
<li>8.   <a href="#rfc.section.8">WebSocket Client Usage</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">WebSocket Disconnection</a>
</li>
<li>9.   <a href="#rfc.section.9">WebSocket Server Usage</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">SIP Proxy Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Connection Keep Alive</a>
</li>
<li>11.   <a href="#rfc.section.11">Authentication</a>
</li>
<li>12.   <a href="#rfc.section.12">Examples</a>
</li>
<li>12.1.   <a href="#rfc.section.12.1">Registration</a>
</li>
<li>12.2.   <a href="#rfc.section.12.2">INVITE dialog through a proxy</a>
</li>
<li>13.   <a href="#rfc.section.13">Security Considerations</a>
</li>
<li>13.1.   <a href="#rfc.section.13.1">Secure WebSocket Connection</a>
</li>
<li>13.2.   <a href="#rfc.section.13.2">WebSocket Topology Hiding</a>
</li>
<li>14.   <a href="#rfc.section.14">IANA Considerations</a>
</li>
<li>14.1.   <a href="#rfc.section.14.1">Registration of the WebSocket SIP Sub-Protocol</a>
</li>
<li>14.2.   <a href="#rfc.section.14.2">Registration of new Via transports</a>
</li>
<li>14.3.   <a href="#rfc.section.14.3">Registration of new SIP URI transport</a>
</li>
<li>14.4.   <a href="#rfc.section.14.4">Registration of new NAPTR service field values</a>
</li>
<li>15.   <a href="#rfc.section.15">Acknowledgements</a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<li>16.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>16.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">This specification defines a new WebSocket Sub-Protocol for transporting SIP messages between a WebSocket client and server, a new transport for the SIP protocol and procedures for SIP servers when bridging WebSocket and other SIP transports.</p>
<p id="rfc.section.1.p.2">This specification is focused on integrating the SIP protocol within client applications running a WebSocket stack. Other aspects such as the usage of WebSocket as a transport between SIP servers are not fully covered by this specification.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#the_websocket_protocol" id="the_websocket_protocol">The WebSocket Protocol</a>
</h1>
<p id="rfc.section.3.p.1">WebSocket protocol <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> is a transport layer on top of TCP in which both client and server exchange message units in both directions. The protocol defines a connection handshake, WebSocket Sub-Protocol and extensions negotiation, a frame format for sending application and control data, a masking mechanism, and status codes for indicating disconnection causes.</p>
<p id="rfc.section.3.p.2">The WebSocket connection handshake is based on HTTP <a href="#RFC2616">[RFC2616]</a> protocol by means of a specific HTTP GET request sent by the client, typically a web browser, which is answered by the server (if the negotiation succeeded) with HTTP 101 status code. This handshake procedure is designed to reuse the existing HTTP infrastructure. During the connection handshake, client and server agree in the application protocol to use on top of the WebSocket transport. Such application protocol (also known as the "WebSocket Sub-Protocol") defines the format and semantics of the messages exchanged between both endpoints. The WebSocket Sub-Protocol to be used is up to the application developer. It may be a custom protocol or a standarized one (as the WebSocket SIP Sub-Protocol proposed in this document). Once the HTTP 101 response is processed both client and server reuse the existing TCP connection for sending application messages and control frames to each other in a persistent way.</p>
<p id="rfc.section.3.p.3">WebSocket defines message units as application data exchange for communication endpoints, becoming a message boundary transport layer. These messages can contain UTF-8 text or binary data, and can be splitted into various WebSocket text/binary frames. However, the <a href="#WS-API">WebSocket API</a> <cite title="NONE">[WS-API]</cite> for web browsers just includes JavaScript callbacks that are invoked upon receipt of an entire message, regardless it has been received in a single or multiple WebSocket frames.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#the_websocket_sip_subprotocol" id="the_websocket_sip_subprotocol">The WebSocket SIP Sub-Protocol</a>
</h1>
<p id="rfc.section.4.p.1">The term WebSocket Sub-Protocol refers to the application-level protocol layered over a WebSocket connection. This document specifies the WebSocket SIP Sub-Protocol for carrying SIP requests and responses through a WebSocket connection.</p>
<p id="rfc.section.4.p.2">The WebSocket client and server need to agree on this protocol during the WebSocket handshake procedure as defined in section 1.3 of <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a>. The client MUST include the value "sip" in the Sec-WebSocket-Protocol header in its handshake request. The 101 reply from the WebSocket server MUST contain "sip" in its own Sec-WebSocket-Protocol header.</p>
<div id="#rfc.figure.1"></div>
<pre>
  GET / HTTP/1.1
  Host: sip-ws.example.com
  Upgrade: websocket
  Connection: Upgrade
  Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
  Origin: http://www.example.com
  Sec-WebSocket-Protocol: sip
  Sec-WebSocket-Version: 13
</pre>
<p id="rfc.section.4.p.3">Below is an example of the WebSocket handshake in which the client requests SIP Sub-Protocol support from the server:</p>
<div id="#rfc.figure.2"></div>
<pre>
  HTTP/1.1 101 Switching Protocols
  Upgrade: websocket
  Connection: Upgrade
  Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
  Sec-WebSocket-Protocol: sip
</pre>
<p id="rfc.section.4.p.4">The handshake response from the server supporting the WebSocket SIP Sub-Protocol would look like:</p>
<p id="rfc.section.4.p.5">Once the negotiation is done, the WebSocket connection is established with SIP as the WebSocket Sub-Protocol. The WebSocket messages to be transmitted over this connection MUST conform to the established signaling protocol.</p>
<p id="rfc.section.4.p.6">WebSocket messages are carried on top of WebSocket UTF-8 text frames or binary frames. SIP protocol <a href="#RFC3261">[RFC3261]</a> allows both text and binary bodies in SIP messages. Therefore a client and server implementing the WebSocket SIP Sub-Protocol MUST accept both WebSocket text and binary frames.</p>
<p id="rfc.section.4.p.7">Each SIP message MUST be carried within a single WebSocket message and MUST be a complete SIP message, so a Content-Length header field is not mandatory. Sending more than one SIP message within a single WebSocket message is not allowed, neither sending an incomplete SIP message.  </p>

<ul class="empty"><li>This makes parsing of SIP messages easier on client side (typically web-based applications with an strict and simple API for receiving WebSocket messages). There is no need to establish boundaries (using Content-Length headers) between different messages. Same advantage is present in other message-based SIP transports as UDP or <a href="#RFC4168">SCTP</a> <cite title="NONE">[RFC4168]</cite>.</li></ul>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#sip_websocket_transport" id="sip_websocket_transport">SIP WebSocket Transport</a>
</h1>
<p id="rfc.section.5.p.1">WebSocket <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> is a reliable protocol and therefore the WebSocket sub-protocol for a SIP transport defined by this document is also a reliable transport. Thus, client and server transactions using WebSocket transport MUST follow the procedures and timer values for reliable transports as defined in <a href="#RFC3261">[RFC3261]</a>.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#via_transport_parameter" id="via_transport_parameter">Via Transport Parameter</a>
</h1>
<p id="rfc.section.5.1.p.1">Via header fields carry the transport protocol identifier. This document defines the value "WS" to be used for requests over plain WebSocket protocol and "WSS" for requests over secure WebSocket protocol (in which the WebSocket connection is established on top of TLS <a href="#RFC5246">[RFC5246]</a> over TCP transport).</p>
<div id="#rfc.figure.3"></div>
<pre>
  transport  =  "UDP" / "TCP" / "TLS" / "SCTP" / "WS" / "WSS"
                / other-transport
</pre>
<p id="rfc.section.5.1.p.2">The updated augmented BNF (Backus-Naur Form) <a href="#RFC5234">[RFC5234]</a> for this parameter is the following:</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#sip_uri_transport_parameter" id="sip_uri_transport_parameter">SIP URI Transport Parameter</a>
</h1>
<p id="rfc.section.5.2.p.1">This document defines the value "ws" as the transport parameter value for a SIP URI <a href="#RFC3986">[RFC3986]</a> to be contacted using WebSocket protocol as transport.</p>
<div id="#rfc.figure.4"></div>
<pre>
  transport-param  =  "transport="
                      ( "udp" / "tcp" / "sctp" / "tls" / "sctp"
                      / "ws"
                      / other-transport )
</pre>
<p id="rfc.section.5.2.p.2">The updated augmented BNF (Backus-Naur Form) <a href="#RFC5234">[RFC5234]</a> for this parameter is the following:</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#sending_responses" id="sending_responses">Sending Responses</a>
</h1>
<p id="rfc.section.5.3.p.1">The SIP server transport uses the value of the top Via header field in order to determine where to send a response. If the "sent-protocol" is "WS" or "WSS" the response MUST be sent using the existing WebSocket connection to the source of the original request, if that connection is still open. This requires the server transport to maintain an association between server transactions and transport connections. If that connection is no longer open, the server MUST NOT attempt to open a WebSocket connection to the Via "sent-by"/"received"/"rport".  </p>

<ul class="empty"><li>This is due to the nature of the WebSocket protocol in which just the WebSocket client can establish a connection with the WebSocket server. A WebSocket client does not listen for incoming connections.</li></ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#outbound_and_gruu_usage" id="outbound_and_gruu_usage">Outbound and GRUU Usage</a>
</h1>
<p id="rfc.section.6.p.1">WebSocket requires the client to open a TCP connection with the server and perform the WebSocket handshake. A WebSocket client does not listen for incoming connections so it can only receive SIP requests from the WebSocket server it is connected to. WebSocket clients may use either public or private addressing but it is expected that many of them will run the latter. Unfortunately, some implementations may not have the ability to discover the local transport address which the WebSocket connection is originated from (e.g. a JavaScript stack within a web browser).</p>
<p id="rfc.section.6.p.2">Therefore clients and servers implementing SIP over the WebSocket transport MUST implement the Outbound mechanism <a href="#RFC5626">[RFC5626]</a>, being this the most suitable solution for SIP clients behind Network Address Translation (NAT) using reliable transports for contacting SIP servers.</p>
<p id="rfc.section.6.p.3">A client implementing SIP over the WebSocket transport SHOULD also implement GRUU <a href="#RFC5627">[RFC5627]</a>. The registrar responsible for the registration of SIP clients using the WebSocket transport SHOULD implement GRUU as well.  </p>

<ul class="empty"><li>If a REFER request is sent to a SIP User Agent indicating the Contact URI of a WebSocket client as the target in the Refer-To header field, such a URI will be reachable by the SIP UA just in the case it is a globally routable URI obtained from a SIP registrar implementing GRUU.</li></ul>

<p> </p>
<p id="rfc.section.6.p.4">Both Outbound and GRUU require the client to indicate a Uniform Resource Name (URN) in the "+sip.instance" parameter of the Contact header during the registration. The client device is responsible for getting such a constant and unique value.  </p>

<ul class="empty"><li>In the case of web browsers it is hard to get a URN value from the browser itself. This specification suggests that value is generated according to <a href="#RFC5626">[RFC5626]</a> section 4.1 by the web application running in the browser the first time it loads the web page, and then it is stored as a Cookie <a href="#RFC6265">[RFC6265]</a> within the browser data and loaded every time the same web page is visited. The application developer could choose any other mechanism which accomplishes the requirements of a URN.</li></ul>

<p> </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#locating_a_sip_server" id="locating_a_sip_server">Locating a SIP Server</a>
</h1>
<p id="rfc.section.7.p.1">SIP entities follow normal SIP procedures in <a href="#RFC3263">[RFC3263]</a> to discover a SIP server. This specification defines the NAPTR service value "SIP+D2W" for servers that support plain WebSocket transport and "SIPS+D2W" for servers that support secure WebSocket transport.</p>
<p id="rfc.section.7.p.2">A SIP entity using the WebSocket transport SHOULD perform procedures in <a href="#RFC3263">[RFC3263]</a> for the given WebSocket URI it will connect to. If the WebSocket URI has "wss" schema the SIP entity MUST only consider "SIPS+D2W" resource records. If the WebSocket URI does not contain a domain in the host part or does include a port, the SIP entity MUST follow procedures in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> section 3 instead.  </p>

<ul class="empty"><li>Unfortunately the JavaScript stack running in web browsers cannot perform DNS NAPTR/SRV queries, neither the WebSocket stack running in web browsers can do it. Thus, a WebSocket URI given within a web application needs to have a numeric network address or a hostname with associated DNS A/AAAA resource record(s) in its host part.</li></ul>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#websocket_client_usage" id="websocket_client_usage">WebSocket Client Usage</a>
</h1>
<p id="rfc.section.8.p.1">The WebSocket connection MUST be established in order to allow the client application to send and receive SIP requests.  </p>

<ul class="empty"><li>Based on local policy, this might occur once the JavaScript SIP application has been downloaded from the web server, or when the SIP user using the web browser application registers itself to a SIP registrar (assuming that SIP requests cannot be sent or received before then).</li></ul>

<p> </p>
<p id="rfc.section.8.p.2">In case the client application decides to close the WebSocket connection (for example when performing "logout" in a web application) it is recommended to remove the existing SIP registration binding (if present) by means of a REGISTER with expiration value of 0 and the associated "+sip.instance" Contact header parameter as per <a href="#RFC5626">[RFC5626]</a>.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#websocket_disconnection" id="websocket_disconnection">WebSocket Disconnection</a>
</h1>
<p id="rfc.section.8.1.p.1">In some circumstances the WebSocket connection could be terminated by the WebSocket server (for example when the server is restarted). If the client application wants to become reachable again it SHOULD reconnect to the WebSocket server and perform a new SIP registration with same "+sip.instance" and "reg-id" Contact header parameters (as stated in <a href="#RFC5626">[RFC5626]</a>).</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#websocket_server_usage" id="websocket_server_usage">WebSocket Server Usage</a>
</h1>
<p id="rfc.section.9.p.1">How a SIP server authorizes WebSocket connection attemps from clients is out of the scope of this specification. However some informational guidelines are provided in <a href="#authentication">Section 11</a>. Once the WebSocket SIP Sub-Protocol is agreed, both client and server can send SIP messages to each other.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#sip_proxy_considerations" id="sip_proxy_considerations">SIP Proxy Considerations</a>
</h1>
<p id="rfc.section.9.1.p.1">When a SIP proxy bridges WebSocket and any other SIP transport (including WebSocket transport) it MUST perform Loose Routing as specified in <a href="#RFC3261">[RFC3261]</a>. Otherwise in-dialog requests would fail since WebSocket clients cannot contact destinations other than their WebSocket server, and non-WebSocket SIP entities cannot establish a connection to WebSocket clients. It is also recommended that SIP proxy implementations use double Record-Route techniques (as specified in <a href="#RFC5658">[RFC5658]</a>).</p>
<p id="rfc.section.9.1.p.2">In the same way, if the SIP proxy implementing the WebSocket server behaves as an outbound proxy for REGISTER requests, it MUST add a Path header field as described in <a href="#RFC3327">[RFC3327]</a>. Otherwise the WebSocket client would never receive incoming requests from the SIP registrar server after the lookup procedures in the SIP location service.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#connection_keep_alive" id="connection_keep_alive">Connection Keep Alive</a>
</h1>
<p id="rfc.section.10.p.1">It is recommended that the WebSocket client or server keeps the WebSocket connection open by sending periodic WebSocket Ping frames as described in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> section 5.5.2. The decision for a WebSocket endpoint to maintain, or not, the connection over time is out of scope of this document.</p>
<p id="rfc.section.10.p.2">The client application MAY also use Network Address Translation (NAT) keep-alive mechanisms defined for the SIP protocol, such as the CRLF Keep-Alive Technique mechanism described in <a href="#RFC5626">[RFC5626]</a> section 3.5.1. Therefore, a SIP server implementing the WebSocket transport MUST support the CRLF Keep-Alive Technique.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#authentication" id="authentication">Authentication</a>
</h1>
<p id="rfc.section.11.p.1">Prior to sending SIP requests, the WebSocket client implementing the SIP protocol connects to the WebSocket server and performs the connection handshake. As described in <a href="#the_websocket_protocol">Section 3</a> the handshake procedure involves an HTTP GET request replied with HTTP 101 status code by the server.</p>
<p id="rfc.section.11.p.2">In order to authorize the WebSocket connection the server MAY inspect the Cookie <a href="#RFC6265">[RFC6265]</a> header in the HTTP GET request (if present). In case of web applications the value of such a Cookie is typically provided by the web server once the user has authenticated itself against the web application by following any of the multiple existing mechanisms. As an alternative method, the WebSocket server could request Digest <a href="#RFC2617">[RFC2617]</a> authentication by replying a HTTP 401 status code. The WebSocket protocol <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> covers this usage in section 4.1: </p>

<ul class="empty"><li>If the status code received from the server is not 101, the client handles the response per HTTP <a href="#RFC2616">[RFC2616]</a> procedures, in particular the client might perform authentication if it receives 401 status code.</li></ul>

<p> </p>
<p id="rfc.section.11.p.3">Regardless the WebSocket server requires authentication during the WebSocket handshake or not, authentication MAY be requested at SIP protocol level. Therefore a SIP client using the WebSocket transport MUST implement Digest <a href="#RFC2617">[RFC2617]</a> authentication as stated in <a href="#RFC3261">[RFC3261]</a>.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h1 id="rfc.section.12.1">
<a href="#rfc.section.12.1">12.1.</a> <a href="#registration" id="registration">Registration</a>
</h1>
<div id="#rfc.figure.5"></div>
<pre>
Alice    (SIP WSS)    proxy.atlanta.com
|                             |
|REGISTER F1                  |
|----------------------------&gt;|
|200 OK F2                    |
|&lt;----------------------------|
|                             |
</pre>
<p></p>
<p id="rfc.section.12.1.p.2">Alice loads a web page using her web browser and retrieves a JavaScript code implementing the WebSocket SIP Sub-Protocol defined in this document. The JavaScript code obtained from the web server establishes a secure WebSocket connection with a SIP proxy/registrar at proxy.atlanta.com. Upon WebSocket connection, Alice constructs and sends a SIP REGISTER by requesting Outbound and GRUU support. Since the JavaScript stack in a browser has no way to determine the local address from which the WebSocket connection is made, this implementation uses anonymous.invalid in Via sent-by for every SIP requests and anonymous.invalid as URI hostpart in the Contact header of the initial REGISTER request.</p>
<p id="rfc.section.12.1.p.3">Message details (authentication and SDP bodies are omitted for simplicity):</p>
<div id="#rfc.figure.6"></div>
<pre>
F1 REGISTER  Alice -&gt; proxy.atlanta.com (transport WSS)

REGISTER sip:proxy.atlanta.com SIP/2.0
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bKasudf
From: sip:alice@atlanta.com;tag=65bnmj.34asd
To: sip:alice@atlanta.com
Call-ID: aiuy7k9njasd
CSeq: 1 REGISTER
Max-Forwards: 70
Supported: path, outbound, gruu
Route: &lt;sip:proxy.atlanta.com:443;transport=ws;lr&gt;
Contact: &lt;sip:alice@anonymous.invalid;transport=ws&gt;
  ;reg-id=1
  ;+sip.instance="&lt;urn:uuid:f81-7dec-14a06cf1&gt;"


F2 200 OK  proxy.atlanta.com -&gt; Alice (transport WSS)

SIP/2.0 200 OK
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bKasudf
From: sip:alice@atlanta.com;tag=65bnmj.34asd
To: sip:alice@atlanta.com;tag=12isjljn8
Call-ID: aiuy7k9njasd
CSeq: 1 REGISTER
Supported: outbound, gruu
Contact: &lt;sip:alice@anonymous.invalid;transport=ws&gt;
  ;reg-id=1
  ;+sip.instance="&lt;urn:uuid:f81-7dec-14a06cf1&gt;"
  ;pub-gruu="sip:alice@atlanta.com;gr=urn:uuid:f81-7dec-14a06cf1"
  ;temp-gruu="sip:87ash54=3dd.98a@atlanta.com;gr"
  ;expires=3600
</pre>
<p></p>
<h1 id="rfc.section.12.2">
<a href="#rfc.section.12.2">12.2.</a> <a href="#invite_dialog_through_a_proxy" id="invite_dialog_through_a_proxy">INVITE dialog through a proxy</a>
</h1>
<div id="#rfc.figure.7"></div>
<pre>
Alice    (SIP WSS)    proxy.atlanta.com    (SIP UDP)       Bob
|                             |                             |
|INVITE F1                    |                             |
|----------------------------&gt;|                             |
|100 Trying F2                |                             |
|&lt;----------------------------|                             |
|                             |INVITE F3                    |
|                             |----------------------------&gt;|
|                             |200 OK F4                    |
|                             |&lt;----------------------------|
|200 OK F5                    |                             |
|&lt;----------------------------|                             |
|                             |                             |
|ACK F6                       |                             |
|----------------------------&gt;|                             |
|                             |ACK F7                       |
|                             |----------------------------&gt;|
|                             |                             |
|                    Both Way RTP Media                     |
|&lt;=========================================================&gt;|
|                             |                             |
|                             |BYE F8                       |
|                             |&lt;----------------------------|
|BYE F9                       |                             |
|&lt;----------------------------|                             |
|200 OK F10                   |                             |
|----------------------------&gt;|                             |
|                             |200 OK F11                   |
|                             |----------------------------&gt;|
|                             |                             |
</pre>
<p></p>
<p id="rfc.section.12.2.p.2">In the same scenario Alice places a call to Bob's AoR by using the public GRUU retrieved from the registrar as Contact URI of the INVITE. The WebSocket SIP server at proxy.atlanta.com acts as a SIP proxy routing the INVITE to the UDP location of Bob, who answers the call and terminates it later.</p>
<p id="rfc.section.12.2.p.3">Message details (authentication and SDP bodies are omitted for simplicity):</p>
<div id="#rfc.figure.8"></div>
<pre>
F1 INVITE  Alice -&gt; proxy.atlanta.com (transport WSS)

INVITE sip:bob@atlanta.com SIP/2.0
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bK56sdasks
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 70
Supported: path, outbound, gruu
Route: &lt;sip:proxy.atlanta.com:443;transport=ws;lr&gt;
Contact: &lt;sip:alice@atlanta.com
 ;gr=urn:uuid:f81-7dec-14a06cf1;ob&gt;"
Content-Type: application/sdp


F2 100 Trying  proxy.atlanta.com -&gt; Alice (transport WSS)

SIP/2.0 100 Trying
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bK56sdasks
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE


F3 INVITE  proxy.atlanta.com -&gt; Bob (transport UDP)

INVITE sip:bob@203.0.113.22:5060 SIP/2.0
Via: SIP/2.0/UDP proxy.atlanta.com;branch=z9hG4bKhjhjqw32c
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:proxy.atlanta.com;transport=udp;lr&gt;,
  &lt;sip:h7kjh12s@proxy.atlanta.com:443;transport=ws;lr&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Supported: path, outbound, gruu
Contact: &lt;sip:alice@atlanta.com
  ;gr=urn:uuid:f81-7dec-14a06cf1;ob&gt;"
Content-Type: application/sdp


F4 200 OK  Bob -&gt; proxy.atlanta.com (transport UDP)

SIP/2.0 200 OK
Via: SIP/2.0/UDP proxy.atlanta.com;branch=z9hG4bKhjhjqw32c
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:proxy.atlanta.com;transport=udp;lr&gt;,
  &lt;sip:h7kjh12s@proxy.atlanta.com:443;transport=ws;lr&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sip:bob@203.0.113.22:5060;transport=udp&gt;
Content-Type: application/sdp


F5 200 OK  proxy.atlanta.com -&gt; Alice (transport WSS)

SIP/2.0 200 OK
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:proxy.atlanta.com;transport=udp;lr&gt;,
  &lt;sip:h7kjh12s@proxy.atlanta.com:443;transport=ws;lr&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sip:bob@203.0.113.22:5060;transport=udp&gt;
Content-Type: application/sdp
           

F6 ACK  Alice -&gt; proxy.atlanta.com (transport WSS)

ACK sip:bob@203.0.113.22:5060;transport=udp SIP/2.0
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bKhgqqp090
Route: &lt;sip:h7kjh12s@proxy.atlanta.com:443;transport=ws;lr&gt;,
  &lt;sip:proxy.atlanta.com;transport=udp;lr&gt;,
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 ACK
Max-Forwards: 70


F7 ACK  proxy.atlanta.com -&gt; Bob (transport UDP)

ACK sip:bob@203.0.113.22:5060;transport=udp SIP/2.0
Via: SIP/2.0/UDP proxy.atlanta.com;branch=z9hG4bKhwpoc80zzx
Via: SIP/2.0/WSS anonymous.invalid;branch=z9hG4bKhgqqp090
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:bob@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 ACK
Max-Forwards: 69


F8 BYE  Bob -&gt; proxy.atlanta.com (transport UDP)

BYE sip:alice@atlanta.com;gr=urn:uuid:f81-7dec-14a06cf1;ob SIP/2.0
Via: SIP/2.0/UDP 203.0.113.22;branch=z9hG4bKbiuiansd001
Route: &lt;sip:proxy.atlanta.com;transport=udp;lr&gt;,
  &lt;sip:h7kjh12s@proxy.atlanta.com:443;transport=ws;lr&gt;
From: sip:bob@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
Max-Forwards: 70


F9 BYE  proxy.atlanta.com -&gt; Alice (transport WSS)

BYE sip:alice@atlanta.com;gr=urn:uuid:f81-7dec-14a06cf1;ob SIP/2.0
Via: SIP/2.0/WSS proxy.atlanta.com:443;branch=z9hG4bKmma01m3r5
Via: SIP/2.0/UDP 203.0.113.22;branch=z9hG4bKbiuiansd001
From: sip:bob@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
Max-Forwards: 69


F10 200 OK  Alice -&gt; proxy.atlanta.com (transport WSS)

SIP/2.0 200 OK
Via: SIP/2.0/WSS proxy.atlanta.com:443;branch=z9hG4bKmma01m3r5
Via: SIP/2.0/UDP 203.0.113.22;branch=z9hG4bKbiuiansd001
From: sip:bob@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE


F11 200 OK  proxy.atlanta.com -&gt; Bob (transport UDP)

SIP/2.0 200 OK
Via: SIP/2.0/UDP 203.0.113.22;branch=z9hG4bKbiuiansd001
From: sip:bob@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
</pre>
<p></p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#security_considerations" id="security_considerations">Security Considerations</a>
</h1>
<h1 id="rfc.section.13.1">
<a href="#rfc.section.13.1">13.1.</a> Secure WebSocket Connection</h1>
<p id="rfc.section.13.1.p.1">It is recommended to protect the privacy of the SIP traffic through the WebSocket communication by using a secure WebSocket connection (tunneled over TLS <a href="#RFC5246">[RFC5246]</a>). For this, the client application MUST be provided with a secure "wss" WebSocket URI.</p>
<h1 id="rfc.section.13.2">
<a href="#rfc.section.13.2">13.2.</a> <a href="#websocket_topology_hiding" id="websocket_topology_hiding">WebSocket Topology Hiding</a>
</h1>
<p><a href="#RFC3261">RFC 3261</a> <cite title="NONE">[RFC3261]</cite> section 18.2.1 "Receiving Requests" states the following: </p>

<ul class="empty"><li>When the server transport receives a request over any transport, it MUST examine the value of the "sent-by" parameter in the top Via header field value.  If the host portion of the "sent-by" parameter contains a domain name, or if it contains an IP address that differs from the packet source address, the server MUST add a "received" parameter to that Via header field value.  This parameter MUST contain the source address from which the packet was received.</li></ul>

<p> </p>
<p id="rfc.section.13.2.p.2">The requirement of adding the "received" parameter does not fit well into WebSocket protocol nature. The WebSocket handshake connection reuses existing HTTP infrastructure in which there could be certain number of HTTP proxies and/or TCP load balancers between the client and the WebSocket server, so the source IP the server would write into the Via "received" parameter would be the IP of the HTTP/TCP intermediary in front of it. This would reveal sensitive information about the internal topology of the provider network to the WebSocket client.</p>
<p id="rfc.section.13.2.p.3">Thus, given the fact that SIP responses can only be sent over the existing WebSocket connection, the meaning of the Via "received" parameter added by the server is of little use. Therefore, in order to allow hiding possible sensitive information about the provider infrastructure, this specification relaxes the requirement in <a href="#RFC3261">RFC 3261</a> <cite title="NONE">[RFC3261]</cite> section 18.2.1 "Receiving Requests" by stating that a WebSocket server receiving a SIP request from a WebSocket client MAY choose not to add the Via "received" parameter nor honor the Via "rport" <a href="#RFC3581">[RFC3581]</a> parameter. A SIP client implementing the WebSocket transport MUST be ready to receive SIP responses in which the topmost Via header field does not contain the "received" and "rport" parameters.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> <a href="#iana_considerations" id="iana_considerations">IANA Considerations</a>
</h1>
<h1 id="rfc.section.14.1">
<a href="#rfc.section.14.1">14.1.</a> Registration of the WebSocket SIP Sub-Protocol</h1>
<p id="rfc.section.14.1.p.1">This specification requests IANA to create the WebSocket SIP Sub-Protocol in the registry of WebSocket sub-protocols with the following data: </p>

<dl>
<dt>Subprotocol Identifier:</dt>
<dd style="margin-left: 8">sip</dd>
<dt>Subprotocol Common Name:</dt>
<dd style="margin-left: 8">SIP over WebSocket</dd>
<dt>Subprotocol Definition:</dt>
<dd style="margin-left: 8">TBD, it should point to this document</dd>
</dl>

<p> </p>
<h1 id="rfc.section.14.2">
<a href="#rfc.section.14.2">14.2.</a> Registration of new Via transports</h1>
<p id="rfc.section.14.2.p.1">This specification registers two new transport identifiers for Via headers: </p>

<dl>
<dt>WS:</dt>
<dd style="margin-left: 6">MUST be used when constructing a SIP request to be sent over a plain WebSocket connection.</dd>
<dt>WSS:</dt>
<dd style="margin-left: 6">MUST be used when constructing a SIP request to be sent over a secure WebSocket connection (tunneled over TLS <a href="#RFC5246">[RFC5246]</a>).</dd>
</dl>

<p> </p>
<h1 id="rfc.section.14.3">
<a href="#rfc.section.14.3">14.3.</a> Registration of new SIP URI transport</h1>
<p id="rfc.section.14.3.p.1">This specification registers a new value for the "transport" parameter in a SIP URI: </p>

<dl>
<dt>ws:</dt>
<dd style="margin-left: 6">Identifies a SIP URI to be contacted using a WebSocket connection.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.14.4">
<a href="#rfc.section.14.4">14.4.</a> Registration of new NAPTR service field values</h1>
<div id="#rfc.figure.9"></div>
<pre>
 Services Field        Protocol  Reference
 --------------------  --------  ---------
 SIP+D2W               WS        TBD: this document
 SIPS+D2W              WSS       TBD: this document
</pre>
<p id="rfc.section.14.4.p.1">This document defines two new NAPTR service field values (SIP+D2W and SIPS+D2W) and requests IANA to register these values under the "Registry for the SIP SRV Resource Record Services Field".  The resulting entries are as follows:</p>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.15.p.1">Special thanks to the following people who participated in discussions on the SIPCORE and RTCWEB WG mailing lists and contributed ideas and/or provided detailed reviews (the list is likely to be incomplete): Hadriel Kaplan, Paul Kyzivat, Ranjit Avasarala.</p>
<p id="rfc.section.15.p.2">Special thanks also to Saul Ibarra Corretg&#233; for his detailed review and provided suggestions.</p>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">16.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2617">[RFC2617]</b></td>
<td class="top">
<a href="mailto:john@math.nwu.edu" title="Northwestern University, Department of Mathematics">Franks, J.</a>, <a href="mailto:pbaker@verisign.com" title="Verisign Inc.">Hallam-Baker, P.M.</a>, <a href="mailto:jeff@AbiSource.com" title="AbiSource, Inc.">Hostetler, J.L.</a>, <a href="mailto:lawrence@agranat.com" title="Agranat Systems, Inc.">Lawrence, S.D.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.J.</a>, <a title="Netscape Communications Corporation">Luotonen, A.</a> and <a href="mailto:stewart@OpenMarket.com" title="Open Market, Inc.">L. Stewart</a>, "<a href="http://tools.ietf.org/html/rfc2617">HTTP Authentication: Basic and Digest Access Authentication</a>", RFC 2617, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3263">[RFC3263]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3263">Session Initiation Protocol (SIP): Locating SIP Servers</a>", RFC 3263, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5626">[RFC5626]</b></td>
<td class="top">
<a>Jennings, C.</a>, <a>Mahy, R.</a> and <a>F. Audet</a>, "<a href="http://tools.ietf.org/html/rfc5626">Managing Client-Initiated Connections in the Session Initiation Protocol (SIP)</a>", RFC 5626, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5627">[RFC5627]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5627">Obtaining and Using Globally Routable User Agent URIs (GRUUs) in the Session Initiation Protocol (SIP)</a>", RFC 5627, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</b></td>
<td class="top">
<a>Fette, I</a> and <a>A Melnikov</a>, "<a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-17">The WebSocket protocol</a>", Internet-Draft draft-ietf-hybi-thewebsocketprotocol-17, September 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">16.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4168">[RFC4168]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>G. Camarillo</a>, "<a href="http://tools.ietf.org/html/rfc4168">The Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP)</a>", RFC 4168, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3327">[RFC3327]</b></td>
<td class="top">
<a>Willis, D.</a> and <a>B. Hoeneisen</a>, "<a href="http://tools.ietf.org/html/rfc3327">Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts</a>", RFC 3327, December 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3581">[RFC3581]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3581">An Extension to the Session Initiation Protocol (SIP) for Symmetric Response Routing</a>", RFC 3581, August 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5658">[RFC5658]</b></td>
<td class="top">
<a>Froment, T.</a>, <a>Lebel, C.</a> and <a>B. Bonnaerens</a>, "<a href="http://tools.ietf.org/html/rfc5658">Addressing Record-Route Issues in the Session Initiation Protocol (SIP)</a>", RFC 5658, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6265">[RFC6265]</b></td>
<td class="top">
<a>Barth, A.</a>, "<a href="http://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>", RFC 6265, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="WS-API">[WS-API]</b></td>
<td class="top">
<a title="Google, Inc.">Hickson, I.</a>, "<a>The Web Sockets API</a>", September 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Inaki Baz Castillo</span> 
	  <span class="n hidden">
		<span class="family-name">Baz Castillo</span>
	  </span>
	</span>
	<span class="org vcardline">XtraTelecom S.A.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Barakaldo</span>,  
		<span class="region">Basque Country</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ibc@aliax.net">ibc@aliax.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jose Luis Millan</span> 
	  <span class="n hidden">
		<span class="family-name">Luis Millan</span>
	  </span>
	</span>
	<span class="org vcardline">XtraTelecom S.A.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bilbao</span>,  
		<span class="region">Basque Country</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jmillan@aliax.net">jmillan@aliax.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Victor Pascual</span> 
	  <span class="n hidden">
		<span class="family-name">Pascual</span>
	  </span>
	</span>
	<span class="org vcardline">Acme Packet</span>
	<span class="adr">
	  <span>Anabel Segura 10</span>

	  <span class="vcardline">
		<span class="locality">Madrid</span>,  
		<span class="region">Madrid</span> 
		<span class="code">28108</span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vpascual@acmepacket.com">vpascual@acmepacket.com</a></span>

  </address>
</div>

</body>
</html>