


NGTRANS Working Group                                         F. Templin
Internet-Draft                                                     Nokia
Expires: June 19, 2003                                        T. Gleeson
                                                      Cisco Systems K.K.
                                                               M. Talwar
                                                               D. Thaler
                                                   Microsoft Corporation
                                                       December 19, 2002


        Intra-Site Automatic Tunnel Addressing Protocol (ISATAP)
                    draft-ietf-ngtrans-isatap-08.txt

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on June 19, 2003.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

Abstract

   This document specifies an Intra-Site Automatic Tunnel Addressing
   Protocol (ISATAP) that connects IPv6 hosts and routers within IPv4
   sites.  ISATAP is a transition mechanism that treats the site's IPv4
   infrastructure as a Non-Broadcast Multiple Access (NBMA) link layer
   for IPv6 with no requirement for IPv4 multicast.  ISATAP enables
   intra-site automatic IPv6-in-IPv4 tunneling whether globally assigned
   or private IPv4 addresses are used.



Templin, et al.          Expires June 19, 2003                  [Page 1]

Internet-Draft                   ISATAP                    December 2002


Table of Contents

   1.    Introduction . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.    Applicability Statement  . . . . . . . . . . . . . . . . . .  3
   3.    Terminology  . . . . . . . . . . . . . . . . . . . . . . . .  4
   4.    Transmission of IPv6 Packets on ISATAP Links . . . . . . . .  4
   4.1   ISATAP Interface Identifier Construction . . . . . . . . . .  4
   4.2   Stateless Autoconfiguration and Link-Local Addresses . . . .  5
   4.3   ISATAP Link/Interface Configuration  . . . . . . . . . . . .  5
   4.4   Sending Rules and Address Mapping  . . . . . . . . . . . . .  6
   4.5   Validity Checks for Received Packets . . . . . . . . . . . .  6
   4.6   Tunnel MTU and Fragmentation . . . . . . . . . . . . . . . .  6
   5.    Neighbor Discovery for ISATAP Links  . . . . . . . . . . . .  9
   5.1   Address Resolution . . . . . . . . . . . . . . . . . . . . .  9
   5.2   Router and Prefix Discovery  . . . . . . . . . . . . . . . . 10
   5.2.1 Conceptual Data Structures . . . . . . . . . . . . . . . . . 10
   5.2.2 Validity Checks for Router Advertisements  . . . . . . . . . 11
   5.2.3 Router Specification . . . . . . . . . . . . . . . . . . . . 12
   5.2.4 Host Specification . . . . . . . . . . . . . . . . . . . . . 12
   6.    ISATAP Deployment Considerations . . . . . . . . . . . . . . 13
   6.1   Host And Router Deployment Considerations  . . . . . . . . . 13
   6.2   Site Administration Considerations . . . . . . . . . . . . . 13
   7.    IANA Considerations  . . . . . . . . . . . . . . . . . . . . 14
   8.    Security considerations  . . . . . . . . . . . . . . . . . . 14
   9.    Acknowledgements . . . . . . . . . . . . . . . . . . . . . . 15
         Normative References . . . . . . . . . . . . . . . . . . . . 16
         Informative References . . . . . . . . . . . . . . . . . . . 17
         Authors' Addresses . . . . . . . . . . . . . . . . . . . . . 17
   A.    Major Changes  . . . . . . . . . . . . . . . . . . . . . . . 18
   B.    Rationale for Interface Identifier Construction Rules  . . . 21
   C.    INTELLECTUAL PROPERTY  . . . . . . . . . . . . . . . . . . . 22
         Intellectual Property and Copyright Statements . . . . . . . 23



















Templin, et al.          Expires June 19, 2003                  [Page 2]

Internet-Draft                   ISATAP                    December 2002


1. Introduction

   This document presents a simple approach that enables incremental
   deployment of IPv6 [1] within IPv4-based [2] sites in a manner that
   is compatible with inter-domain transition mechanisms, e.g., RFC 3056
   (6to4) [19].  We refer to this approach as the Intra-Site Automatic
   Tunnel Addressing Protocol, or ISATAP (pronounced: "ice-a-tap").
   ISATAP allows dual-stack nodes that do not share a common link with
   an IPv6 router to automatically tunnel packets to the IPv6 next-hop
   address through IPv4, i.e., the site's IPv4 infrastructure is treated
   as an NBMA link layer.

   This document specifies details for the transmission of IPv6 packets
   over ISATAP links (i.e., automatic IPv6-in-IPv4 tunneling), including
   a new EUI-64 based interface identifier format [3][4][5] that embeds
   an IPv4 address.  This format supports configuration of global,
   site-local and link-local addresses as specified in RFC 2462 [6] as
   well as simple link-layer address mapping.  Simple validity checks
   for received packets are given.  Also specified in this document is
   the operation of IPv6 Neighbor Discovery for ISATAP, as permitted for
   NBMA links by RFC 2461 [7].  The document finally presents deployment
   and security considerations for ISATAP.

2. Applicability Statement

   ISATAP provides the following features:

   o  treats site's IPv4 infrastructure as an NBMA link layer using
      automatic IPv6-in-IPv4 tunneling (i.e., no configured tunnel
      state)

   o  enables incremental deployment of IPv6 hosts within IPv4 sites
      with no aggregation scaling issues at border gateways

   o  requires no special IPv4 services within the site (e.g.,
      multicast)

   o  supports both stateless address autoconfiguration and manual
      configuration

   o  supports networks that use non-globally unique IPv4 addresses
      (e.g., when private address allocations [8] are used), but does
      not allow the virtual ISATAP link to span a Network Address
      Translator [9]

   o  compatible with other NGTRANS mechanisms (e.g., 6to4 [19])





Templin, et al.          Expires June 19, 2003                  [Page 3]

Internet-Draft                   ISATAP                    December 2002


3. Terminology

   The terminology of RFC 2460 [1] applies to this document.  The
   following additional terms are defined:

   link:
      same definition as [6][7].

   underlying link:
      a link layer that supports IPv4 (for ISATAP), and MAY also support
      IPv6 natively.

   ISATAP link:
      one or more underlying links used for tunneling.  The IPv4 network
      layer addresses of the underlying links are used as link-layer
      addresses on the ISATAP link.

   ISATAP interface:
      a node's attachment to an ISATAP link.

   ISATAP prefix:
      a prefix used to configure an address on the ISATAP interface.
      This prefix is administratively assigned to the ISATAP link and
      MUST NOT be duplicated on native IPv6 links.

   ISATAP address:
      an IPv6 address with an ISATAP prefix and an ISATAP format
      interface identifier constructed as specified in section 4.

   ISATAP router:
      an IPv6 node that has an ISATAP interface over which it forwards
      packets not explicitly addressed to itself.

   ISATAP host:
      any node that has an ISATAP interface and is not an ISATAP router.


4. Transmission of IPv6 Packets on ISATAP Links

   ISATAP links transmit IPv6 packets via automatic tunnels using the
   site's IPv4 infrastructure as an NBMA link layer.  IPv4 ICMP errors
   and ARP failures may be processed as link error notifications, as
   allowed by RFC 2461 [7].  The common tunneling mechanisms specified
   in Section 3 of RFC 2893 [10] are used, with the following noted
   specific considerations for ISATAP links and automatic tunnels:

4.1 ISATAP Interface Identifier Construction




Templin, et al.          Expires June 19, 2003                  [Page 4]

Internet-Draft                   ISATAP                    December 2002


   IPv6 unicast addresses [3][4] include a 64-bit interface identifier
   field in "modified EUI-64 format", based on the IEEE EUI-64 [5]
   specification.  (Modified EUI-64 format inverts the sense of the 'u/
   l' bit from its specification in [5], i.e., 'u/l' = 0 indicates
   local-use.) ISATAP interface identifiers are constructed by
   prepending the 32-bit string '00-00-5E-FE' with an IPv4 address (see
   the following section for examples).  Appendix B includes text
   explaining the rationale for this construction rule.

4.2 Stateless Autoconfiguration and Link-Local Addresses

   ISATAP addresses are unicast addresses that use ISATAP format
   interface identifiers as follows:

    |           64 bits            |     32 bits   |    32 bits     |
    +------------------------------+---------------+----------------+
    | link-local, site-local or    |   0000:5EFE   |  IPv4 Address  |
    |    global unicast prefix     |               | of ISATAP link |
    +------------------------------+---------------+----------------+

                                Figure 1

   Link-local, site-local, and global ISATAP addresses can be created
   exactly as specified in [3], (e.g., by auto-configuration [6] or
   manual configuration).  For example, the IPv6 address:

      3FFE:1A05:510:1111:0:5EFE:8CAD:8108

   has a prefix of '3FFE:1A05:510:1111::/64' and an ISATAP format
   interface identifier with embedded IPv4 address: '140.173.129.8'.
   The address is alternately written as:

      3FFE:1A05:510:1111:0:5EFE:140.173.129.8

   The link-local and site-local variants (respectively) are:

      FE80::0:5EFE:140.173.129.8

      FEC0::1111:0:5EFE:140.173.129.8


4.3 ISATAP Link/Interface Configuration

   An ISATAP link consists of one or more underlying links that support
   IPv4 for tunneling within a site.

   ISATAP interfaces are configured over ISATAP links; each IPv4 address
   assigned to an underlying link is seen as a link-layer address for



Templin, et al.          Expires June 19, 2003                  [Page 5]

Internet-Draft                   ISATAP                    December 2002


   ISATAP.

   At least one link-layer address per each ISATAP router interface
   SHOULD be added to the Potential Routers List (see Section 5.2.1).

4.4 Sending Rules and Address Mapping

   The IPv6 next-hop address for packets sent on an ISATAP link MUST be
   an ISATAP address.  Packets that do not satisfy this constraint MUST
   be discarded and an ICMPv6 destination unreachable indication with
   code 3 (Address Unreachable) [11] MUST be returned.  No other sending
   rules are necessary.

   The procedure for mapping unicast addresses into link-layer addresses
   is to simply treat the last four octets of the ISATAP address as an
   IPv4 address (in network byte order).  No multicast address mappings
   are specified.

4.5 Validity Checks for Received Packets

   Packets received on ISATAP interfaces MUST satisfy at least one
   (i.e., one or both) of the following validity checks:

   o  the network-layer (IPv6) source address has a prefix configured on
      the ISATAP interface and an ISATAP-format interface identifier
      that embeds the link-layer (IPv4) source address, i.e., source is
      on-link

   o  the link-layer (IPv4) source address is in the Potential Routers
      List (see Section 5.2.1), i.e., previous hop is an on-link ISATAP
      router

   Packets that do not satisfy at least one of the above checks are
   silently discarded.

4.6 Tunnel MTU and Fragmentation

   ISATAP interfaces implement automatic tunnels that may be configured
   over multiple underlying links with diverse MTUs.  The ISATAP
   interface MTU (ISATAP_MTU) SHOULD be set to the largest MTU of all
   underlying links (LINK_MTU) minus 120 bytes for possible link-layer
   encapsulations (see note 1).  The minimum value (ISATAP_MINMTU) MUST
   be at least 1280 bytes [1], but SHOULD be set to 1380 bytes (see note
   2).

   IPv6 path MTU discovery [14] is required for IPv6 interfaces that
   send packets larger than 1280 bytes.  The following considerations
   for ISATAP interfaces are noted:



Templin, et al.          Expires June 19, 2003                  [Page 6]

Internet-Draft                   ISATAP                    December 2002


   o  ISATAP encapsulators and decapsulators are IPv6 neighbors since
      they share a common link layer, i.e., the ISATAP link

   o  ISATAP neighbors may be separated by multiple IPv4 hops requiring
      IPv4 path MTU discovery [15] to establish per-neighbor MTUs
      (NBR_MTU)

   o  NBR_MTU information is stored as link-layer (IPv4) information
      (e.g., in the IPv4 path MTU discovery cache), thus it may not be
      visible to upper layers in all implementations

   o  NBR_MTU information may not always be available for each neighbor
      due to finite storage limitations

   o  IPv4 path MTU discovery delivers ICMPv4 "fragmentation needed"
      messages, but these do not provide enough state for translation
      into ICMPv6 "packet too big" messages (see: RFC 792 [12] and RFC
      1812 [13], section 4.3.2.3).

   IPv6 sees the ISATAP interface as an ordinary IPv6 interface with a
   fixed MTU (ISATAP_MTU), i.e., only those IPv6 packets of size
   ISATAP_MTU or smaller are accepted.  All other packets are dropped,
   and an IPv6 ICMP "packet too big" message with MTU = ISATAP_MTU is
   returned.  ISATAP interfaces SHOULD implement the following
   link-layer algorithm to determine when to perform IPv6-in-IPv4
   encapsulation and when to return an ICMPv6 "packet too big" message:

























Templin, et al.          Expires June 19, 2003                  [Page 7]

Internet-Draft                   ISATAP                    December 2002


   Determine per-neighbor LINK_MTU; NBR_MTU, e.g., by consulting IPv4
   forwarding table and/or IPv4 path MTU discovery cache, then:

   if NBR_MTU information exists
   	if packet is larger than NBR_MTU - 120 and packet
   	  is larger than ISATAP_MINMTU
   		Send IPv6 ICMP "packet too big" with
   		  MTU = MAX(NBR_MTU - 120, ISATAP_MINMTU)
   		Drop packet
   	else
   		if packet is larger than ISATAP_MINMTU
   			Encapsulate and set the Don't Fragment
                     	  flag in the IPv4 header
   		else
   			Encapsulate but do not set the Don't
   			  Fragment flag in the IPv4 header
   		endif

   	endif
   else
   	if packet is larger than LINK_MTU - 120 and packet is
             larger than ISATAP_MINMTU
   		Send IPv6 ICMP "packet too big" with
   		  MTU = ISATAP_MINMTU
   		Drop packet
   	else
   		if IPv6 neighbor is also an IPv4 neighbor on
                     the underlying link, or packet is less than
                     or == ISATAP_MINMTU
   			Encapsulate but do not set the Don't
   			  Fragment flag in the IPv4 header
   		else
   			send ICMPv6 "packet too big" with
   			  MTU = ISATAP_MINMTU
   			Drop packet
   		endif
   	endif
   endif

                                Figure 2

   Encapsulators MAY maintain per-neighbor MTU (NBR_MTU) values by
   periodically probing the IPv4 path, e.g., by sending packets larger
   than ISATAP_MINMTU with the DF bit set in the IPv4 header.  Large
   data packets and/or Neighbor Solicitation (NS) packets with padding
   bytes added (up to a total length of ISATAP_MTU) may be used for this
   purpose.  (NS packets are preferred, since successful delivery
   results in a positive acknowledgement from the decapsulator.)



Templin, et al.          Expires June 19, 2003                  [Page 8]

Internet-Draft                   ISATAP                    December 2002


   When probing, implementations SHOULD maintain state for translating
   ICMPv4 "fragmentation needed" messages into ICMPv6 "packet too big"
   messages for at least the round-trip time (RTT) between the
   encapsulator and decapsulator (see note 3).  Implementations SHOULD
   repeat the polling process within REACHABLE_TIME ([7], section 10) to
   detect link MTU restrictions.

   NOTES:

   1.  ISATAP requires 20 bytes for link-layer (IPv4) encapsulation.
       However, sub-IPv4 layer encapsulation (e.g., for VPNs) may occur
       on some paths.  Commonly-deployed VPNs on Ethernet use an MTU of
       1400 bytes, thus 100 bytes (1500 minums 1400) are reserverd for
       sub-IPv4 layer encapsulation.

   2.  Nearly all IPv4 routers can forward 1500 byte packets without
       fragmentation.  Thus, 1380 bytes (1500 minus 100 minus 20) is
       RECOMMENDED as ISATAP_MINMTU.

   3.  ICMPv4 "fragmentation needed" messages can be injected by
       malicious nodes, but this same problem exists in IPv4.  Using
       Neighbor Solicitation messages for probing and receiving a
       positive acknowledgement from a trusted decapsulator MAY help
       encapsulators recognize spoofed ICMPv4 "fragmentation needed"
       messages.


5. Neighbor Discovery for ISATAP Links

   Section 3.2 of RFC 2461 [7] provides the following guidelines for
   non-broadcast multiple access (NBMA) link support:

      "Redirect, Neighbor Unreachability Detection and next-hop
      determination should be implemented as described in this document.
      Address resolution and the mechanism for delivering Router
      Solicitations and Advertisements on NBMA links is not specified in
      this document."

   ISATAP links SHOULD implement Redirect, Neighbor Unreachability
   Detection, and next-hop determination exactly as specified in [7].
   Address resolution and the mechanisms for delivering Router
   Solicitations and Advertisements for ISATAP links are not specified
   by [7]; instead, they are specified in this document.  (Note that
   these mechanisms MAY potentially apply to other types of NBMA links
   in the future.)

5.1 Address Resolution




Templin, et al.          Expires June 19, 2003                  [Page 9]

Internet-Draft                   ISATAP                    December 2002


   Protocol addresses (IPv6) in ISATAP are resolved to link-layer
   addresses (IPv4) by a static computation, i.e., the last four octets
   are treated as an IPv4 address.

   ISATAP hosts SHOULD enhance the static address resolution computation
   with a unicast Neighbor Solicitation(NS)/Neighbor Advertisement(NA)
   exchange to ensure IPv6 level reachability of the neighbor and also
   SHOULD perform Neighbor Unreachability Detection (NUD) as specified
   in (RFC 2461 [7], section 7.3).  ISATAP routers MAY implement the
   enhanced address resolution and NUD, but this might not scale in all
   environments.  All ISATAP nodes MUST send solicited neighbor
   advertisements ([7], section 7.2.4).

   Link-layer address options ([7], section 4.6.1) for this
   specification MUST have Length = 1 and a six-octet interface
   identifier consisting of two zero octets followed by a four-octet
   IPv4 address.  Options of this form SHOULD NOT be sent in NS/NA
   messages and MUST be silently ignored in received NS/NA messages.

5.2 Router and Prefix Discovery

   Since the site's IPv4 infrastructure is treated as an NBMA link
   layer, unsolicited Router Advertisements do not provide sufficient
   means for router discovery on ISATAP links.  Thus, alternate
   mechanisms are required and specified below:

5.2.1 Conceptual Data Structures

   ISATAP nodes use the conceptual data structures Prefix List and
   Default Router List exactly as in ([7], section 5.1).  ISATAP links
   add a new conceptual data structure "Potential Router List" and the
   following new configuration variable:

   ResolveInterval
      Time between name service resolutions.  Default and suggested
      minimum: 1hr

   A Potential Router List (PRL) is associated with every ISATAP link.
   The PRL provides a trust basis for router validation (see security
   considerations).  Each entry in the PRL has an IPv4 address and an
   associated timer.  The IPv4 address represents a router's ISATAP
   interface (likely to be an "advertising interface"), and is used to
   construct the ISATAP link-local address for that interface.  The
   following sections specify the process for initializing the PRL:

   When a node enables an ISATAP link, it first discovers a DNS (RFC
   1035 [22]) fully-qualified domain name for the site's ISATAP service.
   The domain name MAY be established by a DHCPv4 [17] option for ISATAP



Templin, et al.          Expires June 19, 2003                 [Page 10]

Internet-Draft                   ISATAP                    December 2002


   (option code TBD, see IANA Considerations), by manual configuration,
   or by an unspecified alternative method.  The DHCPv4 option for
   ISATAP is implemented exactly as in RFC 3361 [18] with the following
   noted exceptions:

   o  the DHCP option code for ISATAP (TBD) is used

   o  the encoding byte MUST be 0, i.e.; only FQDNs are accepted

   o  if multiple domain names occur, only the first is used

   Next, the node initializes the link's PRL with IPv4 addresses
   associated with the domain name discovered above.  IPv4 addresses are
   discovered through manual config or by querying the name service to
   resolving the domain name into address records (e.g., DNS 'A'
   resource records) containing IPv4 addresses.  Unspecified alternative
   methods may also be used.

   Notes:

   1.  Site administrators maintain a domain name for the ISATAP service
       and a list of IPv4 addresses representing ISATAP router
       interfaces (normally as address records in the site's name
       service).  Administrators may also advertise the domain name in a
       DHCPv4 option for ISATAP.

   2.  There are no mandatory rules for the selection of a domain name,
       but administrators are encouraged to use the convention
       "isatap.domainname" (e.g., isatap.example.com).

   3.  After initialization, nodes periodically re-initialize the PRL
       (after ResolveInterval).  When DNS is used, nodes MUST follow the
       cache invalidation procedures in [22] when the DNS time-to-live
       expires.


5.2.2 Validity Checks for Router Advertisements

   A node MUST silently discard any Router Advertisement messages it
   receives that do not satisfy both the validity checks in ([7],
   section 6.1.2) and the following additional validity check for
   ISATAP:

   o  the network-layer (IPv6) source address is an ISATAP address and
      embeds an IPv4 address from the PRL






Templin, et al.          Expires June 19, 2003                 [Page 11]

Internet-Draft                   ISATAP                    December 2002


5.2.3 Router Specification

   Advertising ISATAP interfaces of routers behave the same as
   advertising interfaces described in ([7], section 6.2).  However,
   periodic unsolicited multicast Router Advertisements are not
   required, thus the "interval timer" associated with advertising
   interfaces is not used for that purpose.

   When an ISATAP router receives a valid Router Solicitation on an
   advertising ISATAP interface, it replies with a unicast Router
   Advertisement to the address of the node which sent the Router
   Solicitation.  The source address of the Router Advertisement is a
   link-local unicast address associated with the interface.  This MAY
   be the same as the destination address of the Router Solicitation.
   ISATAP routers MAY engage in the solicitation process described under
   Host Specification below, e.g., if Router Advertisement consistency
   verification ([7], section 6.2.7) is desired.

5.2.4 Host Specification

   All entries in the PRL are assumed to represent active ISATAP routers
   within the site, i.e., the PRL provides trust basis only; not
   reachability detection.  Hosts periodically solicit information from
   one or more entries in the PRL ("PRL(i)") by sending unicast Router
   Solicitation messages using the IPv4 address ("V4ADDR_PRL(i)") and
   associated timer in the entry.  Hosts add the following variable to
   support the solicitation process:

   MinRouterSolicitInterval
      Minimum time between sending Router Solicitations to any router.
      Default and suggested minimum: 15min

   When a PRL(i) is selected, the host sets its associated timer to
   MinRouterSolicitInterval and initiates solicitation following a short
   delay as in ([7], section 6.3.7).  The solicitation process repeats
   when the associated timer expires.

   Solicitation consists of sending Router Solicitations to the ISATAP
   link-local address constructed from the entry's IPv4 address, i.e.,
   they are sent to 'FE80::0:5EFE:V4ADDR_PRL(i)' instead of 'All-Routers
   multicast'.  They are otherwise sent exactly as in ([7], section
   6.3.7).

   Hosts process received Router Advertisements exactly as in ([7],
   section 6.3.4).  Hosts additionally reset the timer associated with
   the V4ADDR_PRL(i) embedded in the network-layer source address in
   each received Router Advertisement.  The timer is reset to either 0.5
   * (the minimum value in the router lifetime or valid lifetime of any



Templin, et al.          Expires June 19, 2003                 [Page 12]

Internet-Draft                   ISATAP                    December 2002


   on-link prefixes advertised) or MinRouterSolicitInterval; whichever
   is longer.

   ([7], section 6.3.4) includes the following specification:

      "To limit the storage needed for the Default Router List, a host
      MAY choose not to store all of the router addresses discovered via
      advertisements.  However, a host MUST retain at least two
      addresses and SHOULD retain more."

   The router solicitation process for ISATAP nodes is analogous to
   choosing which router addresses to store as in the above text.
   ISATAP nodes may wish to consider the control traffic overhead of
   this process when choosing how many routers to solict.  The manner of
   choosing particular routers in the PRL for solicitation is outside
   the scope of this specification.

6. ISATAP Deployment Considerations

6.1 Host And Router Deployment Considerations

   For hosts, if an underlying link supports both IPv4 (over which
   ISATAP is implemented) and also supports IPv6 natively, then ISATAP
   MAY be enabled if the native IPv6 layer does not receive Router
   Advertisements (i.e., does not have connection with an IPv6 router).
   After a non-link-local address has been configured and a default
   router acquired on the native link, the host SHOULD discontinue the
   router solicitation process described in the host specification and
   allow existing ISATAP address configurations to expire as specified
   in ([7], section 5.3) and ([6], section 5.5.4).  Any ISATAP addresses
   added to the DNS for this host should also be removed.  In this way,
   ISATAP use will gradually diminish as IPv6 routers are widely
   deployed throughout the site.

   Routers MAY configure an interface to simultaneously support both
   native IPv6, and also ISATAP (over IPv4).  Routing will operate as
   usual between these two domains.  Note that the prefixes used on the
   ISATAP and native IPv6 interfaces will be distinct.  The IPv4
   address(es) configured on a router's ISATAP interface(s) SHOULD be
   added (either automatically or manually) to the site's address
   records for ISATAP router interfaces.

6.2 Site Administration Considerations

   The following considerations are noted for sites that deploy ISATAP:

   o  ISATAP links are administratively defined by a set of router
      interfaces, and set of nodes which have those interface addresses



Templin, et al.          Expires June 19, 2003                 [Page 13]

Internet-Draft                   ISATAP                    December 2002


      in their potential router lists.  Thus, ISATAP links are defined
      by administrative (not physical) boundaries.

   o  ISATAP hosts and routers can be deployed in an ad-hoc and
      independent fashion.  In particular, ISATAP hosts can be deployed
      with little/no advanced knowledge of existing ISATAP routers, and
      ISATAP routers can deployed with no reconfiguration requirements
      for hosts.

   o  ISATAP nodes periodically send Router Solicitations (RS) to one or
      more members of the potential router list.  When Router
      Advertisements (RAs) are received, the Router Lifetime value
      provides a timer for the next RS to be sent.  Worst-case is for
      small values of Router Lifetime which is bounded by
      MinRouterSolicitInterval.

   o  ISATAP nodes periodically refresh the entries on the PRL,
      typically by querying the DNS.  Responsible site administration
      can reduce the control traffic.  At a minimum, administrators
      SHOULD ensure that the site's address records for ISATAP router
      interfaces are well maintained.


7. IANA Considerations

   A DHCPv4 option assignment for ISATAP is requested, as outlined in
   the procedures found in RFC 2939 [23], section 3.

   Appendix B proposes a specification for managing the IEEE OUI
   assigned to IANA for EUI-64 interface identifier construction.  This
   specification is made freely available to IANA for any purpose they
   may find useful.

8. Security considerations

   Site administrators are advised that, in addition to possible attacks
   against IPv6, security attacks against IPv4 MUST also be considered.
   Many security considerations in RFC 2529 [20], section 9 apply also
   to ISATAP.

   Responsible IPv4 site security management is strongly encouraged.  In
   particular, border gateways SHOULD implement filtering to detect
   spoofed IPv4 source addresses at a minimum; ip-protocol-41 filtering
   SHOULD also be implemented.

   If IPv4 source address filtering is not correctly implemented, the
   ISATAP validity checks will not be effective in preventing IPv6
   source address spoofing.



Templin, et al.          Expires June 19, 2003                 [Page 14]

Internet-Draft                   ISATAP                    December 2002


   If filtering for ip-protocol-41 is not correctly implemented, IPv6
   source address spoofing is clearly possible, but this can be
   eliminated if both IPv4 source address filtering, and the ISATAP
   validity checks are implemented.

   (RFC 2461 [7]), section 6.1.2 implies that nodes trust Router
   Advertisements they receive from on-link routers, as indicated by a
   value of 255 in the IPv6 'hop-limit' field.  Since this field is not
   decremented when ip-protocol-41 packets traverse multiple IPv4 hops
   ([10], section 3), ISATAP links require a different trust model.  In
   particular, ONLY those Router Advertisements received from a member
   of the Potential Routers List are trusted; all others are silently
   discarded.  This trust model is predicated on IPv4 source address
   filtering, as described above.

   The ISATAP address format does not support privacy extensions for
   stateless address autoconfiguration [21].  However, since the ISATAP
   interface identifier is derived from the node's IPv4 address, ISATAP
   addresses do not have the same level of privacy concerns as IPv6
   addresses that use an interface identifier derived from the MAC
   address.  (This issue is the same for NAT'd addresses.)

9. Acknowledgements

   Some of the ideas presented in this draft were derived from work at
   SRI with internal funds and contractual support.  Government sponsors
   who supported the work include Monica Farah-Stapleton and Russell
   Langan from U.S.  Army CECOM ASEO, and Dr.  Allen Moshfegh from U.S.
   Office of Naval Research.  Within SRI, Dr.  Mike Frankel, J.  Peter
   Marcotullio, Lou Rodriguez, and Dr.  Ambatipudi Sastry supported the
   work and helped foster early interest.

   The following peer reviewers are acknowledged for taking the time to
   review a pre-release of this document and provide input: Jim Bound,
   Rich Draves, Cyndi Jung, Ambatipudi Sastry, Aaron Schrader, Ole
   Troan, Vlad Yasevich.

   The authors acknowledge members of the NGTRANS community who have
   made significant contributions to this effort, including Rich Draves,
   Alain Durand, Nathan Lutchansky, Karen Nielsen, Art Shelest, Margaret
   Wasserman, and Brian Zill.

   The authors also wish to acknowledge the work of Quang Nguyen [24]
   under the guidance of Dr.  Lixia Zhang that proposed very similar
   ideas to those that appear in this document.  This work was first
   brought to the authors' attention on September 20, 2002.

Normative References



Templin, et al.          Expires June 19, 2003                 [Page 15]

Internet-Draft                   ISATAP                    December 2002


   [1]   Deering, S. and R. Hinden, "Internet Protocol, Version 6 (IPv6)
         Specification", RFC 2460, December 1998.

   [2]   Postel, J., "Internet Protocol", STD 5, RFC 791, September
         1981.

   [3]   Hinden, R. and S. Deering, "IP Version 6 Addressing
         Architecture", RFC 2373, July 1998.

   [4]   Hinden, R. and S. Deering, "An IPv6 Aggregatable Global Unicast
         Address Format", RFC 2374, July 1998.

   [5]   IEEE, "http://standards.ieee.org/regauth/oui/tutorials/
         EUI64.html", March 1997.

   [6]   Thomson, S. and T. Narten, "IPv6 Stateless Address
         Autoconfiguration", RFC 2462, December 1998.

   [7]   Narten, T., Nordmark, E. and W. Simpson, "Neighbor Discovery
         for IP Version 6 (IPv6)", RFC 2461, December 1998.

   [8]   Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G. and E.
         Lear, "Address Allocation for Private Internets", BCP 5, RFC
         1918, February 1996.

   [9]   Egevang, K. and P. Francis, "The IP Network Address Translator
         (NAT)", RFC 1631, May 1994.

   [10]  Gilligan, R. and E. Nordmark, "Transition Mechanisms for IPv6
         Hosts and Routers", RFC 2893, August 2000.

   [11]  Conta, A. and S. Deering, "Internet Control Message Protocol
         (ICMPv6) for the Internet Protocol Version 6 (IPv6)
         Specification", RFC 2463, December 1998.

   [12]  Postel, J., "Internet Control Message Protocol", STD 5, RFC
         792, September 1981.

   [13]  Baker, F., "Requirements for IP Version 4 Routers", RFC 1812,
         June 1995.

   [14]  McCann, J., Deering, S. and J. Mogul, "Path MTU Discovery for
         IP version 6", RFC 1981, August 1996.

   [15]  Mogul, J. and S. Deering, "Path MTU discovery", RFC 1191,
         November 1990.

   [16]  Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer,



Templin, et al.          Expires June 19, 2003                 [Page 16]

Internet-Draft                   ISATAP                    December 2002


         H., Taylor, T., Rytina, I., Kalla, M., Zhang, L. and V. Paxson,
         "Stream Control Transmission Protocol", RFC 2960, October 2000.

   [17]  Droms, R., "Dynamic Host Configuration Protocol", RFC 2131,
         March 1997.

   [18]  Schulzrinne, H., "Dynamic Host Configuration Protocol
         (DHCP-for-IPv4) Option for Session Initiation Protocol (SIP)
         Servers", RFC 3361, August 2002.

Informative References

   [19]  Carpenter, B. and K. Moore, "Connection of IPv6 Domains via
         IPv4 Clouds", RFC 3056, February 2001.

   [20]  Carpenter, B. and C. Jung, "Transmission of IPv6 over IPv4
         Domains without Explicit Tunnels", RFC 2529, March 1999.

   [21]  Narten, T. and R. Draves, "Privacy Extensions for Stateless
         Address Autoconfiguration in IPv6", RFC 3041, January 2001.

   [22]  Mockapetris, P., "Domain names - implementation and
         specification", STD 13, RFC 1035, November 1987.

   [23]  Droms, R., "Procedures and IANA Guidelines for Definition of
         New DHCP Options and Message Types", BCP 43, RFC 2939,
         September 2000.

   [24]  Nguyen, Q., "http://irl.cs.ucla.edu/vet/report.ps", spring
         1998.


Authors' Addresses

   Fred L. Templin
   Nokia
   313 Fairchild Drive
   Mountain View, CA  94110
   US

   Phone: +1 650 625 2331
   EMail: ftemplin@iprg.nokia.com









Templin, et al.          Expires June 19, 2003                 [Page 17]

Internet-Draft                   ISATAP                    December 2002


   Tim Gleeson
   Cisco Systems K.K.
   Shinjuku Mitsu Building
   2-1-1 Nishishinjuku, Shinjuku-ku
   Tokyo  163-0409
   Japan

   EMail: tgleeson@cisco.com


   Mohit Talwar
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA>  98052-6399
   US

   Phone: +1 425 705 3131
   EMail: mohitt@microsoft.com


   Dave Thaler
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA  98052-6399
   US

   Phone: +1 425 703 8835
   EMail: dthaler@microsoft.com

Appendix A. Major Changes

   changes from version 07 to version 08:

   o  updated MTU section

   changes from version 06 to version 07:

   o  clarified address resolution, Neighbor Unreachability Detection

   o  specified MTU/MRU requirements

   changes from version 05 to version 06:

   o  Addressed operational issues identified in 05 based on discussion
      between co-authors

   o  Clarified ambiguous text per comments from Hannu Flinck; Jason
      Goldschmidt



Templin, et al.          Expires June 19, 2003                 [Page 18]

Internet-Draft                   ISATAP                    December 2002


   changes from version 04 to version 05:

   o  Moved historical text in section 4.1 to Appendix B in response to
      comments from Pekka Savola

   o  Identified operational issues for anticipated deployment scenarios

   o  Included SRI IPR statement and contact information

   o  Included reference to Quang Nguyen work

   changes from version 03 to version 04:

   o  Re-wrote section on Potential Router List initialization to
      reference existing precedence in other documents

   o  several minor wording changes based on feedback from the community

   changes from version 02 to version 03:

   o  Added contributing co-authors

   o  RSs are now sent to unicast addresses rather than
      all-routers-multicast

   o  Brought draft into better alignment with other IPv6
      standards-track documents

   o  Added applicability statement

   changes from version 01 to version 02:

   o  Cleaned up text and tightened up terminology

   o  Changed "IPv6 destination address" to "IPv6 next-hop address"
      under "sending rules"

   o  Changed definition of ISATAP prefix to include link and site-local

   o  Changed language in sections 4 and 5

   changes from version 00 to version 01:

   o  Revised draft to require different /64 prefixes for ISATAP
      addresses and native IPv6 addresses.  Thus, a node's ISATAP
      interface is assigned a /64 prefix that is distinct from the
      prefixes assigned to any other interfaces attached to the node -
      be they physical or logical interfaces.  This approach eliminates



Templin, et al.          Expires June 19, 2003                 [Page 19]

Internet-Draft                   ISATAP                    December 2002


      ISATAP-specific sending rules presented in earlier draft versions.

   o  Changed sense of 'u/l' bit in the ISATAP address interface
      identifier to indicate "local scope", since ISATAP interface
      identifiers are unique only within the scope of the ISATAP prefix.
      (See section 4.)

   changes from personal draft to version 00:

   o  Title change to provide higher-level description of field of use
      addressed by this draft.  Removed other extraneous text.

   o  Major new section on automatic discovery of off-link IPv6 routers
      when IPv6-IPv4 compatibility addresses are used.





































Templin, et al.          Expires June 19, 2003                 [Page 20]

Internet-Draft                   ISATAP                    December 2002


Appendix B. Rationale for Interface Identifier Construction Rules

   ISATAP specifies an EUI64-format address construction for the
   Organizationally-Unique Identifier (OUI) owned by the Internet
   Assigned Numbers Authority (IANA).  This format (given below) is used
   to construct both native EUI64 addresses for general use and modified
   EUI-64 format interface identifiers for use in IPv6 unicast
   addresses:

    |0                      2|2      3|3      3|4                      6|
    |0                      3|4      1|2      9|0                      3|
    +------------------------+--------+--------+------------------------+
    |  OUI ("00-00-5E"+u+g)  |  TYPE  |  TSE   |          TSD           |
    +------------------------+--------+--------+------------------------+

   Where the fields are:

      OUI     IANA's OUI: 00-00-5E with 'u' and 'g' bits (3 octets)

      TYPE    Type field; specifies interpretation of (TSE, TSD) (1 octet)

      TSE     Type-Specific Extension (1 octet)

      TSD     Type-Specific Data (3 octets)

   And the following interpretations are specified based on TYPE:

      TYPE         (TSE, TSD) Interpretation
      ----         -------------------------
      0x00-0xFD    RESERVED for future IANA use
      0xFE         (TSE, TSD) together contain an embedded IPv4 address
      0xFF         TSD is interpreted based on TSE as follows:

                   TSE          TSD Interpretation
                   ---          ------------------
                   0x00-0xFD    RESERVED for future IANA use
                   0xFE         TSD contains 24-bit EUI-48 intf id
                   0xFF         RESERVED by IEEE/RAC

                                Figure 3

   Thus, if TYPE=0xFE, TSE is an extension of TSD.  If TYPE=0xFF, TSE is
   an extension of TYPE.  Other values for TYPE (thus, other
   interpretations of TSE, TSD) are reserved for future IANA use.

   The above specification is compatible with all aspects of EUI64,
   including support for encapsulating legacy EUI-48 interface
   identifiers (e.g., an IANA EUI-48 format multicast address such as:



Templin, et al.          Expires June 19, 2003                 [Page 21]

Internet-Draft                   ISATAP                    December 2002


   '01-00-5E-01-02-03' is encapsulated as: '01-00-5E-FF-FE-01-02-03').
   But, the specification also provides a special TYPE (0xFE) to
   indicate an IPv4 address is embedded.  Thus, when the first four
   octets of an IPv6 interface identifier are: '00-00-5E-FE' (note: the
   'u/l' bit MUST be 0) the interface identifier is said to be in
   "ISATAP format" and the next four octets embed an IPv4 address
   encoded in network byte order.

Appendix C. INTELLECTUAL PROPERTY

   SRI International has notified the IETF of IPR considerations for
   some aspects of this specification.  For more information consult the
   online list of claimed rights.






































Templin, et al.          Expires June 19, 2003                 [Page 22]

Internet-Draft                   ISATAP                    December 2002


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights.  Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11.  Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard.  Please address the information to the IETF Executive
   Director.


Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION



Templin, et al.          Expires June 19, 2003                 [Page 23]

Internet-Draft                   ISATAP                    December 2002


   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.











































Templin, et al.          Expires June 19, 2003                 [Page 24]


