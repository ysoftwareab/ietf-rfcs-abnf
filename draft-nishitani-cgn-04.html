<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Common requirements for IP address sharing schemes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Common requirements for IP address sharing schemes">
<meta name="keywords" content="Large-Scale,NAT">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">I. Yamagata</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">T. Nishitani</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">S. Miyakawa</td></tr>
<tr><td class="header">Expires: September 10, 2010</td><td class="header">NTT Communications</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">A. Nakagawa</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">KDDI CORPORATION</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Ashida</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">iTSCOM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 09, 2010</td></tr>
</table></td></tr></table>
<h1><br />Common requirements for IP address sharing schemes<br />draft-nishitani-cgn-04</h1>

<h3>Abstract</h3>

<p>This document defines common requirements of multiple types of Large Scale
Network Address Translation (NAT) that handles Unicast UDP, TCP and ICMP.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Requirements for UDP<br />
<a href="#anchor4">4.</a>&nbsp;
Requirements for TCP<br />
<a href="#anchor5">5.</a>&nbsp;
Requirements for ICMP<br />
<a href="#anchor6">6.</a>&nbsp;
LSN specified Requirements<br />
<a href="#anchor7">7.</a>&nbsp;
 Identifying particular users (BOTs, spammers, etc)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">7.1.</a>&nbsp;
Store Translation Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">7.2.</a>&nbsp;
Fixed port assignment<br />
<a href="#port_limitation">8.</a>&nbsp;
Considerations about limiting the number of LSN external ports<br />
<a href="#IANA">9.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">10.</a>&nbsp;
Security Considerations<br />
<a href="#anchor10">11.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative Reference<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Now there are several IPv4 address sharing schemes such as Large Scale NAT (as known as NAT444<a class='info' href='#I-D.shirasaki-nat444-isp-shared-addr'>[I&#8209;D.shirasaki&#8209;nat444&#8209;isp&#8209;shared&#8209;addr]<span> (</span><span class='info'>Shirasaki, Y., Miyakawa, S., Nakagawa, A., Yamaguchi, J., and H. Ashida, &ldquo;NAT444 addressing models,&rdquo; March&nbsp;2010.</span><span>)</span></a>) , DS-Lite<a class='info' href='#I-D.ietf-softwire-dual-stack-lite'>[I&#8209;D.ietf&#8209;softwire&#8209;dual&#8209;stack&#8209;lite]<span> (</span><span class='info'>Durand, A., Droms, R., Haberman, B., Woodyatt, J., Lee, Y., and R. Bush, &ldquo;Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion,&rdquo; March&nbsp;2010.</span><span>)</span></a>, A+P<a class='info' href='#I-D.ymbk-aplusp'>[I&#8209;D.ymbk&#8209;aplusp]<span> (</span><span class='info'>Bush, R., &ldquo;The A+P Approach to the IPv4 Address Shortage,&rdquo; October&nbsp;2009.</span><span>)</span></a> and so on under the discussion.
	
</p>
<p>
Those IPv4 address sharing schemes are intended to be used in the middle of the ISP access network against IPv4 address shortage problem by sharing one global IPv4 address by multiple users. Authors believe that there are common requirements among all IPv4 address sharing schemes to make them "transparent" as much as possible.
At the BEHAVE working group of IETF, following RFCs have already defined to achieve maximum transparency at the residential CPE which has NAT function;
	
</p>
<p>
   	</p>
<blockquote class="text">
<p>
- RFC4787 : NAT Behavioral Requirements for Unicast UDP
		
</p>
<p>
- RFC5382 : NAT Behavioral Requirements for TCP
		
</p>
<p>
- RFC5508 : NAT Behavioral Requirements for ICMP
		
</p>
</blockquote><p>
	
</p>
<p>
However so, because those RFCs are mainly aimed at residential CPE and any IPv4 address sharing schemes are a bit different from it, we believe that requirements for LSN and other schemes should be defined alternatively to those RFCs.
	
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
	document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
	
</p>
<p>
	Readers are expected to be familiar with <a class='info' href='#RFC4787'>[RFC4787]<span> (</span><span class='info'>Audet, F. and C. Jennings, &ldquo;Network Address Translation (NAT) Behavioral Requirements for Unicast UDP,&rdquo; January&nbsp;2007.</span><span>)</span></a> and the 
	terms defined there. The following term are used in this document:
    	

	</p>
<blockquote class="text">
<p>
  Large-Scale NAT(LSN): NAT devices placed between CPE and public
  Internet by an operator.  LSN converts CPE IP Address, CPE Port, and
  CPE Identifier into LSN external IP Address, LSN external Port and
  LSN external Identifier in communication between CPE and GGN
  external.
    
</p>
<p>
    	LSN external realm:
    	The realm where IPv4 global addresses are assigned
    
</p>
<p>
	 LSN internal realm:
  	 The realm placed between LSN and CPEs
  	 
</p>
<p>
   	LSN external IP address:
   	The IP address on LSN in LSN external realm mapping to CPE IP address
  	 
</p>
<p>
   	LSN external port:
   	The port on LSN in LSN external realm mapping to CPE port
   	
</p>
<p>
 	LSN external identifier:
   	The identifier of ICMP on LSN in LSN external realm mapping to CPE identifier
   	
</p>
<p>
   	Customer Premises Equipment(CPE): 
   	The terminal which is placed in LSN internal realm and may establish
	TCP sessions to LSN external realm (e.g. a single PC or NATBox)
   	
</p>
<p>
   	CPE IP address:
   	The IP address on CPE in LSN internal realm 
   	
</p>
<p>
   	CPE port:
   	The port on CPE in LSN internal realm
   	
</p>
<p>
   	CPE identifier:
   	CPE's identifier of ICMP in LSN internal realm
   	
</p>
<p>
   	CPE 3-tuple:
   	The tuple of TCP/UDP, CPE IP address, and CPE Port Service Server (SS)
   	The server an operator supplies various services for CPE
  	
</p>
<p>
	Service Server (SS): 
	The server placed in external realm
    
</p>
<p>

	Service Provide Server (SPS): 
	The server placed in external realm and controlled by LSN administrators
    
</p>
</blockquote><p>
	
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                        ++------++
                        |   SS   |
                        ++------++
                            |
                            |
                            |
LSN external IP address Y1  |
LSN external port y1        |
                        ++------++  LSN external realm
            ........... |  LSN   |...............
                        ++------++  LSN internal realm
                            |
CPE IP address X1           |
CPE port x1                 |
                        ++------++
                        |  CPE   |
                        ++------++
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 1. LSN network &nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Requirements for UDP</h3>

<p>
Based on RFC4787, we'd like to compile the list of the requirements as follows.
    	
</p>
<p>
Please note that UDP-REQ-8 is slightly different for original RFC.
And some of requirements have additional justification.

</p>
<p>UDP-REQ-1: A NAT MUST have an "Endpoint-Independent Mapping" behavior.
</p>
<blockquote class="text">
<p>Status: Same as REQ-1 in RFC4787
</p>
<p>Justification: This is needed to use UNilateral Self-Address Fixing (UNSAF) which plays important role in STUN / TURN. More detailed description can be found in the original RFC. But to be more precise, in the LSN case, it may not be needed for some specific protocol such as DNS query and response.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-2: It is RECOMMENDED that a NAT have an "IP address pooling" behavior of "Paired".  Note that this requirement is not applicable to NATs that do not support IP address pooling.
</p>
<blockquote class="text">
<p>Status: Same as REQ-2 in RFC4787
</p>
<p>Justification: This allows applications that use multiple ports originating from the same internal IP address to also have the same external IP address. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-3: A NAT MUST NOT have a "Port assignment" behavior of "Port overloading".
</p>
<blockquote class="text">
<p>Status: Same as REQ-3 in RFC4787
</p>
<p>Justification: This requirement must be met in order to enable two applications on the internal side of the NAT both to use the same port to try to communicate with the same destination. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-3-a: If the host's source port was in the range 0-1023, it is RECOMMENDED the NAT's source port be in the same range.  If the host's source port was in the range 1024-65535, it is RECOMMENDED that the NAT's source port be in that range.
</p>
<blockquote class="text">
<p>Status: Same as REQ-3-a in RFC4787
</p>
<p>Justification: Certain applications expect the source UDP port to be in the well-known range. More detailed description can be found in original RFC. On the other hand, almost application probably not use range 0-1023 for source port. Using ports as many as possible, it may not be needed this requirement.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-4: It is RECOMMENDED that a NAT have a "Port parity preservation" behavior of "Yes".
</p>
<blockquote class="text">
<p>Status: Same as REQ-4 in RFC4787
</p>
<p>Justification: This is avoid breaking peer-to-peer applications that do not explicitly and separately specify RTP and RTCP port numbers and that follow the RFC 3550 rule to decrement an odd RTP port to make it even. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-5: A NAT UDP mapping timer MUST NOT expire in less than two minutes, unless REQ-5a applies.
</p>
<p>UDP-REQ-5-a: For specific destination ports in the well-known port range (ports 0-1023), a NAT MAY have shorter UDP mapping timers that are specific to the IANA-registered application running over that specific destination port.
</p>
<p>UDP-REQ-5-b: The value of the NAT UDP mapping timer SHOULD be configurable.
</p>
<p>UDP-REQ-5-c: A default value of five minutes or more for the NAT UDP mapping timer is RECOMMENDED.
</p>
<blockquote class="text">
<p>Status: Same as REQ-5, REQ-5-a, REQ-5-b, REQ-5-c in RFC4787
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-6: The NAT mapping Refresh Direction MUST have a "NAT Outbound refresh behavior" of "True".
</p>
<blockquote class="text">
<p>Status: Same as REQ-6 in RFC4787
</p>
<p>Justification: Outbound refresh is necessary for allowing the client to keep the mapping alive. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-6-a: The NAT mapping Refresh Direction MAY have a "NAT Inbound refresh behavior" of "True".
</p>
<blockquote class="text">
<p>Status: Same as REQ-6-a in RFC4787
</p>
<p>Justification: Allowing inbound refresh may allow an external attacker or misbehaving application to keep a mapping alive indefinitely. Also, it the process is repeated with different ports, over time, it could use up all the ports on the NAT. But this requirement is maybe needed for some applications occurring only incoming inbound traffic. In LSN, Making much of transparency, this requirement is more necessary.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-7: A NAT device whose external IP interface can be configured dynamically MUST either
	</p>
<blockquote class="text">
<p>(1) Automatically ensure that its internal network uses IP addresses that do not conflict with its external network, or 
	
</p>
<p>(2) Be able to translate and forward traffic between all internal nodes and all external nodes whose IP addresses numerically conflict with the internal network.
	
</p>
</blockquote><p>
	</p>
<blockquote class="text">
<p>Status: Same as REQ-7 in RFC4787
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-8: It is RECOMMENDED that a NAT have "Endpoint-Independent Filtering" behavior.
</p>
<blockquote class="text">
<p>Status: "If application transparency is most important, it is RECOMMENDED that a NAT have Endpoint-Independent Filtering behavior.  If a more stringent filtering behavior is most important, it is RECOMMENDED that a NAT have Address-Dependent Filtering behavior." is written at REQ-8 in RFC4787. In this draft, we pick up only first requirement.
</p>
<p>Justification: LSN which is placed at ISP/Carrier makes much of transparency. In particular, for applications that receive media simultaneously from multiple locations (e.g., gaming), or applications that use rendezvous techniques. But to be more precise, in the LSN case, it may not be needed for some specific protocol such as DNS query and response.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-8-a: The filtering behavior MAY be an option configurable by the administrator of the NAT.
</p>
<blockquote class="text">
<p>Status: Same as REQ-8-a in RFC4787
</p>
<p>Justification: Having the filtering behavior being an option configurable by the administrator of the NAT ensures that a NAT can be used in the widest variety of deployment scenarios. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-9: A NAT MUST support "Hairpinning".
</p>
<p>UDP-REQ-9-a: A NAT Hairpinning behavior MUST be "External source IP address and port".
</p>
<blockquote class="text">
<p>Status: Same as REQ-9 in RFC4787
</p>
<p>Justification: These requirements are to allow communications between two endpoints behind the same NAT when they are trying each other's external IP address. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-10: To eliminate interference with UNSAF NAT traversal mechanisms and allow integrity protection of UDP communications, NAT ALGs for UDP-based protocols SHOULD be turned off.  Future standards track specifications that define an ALG can update this to recommend the ALGs on which they define default.
</p>
<p>UDP-REQ-10-a: If a NAT includes ALGs, it is RECOMMENDED that the NAT allow the NAT administrator to enable or disable each ALG separately.
</p>
<blockquote class="text">
<p>Status: Same as REQ-10, REQ-10-a in RFC4787
</p>
<p>Justification: NAT ALGs may interfere with UNSAF methods. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-11: A NAT MUST have deterministic behavior, i.e., it MUST NOT change the NAT translation or the Filtering Behavior at any point in time, or under any particular conditions.
</p>
<blockquote class="text">
<p>Status: Same as REQ-11 in RFC4787
</p>
<p>Justification: Non-deterministic NATs are very difficult to troubleshoot. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-12: Receipt of any sort of ICMP message MUST NOT terminate the NAT mapping.
</p>
<p>UDP-REQ-12-a: The NAT's default configuration SHOULD NOT filter ICMP messages based on their source IP address.
</p>
<p>UDP-REQ-12-b: It is RECOMMENDED that a NAT support ICMP Destination Unreachable messages.
</p>
<blockquote class="text">
<p>Status: Same as REQ-12, REQ-12-a, REQ-12-b in RFC4787
</p>
<p>Justification: This is easy to do and is used for many things including MTU discovery and rapid detection of error conditions, and has no negative consequences. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-13: If the packet received on an internal IP address has DF=1, the NAT MUST send back an ICMP message "Fragmentation needed and DF set" to the host, as described in [RFC0792].
</p>
<p>UDP-REQ-13-a: If the packet has DF=0, the NAT MUST fragment the packet and SHOULD send the fragments in order.
	</p>
<blockquote class="text">
<p>Status: Same as REQ-13, REQ-13-a in RFC4787
</p>
<p>Justification: This is the same function a router performs in a similar situation. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<p>UDP-REQ-14: A NAT MUST support receiving in-order and out-of-order fragments, so it MUST have "Received Fragment Out of Order" behavior.
</p>
<p>UDP-REQ-14-a: A NAT's out-of-order fragment processing mechanism MUST be designed so that fragmentation-based DoS attacks do not compromise the NAT's ability to process in-order and unfragmented IP packets.
</p>
<blockquote class="text">
<p>Status: Same as REQ-14, REQ-14-a in RFC4787
</p>
<p>Justification: Since some networks deliver small packets ahead of large ones, there can be many out-of order fragments. NATs that are capable of delivering these out-of-order packets are possible, but they need to store the out-of-order fragments which can open up a Denial-of-Service (DoS) opportunity, if done incorrectly. More detailed description can be found in original RFC.
</p>
</blockquote><p>
	
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requirements for TCP</h3>

<p>
Based on RFC5382, we'd like to compile the list of the requirements as follows.

</p>
<p>
Please note that TCP-REQ-3 is slightly different for original RFC.
And some of requirements have additional justification.

</p>
<p>TCP-REQ-1: A NAT MUST have an "Endpoint Independent Mapping" behavior for TCP.
</p>
<blockquote class="text">
<p>Status: Same as REQ-1 in RFC5382
</p>
<p>Justification: This is needed to use UNilateral Self-Address Fixing (UNSAF) which plays important role in STUN / TURN. More detailed description can be found in the original RFC. But to be more precise, in the LSN case, it may not be needed for some specific protocols.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-2: A NAT MUST support all valid sequences of TCP packets for connections initiated both internally as well as externally when the connection is permitted by the NAT.
</p>
<p>TCP-REQ-2-a: In addition to handling the TCP 3-way handshake mode of connection initiation, A NAT MUST handle the TCP simultaneous-open mode of connection initiation.
</p>
<blockquote class="text">
<p>Status: Same as REQ-2,REQ-2-a in RFC5382
</p>
<p>Justification: This is to allow standards compliant TCP stacks to traverse NATs. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-3: It is RECOMMENDED that a NAT have an "Endpoint independent filtering" behavior for TCP.
</p>
<blockquote class="text">
<p>Status: "If application transparency is most important, it is RECOMMENDED that a NAT have an "Endpoint independent filtering" behavior for TCP.  If a more stringent filtering behavior is most important, it is RECOMMENDED that a NAT have an "Address dependent filtering" behavior." is REQ-3 in RFC5382. In this draft, we pick up only first requirement.
</p>
<p>Justification: LSN which is placed at ISP/Carrier makes much of transparency. But to be more precise, in the LSN case, it may not be needed for some specific protocols.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-3-a: The filtering behavior MAY be an option configurable by the administrator of the NAT.
</p>
<p>TCP-REQ-3-b: The filtering behavior for TCP MAY be independent of the filtering behavior for UDP.
</p>
<blockquote class="text">
<p>Status: Same as REQ-3-a, REQ-3-b in RFC5382
</p>
</blockquote><p>

</p>
<p>TCP-REQ-4: A NAT MUST NOT respond to an unsolicited inbound SYN packet for at least 6 seconds after the packet is received.  If during this interval the NAT receives and translates an outbound SYN for the connection the NAT MUST silently drop the original unsolicited inbound SYN packet.  Otherwise the NAT SHOULD send an ICMP Port Unreachable error (Type 3, Code 3) for the original SYN, unless REQ-4a applies.
</p>
<p>TCP-REQ-4-a: The NAT MUST silently drop the original SYN packet if sending a response violates the security policy of the NAT.
</p>
<blockquote class="text">
<p>Status: Same as REQ-4, REQ-4-a in RFC5382
</p>
<p>Justification: This intent of this requirement is to allow simultaneous-open to work reliably in the presence of NATs. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-5: If a NAT cannot determine whether the endpoints of a TCP connection are active, it MAY abandon the session if it has been idle for some time.  In such cases, the value of the "established connection idle-timeout" MUST NOT be less than 2 hours 4 minutes. The value of the "transitory connection idle-timeout" MUST NOT be less than 4 minutes.
</p>
<p>TCP-REQ-5-a: The value of the NAT idle-timeouts MAY be configurable.
</p>
<blockquote class="text">
<p>Status: Same as REQ-5, REQ-5-a in RFC5382
</p>
<p>Justification: The intent of this requirement is to minimize the cases where a NAT abandons session state for a live connection. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-6: If a NAT includes ALGs that affect TCP, it is RECOMMENDED that all of those ALGs (except for FTP) be disabled by default.
</p>
<blockquote class="text">
<p>Status: Same as REQ-6 in RFC5382
</p>
<p>Justification: The intent of this requirement is to prevent ALGs from interfering with UNSAF methods. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-7: A NAT MUST NOT have a "Port assignment" behavior of "Port overloading" for TCP.
</p>
<blockquote class="text">
<p>Status: Same as REQ-7 in RFC5382
</p>
<p>Justification: This requirement allows two applications on the internal side of the NAT to consistently communicate with the same destination.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-8: A NAT MUST support "Hairpinning" for TCP.
</p>
<p>TCP-REQ-8-a: A NAT's Hairpinning behavior MUST be of type "External source IP address and port".
</p>
<blockquote class="text">
<p>Status: Same as REQ-8, REQ-8-a in RFC5382
</p>
<p>Justification: This requirement allows two applications behind the same NAT that are trying to communicate with each other using their external addresses. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-9: If a NAT translates TCP, it SHOULD translate ICMP Destination Unreachable (Type 3) messages.
</p>
<blockquote class="text">
<p>Status: Same as REQ-9 in RFC5382
</p>
<p>Justification: Translating ICMP Destination Unreachable messages avoids communication failures. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>TCP-REQ-10: Receipt of any sort of ICMP message MUST NOT terminate the NAT mapping or TCP connection for which the ICMP was generated.
</p>
<blockquote class="text">
<p>Status: Same as REQ-10 in RFC5382
</p>
<p>Justification: This is necessary for reliably performing TCP simultaneous-open where a remote NAT may temporarily signal an ICMP error. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Requirements for ICMP</h3>

<p>
Based on RFC5508, we'd like to compile the list of the requirements as follows.

</p>
<p>
Some of requirements have additional justification.

</p>
<p>ICMP-REQ-1: Unless explicitly overridden by local policy, a NAT device MUST permit ICMP Queries and their associated responses, when the Query is initiated from a private host to the external hosts.
</p>
<p>ICMP-REQ-1-a: NAT mapping of ICMP Query Identifiers SHOULD be external host independent.
</p>
<blockquote class="text">
<p>Status: Same as REQ-1 in RFC5508
</p>
<p>Justification: ICMP Query mapping by NAT devices is necessary for current ICMP-Query-based applications to work. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-2: An ICMP Query session timer MUST NOT expire in less than 60 seconds.
</p>
<p>ICMP-REQ-2-a: It is RECOMMENDED that the ICMP Query session timer be made configurable.
</p>
<blockquote class="text">
<p>Status: Same as REQ-2, REQ-2-a in RFC5508
</p>
<p>Justification: Setting the ICMP NAT session timeout to a very large duration ( say, 240 seconds) could potentially tie up precious NAT resources for the whole duration. On the other hand, setting the timeout very low can result in premature freeing of NAT resources and applications failing to complete gracefully. A 60-second timeout is a balance between the two extremes. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-3: When an ICMP Error packet is received, if the ICMP checksum fails to validate, the NAT SHOULD silently drop the ICMP Error packet. If the ICMP checksum is valid, do the following.
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>If the IP checksum of the embedded packet fails to validate, the NAT SHOULD silently drop the Error packet; and
</dd>
<dt>b.</dt>
<dd>If the embedded packet includes IP options, the NAT device MUST traverse past the IP options to locate the start of transport header for the embedded packet; and
</dd>
<dt>c.</dt>
<dd>The NAT device SHOULD NOT validate the transport checksum of the embedded packet within an ICMP Error message, even when it is possible to do so; and
</dd>
<dt>d.</dt>
<dd>If the ICMP Error payload contains ICMP extensions, the NAT device MUST exclude the optional zero-padding and the ICMP extensions when evaluating transport checksum for the embedded packet.
</dd>
</dl></blockquote><p>
</p>
<blockquote class="text">
<p>Status: Same as REQ-3 in RFC5508
</p>
<p>Justification: An ICMP Error message checksum covers the entire ICMP message, including the payload. NAT uses the embedded IP and transport headers for forwarding and translating the ICMP Error message.
More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-4: If a NAT device receives an ICMP Error packet from external realm, and the NAT device does not have an active mapping for the embedded payload, the NAT SHOULD silently drop the ICMP Error packet. If the NAT has active mapping for the embedded payload, then the NAT MUST do the following prior to forwarding the packet, unless local policy explicitly overridden by local policy:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>Revert the IP and transport headers of the embedded IP packet to their original form, using the matching mapping; and
</dd>
<dt>b.</dt>
<dd>Leave the ICMP Error type and code unchanged; and
</dd>
<dt>c.</dt>
<dd>Modify the destination IP address of the outer IP header to be same as the source IP address of the embedded packet after translation.
</dd>
</dl></blockquote><p>
</p>
<blockquote class="text">
<p>Status: Same as REQ-4 in RFC5508
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-5: If a NAT device receives an ICMP Error packet from the private realm, and the NAT does not have an active mapping for the embedded payload, the NAT SHOULD silently drop the ICMP Error packet. If the NAT has active mapping for the embedded payload, then the NAT MUST do the following prior to forwarding the packet, unless explicitly overridden by local policy.
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>Revert the IP and transport headers of the embedded IP packet to their original form, using the matching mapping; and
</dd>
<dt>b.</dt>
<dd>Leave the ICMP Error type and code unchanged; and
</dd>
<dt>c.</dt>
<dd>If the NAT enforces Basic NAT function, and the NAT has active mapping for the IP address that sent the ICMP Error, translate the source IP address of the ICMP Error packet with the public IP address in the mapping. In all other cases, translate the source IP address of the ICMP Error packet with its own public IP address.
</dd>
</dl></blockquote><p>
</p>
<blockquote class="text">
<p>Status: Same as REQ-5 in RFC5508
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-6: While processing an ICMP Error packet pertaining to an ICMP Query or Query response message, a NAT device MUST NOT refresh or delete the NAT Session that pertains to the embedded payload within the ICMP Error packet.
</p>
<blockquote class="text">
<p>Status: Same as REQ-6 in RFC5508
</p>
<p>Justification: This requirement ensures that the NAT Session will not be modified if someone is able to spoof ICMP Error messages for the session. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-7: LSN devices MUST support the traversal of hairpinned ICMP Query sessions and Error messages.
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>When forwarding a hairpinned ICMP Error message, the NAT device MUST translate the destination IP address of the outer IP header to be same as the source IP address of the embedded IP packet after the translation
</dd>
</dl></blockquote><p>
</p>
<blockquote class="text">
<p>Status: "NAT devices enforcing Basic NAT MUST support the traversal of hairpinned ICMP Query sessions. All NAT devices (i.e., Basic NAT as well as NAPT devices) MUST support the traversal of hairpinned ICMP Error messages." is REQ-7 in RFC5508. LSN is kind of Basic NATs, and is enforced Basic NAT behavior, so LSN MUST support ICMP Query and Error messages.
</p>
<p>Justification: This requirement is necessary for current applications to work correctly. More detailed description can be found in original RFC.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-8: When a NAT device is unable to establish a NAT Session for a new transport-layer (TCP, UDP, ICMP, etc.) flow due to resource constraints or administrative restrictions, the NAT device SHOULD send an ICMP destination unreachable message, with a code of 13 (Communication administratively prohibited) to the sender, and drop the original packet.
</p>
<blockquote class="text">
<p>Status: Same as REQ-8 in RFC5508
</p>
<p>Justification: LSN, limiting the number of the LSN external ports of UDP/TCP per CPE, often unable to establish new NAT session for a CPE, because the CPE use many sessions. In this case, LSN SHOULD send an ICMP destination unreachable message or some applications maybe not work well.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-9: A NAT device MAY implement a policy control that prevents ICMP messages being generated toward certain interface(s). Implementation of such a policy control overrides the MUSTs and SHOULDs in REQ-10.
</p>
<p>ICMP-REQ-10: Unless overridden by REQ-9's policy, a NAT device needs to support ICMP messages as below, some conforming to Section 4.3 of [RFC1812] and some superseding the requirements of Section 4.3 of [RFC1812]:
</p>
<blockquote class="text">
<p>a) MUST support:
	</p>
<ol class="text">
<li>Destination Unreachable Message
</li>
<li>Time Exceeded Message
</li>
<li>Echo Request/Reply Messages
</li>
</ol>
	

<p>b) MAY support:
	</p>
<ol class="text">
<li>Redirect Message
</li>
<li>Timestamp and Timestamp Reply Messages
</li>
<li>Source Route Options
</li>
<li>Address Mask Request/Reply Message
</li>
<li>Parameter Problem Message
</li>
<li>Router Advertisement and Solicitations
</li>
</ol>
	

<p>c) SHOULD NOT support
	</p>
<ol class="text">
<li>Source Quench Message
</li>
<li>Information Request/reply
</li>
</ol>
	

</blockquote><p>

</p>
<p>
In addition, a NAT device is RECOMMENDED to conform to the following implementation considerations:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>d) DS Field Usage
</dd>
<dt>b.</dt>
<dd>e) When Not to Send ICMP Errors
</dd>
<dt>c.</dt>
<dd>f) Rate Limiting
</dd>
</dl></blockquote><p>
</p>
<blockquote class="text">
<p>Status: Same as REQ-9, REQ-10 in RFC5508
</p>
<p>Justification: These are for conformance to RFC 1812.
</p>
</blockquote><p>

</p>
<p>ICMP-REQ-11: A NAT MAY drop or appropriately handle Non-QueryError ICMP messages.
</p>
<blockquote class="text">
<p>Status: Same as REQ-11 in RFC5508
</p>
<p>Justification: NAT devices may handle of Non-QueryError ICMP messages.
</p>
</blockquote><p>

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
LSN specified Requirements</h3>

<p>ORIG-REQ-1: A LSN MUST allocate one external IP address to each CPE.
	</p>
<blockquote class="text">
<p>a) LSN external IP address allocated to the CPE MUST be same for the UDP, TCP and ICMP.
</p>
</blockquote><p>
	
</p>
<p>
   	Justification: If a LSN allocates multiple LSN external IP addresses to each CPE, some applications might not work.
   	
</p>
<p>
   	ORIG-REQ-2: A LSN MUST allocate LSN external ports which is mapped for CPE ports of UDP.
   	</p>
<blockquote class="text">
<p>
  	 	a) A LSN MAY reuse LSN external port after a NAT UDP mapping timer expires.
  	 	
</p>
<p> 
   		b) A LSN SHOULD limit the number of the LSN external ports of UDP per CPE.
   		
</p>
<p>
   		c) The number of the LSN external ports of UDP per CPE which LSN can allocate SHOULD be 
		configurable for the administrator of LSN.
   		
</p>
</blockquote><p>	
	
</p>
<p>
   	Justification: CPEs can communicate to CPE external realm fairly by limiting the number of LSN external ports per CPE.
   	
</p>
<p>
   	ORIG-REQ-3: A LSN MUST allocate LSN external ports which is mapped for CPE ports of TCP.
   	

		</p>
<blockquote class="text">
<p>
  		a) A LSN MAY reuse LSN external port while the port is allocated for no session originated  by any CPE.
   		
</p>
<p>
  		b) A LSN SHOULD limit the number of the LSN external ports of TCP per CPE.
   		
</p>
<p>
  		c) The number of the LSN external ports of TCP per CPE SHOULD be an administratively  configurable option.
   		
</p>
<p>
  		e)  A LSN SHOULD limit the number of the new sessions of TCP per time unit and per CPE.
   		
</p>
</blockquote><p>
	
</p>
<p>
  	Justification: CPEs can communicate to CPE external realm fairly by limiting the number of LSN external 
	ports per CPE. In addition, TCP LSN external port MAY have TCP sessions, and therefore the 
	TCP session timer is necessary for every 5-Tuple. LSN can have not only the limitations of the number of 
	LSN external ports but also TCP sessions per CPE. Thus a LSN can prevent denial of service attacks with the tons of 
	TCP open and close by malicious CPEs. 
	
</p>
<p>
  	ORIG-REQ-4: A LSN MUST allocate LSN external identifiers which is mapped for CPE identifiers of ICMP.

	</p>
<blockquote class="text">
<p>
  		a) A LSN MAY reuse LSN external identifier after an ICMP Query session timer expires.
  		
</p>
<p>
  		b) A LSN SHOULD limit the number of the LSN external identifier allocated per CPE.
  		
</p>
<p>
  		c) The number of the LSN external identifiers per CPE which LSN can allocate SHOULD be an administratively configurable option.
		
</p>
</blockquote><p>
	
</p>
<p>
 	Justification: CPEs can communicate to CPE external realm fairly by limiting the number of LSN external identifiers every CPE. 
      	
</p>
<p>
If a CPE has already consumed many LSN external ports, the CPE might not use new ports because LSNs limit the number of ports.
 	
</p>
<p>
ORIG-REQ-5: A LSN MAY have implementations that some specific applications can work well even if each CPE's usable number of LSN external ports have already consumed.

</p>
<p>

Justification: Some specific applications don't work well due to limitation of number of number of ports by LSN, therefore other applications might be affected in the same CPE.


</p>
<p>
In Section 7 we discuss in detail.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
 Identifying particular users (BOTs, spammers, etc)</h3>

<p>
It is necessary for network administrators to identify a user
from an IP address and a timestamp in order to deal with abuse
and lawful intercept. When multiple users share one external
address at LSN, the source address and the source port that
are visible at the destination host are translated ones.
The following mechanisms can be used to identify the user that
transmitted a certain packet.
	
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Store Translation Log</h3>

<p>
One mechanism stores the following information at LSN.
		
</p>
<p>
		</p>
<blockquote class="text">
<p>- destination address
</p>
<p>- destination port
</p>
<p>- translated source address
</p>
<p>- translated source port
</p>
<p>- untranslated source address
</p>
<p>- untranslated source port
</p>
<p>- timestamp
</p>
</blockquote><p>
		
</p>
<p>
In such environment that one LSN accommodates a lot of users or
processes large amount of traffic, the amount of log will be
so large and the operator has to prepare large volume of storage.
		
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Fixed port assignment</h3>

<p>
To save costs for storage, one can adopt this port assignment
mechanism at LSN. By fixing the range of external port per user/CPE,
and having the mapping of internal IP address to external IP
address and port, there will be no need to store per session log.
Note that this mechanism is possible only if the source
port is known as well as the source address, the destination
address and the destination port.
		
</p>
<a name="port_limitation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Considerations about limiting the number of LSN external ports</h3>

<p>
 	As discussed in section 3, LSN limits the number of LSN external ports and identifier per CPE. Therefore some important applications like DNS might not work well due to applications consuming many LSN external ports.

</p>
<p>
There are two ways to solve this issue.
The one is that particular applications are out of the targets for the number of port limitation for LSN.
In the case, the applications should be configurable for the administrator of LSN.

</p>
<p>
The other is that LSN doesn't translate address or port for some specific applications, moreover it doesn't limit the number of LSN external ports.(we call "LSN pass-through")
Therefore, LSN behave as a router.
In this case, some specific applications are out of limitation for the number of LSN external ports.
Some applications, which don't work well due to address translation like FTP, is effective.
Reducing costs of translation is also effective.
As a condition, administrators of LSN can control SPS which become a target of LSN pass-through. 
 	
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  X1:x1             X1':x1'            X2:x2
  +---+from X1:x1  +---+fromX1:x1     +---+
  |   |to X2:x2    |   | to X2:x2     |   |
  | C |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| L |&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;| S |
  | P |            | S |              | P |
  | E |&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;| N |&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;| S |
  |   |from X2:x2  |   |fromX2:x2     |   |
  +---+ to X1:x1   +---+ to X1:x1     +---+


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 3. LSN pass-through&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
No matter which solutions you choose, you should consider which applications you are out of limitation target for the number of LSN external ports.
When you choose too many applications, this might cause LSNs large load.

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>There are no IANA considerations.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
	If malicious CPE can camouflage CPE 3-Tuple, the malicious CPE MAY prevent a normal 
	CPE from sending data to external realm. 
	Therefore, an operator SHOULD make policies to prevent a spoofing of CPE 3-tuple.
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>
Thanks for the input and review by Yasuhiro Shirasaki, Takeshi
Tomochika, Kousuke Shishikura, Dai Kuwabara, Tomoya Yoshida, Takanori
Mizuguchi, Arifumi Matsumoto, Tomohiro Fujisaki
	
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3022">[RFC3022]</a></td>
<td class="author-text">Srisuresh, P. and K. Egevang, &ldquo;<a href="http://tools.ietf.org/html/rfc3022">Traditional IP Network Address Translator (Traditional NAT)</a>,&rdquo; RFC&nbsp;3022, January&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3022.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4787">[RFC4787]</a></td>
<td class="author-text">Audet, F. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>,&rdquo; BCP&nbsp;127, RFC&nbsp;4787, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4787.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5382">[RFC5382]</a></td>
<td class="author-text">Guha, S., Biswas, K., Ford, B., Sivakumar, S., and P. Srisuresh, &ldquo;<a href="http://tools.ietf.org/html/rfc5382">NAT Behavioral Requirements for TCP</a>,&rdquo; BCP&nbsp;142, RFC&nbsp;5382, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5382.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5508">[RFC5508]</a></td>
<td class="author-text">Srisuresh, P., Ford, B., Sivakumar, S., and S. Guha, &ldquo;<a href="http://tools.ietf.org/html/rfc5508">NAT Behavioral Requirements for ICMP</a>,&rdquo; BCP&nbsp;148, RFC&nbsp;5508, April&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5508.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.shirasaki-nat444-isp-shared-addr">[I-D.shirasaki-nat444-isp-shared-addr]</a></td>
<td class="author-text">Shirasaki, Y., Miyakawa, S., Nakagawa, A., Yamaguchi, J., and H. Ashida, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-shirasaki-nat444-isp-shared-addr-03.txt">NAT444 addressing models</a>,&rdquo; draft-shirasaki-nat444-isp-shared-addr-03 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-shirasaki-nat444-isp-shared-addr-03.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative Reference</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-softwire-dual-stack-lite">[I-D.ietf-softwire-dual-stack-lite]</a></td>
<td class="author-text">Durand, A., Droms, R., Haberman, B., Woodyatt, J., Lee, Y., and R. Bush, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-04.txt">Dual-Stack Lite Broadband Deployments Following IPv4 Exhaustion</a>,&rdquo; draft-ietf-softwire-dual-stack-lite-04 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-softwire-dual-stack-lite-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ymbk-aplusp">[I-D.ymbk-aplusp]</a></td>
<td class="author-text">Bush, R., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ymbk-aplusp-05.txt">The A+P Approach to the IPv4 Address Shortage</a>,&rdquo; draft-ymbk-aplusp-05 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ymbk-aplusp-05.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ikuhei Yamagata</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Communications Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gran Park Tower 17F, 3-4-1 Shibaura, Minato-ku</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  108-8118</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 50 3812 4704</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ikuhei@nttv6.jp">ikuhei@nttv6.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tomohiro Nishitani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Communications Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gran Park Tower 17F, 3-4-1 Shibaura, Minato-ku</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  108-8118</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 50 3812 4742</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tomohiro.nishitani@ntt.com">tomohiro.nishitani@ntt.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shin Miyakawa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Communications Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gran Park Tower 17F, 3-4-1 Shibaura, Minato-ku</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  108-8118</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 50 3812 4695</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:miyakawa@nttv6.jp">miyakawa@nttv6.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Akira Nakagawa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">KDDI CORPORATION</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">GARDEN AIR TOWER, 3-10-10, Iidabashi, Chiyoda-ku</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tokyo  102-8460</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ai-nakagawa@kddi.com">ai-nakagawa@kddi.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hiroyuki Ashida</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">its communications Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">541-1 Ichigao-cho Aoba-ku</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yokohama  225-0024</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ashida@itscom.ad.jp">ashida@itscom.ad.jp</a></td></tr>
</table>
</body></html>
