<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A SIP Event Package for Subscribing to Changes to an HTTP Resource</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A SIP Event Package for Subscribing to Changes to an HTTP Resource">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP WG</td><td class="header">A. Roach</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Tekelec</td></tr>
<tr><td class="header">Expires: May 24, 2009</td><td class="header">November 20, 2008</td></tr>
</table></td></tr></table>
<h1><br />A SIP Event Package for Subscribing to Changes to an HTTP Resource<br />draft-roach-sip-http-subscribe-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 24, 2009.</p>

<h3>Abstract</h3>

<p>
      The Session Initiation Protocol (SIP) is increasingly being
      used in systems that are tightly coupled with Hypertext
      Transport Protocol (HTTP) servers for a variety of
      reasons. In many of these cases, applications
      can benefit from being able to discover, in near-real-time,
      when a specific HTTP resource is created, changed, or
      deleted. This document proposes a mechanism, based on
      the SIP events framework, for doing so.
    
</p>
<p>
      This document further proposes that the HTTP work necessary
      to make such a mechanism work be extensible to support protocols
      other than SIP for monitoring HTTP resources.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Associating a Monitoring URI with an HTTP URL<br />
<a href="#package">3.</a>&nbsp;
HTTP Change Event Package<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Event Package Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
Event Package Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.3.</a>&nbsp;
SUBSCRIBE Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.4.</a>&nbsp;
Subscription Duration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#notify-bodies">3.5.</a>&nbsp;
NOTIFY Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#httpfrag">3.5.1.</a>&nbsp;
Formal definition of message/httpfrag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.5.2.</a>&nbsp;
Use of message/httpfrag in HTTP Monitor Event Package<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.6.</a>&nbsp;
Notifier processing of SUBSCRIBE requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#notifier-subscribe">3.7.</a>&nbsp;
Notifier generation of NOTIFY requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.8.</a>&nbsp;
Subscriber processing of NOTIFY requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.9.</a>&nbsp;
Handling of forked requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.10.</a>&nbsp;
Rate of notifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.11.</a>&nbsp;
State Agents<br />
<a href="#anchor13">4.</a>&nbsp;
Example Message Flow<br />
<a href="#anchor14">5.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.1.</a>&nbsp;
New Link Relation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.2.</a>&nbsp;
New SIP Event Package<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.3.</a>&nbsp;
New message/httpfrag MIME Type<br />
<a href="#anchor18">6.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
      The Session Initiation Protocol (SIP) 
      <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>
      is increasingly being
      used in systems that are tightly coupled with Hypertext
      Transport Protocol (HTTP) 
      <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>
      servers for a variety of
      reasons.  In many of these cases, applications
      can benefit from learning of changes to specified
      HTTP resources in near-real-time. For example,
      user agent terminals may elect to store service-related
      data in an HTTP tree, such as is described in 
      <a class='info' href='#I-D.griffin-bliss-rest'>[I&#8209;D.griffin&#8209;bliss&#8209;rest]<span> (</span><span class='info'>Griffin, K. and J. Rosenberg, &ldquo;Representational State Transfer (REST) for Feature Configuration in Session  Initiation Protocol (SIP),&rdquo; October&nbsp;2008.</span><span>)</span></a>
      and
      <a class='info' href='#I-D.zourzouvillys-bliss-ach-config-requirements'>[I&#8209;D.zourzouvillys&#8209;bliss&#8209;ach&#8209;config&#8209;requirements]<span> (</span><span class='info'>Zourzouvillys, T., &ldquo;Automatic Call Handling (ACH) Configuration Requirements,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
      When such configuration information is stored and retrieved
      using HTTP, clients may need to be informed when information
      changes, so as to make appropriate changes to their local behavior
      and user interface.
    
</p>
<p>
      This document defines a mechanism, based on the SIP Event Framework
      <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>, for subscribing to changes in
      the resource referenced by an HTTP server. It further defines
      a mechanism by which the proper SIP and/or SIPS URI to be
      used for such subscriptions can be determined from the HTTP
      server.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Associating a Monitoring URI with an HTTP URL</h3>

<p>
      One of the key challenges in subscribing to the changes
      of a resource indicated by an HTTP URL is determining
      which SIP URI corresponds to a specific HTTP URL. This
      specification takes the approach of having the HTTP
      server responsible for the URL in question select
      an appropriate SIP URI for the corresponding resource,
      and to return that URI within an HTTP transaction.
    
</p>
<p>
      In particular, HTTP servers use the HTTP Link: header
      <a class='info' href='#I-D.nottingham-http-link-header'>[I&#8209;D.nottingham&#8209;http&#8209;link&#8209;header]<span> (</span><span class='info'>Nottingham, M., &ldquo;HTTP Header Linking,&rdquo; July&nbsp;2008.</span><span>)</span></a>
      with a relation type of "monitor" to convey the URI that
      can be used to discover changes to the resource. This document
      defines behavior for SIP and SIPS URIs in this header.
      Handling for other URI schemes is out of scope for the
      current document, although we expect future specifications
      to define procedures for monitoring via other protocols.
    
</p>
<p>
      Because a single resource may have the ability to be monitored
      via multiple protocols, it is perfectly legal for an HTTP
      response to contain
      multiple "Link:" headers with a relation type of "monitor".
      Implementors are cautioned to search the entire HTTP response
      header block to locate a "Link:" header that corresponds with
      their preferred change monitoring protocol.
    
</p>
<p>
      If an HTTP server provides the ability to subscribe to a
      changes in a resource's value using this event package, it
      MUST return a Link: header containing a SIP or SIPS URI
      with a relation type of "monitor" in any successful response
      to a GET or HEAD request on that resource. It MAY return both.
    
</p>
<p>
      A client wishing to subscribe to the change state of an HTTP
      resource obtains a SIP or SIPS URI by sending a GET or
      HEAD request to the HTTP URL it wishes to monitor. This SIP or
      SIPS URI is then used in a SUBSCRIBE request, according to the
      event package defined in section <a class='info' href='#package'>Section&nbsp;3<span> (</span><span class='info'>HTTP Change Event Package</span><span>)</span></a>.
    
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
            
            [This indented text to be removed before publication
            as an RFC]
            <br />

          
</dd>
<dt></dt>
<dd>
            
            Several potential mechanisms for retrieving the SIP
            URI from the HTTP server were evaluated. Of them,
            the HTTP Link: header was determined to have the most
            favorable set of properties. Two key candidates
            that were considered but rejected in favor of Link:
            are discussed below.
            <br />

          
</dd>
<dt></dt>
<dd>
            
            The HTTP PROPFIND method (<a class='info' href='#RFC4918'>[RFC4918]<span> (</span><span class='info'>Dusseault, L., &ldquo;HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV),&rdquo; June&nbsp;2007.</span><span>)</span></a>, section 9.1)
            can be used to retrieve the value of a
            specific property associated with an HTTP URL.
            However, this cannot be done in conjunction with
            retrieval of the document itself, which is
            usually desirable. If a PROPFIND approach is
            employed, clients will typically perform both a
            GET and a PROPFIND on resources of interest.
            Additionally, the use of PROPFIND requires
            support of the PROPFIND method in HTTP User
            Agents -- which, although fairly well implemented,
            still lacks the penetration of GET implementations.
            <br />

          
</dd>
<dt></dt>
<dd>
            
            Similar to PROPFIND, XRDS 
            <a class='info' href='#XRI_Resolution_2.0'>[XRI_Resolution_2.0]<span> (</span><span class='info'>Wachob, G., Reed, D., Chasen, L., Tan, W., and S. Churchill, &ldquo;Extensible Resource Identifier (XRI) Resolution V2.0,&rdquo; .</span><span>)</span></a>
            can be used to retrieve properties associated with
            an HTTP URL. It has the advantage of using GET
            instead of PROPFIND; however, it suffers from both
            the two-round-trip issue discussed above, as well
            as an unfortunately large number of options in specifying
            how to retrieve the properties.
            <br />

          
</dd>
</dl></blockquote>

<a name="package"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
HTTP Change Event Package</h3>

<p>
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Event Package Name</h3>

<p>
            The name of this event package is "http-monitor".
          
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Event Package Parameters</h3>

<p>
            This event package defines no parameters.
            [TODO: should we define a simple filter that
            allows subscribers to request the body be sent
            in notifications? Something like "body=true"?]
          
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
SUBSCRIBE Bodies</h3>

<p>
            This event package defines no bodies to be used
            in the SUBSCRIBE message. Future extensions
            may define filter criteria to be sent in the
            SUBSCRIBE bodies.
          
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Subscription Duration</h3>

<p>
           Reasonable values for the duration of subscriptions
           to the http-monitor event package vary widely with the
           nature of the HTTP resource being monitored. 
           Some HTTP resources change infrequently (if ever),
           while other can change comparatively rapidly. For
           rapidly changing documents, the ability to recover
           more rapidly from a subscription failure is relatively
           important, so implementations will be well served by
           selecting smaller durations for their subscriptions,
           on the order of 1800 to 3600 seconds (30 minutes to
           an hour).
          
</p>
<p>
           Subscriptions to slower-changing resources lack
           this property, and the need to periodically refresh
           subscriptions render short subscriptions wasteful. For
           these type of subscriptions, expirations as long as
           604800 (one week) or even longer may well make sense.
          
</p>
<p>
            Given the broad range of reasonable expirations
            involved, selecting a single default expiration
            is somewhat tricky. However, in the absence of
            an expires value in a subscription, the notifier
            shall assume a default expiration value of 86400
            (one day).
          
</p>
<a name="notify-bodies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
NOTIFY Bodies</h3>

<p>
            By default, the bodies of NOTIFY messages for the
            http-monitor event package will be of content-type
            "message/httpfrag". This content-type is defined
            below, as is its use in the http-monitor event package.
          
</p>
<a name="httpfrag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1"></a><h3>3.5.1.&nbsp;
Formal definition of message/httpfrag</h3>

<p>
	     A valid message/httpfrag part is one that could be
	     obtained by starting with some valid HTTP message and
	     deleting any of the following:
	   
</p>
<p></p>
<ul class="text">
<li>the entire start line
</li>
<li>one or more entire header fields
</li>
<li>the body
</li>
</ul>

<p>
             The following Augmented Backus-Naur Form (ABNF) 
             <a class='info' href='#RFC2234'>[RFC2234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; November&nbsp;1997.</span><span>)</span></a> rule
             describes a message/httpfrag part using the HTTP grammar
             elements defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
             The expansion of any element
             is subject to the restrictions on valid HTTP message
             syntax defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
           
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     httpfrag = [ start-line ]
                *(message-header CRLF)
                [ CRLF [ message-body ] ]
</pre></div>
<p>
             If the message/httpfrag part contains a body, it MUST
             also contain the appropriate header fields describing
             that body (such as Content-Length) and the blank line
             separating the headers from the body.
           
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.2"></a><h3>3.5.2.&nbsp;
Use of message/httpfrag in HTTP Monitor Event Package</h3>

<p>
              The message/httpfrag NOTIFY bodies used in the HTTP
              monitor event package represent a subset of the HTTP
              response that would be returned if the client used
              an HTTP GET to retrieve the HTTP resource. Except for
              the normative constraints described in the remainder
              of this section, the notifier MAY include any arbitrary
              subset of the HTTP response, including the entire set
              of headers.
            
</p>
<p>
              An example of a message/httpfrag body as used in this
              event package is shown below.
            
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  ETag: 38fe6-58b-1840e7d0
  Last-Modified: Sat, 13 Nov 2010 23:29:00 GMT
  Content-MD5: 4e3b50421829c7c379a5c6154e560449
</pre></div>
<p>
              When used in the HTTP monitor event package defined in 
              this document, the message/httpfrag MUST contain
              at least one of an ETag or Content-MD5 header, unless
              returning a null state as described in
              <a class='info' href='#notifier-subscribe'>Section&nbsp;3.7<span> (</span><span class='info'>Notifier generation of NOTIFY requests</span><span>)</span></a>. It MAY contain
              both. Inclusion of a Last-Modified header is
              also RECOMMENDED.
            
</p>
<p>
              When used in the HTTP monitor event package,
              the message/httpfrag MUST NOT contain a message-body
              component, unless the corresponding subscription
              has explicitly indicated the desire to receive such
              bodies in the form of a filter. Filters for this
              event package are out of scope for this specification.
            
</p>
<p>
              If the change to the resource being communicated 
              represents a modification of the resource's value, the
              message/httpfrag MAY contain a start line. If present, this
              start line will contain a the same 2xx-class HTTP
              response that would be returned if a user agent
              attempted to access the HTTP resource with
              a GET request (e.g., "200 OK").
            
</p>
<p>
              If the change to the resource being communicated 
              represents a renaming of the HTTP resource, the
              message/httpfrag MUST contain a start line; this
              start line will contain a the same 3xx-class HTTP
              response that would be returned if a user agent
              attempted to access the relocated HTTP resource with
              a GET request (e.g., "301 Moved Permanently").
              The message/httpfrag also SHOULD contain a Location:
              header that communicates the new name of the
              resource.
            
</p>
<p>
              If the change to the resource being communicated 
              represents a deletion of the HTTP resource, the
              message/httpfrag MUST contain a start line; this
              start line will contain a the same 4xx-class HTTP
              response that would be returned if a user agent
              attempted to access the missing HTTP resource with
              a GET request (e.g., "404 Not Found" or "410 Gone").
            
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Notifier processing of SUBSCRIBE requests</h3>

<p>
            Upon receipt of a SUBSCRIBE request, the notifier
            applies authorization according to local policy.
            Typically, this policy will be aligned with the
            HTTP server authorization policies regarding access
            to the resource whose change state is being requested.
          
</p>
<a name="notifier-subscribe"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.7"></a><h3>3.7.&nbsp;
Notifier generation of NOTIFY requests</h3>

<p>
            NOTIFY messages should be generated whenever the
            underlying resource indicated by the corresponding
            HTTP URL has been modified.
          
</p>
<p>
            In the case that the NOTIFIER has insufficient information
            to return any useful information about the underlying
            HTTP resource, it may return a message/httpfrag
            that is zero bytes long (which is a proper empty subset
            of the syntax described in section <a class='info' href='#httpfrag'>Section&nbsp;3.5.1<span> (</span><span class='info'>Formal definition of message/httpfrag</span><span>)</span></a>).
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.8"></a><h3>3.8.&nbsp;
Subscriber processing of NOTIFY requests</h3>

<p>
            Upon receipt of a NOTIFY message, subscriber should use
            any information in the message/httpfrag to update its
            view of the underlying HTTP resource. In most cases,
            this results in an invalidation of its view of the
            HTTP resource. It is up to the subscriber implementation
            to decide whether it is appropriate to fetch a new copy
            of the HTTP resource as a reaction to a NOTIFY message.
          
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.9"></a><h3>3.9.&nbsp;
Handling of forked requests</h3>

<p>
            Multiple notifiers for a single HTTP resource
            is semantically nonsensical. In the aberrant
            circumstance that a SUBSCRIBE request is forked,
            the SUBSCRIBER SHOULD terminate all but one
            subscription, as described in section 4.4.9
            of RFC 3265 <a class='info' href='#RFC3265'>[RFC3265]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
          
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.10"></a><h3>3.10.&nbsp;
Rate of notifications</h3>

<p>
            Because the data stored in HTTP for the
            purpose of SIP services may change rapidly
            due to user input, and because it may potentially
            be rendered to users and/or used to impact call
            routing, a high degree of responsiveness is
            appropriate. However, for the protection of
            the network, notifiers for the http-monitor event
            package SHOULD NOT send notifications
            more frequently than once every second.
          
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.11"></a><h3>3.11.&nbsp;
State Agents</h3>

<p>
            Decomposition of the authority for the HTTP
            resource into an HTTP Server and a SIP Events
            Server is likely to be useful, due to the
            potentially different scaling properties
            associated with serving HTTP resources and
            managing subscriptions. In the case of such
            decomposition, implementors are encouraged
            to familiarize themselves with the PUBLISH
            mechanism described in RFC 3903
            <a class='info' href='#RFC3903'>[RFC3903]<span> (</span><span class='info'>Niemi, A., &ldquo;Session Initiation Protocol (SIP) Extension for Event State Publication,&rdquo; October&nbsp;2004.</span><span>)</span></a>.
          
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Example Message Flow</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     Subscriber          HTTP Server      SIP Events Server
          |                   |                   |
          |                   |                   |
          |(1) HTTP GET       |                   |
          |------------------&gt;|                   |
          |(2) HTTP 200 OK    |                   |
          |&lt;------------------|                   |
          |(3) SIP SUBSCRIBE  |                   |
          |--------------------------------------&gt;|
          |(4) SIP 200 OK     |                   |
          |&lt;--------------------------------------|
          |(5) SIP NOTIFY     |                   |
          |&lt;--------------------------------------|
          |(6) SIP 200 OK     |                   |
          |--------------------------------------&gt;|
          |                   |(7) SIP PUBLISH    |
          |                   |------------------&gt;|
          |                   |(8) SIP 200 OK     |
          |                   |&lt;------------------|
          |(9) SIP NOTIFY     |                   |
          |&lt;--------------------------------------|
          |(10) SIP 200       |                   |
          |--------------------------------------&gt;|
          |                   |                   |
          |                   |                   |
</pre></div>
<p>
      [TBD: include full example messages]
    
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
      [TBD: these sections need some prose to describe
      which registry we're putting the values in to]
    
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
New Link Relation</h3>

<p></p>
<ul class="text">
<li> Relation Name: monitor
</li>
<li> Description: Refers to a resource that can be used to monitor 
            changes.
</li>
<li> Reference: RFC XXXX [[Note to RFC Editor: replace 
                                with the RFC number for this specification]]
</li>
</ul>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
New SIP Event Package</h3>

<p></p>
<blockquote class="text"><dl>
<dt>Package Name:</dt>
<dd> http-monitor
</dd>
<dt>Type:</dt>
<dd> package
</dd>
<dt>Contact:</dt>
<dd> Adam Roach, adam.roach@tekelec.com
</dd>
<dt>Reference:</dt>
<dd> RFC XXXX [[Note to RFC Editor: replace 
                                with the RFC number for this specification]]
</dd>
</dl></blockquote>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
New message/httpfrag MIME Type</h3>

<p>
        This document proposes a new message/httpfrag
        Message Media Type, to be registered at 
        http://www.iana.org/assignments/media-types/message/.
        This body type is described in section 
        <a class='info' href='#notify-bodies'>Section&nbsp;3.5<span> (</span><span class='info'>NOTIFY Bodies</span><span>)</span></a>
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Media Type name:         message
Media subtype name:      httpfrag
Required parameters:     none
Optional parameters:     version, msgtype
</pre></div>
<p></p>
<blockquote class="text"><dl>
<dt>version:</dt>
<dd>The HTTP-Version number of the enclosed message
                 (e.g., "1.1"). If not present, the version can be
                 determined from the first line of the body.
</dd>
<dt>msgtype:</dt>
<dd>The message type -- "request" or "response".
</dd>
</dl></blockquote>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Encoding considerations: only "7bit", "8bit", or "binary" are
                         permitted
Security considerations: none
</pre></div>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p>
      Thanks to Lisa Dusseault and Mark Nottingham for significant
      input on the mechanisms to bind an HTTP URL to a SIP URI.
      Thanks to Robert Sparks for the message/sipfrag
      specification, from which the message/httpfrag definition
      was lifted wholesale.
    
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2234">[RFC2234]</a></td>
<td class="author-text"><a href="mailto:dcrocker@imc.org">Crocker, D., Ed.</a> and <a href="mailto:paulo@turnpike.com">P. Overell</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; RFC&nbsp;2234, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2234.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2234.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2234.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3265">[RFC3265]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.nottingham-http-link-header">[I-D.nottingham-http-link-header]</a></td>
<td class="author-text">Nottingham, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-nottingham-http-link-header-02.txt">HTTP Header Linking</a>,&rdquo; draft-nottingham-http-link-header-02 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-nottingham-http-link-header-02.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3903">[RFC3903]</a></td>
<td class="author-text">Niemi, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3903">Session Initiation Protocol (SIP) Extension for Event State Publication</a>,&rdquo; RFC&nbsp;3903, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3903.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4918">[RFC4918]</a></td>
<td class="author-text">Dusseault, L., &ldquo;<a href="http://tools.ietf.org/html/rfc4918">HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)</a>,&rdquo; RFC&nbsp;4918, June&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.griffin-bliss-rest">[I-D.griffin-bliss-rest]</a></td>
<td class="author-text">Griffin, K. and J. Rosenberg, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-griffin-bliss-rest-00.txt">Representational State Transfer (REST) for Feature Configuration in Session  Initiation Protocol (SIP)</a>,&rdquo; draft-griffin-bliss-rest-00 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-griffin-bliss-rest-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.zourzouvillys-bliss-ach-config-requirements">[I-D.zourzouvillys-bliss-ach-config-requirements]</a></td>
<td class="author-text">Zourzouvillys, T., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-zourzouvillys-bliss-ach-config-requirements-00.txt">Automatic Call Handling (ACH) Configuration Requirements</a>,&rdquo; draft-zourzouvillys-bliss-ach-config-requirements-00 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-zourzouvillys-bliss-ach-config-requirements-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XRI_Resolution_2.0">[XRI_Resolution_2.0]</a></td>
<td class="author-text">Wachob, G., Reed, D., Chasen, L., Tan, W., and S. Churchill, &ldquo;<a href="http://docs.oasis-open.org/xri/2.0/specs/xri-resolution-V2.0.html">Extensible Resource Identifier (XRI) Resolution V2.0</a>&rdquo; (<a href="http://docs.oasis-open.org/xri/2.0/specs/xri-resolution-V2.0.pdf">PDF</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adam Roach</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tekelec</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">17210 Campbell Rd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 250</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dallas, TX  75252</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:adam@nostrum.com">adam@nostrum.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
