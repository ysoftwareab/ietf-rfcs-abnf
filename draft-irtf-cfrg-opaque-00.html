<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>The OPAQUE Asymmetric PAKE Protocol</title>
<meta content="Hugo Krawczyk" name="author">
<meta content="Kevin Lewi" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document describes the OPAQUE protocol, a secure asymmetric
password-authenticated key exchange (aPAKE) that supports mutual
authentication in a client-server setting without reliance on PKI and
with security against pre-computation attacks upon server compromise.
In addition, the protocol provides forward secrecy and the ability to
hide the password from the server, even during password registration.
This document specifies the core OPAQUE protocol, along with several
instantiations in different authenticated key exchange protocols. 
    " name="description">
<meta content="xml2rfc 3.1.1" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-irtf-cfrg-opaque-00" name="ietf.draft">
<link href="/tmp/draft-irtf-cfrg-opaque-00-vnxukn_q.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OPAQUE</td>
<td class="right">September 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Krawczyk, et al.</td>
<td class="center">Expires 1 April 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-irtf-cfrg-opaque-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-09-28" class="published">28 September 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-04-01">1 April 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">H. Krawczyk</div>
<div class="org">Algorand Foundation</div>
</div>
<div class="author">
      <div class="author-name">K. Lewi</div>
<div class="org">Facebook</div>
</div>
<div class="author">
      <div class="author-name">C.A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">The OPAQUE Asymmetric PAKE Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes the OPAQUE protocol, a secure asymmetric
password-authenticated key exchange (aPAKE) that supports mutual
authentication in a client-server setting without reliance on PKI and
with security against pre-computation attacks upon server compromise.
In addition, the protocol provides forward secrecy and the ability to
hide the password from the server, even during password registration.
This document specifies the core OPAQUE protocol, along with several
instantiations in different authenticated key exchange protocols.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/cfrg/draft-irtf-cfrg-opaque">https://github.com/cfrg/draft-irtf-cfrg-opaque</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 1 April 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-notation" class="xref">Requirements Notation</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-notation" class="xref">Notation</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-cryptographic-protocol-and-" class="xref">Cryptographic Protocol and Algorithm Dependencies</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-core-protocol" class="xref">Core Protocol</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-protocol-messages" class="xref">Protocol messages</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-offline-registration-stage" class="xref">Offline registration stage</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-registration-messages" class="xref">Registration messages</a><a href="#section-toc.1-1.3.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-registration-functions" class="xref">Registration functions</a><a href="#section-toc.1-1.3.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-online-authenticated-key-ex" class="xref">Online authenticated key exchange stage</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-authenticated-key-exchange-" class="xref">Authenticated key exchange messages</a><a href="#section-toc.1-1.3.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-authenticated-key-exchange-f" class="xref">Authenticated key exchange functions</a><a href="#section-toc.1-1.3.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-export-key" class="xref">Export Key</a><a href="#section-toc.1-1.3.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-ake-execution-and-party-ide" class="xref">AKE Execution and Party Identities</a><a href="#section-toc.1-1.3.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-authenticated-key-exchange-p" class="xref">Authenticated Key Exchange Protocol Instantiations</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-key-schedule-utility-functi" class="xref">Key Schedule Utility Functions</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-instantiation-with-hmqv-and" class="xref">Instantiation with HMQV and 3DH</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-hmqv-and-3dh-protocol-messa" class="xref">HMQV and 3DH protocol messages</a><a href="#section-toc.1-1.4.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-hmqv-and-3dh-key-derivation" class="xref">HMQV and 3DH key derivation</a><a href="#section-toc.1-1.4.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-instantiation-with-sigma-i" class="xref">Instantiation with SIGMA-I</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-sigma-protocol-messages" class="xref">SIGMA protocol messages</a><a href="#section-toc.1-1.4.2.3.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-sigma-key-derivation" class="xref">SIGMA key derivation</a><a href="#section-toc.1-1.4.2.3.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-configurations" class="xref">Configurations</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-configuration-choice" class="xref">Configuration Choice</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-static-diffie-hellman-oracl" class="xref">Static Diffie-Hellman Oracles</a><a href="#section-toc.1-1.6.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-input-validation" class="xref">Input validation</a><a href="#section-toc.1-1.6.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-user-authentication-versus-" class="xref">User authentication versus Authenticated Key Exchange</a><a href="#section-toc.1-1.6.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-oprf-hardening" class="xref">OPRF Hardening</a><a href="#section-toc.1-1.6.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-user-enumeration" class="xref">User enumeration</a><a href="#section-toc.1-1.6.2.6.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-password-salt-and-storage-i" class="xref">Password salt and storage implications</a><a href="#section-toc.1-1.6.2.7.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-performance-considerations" class="xref">Performance Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Password authentication is the prevalent form of authentication in
the web and in many other applications. In the most common
implementation, a user authenticates to a server by sending its user
ID and password to the server over a TLS connection. This makes
the password vulnerable to server mishandling, including accidentally
logging the password or storing it in cleartext in a database. Server
compromise resulting in access to these plaintext passwords is not an
uncommon security incident, even among security-conscious companies.
Moreover, plaintext password authentication over TLS is also vulnerable
to TLS failures, including many forms of PKI attacks, certificate
mishandling, termination outside the security perimeter, visibility
to middle boxes, and more.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Asymmetric (or augmented) Password Authenticated Key Exchange (aPAKE)
protocols are designed to provide password authentication and
mutually authenticated key exchange in a client-server setting without relying on PKI (except
during user/password registration) and without disclosing passwords
to servers or other entities other than the client machine. A secure
aPAKE should provide the best possible security for a password
protocol. Namely, it should only be open to inevitable attacks, such as
online impersonation attempts with guessed user passwords and offline
dictionary attacks upon the compromise of a server and leakage of its
password file. In the latter case, the attacker learns a mapping of
a user's password under a one-way function and uses such a mapping to
validate potential guesses for the password. Crucially important is
for the password protocol to use an unpredictable one-way mapping.
Otherwise, the attacker can pre-compute a deterministic list of mapped
passwords leading to almost instantaneous leakage of passwords upon
server compromise.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Despite the existence of multiple designs for
(PKI-free) aPAKE protocols, none of these protocols are secure against
pre-computation attacks. In particular, none of these protocols can
use the standard technique against pre-computation that combines
<em>secret</em> random values ("salt") into the one-way password mappings.
Either these protocols do not use salt at all or, if they do, they
transmit the salt from server to user in the clear, hence losing the
secrecy of the salt and its defense against pre-computation. Furthermore,
transmitting the salt may require additional protocol messages.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document describes OPAQUE, a PKI-free secure aPAKE that is secure
against pre-computation attacks and capable of using a secret salt.
OPAQUE provides forward secrecy (essential for
protecting past communications in case of password leakage) and the
ability to hide the password from the server - even during password
registration. Furthermore, OPAQUE enjoys good performance and an array of additional
features including the ability to increase
the difficulty of offline dictionary attacks via iterated hashing
or other hardening schemes, and offloading these operations to the
client (that also helps against online guessing attacks); extensibility of
the protocol to support storage and
retrieval of user's secrets solely based on a password; and being
amenable to a multi-server distributed implementation where offline
dictionary attacks are not possible without breaking into a threshold
of servers (such a distributed solution requires no change or awareness
on the client side relative to a single-server implementation).<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">OPAQUE is defined and proven as the composition of two functionalities:
an Oblivious PRF (OPRF) and an authenticated key-exchange (AKE) protocol. It can be seen
as a "compiler" for transforming any suitable AKE protocol into a secure
aPAKE protocol. (See <a href="#security-considerations" class="xref">Section 6</a> for requirements of the
OPRF and AKE protocols.) This document specifies OPAQUE instantiations based
on a variety of AKE protocols, including HMQV <span>[<a href="#HMQV" class="xref">HMQV</a>]</span>, 3DH <span>[<a href="#SIGNAL" class="xref">SIGNAL</a>]</span>
and SIGMA <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>. In general, the modularity of OPAQUE's design makes it
easy to integrate with additional AKE protocols, e.g., IKEv2, and with future
ones such as those based on post-quantum techniques.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">Currently, the most widely deployed (PKI-free) aPAKE is SRP <span>[<a href="#RFC2945" class="xref">RFC2945</a>]</span>, which is
vulnerable to pre-computation attacks, lacks a proof of security, and is less efficient
relative to OPAQUE. Moreover, SRP requires a ring as it mixes addition and
multiplication operations, and thus does not work over plain elliptic curves. OPAQUE
is therefore a suitable replacement for applications that use SRP.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This draft complies with the requirements for PAKE protocols set forth in
<span>[<a href="#RFC8125" class="xref">RFC8125</a>]</span>.<a href="#section-1-7" class="pilcrow">¶</a></p>
<div id="requirements-notation">
<section id="section-1.1">
        <h3 id="name-requirements-notation">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-notation" class="section-name selfRef">Requirements Notation</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="notation">
<section id="section-1.2">
        <h3 id="name-notation">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-notation" class="section-name selfRef">Notation</a>
        </h3>
<p id="section-1.2-1">The following terms are used throughout this document to describe the
operations, roles, and behaviors of OPAQUE:<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">Client (U): Entity which has knowledge of a password and wishes to authenticate.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">Server (S): Entity which authenticates clients using passwords.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">(skX, pkX): An AKE key pair used in role X; skX is the private key and pkX is
the public key. For example, (skU, pkU) refers to U's private and public key.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.4">kX: An OPRF private key used in role X. For example, kU refers to U's private OPRF
key.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.5">I2OSP and OS2IP: Convert a byte string to and from a non-negative integer as
described in <span>[<a href="#RFC8017" class="xref">RFC8017</a>]</span>. Note that these functions operate on byte strings in
big-endian byte order.<a href="#section-1.2-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.6">concat(x0, ..., xN): Concatenation of byte strings.
<code>concat(0x01, 0x0203, 0x040506) = 0x010203040506</code>.<a href="#section-1.2-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.7">random(n): Generate a random byte string of length <code>n</code> bytes.<a href="#section-1.2-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.8">
            <code>xor(a,b)</code>: XOR of byte strings; <code>xor(0xF0F0, 0x1234) = 0xE2C4</code>.
It is an error to call this function with two arguments of unequal
length.<a href="#section-1.2-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.9">
            <code>ct_equal(a, b)</code>: Return <code>true</code> if <code>a</code> is equal to <code>b</code>, and false otherwise.
This function is constant-time in the length of <code>a</code> and <code>b</code>, which are assumed
to be of equal length, irrespective of the values <code>a</code> or <code>b</code>.<a href="#section-1.2-2.9" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.2-3">Except if said otherwise, random choices in this specification refer to
drawing with uniform distribution from a given set (i.e., "random" is short
for "uniformly random"). Random choices can be replaced with fresh outputs from
a cryptographically strong pseudorandom generator, according to the requirements
in <span>[<a href="#RFC4086" class="xref">RFC4086</a>]</span>, or pseudorandom function.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">The name OPAQUE is a homonym of O-PAKE where O is for Oblivious (the name
OPAKE was taken).<a href="#section-1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="dependencies">
<section id="section-2">
      <h2 id="name-cryptographic-protocol-and-">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-cryptographic-protocol-and-" class="section-name selfRef">Cryptographic Protocol and Algorithm Dependencies</a>
      </h2>
<p id="section-2-1">OPAQUE relies on the following protocols and primitives:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
          <p id="section-2-2.1.1">Oblivious Pseudorandom Function (OPRF, <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span>):<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1.2.1">Blind(x): Convert input <code>x</code> into an element of the OPRF group, randomize it
by some value <code>r</code>, producing <code>M</code>, and output (<code>r</code>, <code>M</code>).<a href="#section-2-2.1.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.1.2.2">Evaluate(k, M): Evaluate input <code>M</code> using private key <code>k</code>, yielding output <code>Z</code>.<a href="#section-2-2.1.2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.1.2.3">Unblind(r, Z): Remove randomizer <code>r</code> from <code>Z</code>, yielding output <code>N</code>.<a href="#section-2-2.1.2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.1.2.4">Finalize(x, N, info): Compute the OPRF output using input <code>x</code>, <code>N</code>, and domain
separation tag <code>info</code>.<a href="#section-2-2.1.2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.1.2.5">Serialize(x): Encode the OPRF group element x as a fixed-length byte string
<code>enc</code>. The size of <code>enc</code> is determined by the underlying OPRF group.<a href="#section-2-2.1.2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.1.2.6">Deserialize(enc): Decode a byte string <code>enc</code> into an OPRF group element <code>x</code>,
or produce an error if <code>enc</code> is an invalid encoding. This is the inverse
of Serialize, i.e., <code>x = Deserialize(Serialize(x))</code>.<a href="#section-2-2.1.2.6" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-2-2.2">
          <p id="section-2-2.2.1">Cryptographic hash function:<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.2.2.1">Hash(m): Compute the cryptographic hash of input message "m".<a href="#section-2-2.2.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2-2.2.2.2">Nh: The output size of the Hash function.<a href="#section-2-2.2.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-2-2.3">
          <p id="section-2-2.3.1">Memory Hard Function (MHF):<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.3.2.1">Harden(msg, params): Repeatedly apply a memory hard function with parameters
<code>params</code> to strengthen the input <code>msg</code> against offline dictionary attacks.
This function also needs to satisfy collision resistance.<a href="#section-2-2.3.2.1" class="pilcrow">¶</a>
</li>
          </ul>
</li>
      </ul>
<p id="section-2-3">We also assume the existence of a function <code>KeyGen</code> from <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span>, which
generates an OPRF private and public key. OPAQUE only requires an OPRF private key.
We write <code>(kU, _) = KeyGen()</code> to denote use of this function for generating secret key <code>kU</code>
(and discarding the corresponding public key).<a href="#section-2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol">
<section id="section-3">
      <h2 id="name-core-protocol">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-core-protocol" class="section-name selfRef">Core Protocol</a>
      </h2>
<p id="section-3-1">OPAQUE consists of two stages: registration and authenticated key exchange.
In the first stage, a client registers its password with the server and stores its encrypted credentials on the server.
In the second stage, a client obtains those credentials, unlocks them using the user's password and subsequently uses
them as input to an authenticated key exchange (AKE) protocol.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Both registration and authenticated key exchange stages require running an OPRF protocol.
The latter stage additionally requires running a mutually-authenticated
key-exchange protocol (AKE) using credentials recovered after the OPRF protocol completes.
(The key-exchange protocol MUST satisfy forward secrecy and the KCI requirement discussed in <a href="#security-considerations" class="xref">Section 6</a>.)<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">We first define the core OPAQUE protocol based on a generic OPRF, hash, and MHF function.
<a href="#instantiations" class="xref">Section 4</a> describes specific instantiations of OPAQUE using various AKE protocols,
including: HMQV, 3DH, and SIGMA-I. <span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span> discusses integration with
TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="protocol-messages">
<section id="section-3.1">
        <h3 id="name-protocol-messages">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-protocol-messages" class="section-name selfRef">Protocol messages</a>
        </h3>
<p id="section-3.1-1">The OPAQUE protocol runs the OPRF protocol in two stages: registration and
authenticated key exchange. A client and server exchange protocol messages in
executing these stages. This section specifies the structure of these protocol
messages using TLS notation (see <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, Section 3).<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-2">
<pre>
enum {
    registration_request(1),
    registration_response(2),
    registration_upload(3),
    credential_request(4),
    credential_response(5),
    (255)
} ProtocolMessageType;

struct {
    ProtocolMessageType msg_type;    /* protocol message type */
    uint24 length;                   /* remaining bytes in message */
    select (ProtocolMessage.msg_type) {
        case registration_request: RegistrationRequest;
        case registration_response: RegistrationResponse;
        case registration_upload: RegistrationUpload;
        case credential_request: CredentialRequest;
        case credential_response: CredentialResponse;
    };
} ProtocolMessage;
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">OPAQUE makes use of an additional structure <code>Credentials</code> to store
user (client) credentials. A <code>Credentials</code> structure consists of secret and
cleartext <code>CredentialExtension</code> values. Each <code>CredentialExtension</code> indicates
the type of extension and carries the raw bytes. This specification includes
extensions for OPAQUE, including:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-4.1">skU: The encoded user private key for the AKE protocol.<a href="#section-3.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.2">pkU: The encoded user public key for the AKE protocol.<a href="#section-3.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.3">pkS: The encoded server public key for the AKE protocol.<a href="#section-3.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.4">idU: The user identity. This is an application-specific value, e.g., an e-mail
address or normal account name.<a href="#section-3.1-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-4.5">idS: The server identity. This is typically a domain name, e.g., example.com.
See <a href="#SecIdentities" class="xref">Section 3.5</a> for information about this identity.<a href="#section-3.1-4.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-5">Each public and private key value is an opaque byte string, specific to the AKE
protocol in which OPAQUE is instantiated. For example, if used as raw public keys
for TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, they may be RSA or ECDSA keys as per <span>[<a href="#RFC7250" class="xref">RFC7250</a>]</span>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">The full <code>Credentials</code> encoding is as follows.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-7">
<pre>
enum {
  skU(1),
  pkU(2),
  pkS(3),
  idU(4),
  idS(5),
  (255)
} CredentialType;

struct {
  CredentialType type;
  CredentialData data&lt;0..2^16-1&gt;;
} CredentialExtension;

struct {
  CredentialExtension secret_credentials&lt;1..2^16-1&gt;;
  CredentialExtension cleartext_credentials&lt;0..2^16-1&gt;;
} Credentials;
</pre><a href="#section-3.1-7" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.1-8">
          <dt id="section-3.1-8.1">secret_credentials</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-8.2">
  OPAQUE credentials which require secrecy and authentication.<a href="#section-3.1-8.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-8.3">cleartext_credentials</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-8.4">
  OPAQUE credentials which require authentication but not secrecy.<a href="#section-3.1-8.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.1-9">Applications MUST include <code>skU</code> in <code>secret_credentials</code> and <code>pkS</code> in either <code>cleartext_credentials</code>
or <code>secret_credentials</code>. All other CredentialExtension values are optional. It is RECOMMENDED
that applications include <code>pkS</code> and <code>idS</code> in <code>cleartext_credentials</code>, as this allows servers
to not store redundant encryptions of these values for each user in case the server uses the
same values for multiple users.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<p id="section-3.1-10">Additionally, we assume helper functions <code>SerializeExtensions</code> and <code>DeserializeExtensions</code>
which translate a list of <code>CredentialExtension</code> structures to and from a unique byte string
encoding.<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<p id="section-3.1-11">OPAQUE uses an <code>Envelope</code> structure to encapsulate an encrypted <code>Credentials</code> structure.
It is encoded as follows.<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-12">
<pre>
struct {
  opaque nonce[32];
  opaque ct&lt;1..2^16-1&gt;;
  opaque auth_data&lt;0..2^16-1&gt;;
} InnerEnvelope;

struct {
  InnerEnvelope contents;
  opaque auth_tag[Nh];
} Envelope;
</pre><a href="#section-3.1-12" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.1-13">
          <dt id="section-3.1-13.1">nonce</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-13.2">
  A unique 32-byte nonce used to protect this Envelope.<a href="#section-3.1-13.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-13.3">ct</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-13.4">
  Encoding of encrypted and authenticated credential extensions list.<a href="#section-3.1-13.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-13.5">auth_data</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-13.6">
  Encoding of an authenticated credential extensions list.<a href="#section-3.1-13.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-3.1-13.7">auth_tag</dt>
          <dd style="margin-left: 1.5em" id="section-3.1-13.8">
  Authentication tag protecting the contents of the envelope.<a href="#section-3.1-13.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
<div id="offline-phase">
<section id="section-3.2">
        <h3 id="name-offline-registration-stage">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-offline-registration-stage" class="section-name selfRef">Offline registration stage</a>
        </h3>
<p id="section-3.2-1">Registration is executed between a user U (running on a client machine) and a
server S. It is assumed the server can identify the user and the client can
authenticate the server during this registration phase. This is the only part
in OPAQUE that requires an authenticated channel, either physical, out-of-band,
PKI-based, etc. This section describes the registration flow, message encoding,
and helper functions. Moreover, U has a key pair (skU, pkU) for an AKE protocol
which is suitable for use with OPAQUE; See <a href="#online-phase" class="xref">Section 3.3</a>. (skU, pkU) may be
randomly generated for the account or provided by the calling client.
Clients MUST NOT use the same key pair (skU, pkU) for two different accounts.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">To begin, U chooses password pwdU, and S chooses its own pair of private-public
keys skS and pkS for use with the AKE. S can use the same pair of keys with
multiple users. These steps can happen offline, i.e., before the registration phase.
Once complete, the registration process proceeds as follows:<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2-3">
<pre>
 Client (idU, pwdU, skU, pkU)                 Server (skS, pkS)
  -----------------------------------------------------------------
   request, metadata = CreateRegistrationRequest(idU, pwdU)

                                   request
                              -----------------&gt;

            (response, kU) = CreateRegistrationResponse(request, pkS)

                                   response
                              &lt;-----------------

 record = FinalizeRequest(idU, pwdU, skU, metadata, request, response)

                                    record
                              ------------------&gt;

                                             StoreUserRecord(record)
</pre><a href="#section-3.2-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2-4">Both client and server MUST validate the other party's public key before use.
See <a href="#validation" class="xref">Section 6.3</a> for more details.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<div id="registration-messages">
<section id="section-3.2.1">
          <h4 id="name-registration-messages">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-registration-messages" class="section-name selfRef">Registration messages</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-3.2.1-1">
<pre>
struct {
    opaque id&lt;0..2^16-1&gt;;
    opaque data&lt;1..2^16-1&gt;;
} RegistrationRequest;
</pre><a href="#section-3.2.1-1" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-2">
            <dt id="section-3.2.1-2.1">id</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-2.2">
  An opaque string carrying the client account information, if available.<a href="#section-3.2.1-2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-2.3">data</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-2.4">
  An encoded element in the OPRF group. See <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> for a
description of this encoding.<a href="#section-3.2.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-3.2.1-3">
<pre>
struct {
    opaque data_blind&lt;1..2^16-1&gt;;
} RequestMetadata;
</pre><a href="#section-3.2.1-3" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-4">
            <dt id="section-3.2.1-4.1">data_blind</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-4.2">
  An encoded OPRF scalar element. See <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> for a
description of this encoding.<a href="#section-3.2.1-4.2" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-3.2.1-5">
<pre>
struct {
    opaque data&lt;0..2^16-1&gt;;
    opaque pkS&lt;0..2^16-1&gt;;
    CredentialType secret_types&lt;1..255&gt;;
    CredentialType cleartext_types&lt;0..255&gt;;
} RegistrationResponse;
</pre><a href="#section-3.2.1-5" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-6">
            <dt id="section-3.2.1-6.1">data</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-6.2">
  An encoded element in the OPRF group. See <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> for a
description of this encoding.<a href="#section-3.2.1-6.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-6.3">pkS</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-6.4">
  An encoded public key that will be used for the online authenticated key exchange stage.<a href="#section-3.2.1-6.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-3.2.1-7">
<pre>
struct {
    Envelope envelope;
    opaque pkU&lt;0..2^16-1&gt;;
} RegistrationUpload;
</pre><a href="#section-3.2.1-7" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.2.1-8">
            <dt id="section-3.2.1-8.1">envelope</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-8.2">
  An authenticated encoding of a Credentials structure with additional application-specific
data.<a href="#section-3.2.1-8.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.2.1-8.3">pkU</dt>
            <dd style="margin-left: 1.5em" id="section-3.2.1-8.4">
  An encoded public key, matching the public key contained within the encrypted
envelope.<a href="#section-3.2.1-8.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="registration-functions">
<section id="section-3.2.2">
          <h4 id="name-registration-functions">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-registration-functions" class="section-name selfRef">Registration functions</a>
          </h4>
<div id="createregistrationrequest">
<section id="section-3.2.2.1">
            <h5 id="name-createregistrationrequest">
<a href="#section-3.2.2.1" class="section-number selfRef">3.2.2.1. </a><a href="#name-createregistrationrequest" class="section-name selfRef">CreateRegistrationRequest</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.2.2.1-1">
<pre>
CreateRegistrationRequest(idU, pwdU)

Input:
- idU, an opaque byte string containing the user's identity
- pwdU, an opaque byte string containing the user's password

Output:
- request, a RegistrationRequest structure
- metadata, a RequestMetadata structure

Steps:
1. (r, M) = Blind(pwdU)
2. data = Serialize(M)
3. Create RegistrationRequest request with (idU, data)
4. Create RequestMetadata metadata with Serialize(r)
5. Output (request, metadata)
</pre><a href="#section-3.2.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="createregistrationresponse">
<section id="section-3.2.2.2">
            <h5 id="name-createregistrationresponse">
<a href="#section-3.2.2.2" class="section-number selfRef">3.2.2.2. </a><a href="#name-createregistrationresponse" class="section-name selfRef">CreateRegistrationResponse</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.2.2.2-1">
<pre>
CreateRegistrationResponse(request, pkS)

Parameters:
- secret_credentials_list, a list of CredentialType values clients should include
 in the secret_credentials list of their Credentials structure
- cleartext_credentials_list, a list of CredentialType values clients should include
 in the cleartext_credentials list of their Credentials structure

Input:
- request, a RegistrationRequest structure
- pkS, the server's public key

Output:
- response, a RegistrationResponse structure
- kU, Per-user OPRF key

Steps:
1. (kU, _) = KeyGen()
2. M = Deserialize(request.data)
3. Z = Evaluate(kU, M)
4. data = Z.encode()
5. Create RegistrationResponse response with
     (data, pkS, secret_credentials_list, cleartext_credentials_list)
6. Output (response, kU)
</pre><a href="#section-3.2.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="finalizerequest">
<section id="section-3.2.2.3">
            <h5 id="name-finalizerequest">
<a href="#section-3.2.2.3" class="section-number selfRef">3.2.2.3. </a><a href="#name-finalizerequest" class="section-name selfRef">FinalizeRequest</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.2.2.3-1">
<pre>
FinalizeRequest(idU, pwdU, skU, metadata, request, response)

Parameters:
- params, the MHF parameters established out of band

Input:
- idU, an opaque byte string containing the user's identity
- pwdU, an opaque byte string containing the user's password
- skU, the user's private key
- metadata, a RequestMetadata structure
- request, a RegistrationRequest structure
- response, a RegistrationResponse structure

Output:
- upload, a RegistrationUpload structure
- export_key, an additional key

Steps:
1. Z = Deserialize(response.data)
2. N = Unblind(input.data_blind, Z)
3. y = Finalize(pwdU, N, "OPAQUE00")
4. rwdU = HKDF-Extract("rwdU", Harden(y, params))
5. Create secret_credentials with CredentialExtensions matching that
   contained in response.secret_credentials_list
6. Create cleartext_credentials with CredentialExtensions matching that
   contained in response.cleartext_credentials_list
7. pt = SerializeExtensions(secret_credentials)
8. nonce = random(32)
9. pseudorandom_pad = HKDF-Expand(rwdU, concat(nonce, "Pad"), len(pt))
10. auth_key = HKDF-Expand(rwdU, concat(nonce, "AuthKey"), Nh)
11. export_key = HKDF-Expand(rwdU, concat(nonce, "ExportKey"), Nh)
12. ct = xor(pt, pseudorandom_pad)
13. auth_data = SerializeExtensions(cleartext_credentials)
14. Create InnerEnvelope contents with (nonce, ct, auth_data)
15. t = HMAC(auth_key, contents)
16. Create Envelope envU with (contents, t)
17. Create RegistrationUpload upload with envelope value (envU, pkU)
18. Output (upload, export_key)
</pre><a href="#section-3.2.2.3-1" class="pilcrow">¶</a>
</div>
<p id="section-3.2.2.3-2">[[RFC editor: please change "OPAQUE00" to the correct RFC identifier before publication.]]<a href="#section-3.2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-3.2.2.3-3">[[https://github.com/cfrg/draft-irtf-cfrg-opaque/issues/58: Should the nonce size be a parameter?]]<a href="#section-3.2.2.3-3" class="pilcrow">¶</a></p>
<p id="section-3.2.2.3-4">The inputs to HKDF-Extract and HKDF-Expand are as specified in <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span>. The underlying hash function
is that which is associated with the OPAQUE configuration (see <a href="#configurations" class="xref">Section 5</a>).<a href="#section-3.2.2.3-4" class="pilcrow">¶</a></p>
<p id="section-3.2.2.3-5">OPAQUE security requires authentication for all <code>CredentialExtension</code> values,
and secrecy for <code>skU</code>. If an application additionally requires secrecy of <code>pkS</code>,
this value SHOULD be included in the
<code>Credentials.secret_credentials</code> list (step 5), and MUST NOT be included in the
<code>Credentials.cleartext_credentials</code> list. Applications may optionally include
<code>pkU</code>, <code>idU</code>, or <code>idS</code> in the <code>Credentials.cleartext_credentials</code> structure, or in
<code>Credentials.secret_credentials</code> if secrecy of these values is desired.
Servers MUST specify how clients encode extensions in the <code>Credentials</code> structure
as part of this registration phase.<a href="#section-3.2.2.3-5" class="pilcrow">¶</a></p>
<p id="section-3.2.2.3-6">The server identity <code>idS</code> comes from context. For example, if registering with
a server within the context of a TLS connection, the identity might be the
server domain name. See <a href="#SecIdentities" class="xref">Section 3.5</a>.<a href="#section-3.2.2.3-6" class="pilcrow">¶</a></p>
<p id="section-3.2.2.3-7">See <a href="#export-usage" class="xref">Section 3.4</a> for details about the output export_key usage.<a href="#section-3.2.2.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="storeuserrecord">
<section id="section-3.2.2.4">
            <h5 id="name-storeuserrecord">
<a href="#section-3.2.2.4" class="section-number selfRef">3.2.2.4. </a><a href="#name-storeuserrecord" class="section-name selfRef">StoreUserRecord</a>
            </h5>
<p id="section-3.2.2.4-1">The StoreUserRecord function stores the tuple <code>(envU, pkS, skS, pkU, kU)</code>,
where envU and pkU are obtained from the input RegistrationUpload message in
a record associated with the user's account idU. If <code>skS</code> and <code>pkS</code> are used for
multiple users, the server can store these values separately and omit them from
the user's record.<a href="#section-3.2.2.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="online-phase">
<section id="section-3.3">
        <h3 id="name-online-authenticated-key-ex">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-online-authenticated-key-ex" class="section-name selfRef">Online authenticated key exchange stage</a>
        </h3>
<p id="section-3.3-1">After registration, the user (through a client machine) and server run the
authenticated key exchange stage of the OPAQUE protocol. This stage is composed of a concurrent
OPRF and key exchange flow. The key exchange protocol is authenticated using the
client and server private keys established during the offline phase; see <a href="#offline-phase" class="xref">Section 3.2</a>.
The type of keys MUST be suitable for the key exchange protocol. For example, if
the key exchange protocol is 3DH, as described in <a href="#SecHmqv" class="xref">Section 4.2</a>, then the private and
public keys must be Diffie-Hellman keys. At the end, the client proves the user's
knowledge of the password, and both client and server agree on a mutually authenticated
shared secret key.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">This section describes the message flow, encoding, and helper functions used in this stage.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3-3">
<pre>
 Client (idU, pwdU)                           Server (skS, pkS)
  -----------------------------------------------------------------
   request, metadata = CreateCredentialRequest(idU, pwdU)

                                   request
                              -----------------&gt;

         (response, pkU) = CreateCredentialResponse(request, pkS)

                                   response
                              &lt;-----------------

  creds, export_key = RecoverCredentials(pwdU, metadata, request, response)

                               (AKE with creds)
                              &lt;================&gt;
</pre><a href="#section-3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-3.3-4">The protocol messages below do not include the AKE protocol. Instead, OPAQUE
assumes the client and server run the AKE using the credentials recovered from
the OPRF protocol.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">Note also that the authenticated key exchange stage can run the OPRF and AKE protocols
concurrently with interleaved and combined messages (while preserving the internal ordering
of messages in each protocol). In all cases, the client needs to obtain envU and
rwdU (i.e., complete the OPRF protocol) before it can use its own private key
skU and the server's public key pkS in the AKE. See <a href="#instantiations" class="xref">Section 4</a> for examples
of this integration.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<div id="authenticated-key-exchange-messages">
<section id="section-3.3.1">
          <h4 id="name-authenticated-key-exchange-">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-authenticated-key-exchange-" class="section-name selfRef">Authenticated key exchange messages</a>
          </h4>
<div class="artwork art-text alignLeft" id="section-3.3.1-1">
<pre>
struct {
    opaque id&lt;0..2^16-1&gt;;
    opaque data&lt;1..2^16-1&gt;;
} CredentialRequest;
</pre><a href="#section-3.3.1-1" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.1-2">
            <dt id="section-3.3.1-2.1">id</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-2.2">
  An opaque string carrying the client account information, if available. If absent,
the server is assumed to have some way of ascertaining the client account information
out of band.<a href="#section-3.3.1-2.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-2.3">data</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-2.4">
  An encoded element in the OPRF group. See <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> for a
description of this encoding.<a href="#section-3.3.1-2.4" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
<div class="artwork art-text alignLeft" id="section-3.3.1-3">
<pre>
struct {
    opaque data&lt;1..2^16-1&gt;;
    opaque envelope&lt;1..2^16-1&gt;;
    opaque pkS&lt;0..2^16-1&gt;;
} CredentialResponse;
</pre><a href="#section-3.3.1-3" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="section-3.3.1-4">
            <dt id="section-3.3.1-4.1">data</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-4.2">
  An encoded element in the OPRF group. See <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> for a
description of this encoding.<a href="#section-3.3.1-4.2" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-4.3">envelope</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-4.4">
  An authenticated encoding of a Credentials structure.<a href="#section-3.3.1-4.4" class="pilcrow">¶</a>
</dd>
            <dd class="break"></dd>
<dt id="section-3.3.1-4.5">pkS</dt>
            <dd style="margin-left: 1.5em" id="section-3.3.1-4.6">
  An encoded public key that will be used for the online authenticated key
exchange stage. This field is optional.<a href="#section-3.3.1-4.6" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="authenticated-key-exchange-functions">
<section id="section-3.3.2">
          <h4 id="name-authenticated-key-exchange-f">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-authenticated-key-exchange-f" class="section-name selfRef">Authenticated key exchange functions</a>
          </h4>
<div id="createcredentialrequestidu-pwdu">
<section id="section-3.3.2.1">
            <h5 id="name-createcredentialrequestidu-">
<a href="#section-3.3.2.1" class="section-number selfRef">3.3.2.1. </a><a href="#name-createcredentialrequestidu-" class="section-name selfRef">CreateCredentialRequest(idU, pwdU)</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.3.2.1-1">
<pre>
CreateCredentialRequest(idU, pwdU)

Input:
- idU, an opaque byte string containing the user's identity
- pwdU, an opaque byte string containing the user's password

Output:
- request, an CredentialRequest structure
- metadata, a RequestMetadata structure

Steps:
1. (r, M) = Blind(pwdU)
2. data = Serialize(M)
3. Create CredentialRequest request with (idU, data)
4. Create RequestMetadata metadata with Serialize(r)
5. Output (request, metadata)
</pre><a href="#section-3.3.2.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="createcredentialresponserequest-pks">
<section id="section-3.3.2.2">
            <h5 id="name-createcredentialresponsereq">
<a href="#section-3.3.2.2" class="section-number selfRef">3.3.2.2. </a><a href="#name-createcredentialresponsereq" class="section-name selfRef">CreateCredentialResponse(request, pkS)</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.3.2.2-1">
<pre>
CreateCredentialResponse(request, pkS)

Input:
- request, an CredentialRequest structure
- pkS, public key of the server

Output:
- response, a CredentialResponse structure
- pkU, public key of the user

Steps:
1. (kU, envU, pkU) = LookupUserRecord(request.id)
2. M = Deserialize(request.data)
3. Z = Evaluate(kU, M)
4. data = Z.encode()
5. Create CredentialResponse response with (data, envU, pkS)
6. Output (response, pkU)
</pre><a href="#section-3.3.2.2-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="recovercredentialspwdu-metadata-request-response">
<section id="section-3.3.2.3">
            <h5 id="name-recovercredentialspwdu-meta">
<a href="#section-3.3.2.3" class="section-number selfRef">3.3.2.3. </a><a href="#name-recovercredentialspwdu-meta" class="section-name selfRef">RecoverCredentials(pwdU, metadata, request, response)</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-3.3.2.3-1">
<pre>
RecoverCredentials(pwdU, metadata, request, response)

Parameters:
- params, the MHF parameters established out of band

Input:
- pwdU, an opaque byte string containing the user's password
- metadata, a RequestMetadata structure
- request, a RegistrationRequest structure
- response, a RegistrationResponse structure

Output:
- C, a Credentials structure
- export_key, an additional key

Steps:
1. Z = Deserialize(response.data)
2. N = Unblind(input.data_blind, Z)
3. y = Finalize(pwdU, N, "OPAQUE00")
4. contents = response.envelope.contents
5. nonce = contents.nonce
6. ct = contents.ct
7. rwdU = HKDF-Extract("rwdU", Harden(y, params))
8. pseudorandom_pad = HKDF-Expand(rwdU, concat(nonce, "Pad"), len(ct))
9. auth_key = HKDF-Expand(rwdU, concat(nonce, "AuthKey"), Nh)
10. export_key = HKDF-Expand(rwdU, concat(nonce, "ExportKey"), Nh)
11. expected_tag = HMAC(auth_key, contents)
12. If !ct_equal(response.envelope.auth_tag, expected_tag), raise DecryptionError
13. pt = xor(ct, pseudorandom_pad)
14. secret_credentials = DeserializeExtensions(pt)
15. cleartext_credentials = DeserializeExtensions(auth_data)
16. Create Credentials creds with (secret_credentials, cleartext_credentials)
17. Output creds, export_key
</pre><a href="#section-3.3.2.3-1" class="pilcrow">¶</a>
</div>
<p id="section-3.3.2.3-2">[[RFC editor: please change "OPAQUE00" to the correct RFC identifier before publication.]]<a href="#section-3.3.2.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="export-usage">
<section id="section-3.4">
        <h3 id="name-export-key">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-export-key" class="section-name selfRef">Export Key</a>
        </h3>
<p id="section-3.4-1">In addition to Credentials, OPAQUE outputs an export_key that may be used for additional
application-specific purposes. For example, one might expand the use of OPAQUE with a
credential-retrieval functionality that is separate from the contents of the Credentials
structure.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">The exporter_key MUST NOT be used in any way before the HMAC value in the
envelope is validated.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SecIdentities">
<section id="section-3.5">
        <h3 id="name-ake-execution-and-party-ide">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-ake-execution-and-party-ide" class="section-name selfRef">AKE Execution and Party Identities</a>
        </h3>
<p id="section-3.5-1">The AKE protocol is run as part of the online authenticated key exchange
flow described above. The AKE MUST authenticate the OPAQUE transcript, which
consists of the encoded <code>request</code> and <code>response</code> messages exchanged during the
OPRF computation and credential fetch flow.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">Also, authenticated key-exchange protocols generate keys that need to be uniquely
and verifiably bound to a pair of identities. In the case of OPAQUE, those identities
correspond to idU and idS. Thus, it is essential for the parties to agree on such
identities, including an agreed bit representation of these identities as needed.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<p id="section-3.5-3">Applications may have different policies about how and when identities are
determined. A natural approach is to tie idU to the identity the server uses
to fetch envU (hence determined during password registration) and to tie idS
to the server identity used by the client to initiate an offline password
registration or online authenticated key exchange session.
idS and idU can also be part of envU or be tied to the
parties' public keys. In principle, it is possible that identities change
across different sessions as long as there is a policy that can establish if
the identity is acceptable or not to the peer. However, we note that the
public keys of both the server and the user must always be those defined at
time of password registration.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="instantiations">
<section id="section-4">
      <h2 id="name-authenticated-key-exchange-p">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-authenticated-key-exchange-p" class="section-name selfRef">Authenticated Key Exchange Protocol Instantiations</a>
      </h2>
<p id="section-4-1">This section describes several instantiations of OPAQUE using different AKE protocols, all of
which satisfy the forward secrecy and KCI properties discussed in <a href="#security-considerations" class="xref">Section 6</a>.
For the sake of concreteness it only includes AKE protocols consisting of three messages,
denoted KE1, KE2, KE3, where KE1 and KE2 include key exchange shares (DH values) sent by
client and server, respectively, and KE3 provides explicit client authentication and full
forward security (without it, forward secrecy is only achieved against eavesdroppers
which is insufficient for OPAQUE security).<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">As shown in <span>[<a href="#OPAQUE" class="xref">OPAQUE</a>]</span>, OPAQUE cannot use less than three messages so the 3-message
instantiations presented here are optimal in terms of number of messages.
On the other hand, there is no impediment of using OPAQUE with protocols with
more than 3 messages as in the case of IKEv2 (or the underlying SIGMA-R
protocol <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>).<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The generic outline of OPAQUE with a 3-message AKE protocol is as follows:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">C to S: credential_request, KE1<a href="#section-4-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.2">S to C: credential_response, KE2<a href="#section-4-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.3">C to S: KE3<a href="#section-4-4.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-5">Key derivation and other details of the protocol are specified by the
KE scheme. We note that by the results in <span>[<a href="#OPAQUE" class="xref">OPAQUE</a>]</span>, KE2 and KE3 should
authenticate credential_request and credential_response, respectively,
for binding between the underlying OPRF protocol messages and the KE session.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">Next, we present three instantiations of OPAQUE - with HMQV, 3DH and SIGMA-I.
<span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span> discusses integration with TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.
Note that these instantiations transmit idU in cleartext. Applications that require
idU privacy should encrypt this appropriately. Mechanisms for doing so are
outside the scope of this document, though may be addressed elsewhere, such as
in <span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span>.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">OPAQUE may be instantiated with any post-quantum (PQ) AKE protocol that has the message
flow above and security properties (KCI resistance and forward secrecy) outlined
in <a href="#security-considerations" class="xref">Section 6</a>. This document does not specify such an instantiation.
Note that such an instantiation is not quantum safe unless the OPRF and data encryption schemes
are quantum safe. However, an instantiation where both AKE and data encryption are quantum safe,
but the OPRF is not, would still ensure data security against future quantum attacks since breaking the OPRF
does not retroactively affect the security of data transferred over a quantum-safe secure channel.<a href="#section-4-7" class="pilcrow">¶</a></p>
<div id="key-schedule-utility-functions">
<section id="section-4.1">
        <h3 id="name-key-schedule-utility-functi">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-key-schedule-utility-functi" class="section-name selfRef">Key Schedule Utility Functions</a>
        </h3>
<p id="section-4.1-1">The key derivation procedures for HMQV, 3DH, and SIGMA-I instantiations
all make use of the functions below, re-purposed from TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-2">
<pre>
HKDF-Expand-Label(Secret, Label, Context, Length) =
  HKDF-Expand(Secret, HkdfLabel, Length)
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">Where HkdfLabel is specified as:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-4">
<pre>
struct {
   uint16 length = Length;
   opaque label&lt;8..255&gt; = "OPAQUE " + Label;
   opaque context&lt;0..255&gt; = Context;
} HkdfLabel;

Derive-Secret(Secret, Label, Transcript) =
    HKDF-Expand-Label(Secret, Label, Hash(Transcript), Nh)
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">HKDF uses Hash as its underlying hash function, which is the same as that
which is indicated by the OPAQUE instantiation.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SecHmqv">
<section id="section-4.2">
        <h3 id="name-instantiation-with-hmqv-and">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-instantiation-with-hmqv-and" class="section-name selfRef">Instantiation with HMQV and 3DH</a>
        </h3>
<p id="section-4.2-1">The integration of OPAQUE with HMQV <span>[<a href="#HMQV" class="xref">HMQV</a>]</span> leads to the most
efficient instantiation of OPAQUE in terms of exponentiations count.
Performance is close to optimal due to the low cost of authentication in
HMQV: Just 1/6 of an exponentiation for each party over the cost of a regular
DH exchange. However, HMQV is encumbered by an IBM patent, hence we also
present OPAQUE with 3DH which only differs in the key derivation function
at the cost of two additional exponentiations (and less resilience to the compromise
of ephemeral exponents). We note that 3DH serves as a basis for the
key-exchange protocol of <span>[<a href="#SIGNAL" class="xref">SIGNAL</a>]</span>. Importantly, many other protocols
follow a similar format with differences
mainly in the key derivation function. This includes the Noise family of
protocols. Extensions also apply to KEM-based AKE protocols as in many
post-quantum candidates.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div id="hmqv-3dh-protocol-messages">
<section id="section-4.2.1">
          <h4 id="name-hmqv-and-3dh-protocol-messa">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-hmqv-and-3dh-protocol-messa" class="section-name selfRef">HMQV and 3DH protocol messages</a>
          </h4>
<p id="section-4.2.1-1">HMQV and 3DH are both implemented using a suitable cyclic group of prime order p.
All operations in the key derivation steps in <a href="#derive-hmqv" class="xref">Section 4.2.2.1</a> and <a href="#derive-3dh" class="xref">Section 4.2.2.2</a>
are performed in this group and represented here using multiplicative notation.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
<p id="section-4.2.1-2">OPAQUE with HMQV and OPAQUE with 3DH comprises:<a href="#section-4.2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-3.1">KE1 = credential_request, nonceU, info1<em>, idU</em>, epkU<a href="#section-4.2.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-3.2">KE2 = credential_response, nonceS, info2<em>, epkS, Einfo2</em>, MAC(Km2; transcript2),<a href="#section-4.2.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-3.3">KE3 = info3<em>, Einfo3</em>, MAC(Km3; transcript3)}<a href="#section-4.2.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.1-4">where:<a href="#section-4.2.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-5.1">'*' denotes optional elements;<a href="#section-4.2.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.2">The private and public keys of the parties in these examples are
Diffie-Hellman keys, namely, pkU=g^skU and pkS=g^skS.<a href="#section-4.2.1-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.3">credential_request and credential_response denote the online OPAQUE
protocol messages (defined in <a href="#online-phase" class="xref">Section 3.3</a>) which carry the client
and server OPRF values, respectively, as well as the envelope.<a href="#section-4.2.1-5.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.4">nonceU, nonceS are fresh random nonces chosen by client and server,
respectively;<a href="#section-4.2.1-5.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.5">info1, info2, info3 denote optional application-specific information sent in
the clear (e.g., they can include parameter negotiation, parameters for a
hardening function, etc.);<a href="#section-4.2.1-5.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.6">Einfo2, Einfo3 denotes optional application-specific information sent
encrypted under keys Ke2, Ke3 defined below;<a href="#section-4.2.1-5.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.7">idU is the user's identity used by the server to construct <code>credential_response</code>,
which contains the server's OPRF response and envU. idU can be omitted from message
KE1 if the information is available to the server in some other way;<a href="#section-4.2.1-5.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.8">idS, the server's identity, is not shown explicitly, it can be part of an info
field (encrypted or not), part of envU, or can be known from other context
(see <a href="#SecIdentities" class="xref">Section 3.5</a>); it is used crucially for key derivation (see below);<a href="#section-4.2.1-5.8" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.9">epkU, epkS are Diffie-Hellman ephemeral public keys chosen by user and
server, respectively, which MUST be validated to be in the correct group
(see <a href="#validation" class="xref">Section 6.3</a>);<a href="#section-4.2.1-5.9" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.10">transcript2 includes the concatenation of the values
credential_request, nonceU, info1<em>, idU</em>, epkU, credential_response,
nonceS, info2<em>, epkS, Einfo2</em>;<a href="#section-4.2.1-5.10" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-5.11">transcript3 includes the concatenation of all elements in transcript2
followed by info3<em>, Einfo3</em>;<a href="#section-4.2.1-5.11" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.2.1-6">Notes:<a href="#section-4.2.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2.1-7.1">The explicit concatenation of elements under transcript2 and transcript3 can be
 replaced with hashed values of these elements, or their combinations, using
 a collision-resistant hash (e.g., as in the transcript-hash of TLS 1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>).<a href="#section-4.2.1-7.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.2.1-7.2">The inclusion of the values credential_request and credential_response under
 transcript2 is needed for binding the underlying OPRF execution to that of the
 AKE session. On the other hand, including envU in transcript2 is not mandatory
 for security, though done as part of including credential_response.<a href="#section-4.2.1-7.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="hmqv-key-schedule">
<section id="section-4.2.2">
          <h4 id="name-hmqv-and-3dh-key-derivation">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-hmqv-and-3dh-key-derivation" class="section-name selfRef">HMQV and 3DH key derivation</a>
          </h4>
<p id="section-4.2.2-1">The above protocol requires MAC keys Km2, Km3, and optional encryption keys
Ke2, Ke3, as well as generating a session key SK which is the
AKE output for protecting subsequent traffic (or for generating further key
material). Key derivation uses HKDF <span>[<a href="#RFC5869" class="xref">RFC5869</a>]</span> with a combination of the parties static
and ephemeral private-public key pairs and the parties' identities idU, idS.
See <a href="#SecIdentities" class="xref">Section 3.5</a> for more information about these identities.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">HMQV and 3DH use the following key schedule for computing Km2, Km3, Ke2, Ke3, and SK:<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2-3">
<pre>
  HKDF-Extract(salt=0, IKM)
      |
      +--&gt; Derive-Secret(., "handshake secret", info) = handshake_secret
      |
      +--&gt; Derive-Secret(., "session secret", info) = SK
</pre><a href="#section-4.2.2-3" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-4">From <code>handshake_secret</code>, Km2, Km3, Ke2, and Ke3 are computed as follows:<a href="#section-4.2.2-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2-5">
<pre>
Km2 = HKDF-Expand-Label(handshake_secret, "client mac", "", Hash.length)
Km3 = HKDF-Expand-Label(handshake_secret, "server mac", "", Hash.length)
Ke2 = HKDF-Expand-Label(handshake_secret, "client enc", "", key_length)
Ke3 = HKDF-Expand-Label(handshake_secret, "server enc", "", key_length)
</pre><a href="#section-4.2.2-5" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2-6"><code>key_length</code> is the length of the key required for the AKE handshake encryption algorithm.<a href="#section-4.2.2-6" class="pilcrow">¶</a></p>
<p id="section-4.2.2-7">Values <code>IKM</code> and <code>info</code> are defined for each instantiation in the following sections.<a href="#section-4.2.2-7" class="pilcrow">¶</a></p>
<div id="derive-hmqv">
<section id="section-4.2.2.1">
            <h5 id="name-hmqv-key-derivation">
<a href="#section-4.2.2.1" class="section-number selfRef">4.2.2.1. </a><a href="#name-hmqv-key-derivation" class="section-name selfRef">HMQV key derivation</a>
            </h5>
<p id="section-4.2.2.1-1">The HKDF input parameter <code>info</code> is computed as follows:<a href="#section-4.2.2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.1-2">
<pre>
info = "HMQV keys" || I2OSP(len(nonceU), 2) || nonceU
                   || I2OSP(len(nonceS), 2) || nonceS
                   || I2OSP(len(idU), 2) || idU
                   || I2OSP(len(idS), 2) || idS
</pre><a href="#section-4.2.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.1-3">The input parameter <code>IKM</code> is <code>Khmqv</code>, where <code>Khmqv</code> is computed by the client as follows:<a href="#section-4.2.2.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.1-4">
<pre>
1. u' = (eskU + u\*skU) mod p
2. Khmqv = (epkS \* pkS^s)^u'
</pre><a href="#section-4.2.2.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.1-5">Hash is the same hash function used in the main OPAQUE protocol for key derivation.
Its output length must be at least the length of the group order p.<a href="#section-4.2.2.1-5" class="pilcrow">¶</a></p>
<p id="section-4.2.2.1-6">Likewise, servers compute <code>Khmqv</code> as follows:<a href="#section-4.2.2.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.1-7">
<pre>
1. s' = (eskS + s\*skS) mod p
2. Khmqv = (epkU \* pkU^u)^s'
</pre><a href="#section-4.2.2.1-7" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.1-8">In both cases, <code>u</code> is computed as follows:<a href="#section-4.2.2.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.1-9">
<pre>
hashInput = I2OSP(len(epkU), 2) || epkU ||
            I2OSP(len(info), 2) || info ||
            I2OSP(len("client"), 2) || "client"
u = Hash(hashInput) mod (len(p)-1)
</pre><a href="#section-4.2.2.1-9" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.1-10">Likewise, <code>s</code> is computed as follows:<a href="#section-4.2.2.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.1-11">
<pre>
hashInput = I2OSP(len(epkS), 2) || epkS ||
            I2OSP(len(info), 2) || info ||
            I2OSP(len("server"), 2) || "server"
s = Hash(hashInput) mod (len(p)-1)
</pre><a href="#section-4.2.2.1-11" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="derive-3dh">
<section id="section-4.2.2.2">
            <h5 id="name-3dh-key-derivation">
<a href="#section-4.2.2.2" class="section-number selfRef">4.2.2.2. </a><a href="#name-3dh-key-derivation" class="section-name selfRef">3DH key derivation</a>
            </h5>
<p id="section-4.2.2.2-1">The HKDF input parameter <code>info</code> is computed as follows:<a href="#section-4.2.2.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.2-2">
<pre>
info = "3DH keys" || I2OSP(len(nonceU), 2) || nonceU
                  || I2OSP(len(nonceS), 2) || nonceS
                  || I2OSP(len(idU), 2) || idU
                  || I2OSP(len(idS), 2) || idS
</pre><a href="#section-4.2.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.2-3">The input parameter <code>IKM</code> is <code>K3dh</code>, where <code>K3dh</code> is the concatenation of
three DH values computed by the client as follows:<a href="#section-4.2.2.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.2-4">
<pre>
K3dh = epkS^eskU || pkS^eskU || epkS^skU
</pre><a href="#section-4.2.2.2-4" class="pilcrow">¶</a>
</div>
<p id="section-4.2.2.2-5">Likewise, <code>K3dh</code> is computed by the server as follows:<a href="#section-4.2.2.2-5" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.2.2.2-6">
<pre>
K3dh = epkU^eskS || epkU^skS || pkU^eskS
</pre><a href="#section-4.2.2.2-6" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="SecSigma">
<section id="section-4.3">
        <h3 id="name-instantiation-with-sigma-i">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-instantiation-with-sigma-i" class="section-name selfRef">Instantiation with SIGMA-I</a>
        </h3>
<p id="section-4.3-1">We show the integration of OPAQUE with the 3-message SIGMA-I protocol <span>[<a href="#SIGMA" class="xref">SIGMA</a>]</span>.
This is an example of a signature-based protocol and also serves
as a basis for integration of OPAQUE with TLS 1.3 as specified in <span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span>.
This specification can be extended to the 4-message SIGMA-R protocol as used
in IKEv2.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<div id="sigma-protocol-messages">
<section id="section-4.3.1">
          <h4 id="name-sigma-protocol-messages">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-sigma-protocol-messages" class="section-name selfRef">SIGMA protocol messages</a>
          </h4>
<p id="section-4.3.1-1">OPAQUE with SIGMA-I comprises:<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-2.1">KE1 = credential_request, nonceU, info1<em>, idU</em>, epkU<a href="#section-4.3.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-2.2">KE2 = credential_response, nonceS, info2<em>, epkS, Einfo2</em>,
     Sign(skS; transcript2-), MAC(Km2; idS),<a href="#section-4.3.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-4.3.1-2.3">KE3 = info3<em>, Einfo3</em>, Sign(skU; transcript3-), MAC(Km3; idU)}<a href="#section-4.3.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-4.3.1-3">See explanation of fields in <a href="#hmqv-3dh-protocol-messages" class="xref">Section 4.2.1</a>.
In addition, for the signed material,
transcript2- is defined similarly to transcript2, however if transcript2 includes
information that identifies the user, such information can be eliminated in
transcript2- (this is advised if signing user's identification information by
the server is deemed to have adverse privacy consequences).
Similarly, transcript3- is defined as transcript3 with server identification
information removed if so desired.<a href="#section-4.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sigma-key-derivation">
<section id="section-4.3.2">
          <h4 id="name-sigma-key-derivation">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-sigma-key-derivation" class="section-name selfRef">SIGMA key derivation</a>
          </h4>
<p id="section-4.3.2-1">The key schedule for computing Km2, Km3, Ke2, Ke3, and SK is the same as
specified in <a href="#hmqv-key-schedule" class="xref">Section 4.2.2</a>. The HKDF input parameter <code>info</code> is
computed as follows:<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.3.2-2">
<pre>
info = "SIGMA-I keys" || I2OSP(len(nonceU), 2) || nonceU
                      || I2OSP(len(nonceS), 2) || nonceS
                      || I2OSP(len(idU), 2) || idU
                      || I2OSP(len(idS), 2) || idS
</pre><a href="#section-4.3.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.3.2-3">The input parameter <code>IKM</code> is <code>Ksigma</code>, where <code>Ksigma</code> is computed by clients
as <code>epkS^eskU</code> and by servers as <code>epkU^eskS</code>.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="configurations">
<section id="section-5">
      <h2 id="name-configurations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-configurations" class="section-name selfRef">Configurations</a>
      </h2>
<p id="section-5-1">An OPAQUE configuration is a tuple (OPRF, Hash, MHF, AKE). The OPAQUE OPRF protocol is
drawn from <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span>. The following OPRF ciphersuites supports are supported:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">OPRF(curve25519, SHA-512)<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.2">OPRF(curve448, SHA-512)<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.3">OPRF(P-256, SHA-512)<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.4">OPRF(P-384, SHA-512)<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.5">OPRF(P-521, SHA-512)<a href="#section-5-2.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-3">The OPAQUE hash function is that which is associated with the OPRF variant.
For the variants specified here, only SHA-512 is supported.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">[[https://github.com/cfrg/draft-irtf-cfrg-opaque/issues/59: Consider SHA-256 for the Curve25519 OPRF suite - SHA-512 is excessive]]<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">The OPAQUE MHFs include Argon2 <span>[<a href="#I-D.irtf-cfrg-argon2" class="xref">I-D.irtf-cfrg-argon2</a>]</span>, scrypt <span>[<a href="#RFC7914" class="xref">RFC7914</a>]</span>,
and PBKDF2 <span>[<a href="#RFC2898" class="xref">RFC2898</a>]</span> with suitable parameter choices. These may be constant
values or set at the time of password registration and stored at the server.
In the latter case, the server communicates these parameters to the client during
login.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">The OPAQUE AKE protocols are those which are specified in <a href="#instantiations" class="xref">Section 4</a>.
Future specifications (such as <span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span>) MAY introduce other
AKE instantiations.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">[[https://github.com/cfrg/draft-irtf-cfrg-opaque/issues/60: Should we have a registry for configurations?]]<a href="#section-5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">OPAQUE is defined and proven as the composition of two
functionalities: An Oblivious PRF (OPRF) and an authenticated key-exchange (AKE) protocol.
It can be seen as a "compiler" for transforming any AKE
protocol (with KCI security and forward secrecy - see below)
into a secure aPAKE protocol. In OPAQUE, the user stores a secret private key at the
server during password registration and retrieves this key each time
it needs to authenticate to the server. The OPRF security properties
ensure that only the correct password can unlock the private key
while at the same time avoiding potential offline guessing attacks.
This general composability property provides great flexibility and
enables a variety of OPAQUE instantiations, from optimized
performance to integration with TLS. The latter aspect is of prime
importance as the use of OPAQUE with TLS constitutes a major security
improvement relative to the standard password-over-TLS practice.
At the same time, the combination with TLS builds OPAQUE as a fully functional
secure communications protocol and can help provide privacy to
account information sent by the user to the server prior to authentication.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">The KCI property required from AKE protocols for use with OPAQUE
states that knowledge of a party's private key does not allow an attacker
to impersonate others to that party. This is an important security
property achieved by most public-key based AKE protocols, including
protocols that use signatures or public key encryption for
authentication. It is also a property of many implicitly
authenticated protocols (e.g., HMQV) but not all of them. We also note that
key exchange protocols based on shared keys do not satisfy the KCI
requirement, hence they are not considered in the OPAQUE setting.
We note that KCI is needed to ensure a crucial property of OPAQUE: even upon
compromise of the server, the attacker cannot impersonate the user to the
server without first running an exhaustive dictionary attack.
Another essential requirement from AKE protocols for use in OPAQUE is to
provide forward secrecy (against active attackers).<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">Jarecki et al. <span>[<a href="#OPAQUE" class="xref">OPAQUE</a>]</span> proved the security of OPAQUE
in a strong aPAKE model that ensures security against pre-computation attacks
and is formulated in the Universal Composability (UC) framework <span>[<a href="#Canetti01" class="xref">Canetti01</a>]</span>
under the random oracle model. This assumes security of the OPRF
function and of the underlying key-exchange protocol. In turn, the
security of the OPRF protocol from <span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> is proven
in the random oracle model under the One-More Diffie-Hellman assumption <span>[<a href="#JKKX16" class="xref">JKKX16</a>]</span>.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Very few aPAKE protocols have been proven formally, and those proven were analyzed
in a weak security model that allows for pre-computation attacks (e.g.,
<span>[<a href="#GMR06" class="xref">GMR06</a>]</span>). This is not just a formal issue: these protocols are
actually vulnerable to such attacks. This includes protocols that have recent
analyses in the UC model such as AuCPace <span>[<a href="#AuCPace" class="xref">AuCPace</a>]</span> and SPAKE2+ <span>[<a href="#SPAKE2plus" class="xref">SPAKE2plus</a>]</span>.
We note that as shown in <span>[<a href="#OPAQUE" class="xref">OPAQUE</a>]</span>, these protocols, and any aPAKE
in the model from <span>[<a href="#GMR06" class="xref">GMR06</a>]</span>, can be converted into an aPAKE secure against
pre-computation attacks at the expense of an additional OPRF execution.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">OPAQUE's design builds on a line of work initiated in the seminal
paper of Ford and Kaliski <span>[<a href="#FK00" class="xref">FK00</a>]</span> and is based on the HPAKE protocol
of Xavier Boyen <span>[<a href="#Boyen09" class="xref">Boyen09</a>]</span> and the (1,1)-PPSS protocol from Jarecki
et al. <span>[<a href="#JKKX16" class="xref">JKKX16</a>]</span>. None of these papers considered security against
pre-computation attacks or presented a proof of aPAKE security
(not even in a weak model).<a href="#section-6-5" class="pilcrow">¶</a></p>
<div id="configuration-choice">
<section id="section-6.1">
        <h3 id="name-configuration-choice">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-configuration-choice" class="section-name selfRef">Configuration Choice</a>
        </h3>
<p id="section-6.1-1">Best practices regarding implementation of cryptographic schemes
apply to OPAQUE. Particular care needs to be given to the
implementation of the OPRF regarding testing group membership and
avoiding timing and other side channel leakage in the hash-to-curve
mapping. Drafts <span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="xref">I-D.irtf-cfrg-hash-to-curve</a>]</span> and
<span>[<a href="#I-D.irtf-cfrg-voprf" class="xref">I-D.irtf-cfrg-voprf</a>]</span> have detailed instantiation and
implementation guidance.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="static-diffie-hellman-oracles">
<section id="section-6.2">
        <h3 id="name-static-diffie-hellman-oracl">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-static-diffie-hellman-oracl" class="section-name selfRef">Static Diffie-Hellman Oracles</a>
        </h3>
<p id="section-6.2-1">While one can expect the practical security of the OPRF function
(namely, the hardness of computing the function without knowing the
key) to be in the order of computing discrete logarithms or solving
Diffie-Hellman, Brown and Gallant <span>[<a href="#BG04" class="xref">BG04</a>]</span> and Cheon <span>[<a href="#Cheon06" class="xref">Cheon06</a>]</span> show an
attack that slightly improves on generic attacks. For the case that
q-1 or q+1, where q is the order of the group G, has a t-bit divisor,
they show an attack that calls the OPRF on 2^t chosen inputs and
reduces security by t/2 bits, i.e., it can find the OPRF key in time
2^{q/2-t/2} and 2^{q/2-t/2} memory. For typical curves, the attack
requires an infeasible number of calls and/or results in insignificant
security loss (*). Moreover, in the OPAQUE application, these
attacks are completely impractical as the number of calls to the function
translates to an equal number of failed authentication attempts by a
<em>single</em> user. For example, one would need a billion impersonation attempts
to reduce security by 15 bits and a trillion to reduce it by 20 bits - and
most curves will not even allow for such attacks in the first place
(note that this theoretical loss of security is with respect to computing
discrete logarithms, not in reducing the password strength).<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">(*) Some examples (courtesy of Dan Brown): For P-384, 2^90 calls reduce
security from 192 to 147 bits; for NIST P-256 the options are 6-bit
reduction with 2153 OPRF calls, about 14 bit reduction with 187 million
calls and 20 bits with a trillion calls. For Curve25519, attacks are
completely infeasible (require over 2^100 calls) but its twist form allows
an attack with 25759 calls that reduces security by 7 bits and one with
117223 calls that reduces security by 8.4 bits.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="validation">
<section id="section-6.3">
        <h3 id="name-input-validation">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-input-validation" class="section-name selfRef">Input validation</a>
        </h3>
<p id="section-6.3-1">Both client and server MUST validate the other party's public key(s) used
for the execution of OPAQUE. This includes the keys shared during the
offline registration phase, as well as any keys shared during the online
key agreement phase. The validation procedure varies depending on the
type of key. For example, for OPAQUE instantiations
using 3DH with P-256, P-384, or P-521 as the underlying group, validation
is as specified in Section 5.6.2.3.4 of <span>[<a href="#keyagreement" class="xref">keyagreement</a>]</span>. This includes
checking that the coordinates are in the correct range, that the point
is on the curve, and that the point is not the point at infinity.
Additionally, validation MUST ensure the Diffie-Hellman shared secret is
not the point at infinity. For X25519 and X448, validation is as described in
<span>[<a href="#RFC7748" class="xref">RFC7748</a>]</span>. In particular, where applicable, endpoints MUST check whether
the Diffie-Hellman shared secret is the all-zero value and abort if so.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="user-authentication-versus-authenticated-key-exchange">
<section id="section-6.4">
        <h3 id="name-user-authentication-versus-">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-user-authentication-versus-" class="section-name selfRef">User authentication versus Authenticated Key Exchange</a>
        </h3>
<p id="section-6.4-1">OPAQUE provides PAKE (password-based authenticated key exchange)
functionality in the client-server setting. While in the case of user
identification, wherein the focus is often on authentication, we stress
that the key exchange element is essential. Indeed, in most cases,
user authentication enforces some policy, and the key exchange step
is essential for binding this enforcement to the authentication step.
Skipping the key exchange part is analogous to carefully checking a
visitor's credential at the door and then leaving the door open for
others to enter freely.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oprf-hardening">
<section id="section-6.5">
        <h3 id="name-oprf-hardening">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-oprf-hardening" class="section-name selfRef">OPRF Hardening</a>
        </h3>
<p id="section-6.5-1">Hardening the output of the OPRF greatly increases the cost of an offline
attack upon the compromise of the password file at the server. Applications
SHOULD select parameters that balance cost and complexity.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="SecEnumeration">
<section id="section-6.6">
        <h3 id="name-user-enumeration">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-user-enumeration" class="section-name selfRef">User enumeration</a>
        </h3>
<p id="section-6.6-1">User enumeration refers to attacks where the attacker tries to learn
whether a given user identity is registered with a server. Preventing
such attack requires the server to act with unknown user identities
in a way that is indistinguishable from its behavior with existing
users. Here we suggest a way to implement such defense, namely, a way for
simulating the values beta and envU for non-existing users.
Note that if the same pair of user identity idU and value alpha is received
twice by the server, the response needs to be the same in both cases (since
this would be the case for real users).
For protection against this attack, one would apply the encryption function in
the construction of envU to all the key material in envU, namely,
cleartext_credentials will be empty.
The server S will have two keys MK, MK' for a PRF f
(this refers to a regular PRF such as HMAC or CMAC).
Upon receiving a pair of user identity idU and value alpha for a non-existing
user idU, S computes kU=f(MK; idU) and kU'=f(MK'; idU) and responds with
values beta=alpha^kU and envU, where the latter is computed as follows.
rwdU is set to kU' and AEenv is set to the all-zero string (of the
length of a regular envU plaintext). Care needs to be taken to avoid side
channel leakage (e.g., timing) from helping differentiate these
operations from a regular server response.
The above requires changes to the server-side implementation but not to the
protocol itself or the client side.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
<p id="section-6.6-2">There is one form of leakage that the above allows and whose prevention would
require a change in OPAQUE.
Note that an attacker that tests a idU (and same alpha) twice and receives
different responses can conclude that either the user registered with the
service between these two activations or that the user was registered before
but changed its password in between the activations (assuming the server
changes kU at the time of a password change). In any case, this
indicates that idU is a registered user at the time of the second activation.
To conceal this information, S can implement the derivation of kU
as kU=f(MK; idU) also for registered users. Hiding changes in envU, however,
requires a change in the protocol. Instead of sending envU as is,
S would send an encryption of envU under a key that the user derives from the
OPRF result (similarly to rwdU) and that S stores during password
registration. During the authenticated key exchange stage, the user will derive
this key from the OPRF result, will use it to decrypt envU, and continue with the
regular protocol. If S uses a randomized encryption, the encrypted envU will look
each time as a fresh random string, hence S can simulate the encrypted envU also
for non-existing users.<a href="#section-6.6-2" class="pilcrow">¶</a></p>
<p id="section-6.6-3">Note that the first case above does not change the protocol so its
implementation is a server's decision (the client side is not changed).
The second case, requires changes on the client side so it changes OPAQUE
itself.<a href="#section-6.6-3" class="pilcrow">¶</a></p>
<p id="section-6.6-4">[[https://github.com/cfrg/draft-irtf-cfrg-opaque/issues/22: Should this variant be documented/standardized?]]<a href="#section-6.6-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="password-salt-and-storage-implications">
<section id="section-6.7">
        <h3 id="name-password-salt-and-storage-i">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-password-salt-and-storage-i" class="section-name selfRef">Password salt and storage implications</a>
        </h3>
<p id="section-6.7-1">In OPAQUE, the OPRF key acts as the secret salt value that ensures the infeasibility
of pre-computation attacks. No extra salt value is needed. Also, clients never
disclose their password to the server, even during registration. Note that a corrupted
server can run an exhaustive offline dictionary attack to validate guesses for the user's
password; this is inevitable in any aPAKE protocol. (OPAQUE enables a defense against such
offline dictionary attacks by distributing the server so that an offline attack is only
possible if all - or a minimal number of - servers are compromised <span>[<a href="#OPAQUE" class="xref">OPAQUE</a>]</span>.)<a href="#section-6.7-1" class="pilcrow">¶</a></p>
<p id="section-6.7-2">Some applications may require learning the user's password for enforcing password
rules. Doing so invalidates this important security property of OPAQUE and is
NOT RECOMMENDED. Applications should move such checks to the client. Note that
limited checks at the server are possible to implement, e.g., detecting repeated
passwords.<a href="#section-6.7-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="performance-considerations">
<section id="section-7">
      <h2 id="name-performance-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance Considerations</a>
      </h2>
<p id="section-7-1">The computational cost of OPAQUE is determined by the cost of the OPRF,
the cost of a regular Diffie-Hellman exchange, and the cost of
authenticating such exchange. In an elliptic-curve implementation of
the OPRF, the cost for the client is two exponentiations (one or two
of which can be fixed base) and one hashing-into-curve operation
<span>[<a href="#I-D.irtf-cfrg-hash-to-curve" class="xref">I-D.irtf-cfrg-hash-to-curve</a>]</span>; for the server, it is just one
exponentiation. The cost of a Diffie-Hellman exchange is as usual two
exponentiations per party (one of which is fixed-base). Finally, the
cost of authentication per party depends on the specific AKE protocol:
it is just 1/6 of an exponentiation with HMQV, two exponentiations for 3DH,
and it is one signature generation and verification in the case of SIGMA and
TLS 1.3.
These instantiations preserve the number of messages in the underlying AKE
protocol except in implementations such as <span>[<a href="#I-D.sullivan-tls-opaque" class="xref">I-D.sullivan-tls-opaque</a>]</span> where
an additional round trip is required to provide privacy to account information.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-8">
      <h2 id="name-iana-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-8-1">This document makes no IANA requests.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
        <dd>
<span class="refAuthor">Eastlake 3rd, D.</span><span class="refAuthor">, Schiller, J.</span><span class="refAuthor">, and S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4086">https://www.rfc-editor.org/info/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="AuCPace">[AuCPace]</dt>
        <dd>
<span class="refAuthor">Haase, B.</span><span class="refAuthor"> and B. Labrique</span>, <span class="refTitle">"AuCPace: Efficient verifier-based PAKE protocol tailored for the IIoT"</span>, <span class="seriesInfo">http://eprint.iacr.org/2018/286 </span>, <time datetime="2018" class="refDate">2018</time>. </dd>
<dd class="break"></dd>
<dt id="BG04">[BG04]</dt>
        <dd>
<span class="refAuthor">Brown, D.</span><span class="refAuthor"> and R. Galant</span>, <span class="refTitle">"The static Diffie-Hellman problem"</span>, <span class="seriesInfo">http://eprint.iacr.org/2004/306 </span>, <time datetime="2004" class="refDate">2004</time>. </dd>
<dd class="break"></dd>
<dt id="Boyen09">[Boyen09]</dt>
        <dd>
<span class="refAuthor">Boyen, X.</span>, <span class="refTitle">"HPAKE: Password authentication secure against cross-site user impersonation"</span>, <span class="seriesInfo">Cryptology and Network Security (CANS) </span>, <time datetime="2009" class="refDate">2009</time>. </dd>
<dd class="break"></dd>
<dt id="Canetti01">[Canetti01]</dt>
        <dd>
<span class="refAuthor">Canetti, R.</span>, <span class="refTitle">"Universally composable security: A new paradigm for cryptographic protocols"</span>, <span class="seriesInfo">IEEE Symposium on Foundations of Computer Science (FOCS) </span>, <time datetime="2001" class="refDate">2001</time>. </dd>
<dd class="break"></dd>
<dt id="Cheon06">[Cheon06]</dt>
        <dd>
<span class="refAuthor">Cheon, J.H.</span>, <span class="refTitle">"Security analysis of the strong Diffie-Hellman problem"</span>, <span class="seriesInfo">Euroctypt 2006 </span>, <time datetime="2006" class="refDate">2006</time>. </dd>
<dd class="break"></dd>
<dt id="FK00">[FK00]</dt>
        <dd>
<span class="refAuthor">Ford, W.</span><span class="refAuthor"> and B.S. Kaliski, Jr</span>, <span class="refTitle">"Server-assisted generation of a strong secret from a password"</span>, <span class="seriesInfo">WETICE </span>, <time datetime="2000" class="refDate">2000</time>. </dd>
<dd class="break"></dd>
<dt id="GMR06">[GMR06]</dt>
        <dd>
<span class="refAuthor">Gentry, C.</span><span class="refAuthor">, MacKenzie, P.</span><span class="refAuthor">, and . Z, Ramzan</span>, <span class="refTitle">"A method for making password-based key exchange resilient to server compromise"</span>, <span class="seriesInfo">CRYPTO </span>, <time datetime="2006" class="refDate">2006</time>. </dd>
<dd class="break"></dd>
<dt id="HMQV">[HMQV]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refTitle">"HMQV: A high-performance secure Diffie-Hellman protocol"</span>, <span class="seriesInfo">CRYPTO </span>, <time datetime="2005" class="refDate">2005</time>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-argon2">[I-D.irtf-cfrg-argon2]</dt>
        <dd>
<span class="refAuthor">Biryukov, A.</span><span class="refAuthor">, Dinu, D.</span><span class="refAuthor">, Khovratovich, D.</span><span class="refAuthor">, and S. Josefsson</span>, <span class="refTitle">"The memory-hard Argon2 password hash and proof-of-work function"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-argon2-12</span>, <time datetime="2020-09-08" class="refDate">8 September 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-irtf-cfrg-argon2-12.txt">http://www.ietf.org/internet-drafts/draft-irtf-cfrg-argon2-12.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-hash-to-curve">[I-D.irtf-cfrg-hash-to-curve]</dt>
        <dd>
<span class="refAuthor">Faz-Hernandez, A.</span><span class="refAuthor">, Scott, S.</span><span class="refAuthor">, Sullivan, N.</span><span class="refAuthor">, Wahby, R.</span><span class="refAuthor">, and C. Wood</span>, <span class="refTitle">"Hashing to Elliptic Curves"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hash-to-curve-09</span>, <time datetime="2020-06-29" class="refDate">29 June 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-irtf-cfrg-hash-to-curve-09.txt">http://www.ietf.org/internet-drafts/draft-irtf-cfrg-hash-to-curve-09.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-voprf">[I-D.irtf-cfrg-voprf]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span><span class="refAuthor">, Sullivan, N.</span><span class="refAuthor">, and C. Wood</span>, <span class="refTitle">"Oblivious Pseudorandom Functions (OPRFs) using Prime-Order Groups"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-voprf-04</span>, <time datetime="2020-07-13" class="refDate">13 July 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-irtf-cfrg-voprf-04.txt">http://www.ietf.org/internet-drafts/draft-irtf-cfrg-voprf-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.sullivan-tls-opaque">[I-D.sullivan-tls-opaque]</dt>
        <dd>
<span class="refAuthor">Sullivan, N.</span><span class="refAuthor">, Krawczyk, H.</span><span class="refAuthor">, Friel, O.</span><span class="refAuthor">, and R. Barnes</span>, <span class="refTitle">"Usage of OPAQUE with TLS 1.3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sullivan-tls-opaque-00</span>, <time datetime="2019-03-11" class="refDate">11 March 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-sullivan-tls-opaque-00.txt">http://www.ietf.org/internet-drafts/draft-sullivan-tls-opaque-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="JKKX16">[JKKX16]</dt>
        <dd>
<span class="refAuthor">Jarecki, S.</span><span class="refAuthor">, Kiayias, A.</span><span class="refAuthor">, Krawczyk, H.</span><span class="refAuthor">, and J. Xu</span>, <span class="refTitle">"Highly-efficient and composable password-protected secret sharing (or: how to protect your bitcoin wallet online)"</span>, <span class="seriesInfo">IEEE European Symposium on Security and Privacy </span>, <time datetime="2016" class="refDate">2016</time>. </dd>
<dd class="break"></dd>
<dt id="keyagreement">[keyagreement]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span><span class="refAuthor">, Chen, L.</span><span class="refAuthor">, Roginsky, A.</span><span class="refAuthor">, Vassilev, A.</span><span class="refAuthor">, and R. Davis</span>, <span class="refTitle">"Recommendation for pair-wise key-establishment schemes using discrete logarithm cryptography"</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56ar3</span>, <span class="seriesInfo">National Institute of Standards and Technology report</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56ar3">https://doi.org/10.6028/nist.sp.800-56ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OPAQUE">[OPAQUE]</dt>
        <dd>
<span class="refAuthor">Jarecki, S.</span><span class="refAuthor">, Krawczyk, H.</span><span class="refAuthor">, and J. Xu</span>, <span class="refTitle">"OPAQUE: An Asymmetric PAKE Protocol Secure Against Pre-Computation Attacks"</span>, <span class="seriesInfo">Eurocrypt </span>, <time datetime="2018" class="refDate">2018</time>. </dd>
<dd class="break"></dd>
<dt id="RFC2898">[RFC2898]</dt>
        <dd>
<span class="refAuthor">Kaliski, B.</span>, <span class="refTitle">"PKCS #5: Password-Based Cryptography Specification Version 2.0"</span>, <span class="seriesInfo">RFC 2898</span>, <span class="seriesInfo">DOI 10.17487/RFC2898</span>, <time datetime="2000-09" class="refDate">September 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2898">https://www.rfc-editor.org/info/rfc2898</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2945">[RFC2945]</dt>
        <dd>
<span class="refAuthor">Wu, T.</span>, <span class="refTitle">"The SRP Authentication and Key Exchange System"</span>, <span class="seriesInfo">RFC 2945</span>, <span class="seriesInfo">DOI 10.17487/RFC2945</span>, <time datetime="2000-09" class="refDate">September 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2945">https://www.rfc-editor.org/info/rfc2945</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor"> and P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5869">https://www.rfc-editor.org/info/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7250">[RFC7250]</dt>
        <dd>
<span class="refAuthor">Wouters, P., Ed.</span><span class="refAuthor">, Tschofenig, H., Ed.</span><span class="refAuthor">, Gilmore, J.</span><span class="refAuthor">, Weiler, S.</span><span class="refAuthor">, and T. Kivinen</span>, <span class="refTitle">"Using Raw Public Keys in Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)"</span>, <span class="seriesInfo">RFC 7250</span>, <span class="seriesInfo">DOI 10.17487/RFC7250</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7250">https://www.rfc-editor.org/info/rfc7250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7748">[RFC7748]</dt>
        <dd>
<span class="refAuthor">Langley, A.</span><span class="refAuthor">, Hamburg, M.</span><span class="refAuthor">, and S. Turner</span>, <span class="refTitle">"Elliptic Curves for Security"</span>, <span class="seriesInfo">RFC 7748</span>, <span class="seriesInfo">DOI 10.17487/RFC7748</span>, <time datetime="2016-01" class="refDate">January 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7748">https://www.rfc-editor.org/info/rfc7748</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7914">[RFC7914]</dt>
        <dd>
<span class="refAuthor">Percival, C.</span><span class="refAuthor"> and S. Josefsson</span>, <span class="refTitle">"The scrypt Password-Based Key Derivation Function"</span>, <span class="seriesInfo">RFC 7914</span>, <span class="seriesInfo">DOI 10.17487/RFC7914</span>, <time datetime="2016-08" class="refDate">August 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7914">https://www.rfc-editor.org/info/rfc7914</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
        <dd>
<span class="refAuthor">Moriarty, K., Ed.</span><span class="refAuthor">, Kaliski, B.</span><span class="refAuthor">, Jonsson, J.</span><span class="refAuthor">, and A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8017">https://www.rfc-editor.org/info/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8125">[RFC8125]</dt>
        <dd>
<span class="refAuthor">Schmidt, J.</span>, <span class="refTitle">"Requirements for Password-Authenticated Key Agreement (PAKE) Schemes"</span>, <span class="seriesInfo">RFC 8125</span>, <span class="seriesInfo">DOI 10.17487/RFC8125</span>, <time datetime="2017-04" class="refDate">April 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8125">https://www.rfc-editor.org/info/rfc8125</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SIGMA">[SIGMA]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span>, <span class="refTitle">"SIGMA: The SIGn-and-MAc approach to authenticated Diffie-Hellman and its use in the IKE protocols"</span>, <span class="seriesInfo">CRYPTO </span>, <time datetime="2003" class="refDate">2003</time>. </dd>
<dd class="break"></dd>
<dt id="SIGNAL">[SIGNAL]</dt>
        <dd>
<span class="refTitle">"Signal recommended cryptographic algorithms"</span>, <span class="seriesInfo">https://signal.org/docs/specifications/doubleratchet/#recommended-cryptographic-algorithms </span>, <time datetime="2016" class="refDate">2016</time>. </dd>
<dd class="break"></dd>
<dt id="SPAKE2plus">[SPAKE2plus]</dt>
      <dd>
<span class="refAuthor">Shoup, V.</span>, <span class="refTitle">"Security Analysis of SPAKE2+"</span>, <span class="seriesInfo">http://eprint.iacr.org/2020/313 </span>, <time datetime="2020" class="refDate">2020</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">The OPAQUE protocol and its analysis is joint work of the author with Stas
Jarecki and Jiayu Xu. We are indebted to the OPAQUE reviewers during CFRG's
aPAKE selection process, particularly Julia Hesse and Bjorn Tackmann.
This draft has benefited from comments by multiple people. Special thanks
to Richard Barnes, Dan Brown, Eric Crockett, Paul Grubbs, Fredrik Kuivinen,
Kevin Lewi, Payman Mohassel, Jason Resch, Greg Rubin, Nick Sullivan.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Hugo Krawczyk</span></div>
<div dir="auto" class="left"><span class="org">Algorand Foundation</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hugokraw@gmail.com" class="email">hugokraw@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Kevin Lewi</span></div>
<div dir="auto" class="left"><span class="org">Facebook</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lewi.kevin.k@gmail.com" class="email">lewi.kevin.k@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
