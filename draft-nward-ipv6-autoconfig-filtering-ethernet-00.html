<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 Autoconfig Filtering on
    Ethernet Switches</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 Autoconfig Filtering on
    Ethernet Switches">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">N. Ward</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Braintrust Ltd.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">March 04, 2009</td></tr>
<tr><td class="header">Expires: September 5, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IPv6 Autoconfig Filtering on
    Ethernet Switches<br />draft-nward-ipv6-autoconfig-filtering-ethernet-00</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 5, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>Many ethernet switch vendors provide features for filtering IPv4
      address assignment services - i.e. DHCP, Bootp. This document describes
      what is necessary for a switch to provide the same level of filtering
      for IPv6, as a standard on which operators can base equipment selection
      decisions.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Router Advertisements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
DHCPv6 Replies<br />
<a href="#anchor5">3.</a>&nbsp;
Filtering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
Requests<br />
<a href="#IANA">4.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">5.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">6.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">7.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>IPv6 provides several ways of assigning addresses to IPv6 capable
      hosts. These are the prefix field in Router Advertisement (RA) messages,
      and stateful DHCPv6. In IPv4, we can filter DHCP and Bootp servers in
      ethernet switches, allowing only our authorised configuration servers to
      provide autoconfiguration information to hosts. Few ethernet switches
      provide similar functionality for IPv6 autoconfiguration services, and
      many hosts already listen for RA messages and then subsequent to
      receiving and RA message either configure addressing statelessly, or
      statefully with DHCPv6.
</p>
<p>This represents a problem for many networks, for which the only
      solution at present is to filter out all IPv6 packets from their
      ethernet network.
</p>
<p>This document describes how to filter RA and DHCPv6 messages so that
      autoconfiguration can be provided only by authorised hosts and/or switch
      ports.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocols</h3>

<p>In order to filter IPv6 packets, some level of understanding of the
      IPv6, ICMPv6 and UDP protocols is required by the switch. The following
      fields are analysed so need to be understood by the switch:
</p>
<p>1) Ethertype in the ethernet header (always 0x86DD)
</p>
<p>2) Source MAC address in the ethernet header
</p>
<p>3) Destination MAC address in the ethernet header
</p>
<p>4) Version in the IPv6 header (always 6)
</p>
<p>5) Source IPv6 address in the IPv6 header
</p>
<p>6) Destination IPv6 address in the IPv6 header
</p>
<p>7) Next-header in the IPv6 header
</p>
<p>8) Type and Code in the ICMPv6 header
</p>
<p>9) UDP source port
</p>
<p>10) UDP destination port
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Router Advertisements</h3>

<p>Router advertisement messages SHOULD only be sent by routers, and
        so should enter a switch only from a port with a router, and/or from a
        router's link-local IPv6 address or ethernet MAC address. Router
        advertisements can be sent unsolicited (periodically) to multicast
        IPv6 and MAC addresses, or solicited (on demand) to a specific MAC and
        IPv6 destination.
</p>
<p>The characteristics of a router advertisement message are:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Field</th><th align="left">Value</th></tr>
<tr>
<td align="left">Source MAC Address</td>
<td align="left">Router;s MAC address</td>
</tr>
<tr>
<td align="left">Destination MAC</td>
<td align="left">33:33:00:00:00:01 for unsolicited, a host's MAC address for
          solicited</td>
</tr>
<tr>
<td align="left">Source IPv6 Address</td>
<td align="left">Router's IPv6 link-local address</td>
</tr>
<tr>
<td align="left">Destination IPv6 Address</td>
<td align="left">FF01::1 for unsolicited, an address in FE80::/64 for
          solicited</td>
</tr>
<tr>
<td align="left">Next-header</td>
<td align="left">58</td>
</tr>
<tr>
<td align="left">ICMPv6 Type</td>
<td align="left">134</td>
</tr>
<tr>
<td align="left">ICMPv6 Code</td>
<td align="left">0</td>
</tr>
</table>
<br clear="all" />

<p>Unique to router advertisements is the ICMPv6 type, 134.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
DHCPv6 Replies</h3>

<p>DHCPv6 reply messages SHOULD only be sent by DHCPv6 servers and
        relays, and so should only enter a switch from a port with a DHCPv6
        server or relay, and/or from a DHCPv6 server or relay's link-local
        IPv6 address or ethernet MAC address.
</p>
<p>The characteristics of a DHCPv6 reply message are:
</p><table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Field</th><th align="left">Value</th></tr>
<tr>
<td align="left">Source MAC Address</td>
<td align="left">DHCPv6 server or relay's MAC address</td>
</tr>
<tr>
<td align="left">Source IPv6 Address</td>
<td align="left">DHCPv6 server or relay's link-local IPv6 address</td>
</tr>
<tr>
<td align="left">Destination IPv6 Address</td>
<td align="left">An address in FE80::/64</td>
</tr>
<tr>
<td align="left">Next-header</td>
<td align="left">17</td>
</tr>
<tr>
<td align="left">UDP source port</td>
<td align="left">547</td>
</tr>
<tr>
<td align="left">UDP destination port</td>
<td align="left">546</td>
</tr>
</table>
<br clear="all" />

<p>Unique to DHCPv6 replies is the UDP source and destination ports,
        547 and 546 respectively.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Filtering</h3>

<p>An ethernet switch MUST be able to be configured to filter Router
      Advertisement and DHCPv6 reply messages under one or both of the
      following conditions:
</p>
<p>a) The source MAC address is not configured to belong to a router, or
      DHCPv6 server or relay.
</p>
<p>b) The source IPv6 link-local address is not configured to belong to
      a router, or DHCPv6 server or relay.
</p>
<p>c) The ethernet frame was not received on a port configured to as
      authorised to receive these messages.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Requests</h3>

<p>It may be desirable for a switch to only transmit Router
        Solicitation and DHCPv6 request messages out a port if it is
        configured as a port having a router, DHCPv6 server or relay. Comment
        is sought for this.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<p>Note to RFC Editor: this section may be removed on publication as an
      RFC.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>This document describes filtering features for ethernet switches, so
      improves security of IPv6 auto configuration in switched ethernet
      environments.
</p>
<p>It is unknown if this document introduces any security issues.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p>Discussion on the NANOG mailing list.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nathan Ward</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Braintrust Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Level 1, 206 Symonds St.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Auckland,   1010</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NZ</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+64-21-431675</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nward@braintrust.co.nz">nward@braintrust.co.nz</a></td></tr>
</table>
</body></html>
