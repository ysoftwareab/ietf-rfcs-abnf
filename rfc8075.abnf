tu = [ ( "coap:" / "coaps:" ) "//" ] host [ ":" port ] path-abempty
          [ "?" query ]

s  = "coap" / "coaps" ; from [RFC7252], Sections 6.1 and 6.2
hp = host [":" port]  ; from [RFC3986], Sections 3.2.2 and 3.2.3
p  = path-abempty     ; from [RFC3986], Section 3.3
q  = query            ; from [RFC3986], Section 3.4
qq = [ "?" query ]    ; qq is empty if and only if 'query' is empty

rt="core.hc";hct="?uri={+tu}"

coap_cf_registry=CoAPContentFormatRegistry(),
loose_mapper=None):
content_format = coap_cf_registry.lookup(media_type, encoding)

content_format = coap_cf_registry.lookup(
             loose_mapper.lookup(media_type), encoding)

T = MAX_RTT + MAX_SERVER_RESPONSE_DELAY

TEXT_PLAIN = 0
LINK_FORMAT = 40
XML = 41
OCTET_STREAM = 42
EXI = 47
JSON = 50
CBOR = 60
GROUP_JSON = 256

LOOKUP_TABLE = {
        ("text/plain;charset=utf-8", None): TEXT_PLAIN,
        ("application/link-format", None): LINK_FORMAT,
        ("application/xml", None): XML,
        ("application/octet-stream", None): OCTET_STREAM,
        ("application/exi", None): EXI,
        ("application/json", None): JSON,
        ("application/cbor", None): CBOR,
        ("application/coap-group+json", "utf-8"): GROUP_JSON,
LOOKUP_TABLE = [
        (re.compile("application/.+\+xml$"), "application/xml"),
        (re.compile("application/.+\+json$"), "application/json"),
        (re.compile("application/.+\+cbor$"), "application/cbor"),
        (re.compile("text/xml$"), "application/xml"),
        (re.compile("text/[a-z\.\-\+]+$"), "text/plain;charset=utf-8"),
        (re.compile("[a-z]+/[a-z\.\-\+]+$"), "application/octet-stream")
coap_cf_registry=CoAPContentFormatRegistry(),
loose_mapper=None):
content_format = coap_cf_registry.lookup(media_type, encoding)

content_format = coap_cf_registry.lookup(
            loose_mapper.lookup(media_type), encoding)

loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()),
loose_mapper=LooseMediaTypeMapper()))
loose_mapper=LooseMediaTypeMapper()))

loose_mapper=LooseMediaTypeMapper()))

loose_mapper=LooseMediaTypeMapper()))

loose_mapper=LooseMediaTypeMapper()))

