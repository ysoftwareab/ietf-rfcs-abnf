<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Neighbor Discovery Optimization for Low Power and Lossy Networks (6LoWPAN)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 The Shortcomings of IPv6 Neighbor Discovery">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Mesh-under and Route-over Concepts">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Applicability">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 Goals and Assumptions">
<link href="#rfc.section.1.5" rel="Chapter" title="1.5 Optional Features">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Overview">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Extensions to RFC4861">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Address Assignment">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Host-to-Router Interaction">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Router-to-Router Interaction">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Neighbor Cache Management">
<link href="#rfc.section.4" rel="Chapter" title="4 New Neighbor Discovery Options and Messages">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Address Registration Option">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 6LoWPAN Context Option">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Authoritative Border Router Option">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Duplicate Address messages">
<link href="#rfc.section.5" rel="Chapter" title="5 Host Behavior">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Forbidden Actions">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Interface Initialization">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Sending a Router Solicitation">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Processing a Router Advertisement">
<link href="#rfc.section.5.4.1" rel="Chapter" title="5.4.1 Address configuration">
<link href="#rfc.section.5.4.2" rel="Chapter" title="5.4.2 Storing Contexts">
<link href="#rfc.section.5.4.3" rel="Chapter" title="5.4.3 Maintaining Prefix and Context Information">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Registration and Neighbor Unreachability Detection">
<link href="#rfc.section.5.5.1" rel="Chapter" title="5.5.1 Sending a Neighbor Solicitation">
<link href="#rfc.section.5.5.2" rel="Chapter" title="5.5.2 Processing a Neighbor Advertisement">
<link href="#rfc.section.5.5.3" rel="Chapter" title="5.5.3 Recovering from Failures">
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Next-hop Determination">
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Address Resolution">
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Sleeping">
<link href="#rfc.section.5.8.1" rel="Chapter" title="5.8.1 Picking an Appropriate Registration Lifetime">
<link href="#rfc.section.5.8.2" rel="Chapter" title="5.8.2 Behavior on Wakeup">
<link href="#rfc.section.6" rel="Chapter" title="6 Router Behavior for 6LR and 6LBR">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Forbidden Actions">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Interface Initialization">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Processing a Router Solicitation">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Periodic Router Advertisements">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Processing a Neighbor Solicitation">
<link href="#rfc.section.6.5.1" rel="Chapter" title="6.5.1 Checking for Duplicates">
<link href="#rfc.section.6.5.2" rel="Chapter" title="6.5.2 Returning Address Registration Errors">
<link href="#rfc.section.6.5.3" rel="Chapter" title="6.5.3 Updating the Neighbor Cache">
<link href="#rfc.section.6.5.4" rel="Chapter" title="6.5.4 Next-hop Determination">
<link href="#rfc.section.6.5.5" rel="Chapter" title="6.5.5 Address Resolution between Routers">
<link href="#rfc.section.7" rel="Chapter" title="7 Border Router Behavior">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Prefix Determination">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Context Configuration and Management">
<link href="#rfc.section.8" rel="Chapter" title="8 Optional Behavior">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Multihop Prefix and Context Distribution">
<link href="#rfc.section.8.1.1" rel="Chapter" title="8.1.1 6LBRs Sending Router Advertisements">
<link href="#rfc.section.8.1.2" rel="Chapter" title="8.1.2 Routers Sending Router Solicitations">
<link href="#rfc.section.8.1.3" rel="Chapter" title="8.1.3 Routers Processing Router Advertisements">
<link href="#rfc.section.8.1.4" rel="Chapter" title="8.1.4 Storing the Information">
<link href="#rfc.section.8.1.5" rel="Chapter" title="8.1.5 Sending Router Advertisements">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Multihop Duplicate Address Detection">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Message Validation for DAR and DAC">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 Conceptual Data Structures">
<link href="#rfc.section.8.2.3" rel="Chapter" title="8.2.3 6LR Sending a Duplicate Address Request">
<link href="#rfc.section.8.2.4" rel="Chapter" title="8.2.4 6LBR Receiving a Duplicate Address Request">
<link href="#rfc.section.8.2.5" rel="Chapter" title="8.2.5 Processing a Duplicate Address Confirmation">
<link href="#rfc.section.8.2.6" rel="Chapter" title="8.2.6 Recovering from Failures">
<link href="#rfc.section.9" rel="Chapter" title="9 Protocol Constants">
<link href="#rfc.section.10" rel="Chapter" title="10 Examples">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Message Examples">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Host Bootstrapping Example">
<link href="#rfc.section.10.2.1" rel="Chapter" title="10.2.1 Host Bootstrapping Messages">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 Router Interaction Example">
<link href="#rfc.section.10.3.1" rel="Chapter" title="10.3.1 Bootstrapping a Router">
<link href="#rfc.section.10.3.2" rel="Chapter" title="10.3.2 Updating the Neighbor Cache">
<link href="#rfc.section.11" rel="Chapter" title="11 Security Considerations">
<link href="#rfc.section.12" rel="Chapter" title="12 IANA Considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 Guideline for New Features">
<link href="#rfc.section.14" rel="Chapter" title="14 Acknowledgments">
<link href="#rfc.section.15" rel="Chapter" title="15 Changelog">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.references.1" rel="Chapter" title="16.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="16.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The IETF 6LoWPAN working group defines IPv6 over Low-power Wireless Personal Area Networks such as IEEE 802.15.4. This and other similar link technologies have limited or no usage of multicast signaling due to energy conservation. In addition, the wireless network may not strictly follow traditional concept of IP subnets and IP links. IPv6 Neighbor Discovery was not designed for non-transitive wireless links. The traditional IPv6 link concept and heavy use of multicast make the protocol inefficient and sometimes impractical in a low power and lossy network. This document describes simple optimizations to IPv6 Neighbor Discovery, addressing mechanisms and duplicate address detection for 6LoWPAN and similar networks.  " />
  <meta name="description" content="The IETF 6LoWPAN working group defines IPv6 over Low-power Wireless Personal Area Networks such as IEEE 802.15.4. This and other similar link technologies have limited or no usage of multicast signaling due to energy conservation. In addition, the wireless network may not strictly follow traditional concept of IP subnets and IP links. IPv6 Neighbor Discovery was not designed for non-transitive wireless links. The traditional IPv6 link concept and heavy use of multicast make the protocol inefficient and sometimes impractical in a low power and lossy network. This document describes simple optimizations to IPv6 Neighbor Discovery, addressing mechanisms and duplicate address detection for 6LoWPAN and similar networks.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">6lowpan Working Group</td>
<td class="right">Z. Shelby, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Sensinode</td>
</tr>
<tr>
<td class="left">Updates: 4944 (if approved)</td>
<td class="right">S. Chakrabarti</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left">Expires: November 25, 2011</td>
<td class="right">E. Nordmark</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">May 24, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Neighbor Discovery Optimization for Low Power and Lossy Networks (6LoWPAN)<br />
  <span class="filename">draft-ietf-6lowpan-nd-16</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The IETF 6LoWPAN working group defines IPv6 over Low-power Wireless Personal Area Networks such as IEEE 802.15.4. This and other similar link technologies have limited or no usage of multicast signaling due to energy conservation. In addition, the wireless network may not strictly follow traditional concept of IP subnets and IP links. IPv6 Neighbor Discovery was not designed for non-transitive wireless links. The traditional IPv6 link concept and heavy use of multicast make the protocol inefficient and sometimes impractical in a low power and lossy network. This document describes simple optimizations to IPv6 Neighbor Discovery, addressing mechanisms and duplicate address detection for 6LoWPAN and similar networks.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 25, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">The Shortcomings of IPv6 Neighbor Discovery</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Mesh-under and Route-over Concepts</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Applicability</a>
</li>
<li>1.4.   <a href="#rfc.section.1.4">Goals and Assumptions</a>
</li>
<li>1.5.   <a href="#rfc.section.1.5">Optional Features</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Overview</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Extensions to RFC4861</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Address Assignment</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Host-to-Router Interaction</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Router-to-Router Interaction</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Neighbor Cache Management</a>
</li>
<li>4.   <a href="#rfc.section.4">New Neighbor Discovery Options and Messages</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Address Registration Option</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">6LoWPAN Context Option</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Authoritative Border Router Option</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Duplicate Address messages</a>
</li>
<li>5.   <a href="#rfc.section.5">Host Behavior</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Forbidden Actions</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Interface Initialization</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Sending a Router Solicitation</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Processing a Router Advertisement</a>
</li>
<li>5.4.1.   <a href="#rfc.section.5.4.1">Address configuration</a>
</li>
<li>5.4.2.   <a href="#rfc.section.5.4.2">Storing Contexts</a>
</li>
<li>5.4.3.   <a href="#rfc.section.5.4.3">Maintaining Prefix and Context Information</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Registration and Neighbor Unreachability Detection</a>
</li>
<li>5.5.1.   <a href="#rfc.section.5.5.1">Sending a Neighbor Solicitation</a>
</li>
<li>5.5.2.   <a href="#rfc.section.5.5.2">Processing a Neighbor Advertisement</a>
</li>
<li>5.5.3.   <a href="#rfc.section.5.5.3">Recovering from Failures</a>
</li>
<li>5.6.   <a href="#rfc.section.5.6">Next-hop Determination</a>
</li>
<li>5.7.   <a href="#rfc.section.5.7">Address Resolution</a>
</li>
<li>5.8.   <a href="#rfc.section.5.8">Sleeping</a>
</li>
<li>5.8.1.   <a href="#rfc.section.5.8.1">Picking an Appropriate Registration Lifetime</a>
</li>
<li>5.8.2.   <a href="#rfc.section.5.8.2">Behavior on Wakeup</a>
</li>
<li>6.   <a href="#rfc.section.6">Router Behavior for 6LR and 6LBR</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Forbidden Actions</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Interface Initialization</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Processing a Router Solicitation</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Periodic Router Advertisements</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">Processing a Neighbor Solicitation</a>
</li>
<li>6.5.1.   <a href="#rfc.section.6.5.1">Checking for Duplicates</a>
</li>
<li>6.5.2.   <a href="#rfc.section.6.5.2">Returning Address Registration Errors</a>
</li>
<li>6.5.3.   <a href="#rfc.section.6.5.3">Updating the Neighbor Cache</a>
</li>
<li>6.5.4.   <a href="#rfc.section.6.5.4">Next-hop Determination</a>
</li>
<li>6.5.5.   <a href="#rfc.section.6.5.5">Address Resolution between Routers</a>
</li>
<li>7.   <a href="#rfc.section.7">Border Router Behavior</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Prefix Determination</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Context Configuration and Management</a>
</li>
<li>8.   <a href="#rfc.section.8">Optional Behavior</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Multihop Prefix and Context Distribution</a>
</li>
<li>8.1.1.   <a href="#rfc.section.8.1.1">6LBRs Sending Router Advertisements</a>
</li>
<li>8.1.2.   <a href="#rfc.section.8.1.2">Routers Sending Router Solicitations</a>
</li>
<li>8.1.3.   <a href="#rfc.section.8.1.3">Routers Processing Router Advertisements</a>
</li>
<li>8.1.4.   <a href="#rfc.section.8.1.4">Storing the Information</a>
</li>
<li>8.1.5.   <a href="#rfc.section.8.1.5">Sending Router Advertisements</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Multihop Duplicate Address Detection</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Message Validation for DAR and DAC</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">Conceptual Data Structures</a>
</li>
<li>8.2.3.   <a href="#rfc.section.8.2.3">6LR Sending a Duplicate Address Request</a>
</li>
<li>8.2.4.   <a href="#rfc.section.8.2.4">6LBR Receiving a Duplicate Address Request</a>
</li>
<li>8.2.5.   <a href="#rfc.section.8.2.5">Processing a Duplicate Address Confirmation</a>
</li>
<li>8.2.6.   <a href="#rfc.section.8.2.6">Recovering from Failures</a>
</li>
<li>9.   <a href="#rfc.section.9">Protocol Constants</a>
</li>
<li>10.   <a href="#rfc.section.10">Examples</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Message Examples</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">Host Bootstrapping Example</a>
</li>
<li>10.2.1.   <a href="#rfc.section.10.2.1">Host Bootstrapping Messages</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">Router Interaction Example</a>
</li>
<li>10.3.1.   <a href="#rfc.section.10.3.1">Bootstrapping a Router</a>
</li>
<li>10.3.2.   <a href="#rfc.section.10.3.2">Updating the Neighbor Cache</a>
</li>
<li>11.   <a href="#rfc.section.11">Security Considerations</a>
</li>
<li>12.   <a href="#rfc.section.12">IANA Considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">Guideline for New Features</a>
</li>
<li>14.   <a href="#rfc.section.14">Acknowledgments</a>
</li>
<li>15.   <a href="#rfc.section.15">Changelog</a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<li>16.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>16.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The IPv6-over-IEEE 802.15.4 <a href="#RFC4944">[RFC4944]</a> document specifies how IPv6 is carried over an IEEE 802.15.4 network with the help of an adaptation layer which sits between the MAC layer and the IP network layer.  A link in a LoWPAN is characterized as lossy, low-power, low bit-rate, short range, with many nodes saving energy with long sleep periods. Multicast as used in IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> is not desirable in such a wireless low-power and lossy network. Moreover, LoWPAN links are asymmetric and non-transitive in nature. A LoWPAN is potentially composed of a large number of overlapping radio ranges. Although a given radio range has broadcast capabilities, the aggregation of these is a complex Non-Broadcast MultiAccess (NBMA, <a href="#RFC2491">[RFC2491]</a>) structure with generally no LoWPAN-wide multicast capabilities. Link-local scope is in reality defined by reachability and radio strength. Thus we can consider a LoWPAN to be made up of links with undetermined connectivity properties as in <a href="#RFC5889">[RFC5889]</a>, along with the corresponding address model assumptions defined therein.</p>
<p id="rfc.section.1.p.2">This specification introduces the following optimizations to IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> specifically aimed at low-power and lossy networks such as LoWPANs: </p>

<ul>
<li>Host-initiated interactions to allow for sleeping hosts.</li>
<li>Elimination of multicast-based address resolution for hosts.</li>
<li>A host address registration feature using a new option in unicast Neighbor Solicitation and Neighbor Advertisement messages.</li>
<li>A new Neighbor Discovery option to distribute 6LoWPAN header compression context to hosts.</li>
<li>Optional multihop distribution of prefix and 6LoWPAN header compression context.</li>
<li>Optional multihop duplicate address detection which uses two new ICMPv6 message types.</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.3">The document defines three new ICMPv6 message options: the required Address Registration option and the optional Authoritative Border Router and 6LoWPAN Context options. It also defines two new ICMPv6 message types: the Duplicate Address Request and Duplicate Address Confirmation.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#nd_problems" id="nd_problems">The Shortcomings of IPv6 Neighbor Discovery</a>
</h1>
<p id="rfc.section.1.1.p.1">IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> provides several important mechanisms used for Router Discovery, Address Resolution, Duplicate Address Detection, Redirect, along with Prefix and Parameter Discovery.</p>
<p id="rfc.section.1.1.p.2">Following power-on and initialization of the network in IPv6 Ethernet networks, a node joins the solicited-node multicast address on the interface and then performs Duplicate Address Detection (DAD) for the acquired link-local address by sending a solicited-node multicast message to the link.  After that it sends multicast messages to the all-router address to solicit router advertisements. If the host receives a valid Router Advertisement with the "A" flag, it autoconfigures the IPv6 address with the advertised prefix in the Router Advertisement (RA) message. Besides this, the IPv6 routers usually send router advertisements periodically on the network. RAs are sent to the all-node multicast address. Nodes send Neighbor Solicitation/Neighbor Advertisement messages to resolve the IPv6 address of the destination on the link. The Neighbor Solicitation messages used for address resolution are multicast. The Duplicate Address Detection procedure and the use of periodic Router Advertisement messages assumes that the nodes are powered on and reachable most of the time.</p>
<p id="rfc.section.1.1.p.3">In Neighbor Discovery the routers find the hosts by assuming that a subnet prefix maps to one broadcast domain, and then multicast Neighbor Solicitation messages to find the host and its link-layer address.  Furthermore, the DAD use of multicast assumes that all hosts that autoconfigure IPv6 addresses from the same prefix can be reached using link-local multicast messages.</p>
<p id="rfc.section.1.1.p.4">Note that the 'L' (on-link) bit in the Prefix Information option can be set to zero in Neighbor Discovery, which makes the host not use multicast Neighbor Solicitation (NS) messages for address resolution of other hosts, but routers still use multicast NS messages to find the hosts.</p>
<p id="rfc.section.1.1.p.5">In a LoWPAN, primarily two types of network topologies are found - star networks and mesh networks. A star network is similar to a regular IPv6 subnet with a router and a set of nodes connected to it via the same non-transitive link. But in Mesh networks, the nodes are capable of routing and forwarding packets. Due to the lossy nature of wireless communication and a changing radio environment, the IPv6-link node-set may change due to external physical factors. Thus the link is often unstable and the nodes appear to be moving without necessarily moving physically.  </p>
<p id="rfc.section.1.1.p.6">A LoWPAN can use two types of link-layer addresses; 16-bit short addresses and 64-bit unique addresses as defined in <a href="#RFC4944">[RFC4944]</a>.  Moreover, the available link-layer payload size is on the order of less than 100 bytes thus header compression is very useful.</p>
<p id="rfc.section.1.1.p.7">Considering the above characteristics in a LoWPAN, and the IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> protocol design center, some optimizations and extensions to Neighbor Discovery are useful for the wide deployment of IPv6 over low-powered and lossy networks such as 6LoWPANs.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> <a href="#mu_ro" id="mu_ro">Mesh-under and Route-over Concepts</a>
</h1>
<p id="rfc.section.1.2.p.1">In the 6LoWPAN context, often a link-layer mesh routing mechanism is referred to as "mesh-under" while routing/forwarding packets using IP-layer addresses is referred to as "route-over". The difference between mesh-under and route-over is similar to a bridged-network versus IP-routing using Ethernet. In a mesh-under network all nodes are on the same link which is served by one or more routers, which we call 6LoWPAN Border Routers (6LBR).  In a route-over network, there are multiple links in the 6LoWPAN. Unlike fixed IP links, these link's members may be changing due to the nature of the low-power and lossy behavior of wireless technology. Thus a route-over network is made up of a flexible set of links interconnected by interior routers, which we call 6LoWPAN Routers (6LR).  </p>
<p id="rfc.section.1.2.p.2">This specification is applicable to both mesh-under and route-over networks. However, in route-over networks, we have two types of routers - 6LBRs and 6LRs. 6LoWPAN Border Routers sit at the boundary of the 6LoWPAN and the rest of the network while 6LoWPAN Routers are inside the LoWPAN. 6LoWPAN Routers are assumed to be running a routing protocol.  </p>
<p id="rfc.section.1.2.p.3">In a mesh-under configuration a 6LBR is acting as the IPv6 router where all the hosts in the LoWPAN are on the same link, thus they are only one IP hop away. No 6LoWPAN Routers exist in this topology as forwarding is handled by a link-layer mesh routing protocol.  </p>
<p id="rfc.section.1.2.p.4">In a route-over configuration, Neighbor Discovery operations take place between hosts and 6LRs or 6LBRs. The 6LR nodes are able to send and receive Router Advertisements, Router Solicitations as well as forward and route IPv6 packets. Here packet forwarding happens at the IP layer.  </p>
<p id="rfc.section.1.2.p.5">In both types of configurations, hosts do not take part in routing and forwarding packets and they act as simple IPv6 hosts.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> <a href="#applicability" id="applicability">Applicability</a>
</h1>
<p id="rfc.section.1.3.p.1">In its Section 1, <a href="#RFC4861">[RFC4861]</a> foresees a document that covers operating IP over a particular link type and defines an exception to the otherwise general applicability of unmodified RFC 4861.  The present specification optimizes the usage of IPv6 Neighbor Discovery for LoWPANs in order to save energy and processing power of such nodes. The document, thus updates RFC 4944 to specify the use of the optimizations defined here.  </p>
<p id="rfc.section.1.3.p.2">The applicability of this specification is limited to LoWPANs where all nodes on the subnet implement these optimizations in a homogeneous way.  Although it is noted that some of these optimizations may be useful outside of 6LoWPAN, for example in general IPv6 low-power and lossy networks and possibly even in combination with <a href="#RFC4861">[RFC4861]</a>, the usage of such combinations is out of scope of this document.  </p>
<p id="rfc.section.1.3.p.3">In this document, we specify a set of behaviors between hosts and routers in LoWPANs. An implementation that adheres to this document MUST implement those behaviors.  The document also specifies a set of behaviors (multihop prefix or context dissemination, and separately multihop duplicate address detection) which are OPTIONAL to use.  An implementation of this specification SHOULD implement those optional to use pieces.  </p>
<p id="rfc.section.1.3.p.4">The optimizations described in this document apply to different topologies.  They are most useful for route-over and mesh-under configurations in Mesh topologies.  However, Star topology configurations will also benefit from the optimizations due to minimized signaling, robust handling of the non-transitive link, and header compression context information.  </p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> <a href="#goals" id="goals">Goals and Assumptions</a>
</h1>
<p id="rfc.section.1.4.p.1">The document has the following main goals and assumptions.  </p>
<p id="rfc.section.1.4.p.2">Goals: </p>

<ul>
<li>Optimize Neighbor Discovery with a mechanism that is minimal yet sufficient for the operation in both mesh-under and route-over configurations.</li>
<li>Minimize signaling by avoiding the use of multicast flooding and reducing the use of link-scope multicast messages.</li>
<li>Optimize the interfaces between hosts and their default routers.</li>
<li>Support for sleeping hosts.</li>
<li>Disseminate context information to hosts as needed by <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a>.</li>
<li>Optionally disseminate context information and prefix information from the border to all routers in a LoWPAN.</li>
<li>Optional duplicate address detection mechanism suitable for route-over LoWPANs.</li>
</ul>

<p> </p>
<p id="rfc.section.1.4.p.3">Assumptions: </p>

<ul>
<li>EUI-64 addresses are globally unique.</li>
<li>All nodes in the network have an EUI-64 interface identifier in order to do address auto-configuration and detect duplicate addresses.</li>
<li>The link layer technology is assumed to be low-power and lossy, exhibiting undetermined connectivity, such as IEEE 802.15.4 <a href="#RFC4944">[RFC4944]</a>. However, the Address Registration mechanism might be useful for other link layer technologies.</li>
<li>A 6LoWPAN is configured to share one or more global IPv6 address prefixes to enable hosts to move between routers in the 6LoWPAN without changing their IPv6 addresses.</li>
<li>When using the optional DAD mechanism of <a href="#optional_dad">Section 8.2</a> it is assumed that 6LRs register with all the 6LBRs.</li>
<li>If IEEE 802.15.4 16-bit short addresses are used, then some technique is used to ensure uniqueness of those link-layer addresses. That could be done using DHCPv6, the Address Registration Option based duplicate address detection (specified in <a href="#optional_dad">Section 8.2</a>) or other techniques outside of the scope of this document. </li>
<li>In order to preserve the uniqueness of addresses not derived from an EUI-64, they must be either assigned or checked for duplicates in the same way throughout the LoWPAN. This can be done using DHCPv6 for assignment and/or using the duplicate address detection mechanism specified in <a href="#optional_dad">Section 8.2</a> (or any other protocols developed for that purpose).</li>
<li>In order for <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a> to operate correctly, the compression context must match for all the hosts, 6LRs, and 6LBRs that can send, receive, or forward a given packet. If <a href="#optional_dist">Section 8.1</a> is used to distribute context information this implies that all the 6LBRs must coordinate the context information they distribute within a single 6LoWPAN.</li>
<li>This specification describes the operation of ND within a single LoWPAN. The participation of a node in multiple LoWPANs simultaneously may be possible, but is out of scope of this document.</li>
<li>Since the 6lowpan shares one single prefix throughout the network, mobility of nodes within the lowpan is transparent. Inter-lowpan mobility is out-of-scope of this document. When a node moves away from the registered default router, it SHOULD first de-register by sending a registration message with zero lifetime and then registers with a new default router that is reachable. To handle the case when a node loses connectivity with the default router involunterily, the node should use a suitably low registration lifetime.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.1.5">
<a href="#rfc.section.1.5">1.5.</a> <a href="#optional_features" id="optional_features">Optional Features</a>
</h1>
<p id="rfc.section.1.5.p.1">This document defines the optimization of Neighbor Discovery messages in host-router interface and introduces the communication in case of Route-over topology. The multhop prefix distribution by the 6LBR and multihop Duplicate Address Detection mechansims, as well as 6LowPAN context option are optional features for a 6LoWPAN deployment. A guideline for feature implementation and deployment is provided at the end of the document.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">This specification requires readers to be familiar with all the terms and concepts that are discussed in <a href="#RFC4861">"Neighbor Discovery for IP version 6"</a> <cite title="NONE">[RFC4861]</cite> <a href="#RFC4862">"IPv6 Stateless Address Autoconfiguration"</a> <cite title="NONE">[RFC4862]</cite>, <a href="#RFC4919">"IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals"</a> <cite title="NONE">[RFC4919]</cite>, <a href="#RFC4944">"Transmission of IPv6 Packets over IEEE 802.15.4 Networks"</a> <cite title="NONE">[RFC4944]</cite> and <a href="#RFC5889">"IP Addressing Model in Ad Hoc Networks"</a> <cite title="NONE">[RFC5889]</cite>.  </p>
<p id="rfc.section.2.p.3">This specification makes extensive use of the same terminology defined in <a href="#RFC4861">[RFC4861]</a> unless otherwise defined below.  </p>
<p></p>

<dl>
<dt>6LoWPAN link:</dt>
<dd style="margin-left: 8">
<br> A wireless link determined by single IP hop reachability of neighboring nodes. These are considered links with undetermined connectivity properties as in <a href="#RFC5889">[RFC5889]</a>.  </dd>
<dt>6LoWPAN Node (6LN):</dt>
<dd style="margin-left: 8">
<br> A 6LoWPAN Node is any host or router participating in a LoWPAN. This term is used when referring to situations in which either a host or router can play the role described.  </dd>
<dt>6LoWPAN Router (6LR):</dt>
<dd style="margin-left: 8">
<br> An intermediate router in the LoWPAN who can communicate with other 6LoWPAN routers in the same LoWPAN. 6LoWPAN routers are present only in route-over topologies.  </dd>
<dt>6LoWPAN Border Router (6LBR):</dt>
<dd style="margin-left: 8">
<br> A border router located at the junction of separate 6LoWPAN networks or between a 6LoWPAN network and another IP network. There may be one or more 6LBRs at the 6LoWPAN network boundary. A 6LBR is the responsible authority for IPv6 Prefix propagation for the 6LoWPAN network it is serving. An isolated LoWPAN also contains a 6LBR in the network, which provides the prefix(es) for the isolated network.  </dd>
<dt>Router:</dt>
<dd style="margin-left: 8">
<br>Either a 6LR or a 6LBR. Note that nothing in this document precludes a node being a router on some interfaces and a host on other interfaces as allowed by <a href="#RFC2460">[RFC2460]</a>.</dd>
<dt>Mesh-under:</dt>
<dd style="margin-left: 8">
<br> A topology where hosts are connected to a 6LBR through a mesh using link-layer forwarding. Thus in a mesh-under configuration all IPv6 hosts in a LoWPAN are only one IP hop away from the 6LBR. This topology simulates the typical IP-subnet topology with one router with multiple nodes in the same subnet.  </dd>
<dt>Route-over:</dt>
<dd style="margin-left: 8">
<br> A topology where hosts are connected to the 6LBR through the use of intermediate layer-3 (IP) routing. Here hosts are typically multiple IP hops away from a 6LBR. The route-over topology typically consists of a 6LBR, a set of 6LRs and hosts.  </dd>
<dt>Registration:</dt>
<dd style="margin-left: 8">
<br> The process during which a LoWPAN node sends an Neighbor Solicitation message with an Address Registration option to a Router creating a Neighbor Cache entry for the LoWPAN node with a specific timeout. Thus for 6LoWPAN Routers the Neighbor Cache doesn't behave like a cache. Instead it behaves as a registry of all the host addresses that are attached to the Router.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#overview" id="overview">Protocol Overview</a>
</h1>
<p id="rfc.section.3.p.1">These Neighbor Discovery optimizations are applicable to both mesh-under and route-over configurations. In a mesh-under configuration only 6LoWPAN Border Routers and hosts exist; there are no 6LoWPAN routers in mesh-under topologies.</p>
<p id="rfc.section.3.p.2">The most important part of the optimizations is the evolved host-to-router interaction that allows for sleeping nodes and avoids using multicast Neighbor Discovery messages except for the case of a host finding an initial set of default routers, and redoing such determination when that set of routers have become unreachable.  </p>
<p id="rfc.section.3.p.3">The protocol also provides for header compression <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a> by carrying header compression information in a new option in Router Advertisement messages.</p>
<p id="rfc.section.3.p.4">In addition, there are optional and separate mechanisms that can be used between 6LRs and 6LBRs to perform multihop Duplicate Address Detection and distribution of the Prefix and compression Context information from the 6LBRs to all the 6LRs, which in turn use normal Neighbor Discovery mechanisms to convey this information to the hosts.</p>
<p id="rfc.section.3.p.5">The protocol is designed so that the host-to-router interaction is not affected by the configuration of the 6LoWPAN; the host-to-router interaction is the same in a mesh-under and route-over configuration.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#Optimization" id="Optimization">Extensions to RFC4861</a>
</h1>
<p id="rfc.section.3.1.p.1">This document specifies the following optimizations and extensions to IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a>: </p>

<ul>
<li>Host initiated refresh of Router Advertisement information. This removes	the need for periodic or unsolicited Router Advertisements from routers to hosts.</li>
<li>No Duplicate Address Detection (DAD) is performed if EUI-64 based IPv6 addresses are used (as these addresses are assumed to be globally unique).</li>
<li>DAD is optional if DHCPv6 is used to assign addresses.</li>
<li>A New Address Registration mechanism using new Address Registration option between hosts and routers. This removes the need for Routers to use multicast Neighbor Solicitations to find hosts, and supports sleeping hosts. This also enables the same IPv6 address prefix(es) to be used across a route-over 6LoWPAN. It provides the host-to-router interface for Duplicate Address Detection. </li>
<li>A new optional Router Advertisement option for Context information used by 6LoWPAN header compression.</li>
<li>A new optional mechanism to perform Duplicate Address Detection across a route-over 6LoWPAN using the new Duplicate Address Request and Confirmation messages.</li>
<li>New optional mechanisms to distribute Prefixes and Context information across a route-over network which uses a new Authoritative Border Router option to control the flooding of configuration changes.</li>
<li>A few new default protocol constants are introduced and some existing Neighbor Discovery protocol constants are tuned.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#Addr-assign" id="Addr-assign">Address Assignment</a>
</h1>
<p id="rfc.section.3.2.p.1">Hosts in a 6LoWPAN configure their IPv6 address as specified in <a href="#RFC4861">[RFC4861]</a> and <a href="#RFC4862">[RFC4862]</a> based on the information received in Router Advertisement messages. The use of the M flag in this optimization is however more restrictive than in <a href="#RFC4861">[RFC4861]</a>. When the M flag is set a host is required to use DHCPv6 to assign any non-EUI-64 addresses. When the M flag is not set, the LoWPAN is required to support duplicate address detection, thus a host can then safely use the address registration mechanism to check non-EUI-64 addresses for uniqueness.</p>
<p id="rfc.section.3.2.p.2">6LRs MAY use the same mechanisms to configure their IPv6 addresses.</p>
<p id="rfc.section.3.2.p.3">The 6LBRs are responsible for managing the prefix(es) assigned to the 6LoWPAN, using manual configuration, DHCPv6 Prefix Delegation <a href="#RFC3633">[RFC3633]</a>, or other mechanisms.  In an isolated LoWPAN a ULA <a href="#RFC4193">[RFC4193]</a> prefix SHOULD be generated by the 6LBR.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#overview_hr" id="overview_hr">Host-to-Router Interaction</a>
</h1>
<p id="rfc.section.3.3.p.1">A host sends Router Solicitation messages at startup and also when it suspects that one of its default routers has become unreachable (after Neighbor Unreachability Detection towards the router fails).  </p>
<p id="rfc.section.3.3.p.2">Hosts receive Router Advertisement messages typically containing the Authoritative Border Router option (ABRO) and may optionally contain one or more 6LoWPAN Context options (6CO) in addition to the existing Prefix Information options (PIO) as described in <a href="#RFC4861">[RFC4861]</a>.</p>
<p id="rfc.section.3.3.p.3">When a host has configured a non-link-local IPv6 address, it registers that address with one or more of its default routers using the Address Registration option (ARO) in an NS message. The host chooses a lifetime of the registration and repeats the ARO option periodically (before the lifetime runs out) to maintain the registration. The lifetime should be chosen in such a way as to maintain the registration even while a host is sleeping. Likewise, mobile nodes that change their point of attachment often, should use a suitably short lifetime. </p>
<p id="rfc.section.3.3.p.4">The registration can fail (an ARO option returned to the host with a non-zero Status) if the router determines that the IPv6 address is already used by another host, that is, is used by a host with a different EUI-64.  This can be used to support non-EUI-64 based addresses such as temporary IPv6 addresses <a href="#RFC4941">[RFC4941]</a> or addresses based on an Interface ID that is a IEEE 802.15.4 16-bit short addresses.  Failure can also occur if the Neighbor Cache on that router is full.</p>
<p id="rfc.section.3.3.p.5">The re-registration of an address can be combined with Neighbor Unreachability Detection (NUD) of the router since both use unicast Neighbor Solicitation messages. This makes things efficient when a host wakes up to send a packet and both need to perform NUD to check that the router is still reachable, and refresh its registration with the router.</p>
<p id="rfc.section.3.3.p.6">The response to an address registration might not be immediate since in route-over configurations the 6LR might perform Duplicate Address Detection against the 6LBR. A host retransmits the Address Registration option until it is acknowledged by the receipt of a Address Registration option.</p>
<p id="rfc.section.3.3.p.7">As part of the optimizations, Address Resolution is not performed by multicasting Neighbor Solicitation messages as in <a href="#RFC4861">[RFC4861]</a>.  Instead, the routers maintain Neighbor Cache entries for all registered IPv6 addresses. If the address is not in the Neighbor Cache in the router, then the address either doesn't exist, or is assigned to a host attached to some other router in the 6LoWPAN, or is external to the 6LoWPAN. In a route-over configuration the routing protocol is used to route such packets toward the destination.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#overview_rr" id="overview_rr">Router-to-Router Interaction</a>
</h1>
<p id="rfc.section.3.4.p.1">The optional new router-to-router interaction is only for the route-over configuration where 6LRs are present. It is optional in this protocol since the functions it provides might be better provided by other protocol mechanisms, be it DHCPv6, link-layer mechanisms, the routing protocol, or something else. It is however assumed that all 6LRs in a network are configured to perform these functions homogeneously. Some mechanisms from this protocol might be used for router-to-router interaction, while others are provided by other protocols. For instance, context information and/or prefix information might be disseminated using this protocol, while Duplicate Address Detection is done using some other protocol.</p>
<p id="rfc.section.3.4.p.2">6LRs MAY act like a host during system startup and prefix configuration by sending Router Solicitation messages and autoconfiguring their IPv6 addresses unlike routers in <a href="#RFC4861">[RFC4861]</a>.</p>
<p id="rfc.section.3.4.p.3">When multihop prefix or context dissemination is used then the 6LRs store the ABRO, 6CO and Prefix Information received (directly or indirectly) from the 6LBRs and redistribute this information in the Router Advertisement they send to other 6LRs or send to hosts in response to a Router Solicitations. There is a version number field in the ABRO which is used to limit the flooding of updated information between the 6LRs.</p>
<p id="rfc.section.3.4.p.4">Optionally the 6LRs can perform Duplicate Address Detection against one or more 6LBRs using the new Duplicate Address Request (DAR) and Confirmation (DAC) messages, which carry the information from the Address Registration option. The DAR and DAC messages will be forwarded between the 6LR and 6LBRs thus the <a href="#RFC4861">[RFC4861]</a> rule for checking hop limit=255 does not apply to the DAR and DAC messages. Those multihop DAD messages MUST NOT modify any Neighbor Cache entries on the routers since we do not have the security benefits provided by the hop limit=255 check.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#nce_management" id="nce_management">Neighbor Cache Management</a>
</h1>
<p id="rfc.section.3.5.p.1">The use of explicit registrations with lifetimes plus the desire to not multicast Neighbor Solicitation messages for hosts imply that we manage the Neighbor Cache entries (NCE) slightly differently than in <a href="#RFC4861">[RFC4861]</a>. This results in three different types of NCEs and the types specify how those entries can be removed: <a href="#RFC4861">[RFC4861]</a>.  </p>

<dl>
<dt>Garbage-collectible: </dt>
<dd style="margin-left: 22">Entries that are subject to the normal rules in <a href="#RFC4861">[RFC4861]</a> that allow for garbage collection when low on memory. </dd>
<dt>Registered: </dt>
<dd style="margin-left: 22">Entries that have an explicit registered lifetime and are kept until this lifetime expires or they are explicitly unregistered. </dd>
<dt>Tentative: </dt>
<dd style="margin-left: 22">Entries that are temporary with a short lifetime, which typically get converted to Registered entries.</dd>
</dl>

<p> Note that the type of the NCE is orthogonal to the states specified in </p>
<p id="rfc.section.3.5.p.2">When a host interacts with a router by sending Router Solicitations this results in a Tentative NCE. Once a node successfully registers with a Router the result is a Registered NCE. As Routers send RAs to hosts, and when routers optionally receive RA messages or receive multicast NS messages from other Routers the result is Garbage-collectible NCEs. There can only be one kind of NCE for an IP address at a time.</p>
<p id="rfc.section.3.5.p.3">Neighbor Cache entries on Routers can additionally be added or deleted by a routing protocol used in the 6LoWPAN. This is useful if the routing protocol carries the link-layer addresses of the neighboring routers. Depending on the details of such routing protocols such NCEs could be either Registered or Garbage-collectible.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#message_options" id="message_options">New Neighbor Discovery Options and Messages</a>
</h1>
<p id="rfc.section.4.p.1">This section defines new Neighbor Discovery message options used by this specification. The Address Registration Option is mandatory, whereas the Authoritative Border Router Option and 6LoWPAN Context Option are optional. This section also defines the optional and new Duplicate Address Request and Confirmation messages.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#ARO" id="ARO">Address Registration Option</a>
</h1>
<p id="rfc.section.4.1.p.1">The routers need to know the set of host IP addresses that are directly reachable and their corresponding link-layer addresses. This needs to be maintained as the radio reachability changes. For this purpose an Address Registration Option (ARO) is introduced, which can be included in unicast Neighbor Solicitation (NS) messages sent by hosts. Thus it can be included in the unicast NS messages that a host sends as part of Neighbor Unreachability Detection to determine that it can still reach a default router.  The ARO is used by the receiving router to reliably maintain its Neighbor Cache. The same option is included in corresponding Neighbor Advertisement (NA) messages with a Status field indicating the success or failure of the registration. This option is always host initiated.</p>
<p id="rfc.section.4.1.p.2">The information contained in the ARO is also included in optional multihop DAR and DAC messages used between 6LRs to 6LBRs, but the option itself is not used in those messages.  </p>
<p id="rfc.section.4.1.p.3">The ARO is required for reliability and power saving. The lifetime field provides flexibility to the host to register an address which should be usable (continue to be advertised by the 6LR in the routing protocol etc.) during its intended sleep schedule.  </p>
<p id="rfc.section.4.1.p.4">The sender of the NS also includes the EUI-64 <a href="#EUI64">[EUI64]</a> of the interface it is registering an address from. This is used as a unique ID for the detection of duplicate addresses. It is used to tell the difference between the same node re-registering its address and a different node (with a different EUI-64) registering an address that is already in use by someone else. The EUI-64 is also used to deliver an NA carrying an error Status code to the EUI-64 based link-local IPv6 address of the host (see <a href="#errors">Section 6.5.2</a>).  </p>
<p id="rfc.section.4.1.p.5">When the ARO is used by hosts an SLLA option MUST be included and the address that is to be registered MUST be the IPv6 source address of the Neighbor Solicitation message.  </p>
<div id="#rfc.figure.1"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |   Length = 2  |    Status     |   Reserved    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Reserved            |     Registration Lifetime     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                            EUI-64                             +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	</pre>
<p id="rfc.section.4.1.p.6">Fields: </p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 15">TBD1</dd>
<dt>Length:</dt>
<dd style="margin-left: 15">8-bit unsigned integer.  The length of the option in units of 8 bytes. Always 2.</dd>
<dt>Status:</dt>
<dd style="margin-left: 15">8-bit unsigned integer.  Indicates the status of a registration in the NA response. MUST be set to 0 in NS messages. See below.</dd>
<dt>Reserved:</dt>
<dd style="margin-left: 15">This field is unused.  It MUST be initialized to zero by the sender and MUST be ignored by the receiver.</dd>
<dt>Registration Lifetime:</dt>
<dd style="margin-left: 15">16-bit unsigned integer.  The amount of time in a unit of 60 seconds that the router should retain the Neighbor Cache entry for the sender of the NS that includes this option. </dd>
<dt>EUI-64:</dt>
<dd style="margin-left: 15">64 bits. This field is used to uniquely identify the interface of the registered address by including the EUI-64 identifier <a href="#EUI64">[EUI64]</a> assigned to it unmodified.</dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.p.7">The Status values used in Neighbor Advertisements are: </p>
<div id="#rfc.table.1"></div>
<div id="#status-codes"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="center">Status </th>
<th class="center">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="center">0</td>
<td class="center">Success</td>
</tr>
<tr>
<td class="center">1</td>
<td class="center">Duplicate Address</td>
</tr>
<tr>
<td class="center">2</td>
<td class="center">Neighbor Cache Full</td>
</tr>
<tr>
<td class="center">3-255</td>
<td class="center">Allocated using Standards Action <a href="#RFC2434">[RFC2434]</a>
</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#s6CO" id="s6CO">6LoWPAN Context Option</a>
</h1>
<p id="rfc.section.4.2.p.1">The optional 6LoWPAN Context Option (6CO) carries prefix information for LoWPAN header compression, and is similar to the Prefix Information Option of <a href="#RFC4861">[RFC4861]</a>.  However, the prefixes can be remote as well as local to the LoWPAN since header compression potentially applies to all IPv6 addresses. This option allows for the dissemination of multiple contexts identified by a Context Identifier (CID) for use as specified in <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a>. A context may be a prefix of any length or an address (/128), and up to 16 6LoWPAN Context options may be carried in an Router Advertisement message.  </p>
<div id="#rfc.figure.2"></div>
<div id="#f6co_format"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Length    |Context Length | Res |C|  CID  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Reserved           |         Valid Lifetime        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
.                                                               .
.                       Context Prefix                          .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
		 </pre>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">TBD2 </dd>
<dt>Length:</dt>
<dd style="margin-left: 8">8-bit unsigned integer. The length of the option (including the type and length fields) in units of 8 bytes. May be 2 or 3 depending on the length of the Context Prefix field.  </dd>
<dt>Context Length:</dt>
<dd style="margin-left: 8">8-bit unsigned integer.  The number of leading bits in the Context Prefix field that are valid.  The value ranges from 0 to 128. If it is more than 64 then the Length MUST be 3.  </dd>
<dt>C:</dt>
<dd style="margin-left: 8">1-bit context compression flag. This flag indicates if the context is valid for use in compression.  A context that is not valid MUST NOT be used for compression, but SHOULD be used in decompression in case another compressor has not yet received the updated context information. This flag is used to manage the context lifecycle based on the recommendations in <a href="#context_management">Section 7.2</a>.  </dd>
<dt>CID:</dt>
<dd style="margin-left: 8">4-bit Context Identifier for this prefix information. CID is used by context based header compression specified in <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a>. The list of CIDs for a LoWPAN is configured by on the 6LBR that originates the context information for the 6LoWPAN.  </dd>
<dt>Res, Reserved:</dt>
<dd style="margin-left: 8">This field is unused. It MUST be initialized to zero by the sender and MUST be ignored by the receiver.  </dd>
<dt>Valid Lifetime:</dt>
<dd style="margin-left: 8">16-bit unsigned integer.  The length of time in a unit of 60 seconds (relative to the time the packet is received) that the context is valid for the purpose of header compression or decompression. A value of all zero bits (0x0) indicates that this context entry MUST be removed immediately.  </dd>
<dt>Context Prefix:</dt>
<dd style="margin-left: 8">The IPv6 prefix or address corresponding to the Context ID (CID) field. The valid length of this field is included in the Context Length field. This field is padded with zeros in order to make the option a multiple of 8-bytes.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#ABRO" id="ABRO">Authoritative Border Router Option</a>
</h1>
<p id="rfc.section.4.3.p.1">The optional Authoritative Border Router Option (ABRO) is needed when Router Advertisement (RA) messages are used to disseminate prefixes and context information across a route-over topology.  In this case 6LRs receive Prefix Information options from other 6LRs.  This implies that a 6LR can't just let the most recently received RA win.  In order to be able to reliably add and remove prefixes from the 6LoWPAN we need to carry information from the authoritative 6LBR.  This is done by introducing a version number which the 6LBR sets and 6LRs propagate as they propagate the prefix and context information with this Authoritative Border Router Option. When there are multiple 6LBRs they would have separate version number spaces. Thus this option needs to carry the IP address of the 6LBR that originated that set of information.  </p>
<p id="rfc.section.4.3.p.2">The Authoritative Border Router option MUST be included in all Router Advertisement messages in the case when Router Advertisements are used to propagate information between routers (as described in <a href="#optional_dad">Section 8.2</a>).  </p>
<div id="#rfc.figure.3"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |  Length = 3   |        Version Number         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            Reserved                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                          6LBR Address                         +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	</pre>
<p id="rfc.section.4.3.p.3">Fields: </p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 15">TBD3</dd>
<dt>Length:</dt>
<dd style="margin-left: 15">8-bit unsigned integer.  The length of the option in units of 8 bytes. Always 3.</dd>
<dt>Version Number:</dt>
<dd style="margin-left: 15">16-bit unsigned integer.  The version number corresponding to this set of information contained in the RA message. The authoritative 6LBR originating the prefix increases this version number each time its set of prefix or context information changes. This version number uses sequence number arithmetic as it may wrap around.</dd>
<dt>Reserved:</dt>
<dd style="margin-left: 15">This field is unused.  It MUST be initialized to zero by the sender and MUST be ignored by the receiver.</dd>
<dt>6LBR Address:</dt>
<dd style="margin-left: 15">IPv6 address of the 6LBR that is the origin of the included version number.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#DARDAC" id="DARDAC">Duplicate Address messages</a>
</h1>
<p id="rfc.section.4.4.p.1">For the optional multihop DAD exchanges between 6LR and 6LBR specified in <a href="#optional_dad">Section 8.2</a> there are two new ICMPv6 message types called the Duplicate Address Request (DAR) and Duplicate Address Confirmation (DAC).  We avoid reusing the Neighbor Solicitation and Neighbor Advertisement messages for this purpose since these messages are not subject to the hop limit=255 check as they are forwarded by intermediate 6LRs. The information contained in the messages are otherwise the same as would be in a Neighbor Solicitation carrying a Address Registration option, with the message format inlining the fields that are in the ARO.</p>
<p id="rfc.section.4.4.p.2">The DAR and DAC use the same message format with different ICMPv6 type values, and the Status field is only meaningful in the DAC message.</p>
<div id="#rfc.figure.4"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |     Code      |          Checksum             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    Status     |   Reserved    |     Registration Lifetime     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                            EUI-64                             +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                       Registered Address                      +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	</pre>
<p id="rfc.section.4.4.p.3">IP fields: </p>

<dl>
<dt>IPv6 source:</dt>
<dd style="margin-left: 15">A non link-local address of the sending router.</dd>
<dt>IPv6 destination:</dt>
<dd style="margin-left: 15">A non link-local address of the sending router. In a DAC this is just the source from the DAR.</dd>
<dt>Hop Limit:</dt>
<dd style="margin-left: 15">Set to MULTIHOP_HOPLIMIT on transmit.  MUST be ignored on receipt.</dd>
</dl>

<p> </p>
<p id="rfc.section.4.4.p.4">ICMP Fields: </p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 15">TBD4 for DAR and TBD5 for DAC</dd>
<dt>Code:</dt>
<dd style="margin-left: 15">Set to zero on transmit. MUST be ignored on receipt.</dd>
<dt>Checksum:</dt>
<dd style="margin-left: 15">The ICMP checksum. See <a href="#RFC4443">[RFC4443]</a>.</dd>
<dt>Status:</dt>
<dd style="margin-left: 15">8-bit unsigned integer.  Indicates the status of a registration in the DAC. MUST be set to 0 in DAR. See <a href="#status-codes">Table 1</a>.</dd>
<dt>Reserved:</dt>
<dd style="margin-left: 15">This field is unused.  It MUST be initialized to zero by the sender and MUST be ignored by the receiver.</dd>
<dt>Registration Lifetime:</dt>
<dd style="margin-left: 15">16-bit unsigned integer.  The amount of time in a unit of 60 seconds that the router should retain the Neighbor Cache entry for the sender of the NS that includes this option. A value of 0 indicates in an NS that the neighbor cache entry should be removed.</dd>
<dt>EUI-64:</dt>
<dd style="margin-left: 15">64 bits. This field is used to uniquely identify the interface of the registered address by including the EUI-64 identifier <a href="#EUI64">[EUI64]</a> assigned to it unmodified.</dd>
<dt>Registered Address:</dt>
<dd style="margin-left: 15">128-bit field. Carries the host address, which was contained in the IPv6 Source field in the NS that contained the ARO option sent by the host.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#host" id="host">Host Behavior</a>
</h1>
<p id="rfc.section.5.p.1">Hosts in a LoWPAN use the Address Registration option in the Neighbor Solicitation messages they send as a way to maintain the Neighbor Cache in the routers thereby removing the need for multicast Neighbor Solicitations to do address resolution. Unlike in <a href="#RFC4861">[RFC4861]</a> the hosts initiate updating the information they receive in Router Advertisements by sending Router Solicitations before the information expires. Finally, when Neighbor Unreachability Detection indicates that one or all default routers have become unreachable, then the host uses Router Solicitations to find a new set of default routers. </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#hFA" id="hFA">Forbidden Actions</a>
</h1>
<p id="rfc.section.5.1.p.1">A host would never multicast a Neighbor Solicitation message.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#host_interface" id="host_interface">Interface Initialization</a>
</h1>
<p id="rfc.section.5.2.p.1">When the interface on a host is initialized it follows the specification in <a href="#RFC4861">[RFC4861]</a>. A link-local address is formed based on the EUI-64 identifier <a href="#EUI64">[EUI64]</a> assigned to the interface as per <a href="#RFC4944">[RFC4944]</a> or the appropriate IP-over-foo document for the link, and then the host sends Router Solicitation messages as described in <a href="#RFC4861">[RFC4861]</a> Section 6.3.7.</p>
<p id="rfc.section.5.2.p.2">There is no need to join the Solicited-Node multicast address since nobody multicasts Neighbor Solicitations in this type of network. A host MUST join the all-nodes multicast address.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#host_sending_rs" id="host_sending_rs">Sending a Router Solicitation</a>
</h1>
<p id="rfc.section.5.3.p.1">The Router Solicitation is formatted as specified in <a href="#RFC4861">[RFC4861]</a> and sent to the IPv6 All-Routers multicast address (see <a href="#RFC4861">[RFC4861]</a> Section 6.3.7 for details). An SLLA option MUST be included to enable unicast Router Advertisements in response. An unspecified source address MUST NOT be used in RS messages.</p>
<p id="rfc.section.5.3.p.2">If the link layer supports a way to send packets to some kind of all-routers anycast link-layer address, then that MAY be used to convey theses packets to a router.</p>
<p id="rfc.section.5.3.p.3">Since hosts do not depend on multicast Router Advertisements to discover routers, the hosts need to intelligently retransmit Router Solicitations whenever the default router list is empty, one of its default routers becomes unreachable, or the lifetime of the prefixes and contexts in the previous RA are about to expire. The RECOMMENDED retransmissions it to initially send up to 3 (MAX_RTR_SOLICITATIONS) RS messages separated by at least 10 seconds (RTR_SOLICITATION_INTERVAL) as specified in <a href="#RFC4861">[RFC4861]</a>, and then switch to slower retransmissions. After the initial retransmissions the host SHOULD do binary exponential backoff of the retransmission timer for each subsequent retransmission. However, it is useful to have a maximum retransmission timer of 60 seconds (MAX_RTR_SOLICITATION_INTERVAL). In all cases the RS retransmissions are terminated when a RA is received.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#ra_proc" id="ra_proc">Processing a Router Advertisement</a>
</h1>
<p id="rfc.section.5.4.p.1">The processing of Router Advertisements is as in <a href="#RFC4861">[RFC4861]</a> with the addition of handling the 6LoWPAN Context option and triggering address registration when a new address has been configured. Furthermore, the SLLA option MUST be included in the RA. Unlike in <a href="#RFC4861">[RFC4861]</a>, the maximum value of the RA Router Lifetime field MAY be up to 0xFFFF (approximately 18 hours).</p>
<p id="rfc.section.5.4.p.2">Should the host erroneously receive a Prefix Information option with the 'L' (on-link) flag set, then that Prefix Information Option (PIO) MUST be ignored.</p>
<h1 id="rfc.section.5.4.1">
<a href="#rfc.section.5.4.1">5.4.1.</a> Address configuration</h1>
<p id="rfc.section.5.4.1.p.1">Address configuration follows <a href="#RFC4862">[RFC4862]</a>. For an address not derived from an EUI-64, the M flag of the RA determines how the address can be configured. If the M flag is set in the RA, then DHCPv6 MUST be used to assign the address. If the M flag is not set, then the address can be configured by any other means (and duplicate detection is performed as part of the registration process).</p>
<p id="rfc.section.5.4.1.p.2">Once an address has been configured it will be registered by unicasting a Neighbor Solicitation with the Address Registration option to one or more routers.</p>
<h1 id="rfc.section.5.4.2">
<a href="#rfc.section.5.4.2">5.4.2.</a> Storing Contexts</h1>
<p id="rfc.section.5.4.2.p.1">The host maintains a conceptual data structure for the context information it receives from the routers, which is called the Context Table.  This includes the Context ID, the prefix (from the Context Prefix field in the 6CO), the Compression bit, and the Valid Lifetime.  A Context Table entry that has the Compression bit clear is used for decompression when receiving packets, but MUST NOT be used for compression when sending packets.</p>
<p id="rfc.section.5.4.2.p.2">When a 6CO option is received in a Router Advertisement it is used to add or update the information in the Context Table. If the Context ID field in the 6CO matches an existing Context Table entry, then that entry is updated with the information in the 6CO. If the Valid Lifetime field in the 6CO is zero, then the entry is immediately deleted.</p>
<p id="rfc.section.5.4.2.p.3">If there is no matching entry in the Context Table, and the Valid Lifetime field is non-zero, then a new context is added to the Context Table. The 6CO is used to update the created entry.</p>
<p id="rfc.section.5.4.2.p.4">When the 6LBR changes the context information a host might not immediately notice. And in the worst case a host might have stale context information. For this reason 6LBRs use the recommendations in <a href="#context_management">Section 7.2</a> for carefully managing the context lifecycle. Nodes should be careful about using header compression in RA messages that include 6COs.  </p>
<h1 id="rfc.section.5.4.3">
<a href="#rfc.section.5.4.3">5.4.3.</a> Maintaining Prefix and Context Information</h1>
<p id="rfc.section.5.4.3.p.1">The prefix information is timed out as specified in <a href="#RFC4861">[RFC4861]</a>.  When the Valid Lifetime for a Context Table entry expires the entry is placed in a receive-only mode, which is the equivalent of receiving a 6CO for that context with C=0. The entry is held in receive-only mode for a period of twice the Default Router Lifetime, after which the entry is removed. </p>
<p id="rfc.section.5.4.3.p.2">A host should inspect the various lifetimes to determine when it should next initiate sending a Router Solicitation to ask for any updates to the information. The lifetimes that matter are the Default Router lifetime, the Valid Lifetime in the Prefix Information options, and the Valid Lifetime in the 6CO. The host SHOULD unicast one or more Router Solicitations to the router well before the minimum of those lifetimes (across all the prefixes and all the contexts) expire, and switch to multicast RS messages if there is no response to the unicasts. The retransmission behavior for the Router Solicitations is specified in section <a href="#host_sending_rs">Section 5.3</a>.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#host_registration" id="host_registration">Registration and Neighbor Unreachability Detection</a>
</h1>
<p id="rfc.section.5.5.p.1">Hosts send Unicast Neighbor Solicitation (NS) messages to register their IPv6 addresses, and also to do NUD to verify that their default routers are still reachable. The registration is performed by the host including an ARO in the Neighbor Solicitation it sends. Even if the host doesn't have data to send, but is expecting others to try to send packets to the host, the host needs to maintain its Neighbor Cache entries in the routers. This is done by sending NS messages with the ARO to the router well in advance of the registration lifetime expiring. NS messages are retransmitted up to MAX_UNICAST_SOLICIT times using a minimum timeout of RETRANS_TIMER until the host receives an Neighbor Advertisement message with an ARO option. </p>
<p id="rfc.section.5.5.p.2">Hosts that receive Router Advertisement messages from multiple default routers SHOULD attempt to register with more than one of them in order to increase the robustness of the network.</p>
<p id="rfc.section.5.5.p.3">Note that Neighbor Unreachability Detection probes can be suppressed by Reachability Confirmations from transport protocols or applications as specified in <a href="#RFC4861">[RFC4861]</a>.</p>
<p id="rfc.section.5.5.p.4">When a host knows it will no longer use a router it is registered, it SHOULD de-register with the router by sending an NS with an ARO containing a lifetime of 0. </p>
<h1 id="rfc.section.5.5.1">
<a href="#rfc.section.5.5.1">5.5.1.</a> <a href="#host_ns" id="host_ns">Sending a Neighbor Solicitation</a>
</h1>
<p id="rfc.section.5.5.1.p.1">The host triggers sending Neighbor Solicitation (NS) messages containing an ARO when a new address is configured, when it discovers a new default router, or well before the Registration Lifetime expires. Such an NS MUST include a Source Link-Layer Address (SLLA) option, since the router needs to record the link-layer address of the host. An unspecified source address MUST NOT be used in NS messages.</p>
<h1 id="rfc.section.5.5.2">
<a href="#rfc.section.5.5.2">5.5.2.</a> Processing a Neighbor Advertisement</h1>
<p id="rfc.section.5.5.2.p.1">A host handles Neighbor Advertisement messages as specified in <a href="#RFC4861">[RFC4861]</a>, with added logic described in this section for handling the Address Registration option.</p>
<p id="rfc.section.5.5.2.p.2">In addition to the normal validation of a Neighbor Advertisement and its options, the Address Registration option is verified as follows (if present). If the Length field is not two, the option is silently ignored. If the EUI-64 field does not match the EUI-64 of the interface, the option is silently ignored.  </p>
<p id="rfc.section.5.5.2.p.3">If the status field is zero, then the address registration was successful. The host saves the Registration Lifetime from the Address Registration option for use to trigger a new NS well before the lifetime expires. If the Status field is not equal to zero, the address registration has failed.  </p>
<h1 id="rfc.section.5.5.3">
<a href="#rfc.section.5.5.3">5.5.3.</a> Recovering from Failures</h1>
<p id="rfc.section.5.5.3.p.1">The procedure for maintaining reachability information about a neighbor is the same as in <a href="#RFC4861">[RFC4861]</a> Section 7.3 with the exception that address resolution is not performed. </p>
<p id="rfc.section.5.5.3.p.2">The address registration procedure may fail for two reasons: no response to Neighbor Solicitations is received (NUD failure), or an Address Registration option with a failure Status (Status &gt; 0) is received. In the case of NUD failure the entry for that router will be removed thus address registration is no longer of importance. When an Address Registration option with a non-zero Status field is received this indicates that registration for that address has failed. A failure Status of one indicates that a duplicate address was detected and the procedure described in <a href="#RFC4862">[RFC4862]</a> Section 5.4.5 is followed. The host MUST NOT use the address it tried to register. If the host has valid registrations with other routers, these MUST be removed by registering with each using a zero ARO lifetime. </p>
<p id="rfc.section.5.5.3.p.3">A Status code of two indicates that the Neighbor Cache of that router is full. In this case the host SHOULD remove this router from its default router list and attempt to register with another router. If the host has no more default routers it needs to revert to sending Router Solicitations as specified in section <a href="#host_sending_rs">Section 5.3</a>.</p>
<p id="rfc.section.5.5.3.p.4">Other failure codes may be defined in future documents.  </p>
<h1 id="rfc.section.5.6">
<a href="#rfc.section.5.6">5.6.</a> <a href="#host-nexthop" id="host-nexthop">Next-hop Determination</a>
</h1>
<p id="rfc.section.5.6.p.1">The IP address of the next-hop for a destination is determined as follows. Destinations to the link-local prefix (FE80::) are always sent on the link to that destination. It is assumed that link-local addresses are formed as specified in <a href="#host_interface">Section 5.2</a> from the EUI-64, and address resolution is not performed.  </p>
<p id="rfc.section.5.6.p.2">All other prefixes are assumed to be off-link <a href="#RFC5889">[RFC5889]</a>. Anycast addresses are always considered to be off-link. They are therefore sent to one of the routers in the Default Router List.  </p>
<p id="rfc.section.5.6.p.3">Multicast addresses are considered to be on-link and are resolved as specified in <a href="#RFC4944">[RFC4944]</a> or the appropriate IP-over-foo document.</p>
<p id="rfc.section.5.6.p.4">A LoWPAN Node is not required to maintain a minimum of one buffer per neighbor as specified in <a href="#RFC4861">[RFC4861]</a>, since packets are never queued while waiting for address resolution. </p>
<h1 id="rfc.section.5.7">
<a href="#rfc.section.5.7">5.7.</a> Address Resolution</h1>
<p id="rfc.section.5.7.p.1">The address registration mechanism and the SLLA option in Router Advertisement messages provide sufficient a priori state in routers and hosts to resolve an IPv6 address to its associated link-layer address. As all prefixes but the link-local prefix are always assumed to be off-link, multicast-based address resolution between neighbors is not needed.  </p>
<p id="rfc.section.5.7.p.2">Link-layer addresses for neighbors are stored in Neighbor Cache entries <a href="#RFC4861">[RFC4861]</a>.  In order to achieve LoWPAN compression, most global addresses are formed using a link-layer address. Thus a host can minimize memory usage by optimizing for this case and only storing link-layer address information if it differs from the link-layer address corresponding to the Interface ID of the IPv6 address (i.e., differs in more than the on-link/global bit being inverted).  </p>
<h1 id="rfc.section.5.8">
<a href="#rfc.section.5.8">5.8.</a> Sleeping</h1>
<p id="rfc.section.5.8.p.1">It is often advantageous for battery-powered hosts in LoWPANs to keep a low duty cycle. The optimizations described in this document enable hosts to sleep as described further in this section. Routers may want to cache traffic destined to a host which is sleeping, but such functionality is out of the scope of this document.</p>
<h1 id="rfc.section.5.8.1">
<a href="#rfc.section.5.8.1">5.8.1.</a> Picking an Appropriate Registration Lifetime</h1>
<p id="rfc.section.5.8.1.p.1">As all Neighbor Discovery messages are initiated by the hosts, this allows a host to sleep or otherwise be unreachable between NS/NA message exchanges. The Address Registration option attached to NS messages indicates to a router to keep the Neighbor Cache entry for that address valid for the period in the Registration Lifetime field. A host should choose a sleep time appropriate for its energy characteristics, and set a registration lifetime larger than the sleep time to ensure the registration is renewed successfully (considering e.g. clock drift and additional time for potential retransmissions of the re-registration). A host should also consider the stability of the network (how quickly the topology changes) when choosing its sleep time (and thus registration lifetime). A dynamic network requires a shorter sleep time so that routers don't keep invalid neighbor cache entries for nodes longer than necessary.</p>
<h1 id="rfc.section.5.8.2">
<a href="#rfc.section.5.8.2">5.8.2.</a> <a href="#be_wakeup" id="be_wakeup">Behavior on Wakeup</a>
</h1>
<p id="rfc.section.5.8.2.p.1">When a host wakes up from a sleep period it SHOULD maintain its current address registrations that will timeout before the next wakeup. This is done by sending Neighbor Solicitation messages with the Address Registration option as described in <a href="#host_ns">Section 5.5.1</a>. The host may also need to refresh its prefix and context information by sending a new unicast Router Solicitation (the maximum Router Lifetime is about 18 hours whereas the maximum Registration lifetime is about 7 days). If after wakeup the host (using NUD) determines that some or all previous default routers have become unreachable, then the host will send multicast Router Solicitations to discover new default router(s) and restart the address registration process.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#router" id="router">Router Behavior for 6LR and 6LBR</a>
</h1>
<p id="rfc.section.6.p.1">Both 6LRs and 6LBRs maintain the Neighbor Cache <a href="#RFC4861">[RFC4861]</a> based on the Address Registration Options they receive in Neighbor Advertisement messages from hosts, Neighbor Discovery packets from other nodes, and potentially a routing protocol used in the 6LoWPAN as outlined in <a href="#nce_management">Section 3.5</a>.</p>
<p id="rfc.section.6.p.2">The routers SHOULD NOT garbage collect Registered Neighbor Cache entries (see <a href="#overview_rr">Section 3.4</a>) since they need to retain them until the Registration Lifetime expires. Similarly, if Neighbor Unreachability Detection on the router determines that the host is UNREACHABLE (based on the logic in <a href="#RFC4861">[RFC4861]</a>), the Neighbor Cache entry SHOULD NOT be deleted but be retained until the Registration Lifetime expires. A renewed ARO should mark the cache entry as STALE. Thus for 6LoWPAN Routers the Neighbor Cache doesn't behave like a cache. Instead it behaves as a registry of all the host addresses that are attached to the Router.</p>
<p id="rfc.section.6.p.3">Routers MAY implement the Default Router Preferences <a href="#RFC4191">[RFC4191]</a> and use that to indicate to the host whether the router is a 6LBR or a 6LR. If this is implemented then 6LRs with no route to a border router MUST set Prf to (11) for low preference, other 6LRs MUST set Prf to (00) for normal preference, and 6LBRs MUST set Prf to (01) for high preference.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#router-forbidden" id="router-forbidden">Forbidden Actions</a>
</h1>
<p id="rfc.section.6.1.p.1">A router SHOULD NOT send Redirect messages in a route-over topology, but MAY send Redirect messages in a mesh-under topology. In route-over the link has non-transitive reachability and the router has no way to determine that the recipient of a Redirect message can reach the link-layer address.</p>
<p id="rfc.section.6.1.p.2">A router MUST NOT set the 'L' (on-link) flag in the Prefix Information options, since that might trigger hosts to send multicast Neighbor Solicitations.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Interface Initialization</h1>
<p id="rfc.section.6.2.p.1">A router initializes its interface more or less as in <a href="#RFC4861">[RFC4861]</a>.  However, a 6LR might want to wait to make its interfaces advertising (implicitly keeping the AdvSendAdvertisements flag clear) until it has received the prefix(es) and context information from its 6LBR. That is independent of whether prefixes and context information is disseminated using the methods specified in this document, or using some other method.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#rs_proc" id="rs_proc">Processing a Router Solicitation</a>
</h1>
<p id="rfc.section.6.3.p.1">A router processes Router Solicitation messages as specified in <a href="#RFC4861">[RFC4861]</a>. The differences relate to the inclusion of Authoritative Border Router options in the Router Advertisement (RA) messages, and the exclusive use of unicast Router Advertisements. If a 6LR has received an ABRO from a 6LBR, then it will include that option unmodified in the Router Advertisement messages it sends.  And if the 6LR has received RAs, whether with the same prefixes and context information or different, from a different 6LBR, then it will need to keep those prefixes and context information separately so that the RAs the 6LR sends will maintain the association between the ABRO and the prefixes and context information. The router can tell which 6LBR originated the prefixes and context information from the 6LBR Address field in the ABRO. When a router has information tied to multiple ABROs, a single RS will result in multiple RAs each containing a different ABRO.</p>
<p id="rfc.section.6.3.p.2">A Router Solicitation might be received from a host that has not yet registered its address with the router. Thus the router MUST NOT modify an existing Neighbor Cache entry based on the SLLA option from the Router Solicitation. However, a router MAY create a Tentative Neighbor Cache entry based on the SLLA option. Such a Tentative Neighbor Cache entry SHOULD be timed out in TENTATIVE_NCE_LIFETIME seconds unless a registration converts it into a Registered NCE.</p>
<p id="rfc.section.6.3.p.3">A 6LR or 6LBR MUST include a Source Link-layer address option in the Router Advertisements it sends. That is required so that the hosts will know the link-layer address of the router. Unlike in <a href="#RFC4861">[RFC4861]</a>, the maximum value of the RA Router Lifetime field MAY be up to 0xFFFF (approximately 18 hours).</p>
<p id="rfc.section.6.3.p.4">Unlike <a href="#RFC4861">[RFC4861]</a> which suggests multicast Router Advertisements, this specification optimizes the exchange by always unicasting RAs in response to RSs. This is possible since the RS always includes a SLLA option, which is used by the router to unicast the RA.  </p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Periodic Router Advertisements</h1>
<p id="rfc.section.6.4.p.1">A router does not need to send any periodic Router Advertisement messages since the hosts will solicit updated information by sending Router Solicitations before the lifetimes expire.</p>
<p id="rfc.section.6.4.p.2">However, if the routers use Router Advertisements to optionally distribute prefix and/or context information across a route-over topology, that might require periodic Router Advertisement messages. Such RAs are sent using the configurable MinRtrAdvInterval and MaxRtrAdvInterval as per <a href="#RFC4861">[RFC4861]</a>.</p>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> <a href="#router_ns" id="router_ns">Processing a Neighbor Solicitation</a>
</h1>
<p id="rfc.section.6.5.p.1">A router handles Neighbor Solicitation messages as specified in <a href="#RFC4861">[RFC4861]</a>, with added logic described in this section for handling the Address Registration option.</p>
<p id="rfc.section.6.5.p.2">In addition to the normal validation of a Neighbor Solicitation and its options, the Address Registration option is verified as follows (if present). If the Length field is not two, or if the Status field is not zero, then the Neighbor Solicitation is silently ignored.</p>
<p id="rfc.section.6.5.p.3">If the source address of the NS is the unspecified address, or if no SLLA option is included, then any included ARO is ignored, that is, the NS is processed as if it did not contain an ARO.</p>
<h1 id="rfc.section.6.5.1">
<a href="#rfc.section.6.5.1">6.5.1.</a> <a href="#duplicate" id="duplicate">Checking for Duplicates</a>
</h1>
<p id="rfc.section.6.5.1.p.1">If the NS contains a valid ARO, then the router inspects its Neighbor Cache on the arriving interface to see if it is a duplicate. If there is no Neighbor Cache entry for the IPv6 source address of the NS, then it isn't a duplicate. If there is such a Neighbor Cache entry and the EUI-64 is the same, then it isn't a duplicate either. Otherwise it is a duplicate address. Note that if multihop DAD (<a href="#optional_dad">Section 8.2</a>) is used then the checks are slightly different to take into account Tentative Neighbor Cache entries. In the case it is a duplicate address then the router responds with a unicast Neighbor Advertisement (NA) message with the ARO Status field set to one (to indicate the address is a duplicate) as described in <a href="#errors">Section 6.5.2</a>. In this case there is no modification to the Neighbor Cache. </p>
<h1 id="rfc.section.6.5.2">
<a href="#rfc.section.6.5.2">6.5.2.</a> <a href="#errors" id="errors">Returning Address Registration Errors</a>
</h1>
<p id="rfc.section.6.5.2.p.1">Address registration errors are not sent back to the source address of the NS due to a possible risk of L2 address collision. Instead the NA is sent to the link-local IPv6 address with the IID part derived from the EUI-64 field of the ARO as per <a href="#RFC4944">[RFC4944]</a>. In particular, this means that the universal/local bit needs to be inverted. The NA is formatted with a copy of the ARO from the NS, but with the Status field set to indicate the appropriate error. </p>
<h1 id="rfc.section.6.5.3">
<a href="#rfc.section.6.5.3">6.5.3.</a> <a href="#router_cache" id="router_cache">Updating the Neighbor Cache</a>
</h1>
<p id="rfc.section.6.5.3.p.1">If ARO did not result in a duplicate address being detected as above, then if the Registration Lifetime is non-zero the router creates (if it didn't exist) or updates (otherwise) a Neighbor Cache entry for the IPv6 source address of the NS. If the Neighbor Cache is full and a new entry needs to be created, then the router responds with a unicast NA with the ARO Status field set to two (to indicate the router's Neighbor Cache is full) as described in <a href="#errors">Section 6.5.2</a>. </p>
<p id="rfc.section.6.5.3.p.2">The Registration Lifetime and the EUI-64 are recorded in the Neighbor Cache entry. A unicast Neighbor Advertisement (NA) is then sent in response to the NS. This NA SHOULD include a copy of the ARO, with the Status field set to zero. A TLLA option is not required in the NA, since the host already knows the router's link-layer address from Router Advertisements.</p>
<p id="rfc.section.6.5.3.p.3">If the ARO contains a zero Registration Lifetime then any existing Neighbor Cache entry for the IPv6 source address of the NS MUST be deleted, and a NA sent as above.</p>
<p id="rfc.section.6.5.3.p.4">Should the Registration Lifetime in a Neighbor Cache entry expire, then the router MUST delete the cache entry.</p>
<p id="rfc.section.6.5.3.p.5">The addition and removal of Registered Neighbor Cache entries would result in notifying the routing protocol. </p>
<p id="rfc.section.6.5.3.p.6">Note: If the optional multihop DAD (<a href="#optional_dad">Section 8.2</a>) is used, then the updating of the Neighbor Cache is slightly different due to Tentative NCEs.</p>
<h1 id="rfc.section.6.5.4">
<a href="#rfc.section.6.5.4">6.5.4.</a> Next-hop Determination</h1>
<p id="rfc.section.6.5.4.p.1">In order to deliver a packet destined for a 6LN registered with a router, next-hop determination is slightly different for routers than hosts (see  <a href="#host-nexthop">Section 5.6</a>. The routing table is checked to determine the nexthop IP address. A registered Neghbor Cache Entry (NCE) determines if the nexthop IP-address is on-link. It is the responsibility of the routing protocol of the router to maintain on-link information about its registered neighbors. Tentative NCEs MUST NOT be used to determine on-link status of the registered nodes.  </p>
<h1 id="rfc.section.6.5.5">
<a href="#rfc.section.6.5.5">6.5.5.</a> <a href="#router_resolution" id="router_resolution">Address Resolution between Routers</a>
</h1>
<p id="rfc.section.6.5.5.p.1">There needs to be a mechanism somewhere for the routers to discover each other's link-layer addresses. If the routing protocol used between the routers provides this, then there is no need for the routers to use the Address Registration option between each other. Otherwise, the routers MAY use the ARO. When routers use ARO to register with each other and the optional multihop DAD <a href="#optional_dad">Section 8.2</a> is in use, then care should be taken to ensure that there isn't a flood of ARO-carrying messages sent to the 6LBR as each router hears an ARO from their neighboring routers. The details for this is out of scope of this document.</p>
<p id="rfc.section.6.5.5.p.2">Optionally Routers can use multicast Neighbor Solicitations as in <a href="#RFC4861">[RFC4861]</a> to resolve each others link-layer addresses.  Thus Routers MAY multicast Neighbor Solicitations for other routers, for example as a result of receiving some routing protocol update.  Routers MUST respond to multicast Neighbor Solicitations. This implies that Routers MUST join the Solicited-node multicast addresses as specified in <a href="#RFC4861">[RFC4861]</a>.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#border_router" id="border_router">Border Router Behavior</a>
</h1>
<p id="rfc.section.7.p.1">A 6LBR handles sending of Router Advertisements and processing of Neighbor Solicitations from hosts as specified above in section <a href="#router">Section 6</a>. A 6LBR SHOULD always include an Authoritative Border Router option in the Router Advertisements it sends, listing itself as the 6LBR Address. That requires that the 6LBR maintain the version number in stable storage, and increases the version number when some information in its Router Advertisements change. The information whose change affects the version are in the Prefix Information options (the prefixes or their lifetimes) and in the 6CO option (the prefixes, Context IDs, or lifetimes.)</p>
<p id="rfc.section.7.p.2">In addition, a 6LBR is somehow configured with the prefix or prefixes that are assigned to the LoWPAN, and advertises those in Router Advertisements as in <a href="#RFC4861">[RFC4861]</a>.  Optionally, in the case of route-over, those prefixes can be disseminated to all the 6LRs using the technique in <a href="#optional_dist">Section 8.1</a>. However, there might be mechanisms outside of the scope of this document that can be used instead for prefix dissemination with route-over.</p>
<p id="rfc.section.7.p.3">If the 6LoWPAN uses Header Compression <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a> with context then the 6LBR needs to manage the context IDs, and advertise those in Router Advertisements by including 6CO options in its Router Advertisements so that directly attached hosts are informed about the context IDs. Below we specify things to consider when the 6LBR needs to add, remove, or change the context information.  Optionally, in the case of route-over, the context information can be disseminated to all the 6LRs using the technique in <a href="#optional">Section 8</a>. However, there might be mechanisms outside of the scope of this document that can be used instead for disseminating context information with route-over.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#border_router_prefix" id="border_router_prefix">Prefix Determination</a>
</h1>
<p id="rfc.section.7.1.p.1">The prefix or prefixes used in a LoWPAN can be manually configured, or can be acquired using DHCPv6 Prefix Delegation <a href="#RFC3633">[RFC3633]</a>. For a LoWPAN that is isolated from the network, either permanently or occasionally, the 6LBR can assign a ULA prefix using <a href="#RFC4193">[RFC4193]</a>. The ULA prefix should be stored in stable storage so that the same prefix is used after a failure of the 6LBR.  If the LoWPAN has multiple 6LBRs, then they should be configured with the same set of prefixes. The set of prefixes are included in the Router Advertisement messages as specified in <a href="#RFC4861">[RFC4861]</a>.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#context_management" id="context_management">Context Configuration and Management</a>
</h1>
<p id="rfc.section.7.2.p.1">If the LoWPAN uses Header Compression <a href="#I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</a> with context then the 6LBR may be configured with context information and related context IDs. If the LoWPAN has multiple 6LBRs, then they MUST be configured with the same context information and context IDs.</p>
<p id="rfc.section.7.2.p.2">The context information carried in Router Advertisement (RA) messages originate at 6LBRs and must be disseminated to all the routers and hosts within the LoWPAN. RAs include one 6CO for each context. </p>
<p id="rfc.section.7.2.p.3">For the dissemination of context information using the 6CO, a strict lifecycle SHOULD be used in order to ensure the context information stays synchronized throughout the LoWPAN.  New context information SHOULD be introduced into the LoWPAN with C=0, to ensure it is known by all nodes that may have to decompress based on this context information.  Only when it is reasonable to assume that this information was successfully disseminated SHOULD an option with C=1 be sent, enabling the actual use of the context information for compression.  </p>
<p id="rfc.section.7.2.p.4">Conversely, to avoid that nodes send packets making use of previous values of contexts, resulting in ambiguity when receiving a packet that uses a recently changed context, old values of a context SHOULD be taken out of use for a while before new values are assigned to this specific context.  That is, in preparation for a change of context information, its dissemination SHOULD continue for at least MIN_CONTEXT_CHANGE_DELAY with C=0.  Only when it is reasonable to assume that the fact that the context is now invalid was successfully disseminated, should the context ID be taken out of dissemination or reused with a different Context Prefix field.  In the latter case, dissemination of the new value again SHOULD start with C=0, as above.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#optional" id="optional">Optional Behavior</a>
</h1>
<p id="rfc.section.8.p.1">Optionally the Router Advertisement messages can be used to disseminate prefixes and context information to all the 6LRs in a route-over topology. If all routers are configured to use another mechanism for such information distribution, this mechanism MAY stay unused.</p>
<p id="rfc.section.8.p.2">There is also the option for a 6LR to perform multi-hop DAD (for non-EUI-64 derived IPv6 addresses) against a 6LBR in a route-over topology by using the DAR and DAC messages. This is optional because there might be other ways to either allocate unique address, such as DHCPv6 <a href="#RFC3315">[RFC3315]</a>, or other future mechanisms for multihop DAD.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#optional_dist" id="optional_dist">Multihop Prefix and Context Distribution</a>
</h1>
<p id="rfc.section.8.1.p.1">The multihop distribution relies on Router Solicitation messages and Router Advertisement (RA) messages sent between routers, and using the ABRO version number to control the propagation of the information (prefixes and context information) that is being sent in the RAs.</p>
<p id="rfc.section.8.1.p.2">This multihop distribution mechanism can handle arbitrary information from an arbitrary number of 6LBRs. However, the semantics of the context information requires that all the 6LNs use the same information, whether they send, forward, or receive compressed packets. Thus the manager of the 6LBRs need to somehow ensure that the context information is in synchrony across the 6LBRs.  This can be handled in different ways. One possible way to ensure it is to treat the context and prefix information as originating from some logical or virtual source, which in essence means that it looks like the information is distributed from a single source.</p>
<p id="rfc.section.8.1.p.3">If a set of 6LBRs behave as a single one (using mechanisms out of scope of this document) so that the prefixes and contexts and ABRO version number will be the same from all the 6LBRs, then those 6LBRs can pick a single IP address to use in the ABRO option.</p>
<h1 id="rfc.section.8.1.1">
<a href="#rfc.section.8.1.1">8.1.1.</a> <a href="#br_ra" id="br_ra">6LBRs Sending Router Advertisements</a>
</h1>
<p id="rfc.section.8.1.1.p.1">6LBRs supporting multihop prefix and context distribution MUST include an ABRO in each of its RAs. The ABRO Version Number field is used to keep prefix and context information consistent throughout the LoWPAN along with the guidelines in <a href="#context_management">Section 7.2</a>. Each time any information in the set of PIO or 6CO options change, the ABRO Version is increased by one. </p>
<p id="rfc.section.8.1.1.p.2">This requires that the 6LBR maintain the PIO, 6CO, and ABRO Version Number in stable storage, since an old version number will be silently ignored by the 6LRs.</p>
<h1 id="rfc.section.8.1.2">
<a href="#rfc.section.8.1.2">8.1.2.</a> <a href="#r_rs_send" id="r_rs_send">Routers Sending Router Solicitations</a>
</h1>
<p id="rfc.section.8.1.2.p.1">If multihop distribution is done using Router Advertisement (RA) messages, then on interface initialization a router SHOULD send some Router Solicitation messages similarly to how hosts do this in <a href="#RFC4861">[RFC4861]</a>. That will cause the routers to respond with RA messages which then can be used to initially seed the prefix and context information.  </p>
<h1 id="rfc.section.8.1.3">
<a href="#rfc.section.8.1.3">8.1.3.</a> <a href="#r_ra_proc" id="r_ra_proc">Routers Processing Router Advertisements</a>
</h1>
<p id="rfc.section.8.1.3.p.1">If multihop distribution is not done using RA messages, then the routers follow <a href="#RFC4861">[RFC4861]</a> which states that they merely do some consistency checks and nothing in <a href="#optional_dist">Section 8.1</a> applies. Otherwise the routers will check and record the prefix and context information from the receive RAs, and use that information as follows.</p>
<p id="rfc.section.8.1.3.p.2">If a received RA does not contain a Authoritative Border Router option, then the RA MUST be silently ignored.</p>
<p id="rfc.section.8.1.3.p.3">The router uses the 6LBR Address field in the ABRO to check if it has previously received information from the 6LBR. If it finds no such information, then it just records the 6LBR Address and Version and the associated prefixes and context information. If the 6LBR is previously known, then the Version number field MUST be compared against the recorded version number for that 6LBR. The comparison MUST be done the same way as TCP sequence number comparisons to handle the case when the version number wraps around. If the version number received in the packet is less than the stored version number (following <a href="#RFC1982">[RFC1982]</a> Section 3.2), then the information in the RA is silently ignored. Otherwise the recorded information and version number are updated.</p>
<p id="rfc.section.8.1.3.p.4">By TCP sequence number comparison we mean that half of the version number space is "old" and half is "new". For example, if the current version number is 0x2, then anything between 0x80000003 (0x2-0x7fffffff) and 0x1 is old, and anything between 0x3 and 0x80000002 (0x2+0x8000000) is new.</p>
<h1 id="rfc.section.8.1.4">
<a href="#rfc.section.8.1.4">8.1.4.</a> <a href="#store_info" id="store_info">Storing the Information</a>
</h1>
<p id="rfc.section.8.1.4.p.1">The router keeps state for each 6LBR that it sees with an ABRO.  This includes the version number, and the complete set of Prefix Information options and 6LoWPAN Context options. The prefixes are timed out based on the Valid lifetime in the Prefix Information Option. The Context Prefix is timed out based on the Valid lifetime in the 6LoWPAN Context option.</p>
<p id="rfc.section.8.1.4.p.2">While the prefixes and context information are stored in the router their valid and preferred lifetimes are decremented as time passes. This ensures that when the router is in turn later advertising that information in the Router Advertisements it sends, the 'expiry time' doesn't accidentally move further into the future. For example, if a 6CO with a Valid lifetime of 10 minutes is received at time T, and the router includes this in a RA it sends at time T+5 minutes, the Valid lifetime in the 6CO it sends will be only 5 minutes.</p>
<h1 id="rfc.section.8.1.5">
<a href="#rfc.section.8.1.5">8.1.5.</a> <a href="#mh_ra" id="mh_ra">Sending Router Advertisements</a>
</h1>
<p id="rfc.section.8.1.5.p.1">If multihop distribution is performed using RA messages, then the routers MUST ensure that the ABRO always stay together with the prefixes and context information received with that ABRO. Thus if the router has received prefix P1 with ABRO saying it is from one 6LBR, and prefix P2 from another 6LBR, then the router MUST NOT include the two prefixes in the same RA message. Prefix P1 MUST be in a RA that include a ABRO from the first 6LBR etc. Note that multiple 6LBRs might advertise the same prefix and context information, but they still need to be associated with the 6LBRs that advertised them.</p>
<p id="rfc.section.8.1.5.p.2">The routers periodically send Router Advertisements as in <a href="#RFC4861">[RFC4861]</a>.  This is for the benefit of the other routers receiving the prefixes and context information. And the routers also respond to Router Solicitations by unicasting RA messages. In both cases the above constraint of keeping the ABRO together with 'its' prefixes and context information apply.</p>
<p id="rfc.section.8.1.5.p.3">When a router receives new information from a 6LBR, that is, either it hears from a new 6LBR (a new 6LBR Address in the ABRO) or the ABRO version number of an existing 6LBR has increased, then it is useful to send out a few triggered updates. The recommendation is to behave the same as when an interface has become an advertising interface in <a href="#RFC4861">[RFC4861]</a>, that is, send up to three RA messages. This ensures rapid propagation of new information to all the 6LRs.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#optional_dad" id="optional_dad">Multihop Duplicate Address Detection</a>
</h1>
<p id="rfc.section.8.2.p.1">The ARO can be used, in addition to registering an address in a 6LR, to have the 6LR verify that the address isn't used by some other host known to the 6LR.  However, that isn't sufficient in a route-over topology (or in a LoWPAN with multiple 6LBRs) since some host attached to another 6LR could be using the same address. There might be different ways for the 6LRs to coordinate such Duplicate Address Detection in the future, or addresses could be assigned using a DHCPv6 server that verifies uniqueness as part of the assignment. </p>
<p id="rfc.section.8.2.p.2">This specification offers an optional and simple technique for 6LRs and 6LBRs to perform Duplicate Address Detection that reuses the information from Address Registration option in the DAR and DAC messages. This technique is not needed when the Interface ID in the address is based on an EUI-64, since those are assumed to be globally unique. The technique assumes that the 6LRs either register with all the 6LBRs, or that the network uses some out-of-scope mechanism to keep the DAD tables in the 6LBRs synchronized.</p>
<p id="rfc.section.8.2.p.3">The multihop DAD mechanism is used synchronously the first time an address is registered with a particular 6LR. That is, the ARO option is not returned to the host until multihop DAD has been completed against the 6LBRs. For existing registrations in the 6LR the multihop DAD needs to be repeated against the 6LBRs to ensure that the entry for the address in the 6LBRs does not time out, but that can be done asynchronously with the response to the hosts. For instance, by tracking how much is left of the lifetime the 6LR registered with the 6LBRs and re-registering with the 6LBR when this lifetime is about to run out.</p>
<p id="rfc.section.8.2.p.4">For the synchronous multihop DAD the 6LR performs some additional checks to ensure that it has a Neighbor Cache entry it can use to respond to the host when it receives a response from a 6LBR. This consists of checking for an already existing (Tentative or Registered) Neighbor Cache entry for the registered address with a different EUI-64. If such a Registered NCE exists, then the 6LR SHOULD respond that the address is a duplicate. If such a Tentative NCE exists, then the 6LR SHOULD silently ignore the ARO thereby relying on the host retransmitting the ARO. This is needed to handle the case when multiple hosts try to register the same IPv6 address at the same time. If no Neighbor Cache entry exists, then the 6LR MUST create a Tentative Neighbor Cache entry with the EUI-64 and the SLLAO. This entry will be used to send the response to the host when the 6LBR responds positively.</p>
<p id="rfc.section.8.2.p.5">When a 6LR receives a Neighbor Solicitation containing an Address Registration option with a non-zero Registration Lifetime and it has no existing Registered Neighbor Cache entry, then with this mechanism the 6LR will invoke synchronous multihop DAD.</p>
<p id="rfc.section.8.2.p.6">The 6LR will unicast a Duplicate Address Request message to one or more 6LBRs, where the DAR contains the host's address in the Registered Address field.  The DAR will be forwarded by 6LRs until it reaches the 6LBR, hence its IPv6 hop limit field will not be 255 when received by the 6LBR. The 6LBR will respond with a Duplicate Address Confirmation message, which will have a hop limit less than 255 when it reaches the 6LR.</p>
<p id="rfc.section.8.2.p.7">When the 6LR receives the DAC from the 6LBR, it will look for a matching (same IP address and EUI-64) (Tentative or Registered) Neighbor Cache entry. If no such entry is found then the DAC is silently ignored. If an entry is found and the DAC had Status=0 then the 6LR will mark the Tentative Neighbor Cache entry as Registered.  In all cases when an entry is found then the 6LR will respond to the host with an NA, copying the Status and EUI-64 fields from the DAC to an ARO option in the NA. In case the status is an error, then the destination IP address of the NA is derived from the EUI-64 field of the DAC.</p>
<p id="rfc.section.8.2.p.8">A Tentative Neighbor Cache entry SHOULD be timed out TENTATIVE_NCE_LIFETIME seconds after it was created in order to allow for another host to attempt to register the IPv6 address.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> <a href="#DAR-validation" id="DAR-validation">Message Validation for DAR and DAC</a>
</h1>
<p id="rfc.section.8.2.1.p.1">A node MUST silently discard any received Duplicate Address Request and Confirmation messages that do not satisfy all of the following validity checks: </p>

<ul>
<li>If the message includes an IP Authentication Header, the message authenticates correctly.</li>
<li>ICMP Checksum is valid.</li>
<li>ICMP Code is 0.</li>
<li>ICMP length (derived from the IP length) is 32 or more bytes.</li>
<li>The Registered Address is not a multicast address.</li>
<li>All included options have a length that is greater than zero.</li>
<li>The IP source address is not the unspecified address, nor a multicast address.</li>
</ul>

<p> </p>
<p id="rfc.section.8.2.1.p.2">The contents of the Reserved field, and of any unrecognized options, MUST be ignored.  Future, backward-compatible changes to the protocol may specify the contents of the Reserved field or add new options; backward-incompatible changes may use different Code values.  </p>
<p id="rfc.section.8.2.1.p.3">Note that due to the forwarding of the DAR and DAC messages between the 6LR and 6LBR there is no hop limit check on receipt for these ICMPv6 message types.  </p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> Conceptual Data Structures</h1>
<p id="rfc.section.8.2.2.p.1">A 6LBR implementing the optional multihop DAD needs to maintain some state separate from the Neighbor Cache. We call this conceptual data structure the DAD table. It is indexed by the IPv6 address - the Registered Address in the DAR - and contains the EUI-64 and the registration lifetime of the host that is using that address.</p>
<h1 id="rfc.section.8.2.3">
<a href="#rfc.section.8.2.3">8.2.3.</a> 6LR Sending a Duplicate Address Request</h1>
<p id="rfc.section.8.2.3.p.1">When a 6LR that implements the optional multihop DAD receives an NS from a host and subject to the above checks, the 6LR forms and sends a DAR to at least one 6LBR.  The DAR contains the following information: </p>

<ul>
<li>In the IPv6 source address, a global address of the 6LR.</li>
<li>In the IPv6 destination address, the address of the 6LBR.</li>
<li>In the IPv6 hop limit, MULTIHOP_HOPLIMIT.</li>
<li>The Status field MUST be set to zero</li>
<li>The EUI-64 and Registration lifetime are copied from the ARO received from the host.</li>
<li>The Registered Address set to the IPv6 address of the host, that is, the sender of the triggering NS.</li>
</ul>

<p> </p>
<p id="rfc.section.8.2.3.p.2">When a 6LR receives an NS from a host with a zero Registration Lifetime then, in addition to removing the Neighbor Cache entry for the host as specified in section <a href="#router">Section 6</a>, an DAR is sent to the 6LBRs as above.</p>
<p id="rfc.section.8.2.3.p.3">A router MUST NOT modify the Neighbor Cache as a result of receiving a Duplicate Address Request.</p>
<h1 id="rfc.section.8.2.4">
<a href="#rfc.section.8.2.4">8.2.4.</a> 6LBR Receiving a Duplicate Address Request</h1>
<p id="rfc.section.8.2.4.p.1">When a 6LBR that implements the optional multihop DAD receives an DAR from a 6LR, it performs the message validation specified in <a href="#DAR-validation">Section 8.2.1</a>. If the DAR is valid the 6LBR proceeds to look for the Registration Address in the DAD Table. If an entry is found and the recorded EUI-64 is different than the EUI-64 in the DAR, then it returns a DAC NA with the Status set to 1 ('Duplicate Address'). Otherwise it returns a DAC with Status set to zero and updates the lifetime.</p>
<p id="rfc.section.8.2.4.p.2">If no entry is found in the DAD Table and the Registration Lifetime is non-zero, then an entry is created and the EUI-64 and Registered Address from the DAR are stored in that entry.</p>
<p id="rfc.section.8.2.4.p.3">If an entry is found in the DAD Table, the EUI-64 matches, and the Registration Lifetime is zero then the entry is deleted from the table.</p>
<p id="rfc.section.8.2.4.p.4">In both of the above cases the 6LBR forms an DAC with the information copied from the DAR and the Status field is set to zero. The DAC is sent back to the 6LR i.e., back to the source of the DAR. The IPv6 hop limit is set to MULTIHOP_HOPLIMIT</p>
<h1 id="rfc.section.8.2.5">
<a href="#rfc.section.8.2.5">8.2.5.</a> Processing a Duplicate Address Confirmation</h1>
<p id="rfc.section.8.2.5.p.1">When a 6LR that implements the optional multihop DAD receives a DAC message, then it first validates the message per <a href="#DAR-validation">Section 8.2.1</a>. For a valid DAC, if there is no Tentative Neighbor Cache entry matching the Registered address and EUI-64, then the DAC is silently ignored. Otherwise, the information in the DAC and in the Tentative Neighbor Cache entry is used to form an NA to send to the host. The Status code is copied from the DAC to the ARO that is sent to the host. In case of the DAC indicates an error (the Status is non-zero), the NA is returned to the host as described in <a href="#errors">Section 6.5.2</a> and the Tentative Neighbor Cache entry for the Registered Address is removed. Otherwise it is made into a Registered Neighbor Cache entry.</p>
<p id="rfc.section.8.2.5.p.2">A router MUST NOT modify the Neighbor Cache as a result of receiving a Duplicate Address Confirmation, unless there is a Tentative Neighbor Cache entry matching the IPv6 address and EUI-64.</p>
<h1 id="rfc.section.8.2.6">
<a href="#rfc.section.8.2.6">8.2.6.</a> Recovering from Failures</h1>
<p id="rfc.section.8.2.6.p.1">If there is no response from a 6LBR after RETRANS_TIMER <a href="#RFC4861">[RFC4861]</a> then the 6LR would retransmit the DAR to the 6LBR up to MAX_UNICAST_SOLICIT <a href="#RFC4861">[RFC4861]</a> times. After this the 6LR SHOULD respond to the host with an ARO Status of zero.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#constants" id="constants">Protocol Constants</a>
</h1>
<p id="rfc.section.9.p.1">This section defines the relevant protocol constants used in this document based on a subset of <a href="#RFC4861">[RFC4861]</a> constants. (*) indicates constants modified from <a href="#RFC4861">[RFC4861]</a> and (+) indicates new constants.  </p>
<p id="rfc.section.9.p.2">Additional protocol constants are defined in <a href="#message_options">Section 4</a>.  </p>
<p id="rfc.section.9.p.3">6LBR Constants: </p>

<dl>
<dt>MIN_CONTEXT_CHANGE_DELAY+</dt>
<dd style="margin-left: 40">300 seconds</dd>
</dl>

<p> </p>
<p id="rfc.section.9.p.4">6LR Constants: </p>

<dl>
<dt>MAX_RTR_ADVERTISEMENTS</dt>
<dd style="margin-left: 40">3 transmissions</dd>
<dt>MIN_DELAY_BETWEEN_RAS*</dt>
<dd style="margin-left: 40">10 seconds</dd>
<dt>MAX_RA_DELAY_TIME*</dt>
<dd style="margin-left: 40">2 seconds</dd>
<dt>TENTATIVE_NCE_LIFETIME+</dt>
<dd style="margin-left: 40">20 seconds</dd>
</dl>

<p> </p>
<p id="rfc.section.9.p.5">Router Constants: </p>

<dl>
<dt>MULTIHOP_HOPLIMIT+</dt>
<dd style="margin-left: 40">64</dd>
</dl>

<p> </p>
<p id="rfc.section.9.p.6">Host Constants: </p>

<dl>
<dt>RTR_SOLICITATION_INTERVAL*</dt>
<dd style="margin-left: 40">10 seconds</dd>
<dt>MAX_RTR_SOLICITATIONS</dt>
<dd style="margin-left: 40">3 transmissions</dd>
<dt>MAX_RTR_SOLICITATION_INTERVAL+</dt>
<dd style="margin-left: 40">60 seconds</dd>
</dl>

<p> </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> <a href="#examples_msg" id="examples_msg">Message Examples</a>
</h1>
<div id="#rfc.figure.5"></div>
<div id="#figmessrsra"></div>
<pre>

STEP

   6LN                                                        6LR

    |                                                          |

1.  |       ---------- Router Solicitation --------&gt;           |

    |                       [SLLAO]                            |

    |                                                          |

2.  |       &lt;-------- Router Advertisement ---------           |

    |              [PIO + 6CO + ABRO + SLLAO]                  |



</pre>
<div id="#rfc.figure.6"></div>
<div id="#figmessbasic"></div>
<pre>


   6LN                                                        6LR

    |                                                          |

1.  |       ------- NS with Address Registration ------&gt;       |

    |                     [ARO + SLLAO]                        |

    |                                                          |

2.  |       &lt;----- NA with Address Registration --------       |

    |                   [ARO with Status]                      |



 </pre>
<div id="#rfc.figure.7"></div>
<div id="#figmessmdad"></div>
<pre>


   6LN                           6LR                          6LBR

    |                             |                             |

1.  | --- NS with Address Reg --&gt; |                             |

    |      [ARO + SLLAO]          |                             |

    |                             |                             |

2.  |                             | ----------- DAR ----------&gt; |

    |                             |                             |

3.  |                             | &lt;---------- DAC ----------- |

    |                             |                             |

4.  | &lt;-- NA with Address Reg --- |                             |

    |      [ARO with Status]      |

</pre>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> <a href="#examples_boot" id="examples_boot">Host Bootstrapping Example</a>
</h1>
<p id="rfc.section.10.2.p.1">The following example describes the address bootstrapping scenarios using the optimized ND mechanisms specified in this document. It is assumed that the 6LN first performs a sequence of operations in order to get secure access at the link-layer of the LoWPAN and obtain a key for link-layer security. The methods of how to establish the link-layer security is out of scope of this document. In this example an IEEE 802.15.4 6LN forms a 16-bit short-address based IPv6 addresses without using DHCPv6 (i.e., the M flag is not set in the Router Advertisements).</p>
<p id="rfc.section.10.2.p.2">1. After obtaining link-level security, a 6LN assigns a link-local IPv6 address to itself. A link-local IPv6 address is configured based on the 6LN's EUI-64 link-layer address formed as per <a href="#RFC4944">[RFC4944]</a>.</p>
<p id="rfc.section.10.2.p.3">2. Next the 6LN determines one or more default routers in the network by sending an RS to the all-routers multicast address with the SLLA Option set to its EUI-64 link-local address. If the 6LN was able to obtain the link-layer address of a router through its link-layer operations then the 6LN may form a link-local destination IPv6 address for the router and send it a unicast RS. The 6LR responds with a unicast RA to the IP source using the SLLAO from the RS (it may have created a tentative NCE). See <a href="#figmessrsra">Figure 5</a>. </p>
<p id="rfc.section.10.2.p.4">3. In order to communicate more than one IP hop away the 6LN configures a global IPv6 address. In order to save overhead, this 6LN wishes to configure its IPv6 address based on a 16-bit short address as per <a href="#RFC4944">[RFC4944]</a>. As the network is unmanaged (M flag not set in RA), the 6LN randomly chooses a 16-bit link-layer address and forms a tentative IPv6 address from it.  </p>
<p id="rfc.section.10.2.p.5">4. Next the 6LN registers that address with one or more of its default routers by sending a unicast NS message with an ARO containing its tentative global IPv6 address to register, the registration lifetime and its EUI-64. An SLLAO is also included with the link-layer address corresponding to the address being registered. If a successful (status 0) NA message is received the address can then be used and the 6LN assumes it has been successfully checked for duplicates. If a duplicate address (status 1) NA message is received, the 6LN then removes the temporary IPv6 address and 16-bit link-layer address and goes back to step 3. If a neighbor cache full (status 2) message is received, the 6LN attempts to register with another default router, or if none, goes back to step 2. See <a href="#figmessbasic">Figure 6</a>. Note that an NA message returning an error would be sent back to the link-local EUI-64 based IPv6 address of the 6LN instead of the 16-bit (duplicate) address.  </p>
<p id="rfc.section.10.2.p.6">5. The 6LN now performs maintenance by sending a new NS address registration before the lifetime expires.  </p>
<p id="rfc.section.10.2.p.7">If multihop DAD and multihop prefix and context distribution is used, the effect of the 6LRs and hosts following the above bootstrapping is a "wavefront" of 6LRs and host being configured spreading from the 6LBRs. First the hosts and 6LRs that can directly reach a 6LBR would receive one or more RAs and configure and register their IPv6 addresses. Once that is done they would enable the routing protocol and start sending out Router Advertisements. That would result in a new set of 6LRs and hosts to receive responses to their Router Solicitations, form and register their addresses, etc. That repeats until all of the 6LRs and hosts have been configured.</p>
<h1 id="rfc.section.10.2.1">
<a href="#rfc.section.10.2.1">10.2.1.</a> <a href="#examples_annotation" id="examples_annotation">Host Bootstrapping Messages</a>
</h1>
<p id="rfc.section.10.2.1.p.1">This section brings specific message examples to the previous bootstrapping process.  When discussing messages, the following notation is used:</p>
<p id="rfc.section.10.2.1.p.2">LL64: Link-Local Address based on the EUI-64, which is also the 802.15.4 Long Address.  </p>
<p id="rfc.section.10.2.1.p.3">GP16: Global Address based on the 802.15.4 Short Address.  This address may not be unique.  </p>
<p id="rfc.section.10.2.1.p.4">GP64: Global addresses derived from the EUI-64 address as specified in RFC 4944.</p>
<p id="rfc.section.10.2.1.p.5">MAC64: EUI-64 address used as the link-layer address.</p>
<p id="rfc.section.10.2.1.p.6">MAC16: IEEE 802.15.4 16-bit short address.</p>
<p id="rfc.section.10.2.1.p.7">Note that some implementations may use LL64 and GP16 style addresses 	 instead of LL64 and GP64. In the following, we will show an example message flow as to how a node uses LL64 to register a GP16 address for multihop DAD verification.</p>
<div id="#rfc.figure.8"></div>
<div id="#figmessexamples"></div>
<pre>

  6LN-----RS--------&gt;6LR
  Src= LL64 (6LN)
  Dst= All-router-link-scope-multicast
  SLLAO= MAC64 (6LN)

 6LR------RA---------&gt;6LN
  Src= LL64 (6LR)
  Dst= LL64 (6LN)

Note: Source address of RA must be a link-local
address (Section 4.2, RFC 4861).

 6LN-------NS Reg------&gt;6LR
  Src= GP16 (6LN)
  Dst= LL64 (6LR)
  ARO
  SLLAO= MAC16 (6LN)

 6LR---------DAR-----&gt;6LBR
 Src= GP64 or GP16 (6LR)
 Dst= GP64 or GP16 (6LBR)
 Registered Address= GP16 (6LN) and EUI-64 (6LN)

 6LBR-------DAC---------&gt;6LR
 Src= GP64 or GP16 (6LBR)
 Dst= GP64 or GP16 (6LR)
 Copy of information from DAR

 If Status is a Success:

 6LR ---------NA-Reg-------&gt;6LN
 Src= LL64 (6LR)
 Dst= GP16 (6LN)
 ARO with Status = 0

 If Status is not a success:

 6LR ---------NA-Reg--------&gt;6LN
 Src= LL64 (6LR)
 Dst= LL64 (6LN) --&gt; Derived from the EUI-64 of ARO
 ARO with Status &gt; 0


</pre>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> <a href="#examples_router" id="examples_router">Router Interaction Example</a>
</h1>
<p id="rfc.section.10.3.p.1">In the Route-over topology, when a routing protocol is run across 6LRs the bootstrapping and neighbor cache management are handled a little differently. The description in this paragraph provides only a guideline for an implementation.</p>
<p id="rfc.section.10.3.p.2">At the initialization of a 6LR, it may choose to bootstrap as a host with the help of a parent 6LR if the optional multihop DAD is performed with the 6LBR. The neighbor cache management of a router and address resolution among the neighboring routers are described in <a href="#router_cache">Section 6.5.3</a> and <a href="#router_resolution">Section 6.5.5</a>, respectively. In this example, we assume that the neighboring 6lowpan link is secure.</p>
<h1 id="rfc.section.10.3.1">
<a href="#rfc.section.10.3.1">10.3.1.</a> Bootstrapping a Router</h1>
<p id="rfc.section.10.3.1.p.1">In this scenario, the bootstrapping 6LR, 'R1', is multiple hops away from the 6LBR and surrounded by other 6LR neighbors. Initially R1 behaves as a host. It sends multicast RS and receives an RA from one or more neighboring 6LRs. R1 picks one 6LR as its temporary default router and performs address resolution via this default router. Note, if multihop DAD is not required (e.g. in a managed network or using EUI-64 based addresses) then it does not need to pick a temporary default router, however it may still want to send the initial RS message if it wants to autoconfigure its address with the global prefix disseminated by the 6LBR.</p>
<p id="rfc.section.10.3.1.p.2">Based on the information received in the RAs, R1 updates its cache with entries for all the neighboring 6LRs. Upon completion of the address registration, the bootstrapping router deletes the temporary entry of the default router and the routing protocol is started.</p>
<p id="rfc.section.10.3.1.p.3">Also note that R1 may refresh its multihop DAD registration directly with the 6LBR (using the nexthop neighboring 6LR determined by the routing protocol for reaching the 6LBR).</p>
<h1 id="rfc.section.10.3.2">
<a href="#rfc.section.10.3.2">10.3.2.</a> Updating the Neighbor Cache</h1>
<p id="rfc.section.10.3.2.p.1">In this example, there are three 6LRs, R1, R2, R3. Initially when R2 boots it sees only R1, and accordingly R2 creates a neighbor cache entry for R1. Now assume R2 receives a valid routing update from router R3. R2 does not have any neighbor cache entry for R3. If the implementation of R2 supports detecting link-layer address from the routing information packets then it directly updates the its neighbor cache using that link-layer information. If this is not possible, then R2 should perform multicast NS with source set with its link-local or global address depending on the scope of the source IP-address received in the routing update packet. The target address of the NS message is the source IPv6 address of the received routing update packet. The format of the NS message is as described in Section 4.3 of <a href="#RFC4861">[RFC4861]</a>.</p>
<p id="rfc.section.10.3.2.p.2">More generally any 6LR that receives a valid route-update from a neighboring router for which it does not have any neighbor cache entry is required to update its neighbor cache as described above.</p>
<p id="rfc.section.10.3.2.p.3">The router (6LR and 6LBR) IP-addresses learned via Neighbor Discovery are not redistributed to the routing protocol.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Security Considerations</h1>
<p id="rfc.section.11.p.1">The security considerations of IPv6 Neighbor Discovery <a href="#RFC4861">[RFC4861]</a> apply. Additional considerations can be found in <a href="#RFC3756">[RFC3756]</a>.  </p>
<p id="rfc.section.11.p.2">This specification expects that the link layer is sufficiently protected, for instance using MAC sublayer cryptography.  In other words, model 1 from <a href="#RFC3756">[RFC3756]</a> applies.  In particular, it is expected that the LoWPAN MAC provides secure unicast to/from Routers and secure broadcast from the Routers in a way that prevents tampering with or replaying the Router Advertisement messages.  However, any future 6LoWPAN security protocol that applies to Neighbor Discovery for 6LoWPAN protocol, is out of scope of this document.  </p>
<p id="rfc.section.11.p.3">The multihop DAD mechanisms rely on DAR and DAC messages that are forwarded by 6LRs, and as a result the hop_limit=255 check on the receiver does not apply to those messages. This implies that any node on the Internet could successfully send such messages. We avoid any additional security issues due to this by requiring that the routers never modify the Neighbor Cache entry due to such messages, and that they reject them unless they are received on an interface that has been explicitly configured to use these optimizations.</p>
<p id="rfc.section.11.p.4">In some future deployments one might want to use SEcure Neighbor Discovery <a href="#RFC3971">[RFC3971]</a> <a href="#RFC3972">[RFC3972]</a>. This is possible with the Address Registration option as sent between hosts and routers, since the address that is being registered is the IPv6 source address of the Neighbor Solicitation and SeND verifies the IPv6 source address of the packet. Applying SeND to the optional router-to-router communication in this document is out of scope.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.12.p.1">The document requires three new Neighbor Discovery option types under the subregistry "IPv6 Neighbor Discovery Option Formats": </p>

<ul>
<li>Address Registration Option (TBD1)</li>
<li>6LoWPAN Context Option (TBD2)</li>
<li>Authoritative Border Router Option (TBD3)</li>
</ul>

<p> </p>
<p id="rfc.section.12.p.2">The document requires two new ICMPv6 types under the subregistry "ICMPv6 type Numbers": </p>

<ul>
<li>Duplicate Address Request (TBD4)</li>
<li>Duplicate Address Confirmation (TBD5)</li>
</ul>

<p> </p>
<p id="rfc.section.12.p.3">For the purpose of protocol interoperability testing of this specification, the following values are being used temporarily: </p>

<ul>
<li>TBD1 = 31</li>
<li>TBD2 = 32</li>
<li>TBD3 = 33 </li>
<li>TBD4 = 155 XXX </li>
<li>TBD3 = 156 XXX </li>
</ul>

<p> </p>
<p id="rfc.section.12.p.4">This document also requests IANA to create a new registry for the Status values of the Address Registration Option.</p>
<p id="rfc.section.12.p.5">[TO BE REMOVED: This registration should take place at the following location: http://www.iana.org/assignments/icmpv6-parameters] </p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> Guideline for New Features</h1>
<p id="rfc.section.13.p.1">This section discusses a guideline of new features for implementation and deployment.  </p>
<div id="#rfc.table.2"></div>
<div id="#guide1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Guideline for 6LoWPAN-ND features for hosts</caption>
<thead><tr>
<th class="left">Section</th>
<th class="left">Description</th>
<th class="left">deploy</th>
<th class="left">implement</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><a href="#Optimization">3.1</a></td>
<td class="left">Host initiated RA</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#Addr-assign">3.2</a></td>
<td class="left">EUI-64 based IPv6-address</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">16bit-MAC based address</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">Other non-unique addresses</td>
<td class="left">MAY</td>
<td class="left">MAY</td>
</tr>
<tr>
<td class="left"><a href="#overview_hr">3.3</a></td>
<td class="left">Host Initiated RS</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">ABRO Processing</td>
<td class="left">SHOULD</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#ARO">4.1</a></td>
<td class="left">Registration with ARO</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left">
<a href="#s6CO">4.2</a>, <a href="#ra_proc">5.4</a>
</td>
<td class="left">6lowpan Context Option</td>
<td class="left">SHOULD</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"><a href="#hFA">5.1</a></td>
<td class="left">Re-direct Message Acceptance</td>
<td class="left">MUST&#160;NOT</td>
<td class="left">MUST&#160;NOT</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">Joining Solicited Node Multicast</td>
<td class="left">N/A</td>
<td class="left">N/A</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">Joining all-node Multicast</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">Using link-layer indication for NUD</td>
<td class="left">SHOULD</td>
<td class="left">MAY</td>
</tr>
<tr>
<td class="left"><a href="#host_registration">5.5</a></td>
<td class="left">6lowpan-ND NUD</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#be_wakeup">5.8.2</a></td>
<td class="left">Behavior on wake-up</td>
<td class="left">SHOULD</td>
<td class="left">SHOULD</td>
</tr>
</tbody>
</table>
<div id="#rfc.table.3"></div>
<div id="#guide2"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Guideline for 6LR features in 6LoWPAN-ND</caption>
<thead><tr>
<th class="left">Section</th>
<th class="left">Description</th>
<th class="left">deploy</th>
<th class="left">implement</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><a href="#Optimization">3.1</a></td>
<td class="left">Periodic RA</td>
<td class="left">SHOULD&#160;NOT</td>
<td class="left">SHOULD&#160;NOT</td>
</tr>
<tr>
<td class="left"><a href="#Addr-assign">3.2</a></td>
<td class="left">Address assignment during Startup</td>
<td class="left">SHOULD</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#overview_hr">3.3</a></td>
<td class="left">Supporting EUI-64 based MAC Hosts</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"></td>
<td class="left">Supporting 16-bit MAC hosts</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left">
<a href="#overview_rr">3.4</a>, <a href="#ABRO">4.3</a>, <a href="#r_ra_proc">8.1.3</a>, <a href="#store_info">8.1.4</a>
</td>
<td class="left">ABRO Processing/sending</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"><a href="#optional_dist">8.1</a></td>
<td class="left">Multihop Prefix storing and re-distribution</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"><a href="#nce_management">3.5</a></td>
<td class="left">Tentative NCE</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#optional_dad">8.2</a></td>
<td class="left">Multihop DAD</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left">
<a href="#ARO">4.1</a>, <a href="#router_ns">6.5</a>, <a href="#duplicate">6.5.1</a> - <a href="#router_resolution">6.5.5</a>
</td>
<td class="left">ARO Support</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left"><a href="#s6CO">4.2</a></td>
<td class="left">6lowpan Context Option</td>
<td class="left">SHOULD</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"><a href="#rs_proc">6.3</a></td>
<td class="left">Process RS/ARO</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
</tbody>
</table>
<div id="#rfc.table.4"></div>
<div id="#guide3"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Guideline for 6LBR features in 6LoWPAN-ND</caption>
<thead><tr>
<th class="left">Section</th>
<th class="left">Description</th>
<th class="left">deploy</th>
<th class="left">implement</th>
</tr></thead>
<tbody>
<tr>
<td class="left"><a href="#Optimization">3.1</a></td>
<td class="left">Periodic RA</td>
<td class="left">SHOULD&#160;NOT</td>
<td class="left">SHOULD&#160;NOT</td>
</tr>
<tr>
<td class="left"><a href="#Addr-assign">3.2</a></td>
<td class="left">Address autoconf on Router interface</td>
<td class="left">MUST&#160;NOT</td>
<td class="left">MUST&#160;NOT</td>
</tr>
<tr>
<td class="left"><a href="#overview_hr">3.3</a></td>
<td class="left">EUI-64 MAC support on 6lowpan interface</td>
<td class="left">MUST</td>
<td class="left">MUST</td>
</tr>
<tr>
<td class="left">
<a href="#optional_dist">8.1</a> - <a href="#br_ra">8.1.1</a>, <a href="#mh_ra">8.1.5</a>
</td>
<td class="left">Multihop Prefix distribution</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
<tr>
<td class="left"><a href="#optional_dad">8.2</a></td>
<td class="left">Multihop DAD</td>
<td class="left">MAY</td>
<td class="left">SHOULD</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> Acknowledgments</h1>
<p id="rfc.section.14.p.1">The authors thank Pascal Thubert, Jonathan Hui, Carsten Bormann, Richard Kelsey, Geoff Mulligan, Julien Abeille, Alexandru Petrescu, Peter Siklosi, Pieter De Mil, Fred Baker, Anthony Schoofs, Phil Roberts, Daniel Gavelle, Joseph Reddy, Robert Cragie, Mathilde Durvy, Colin O'Flynn, Dario Tedeschi and Joakim Eriksson for useful discussions and comments that have helped shaped and improve this document.</p>
<p id="rfc.section.14.p.2">Additionally, the authors would like to recognize Carsten Bormann for the suggestions on the Context Prefix Option and contribution to earlier version of the draft, Pascal Thubert for contribution of the original registration idea and extensive contributions to earlier versions of the draft, Jonathan Hui for original ideas on prefix/context distribution and extensive contributions to earlier versions of the draft, Colin O'Flynn for useful Error-to suggestions and contributions to the Examples section, Geoff Mulligan for suggesting the use of Address Registration as part of existing IPv6 Neighbor Discovery messages, and Mathilde Durvy for helping to clarify router interaction. </p>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> Changelog</h1>
<p id="rfc.section.15.p.1">Changes from -15 to -16: </p>

<ul class="empty">
<li>o Added an applicability section (#133) </li>
<li>o Updated document title to align with HC</li>
<li>o Minor editing as result of WGLC review (#134)</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.2">Changes from -14 to -15: </p>

<ul class="empty">
<li>o Changed use of redirect to SHOULD NOT for route-over and MAY for mesh-under. (#130) </li>
<li>o Changed the 16-bit lifetimes to a unit of 60 seconds (#131) </li>
<li>o Added text to Section 5.4.2 adding a receive-only state to context entries that timeout. (#132) </li>
</ul>

<p> </p>
<p id="rfc.section.15.p.3">Changes from -13 to -14: </p>

<ul class="empty">
<li>o Introduced the new DAR and DAC ICMPv6 message types for multihop DAD to avoid relying on the Length=4 checks for the ARO. This simplifies implementing the hop limit check.</li>
<li>o Clarified the hop limit values for the multihop DAD messages by introducing the MULTIHOP_HOPLIMIT constant set to 64.</li>
<li>o Clarified when a host should de-register from a router.</li>
<li>o Added a section on next-hop determination for routers.</li>
<li>o Removed the infinite lifetime from 6CO. </li>
<li>o Increased MIN_CONTEXT_CHANGE_DELAY to 300 seconds. </li>
</ul>

<p> </p>
<p id="rfc.section.15.p.4">Changes from -12 to -13: </p>

<ul class="empty">
<li>o Error-to solution added for returning NA messages carrying an error ARO option to the link-local EUI-64 based IPv6 address of the host (#126). </li>
<li>o New examples added.</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.5">Changes from -11 to -12: </p>

<ul class="empty">
<li>o Version field of ABRO moved after Length for 32-bit alignment of the reserved space (#90).</li>
<li>o Several clarifications were made on router interaction, including a new section with router interaction examples (#91).</li>
<li>o Temporary Neighbor Cache Entry created upon host sending NS+ARO, and SLLAO removed from multihop DAD NS/NA messages (#87).</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.6">Changes from -10 to -11: </p>

<ul class="empty">
<li>o Reference to RFC1982 for version number comparison (#80)</li>
<li>o RA Router Lifetime field use clarified (#81)</li>
<li>o Make fields 16-bit rather than 32-bit where possible (#83)</li>
<li>o Unicast RA clarification (#84)</li>
<li>o Temporary ND option types (#85)</li>
<li>o SLLA/TLLA clarification (#86)</li>
<li>o GP16 as source address in initial NS clarification (#87)</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.7">Changes from -09 to -10: </p>

<ul class="empty">
<li>o Clarifications made to Section 8.2 (#66)</li>
<li>o Explained behavior of Neighbor Cache (#67)</li>
<li>o Clarified use of SLLAO in RS and NS messages (#68)</li>
<li>o Added new term 6LN (#69)</li>
<li>o Small clarification on 6CO flag (#70)</li>
<li>o Defined host behavior on ARO failure better (#72)</li>
<li>o Added bootstrapping example for a host (#73)</li>
<li>o Added new Neighbor Cache Full ARO error (#74)</li>
<li>o Added rule on the use of the M flag (#75)</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.8">Changes from -08 to -09: </p>

<ul class="empty">
<li>o Clean re-write of the draft (re-use of some introductory material)</li>
<li>o Merged in draft-chakrabarti-6lowpan-ipv6-nd-simple-00</li>
<li>o Changed address registration to an option piggybacked on NS/NA</li>
<li>o New Authoritative Border Router option</li>
<li>o New Address Registration Option</li>
<li>o Separated Prefix Information and Content Information</li>
<li>o Optional DAD to the edge</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.9">Changes from -07 to -08: </p>

<ul class="empty">
<li>o Removed Extended LoWPAN and Whiteboard related sections.</li>
<li>o Included reference to the autoconf addressing model.</li>
<li>o Added Optimistic Flag to 6AO.</li>
<li>o Added guidelines on routers performing DAD.</li>
<li>o Removed the NR/NC Advertising Interval.</li>
<li>o Added assumption of uniform IID formation and DAD throughout a LoWPAN.</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.10">Changes from -06 to -07: </p>

<ul class="empty">
<li>o Updated addressing and address resolution (#60).</li>
<li>o Changed the Address Option to 6LoWPAN Address Option, fixed S values (#61).</li>
<li>o Added support for classic RFC4861 RA Prefix Information messages to be processed (#62).</li>
<li>o Added a section on using 6LoWPAN-ND under a hard-wired RFC4861 stack (#63).</li>
<li>o Updated the NR/NC message with a new Router flag, combined the Code and Status fields into one byte, and added the capability to carry 6IOs (#64).</li>
<li>o Made co-existence with other ND mechanisms clear (#59).</li>
<li>o Added a new Protocol Specification section with all mechanisms specified there (#59).</li>
<li>o Removed dependencies and conflicts with RFC4861 wherever possible (#59).</li>
<li>o Some editorial cleanup.</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.11">Changes from -05 to -06: </p>

<ul class="empty">
<li>o Fixed the Prf codes (#52).</li>
<li>o Corrected the OIIO TID field to 8-bits. Changed the Nonce/OII order in both the OIIO and the NR/NC. (#53)</li>
<li>o Corrected an error in Table 1 (#54).</li>
<li>o Fixed asymmetric and a misplaced transient in the 6LoWPAN terminology section.</li>
<li>o Added Updates RFC4861 to header</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.12">Changes from -04 to -05: </p>

<ul class="empty">
<li>o Meaning of the RA's M-bit changed to original <a href="#RFC4861">[RFC4861]</a> meaning (#46).</li>
<li>o Terms "on-link" and "off-link" used in place of "on-link" and "off-link".</li>
<li>o Next-hop determination text simplified (#49).</li>
<li>o Neighbor cache and destination cache removed.</li>
<li>o IID to link-layer address requirement relaxed. </li>
<li>o NR/NC changes to enable on-link refresh with routers (#48).</li>
<li>o Modified 6LoWPAN Information Option (#47).</li>
<li>o Added a Protocol Constants section (#24)</li>
<li>o Added the NR processing table (#51)</li>
<li>o Considered the use of SeND on backbone NS/NA messages (#50)</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.13">Changes from -03 to -04: </p>

<ul class="empty">
<li>o Moved Ad-hoc LoWPAN operation to Section 7 and made ULA prefix generation a features useful also in Simple and Extended LoWPANs. (#41)</li>
<li>o Added a 32-bit Owner Nonce to the NR/NC messages and the Whiteboard, removed the TID history. (#39)</li>
<li>o Improved the duplicate OII detection algorithm using the Owner Nonce. (#39)</li>
<li>o Clarified the use of Source and Target link-layer options in NR/NC. (#43)</li>
<li>o Included text on the use of alternative methods to acquire addresses. (#38)</li>
<li>o Removed S=2 from Address Option (not needed). (#36)</li>
<li>o Added a section on router dissemination consistency. (#44)</li>
<li>o Small improvements and extensive editing. (#42, #37, #35)</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.14">Changes from -02 to -03: </p>

<ul class="empty">
<li>o Updated terminology, with RFC4861 non-transitive link model.</li>
<li>o 6LoWPAN and ND terminology separated.</li>
<li>o Protocol overview explains RFC4861 diff in detail.</li>
<li>o RR/RC is now Node Registration/Confirmation (NR/NC).</li>
<li>o Added NR failure codes.</li>
<li>o ER Metric now included in 6LoWPAN Summary Option for use in default router determination by hosts.</li>
<li>o Examples of host data structures, and the Whiteboard given.</li>
<li>o Whiteboard is supported by all Edge Routers for option simplicity.</li>
<li>o Edge Router Specification chapter re-structured, clarifying optional Extended LoWPAN operation.</li>
<li>o NS/NA now completely optional for nodes. No address resolution or NS/NA NUD required.</li>
<li>o link-local operation now compatible with oDAD (was broken).</li>
<li>o Exception to hop limit = 255 for NR/NC messages.</li>
<li>o Security considerations improved.</li>
<li>o ICMPv6 destination unreachable supported.</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.15">Changes from -01 to -02: </p>

<ul class="empty">
<li>o Fixed 16 != 0xff bug (ticket closed).</li>
<li>o Specified use of ULAs in ad-hoc LoWPAN section 9 (ticket closed).</li>
<li>o Terminology cleanup based on Alex's comments.</li>
<li>o General editing improvements.</li>
</ul>

<p> </p>
<p id="rfc.section.15.p.16">Changes from -00 to -01: </p>

<ul class="empty">
<li>o Specified the duplicate owner interface identifier procedures. A TID lollipop algorithm was sufficient (nonce unnecessary).</li>
<li>o Defined fault tolerance using secondary bindings.</li>
<li>o Defined ad-hoc network operation.</li>
<li>o Removed the E flag from RA and the X flag from RR/RC.</li>
<li>o Completed message examples.</li>
<li>o Lots of improvements in text quality and consistency were made. </li>
</ul>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">16.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5889">[RFC5889]</b></td>
<td class="top">
<a>Baccelli, E.</a> and <a>M. Townsley</a>, "<a href="http://tools.ietf.org/html/rfc5889">IP Addressing Model in Ad Hoc Networks</a>", RFC 5889, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1982">[RFC1982]</b></td>
<td class="top">
<a href="mailto:kre@munnari.OZ.AU" title="University of Melbourne, Computer Science">Elz, R.</a> and <a href="mailto:randy@psg.com" title="RGnet, Inc.">R. Bush</a>, "<a href="http://tools.ietf.org/html/rfc1982">Serial Number Arithmetic</a>", RFC 1982, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2434">[RFC2434]</b></td>
<td class="top">
<a href="mailto:narten@raleigh.ibm.com" title="IBM Corporation">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no" title="Maxware">H.T. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 2434, October 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2491">[RFC2491]</b></td>
<td class="top">
<a href="mailto:gja@lucent.com" title="Bell Laboratories, Lucent Technologies">Armitage, G.</a>, <a href="mailto:paschulter@acm.org" title="Bright Tiger Technologies">Schulter, P.</a>, <a href="mailto:jork@kar.dec.com" title="European Applied Research Center">Jork, M.</a> and <a href="mailto:harter@zk3.dec.com" title="Digital UNIX Networking">G. Harter</a>, "<a href="http://tools.ietf.org/html/rfc2491">IPv6 over Non-Broadcast Multiple Access (NBMA) networks</a>", RFC 2491, January 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4191">[RFC4191]</b></td>
<td class="top">
<a>Draves, R.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>", RFC 4191, November 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4193">[RFC4193]</b></td>
<td class="top">
<a>Hinden, R.</a> and <a>B. Haberman</a>, "<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>", RFC 4193, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4443">[RFC4443]</b></td>
<td class="top">
<a>Conta, A.</a>, <a>Deering, S.</a> and <a>M. Gupta</a>, "<a href="http://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>", RFC 4443, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4862">[RFC4862]</b></td>
<td class="top">
<a>Thomson, S.</a>, <a>Narten, T.</a> and <a>T. Jinmei</a>, "<a href="http://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>", RFC 4862, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4944">[RFC4944]</b></td>
<td class="top">
<a>Montenegro, G.</a>, <a>Kushalnagar, N.</a>, <a>Hui, J.</a> and <a>D. Culler</a>, "<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>", RFC 4944, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="EUI64">[EUI64]</b></td>
<td class="top">
<a>GUIDELINES FOR 64-BIT GLOBAL IDENTIFIER (EUI-64) REGISTRATION AUTHORITY</a>", .</td>, "</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">16.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3633">[RFC3633]</b></td>
<td class="top">
<a>Troan, O.</a> and <a>R. Droms</a>, "<a href="http://tools.ietf.org/html/rfc3633">IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6</a>", RFC 3633, December 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3756">[RFC3756]</b></td>
<td class="top">
<a>Nikander, P.</a>, <a>Kempf, J.</a> and <a>E. Nordmark</a>, "<a href="http://tools.ietf.org/html/rfc3756">IPv6 Neighbor Discovery (ND) Trust Models and Threats</a>", RFC 3756, May 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3971">[RFC3971]</b></td>
<td class="top">
<a>Arkko, J.</a>, <a>Kempf, J.</a>, <a>Zill, B.</a> and <a>P. Nikander</a>, "<a href="http://tools.ietf.org/html/rfc3971">SEcure Neighbor Discovery (SEND)</a>", RFC 3971, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3972">[RFC3972]</b></td>
<td class="top">
<a>Aura, T.</a>, "<a href="http://tools.ietf.org/html/rfc3972">Cryptographically Generated Addresses (CGA)</a>", RFC 3972, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4919">[RFC4919]</b></td>
<td class="top">
<a>Kushalnagar, N.</a>, <a>Montenegro, G.</a> and <a>C. Schumacher</a>, "<a href="http://tools.ietf.org/html/rfc4919">IPv6 over Low-Power Wireless Personal Area Networks (6LoWPANs): Overview, Assumptions, Problem Statement, and Goals</a>", RFC 4919, August 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4941">[RFC4941]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Draves, R.</a> and <a>S. Krishnan</a>, "<a href="http://tools.ietf.org/html/rfc4941">Privacy Extensions for Stateless Address Autoconfiguration in IPv6</a>", RFC 4941, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-6lowpan-hc">[I-D.ietf-6lowpan-hc]</b></td>
<td class="top">
<a>Hui, J</a> and <a>P Thubert</a>, "<a href="http://tools.ietf.org/html/draft-ietf-6lowpan-hc-15">Compression Format for IPv6 Datagrams in Low Power and Lossy Networks (6LoWPAN)</a>", Internet-Draft draft-ietf-6lowpan-hc-15, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Zach Shelby</span> editor
	  <span class="n hidden">
		<span class="family-name">Shelby</span>
	  </span>
	</span>
	<span class="org vcardline">Sensinode </span>
	<span class="adr">
	  <span>Hallituskatu 13-17D</span>

	  <span class="vcardline">
		<span class="locality">Oulu</span>,  
		<span class="region"></span>
		<span class="code">90100</span>
	  </span>
	  <span class="country-name vcardline">FINLAND</span>
	</span>
	<span class="vcardline">Phone: +358407796297</span>

<span class="vcardline">EMail: <a href="mailto:zach@sensinode.com">zach@sensinode.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Samita Chakrabarti</span> 
	  <span class="n hidden">
		<span class="family-name">Chakrabarti</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:samita.chakrabarti@ericsson.com">samita.chakrabarti@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Erik Nordmark</span> 
	  <span class="n hidden">
		<span class="family-name">Nordmark</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:nordmark@cisco.com">nordmark@cisco.com</a></span>

  </address>
</div>

</body>
</html>