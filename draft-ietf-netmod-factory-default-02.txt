



NETMOD Working Group                                               Q. Wu
Internet-Draft                                                    Huawei
Intended status: Standards Track                              B. Lengyel
Expires: December 31, 2019                              Ericsson Hungary
                                                                  Y. Niu
                                                                  Huawei
                                                           June 29, 2019


                        Factory Default Setting
                  draft-ietf-netmod-factory-default-02

Abstract

   This document defines a method to reset a server to its factory-
   default content.  The reset operation may be used e.g. during initial
   zero-touch configuration or when the existing configuration has major
   errors, so re-starting the configuration process from scratch is the
   best option.

   A new factory-reset RPC is defined.  Several methods of documenting
   the factory-default content are specified.

   Optionally a new "factory-default" read-only datastore is defined,
   that contains the data that will be copied over to the running
   datastore at reset.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on December 31, 2019.








Wu, et al.              Expires December 31, 2019               [Page 1]

Internet-Draft           Factory Default Setting               June 2019


Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Factory-Reset RPC . . . . . . . . . . . . . . . . . . . . . .   4
   3.  Factory-Default Datastore . . . . . . . . . . . . . . . . . .   4
   4.  YANG Module . . . . . . . . . . . . . . . . . . . . . . . . .   5
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   7
   8.  Contributors  . . . . . . . . . . . . . . . . . . . . . . . .   8
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   8
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .   8
     9.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Appendix A.  Open Issues  . . . . . . . . . . . . . . . . . . . .   9
   Appendix B.  Difference between <startup> datastore and <factory-
                default> datastore . . . . . . . . . . . . . . . . .   9
   Appendix C.  Changes between revisions  . . . . . . . . . . . . .   9
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  10

1.  Introduction

   This document defines a method to reset a server to its factory-
   default content.  The reset operation may be used e.g. during initial
   zero-touch configuration [RFC8572] or when the existing configuration
   has major errors, so re-starting the configuration process from
   scratch is the best option.  When resetting a datastore all previous
   configuration settings will be lost and replaced by the factory-
   default content.

   A new factory-reset RPC is defined.  Several methods of documenting
   the factory-default content are specified.




Wu, et al.              Expires December 31, 2019               [Page 2]

Internet-Draft           Factory Default Setting               June 2019


   Optionally a new "factory-default" read-only datastore is defined,
   that contains the data that will be copied over to all read-write
   configuration datastores at reset.  This datastore can also be used
   in <get-data> or <get-config> operations.

   NETCONF defines the <delete> operation that allows resetting the
   <startup> datastore and the <discard-changes> operation that copies
   the content of the <running> datastore into the <candidate>
   datastore.  However it is not possible to reset the running
   datastore, to reset the candidate datastore without changing the
   running datastore or to reset any dynamic datastore.

   A RESTCONF server MAY implement the above NETCONF operations, but
   that would still not allow it to reset the running configuration.

1.1.  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

   The following terms are defined in [RFC8342] and are not redefined
   here:

   o  server

   o  startup configuration datastore

   o  candiate configuration datastore

   o  running configuration datastore

   o  intended configuration datastore

   o  operational state datastore

   The following terms are defined in this document as follows:

   o  factory-default datastore: A read-only datastore holding a
      preconfigured minimal initial configuration that can be used to
      initialize the configuration of a server.  The content of the
      datastore is usually static, but MAY depend on external factors
      like available HW.






Wu, et al.              Expires December 31, 2019               [Page 3]

Internet-Draft           Factory Default Setting               June 2019


2.  Factory-Reset RPC

   A new "factory-reset" RPC is introduced.  Upon receiveing the RPC the
   server resets the content of all read-write configuration datastores
   (e.g.,<running> and <startup>) to its factory-default content.  Read-
   only datastores receive their content from other datastores (e.g.
   <intended> gets its content from <running>).

   Factory-default content SHALL be specified by one of the following
   means in order of precedence

   1.  For the <running>,<candidate> and <startup> datastores as the
       content of the <factory-default> datastore, if it exists

   2.  YANG Instance Data [I-D.ietf-netmod-yang-instance-file-format]

   3.  In some implementation specific manner

   4.  For dynamic datastores unless otherwise specified the factory-
       default content is empty.

   In addition to set the content of the read-write configuration
   datastores, the "factory-reset" RPC might also be used to clean up
   files, restart the node or some of the SW processes, or it might set
   some security data/passwords to the default value, remove logs,
   remove any temporary data (from datastore or elsewhere) etc.

3.  Factory-Default Datastore

   Following guidelines for defining Datastores in the appendix A of
   [RFC8342], this document introduces a new datastore resource named
   'Factory-Default' that represents a preconfigured minimal initial
   configuration that can be used to initialize the configuration of a
   server.

   o  Name: "factory-default"

   o  YANG modules: all

   o  YANG nodes: all "config true" data nodes

   o  Management operations: The content of the datastore is set by the
      server in an implementation dependent manner.  The content can not
      be changed by management operations via NETCONF, RESTCONF,the CLI
      etc.  unless specialized, dedicated operations are provided.  The
      contents of the datastore can be read using NETCONF, RESTCONF
      <get-data> and <get-config> operations.  The operation <factory-
      reset> can be used to copy the factory default content to a set of



Wu, et al.              Expires December 31, 2019               [Page 4]

Internet-Draft           Factory Default Setting               June 2019


      read-write configuration datastores and then the content of these
      datastores is propagated automatically to any other read only
      datastores, e.g., <intended> and <operational>.

   o  Origin: This document does not define a new origin identity as it
      does not interact with <operational> datastore.

   o  Protocols: RESTCONF, NETCONF and other management protocol.

   o  Defining YANG module: "ietf-factory-default".

   The datastore content is usually defined by the device vendor.  It is
   usually static, but MAY change e.g., depending on external factors
   like HW available or during device upgrade.

   On devices that support non-volatile storage, the contents of
   <factory > MUST persist across restarts.

4.  YANG Module

<CODE BEGINS> file "ietf-factory-default.yang"
module ietf-factory-default {
  yang-version 1.1;
  namespace urn:ietf:params:xml:ns:yang:ietf-factory-default;
  prefix fd;

  import ietf-netconf { prefix nc ; }
  import ietf-datastores { prefix ds; }

  organization
    "IETF NETMOD (Network Modeling) Working Group";
  contact
    "WG Web:   <https://tools.ietf.org/wg/netconf/>
     WG List:  <mailto:netconf@ietf.org>

     Editor:   Balazs Lengyel
               <mailto:balazs.lengyel@ericsson.com>
     Editor:   Qin Wu
               <mailto:bill.wu@huawei.com>
     Editor:   Ye Niu
               <mailto:niuye@huawei.com>";
  description
    "This module defines the
    - factory-reset RPC
    - factory-default datastore

    It provides functionality to reset a server to its
    factory-default content.



Wu, et al.              Expires December 31, 2019               [Page 5]

Internet-Draft           Factory Default Setting               June 2019


     The key words 'MUST', 'MUST NOT', 'REQUIRED', 'SHALL', 'SHALL
     NOT', 'SHOULD', 'SHOULD NOT', 'RECOMMENDED', 'NOT RECOMMENDED',
     'MAY', and 'OPTIONAL' in this document are to be interpreted as
     described in BCP 14 (RFC 2119) (RFC 8174) when, and only when,
     they appear in all capitals, as shown here.

     Copyright (c) 2019 IETF Trust and the persons identified as
     authors of the code.  All rights reserved.

     Redistribution and use in source and binary forms, with or
     without modification, is permitted pursuant to, and subject
     to the license terms contained in, the Simplified BSD License
     set forth in Section 4.c of the IETF Trust's Legal Provisions
     Relating to IETF Documents
     (http://trustee.ietf.org/license-info).

     This version of this YANG module is part of RFC XXXX;
     see the RFC itself for full legal notices.";

  revision 2019-05-03 {
    description
      "Initial revision.";
      reference "RFC XXXX: Factory default Setting";
  }

  feature factory-default-as-datastore {
    description "Indicates that the factory default configuration is
      also available as a separate datastore";
  }

  rpc factory-reset {
    description "The server resets the content of all read-write
    configuration datastores (e.g.,<running> and <startup>) to
    its factory default content.";
  }

  identity factory-default {
    base ds:datastore;
    if-feature factory-default-as-datastore;
    description "The read-only datastore contains the configuration that
      will be copied into e.g., the running datastore by the
      factory-reset operation if the target is the running
      datastore.";
  }
  augment /nc:get-config/nc:input/nc:source/nc:config-source {
     if-feature factory-default-as-datastore;
     description "Allows the get-config operation to use the
       factory-default datastore as a source";



Wu, et al.              Expires December 31, 2019               [Page 6]

Internet-Draft           Factory Default Setting               June 2019


     leaf factory-default {
         type empty ;
         description
           "The factory-default datastore is the source.";    }
}
<CODE ENDS>

5.  IANA Considerations

   This document registers one URI in the IETF XML Registry [RFC3688].
   The following registration has been made:

      URI: urn:ietf:params:xml:ns:yang:ietf-factory-default

      Registrant Contact: The IESG.

      XML: N/A, the requested URI is an XML namespace.

   This document registers one YANG module in the YANG Module Names
   Registry [RFC6020].  The following registration has been made:

      name: ietf-factory-default

      namespace: urn:ietf:params:xml:ns:yang:ietf-factory-default

      prefix: fd

      RFC: xxxx

6.  Security Considerations

   The <factory-reset> RPC can overwrite important and security
   sensitive information in one of the other datastores e.g. running,
   therefore it is important to restrict access to this RPC using the
   standard access control methods.  [RFC8341]

   The content of the factory-default datastore is usually not security
   sensitive as it is the same on any device of a certain type.  In case
   there is any sensitive content in the factory-default datastore, it
   should be protected in a secure way,e.g.,sign or encrypt the
   sensitive information.

7.  Acknowledgements

   Thanks to Juergen Schoenwaelder, Ladislav Lhotka, Alex Campbell,Joe
   Clark,Robert Wilton, Kent Watsen, Joel Jaeggli,Andy Berman,Susan
   Hares to review this draft and provide important input to this
   document.



Wu, et al.              Expires December 31, 2019               [Page 7]

Internet-Draft           Factory Default Setting               June 2019


8.  Contributors

      Rohit R Ranade
      Huawei
      Email: rohitrranade@huawei.com

9.  References

9.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC7950]  Bjorklund, M., Ed., "The YANG 1.1 Data Modeling Language",
              RFC 7950, DOI 10.17487/RFC7950, August 2016,
              <https://www.rfc-editor.org/info/rfc7950>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8341]  Bierman, A. and M. Bjorklund, "Network Configuration
              Access Control Model", STD 91, RFC 8341,
              DOI 10.17487/RFC8341, March 2018,
              <https://www.rfc-editor.org/info/rfc8341>.

   [RFC8342]  Bjorklund, M., Schoenwaelder, J., Shafer, P., Watsen, K.,
              and R. Wilton, "Network Management Datastore Architecture
              (NMDA)", RFC 8342, DOI 10.17487/RFC8342, March 2018,
              <https://www.rfc-editor.org/info/rfc8342>.

9.2.  Informative References

   [I-D.ietf-netmod-yang-instance-file-format]
              Lengyel, B. and B. Claise, "YANG Instance Data File
              Format", draft-ietf-netmod-yang-instance-file-format-02
              (work in progress), February 2019.

   [RFC8572]  Watsen, K., Farrer, I., and M. Abrahamsson, "Secure Zero
              Touch Provisioning (SZTP)", RFC 8572,
              DOI 10.17487/RFC8572, April 2019,
              <https://www.rfc-editor.org/info/rfc8572>.







Wu, et al.              Expires December 31, 2019               [Page 8]

Internet-Draft           Factory Default Setting               June 2019


Appendix A.  Open Issues

   o  Do we need an extra parameter that may order a restart of the
      YANG-server or the whole system?

   o  Do we allow different datastore have different factory default
      content?  No

Appendix B.  Difference between <startup> datastore and <factory-
             default> datastore

   When the device first boots up, the content of the <startup> and
   <factory-default> will be identical.  The content of <startup> can be
   subsequently changed by using <startup> as a target in a <copy-
   config> operation.  The <factory-default> is a read-only datastore
   and it is usually static as described in earlier sections.

Appendix C.  Changes between revisions

   v01 - v02

   o  Address security issue in the security consideration section.

   o  Remove an extension to the NETCONF <copy-config> operation which
      allows it to operate on the factory-default datastore.

   o  Add an extension to the NETCONF <get-config.operation which allows
      it to operate on the factory-default datastore.

   v00 - v01

   o  Change YANG server into server defined in NMDA architecture based
      on discussion.

   o  Allow reset the content of all read-write configuraton datastores
      to its factory-default content except <candidate>.

   o  Add clarification text on factory-reset protocol operation
      behavior.

   v03 - v00

   o  Change draft name from draft-wu to draft-ietf-netmod-factory-
      default-00 without content changes.

   v02 - v03





Wu, et al.              Expires December 31, 2019               [Page 9]

Internet-Draft           Factory Default Setting               June 2019


   o  Change reset-datastore RPC into factory-reset RPC to allow reset
      the whole device with factory default content.

   o  Remove target datastore parameter from factory-reset RPC.

   o  Other editorial changes.

   v01 - v02

   o  Add copy-config based on Rob's comment.

   o  Reference Update.

   v03 - v00 - v01

   o  Changed name from draft-wu-netconf-restconf-factory-restore to
      draft-wu-netmod-factory-default

   o  Removed copy-config ; reset-datastore is enough

   v02 - v03

   o  Restructured

   o  Made new datastore optional

   o  Removed Netconf capability

   o  Listed Open issues

   v01 - v02

   o  -

   v00 - v01

   o  -

Authors' Addresses

   Qin Wu
   Huawei
   101 Software Avenue, Yuhua District
   Nanjing, Jiangsu  210012
   China

   Email: bill.wu@huawei.com




Wu, et al.              Expires December 31, 2019              [Page 10]

Internet-Draft           Factory Default Setting               June 2019


   Balazs Lengyel
   Ericsson Hungary
   Magyar Tudosok korutja 11
   1117 Budapest
   Hungary

   Phone: +36-70-330-7909
   Email: balazs.lengyel@ericsson.com


   Ye Niu
   Huawei

   Email: niuye@huawei.com





































Wu, et al.              Expires December 31, 2019              [Page 11]
