<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>IPv6 Prefix Assignment in Small Networks</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Scope of this Document">
<link href="#rfc.section.3" rel="Chapter" title="3 Simple Tree Network Case">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Assignment of prefxies in a simple network">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 CPE Router Behavior">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Interior Router Behavior">
<link href="#rfc.section.3.1.2.1" rel="Chapter" title="3.1.2.1 Network with a Tree Topology">
<link href="#rfc.section.3.1.2.2" rel="Chapter" title="3.1.2.2 Non-tree Topologies">
<link href="#rfc.section.3.1.2.3" rel="Chapter" title="3.1.2.3 Multi-homed Network">
<link href="#rfc.section.4" rel="Chapter" title="4 Issues in a simple cascade procedure">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Sequence of subnet number allocation">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Multihoming Issues">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Race Conditions">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Scaling Issues">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Prefix Stability">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 When you run out of prefixes">
<link href="#rfc.section.5" rel="Chapter" title="5 Router Advertisement Allocator Information Element ">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Privacy Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Change Log">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="It is necessary to allocate prefixes in small networks, which include residential and Small Office/Home Office (SOHO) networks in a manner that minimizes or eliminates manual configuration. This note suggests an approach." />
  <meta name="description" content="It is necessary to allocate prefixes in small networks, which include residential and Small Office/Home Office (SOHO) networks in a manner that minimizes or eliminates manual configuration. This note suggests an approach." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">F.J. Baker</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">R. E. Droms</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left">Expires: April 06, 2012</td>
<td class="right">October 04, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">IPv6 Prefix Assignment in Small Networks<br />
  <span class="filename">draft-baker-homenet-prefix-assignment-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>It is necessary to allocate prefixes in small networks, which include residential and Small Office/Home Office (SOHO) networks in a manner that minimizes or eliminates manual configuration. This note suggests an approach.</p>
<h1><a>Requirements</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 06, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Scope of this Document</a>
</li>
<li>3.   <a href="#rfc.section.3">Simple Tree Network Case</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Assignment of prefxies in a simple network</a>
</li>
<li>3.1.1.   <a href="#rfc.section.3.1.1">CPE Router Behavior</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Interior Router Behavior</a>
</li>
<li>3.1.2.1.   <a href="#rfc.section.3.1.2.1">Network with a Tree Topology</a>
</li>
<li>3.1.2.2.   <a href="#rfc.section.3.1.2.2">Non-tree Topologies</a>
</li>
<li>3.1.2.3.   <a href="#rfc.section.3.1.2.3">Multi-homed Network</a>
</li>
<li>4.   <a href="#rfc.section.4">Issues in a simple cascade procedure</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Sequence of subnet number allocation</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Multihoming Issues</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Race Conditions</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Scaling Issues</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Prefix Stability</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">When you run out of prefixes</a>
</li>
<li>5.   <a href="#rfc.section.5">Router Advertisement Allocator Information Element </a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Privacy Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Change Log</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">One of the objectives of the design of <a href="#RFC2460">IPv6 </a> <cite title="NONE">[RFC2460]</cite> has been to reduce or minimize the need for manual configuration in networks. <a href="#RFC0791">IPv4 </a> <cite title="NONE">[RFC0791]</cite> networks, when it became widely deployed in the 1980's, required manual configuration, and the scaling limits of the approach quickly became apparent. One of the outcomes of that was the <a href="#RFC2131">Dynamic Host Configuration Protocol</a> <cite title="NONE">[RFC2131]</cite> (DHCP), which facilitated central administration of desktop computers. In practice, DHCP itself has been of limited utility in the administration of network equipment; while it is conceptually possible to use it for any kind of configuration, more flexible protocols such as the <a href="#RFC6241">Network Configuration Protocol</a> <cite title="NONE">[RFC6241]</cite><a href="#RFC6242">[RFC6242]</a> have been preferred.</p>
<p id="rfc.section.1.p.2">Allocation of prefixes in small networks calls for an approach that can be completely automated. This note documents a procedure that has been suggested by several. It builds on a few basic assumptions: </p>

<ul>
<li>IPv6 prefixes are allocated to a small network by one or more upstream service providers using <a href="#RFC3315">[RFC3315]</a> and <a href="#RFC3363">[RFC3363]</a>.</li>
<li>IPv6 prefixes may allocated to LAN within a small network by the CPE Router using <a href="#RFC3315">[RFC3315]</a> and <a href="#RFC3363">[RFC3363]</a>.</li>
<li>Occasional inefficiencies such as allocating two /64s to a LAN from a given upstream prefix are acceptable, especially if short-lived.</li>
<li>Small networks, such as described in <a href="#I-D.chown-homenet-arch">Home Networking Architecture for IPv6</a> <cite title="NONE">[I-D.chown-homenet-arch]</cite>, are simple enough in structure that the mechanism described in this note is adequate.</li>
</ul>
<p id="rfc.section.1.p.3">These assumptions bear analysis. The first two, that prefixes can and may be allocated using mechanisms designed for the purpose, seems self-evident. The third builds on the IPv6 premise that a host may have more than one prefix on an interface and one or more addresses in each prefix; in such a case, while it may be suboptimal to allocate more than one /64 from the same upstream prefix, the hosts will not complain and the routing protocols will route them. The fourth may be considered the limit of applicability; if a network requires a prefix aggregation design or is otherwise too complex for this procedure to be effective, other procedures are more appropriate.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#scope" id="scope">Scope of this Document</a>
</h1>
<p id="rfc.section.2.p.1">This document describes a procedure for prefix delegation and assignment.  It results in the assignment of a series of /64 prefixes on the links in a small home network.</p>
<p id="rfc.section.2.p.2">While this document describes the use of DHCPv6 for prefix delegation, specification of the use of DHCPv6 for address assignment and other purposes is out of scope.</p>
<p id="rfc.section.2.p.3">If a network includes interior routers and the CPE router is not directly to all of the links in the network, the routers in the network will need routing information to forward traffic in the network and between the network and the service provider network.  The specification of a routing protocol or other mechanism to provide that routing information to the routers is beyond the scope of this document.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#simple_tree" id="simple_tree">Simple Tree Network Case</a>
</h1>
<p id="rfc.section.3.p.1">The first case to describe is that of a network with a simple tree topology.  In this network, there is a single CPE router attached to a single SP network.  The interior of the network is organized as a tree.  Each interior router has one "upstream" interface and one or more "downstream" interfaces.  Each link in the network has a single interior router with a downstream interface attached and zero or more interior routers with an upstream interface attached.</p>
<p id="rfc.section.3.p.2">The fundamental procedure for prefix allocation takes three phases: </p>

<ul>
<li>Allocating a prefix from the upstream network,</li>
<li>Prefix allocation by the CPE Router, and</li>
<li>Prefix allocation by a subsequent router.</li>
</ul>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#dhcp" id="dhcp">Assignment of prefxies in a simple network</a>
</h1>
<p id="rfc.section.3.1.p.1">This section describes the assignment of prefixes in a simple network.  The network is assumed to be tree-structured, including one CPE router that is connected to a SP network and one or more interior routers.  The interior routers each have a single "upstream" interface and one or more "downstream" interfaces.  The upstream interface of each interior router is connected to a link in the network to which a downstream interface of a router closer to the CPE router is already connected.</p>
<p id="rfc.section.3.1.p.2">The CPE router obtains a delegated prefix for the entire home network, and manages prefix allocations for all of the interior routers.  Each interior router uses DHCPv6 on its upstream interface to obtain delegated prefixes from the CPE router for each of the interior routers downstream interfaces.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#CPE_Router" id="CPE_Router">CPE Router Behavior</a>
</h1>
<p id="rfc.section.3.1.1.p.1">The CPE router obtains a delegated prefix from the SP provisioning system using <a href="#RFC3315">[RFC3315]</a> and <a href="#RFC3363">[RFC3363]</a> and other appropriate provisioning systems.  The prefix delegated from the service provider includes a preferred and valid lifetime for the prefix.</p>
<p id="rfc.section.3.1.1.p.2">Once the CPE router has received a delegated prefix, it assigns a /64 subprefix to each of the links to which the router is attached.  The CPE router configures an address to each of its interfaces from the prefix assigned to the link to which the interface is attached.  After assigning the interface addresses, the CPE router begins sending Router Advertisement (RA) messages <a href="#RFC4861">[RFC4861]</a> advertising the appropriate prefix on each attached link.</p>
<p id="rfc.section.3.1.1.p.3">The CPE router includes a Router Advertisement Allocator Information (RAAI) option, identifying itself as the allocating server for prefixes related to the prefix announced in the RA.  The RAs include preferred and valid lifetimes derived from the lifetimes associated with the delegated prefix from the service provider.  The RA also advertises the CPE router as the default router for the link.  Other fields in the RAs are set as appropriate.</p>
<p id="rfc.section.3.1.1.p.4">At this point, the links to which the CPE router is attached is now provisioned with prefixes taken from the prefix obtained from the service provider.  The CPE router uses ongoing DHCPv6 messages exchanges according to <a href="#RFC3315">[RFC3315]</a> and <a href="#RFC3363">[RFC3363]</a> to maintain and update its delegated prefix.</p>
<p id="rfc.section.3.1.1.p.5">The CPE router uses a DHCPv6 server for prefix subdelegation throughout the rest of the network.  In preparation for assigning prefixes to links in the rest of the network, the CPE router makes all of the remaining prefixes from the network prefix available for subdelegation through a DHCPv6 server.  The CPE router configures the preferred and valid lifetimes for the subdelegated prefixes from the values received from the service provider.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#interior_router" id="interior_router">Interior Router Behavior</a>
</h1>
<p id="rfc.section.3.1.2.p.1">When an interior router is connected to the home network, its upstream interface is attached to a link in the home network, and its downstream interfaces are connected to other links to be added to the home network.</p>
<h1 id="rfc.section.3.1.2.1">
<a href="#rfc.section.3.1.2.1">3.1.2.1.</a> <a href="#tree_topology" id="tree_topology">Network with a Tree Topology</a>
</h1>
<p id="rfc.section.3.1.2.1.p.1">After the upstream interface is attached to a link, the interior router listens for RAs on the upstream interface and configures the upstream interface according to the information contained in the received RAs.</p>
<p id="rfc.section.3.1.2.1.p.2">When the interior router receives an RA with an RAAI option, the router initiates a DHCPv6 message exchange to obtain prefixes from the prefix managed by the allocating router.  The interior router requests the delegation of a separate /64 prefix for each of its downstream interfaces.  The DHCPv6 service in the home network delivers the DHCPv6 traffic between the interior router and the CPE router.  </p>

<dl>
<dt>Discussion:</dt>
<dd style="margin-left: 8">The interior router conducts the DHCPv6 message exchange directly with the allocating DHCPv6 server using IPv6 unicast.  This technique assumes that the interior router has already obtained an address of sufficient scope through SLAAC or an earlier DHCPv6 address assignment.  This technique also breaks the rule in RFC 3315 requiring the use of multicast and the DHCPv6 client's link-local address.</dd>
<dt></dt>
<dd style="margin-left: 8">The requirements regarding DHCPv6 message addressing in RFC 3315 are based primarily on the need for some sort of address on the DHCPv6 client before address assigment is completed and the desire to forward all DHCPv6 traffic through a relay agent to allow for relay agent processing.  The procedures in this specification require that the interior router (DHCPv6 client) already has an IPv6 address of sufficient scope before initiating any DHCPv6 message exchanges for prefix delegation.  There is no need, in this specification, for realy agent processing, so direct communication between the interior router and the allocating DHCPv6 server is allowed.</dd>
<dt></dt>
<dd style="margin-left: 8">The primary advantage to allowing direct DHCPv6 message exchanges in this specification is the avoiding the need for a relay agent infrastrcuture throughout the network.  Otherwise, each interior router would have to act as a realy agent for potentially several DHCPv6 servers delegating prefixes for the network.</dd>
</dl>

<p> </p>
<p id="rfc.section.3.1.2.1.p.3">The CPE router delegates the requested prefixes from the prefix delegated to the network.  The interior router then assigns a prefix to each link attached to which a downstream interface is attached, configures those downstream interfaces with addresses from the assigned prefixes and begins sending RAs on the downstream interfaces.  The interior router includes an RAAI option in the RAs, indentifying the CPE router as the allocating DHCPv6 server.  The preferred and valid lifetimes for the advertised prefix are derived from the lifetimes in the DHCPv6 delegation, and the RAs advertise the interior router as the default router for the link.</p>
<h1 id="rfc.section.3.1.2.2">
<a href="#rfc.section.3.1.2.2">3.1.2.2.</a> <a href="#non-tree_topology" id="non-tree_topology">Non-tree Topologies</a>
</h1>
<p id="rfc.section.3.1.2.2.p.1">It is quite likely that real world deployments will violate the assumption in the previous section that only one downstream interface will be attached to each link in the home network.  In this situation, it is desirable that the link only be assigned one prefix and, therefore, only one of the interior routers with a downstream interface on the link be responsible for assigning a prefix and sending RAs on the link.</p>
<p id="rfc.section.3.1.2.2.p.2">To avoid duplicate address assignment, a router first listens for RAs on the link attached to its downstream interface.  If the router does not receive an RA after listening for INTERVAL1 microfortnights, the router assumes it is responsible for assigning a prefix to that link and initiates the DHCPv6 process for obtaining a delegated prefix.</p>
<p id="rfc.section.3.1.2.2.p.3">After the router determines it is responsible for the link attached to its downstream interface, it continues to listen for RAs from other routers on the link.  If it receives an RA from another router, it deassigns its delegated prefix from the link, unconfigures any addresses assigned from that prefix and releases the delegated prefix to the CPE router using DHCPv6.</p>
<p id="rfc.section.3.1.2.2.p.4">If a router hears an RA such as described in <a href="#interior_router">Section 3.1.2</a>, it uses <a href="#RFC4862">IPv6 Stateless Address Autoconfiguration</a> <cite title="NONE">[RFC4862]</cite><a href="#RFC4941">[RFC4941]</a> or a <a href="#RFC3315">DHCPv6</a> <cite title="NONE">[RFC3315]</cite> request to each announced allocator to generate an address within the prefix for use in that subnet.</p>
<p id="rfc.section.3.1.2.2.p.5">After the router determines that some other router is responsible for the link attached to its downstream interface, it continues to listen on the interface for RAs.  If the router receives no RA on the interface for INTERVAL2 microfortnights, the router takes responsibility for the link and initiates the process described above to obtain and assign a prefix to the link.</p>
<h1 id="rfc.section.3.1.2.3">
<a href="#rfc.section.3.1.2.3">3.1.2.3.</a> <a href="#multihomed_net" id="multihomed_net">Multi-homed Network</a>
</h1>
<p id="rfc.section.3.1.2.3.p.1">If a network has multiple service provider networks, it will have multiple prefixes.  This situation is easiest to describe if the network is connected to each service provider through a separate CPE router.</p>
<p id="rfc.section.3.1.2.3.p.2">Each CPE router obtains a delegated prefix from its service provider and then manages the prefix according to the </p>
<p id="rfc.section.3.1.2.3.p.3">First layer of interior router get multiple direct DHCPv6 prefixes.  Assigns each prefix in parallel.  Sets up DHCPv6 relay agent to point to each of the CPE routers.</p>
<p id="rfc.section.3.1.2.3.p.4">Next layer receives DHCPv6 transaction from each CPE router because upstream router forwards DHCPv6 messages to each of the CPE routers.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#issues" id="issues">Issues in a simple cascade procedure</a>
</h1>
<p id="rfc.section.4.p.1">There are a number of potential issues in this procedure.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Sequence of subnet number allocation</h1>
<p id="rfc.section.4.1.p.1">Apart from cases in which the administration has chosen to fix a given subnet to a given LAN, such as to support server deployment in DNS, it is generally advised that subnet numbers be randomized. This is to make certain network attacks a little more difficult.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#multihoming" id="multihoming">Multihoming Issues</a>
</h1>
<p id="rfc.section.4.2.p.1">One issue is "what happens if one has multiple upstream networks with multiple CPE Routers and therefore multiple allocators?" The design of the RA information element announcing the allocator is intended to simplify that by announcing an allocator.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#racing" id="racing">Race Conditions</a>
</h1>
<p id="rfc.section.4.3.p.1">In the simplest case, there are no race conditions; the home has exactly one router, it obtains a prefix from its upstream network, and sub-allocates to its interfaces. If there are additional routers in the home, however, either there are one or more links that are not attached to the CPE Router or there are zero; in the event that there are one or more such links, they may be connected by one router or by multiple routers.</p>
<p id="rfc.section.4.3.p.2">One race condition is when two interior routers are attached to the same LANs as the CPE. For example, one might have a wireless router in the home that connects both to the wired and the wireless network that the CPE Router is on. In such a case, it will hear and interpret one of the CPE Router's RAs first, and then the other some amount of time later. The purpose of the INTERVAL1 delay in <a href="#interior_router">Section 3.1.2</a> is to allow this race condition to stabilize before the router acts on this information it has.</p>
<p id="rfc.section.4.3.p.3">A second race condition occurs when two "subsequent" routers are on the same LAN but it is not serviced by the CPE Router. These routers will both use the procedure of <a href="#interior_router">Section 3.1.2</a> to attempt to allocate a prefix to the LAN and so create a subnet. It is RECOMMENDED that the allocator allocate at most one prefix per INTERVAL2, ignoring all other requests, in order to allow the "subsequent" routers to sort out this class of race condition. If needed, ignored routers will re-request the allocation.</p>
<p id="rfc.section.4.3.p.4">Due to the possibility of packet loss in the network, it is possible that these race conditions may result in a given LAN developing multiple subnets. While suboptimal, this is not a violation of the architecture and should cause no issues. However, in the event that two routers observe that they are announcing different subnets in the same upstream prefix on the same LAN, the one with the numerically least subnet number SHOULD NOT allow its prefix to expire, but any others SHOULD allow their prefixes to expire.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#scaling" id="scaling">Scaling Issues</a>
</h1>
<p id="rfc.section.4.4.p.1">Obviously, use of this procedure in a complex network results in a serialization of prefix allocation that may take more time to settle than is operationally desirable (number of LANs times INTERVAL2). In such cases, the administration will have to decide how it wants to handle the issue. One approach would be to divide the network into easily-aggregated sections and use the procedure within each section; another would be to use a different procedure.</p>
<p id="rfc.section.4.4.p.2">In such networks, the routers requesting prefixes can also act as a denial of service attack, by flooding the CPE Router with requests.  Given that the procedure eventually terminates, this is undesirable but of limited duration.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#stability" id="stability">Prefix Stability</a>
</h1>
<p id="rfc.section.4.5.p.1">In networks that contain servers or names that are announced in DNS, it is often valuable to have the same LAN always have the same subnet number applied to it. The procedure as described could accomplish that if the CPE Router maintains memory of what router it has allocated a given prefix to recently, or would fail to provide that if it does not. The distinction is essentially a marketing requirement that the implementation will need to decide for itself.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> <a href="#toosmall" id="toosmall">When you run out of prefixes</a>
</h1>
<p id="rfc.section.4.6.p.1">If a network runs out of subnet numbers and therefore subnet prefixes, this is considered a provisioning failure. It can result when multiple prefixes are allocated to the same LAN, which should be unusual and will end when one of the routers releases its prefix. It can also result when the upstream network allocates a prefix that is too long and as a result contains too few potential prefixes. In that case, the administration is forced to either reorganize its network or negotiate for a shorter prefix.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#allocator" id="allocator">Router Advertisement Allocator Information Element </a>
</h1>
<p id="rfc.section.5.p.1">On a Neighbor Discovery RA, <a href="#interior_router">Section 3.1.2</a> and <a href="#interior_router">Section 3.1.2</a> call for the RA to identify the allocator that a "subsequent" router may use to request a related prefix for use on a different interface. This information element contains a list of the IPv6 addresses of one or more allocators, and an element length option to permit parsing of the information element.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">In <a href="#allocator">Section 5</a>, this note specifies an information element to be carried in the Router Advertisement message specified in Neighbor Discovery.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">&lt;TBD&gt;</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#Privacy" id="Privacy">Privacy Considerations</a>
</h1>
<p id="rfc.section.7.1.p.1">&lt;TBD&gt;</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#log" id="log">Change Log</a>
</h1>
<p></p>

<dl>
<dt>Initial Version:</dt>
<dd style="margin-left: 8">4 Octoboer 2011</dd>
</dl>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.chown-homenet-arch">[I-D.chown-homenet-arch]</b></td>
<td class="top">
<a>Arkko, J</a>, <a>Chown, T</a>, <a>Weil, J</a> and <a>O Troan</a>, "<a href="http://tools.ietf.org/html/draft-chown-homenet-arch-01">Home Networking Architecture for IPv6</a>", Internet-Draft draft-chown-homenet-arch-01, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0791">[RFC0791]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>", STD 5, RFC 791, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2131">[RFC2131]</b></td>
<td class="top">
<a href="mailto:droms@bucknell.edu" title="Computer Science Department">Droms, R.</a>, "<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>", RFC 2131, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3363">[RFC3363]</b></td>
<td class="top">
<a>Bush, R.</a>, <a>Durand, A.</a>, <a>Fink, B.</a>, <a>Gudmundsson, O.</a> and <a>T. Hain</a>, "<a href="http://tools.ietf.org/html/rfc3363">Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)</a>", RFC 3363, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3971">[RFC3971]</b></td>
<td class="top">
<a>Arkko, J.</a>, <a>Kempf, J.</a>, <a>Zill, B.</a> and <a>P. Nikander</a>, "<a href="http://tools.ietf.org/html/rfc3971">SEcure Neighbor Discovery (SEND)</a>", RFC 3971, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4389">[RFC4389]</b></td>
<td class="top">
<a>Thaler, D.</a>, <a>Talwar, M.</a> and <a>C. Patel</a>, "<a href="http://tools.ietf.org/html/rfc4389">Neighbor Discovery Proxies (ND Proxy)</a>", RFC 4389, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4861">[RFC4861]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Nordmark, E.</a>, <a>Simpson, W.</a> and <a>H. Soliman</a>, "<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>", RFC 4861, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4862">[RFC4862]</b></td>
<td class="top">
<a>Thomson, S.</a>, <a>Narten, T.</a> and <a>T. Jinmei</a>, "<a href="http://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>", RFC 4862, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4941">[RFC4941]</b></td>
<td class="top">
<a>Narten, T.</a>, <a>Draves, R.</a> and <a>S. Krishnan</a>, "<a href="http://tools.ietf.org/html/rfc4941">Privacy Extensions for Stateless Address Autoconfiguration in IPv6</a>", RFC 4941, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6241">[RFC6241]</b></td>
<td class="top">
<a>Enns, R.</a>, <a>Bjorklund, M.</a>, <a>Schoenwaelder, J.</a> and <a>A. Bierman</a>, "<a href="http://tools.ietf.org/html/rfc6241">Network Configuration Protocol (NETCONF)</a>", RFC 6241, June 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6242">[RFC6242]</b></td>
<td class="top">
<a>Wasserman, M.</a>, "<a href="http://tools.ietf.org/html/rfc6242">Using the NETCONF Protocol over Secure Shell (SSH)</a>", RFC 6242, June 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fred Baker</span> 
	  <span class="n hidden">
		<span class="family-name">Baker</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Santa Barbara</span>,  
		<span class="region">California</span> 
		<span class="code">93117</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fred@cisco.com">fred@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ralph Droms</span> 
	  <span class="n hidden">
		<span class="family-name">Droms</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  <span>1414 Massachusetts Avenue</span>

	  <span class="vcardline">
		<span class="locality">Boxborough</span>,  
		<span class="region">Massachusetts</span> 
		<span class="code">01719</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rdroms@cisco.com">rdroms@cisco.com</a></span>

  </address>
</div>

</body>
</html>