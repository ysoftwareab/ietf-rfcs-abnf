



Network Working Group                                              Y. Li
Internet-Draft                                                   H. Yang
Intended status: Informational                                    T. Sun
Expires: 14 August 2022                                     China Mobile
                                                        10 February 2022


      One-way Delay Measurement Based on Deterministic Networking
             draft-li-ippm-deterministic-owd-measurement-01

Abstract

   One-way delay is a key indicator to measure network quality.  Some
   applications are one-way transmission in the network, such as some
   high-definition video services, and are very sensitive to one-way
   delay.  Excessive delay will affect user experience greatly.  To some
   extent, the network can't even be used, so it is very important to
   accurately measure the network transmission delay.  The current one-
   way delay measurement method has problems such as high complexity and
   low measurement accuracy.  In order to solve the problem of high-
   precision one-way delay measurement, a one-way delay measurement
   method based on deterministic networking is proposed in this
   document.  The method takes advantage of the delay characteristics of
   the deterministic networking and does not depend on precise time
   synchronization.The method realizes the one-way delay measurement of
   any service flow between any network elements.  Its technical
   advantages are: the network does not need to send measurement
   packets, can test all traffic types, does not change network status,
   does not change the format of traffic packets, and does not require
   network elements to support time synchronization protocols.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 14 August 2022.




Li, et al.               Expires 14 August 2022                 [Page 1]

Internet-Draft            Network Working Group            February 2022


Copyright Notice

   Copyright (c) 2022 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   3
     2.1.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
     2.2.  Requirements Language . . . . . . . . . . . . . . . . . .   4
   3.  One-way Delay Measurement Method Based on Deterministic
           Networking  . . . . . . . . . . . . . . . . . . . . . . .   4
   4.  Procedures of the One-way Delay Measurement Method  . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   8
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   8
   7.  Normative References  . . . . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9

1.  Introduction

   One-way transmission delay is a key indicator to measure network
   quality.  Some applications are based on one-way transmission in the
   network, such as some high-definition video services, and are very
   sensitive to one-way delay.  Excessive one-way delay will affect user
   experience dramatically, so it is very important to accurately
   measure the one-way transmission delay of the network.

   There are several kinds of methods to measure one-way delay.  The
   first kind of methods is active measurement.  A sender will send
   measurement protocol messages, such as Two-Way Active Measurement
   Protocol (TWAMP) [RFC8186]messages, to the network to measure the
   one-way delay of the sender and receiver.  The advantage of active
   measurement is that it is flexible in application.  The disadvantage
   is that the measurement messages cannot measure the delay of real
   services, and the measurement of one-way delay requires sender and
   receiver to support time synchronization protocol, such as NTP
   [RFC5905]and PTP [IEEE.1588.2008].  The first kind of methods is
   passive measurement.  The passive measurement devices will calculate



Li, et al.               Expires 14 August 2022                 [Page 2]

Internet-Draft            Network Working Group            February 2022


   network delay by collecting actual business traffic.  The advantage
   of passive measurement is that it can measure the one-way delay of
   real services.  The disadvantage is that two passive measurement
   devices need to be deployed, and the two devices require time
   synchronization, which is difficult to implement.  The third kind of
   methods is hybrid measurement.  Hybrid measurement is a combination
   of active and passive measurements, that is, inserting some fields or
   flags in the service message to realize the delay measurement of the
   actual service.  The disadvantage is that the message format of the
   actual service is changed, which will affect the forwarding behavior
   of the service and have observer effect.  The network element needs
   to be able to recognize and forward the modified service message, and
   time synchronization of the network element is also required.

   The above-mentioned one-way delay measurement methods have the
   following shortcomings.  Firstly, if the measurement message is
   injected into actual network, it will occupy network bandwidth
   resources and interfere with the actual service flow, so the measured
   delay is not the delay of the actual service.  Secondly, the
   measurement equipment or network elements need to support time
   synchronization protocols, which is difficult to implement and
   costly.

   To address the following shortcomings of existing methods, this
   document presents the following technical solution.  A high-precision
   one-way delay measurement method is proposed, which can be used to
   measure the one-way delay of actual service packets, without sending
   measurement messages, without changing the actual network status,
   without changing service messages, and without the need for network
   elements to support time synchronization protocols.

2.  Conventions Used in This Document

2.1.  Terminology

   NTP Network Time Protocol

   PTP Precision Time Protocol

   TWAMP Two-Way Active Measurement Protocol

   SLA Service Level Agreement









Li, et al.               Expires 14 August 2022                 [Page 3]

Internet-Draft            Network Working Group            February 2022


2.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14[RFC2119][RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  One-way Delay Measurement Method Based on Deterministic Networking

   +-----------------------------------------------------------+
   |                 Centralized Control Node                  |
   +----+-------------+---------------+---------+---------+----+
        ^             ^               ^         ^         ^
        |             |            T4 |      T3 |         | Tn
        |             |               |    +----+----+    |
        |             |               |    | Network |    |
     T1 |          T2 |  +----------------->Element 3+-+  |
        |             |  |            |    |         | |  |
        |             |  |            |    +---------+ |  |
        |             |  |            |                |  |
        |             |  |            |                |  |
        |             |  |            |                |  |
        |             |  |            |                |  |
   +----+----+   +----+--+-+     +----+----+         +-v--+----+
   | Network |   | Network |     | Network |         | Network |
   |Element 1+--->Element 2+----->Element 4+--------->Element n|
   |         |   |         |     |         |         |         |
   +---------+   +---------+     +---------+         +---------+

      Figure 1: Figure 1: A schematic diagram of the network topology
                                 structure

   A schematic diagram of the network topology structure to describe the
   proposed method is shown in Figure 1.  The network may be a SDN
   (Software Defined Network) or a traditional network.  Whether it is
   SDN or traditional network, there is a centralized control node (or
   called a centralized management unit) for collecting network
   information sent by network elements and sending control information
   to the network.  Taking SDN as an example, the centralized control
   node can be a SDN controller.  For traditional networks, the
   centralized control node can be a network management system.  The
   information from the network element to the centralized control node
   generally passes through the management network.  In our solution,
   the management network from each network element to the centralized
   control node is required to use a delay deterministic network.  As an
   example, the delay deterministic network may be a time sensitive
   network (TSN) or a deterministic Internet (Deterministic Internet



Li, et al.               Expires 14 August 2022                 [Page 4]

Internet-Draft            Network Working Group            February 2022


   Network, DIP) [RFC8655], etc.  Through the delay deterministic
   network, the transmission delay of the network element information
   from the network element to the centralized control node can be
   guaranteed to be fixed.  T1~Tn in Figure 1 represent the network
   element information delay from the network element to the centralized
   control node of network element 1 to n respectively.

   As shown in Figure 1, suppose network traffic of a real service flow
   passes through network element 1, network element 2, ..., network
   element n in turn, and the time when network traffic passes through
   the network element is recorded as t1, t2, ..., tn.  The timestamp
   maybe the ingress timestamp of network traffic entering the network
   element or the egress timestamp of network traffic flowing out of the
   network element after the forwarding is completed.  Each network
   element transmits the flow information to the centralized control
   node through the delay deterministic network when real traffic
   passes, and the transmission delays of each network element to
   transmit the flow information to the centralized control node through
   the delay deterministic network are denoted as T1, T2, ..., Tn,
   respectively.  The timestamps when the centralized control node
   receives the flow information of each network element are t1', t2',
   ..., tn'.

   Taking the calculation of the one-way transmission delay of traffic
   from network element 1 to network element 2 as an example, the one-
   way transmission delay can be calculated in the following way.
   Firstly, because the clocks of network element 1 and network element
   2 are not synchronized, suppose the time deviation between the two is
   delta_t.  Then the one-way transmission delay of traffic from network
   element 1 to network element 2 satisfies the following formula (1).
   Among them, Delay represents the one-way transmission delay of
   traffic from network element 1 to network element 2.

   Formula (1): Delay = t2 - t1 - delta_t

   Secondly, because the clocks between network element 1 and the
   centralized control node are not synchronized, assuming that the time
   deviation between the two is delta_t', the time for the traffic
   information collected from the network element 1 to reach the
   centralized control node through the delay deterministic network
   satisfies the following formula (2).

   Formula (2): t1' = t1 + T1 + delta_t'








Li, et al.               Expires 14 August 2022                 [Page 5]

Internet-Draft            Network Working Group            February 2022


   Thirdly, the clocks between network element 2 and the centralized
   control node are not synchronized, and the time deviation between
   network element 2 and the centralized control node is delta_t'-
   delta_t.  The time t2' for the collected traffic to reach the
   centralized control node satisfies the following formula (3).

   Formula (3): t2' = t2 + T2 + delta_t' - delta_t

   Forthly, subtracting the formula (2) from the above formula (3), we
   can obtain the following formula (4).

   Formula (4): t2 - t1 - delta_t = t2' - t1' + T1 - T2

   Fifthly, substituting the above formula (4) into the above formula
   (1), the following formula (5) can be obtained.

   Formula (5): Delay = t2' - t1' + T1 - T2

   So far, the one-way transmission delay of traffic from network
   element 1 to network element 2 is obtained.  Taking the calculation
   of one-way transmission delay of traffic from network element 1 to
   network element 3 as an example, the one-way transmission delay can
   be calculated in the following way: I) Referring to the above formula
   (5), the one-way transmission delay of traffic from network element 1
   to network element 2 is: Delay12 = t2' - t1' + T1 - T2.  II)
   Referring to the above formula (5), the one-way transmission delay of
   traffic from network element 2 to network element 3 is: Delay23 = t3'
   - t2' + T2 - T3.  III) The one-way transmission delay of traffic from
   network element 1 to network element 3 is: Delay13 = Delay12 +
   Delay23 = t2' - t1' + T1 - T2 + t3' -t2' +T2 - T3 = t3' - t1' + T1 -
   T3.  It can be seen that the one-way transmission delay between any
   two network elements can be calculated similarly to the above formula
   (5).  For example, taking network element m and network element n as
   an example, the transmission delay of traffic from network element m
   to network element n is: Delay = tn' - tm' + Tm - Tn, where tn' and
   tm' are the time when the traffic information of network element m
   and network n reaches the centralized control node, and Tm and Tn are
   transmission delay of the traffic information from network element m
   and network element n to the centralized control node respectively
   through delay deterministic network.











Li, et al.               Expires 14 August 2022                 [Page 6]

Internet-Draft            Network Working Group            February 2022


4.  Procedures of the One-way Delay Measurement Method

   In this section, the procedures of the proposed one-way delay
   measurement method will be elaborated.  Assume there are two network
   element.  It is determined that the time when the centralized control
   node receives the first flow information is the first time, and the
   time when the second flow information is received by the centralized
   control node is determined to be the second time.  The first flow
   information is sent to the centralized control node via delay
   deterministic network, and the second flow information is also sent
   to the centralized control node via delay deterministic network.  The
   procedures of the one-way delay measurement method is shown in
   Figure 2.

 +-----------+  +-----------+ +---------------------+ +--------------+
 |  Network  |  |  Network  | | Delay Deterministic | | Centralized  |
 | Element m |  | Element n | |       Network       | | Control Node |
 +-----+-----+  +-----+-----+ +---------------------+ +-------+------+
       |              |                                       |
       |              |                                       |
       |              |                                       |
       |              |  The first transmission       +-------+--------+
       |              |      delay is Tm              | tm' represents |
       +----------------------------------------------> the first time |
       |              |                               +-------+--------+
       |              |                                       |
       |              |                                       |
       |              |  The second transmission      +-------+--------+
       |              |      delay is Tn              | tn' represents |
       |              +-------------------------------> the second time|
       |              |                               +-------+--------+
       |              |                                       |
       |              |                                       |
       |              |                                       |
       +              +                                       +

    Figure 2: Figure 2: Procedures of the one-way delay measurement
                                 method

   The transmission delay of traffic from the first network element to
   the second network element can be determined based on the first time,
   the second time, the first transmission delay, and the second
   transmission delay.

   The first traffic information is sent by the first network element to
   the centralized control node via a delay deterministic network at the
   moment when the traffic passes through the first network element.
   And the time when the traffic passes through the first network



Li, et al.               Expires 14 August 2022                 [Page 7]

Internet-Draft            Network Working Group            February 2022


   element refers to the moment when traffic enters the first network
   element or the time when traffic flows out of the first network
   element.

   The second traffic information is sent by the second network element
   to the centralized control node via a delay deterministic network at
   the moment when the traffic passes through the second network
   element.  And the time when the traffic passes through the second
   network element refers to the moment when traffic enters the second
   network element or the time when traffic flows out of the second
   network element.

   It is determined that the transmission delay of the first traffic
   information from the first network element to the centralized control
   node is the first transmission delay, and it is determined that the
   transmission delay of the second traffic information from the second
   network element to the centralized control node is the second
   transmission delay.  The transmission delay of traffic from the first
   network element to the second network element can be determined based
   on the following formula: Delay=tn'-tm'+Tm-Tn.  Wherein, tn'
   represents the second time, tm' represents the first time, Tm
   represents the first transmission delay, Tn represents the second
   transmission delay, and Delay represents transmission delay of the
   traffic from the first network element to the second network element.
   In the above method, the delay deterministic network is used to
   ensure that the first transmission delay and the second transmission
   delay are fixed delays.

5.  Security Considerations

   TBD.

6.  IANA Considerations

   TBD.

7.  Normative References

   [IEEE.1588.2008]
              IEEE, "IEEE Standard for a Precision Clock Synchronization
              Protocol for Networked Measurement and Control Systems",
              July 2008.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.




Li, et al.               Expires 14 August 2022                 [Page 8]

Internet-Draft            Network Working Group            February 2022


   [RFC5905]  Mills, D., Martin, J., Ed., Burbank, J., and W. Kasch,
              "Network Time Protocol Version 4: Protocol and Algorithms
              Specification", RFC 5905, DOI 10.17487/RFC5905, June 2010,
              <https://www.rfc-editor.org/info/rfc5905>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8186]  Mirsky, G. and I. Meilik, "Support of the IEEE 1588
              Timestamp Format in a Two-Way Active Measurement Protocol
              (TWAMP)", RFC 8186, DOI 10.17487/RFC8186, June 2017,
              <https://www.rfc-editor.org/info/rfc8186>.

   [RFC8655]  Finn, N., Thubert, P., Varga, B., and J. Farkas,
              "Deterministic Networking Architecture", RFC 8655,
              DOI 10.17487/RFC8655, October 2019,
              <https://www.rfc-editor.org/info/rfc8655>.

Authors' Addresses

   Yang Li
   China Mobile
   Beijing
   100053
   China

   Email: liyangzn@chinamobile.com


   Hongwei Yang
   China Mobile
   Beijing
   100053
   China

   Email: yanghongwei@chinamobile.com


   Tao Sun
   China Mobile
   Beijing
   100053
   China

   Email: suntao@chinamobile.com





Li, et al.               Expires 14 August 2022                 [Page 9]
