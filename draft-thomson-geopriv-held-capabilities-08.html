<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Device Capability Negotiation for Device-Based Location Determination and Location Measurements in HELD</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Device Capability Negotiation for Device-Based Location Determination and Location Measurements in HELD">
<meta name="keywords" content="Internet-Draft, HELD, Capabilities, Location, Measurements, Device-based">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">GEOPRIV</td><td class="header">M. Thomson</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">J. Winterbottom</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Andrew Corporation</td></tr>
<tr><td class="header">Expires: January 1, 2011</td><td class="header">M. Barnes</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Polycom</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">June 30, 2010</td></tr>
</table></td></tr></table>
<h1><br />Device Capability Negotiation for Device-Based Location Determination and Location Measurements in HELD<br />draft-thomson-geopriv-held-capabilities-08</h1>

<h3>Abstract</h3>

<p>A Device is a valuable source of information about its location.  A Location Information Server (LIS) that serves a location URI about a Device is unable to acquire this information.  Extensions to HTTP-Enabled Location Delivery (HELD) are described for negotiating and exercising Device capabilities for location determination or location measurement collection.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 1, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#overview">3.</a>&nbsp;
Capabilities Exchange Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">3.1.</a>&nbsp;
Capabilities Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.2.</a>&nbsp;
Capabilities Invocation<br />
<a href="#anchor3">4.</a>&nbsp;
The Capability Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.1.</a>&nbsp;
Capabilities Advertisement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.2.</a>&nbsp;
Capabilities Agreement<br />
<a href="#poll">5.</a>&nbsp;
Capability Invocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.1.</a>&nbsp;
HTTP Polling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.2.</a>&nbsp;
Invocation Resource<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.3.</a>&nbsp;
Invocation Time<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.4.</a>&nbsp;
Responding to a Capability Invocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.5.</a>&nbsp;
Error Reponse to an Invocation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.6.</a>&nbsp;
Multiple Invocations<br />
<a href="#location">6.</a>&nbsp;
The Location Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.1.</a>&nbsp;
Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.2.</a>&nbsp;
Invocation<br />
<a href="#measurements">7.</a>&nbsp;
Location Measurement Capability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.1.</a>&nbsp;
Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">7.2.</a>&nbsp;
Invocation<br />
<a href="#anchor16">8.</a>&nbsp;
Example Capabilities Exchange and Invocation<br />
<a href="#security">9.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#privacy">9.1.</a>&nbsp;
Privacy Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#secret">9.2.</a>&nbsp;
URI Secrecy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#spoof">9.3.</a>&nbsp;
Location Veracity<br />
<a href="#iana">10.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-nomeas">10.1.</a>&nbsp;
Registration of HELD 'noMeasurement' Error Code<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-nscap">10.2.</a>&nbsp;
URN Sub-Namespace Registration for urn:ietf:params:xml:ns:held:cap<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#iana-schemacap">10.3.</a>&nbsp;
XML Schema Registration for HELD Capabilities<br />
<a href="#capschema">11.</a>&nbsp;
XML Schema for Capabilities<br />
<a href="#anchor17">12.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>A Device is a good source of information about its location.  Even where a Device is unable to independently determine its location, it can often make observations about its environment and network attachment that are of use in determining its position.  Making this information available to the Location Information Server (LIS) in the access network can improve the quality of location estimates for the Device.
      
</p>
<p>Requests that retrieve location information by value can benefit from Device-provided measurement data, as described in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a>.  However, location information provided through <a class='info' href='#RFC5808'>location URIs<span> (</span><span class='info'>Marshall, R., &ldquo;Requirements for a Location-by-Reference Mechanism,&rdquo; May&nbsp;2010.</span><span>)</span></a> [RFC5808] cannot effectively use this information.  The LIS that serves the URI is unable to contact the Device to acquire information.
      
</p>
<p>Access to some form of location determination is a necessary precondition of providing a location URI.  The LIS that serves that location URI is assumed to be capable of determining the location of the Device.  A LIS might only have a limited capacity for determining location in serving a location URI.  The quality and timeliness of responses can be improved with Device assistance.
      
</p>
<p>Acquiring location measurements or information from a Device is made difficult by the nature of the relationship between the LIS, or access network, and the Device.  The relationship between a LIS and the Devices that it serves is often transient.  A Device is not necessarily a permanent part of an access network, so it is not possible to pre-arrange trust relationships between Device and LIS.
      
</p>
<p><a class='info' href='#I-D.ietf-geopriv-http-location-delivery'>HELD<span> (</span><span class='info'>Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;HTTP Enabled Location Delivery (HELD),&rdquo; August&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;geopriv&#8209;http&#8209;location&#8209;delivery] provides a basis for the relationship between Device and LIS.  LIS Discovery <a class='info' href='#I-D.ietf-geopriv-lis-discovery'>[I&#8209;D.ietf&#8209;geopriv&#8209;lis&#8209;discovery]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Discovering the Local Location Information Server (LIS),&rdquo; March&nbsp;2010.</span><span>)</span></a> provides a means for the Device to initiate the relationship.  This document extends the basic HELD location request to include negotiation of a mechanism that allows the LIS to request information from the Device.
      
</p>
<p>Location-related Device capabilities include the ability to generate or acquire location information, or the ability to make observations about the mode of network attachment or environment.  For instance, a Device with Global Navigation Satellite System (GNSS) hardware can determine its own position by taking a set of measurements and performing a calculation, or it can provide GNSS measurement data.
      
</p>
<p>This document describes how a Device can advertise its ability to locate itself or provide location-related measurement data to a LIS.  This advertisement is made in a HELD location request where the Device acquires a location URI (see <a class='info' href='#I-D.ietf-geopriv-http-location-delivery'>[I&#8209;D.ietf&#8209;geopriv&#8209;http&#8209;location&#8209;delivery]<span> (</span><span class='info'>Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;HTTP Enabled Location Delivery (HELD),&rdquo; August&nbsp;2009.</span><span>)</span></a>).  The LIS is then able to exercise advertised capabilities to acquire location-related measurement data or location information from the Device when serving the location URI.
      
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>This document relies on definitions from <a class='info' href='#I-D.ietf-geopriv-arch'>[I&#8209;D.ietf&#8209;geopriv&#8209;arch]<span> (</span><span class='info'>Barnes, R., Lepinski, M., Cooper, A., Morris, J., Tschofenig, H., and H. Schulzrinne, &ldquo;An Architecture for Location and Location Privacy in Internet Applications,&rdquo; May&nbsp;2010.</span><span>)</span></a>.  Use of the terms LIS and Device is consistent with <a class='info' href='#I-D.ietf-geopriv-http-location-delivery'>[I&#8209;D.ietf&#8209;geopriv&#8209;http&#8209;location&#8209;delivery]<span> (</span><span class='info'>Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;HTTP Enabled Location Delivery (HELD),&rdquo; August&nbsp;2009.</span><span>)</span></a>.  Location-related measurement data (and location measurement) is defined in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a> and location estimate is defined in <a class='info' href='#I-D.thomson-geopriv-uncertainty'>[I&#8209;D.thomson&#8209;geopriv&#8209;uncertainty]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Representation of Uncertainty and Confidence in PIDF-LO,&rdquo; May&nbsp;2010.</span><span>)</span></a>.
      
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
      
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Capabilities Exchange Overview</h3>

<p>A Device provides the LIS with a capabilities advertisement when it requests a location URI.  A Device can advertise the ability to acquire location-related measurement data of any type (see <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a>), or the ability to autonomously determine its own location.
      
</p>
<p>The LIS responds with a capabilities agreement, that includes which of these capabilities it might use.  As part of the agreement, the LIS identifies an HTTP resource (the invocation resource) that it will use to request Device assistance.  The Device monitors this resource as long as it is willing to provide the advertised data.
      
</p>
<p>In the process of serving requests to a location URI, a LIS might determine that certain Device capabilities could be useful or necessary in completing the request.  The LIS alters the invocation resource to include a request that details what data is desired.  The Device acquires the updated resource and provides the requested information.
      
</p>
<p><a class='info' href='#logical'>Figure&nbsp;1<span> (</span><span class='info'>Logical Overview of Operation</span><span>)</span></a> shows a logical overview of a simple scenario where the LIS uses a Device-provided measurement to service a request to a location URI.
      
</p><br /><hr class="insert" />
<a name="logical"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  +--------+                   +-------+            +-----------+
  |        |                   |       |            | Location  |
  | Device |                   |  LIS  |            | Recipient |
  +--------+                   +-------+            +-----------+
      |                            |                      |
      +----- locationRequest -----&gt;|                      |
      | (capability advertisement) |                      |
      |                            |                      |
      |&lt;----- locationResponse ----+                      |
      |   (capability agreement)   |                      |
      |                            |                      |
      |~ ~ ~ ~ ~ ~ ~ ~ ~(convey location URI)~ ~ ~ ~ ~ ~ &gt;|
      |                            |                      |
      |                            |&lt;-- locationRequest --+
      |         capability         |                      |
      |&lt;------- invocation --------+                      |
      |                            |                      |
      +--------- publish ---------&gt;|                      |
      |  (measurements/location)   |                      |
      |                            +-- locationResponse -&gt;|
      |                            |                      |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Logical Overview of Operation&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In practice, this scheme relies on HTTP polling to provide a channel for capability invocation.  This mechanism is described in more detail in <a class='info' href='#poll'>Section&nbsp;5<span> (</span><span class='info'>Capability Invocation</span><span>)</span></a>.
     
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Capabilities Exchange</h3>

<p>To indicate capabilities to a LIS, a Device advertises its location determination or measurement capabilities to the LIS in a HELD <tt>locationRequest</tt> message.  The LIS selects those capabilities that it might make use of and provides a capabilities agreement that includes the selected capabilities in the <tt>locationResponse</tt> message, along with the location URI.
      
</p><br /><hr class="insert" />
<a name="capex"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +--------+                            +-------+
    | Device |                            |  LIS  |
    +--------+                            +-------+
        |                                     |
        +---------- locationRequest ---------&gt;|
        | (capability advertisement: A, B, C) |
        |                                     |
        |&lt;--------- locationResponse ---------+
        |          (location URI set)         |
        |     (capability agreement: A, C)    |
        |                                     |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Capabilities Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Once a common set of capabilities are agreed upon, the LIS is able invoke these capabilities to assist in the generation of location information.  Agreed capabilities and associated parameters are stored in association with the contextual information necessary for serving the location URI.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Capabilities Invocation</h3>

<p>The LIS invokes capabilities as it is necessary to service requests to the location URIs it provides.
      
</p><br /><hr class="insert" />
<a name="excap"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  +--------+                 +-------+              +-----------+
  |        |                 |       |              | Location  |
  | Device |                 |  LIS  |              | Recipient |
  +--------+                 +-------+              +-----------+
      |                          |                        |
      +--------- poll ----------&gt;|                        |
      |                          |                        |
      .                          .                        .
      |                          |                        |
      |                          |&lt;--- locationRequest ---+
      |        capability        |                        |
      |&lt;------ invocation -------+                        |
      |                          |                        |
      |&lt;- - - - exchange - - - -&gt;|                        |
      | (measurements/location)  |                        |
      |                          +--- locationResponse --&gt;|
      |                          |                        |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Invoking Capabilities&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Capabilities are bound to the location URIs that are provided in the response that indicates the mutually agreed capabilities.  The LIS MUST NOT use capabilities for any purpose other than serving those location URIs.
      
</p>
<p>The set of capabilities associated with a location URI is fixed.  A Device instead applies local policy in determining whether to respond to a capability invocation.  A Device can choose to discontinue selected capabilities by refusing to respond to a capability invocation.  A Device can also cease to monitor the resource used for capability invocation to terminate all capabilities.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
The Capability Exchange</h3>

<p>A capabilities exchange is initiated with a location request from a Device.  The Device includes a capbilities advertisement in the location request.  The LIS responds with agreed capabilities in the location response.
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Capabilities Advertisement</h3>

<p>A Device capabilities advertisement (the <tt>deviceCapabilities</tt> element) is added to the HELD location request by the Device.  This element can contain a <tt>location</tt> element to indicate that the Device is capable of determining its own location autonomously; it can also contain one or more <tt>measurement</tt> elements, each indicating that the Device is cable of providing location measurement data.
      
</p>
<p>Each capability is uniquely identified with a <tt>id</tt> attribute.
      
</p>
<p>A <tt>responseTime</tt> attribute indicates the expected time that acquiring the location or measurement data takes, in milliseconds.  The advertised response time assists the LIS in deciding whether or not to invoke a capability when serving a request for location information.
      </p>
<blockquote class="text">
<p>The Device is only able to quantify the time for its own involvement in the process; additional delays from polling, network transit and LIS processing need to be included in any decision to invoke a Device capability.
      
</p>
</blockquote><p>
      
</p>
<p>Location measurement capabilities include a <tt>type</tt> attribute, which identifies the type of measurement.  Types are identified using the qualified name of the XML element for the measurement, as with the <tt>measurementRequest</tt> element defined in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a>.
      
</p>
<p>Each capability element can also contain arbitrary content that carries supplementary information specific to the capability.  This supplementary information includes, but is not restricted to, measurement parameters that identify specific aspects of a measurement capability.  Different supplementary information can be provided by the Device and LIS.
      
</p>
<p>The following figure shows a capabilities advertisement that might be made by a Device with GNSS capabilities.  This includes both autonomous GNSS location determination capability as well as GNSS measurement capability with additional parameters.
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;deviceCapabilities
      xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
    &lt;location id="loc" responseTime="45000"/&gt;
    &lt;measurement xmlns:g="urn:ietf:params:xml:ns:geopriv:lm:gnss"
                 type="g:gnss" id="gps" responseTime="12000"&gt;
      &lt;g:gnss system="gps" signal="L1"/&gt;
    &lt;/measurement&gt;
  &lt;/deviceCapabilities&gt;
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Capabilities Agreement</h3>

<p>A capabilities agreement (<tt>agreedCapabilities</tt> element) is included in the HELD location response.  This element contains a subset of the advertised capabilities, indicating which capabilities the LIS wishes to use.  Capabilities are identified using the <tt>id</tt> attribute, but other attributes are omitted.
      
</p>
<p>A capabilities agreement contains an HTTP URI for an invocation resource.  The <tt>monitor</tt> element indicates a resource that the Device is requested to monitor for <a class='info' href='#poll'>capability invocations<span> (</span><span class='info'>Capability Invocation</span><span>)</span></a>.
      
</p>
<p>The following figure shows a capabilities agreement that might be made in response to a device capabilities advertisement.  This includes an invoke resource and a reference to each device capability, using the <tt>id</tt> attribute for each location and measurement capability.
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;agreedCapabilities
      xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
    &lt;monitor&gt;https://lis.example.com/inv/C90dXBsZT4KPC&lt;/monitor&gt;
    &lt;location id="loc"/&gt;
    &lt;measurement id="gps"/&gt;
  &lt;/agreedCapabilities&gt;
</pre></div>
<a name="poll"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Capability Invocation</h3>

<p>The LIS includes a URI for an HTTP "invocation" resource in the capabilities agreement.  A Device that wishes to provide advertised capabilities monitors this resource.
      
</p>
<p>The contents of the invocation resource identify the information that the LIS desires.  The LIS updates the invocation resource when a request to a location URI is made that could benefit from location or measurement data acquired by the Device.
      
</p>
<p>The invocation resource is updated to identify one or more capabilities when information is requested by the LIS.  For each capability, the resource includes a destination URI for the requested data, and a time.  By monitoring the invocation resource, the Device is informed when the LIS requires more information and the Device is then able to provide that information.
      
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
HTTP Polling</h3>

<p>The Device monitors the invocation resource, using either <a class='info' href='#I-D.loreto-http-bidirectional'>HTTP long-polling<span> (</span><span class='info'>Loreto, S., Saint-Andre, P., Salsano, S., and G. Wilkins, &ldquo;Best Practices for the Use of Long Polling and Streaming in Bidirectional HTTP,&rdquo; February&nbsp;2010.</span><span>)</span></a> [I&#8209;D.loreto&#8209;http&#8209;bidirectional] or periodic requests (short-polling).  Both methods use the HTTP GET method.  Client and server developers are reminded that full support of <a class='info' href='#RFC2616'>HTTP<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> [RFC2616] facilities is expected.
        
</p>
<p>The Device SHOULD retrieve an initial representation of the resource and poll for updates using conditional request headers, such as <tt>If-Modified-Since</tt> or <tt>If-None-Match</tt>.  The Device SHOULD use long-polling and indicate this using a <a class='info' href='#I-D.loreto-http-timeout'>Timeout header<span> (</span><span class='info'>Loreto, S., Thomson, M., and G. Wilkins, &ldquo;Hypertext Transfer Protocol (HTTP) Timeouts,&rdquo; June&nbsp;2010.</span><span>)</span></a> [I&#8209;D.loreto&#8209;http&#8209;timeout] [[...or whatever replaces this, since Timeout is already taken]].  An HTTP 200 (OK) response is sent immediately when the resource is updated, or an HTTP 304 (Not Modified) response is sent if the timeout period lapses .  In order to continue monitoring the state of the resource, the Device immediately sends another request upon receiving a response.
        
</p>
<p>In the absence of the Timeout header, the server MAY assume that short-polling is in use.  If short-polling is used, the Device MUST NOT continuously poll for updates.  The server can limit the rate that a client is able to poll by sending a 503 (Service Unavailable) response with an appropriate <tt>Retry-After</tt> header.  A client that receives this header MUST adjust its polling rate to match the indicated period.
        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Invocation Resource</h3>

<p>The resource that the Device monitors identifies individual capabilities and when the information that they provide is requested.
        
</p>
<p>The value of the invocation resource determines what information is required.  This document is an XML document with the MIME type of <tt>application/held+xml</tt> and a document element of <tt>invokeCapability</tt>.  Initially, this document is likely to be empty.
        
</p>
<p>A Device monitors the invocation resource for changes.  A change in the state of the invocation resource indicates that the LIS requests some data.  The value of the invocation resource indicates the capability, where the data associated with the capability is to be pushed by the Device, and when the associated data is to be provided.
        
</p>
<p>For instance, if the LIS wants to invoke the location capability of the Device, it updates the resource to produce the following representation:
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;invokeCapabilities
      xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
    &lt;measurement id="gps" before="2011-07-09T13:55:01+10:00"&gt;
      &lt;push&gt;https://lis.example.com/push/U2Nob29sIGlzIGNvb2wu&lt;/push&gt;
    &lt;/measurement&gt;
  &lt;/invokeCapabilities&gt;
</pre></div>
<p>The Device monitors the invocation resource as long as it is willing to respond to capability invocation requests, though it MAY suspend any monitoring while it responds to a request for data.  Upon expiry of the location URI, the Device SHOULD stop monitoring the resource.  An HTTP 404 (Not Found) or 410 (Gone) response can be provided to indicate to the Device that the resource no longer exists.
        
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Invocation Time</h3>

<p>The <tt>before</tt> attribute on the capability invocation serves to advise the Device on the latest time when a response is desired.  This time is the latest moment that information from the Device is of use to the LIS.  If this time has passed, or the requested information cannot be provided before this time, then the capability invocation can be ignored.
        
</p>
<p>The <tt>periodic</tt> attribute on a capability requests periodic updates.  The attribute contains a time interval in milliseconds, which specifies the periodicity desired.  This indicates that the Device provide information before the time specified in the <tt>before</tt> attribute and periodically thereafter at the specified interval.
        
</p>
<p>Periodic invocations continue until the invocation is modified or removed.  The Device SHOULD continue to monitor the invocation resource to be informed of any changes.
        
</p>
<p>For instance, the following invocation contains a request to provide measurements for the capability identified with the <tt>id</tt> attribute of <tt>gps</tt>.  This information should be provided before <tt>2011-07-09T13:55:01+10:00</tt> and at 60 second intervals thereafter (before 13:55:01, then before 13:56:01, then 13:57:01, and so on).
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;invokeCapabilities
      xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
    &lt;measurement id="gps" before="2011-07-09T13:55:01+10:00"
                 periodic="60000"&gt;
      &lt;push&gt;https://lis.example.com/push/U2Nob29sIGlzIGNvb2wu&lt;/push&gt;
    &lt;/measurement&gt;
  &lt;/invokeCapabilities&gt;
</pre></div>
<p>The following figure shows that a Device acquires measurement data immediately upon receiving a capability invocation with a periodic interval.  After these measurements are pushed to the LIS, the Device waits for a period.  The time that is waited is the difference between the periodic interval (p) and the expected time to acquire measurement data (m).  This ensures that measurement data is provided to the LIS prior to the requested time.
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                    +--------+           +-------+
                    | Device |           |  LIS  |
                    +--------+           +-------+
                        |                    |
                        |      periodic      |
                        |&lt;--- capability ----+
                        |     invocation     |
                 .--------------.            |
                 |   Acquire    |            |
                 | Measurements |            |
 Before          `--------------'            |
  Time                  |                    |
    \                   +------ push -------&gt;|
     \______________    |    measurements    +--...
       ^     ^          |                    |
       |     |          '                    '
       |   (p-m)     &lt;wait&gt;
       |     |          .                    .
       |     v______    |                    |
       |     ^   .--------------.            |
      (p)    |   |   Acquire    |            |
       |     |   | Measurements |            |
       |    (m)  `--------------'            |
       |     |          |                    |
       |     |          +------ push -------&gt;|
       v_____v______    |    measurements    +--...
       ^                |                    |
       '                '                    '
</pre></div>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Responding to a Capability Invocation</h3>

<p>A Device that wishes to provide information SHOULD do so when it receives an invocation that it can comply with.  Any information is pushed to the URI indicated in the <tt>push</tt> element as an HTTP PUT.  The format of the information provided depends on the capability.
        
</p>
<p>A Device can choose to ignore a capability invocation at any time.
        
</p>
<p>Information provided in this manner can be considered as additional supplementary information that is provided for the purposes of serving the location URI.  The same authorization rules that apply to the location URI apply to this data.  A LIS is able to redistribute this information and any results based on this information under the same policy that the location URI operates.  Any information MUST only be used as permitted by the Device.  Explicit data expiration indications, such as that used in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a>, MUST be respected.
        
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Error Reponse to an Invocation</h3>

<p>A Device might be unable to acquire the requested location or measurement information when it is requested.  In this case, a HELD error message is sent to the resource indicated in the <tt>push</tt> element of the invocation, in place of the requested data.  The HELD error message is defined in Section 5.3 of <a class='info' href='#I-D.ietf-geopriv-http-location-delivery'>[I&#8209;D.ietf&#8209;geopriv&#8209;http&#8209;location&#8209;delivery]<span> (</span><span class='info'>Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;HTTP Enabled Location Delivery (HELD),&rdquo; August&nbsp;2009.</span><span>)</span></a>.
        
</p>
<p>Requests for location information can elicit a push containing any of the applicable HELD error codes (including <tt>locationUnknown</tt>).  Requests for measurement data can result in the same set of codes, plus a newly defined error code: <tt>noMeasurement</tt> is defined in <a class='info' href='#iana-nomeas'>Section&nbsp;10.1<span> (</span><span class='info'>Registration of HELD 'noMeasurement' Error Code</span><span>)</span></a>.
        
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Multiple Invocations</h3>

<p>The same invoke resource is used for multiple capabilities.  Devices that support multiple capabililties identify the capability that the LIS desires to use through the <tt>id</tt> attribute on the capability.  If multiple capabilities are invoked at the same time, the Device MAY choose to provide all information concurrently or separately, and in whole, in part or not at all.
        
</p>
<p>The measurement capability inherently supports provision of multiple measurements concurrently.  A single measurement container can be provided with multiple different forms of measurement.  Measurement and location capabilities are pushed separately.
        
</p>
<p>A LIS MUST provide a different push resource for each separate capability that it invokes.  Without this, information from the Device cannot be reliably correlated with a specific capability.  For instance, an error response for one capability might be misinterpreted as an error for all capabilities.
        
</p>
<a name="location"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
The Location Capability</h3>

<p>The location capability indicates that the Device can determine its own location.  This is represented by the inclusion of a <tt>location</tt> element.
      
</p>
<p>The ability to locate itself is a trait that is applicable to Devices in a range of networks.  This includes automated location determination, like Global Navigation Satellite Systems (GNSS), user input, an alternative location service, or a range of location techniques.
      
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Parameters</h3>

<p>The <tt>location</tt> element MAY include a <tt>locationType</tt> element that includes a value of <tt>civic</tt> or <tt>geodetic</tt>, a space-separated list containing both values, or the value <tt>any</tt>.  A basic description of the semantics of location type is included in Section 6.3 of <a class='info' href='#I-D.ietf-geopriv-http-location-delivery'>HELD<span> (</span><span class='info'>Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;HTTP Enabled Location Delivery (HELD),&rdquo; August&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;geopriv&#8209;http&#8209;location&#8209;delivery].
        
</p>
<p>When included in the capabilities advertisement, the <tt>locationType</tt> element indicates the type of location information that the device is capable of providing.  When included in other messages, the <tt>locationType</tt> element indicates the type of location information that the LIS requests that the Device provide.  Omitting the <tt>locationType</tt> element indicates that the previous value from the most recent message is requested; if there is no such value, then any form of location information is acceptable.
        
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Invocation</h3>

<p>When invoked, the Device provides location information in the form of a PIDF-LO.  The Device uses an HTTP PUT to the URI identified in the <tt>push</tt> element of the capability invocation.  The PUT request includes a PIDF-LO document and a <tt>Content-Type</tt> of <tt>application/pidf+xml</tt>.
        
</p>
<p>Only the <tt>location-info</tt> element of the PIDF-LO is used by the LIS; other PIDF-LO fields SHOULD be minimally populated by the Device.  It is RECOMMENDED that the Device generate an unlinked pseudonym for the <tt>entity</tt> attribute of the presence document to avoid providing identity information.
        
</p>
<p>In providing location information in this manner, the Device implicitly grants the LIS the ability to redistribute location information under the same conditions that apply to the location URI that the capability was negotiated with.
        
</p>
<a name="measurements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Location Measurement Capability</h3>

<p>The location capability indicates that the Device can acquire location-related measurement data of a specified type.  This is represented by the inclusion of a <tt>measurement</tt> element.
      
</p>
<p>Measurement data from the Device can be invaluable in improving the quality of location information.  Measurement information from a Device can improve the accuracy of location estimates or enable positioning methods that would not otherwise be available.  See <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a> for more information on location measurements.  Providing access to measurement data by using the capability exchange makes these advantages available when a location recipient uses a location URI to retrieve location information.
      
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Parameters</h3>

<p>A capability advertisement for location measurements includes the type of measurement that is supported, using the <tt>type</tt> attribute of the <tt>measurement</tt> element.   Measurement types are identified using the XML qualified name of the measurement element, as defined for the measurement request in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a>.
        
</p>
<p>The <tt>type</tt> attribute is omitted from the capabilities agreement and capability invocation.  If the LIS supports or requires a subset of the measurement data, it MAY indicate this using measurement parameters in the agreement or the capability invocation.  Omission of parameters in either message indicates that the last set parameters are to be applied.  For instance, if parameters are included in the capabilities advertisement and revised in the capabilities agreement, a capability invocation can omit these and have the parameters from the agreement applied.
        
</p>
<p>A capability invocation MAY include a <tt>samples</tt> parameter to request that the Device provide a certain number of samples of the indicated measurement type.  The <tt>samples</tt> parameter defaults to 1.
        
</p>
<p>The Device MAY ignore this parameter and provide a smaller (or larger) number of samples.  However, a Device SHOULD indicate how many samples were acquired for a given measurement type, either by including multiple measurements, by providing multiple separate responses, or by setting the <tt>samples</tt> attribute for elements of the measurement where available.
        
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Invocation</h3>

<p>The Device acquires and pushes location measurements to the identified URI when a measurement capability is invoked.  The Device uses an HTTP PUT to the URI identified in the <tt>target</tt> element of the capability indication.   This document contains the MIME type <tt>application/held+xml</tt> and has a document element of <tt>measurements</tt>.  This document contains one or more measurement elements containing the requested measurement data.
        
</p>
<p>Multiple measurements can be provided at the same time.  The <tt>measurements</tt> element simply contains multiple measurement elements.  This can be used to simultaneously provide information for multiple different invocations of this capability.  Measurements that are acquired at different times are provided in different requests.
        
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Example Capabilities Exchange and Invocation</h3>

<p>This section shows sample messages relating to a location request with capabilities, monitoring the invocation resource and the provision of measurement or location information.  HTTP headers are shown on messages where it is relevant to do so.
</p>
<p>The following HELD request from a Device includes a capabilities advertisement; HTTP headers are omitted:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;held:locationRequest
      xmlns:held="urn:ietf:params:xml:ns:geopriv:held"&gt;
    &lt;held:locationType exact="true"&gt;locationURI&lt;/held:locationType&gt;
    &lt;requestPolicyUri
        xmlns="urn:ietf:params:xml:ns:geopriv:held:policy"/&gt;

    &lt;cap:deviceCapabilities
        xmlns:cap="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
      &lt;cap:location id="loc" responseTime="45000"&gt;
        &lt;held:locationType&gt;geodetic&lt;/held:locationType&gt;
      &lt;/cap:location&gt;
      &lt;cap:measurement
          xmlns:gnss="urn:ietf:params:xml:ns:geopriv:lm:gnss"
          type="gnss:gnss" id="gps" responseTime="12000"&gt;
        &lt;gnss:gnss system="gps" signal="L1"/&gt;
      &lt;/cap:measurement&gt;
    &lt;/cap:deviceCapabilities&gt;
  &lt;/held:locationRequest&gt;
</pre></div>
<p>Two capabilities are included: location and measurement.  The measurement capability indicates that GNSS measurements can be provided by the Device.  The GNSS capability indicates that measurement for the GPS L1 signal are the only GNSS measurement supported.
        
</p>
<p>The LIS response includes location URIs, along with a capabilities agreement:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;held:locationResponse
      xmlns:held="urn:ietf:params:xml:ns:geopriv:held"&gt;
    &lt;held:locationUriSet expires="2011-07-11T15:06:00+10:00"&gt;
      &lt;held:locationURI&gt;
        https://lis.example.com/OnBhcmFtczp4bWw6bnM6c
      &lt;/held:locationURI&gt;
    &lt;/held:locationUriSet&gt;

    &lt;cap:agreedCapabilities
        xmlns:cap="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
      &lt;cap:monitor&gt;
        https://lis.example.com/inv/OnBhcmFtczp4C90dXBsZT4KPC
      &lt;/cap:monitor&gt;
      &lt;cap:location id="loc"/&gt;
      &lt;cap:measurement id="gps"/&gt;
    &lt;/cap:agreedCapabilities&gt;
  &lt;/held:locationResponse&gt;
</pre></div>
<p>This indication instructs the Device to monitor a URI to determine when the LIS wants to invoke either capability.
        
</p>
<p>The Device then monitors the state of the resource:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /inv/OnBhcmFtczp4C90dXBsZT4KPC HTTP/1.1
Host: lis.example.com

</pre></div>
<p>The resource initially contains no invocation instructions:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Server: Example LIS
Date: Sat, 9 Jul 2011 03:06:12 GMT
Expires: Sat, 9 Jul 2011 03:08:42 GMT
ETag: "xyzzy"
Cache-Control: private
Content-Type: application/held+xml
Content-Length: 76

&lt;invokeCapabilities
    xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"/&gt;
</pre></div>
<p>The Device then issues a long-polling request to monitor the state of the resource:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
GET /inv/OnBhcmFtczp4C90dXBsZT4KPC HTTP/1.1
Host: lis.example.com
If-None-Match: "xyzzy"
Timeout: 600

</pre></div>
<p>Some time later, the LIS receives a location request and decides that the GNSS measurement capability of the Device would be useful or necessary in completing the reqeust.  The LIS updates the invocation resource with instructions to the Device to provide location measurements:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 200 OK
Server: Example LIS
Date: Sat, 9 Jul 2011 03:54:44 GMT
Expires: Sat, 9 Jul 2011 03:55:01 GMT
Cache-Control: private
Content-Type: application/held+xml
Content-Length: 245

&lt;invokeCapabilities
    xmlns="urn:ietf:params:xml:ns:geopriv:held:cap"&gt;
  &lt;measurement id="gps" before="2011-07-09T13:55:01+10:00"&gt;
    &lt;push&gt;https://lis.example.com/push/U2Nob29sIGlzIGNvb2wu&lt;/push&gt;
  &lt;/measurement&gt;
&lt;/invokeCapabilities&gt;
</pre></div>
<p>The Device decides that it is able to provide these data.  It takes the requested measurement and pushes the measurement data to the indicated destination:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PUT /push/U2Nob29sIGlzIGNvb2wu HTTP/1.1
Host: lis.example.com
Content-Type: application/held+xml
Content-Length: 688

&lt;measurements xmlns="urn:ietf:params:xml:ns:geopriv:lm"
              time="2011-07-09T13:54:56.490+10:00" timeError="2e-5"&gt;
  &lt;gnss xmlns="urn:ietf:params:xml:ns:geopriv:lm:gnss"
        system="gps" signal="L1"&gt;
    &lt;sat num="19"&gt;
      &lt;doppler&gt;499.9395&lt;/doppler&gt;
      &lt;codephase rmsError="1.6e-9"&gt;0.87595747&lt;/codephase&gt;
      &lt;cn0&gt;45&lt;/cn0&gt;
    &lt;/sat&gt;
    &lt;sat num="27"&gt;
      &lt;doppler&gt;378.2657&lt;/doppler&gt;
      &lt;codephase rmsError="1.6e-9"&gt;0.56639479&lt;/codephase&gt;
      &lt;cn0&gt;52&lt;/cn0&gt;
    &lt;/sat&gt;
    &lt;sat num="20"&gt;
      &lt;doppler&gt;-633.0309&lt;/doppler&gt;
      &lt;codephase rmsError="1.6e-9"&gt;0.57016835&lt;/codephase&gt;
      &lt;cn0&gt;48&lt;/cn0&gt;
    &lt;/sat&gt;
  &lt;/gnss&gt;
&lt;/measurements&gt;
</pre></div>
<p>The LIS immediately provides an empty response to the Device:
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HTTP/1.1 204 No Content
Server: Example LIS
Date: Sat, 9 Jul 2011 03:54:58 GMT

</pre></div>
<p>The LIS is then able to use the provided measurement data to provide highly accurate location information in response to the request it received.
        
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>Use of location or measurement capabilities has <a class='info' href='#privacy'>privacy considerations<span> (</span><span class='info'>Privacy Considerations</span><span>)</span></a>.  Protecting privacy depends on the <a class='info' href='#secret'>secrecy of the URIs used<span> (</span><span class='info'>URI Secrecy</span><span>)</span></a>.  Use of Device capability also exposes a LIS to the possibility of a Device that <a class='info' href='#spoof'>falsifies location or measurement data<span> (</span><span class='info'>Location Veracity</span><span>)</span></a>.
      
</p>
<a name="privacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Privacy Considerations</h3>

<p>The information provided by a Device in the course of responding to a capabilities invocation privacy-sensitive data.  This is either location information, or measurement data that could be use to produce location information.  The <a class='info' href='#I-D.ietf-geopriv-arch'>GEOPRIV architecture<span> (</span><span class='info'>Barnes, R., Lepinski, M., Cooper, A., Morris, J., Tschofenig, H., and H. Schulzrinne, &ldquo;An Architecture for Location and Location Privacy in Internet Applications,&rdquo; May&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;geopriv&#8209;arch] provides a framework for the handling of location and location-related information.
        
</p>
<p>Information about the capabilities of a Device might be privacy sensitive.  Similarly, willingness to provide capabilities might be sensitive.
        
</p>
<p><a class='info' href='#RFC2818'>HTTP over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818] MUST be used to provide confidentiality for Device capabilities and the location or measurement data that is provided by the Device.
        
</p>
<p>All data acquired by the LIS in relation to a location URI MUST only be used for the purpose of serving the location URI.  Any access control policy - such as that installed using <a class='info' href='#I-D.barnes-geopriv-policy-uri'>[I&#8209;D.barnes&#8209;geopriv&#8209;policy&#8209;uri]<span> (</span><span class='info'>Barnes, R., Thomson, M., and J. Winterbottom, &ldquo;Location Configuration Extensions for Policy Management,&rdquo; May&nbsp;2010.</span><span>)</span></a> - that applies to the location URI also applies to any information acquired using Device capabilities.
        
</p>
<p>Any information that is provided to the LIS by the Device increases the impact of LIS impersonation.  Measures that aim to prevent impersonation, as outlined in <a class='info' href='#I-D.ietf-geopriv-lis-discovery'>[I&#8209;D.ietf&#8209;geopriv&#8209;lis&#8209;discovery]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Discovering the Local Location Information Server (LIS),&rdquo; March&nbsp;2010.</span><span>)</span></a>, MUST be applied if a Device provides capability information to a LIS.  These measures include <a class='info' href='#I-D.saintandre-tls-server-id-check'>server authentication<span> (</span><span class='info'>Saint-Andre, P. and J. Hodges, &ldquo;Representation and Verification of Domain-Based Application Server Identity in Certificates Used with Transport Layer Security,&rdquo; June&nbsp;2010.</span><span>)</span></a> [I&#8209;D.saintandre&#8209;tls&#8209;server&#8209;id&#8209;check] for all stages of the process.
        
</p>
<p>Server authentication MUST be used for the HELD location request containing the capability exchange, for retrieving the capabilities invocation and for publishing any requested information.  Resources that are identified by the LIS do no need to be provided by the same server identity, but each resource MUST be authenticated based on the domain name in the URI.  <a class='info' href='#RFC2818'>HTTP over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818] is strongly RECOMMENDED for each of these exchanges.
        
</p>
<a name="secret"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
URI Secrecy</h3>

<p>Using capabilities offers attackers a means to provide invalid location or measurement data.  The URI offered by the LIS for receiving location or measurement data is not protected by an access policy.  Knowledge of this URI is all that is required to provide information.  If an attacker is able to learn this URI, they could provide misleading information that could be used by the LIS.
        
</p>
<p>The only protection provided is secrecy.  Only the Device is given the URI to the invocation resource, which is where the URI used for providing information is made available.  To guarantee this secrecy, the URI of the invocation resource and any URIs contained therein need to be difficult to acquire or guess.
        
</p>
<p>The LIS MUST use confidentiality protection on the channel it uses to provide all resources used in the capability exchange and subsequent requests: the LIS URI used for the location request, the invocation resource, and the resource that location or measurement data is pushed to.  <a class='info' href='#RFC2818'>HTTP over TLS<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> [RFC2818] MUST be used unless confidentiality can be guaranteed by other means.
        
</p>
<p>To lower the probability of these URIs being discovered by guessing or inference, these URIs MUST include sufficient randomness.  The LIS SHOULD also periodically change the URIs it provides to limit any exposure in the case that these URIs become known to an attacker.
        
</p>
<a name="spoof"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Location Veracity</h3>

<p>The LIS is responsible for the veracity of location information it provides, especially when serving a location URI.  Information acquired from a location URI is attributed to the LIS, unless there is an explicit indication as to the provenance of the data.
        
</p>
<p>A Device might exploit this by spoofing location or measurement data.  A Device thereby falsely gains any credibility that recipients of that data might attribute to the LIS.
        
</p>
<p>This and other related considerations described in <a class='info' href='#I-D.thomson-geopriv-held-measurements'>[I&#8209;D.thomson&#8209;geopriv&#8209;held&#8209;measurements]<span> (</span><span class='info'>Thomson, M. and J. Winterbottom, &ldquo;Using Device-provided Location-Related Measurements in Location Configuration Protocols,&rdquo; May&nbsp;2010.</span><span>)</span></a> apply to the use of Device-provided information.  At a minimum, a LIS SHOULD mark location tuples with the <tt>source</tt> element.
        
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>This section registers a URN for a HELD capabilities XML namespace (<a class='info' href='#iana-nscap'>Section&nbsp;10.2<span> (</span><span class='info'>URN Sub-Namespace Registration for urn:ietf:params:xml:ns:held:cap</span><span>)</span></a>) and a corresponding schema (<a class='info' href='#iana-schemacap'>Section&nbsp;10.3<span> (</span><span class='info'>XML Schema Registration for HELD Capabilities</span><span>)</span></a>).
      
</p>
<a name="iana-nomeas"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Registration of HELD 'noMeasurement' Error Code</h3>

<p>This section registers the <tt>noMeasurement</tt> error code in the "Geopriv HELD Registries, Error codes for HELD" IANA registry.
        </p>
<blockquote class="text"><dl>
<dt>noMeasurement</dt>
<dd>This error code indicates that all requested location-related measurement data could not be acquired by the Device.
          
</dd>
</dl></blockquote>

<a name="iana-nscap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
URN Sub-Namespace Registration for urn:ietf:params:xml:ns:held:cap</h3>

<p>This section registers a new XML namespace, <tt>urn:ietf:params:xml:ns:held:cap</tt>, as per the guidelines in <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.
        </p>
<blockquote class="text">
<p>URI: urn:ietf:params:xml:ns:held:cap
</p>
<p>Registrant Contact: IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).
</p>
<p>XML:
          </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      BEGIN
        &lt;?xml version="1.0"?&gt;
        &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"&gt;
        &lt;html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"&gt;
          &lt;head&gt;
            &lt;title&gt;HELD Capabilities Indication&lt;/title&gt;
          &lt;/head&gt;
          &lt;body&gt;
            &lt;h1&gt;Namespace for HELD Capabilities Indication&lt;/h1&gt;
            &lt;h2&gt;urn:ietf:params:xml:ns:held:cap&lt;/h2&gt;
[[NOTE TO IANA/RFC-EDITOR: Please update RFC URL and replace XXXX
    with the RFC number for this specification.]]
            &lt;p&gt;See &lt;a href="[[RFC URL]]"&gt;RFCXXXX&lt;/a&gt;.&lt;/p&gt;
          &lt;/body&gt;
        &lt;/html&gt;
      END
</pre></div><p>

          
</p>
</blockquote><p>
        
</p>
<a name="iana-schemacap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
XML Schema Registration for HELD Capabilities</h3>

<p>This section registers an XML schema as per the guidelines in <a class='info' href='#RFC3688'>[RFC3688]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>.
        </p>
<blockquote class="text"><dl>
<dt>URI:</dt>
<dd>urn:ietf:params:xml:schema:held:cap
</dd>
<dt>Registrant Contact:</dt>
<dd>IETF, GEOPRIV working group, (geopriv@ietf.org), Martin Thomson (martin.thomson@andrew.com).
</dd>
<dt>Schema:</dt>
<dd>The XML for this schema can be found as the entirety of <a class='info' href='#capschema'>Section&nbsp;11<span> (</span><span class='info'>XML Schema for Capabilities</span><span>)</span></a> of this document.
          
</dd>
</dl></blockquote><p>
        
</p>
<a name="capschema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
XML Schema for Capabilities</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0"?&gt;
&lt;xs:schema
     xmlns:cap="urn:ietf:params:xml:ns:geopriv:held:cap"
     xmlns:xs="http://www.w3.org/2001/XMLSchema"
     targetNamespace="urn:ietf:params:xml:ns:geopriv:held:cap"
     elementFormDefault="qualified"
     attributeFormDefault="unqualified"&gt;

  &lt;xs:annotation&gt;
    &lt;xs:appinfo
        source="urn:ietf:params:xml:schema:geopriv:held:cap"&gt;
      HELD Capabilities
    &lt;/xs:appinfo&gt;
    &lt;xs:documentation source="http://www.ietf.org/rfc/rfcXXXX.txt"&gt;
&lt;!-- [[NOTE TO RFC-EDITOR: Please replace above URL with URL of
                       published RFC and remove this note.]] --&gt;
      This schema is the basis for HELD capabilities negotiation.
    &lt;/xs:documentation&gt;
  &lt;/xs:annotation&gt;

  &lt;xs:element name="deviceCapabilities" type="cap:deviceCapType"/&gt;
  &lt;xs:complexType name="deviceCapType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="location"
                      type="cap:deviceCapLocationType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:element name="measurement"
                      type="cap:deviceCapMeasurementType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace="##any" processContents="lax"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="deviceCapLocationType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="cap:agreedCapLocationType"&gt;
        &lt;xs:attribute name="responseTime" type="xs:nonNegativeInteger"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="deviceCapMeasurementType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:extension base="cap:agreedCapMeasurementType"&gt;
        &lt;xs:attribute name="responseTime" type="xs:nonNegativeInteger"
                      use="required"/&gt;
      &lt;/xs:extension&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:element name="agreedCapabilities" type="cap:agreedCapType"/&gt;
  &lt;xs:complexType name="agreedCapType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="monitor" type="xs:anyURI"/&gt;
          &lt;xs:element name="location"
                      type="cap:agreedCapLocationType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:element name="measurement"
                      type="cap:agreedCapMeasurementType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace="##any" processContents="lax"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:attributeGroup name="baseCapAttrs"&gt;
    &lt;xs:attribute name="id" type="xs:NCName" use="required"/&gt;
    &lt;xs:anyAttribute namespace="##local" processContents="strict"/&gt;
  &lt;/xs:attributeGroup&gt;

  &lt;xs:complexType name="agreedCapLocationType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace="##any" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attributeGroup ref="cap:baseCapAttrs"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="agreedCapMeasurementType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:any namespace="##any" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attribute name="type" type="xs:QName" use="optional"/&gt;
        &lt;xs:attributeGroup ref="cap:baseCapAttrs"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;!-- not included in agreedCapLocationType due to UPA --&gt;
  &lt;xs:element name="locationType" type="cap:locationTypeType"/&gt;
  &lt;xs:simpleType name="locationTypeType"&gt;
    &lt;xs:union&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="xs:token"&gt;
          &lt;xs:enumeration value="any"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="cap:locationTypeList"&gt;
          &lt;xs:minLength value="1"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
    &lt;/xs:union&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:simpleType name="locationTypeList"&gt;
    &lt;xs:list&gt;
      &lt;xs:simpleType&gt;
        &lt;xs:restriction base="xs:token"&gt;
          &lt;xs:enumeration value="civic"/&gt;
          &lt;xs:enumeration value="geodetic"/&gt;
        &lt;/xs:restriction&gt;
      &lt;/xs:simpleType&gt;
    &lt;/xs:list&gt;
  &lt;/xs:simpleType&gt;

  &lt;xs:element name="invokeCapabilities" type="cap:invokeCapType"/&gt;
  &lt;xs:complexType name="invokeCapType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="xs:anyType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="location"
                      type="cap:invokeCapLocationType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:element name="measurement"
                      type="cap:invokeCapMeasurementType"
                      minOccurs="0" maxOccurs="unbounded"/&gt;
          &lt;xs:any namespace="##other" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:anyAttribute namespace="##any" processContents="lax"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:attributeGroup name="invokeTimeGroup"&gt;
    &lt;xs:attribute name="before" type="xs:dateTime" use="required"/&gt;
    &lt;xs:attribute name="periodic" type="xs:positiveInteger"
                  use="optional"/&gt;
  &lt;/xs:attributeGroup&gt;

  &lt;xs:complexType name="invokeCapLocationType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="cap:agreedCapLocationType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="push" type="xs:anyURI"/&gt;
          &lt;xs:any namespace="##any" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attributeGroup ref="cap:invokeTimeGroup"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

  &lt;xs:complexType name="invokeCapMeasurementType"&gt;
    &lt;xs:complexContent&gt;
      &lt;xs:restriction base="cap:agreedCapMeasurementType"&gt;
        &lt;xs:sequence&gt;
          &lt;xs:element name="push" type="xs:anyURI"/&gt;
          &lt;xs:any namespace="##any" processContents="lax"
                  minOccurs="0" maxOccurs="unbounded"/&gt;
        &lt;/xs:sequence&gt;
        &lt;xs:attributeGroup ref="cap:invokeTimeGroup"/&gt;
        &lt;xs:attribute name="samples" type="xs:positiveInteger"
                      use="optional" default="1"/&gt;
      &lt;/xs:restriction&gt;
    &lt;/xs:complexContent&gt;
  &lt;/xs:complexType&gt;

&lt;/xs:schema&gt;
</pre></div>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgements</h3>

<p>Richard Barnes provided useful input on the state management mechanisms that are used in this document.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-geopriv-http-location-delivery">[I-D.ietf-geopriv-http-location-delivery]</a></td>
<td class="author-text">Barnes, M., Winterbottom, J., Thomson, M., and B. Stark, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-http-location-delivery-16.txt">HTTP Enabled Location Delivery (HELD)</a>,&rdquo; draft-ietf-geopriv-http-location-delivery-16 (work in progress), August&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-http-location-delivery-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-geopriv-lis-discovery">[I-D.ietf-geopriv-lis-discovery]</a></td>
<td class="author-text">Thomson, M. and J. Winterbottom, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-lis-discovery-15.txt">Discovering the Local Location Information Server (LIS)</a>,&rdquo; draft-ietf-geopriv-lis-discovery-15 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-lis-discovery-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.loreto-http-timeout">[I-D.loreto-http-timeout]</a></td>
<td class="author-text">Loreto, S., Thomson, M., and G. Wilkins, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-loreto-http-timeout-00.txt">Hypertext Transfer Protocol (HTTP) Timeouts</a>,&rdquo; draft-loreto-http-timeout-00 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-loreto-http-timeout-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.saintandre-tls-server-id-check">[I-D.saintandre-tls-server-id-check]</a></td>
<td class="author-text">Saint-Andre, P. and J. Hodges, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-tls-server-id-check-06.txt">Representation and Verification of Domain-Based Application Server Identity in Certificates Used with Transport Layer Security</a>,&rdquo; draft-saintandre-tls-server-id-check-06 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-tls-server-id-check-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.thomson-geopriv-held-measurements">[I-D.thomson-geopriv-held-measurements]</a></td>
<td class="author-text">Thomson, M. and J. Winterbottom, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-held-measurements-06.txt">Using Device-provided Location-Related Measurements in Location Configuration Protocols</a>,&rdquo; draft-thomson-geopriv-held-measurements-06 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-held-measurements-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.winterbottom-geopriv-deref-protocol">[I-D.winterbottom-geopriv-deref-protocol]</a></td>
<td class="author-text">Winterbottom, J., Tschofenig, H., Schulzrinne, H., Thomson, M., and M. Dawson, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-winterbottom-geopriv-deref-protocol-05.txt">A Location Dereferencing Protocol Using HELD</a>,&rdquo; draft-winterbottom-geopriv-deref-protocol-05 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-winterbottom-geopriv-deref-protocol-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3688.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.barnes-geopriv-policy-uri">[I-D.barnes-geopriv-policy-uri]</a></td>
<td class="author-text">Barnes, R., Thomson, M., and J. Winterbottom, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-barnes-geopriv-policy-uri-01.txt">Location Configuration Extensions for Policy Management</a>,&rdquo; draft-barnes-geopriv-policy-uri-01 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-barnes-geopriv-policy-uri-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-geopriv-arch">[I-D.ietf-geopriv-arch]</a></td>
<td class="author-text">Barnes, R., Lepinski, M., Cooper, A., Morris, J., Tschofenig, H., and H. Schulzrinne, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-arch-02.txt">An Architecture for Location and Location Privacy in Internet Applications</a>,&rdquo; draft-ietf-geopriv-arch-02 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-geopriv-arch-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.loreto-http-bidirectional">[I-D.loreto-http-bidirectional]</a></td>
<td class="author-text">Loreto, S., Saint-Andre, P., Salsano, S., and G. Wilkins, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-loreto-http-bidirectional-02.txt">Best Practices for the Use of Long Polling and Streaming in Bidirectional HTTP</a>,&rdquo; draft-loreto-http-bidirectional-02 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-loreto-http-bidirectional-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.thomson-geopriv-uncertainty">[I-D.thomson-geopriv-uncertainty]</a></td>
<td class="author-text">Thomson, M. and J. Winterbottom, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-uncertainty-05.txt">Representation of Uncertainty and Confidence in PIDF-LO</a>,&rdquo; draft-thomson-geopriv-uncertainty-05 (work in progress), May&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-thomson-geopriv-uncertainty-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2141">[RFC2141]</a></td>
<td class="author-text"><a href="mailto:jayhawk@ds.internic.net">Moats, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2141">URN Syntax</a>,&rdquo; RFC&nbsp;2141, May&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2141.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2141.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2141.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5808">[RFC5808]</a></td>
<td class="author-text">Marshall, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5808">Requirements for a Location-by-Reference Mechanism</a>,&rdquo; RFC&nbsp;5808, May&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5808.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martin Thomson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Building (39)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong University Campus</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Northfields Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong, NSW  2522</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AU</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:martin.thomson@andrew.com">martin.thomson@andrew.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">James Winterbottom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Andrew Building (39)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong University Campus</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Northfields Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wollongong, NSW  2522</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AU</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:james.winterbottom@andrew.com">james.winterbottom@andrew.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mary Barnes</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Polycom</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mary.ietf.barnes@gmail.com">mary.ietf.barnes@gmail.com</a></td></tr>
</table>
</body></html>
