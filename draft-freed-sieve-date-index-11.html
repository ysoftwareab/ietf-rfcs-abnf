<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Email Filtering: 
Date and Index Extensions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Email Filtering: 
Date and Index Extensions">
<meta name="keywords" content="RFC, Request for Comments, SMTP, ESMTP, Sieve, I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">N. Freed</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Sun Microsystems</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">April 21, 2008</td></tr>
<tr><td class="header">Expires: October 23, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Sieve Email Filtering: 
Date and Index Extensions<br />draft-freed-sieve-date-index-11</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 23, 2008.</p>

<h3>Abstract</h3>

<p>
This document describes the "date" and "index" extensions to the Sieve email
filtering language.  The "date" extension gives Sieve
the ability to test date and time values in various ways.
The "index" extension provides a means to limit header and address
tests to specific instances of header fields when header fields
are repeated.

</p>
<h3>Change History (to be removed prior to publication as an RFC)</h3>

<p>
Changed usage from Julian Days to Modified Julian Days. This has
the advantage that the number are smaller and day numbers change at midnight
rather than at noon.

</p>
<p>
Added the ability to return the day of the week.

</p>
<p>
Use the term "argument" instead of "parameter" throughout.

</p>
<p>
Added a "std11" part type as a means to operate on values formatted
in the same way as a Date: header field.

</p>
<p>
Changed the terminology from "part" to "date-part".

</p>
<p>
Updated reference to 3028bis, corrected miscellaneous typos.

</p>
<p>
Updated the IANA registration templates.

</p>
<p>
Added "time" and "date" as possible date-part values with appropriate
syntax.

</p>
<p>
Restricted allowed ISO 8601 formats so that comparisons will
be reliable.

</p>
<p>
Changed the date-part "timezone" to "zone" to make it consistent with the
:zone parameter.

</p>
<p>
Removed the reference to structured header fields in the description of the
date test.

</p>
<p>
Added a paragraph to make it clear that :index counts header fields, not
the contents of header fields.

</p>
<p>
Allow leap seconds.

</p>
<p>
Added :originalzone parameter to date test.

</p>
<p>
Added several examples.

</p>
<p>
Made the specification of :last without :index an error, aligning this
specification with editheader.

</p>
<p>
Added some security considerations text about the impact of currentdate
on script analysis.

</p>
<p>
Updated references to recently published RFCs.

</p>
<p>
Clarified that date tests must return false for dates that aren't
valid according to the calendar system.

</p>
<p>
Correct erroneous reference to Julian calendar dates - should be Gregorian
instead.

</p>
<p>
Clarified that "std11" isn't really intended to be used in comparison operations
and added an example of using "std11" to insert a date/time in a header field.

</p>
<p>
Added an appendix giving sample code to convert to and from modified Julian
date values.

</p>
<p>
Simplified the requirements for extracting date information from header
fields.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#anchor1">3.</a>&nbsp;
Capability Identifiers<br />
<a href="#anchor2">4.</a>&nbsp;
Date Test<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.1.</a>&nbsp;
Zone and Originalzone Arguments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.2.</a>&nbsp;
Date-part Argument<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.3.</a>&nbsp;
Comparator Interactions With Date-part Arguments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dateexamples">4.4.</a>&nbsp;
Examples<br />
<a href="#currentdate">5.</a>&nbsp;
Currentdate Test<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#currentdateexamples">5.1.</a>&nbsp;
Examples<br />
<a href="#index">6.</a>&nbsp;
Index Extension<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#indexexamples">6.1.</a>&nbsp;
Examples<br />
<a href="#security">7.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#julianconversion">Appendix&nbsp;A.</a>&nbsp;
Julian Date Conversions<br />
<a href="#anchor8">Appendix&nbsp;B.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Sieve <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> is a language for filtering email
messages at or around the time of final delivery.  It is designed to be
implementable on either a mail client or mail server.  It is meant to be
extensible, simple, and independent of access protocol, mail architecture,
and operating system.  It is suitable for running on a mail server where users
may not be allowed to execute arbitrary programs, such as on black box
Internet Message Access Protocol <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a> servers, as it has no
user-controlled loops or the ability to run external programs.

</p>
<p>
The "date" extension provides a new date test to extract and match 
date/time information from structured header fields.
The date test is similar in concept to the
address test specified in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
which performs similar operations on addresses in header fields.

</p>
<p>
The "date" extension also provides a currentdate test that operates on the
date and time when the Sieve script is executed.

</p>
<p>
Some header fields containing date/time information, e.g. Received:, naturally
occur more than one in a single header. In such cases it is useful to be able
to restrict the date test to some subset of the fields that are present. For
example, it may be useful to apply a date test to the last (earliest)
Received: field. Additionally, it may also be useful to apply similar restrictions
to either the header or address tests specified in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>. 

</p>
<p>
For this reason this specification also defines an "index" extension. This
extension adds two additional tagged arguments :index and :last to the header,
address, and date tests. If present these arguments specify which occurrence
of the named header field is to be tested. 

</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].

</p>
<p>
The terms used to describe the various components of the Sieve
language are taken from <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> section 1.1. A
syntactic element defined using ABNF notation <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>
in <a class='info' href='#RFC3339'>[RFC3339]<span> (</span><span class='info'>Klyne, G., Ed. and C. Newman, &ldquo;Date and Time on the Internet: Timestamps,&rdquo; July&nbsp;2002.</span><span>)</span></a> is also used here.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Capability Identifiers</h3>

<p>
The capability strings associated with the two extensions defined in this
document are "date" and "index".

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Date Test</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Usage:   date [&lt;":zone" &lt;time-zone: string&gt;&gt; / ":originalzone"]
              [COMPARATOR] [MATCH-TYPE] &lt;header-name: string&gt;
              &lt;date-part: string&gt; &lt;key-list: string-list&gt;
</pre></div>
<p>
The date test matches date/time information derived from headers
containing <a class='info' href='#RFC2822'>[RFC2822]<span> (</span><span class='info'>Resnick, P., &ldquo;Internet Message Format,&rdquo; April&nbsp;2001.</span><span>)</span></a> date-time
values. The date/time information is extracted from the header, shifted to
the specified time zone, and the value of the given date-part is determined.
The test returns true if the resulting string matches any of the
strings specified in the key-list, as controlled by the comparator and match
keywords. The date test returns false unconditionally if the specified header
field does not exist, the field exists but does not contain a syntactically
valid date-time specification, the date-time isn't valid according to the
rules of the calendar system (e.g., January 32nd, February 29 in a non-leap
year), or the resulting string fails to match any key-list value.

</p>
<p>
The type of match
defaults to ":is" and the default comparator is "i;ascii-casemap".

</p>
<p>
Unlike the header and address tests, the date test can only be applied
to a single header field at a time. If multiple header fields with the
same name are present only the first field that is found is used. (Note,
however, that this behavior can be modified with the "index" extension
defined below.)

</p>
<p>
The "relational" extension <a class='info' href='#RFC5231'>[RFC5231]<span> (</span><span class='info'>Segmuller, W. and B. Leiba, &ldquo;Sieve Email Filtering: Relational Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> adds a match
type called ":count".  The count of a date test is 1 if the specified field
exists and contains a valid date, zero otherwise.

</p>
<p>
Implementations MUST support extraction of RFC 2822 date-time information that
either makes up the entire header field (e.g., as it does in a standard
Date: header field) and date-time information that appears at the end of
a header field following a semicolon (e.g., as it does in a standard Received:
header field). Implementations MAY support extraction of date and time
information in RFC2822 or other formats that
appears in other positions in header field content. In the case of a field
containing more than one date or time value the last one that appears should
be used.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Zone and Originalzone Arguments</h3>

<p>
The :originalzone argument specifies that the time zone originally in the
extracted date-time value should be retained. The :zone argument specifies
a specific time zone offset the date-time value is to be shifted to prior to
testing. It is an error to specify both :zone and :originalzone.

</p>
<p>
The value of time-zone MUST be an offset relative to
UTC with the following syntax:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    time-zone  =  ( "+" / "-" ) 4DIGIT
</pre></div>
<p>
If both the :zone and :originalzone arguments are omitted the local time zone
MUST be used.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Date-part Argument</h3>

<p>
The date-part argument specifies a particular part of the resulting date/time
value to match against the key-list. Possible values are:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  "year"      =&gt; the year, "0000" .. "9999".
  "month"     =&gt; the month, "01" .. "12".
  "day"       =&gt; the day, "01" .. "31".
  "date"      =&gt; the date in "yyyy-mm-dd" format.
  "julian"    =&gt; the Modified Julian Day, that is, the date
                 expressed as an integer number of days since
                 00:00 UTC on November 17, 1858 (using the Gregorian
                 calendar). This corresponds to the regular
                 Julian Day minus 2400000.5. Sample routines to
                 convert to and from modified Julian dates are
                 given in Appendix A.
  "hour"      =&gt; the hour, "00" .. "23".
  "minute"    =&gt; the minute, "00" .. "59".
  "second"    =&gt; the second, "00" .. "60".
  "time"      =&gt; the time in "hh:mm:ss" format.
  "iso8601"   =&gt; the date and time in restricted ISO 8601 format.
  "std11"     =&gt; the date and time in a format appropriate
                 for use in a Date: header field [RFC2822].
  "zone"      =&gt; the time zone in use.  If the user specified a
                 time zone with ":zone", "zone" will
                 contain that value.  If :originalzone is specified
                 this value will be the original zone specified
                 in the date-time value. If neither arugment is
                 specified the value will be the server's default
                 time zone in offset format "+hhmm" or "-hhmm". An
                 offset of 0 (Zulu) always has a positive sign.
  "weekday"   =&gt; the day of the week expressed as an integer between
                 "0" and "6". "0" is Sunday, "1" is Monday, etc.
</pre></div>
<p>
The restricted ISO 8601 format is specified by the date-time ABNF
production given in <a class='info' href='#RFC3339'>[RFC3339]<span> (</span><span class='info'>Klyne, G., Ed. and C. Newman, &ldquo;Date and Time on the Internet: Timestamps,&rdquo; July&nbsp;2002.</span><span>)</span></a> section 5.6, with
the added restrictions that the letters "T" and "Z" MUST be in
upper case and a time zone offset of zero MUST be represented by
"Z" and not "+00:00".

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Comparator Interactions With Date-part Arguments</h3>

<p>
Not all comparators are suitable with all date-part arguments. In 
general, the date-parts can be compared and tested for equality with 
either "i;ascii-casemap" (the default) or "i;octet", but there are 
two exceptions:

</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>julian</dt>
<dd>
This is an integer, and may or may not 
have leading zeros. As such, "i;ascii-numeric" is almost
certainly the best comparator to use with it.

</dd>
<dt>std11</dt>
<dd>
"std11" is provided as a means to obtain date/time values in a format appropriate
for inclusion in email header fields. The wide range of possible syntaxes for
a std11 date/time - which implementations of this extension are free to use
when composing a std11 string - makes this format a poor choice for comparisons.
Nevertheless, if a comparison must be performed, this is case-insensitive, and
therefore "i;ascii-casemap"  needs to be used.

</dd>
</dl></blockquote><p>

</p>
<p>
"year", "month", "day", "date", "hour", "minute", "second" and 
"weekday" all use fixed-width string representations of integers, and 
can therefore be compared with "i;octet", "i;ascii-casemap", and 
"i;ascii-numeric" with equivalent results.

</p>
<a name="dateexamples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Examples</h3>

<p>
The Date: field can be checked to test when the sender claims to
have created the message and act accordingly:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  require ["date", "relational", "fileinto"];
  if allof(header :is "from" "boss@example.com",
           date :value "ge" :originalzone "date" "hour" "09",
           date :value "lt" :originalzone "date" "hour" "17")
  { fileinto "urgent"; }
</pre></div>
<p>
Testing the initial Received: field can provide an indication of when a message
was actually received by the local system:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  require ["date", "relational", "fileinto"];
  if anyof(date :is "received" "weekday" "0",
           date :is "received" "weekday" "6")
  { fileinto "weekend"; }
</pre></div>
<a name="currentdate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Currentdate Test</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Usage:   currentdate [":zone" &lt;time-zone: string&gt;]
                     [COMPARATOR] [MATCH-TYPE]
                     &lt;date-part: string&gt;
                     &lt;key-list: string-list&gt;
</pre></div>
<p>
The currentdate test is similar to the date test, except that it
operates on the current date/time rather than a value extracted from
the message header. In particular, the ":zone" and date-part
arguments are the same as those in the date test.

</p>
<p>
All currentdate tests in a single Sieve script 
MUST refer to the same point in time during execution of the script.

</p>
<p>
The :count value of a currentdate test is always 1.

</p>
<a name="currentdateexamples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Examples</h3>

<p>
The simplest use of currentdate is to have an action that only
operates at certain times. For example, a user might want to
have messages redirected to their pager after business hours and on
weekends:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  require ["date", "relational"];
  if anyof(currentdate :is "weekday" "0",
           currentdate :is "weekday" "6",
           currentdate :value "lt" "hour" "09",
           currentdate :value "ge" "hour" "17")
  { redirect pager@example.com"; }
</pre></div>
<p>
Currentdate can be used to set up vacation 
<a class='info' href='#RFC5230'>[RFC5230]<span> (</span><span class='info'>Showalter, T. and N. Freed, &ldquo;Sieve Email Filtering: Vacation Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> responses in advance and to
stop response generation automatically:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  require ["date", "relational", "vacation"];
  if allof(currentdate :value "ge" "date" "2007-06-30",
           currentdate :value "le" "date" "2007-07-07")
  { vacation :days 7  "I'm away during the first week in July."; }
</pre></div>
<p>
Currentdate may also be used in conjunction with the variables
extension to pass time-dependent arguments to other tests and
actions. The following Sieve places messages in a folder named
according to the current month and year:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  require ["date", "variables", "fileinto"];
  if currentdate :matches "month" "*" { set "month" "${1}"; }
  if currentdate :matches "year"  "*" { set "year"  "${1}"; }
  fileinto "${month}-${year}";
</pre></div>
<p>
Finally, currentdate can be used in conjunction with the editheader
extension to insert a header-field containing date/time information:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   require ["variables", "date", "editheader"];
   if currentdate :matches "std11" "*"
     {addheader "Processing-date" "${0}";}
</pre></div>
<a name="index"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Index Extension</h3>

<p>
The "index" extension, if specified, adds optional :index and :last
arguments to the header, address, and date tests as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Syntax:   date [":index" &lt;fieldno: number&gt; [":last"]]
               [&lt;":zone" &lt;time-zone: string&gt;&gt; / ":originalzone"]
               [COMPARATOR] [MATCH-TYPE] &lt;header-name: string&gt;
               &lt;date-part: string&gt; &lt;key-list: string-list&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Syntax:   header [":index" &lt;fieldno: number&gt; [":last"]]
                 [COMPARATOR] [MATCH-TYPE]
                 &lt;header-names: string-list&gt; &lt;key-list: string-list&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Syntax:   address [":index" &lt;fieldno: number&gt; [":last"]]
                  [ADDRESS-PART] [COMPARATOR] [MATCH-TYPE]
                  &lt;header-list: string-list&gt; &lt;key-list: string-list&gt;
</pre></div>
<p>
If :index &lt;fieldno&gt; is specified, the attempts to match 
a value are limited to the header field fieldno (beginning
at 1, the first named header field).  If :last is also specified,
the count is backwards; 1 denotes the last named header field,
2 the second to last, and so on. Specifying :last without :index
is an error.

</p>
<p>
:index only counts separate header fields, not multiple occurences within
a single field. In particular, :index cannot be used to test a specific
address in an address list contained within a single header field.

</p>
<p>
Both header and address allow the specification of more than one
header field name. If more than one header field name is specified
all the named header fields are counted in the order specified by the
header-list.

</p>
<a name="indexexamples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Examples</h3>

<p>
Mail delivery may involve multiple hops, resulting in the Received: field
containing information about when a message first entered the local
administrative domain being the second or subsequent field in the message.
As long as the field offset is consistent it can be tested:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  # Implement the Internet-draft cutoff date check assuming the
  # second Received: field specifies when the message first
  # entered the local email infrastructure.
  require ["date", "relational", "index"];
  if date :value "gt" :index 2 :zone "-0500" "received"
          "iso8601" "2007-02-26T09:00:00-05:00",
  { redirect "aftercutoff@example.org"; }
</pre></div>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
The facilities defined here, like the facilities in the base
Sieve specification, operate on message header information which
can easily be forged. Note, however, that some fields are
inherently more reliable than others. For example, the Date: field
is typically inserted by the message sender and can be altered at
any point. By contrast, the uppermost Received: field is typically
inserted by the local mail system and is therefore difficult for the
sender or an intermediary to falsify.

</p>
<p>
Use of the currentdate test makes script behavior inherently less
predictable and harder to analyze. This may have consequences for systems
that use script analysis to try and spot problematic scripts.

</p>
<p>
All of the security considerations given in the base Sieve
specification also apply to these extensions. 

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>
The following templates specify the IANA registrations of the two Sieve
extensions specified in this document:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   To: iana@iana.org
   Subject: Registration of new Sieve extensions

   Capability name: date
   Description:     The "date" extension gives Sieve the ability
                    to test date and time values.
   RFC number:      RFC XXXX
   Contact address: Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Capability name: index
   Description:     The "index" extension provides a means to
                    limit header and address tests to specific
                    instances when more than one field of a
                    given type is present.
   RFC number:      RFC XXXX
   Contact address: Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;
</pre></div>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CALGO199">[CALGO199]</a></td>
<td class="author-text">Tantzen, R., &ldquo;Algorithm 199: Conversions Between Calendar Date and Julian Day Number,&rdquo; Collected Algorithms from CACM&nbsp;199.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2822">[RFC2822]</a></td>
<td class="author-text">Resnick, P., &ldquo;<a href="http://tools.ietf.org/html/rfc2822">Internet Message Format</a>,&rdquo; RFC&nbsp;2822, April&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc2822.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3339">[RFC3339]</a></td>
<td class="author-text"><a href="mailto:GK@ACM.ORG">Klyne, G., Ed.</a> and <a href="mailto:chris.newman@sun.com">C. Newman</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3339">Date and Time on the Internet: Timestamps</a>,&rdquo; RFC&nbsp;3339, July&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3339.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3339.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3339.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5231">[RFC5231]</a></td>
<td class="author-text">Segmuller, W. and B. Leiba, &ldquo;<a href="http://tools.ietf.org/html/rfc5231">Sieve Email Filtering: Relational Extension</a>,&rdquo; RFC&nbsp;5231, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5231.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5230">[RFC5230]</a></td>
<td class="author-text">Showalter, T. and N. Freed, &ldquo;<a href="http://tools.ietf.org/html/rfc5230">Sieve Email Filtering: Vacation Extension</a>,&rdquo; RFC&nbsp;5230, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5230.txt">TXT</a>).</td></tr>
</table>

<a name="julianconversion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Julian Date Conversions</h3>

<p>
The following C routines show how to translate day/month/year
information to and from modified Julian dates. These routines are
straightforward
translations of the Algol routines specified in CACM Algorithm 199
<a class='info' href='#CALGO199'>[CALGO199]<span> (</span><span class='info'>Tantzen, R., &ldquo;Algorithm 199: Conversions Between Calendar Date and Julian Day Number,&rdquo; .</span><span>)</span></a>.

</p>
<p>
Given the day, month, and year, jday returns the modified Julian date.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
int jday(int year, int month, int day)
{
    int j, c, ya;

    if (month &gt; 2)
        month -= 3;
    else
    {
        month += 9;
        year--;
    }
    c = year / 100;
    ya = year - c * 100;
    return (c * 146097 / 4 + ya * 1461 / 4 + (month * 153 + 2) / 5 +
            day + 1721119);
}
</pre></div>
<p>
Given j, the modified Julian date, jdate returns the day, month, and year.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
void jdate(int j, int *year, int *month, int *day)
{
    int y, m, d;

    j -= 1721119;
    y = (j * 4 - 1) / 146097;
    j = j * 4 - y * 146097 - 1;
    d = j / 4;
    j = (d * 4 + 3) / 1461;
    d = d * 4 - j * 1461 + 3;
    d = (d + 4) / 4;
    m = (d * 5 - 3) / 153;
    d = d * 5 - m * 153 - 3;
    *day = (d + 5) / 5;
    *year = y * 100 + j;
    if (m &lt; 10)
        *month = m + 3;
    else
    {
        *month = m - 9;
        *year += 1;
    }
}
</pre></div>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Acknowledgements</h3>

<p>
Dave Cridland contributed the text describing the proper comparators
to use with different date-parts. Cyrus Daboo, Frank Ellerman, Alexey Melnikov,
Chris Newman, Dilyan Palauzov and Aaron Stone provided helpful suggestions and
corrections.

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ned Freed</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3401 Centrelake Drive, Suite 410</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ontario, CA  92761-1205</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 909 457 4293</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ned.freed@mrochek.com">ned.freed@mrochek.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
