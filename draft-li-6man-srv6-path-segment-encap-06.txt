



6man Working Group                                                 C. Li
Internet-Draft                                       Huawei Technologies
Intended status: Standards Track                                W. Cheng
Expires: November 9, 2021                                   China Mobile
                                                                  Y. Zhu
                                                           China Telecom
                                                                   Z. Li
                                                                D. Dhody
                                                     Huawei Technologies
                                                             May 8, 2021


                 Encapsulation of Path Segment in SRv6
                draft-li-6man-srv6-path-segment-encap-06

Abstract

   Segment Routing (SR) allows for a flexible definition of end-to-end
   paths by encoding an ordered list of instructions, called "segments".
   The SR architecture can be implemented over an IPv6 data plane,
   called SRv6.  In some use-cases such as end-to-end SR Path Protection
   and Performance Measurement (PM), an SRv6 path needs to be
   identified.  An SRv6 Path Segment can be used for identifying an SRv6
   path.  This document defines a P-flag in the Segment Routing Header
   to indicate the appearence of SRv6 Path Segment.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 9, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.




Li, et al.              Expires November 9, 2021                [Page 1]

Internet-Draft                 SRv6 P-bit                       May 2021


   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
     1.2.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Encoding of an SRv6 Path Segment  . . . . . . . . . . . . . .   3
     2.1.  SRH.P-flag  . . . . . . . . . . . . . . . . . . . . . . .   4
   3.  Processing of SRv6 Path Segment . . . . . . . . . . . . . . .   5
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   5
   6.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   6
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   6
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   6
     7.2.  Informative References  . . . . . . . . . . . . . . . . .   7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   7

1.  Introduction

   Segment routing (SR) [RFC8402] is a source routing paradigm that
   explicitly indicates the forwarding path for packets at the ingress
   node by inserting an ordered list of instructions, called segments.

   When segment routing is deployed on an IPv6 data plane, it is called
   SRv6, and it uses a new IPv6 [RFC8200] Routing Header (EH) called the
   IPv6 Segment Routing Header (SRH) [RFC8754] to construct an SRv6
   path.  As per [RFC8986], an SRv6 segment identifier is a 128-bit
   value.

   In several use cases, such as binding bidirectional path
   [I-D.ietf-pce-sr-bidir-path] and end-to-end performance measurement
   [I-D.gandhi-spring-twamp-srpm], the ability to implement path
   identification is a pre-requisite.

   An SRv6 path MAY be identified by the content of a segment list in
   the SRH.  However, the segment list may not be a good key, since the
   length of a segment list is flexible according to the number of
   required SIDs.  Also, the length of a segment list may be too long to
   be a key when it contains many SIDs.  For instance, if packet A uses



Li, et al.              Expires November 9, 2021                [Page 2]

Internet-Draft                 SRv6 P-bit                       May 2021


   an SRH with 3 SIDs while Packet B uses an SRH with 10 SIDs, the key
   to identify these two paths will be a 384-bits value and a 1280-bits
   value, respectively.  Furthermore, an SRv6 path cannot be identified
   by the information carried by the SRH in reduced mode [RFC8754] as
   the first SID is not present.  Also, different SRv6 policies may use
   the same segment list for different candidate paths, so the traffic
   of different SRv6 policies are merged, resulting in the inability to
   measure the performance of the specific path.  Therefore,
   [I-D.ietf-spring-srv6-path-segment] defines an SRv6 Path Segment to
   identify an SRv6 path.

   This document defines a P-bit in SRH to indicate the appearence of
   SRv6 Path Segment in SRH.

1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

1.2.  Terminology

   PM: Performance Measurement.

   SID: Segment ID.

   SL: Segment List.

   SR: Segment Routing.

   SRH: Segment Routing Header.

   PSID: Path Segment Identifier.

   PSP: Penultimate Segment Popping.

   Further, this document makes use of the terms defined in [RFC8402]
   and [RFC8986].

2.  Encoding of an SRv6 Path Segment

   This section describes the SRH encoding of an SRv6 Path Segment
   [I-D.ietf-spring-srv6-path-segment].






Li, et al.              Expires November 9, 2021                [Page 3]

Internet-Draft                 SRv6 P-bit                       May 2021


2.1.  SRH.P-flag

   As per [I-D.ietf-spring-srv6-path-segment], an SRv6 Path Segment is a
   128-bits value, and it MUST appear only once in a SID list, and it
   MUST appear as the last entry.

   To indicate the existence of a Path Segment in the SRH, this document
   defines a P-flag in the SRH flag field.  The encapsulation of SRv6
   Path Segment is shown below.

           0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Next Header   |  Hdr Ext Len  | Routing Type  | Segments Left |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Last Entry   |     Flags   |P|              Tag              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |            Segment List[0] (128 bits IPv6 address)            |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                                                               |
                                     ...
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |          Segment List[n-1] (128 bits IPv6 address)            |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |    SRv6 Path Segment (Segment List[n],128 bits IPv6 value)    |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       //                                                             //
       //         Optional Type Length Value objects (variable)       //
       //                                                             //
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 1. SRv6 Path Segment in SID List

   o  P-bit: set when SRv6 Path Segment is inserted.  It MUST be ignored
      when a node does not support SRv6 Path Segment processing.




Li, et al.              Expires November 9, 2021                [Page 4]

Internet-Draft                 SRv6 P-bit                       May 2021


   SRH.P-bit processing can be enabled or disabled by configuration on
   devices, it can be done by CLI, NETCONF YANG or other ways, and this
   is out of the scope of this document.

   The pseudo code of SRH.P-bit processing is described as below.

       S01.  if SRH.P-flag processing is enabled:
       S02.     if SRH.P-flag is set:
       S03.        SRv6 Path Segment processing       ;;ref1


   Ref1: The SRv6 Path Segment processing is accosiated with the
   specific application, such as SRv6 Path Segment based Performance
   measurement, and this is out of the scope of this document.

   In some use cases, only the egress need to process the SRv6 Path
   Segment, therefore, the P-bit processing can be done at the egress
   node only while the intermediate nodes do not need to process it.
   This feature can be enabled by configuration like CLI , NETCONF YANG
   or other ways.  In this case, the pseudo code is described as below.

       S01.  if SRH.P-flag processing is enabled:
       S02.    if intermediate node processing is disabled:
       S03.        if SRH.P-flag is set and SRH.SL == 0:
       S03.            SRv6 Path Segment processing
       S04     else:
       S05.        if SRH.P-flag is set:
       S06.            SRv6 Path Segment processing


3.  Processing of SRv6 Path Segment

   The processing of SRv6 path segment is out of the scope of this
   document and is defined in [I-D.ietf-spring-srv6-path-segment].

4.  IANA Considerations

   This document requests IANA to allocate bit position TBA within the
   "Segment Routing Header Flags" registry defined in [RFC8402].

5.  Security Considerations

   TBA








Li, et al.              Expires November 9, 2021                [Page 5]

Internet-Draft                 SRv6 P-bit                       May 2021


6.  Acknowledgements

   TBA

7.  References

7.1.  Normative References

   [I-D.ietf-spring-srv6-path-segment]
              Li, C., Cheng, W., Chen, M., Dhody, D., and R. Gandhi,
              "Path Segment for SRv6 (Segment Routing in IPv6)", draft-
              ietf-spring-srv6-path-segment-00 (work in progress),
              November 2020.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8200]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", STD 86, RFC 8200,
              DOI 10.17487/RFC8200, July 2017,
              <https://www.rfc-editor.org/info/rfc8200>.

   [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,
              Decraene, B., Litkowski, S., and R. Shakir, "Segment
              Routing Architecture", RFC 8402, DOI 10.17487/RFC8402,
              July 2018, <https://www.rfc-editor.org/info/rfc8402>.

   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,
              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header
              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,
              <https://www.rfc-editor.org/info/rfc8754>.

   [RFC8986]  Filsfils, C., Ed., Camarillo, P., Ed., Leddy, J., Voyer,
              D., Matsushima, S., and Z. Li, "Segment Routing over IPv6
              (SRv6) Network Programming", RFC 8986,
              DOI 10.17487/RFC8986, February 2021,
              <https://www.rfc-editor.org/info/rfc8986>.








Li, et al.              Expires November 9, 2021                [Page 6]

Internet-Draft                 SRv6 P-bit                       May 2021


7.2.  Informative References

   [I-D.gandhi-spring-twamp-srpm]
              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.
              Janssens, "Performance Measurement Using TWAMP Light for
              Segment Routing Networks", draft-gandhi-spring-twamp-
              srpm-11 (work in progress), October 2020.

   [I-D.ietf-idr-sr-policy-path-segment]
              Li, C., Li, Z., Chen, H., Cheng, W., and K. Talaulikar,
              "SR Policy Extensions for Path Segment and Bidirectional
              Path", draft-ietf-idr-sr-policy-path-segment-03 (work in
              progress), March 2021.

   [I-D.ietf-pce-sr-bidir-path]
              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,
              "Path Computation Element Communication Protocol (PCEP)
              Extensions for Associated Bidirectional Segment Routing
              (SR) Paths", draft-ietf-pce-sr-bidir-path-05 (work in
              progress), January 2021.

   [I-D.ietf-pce-sr-path-segment]
              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,
              "Path Computation Element Communication Protocol (PCEP)
              Extension for Path Segment in Segment Routing (SR)",
              draft-ietf-pce-sr-path-segment-03 (work in progress),
              February 2021.

   [I-D.ietf-spring-segment-routing-policy]
              Filsfils, C., Talaulikar, K., Voyer, D., Bogdanov, A., and
              P. Mattes, "Segment Routing Policy Architecture", draft-
              ietf-spring-segment-routing-policy-11 (work in progress),
              April 2021.

Authors' Addresses

   Cheng Li
   Huawei Technologies

   Email: c.l@huawei.com


   Weiqiang Cheng
   China Mobile

   Email: chengweiqiang@chinamobile.com





Li, et al.              Expires November 9, 2021                [Page 7]

Internet-Draft                 SRv6 P-bit                       May 2021


   Yongqing Zhu
   China Telecom
   Guangzhou

   Email: zhuyq8@chinatelecom.cn


   Zhenbin Li
   Huawei Technologies
   Huawei Campus, No. 156 Beiqing Rd.
   Beijing  100095
   China

   Email: lizhenbin@huawei.com


   Dhruv Dhody
   Huawei Technologies
   Divyashree Techno Park, Whitefield
   Bangalore  560066
   India

   Email: dhruv.ietf@gmail.com




























Li, et al.              Expires November 9, 2021                [Page 8]
