<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Diameter Support for Proxy Mobile IPv6 Localized Routing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Diameter Support for Proxy Mobile IPv6 Localized Routing">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">G. Zorn, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Network Zen</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Q. Wu, Ed.</td></tr>
<tr><td class="header">Expires: August 25, 2010</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Liebsch </td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NEC</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Korhonen </td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NSN</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 21, 2010</td></tr>
</table></td></tr></table>
<h1><br />Diameter Support for Proxy Mobile IPv6 Localized Routing<br />draft-ietf-dime-pmip6-lr-00</h1>

<h3>Abstract</h3>

<p>
				In Proxy Mobile IPv6, packets received from a Mobile Node (MN) by the
				Mobile Access Gateway (MAG) to which it is attached are typically
				tunneled to a Local Mobility Anchor (LMA) for routing. The term
				"localized routing" refers to a method by which packets are routed
				directly by the MAG without involving the LMA. In order to establish a
				localized routing session between two Mobile Access Gateways in a Proxy
				Mobile IPv6 domain, two tasks must be accomplished:
				</p>
<ol class="text">
<li>
						The usage of local routing must be authorized for both MAGs
						and
					
</li>
<li>
						The address of the MAG to which the Correspondent Node (CN) is
						attached must be ascertained
					
</li>
</ol><p>
				This document specifies how to accomplish these tasks using the
				Diameter protocol.
			
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 25, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Solution Overview<br />
<a href="#anchor4">4.</a>&nbsp;
Localized Routing Service Authorization<br />
<a href="#anchor5">5.</a>&nbsp;
Diameter Server Authorizes MAG Location Query<br />
<a href="#anchor6">6.</a>&nbsp;
Local Routing Service Authorization in Networks with Multiple AAA Servers<br />
<a href="#Security">7.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor7">9.</a>&nbsp;
Contributors<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
				<a class='info' href='#RFC5213'>Proxy Mobile IPv6 (PMIPv6)<span> (</span><span class='info'>Gundavelli, S., Leung, K., Devarapalli, V., Chowdhury, K., and B. Patil, &ldquo;Proxy Mobile IPv6,&rdquo; August&nbsp;2008.</span><span>)</span></a> [RFC5213] 
				allows the
				Mobility Access Gateway to optimize media delivery by locally routing
				packets within itself, avoiding tunneling them to the Mobile Node's
				Local Mobility Anchor. This is referred to as "local routing" in RFC
				5213. However, this mechanism is not applicable to the typical scenario
				in which the MN and CN are connected to different MAGs and are registered to different
				LMAs. 
				In this scenario (<a class='info' href='#I-D.ietf-netext-pmip6-lr-ps'>as
				described in<span> (</span><span class='info'>Liebsch, M., Jeong, S., and W. Wu, &ldquo;PMIPv6 Localized Routing Problem Statement,&rdquo; January&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;netext&#8209;pmip6&#8209;lr&#8209;ps]), the relevant information needed to set up a
				localized routing path (e.g., the addresses of the Mobile Access Gateways to which the MN
				and CN are respectively attached) is distributed between their
				respective Local Mobility Anchors. This may complicate the setup and
				maintenance of localized routing.
				<br />
<br />
 
				Therefore, in
				order to establish a localized routing path between the two Mobile
				Access Gateways, the Mobile Node's MAG must identify the LMA that is
				managing the Correspondent Node's traffic and then obtain the address of
				the Correspondent Node's MAG from that LMA. 
				In Proxy Mobile IPv6, the
				LMA to be assigned to the CN may be maintained as a configured entry in the
				Correspondent Node's policy profile located on an Authentication,
				Authorization and Accounting (AAA) server. 
				However, there is no relevant
				work discussing how AAA-based mechanisms can be used by the Mobile
				Node's MAG to discover the address of the Correspondent Node's LMA
				during the setup of localized routing,
				The method by which the Mobile Node's MAG interacts with the
				Correspondent Node's LMA to identify the Correspondent Node's MAG is
				also unspecified.
				<br />
<br />
 
				This document describes AAA
				support for the authorization and discovery of PMIPv6 mobility entities
				during localized routing. In LMA discovery, Diameter
				<a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>
				is used to authorize the localized routing
				service and provide the Mobile Node's MAG/LMA with information regarding
				the Correspondent Node's LMA. In MAG discovery, AAA is used to determine
				whether Mobile Node's MAG is allowed to fetch the address of the
				Correspondent Node's MAG from the Correspondent Node's LMA. If MAG
				discovery is successful, the Correspondent Node's LMA will respond
				to the Mobile Node's MAG with the address of the Correspondent Node's
				MAG.
			
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
				The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
				"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
				document are to be interpreted as described in 
				<a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
			
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Solution Overview</h3>

<p>
				MAG/LMA resolution is a prerequisite to the establishment of a direct
				routing path between MAG1 and MAG2 (associated with MN1 and MN2
				respectively).
				This document addresses how to resolve the destination
				MN’s MAG by means of interaction between the LMA and the AAA server.
				<a class='info' href='#ref_arch'>Figure&nbsp;1<span> (</span><span class='info'>Local Routing Service Authorization Reference Architecture</span><span>)</span></a> shows the reference architecture for
				Local Routing Service Authorization. This reference architecture assumes
				</p>
<ul class="text">
<li>
						MN1 and MN2 belong to different LMAs
					
</li>
<li>
						the MAG and LMA support Diameter client functionality
					
</li>
</ul><p> 
<br /><hr class="insert" />
<a name="ref_arch"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                     +---------+
          LMA2?      |  AAA &amp;  |
             +------&gt;| Policy  |&lt;----------+
             |       | Profile |           |
         Diameter    +---------+        Diameter
          AAA(a)                         AAA(b)
    LMA2? +--+-+             +----+        |
 +-------&gt;|LMA1|      +-----&gt;|LMA2|&lt;-------+
 |        +----+      |      +----+
 |          |         |        |
 |         //         |        \\
PMIP      //         PMIP       \\
 |       //           |          \\
 |       |            |           |
 |     +----+  MAG2?  |         +----+
 +----&gt;|MAG1|&lt;--------+         |MAG2|
       +----+                   +----+
          :                        :
       +---+                     +---+
       |MN1|                     |MN2|
       +---+                     +---+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Local Routing Service Authorization Reference Architecture&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
 
				The interaction of the MAG and LMA with the AAA server is a
				two step procedure involving 
					</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>
							The LMA1 interaction with the AAA server is used to authorize the
							localized routing service and fetch the IP address of LMA2 from the
							AAA server (<a class='info' href='#ref_arch'>step 'a' in<span> (</span><span class='info'>Local Routing Service Authorization Reference Architecture</span><span>)</span></a>)
						
</dd>
<dt>b.</dt>
<dd>
							LMA2 interaction with the AAA server is used to determine whether
							MAG1 is allowed to obtain the IP address of MAG2 
							(<a class='info' href='#ref_arch'>step 'b' in<span> (</span><span class='info'>Local Routing Service Authorization Reference Architecture</span><span>)</span></a>)
						
</dd>
</dl></blockquote><p>
				
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Localized Routing Service Authorization</h3>

<p>
					<a class='info' href='#fig2'>Figure&nbsp;2<span> (</span><span class='info'>MAG-initiated Localized Routing Authorization</span><span>)</span></a> shows a scenario where MAG1 acts as a
					Diameter client, processing the data packet from MN1 to MN2 and
					requesting authorization of localized routing. In this scenario, MN1 and
					MN2 are anchored to LMA1 and LMA2 respectively. In order to setup a
					localized routing path with MAG2, MAG1 must first locate the entity that
					maintains the data required to setup the path (i.e., LMA2) by sending a
					Local Routing Optimization Request message
					(<a class='info' href='#I-D.wu-netext-local-ro'>[I&#8209;D.wu&#8209;netext&#8209;local&#8209;ro]<span> (</span><span class='info'>Wu, W. and B. Sarikaya, &ldquo;An Extension to Proxy Mobile IPv6 for Local Routing Optimization,&rdquo; February&nbsp;2010.</span><span>)</span></a>) 
					to LMA1. 
					Note that the discovery of LMA2 is only done once; upon
					LMA1 know LMA2 address from AAA serer, LMA1 may associate LMA2 address
					with MN’s data for future use (e.g., handover case). The Diameter client
					in LMA1 sends an AA-Request (AAR) message to the Diameter server. The
					message contains an instance of the MIP6-Feature-Vector (MFV) AVP 
					(<a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a>, Section 4.2.5) with the INTER_MAG_ROUTING_SUPPORTED bit <a class='info' href='#IANA'>Section&nbsp;8<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>
					set
					and an instance of the MIP6-Home-Link-Prefix AVP
					(<a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a>, Section 4.2.4) containing the IP
					address of MN2.
					<br />
<br />

					The Diameter server checks if
					localized routing is allowed between MAG1 and MAG2 and if so, responds
					with an AA-Answer (AAA) message encapsulating an instance of the
					MIP6-Agent-Info AVP <a class='info' href='#I-D.ietf-dime-pmip6'>[I&#8209;D.ietf&#8209;dime&#8209;pmip6]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Chowdhury, K., Muhanna, A., and U. Meyer, &ldquo;Diameter Proxy Mobile IPv6: Mobile Access Gateway and Local Mobility Anchor Interaction with Diameter Server,&rdquo; September&nbsp;2009.</span><span>)</span></a>
					containing
					the IP address and/or Fully Qualified Domain Name (FQDN) of LMA2. LMA1
					then determines the IP address of LMA2 using the data returned in the
					MIP6-Agent-Info and responds to MAG1 with the address of LMA2. 
					MAG1 then
					requests the address of MAG2 from LMA2 and uses that address to setup
					the localized routing path between itself and MAG2 via a Proxy Binding
					Update (PBU)/Proxy Binding Acknowledgement (PBA) message exchange 
					<a class='info' href='#RFC5213'>[RFC5213]<span> (</span><span class='info'>Gundavelli, S., Leung, K., Devarapalli, V., Chowdhury, K., and B. Patil, &ldquo;Proxy Mobile IPv6,&rdquo; August&nbsp;2008.</span><span>)</span></a>. 
<br /><hr class="insert" />
<a name="fig2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+---+    +----+    +----+     +---+    +----+  +----+   +---+
|MN1|    |MAG1|    |LMA1|     |AAA|    |LMA2|  |MAG2|   |MN2|
+-+-+    +-+--+    +-+--+     +-+-+    +-+--+  +-+--+   +-+-+
  |        |         |          |        |       |        |
  |     Anchored     |          |        |    Anchored    |
  o------------------o          |        o-------+--------o
Data[MN1-&gt;MN2]       |          |        |       |        |
  |-------&gt;|         |          |        |       |        |
  |        |LROREQ(MN2)         |        |       |        |
  |        |--------&gt;|          |        |       |        |
  |        |         |AAR(MN2,MFV)       |       |        |
  |        |         |---------&gt;|        |       |        |
  |        |         |AAA(LMA2) |        |       |        |
  |        |         |&lt;---------|        |       |        |
  |        |LRORSP(LMA2)        |        |       |        |
  |        |&lt;--------|          |        |       |        |
  |        |       PBU(LR[MN1,MN2])      |       |        |
  |        |---------+----------+-------&gt;|       |        |
  |        |        PBA(LR[MAG2])        |       |        |
  |        |&lt;--------+----------+--------|       |        |
  |        |        MAGs PBU/PBA exchange|       |        |
  |        |&lt;--------+----------+---------------&gt;|        |
  |        |         |   Data[MN1-&gt;MN2]  |       |        |
  |        |=========|==========|==============-&gt;|-------&gt;|
  |        |         |   Data[MN2-&gt;MN1]  |       |        |
  |&lt;-------|&lt;========|==========|================|&lt;-------|
  |        |         |          |        |       |        |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: MAG-initiated Localized Routing Authorization&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
   
					<a class='info' href='#fig3'>Figure&nbsp;3<span> (</span><span class='info'>LMA-initiated Localized Routing Authorization</span><span>)</span></a> 
					shows another scenario, in which the 
					LMA1 acts as a Diameter client, processing the data packet from MN1 to
					MN2 and requesting the authorization of localized routing. 
					In this scenario,
					MN1 and MN2 are anchored to LMA1 and LMA2 respectively. 
					In contrast with
					the signaling flow of <a class='info' href='#fig2'>Figure&nbsp;2<span> (</span><span class='info'>MAG-initiated Localized Routing Authorization</span><span>)</span></a>, 
					the difference is that
					it is LMA1 instead of MAG1 which initiates the setup of the localized routing path.
					<br />
<br />

					The Diameter client in LMA1 sends an AA-Request
					(AAR) message to the Diameter server. 
					The message contains an instance
					of the MIP6-Feature-Vector AVP (<a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a>, Section 4.2.5)
					with the INTER_MAG_ROUTING_SUPPORTED bit set and an instance
					of the MIP6-Home-Link-Prefix AVP 
					(<a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a>, Section 4.2.4) containing the IP address of MN2. 
					The Diameter server
					checks if localized routing is allowed between MAG1 and MAG2 and if so,
					responds with an AA-Answer (AAA) message encapsulating an instance of
					the MIP6-Agent-Info AVP
					<a class='info' href='#I-D.ietf-dime-pmip6'>[I&#8209;D.ietf&#8209;dime&#8209;pmip6]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Chowdhury, K., Muhanna, A., and U. Meyer, &ldquo;Diameter Proxy Mobile IPv6: Mobile Access Gateway and Local Mobility Anchor Interaction with Diameter Server,&rdquo; September&nbsp;2009.</span><span>)</span></a>
					containing the IP address and/or
					Fully Qualified Domain Name (FQDN) of LMA2.
					LMA1 then determines the IP
					address of LMA2 using the data returned in the MIP6-Agent-Info AVP and
					forwards it to MAG1 in the Local Routing Optimization message 
					(<a class='info' href='#I-D.wu-netext-local-ro'>[I&#8209;D.wu&#8209;netext&#8209;local&#8209;ro]<span> (</span><span class='info'>Wu, W. and B. Sarikaya, &ldquo;An Extension to Proxy Mobile IPv6 for Local Routing Optimization,&rdquo; February&nbsp;2010.</span><span>)</span></a>).
<br /><hr class="insert" />
<a name="fig3"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+---+    +----+  +----+     +---+      +----+  +----+   +---+
|MN1|    |MAG1|  |LMA1|     |AAA|      |LMA2|  |MAG2|   |MN2|
+-+-+    +-+--+  +-+--+     +-+-+      +-+--+  +-+--+   +-+-+
  |        |       |          |          |       |        |
  |     Anchored   |          |          |    Anchored    |
  o--------+-------o          |          o-------+--------o
  | Data[MN2-&gt;MN1] |          |          |       |        |
  |--------+------&gt;|          |          |       |        |
  |        |       |AAR(MN2,MFV)         |       |        |
  |        |       |---------&gt;|          |       |        |
  |        |       |AAA(LMA2) |          |       |        |
  |        |       |&lt;---------|          |       |        |
  |     LROREQ(MN2,LMA2)      |          |       |        |
  |        |&lt;------|          |          |       |        |
  |      LRORSP(Succ)         |          |       |        |
  |        |------&gt;|          |          |       |        |
  |        |       |  PBU(LR[MN1,MN2])   |       |        |
  |        |----------------------------&gt;|       |        |
  |        |       |  PBA(LR[MAG2])      |       |        |
  |        |&lt;----------------------------|       |        |
  |        |       |  MAGs PBU/PBA exch  |       |        |
  |        |&lt;-----------------------------------&gt;|        |
  |Data[MN1-&gt;MN2]                                |        |
  |-------&gt;|====================================&gt;|-------&gt;|
  |        |       |          |          |       |        |
  |        |       |          |          |  Data[MN2-&gt;MN1]|
  |&lt;-------|&lt;====================================|&lt;-------|
  |        |       |          |          |       |        |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: LMA-initiated Localized Routing Authorization&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

				
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Diameter Server Authorizes MAG Location Query</h3>

<p>
					<a class='info' href='#fig4'>Figure&nbsp;4<span> (</span><span class='info'>Diameter Server Authorizes MAG Location Query</span><span>)</span></a> shows a scenario in which LMA2 acts as a
					Diameter client, receiving location request and requesting authorization
					for MAG location lookup. 
					In this scenario, MN1 and MN2 are anchored to
					LMA1 and LMA2 respectively. 
					Upon receiving an upstream data packet, MAG1
					needs to determine the recipient of localized routing, i.e., LMA2. And
					then MAG1 solicits LMA2 to look up the IP address of the MAG to which MN2 is
					currently attached (in this case, MAG2) by sending a Local Routing Optimization Request message
					containing the IP addresses/HNPs of MN1 and MN2. 
					LMA2 
					validates the request from MAG1 by sending an AAR to the AAA server containing 
					the IP address/HNP of MN1 (encapsulated in an instance of the MIP6-Home-Link-Prefix AVP) and 
					an instance of the MIP6-Feature-Vector AVP (<a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a>, Section 4.2.5)
					with the INTER_MAG_ROUTING_SUPPORTED bit set. If the authorization is successful,
					LMA2 then looks up the IP address of MAG2 based on the IP address/HNP of MN2 and
					responds to MAG1 with the IP address of MAG2.
<br /><hr class="insert" />
<a name="fig4"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
+---+    +----+  +----+     +---+      +----+  +----+   +---+
|MN1|    |MAG1|  |LMA1|     |AAA|      |LMA2|  |MAG2|   |MN2|
+-+-+    +-+--+  +-+--+     +-+-+      +-+--+  +-+--+   +-+-+
  |        |       |          |          |       |        |
  |     Anchored   |          |          |    Anchored    |
  o----------------o          |          o-------+--------o
Data[MN1-&gt;MN2]     |          |          |       |        |
  |-------&gt;|       |          |          |       |        |
  |+--------------+|          |          |       |        |
  ||Recipient=LMA2||          |          |       |        |
  |+--------------+|          |          |       |        |
  |        |       PBU(LR[MN1,MN2])      |       |        |
  |        |-------+----------+---------&gt;|       |        |
  |        |       |          |AAR(Service Type,MN1)      |
  |        |       |          |&lt;---------|       |        |
  |        |       |          |   AAA    |       |        |
  |        |       |          |---------&gt;|       |        |
  |        |       |PBA(LR[MAG2])        |       |        |
  |        |&lt;----------------------------|       |        |
  |        |      MAGs PBU/PBA exchange  |       |        |
  |        |&lt;-----------------------------------&gt;|        |
  |        |                                     |        |
  |        |====================================&gt;|        |
  |        |       |          |          |       |-------&gt;|
  |        |       |          |          |       |Data[MN2-&gt;MN1]
  |&lt;-------|&lt;====================================|&lt;-------|
  |        |       |          |          |       |        |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Diameter Server Authorizes MAG Location Query&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

				
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Local Routing Service Authorization in Networks with Multiple AAA Servers</h3>
<br /><hr class="insert" />
<a name="fig5"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                   +------------------------------------+
                   (                      AAA           )
                   (     +--------+     Backend         )
                   (     |Redirect|                     )
                   (     | Agent  |                     )
                   (     +--------+                     )
                   (         ^                          )
                   (         |                          )
                   (         |                          )
                   (         v                          )
                   (  +---------+          +---------+  )
                +----&gt;| AAA1 &amp;  |          | AAA2 &amp;  |&lt;---+
                |  (  | Policy  |&lt;--------&gt;| Policy  |  ) |
                |  (  | Profile |          | Profile |  ) |
                |  (  +---------+          +---------+  ) |
                |  (      ^                     ^       ) |
                |  +----- | ------------------- |-------+ |
                |         A1                    A2        |
                |         |                     |         |
                |         |                     |         |
             Diameter     v                     v      Diameter
                B1       +----+  LMA2 ?     +----+        B2
                |        |LMA1| ------&gt;     |LMA2|        |
                |        +----+             +----+        |
                |          |                  |           |
                |         //                  \\          |
                |        //                    \\         |
                |       //                      \\        |
                |       |                        |        |
                |     +----+                   +----+     |
                +----&gt;|MAG1|                   |MAG2|&lt;----+
                      +----+                   +----+
                         :                        :
                      +---+                     +---+
                      |MN1|                     |MN2|
                      +---+                     +---+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Use of a Diameter Redirect Agent to Support Local Routing Service Authorization in Networks with Multiple AAA servers&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
					Referring to an architecture with multiple AAA servers (as illustrated in
					<a class='info' href='#fig5'>Figure&nbsp;5<span> (</span><span class='info'>Use of a Diameter Redirect Agent to Support Local Routing Service Authorization in Networks with Multiple AAA servers</span><span>)</span></a>), AAA1 may not maintain the LMA to be assigned
					to MN2 as a configured entry in the Correspondent Node's Policy profile,
					as AAA2 holds this information in its policy store. In such a case, AAA1
					contacts a Diameter redirect agent [RFC3588] to request the AAA server
					being responsible for maintaining MN2's policy
					profile. 
					AAA2 checks if localized routing is
					allowed between MAG1 and MAG2 and if so, responds with the IP address of
					LMA2 corresponding to MN2 and sends the results back to LMA1 via AAA1.
					Details about the use of redirect agents in this context are beyond
					scope of this document.
				
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
				The security considerations for the  
				<a class='info' href='#RFC4005'>Diameter NASREQ<span> (</span><span class='info'>Calhoun, P., Zorn, G., Spence, D., and D. Mitton, &ldquo;Diameter Network Access Server Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4005] and 
				<a class='info' href='#I-D.ietf-dime-pmip6'>Diameter Proxy Mobile IPv6<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Chowdhury, K., Muhanna, A., and U. Meyer, &ldquo;Diameter Proxy Mobile IPv6: Mobile Access Gateway and Local Mobility Anchor Interaction with Diameter Server,&rdquo; September&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;dime&#8209;pmip6] 
				applications are also applicable to this document.
				<br />
<br />

				The service authorization solicited by the MAG or the LMA relies upon
				the existing trust relationship between the MAG/LMA and the AAA server.
			
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>
				This specification specifies a new value in the Mobility Capability
				registry <a class='info' href='#RFC5447'>[RFC5447]<span> (</span><span class='info'>Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction,&rdquo; February&nbsp;2009.</span><span>)</span></a> for use with the MIP6-Feature-Vector AVP: INTER_MAG_ROUTING_SUPPORTED (0x0000080000000000).   
			
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Contributors</h3>

<p>
				Paulo Loureiro, Jinwei Xia and Yungui Wang all contributed to early versions of this document.
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-pmip6">[I-D.ietf-dime-pmip6]</a></td>
<td class="author-text">Korhonen, J., Bournelle, J., Chowdhury, K., Muhanna, A., and U. Meyer, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-pmip6-04.txt">Diameter Proxy Mobile IPv6: Mobile Access Gateway and Local Mobility Anchor Interaction with Diameter Server</a>,&rdquo; draft-ietf-dime-pmip6-04 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-pmip6-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4005">[RFC4005]</a></td>
<td class="author-text">Calhoun, P., Zorn, G., Spence, D., and D. Mitton, &ldquo;<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>,&rdquo; RFC&nbsp;4005, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4005.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5213">[RFC5213]</a></td>
<td class="author-text">Gundavelli, S., Leung, K., Devarapalli, V., Chowdhury, K., and B. Patil, &ldquo;<a href="http://tools.ietf.org/html/rfc5213">Proxy Mobile IPv6</a>,&rdquo; RFC&nbsp;5213, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5213.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5447">[RFC5447]</a></td>
<td class="author-text">Korhonen, J., Bournelle, J., Tschofenig, H., Perkins, C., and K. Chowdhury, &ldquo;<a href="http://tools.ietf.org/html/rfc5447">Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction</a>,&rdquo; RFC&nbsp;5447, February&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5447.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-netext-pmip6-lr-ps">[I-D.ietf-netext-pmip6-lr-ps]</a></td>
<td class="author-text">Liebsch, M., Jeong, S., and W. Wu, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-netext-pmip6-lr-ps-02.txt">PMIPv6 Localized Routing Problem Statement</a>,&rdquo; draft-ietf-netext-pmip6-lr-ps-02 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-netext-pmip6-lr-ps-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wu-netext-local-ro">[I-D.wu-netext-local-ro]</a></td>
<td class="author-text">Wu, W. and B. Sarikaya, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wu-netext-local-ro-05.txt">An Extension to Proxy Mobile IPv6 for Local Routing Optimization</a>,&rdquo; draft-wu-netext-local-ro-05 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-wu-netext-local-ro-05.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Glen Zorn (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Network Zen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1463 East Republican Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">#358</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Seattle, Washington  98112</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:gwz@net-zen.net">gwz@net-zen.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qin Wu (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies Co., Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Site B, Floor 12F, Huihong Mansion, No.91 Baixia Rd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nanjing, JiangSu  210001</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86-25-84565892</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Sunseawq@huawei.com">Sunseawq@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marco Liebsch</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NEC Europe Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NEC Europe Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kurfuersten-Anlage 36</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Heidelberg,   69115</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:liebsch@nw.neclab.eu">liebsch@nw.neclab.eu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jouni Korhonen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo FI-02600,   </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jouni.nospam@gmail.com">jouni.nospam@gmail.com</a></td></tr>
</table>
</body></html>
