<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The References Header for SIP</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The References Header for SIP">
<meta name="keywords" content="">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP</td><td class="header">D. Worley</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nortel</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">December 01, 2008</td></tr>
<tr><td class="header">Expires: June 4, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The References Header for SIP<br />draft-worley-references-01</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on June 4, 2009.</p>

<h3>Abstract</h3>

<p>
This document defines a SIP extension header, References, to be used
within SIP messages to signify that the message (and the
dialog containing it) is related to one or more other dialogs.
It is expected to be used largely for diagnostic purposes.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#purpose">1.</a>&nbsp;
Purpose of the References Header<br />
<a href="#syntax">2.</a>&nbsp;
Syntax and Semantics<br />
<a href="#examples">3.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#refer">3.1.</a>&nbsp;
REFER<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transfer">3.2.</a>&nbsp;
Attended Transfer<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pickup">3.3.</a>&nbsp;
Call Pickup<br />
<a href="#experience">4.</a>&nbsp;
Practical Experience<br />
<a href="#related">5.</a>&nbsp;
Related Work<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">5.1.</a>&nbsp;
draft-loreto-sipping-dialog-correlation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.2.</a>&nbsp;
draft-kaplan-sip-session-id<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
<a href="#revision">7.</a>&nbsp;
Revision History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#00-01">7.1.</a>&nbsp;
Changes from draft-worley-references-00 to draft-worley-references-01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#00">7.2.</a>&nbsp;
draft-worley-references-00<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="purpose"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Purpose of the References Header</h3>

<p>
In many situations, the processing of a SIP "telephone call" involves
a number of different SIP dialogs.
Of course, the existing SIP headers provide adequate information for
the SIP elements to carry out the needed operations.
But in many cases, it is difficult for an observer to identify from a
network trace the particular SIP dialogs that are involved in one
operation.

</p>
<p>
For example, if a user agent receives a REFER message within one
dialog, it sends an INVITE to establish a new dialog which replaces
the previous one within the user interface of the user agent.
But since the connection between the new dialog and the old dialog is
only realized within the user agent, there is no algorithmic way to
associate the two dialogs based on the SIP messages alone --
the best available technique is to extract all the messages to/from
the particular user agent, and then observe the INVITE that is sent
immediately after receipt of the REFER.

</p>
<p>
The purpose of the References header is to allow a SIP message to
specify that the message carrying it (and by extension, the dialog
that contains the message) is related to one or more other dialogs,
specified by their Call-Id values.
Ideally, when given a Call-Id, an automated process can use the
connections between dialogs specified in References headers to
determine the entire set of dialogs that are needed to understand a
complete "telephone call" or other SIP interaction.

</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Syntax and Semantics</h3>

<p>
The syntax of the References header is as follows.
(All rules not defined here are taken from
section 25.1 of RFC 3261<a class='info' href='#sip'>[sip]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.)

</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
<dfn>message-header</dfn>  =/ <cite class='id'>References</cite>
<dfn>References</dfn>      =  "<span class='str'>References</span>" <cite class='id'>HCOLON</cite> <cite class='id'>reference</cite> <span class='rep'>*</span>(<cite class='id'>COMMA</cite> <cite class='id'>reference</cite>)
<dfn>reference</dfn>       =  <cite class='id'>callid</cite> <span class='rep'>*</span>( <cite class='id'>SEMI</cite> <cite class='id'>reference-param</cite> )
<dfn>reference-param</dfn> =  <cite class='id'>rel-param</cite> / <cite class='id'>generic-param</cite>
<dfn>rel-param</dfn>       =  "<span class='str'>rel</span>" <cite class='id'>EQUAL</cite> <cite class='id'>rel-value</cite>
<dfn>rel-value</dfn>       =  "<span class='str'>refer</span>" / "<span class='str'>inquiry</span>" / "<span class='str'>xfer</span>" / <cite class='id'>gen-value</cite>
</pre></div>
<p>
Multiple References headers may appear in a SIP message, and their
values may be combined or separated as allowed by section 7.3 of
RFC 3261<a class='info' href='#sip'>[sip]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
The ordering of References values is not significant.

</p>
<p>
The call-id elements of the Replaces and Join headers are considered
implicit References and so SHOULD NOT be specified in
References headers.

</p>
<p>
The presence of a References header in a SIP message means that the
message (and by implication, the dialog containing it) is related to
the dialog(s) bearing the specified Call-Id(s).
Note that since there is no way to specify the to-tag and from-tag of
the referenced dialog, the
References header does not distinguish different dialogs that have the
same Call-Id, and all dialogs sharing a Call-Id are considered to be
related a priori.
The processor of References headers should
consider the "related" relationship of dialogs to include the
symmetric-transitive closure of the References relationship; that is,
if a message in dialog A references dialog B, and a message in dialog
B references dialog C, then all three dialogs should be considered
related to each other.

</p>
<p>
The nature of the relationship between the message's dialog and the
referenced dialog(s) is indicated by
the "rel" parameter (if it is present).
Since the message containing the References header is likely to be
constrained to be generated after the creation of the dialog mentioned
by the header, and the UA may not have control over this time-ordering,
relationship natures are considered symmetric.  E.g., a request
with Call-Id A that performs an inquiry to assist in routing dialog B
may contain
"References: B;rel=inquiry", but the same meaning can be indicated by
a message in dialog B containing "References: A;rel=inquiry".

</p>
<p>
The currently defined values of the "rel" parameter are:

</p>
<p>

</p>
<blockquote class="text">
<p>
"refer"
meaning that this request was generated due to a REFER with the
specified Call-Id

</p>
<p>
"inquiry"
meaning that this request was generated to obtain information needed
to properly process a request with the specified Call-Id.  (For
example, in
section 2.16, "Call Pickup" of <a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>,
a SUBSCRIBE
is generated to discover the UA which sent an INVITE to a designated AOR.)

</p>
<p>
"xfer"
meaning that the dialog of this message and the dialog with the
specified Call-Id are the two legs of a consultative (or attended)
transfer.  One endpoint of each dialog will become an endpoint of the
final dialog.

</p>
</blockquote><p>


</p>
<p>
It is expected that the References header will usually appear in the
dialog-forming request of a dialog, but it may appear in any request
or response.  Since 1xx responses are not delivered reliably, a
References header value that is present only in a 1xx response may not be
seen by an element that ought in principle to see the response, and
such a value SHOULD be present in another message of the dialog going
to that UA.

</p>
<p>
All parameters and parameter values that are not understood by the
processor of the References header MUST be ignored.
Parameters and values that start with "X-" (case-insensitive) are reserved
for non-standardized purposes.

</p>
<p>
Note that while the SIP References header is similar in function to
the Internet e-mail References header<a class='info' href='#message-format'>[message&#8209;format]<span> (</span><span class='info'>Resnick, P., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>,
they have different syntaxes and are not interchangeable.

</p>
<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Examples</h3>

<a name="refer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
REFER</h3>

<p>
One use of References is to connect a REFER to the INVITE that it
causes to be sent.
A typical use of REFER is to implement blind transfer.
This example is taken from section 2.4, "Transfer - Unattended" of
<a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
          Alice                 Bob                 Carol
            |      INVITE F1     |                    |
            |&lt;-------------------|                    |
            |   180 Ringing F2   |                    |
            |-------------------&gt;|                    |
            |      200 OK F3     |                    |
            |-------------------&gt;|                    |
            |        ACK F4      |                    |
            |&lt;-------------------|                    |
            |        RTP         |                    |
            |&lt;==================&gt;|                    |
            |                    |                    |
            |  Alice performs unattended transfer     |
            |                    |                    |
            | REFER Refer-To:C F5|                    |
            |-------------------&gt;|                    |
            |  202 Accepted F6   |                    |
            |&lt;-------------------|                    |
            |      NOTIFY F7     |                    |
            |&lt;-------------------|                    |
            |      200 OK F8     |                    |
            |-------------------&gt;|                    |
            |       BYE F9       |                    |
            |-------------------&gt;|                    |
            |     200 OK F10     |                    |
            |&lt;-------------------|                    |
            |   No RTP Session   | INVITE Referred-By: A F11
            |                    |-------------------&gt;|
            |                    |   180 Ringing F12  |
            |                    |&lt;-------------------|
            |                    |     200 OK F13     |
            |                    |&lt;-------------------|
            |                    |       ACK F14      |
            |                    |-------------------&gt;|
            |                    |        RTP         |
            |                    |&lt;==================&gt;|
            |      NOTIFY F15    |                    |
            |&lt;-------------------|                    |
            |      200 OK F16    |                    |
            |-------------------&gt;|                    |
            |                    |                    |
</pre></div>
<p>
In order to execute the blind transfer, Alice's UA sends a REFER to Bob's UA:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      F5 REFER Alice -&gt; Bob

      REFER sips:bob@client.biloxi.example.com SIP/2.0
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds8
      Max-Forwards: 70
      From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=1234567
      To: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=314159
      Call-ID: 12345601@atlanta.example.com
      CSeq: 101 REFER
      Refer-To: &lt;sips:carol@chicago.example.com&gt;
      Referred-By: &lt;alice@atlanta.example.com&gt;
      Contact: &lt;sips:alice@client.atlanta.example.com&gt;
      Content-Length: 0
</pre></div>
<p>
Upon receipt of the REFER, Bob's UA sends an INVITE to Carol's UA.  In
order to make explicit the relationship between the REFER and the
INVITE, the INVITE has a References header giving the Call-Id of the
REFER:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      F11 INVITE Bob -&gt; Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      References: 12345601@atlanta.example.com;rel=refer
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnashds1
      Max-Forwards: 70
      From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=8675309
      To: Carol &lt;sips:carol@chicago.example.com&gt;
      Call-ID: 7436222@atlanta.example.com
      CSeq: 1 INVITE
      Contact: &lt;sips:bob@client.biloxi.example.com&gt;
      Referred-By: &lt;alice@atlanta.example.com&gt;
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      [SDP omitted]
</pre></div>
<a name="transfer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Attended Transfer</h3>

<p>
An attended transfer normally involves three different dialogs.
If the transfer completes, and
the REFER that completes the transfer has a References header, the
References header in the REFER and the Replaces header in the
resulting INVITE will suffice to connect the three dialogs.
However, to provide complete information if the transfer does not
complete, the INVITE that establishes the "second leg" of the transfer
scenario should have a References header naming the "first leg".
This example is taken from section 2.5, "Transfer - Attended" of 
<a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Alice             Bob          Carol
             |                |              |
             |    INVITE F1   |              |
             |---------------&gt;|              |
             | 180 Ringing F2 |              |
             |&lt;---------------|              |
             |    200 OK F3   |              |
             |&lt;---------------|              |
             |     ACK F4     |              |
             |---------------&gt;|              |
             |       RTP      |              |
             |&lt;==============&gt;|              |
             |INVITE (hold) F5|              |
             |&lt;---------------|              |
             |    200 OK F6   |              |
             |---------------&gt;|              |
             |     ACK F7     |              |
             |&lt;---------------|              |
             |     No RTP     |              |
             |                |  INVITE F8   |
             |                |-------------&gt;|
             |                | 180 Ringing F9
             |                |&lt;-------------|
             |                |  200 OK F10  |
             |                |&lt;-------------|
             |                |    ACK F11   |
             |                |-------------&gt;|
             |                |     RTP      |
             |                |&lt;============&gt;|
             |                |INVITE (hold) F12
             |                |-------------&gt;|
             |                | 200 OK F13   |
             |                |&lt;-------------|
             |                |    ACK F14   |
             |                |-------------&gt;|
             |                |     No RTP   |
             | REFER Refer-To: C F15         |
             |&lt;---------------|              |
             |202 Accepted F16|              |
             |---------------&gt;|              |
             |   NOTIFY F17   |              |
             |---------------&gt;|              |
             |   200 OK F18   |              |
             |&lt;---------------|              |
             |     INVITE Replaces: B F19    |
             |------------------------------&gt;|
             |            200 OK F20         |
             |&lt;------------------------------|
             |             ACK F21           |
             |------------------------------&gt;|
             |               RTP             |
             |&lt;=============================&gt;|
             |                |    BYE F22   |
             |                |&lt;-------------|
             |                |  200 OK F23  |
             |                |-------------&gt;|
             |   NOTIFY F24   |              |
             |---------------&gt;|              |
             |   200 OK F25   |              |
             |&lt;---------------|              |
             |    BYE F26     |              |
             |&lt;---------------|              |
             |   200 OK F27   |              |
             |---------------&gt;|              |
</pre></div>
<p>
The INVITE that establishes the second leg has a References header
naming the first leg:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      F8 INVITE Bob -&gt; Carol

      INVITE sips:carol@chicago.example.com SIP/2.0
      References:  12345600@atlanta.example.com;rel=xfer
      Via: SIP/2.0/TLS client.biloxi.example.com:5061
       ;branch=z9hG4bKnash
      Max-Forwards: 70
      From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=8675309
      To: Carol &lt;sips:carol@chicago.example.com&gt;
      Call-ID: sdjfdjfskdf@biloxi.example.com
      CSeq: 42 INVITE
      Contact: &lt;sips:bob@client.biloxi.example.com&gt;
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      [SDP omitted]
</pre></div>
<p>
As described in <a class='info' href='#refer'>Section&nbsp;3.1<span> (</span><span class='info'>REFER</span><span>)</span></a>, the INVITE that completes the
transfer has a References header giving the dialog of the first leg,
within which the REFER was sent.  It also has a Replaces header giving
the dialog of the second leg, which acts as an implicit References.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      F19 INVITE Alice -&gt; Carol

      INVITE sips:39itp34klkd@chicago.example.com;gr SIP/2.0
      References:  12345600@atlanta.example.com;rel=refer
      Via: SIP/2.0/TLS chicago.example.com:5061
       ;branch=z9hG4bKadfe4ko
      To: Carol &lt;sips:39itp34klkd@chicago.example.com&gt;
      Max-Forwards: 70
      From: Alice &lt;sips:alice@atlanta.example.com&gt;;tag=3461
      Call-ID: 9435674543@atlanta.example.com
      CSeq: 1 INVITE
      Require: replaces
      Referred-By: &lt;sips:bob@biloxi.example.com&gt;
      Replaces: sdjfdjfskdf@biloxi.example.com
       ;to-tag=5f35a3;from-tag=8675309
      Contact: &lt;sips:alice@client.atlanta.example.com&gt;
      Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
      Supported: replaces
      Content-Type: application/sdp
      Content-Length: ...

      [SDP omitted]
</pre></div>
<a name="pickup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Call Pickup</h3>

<p>
The References header can be used during a call pickup operation to
connect the
SUBSCRIBE that is used to locate the target dialog with the INVITE
which is generated to execute the pickup.
This example is taken from section 2.16, "Call Pickup" of
<a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
            Alice          Bob                Bill
             |              |                   |
             |   INVITE F1  |                   |
             |-------------&gt;|                   |
             |180 Ringing F2|                   |
             |&lt;-------------|                   |
             |              |   SUBSCRIBE F3    |
             |              |&lt;------------------|
             |              |     200 OK F4     |
             |              |------------------&gt;|
             |              |     NOTIFY F5     |
             |              |------------------&gt;|
             |              |     200 OK F6     |
             |              |&lt;------------------|
             |          INVITE Replaces:Bob  F7 |
             |&lt;---------------------------------|
             |              |     200 OK F8     |
             |---------------------------------&gt;|
             |   CANCEL F9  |                   |
             |-------------&gt;|                   |
             |  200 OK F10  |                   |
             |&lt;-------------|                   |
             |    487 F11   |                   |
             |&lt;-------------|                   |
             |    ACK F12   |                   |
             |-------------&gt;|                   |
             |                    ACK F13       |
             |&lt;---------------------------------|
             |                                  |
             |    Two way RTP Established       |
             |&lt;================================&gt;|
             |                     BYE F14      |
             |---------------------------------&gt;|
             |                   200 OK F15     |
             |&lt;---------------------------------|
             |                                  |
</pre></div>
<p>
Bill's UA sends a SUBSCRIBE to find the target dialog:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F3 SUBSCRIBE  Bill -&gt; Bob

   SUBSCRIBE sips:bob@biloxi.example.com SIP/2.0
   Via: SIP/2.0/TLS pc.biloxi.example.com:5061
    ;branch=z9hG4bK74bf
   Max-Forwards: 70
   From: Bill &lt;sips:bill@biloxi.example.com&gt;;tag=8675309
   To: Bob &lt;sips:bob@biloxi.example.com&gt;
   Call-ID: rt4353gs2egg@pc.biloxi.example.com
   CSeq: 1 SUBSCRIBE
   Contact: &lt;sips:bill@pc.biloxi.example.com&gt;
   Event: dialog
   Expires: 0
   Accept: application/dialog-info+xml
   Content-Length: 0
</pre></div>
<p>
After locating the target dialog, Bill's UA generates an
INVITE-with-Replaces to execute the pickup.
The UA adds the References header to show the connection with the
SUBSCRIBE: 

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F7 INVITE  Bill -&gt; Alice

   INVITE sips:a8342043f@atlanta.example.com;gr SIP/2.0
   References: rt4353gs2egg@pc.biloxi.example.com;rel=inquiry
   Via: SIP/2.0/TLS pc.biloxi.example.com:5061
    ;branch=z9hG4bK74HH
   Max-Forwards: 70
   From: Bill &lt;sips:bill@biloxi.example.com&gt;;tag=8675310
   To: Alice &lt;sips:alice@atlanta.example.com&gt;
   Call-ID: 563456212@b2.biloxi.example.com
   CSeq: 1 INVITE
   Require: replaces
   Replaces: 12345600@atlanta.example.com
    ;from-tag=314578;to-tag=1234567;early-only
   Contact: &lt;sips:bill@pc.biloxi.example.com&gt;
   Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, REFER, NOTIFY
   Supported: replaces
   Content-Type: application/sdp
   Content-Length: ...

   [SDP omitted]
</pre></div>
<p>
Note that the executing INVITE F7 does not mention the Call-Id of the
original INVITE F1 because it is mentioned in the Replaces header.

</p>
<p>
If the call pickup operation is done by an agent on behalf of Bill's
UA (as in the sipX open-source PBX), the executing INVITE is likely to
exist before the SUBSCRIBE is generated.
In that case, the SUBSCRIBE will have a References header giving the
Call-Id of the INVITE:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F3 SUBSCRIBE  Bill -&gt; Bob

   SUBSCRIBE sips:bob@biloxi.example.com SIP/2.0
   References: 563456212@b2.biloxi.example.com;rel=inquiry
   Via: SIP/2.0/TLS pc.biloxi.example.com:5061
    ;branch=z9hG4bK74bf
   Max-Forwards: 70
   From: Bill &lt;sips:bill@biloxi.example.com&gt;;tag=8675309
   To: Bob &lt;sips:bob@biloxi.example.com&gt;
   Call-ID: rt4353gs2egg@pc.biloxi.example.com
   CSeq: 1 SUBSCRIBE
   Contact: &lt;sips:bill@pc.biloxi.example.com&gt;
   Event: dialog
   Expires: 0
   Accept: application/dialog-info+xml
   Content-Length: 0
</pre></div>
<a name="experience"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Practical Experience</h3>

<p>
The current version of the sipX open-source PBX adds a References
header to the SUBSCRIBE of a call pickup as described in
section 2.16, "Call Pickup" of <a class='info' href='#service-examples'>[service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
It has caused no observed interoperability problem.

</p>
<a name="related"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Related Work</h3>

<p>
This section discusses other Internet-drafts and their relationship to
this work.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
draft-loreto-sipping-dialog-correlation</h3>

<p>

</p>
<blockquote class="text">
<p>
The Session Initiation Protocol (SIP) Dialog Correlation<a class='info' href='#loreto-correlation'>[loreto&#8209;correlation]<span> (</span><span class='info'>Loreto, S. and G. Camarillo, &ldquo;The Session Initiation Protocol (SIP) Dialog Correlation,&rdquo; June&nbsp;2006.</span><span>)</span></a><br />
<br />

This document defines a new header field for use with SIP.  The
Same-Session header field is used to logically correlate an existing
SIP
dialog with a new SIP dialog when the media sessions established by
both dialogs can be considered a single logical session.  This
mechanism can be used to share the user interface and other resources
between all the media streams from both sessions.

</p>
</blockquote><p>


</p>
<p>
The "Same-Session" header prescribes that the media sessions of two INVITE
dialog usages are to be considered part of the same session from the
users' points of view.
Because of this semantic, it cannot be used in place of the
References header, as References can be used to express the
relationship between two dialogs that are not connected in any
particular way in regard to user interface.

</p>
<p>
However, it would be possible to define a "parallel" value of the
"rel" parameter to have the semantics of "Same-Session".
This usage would require
that the References header appears in the INVITE establishing the
second dialog (and that the two INVITEs are properly time-sequenced,
or that both INVITEs have a References header).
But this still might be considered a conflation of mechanism that have
different semantics.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
draft-kaplan-sip-session-id</h3>

<p>

</p>
<blockquote class="text">
<p>
A Session Identifier for the Session Initiation Protocol (SIP)<a class='info' href='#kaplan-session'>[kaplan&#8209;session]<span> (</span><span class='info'>Kaplan, H., &ldquo;A Session Identifier for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2008.</span><span>)</span></a><br />
<br />

There are several reasons for having a globally unique session
identifier for the same SIP session, which can be maintained across
B2BUA's and other SIP middle-boxes.  This draft proposes a new SIP
header to carry such a value: Session-ID.

</p>
</blockquote><p>


</p>
<p>
The semantics of "Session-ID" are close to those of References, and
it would be reasonable to define a "rel" value that meant that the
referenced Call-Id was "the other side" of a B2BUA connection.
(This would require placing a References header in the INVITE
request sent
from the recipient side of the B2BUA and one in the response to the
INVITE send from the originator side.)
But since References contains the real Call-Id of a dialog, this use
would not have the security properties described in section 5.1 of
<a class='info' href='#kaplan-session'>[kaplan&#8209;session]<span> (</span><span class='info'>Kaplan, H., &ldquo;A Session Identifier for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2008.</span><span>)</span></a>.

</p>
<p>
A possible solution to this problem is for the B2BUA to create a
"phantom" Call-Id that is suitably random, and use it in References
headers sent in both the initial request and response.
By the transitivity property<a class='info' href='#syntax'>Section&nbsp;2<span> (</span><span class='info'>Syntax and Semantics</span><span>)</span></a>, the dialogs on
both sides of the B2BUA are declared to be related, even if the
referenced dialog contains no messages.

</p>
<p>
For two chained B2BUAs with no forking, this would give a message flow
like this:

</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
UA 1            B2BUA 1         B2BUA 2         UA 2

     ---&gt;
     INVITE 123@aa.example.com
     Call-Id: qwerty@aa

                     ---&gt;
                     INVITE 123@transit.example.com
                     Call-Id: asdfgh@transit
                     References: QAZWSXEDCRFV;rel=serial

                                     ---&gt;
                                     INVITE 123@bb.example.com
                                     Call-Id: zxcvbn@bb
                                     References: QAZWSXEDCRFV
                                          ;rel=serial

                                     &lt;---
                                     SIP/2.0 200 OK
                                     Call-Id: zxcvbn@bb

                     &lt;---
                     SIP/2.0 200 OK
                     Call-Id: asdfgh@transit
                     References: QAZWSXEDCRFV;rel=serial

     &lt;---
     SIP/2.0 200 OK
     Call-Id: qwerty@aa
     References: QAZWSXEDCRFV;rel=serial
</pre></div>
<p>
Note that B2BUA 2 does not create a new "References serial" value, but
rather reuses the value it received in the initial INVITE.  (In
principle, B2BUA 2 does not need to add References to the response
it sends, as References is present in the request.)

</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
The specification of the relationship between two dialogs could in
principle be a privacy issue.
But these relationships can usually be discerned by heuristic
processing of the stream of SIP messages, and (with one exception)
the author knows of no
instance where the security or privacy properties of SIP have been
based on the inability of an eavesdropper to determine that two SIP
dialogs or messages are related.

</p>
<p>
The one known privacy problem is the the "service
provider privacy" problem discussed in <a class='info' href='#kaplan-session'>[kaplan&#8209;session]<span> (</span><span class='info'>Kaplan, H., &ldquo;A Session Identifier for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2008.</span><span>)</span></a>.
This situation is different from conventional "user security"
situations because the eavesdropper is assumed to be unable to
tap multiple points of the network, and the goal is to prevent the eavesdropper
from obtaining informaiton about parts of the network that the
eavesdropper cannot directly access.
This sort of privacy can be provided by constructing artificial
Call-Ids to use in References headers, if References is inserted in
both requests and responses.

</p>
<a name="revision"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Revision History</h3>

<a name="00-01"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Changes from draft-worley-references-00 to draft-worley-references-01</h3>

<p>
Add the "rel" parameter.

</p>
<p>
Note that References will usually appear in the dialog-forming request.

</p>
<p>
Note that References may appear in a response.

</p>
<p>
Add the "Related Work" section.

</p>
<a name="00"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
draft-worley-references-00</h3>

<p>
Initial version.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="sip">[sip]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="service-examples">[service-examples]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://tools.ietf.org/html/rfc5359">Session Initiation Protocol Service Examples</a>,&rdquo; RFC&nbsp;5359, October&nbsp;2008 (<a href="http://www.ietf.org/rfc/rfc5359.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="message-format">[message-format]</a></td>
<td class="author-text">Resnick, P., &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.ietf.org/rfc/rfc5322.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="loreto-correlation">[loreto-correlation]</a></td>
<td class="author-text">Loreto, S. and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/draft-loreto-sipping-dialog-correlation-01">The Session Initiation Protocol (SIP) Dialog Correlation</a>,&rdquo; I-D&nbsp;draft-loreto-sipping-dialog-correlation-01, June&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="kaplan-session">[kaplan-session]</a></td>
<td class="author-text">Kaplan, H., &ldquo;<a href="http://tools.ietf.org/html/draft-kaplan-sip-session-id-00">A Session Identifier for the Session Initiation Protocol (SIP)</a>,&rdquo; I-D&nbsp;draft-kaplan-sip-session-id-00, November&nbsp;2008.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dale R. Worley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel Networks Corp.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">600 Technology Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Billerica, MA  01821</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 978 288 5505</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dworley@nortel.com">dworley@nortel.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.nortel.com">http://www.nortel.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
