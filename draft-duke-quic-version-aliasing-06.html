<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>QUIC Version Aliasing</title>
<meta content="Martin Duke" name="author">
<meta content="
       The QUIC transport protocol preserves its future extensibility partly by
specifying its version number. There will be a relatively small number of
published version numbers for the foreseeable future. This document provides a
method for clients and servers to negotiate the use of other version numbers in
subsequent connections and encrypts Initial Packets using secret keys instead of
standard ones. If a sizeable subset of QUIC connections use this mechanism, this
should prevent middlebox ossification around the current set of published
version numbers and the contents of QUIC Initial packets, as well as improving
the protocol's privacy properties. 
    " name="description">
<meta content="xml2rfc 3.7.0" name="generator">
<meta content="draft-duke-quic-version-aliasing-06" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.7.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.4.1
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 56.2.0
    six 1.16.0
-->
<link href="/tmp/draft-duke-quic-version-aliasing-06-ujeg4ar9.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">QUIC Version Aliasing</td>
<td class="right">May 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Duke</td>
<td class="center">Expires 14 November 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">QUIC</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-duke-quic-version-aliasing-06</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-05-13" class="published">13 May 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-11-14">14 November 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Duke</div>
<div class="org">F5 Networks, Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">QUIC Version Aliasing</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The QUIC transport protocol preserves its future extensibility partly by
specifying its version number. There will be a relatively small number of
published version numbers for the foreseeable future. This document provides a
method for clients and servers to negotiate the use of other version numbers in
subsequent connections and encrypts Initial Packets using secret keys instead of
standard ones. If a sizeable subset of QUIC connections use this mechanism, this
should prevent middlebox ossification around the current set of published
version numbers and the contents of QUIC Initial packets, as well as improving
the protocol's privacy properties.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    mailing list (quic@ietf.org),
  which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/quic/">https://mailarchive.ietf.org/arch/browse/quic/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/martinduke/quic-version-aliasing">https://github.com/martinduke/quic-version-aliasing</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 14 November 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-protocol-overview" class="xref">Protocol Overview</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-relationship-to-ech-and-qui" class="xref">Relationship to ECH and QUIC Protected Initials</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-the-version-alias-transport" class="xref">The Version Alias Transport Parameter</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-version-number-generation" class="xref">Version Number Generation</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-initial-token-extension-ite" class="xref">Initial Token Extension (ITE) Generation</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-salt-and-packet-length-offs" class="xref">Salt and Packet Length Offset Generation</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-expiration-time" class="xref">Expiration Time</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-format" class="xref">Format</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-multiple-servers-for-one-do" class="xref">Multiple Servers for One Domain</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.7">
                <p id="section-toc.1-1.3.2.7.1"><a href="#section-3.7" class="xref">3.7</a>.  <a href="#name-multiple-entities-with-one-" class="xref">Multiple Entities With One Load Balancer</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-client-behavior" class="xref">Client Behavior</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-the-aliasing_parameters-tra" class="xref">The aliasing_parameters Transport Parameter</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-server-actions-on-aliased-v" class="xref">Server Actions on Aliased Version Numbers</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-fallback" class="xref">Fallback</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-bad-salt-packets" class="xref">Bad Salt Packets</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-client-response-to-bad-salt" class="xref">Client Response to Bad Salt</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-server-response-to-version_" class="xref">Server Response to version_aliasing Transport Parameter</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-considerations-for-retry-pa" class="xref">Considerations for Retry Packets</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-and-privacy-consid" class="xref">Security and Privacy Considerations</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-endpoint-impersonation" class="xref">Endpoint Impersonation</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-first-connection-privacy" class="xref">First-Connection Privacy</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-forcing-downgrade" class="xref">Forcing Downgrade</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-initial-packet-injection" class="xref">Initial Packet Injection</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="xref">8.5</a>.  <a href="#name-retry-injection" class="xref">Retry Injection</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="xref">8.6</a>.  <a href="#name-increased-linkability" class="xref">Increased Linkability</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.7">
                <p id="section-toc.1-1.8.2.7.1"><a href="#section-8.7" class="xref">8.7</a>.  <a href="#name-salt-polling" class="xref">Salt Polling</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.8">
                <p id="section-toc.1-1.8.2.8.1"><a href="#section-8.8" class="xref">8.8</a>.  <a href="#name-server-fingerprinting" class="xref">Server Fingerprinting</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.9">
                <p id="section-toc.1-1.8.2.9.1"><a href="#section-8.9" class="xref">8.9</a>.  <a href="#name-increased-processing-of-gar" class="xref">Increased Processing of Garbage UDP Packets</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.10">
                <p id="section-toc.1-1.8.2.10.1"><a href="#section-8.10" class="xref">8.10</a>. <a href="#name-increased-retry-overhead" class="xref">Increased Retry Overhead</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.11">
                <p id="section-toc.1-1.8.2.11.1"><a href="#section-8.11" class="xref">8.11</a>. <a href="#name-request-forgery" class="xref">Request Forgery</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-quic-version-registry" class="xref">QUIC Version Registry</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-quic-transport-parameter-re" class="xref">QUIC Transport Parameter Registry</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-quic-transport-error-codes-" class="xref">QUIC Transport Error Codes Registry</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-change-log" class="xref">Change Log</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-b.1" class="xref">B.1</a>.  <a href="#name-since-draft-duke-quic-versi" class="xref">since draft-duke-quic-version-aliasing-05</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-b.2" class="xref">B.2</a>.  <a href="#name-since-draft-duke-quic-versio" class="xref">since draft-duke-quic-version-aliasing-04</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#section-b.3" class="xref">B.3</a>.  <a href="#name-since-draft-duke-quic-version" class="xref">since draft-duke-quic-version-aliasing-03</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#section-b.4" class="xref">B.4</a>.  <a href="#name-since-draft-duke-quic-version-" class="xref">since draft-duke-quic-version-aliasing-02</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.12.2.5">
                <p id="section-toc.1-1.12.2.5.1"><a href="#section-b.5" class="xref">B.5</a>.  <a href="#name-since-draft-duke-quic-version-a" class="xref">since draft-duke-quic-version-aliasing-01</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.12.2.6">
                <p id="section-toc.1-1.12.2.6.1"><a href="#section-b.6" class="xref">B.6</a>.  <a href="#name-since-draft-duke-quic-version-al" class="xref">since draft-duke-quic-version-aliasing-00</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The QUIC version number is critical to future extensibility of the protocol
(<span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>). Past experience with other
protocols, such as TLS1.3 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, shows that middleboxes might attempt to
enforce that QUIC packets use versions known at the time the middlebox was
implemented. This has a chilling effect on deploying experimental and standard
versions on the internet.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">Each version of QUIC has a "salt" <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span> that is used
to derive the keys used to encrypt Initial packets. As each salt is published in
a standards document, any observer can decrypt these packets and inspect the
contents, including a TLS Client Hello. A subsidiary mechanism like Encrypted
Client Hello <span>[<a href="#ECHO" class="xref">ECHO</a>]</span> might protect some of the TLS fields
inside a TLS Client Hello.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document proposes "QUIC Version Aliasing," a standard way for servers to
advertise the availability of other versions inside the cryptographic
protection of a QUIC handshake. These versions are syntactically identical to
the QUIC version in which the communication takes place, but use a different
salt. In subsequent communications, the client uses the new version number and
encrypts its Initial packets with a key derived from the provided salt. These
version numbers and salts are unique to the client.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">If a large subset of QUIC traffic adopts his technique, middleboxes will be
unable to enforce particular version numbers or policy based on Client Hello
contents without incurring unacceptable penalties on users. This would
simultaneously protect the protocol against ossification and improve its privacy
properties.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="terminology">
<section id="section-1.1">
        <h3 id="name-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be
interpreted as described in RFC 2119 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">In this document, these words will appear with that interpretation only when in
ALL CAPS.  Lower case uses of these words are not to be interpreted as carrying
significance described in RFC 2119.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">A "standard version" is a QUIC version that would be advertised in a QUIC
version negotiation and conforms to a specification. Any aliased version
corresponds to a standard version in all its formats and behaviors, except for
the version number field in long headers. To be compatible with version aliasing,
the first client packet in a standard version MUST encode the packet type and
token as if it were a QUIC version 1 initial packet. That is:<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.1-4.1">The most significant bit MUST be 1.<a href="#section-1.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.2">The third and fourth most significant bits MUST be zero.<a href="#section-1.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.3">The first field after the Source Connection ID MUST be a variable-length
integer including the length of a token.<a href="#section-1.1-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.4">The second field after the Destination Connection ID MUST be a field, with
length indicated by the previous field, that contains opaque data generated by
the server.<a href="#section-1.1-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.1-4.5">There must be a variable-length integer that encodes the packet length,
unprotected in the header.<a href="#section-1.1-4.5" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.1-5">An "aliased version" is a version with a number generated in accordance with
this document. Except for the version field in long headers, it conforms
entirely to the specification of the standard version.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="protocol-overview">
<section id="section-2">
      <h2 id="name-protocol-overview">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
      </h2>
<p id="section-2-1">When they instantiate a connection, servers select an alternate 32-bit version
number, and optionally an initial token extension, for the next connection at
random and securely derive a salt and Packet Length Offset from those values
using a repeatable process. They communicate this using a transport parameter
extension including the version, initial token extension, salt, Packet Length
Offset, and an expiration time for that value.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">If a client next connects to that server within the indicated expiration time,
it MAY use the provided version number and encrypt its Initial Packets using a
key derived from the provided salt. It adds the Packet Length Offset to the
true packet length when encoding it in the long header. If the server provided
an Initial Token Extension, the client puts it in the Initial Packet token
field. If there is another token the client wishes to include, it appends the
Initial Token Extension to that token. The server can reconstruct the salt and
Packet Length Offset from the requested version and token, and proceed with the
connection normally.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">The Packet Length Offset provides a low-cost way for the server to verify it can
derive a valid salt from the inputs without trial decryption. This has important
security implications, as described in <a href="#retry-injection" class="xref">Section 8.5</a>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">When generating a salt and Packet Length Offset, servers can choose between
doing so randomly and storing the mapping, or using a cryptographic process to
transform the aliased version number and token extension into the salt. The two
options provide a simple tradeoff between computational complexity and storage
requirements.<a href="#section-2-4" class="pilcrow">¶</a></p>
<div id="relationship-to-ech-and-quic-protected-initials">
<section id="section-2.1">
        <h3 id="name-relationship-to-ech-and-qui">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-relationship-to-ech-and-qui" class="section-name selfRef">Relationship to ECH and QUIC Protected Initials</a>
        </h3>
<p id="section-2.1-1">The TLS Encrypted Client Hello <span>[<a href="#ECHO" class="xref">ECHO</a>]</span> shares some goals with
this document. It encodes an "inner" encrypted Client Hello in a TLS extension
in an "outer" Client Hello. The encryption uses asymmetric keys with the
server's public key distributed via an out-of-band mechanism like DNS. The
inner Client Hello contains any privacy-sensitive information and is only
readable with the server's private key.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">Significantly, unlike QUIC Version Aliasing, ECH can operate on the first
connection between a client and server. However, from the second connection
QUIC version aliasing provides additional benefits. It:<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-3.1">greases QUIC header fields and packet formats;<a href="#section-2.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.2">protects all of the TLS Client Hello and Server Hello;<a href="#section-2.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.3">mitigates Retry injection attacks;<a href="#section-2.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.4">does not require a mechanism to distribute the public key;<a href="#section-2.1-3.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.5">uses smaller Client Hello messages, which might allow a larger 0RTT packet
in the same datagram; and<a href="#section-2.1-3.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.1-3.6">relies on computationally cheap symmetric encryption.<a href="#section-2.1-3.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-2.1-4">If ECH is operating in "Split Mode", where a client-facing server is using the
SNI information to route to a backend server, the client-facing server MUST
have the cryptographic context relevant to version aliasing at the backend
server to successfully extract the SNI for routing purposes. Furthermore, either
all backend servers must share this context, or the client-facing server must
trial decrypt the incoming packet with all possible derived salts.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.1-5">Note that in the event of the server losing state, the two approaches have a
similar fallback: ECH uses information in the outer Client Hello, and Version
Aliasing requires a connection using a standard version. In either case,
maintaining privacy requires the outer or standard version Client Hello to
exclude privacy-sensitive information. However, ECH will allow confidential
transmission of data in 1 RTT, while Version Aliasing requires 2 RTTs to resume.
This mechanism is also relevant to mitigation of downgrade attacks (see
<a href="#downgrade" class="xref">Section 8.3</a>).<a href="#section-2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.1-6">Similarly, the QUIC Protected Initial
<span>[<a href="#QUIC-PI" class="xref">QUIC-PI</a>]</span> uses the ECH distribution mechanism
to generate secure initial keys and Retry integrity tags. While still dependent
on a key distribution system, asymmetric encryption, and relatively large Initial
packets, it offers similar protection properties to Version Aliasing while still
not greasing the version field.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
<p id="section-2.1-7">A maximally privacy-protecting client might use Protected Initials for any
connection attempts for which it does not have an unexpired aliased version, and
QUIC version aliasing otherwise.<a href="#section-2.1-7" class="pilcrow">¶</a></p>
<p id="section-2.1-8">See also section 1.1 of <span>[<a href="#QUIC-PI" class="xref">QUIC-PI</a>]</span> for further discussion of tradeoffs.<a href="#section-2.1-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="the-version-alias-transport-parameter">
<section id="section-3">
      <h2 id="name-the-version-alias-transport">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-the-version-alias-transport" class="section-name selfRef">The Version Alias Transport Parameter</a>
      </h2>
<div id="version-number-generation">
<section id="section-3.1">
        <h3 id="name-version-number-generation">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-version-number-generation" class="section-name selfRef">Version Number Generation</a>
        </h3>
<p id="section-3.1-1">Servers MUST use a random process to generate version numbers. This version
number MUST NOT correspond to a QUIC version the server advertises in QUIC
Version Negotiation packets or transport parameters. Servers SHOULD also
exclude version numbers used in known specifications or experiments to avoid
confusion at clients, whether or not they have plans to support those
specifications.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Servers MAY use version numbers reserved for grease in Section 15.1 of
<span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>, even though they might be advertised in Version Negotiation
Packets.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">Servers MUST NOT use client-controlled information (e.g. the client IP address)
in the random process, see <a href="#salt-polling" class="xref">Section 8.7</a>.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4">Servers MUST NOT advertise these versions in QUIC Version Negotiation packets.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="initial-token-extension-ite-generation">
<section id="section-3.2">
        <h3 id="name-initial-token-extension-ite">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-initial-token-extension-ite" class="section-name selfRef">Initial Token Extension (ITE) Generation</a>
        </h3>
<p id="section-3.2-1">Servers SHOULD generate an Initial Token Extension (ITE) to provide additional
entropy in salt generation. Two clients that receive the same version number but
different extensions will not be able to decode each other's Initial Packets.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">Servers MAY choose any length that will allow client Initial Packets to fit
within the minimum QUIC packet size of 1200 octets. A four-octet extension is
RECOMMENDED. The ITE MUST appear to be random to observers.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">If a server supports multiple standard versions, it MUST either encode the
standard version of the current connection in the ITE or store it in a lookup
table.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2-4">If the server chooses to encode the standard version, it MUST be
cryptographically protected.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">Encoded standard versions MUST be robust to false positives. That is, if decoded
with a new key, the version encoding must return as invalid, rather than an
incorrect value.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">Alternatively, servers MAY store a mapping of unexpired aliased versions and
ITEs to standard versions. This mapping SHOULD NOT create observable patterns,
e.g. one plaintext bit indicates if the standard version is 1 or 2.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
<p id="section-3.2-7">The server MUST be able to distinguish ITEs from Resumption and Retry tokens in
incoming Initial Packets that contain an aliased version number. As the server
controls the lengths and encoding of each, there are many ways to guarantee
this.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="salt-and-packet-length-offset-generation">
<section id="section-3.3">
        <h3 id="name-salt-and-packet-length-offs">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-salt-and-packet-length-offs" class="section-name selfRef">Salt and Packet Length Offset Generation</a>
        </h3>
<p id="section-3.3-1">The salt is an opaque 20-octet field. It is used to generate Initial connection
keys using the process described in <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">The Packet Length Offset is a 64-bit unsigned integer with a maximum value of
2^62 - 1. Clients MUST ignore a transport parameter with a value that exceeds
this limit.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">To reduce header overhead, servers MAY consistently use a Packet Length Offset
of zero if and only if it either (1) never sends Retry packets, or (2) can
guarantee, through the use of persistent storage or other means, that it will
never lose the cryptographic state required to generate the salt before the
promised expiration time. <a href="#retry-injection" class="xref">Section 8.5</a> describes the implications if it
uses zero without meeting these conditions.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<p id="section-3.3-4">Servers MUST either generate a random salt and Packet Length Offset and store a
mapping of aliased version and ITE to salt and offset, or generate the salt and
offset using a cryptographic method that uses the version number, ITE, and only
server state that is persistent across connections.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">If the latter, servers MUST implement a method that it can repeat
deterministically at a later time to derive the salt and offset from the
incoming version number and ITE. It MUST NOT use client controlled information
other than the version number and ITE; for example, the client's IP address and
port.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="expiration-time">
<section id="section-3.4">
        <h3 id="name-expiration-time">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-expiration-time" class="section-name selfRef">Expiration Time</a>
        </h3>
<p id="section-3.4-1">Servers should select an expiration time in seconds, measured from the instant
the transport parameter is first sent. This time SHOULD be less than the time
until the server expects to support new QUIC versions, rotate the keys used
to encode information in the version number, or rotate the keys used in salt
generation.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">Furthermore, the expiration time SHOULD be short enough to frustrate a salt
polling attack (<a href="#salt-polling" class="xref">Section 8.7</a>)<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">Conversely, an extremely short expiration time will often force the client to
use standard QUIC version numbers and salts.<a href="#section-3.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="format">
<section id="section-3.5">
        <h3 id="name-format">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-format" class="section-name selfRef">Format</a>
        </h3>
<p id="section-3.5-1">This document defines a new transport parameter extension for QUIC with
provisional identifier 0x5641. The contents of the value field are indicated
below.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<span id="name-version-alias-transport-par"></span><div id="fig-transport-parameter">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-3.5-2.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Version (32)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                                                               +
|                                                               |
+                                                               +
|                            Salt (160)                         |
+                                                               +
|                                                               |
+                                                               +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Packet Length Offset (i)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Expiration (i)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Initial Token Extension (variable)             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-version-alias-transport-par" class="selfRef">Version Alias Transport Parameter value</a>
          </figcaption></figure>
</div>
<p id="section-3.5-3">The definition of the fields is described above. Note that the "Expiration"
field is in seconds, and its length is encoded using the Variable Length
Integer encoding from Section 16 of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">The Packet Length Offset is also encoded as a Variable Length Integer.<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<p id="section-3.5-5">Clients can compute the length of the Initial Token Extension by subtracting
known and encoded field lengths from the overall transport parameter length.<a href="#section-3.5-5" class="pilcrow">¶</a></p>
<p id="section-3.5-6">Note that servers that support version aliasing need not send the transport
parameter on every connection. Therefore, a client MAY attempt to connect with
an unexpired aliased version, even if in its most recent connection it did not
receive the transport parameter.<a href="#section-3.5-6" class="pilcrow">¶</a></p>
<p id="section-3.5-7">Clients MAY remember the value in this transport parameter for future
connections. Servers MUST either store the contents of the transport parameter,
or preserve the state to compute the full contents based on what the client
provides.<a href="#section-3.5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-servers-for-one-domain">
<section id="section-3.6">
        <h3 id="name-multiple-servers-for-one-do">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-multiple-servers-for-one-do" class="section-name selfRef">Multiple Servers for One Domain</a>
        </h3>
<p id="section-3.6-1">If multiple servers serve the same entity behind a load balancer, all such
servers SHOULD either have a common configuration for encoding standard versions
and computing salts, or share a common database of mappings. They MUST NOT
generate version numbers that any of them would advertise in a Version
Negotiation Packet or Transport Parameter.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-entities-with-one-load-balancer">
<section id="section-3.7">
        <h3 id="name-multiple-entities-with-one-">
<a href="#section-3.7" class="section-number selfRef">3.7. </a><a href="#name-multiple-entities-with-one-" class="section-name selfRef">Multiple Entities With One Load Balancer</a>
        </h3>
<p id="section-3.7-1">If mutually mistrustful entities share the same IP address and port, incoming
packets are usually routed by examining the SNI at a load balancer server that
routes the traffic. This use case makes concealing the contents of the Client
Initial especially attractive, as the IP address reveals less information. There
are several solutions to solve this problem.<a href="#section-3.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.7-2.1">All entities have a common crytographic context for deriving salts and Packet
Length Offsets from the version number and ITE. This is straightforward but also
increases the risk that the keys will leak to an attacker which could then
decode Initial packets from point where the packets are observable. This is
therefore NOT RECOMMENDED.<a href="#section-3.7-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.7-2.2">Each entity has its own cryptographic context, shared with the load balancer.
This requires the load balancer to trial decrypt each incoming Initial with
each context. As there is no standard algorithm for encoding information in the
Version and ITE, this involves synchronizing the method, not just the key
material.<a href="#section-3.7-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.7-2.3">Each entity reports its Version Aliasing Transport Parameters to the load
balancer out-of-band.<a href="#section-3.7-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.7-2.4">Each entity is assigned certain version numbers for use. This assignment
SHOULD NOT follow observable patterns (e.g., assigning ranges to each entity),
as this would allow observers to obtain the target server based on the version.
The scheme SHOULD assign all available version numbers to maximize the entropy
of the encoding.<a href="#section-3.7-2.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.7-3">Note that <span>[<a href="#ECHO" class="xref">ECHO</a>]</span> and <span>[<a href="#QUIC-PI" class="xref">QUIC-PI</a>]</span> solve this problem elegantly by only holding
the private key at the load balancer, which decodes the sensitive information on
behalf of the back-end server.<a href="#section-3.7-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="client-behavior">
<section id="section-4">
      <h2 id="name-client-behavior">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-client-behavior" class="section-name selfRef">Client Behavior</a>
      </h2>
<p id="section-4-1">When a client receives the Version Alias Transport Parameter, it MAY cache the
version number, ITE, salt, Packet Length Offset, and the expiration of these
values. It MAY use the version number and ITE in a subsequent connection and
compute the initial keys using the provided salt.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The Client MUST NOT use the contents of a Version Alias transport parameter if
the handshake does not (1) later authenticate the server name or (2)
result in both endpoints computing the same 1-RTT keys. See <a href="#impersonation" class="xref">Section 8.1</a>.
The authenticated server name MAY be a "public name" distributed as described in
<span>[<a href="#ECHO" class="xref">ECHO</a>]</span> rather than the true target domain.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Clients MUST NOT advertise aliased versions in the Version Negotiation Transport
Parameter unless they support a standard version with the same number. Including
that number signals support for the standard version, not the aliased version.<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Clients SHOULD NOT attempt to use the provided version number and salt after
the provided Expiration time has elapsed.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Clients MAY decline to use the provided version number or salt in more than one
connection. It SHOULD do so if its IP address has changed between two connection
attempts. Using a consistent version number can link the client across
connection attempts.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">Clients MUST use the same standard version to format the Initial Packet as the
standard version used in the connection that provided the aliased version.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">If the server provided an ITE, the client MUST append it to any Initial Packet
token it is including from a Retry packet or NEW_TOKEN frame, if it is using
the associated aliased version. If there is no such token, it simply includes
the ITE as the entire token.<a href="#section-4-7" class="pilcrow">¶</a></p>
<p id="section-4-8">When using an aliased version, the client MUST include a aliasing_parameters
transport parameter in its Client Hello.<a href="#section-4-8" class="pilcrow">¶</a></p>
<p id="section-4-9">The QUIC Token Length field MUST include the length of both any Retry or
NEW_TOKEN token and the ITE.<a href="#section-4-9" class="pilcrow">¶</a></p>
<p id="section-4-10">The Length fields of all Initial, Handshake, and 0-RTT packets in the
connection are set to the value described in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> plus the
provided Packet Length Offset, modulo 2^62.<a href="#section-4-10" class="pilcrow">¶</a></p>
<p id="section-4-11">If a client receives an aliased version number that matches a standard version
that the client supports, it SHOULD assume the server does not support the
standard version and MUST use aliased version behaviors in any connection with
the server using that version number.<a href="#section-4-11" class="pilcrow">¶</a></p>
<p id="section-4-12">If the response to an Initial packet using the provided version is a Version
Negotiation Packet, the client SHOULD assume that the server no longer supports
version aliasing and attempt to connect with one of the advertised versions
(while observing the considerations in <a href="#downgrade" class="xref">Section 8.3</a>).<a href="#section-4-12" class="pilcrow">¶</a></p>
<p id="section-4-13">If the response to an Initial packet is a Bad Salt packet, the client follows
the procedures in <a href="#fallback" class="xref">Section 6</a>.<a href="#section-4-13" class="pilcrow">¶</a></p>
<div id="the-aliasingparameters-transport-parameter">
<section id="section-4.1">
        <h3 id="name-the-aliasing_parameters-tra">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-the-aliasing_parameters-tra" class="section-name selfRef">The aliasing_parameters Transport Parameter</a>
        </h3>
<p id="section-4.1-1">This transport parameter has the following format. Its provisional type is
0x4150.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-2">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Version (32)                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Initial Token (variable)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">The Version field matches the one in the packet header.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">The Initial Token field matches the Initial Token in the packet header,
including any Retry token, NEW_TOKEN token, and Initial Token Extension. Its
length is inferred from the specified length of the parameter.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">The purpose of this parameter is to validate the contents of these header
fields by including it in the TLS handshake transcript.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server-actions">
<section id="section-5">
      <h2 id="name-server-actions-on-aliased-v">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-server-actions-on-aliased-v" class="section-name selfRef">Server Actions on Aliased Version Numbers</a>
      </h2>
<p id="section-5-1">When a server receives an Initial packet with an unsupported version number, it
SHOULD send a Version Negotiation Packet if it is configured not to generate
that version number at random.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">Otherwise, it extracts the ITE, if any, and either looks up the corresponding
salt in its database or computes it using the technique originally used to
derive the salt from the version number and ITE.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The server similarly obtains the Packet Length Offset and subtracts it from the
provided Length field, modulo 2^62. If the resulting value is larger than the
entire UDP datagram, the server discards the packet and SHOULD follow the
procedure in <a href="#fallback" class="xref">Section 6</a>. The server MAY apply further checks (e.g. against the
minimum QUIC packet length) to further reduce the very small probability of a
false positive.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">If the server supports multiple standard versions, it uses the standard version
extracted by the ITE or stored in the mapping to parse the decrypted packet.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">In all packets with long headers, the server uses the aliased version number
and adds the Packet Length Offset to the length field.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">In the extremely unlikely event that the Packet Length Offset resulted in a
legal value but the salt is incorrect, the packet may fail authentication. The
server should drop these packets in case this is the result of packet corruption
along the path.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">To reduce linkability for the client, servers SHOULD provide a new Version Alias
transport parameter, with a new version number, ITE, salt, and Packet Length
Offset, each time a client connects. However, issuing version numbers to a
client SHOULD be rate-limited to mitigate the salt polling attack
<a href="#salt-polling" class="xref">Section 8.7</a> and MAY cease to clients that are consistently connecting with
standard versions.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">If there is no aliasing_parameters transport parameter, or the contents do not
match the fields in the Initial header, the server MUST terminate the
connection with a TRANSPORT_PARAMETER_ERROR.<a href="#section-5-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="fallback">
<section id="section-6">
      <h2 id="name-fallback">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-fallback" class="section-name selfRef">Fallback</a>
      </h2>
<p id="section-6-1">If the server has lost its encryption state, it may not be able to generate
the correct salts from previously provided versions and ITEs. The fallback
mechanism provides a means of recovering from this state while protecting
against injection of messages by attackers.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">When the packet length computation in <a href="#server-actions" class="xref">Section 5</a> fails, it signals
either that the packet has been corrupted in transit, or the client is using a
transport parameter issued before a server failure. In either case, the server
sends a Bad Salt packet.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="bad-salt-packets">
<section id="section-6.1">
        <h3 id="name-bad-salt-packets">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-bad-salt-packets" class="section-name selfRef">Bad Salt Packets</a>
        </h3>
<p id="section-6.1-1">The Bad Salt packet has a long header and a reserved version number, because it
must not be confused with a legitimate packet in any standard version. They are
not encrypted, not authenticated, and have the following format:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.1-2">
<pre>
Bad Salt Packet {
    Header Form (1) = 1,
    Unused (7),
    Version (32) = TBD (provisional value = 0x56415641),
    Destination Connection ID Length (8),
    Destination Connection ID (0..2040),
    Source Connection ID Length (8),
    Source Connection ID (0..2040),
    Supported Version (32) ...,
    Integrity Tag (128),
}
</pre><a href="#section-6.1-2" class="pilcrow">¶</a>
</div>
<p id="section-6.1-3">Unused: The unused field is filled randomly by the sender and ignored on
receipt.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">Version: The version field is reserved for use by the Bad Salt packet.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">Destination and Source Connection IDs and Lengths: These fields are copied from
the client packet, with the source fields from the client packet written into
the destination fields of the Bad Salt, and vice versa.<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">Supported Version: A list of standard QUIC version numbers which the server
supports. The number of versions is inferred from the length of the datagram.<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<p id="section-6.1-7">Integrity Tag: To compute the integrity tag, the server creates a pseudo-packet
by contents of the entire client Initial UDP payload, including any coalesced
packets, with the Bad Salt packet:<a href="#section-6.1-7" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6.1-8">
<pre>
Bad Salt Pseudo-Packet {
    Client UDP Payload (9600..),
    Header Form (1) = 1,
    Unused (7),
    Version (32) = TBD (provisional value = 0x56415641),
    Destination Connection ID Length (8),
    Destination Connection ID (0..2040),
    Source Connection ID Length (8),
    Source Connection ID (0..2040),
    Supported Version (32) ...,
}
</pre><a href="#section-6.1-8" class="pilcrow">¶</a>
</div>
<p id="section-6.1-9">In a process similar to the Retry Integrity Tag, the Bad Salt Integrity Tag is
computed as the output of AEAD_AES_128_GCM with the following inputs:<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-10.1">The secret key, K, is 0xbe0c690b9f66575a1d766b54e368c84e.<a href="#section-6.1-10.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-10.2">The nonce, N, is 0x461599d35d632bf2239825bb.<a href="#section-6.1-10.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-10.3">The plaintext, P, is empty.<a href="#section-6.1-10.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-10.4">The associated data, A, is the Bad Salt pseudo-packet.<a href="#section-6.1-10.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-11">These values are derived using HKDF-Expand-Label from the secret
0x767fedaff519a2aad117d8fd3ce0a04178ed205ab0d43425723e436853c4b3e2 and labels
"quicva key" and "quicva iv".<a href="#section-6.1-11" class="pilcrow">¶</a></p>
<p id="section-6.1-12">The integrity tag serves to validate the integrity of both the Bad Salt packet
itself and the Initial packet that triggered it.<a href="#section-6.1-12" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-response-to-bad-salt">
<section id="section-6.2">
        <h3 id="name-client-response-to-bad-salt">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-client-response-to-bad-salt" class="section-name selfRef">Client Response to Bad Salt</a>
        </h3>
<p id="section-6.2-1">Upon receipt of a Bad Salt packet, the client SHOULD wait for a Probe Timeout
(PTO) to check if the Bad Salt packet was injected by an attacker, and a valid
response arrives from the actual server.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">After waiting, the client checks the Integrity Tag using its record of the
Initial it sent. If this fails, the client SHOULD assume packet corruption and
resend the Initial packet.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">If the verification succeeds, the client SHOULD attempt to connect with one of
the listed standard versions. It SHOULD observe the privacy considerations in
<a href="#first-connection" class="xref">Section 8.2</a>. It MUST include a version_aliaising Transport Parameter
in the Client Hello, that enumerates the aliased version and parameters it just
tried to connect with.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">Once it sends this transport parameter, the client MUST NOT attempt to connect
with that aliased version again.<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">The original Client Initial is not part of the new connection. Therefore, the
Connection IDs can change, and the original client hello is not part of the
transcript for TLS key derivation.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<p id="section-6.2-6">Note that the client never sends this transport parameter with an aliased
version. A server that receives such a packet MUST terminate the connection with
a TRANSPORT_PARAMETER_ERROR.<a href="#section-6.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-response-to-versionaliasing-transport-parameter">
<section id="section-6.3">
        <h3 id="name-server-response-to-version_">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-server-response-to-version_" class="section-name selfRef">Server Response to version_aliasing Transport Parameter</a>
        </h3>
<p id="section-6.3-1">A client version_aliasing transport parameter tells the server that the client
received a Bad Salt packet. The server checks if could have generated that
version aliasing transport parameter given its current configuration; i.e. if
using the version and ITE as inputs results in the same salt and Packet Length
Offset.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">If the salt or Packet Length Offset are invalid, the server SHOULD continue with
the connection and SHOULD issue a new version_aliasing transport parameter.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
<p id="section-6.3-3">If the salt and Packet Length Offset are valid, the server MUST terminate the
connection with the error code INVALID_BAD_SALT.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="considerations-for-retry-packets">
<section id="section-7">
      <h2 id="name-considerations-for-retry-pa">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-considerations-for-retry-pa" class="section-name selfRef">Considerations for Retry Packets</a>
      </h2>
<p id="section-7-1">QUIC Retry packets reduce the load on servers during periods of stress by
forcing the client to prove it possesses the IP address before the server
decrypts any Initial Packets or establishes any connection state. Version
aliasing substantially complicates the process.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">If a server has to send a Retry packet, the required format is ambiguous without
understanding which standard version to use. If all supported standard versions
use the same Retry format, it simply uses that format with the client-provided
version number.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">If the supported standard versions use different Retry formats, the server
obtains the standard version via lookup or decoding and formats a Retry
containing the aliased version number accordingly.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">Servers generate the Retry Integrity Tag of a Retry Packet using the procedure
in Section 5.8 of <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>. However, for aliased versions, the secret key K
uses the first 16 octets of the aliased salt instead of the key provided in the
specification.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Clients MUST ignore Retry packets that contain a QUIC version other than the
version it used in its Initial Packet.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">Servers MUST NOT reply to a packet with an incorrect Length field in its long
header with a Retry packet; it SHOULD reply with Bad Salt as described above.<a href="#section-7-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-and-privacy-considerations">
<section id="section-8">
      <h2 id="name-security-and-privacy-consid">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-and-privacy-consid" class="section-name selfRef">Security and Privacy Considerations</a>
      </h2>
<p id="section-8-1">This document intends to improve the existing security and privacy properties of
QUIC by dramatically improving the secrecy of QUIC Initial Packets. However,
there are new attacks against this mechanism.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="impersonation">
<section id="section-8.1">
        <h3 id="name-endpoint-impersonation">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-endpoint-impersonation" class="section-name selfRef">Endpoint Impersonation</a>
        </h3>
<p id="section-8.1-1">An on-path attacker might respond to an Initial Packet with a standard version
with a Version Aliasing Transport Parameter that then caused the client to
reveal sensitive information in a subsequent Initial.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">As described in <a href="#client-behavior" class="xref">Section 4</a>, clients cannot use the contents of a
Version Aliasing transport parameter until they have authenticated the source
as a trusted domain, and have verified that the 1RTT key derivation is
identical at both endpoints.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="first-connection">
<section id="section-8.2">
        <h3 id="name-first-connection-privacy">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-first-connection-privacy" class="section-name selfRef">First-Connection Privacy</a>
        </h3>
<p id="section-8.2-1">As version aliasing requires one connection over a standard QUIC version to
acquire initial state, this initial connection leaks some information about
the true target.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">The client MAY alter its Initial Packet to sanitize sensitive information and
obtain another aliased version before proceeding with its true request. However,
the client Initial must lead to the authentication of a domain name the client
trusts to provide accurate Version Aliasing information (possibly the
public_name from an Encrypted Client Hello configuration from <span>[<a href="#ECHO" class="xref">ECHO</a>]</span>). Advice
for the Outer ClientHello in Section 10.5 of <span>[<a href="#ECHO" class="xref">ECHO</a>]</span> applies here.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">Endpoints are encouraged to instead use <span>[<a href="#ECHO" class="xref">ECHO</a>]</span> or <span>[<a href="#QUIC-PI" class="xref">QUIC-PI</a>]</span> to increase
privacy on the first connection between a client and server.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="downgrade">
<section id="section-8.3">
        <h3 id="name-forcing-downgrade">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-forcing-downgrade" class="section-name selfRef">Forcing Downgrade</a>
        </h3>
<p id="section-8.3-1">An attacker can attempt to force a client to send an Initial that uses a
standard version by injecting a Version Negotiation packet (which implies the
server no longer supports aliasing) or a Bad Salt packet (which implies the
server has a new cryptographic context).<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">The weak form of this attack observes the Initial and injects the Version
Negotiation or Bad Salt packet, but cannot drop the Initial. To counteract this,
a client SHOULD NOT respond to these packets until they have waited for Probe
Timeout (PTO) for a valid server Initial to arrive.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">The strong form features an attacker that can drop Initial packets. In this
case, the client can either abandon the connection attempt or connect with an
standard version.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
<p id="section-8.3-4">If it connects with a standard version, it should consider the privacy advice
in <a href="#first-connection" class="xref">Section 8.2</a>.<a href="#section-8.3-4" class="pilcrow">¶</a></p>
<p id="section-8.3-5">Furthermore, if it received a Bad Salt packet, the client sends a Version
Aliasing transport parameter to detect the downgrade attack, and the server will
terminate the connection if the Bad Salt packet was an attack.<a href="#section-8.3-5" class="pilcrow">¶</a></p>
<p id="section-8.3-6">If the client received a Version Negotiation packet, it MUST implement a
downgrade detection mechanism such as <span>[<a href="#I-D.ietf-quic-version-negotiation" class="xref">I-D.ietf-quic-version-negotiation</a>]</span> or
abandon the connection attempt. If it subsequent detects a downgrade detection,
or discovers that the server does not support the same mechanism, it terminates
the connection attempt.<a href="#section-8.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="initial-packet-injection">
<section id="section-8.4">
        <h3 id="name-initial-packet-injection">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-initial-packet-injection" class="section-name selfRef">Initial Packet Injection</a>
        </h3>
<p id="section-8.4-1">QUIC version 1 handshakes are vulnerable to DoS from observers for the short
interval that endpoints keep Initial keys (usually ~1.5 RTTS), since Initial
Packets are not authenticated. With version aliasing, attackers do not have
the necessary keys to launch such an attack.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="retry-injection">
<section id="section-8.5">
        <h3 id="name-retry-injection">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-retry-injection" class="section-name selfRef">Retry Injection</a>
        </h3>
<p id="section-8.5-1">QUIC Version 1 Retry packets are spoofable, as they follow a fixed format, are
sent in plaintext, and the integrity protection uses a widely known key. As a
result, QUIC Version 1 has verification mechanisms in subsequent packets of the
connection to validate the origin of the Retry.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">Version aliasing largely frustrates this attack. As the integrity check key is
derived from the secret salt, packets from attackers will fail their integrity
check and the client will ignore them.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
<p id="section-8.5-3">The Packet Length Offset is important in this framework. Without this
mechanism, servers would have to perform trial decryption to verify the client
was using the correct salt. As this does not occur before sending Retry
Packets, servers would not detect disagreement on the salt beforehand and would
send a Retry packet signed with a different salt than the client expects.
Therefore, a client that received a Retry packet with an invalid integrity
check would not be able to distinguish between the following possibilities:<a href="#section-8.5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.5-4.1">a Retry packet corrupted in the network, which should be ignored;<a href="#section-8.5-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.5-4.2">a Retry packet generated by an attacker, which should be ignored; or<a href="#section-8.5-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.5-4.3">a Retry packet from a server that lost its cryptographic state, meaning that
further communication with aliased versions is impossible and the client should
revert to using a standard version.<a href="#section-8.5-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.5-5">The Packet Length Offset introduces sufficient entropy to make the third
possibility exceedingly unlikely.<a href="#section-8.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="increased-linkability">
<section id="section-8.6">
        <h3 id="name-increased-linkability">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-increased-linkability" class="section-name selfRef">Increased Linkability</a>
        </h3>
<p id="section-8.6-1">As each version number and ITE is unique to each client, if a client uses one
twice, those two connections are extremely likely to be from the same host. If
the client has changed IP address, this is a significant increase in linkability
relative to QUIC with a standard version numbers.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="salt-polling">
<section id="section-8.7">
        <h3 id="name-salt-polling">
<a href="#section-8.7" class="section-number selfRef">8.7. </a><a href="#name-salt-polling" class="section-name selfRef">Salt Polling</a>
        </h3>
<p id="section-8.7-1">Observers that wish to decode Initial Packets might open a large number of
connections to the server in an effort to obtain part of the mapping of version
numbers and ITEs to salts for a server. While storage-intensive, this attack
could increase the probability that at least some version-aliased connections
are observable. There are three mitigations servers can execute against this
attack:<a href="#section-8.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8.7-2.1">use a longer ITE to increase the entropy of the salt,<a href="#section-8.7-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-2.2">rate-limit transport parameters sent to a particular client, and/or<a href="#section-8.7-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.7-2.3">set a low expiration time to reduce the lifetime of the attacker's database.<a href="#section-8.7-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-8.7-3">Segmenting the version number space based on client information, i.e. using only
a subset of version numbers for a certain IP address range, would significantly
amplify an attack. Observers will generally be on the path to the client and be
able to mimic having an identical IP address. Segmentation in this way would
dramatically reduce the search space for attackers. Thus, servers are prohibited
from using this mechanism.<a href="#section-8.7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-fingerprinting">
<section id="section-8.8">
        <h3 id="name-server-fingerprinting">
<a href="#section-8.8" class="section-number selfRef">8.8. </a><a href="#name-server-fingerprinting" class="section-name selfRef">Server Fingerprinting</a>
        </h3>
<p id="section-8.8-1">The server chooses its own ITE length, and the length of this ITE is likely to
be discoverable to an observer. Therefore, the destination server of a client
Initial packet might be decipherable with an ITE length along with other
observables. A four-octet ITE is RECOMMENDED. Deviations from this value should
be carefully considered in light of this property.<a href="#section-8.8-1" class="pilcrow">¶</a></p>
<p id="section-8.8-2">Servers with acute needs for higher or lower entropy than provided by a four-
octet ITE are RECOMMENDED to converge on common lengths to reduce the
uniqueness of their signatures.<a href="#section-8.8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="increased-processing-of-garbage-udp-packets">
<section id="section-8.9">
        <h3 id="name-increased-processing-of-gar">
<a href="#section-8.9" class="section-number selfRef">8.9. </a><a href="#name-increased-processing-of-gar" class="section-name selfRef">Increased Processing of Garbage UDP Packets</a>
        </h3>
<p id="section-8.9-1">As QUIC shares the UDP protocol number with other UDP applications, in some
deployments it may be possible for traffic intended for other UDP applications
to arrive at a QUIC server endpoint. When servers support a finite set of
version numbers, a valid version number field is a strong indicator the packet
is, in fact, QUIC. If the version number is invalid, a QUIC Version Negotiation
is a low-cost response that triggers very early in packet processing.<a href="#section-8.9-1" class="pilcrow">¶</a></p>
<p id="section-8.9-2">However, a server that provides version aliasing is prepared to accept almost
any version number. As a result, many more sufficiently sized UDP payloads with
the first bit set to '1' are potential QUIC Initial Packets that require
computation of a salt and Packet Length Offset.<a href="#section-8.9-2" class="pilcrow">¶</a></p>
<p id="section-8.9-3">Note that a nonzero Packet Length Offset will allow the server to drop all but
approximately 1 in every 2^49 packets, so trial decryption is unnecessary.<a href="#section-8.9-3" class="pilcrow">¶</a></p>
<p id="section-8.9-4">While not a more potent attack then simply sending valid Initial Packets,
servers may have to provision additional resources to address this possibility.<a href="#section-8.9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="increased-retry-overhead">
<section id="section-8.10">
        <h3 id="name-increased-retry-overhead">
<a href="#section-8.10" class="section-number selfRef">8.10. </a><a href="#name-increased-retry-overhead" class="section-name selfRef">Increased Retry Overhead</a>
        </h3>
<p id="section-8.10-1">This document requires two small cryptographic operations to build a Retry
packet instead of one, placing more load on servers when already under load.<a href="#section-8.10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-forgery">
<section id="section-8.11">
        <h3 id="name-request-forgery">
<a href="#section-8.11" class="section-number selfRef">8.11. </a><a href="#name-request-forgery" class="section-name selfRef">Request Forgery</a>
        </h3>
<p id="section-8.11-1">Section 21.4 of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> describes the request forgery attack, where
a QUIC endpoint can cause its peer to deliver packets to a victim with specific
content.<a href="#section-8.11-1" class="pilcrow">¶</a></p>
<p id="section-8.11-2">Version aliasing allows the server to specify the contents of the version field
and part of the token field in Initial packets sent by the client, potentially
increasing the potency of this attack.<a href="#section-8.11-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-9">
      <h2 id="name-iana-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="quic-version-registry">
<section id="section-9.1">
        <h3 id="name-quic-version-registry">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-quic-version-registry" class="section-name selfRef">QUIC Version Registry</a>
        </h3>
<p id="section-9.1-1">This document request that IANA add the following entry to the QUIC version
registry:<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">Value: TBD<a href="#section-9.1-2" class="pilcrow">¶</a></p>
<p id="section-9.1-3">Status: permanent<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">Specification: This document<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">Change Controller: IETF<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<p id="section-9.1-6">Contact: QUIC WG<a href="#section-9.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="quic-transport-parameter-registry">
<section id="section-9.2">
        <h3 id="name-quic-transport-parameter-re">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-quic-transport-parameter-re" class="section-name selfRef">QUIC Transport Parameter Registry</a>
        </h3>
<p id="section-9.2-1">This document requests that IANA add the following entries to the QUIC
Transport Parameters Registry:<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-center" rowspan="1" colspan="1">Value</th>
              <th class="text-center" rowspan="1" colspan="1">Parameter Name</th>
              <th class="text-center" rowspan="1" colspan="1">Specification</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">TBD</td>
              <td class="text-center" rowspan="1" colspan="1">Version Aliasing</td>
              <td class="text-center" rowspan="1" colspan="1">This Document</td>
            </tr>
            <tr>
              <td class="text-center" rowspan="1" colspan="1">TBD</td>
              <td class="text-center" rowspan="1" colspan="1">aliasing_parameters</td>
              <td class="text-center" rowspan="1" colspan="1">This Document</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="quic-transport-error-codes-registry">
<section id="section-9.3">
        <h3 id="name-quic-transport-error-codes-">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-quic-transport-error-codes-" class="section-name selfRef">QUIC Transport Error Codes Registry</a>
        </h3>
<p id="section-9.3-1">This document requests that IANA add the following entry to the QUIC Transport
Error Codes registry:<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">Value: TBD (provisional: 0x4942)<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<p id="section-9.3-3">Code: INVALID_BAD_SALT<a href="#section-9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<section id="section-10">
      <h2 id="name-references">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-10.1">
        <h3 id="name-normative-references">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-quic-version-negotiation">[I-D.ietf-quic-version-negotiation]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span> and <span class="refAuthor">E. Rescorla</span>, <span class="refTitle">"Compatible Version Negotiation for QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-version-negotiation-03</span>, <time datetime="2021-02-04" class="refDate">4 February 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-version-negotiation-03">https://tools.ietf.org/html/draft-ietf-quic-version-negotiation-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-PI">[QUIC-PI]</dt>
        <dd>
<span class="refAuthor">Duke, M.</span> and <span class="refAuthor">D. Schinazi</span>, <span class="refTitle">"Protected QUIC Initial Packets"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-duke-quic-protected-initial-02</span>, <time datetime="2021-05-13" class="refDate">13 May 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-duke-quic-protected-initial-02">https://tools.ietf.org/html/draft-duke-quic-protected-initial-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-TLS">[QUIC-TLS]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">S. Turner</span>, <span class="refTitle">"Using TLS to Secure QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-tls-34</span>, <time datetime="2021-01-14" class="refDate">14 January 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-tls-34">https://tools.ietf.org/html/draft-ietf-quic-tls-34</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-TRANSPORT">[QUIC-TRANSPORT]</dt>
      <dd>
<span class="refAuthor">Iyengar, J.</span> and <span class="refAuthor">M. Thomson</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-transport-34</span>, <time datetime="2021-01-14" class="refDate">14 January 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-34">https://tools.ietf.org/html/draft-ietf-quic-transport-34</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-10.2">
        <h3 id="name-informative-references">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="ECHO">[ECHO]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-10</span>, <time datetime="2021-03-08" class="refDate">8 March 2021</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-tls-esni-10">https://tools.ietf.org/html/draft-ietf-tls-esni-10</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">Marten Seemann was the original creator of the version aliasing approach.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="change-log">
<section id="section-appendix.b">
      <h2 id="name-change-log">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-change-log" class="section-name selfRef">Change Log</a>
      </h2>
<ul class="ulEmpty normal">
<li class="ulEmpty normal" id="section-appendix.b-1.1">
          <strong>RFC Editor's Note:</strong> Please remove this section prior to
publication of a final version of this document.<a href="#section-appendix.b-1.1" class="pilcrow">¶</a>
</li>
      </ul>
<div id="since-draft-duke-quic-version-aliasing-05">
<section id="section-b.1">
        <h2 id="name-since-draft-duke-quic-versi">
<a href="#section-b.1" class="section-number selfRef">B.1. </a><a href="#name-since-draft-duke-quic-versi" class="section-name selfRef">since draft-duke-quic-version-aliasing-05</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.1-1.1">Revised security considerations<a href="#section-b.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.1-1.2">Discussed multiple SNIs behind one load balancer<a href="#section-b.1-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.1-1.3">Removed VN from the fallback mechanism<a href="#section-b.1-1.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-version-aliasing-04">
<section id="section-b.2">
        <h2 id="name-since-draft-duke-quic-versio">
<a href="#section-b.2" class="section-number selfRef">B.2. </a><a href="#name-since-draft-duke-quic-versio" class="section-name selfRef">since draft-duke-quic-version-aliasing-04</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.2-1.1">Relationship with Encrypted Client Hello (ECH) and QUIC Protected Initials<a href="#section-b.2-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.2-1.2">Corrected statement about version negotiation<a href="#section-b.2-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-version-aliasing-03">
<section id="section-b.3">
        <h2 id="name-since-draft-duke-quic-version">
<a href="#section-b.3" class="section-number selfRef">B.3. </a><a href="#name-since-draft-duke-quic-version" class="section-name selfRef">since draft-duke-quic-version-aliasing-03</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.3-1.1">Discussed request forgery attacks<a href="#section-b.3-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-version-aliasing-02">
<section id="section-b.4">
        <h2 id="name-since-draft-duke-quic-version-">
<a href="#section-b.4" class="section-number selfRef">B.4. </a><a href="#name-since-draft-duke-quic-version-" class="section-name selfRef">since draft-duke-quic-version-aliasing-02</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.4-1.1">Specified 0RTT status of the transport parameter<a href="#section-b.4-1.1" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-version-aliasing-01">
<section id="section-b.5">
        <h2 id="name-since-draft-duke-quic-version-a">
<a href="#section-b.5" class="section-number selfRef">B.5. </a><a href="#name-since-draft-duke-quic-version-a" class="section-name selfRef">since draft-duke-quic-version-aliasing-01</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.5-1.1">Fixed all references to "seed" where I meant "salt."<a href="#section-b.5-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.5-1.2">Added the Packet Length Offset, which eliminates Retry Injection Attacks<a href="#section-b.5-1.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="since-draft-duke-quic-version-aliasing-00">
<section id="section-b.6">
        <h2 id="name-since-draft-duke-quic-version-al">
<a href="#section-b.6" class="section-number selfRef">B.6. </a><a href="#name-since-draft-duke-quic-version-al" class="section-name selfRef">since draft-duke-quic-version-aliasing-00</a>
        </h2>
<ul class="normal">
<li class="normal" id="section-b.6-1.1">Added "Initial Token Extensions" to increase salt entropy and make salt
polling attacks impractical.<a href="#section-b.6-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.6-1.2">Allowed servers to store a mapping of version number and ITE to salt instead.<a href="#section-b.6-1.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.6-1.3">Made standard version encoding mandatory. This dramatically simplifies the new
Retry logic and changes the security model.<a href="#section-b.6-1.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.6-1.4">Added references to Version Negotiation Transport Parameters.<a href="#section-b.6-1.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-b.6-1.5">Extensive readability edit.<a href="#section-b.6-1.5" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.c">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Martin Duke</span></div>
<div dir="auto" class="left"><span class="org">F5 Networks, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:martin.h.duke@gmail.com" class="email">martin.h.duke@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
