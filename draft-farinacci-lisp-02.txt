
Network Working Group                                       D. Farinacci
Internet-Draft                                                 V. Fuller
Intended status: Experimental                                    D. Oran
Expires: January 18, 2008                                       D. Meyer
                                                           cisco Systems
                                                           July 17, 2007


                 Locator/ID Separation Protocol (LISP)
                      draft-farinacci-lisp-02.txt

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on January 18, 2008.

Copyright Notice

   Copyright (C) The IETF Trust (2007).












Farinacci, et al.       Expires January 18, 2008                [Page 1]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


Abstract

   This draft describes a simple, incremental, network-based protocol to
   implement separation of Internet addresses into Endpoint Identifiers
   (EIDs) and Routing Locators (RLOCs).  This mechanism requires no
   changes to host stacks and no major changes to existing database
   infrastructures.  The proposed protocol can be implemented in a
   relatively small number of routers.

   This proposal was stimulated by the problem statement effort at the
   Amsterdam IAB Routing and Addressing Workshop (RAWS), which took
   place in October 2006.


Table of Contents

   1.  Requirements Notation  . . . . . . . . . . . . . . . . . . . .  3
   2.  Introduction . . . . . . . . . . . . . . . . . . . . . . . . .  4
   3.  Definition of Terms  . . . . . . . . . . . . . . . . . . . . .  6
   4.  Basic Overview . . . . . . . . . . . . . . . . . . . . . . . .  9
     4.1.  Packet Flow Sequence . . . . . . . . . . . . . . . . . . . 10
   5.  Tunneling Details  . . . . . . . . . . . . . . . . . . . . . . 13
     5.1.  LISP IPv4-in-IPv4 Header Format  . . . . . . . . . . . . . 13
     5.2.  LISP IPv6-in-IPv6 Header Format  . . . . . . . . . . . . . 13
     5.3.  Tunnel Header Field Descriptions . . . . . . . . . . . . . 15
   6.  EID-to-RLOC Mapping  . . . . . . . . . . . . . . . . . . . . . 17
     6.1.  Control-Plane Packet Format  . . . . . . . . . . . . . . . 17
       6.1.1.  Map-Request Message Format . . . . . . . . . . . . . . 18
       6.1.2.  EID-to-RLOC UDP Map-Request Message  . . . . . . . . . 19
       6.1.3.  Map-Reply Message Format . . . . . . . . . . . . . . . 20
       6.1.4.  EID-to-RLOC UDP Map-Reply Message  . . . . . . . . . . 22
     6.2.  Routing Locator Selection  . . . . . . . . . . . . . . . . 23
     6.3.  Routing Locator Reachability . . . . . . . . . . . . . . . 24
   7.  Router Performance Considerations  . . . . . . . . . . . . . . 26
   8.  Deployment Scenarios . . . . . . . . . . . . . . . . . . . . . 27
     8.1.  First-hop/Last-hop Tunnel Routers  . . . . . . . . . . . . 28
     8.2.  Border/Edge Tunnel Routers . . . . . . . . . . . . . . . . 28
     8.3.  ISP Provider-Edge (PE) Tunnel Routers  . . . . . . . . . . 29
   9.  Multicast Considerations . . . . . . . . . . . . . . . . . . . 30
   10. Security Considerations  . . . . . . . . . . . . . . . . . . . 31
   11. Prototype Plans and Status . . . . . . . . . . . . . . . . . . 32
   12. References . . . . . . . . . . . . . . . . . . . . . . . . . . 34
     12.1. Normative References . . . . . . . . . . . . . . . . . . . 34
     12.2. Informative References . . . . . . . . . . . . . . . . . . 34
   Appendix A.  Acknowledgments . . . . . . . . . . . . . . . . . . . 36
   Authors' Addresses . . . . . . . . . . . . . . . . . . . . . . . . 37
   Intellectual Property and Copyright Statements . . . . . . . . . . 38




Farinacci, et al.       Expires January 18, 2008                [Page 2]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


1.  Requirements Notation

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].














































Farinacci, et al.       Expires January 18, 2008                [Page 3]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


2.  Introduction

   Many years of discussion about the current IP routing and addressing
   architecture have noted that its use of a single numbering space (the
   "IP address") for both host transport session identification and
   network routing creates scaling issues (see [CHIAPPA] and [RFC1498]).
   A number of scaling benefits would be realized by separating the
   current IP address into separate spaces for Endpoint Identifiers
   (EIDs) and Routing Locators (RLOCs); among them are:

   1.  Reduction of routing table size in the "default-free zone" (DFZ).
       Use of a separate numbering space for RLOCs will allow them to be
       assigned topologically (in today's Internet, RLOCs would be
       assigned by providers at client network attachment points),
       greatly improving aggregation and reducing the number of
       globally-visible, routable prefixes.

   2.  Easing of renumbering burden when clients change providers.
       Because host EIDs are numbered from a separate, non-provider-
       assigned and non-topologically-bound space, they do not need to
       be renumbered when a client site changes its attachment points to
       the network.

   3.  Mobility with session survivability.  Because session state is
       associated with a persistent host EID, it should be possible for
       a host (or a collection of hosts) to move to a different point in
       the network topology (whether by changing providers or by
       physically moving) without disruption of connectivity.

   4.  Traffic engineering capabilities that can be performed by network
       elements and do not depend on injecting additional state into the
       routing system.  This will fall out of the mechanism that is used
       to implement the EID/RLOC split (see Section 4).

   This draft describes protocol mechanisms to achieve the desired
   functional separation.  For flexibility, the document decouples the
   mechanism used for forwarding packets from that used to determine EID
   to RLOC mappings.  This work is in response to and intended to
   address the problem statement that came out of the RAWS effort
   [RAWS].

   This draft focuses on a router-based solution.  Building the solution
   into the network should facilitate incremental deployment of the
   technology on the Internet.  Note that while the detailed protocol
   specification and examples in this document assume IP version 4
   (IPv4), there is nothing in the design that precludes use of the same
   techniques and mechanisms for IPv6.  It should be possible for IPv4
   packets to use IPv6 RLOCs and for IPv6 EIDs to be mapped to IPv4



Farinacci, et al.       Expires January 18, 2008                [Page 4]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   RLOCs.

   Related work on host-based solutions is described in Shim6 [SHIM6]
   and HIP [RFC4423].  Related work on other router-based solutons is
   described in GSE [GSE].  This draft attempts to not compete or
   overlap with such solutions and the proposed protocol changes are
   expected to complement a host-based mechanism when Traffic
   Engineering functionality is desired.

   Some of the design goals of this proposal include:

   1.  Minimize required changes to Internet infrastructure.

   2.  Require no hardware or software changes to end-systems (hosts).

   3.  Be incrementally deployable.

   4.  Require no router hardware changes.

   5.  Minimize router software changes.

   6.  Avoid or minimize packet loss when EID-to-RLOC mappings need to
       be performed.

   There are 4 variants of LISP, which differ along a spectrum of strong
   to weak dependence on the topological nature and possible need for
   routability of EIDs.  The variants are:

   LISP 1:  where EIDs are routable through the RLOC topology for
      bootstrapping EID-to-RLOC mappings.  [LISP1]

   LISP 1.5:  where EIDs are routable for bootstrapping EID-to-RLOC
      mappings; such routing is via a separate topology.

   LISP 2:  where EIDS are not routable and EID-to-RLOC mappings are
      implemented within the DNS.  [LISP2]

   LISP 3:  where non-routable EIDs are used as lookup keys for a new
      EID-to-RLOC mapping database.  Use of Distributed Hash Tables
      [DHTs] to implement such a database would be an area to explore.
      Other examples of new mapping database services are [CONS],
      [NERD], and [APT].

   This document will focus on LISP 1 and LISP 1.5, both of which rely
   on a router-based distributed cache and database for EID-to-RLOC
   mappings.  The LISP 2 and LISP 3 mechanisms, which require separate
   EID-to-RLOC infrastructure, will be documented in additional drafts.




Farinacci, et al.       Expires January 18, 2008                [Page 5]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


3.  Definition of Terms

   Provider Independent (PI) Addresses:   an address block assigned from
      a pool that is not associated with any service provider and is
      therefore not topologically-aggregatable in the routing system.

   Provider Assigned (PA) Addresses:   a block of IP addresses that are
      assigned to a site by each service provider to which a site
      connects.  Typically, each block is sub-block of a service
      provider CIDR block and is aggregated into the larger block before
      being advertised into the global Internet.  Traditionally, IP
      multihoming has been implemented by each multi-homed site
      acquiring its own, globally-visible prefix.  LISP uses only
      topologically-assigned and aggregatable address blocks for RLOCs,
      eliminating this demonstrably non-scalable practice.

   Routing Locator (RLOC):   the IPv4 or IPv6 address of an egress
      tunnel router (ETR).  It is the output of a EID-to-RLOC mapping
      lookup.  An EID maps to one or more RLOCs.  Typically, RLOCs are
      numbered from topologically-aggregatable blocks that are assigned
      to a site at each point to which it attaches to the global
      Internet; where the topology is defined by the connectivity of
      provider networks, RLOCs can be thought of as PA addresses.
      Multiple RLOCs can be assigned to the same ETR device or to
      multiple ETR devices at a site.

   Endpoint ID (EID):   a 32- or 128-bit value used in the source and
      destination address fields of the first (most inner) LISP header
      of a packet.  The host obtains a destination EID the same way it
      obtains an destination address today, for example through a DNS
      lookup or SIP exchange.  The source EID is obtained via existing
      mechanisms used to set a hosts "local" IP address.  LISP uses PI
      blocks for EIDs; such EIDs MUST NOT be used as LISP RLOCs.  Note
      that EID blocks may be assigned in a hierarchical manner,
      independent of the network topology, to facilitate scaling of the
      mapping database.  In addition, an EID block assigned to a site
      may have site-local structure (subnetting) for routing within the
      site; this structure is not visible to the global routing system.

   EID-prefix:   A power-of-2 block of EIDs which are allocated to a
      site by an address allocation authority.  EID-prefixes are
      associated with a set of RLOC addresses which make up a "database
      mapping".  EID-prefix allocations can be broken up into smaller
      blocks when an RLOC set is to be associated with the smaller EID-
      prefix.






Farinacci, et al.       Expires January 18, 2008                [Page 6]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   End-system:   is an IPv4 or IPv6 device that originates packets with
      a single IPv4 or IPv6 header.  The end-system supplies an EID
      value for the destination address field of the IP header when
      communicating globally (i.e. outside of it's routing domain).  An
      end-system can be a host computer, a switch or router device, or
      any network appliance.  An iPhone.

   Ingress Tunnel Router (ITR):   a router which accepts an IP packet
      with a single IP header (more precisely, an IP packet that does
      not contain a LISP header).  The router treats this "inner" IP
      destination address as an EID and performs an EID-to-RLOC mapping
      lookup.  The router then prepends an "outer" IP header with one of
      its globally-routable RLOCs in the source address field and the
      result of the mapping lookup in the destination address field.
      Note that this destination RLOC may be an intermediate, proxy
      device that has better knowledge of the EID-to-RLOC mapping
      closest to the destination EID.  In general, an ITR receives IP
      packets from site end-systems on one side and sends LISP-
      encapsulated IP packets toward the Internet on the other side.

      Specifically, when a service provider prepends a LISP header for
      Traffic Engineering purposes, the router that does this is also
      regarded as an ITR.  The outer RLOC the ISP ITR uses can be based
      on the outer destination address (the originating ITR's supplied
      RLOC) or the inner destination address (the originating hosts
      supplied EID).

   TE-ITR:   is an ITR that is deployed in a service provider network
      that prepends an additional LISP header for Traffic Engineering
      purposes.

   Egress Tunnel Router (ETR):   a router that accepts an IP packet
      where destination address in the "outer" IP header is one of its
      own RLOCs.  The router strips the "outer" header and forwards the
      packet based on the next IP header found.  In general, an ETR
      receives LISP-encapsulated IP packets from the Internet on one
      side and sends decapsulated IP packets to site end-systems on the
      other side.  ETR functionality does not have to be limited to a
      router device.  A server host can be the endpoint of a LISP tunnel
      as well.

   TE-ETR:   is an ETR that is deployed in a service provider network
      that strips an outer LISP header for Traffic Engineering purposes.

   EID-to-RLOC Cache:   a short-lived, on-demand database in an ITR that
      stores, tracks, and is responsible for timing-out and otherwise
      validating EID-to-RLOC mappings.  This cache is distinct from the
      "database", the cache is dynamic, local, and relatively small



Farinacci, et al.       Expires January 18, 2008                [Page 7]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


      while and the database is distributed, relatively static, and much
      global in scope.

   EID-to-RLOC Database:   a globally, distributed database that
      contains all known EID-prefix to RLOC mappings.  Each potential
      ETR typically contains a small piece of the database: the EID-to-
      RLOC mappings for the EID prefixes "behind" the router.  These map
      to one of the router's own, globally-visible, IP addresses.

   Recursive Tunneling:   when a packet has more than one LISP IP
      header.  Additional layers of tunneling may be employed to
      implement traffic engineering or other re-routing as needed.  When
      this is done, an additional "outer" LISP header is added and the
      original RLOCs are preserved in the "inner" header.

   Reencapsulating Tunnels:   when a packet has no more than one LISP IP
      header (two IP headers total) and when it needs to be diverted to
      new RLOC, an ETR can decapsulate the packet (remove the LISP
      header) and prepend a new tunnel header, with new RLOC, on to the
      packet.  Doing this allows a packet to be re-routed by the re-
      encapsulating router without adding the overhead of additional
      tunnel headers.

   LISP Header:   a term used in this document to refer to the outer
      IPv4 or IPv6 header, a UDP header, and a LISP header, an ITR
      prepends or an ETR strips.

























Farinacci, et al.       Expires January 18, 2008                [Page 8]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


4.  Basic Overview

   One key concept of LISP is that end-systems (hosts) operate the same
   way they do today.  The IP addresses that hosts use for tracking
   sockets, connections, and for sending and receiving packets do not
   change.  In LISP terminology, these IP addresses are called Endpoint
   Identifiers (EIDs).

   Routers continue to forward packets based on IP destination
   addresses.  These addresses are referred to as Routing Locators
   (RLOCs).  Most routers along a path between two hosts will not
   change; they continue to perform routing/forwarding lookups on
   addresses (RLOCs) in the IP header.

   This design introduces "Tunnel Routers", which prepend LISP headers
   on host-originated packets and strip them prior to final delivery to
   their destination.  The IP addresses in this "outer header" are
   RLOCs.  During end-to-end packet exchange between two Internet hosts,
   an ITR prepends a new LISP header to each packet and an egress tunnel
   router strips the new header.  The ITR performs EID-to-RLOC lookups
   to determine the routing path to the the ETR, which has the RLOC as
   one of its IP addresses.

   Some basic rules governing LISP are:

   o  End-systems (hosts) only know about EIDs.

   o  EIDs are always IP addresses assigned to hosts.

   o  Routers mostly deal with Routing Locator addresses.  See details
      later in Section 4.1 to clarify what is meant by "mostly".

   o  RLOCs are always IP addresses assigned to routers; preferably,
      topologically-oriented addresses from provider CIDR blocks.

   o  Routers can use their RLOCs as EIDs but can also be assigned EIDs
      when performing host functions.  Those EIDs MUST NOT be used as
      RLOCs.  When EIDs are used the routeability of them is scoped to
      within the site.  A hybrid use of this, for example is when a
      router runs the BGP protocol where iBGP peerings may use EIDs and
      eBGP peerings may use RLOCs.

   o  EIDs are not expected to be usable for global end-to-end
      communication in the absence of an EID-to-RLOC mapping operation.
      They are expected to be used locally for intra-site communication.

   o  EID prefixes are likely to be hierarchically assigned in a manner
      which is optimized for administrative convenience and to



Farinacci, et al.       Expires January 18, 2008                [Page 9]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


      facilitate scaling of the EID-to-RLOC mapping database.  The
      hierarchy is based on a address alocation hierarchy which is not
      dependent on the network toplogy.

   o  EIDs may also be structured (subnetted) in a manner suitable for
      local routing within an autonomous system.

   An additional LISP header may be pre-pended to packets by a transit
   router (i.e.  TE-ITR) when re-routing of the end-to-end path for a
   packet is desired.  An obvious instance of this would be an ISP
   router that needs to perform traffic engineering for packets in flow
   through its network.  In such a situation, termed Recursive
   Tunneling, an ISP transit acts as an additional ingress tunnel router
   and the RLOC it uses for the new prepended header would be either an
   TE-ETR within the ISP (along intra-ISP traffic engineered path) or in
   an TE-ETR within another ISP (an inter-ISP traffic engineered path,
   where an agreement to build such a path exists).

   Tunnel Routers can be placed fairly flexibly in a multi-AS topology.
   For example, the ITR for a particular end-to-end packet exchange
   might be the first-hop or default router within a site for the source
   host.  Similarly, the egress tunnel router might be the last-hop
   router directly-connected to the destination host.  Another example,
   perhaps for a VPN service out-sourced to an ISP by a site, the ITR
   could be the site's border router at the service provider attachment
   point.  Mixing and matching of site-operated, ISP-operated, and other
   tunnel routers is allowed for maximum flexibility.  See Section 8 for
   more details.

4.1.  Packet Flow Sequence

   This section provides an example of the unicast packet flow with the
   following parameters:

   o  Source host "host1.abc.com" is sending a packet to
      "host2.xyz.com".

   o  Each site is multi-homed, so each tunnel router has an address
      (RLOC) assigned from each of the site's attached service provider
      address blocks.

   o  The ITR and ETR are directly connected to the source and
      destination, respectively.

   Client host1.abc.com wants to communicate with server host2.xyz.com:






Farinacci, et al.       Expires January 18, 2008               [Page 10]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   1.  host1.abc.com wants to open a TCP connection to host2.xyz.com.
       It does a DNS lookup on host2.xyz.com.  An A record is returned.
       This address is used as the destination EID and the locally-
       assigned address of host1.abc.com is used as the source EID.  An
       IP packet is built using the EIDs in the IP header and sent to
       the default router.

   2.  The default router is configured as an ITR.  It prepends a LISP
       header to the packet, with one of its RLOCs as the source IP
       address and uses the destination EID from the original packet
       header as the destination IP address.  Subsequent packets
       continue to behave the same way until a mapping is learned.

   3.  In LISP 1, the packet is routed through the Internet as it is
       today.  In LISP 1.5, the packet is routed on a different topology
       which may have EID prefixes distributed and advertised in an
       aggregatable fashion.  In either case, the packet arrives at the
       ETR.  The router is configured to "punt" the packet to the
       router's control-plane processor.  See Section 7 for more
       details.

   4.  The LISP header is stripped so that the packet can be forwarded
       by the router control-plane.  The router looks up the destination
       EID in the router's EID-to-RLOC database (not the cache, but the
       configured data structure of RLOCs).  An EID-to-RLOC Map-Reply
       message is originated by the egress router and is addressed to
       the source RLOC from the LISP header of the original packet (this
       is the ITR).  The source RLOC in the IP header of the UDP message
       is one of the ETR's RLOCs (one of the RLOCs that is embedded in
       the UDP payload).

   5.  The ITR receives the UDP message, parses the message (to check
       for format validity) and stores the EID-to-RLOC information from
       the packet.  This information is put in the ITR's EID-to-RLOC
       mapping cache (this is the on-demand cache, the cache where
       entries time out due to inactivity).

   6.  Subsequent packets from host1.abc.com to host2.xyz.com will have
       a LISP header prepended with the RLOCs learned from the ETR.

   7.  The egress tunnel receives these packets directly (since the
       destination address is one of its assigned IP addresses), strips
       the LISP header and delivers the packets to the attached
       destination host.

   In order to eliminate the need for a mapping lookup in the reverse
   direction, the ETR gleans RLOC information from the LISP header.
   Both ITR and the ETR may also influence the decision the other makes



Farinacci, et al.       Expires January 18, 2008               [Page 11]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   in selecting an RLOC.  See Section 6 for more details.


















































Farinacci, et al.       Expires January 18, 2008               [Page 12]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


5.  Tunneling Details

   This section describes the LISP Data Message which defines the
   tunneling header used to encapsulate IPv4 and IPv6 packets which
   contain EID addresses.  Even though the following formats illustrate
   IPv4-in-IPv4 and IPv6-in-IPv6 encapsulations, the other 2
   combinations are supported as well.

5.1.  LISP IPv4-in-IPv4 Header Format



        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version|  IHL  |Type of Service|          Total Length         |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Identification        |Flags|      Fragment Offset    |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
OH     |  Time to Live | Protocol =3D 17 |         Header Checksum       =
|
  \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \   |                    Source Routing Locator                     |
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                 Destination Routing Locator                   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port =3D xxxx      |       Dest Port =3D 4342      =
  |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / | Type  |  Locator Reach Bits   |        Nonce ...              |
 LISP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                          ... Nonce                            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version|  IHL  |Type of Service|          Total Length         |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Identification        |Flags|      Fragment Offset    |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
IH     |  Time to Live |    Protocol   |         Header Checksum       |
  \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \   |                           Source EID                          |
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                         Destination EID                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


5.2.  LISP IPv6-in-IPv6 Header Format





Farinacci, et al.       Expires January 18, 2008               [Page 13]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version| Traffic Class |           Flow Label                  |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Payload Length        | Next Header=3D17|   Hop Limit   =
|
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
 O     +                                                               +
 u     |                                                               |
 t     +                     Source Routing Locator                    +
 e     |                                                               |
 r     +                                                               +
       |                                                               |
 H     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 d     |                                                               |
 r     +                                                               +
       |                                                               |
  \    +                  Destination Routing Locator                  +
   \   |                                                               |
    \  +                                                               +
     \ |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port =3D xxxx      |       Dest Port =3D 4342      =
  |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Type=3D1 |  Locator Reach Bits   |        Nonce ...              =
|
 LISP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                          ... Nonce                            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version| Traffic Class |           Flow Label                  |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Payload Length        |  Next Header  |   Hop Limit   |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
 I     +                                                               +
 n     |                                                               |
 n     +                          Source EID                           +
 e     |                                                               |
 r     +                                                               +
       |                                                               |
 H     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 d     |                                                               |
 r     +                                                               +
       |                                                               |
  \    +                        Destination EID                        +
   \   |                                                               |
    \  +                                                               +
     \ |                                                               |



Farinacci, et al.       Expires January 18, 2008               [Page 14]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


5.3.  Tunnel Header Field Descriptions

   IH Header:  is the inner header, preserved from the datagram received
      from the originating host.  The source and destination IP
      addresses are EIDs.

   OH Header:  is the outer header prepended by an ITR.  The address
      fields contain RLOCs obtained from the ingress router's EID-to-
      RLOC cache.  The IP protocol number is "UDP (17)" from [RFC0768].

   UDP Header:  contains a random source port allocated by the ITR when
      encapsulating a packet.  The destination port MUST be set to the
      well-known IANA assigned port value 4342.  The UDP checksum field
      MUST be transmitted as 0 and not ignore by the ETR.

   UDP Length:  field contains the original packet's length.  For an
      IPv4 encapsulated packet, the inner header Total Length is copied.
      For an IPv6 encapsualted packet, the inner header Payload Length
      plus the size of the IPv6 header (40 bytes) is copied.

   LISP Type:  set to 1 to encode a LISP Data Message.

   LISP Nonce:  is an ITR randomly generated 6-byte value which tests
      return routability of an ETR echoing back the none in a Map-Reply
      message.

   LISP Locator Reach Bits:  in the LISP header are set by an ITR to
      indicate to an ETR the reachability of the Locators in the source
      site.  Each RLOC in a Map-Reply is assigned an ordinal value from
      0 to n-1 (when there are n RLOCs in a mapping entry).  The Locator
      Reach Bits are number from 0 to n-1 from the right significant bit
      of the 12-bit field.  When a bit is set to 1, the ITR is
      indicating to the ETR the RLOC associated with the bit ordinal is
      reachable.  See Section 6.3 for details on how an ITR can
      determine other site ITRs are reachable.

   When doing Recursive Tunneling:

   o  The OH header Time to Live field MUST be copied from the IH header
      Time to Live field.

   o  The OH header Type of Service field SHOULD be copied from the IH
      header Type of Service field.

   When doing Re-encapsulated Tunneling:



Farinacci, et al.       Expires January 18, 2008               [Page 15]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   o  The new OH header Time to Live field SHOULD be copied from the
      stripped OH header Time to Live field.

   o  The new OH header Type of Service field SHOULD be copied from the
      stripped OH header Type of Service field.

   Copying the TTL serves two purposes.  First it preserves the distance
   the host intended the packet to travel.  And more importantly, it
   provides for suppression of looping packets in the event there is a
   loop of concatenated tunnels due to misconfiguration.









































Farinacci, et al.       Expires January 18, 2008               [Page 16]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


6.  EID-to-RLOC Mapping

6.1.  Control-Plane Packet Format

   When LISP 1 or LISP 1.5 are used, new UDP packet types encode the
   EID-to-RLOC mappings:


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Version|  IHL  |Type of Service|          Total Length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Identification        |Flags|      Fragment Offset    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Time to Live | Protocol =3D 17 |         Header Checksum       =
|
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                    Source Routing Locator                     |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                 Destination Routing Locator                   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |           Source Port         |         Dest Port             |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                         LISP Message                          |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Version| Traffic Class |           Flow Label                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Payload Length        | Next Header=3D17|   Hop Limit   =
|
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       +                                                               +
       |                                                               |
       +                     Source Routing Locator                    +
       |                                                               |
       +                                                               +
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       +                                                               +
       |                                                               |
       +                  Destination Routing Locator                  +



Farinacci, et al.       Expires January 18, 2008               [Page 17]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


       |                                                               |
       +                                                               +
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |           Source Port         |         Dest Port             |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                         LISP Message                          |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   The LISP UDP-based messages are the Map-Request and Map-Reply
   messages.  These message formats are also used by LISP-CONS [CONS]
   but are sent over TCP connections instead.  However, this
   specification is the authoritative source for message format
   definitions for the Map-Request and Map-Reply messages.

6.1.1.  Map-Request Message Format



       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |  Locator Reach Bits   |         Checksum              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            Nonce ...                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          ... Nonce            | Record count  |A|  Reserved   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           ITR-AFI             |            CAR-AFI            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Originating ITR RLOC Address                |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Originating CAR EID-Prefix                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Rec -> | EID mask-len  |    EID-AFI    |         EID-prefix ...        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      Path Vector  List                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   Packet field descriptions:







Farinacci, et al.       Expires January 18, 2008               [Page 18]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   Type:  2 (Map-Request)

   Locator Reach Bits:  Refer to Section 5.3.

   Checksum:  A complement of the 1-complements sum of the LISP packet.
      The checksum MUST be computed and the UDP checksum MUST be set to
      0.

   Nonce:  A 6-byte random value created by the sender of the Map-
      Request.

   Record count:  The number of records in this request message.  A
      record comprises of what is labeled 'Rec" above and occurs the
      number of times equal to Record count.

   A: This is an authoritative bit, which is set to 0 for UDP-based Map-
      Requests sent by an ITR.  See [CONS] for TCP-based Map-Requests.

   Reserved:  Set to 0 on transmission and ignored on receipt.

   ITR-AFI:  Address family of the "Originating ITR RLOC Address" field.

   CAR-AFI:  Address family of the "Originating CAR EID-Prefix" field.

   Originating ITR RLOC Address:  Set to 0 for UDP-based messages.  See
      [CONS] for TCP-based Map-Requests.

   Originating CAR EID-Prefix:  Set to 0 for UDP-based messages by an
      ITR.  See [CONS] for TCP-based Map-Requests.

   EID mask-len:  Mask length for EID prefix.

   EID-AFI:  Address family of EID-prefix according to [RFC2434]

   EID-prefix:  4 bytes if an IPv4 address-family, 16 bytes if an IPv6
      address-family.

   Path Vector List:  See [CONS] for details.  This field is not used in
      UDP Map-Requests.

6.1.2.  EID-to-RLOC UDP Map-Request Message

   A Map-Request contains one or more EIDs encoded in prefix format with
   a Locator count of 0.  The EID-prefix MUST NOT be more specific than
   a cache entry stored from a previously-received Map-Reply.

   A Map-Request is sent from an ITR when it wants to test an RLOC for
   reachability.  This is performed by using the RLOC as the destination



Farinacci, et al.       Expires January 18, 2008               [Page 19]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   address for Map-Request message with a randomly allocated source UDP
   port number and the well-known destination port number 4342.  A
   successful Map-Reply updates the cached set of RLOCs associated with
   the EID prefix range.

   Map-Requests MUST be rate-limited.  It is recommended that a Map-
   Request for the same EID-prefix be sent no more than once per second.

6.1.3.  Map-Reply Message Format



       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |  Locator Reach Bits   |         Checksum              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            Nonce ...                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          ... Nonce            | Record count  |   Reserved    |
+----> +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      |                          Record  TTL                          |
|      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      | Locator count | EID mask-len  |A|        Reserved             |
|      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
R      |           ITR-AFI             |            EID-AFI            |
e      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
c      |                   Originating ITR RLOC Address                |
o      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
r      |                          EID-prefix                           |
d      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     /|    Priority   |    Weight     |    Unused     |    Loc-AFI    |
|  Loc +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     \|                             Locator                           |
+--->  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Path Vector List                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   Packet field descriptions:

   Type:  3 (Map-Reply)

   Locator Reach Bits:  Refer to Section 5.3.

   Checksum:  A complement of the 1-complements sum of the LISP packet.
      The checksum MUST be computed and the UDP checksum MUST be set to
      0.





Farinacci, et al.       Expires January 18, 2008               [Page 20]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   Nonce:  A 6-byte value set in a data probe packet or a Map-Request
      that is echoed here in the Map-Reply.

   Record count:  The number of records in this reply message.  A record
      comprises of what is labeled 'Record' above and occurs the number
      of times equal to Record count.

   Reserved:  Set to 0 on transmission and ignored on receipt.

   Record TTL:  The time in minutes the recipient of the Map-Reply will
      store the mapping.  If the TTL is 0, the entry should be removed
      from the cache immediately.  If the value is 0xffffffff, the
      recipient can decide locally how long to store the mapping.

   Locator count:  The number of Locator entries.  A locator entry
      comprises what is labeled above as 'Loc'.

   EID mask-len:  Mask length for EID prefix.

   A: The Authoritative bit, when sent by a UDP-based message is always
      set by the ETR.  See [CONS] for TCP-based Map-Replies.

   ITR-AFI:  Address family of the "Originating ITR RLOC Address" field.

   EID-AFI:  Address family of EID-prefix according to [RFC2434].

   Originating ITR RLOC Address:  Set to 0 for UDP-based messages.  See
      [CONS] for TCP-based Map-Replies.

   EID-prefix:  4 bytes if an IPv4 address-family, 16 bytes if an IPv6
      address-family.

   Priority:  each RLOC is assigned a priority.  Lower values are more
      preferable.  When multiple RLOCs have the same priority, they are
      used in a load-split fashion.  A value of 255 means the RLOC MUST
      NOT be used.

   Weight:  when priorities are the same for multiple RLOCs, the weight
      indicates how to balance traffic between them.  Weight is encoded
      as a percentage of total packets that match the mapping entry.  If
      a non-zero weight value is used for any RLOC, then all RLOCs must
      use a non-zero weight value and then the sum of all weight values
      MUST equal 100.  What did the 3rd grader say after Steve Jobs gave
      an iPhone demo to the class?  If a zero value is used for any RLOC
      weight, then all weights MUST be zero and the receiver of the Map-
      Reply will decide how to load-split traffic.





Farinacci, et al.       Expires January 18, 2008               [Page 21]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   Locator:  an IPv4 or IPv6 address (as encoded by the 'Loc-AFI' field)
      assigned to an ETR or router acting as a proxy replier for the
      EID-prefix.  Note that the destination RLOC address MAY be an
      anycast address if the tunnel egress point may be via more than
      one physical device.  A souce RLOC can be an anycast address as
      well.  The source or destination RLOC MUST NOT be the broadcast
      address (255.255.255.255 or any subnet broadcast address known to
      the router), and MUST NOT be a link-local multicast address.  The
      source RLOC MUST NOT be a multicast address.  The destination RLOC
      SHOULD be a multicast address if it is being mapped from a
      multicast destination EID.

   Path Vector List:  See [CONS] for details.  This field is not used in
      UDP Map-Replies.

6.1.4.  EID-to-RLOC UDP Map-Reply Message

   When a data packet triggers a Map-Reply to be sent, the RLOCs
   associated with the EID-prefix matched by the EID in the original
   packet destination IP address field will be returned.  The RLOCs in
   the Map-Reply are the globally-routable IP addresses of the ETR but
   are not necessarily reachable; separate testing of reachability is
   required.

   Note that a Map-Reply may contain different EID-prefix granularity
   (prefix + length) than the Map-Request which triggers it.  This might
   occur if a Map-Request were for a prefix that had been returned by an
   earlier Map-Reply.  In such a case, the requester updates its cache
   with the new prefix information and granularity.  For example, a
   requester with two cached EID-prefixes that are covered by a Map-
   Reply containing one, less-specific prefix, replaces the entry with
   the less-specific EID-prefix.  Note that the reverse, replacement of
   one less-specific prefix with multiple more-specific prefixes, can
   also occur but not by removing the less-specific prefix rather by
   adding the more-specific prefixes which during a lookup will override
   the less-specific prefix.

   Replies SHOULD be sent for an EID-prefix no more often than once per
   second to the same requesting router.  For scalability, it is
   expected that aggregation of EID addresses into EID-prefixes will
   allow one Map-Reply to satisfy a mapping for the EID addresses in the
   prefix range thereby reducing the number of Map-Request messages.

   The addresses for a Data message or Map-Request message are swapped
   and used for sending the Map-Reply.  The UDP source and destination
   ports are swapped as well.  That is, the source port in the UDP
   header for the Map-Reply is set to the well-known UDP port number
   4342.



Farinacci, et al.       Expires January 18, 2008               [Page 22]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


6.2.  Routing Locator Selection

   Both client-side and server-side may need control over the selection
   of RLOCs for conversations between them.  This control is achieved by
   manipulating the Priority and Weight fields in EID-to-RLOC Map-Reply
   messages.  Alternatively, RLOC information may be gleaned from
   received tunneled packets or EID-to-RLOC Map-Request messages.

   The following enumerates different scenarios for choosing RLOCs and
   the controls that are available:

   o  Server-side returns one RLOC.  Client-side can only use one RLOC.
      Server-side has complete control of the selection.

   o  Server-side returns a list of RLOC where a subset of the list has
      the same best priority.  Client can only use the subset list
      according to the weighting assigned by the server-side.  In this
      case, the server-side controls both the subset list and load-
      splitting across its members.  The client-side can use RLOCs
      outside of the subset list if it determines that the subset list
      is unreachable (unless RLOCs are set to a Priority of 255).  Some
      sharing of control exists: the server-side determines the
      destination RLOC list and load distribution while the client-side
      has the option of using alternatives to this list if RLOCs in the
      list are unreachable.

   o  Server-side sets weight of 0 for the RLOC subset list.  In this
      case, the client-side can choose how the traffic load is spread
      across the subset list.  Control is shared by the server-side
      determining the list and the client determining load distribution.
      Again, the client can use alternative RLOCs if the server-provided
      list of RLOCs are unreachable.

   o  Either side (more likely on the server-side ETR) decides not to
      send an Map-Request.  For example, if the server-side ETR does not
      send Map-Requests, it gleans RLOCs from the client-side ITR,
      giving the client-side ITR responsibility for bidirectional RLOC
      reachability and preferability.  Server-side ETR gleaning of the
      client-side ITR RLOC is done by caching the inner header source
      EID and the outer header source RLOC of received packets.  The
      client-side ITR controls how traffic is returned and can alternate
      using an outer header source RLOC, which then can be added to the
      list the server-side ETR uses to return traffic.  Since no
      Priority or Weights are provided using this method, the server-
      side ETR must assume each client-side ITR RLOC uses the same best
      Priority with a Weight of zero.  In addition, since EID-prefix
      encoding cannot be conveyed in data packets, the EID-to-RLOC cache
      on tunnel routers can grow to be very large.



Farinacci, et al.       Expires January 18, 2008               [Page 23]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   RLOCs that appear in EID-to-RLOC Map-Reply messages are considered
   reachable.  The Map-Reply and the database mapping service does not
   provide any reachability status for Locators.  This is done outside
   of the mapping service.  See next section for details.

6.3.  Routing Locator Reachability

   There are 4 methods for determining when a Locator is either
   reachable or has become unreachable:

   1.  Locator reachability is determined by an ETR by examining the
       Loc-Reach-Bits from a LISP header of a Data Message which is
       provided by an ITR when an ITR encapsulates data.

   2.  Locator unreachability is determined by an ITR by receiving ICMP
       Network or Host Unreachable messages.

   3.  ETR unreachability is determined when a host sends an ICMP Port
       Unreachable message.

   4.  Locator reachability is determined by receiving a Map-Reply
       message from a ETR's Locator address in response to a previously
       sent Map-Request.

   When determining Locator reachability by examining the Loc-Reach-Bits
   from the LISP Data Message, an ETR will receive up to date status
   from the ITR closest to the Locators at the source site.  The ITRs at
   the source site can determine reachability when running their IGP at
   the site.  When the ITRs are deployed on CE routers, typically a
   default route is injected into the site's IGP from each of the ITRs.
   If an ITR goes down, the CE-PE link goes down, or the PE router goes
   down, the CE router withdraws the default route.  This allows the
   other ITRs at the site to determine one of the Locators has gone
   unreachable.

   The Locators listed in a Map-Reply are numbered with ordinals 0 to
   n-1.  The Loc-Reach-Bits in a LISP Data Message are numbered from 0
   to n-1 starting with the least signfiicant bit numbered as 0.  So,
   for example, if the ITR with locator listed as the 3rd Locator
   position in the Map-Reply goes down, all other ITRs at the site will
   have the 3rd bit from the right cleared (the bit that corresponds to
   ordinal 2).

   When an ETR decapsulates a packet, it will look for a change in the
   Loc-Reach-Bits value.  When a bit goes from 1 to 0, the ETR will
   refrain from encapsulating packets to the Locator that has just gone
   unreachable.  It can start using the Locator again when the bit that
   corresponds to the Locator goes from 0 to 1.



Farinacci, et al.       Expires January 18, 2008               [Page 24]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   When ITRs at the site are not deployed in CE routers, the IGP can
   still be used to determine the reachability of Locators provided they
   are injected a stub links into the IGP.  This is typically done when
   a /32 address is configured on a loopback interface.

   When ITRs receive ICMP Network or Host Unreachable messages as a
   method to determine unreachability, they will refrain from using
   Locators which are described in Locator lists of Map-Replies.
   However, using this approach is unreliable because many network
   operators turn off generation of ICMP Unreachable messages.

   Optionally, an ITR can send a Map-Request to a Locator and if a Map-
   Reply is returned, reachability of the Locator has been achieved.
   Obviously, sending such probes increases the number of control
   messages originated by tunnel routers for active flows, so Locators
   are assumed to be reachable when they are advertised.

   This assumption does create a dependency: Locator unreachability is
   detected by the receipt of ICMP Host Unreachable messages.  When an
   Locator has been determined unreachable, it is not used for active
   traffic; this is the same as if it were listed in a Map-Reply with
   priority 255.

   The ITR can later test the reachability of the unreachable Locator by
   sending periodic Requests.  Both Requests and Replies MUST be rate-
   limited.  Locator reachability testing is never done with data
   packets since that increases the risk of packet loss for end-to-end
   sessions.























Farinacci, et al.       Expires January 18, 2008               [Page 25]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


7.  Router Performance Considerations

   LISP is designed to be very hardware-based forwarding friendly.  By
   doing tunnel header prepending [RFC1955] and stripping instead of re-
   writing addresses, existing hardware could support the forwarding
   model with little or no modification.  Where modifications are
   required, they should be limited to re-programming existing hardware
   rather than requiring expensive design changes to hard-coded
   algorithms in silicon.

   A few implementation techniques can be used to incrementally
   implement LISP:

   o  When a tunnel encapsulated packet is received by an ETR, the outer
      destination address may not be the address of the router.  This
      makes it challenging for the control-plane to get packets from the
      hardware.  This may be mitigated by creating special FIB entries
      for the EID-prefixes of EIDs served by the ETR (those for which
      the router provides an RLOC translation).  These FIB entries are
      marked with a flag indicating that control-plane processing should
      be performed.  The forwarding logic of testing for particular IP
      protocol number value is not necessary.  No changes to existing,
      deployed hardware should be needed to support this.

   o  On an ITR, prepending a new IP header is as simple as adding more
      bytes to a MAC rewrite string and prepending the string as part of
      the outgoing encapsulation procedure.  Many routers that support
      GRE tunneling [RFC3056] or 6to4 tunneling [RFC2784] can already
      support this action.

   o  When a received packet's outer destination address contains an EID
      which is not intended to be forwarded on the routable topology
      (i.e.  LISP 1.5), the source address of a data packet or the
      router interface with which the source is associated (the
      interface from which it was received) can be associated with a VRF
      (Virtual Routing/Forwarding), in which a different (i.e. non-
      congruent) topology can be used to find EID-to-RLOC mappings.














Farinacci, et al.       Expires January 18, 2008               [Page 26]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


8.  Deployment Scenarios

   This section will explore how and where ingress and ETRs can be
   deployed and will discuss the pros and cons of each deployment
   scenario.  There are two basic deployment tradeoffs to consider:
   centralized versus distributed caches and flat, recursive, or re-
   encapsulating tunneling.

   When deciding on centralized versus distributed caching, the
   following issues should be considered:

   o  Are the tunnel routers spread out so that the caches are spread
      across all the memories of each router?

   o  Should management "touch points" be minimized by choosing few
      tunnel routers, just enough for redundancy?

   o  In general, using more ITRs doesn't increase management load,
      since caches are built and stored dynamically.  On the other hand,
      more ETRs does require more management since EID-prefix-to-RLOC
      mappings need to be explicitly configured.

   When deciding on flat, recursive, or re-encapsulation tunneling, the
   following issues should be considered:

   o  Flat tunneling implements a single tunnel between source site and
      destination site.  This generally offers better paths between
      sources and destinations with a single tunnel path.

   o  Recursive tunneling is when tunneled traffic is again further
      encapsulated in another tunnel, either to implement VPNs or to
      perform Traffic Engineering.  When doing VPN-based tunneling, the
      site has some control since the site is prepending a new tunnel
      header.  In the case of TE-based tunneling, the site may have
      control if it is prepending a new tunnel header, but if the site's
      ISP is doing the TE, then the site has no control.  Recursive
      tunneling generally will result in suboptimal paths but at the
      benefit of steering traffic to resource available parts of the
      network.

   o  The technique of re-encapsulation ensures that packets only
      require one tunnel header.  So if a packet needs to be rerouted,
      it is first decapsulated by the ETR and then re-encapsulated with
      a new tunnel header using a new RLOC.

   The next sub-sections will describe where tunnel routers can reside
   in the network.




Farinacci, et al.       Expires January 18, 2008               [Page 27]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


8.1.  First-hop/Last-hop Tunnel Routers

   By locating tunnel routers close to hosts, the EID-prefix set is at
   the granularity of an IP subnet.  So at the expense of more EID-
   prefix-to-RLOC sets for the site, the caches in each tunnel router
   can remain relatively small.  But caches always depend on the number
   of non-aggregated EID destination flows active through these tunnel
   routers.

   With more tunnel routers doing encapsulation, the increase in control
   traffic grows as well: since the EID-granularity is greater, more
   Map-Requests and replies are traveling between more routers.

   The advantage of placing the caches and databases at these stub
   routers is that the products deployed in this part of the network
   have better price-memory ratios then their core router counterparts.
   Memory is typically less expensive in these devices and fewer routes
   are stored (only IGP routes).  These devices tend to have excess
   capacity, both for forwarding and routing state.

   LISP functionality can also be deployed in edge switches.  These
   devices generally have layer-2 ports facing hosts and layer-3 ports
   facing the Internet.  Spare capacity is also often available in these
   devices as well.

8.2.  Border/Edge Tunnel Routers

   Using customer-edge (CE) routers for tunnel endpoints allows the EID
   space associated with a site to be reachable via a small set of RLOCs
   assigned to the CE routers for that site.

   This offers the opposite benefit of the first-hop/last-hop tunnel
   router scenario: the number of mapping entries and network management
   touch points are reduced, allowing better scaling.

   One disadvantage is that less of the network's resources are used to
   reach host endpoints thereby centralizing the point-of-failure domain
   and creating network choke points at the CE router.

   Note that more than one CE router at a site can be configured with
   the same IP address.  In this case an RLOC is an anycast address.
   This allows resilency between the CE routers.  That is, if a CE
   router fails, traffic is automatically routed to the other routers
   using the same anycast address.  However, this comes with the
   disadvantage where the site cannot control the entrance point when
   the anycast route is advertised out from all border routers.





Farinacci, et al.       Expires January 18, 2008               [Page 28]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


8.3.  ISP Provider-Edge (PE) Tunnel Routers

   Use of ISP PE routers as tunnel endpoint routers gives an ISP control
   over the location of the egress tunnel endpoints.  That is, the ISP
   can decide if the tunnel endpoints are in the destination site (in
   either CE routers or last-hop routers within a site) or at other PE
   edges.  The advantage of this case is that two or more tunnel headers
   can be avoided.  By having the PE be the first router on the path to
   encapsulate, it can choose a TE path first, and the ETR can
   decapsulate and re-encapsulate for a tunnel to the destination end
   site.

   An obvious disadvantage is that the end site has no control over
   where its packets flow or the RLOCs used.

   As mentioned in earlier sections a combination of these scenarios is
   possible at the expense of extra packet header overhead, if both site
   and provider want control, then recursive or re-encapsulating tunnels
   are used.
































Farinacci, et al.       Expires January 18, 2008               [Page 29]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


9.  Multicast Considerations

   A multicast group address, as defined in the original Internet
   architecture is an identifier of a grouping of topologically
   independent receiver host locations.  The address encoding itself
   does not determine the location of the receiver(s).  The multicast
   routing protocol, and the network-based state the protocol creates,
   determines where the receivers are located.

   In the context of LISP, a multicast group address is both an EID and
   a Routing Locator.  Therefore, no specific semantic or action needs
   to be taken for a destination address, as it would appear in an IP
   header.  Therefore, a group address that appears in an inner IP
   header built by a source host will be used as the destination EID.
   And the outer IP header (the destination Routing Locator address),
   prepended by a LISP router, will use the same group address as the
   destination Routing Locator.

   Having said that, only the source EID and source Routing Locator
   needs to be dealt with.  Therefore, an ITR merely needs to put its
   own IP address in the source Routing Locator field when prepending
   the outer IP header.  This source Routing Locator address, like any
   other Routing Locator address MUST be globally routable.

   Therefore, an EID-to-RLOC mapping does not need to be performed by an
   ITR when a received data packet is a multicast data packet or when
   processing a source-specific Join (either by IGMPv3 or PIM).  But the
   source Routing Locator is decided by the multicast routing protocol
   in a receiver site.  That is, an EID to Routing Locator translation
   is done at control-time.

   Another approach is to have the ITR not encapsulate a multicast
   packet and allow the the host built packet to flow into the core even
   if the source address is allocated out of the EID namespace.  If the
   RPF-Vector TLV [RPFV] is used by PIM in the core, then core routers
   can RPF to the ITR (the Locator address which is injected into core
   routing) rather than the host source address (the EID address which
   is not injected into core routing).













Farinacci, et al.       Expires January 18, 2008               [Page 30]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


10.  Security Considerations

   We believe that most of the security mechanisms will be part of the
   mapping database service when using control-plane procedures for
   obtaining EID-to-RLOC mappings.  For data-plane triggered mappings,
   as described in this specification, protection is provided against
   ETR spoofing by using Return- Routeability mechanisms evidenced by
   the use of a 6-byte Nonce field in the LISP encapsulation header.
   The nonce, coupled with the ITR accepting only solicited Map-Replies
   goes a long way towards providing decent authentication.

   LISP does not rely on a PKI infrastructure or a more heavy weight
   authentication system.  These systems challenge the scalability of
   LISP which was a primary design goal.

   DoS attack prevention will depend on implementations rate- limiting
   of Map-Requests and Map-Replies to the control-plane as well as rate-
   limiting the number of data triggered Map-Replies.

































Farinacci, et al.       Expires January 18, 2008               [Page 31]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


11.  Prototype Plans and Status

   The operator community has requested that the IETF take a practical
   approach to solving the scaling problems associated with global
   routing state growth.  This document offers a simple solution which
   is intended for use in a pilot program to gain experience in working
   on this problem.

   The authors hope that publishing this specification will allow the
   rapid implementation of multiple vendor prototypes and deployment on
   a small scale.  Doing this will help the community:

   o  Decide whether a new EID-to-RLOC mapping database infrastructure
      is needed or if a simple, UDP-based, data-triggered approach is
      flexible and robust enough.

   o  Experiment with provider-independent assignment of EIDs while at
      the same time decreasing the size of DFZ routing tables through
      the use of topologically-aligned, provider-based RLOCs.

   o  Determine whether multiple levels of tunneling can be used by ISPs
      to achieve their Traffic Engineering goals while simultaneously
      removing the more specific routes currently injected into the
      global routing system for this purpose.

   o  Experiment with mobility to determine if both acceptable
      convergence and session survivability properties can be scalably
      implemented to support both individual device roaming and site
      service provider changes.

   Here are a rough set of milestones:

   1.  Stabilize this draft by Summer 2007 Chicago IETF.

   2.  Start implementations to report on by Summer 2007 Chicago IETF.

   3.  Start pilot deployment between summer and fall IETFs.  Report on
       deployment at Fall 2007 Vancouver IETF.

   4.  Achieve multi-vendor interoperability by Fall 2007 Vancouver
       IETF.

   5.  Consider prototyping other database lookup schemes, be it DNS,
       DHTs, CONS, NERD, or other mechanisms by Fall 2007 IETF.

   As of this writing the following accomplishments have been achieved:





Farinacci, et al.       Expires January 18, 2008               [Page 32]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


   1.  A unit tested software switching implementation has been
       completed for both IPv4 and IPv6 encapsulations for LISP 1 and
       LISP 1.5 functionality.

   2.  Dave Meyer, Vince Fuller, and Darrel Lewis are testing the
       implementation this summer.

   3.  An implementation of LISP-CONS is under way.

   Please contact authors if interested in doing an implementation and
   want to interoperability test with our implementation.








































Farinacci, et al.       Expires January 18, 2008               [Page 33]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


12.  References

12.1.  Normative References

   [RFC0768]  Postel, J., "User Datagram Protocol", STD 6, RFC 768,
              August 1980.

   [RFC1498]  Saltzer, J., "On the Naming and Binding of Network
              Destinations", RFC 1498, August 1993.

   [RFC1955]  Hinden, R., "New Scheme for Internet Routing and
              Addressing (ENCAPS) for IPNG", RFC 1955, June 1996.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC2434]  Narten, T. and H. Alvestrand, "Guidelines for Writing an
              IANA Considerations Section in RFCs", BCP 26, RFC 2434,
              October 1998.

   [RFC2784]  Farinacci, D., Li, T., Hanks, S., Meyer, D., and P.
              Traina, "Generic Routing Encapsulation (GRE)", RFC 2784,
              March 2000.

   [RFC3056]  Carpenter, B. and K. Moore, "Connection of IPv6 Domains
              via IPv4 Clouds", RFC 3056, February 2001.

   [RFC4423]  Moskowitz, R. and P. Nikander, "Host Identity Protocol
              (HIP) Architecture", RFC 4423, May 2006.

12.2.  Informative References

   [APT]      Jen, D., Meisel, M., Massey, D., Wang, L., Zhang, B., and
              L. Zhang, "APT: A Practical Transit Mapping Service",
              draft-jen-apt-00.txt (work in progress), July 2007.

   [CHIAPPA]  Chiappa, J., "Endpoints and Endpoint names: A Proposed
              Enhancement to the Internet Architecture", Internet-
              Draft http://www.chiappa.net/~jnc/tech/endpoints.txt,
              1999.

   [CONS]     Farinacci, D., Fuller, V., and D. Meyer, "LISP-CONS: A
              Content distribution Overlay Network  Service for LISP",
              draft-meyer-lisp-cons-01.txt (work in progress),
              July 2007.

   [DHTs]     Ratnasamy, S., Shenker, S., and I. Stoica, "Routing
              Algorithms for DHTs: Some Open Questions", PDF



Farinacci, et al.       Expires January 18, 2008               [Page 34]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


              file http://www.cs.rice.edu/Conferences/IPTPS02/174.pdf.

   [GSE]      "GSE - An Alternate Addressing Architecture for  IPv6",
              draft-ietf-ipngwg-gseaddr-00.txt (work in progress), 1997.

   [LISP1]    Farinacci, D., Oran, D., Fuller, V., and J. Schiller,
              "Locator/ID Separation Protocol (LISP1) [Routable  ID
              Version]",
              Slide-set http://www.dinof.net/~dino/ietf/lisp1.ppt,
              October 2006.

   [LISP2]    Farinacci, D., Oran, D., Fuller, V., and J. Schiller,
              "Locator/ID Separation Protocol (LISP2) [DNS-based
              Version]",
              Slide-set http://www.dinof.net/~dino/ietf/lisp2.ppt,
              November 2006.

   [NERD]     Lear, E., "NERD: A Not-so-novel EID to RLOC Database",
              draft-lear-lisp-nerd-01.txt (work in progress), June 2007.

   [RAWS]     Meyer, D., Zhang, L., and K. Fall, "Report from the IAB
              Workshop on Routing and  Addressing",
              draft-iab-raws-report-02.txt (work in progress),
              April 2007.

   [RPFV]     Wijnands, IJ., Boers, A., and E. Rosen, "The RPF Vector
              TLV", draft-ietf-pim-rpf-vector-03.txt (work in progress),
              October 2006.

   [SHIM6]    Nordmark, E. and M. Bagnulo, "Level 3 multihoming shim
              protocol", draft-ietf-shim6-proto-06.txt (work in
              progress), October 2006.



















Farinacci, et al.       Expires January 18, 2008               [Page 35]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


Appendix A.  Acknowledgments

   The authors would like to gratefully acknowledge many people who have
   contributed discussion and ideas to the making of this proposal.
   They include Jason Schiller, Lixia Zhang, Dorian Kim, Peter
   Schoenmaker, Darrel Lewis, Vijay Gill, Geoff Huston, David Conrad,
   Ron Bonica, Ted Seely, Mark Townsley, Chris Morrow, Brian Weis, Dave
   McGrew, Peter Lothberg, Dave Thaler, Scott Brim, Eliot Lear, Shane
   Amante, Ved Kafle, and Olivier Bonaventure.

   In particular, we would like to thank Dave Meyer for his clever
   suggestion for the name "LISP". ;-)







































Farinacci, et al.       Expires January 18, 2008               [Page 36]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


Authors' Addresses

   Dino Farinacci
   cisco Systems
   Tasman Drive
   San Jose, CA  95134
   USA

   Email: dino@cisco.com


   Vince Fuller
   cisco Systems
   Tasman Drive
   San Jose, CA  95134
   USA

   Email: vaf@cisco.com


   Dave Oran
   cisco Systems
   7 Ladyslipper Lane
   Acton, MA
   USA

   Email: oran@cisco.com


   Dave Meyer
   cisco Systems
   170 Tasman Drive
   San Jose, CA
   USA

   Email: dmm@cisco.com















Farinacci, et al.       Expires January 18, 2008               [Page 37]
=0C
Internet-Draft    Locator/ID Separation Protocol (LISP)        July 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Farinacci, et al.       Expires January 18, 2008               [Page 38]
=0C

--Apple-Mail-2-838033943
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed



--Apple-Mail-2-838033943
Content-Transfer-Encoding: 7bit
Content-Type: text/html;
	x-unix-mode=0644;
	name=draft-farinacci-lisp-02.html
Content-Disposition: attachment;
	filename=draft-farinacci-lisp-02.html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Locator/ID Separation Protocol (LISP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Locator/ID Separation Protocol (LISP)">
<meta name="generator" content="xml2rfc v1.32 (http://xml.resource.org/)">
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: small; color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: small; font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: small; font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: small; text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">D. Farinacci</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">V. Fuller</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">D. Oran</td></tr>
<tr><td class="header">Expires: January 18, 2008</td><td class="header">D. Meyer</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 17, 2007</td></tr>
</table></td></tr></table>
<h1><br />Locator/ID Separation Protocol (LISP)<br />draft-farinacci-lisp-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 18, 2008.</p>

<h3>Copyright Notice</h3>
<p>
Copyright &copy; The IETF Trust (2007).</p>

<h3>Abstract</h3>

<p>This draft describes a simple, incremental, network-based 
            protocol to implement separation of Internet addresses into
	    Endpoint Identifiers (EIDs) and Routing Locators (RLOCs). This
 	    mechanism requires no changes to
            host stacks and no major changes to existing database 
	    infrastructures. The proposed
            protocol can be implemented in a relatively small number of
 	    routers.
</p>
<p>This proposal was stimulated by the problem statement effort at
            the Amsterdam IAB Routing and Addressing Workshop (RAWS), which 
	    took place in October 2006.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Requirements Notation<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#anchor3">3.</a>&nbsp;
Definition of Terms<br />
<a href="#OVERVIEW">4.</a>&nbsp;
Basic Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MOSTLY">4.1.</a>&nbsp;
Packet Flow Sequence<br />
<a href="#anchor4">5.</a>&nbsp;
Tunneling Details<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.1.</a>&nbsp;
LISP IPv4-in-IPv4 Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.2.</a>&nbsp;
LISP IPv6-in-IPv6 Header Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#LRB">5.3.</a>&nbsp;
Tunnel Header Field Descriptions<br />
<a href="#mapping">6.</a>&nbsp;
EID-to-RLOC Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.1.</a>&nbsp;
Control-Plane Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.1.1.</a>&nbsp;
Map-Request Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.1.2.</a>&nbsp;
EID-to-RLOC UDP Map-Request Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.1.3.</a>&nbsp;
Map-Reply Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.1.4.</a>&nbsp;
EID-to-RLOC UDP Map-Reply Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.2.</a>&nbsp;
Routing Locator Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#loc-reach">6.3.</a>&nbsp;
Routing Locator Reachability<br />
<a href="#PUNT">7.</a>&nbsp;
Router Performance Considerations<br />
<a href="#DEPLOYMENT">8.</a>&nbsp;
Deployment Scenarios<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">8.1.</a>&nbsp;
First-hop/Last-hop Tunnel Routers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">8.2.</a>&nbsp;
Border/Edge Tunnel Routers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">8.3.</a>&nbsp;
ISP Provider-Edge (PE) Tunnel Routers<br />
<a href="#anchor16">9.</a>&nbsp;
Multicast Considerations<br />
<a href="#anchor17">10.</a>&nbsp;
Security Considerations<br />
<a href="#anchor18">11.</a>&nbsp;
Prototype Plans and Status<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
            "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
            and "OPTIONAL" in this document are to be interpreted as
            described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>Many years of discussion about the current IP routing and 
	    addressing architecture have noted that its use of a single 
	    numbering space (the &quot;IP address&quot;) for both host 
	    transport session identification and network routing creates 
	    scaling issues (see <a class='info' href='#CHIAPPA'>[CHIAPPA]<span> (</span><span class='info'>Chiappa, J., &ldquo;Endpoints and Endpoint names: A Proposed  		    Enhancement to the Internet Architecture,&rdquo; 1999.</span><span>)</span></a> and 
	    <a class='info' href='#RFC1498'>[RFC1498]<span> (</span><span class='info'>Saltzer, J., &ldquo;On the Naming and Binding of Network Destinations,&rdquo; August&nbsp;1993.</span><span>)</span></a>). A number of scaling 
	    benefits would be realized by separating the current IP address 
	    into separate spaces for Endpoint Identifiers (EIDs) and Routing 
	    Locators (RLOCs); among them are:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>Reduction of routing table
	        size in the &quot;default-free zone&quot; (DFZ). Use
	        of a separate numbering space for RLOCs will allow
	        them to be assigned topologically (in today's
	        Internet, RLOCs would be assigned by providers at
	        client network attachment points), greatly improving
	        aggregation and reducing the number of
	        globally-visible, routable prefixes.
</dd>
<dt>2.</dt>
<dd>Easing of renumbering burden when clients change
		providers. Because host EIDs are numbered from a separate,
	        non-provider-assigned and non-topologically-bound space, they
	        do not need to be renumbered when a client site changes its
	        attachment points to the network.
</dd>
<dt>3.</dt>
<dd>Mobility with session survivability. Because session state 
		is associated with a persistent host EID, it should be 
		possible 
		for a host (or a collection of hosts) to move to a different 
		point in the network topology (whether by changing providers 
		or by physically moving) without disruption of connectivity.
		
</dd>
<dt>4.</dt>
<dd>Traffic engineering capabilities that can be performed by 
		network elements and do not depend on injecting additional 
		state into the routing system. This will fall out of the 
		mechanism that is used to implement the EID/RLOC split (see 
		<a class='info' href='#OVERVIEW'>Section&nbsp;4<span> (</span><span class='info'>Basic Overview</span><span>)</span></a>).
</dd>
</dl></blockquote>

<p>This draft describes protocol mechanisms to achieve the
	    desired functional separation. For flexibility, the
            document decouples the mechanism used for forwarding packets from
            that used to determine EID to RLOC mappings. This work is in
	    response to and intended to address the problem statement that 
	    came out of the RAWS effort <a class='info' href='#RAWS'>[RAWS]<span> (</span><span class='info'>Meyer, D., Zhang, L., and K. Fall, &ldquo;Report from the IAB Workshop on Routing and  		    Addressing,&rdquo; April&nbsp;2007.</span><span>)</span></a>.
</p>
<p>This draft focuses on a router-based solution. Building the 
	    solution into the network should facilitate incremental deployment
	    of the technology on the Internet. Note that while the detailed
	    protocol specification and examples in this document assume
	    IP version 4 (IPv4), there is nothing in the design that precludes
	    use of the same techniques and mechanisms for IPv6. It should
	    be possible for IPv4 packets to use IPv6 RLOCs and for IPv6 EIDs
	    to be mapped to IPv4 RLOCs.
</p>
<p>Related work on host-based solutions is described in
	    Shim6 <a class='info' href='#SHIM6'>[SHIM6]<span> (</span><span class='info'>Nordmark, E. and M. Bagnulo, &ldquo;Level 3 multihoming shim protocol,&rdquo; October&nbsp;2006.</span><span>)</span></a> and HIP <a class='info' href='#RFC4423'>[RFC4423]<span> (</span><span class='info'>Moskowitz, R. and P. Nikander, &ldquo;Host Identity Protocol (HIP) Architecture,&rdquo; May&nbsp;2006.</span><span>)</span></a>. 
	    Related work on other router-based solutons is described in GSE 
	    <a class='info' href='#GSE'>[GSE]<span> (</span><span class='info'>, &ldquo;GSE - An Alternate Addressing Architecture for  		    IPv6,&rdquo; 1997.</span><span>)</span></a>.
	    This draft attempts to not compete or 
	    overlap with such solutions and the proposed protocol changes
	    are expected to complement a host-based mechanism when Traffic
	    Engineering functionality is desired.
</p>
<p>Some of the design goals of this proposal include:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>Minimize required changes to Internet infrastructure.
</dd>
<dt>2.</dt>
<dd>Require no hardware or software changes to end-systems 
		(hosts).
</dd>
<dt>3.</dt>
<dd>Be incrementally deployable.
</dd>
<dt>4.</dt>
<dd>Require no router hardware changes.
</dd>
<dt>5.</dt>
<dd>Minimize router software changes.
</dd>
<dt>6.</dt>
<dd>Avoid or minimize packet loss when EID-to-RLOC mappings
 		need to be performed.
</dd>
</dl></blockquote>

<p>There are 4 variants of LISP, which differ along a spectrum of
	    strong to weak dependence on the topological nature and possible
	    need for routability of EIDs. The variants are:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>LISP 1:</dt>
<dd>
                    where EIDs are routable through the RLOC topology for
		    bootstrapping EID-to-RLOC mappings.
		    <a class='info' href='#LISP1'>[LISP1]<span> (</span><span class='info'>Farinacci, D., Oran, D., Fuller, V., and J. Schiller, &ldquo;Locator/ID Separation Protocol (LISP1) [Routable  		    ID Version],&rdquo; October&nbsp;2006.</span><span>)</span></a>
</dd>
<dt>LISP 1.5:</dt>
<dd>
                    where EIDs are routable for bootstrapping EID-to-RLOC
		    mappings; such routing is via a separate topology.
</dd>
<dt>LISP 2:</dt>
<dd>
                    where EIDS are not routable and EID-to-RLOC mappings are
		    implemented within the DNS. <a class='info' href='#LISP2'>[LISP2]<span> (</span><span class='info'>Farinacci, D., Oran, D., Fuller, V., and J. Schiller, &ldquo;Locator/ID Separation Protocol (LISP2) [DNS-based  		    Version],&rdquo; November&nbsp;2006.</span><span>)</span></a>
</dd>
<dt>LISP 3:</dt>
<dd>
                    where non-routable EIDs are used as lookup keys for a new
		    EID-to-RLOC mapping database. Use of Distributed
		    Hash Tables <a class='info' href='#DHTs'>[DHTs]<span> (</span><span class='info'>Ratnasamy, S., Shenker, S., and I. Stoica, &ldquo;Routing Algorithms for DHTs: Some Open Questions,&rdquo; .</span><span>)</span></a> to implement such a 
		    database would be an area to explore. Other examples of
		    new mapping database services are <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a>,
		    <a class='info' href='#NERD'>[NERD]<span> (</span><span class='info'>Lear, E., &ldquo;NERD: A Not-so-novel EID to RLOC Database,&rdquo; June&nbsp;2007.</span><span>)</span></a>, and <a class='info' href='#APT'>[APT]<span> (</span><span class='info'>Jen, D., Meisel, M., Massey, D., Wang, L., Zhang, B., and L. Zhang, &ldquo;APT: A Practical Transit Mapping Service,&rdquo; July&nbsp;2007.</span><span>)</span></a>.
		    
</dd>
</dl></blockquote>

<p>This document will focus on LISP 1 and LISP 1.5, both of which
	    rely on a router-based distributed cache and database for
	    EID-to-RLOC mappings. The LISP 2 and LISP 3 mechanisms, which
	    require separate EID-to-RLOC infrastructure, will be documented
	    in additional drafts.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definition of Terms</h3>

<p></p>
<blockquote class="text"><dl>
<dt>Provider Independent (PI) Addresses: </dt>
<dd> an 
		address block assigned from a pool that is not associated
                with any service provider and is therefore not 
		topologically-aggregatable in the routing system.
		
</dd>
<dt>Provider Assigned (PA) Addresses: </dt>
<dd> a block
	        of IP addresses that are assigned to a site by each service 
		provider to which a site connects. Typically, each block is
		sub-block of a service provider CIDR block and is aggregated
		into the larger block before being advertised into the global
	        Internet. Traditionally, IP multihoming has been implemented
	        by each multi-homed site acquiring its own, globally-visible
		prefix. LISP uses only topologically-assigned and aggregatable
		 address
		blocks for RLOCs, eliminating this demonstrably non-scalable
		practice.
		
</dd>
<dt>Routing Locator (RLOC): </dt>
<dd> the IPv4 or
		IPv6 address of an
		egress tunnel router (ETR). It is the output of a EID-to-RLOC
		mapping lookup. An EID maps to one or more RLOCs. Typically,
		RLOCs are numbered from topologically-aggregatable blocks that
 		are assigned to a site at each point to which it attaches to
	        the global Internet; where the topology is defined by the
		connectivity of provider networks, RLOCs can be thought of as
		PA addresses. Multiple RLOCs can be assigned to the same ETR 
		device or to multiple ETR devices at a site.
</dd>
<dt>Endpoint ID (EID): </dt>
<dd> a 32- or 128-bit value
	        used in the source and destination address fields
	        of the first (most inner) LISP header of a packet. The host
	        obtains a destination EID the same way it obtains an 
		destination address today, for example through a DNS lookup
		or SIP exchange. The source EID is
	        obtained via existing mechanisms used to set a hosts "local"
	        IP address. LISP uses PI blocks for EIDs; such EIDs MUST NOT
		be used as LISP RLOCs. Note that EID blocks may be assigned
 		in a hierarchical manner, independent of the network topology,
		to facilitate scaling of the mapping database. In addition, 
		an EID
		block assigned to a site may have site-local structure
		(subnetting) for routing within the site; this structure is
		not visible to the global routing system.
		
</dd>
<dt>EID-prefix: </dt>
<dd>A power-of-2 block of EIDs which 
		are allocated to a site by an address allocation authority.
		EID-prefixes are associated with a set of RLOC addresses
		which make up a "database mapping". EID-prefix allocations
		can be broken up into smaller blocks when an RLOC set is
		to be associated with the smaller EID-prefix.
</dd>
<dt>End-system: </dt>
<dd> is an IPv4 or IPv6 device that 
		originates packets with a single IPv4 or IPv6 header. The 
		end-system supplies an
		EID value for the destination address field of the IP header
		when communicating globally (i.e. outside of it's routing
		domain). An end-system can be a host computer, a switch or
		router device, or any network appliance. An iPhone.
		
</dd>
<dt>Ingress Tunnel Router (ITR): </dt>
<dd> a router which
                accepts an IP packet with a single IP header (more precisely,
		an IP packet that does not contain a LISP header). The
                router treats this "inner" IP destination address as an EID
		and performs an EID-to-RLOC mapping lookup. The router 
		then prepends an "outer" IP header with one of its 
		globally-routable RLOCs in the source address field and the 
		result of the mapping lookup in the destination address field.
		Note
		that this destination RLOC may be an intermediate, proxy
		device that has better knowledge of the EID-to-RLOC mapping
		closest to the destination EID. In general, an ITR receives
		IP packets from site end-systems on one side and sends 
		LISP-encapsulated IP packets toward the Internet on the other 
		side.
</dd>
<dt></dt>
<dd>Specifically, when a service provider prepends a LISP 
		header 
		for Traffic Engineering purposes, the router that does this
		is also regarded as an ITR. The outer RLOC the ISP ITR uses
		can be based on the outer destination address (the originating
		ITR's supplied RLOC) or the inner destination address (the
		originating hosts supplied EID).
                
</dd>
<dt>TE-ITR: </dt>
<dd>is an ITR that is deployed in a 
		service provider network that prepends an additional LISP
		header for Traffic Engineering purposes.
		
</dd>
<dt>Egress Tunnel Router (ETR): </dt>
<dd> a router that
 		accepts an IP packet where destination address in the "outer"
		IP header is one of its own RLOCs. The router strips the
                "outer" header and forwards the packet based on the next IP
		header found. In general, an ETR receives LISP-encapsulated
		IP packets from the Internet on one side and sends decapsulated
		IP packets to site end-systems on the other side. ETR
		functionality does not have to be limited to a router device.
		A server host can be the endpoint of a LISP tunnel as well.
                
</dd>
<dt>TE-ETR: </dt>
<dd>is an ETR that is deployed in a 
		service provider network that strips an outer LISP header for 
		Traffic Engineering purposes.
		
</dd>
<dt>EID-to-RLOC Cache: </dt>
<dd> a short-lived, 
		on-demand database in an ITR that
		stores, tracks, and is responsible for timing-out and
		otherwise validating EID-to-RLOC mappings. This cache is
		distinct from the &quot;database&quot;, the cache is 
		dynamic, local, and relatively small while and the database
		is distributed, relatively static, and much global in scope.
		
</dd>
<dt>EID-to-RLOC Database: </dt>
<dd> a globally, distributed
		database that contains all known EID-prefix to RLOC mappings. 
		Each potential ETR typically contains a small
		piece of the database: the EID-to-RLOC mappings for the EID
		prefixes "behind" the router. These map to one of the 
		router's own, globally-visible, IP addresses.
</dd>
<dt>Recursive Tunneling: </dt>
<dd>when a packet has more 
		than one LISP IP header. Additional layers of tunneling may
		be employed to implement traffic engineering or other
		re-routing as needed. When this is done, an additional
		"outer" LISP header is added and the original RLOCs are
		preserved in the "inner" header.
                
</dd>
<dt>Reencapsulating Tunnels: </dt>
<dd>when a packet has no 
		more than one LISP IP header (two IP headers total) and when
		it needs to be diverted to new RLOC, an ETR
		can decapsulate the packet (remove the LISP header) and
		prepend a new tunnel header, with new RLOC, on to the
		packet. Doing this allows a packet to be re-routed by the
		re-encapsulating router without adding the overhead of
		additional tunnel headers.
                
</dd>
<dt>LISP Header: </dt>
<dd>a term used in this document to
		refer to the outer IPv4 or IPv6 header, a UDP header, and
		a LISP header, an ITR prepends or an ETR strips.
</dd>
</dl></blockquote>

<a name="OVERVIEW"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Basic Overview</h3>

<p>One key concept of LISP is that end-systems (hosts) operate
	    the same way they do today. The IP addresses that
            hosts use for tracking sockets, connections, and for 
	    sending and receiving packets do not change. In LISP terminology,
	    these IP addresses are called Endpoint Identifiers (EIDs).
</p>
<p>Routers continue to forward packets based on IP destination
	    addresses. These addresses are referred to as Routing Locators
	    (RLOCs). Most routers along a path between two hosts will not
	    change; they continue to perform routing/forwarding lookups
            on addresses (RLOCs) in the IP header.
</p>
<p>This design introduces &quot;Tunnel Routers&quot;, which prepend
	    LISP headers on host-originated packets and strip them prior to
	    final delivery to their destination. The IP addresses in this
            &quot;outer header&quot; are RLOCs. During end-to-end packet
	    exchange between two Internet hosts, an ITR
	    prepends a new LISP header to each packet and an egress tunnel
	    router strips the new header. The ITR performs
            EID-to-RLOC lookups to determine the routing path to the the
	    ETR, which has the RLOC as one of its IP
	    addresses. 
</p>
<p>Some basic rules governing LISP are:
</p>
<p></p>
<ul class="text">
<li>End-systems (hosts) only know about EIDs.
</li>
<li>EIDs are always IP addresses assigned to hosts.
</li>
<li>Routers mostly deal with Routing Locator addresses. See 
		details 
		later in  <a class='info' href='#MOSTLY'>Section&nbsp;4.1<span> (</span><span class='info'>Packet Flow Sequence</span><span>)</span></a> to clarify what is meant
                by &quot;mostly&quot;.
</li>
<li>RLOCs are always IP addresses assigned to routers;
		preferably, topologically-oriented addresses from provider
		CIDR blocks. 
</li>
<li>Routers can use their RLOCs as EIDs but can also be assigned
                EIDs when performing host functions. Those EIDs MUST NOT be
		used as RLOCs. When EIDs are used the routeability of them
		is scoped to within the site. A hybrid use of this, for
		example is when a router runs the BGP protocol where iBGP
		peerings may use EIDs and eBGP peerings may use RLOCs.
</li>
<li>EIDs are not expected to be usable for global end-to-end 
		communication in the absence of an EID-to-RLOC mapping
		operation. They are expected to be used locally for
		intra-site communication.
</li>
<li>EID prefixes are likely to be hierarchically assigned in
		a manner which is optimized for administrative convenience
		and to facilitate scaling of the EID-to-RLOC mapping
		database. The hierarchy is based on a address alocation
		hierarchy which is not dependent on the network toplogy.
</li>
<li>EIDs may also be structured (subnetted) in a manner
		suitable for local routing within an autonomous system. 
</li>
</ul>

<p>An additional LISP header may be pre-pended to packets by a
	    transit router (i.e. TE-ITR) when re-routing of the end-to-end 
	    path for a
	    packet is desired. An obvious instance of this would be an ISP
	    router that needs to perform traffic engineering for packets in
	    flow through its network. In such a situation, termed Recursive
	    Tunneling, an ISP transit acts as an additional ingress tunnel
	    router and the RLOC it uses for the new prepended header would be
	    either an TE-ETR within the ISP (along intra-ISP
	    traffic engineered path) or in an TE-ETR within
	    another ISP (an inter-ISP traffic engineered path, where an
	    agreement to build such a path exists). 
</p>
<p>Tunnel Routers can be placed fairly flexibly in a multi-AS 
	    topology. For example, the ITR for a particular
	    end-to-end packet exchange might be the first-hop or default router
	    within a site for the source host. Similarly, the egress tunnel
	    router might be the last-hop router directly-connected to the
	    destination host. Another example, perhaps for a VPN service
	    out-sourced to an ISP by a site, the ITR could
	    be the site&#039;s border router at the service provider 
	    attachment point. Mixing and matching of site-operated, 
	    ISP-operated, and other tunnel routers is allowed for maximum
	    flexibility.
	    See <a class='info' href='#DEPLOYMENT'>Section&nbsp;8<span> (</span><span class='info'>Deployment Scenarios</span><span>)</span></a> for more details.
</p>
<a name="MOSTLY"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Packet Flow Sequence</h3>

<p>This section provides an example of the
		unicast packet flow with the following parameters:
</p>
<p></p>
<ul class="text">
<li>Source host &quot;host1.abc.com&quot; is sending a packet 
		to &quot;host2.xyz.com&quot;.
</li>
<li>Each site is multi-homed, so each tunnel router has an 
		address (RLOC) assigned
                from each of the site&#039;s attached service provider 
		address blocks.
</li>
<li>The ITR and ETR are directly connected to the source and 
		destination, respectively.
</li>
</ul>

<p>Client host1.abc.com wants to communicate with server 
		host2.xyz.com:
</p>
<p></p>
<ol class="text">
<li>host1.abc.com wants to open a TCP connection to 
		host2.xyz.com. It does a DNS
                lookup on host2.xyz.com. An A record is returned. This 
		address is used as the
                destination EID and the locally-assigned address of 
		host1.abc.com is  used as the
                source EID. An IP packet is built using the EIDs in the IP
		header  and sent to the default router.
</li>
<li>The default router is configured as an ITR. It prepends
		a LISP header to the packet, with one of its 
		RLOCs as the source IP address and uses the destination EID
		from the original packet header as the destination IP
		address. Subsequent packets continue to behave the same way
		until a mapping is learned.
</li>
<li>In LISP 1, the packet is routed through the Internet as it 
		is today. In
		LISP 1.5, the packet is routed on a different topology which 
		may have EID prefixes
                distributed and advertised in an aggregatable fashion. In 
		either case, the
		packet arrives at the ETR. The router is 
		configured to "punt"
		the packet to the router's control-plane processor. See 
		<a class='info' href='#PUNT'>Section&nbsp;7<span> (</span><span class='info'>Router Performance Considerations</span><span>)</span></a> for more details.
</li>
<li>The LISP header is stripped so that the packet can be
		forwarded by the router control-plane. The router looks up
		the destination EID in the router&#039;s EID-to-RLOC 
		database (not the cache, but the configured data structure
		of RLOCs). An EID-to-RLOC Map-Reply message is originated by 
		the egress router and is
		addressed to the source RLOC from the LISP header of the
		original packet (this is the ITR). The source
		RLOC in the IP header of the UDP message is one of the
 		ETR&#039;s RLOCs (one of the RLOCs that is embedded
		in the UDP payload).
</li>
<li>The ITR receives the UDP message, 
		parses the message (to check for format validity) and stores
		the EID-to-RLOC information from the packet. This information 
		is put in
		the ITR&#039;s EID-to-RLOC mapping cache 
		(this is the
		on-demand cache, the cache where entries time out due to 
		inactivity).
</li>
<li>Subsequent packets from host1.abc.com to host2.xyz.com will
		have a LISP header prepended with the RLOCs learned from the
		ETR.
</li>
<li>The egress tunnel receives these packets directly (since 
		the destination address is one of its assigned IP addresses),
		strips the LISP header and delivers the packets to the
		attached destination host.
</li>
</ol>

<p>In order to eliminate the need for a mapping lookup in
		the reverse direction, the ETR gleans RLOC
		information from the LISP header. Both ITR
		and the ETR may also influence the decision
		the other makes in selecting an RLOC. See
		<a class='info' href='#mapping'>Section&nbsp;6<span> (</span><span class='info'>EID-to-RLOC Mapping</span><span>)</span></a> for more details.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Tunneling Details</h3>

<p>This section describes the LISP Data Message which defines the
	tunneling header used to encapsulate IPv4 and IPv6 packets which
	contain EID addresses. Even though the following formats illustrate
	IPv4-in-IPv4 and IPv6-in-IPv6 encapsulations, the other 2 combinations
	are supported as well.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
LISP IPv4-in-IPv4 Header Format</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version|  IHL  |Type of Service|          Total Length         |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Identification        |Flags|      Fragment Offset    |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
OH     |  Time to Live | Protocol = 17 |         Header Checksum       |
  \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \   |                    Source Routing Locator                     |
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                 Destination Routing Locator                   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port = xxxx      |       Dest Port = 4342        |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / | Type  |  Locator Reach Bits   |        Nonce ...              |
 LISP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                          ... Nonce                            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version|  IHL  |Type of Service|          Total Length         |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Identification        |Flags|      Fragment Offset    |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
IH     |  Time to Live |    Protocol   |         Header Checksum       |
  \    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   \   |                           Source EID                          |
    \  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                         Destination EID                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
LISP IPv6-in-IPv6 Header Format</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version| Traffic Class |           Flow Label                  |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Payload Length        | Next Header=17|   Hop Limit   |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
 O     +                                                               +
 u     |                                                               |
 t     +                     Source Routing Locator                    +
 e     |                                                               |
 r     +                                                               +
       |                                                               |
 H     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 d     |                                                               |
 r     +                                                               +
       |                                                               |
  \    +                  Destination Routing Locator                  +
   \   |                                                               |
    \  +                                                               +
     \ |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |       Source Port = xxxx      |       Dest Port = 4342        |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Type=1 |  Locator Reach Bits   |        Nonce ...              |
 LISP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |                          ... Nonce                            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |Version| Traffic Class |           Flow Label                  |
    /  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   /   |         Payload Length        |  Next Header  |   Hop Limit   |
  /    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
 I     +                                                               +
 n     |                                                               |
 n     +                          Source EID                           +
 e     |                                                               |
 r     +                                                               +
       |                                                               |
 H     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 d     |                                                               |
 r     +                                                               +
       |                                                               |
  \    +                        Destination EID                        +
   \   |                                                               |
    \  +                                                               +
     \ |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>
<a name="LRB"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Tunnel Header Field Descriptions</h3>

<p></p>
<blockquote class="text"><dl>
<dt>IH Header:</dt>
<dd> is the inner header, preserved from the 
	    datagram
	    received from the originating host. The source and destination
	    IP addresses are EIDs.
</dd>
<dt>OH Header:</dt>
<dd> is the outer header prepended by an 
            ITR. The address fields contain RLOCs obtained
	    from the ingress router's EID-to-RLOC cache. The IP protocol
	    number is &quot;UDP (17)&quot; from <a class='info' href='#RFC0768'>[RFC0768]<span> (</span><span class='info'>Postel, J., &ldquo;User Datagram Protocol,&rdquo; August&nbsp;1980.</span><span>)</span></a>.
</dd>
<dt>UDP Header:</dt>
<dd> contains a random source port 
	    allocated by the ITR when encapsulating a packet. The destination 
	    port MUST be
	    set to the well-known IANA assigned port value 4342. The UDP 
	    checksum field 
	    MUST be transmitted as 0 and not ignore by the ETR.
</dd>
<dt>UDP Length:</dt>
<dd> field contains the original packet's 
	    length.
	    For an IPv4 encapsulated packet, the inner header Total Length
	    is copied. For an IPv6 encapsualted packet, the inner header
	    Payload Length plus the size of the IPv6 header (40 bytes) is
	    copied.
</dd>
<dt>LISP Type:</dt>
<dd> set to 1 to encode a LISP Data 
	    Message.
</dd>
<dt>LISP Nonce:</dt>
<dd> is an ITR randomly
	    generated 6-byte value which tests return routability of an ETR
	    echoing back the none in a Map-Reply message.
</dd>
<dt>LISP Locator Reach Bits:</dt>
<dd> in the LISP header are 
	    set by  an ITR
	    to indicate to an ETR the reachability of the Locators in the
	    source site. Each RLOC in a Map-Reply is assigned an ordinal value
	    from 0 to n-1 (when there are n RLOCs in a mapping entry). The
	    Locator Reach Bits are number from 0 to n-1 from the right 
	    significant bit of the 12-bit field. When a bit is set to 1, the
	    ITR is indicating to the ETR the RLOC associated with the bit
	    ordinal is reachable. See <a class='info' href='#loc-reach'>Section&nbsp;6.3<span> (</span><span class='info'>Routing Locator Reachability</span><span>)</span></a> 
	    for details on how an ITR can determine other site ITRs are 
	    reachable.
</dd>
</dl></blockquote>

<p>When doing Recursive Tunneling:
</p>
<p></p>
<ul class="text">
<li>The OH header Time to Live field MUST be copied from the 
		IH header Time to Live field. 
</li>
<li>The OH header Type of Service 
		field SHOULD be copied from the IH header Type of Service
		field.
</li>
</ul>

<p>When doing Re-encapsulated Tunneling:
</p>
<p></p>
<ul class="text">
<li>The new OH header Time to Live field SHOULD be copied 
		from the stripped OH header Time to Live field.
</li>
<li>The new OH header Type of Service field SHOULD be 
		copied from the stripped OH header Type of Service field.
</li>
</ul>

<p>Copying the TTL serves two purposes. First it preserves the
            distance the host intended the packet to travel. And more
	    importantly, it provides for suppression of looping packets in
	    the event there is a loop of concatenated tunnels due to
	    misconfiguration.
	    
</p>
<a name="mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
EID-to-RLOC Mapping</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Control-Plane Packet Format</h3>

<p>When LISP 1 or LISP 1.5 are used, new UDP packet types 
	    encode the EID-to-RLOC mappings:
            
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Version|  IHL  |Type of Service|          Total Length         |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Identification        |Flags|      Fragment Offset    |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Time to Live | Protocol = 17 |         Header Checksum       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                    Source Routing Locator                     |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                 Destination Routing Locator                   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |           Source Port         |         Dest Port             |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                         LISP Message                          |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |Version| Traffic Class |           Flow Label                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |         Payload Length        | Next Header=17|   Hop Limit   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       +                                                               +
       |                                                               |
       +                     Source Routing Locator                    +
       |                                                               |
       +                                                               +
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       +                                                               +
       |                                                               |
       +                  Destination Routing Locator                  +
       |                                                               |
       +                                                               +
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     / |           Source Port         |         Dest Port             |
  UDP  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     \ |           UDP length          |        UDP Checksum           |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                         LISP Message                          |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>
<p>The LISP UDP-based messages are the Map-Request and
	    Map-Reply messages. These message formats are also used by
	    LISP-CONS <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> but are sent over TCP
	    connections instead. However, this specification is the 
	    authoritative source for message format definitions for the
	    Map-Request and Map-Reply messages.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
Map-Request Message Format</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |  Locator Reach Bits   |         Checksum              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            Nonce ...                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          ... Nonce            | Record count  |A|  Reserved   |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           ITR-AFI             |            CAR-AFI            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Originating ITR RLOC Address                |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Originating CAR EID-Prefix                  |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Rec -&gt; | EID mask-len  |    EID-AFI    |         EID-prefix ...        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                      Path Vector  List                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>
<p>Packet field descriptions:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Type:</dt>
<dd>2 (Map-Request)
</dd>
<dt>Locator Reach Bits:</dt>
<dd>
	    Refer to <a class='info' href='#LRB'>Section&nbsp;5.3<span> (</span><span class='info'>Tunnel Header Field Descriptions</span><span>)</span></a>.
	    
</dd>
<dt>Checksum:</dt>
<dd>
	    A complement of the 1-complements sum of the LISP packet.
	    The checksum MUST be computed and the UDP checksum MUST be set
	    to 0.
	    
</dd>
<dt>Nonce:</dt>
<dd>
	    A 6-byte random value created by the sender of the Map-Request.
	    
</dd>
<dt>Record count:</dt>
<dd>
	    The number of records in this request message.  A record 
	    comprises of what is labeled 'Rec" above and occurs the number 
	    of times equal to Record count.
	    
</dd>
<dt>A:</dt>
<dd>
	    This is an authoritative bit, which is set to 0 for UDP-based
	    Map-Requests sent by an ITR. See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for
	    TCP-based Map-Requests.
	    
</dd>
<dt>Reserved:</dt>
<dd>
	    Set to 0 on transmission and ignored on receipt.
	    
</dd>
<dt>ITR-AFI:</dt>
<dd>
	    Address family of the "Originating ITR RLOC Address" field.
	    
</dd>
<dt>CAR-AFI:</dt>
<dd>
	    Address family of the "Originating CAR EID-Prefix" field.
	    
</dd>
<dt>Originating ITR RLOC Address:</dt>
<dd>
	    Set to 0 for UDP-based messages. See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for
	    TCP-based Map-Requests.
	    
</dd>
<dt>Originating CAR EID-Prefix:</dt>
<dd>
	    Set to 0 for UDP-based messages by an ITR. See 
	    <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for TCP-based Map-Requests.
	    
</dd>
<dt>EID mask-len:</dt>
<dd>
	    Mask length for EID prefix.
	    
</dd>
<dt>EID-AFI:</dt>
<dd>
	    Address family of EID-prefix according to <a class='info' href='#RFC2434'>[RFC2434]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a>
	    
</dd>
<dt>EID-prefix:</dt>
<dd>
	    4 bytes if an IPv4 address-family, 16 bytes if an IPv6 
	    address-family.
	    
</dd>
<dt>Path Vector List:</dt>
<dd>
	    See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for details. This field is not used
	    in UDP Map-Requests.
	    
</dd>
</dl></blockquote>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
EID-to-RLOC UDP Map-Request Message</h3>

<p>A Map-Request contains one or more EIDs encoded in prefix 
		format with a Locator count of 0. The EID-prefix MUST NOT be
		more specific than a cache entry stored from a 
		previously-received Map-Reply.
</p>
<p>A Map-Request is sent from an ITR when it 
		wants to test an RLOC for reachability. This is performed by 
		using the RLOC as the destination address for Map-Request 
		message with a randomly allocated source UDP port number and
		the well-known destination port number 4342. A successful 
		Map-Reply updates the cached
		set of RLOCs associated with the EID prefix range.
</p>
<p>Map-Requests MUST be rate-limited. It is recommended that
		a Map-Request for the same EID-prefix be sent no more than 
		once per second.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
Map-Reply Message Format</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |  Locator Reach Bits   |         Checksum              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                            Nonce ...                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |          ... Nonce            | Record count  |   Reserved    |
+----&gt; +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      |                          Record  TTL                          |
|      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      | Locator count | EID mask-len  |A|        Reserved             |
|      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
R      |           ITR-AFI             |            EID-AFI            |
e      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
c      |                   Originating ITR RLOC Address                |
o      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
r      |                          EID-prefix                           |
d      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     /|    Priority   |    Weight     |    Unused     |    Loc-AFI    |
|  Loc +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     \|                             Locator                           |
+---&gt;  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        Path Vector List                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre></div>
<p>
</p>
<p>Packet field descriptions:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Type:</dt>
<dd>3 (Map-Reply)
</dd>
<dt>Locator Reach Bits:</dt>
<dd>
	    Refer to <a class='info' href='#LRB'>Section&nbsp;5.3<span> (</span><span class='info'>Tunnel Header Field Descriptions</span><span>)</span></a>.
	    
</dd>
<dt>Checksum:</dt>
<dd>
	    A complement of the 1-complements sum of the LISP packet.
	    The checksum MUST be computed and the UDP checksum MUST be set
	    to 0.
	    
</dd>
<dt>Nonce:</dt>
<dd>
	    A 6-byte value set in a data probe packet or a Map-Request that
	    is echoed here in the Map-Reply.
	    
</dd>
<dt>Record count:</dt>
<dd>
	    The number of records in this reply message.  A record 
	    comprises of what is labeled &#039;Record&#039; above and 
	    occurs the number of times equal to Record count.
	    
</dd>
<dt>Reserved:</dt>
<dd>
	    Set to 0 on transmission and ignored on receipt.
	    
</dd>
<dt>Record TTL:</dt>
<dd>
	    The time in minutes the recipient of the Map-Reply will
	    store the mapping.  If the TTL is 0, the entry should be removed
	    from the cache immediately.  If the value is 0xffffffff, the
	    recipient can decide locally how long to store the mapping.
	    
</dd>
<dt>Locator count:</dt>
<dd>
	    The number of Locator entries.  A locator entry comprises what is 
	    labeled above as &#039;Loc&#039;.
	    
</dd>
<dt>EID mask-len:</dt>
<dd>
	    Mask length for EID prefix.
	    
</dd>
<dt>A:</dt>
<dd>
            The Authoritative bit, when sent by a UDP-based message is 
	    always set by the ETR. See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for
	    TCP-based Map-Replies.
            
</dd>
<dt>ITR-AFI:</dt>
<dd>
	    Address family of the "Originating ITR RLOC Address" field.
	    
</dd>
<dt>EID-AFI:</dt>
<dd>
	    Address family of EID-prefix according to 
	    <a class='info' href='#RFC2434'>[RFC2434]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a>.
	    
</dd>
<dt>Originating ITR RLOC Address:</dt>
<dd>
	    Set to 0 for UDP-based messages. See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for
	    TCP-based Map-Replies.
	    
</dd>
<dt>EID-prefix:</dt>
<dd>
	    4 bytes if an IPv4 address-family, 16 bytes if an IPv6
	    address-family.
	    
</dd>
<dt>Priority:</dt>
<dd>each RLOC is assigned a priority.
	    Lower values are more preferable. When multiple RLOCs
	    have the same priority, they are used in a load-split fashion.
	    A value of 255 means the RLOC MUST NOT be used.
</dd>
<dt>Weight:</dt>
<dd>when priorities are the same for multiple 
	    RLOCs, the weight indicates how to balance traffic between them.
	    Weight is encoded as a percentage of total packets that match
	    the mapping entry. If a non-zero weight value is
	    used for any RLOC, then all RLOCs must use a non-zero weight value
	    and then the sum of all weight values MUST equal 100. 
	    What did the 3rd grader say after Steve Jobs gave an iPhone demo
	    to the class? If a zero
	    value is used for any RLOC weight, then all weights MUST be zero
	    and the receiver of the Map-Reply will decide how to load-split
	    traffic.
</dd>
<dt>Locator:</dt>
<dd>an IPv4 or IPv6  address (as encoded by
	    the &#039;Loc-AFI&#039; field) assigned to an ETR or 
	    router acting as a proxy replier for the EID-prefix. Note that 
	    the destination RLOC address MAY be an anycast
	    address if the tunnel egress point may be via more than one
	    physical device. A souce RLOC can be an anycast address as well.
	    The source or destination RLOC MUST NOT be
	    the broadcast address (255.255.255.255 or any subnet broadcast
	    address known to the router), and MUST NOT be a link-local
	    multicast address.
	    The source RLOC MUST NOT be a multicast address. The destination
	    RLOC SHOULD be a multicast address if it is being mapped from a
	    multicast destination EID.
</dd>
<dt>Path Vector List:</dt>
<dd>
	    See <a class='info' href='#CONS'>[CONS]<span> (</span><span class='info'>Farinacci, D., Fuller, V., and D. Meyer, &ldquo;LISP-CONS: A Content distribution Overlay Network  		    Service for LISP,&rdquo; June&nbsp;2007.</span><span>)</span></a> for details. This field is not used
	    in UDP Map-Replies.
	    
</dd>
</dl></blockquote>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.4"></a><h3>6.1.4.&nbsp;
EID-to-RLOC UDP Map-Reply Message</h3>

<p>When a data packet triggers a Map-Reply to be sent, the 
		RLOCs associated with the EID-prefix matched by the EID
		in the original packet destination IP address field will be
		returned. The RLOCs in the Map-Reply are the globally-routable
		IP addresses of the ETR but are not
		necessarily reachable; separate testing of reachability is
		required.
		
</p>
<p>Note that a Map-Reply may contain different EID-prefix
		granularity (prefix + length) than the Map-Request which 
		triggers
		it. This might occur if a Map-Request were for a prefix that 
		had been returned by an earlier Map-Reply. In such a case, the
		requester updates its cache with the new prefix
		information and granularity. For example, a requester with
		two cached EID-prefixes that are covered by a Map-Reply 
		containing
		one, less-specific prefix, replaces the entry with the
		less-specific EID-prefix. Note that the reverse, replacement 
		of one less-specific prefix with multiple more-specific 
		prefixes, can also occur but not by removing the 
		less-specific prefix rather by adding the more-specific 
		prefixes which during a lookup will override the less-specific
		prefix.
		
</p>
<p>Replies SHOULD be sent for an EID-prefix no more often 
		than once per second to the same requesting router. For
		scalability, it is expected that aggregation of EID addresses
		into EID-prefixes will allow one Map-Reply to satisfy a
		mapping for the EID addresses in the prefix range thereby
		reducing the number of Map-Request messages.
		
</p>
<p>The addresses for a Data message or Map-Request message
		are swapped and used for sending the Map-Reply. The UDP
		source and destination ports are swapped as well. That is,
		the source port in the UDP header for the Map-Reply is set to
		the well-known UDP port number 4342.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Routing Locator Selection</h3>

<p>Both client-side and server-side may need control over 
	    the selection of RLOCs for conversations between them. 
            This control is achieved by manipulating the Priority and Weight
	    fields in EID-to-RLOC Map-Reply messages. Alternatively,
	    RLOC information may be gleaned from received tunneled packets or
	    EID-to-RLOC Map-Request messages.
</p>
<p>The following enumerates different scenarios for choosing
	    RLOCs and the controls that are available:
</p>
<p></p>
<ul class="text">
<li>Server-side returns one RLOC. Client-side can only 
	    use one RLOC. Server-side has complete control of the 
	    selection.
</li>
<li>Server-side returns a list of RLOC where a subset 
	    of the list has the same best priority. Client can only use 
	    the subset list according to the 
            weighting assigned by the server-side. In this case, the
	    server-side controls both the subset list and load-splitting
	    across its members. The client-side can use RLOCs outside
	    of the subset list if it determines that the subset
	    list is unreachable (unless RLOCs are set to a Priority of 255). 
            Some sharing of control exists: the server-side determines
	    the destination RLOC list and load distribution while the 
	    client-side has the option of using alternatives to this list if
	    RLOCs in the list are unreachable.
</li>
<li>Server-side sets weight of 0 for the RLOC subset list. In
	    this case, the client-side can choose how the traffic load is 
	    spread across the subset list. Control is shared by the
	    server-side determining the list and the client determining
	    load distribution. Again, the client can use alternative RLOCs
	    if the server-provided list of RLOCs are unreachable.
</li>
<li>Either side (more likely on the server-side ETR) decides not to
	    send an Map-Request. For example, if the server-side ETR does not 
	    send Map-Requests, it gleans RLOCs from the
	    client-side ITR, giving the client-side ITR responsibility for
	    bidirectional RLOC reachability and preferability.
	    Server-side ETR gleaning of the client-side ITR RLOC is done by 
	    caching 
	    the inner header source EID and the outer header source RLOC
	    of received packets. The client-side ITR controls how traffic is
	    returned and can alternate using an outer header source RLOC,
	    which then can be added to the list the server-side ETR uses to
	    return traffic. Since no Priority or Weights are provided using
	    this method, the server-side ETR must assume each client-side 
	    ITR RLOC
	    uses the same best Priority with a Weight
	    of zero. In addition, since EID-prefix encoding cannot be conveyed
	    in data packets, the EID-to-RLOC cache on tunnel routers
	    can grow to be very large.
</li>
</ul>

<p>RLOCs that appear in EID-to-RLOC Map-Reply messages are 
	    considered reachable. The Map-Reply and the database mapping
	    service does not provide any reachability status for Locators. 
	    This is done outside of the mapping service. See next section
	    for details.
</p>
<a name="loc-reach"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Routing Locator Reachability</h3>

<p>There are 4 methods for determining when a Locator is either
	    reachable or has become unreachable:
</p>
<p></p>
<ol class="text">
<li>Locator reachability is determined by an ETR by examining 
		the 
		Loc-Reach-Bits from a LISP header of a Data Message which is
		provided by an ITR when an ITR encapsulates data.
</li>
<li>Locator unreachability is determined by an ITR by receiving
		ICMP Network or Host Unreachable messages.
</li>
<li>ETR unreachability is determined when a host sends 
		an ICMP	Port Unreachable message.
</li>
<li>Locator reachability is determined by receiving a Map-Reply
                message from a ETR's Locator address in response to a 
		previously sent Map-Request.
</li>
</ol>

<p>When determining Locator reachability by examining the 
	    Loc-Reach-Bits from the LISP Data Message, an ETR will receive 
	    up to
	    date status from the ITR closest to the Locators at the source
	    site. The ITRs at the source site can determine reachability when
	    running their IGP at the site. When the ITRs are deployed on CE
	    routers, typically a default route is injected into the site's IGP
	    from each of the ITRs. If an ITR goes down, the CE-PE link goes 
	    down, or the PE router goes down, the CE router withdraws the 
	    default
	    route. This allows the other ITRs at the site to determine one
	    of the Locators has gone unreachable.
</p>
<p>The Locators listed in a Map-Reply are numbered with ordinals
	    0 to n-1. The Loc-Reach-Bits in a LISP Data Message are numbered
	    from 0 to n-1 starting with the least signfiicant bit numbered as
	    0. So, for example, if the ITR with locator listed as the 3rd 
	    Locator position in the Map-Reply goes down, all other ITRs at 
	    the site will have the 3rd bit from the right cleared (the bit 
	    that corresponds to ordinal 2).
</p>
<p>When an ETR decapsulates a packet, it will look for a change
	    in the Loc-Reach-Bits value. When a bit goes from 1 to 0, the
	    ETR will refrain from encapsulating packets to the Locator that
	    has just gone unreachable. It can start using the Locator again
	    when the bit that corresponds to the Locator goes from 0 to 1.
</p>
<p>When ITRs at the site are not deployed in CE routers, the IGP
	    can still be used to determine the reachability of Locators
	    provided they are injected a stub links into the IGP. This is
	    typically done when a /32 address is configured on a loopback
	    interface.
</p>
<p>When ITRs receive ICMP Network or Host Unreachable messages as
	    a method to determine unreachability, they will refrain from
	    using Locators which are described in Locator lists of Map-Replies.
	    However, using this approach is unreliable because many network
	    operators turn off generation of ICMP Unreachable messages.
</p>
<p>Optionally, an ITR can send a Map-Request to a Locator and if
	    a Map-Reply is returned, reachability of the Locator has been
	    achieved. Obviously, sending such probes increases the number of 
	    control messages originated by tunnel routers for active flows, so
	    Locators are assumed to be reachable when they are advertised.
</p>
<p>This assumption does create a dependency: Locator unreachability
	    is detected by the receipt of ICMP Host Unreachable messages.
	    When an Locator has been determined unreachable, it is not used for
	    active traffic; this is the same as if it were listed in a 
	    Map-Reply with priority 255.
</p>
<p>The ITR can later test the reachability of 
	    the unreachable Locator by sending periodic Requests. Both Requests
	    and Replies MUST be rate-limited. Locator reachability testing
	    is never done with data packets since that increases the risk
	    of packet loss for end-to-end sessions.
</p>
<a name="PUNT"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Router Performance Considerations</h3>

<p>LISP is designed to be very hardware-based forwarding friendly.
	    By doing tunnel header prepending <a class='info' href='#RFC1955'>[RFC1955]<span> (</span><span class='info'>Hinden, R., &ldquo;New Scheme for Internet Routing and Addressing (ENCAPS) for IPNG,&rdquo; June&nbsp;1996.</span><span>)</span></a> and 
	    stripping instead of re-writing addresses, existing hardware could
	    support the forwarding model with little or no
            modification. Where modifications are required, they should be
	    limited to re-programming existing hardware rather than requiring
	    expensive design changes to hard-coded algorithms in silicon.
</p>
<p>A few implementation techniques can be used to incrementally
	    implement LISP:
</p>
<p></p>
<ul class="text">
<li>When a tunnel encapsulated packet is received by an 
		ETR, the outer destination address may not 
		be the address of the router. This makes it challenging for
		the control-plane to get packets from the hardware. This
		may be mitigated by creating special FIB entries for the
		EID-prefixes of EIDs served by the ETR
		(those for which the router provides an RLOC translation).
		These FIB entries are marked with a flag indicating that
		control-plane processing should be performed. The 
		forwarding logic of testing for particular IP protocol
		number value is not necessary. No changes to existing,
		deployed hardware should be needed to support this. 
</li>
<li>On an ITR, prepending a new IP header 
		is as simple
		as adding more bytes to a MAC rewrite string and prepending
		the string as part of the outgoing encapsulation procedure. 
		Many routers that support GRE tunneling 
		<a class='info' href='#RFC3056'>[RFC3056]<span> (</span><span class='info'>Carpenter, B. and K. Moore, &ldquo;Connection of IPv6 Domains via IPv4 Clouds,&rdquo; February&nbsp;2001.</span><span>)</span></a> or 6to4 tunneling 
		<a class='info' href='#RFC2784'>[RFC2784]<span> (</span><span class='info'>Farinacci, D., Li, T., Hanks, S., Meyer, D., and P. Traina, &ldquo;Generic Routing Encapsulation (GRE),&rdquo; March&nbsp;2000.</span><span>)</span></a> can already support this action.
</li>
<li>When a received packet's outer destination address
		contains an EID which is not intended to be forwarded on the
		routable topology (i.e. LISP 1.5), the source address of a
		data packet or the router interface with which the source
		is associated (the interface from which it was received)
		can be associated with a VRF (Virtual Routing/Forwarding), in 
		which a different (i.e. non-congruent) topology can be used 
		to find EID-to-RLOC mappings.
</li>
</ul>

<a name="DEPLOYMENT"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Deployment Scenarios</h3>

<p>This section will explore how and where ingress and 
	    ETRs
	    can be deployed and will discuss the pros and cons of each
	    deployment scenario. There are two basic deployment tradeoffs
            to consider: centralized versus distributed caches and flat, 
	    recursive, or re-encapsulating tunneling.
</p>
<p>When deciding on centralized versus distributed caching,
	    the following issues should be considered:
</p>
<p></p>
<ul class="text">
<li>Are the tunnel routers spread out so that the caches are
		spread across all the memories of each router?
</li>
<li>Should management "touch points" be minimized by choosing
		few tunnel routers, just enough for redundancy?
</li>
<li>In general, using more ITRs doesn't
		increase management load, since caches are built and stored 
		dynamically. On the other hand, more ETRs
		does require more management since EID-prefix-to-RLOC
		mappings need to be explicitly configured.
</li>
</ul>

<p>When deciding on flat, recursive, or re-encapsulation
	    tunneling, the following issues should be considered:
</p>
<p></p>
<ul class="text">
<li>Flat tunneling implements a single tunnel between 
		source site and	destination site. This generally offers
		better paths between sources and destinations with a 
		single tunnel path.
</li>
<li>Recursive tunneling is when tunneled traffic is again 
		further encapsulated in another tunnel, either to
		implement VPNs or to perform Traffic Engineering. When doing
                VPN-based tunneling, the site has some control since the site
		is prepending a new tunnel header. In the case of TE-based 
		tunneling, the site may have control if it is prepending a 
		new tunnel header, but if the site's ISP is doing the TE, 
		then the site has no control. Recursive tunneling generally 
		will result in suboptimal paths but at the benefit of steering
		traffic to resource available parts of the network.
</li>
<li>The technique of re-encapsulation ensures that packets 
		only require one tunnel header. So if a 
		packet needs to be rerouted, it is first decapsulated
		by the ETR and then re-encapsulated with a
		new tunnel header using a new RLOC.
</li>
</ul>

<p>The next sub-sections will describe where tunnel routers can
	    reside in the network.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
First-hop/Last-hop Tunnel Routers</h3>

<p>By locating tunnel routers close to hosts, the EID-prefix
		set is at the granularity of an IP subnet. So at the expense
                of more EID-prefix-to-RLOC sets for the site, the caches
		in each tunnel router can remain relatively small. But caches
		always depend on the number of non-aggregated EID destination 
                flows active through these tunnel routers.
</p>
<p>With more tunnel routers doing encapsulation, the increase
		in control traffic grows as well: since the EID-granularity
		is greater, more Map-Requests and replies are traveling between
		more routers.
</p>
<p>The advantage of placing the caches and databases at these
		stub routers is that the products deployed in this part of
		the network have better price-memory ratios then their core
		router counterparts. Memory is typically less expensive
		in these devices and fewer routes are stored (only IGP
		routes). These devices tend to have excess capacity, both
		for forwarding and routing state.
</p>
<p>LISP functionality can also be deployed in edge
		switches. These devices generally have layer-2 ports facing 
		hosts and layer-3 ports facing the Internet. Spare capacity is
		also often available in these devices as well.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Border/Edge Tunnel Routers</h3>

<p>Using customer-edge (CE) routers for tunnel endpoints
		allows the EID space associated with a site to be 
		reachable via a small set of RLOCs assigned to the CE
		routers for that site.
</p>
<p>This offers the opposite benefit of the first-hop/last-hop
		tunnel router scenario: the number of mapping entries 
		and network management touch points are reduced, allowing
		better scaling.
</p>
<p>One disadvantage is that less of the network's resources
		are used to reach host endpoints thereby centralizing the
		point-of-failure domain and creating network choke points
		at the CE router.
</p>
<p>Note that more than one CE router at a site can be 
		configured with the same IP address. In this case an RLOC is
		an anycast address. This allows resilency between the CE
		routers. That is, if a CE router fails, traffic is 
		automatically routed to the other routers using the same
		anycast address. However, this comes with the disadvantage 
		where the site cannot control the entrance point when the 
		anycast route is advertised out from all border routers.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
ISP Provider-Edge (PE) Tunnel Routers</h3>

<p>Use of ISP PE routers as tunnel endpoint routers gives
		an ISP control over the location of the egress tunnel
		endpoints. That is, the ISP can decide if the tunnel
		endpoints are in the destination site (in either
		CE routers or last-hop routers within a site) or at
		other PE edges. The advantage of this case is that two or
		more tunnel headers can be avoided. By having the PE be the
		first router on the path to encapsulate, it can choose a
		TE path first, and the ETR can 
		decapsulate and re-encapsulate for a tunnel to the destination
		end site.
</p>
<p>An obvious disadvantage is that the end site
		has no control over where its packets flow or the RLOCs
		used.
</p>
<p>As mentioned in earlier sections a combination of these
		scenarios is possible at the expense of extra packet header
		overhead, if both site and provider want control, then
		recursive or re-encapsulating tunnels are used.
		
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Multicast Considerations</h3>

<p>A multicast group address, as defined in the original Internet
            architecture is an identifier of a grouping of topologically 
            independent receiver host locations. The address encoding itself
            does not determine the location of the receiver(s). The multicast
            routing protocol, and the network-based state the protocol creates,
	    determines where the receivers are located.
</p>
<p>In the context of LISP, a multicast group address is both an EID
            and a Routing Locator. Therefore, no specific semantic or action 
	    needs to
            be taken for a destination address, as it would appear in an IP
            header. Therefore, a group address that appears in an inner IP
            header built by a source host will be used 
            as the destination EID. And the outer IP header (the destination
            Routing Locator address), prepended by a LISP router, will use 
	    the same
            group address as the destination Routing Locator.
</p>
<p>Having said that, only the source EID and source Routing 
	    Locator needs to
            be dealt with. Therefore, an ITR merely needs
            to put its own IP address in the source Routing Locator field when
            prepending the outer IP header. This source Routing Locator 
	    address, like 
            any other Routing Locator address MUST be globally routable.
</p>
<p>Therefore, an EID-to-RLOC mapping does not need to be 
	    performed by an ITR when a received data packet is a multicast
	    data packet or when processing a source-specific Join (either by 
	    IGMPv3 or PIM). But the source Routing Locator is decided
	    by the multicast routing protocol in a receiver site. That is,
	    an EID to Routing Locator translation is done at control-time.
</p>
<p>Another approach is to have the ITR not encapsulate a multicast
	    packet and allow the the host built packet to flow into the core 
	    even if the source address is allocated out of the EID namespace.
	    If the RPF-Vector TLV <a class='info' href='#RPFV'>[RPFV]<span> (</span><span class='info'>Wijnands, IJ., Boers, A., and E. Rosen, &ldquo;The RPF Vector TLV,&rdquo; October&nbsp;2006.</span><span>)</span></a> is used by PIM in
	    the core, then core routers can RPF to the ITR (the Locator
	    address which is injected into core routing) rather than the host
	    source address (the EID address which is not injected into core 
	    routing).
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>We believe that most of the security mechanisms will be part
	    of the mapping database service when using control-plane
	    procedures for obtaining EID-to-RLOC mappings. For data-plane
	    triggered mappings, as described in this specification,
	    protection is provided against ETR spoofing by using Return-
	    Routeability mechanisms evidenced by the use of a 6-byte
	    Nonce field in the LISP encapsulation header. The nonce, coupled
	    with the ITR accepting only solicited Map-Replies goes a long
	    way towards providing decent authentication.
</p>
<p>LISP does not rely on a PKI infrastructure or a more heavy 
	    weight authentication system.  These systems challenge the 
	    scalability of LISP which was a primary design goal.
</p>
<p>DoS attack prevention will depend on implementations rate-
	    limiting of Map-Requests and Map-Replies to the control-plane 
	    as well as rate-limiting the number of data triggered 
	    Map-Replies.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Prototype Plans and Status</h3>

<p>The operator community has requested that the IETF take a 
	    practical approach to solving the scaling problems associated
	    with global routing state growth. This document offers a simple
	    solution which is intended for use in a pilot program to gain
	    experience in working on this problem.
</p>
<p>The authors hope that publishing this specification will allow
	    the rapid implementation of multiple vendor prototypes and
	    deployment on a small scale.  Doing this will help the 
	    community:
</p>
<p></p>
<ul class="text">
<li>Decide whether a new EID-to-RLOC mapping database
		infrastructure is needed or if a simple, UDP-based,
		data-triggered approach is flexible and robust enough.
</li>
<li>Experiment with provider-independent assignment of EIDs
		while at the same time decreasing the size of DFZ routing
		tables through the use of topologically-aligned,
		provider-based RLOCs.
</li>
<li>Determine whether multiple levels of tunneling can be used
		by ISPs to achieve their Traffic Engineering goals while
		simultaneously removing the more specific routes currently
		injected into the global routing system for this purpose.
</li>
<li>Experiment with mobility to determine if both acceptable
		convergence and session survivability properties can be
		scalably implemented to support both individual device
		roaming and site service provider changes. 
</li>
</ul>

<p>Here are a rough set of milestones:
</p>
<p></p>
<ol class="text">
<li>Stabilize this draft by Summer 2007 Chicago IETF.
</li>
<li>Start implementations to report on by Summer 2007 Chicago 
		IETF.
</li>
<li>Start pilot deployment between summer and fall IETFs. 
		Report on deployment at Fall 2007 Vancouver IETF.
</li>
<li> Achieve multi-vendor interoperability by Fall 2007 
		Vancouver IETF.
</li>
<li> Consider prototyping other database lookup schemes, be it 
		DNS, DHTs, CONS, NERD, or other mechanisms by Fall 2007 
		IETF.
</li>
</ol>

<p>As of this writing the following accomplishments have been 
	    achieved:
</p>
<p></p>
<ol class="text">
<li>A unit tested software switching implementation has been 
		completed for both IPv4 and IPv6 encapsulations for LISP 1
		and LISP 1.5 functionality.
</li>
<li>Dave Meyer, Vince Fuller, and Darrel Lewis are testing the 
		implementation this summer.
</li>
<li>An implementation of LISP-CONS is under way.
		
</li>
</ol>

<p>Please contact authors if interested in doing an implementation
	    and want to interoperability test with our implementation.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC0768">[RFC0768]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc768.txt">User Datagram Protocol</a>,&rdquo; STD&nbsp;6, RFC&nbsp;768, August&nbsp;1980.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1498">[RFC1498]</a></td>
<td class="author-text"><a href="mailto:Saltzer@MIT.EDU">Saltzer, J.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1498.txt">On the Naming and Binding of Network Destinations</a>,&rdquo; RFC&nbsp;1498, August&nbsp;1993.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1955">[RFC1955]</a></td>
<td class="author-text"><a href="mailto:hinden@ipsilon.com">Hinden, R.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc1955.txt">New Scheme for Internet Routing and Addressing (ENCAPS) for IPNG</a>,&rdquo; RFC&nbsp;1955, June&nbsp;1996.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2434">[RFC2434]</a></td>
<td class="author-text"><a href="mailto:narten@raleigh.ibm.com">Narten, T.</a> and <a href="mailto:Harald@Alvestrand.no">H. Alvestrand</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2434.txt">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;2434, October&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2434.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2434.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2434.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2784">[RFC2784]</a></td>
<td class="author-text"><a href="mailto:dino@procket.com">Farinacci, D.</a>, <a href="mailto:tony1@home.net">Li, T.</a>, <a href="mailto:stan_hanks@enron.net">Hanks, S.</a>, <a href="mailto:dmm@cisco.com">Meyer, D.</a>, and <a href="mailto:pst@juniper.net">P. Traina</a>, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc2784.txt">Generic Routing Encapsulation (GRE)</a>,&rdquo; RFC&nbsp;2784, March&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3056">[RFC3056]</a></td>
<td class="author-text">Carpenter, B. and K. Moore, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc3056.txt">Connection of IPv6 Domains via IPv4 Clouds</a>,&rdquo; RFC&nbsp;3056, February&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4423">[RFC4423]</a></td>
<td class="author-text">Moskowitz, R. and P. Nikander, &ldquo;<a href="ftp://ftp.isi.edu/in-notes/rfc4423.txt">Host Identity Protocol (HIP) Architecture</a>,&rdquo; RFC&nbsp;4423, May&nbsp;2006.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="APT">[APT]</a></td>
<td class="author-text">Jen, D., Meisel, M., Massey, D., Wang, L., Zhang, B., and L. Zhang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-jen-apt-00.txt.txt">APT: A Practical Transit Mapping Service</a>,&rdquo; draft-jen-apt-00.txt (work in progress), July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="CHIAPPA">[CHIAPPA]</a></td>
<td class="author-text">Chiappa, J., &ldquo;Endpoints and Endpoint names: A Proposed 
		    Enhancement to the Internet Architecture,&rdquo; Internet-Draft&nbsp;http://www.chiappa.net/~jnc/tech/endpoints.txt, 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="CONS">[CONS]</a></td>
<td class="author-text">Farinacci, D., Fuller, V., and D. Meyer, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-meyer-lisp-cons-00.txt.txt">LISP-CONS: A Content distribution Overlay Network 
		    Service for LISP</a>,&rdquo; draft-meyer-lisp-cons-00.txt (work in progress), June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="DHTs">[DHTs]</a></td>
<td class="author-text">Ratnasamy, S., Shenker, S., and I. Stoica, &ldquo;Routing Algorithms for DHTs: Some Open Questions,&rdquo; PDF file&nbsp;http://www.cs.rice.edu/Conferences/IPTPS02/174.pdf.</td></tr>
<tr><td class="author-text" valign="top"><a name="GSE">[GSE]</a></td>
<td class="author-text">&ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipngwg-gseaddr-00.txt.txt">GSE - An Alternate Addressing Architecture for 
		    IPv6</a>,&rdquo; draft-ietf-ipngwg-gseaddr-00.txt (work in progress), 1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="LISP1">[LISP1]</a></td>
<td class="author-text">Farinacci, D., Oran, D., Fuller, V., and J. Schiller, &ldquo;Locator/ID Separation Protocol (LISP1) [Routable 
		    ID Version],&rdquo; Slide-set&nbsp;http://www.dinof.net/~dino/ietf/lisp1.ppt, October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="LISP2">[LISP2]</a></td>
<td class="author-text">Farinacci, D., Oran, D., Fuller, V., and J. Schiller, &ldquo;Locator/ID Separation Protocol (LISP2) [DNS-based 
		    Version],&rdquo; Slide-set&nbsp;http://www.dinof.net/~dino/ietf/lisp2.ppt, November&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="NERD">[NERD]</a></td>
<td class="author-text">Lear, E., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-lear-lisp-nerd-01.txt.txt">NERD: A Not-so-novel EID to RLOC Database</a>,&rdquo; draft-lear-lisp-nerd-01.txt (work in progress), June&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RAWS">[RAWS]</a></td>
<td class="author-text">Meyer, D., Zhang, L., and K. Fall, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-iab-raws-report-02.txt.txt">Report from the IAB Workshop on Routing and 
		    Addressing</a>,&rdquo; draft-iab-raws-report-02.txt (work in progress), April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RPFV">[RPFV]</a></td>
<td class="author-text">Wijnands, IJ., Boers, A., and E. Rosen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pim-rpf-vector-03.txt.txt">The RPF Vector TLV</a>,&rdquo; draft-ietf-pim-rpf-vector-03.txt (work in progress), October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="SHIM6">[SHIM6]</a></td>
<td class="author-text">Nordmark, E. and M. Bagnulo, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-shim6-proto-06.txt.txt">Level 3 multihoming shim protocol</a>,&rdquo; draft-ietf-shim6-proto-06.txt (work in progress), October&nbsp;2006.</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgments</h3>

<p>The authors would like to gratefully acknowledge many people who
            have contributed discussion and ideas to the making of this
            proposal. They include Jason Schiller, Lixia Zhang, Dorian Kim, 
	    Peter Schoenmaker, Darrel Lewis, Vijay Gill, Geoff 
	    Huston, David Conrad, Ron Bonica, Ted Seely, Mark Townsley,
	    Chris Morrow, Brian Weis, Dave McGrew, Peter Lothberg, Dave 
            Thaler, Scott Brim, Eliot Lear, Shane Amante, Ved Kafle, and
	    Olivier Bonaventure.
</p>
<p>In particular, we would like to thank Dave Meyer for his 
            clever suggestion for the name "LISP". ;-)
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dino Farinacci</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dino@cisco.com">dino@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vince Fuller</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vaf@cisco.com">vaf@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dave Oran</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">7 Ladyslipper Lane</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Acton, MA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:oran@cisco.com">oran@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dave Meyer</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dmm@cisco.com">dmm@cisco.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
<h3>Acknowledgment</h3>
<p class='copyright'>
Funding for the RFC Editor function is provided by
the IETF Administrative Support Activity (IASA).</p>
</body></html>

--Apple-Mail-2-838033943
Content-Transfer-Encoding: 7bit
Content-Type: text/plain;
	charset=US-ASCII;
	format=flowed



--Apple-Mail-2-838033943--

