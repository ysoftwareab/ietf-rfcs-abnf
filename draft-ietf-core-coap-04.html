<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Constrained Application Protocol (CoAP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Constrained Application Protocol (CoAP)">
<meta name="keywords" content="CoAP, Constrained Application Protocol, REST">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">CoRE Working Group</td><td class="header">Z. Shelby</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Sensinode</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">K. Hartke</td></tr>
<tr><td class="header">Expires: July 28, 2011</td><td class="header">C. Bormann</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Universitaet Bremen TZI</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">B. Frank</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">SkyFoundry</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 24, 2011</td></tr>
</table></td></tr></table>
<h1><br />Constrained Application Protocol (CoAP)<br />draft-ietf-core-coap-04</h1>

<h3>Abstract</h3>

<p>This document specifies the Constrained Application Protocol (CoAP),
      a specialized web transfer protocol for use with constrained networks
      and nodes for machine-to-machine applications such as smart energy and
      building automation. These constrained nodes often have 8-bit
      microcontrollers with small amounts of ROM and RAM, while networks such
      as 6LoWPAN often have high packet error rates and a typical throughput
      of 10s of kbit/s. CoAP provides a method/response interaction model
      between application end-points, supports built-in resource discovery,
      and includes key web concepts such as URIs and content-types. CoAP
      easily translates to HTTP for integration with the web while meeting
      specialized requirements such as multicast support, very low overhead
      and simplicity for constrained environments.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 28, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#features">1.1.</a>&nbsp;
Features<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#terminology">1.2.</a>&nbsp;
Terminology<br />
<a href="#protocol">2.</a>&nbsp;
Constrained Application Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">2.1.</a>&nbsp;
Messaging Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">2.2.</a>&nbsp;
Request/Response Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.3.</a>&nbsp;
Intermediaries and Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.4.</a>&nbsp;
Resource Discovery<br />
<a href="#syntax">3.</a>&nbsp;
Message Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-format">3.1.</a>&nbsp;
Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-format">3.2.</a>&nbsp;
Option Format<br />
<a href="#messages">4.</a>&nbsp;
Message Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reliable">4.1.</a>&nbsp;
Reliable Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#unreliable">4.2.</a>&nbsp;
Unreliable Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#message-types">4.3.</a>&nbsp;
Message Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#confirmable">4.3.1.</a>&nbsp;
Confirmable (CON)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#non-confirmable">4.3.2.</a>&nbsp;
Non-Confirmable (NON)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#acknowledgement">4.3.3.</a>&nbsp;
Acknowledgement (ACK)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reset">4.3.4.</a>&nbsp;
Reset (RST)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#multicast">4.4.</a>&nbsp;
Multicast<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#congestion">4.5.</a>&nbsp;
Congestion Control<br />
<a href="#requests-responses">5.</a>&nbsp;
Request/Response Semantics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#request-semantics">5.1.</a>&nbsp;
Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#response-semantics">5.2.</a>&nbsp;
Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#immediate">5.2.1.</a>&nbsp;
Immediate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#deferred">5.2.2.</a>&nbsp;
Deferred<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#non-confirmable-responses">5.2.3.</a>&nbsp;
Non-Confirmable<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#response-matching">5.3.</a>&nbsp;
Request/Response Matching<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-semantics">5.4.</a>&nbsp;
Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#critical-elective">5.4.1.</a>&nbsp;
Critical/Elective<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-length">5.4.2.</a>&nbsp;
Length<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-defaults">5.4.3.</a>&nbsp;
Default Values<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#repeated-options">5.4.4.</a>&nbsp;
Repeating Options<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-numbers">5.4.5.</a>&nbsp;
Option Numbers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#payload-semantics">5.5.</a>&nbsp;
Payload<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#caching">5.6.</a>&nbsp;
Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#freshness-model">5.6.1.</a>&nbsp;
Freshness Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#validation-model">5.6.2.</a>&nbsp;
Validation Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxying">5.7.</a>&nbsp;
Proxying<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#methods">5.8.</a>&nbsp;
Method Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#get">5.8.1.</a>&nbsp;
GET<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#post">5.8.2.</a>&nbsp;
POST<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#put">5.8.3.</a>&nbsp;
PUT<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#delete">5.8.4.</a>&nbsp;
DELETE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#response-codes">5.9.</a>&nbsp;
Response Code Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#success">5.9.1.</a>&nbsp;
Success 2.xx<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#client-error">5.9.2.</a>&nbsp;
Client Error 4.xx<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#server-error">5.9.3.</a>&nbsp;
Server Error 5.xx<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#options">5.10.</a>&nbsp;
Option Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#token">5.10.1.</a>&nbsp;
Token<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-options">5.10.2.</a>&nbsp;
Uri-Host, Uri-Port, Uri-Path and Uri-Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy-uri">5.10.3.</a>&nbsp;
Proxy-Uri<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#content-type">5.10.4.</a>&nbsp;
Content-Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#max-age">5.10.5.</a>&nbsp;
Max-Age<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#etag">5.10.6.</a>&nbsp;
Etag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#location-path">5.10.7.</a>&nbsp;
Location-Path<br />
<a href="#uri">6.</a>&nbsp;
CoAP URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-syntax">6.1.</a>&nbsp;
URI Scheme Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-normalization">6.2.</a>&nbsp;
Normalization and Comparison Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-parsing">6.3.</a>&nbsp;
Parsing URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-constructing">6.4.</a>&nbsp;
Constructing URIs<br />
<a href="#addressing">7.</a>&nbsp;
Finding and Addressing CoAP End-Points<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#discovery">7.1.</a>&nbsp;
Resource Discovery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#default-port">7.2.</a>&nbsp;
Default Port<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#multiplexing">7.3.</a>&nbsp;
Multiplexing DTLS and CoAP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#multiplexing-future">7.3.1.</a>&nbsp;
Future-Proofing the Multiplexing<br />
<a href="#http">8.</a>&nbsp;
HTTP Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#coap-http">8.1.</a>&nbsp;
CoAP-HTTP Mapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#http-coap">8.2.</a>&nbsp;
HTTP-CoAP Mapping<br />
<a href="#constants">9.</a>&nbsp;
Protocol Constants<br />
<a href="#security">10.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ipsec">10.1.</a>&nbsp;
Securing CoAP with IPsec<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dtls">10.2.</a>&nbsp;
Securing CoAP with DTLS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">10.2.1.</a>&nbsp;
SharedKey &amp; MultiKey Modes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">10.2.2.</a>&nbsp;
Certificate Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">10.3.</a>&nbsp;
Threat analysis and protocol limitations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">10.3.1.</a>&nbsp;
Protocol Parsing, Processing URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">10.3.2.</a>&nbsp;
Proxying and Caching<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#amplification">10.3.3.</a>&nbsp;
Risk of amplification<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cross-protocol-attacks">10.3.4.</a>&nbsp;
Cross-Protocol Attacks<br />
<a href="#iana-considerations">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#coap-code-registry">11.1.</a>&nbsp;
CoAP Code Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#coap-code-registry-methods">11.1.1.</a>&nbsp;
Method Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#coap-code-registry-responses">11.1.2.</a>&nbsp;
Response Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#option-number-registry">11.2.</a>&nbsp;
Option Number Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#media-type-registry">11.3.</a>&nbsp;
Media Type Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#uri-scheme-registration">11.4.</a>&nbsp;
URI Scheme Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#port-registration">11.5.</a>&nbsp;
Service Name and Port Number Registration<br />
<a href="#anchor10">12.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#integer">Appendix&nbsp;A.</a>&nbsp;
Integer Option Value Format<br />
<a href="#examples">Appendix&nbsp;B.</a>&nbsp;
Examples<br />
<a href="#uri-examples">Appendix&nbsp;C.</a>&nbsp;
URI Examples<br />
<a href="#anchor13">Appendix&nbsp;D.</a>&nbsp;
Changelog<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The use of web services on the Internet has become ubiquitous in most
      applications, and depends on the fundamental Representational State
      Transfer (REST) architecture of the web.
</p>
<p>The Constrained RESTful Environments (CoRE) working group aims at
      realizing the REST architecture in a suitable form for the most
      constrained nodes (e.g. 8-bit microcontrollers with limited RAM and ROM)
      and networks (e.g. 6LoWPAN). Constrained networks like 6LoWPAN support
      the expensive fragmentation of IPv6 packets into small link-layer
      frames. One design goal of CoRE has been to keep message overhead small,
      thus limiting the use of fragmentation.
</p>
<p>One of the main goals of CoRE is to design a generic web protocol for
      the special requirements of this constrained environment, especially
      considering energy, building automation and other M2M applications. The
      goal of CoAP is not to blindly compress HTTP <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>,
      but rather to realize a
      subset of REST common with HTTP but optimized for M2M applications.
      Although CoRE could be used for compressing simple HTTP interfaces, it
      more importantly also offers features for M2M such as built-in
      discovery, multicast support and asynchronous message exchanges.
</p>
<p>This document specifies the Constrained Application Protocol (CoAP),
      which easily translates to HTTP for integration with the existing web
      while meeting specialized requirements such as multicast support, very
      low overhead and simplicity for constrained environments and M2M
      applications.
</p>
<a name="features"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Features</h3>

<p>CoAP has the following main features:
       </p>
<ul class="text">
<li>Constrained web protocol fulfilling M2M requirements.
</li>
<li>A stateless HTTP mapping, allowing proxies to be built providing
          access to CoAP resources via HTTP in a uniform way or for HTTP
          simple interfaces to be realized alternatively over CoAP.
</li>
<li>UDP binding with reliable unicast and best-effort multicast
          support.
</li>
<li>Asynchronous message exchanges.
</li>
<li>Low header overhead and parsing complexity.
</li>
<li>URI and Content-type support.
</li>
<li>Simple proxy and caching capabilities.
</li>
<li>Optional resource discovery.
</li>
</ul>

<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>This specification requires readers to be familiar with all the terms
        and concepts that are discussed in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>. In addition,
        this specification defines the following terminology:
        </p>
<blockquote class="text"><dl>
<dt>Immediate Response</dt>
<dd>
          An Immediate Response is included right in a CoAP
          Acknowledgement (ACK) message that is sent to acknowledge receipt of
          the Request for this Response (<a class='info' href='#immediate'>Section&nbsp;5.2.1<span> (</span><span class='info'>Immediate</span><span>)</span></a>).
</dd>
<dt>Deferred Response</dt>
<dd>
          When a Confirmable message carrying a Request is
          acknowledged with an empty message (e.g., because the server doesn't
          have the answer right away), a Deferred Response is sent later in a
          separate message exchange (<a class='info' href='#deferred'>Section&nbsp;5.2.2<span> (</span><span class='info'>Deferred</span><span>)</span></a>). 
</dd>
<dt>Critical</dt>
<dd>
          An option that would need to be understood by the end-point
          receiving the message in order to properly process the message (<a class='info' href='#critical-elective'>Section&nbsp;5.4.1<span> (</span><span class='info'>Critical/Elective</span><span>)</span></a>).  Note that the implementation
          of critical options is, as the name "Option" implies,
          generally optional: unsupported critical options lead to
          rejection of the message.
          
</dd>
<dt>Elective</dt>
<dd>
          An option that is intended be ignored by an end-point that
          does not understand it, which nonetheless still can correctly process
          the message (<a class='info' href='#critical-elective'>Section&nbsp;5.4.1<span> (</span><span class='info'>Critical/Elective</span><span>)</span></a>).
          
</dd>
<dt>Resource Discovery</dt>
<dd>
          The process where a CoAP client queries a server for its list
          of hosted resources (i.e., links, <a class='info' href='#discovery'>Section&nbsp;7.1<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a>).
          
</dd>
<dt>Intermediary</dt>
<dd>There are two common forms of
          intermediary: proxy and reverse proxy. In some cases, a single
          intermediary might act as an origin server, proxy, or reverse proxy,
          switching behavior based on the nature of each request.
</dd>
<dt>Proxy</dt>
<dd>A "proxy" is an end-point
          selected by a client,
          usually via local configuration rules, to perform requests on behalf
          of the client, doing any necessary translations. Some translations
          are minimal, such as for proxy requests for "coap" URIs, whereas
          other requests might require translation to and from entirely
          different application-layer protocols.
</dd>
<dt>Reverse Proxy</dt>
<dd>A "reverse proxy" is
          an end-point that
          acts as a layer above some other server(s) and satisfies requests
          on behalf of these, doing any necessary translations. Unlike a
          proxy, a reverse proxy receives requests as if it was the origin
          server for the target resource; the requesting client will
          not be aware that it is communicating with a reverse proxy.
</dd>
</dl></blockquote><p>
        
</p>
<p>In this specification, the term "byte" is used in its now customary
        sense as a synonym for "octet".
</p>
<p>In this specification, the operator "^"
        stands for exponentiation.
</p>
<a name="protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Constrained Application Protocol</h3>

<p>The interaction model of CoAP is similar to the client/server model
        of HTTP. However, machine-to-machine interactions typically result in
        a CoAP implementation acting in both client and server roles (called
        an end-point). A CoAP request is equivalent to that of HTTP, and is
        sent by a client to request an action (using a method code) on a
        resource (identified by a URI) on a server. The server then
        sends a response
        with a response code; this response may include a resource
        representation.
</p>
<p>Unlike HTTP, CoAP deals with these interchanges asynchronously over
        a datagram-oriented transport such as UDP. This is done using a layer of messages
        that supports optional reliability (with exponential back-off). CoAP defines
        four types of messages: Confirmable, Non-Confirmable,
        Acknowledgement, Reset; method codes and response codes included in
        some of these messages make them carry requests or responses.
        The basic exchanges of the four types of messages
        are transparent to the request/response interactions.
</p>
<p>One could think of CoAP as using a two-layer approach, a
        CoAP messaging layer used to deal with UDP and the asynchronous nature
        of the interactions, and the request/response interactions using
        Method and Response codes (see <a class='info' href='#fig-layers'>Figure&nbsp;1<span> (</span><span class='info'>Abstract layering of CoAP</span><span>)</span></a>).
</p><br /><hr class="insert" />
<a name="fig-layers"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +----------------------+
                         |      Application     |
                         +----------------------+
                         +----------------------+
                         |  Requests/Responses  |
                         |----------------------|  CoAP
                         |       Messages       |
                         +----------------------+
                         +----------------------+
                         |          UDP         |
                         +----------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Abstract layering of CoAP&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Messaging Model</h3>

<p>The CoAP messaging model is based on the exchange of messages over UDP between
        end-points.
</p>
<p>CoAP uses a short fixed-length binary header
        (4 bytes) that may be followed by compact binary options and a payload. This message
        format is shared by requests and responses.
        The CoAP message format is specified in <a class='info' href='#syntax'>Section&nbsp;3<span> (</span><span class='info'>Message Syntax</span><span>)</span></a>.
        Each message contains a Message ID used to detect duplicates and for optional reliability.
</p>
<p>Reliability is provided by marking a message as Confirmable (CON). A Confirmable message is
        retransmitted using a default timeout and
        exponential back-off between retransmissions, until the
        recipient sends an Acknowledgement message (ACK)
        with the same Message ID (for example, 0x7d34); see <a class='info' href='#fig-reliable'>Figure&nbsp;2<span> (</span><span class='info'>Reliable message delivery</span><span>)</span></a>.
        When a recipient is not able to process a Confirmable
        message, it replies with a Reset message (RST) instead
        of an Acknowledgement (ACK). 
</p><br /><hr class="insert" />
<a name="fig-reliable"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client              Server
   |                  |
   |   CON [0x7d34]   |
   +-----------------&gt;|
   |                  |
   |   ACK [0x7d34]   |
   |&lt;-----------------+
   |                  |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Reliable message delivery&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>A message that does not require reliable delivery, for
          example each single measurement out of a stream of sensor
          data, can be sent as a Non-confirmable message (NON).
          These are not acknowledged, but still have a Message ID for
          duplicate detection (<a class='info' href='#fig-unreliable'>Figure&nbsp;3<span> (</span><span class='info'>Unreliable message delivery</span><span>)</span></a>).
</p><br /><hr class="insert" />
<a name="fig-unreliable"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client              Server
   |                  |
   |   NON [0x01a0]   |
   +-----------------&gt;|
   |                  |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Unreliable message delivery&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>See <a class='info' href='#messages'>Section&nbsp;4<span> (</span><span class='info'>Message Semantics</span><span>)</span></a> for details of CoAP messages.
</p>
<p>
        As CoAP is based on UDP, it also supports the use of multicast IP destination addresses,
        enabling multicast CoAP requests. <a class='info' href='#multicast'>Section&nbsp;4.4<span> (</span><span class='info'>Multicast</span><span>)</span></a> discusses the proper use
        of CoAP messages with multicast addresses and precautions for avoiding response congestion.
</p>
<p>Several security modes are defined for CoAP in <a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> ranging
        from no security to certificate based security. The use of IPsec along with a binding
        to DTLS are specified for securing the protocol.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Request/Response Model</h3>

<p>CoAP request and response semantics are carried in CoAP messages, which include
        either a method or response code, respectively. Optional (or default) request and response information,
        such as the URI and payload content-type are carried as CoAP options. A Token Option
        is used to match responses to requests independently from the
        underlying messages (<a class='info' href='#response-matching'>Section&nbsp;5.3<span> (</span><span class='info'>Request/Response Matching</span><span>)</span></a>).
</p>
<p>A request is carried in a Confirmable (CON) or
        Non-confirmable (NON)
        message, and if immediately available, the response to a
        request carried in a Confirmable message is carried in the resulting
        Acknowledgement (ACK) message. This is called an immediate CoAP response, detailed in
        <a class='info' href='#immediate'>Section&nbsp;5.2.1<span> (</span><span class='info'>Immediate</span><span>)</span></a>. Two examples for a basic GET request with immediate response are shown
          in <a class='info' href='#example-immediate'>Figure&nbsp;4<span> (</span><span class='info'>Two GET requests with immediate responses, one successful, one not found</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="example-immediate"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client              Server       Client              Server
   |                  |             |                  |
   |   CON [0xbc90]   |             |   CON [0xbc91]   |
   | GET /temperature |             | GET /temperature |
   |   (Token 0x71)   |             |   (Token 0x72)   |
   +-----------------&gt;|             +-----------------&gt;|
   |                  |             |                  |
   |   ACK [0xbc90]   |             |   ACK [0xbc91]   |
   |     2.00 OK      |             |  4.04 Not Found  |
   |   (Token 0x71)   |             |   (Token 0x72)   |
   |     "22.5 C"     |             |   "Not found"    |
   |&lt;-----------------+             |&lt;-----------------+
   |                  |             |                  |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Two GET requests with immediate responses, one successful, one not found&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>If the server is not able to respond immediately to a
        request carried in a Confirmable message, it simply responds with an empty Acknowledgement
        message so that the client can stop retransmitting the request.  When the
        response is ready, the server sends it in a new Confirmable
        message (which then in turn needs to be
        acknowledged by the client).  This is called a deferred
        response, as illustrated in <a class='info' href='#example-deferred'>Figure&nbsp;5<span> (</span><span class='info'>A GET request with a deferred response</span><span>)</span></a> and
        described in more detail in <a class='info' href='#deferred'>Section&nbsp;5.2.2<span> (</span><span class='info'>Deferred</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="example-deferred"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client              Server
   |                  |
   |   CON [0x7a10]   |
   | GET /temperature |
   |   (Token 0x73)   |
   +-----------------&gt;|
   |                  |
   |   ACK [0x7a10]   |
   |&lt;-----------------+
   |                  |
   ... Time Passes  ...
   |                  |
   |   CON [0x23bb]   |
   |     2.00 OK      |
   |   (Token 0x73)   |
   |     "22.5 C"     |
   |&lt;-----------------+
   |                  |
   |   ACK [0x23bb]   |
   +-----------------&gt;|
   |                  |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: A GET request with a deferred response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>CoAP makes use of HTTP GET, PUT, POST and DELETE methods, with the semantics specified
        in <a class='info' href='#methods'>Section&nbsp;5.8<span> (</span><span class='info'>Method Definitions</span><span>)</span></a>. URI support in a server is
        simplified as the client already parses the URI and splits it into
        host, port, path and query components, making use of default values for efficiency. Response
        codes correspond to a small subset of HTTP response codes with
        a few CoAP specific
        codes added, as defined in <a class='info' href='#response-codes'>Section&nbsp;5.9<span> (</span><span class='info'>Response Code Definitions</span><span>)</span></a>.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Intermediaries and Caching</h3>

<p>The protocol supports the caching of responses in order to efficiently fulfill
        requests. Simple caching is enabled using freshness and validity information carried with
        CoAP responses. A cache could be located in an end-point or an intermediary. Caching
        functionality is specified in <a class='info' href='#caching'>Section&nbsp;5.6<span> (</span><span class='info'>Caching</span><span>)</span></a>.
</p>
<p>Proxying is useful in constrained networks for several reasons, including network
        traffic limiting, to improve performance, to access resource of sleeping devices or
        for security reasons. The proxying of requests on behalf of another CoAP end-point is supported in
        the protocol. The URI of the resource to request is included in the request, while
        the destination IP address is set to the proxy. See <a class='info' href='#proxying'>Section&nbsp;5.7<span> (</span><span class='info'>Proxying</span><span>)</span></a> for more
        information on proxy functionality. 
</p>
<p>As CoAP was designed according to the REST architecture and thus
        exhibits functionality similar to that of the HTTP protocol,
        it is quite
        straightforward to map between HTTP-CoAP or CoAP-HTTP. Such a mapping may be used to
        realize an HTTP REST interface using CoAP, or for converting between HTTP and CoAP. This
        conversion can be
        carried out by a proxy, which converts the method or response code, content-type
        and options to the corresponding HTTP feature. <a class='info' href='#http'>Section&nbsp;8<span> (</span><span class='info'>HTTP Mapping</span><span>)</span></a> provides more detail about HTTP
        mapping. 
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Resource Discovery</h3>

<p>Resource discovery is important for machine-to-machine interactions, and is supported
        using the CoRE Link Format <a class='info' href='#I-D.ietf-core-link-format'>[I&#8209;D.ietf&#8209;core&#8209;link&#8209;format]<span> (</span><span class='info'>Shelby, Z., &ldquo;CoRE Link Format,&rdquo; December&nbsp;2010.</span><span>)</span></a> as discussed in
        <a class='info' href='#discovery'>Section&nbsp;7.1<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a>.
</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Message Syntax</h3>

<p>CoAP is based on the exchange of short messages which, by default,
      are transported over UDP (i.e. each CoAP message occupies the data
      section of one UDP datagram). CoAP may be used with Datagram
      Transport Layer Security (DTLS) (see <a class='info' href='#dtls'>Section&nbsp;10.2<span> (</span><span class='info'>Securing CoAP with DTLS</span><span>)</span></a>). It could
      also be used over other transports such as TCP or SCTP, the specification
      of which is out of this document's scope.
</p>
<a name="message-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Message Format</h3>

<p>CoAP messages are encoded in a simple binary format. A message
        consists of a fixed-sized CoAP Header followed by options in
        Type-Length-Value (TLV) format and a payload. The number of options
        is determined by the header. The payload is made up of the bytes
        after the options, if any; its length is calculated from the datagram
        length.
</p><br /><hr class="insert" />
<a name="fig-message-format"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Ver| T |  OC   |      Code     |          Message ID           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Options (if any) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Payload (if any) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Message Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
        The fields in the header are defined as follows:
        </p>
<blockquote class="text"><dl>
<dt>Version (Ver):</dt>
<dd>2-bit unsigned integer. Indicates the
          CoAP version number. Implementations of this specification MUST set
          this field to 1. Other values are reserved for future versions.
</dd>
<dt>Type (T):</dt>
<dd>2-bit unsigned integer. Indicates
          if this message is of type Confirmable (0), Non-Confirmable (1),
          Acknowledgement (2) or Reset (3). See <a class='info' href='#messages'>Section&nbsp;4<span> (</span><span class='info'>Message Semantics</span><span>)</span></a> for
          the semantics of these message types.
</dd>
<dt>Option Count (OC):</dt>
<dd>4-bit unsigned integer. Indicates
          the number of options after the header. If set to 0, there are no
          options and the payload (if any) immediately follows the header.
          The format of options is defined below.
</dd>
<dt>Code:</dt>
<dd>8-bit unsigned integer. Indicates if the message
          carries a request (1-31) or a response (64-191), or is empty (0).
          (All other code values are reserved.)
          In case of a request, the Code field indicates the Request Method;
          in case of a response a Response Code. Possible values are maintained
          in the <a class='info' href='#coap-code-registry'>CoAP Code Registry<span> (</span><span class='info'>CoAP Code Registry</span><span>)</span></a>.
          See <a class='info' href='#requests-responses'>Section&nbsp;5<span> (</span><span class='info'>Request/Response Semantics</span><span>)</span></a> for the semantics of requests
          and responses.
</dd>
<dt>Message ID:</dt>
<dd>16-bit unsigned integer. Used for the
          detection of message duplication, and to match messages of type
          Acknowledgement/Reset and messages of type Confirmable. See <a class='info' href='#messages'>Section&nbsp;4<span> (</span><span class='info'>Message Semantics</span><span>)</span></a> for Message ID generation rules and how
          messages are matched.
</dd>
</dl></blockquote><p>
        
</p>
<p>While specific link layers make it beneficial to keep CoAP messages
        small enough to fit into their link layer packets (see
        <a class='info' href='#introduction'>Section&nbsp;1<span> (</span><span class='info'>Introduction</span><span>)</span></a>), this is a matter of implementation
        quality. The CoAP specification itself provides only an upper bound to
        the message size. A CoAP message, appropriately encapsulated, SHOULD
        fit within a single IP packet (i.e., avoid IP fragmentation)
        and MUST fit within a single IP datagram. If the Path MTU is not known
        for a destination, an MTU of 1280 bytes SHOULD be assumed; if
        nothing is known about the size of the headers, good upper
        bounds are 1152 bytes for the message size and 1024 bytes for
        the payload size.
</p>
<a name="option-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Option Format</h3>

<p>Options MUST appear in order of their Option Number (see <a class='info' href='#option-numbers'>Section&nbsp;5.4.5<span> (</span><span class='info'>Option Numbers</span><span>)</span></a>). A delta encoding is used between
        options, with the Option Number for each Option calculated as
        the sum of its Option Delta field and the Option Number of the
        preceding Option in the message, if any, or zero otherwise.
        Multiple options with the same Option Number can be included
        by using an Option Delta of zero.
        Following the Option Delta, each option has a Length field which
        specifies the length of the Option Value. The Length field can be
        extended by one byte for options with values longer than 14 bytes.
        The Option Value immediately follows the Length field.
</p><br /><hr class="insert" />
<a name="fig-option-format"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  0   1   2   3   4   5   6   7
+---+---+---+---+---+---+---+---+
| Option Delta  |    Length     | for 0..14
+---+---+---+---+---+---+---+---+
|   Option Value ...
+---+---+---+---+---+---+---+---+
                                            for 15..270:
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
| Option Delta  | 1   1   1   1 |          Length - 15          |
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
|   Option Value ...
+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Option Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The fields in an option are defined as follows:
        </p>
<blockquote class="text"><dl>
<dt>Option Delta:</dt>
<dd>4-bit unsigned integer.
          Indicates the difference between the Option Number of this option
          and the previous option (or zero for the first option). In other
          words, the Option Number is calculated by simply summing the
          Option Delta fields of this and previous options before it. The
          Option Numbers 14, 28, 42, ... are reserved for no-op options
          when they are sent with an empty value (they are ignored)
          and can be used as "fenceposts" if
          deltas larger than 15 would otherwise be required.
</dd>
<dt>Length:</dt>
<dd>Indicates the length of the Option Value.
          Normally Length is a 4-bit unsigned integer allowing value lengths
          of 0-14 bytes. When the Length field is set to 15, another byte is
          added as an 8-bit unsigned integer whose value is added to
          the 15, allowing option value lengths of 15-270 bytes.
</dd>
</dl></blockquote><p>
        
</p>
<p>The length and format of the Option Value depends on the respective
        option, which MAY define variable length values. Options defined in
        this document make use of the following formats for option values:
        </p>
<blockquote class="text"><dl>
<dt>uint:</dt>
<dd>A non-negative integer which is represented in
          network byte order using a variable number of bytes (see <a class='info' href='#integer'>Appendix&nbsp;A<span> (</span><span class='info'>Integer Option Value Format</span><span>)</span></a>).
</dd>
<dt>string:</dt>
<dd>A Unicode string which is encoded using
          <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629] in
          <a class='info' href='#RFC5198'>Net-Unicode form<span> (</span><span class='info'>Klensin, J. and M. Padlipsky, &ldquo;Unicode Format for Network Interchange,&rdquo; March&nbsp;2008.</span><span>)</span></a> [RFC5198].
</dd>
<dt>opaque:</dt>
<dd>An opaque sequence of bytes.
</dd>
</dl></blockquote><p>
        
</p>
<p>Option Numbers are maintained in the <a class='info' href='#option-number-registry'>CoAP Option Number Registry<span> (</span><span class='info'>Option Number Registry</span><span>)</span></a>.
        See <a class='info' href='#options'>Section&nbsp;5.10<span> (</span><span class='info'>Option Definitions</span><span>)</span></a> for the semantics of the options defined
        in this document.
</p>
<a name="messages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Message Semantics</h3>

<p>CoAP messages are exchanged asynchronously between CoAP end-points.
      They are used to transport CoAP requests and responses, the semantics
      of which are defined in <a class='info' href='#requests-responses'>Section&nbsp;5<span> (</span><span class='info'>Request/Response Semantics</span><span>)</span></a>.
</p>
<p>As CoAP is bound to non-reliable transports
      such as UDP, CoAP messages may arrive out of
      order, appear duplicated, or go missing without notice. For this
      reason, CoAP implements a lightweight reliability mechanism, without
      trying to re-create the full feature set of a transport like TCP.
      It has the following features:
      </p>
<ul class="text">
<li>Simple stop-and-wait retransmission reliability with exponential
        back-off for "confirmable" messages.
</li>
<li>Duplicate detection for both "confirmable" and "non-confirmable"
        messages.
</li>
<li>Multicast support.
</li>
</ul><p>
      
</p>
<a name="reliable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Reliable Messages</h3>

<p>The reliable transmission of a message is initiated by marking
        the message as "confirmable" in the CoAP header. A recipient MUST
        acknowledge such a message with an acknowledgement message (or, if
        it lacks context to process the message properly, MUST reject it
        with a reset message). The sender retransmits the confirmable
        message at exponentially increasing intervals, until it receives
        an acknowledgement (or reset message), or runs out of attempts.
</p>
<p>Retransmission is controlled by two things that a CoAP end-point
        MUST keep track of for each confirmable message it sends while waiting
        for an acknowledgement (or reset): a timeout and a
        retransmission counter. For a new
        confirmable message, the initial timeout is set to RESPONSE_TIMEOUT
        and the retransmission counter is set to 0. When the timeout is triggered
        and the retransmission counter is less than MAX_RETRANSMIT, the message
        is retransmitted, the retransmission counter is incremented, and the
        timeout is doubled. If the retransmission counter reaches
        MAX_RETRANSMIT on a timeout, or if the end-point receives a reset
        message, then the attempt to transmit the message is cancelled and
        the application process informed of failure. On the other hand, if
        the end-point receives an acknowledgement message in time,
        transmission is considered successful.
</p>
<p>An acknowledgement or reset message is related to a confirmable
        message by means of a Message ID. The Message ID is a 16-bit
        unsigned integer that is generated by the sender of a confirmable
        message and included in the CoAP header. The Message ID MUST be
        echoed in the acknowledgement or reset message by the recipient.
        A CoAP end-point generates Message IDs by keeping a single Message
        ID variable, which is changed each time a new confirmable message
        is sent regardless of the destination address or port. The initial
        variable value SHOULD be randomized. The same Message ID MUST NOT
        be re-used within the potential retransmission window, calculated as
        RESPONSE_TIMEOUT * (2 ^ MAX_RETRANSMIT - 1) plus the expected
        maximum round trip time.
</p>
<p>A recipient MUST be prepared to receive the same confirmable message
        (as indicated by the Message ID) multiple times, for example, when
        its acknowledgement went missing or didn't reach the original sender
        before the first timeout. As a general rule that may be
        relaxed based on the specific semantics of a message, the
        recipient SHOULD acknowledge each
        duplicate copy of a confirmable message using the same
        acknowledgement or reset message, but SHOULD process any
        request or response in the message only once.
</p>
<a name="unreliable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Unreliable Messages</h3>

<p>As a more lightweight alternative, a message can be transmitted
        less reliably by marking the message as "non-confirmable". A
        non-confirmable message MUST NOT be acknowledged or be rejected by
        the recipient. If a recipient lacks context to process the message
        properly, the message MUST be silently ignored.
</p>
<p>There is no way to detect if a non-confirmable message was received
        or not at the CoAP-level. A sender MAY choose to transmit a
        non-confirmable message multiple times which, for this purpose,
        specifies a Message ID as well. The same rules for generating
        the Message ID apply.
</p>
<p>A recipient MUST be prepared to receive the same non-confirmable
        message (as indicated by the Message ID) multiple
        times. As a general rule that may be
        relaxed based on the specific semantics of a message, the
        recipient SHOULD silently ignore any duplicated non-confirmable
        message, and SHOULD process any request or response in the message
        only once.
</p>
<a name="message-types"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Message Types</h3>

<p>The different types of messages are summarized below. The type of
        a message is specified by the T field of the CoAP header.
</p>
<p>Separate from the message type, a message may carry a
        request, a response, or be empty. This is
        signalled by the Code field in the CoAP header and is relevant to
        the request/response model. 
        Possible values for the Code field are
        maintained by the <a class='info' href='#coap-code-registry'>CoAP Code
        Registry<span> (</span><span class='info'>CoAP Code Registry</span><span>)</span></a>.
</p>
<p>An empty message has the Code field set to 0. The OC field SHOULD
        be set to 0 and no bytes SHOULD be present after the Message ID
        field.  The OC field and any those
        bytes MUST be ignored by any
        recipient.
</p>
<a name="confirmable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Confirmable (CON)</h3>

<p>Some messages require an acknowledgement. These messages are
          called "Confirmable". When no packets are lost, each confirmable
          message elicits exactly one return message of type Acknowledgement
          or type Reset.
</p>
<p>A confirmable message always carries either a request or
          response and MUST NOT be empty.
</p>
<a name="non-confirmable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Non-Confirmable (NON)</h3>

<p>Some other messages do not require an acknowledgement. This is
          particularly true for messages that are repeated regularly for
          application requirements, such as repeated readings from a sensor
          where eventual arrival is sufficient.
</p>
<p>A non-confirmable message always carries either a request or
          response, as well, and MUST NOT be empty.
</p>
<a name="acknowledgement"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Acknowledgement (ACK)</h3>

<p>An Acknowledgement message acknowledges that a specific confirmable
          message (identified by its Message ID) arrived. It does not
          indicate success or failure of any encapsulated request.
</p>
<p>The acknowledgement message MUST echo the Message ID of the
          confirmable message, and MUST carry a response or be empty (see
          <a class='info' href='#immediate'>Section&nbsp;5.2.1<span> (</span><span class='info'>Immediate</span><span>)</span></a> and <a class='info' href='#deferred'>Section&nbsp;5.2.2<span> (</span><span class='info'>Deferred</span><span>)</span></a>).
</p>
<a name="reset"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
Reset (RST)</h3>

<p>A Reset message indicates that a specific confirmable message was
          received, but some context is missing to properly process it. This
          condition is usually caused when the receiving node has rebooted and
          has forgotten some state that would be required to interpret the
          message.
</p>
<p>A reset message MUST echo the Message ID of the confirmable
          message, and MUST be empty.
</p>
<a name="multicast"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Multicast</h3>

<p>CoAP supports sending messages to multicast destination addresses.
        Such multicast messages MUST be Non-Confirmable. Mechanisms for avoiding
        congestion from multicast requests are being considered in <a class='info' href='#I-D.eggert-core-congestion-control'>[I&#8209;D.eggert&#8209;core&#8209;congestion&#8209;control]<span> (</span><span class='info'>Eggert, L., &ldquo;Congestion Control for the Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="congestion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Congestion Control</h3>

<p>Basic congestion control for CoAP is provided by the
        exponential back-off mechanism in <a class='info' href='#reliable'>Section&nbsp;4.1<span> (</span><span class='info'>Reliable Messages</span><span>)</span></a>.
        Further congestion control optimizations are
        being considered and tested for CoAP <a class='info' href='#I-D.eggert-core-congestion-control'>[I&#8209;D.eggert&#8209;core&#8209;congestion&#8209;control]<span> (</span><span class='info'>Eggert, L., &ldquo;Congestion Control for the Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="requests-responses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Request/Response Semantics</h3>

<p>CoAP operates under a similar request/response model as HTTP: a CoAP
      end-point in the role of a "client" sends one or more CoAP requests to
      a "server", which services the requests by sending CoAP responses.
      Unlike HTTP, requests and responses are not sent over a previously
      established connection, but exchanged asynchronously over CoAP
      messages.
</p>
<a name="request-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Requests</h3>

<p>A CoAP request consists of the method to be applied to the resource,
        the identifier of the resource, a payload and Internet media type
        (if any), and optional meta-data about the request.
</p>
<p>CoAP supports the basic methods of GET, POST, PUT, DELETE, which
        are easily mapped to HTTP. They have the same properties of safe (only
        retrieval) and idempotent (you can invoke it multiple times with the
        same effects) as HTTP (see Section 9.1 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>).
        The GET method is safe, therefore it MUST NOT take any other action
        on a resource other than retrieval. The GET, PUT and DELETE methods
        MUST be performed in such a way that they are idempotent. POST is not
        idempotent, because its effect is determined by the origin server and
        dependent on the target resource; it usually results in a new resource
        being created or the target resource being updated.
</p>
<p>A request is initiated by setting the Code field in the CoAP header
        of a confirmable or a non-confirmable message to a Method Code and
        including request information.
</p>
<a name="response-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Responses</h3>

<p>After receiving and interpreting a request, a server responds
        with a CoAP response, which can be matched to the request by means
        of a client-generated token.
</p>
<p>A response is identified by the Code field in the CoAP
        header being set
        to a Response Code. Similar to the HTTP Status Code, the CoAP Response
        Code indicates the result of the attempt to understand and satisfy the
        request. These codes are fully defined in
        <a class='info' href='#response-codes'>Section&nbsp;5.9<span> (</span><span class='info'>Response Code Definitions</span><span>)</span></a>. The Response Code numbers to be set
        in the Code field of the CoAP header are maintained in the
        <a class='info' href='#coap-code-registry-responses'>CoAP Response Code
        Registry<span> (</span><span class='info'>Response Codes</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="response-code"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
       0
       0 1 2 3 4 5 6 7
      +-+-+-+-+-+-+-+-+
      |class|  detail |
      +-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Structure of a Response Code&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The upper three bits of the 8-bit Response Code number define the
        class of response. The lower five bits do not have any categorization
        role; they give additional detail to the overall class (<a class='info' href='#response-code'>Figure&nbsp;8<span> (</span><span class='info'>Structure of a Response Code</span><span>)</span></a>). There are 3 classes:
        </p>
<blockquote class="text"><dl>
<dt>2 - Success:</dt>
<dd>The request was successfully received,
          understood, and accepted.
</dd>
<dt>4 - Client Error:</dt>
<dd>The request contains bad syntax or
          cannot be fulfilled.
</dd>
<dt>5 - Server Error:</dt>
<dd>The server failed to fulfill an
          apparently valid request.
</dd>
</dl></blockquote><p>
        The response codes are designed to be extensible: Response Codes in
        the Client Error and Server Error class that are unrecognized by an
        end-point MUST be treated as being equivalent to the generic Response
        Code of that class. However, there is no generic Response Code
        indicating success, so a Response Code in the Success class that is
        unrecognized by an end-point can only be used to determine that the
        request was successful without any further details.
</p>
<p>As a human readable notation for specifications and
        protocol diagnostics, the numeric value of a response
        code is indicated
        by giving the upper three bits in decimal, followed by a
        dot and then the lower five bits in a two-digit decimal.  E.g., "Not
        Found" is written as 4.04 -- indicating a value of hexadecimal
        0x84 or decimal 132.  In other words, the dot "." functions as
        a short-cut for "*32+".
</p>
<p>Responses can be sent in multiple ways, which are defined below.
</p>
<a name="immediate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Immediate</h3>

<p>In the most basic case, the response is carried directly in the
          acknowledgement message that acknowledges the request (which
          requires that
          the request was carried in a confirmable message). This is called an
          "immediate" response.
</p>
<p>The response is returned in the acknowledgement message
          independent of whether the response indicates success or failure.
          In effect, the response is piggy-backed on the acknowledgement
          message, so no separate message is required to both acknowledge
          that the request was received and return the response.
</p>
<a name="deferred"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Deferred</h3>

<p>It may not be possible to return an immediate response in all
          cases. For example, a server might need longer to obtain the
          representation of the resource requested than it can wait sending
          back the acknowledgement message, without risking the client to
          repeatedly retransmit the request message.
</p>
<p>The server maybe initiates the attempt to obtain the resource representation
          and times out an acknowledgement timer, or it immediately sends an
          acknowledgement knowing in advance that there will be no immediate
          response. The acknowledgement effectively is a promise
          that the request will be acted upon.
</p>
<p>When the server finally has obtained the resource representation,
          it sends the response. To ensure that this message is not lost, it
          is again sent as a confirmable message and answered by the client
          with an acknowledgement, echoing the new Message ID chosen by
          the server.
</p>
<p>(Note that, as the underlying datagram transport may not be
          sequence-preserving, the confirmable message carrying the
          response may actually arrive before or after the
          acknowledgement message for the request.)
</p>
<p>For a deferred exchange, both the acknowledgement to the confirmable request and the
          acknowledgement to the confirmable response MUST be an empty message,
          i.e. one that carries neither a request nor a response.
</p>
<a name="non-confirmable-responses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Non-Confirmable</h3>

<p>If the request message is non-confirmable, then the response
          SHOULD be returned in a non-confirmable message as well. However,
          an end-point MUST be prepared to receive a non-confirmable response
          (preceded or followed an empty acknowledgement message) in reply to a confirmable
          request, or a confirmable response in reply to a non-confirmable
          request.
</p>
<a name="response-matching"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Request/Response Matching</h3>

<p>Regardless of how a response is sent, it is matched to the
        request by means of a token that is included by the client in the
        request. The token MUST be echoed by the server in any resulting
        response without modification.
</p>
<p>The exact rules for matching a response to a request are as
        follows:
        </p>
<ol class="text">
<li>For requests sent in a unicast message, the source of the
          response MUST match the destination of the
          original request. How this is determined depends on the security
          mode used (see <a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>): With NoSec, the IP
          address and port number of the request destination and response source must match.
          With other security modes, in addition 
          to the IP address and UDP
          port matching, the request and response MUST have the same
          security context.
</li>
<li>In an immediate response, both the Message ID of the
          confirmable request and the acknowledgement, and the token of the
          response and original request MUST match. In a deferred response,
          just the token of the response and original request MUST match.
</li>
</ol><p>
        
</p>
<p>The client SHOULD generate tokens in a way that tokens currently
        in use are unique. An end-point receiving a token MUST treat it as
        opaque and make no assumptions about its format.  (Note that
        there is a default value for the Token Option, so every
        message carries a token, even if it is not explicitly
        expressed in a CoAP option.)
</p>
<p>In case a confirmable message carrying a response is unexpected (i.e. the client is
        not waiting for a response with the specified address and/or token), the confirmable
        response SHOULD be rejected with a reset message and MUST NOT be
        acknowledged.
</p>
<a name="option-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Options</h3>

<p>Both requests and responses may include a list of one or more
        options. For example, the URI in a request is transported in several
        options, and meta-data that would be carried in an HTTP header in
        HTTP is supplied as options as well.
</p>
<p>CoAP defines a single set of options that are used in both requests
        and responses:
        </p>
<ul class="text">
<li>Content-Type
</li>
<li>Etag
</li>
<li>Location-Path
</li>
<li>Max-Age
</li>
<li>Token
</li>
<li>Uri-Host
</li>
<li>Uri-Path
</li>
<li>Uri-Port
</li>
<li>Proxy-Uri
</li>
<li>Uri-Query
</li>
</ul><p>
        The semantics of these options along with their properties are defined
        in <a class='info' href='#options'>Section&nbsp;5.10<span> (</span><span class='info'>Option Definitions</span><span>)</span></a>.
</p>
<p>Not all options have meaning with all methods and response codes.
        The possible options for methods and response codes are defined in
        <a class='info' href='#methods'>Section&nbsp;5.8<span> (</span><span class='info'>Method Definitions</span><span>)</span></a> and <a class='info' href='#response-codes'>Section&nbsp;5.9<span> (</span><span class='info'>Response Code Definitions</span><span>)</span></a>
        respectively. In case an option has no meaning, it SHOULD NOT be
        included by the sender and MUST be ignored by the recipient.
</p>
<a name="critical-elective"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4.1"></a><h3>5.4.1.&nbsp;
Critical/Elective</h3>

<p>Options fall into one of two classes: "critical" or "elective".
          The difference between these is how an option unrecognized by an
          end-point is handled:
          </p>
<ul class="text">
<li>Upon reception, unrecognized options of class "elective" MUST
            be silently ignored.
</li>
<li>Unrecognized options of class "critical" that occur in a
            confirmable request MUST cause the return of a 4.02 (Bad
            Option) response. This response SHOULD include a
            human-readable error message describing the unrecognized
            option(s) (see <a class='info' href='#payload-semantics'>Section&nbsp;5.5<span> (</span><span class='info'>Payload</span><span>)</span></a>).
</li>
<li>Unrecognized options of class "critical" that occur in a
            confirmable response SHOULD cause the response to be rejected
            with a reset message.
</li>
<li>Unrecognized options of class "critical" that occur in a
            non-confirmable message MUST cause the message be silently
            ignored.
</li>
</ul><p>
          
</p>
<p>Note that, whether critical or elective, an option is never
          "mandatory" (it is always optional): These rules are defined in
          order to enable implementations to reject options they do not
          understand or implement.
</p>
<a name="option-length"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4.2"></a><h3>5.4.2.&nbsp;
Length</h3>

<p>Option values are defined to have a specific length, often in the form
          of an upper and lower bound. If the length of an option value in a request
          is outside the defined range, that option MUST be treated like an
          unrecognized option (see <a class='info' href='#critical-elective'>Section&nbsp;5.4.1<span> (</span><span class='info'>Critical/Elective</span><span>)</span></a>).
</p>
<a name="option-defaults"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4.3"></a><h3>5.4.3.&nbsp;
Default Values</h3>

<p>Options may be defined to have a default value. If the
          value of option is intended to be this default value, the
          option SHOULD NOT be included in the message.
          If the option is not present, the default value MUST be assumed.
</p>
<a name="repeated-options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4.4"></a><h3>5.4.4.&nbsp;
Repeating Options</h3>

<p>Each definition of an option specifies whether it is
          defined to occur only at most once or whether it can occur
          multiple times.
          If a message includes an option with more instances than the
          option is defined for,
          the additional option instances MUST be treated like an unrecognized option
          (see <a class='info' href='#critical-elective'>Section&nbsp;5.4.1<span> (</span><span class='info'>Critical/Elective</span><span>)</span></a>).
</p>
<a name="option-numbers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4.5"></a><h3>5.4.5.&nbsp;
Option Numbers</h3>

<p>Options are identified by an option number. Odd numbers indicate
          a critical option, while even numbers indicate an elective option.
          
</p>
<p>The numbers 14, 28, 42, ... are reserved for "fenceposting", as
          described in <a class='info' href='#option-format'>Section&nbsp;3.2<span> (</span><span class='info'>Option Format</span><span>)</span></a>.
          As these option numbers are even, they stand for elective
          options, and unless assigned a meaning, these MUST be
          silently ignored.
</p>
<p>The option numbers for the options defined in this document are
          listed in the <a class='info' href='#option-number-registry'>CoAP Option
          Number Registry<span> (</span><span class='info'>Option Number Registry</span><span>)</span></a>.
</p>
<a name="payload-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Payload</h3>

<p>Both requests and responses may include payload, depending on the
        method or response code respectively. Methods with payload are PUT and
        POST, and the response codes with payload are 2.00 (OK) and the error
        codes.
</p>
<p>The payload of PUT, POST and 2.00 (OK) is typically a resource
        representation. Its format is specified by the Internet media type
        given by the Content-Type Option. A default value of "text/plain;
        charset=utf-8" is assumed in the absence of this option.
</p>
<p>A response with a code indicating a Client or Server Error SHOULD
        include a brief human-readable diagnostic message as payload, explaining the
        error situation. This diagnostic message MUST be encoded using
        <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629], more specifically using <a class='info' href='#RFC5198'>Net-Unicode form<span> (</span><span class='info'>Klensin, J. and M. Padlipsky, &ldquo;Unicode Format for Network Interchange,&rdquo; March&nbsp;2008.</span><span>)</span></a> [RFC5198]. The Content-Type Option has
        no meaning and SHOULD NOT be included.
</p>
<p>If a method or response code is not defined to have a payload,
        then the sender SHOULD NOT include one, and the recipient MUST ignore
        it.
</p>
<a name="caching"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Caching</h3>

<p>CoAP nodes MAY cache responses in order to reduce the response
        time and network bandwidth consumption on future, equivalent
        requests.
</p>
<p>The goal of caching in CoAP is to reuse a prior response message
        to satisfy a current request. In some cases, a stored response can
        be reused without the need for a network request, reducing latency
        and network round-trips; a "freshness" mechanism is used for this
        purpose (see <a class='info' href='#freshness-model'>Section&nbsp;5.6.1<span> (</span><span class='info'>Freshness Model</span><span>)</span></a>).
        Even when a new request is required, it is often possible to reuse
        the payload of a prior response to satisfy the request, thereby
        reducing network bandwidth usage; a "validation" mechanism is
        used for this purpose (see <a class='info' href='#validation-model'>Section&nbsp;5.6.2<span> (</span><span class='info'>Validation Model</span><span>)</span></a>).
</p>
<p>Unlike HTTP, the cacheability of CoAP responses does not depend
        on the request method, but the Response Code. The cacheability of
        each Response Code is defined along the Response Code definitions
        in <a class='info' href='#response-codes'>Section&nbsp;5.9<span> (</span><span class='info'>Response Code Definitions</span><span>)</span></a>. Response Codes that indicate
        success and are unrecognized by an end-point MUST NOT be cached.
</p>
<p>For a presented request, a CoAP node MUST NOT use a stored
        response, unless:
        </p>
<ul class="text">
<li>the presented request method and that used to obtain the stored response
          match,
</li>
<li>all options match between those in the presented request
          and those of the request
          used to obtain the stored response (which includes the request
          URI), except that there is no need for a match of the Token,
          Max-Age, or Etag request option(s), and
</li>
<li>the stored response is either fresh or successfully
          validated as defined below.
</li>
</ul><p>
        
</p>
<a name="freshness-model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6.1"></a><h3>5.6.1.&nbsp;
Freshness Model</h3>

<p>When a response is "fresh" in the cache, it can be used to
          satisfy subsequent requests without contacting the origin server,
          thereby improving efficiency.
</p>
<p>The mechanism for determining freshness is for an origin server
          to provide an explicit expiration time in the future, using the
          Max-Age Option (see <a class='info' href='#max-age'>Section&nbsp;5.10.5<span> (</span><span class='info'>Max-Age</span><span>)</span></a>). The Max-Age Option
          indicates that the response is to be considered not fresh after its
          age is greater than the specified number of seconds.
</p>
<p>As the Max-Age Option defaults to a value of 60, if it is
          not present in a cacheable response,
          then the response is considered not fresh after its age is greater
          than 60 seconds. If an origin server wishes to prevent caching,
          it MUST explicitly include a Max-Age Option with a value of zero
          seconds.
</p>
<p>In general, the origin server end-point is responsible for
          determining the Max-Age value. However, in some cases a client
          might need to influence freshness calculation. It can do this by
          including the Max-Age Option in a request. While this option
          value does not take part in the request matching, this indicates that
          the client is requesting a response whose remaining lifetime
          is no less than the specified time in seconds.
</p>
<a name="validation-model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6.2"></a><h3>5.6.2.&nbsp;
Validation Model</h3>

<p>When an end-point has one or more stored responses for a GET
          request, but cannot use any of them (e.g., because they are not
          fresh), it can use the Etag Option in the GET request to give the
          origin server an opportunity to both select a stored response to
          be used, and to update its freshness. This process is known as
          "validating" or "revalidating" the stored response.
</p>
<p>When sending such a request, the client SHOULD add an Etag
          Option specifying the entity-tag for each stored response that
          is applicable.
</p>
<p>A 2.03 (Valid) response
          indicates the stored response identified by the entity-tag given
          in the response's Etag Option can be reused, after updating its
          freshness with the value of the Max-Age Option that is included with
          the response (see <a class='info' href='#valid'>Section&nbsp;5.9.1.4<span> (</span><span class='info'>2.03 Valid</span><span>)</span></a>).
</p>
<p>Any other response code indicates that none of the stored
          responses nominated in the request is suitable. Instead, the
          response SHOULD be used to satisfy the request and MAY replace
          the stored response.
</p>
<a name="proxying"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
Proxying</h3>

<p>CoAP distinguishes between requests to an origin server and a
        request made through a proxy. A proxy is a CoAP end-point that can
        be tasked by CoAP clients to perform requests on their behalf.
        This may be useful, for example, when the request could otherwise
        not be made, or
        to service the response from a cache in order to reduce response
        time and network bandwidth or energy consumption.
</p>
<p>CoAP requests to a proxy are made as normal confirmable or
        non-confirmable requests to the proxy end-point, but specify the
        request URI in a different way: The request URI in a proxy request
        is specified as a string in the Proxy-Uri Option (see <a class='info' href='#proxy-uri'>Section&nbsp;5.10.3<span> (</span><span class='info'>Proxy-Uri</span><span>)</span></a>), while the request URI in a request to an origin
        server is split into the Uri-Host, Uri-Port, Uri-Path and Uri-Query
        Options (see <a class='info' href='#uri-options'>Section&nbsp;5.10.2<span> (</span><span class='info'>Uri-Host, Uri-Port, Uri-Path and Uri-Query</span><span>)</span></a>).
</p>
<p>When a proxy request is made to an end-point and the end-point is
        unwilling or unable to act as proxy for the request URI, it MUST
        return a 5.05 (Proxying Not Supported) response. If the authority
        (host and port) is recognized as identifying the proxy end-point,
        then the request MUST be treated as a local request.
</p>
<p>Unless a proxy is configured to forward the proxy request
        to another proxy,
        it MUST translate the request as follows: The origin server's
        IP address and port are determined by the authority component of the
        request URI, and the request URI is decoded and split into the
        Uri-Host, Uri-Port,
        Uri-Path and Uri-Query Options.
</p>
<p>All options present in a proxy request MUST be processed at
        the proxy.  Critical options in a request that are not recognized
        by the proxy MUST lead to a 4.02 (Bad Option) response being
        returned by the proxy.  Elective options not recognized by the
        proxy MUST NOT be forwarded to the origin server.  Similarly,
        critical options in a response that are not recognized by the
        proxy server MUST lead to a 5.02 (Bad Gateway) response.
        Again, elective options that are not recognized MUST NOT be forwarded.
</p>
<p>If the proxy does not employ a cache, then it simply forwards the
        translated request to the determined destination. Otherwise, if it
        does not have a stored response that matches the translated request and
        is considered fresh, then it needs to refresh its cache according
        to <a class='info' href='#caching'>Section&nbsp;5.6<span> (</span><span class='info'>Caching</span><span>)</span></a>.
</p>
<p>If the request to the destination times out, then a 5.04 (Gateway
        Timeout) response MUST be returned. If the request to the destination
        returns an response that cannot be processed by the proxy,
        then a 5.02 (Bad Gateway) response MUST be
        returned. Otherwise, the proxy returns the response to the client.
</p>
<p>If a response is generated out of a cache, it MUST be
        generated with a max-age option that does not extend the max-age
        originally set by the server, considering the time the
        resource representation spent in the cache.
        E.g., the Max-Age option could be adjusted by the proxy for each
        response using the formula: proxy-max-age = original-max-age -
        cache-age. For example if a request is made to a proxied resource that
        was refreshed 20 seconds ago and had an original Max-Age of 60 seconds,
        then that resource's proxied Max-Age is now 40 seconds.
</p>
<a name="methods"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8"></a><h3>5.8.&nbsp;
Method Definitions</h3>

<p>In this section each method is defined along with its behavior.
        A request with an unrecognized or unsupported Method Code MUST generate
        a 4.05 (Method Not Allowed) response.
</p>
<a name="get"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.1"></a><h3>5.8.1.&nbsp;
GET</h3>

<p>The GET method retrieves a representation for the
          information that currently corresponds to the resource
          identified by the request URI. If the request includes an Etag
          Option, the GET method requests that Etag be validated and that
          the representation be transferred only if validation failed.
          Upon success a 2.00 (OK) or 2.03 (Valid) response SHOULD be
          sent.
</p>
<p>The GET method is safe and idempotent.  An
          implementation MAY relax the requirement to answer all
          retransmissions of a request with the same response (<a class='info' href='#reliable'>Section&nbsp;4.1<span> (</span><span class='info'>Reliable Messages</span><span>)</span></a>), obviating the need to maintain state
          for Message IDs.
          
</p>
<a name="post"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.2"></a><h3>5.8.2.&nbsp;
POST</h3>

<p>The POST method requests that the representation enclosed in the
          request be processed. The actual function performed by the POST
          method is determined by the origin server and dependent on the
          target resource. It usually results in a new resource being created
          or the target resource being updated.
</p>
<p>If a resource has been created on the server, a 2.01 (Created)
          response that includes the URI of the new resource in a
          sequence of one or more Location-Path Options
          SHOULD be returned. If the POST succeeds but does not result
          in a new resource being created on the server, a 2.04 (Changed)
          response SHOULD be returned.
</p>
<p>If the request passes through a cache that has one or more
          stored responses for the request URI, those stored responses SHOULD
          be marked as stale.
</p>
<p>POST is neither safe nor idempotent and generally requires the full
          deduplication support from the message layer.
</p>
<a name="put"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.3"></a><h3>5.8.3.&nbsp;
PUT</h3>

<p>The PUT method requests that the resource identified by the
          request URI be updated or created with the enclosed representation.
          The representation format is specified by the media type given in
          the Content-Type Option.
</p>
<p>If a resource exists at the request URI the enclosed
          representation SHOULD be considered a modified version of that
          resource, and a 2.04 (Changed) response SHOULD be returned.
          If no resource exists then the server MAY create a new resource
          with that URI, resulting in a 2.01 (Created) response.
          If the resource could not be created or modified, then an
          appropriate error response code SHOULD be sent.
</p>
<p>If the request passes through a cache that has one or more stored
          responses for the request URI, those stored responses SHOULD be
          marked as stale.
</p>
<p>PUT is not safe, but idempotent.  An implementation MAY
          relax the message layer deduplication support and process duplicate
          transmissions of the request as separate requests.
</p>
<a name="delete"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8.4"></a><h3>5.8.4.&nbsp;
DELETE</h3>

<p>The DELETE method requests that the resource identified by the
          request URI be deleted. A 2.02 (Deleted) response SHOULD be
          sent on success or in case the resource did not exist before the
          request.
</p>
<p>If the request passes through a cache and the request URI
          identifies one or more currently stored responses, those
          entries SHOULD be treated as stale.
</p>
<p>DELETE is not safe, but idempotent.  An implementation MAY
          relax the message layer deduplication support and process duplicate
          transmissions of the request as separate requests.
</p>
<a name="response-codes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9"></a><h3>5.9.&nbsp;
Response Code Definitions</h3>

<p>Each response code is described below, including any options
        required in the response.  Where appropriate, some of the codes will be specified
        in regards to related response codes in HTTP <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>; this does not mean that any such
        relationship modifies the HTTP mapping specified in <a class='info' href='#http'>Section&nbsp;8<span> (</span><span class='info'>HTTP Mapping</span><span>)</span></a>.
</p>
<a name="success"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1"></a><h3>5.9.1.&nbsp;
Success 2.xx</h3>

<p>This class of status code indicates that the clients request
          was successfully received, understood, and accepted.
</p>
<a name="ok"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1.1"></a><h3>5.9.1.1.&nbsp;
2.00 OK</h3>

<p>Like HTTP 200 "OK", but only used in response to GET requests.
</p>
<p>The payload returned with the response is a representation
            of the target resource. The representation format is specified
            by the media type given in the Content-Type Option.
</p>
<p>This response is cacheable: Caches can use the Max-Age Option
            to determine freshness (see <a class='info' href='#freshness-model'>Section&nbsp;5.6.1<span> (</span><span class='info'>Freshness Model</span><span>)</span></a>)
            and (if present) the Etag Option for validation (see <a class='info' href='#validation-model'>Section&nbsp;5.6.2<span> (</span><span class='info'>Validation Model</span><span>)</span></a>).
</p>
<a name="created"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1.2"></a><h3>5.9.1.2.&nbsp;
2.01 Created</h3>

<p>Like HTTP 201 "Created", but only used in response to POST and PUT
            requests.
</p>
<p>If the response includes the Location-Path Option, the value of
            the option specifies the location at which the resource was
            created. Otherwise, the resource was created at the request
            URI. A cache SHOULD mark any stored response for the location
            as not fresh.
</p>
<p>This response is not cacheable.
</p>
<a name="deleted"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1.3"></a><h3>5.9.1.3.&nbsp;
2.02 Deleted</h3>

<p>Like HTTP 204 "No Content", but only used in response to DELETE
            requests.
</p>
<p>This response is not cacheable.
</p>
<a name="valid"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1.4"></a><h3>5.9.1.4.&nbsp;
2.03 Valid</h3>

<p>Related to HTTP 304 "Not Modified", but only used to
            indicate that the response
            identified by the entity-tag identified by the included Etag Option
            is valid. Accordingly, the response MUST include
            an Etag Option.
</p>
<p>When a cache receives a 2.03 (Valid) response, it needs to update
            the stored response with the value of the Max-Age Option included
            in the response (see <a class='info' href='#validation-model'>Section&nbsp;5.6.2<span> (</span><span class='info'>Validation Model</span><span>)</span></a>).
</p>
<a name="changed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.1.5"></a><h3>5.9.1.5.&nbsp;
2.04 Changed</h3>

<p>Like HTTP 204 "No Content", but only used in response to POST and PUT
            requests.
</p>
<p>This response is not cacheable.
</p>
<a name="client-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2"></a><h3>5.9.2.&nbsp;
Client Error 4.xx</h3>

<p>This class of response code is intended for cases in which the
          client seems to have erred. These response codes are applicable to
          any request method.
</p>
<p>The server SHOULD include a brief human-readable message as payload,
          as detailed in <a class='info' href='#payload-semantics'>Section&nbsp;5.5<span> (</span><span class='info'>Payload</span><span>)</span></a>.
</p>
<p>Responses of this class are cacheable: Caches can use the
          Max-Age Option to determine freshness (see <a class='info' href='#freshness-model'>Section&nbsp;5.6.1<span> (</span><span class='info'>Freshness Model</span><span>)</span></a>). They cannot be validated.
</p>
<a name="bad-request"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.1"></a><h3>5.9.2.1.&nbsp;
4.00 Bad Request</h3>

<p>Like HTTP 400 "Bad Request".
</p>
<a name="unauthorized"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.2"></a><h3>5.9.2.2.&nbsp;
4.01 Unauthorized</h3>

<p>The client is not authorized to perform the requested action.
            The client SHOULD NOT repeat the request without
            previously improving its
            authentication status to the server.  Which specific mechanism
            can be used for this is outside
            this document's scope; see also <a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>.
</p>
<a name="bad-option"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.3"></a><h3>5.9.2.3.&nbsp;
4.02 Bad Option</h3>

<p>The request could not be understood by the server due to one
            or more unrecognized or malformed critical options. The client
            SHOULD NOT repeat the request without modification.
</p>
<a name="forbidden"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.4"></a><h3>5.9.2.4.&nbsp;
4.03 Forbidden</h3>

<p>Like HTTP 403 "Forbidden".
</p>
<a name="not-found"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.5"></a><h3>5.9.2.5.&nbsp;
4.04 Not Found</h3>

<p>Like HTTP 404 "Not Found".
</p>
<a name="method-not-allowed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.6"></a><h3>5.9.2.6.&nbsp;
4.05 Method Not Allowed</h3>

<p>Like HTTP 405 "Method Not Allowed", but with no
            parallel to the "Accept" header field.
</p>
<a name="request-entity-too-large"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.7"></a><h3>5.9.2.7.&nbsp;
4.13 Request Entity Too Large</h3>

<p>Like HTTP 413 "Request Entity Too Large".
</p>
<a name="unsupported-media-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.2.8"></a><h3>5.9.2.8.&nbsp;
4.15 Unsupported Media Type</h3>

<p>Like HTTP 415 "Unsupported Media Type".
</p>
<a name="server-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3"></a><h3>5.9.3.&nbsp;
Server Error 5.xx</h3>

<p>This class of response code indicates cases in which the server
          is aware that it has erred or is incapable of performing the
          request. These response codes are applicable to any request
          method.
</p>
<p>The server SHOULD include a human-readable message as payload,
          as detailed in <a class='info' href='#payload-semantics'>Section&nbsp;5.5<span> (</span><span class='info'>Payload</span><span>)</span></a>.
</p>
<p>Responses of this class are cacheable: Caches can use the
          Max-Age Option to determine freshness (see <a class='info' href='#freshness-model'>Section&nbsp;5.6.1<span> (</span><span class='info'>Freshness Model</span><span>)</span></a>). They cannot be validated.
</p>
<a name="internal-server-error"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.1"></a><h3>5.9.3.1.&nbsp;
5.00 Internal Server Error</h3>

<p>Like HTTP 500 "Internal Server Error".
</p>
<a name="not-implemented"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.2"></a><h3>5.9.3.2.&nbsp;
5.01 Not Implemented</h3>

<p>Like HTTP 501 "Not Implemented".
</p>
<a name="bad-gateway"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.3"></a><h3>5.9.3.3.&nbsp;
5.02 Bad Gateway</h3>

<p>Like HTTP 502 "Bad Gateway".
</p>
<a name="service-unavailable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.4"></a><h3>5.9.3.4.&nbsp;
5.03 Service Unavailable</h3>

<p>Like HTTP 503 "Service Unavailable", but using the Max-Age Option in place of the
            "Retry-After" header field.
</p>
<a name="gateway-timeout"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.5"></a><h3>5.9.3.5.&nbsp;
5.04 Gateway Timeout</h3>

<p>Like HTTP 504 "Gateway Timeout".
</p>
<a name="proxying-not-supported"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9.3.6"></a><h3>5.9.3.6.&nbsp;
5.05 Proxying Not Supported</h3>

<p>The server is unable or unwilling to act as a proxy for
            the URI specified in the Proxy-Uri Option (see <a class='info' href='#proxy-uri'>Section&nbsp;5.10.3<span> (</span><span class='info'>Proxy-Uri</span><span>)</span></a>).
</p>
<a name="options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10"></a><h3>5.10.&nbsp;
Option Definitions</h3>

<p>The individual CoAP options are summarized in <a class='info' href='#tab-options'>Table&nbsp;1<span> (</span><span class='info'>Options</span><span>)</span></a> and explained below.
</p><br /><hr class="insert" />
<a name="tab-options"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="right"><col align="left"><col align="left"><col align="left"><col align="left"><col align="left">
<tr><th align="right">No.</th><th align="left">C/E</th><th align="left">Name</th><th align="left">Format</th><th align="left">Length</th><th align="left">Default</th></tr>
<tr>
<td align="right">1</td>
<td align="left">C</td>
<td align="left">Content-Type</td>
<td align="left">uint</td>
<td align="left">1-2 B</td>
<td align="left">0</td>
</tr>
<tr>
<td align="right">2</td>
<td align="left">E</td>
<td align="left">Max-Age</td>
<td align="left">uint</td>
<td align="left">0-4 B</td>
<td align="left">60</td>
</tr>
<tr>
<td align="right">3</td>
<td align="left">C</td>
<td align="left">Proxy-Uri</td>
<td align="left">string</td>
<td align="left">1-270 B</td>
<td align="left">(none)</td>
</tr>
<tr>
<td align="right">4</td>
<td align="left">E</td>
<td align="left">Etag</td>
<td align="left">opaque</td>
<td align="left">1-4 B</td>
<td align="left">(none)</td>
</tr>
<tr>
<td align="right">5</td>
<td align="left">C</td>
<td align="left">Uri-Host</td>
<td align="left">string</td>
<td align="left">1-270 B</td>
<td align="left">(see below)</td>
</tr>
<tr>
<td align="right">6</td>
<td align="left">E</td>
<td align="left">Location-Path</td>
<td align="left">string</td>
<td align="left">1-270 B</td>
<td align="left">(none)</td>
</tr>
<tr>
<td align="right">7</td>
<td align="left">C</td>
<td align="left">Uri-Port</td>
<td align="left">uint</td>
<td align="left">0-2 B</td>
<td align="left">(see below)</td>
</tr>
<tr>
<td align="right">9</td>
<td align="left">C</td>
<td align="left">Uri-Path</td>
<td align="left">string</td>
<td align="left">1-270 B</td>
<td align="left">(none)</td>
</tr>
<tr>
<td align="right">11</td>
<td align="left">C</td>
<td align="left">Token</td>
<td align="left">opaque</td>
<td align="left">1-8 B</td>
<td align="left">(empty)</td>
</tr>
<tr>
<td align="right">15</td>
<td align="left">C</td>
<td align="left">Uri-Query</td>
<td align="left">string</td>
<td align="left">1-270 B</td>
<td align="left">(none)</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Options&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="token"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.1"></a><h3>5.10.1.&nbsp;
Token</h3>

<p>The Token Option is used to match a response with a request.
          Every request has a client-generated token which the server MUST
          echo in any response.
</p>
<p>A token is intended for use as a client-local identifier for
          differentiating between concurrent requests. A client SHOULD
          generate tokens in a way that tokens currently in use are unique.
          An end-point receiving a token MUST treat it as opaque and make
          no assumptions about its format.
</p>
<p>A default value of a zero-length token is assumed in the absence
          of the option.
</p>
<p>This option is "critical". It MUST NOT occur more than once.
</p>
<a name="uri-options"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.2"></a><h3>5.10.2.&nbsp;
Uri-Host, Uri-Port, Uri-Path and Uri-Query</h3>

<p>The Uri-Host, Uri-Port, Uri-Path and Uri-Query Options are used
          to specify the target resource of a request to a CoAP origin server. The
          options encode the different components of the request URI in a way
          that no percent-encoding is visible in the option values
          (except for Uri-Query) and that the full URI can be
          reconstructed at any involved end-point. The syntax of CoAP URIs is
          defined in <a class='info' href='#uri'>Section&nbsp;6<span> (</span><span class='info'>CoAP URIs</span><span>)</span></a>.
</p>
<p>The steps for parsing URIs into options is defined in
          <a class='info' href='#uri-parsing'>Section&nbsp;6.3<span> (</span><span class='info'>Parsing URIs</span><span>)</span></a>. These steps result in zero or more
          Uri-Host, Uri-Port, Uri-Path and Uri-Query Options being included
          in a request, where each option holds the following values:
          </p>
<ul class="text">
<li>the Uri-Host Option specifies the Internet host of the resource
            being requested,
</li>
<li>the Uri-Port Option specifies the port number of the resource,
</li>
<li>each Uri-Path Option specifies one segment of the absolute path
            to the resource, and
</li>
<li>the Uri-Query Option specifies the query.
</li>
</ul><p>
          Note: Fragments (<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, Section 3.5) are not
          part of the request URI and thus will not be transmitted in a CoAP
          request.
</p>
<p>The default value of the Uri-Host Option is the IP literal
          representing the destination IP address of the request message.
          Likewise, the default value of the Uri-Port Option is the
          destination UDP port.
</p>
<p>The Uri-Path Option can contain any character sequence. No
          percent-encoding is performed. The value MUST NOT be "." or ".."
          (as the request URI must be resolved before parsing it into
          options).
</p>
<p>The steps for constructing the request URI from the options are
          defined in <a class='info' href='#uri-constructing'>Section&nbsp;6.4<span> (</span><span class='info'>Constructing URIs</span><span>)</span></a>. Note that an
          implementation does not necessarily have to construct the URI;
          it can simply look up the target resource by looking at the
          individual options.
</p>
<p>Examples can be found in <a class='info' href='#uri-examples'>Appendix&nbsp;C<span> (</span><span class='info'>URI Examples</span><span>)</span></a>.
</p>
<p>All of the options are "critical". Uri-Host, Uri-Port and
          Uri-Query MUST NOT occur more than once; Uri-Path MAY occur
          one or more times.
</p>
<a name="proxy-uri"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.3"></a><h3>5.10.3.&nbsp;
Proxy-Uri</h3>

<p>The Proxy-Uri Option is used to make a request to a proxy (see
          <a class='info' href='#proxying'>Section&nbsp;5.7<span> (</span><span class='info'>Proxying</span><span>)</span></a>). The proxy is requested to forward the
          request or service it from a valid cache, and return the
          response.
</p>
<p>The option value is an absolute-URI (<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>,
          Section 4.3). In case the absolute-URI doesn't fit within a single
          option, the Proxy-Uri Option MAY be included multiple times in a
          request such that the concatenation of the values results in the
          single absolute-URI.
</p>
<p>All but the last instance of the Proxy-Uri Option MUST have a
          value with a length of 270 bytes, and the last instance MUST NOT
          be empty.
</p>
<p>Note that the proxy MAY forward the request on to another proxy
          or directly to the server specified by the absolute-URI.
          In order to avoid request loops, a proxy MUST be able to recognize
          all of its server names, including any aliases, local variations,
          and the numeric IP addresses.
</p>
<p>An end-point receiving a request with a Proxy-Uri Option that
          is unable or unwilling to act as a proxy for the request MUST
          cause the return of a 5.05 (Proxying Not Supported) response.
</p>
<p>This option is "critical". It MAY occur one or more times and
          MUST take precedence over any of the Uri-Host, Uri-Port, Uri-Path
          or Uri-Query options (which MUST NOT be included at the same
          time).
</p>
<a name="content-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.4"></a><h3>5.10.4.&nbsp;
Content-Type</h3>

<p>The Content-Type Option indicates the representation format
          of the message payload. The representation format is given as a
          numeric media type identifier that is defined in the <a class='info' href='#media-type-registry'>CoAP Media Type registry<span> (</span><span class='info'>Media Type Registry</span><span>)</span></a>.
          A default value of 0 (meaning "text/plain; charset=utf-8") is
          assumed in the absence of the option.
</p>
<p>This option is "critical". It MUST NOT occur more than once.
</p>
<a name="max-age"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.5"></a><h3>5.10.5.&nbsp;
Max-Age</h3>

<p>The Max-Age Option indicates the maximum time a response may be
          cached before it MUST be considered not fresh (see <a class='info' href='#freshness-model'>Section&nbsp;5.6.1<span> (</span><span class='info'>Freshness Model</span><span>)</span></a>).
</p>
<p>When included in a request, the Max-Age Option indicates the
          minimum value for the maximum age of a cached response the
          client will accept.  Note that the default value of 60
          seconds for the Max-Age Option 
          does not apply in a request.
</p>
<p>The option value is an integer number of seconds between 0 and
          2^32-1 inclusive (about 136.1 years). A default value of 60 seconds
          is assumed in the absence of the option in a response.
</p>
<p>This option is "elective". It MUST NOT occur more than once.
</p>
<a name="etag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.6"></a><h3>5.10.6.&nbsp;
Etag</h3>

<p>The Etag Option in a response provides the current value of the
          entity-tag for the enclosed representation of the target
          resource.
</p>
<p>An entity-tag is intended for use as a resource-local identifier
          for differentiating between representations of the same resource
          that vary over time. It may be generated in any number of ways
          including a version, checksum, hash or time. An end-point receiving
          an entity-tag MUST treat it as opaque and make no assumptions about
          its format.
</p>
<p>A node that has one or more representations previously obtained
          from the resource can specify the Etag Option in a request for
          each stored response to determine if any of those representations
          is current (see <a class='info' href='#validation-model'>Section&nbsp;5.6.2<span> (</span><span class='info'>Validation Model</span><span>)</span></a>).
</p>
<p>This option is "elective". It MUST NOT occur more than once in a
          response, and MAY occur one or more times in a request.
</p>
<a name="location-path"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10.7"></a><h3>5.10.7.&nbsp;
Location-Path</h3>

<p>The collection of Location-Path Options indicates the location of a resource as
          an absolute path URI; each Location-Path Option is similar
          to a Uri-Path Option. The
          Location-Path Option MAY be included in a response to indicate the
          location of a new resource created with POST.
</p>
<p>If a response with a Location-Path Option passes through a cache
          and the implied URI identifies one or more currently stored
          responses, those entries SHOULD be treated as stale.
</p>
<p>This option is "elective". It MAY occur one or more times.
</p>
<a name="uri"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
CoAP URIs</h3>

<p>CoAP uses the "coap" URI scheme for identifying CoAP resources and
      providing a means of locating the resource. Resources are organized
      hierarchically and governed by a potential CoAP origin server listening
      for CoAP requests on a given UDP port. The CoAP server is identified via the
      generic syntax's authority component, which includes a host identifier
      and optional UDP port number, and the remainder of the URI is considered to be
      identifying a resource which can be operated on by the methods available
      through the CoAP protocol. CoAP URIs can thus be compared to the "http"
      URI scheme.
</p>
<a name="uri-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
URI Scheme Syntax</h3>

<p>The syntax of the "coap" URI scheme is specified below in
        Augmented Backus-Naur Form (ABNF) <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
        The definitions of "host", "port", "path-abempty", and "query"
        are adopted from <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, as well as
        "segment", "IP-literal", "IPv4address" and "reg-name" for the
        following sections.
</p>
<p>coap-URI = "coap:" "//" host [ ":" port ] path-abempty [ "?" query ]
</p>
<p>If host is provided as an IP literal or IPv4 address, then the
        CoAP server is located at that IP address.
        If host is a registered name, then that name is considered an indirect
        identifier and the end-point might use a name resolution service, such
        as DNS,
        
        to find the address of that host. The host MUST NOT be empty.
        The port subcomponent indicates the UDP port at which the CoAP
        server is located. If it is
        empty or not given, then the default port
        5683 is assumed.
</p>
<p>The path identifies a resource within the scope of the host and
        port. It consists of a sequence of path segments separated by a slash
        ("/") character. The query serves to further parametrize the resource,
        often in the form of "key=value" pairs.
</p>
<p>Application designers are encouraged to make use of short, but
        descriptive URIs.  As the environments that CoAP is used in
        are usually constrained for bandwidth and energy, the
        trade-off between these two qualities should lean towards the
        shortness, without ignoring descriptiveness.
</p>
<a name="uri-normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Normalization and Comparison Rules</h3>

<p>Since the "coap" scheme conforms to the URI generic syntax, URIs
        of this scheme are normalized and compared according to the algorithm
        defined in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, Section 6.
</p>
<p>If the port is equal to the default port 5683, the normal form
        is to elide the port component. Likewise, an empty path component
        is equivalent to an absolute path of "/", so the normal form is to
        provide a path of "/" instead. The scheme and host are
        case-insensitive and normally provided in lowercase;
        IP-literals are in recommended form <a class='info' href='#RFC5952'>[RFC5952]<span> (</span><span class='info'>Kawamura, S. and M. Kawashima, &ldquo;A Recommendation for IPv6 Address Text Representation,&rdquo; August&nbsp;2010.</span><span>)</span></a>; all other
        components are compared in a case-sensitive manner. Characters
        other than those in the "reserved" set are equivalent to their
        percent-encoded octets (see <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, Section
        2.1): the normal form is to not encode them.
</p>
<p>For example, the following three URIs are equivalent, and
        cause the same options and option values to appear in the CoAP
        messages:
        </p>
<blockquote class="text">
<p>coap://example.com:5683/~sensors/temp.xml
</p>
<p>coap://EXAMPLE.com/%7Esensors/temp.xml
</p>
<p>coap://EXAMPLE.com:/%7esensors/temp.xml
</p>
</blockquote><p>
        
</p>
<a name="uri-parsing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Parsing URIs</h3>

<p>The steps to parse a request's options from a string /url/ are as
        follows. These steps either result in zero or more of the Uri-Host,
        Uri-Port, Uri-Path and Uri-Query Options being included in the
        request, or they fail.
        </p>
<ol class="text">
<li>If the /url/ string is not an absolute URI (<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>), then fail this algorithm.
</li>
<li>Resolve the /url/ string using the process of reference
          resolution defined by <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, with the URL
          character encoding set to <a class='info' href='#RFC3629'>UTF-8<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> [RFC3629].
          <br />
<br />

          NOTE: It doesn't matter what it is resolved relative to, since
          we already know it is an absolute URL at this point.
</li>
<li>If /url/ does not have a &lt;scheme&gt; component whose value,
          when converted to ASCII lowercase, is "coap", then fail this
          algorithm.
</li>
<li>If /url/ has a &lt;fragment&gt; component, then fail this
          algorithm.
</li>
<li>If the &lt;host&gt; component of /url/ does not represent the
          request's destination IP address as an IP-literal or IPv4
          address, include a Uri-Host Option and
          let that option's value be the value of the &lt;host&gt; component
          of /url/, converted to ASCII lowercase, and then converting
          each percent-encoding ("%" followed by
          two hexadecimal digits) to the corresponding byte.
.
          <br />
<br />

          NOTE: In the usual case where the request's destination IP
          address is derived from the host part, this ensures that
          Uri-Host Options are only used for host parts of the form
          reg-name.
</li>
<li>If /url/ has a &lt;port&gt; component, then let /port/ be
          that component's value interpreted as a decimal integer;
          otherwise, let /port/ be the default
          port 5683.
</li>
<li>If /port/ does not equal the request's destination UDP port,
          include a Uri-Port Option and let that option's value be
          /port/.
</li>
<li>If the value of the &lt;path&gt; component of /url/ is empty or
          consists of a single slash character (U+002F SOLIDUS "/"), then move
          to the next step.<br />
<br />

          Otherwise, for each segment in the &lt;path&gt; component,
          include a Uri-Path Option and let that option's value be the
          segment (not including the delimiting slash characters)
          after converting each percent-encoding ("%" followed by
          two hexadecimal digits) to the corresponding byte.
</li>
<li>If /url/ has a &lt;query&gt; component, then include a
          Uri-Query Option and let that option's value be the value
          of the &lt;query&gt; component (not including the delimiting
          question mark). (Note that, in contrast to the other
          components, percent-encodings stay intact in the Uri-Query option.)
</li>
</ol>

<p>Note that these rules completely resolve any percent-encoding
        except in a reg-name and in a query.
        
</p>
<a name="uri-constructing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Constructing URIs</h3>

<p>The steps to construct a URI from a request's options are
        as follows.  These steps either result in a URI, or they fail.
        In these steps, percent-encoding a character means replacing each of its
        (UTF-8 encoded) bytes by a
        "%" character followed by two hexadecimal digits representing the
        byte, where the digits A-F are in upper case (as defined in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> Section 2.1; to reduce variability, the hexadecimal
        notation in CoAP URIs MUST use uppercase letters).
        </p>
<ol class="text">
<li>Let /url/ be the string "coap://".
</li>
<li>If the request includes a Uri-Host Option, let /host/ be
          that option's value, where any non-ASCII characters are
          replaced by their corresponding percent-encoding.  If /host/ is not a valid
          reg-name or IP-literal or IPv4address, fail the algorithm.
          Otherwise, let /host/ be the IP-literal (making
          use of the conventions of <a class='info' href='#RFC5952'>[RFC5952]<span> (</span><span class='info'>Kawamura, S. and M. Kawashima, &ldquo;A Recommendation for IPv6 Address Text Representation,&rdquo; August&nbsp;2010.</span><span>)</span></a>)
          or IPv4address
          representing the request's destination IP address.
</li>
<li>Append /host/ to /url/.
</li>
<li>If the request includes a Uri-Port Option, let /port/ be
          that option's value. Otherwise, let /port/ be the request's
          destination UDP port.
</li>
<li>If /port/ is not the default port 5683, then append a
          single U+003A COLON character (:) followed by the decimal
          representation of /port/ to /url/.
</li>
<li>Let /resource name/ be the empty string. For each Uri-Path
          Option in the request, append a single character U+002F SOLIDUS
          (/) followed by the option's value to /resource name/, after
          converting any character that is not either in the
          "unreserved" set, "sub-delims"
          set, a U+003A COLON character (:) or U+0040 COMMERCIAL AT (@),
          to its percent-encoded form.
</li>
<li>If /resource name/ is the empty string, set it to a single
          character U+002F SOLIDUS (/).
</li>
<li>Append /resource name/ to /url/.
</li>
<li>If the request includes a Uri-Query Option, append a single
          U+003F QUESTION MARK character (?) to /url/, followed by the
          option's value.
</li>
<li>Return /url/.
</li>
</ol>

<p>Note that these steps have been designed to lead to a URI
        in normal form (see <a class='info' href='#uri-normalization'>Section&nbsp;6.2<span> (</span><span class='info'>Normalization and Comparison Rules</span><span>)</span></a>).
        
</p>
<a name="addressing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Finding and Addressing CoAP End-Points</h3>

<a name="discovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Resource Discovery</h3>

<p>The discovery of resources offered by a CoAP end-point is extremely
      important in machine-to-machine applications where there are no humans
      in the loop and static interfaces result in fragility. A CoAP end-point
      SHOULD support the CoRE Link Format of discoverable resources as
      described in <a class='info' href='#I-D.ietf-core-link-format'>[I&#8209;D.ietf&#8209;core&#8209;link&#8209;format]<span> (</span><span class='info'>Shelby, Z., &ldquo;CoRE Link Format,&rdquo; December&nbsp;2010.</span><span>)</span></a>. 
</p>
<a name="default-port"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Default Port</h3>

<p>The CoAP default port number 5683 MUST be supported by a
        server for resource discovery
        and SHOULD be supported for providing access to other resources. In
        addition other end-points may be hosted in the dynamic port space.
</p>
<p>When a CoAP server is hosted by a 6LoWPAN node, it SHOULD also
        support a port in the 61616-61631 compressed UDP port space defined
        in <a class='info' href='#RFC4944'>[RFC4944]<span> (</span><span class='info'>Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;Transmission of IPv6 Packets over IEEE 802.15.4 Networks,&rdquo; September&nbsp;2007.</span><span>)</span></a>.
</p>
<a name="multiplexing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Multiplexing DTLS and CoAP</h3>

<p>The CoAP encoding has been chosen to enable demultiplexing of two
      kinds of packets that arrive on a single UDP port:
</p>
<p></p>
<ul class="text">
<li>CoAP messages directly sent within UDP
</li>
<li>DTLS 1.1 or 1.2 messages (which might contain CoAP messages) on UDP
</li>
</ul>

<p>Possibly less importantly, a distinction can also be made between
      these two and:
</p>
<p></p>
<ul class="text">
<li>STUN messages on UDP
</li>
</ul>

<p>This demultiplexing is possible because DTLS 1.1 or 1.2 UDP
      payloads begin with a byte out of:
</p><br /><hr class="insert" />
<a name="tls-contenttype"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
enum {
  change_cipher_spec(20), alert(21), handshake(22),
  application_data(23), (255)
} ContentType;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: TLS ContentType&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>i.e. 0x14 to 0x17 hex <a class='info' href='#RFC4347'>[RFC4347]<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security,&rdquo; April&nbsp;2006.</span><span>)</span></a>.
      In a CoAP message, such an initial byte would be decoded as a CoAP
      version 0, which is not in use.
</p>
<a name="multiplexing-future"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3.1"></a><h3>7.3.1.&nbsp;
Future-Proofing the Multiplexing</h3>

<p>To maintain this property, future versions of CoAP will not use
      version number 0.
      Note that future versions of DTLS might theoretically start to use
      "ContentType" values that fall into the range of 64 to 127; CoAP
      implementations would then not be able to reliably multiplex
      these new kinds of DTLS datagrams with CoAP datagrams on the same
      UDP port.  To maintain transparency for this case, an initial
      byte of 0x11 (17 decimal) is inserted on transmission and
      discarded upon reception; the rest of the
      datagram is interpreted as the DTLS message.  0x11 MUST NOT be
      followed by 0x14 to 0x17 hex, i.e. the DTLS messages defined by
      DTLS 1.1 and 1.2 are always sent unescaped.  Datagrams starting with
      0x11 and then 0x14 to 0x17 MUST be discarded.
</p>
<p>Similarly, STUN messages begin with 00mmmmmc binary (MSBs) <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>
      and so far happen to use an encoding for mmmmmc that also enables this
      initial byte to be distinguished from valid DTLS messages.  Again,
      future versions of CoAP will need to avoid using version number
      0.  STUN messages are most likely to begin with 0x00 and 0x01.
      All other STUN messages MUST be escaped with a an initial 0x10
      byte (16 decimal).  0x10 MUST NOT be followed by 0x00 or 0x01
      hex, i.e. the more likely STUN messages are always sent unescaped.
</p>
<p>Note that the escaping rules defined in this section are
      insurance for the future; they need no additional code in
      implementations that do not implement STUN or DTLS or implement
      only the versions current at the time of writing.  For easy
      reference, <a class='info' href='#initial-byte'>Table&nbsp;2<span> (</span><span class='info'>Interpretation of initial byte when multiplexing</span><span>)</span></a> summarizes the rules
      upon reception.
      
</p><br /><hr class="insert" />
<a name="initial-byte"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">initial byte</th><th align="left">disposition</th><th align="left">interpretation</th></tr>
<tr>
<td align="left">0x00 or 0x01</td>
<td align="left">keep</td>
<td align="left">STUN</td>
</tr>
<tr>
<td align="left">0x10</td>
<td align="left">remove</td>
<td align="left">STUN</td>
</tr>
<tr>
<td align="left">0x11</td>
<td align="left">remove</td>
<td align="left">DTLS</td>
</tr>
<tr>
<td align="left">0x14 to 0x17</td>
<td align="left">keep</td>
<td align="left">DTLS</td>
</tr>
<tr>
<td align="left">0x40 to 0x7F</td>
<td align="left">keep</td>
<td align="left">CoAP</td>
</tr>
<tr>
<td align="left">all others</td>
<td align="left">&#160;</td>
<td align="left">(invalid)</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Interpretation of initial byte when multiplexing&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
HTTP Mapping</h3>

<p>CoAP supports a limited subset of HTTP functionality, and thus a
      mapping to HTTP is straightforward. There might be several reasons
      for mapping between CoAP and HTTP, for example when designing a web
      interface for use over either protocol or when realizing a CoAP-HTTP
      proxy. Likewise, CoAP could equally be mapped to other protocols such
      as XMPP <a class='info' href='#RFC3920'>[RFC3920]<span> (</span><span class='info'>Saint-Andre, P., Ed., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> or SIP <a class='info' href='#RFC3264'>[RFC3264]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>, the
      definition of these mappings is out of scope of this specification.
</p>
<p>This section discusses two ways of mapping:
      </p>
<blockquote class="text"><dl>
<dt>CoAP-HTTP Mapping:</dt>
<dd>Enables CoAP clients to access
        resources on HTTP servers through an intermediary.
        This is initiated by including the Proxy-Uri Option with an "http"
        URI in a CoAP request to a CoAP-HTTP proxy, or by sending a CoAP
        request to a reverse proxy that maps CoAP to HTTP.
</dd>
<dt>HTTP-CoAP Mapping:</dt>
<dd>Enables HTTP clients to access
        resources on CoAP servers through an intermediary.
        This is initiated by specifying a "coap" URI in the Request-Line
        of an HTTP request to an HTTP-CoAP proxy, or by sending an HTTP
        request to a reverse proxy that maps HTTP to CoAP.
</dd>
</dl></blockquote><p>
      
</p>
<p>Either way, only the Request/Response model of CoAP is mapped to
      HTTP. The underlying model of confirmable or non-confirmable messages,
      etc., is invisible and MUST have no effect on a proxy function.
</p>
<a name="coap-http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
CoAP-HTTP Mapping</h3>

<p>The mapping of CoAP to HTTP is a relatively straightforward conversion of
        the CoAP method or response code, content-type and options to the
        corresponding HTTP feature. The payload is carried in an equivalent
        way by both protocols.
</p>
<p>In a similar manner to CoAP-CoAP proxying, the CoAP-HTTP proxy
        MAY perform caching of HTTP responses. If no caching is performed,
        a CoAP GET request that specifies an entity-tag in an Etag Option
        SHOULD be mapped to a conditional HTTP request that includes the
        entity-tag in the "If-None-Match" request-header field. If the
        entity-tag matches the entity-tag of the representation, the HTTP
        server responds with an HTTP 304 (Not Modified) response which
        SHOULD be mapped to a CoAP 2.03 (Valid) response with the Etag Option
        reflecting the response's "Etag" response-header field.
        The mapping of max-age is straightforward.
</p>
<p>HTTP entity-tags consist of characters in a subset of
        the US-ASCII character set, which can be carried directly in
        a CoAP Etag Option.  Weak entity-tags are not supported by
        this mapping.
        However, an entity-tag may not fit within the CoAP Etag Option.
        In this case, the proxy MAY map the entity-tag to a
        shorter unique byte sequence and keep state, or MAY silently ignore the
        "Etag" response-header when mapping an HTTP response to CoAP (so
        the CoAP client will never send a CoAP GET request with an Etag
        Option).
</p>
<p>Provisional responses (HTTP Status Codes 1xx), and responses
        indicating that further action needs to be taken (HTTP Status
        Codes 3xx), SHOULD cause the proxy to complete the
        request, e.g., by following the redirects. If the proxy
        is unable to complete the request, it SHOULD respond with
        a CoAP 5.02 (Bad Gateway) error.
</p>
<p>HTTP responses are mapped to CoAP responses as follows:
</p><br /><hr class="insert" />
<a name="tab-coap-http"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">HTTP Status Code</th><th align="left">CoAP Response Code</th><th align="left">Notes</th></tr>
<tr>
<td align="left">100 Continue                       </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">101 Switching Protocols            </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">200 OK                             </td>
<td align="left">                             </td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">201 Created                        </td>
<td align="left">2.01 Created                 </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">202 Accepted                       </td>
<td align="left">                             </td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">203 Non-Authoritative Information  </td>
<td align="left">                             </td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">204 No Content                     </td>
<td align="left">                             </td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">205 Reset Content                  </td>
<td align="left">                             </td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">206 Partial Content                </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">300 Multiple Choices               </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">301 Moved Permanently              </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">302 Found                          </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">303 See Other                      </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">304 Not Modified                   </td>
<td align="left">2.03 Valid                   </td>
<td align="left">7</td>
</tr>
<tr>
<td align="left">305 Use Proxy                      </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">306 (Unused)                       </td>
<td align="left">5.02 Bad Gateway             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">307 Temporary Redirect             </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">400 Bad Request                    </td>
<td align="left">4.00 Bad Request             </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">401 Unauthorized                   </td>
<td align="left">4.01 Unauthorized            </td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">402 Payment Required               </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">403 Forbidden                      </td>
<td align="left">4.03 Forbidden               </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">404 Not Found                      </td>
<td align="left">4.04 Not Found               </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">405 Method Not Allowed             </td>
<td align="left">4.05 Method Not Allowed      </td>
<td align="left">8</td>
</tr>
<tr>
<td align="left">406 Not Acceptable                 </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">407 Proxy Authentication Required  </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">408 Request Timeout                </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">409 Conflict                       </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">410 Gone                           </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">411 Length Required                </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">412 Precondition Failed            </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">413 Request Entity Too Large       </td>
<td align="left">4.13 Request Entity Too Large</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">414 URI Too Long                   </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">415 Unsupported Media Type         </td>
<td align="left">4.15 Unsupported Media Type  </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">416 Requested Range Not Satisfiable</td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">417 Expectation Failed             </td>
<td align="left">4.00 Bad Request             </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">500 Internal Server Error          </td>
<td align="left">5.00 Internal Server Error   </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">501 Not Implemented                </td>
<td align="left">5.01 Not Implemented         </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">502 Bad Gateway                    </td>
<td align="left">5.02 Bad Gateway             </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">503 Service Unavailable            </td>
<td align="left">5.03 Service Unavailable     </td>
<td align="left">9</td>
</tr>
<tr>
<td align="left">504 Gateway Timeout                </td>
<td align="left">5.04 Gateway Timeout         </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">505 HTTP Version Not Supported     </td>
<td align="left">                             </td>
<td align="left">2</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3: CoAP-HTTP Mapping&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Notes:
        </p>
<ol class="text">
<li>There is no equivalent CoAP response.
</li>
<li>The proxy should perform the action implied by the
          response code (e.g., by following redirects); i.e. this
          response is never forwarded to the CoAP client.  If the
          proxy is unable or unwilling to perform this function, the
          CoAP response code 5.02 (Bad Gateway) can be returned.
</li>
<li>The CoAP response code depends on the request method. For a GET
          request, the response code SHOULD be 2.00 (OK). For a POST, PUT or
          DELETE request, the mapping is only partial: response
          entities are ignored, and the response code depends on the
          method as defined in <a class='info' href='#methods'>Section&nbsp;5.8<span> (</span><span class='info'>Method Definitions</span><span>)</span></a>.
</li>
<li>(The mapping for these rarely-used status codes is not
          defined in this specification.)
</li>
<li>The HTTP "WWW-Authenticate" response-header field has no
          equivalent option in CoAP and is either processed by the
          proxy by performing an additional request or silently dropped.
</li>
<li>The CoAP response code depends on the request method. For a POST
          or PUT request, the response code SHOULD be 2.04 (Changed); for a
          DELETE request, 2.02 (Deleted).
</li>
<li>Since a CoAP request with Etag Option is mapped to a conditional
          HTTP GET request with a "If-None-Match" request-header field, any
          HTTP 304 (Not Modified) response will confirm that the Etag
          is valid.
          Except for the max-age directive of the Cache-Control header
          field, any additional headers in the HTTP Not Modified
          response are not carried through to the CoAP client, though.
</li>
<li>The HTTP "Accept" response-header field has no equivalent option
          in CoAP and is silently dropped.
</li>
<li>The HTTP "Retry-After" response-header field has no equivalent
          option in CoAP, although it may be used to find a value for the
          Max-Age Option.
</li>
</ol><p>
        
</p>
<a name="http-coap"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
HTTP-CoAP Mapping</h3>

<p>The mapping of HTTP to CoAP requires checking for methods,
        response codes and options that are not supported by CoAP. A
        proxy SHOULD attempt to map options, response codes and
        content-types to a suitable alternative if possible. Otherwise
        the unsupported feature SHOULD be silently dropped if possible,
        or an appropriate error code generated otherwise.
</p>
<p>Mapping MAY include performing payload conversion (e.g., from EXI
        to XML), the definition of which is out of this document's scope.
</p>
<p>Only those Conditional HTTP requests can be mapped to CoAP requests
        that have method GET and include a "If-None-Match" request-header
        field. The "If-Match", "If-Modified-Since" and "If-Unmodified-Since"
        request-header fields are not supported on the CoAP side, but
        could be implemented locally by a caching proxy. A HTTP-CoAP
        proxy SHOULD map
        Etags generated by a CoAP server to HTTP-friendly Etags by using
        <a class='info' href='#RFC4648'>Base64<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a> [RFC4648].
</p>
<p>A proxy SHOULD respond with a HTTP 502 (Bad Gateway) error to
        HTTP requests which can not be successfully mapped to CoAP.
</p>
<p>A proxy SHOULD employ a cache to limit traffic on the constrained
        network.
</p>
<p>CoAP responses are mapped to HTTP responses as follows:
</p><br /><hr class="insert" />
<a name="tab-http-coap"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">CoAP Response Code</th><th align="left">HTTP Status Code</th><th align="left">Notes</th></tr>
<tr>
<td align="left">2.00 OK                      </td>
<td align="left">200 OK                      </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">2.01 Created                 </td>
<td align="left">201 Created                 </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">2.02 Deleted                 </td>
<td align="left">204 No Content              </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">2.03 Valid                   </td>
<td align="left">304 Not Modified            </td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">2.04 Changed                 </td>
<td align="left">204 No Content              </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.00 Bad Request             </td>
<td align="left">400 Bad Request             </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.01 Unauthorized            </td>
<td align="left">400 Bad Request             </td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">4.02 Bad Option              </td>
<td align="left">400 Bad Request             </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.03 Forbidden               </td>
<td align="left">403 Forbidden               </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.04 Not Found               </td>
<td align="left">404 Not Found               </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.05 Method Not Allowed      </td>
<td align="left">405 Method Not Allowed      </td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">4.13 Request Entity Too Large</td>
<td align="left">413 Request Entity Too Large</td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">4.15 Unsupported Media Type  </td>
<td align="left">415 Unsupported Media Type  </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">5.00 Internal Server Error   </td>
<td align="left">500 Internal Server Error   </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">5.01 Not Implemented         </td>
<td align="left">501 Not Implemented         </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">5.02 Bad Gateway             </td>
<td align="left">502 Bad Gateway             </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">5.03 Service Unavailable     </td>
<td align="left">503 Service Unavailable     </td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">5.04 Gateway Timeout         </td>
<td align="left">504 Gateway Timeout         </td>
<td align="left"> </td>
</tr>
<tr>
<td align="left">5.05 Proxying Not Supported  </td>
<td align="left">502 Bad Gateway             </td>
<td align="left"> </td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4: HTTP-CoAP Mapping&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Notes:
        </p>
<ol class="text">
<li>A CoAP 2.03 (Valid) response only (1) confirms that the request Etag
          is valid and (2) provides a new Max-Age value. HTTP 304 (Not Modified)
          also updates some header fields of a stored response.
          A non-caching proxy may not have enough
          information to fill in the required values in the HTTP 304 (Not
          Modified) response, so it may not be advisable to provoke
          the 2.03 (Valid) response by forwarding an Etag.  A caching
          proxy will fill the information out of the cache.
</li>
<li>There is no equivalent HTTP status code.
</li>
<li>CoAP does not provide enough information to compute a
          value for the required "Allow" response-header field.  If
          this violation of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> cannot be tolerated, the
          proxy should instead send a 4.00 (Bad Request) response.
</li>
<li>The value of the "Retry-After" response-header field is the
          value of the Max-Age Option.
</li>
</ol><p>
        
</p>
<a name="constants"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Protocol Constants</h3>

<p>This section defines the relevant protocol constants defined in this
      document: </p>
<blockquote class="text"><dl>
<dt>RESPONSE_TIMEOUT</dt>
<dd>2 seconds
</dd>
<dt>MAX_RETRANSMIT</dt>
<dd>4
</dd>
</dl></blockquote>

<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>This section describes mechanisms that can be used to secure CoAP and
      analyzes the possible threats to the protocol and its limitations.
      Security bootstrapping (authenticating nodes and setting up keys) in constrained environments is
      considered in <a class='info' href='#I-D.oflynn-core-bootstrapping'>[I&#8209;D.oflynn&#8209;core&#8209;bootstrapping]<span> (</span><span class='info'>Sarikaya, B., Ohba, Y., Cao, Z., and R. Cragie, &ldquo;Security Bootstrapping of Resource-Constrained Devices,&rdquo; October&nbsp;2010.</span><span>)</span></a>.
</p>
<p>During the bootstrap and enrollment phases, a CoAP device is provided
      with the security information that it needs, including keying
      materials. How this is done is out
      of scope for this specification but a couple of ways of doing this are
      described in <a class='info' href='#I-D.oflynn-core-bootstrapping'>[I&#8209;D.oflynn&#8209;core&#8209;bootstrapping]<span> (</span><span class='info'>Sarikaya, B., Ohba, Y., Cao, Z., and R. Cragie, &ldquo;Security Bootstrapping of Resource-Constrained Devices,&rdquo; October&nbsp;2010.</span><span>)</span></a>. At
      the end of the enrollment and bootstrap, the device will be in one of
      four security modes with the following information for the given
      mode:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>NoSec:</dt>
<dd>There is no protocol level security.
</dd>
<dt>SharedKey:</dt>
<dd>There is one shared key between all the
          nodes that this CoAP nodes needs to communicate with.
</dd>
<dt>MultiKey:</dt>
<dd>There is a list of shared keys and each key
          includes a list of which nodes it can be used to communicate with.
          At the extreme there may be one key for each node this CoAP node needs to communicate with.
</dd>
<dt>Certificate:</dt>
<dd>The device has an asymmetric key pair
          with a X.509 <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> certificate that binds it
          to its Authority Name and is signed by a some common trust root. The
          device also has a list or root trust anchors that can be used for
          validating a certificate. There may be an optional shared key that
          all the nodes that communicate have access too.
</dd>
</dl></blockquote><p>

        The Authority Name in the certificate is the name that would be
      used in the Authority part of a CoAP URI. It is worth noting that
      this would typically not be either an IP address or DNS name but would
      instead be a long term unique identifier for the device such as the
      EUI-64 <a class='info' href='#EUI64'>[EUI64]<span> (</span><span class='info'>, &ldquo;GUIDELINES FOR 64-BIT GLOBAL IDENTIFIER (EUI-64) REGISTRATION AUTHORITY,&rdquo; April&nbsp;2010.</span><span>)</span></a>. The discovery process used in the system would build up the
      mapping between IP addresses of the given devices and the Authority Name
      for each device. Some devices could have more than one Authority and
      would need more than a single certificate.
</p>
<p>In the "NoSec" mode, the system simply sends the packets over normal
      UDP over IP. The system is secured only by keeping attackers
      from being able to send or receive packets from the network with the
      CoAP nodes; see <a class='info' href='#cross-protocol-attacks'>Section&nbsp;10.3.4<span> (</span><span class='info'>Cross-Protocol Attacks</span><span>)</span></a> for an additional
      complication with this approach.
      The other three security modes can be achieved with IPsec or
      DTLS.  The result is a security association that can be used to
      authenticate (within the limits of the security model) and,
      based on this authentication,
      authorize the communication partner.  CoAP itself does not
      provide protocol primitives for authentication or authorization;
      where this is required, it can either be provided by
      communication security (i.e., IPsec or DTLS) or by object
      security (within the payload).  Devices that require
      authorization for certain operations are expected to require one
      of these two forms of security.  Necessarily, where an
      intermediary is involved, communication security only works when
      that intermediary is part of the trust relationships; CoAP does
      not provide a way to forward different levels of authorization
      that clients may have with an intermediary to further
      intermediaries or origin servers -- it therefore may be required
      to perform all authorization at the first intermediary.
</p>
<a name="ipsec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Securing CoAP with IPsec</h3>

<p>One mechanism to secure CoAP in constrained environments is the
        IPsec Encapsulating Security Payload (ESP) <a class='info' href='#RFC4303'>[RFC4303]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>. Using IPsec ESP with the appropriate
        configuration, it is possible for many constrained devices to support
        encryption with built-in link-layer encryption hardware. For example,
        some IEEE 802.15.4 radio chips are compatible with AES-CBC (with
        128-bit keys) <a class='info' href='#RFC3602'>[RFC3602]<span> (</span><span class='info'>Frankel, S., Glenn, R., and S. Kelly, &ldquo;The AES-CBC Cipher Algorithm and Its Use with IPsec,&rdquo; September&nbsp;2003.</span><span>)</span></a> as defined for use with
        IPsec in <a class='info' href='#RFC4835'>[RFC4835]<span> (</span><span class='info'>Manral, V., &ldquo;Cryptographic Algorithm Implementation Requirements for Encapsulating Security Payload (ESP) and Authentication Header (AH),&rdquo; April&nbsp;2007.</span><span>)</span></a>.  Alternatively,
        particularly on more common IEEE 802.15.4 hardware that supports AES
        encryption but not decryption, and to avoid the need for padding, nodes
        could directly use the more widely supported AES-CCM as
        defined for use with IPsec in
        <a class='info' href='#RFC4309'>[RFC4309]<span> (</span><span class='info'>Housley, R., &ldquo;Using Advanced Encryption Standard (AES) CCM Mode with IPsec Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>, if the security considerations in
        section 9 of that specification can be fulfilled.
        Necessarily for AES-CCM, but much preferably also for AES-CBC,
        static keying should be avoided and the initial keying
        material be derived into transient session keys, e.g. using a
        low-overhead mode of IKEv2 <a class='info' href='#RFC5996'>[RFC5996]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol Version 2 (IKEv2),&rdquo; September&nbsp;2010.</span><span>)</span></a>; such a
        protocol for managing keys and sequence numbers is
        also the only way to achieve anti-replay capabilities.
        However, no
        recommendation can be made at this point on how to manage
        group keys (i.e., for multicast) in a constrained environment.
        Once any initial setup is completed, IPsec ESP adds a limited
        per-packet overhead of approximately 10 bytes, not including
        initialization vectors,
        integrity check values and padding required by the cipher suite.
        
</p>
<p>
        When using IPsec to secure
        CoAP, both authentication and confidentiality SHOULD be applied as
        recommended in <a class='info' href='#RFC4303'>[RFC4303]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>. The use of IPsec
        between CoAP end-points is transparent to the application layer and
        does not require special consideration for a CoAP implementation. 
</p>
<p>IPsec may not be appropriate for all environments. For example,
        IPsec support is not available for many embedded IP stacks and even in
        full PC operating systems or on back-end web servers, application
        developers may not have sufficient access to configure or enable IPsec
        or to add a security gateway to the infrastructure. Problems with
        firewalls and NATs may furthermore limit the use of IPsec.
</p>
<a name="dtls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
Securing CoAP with DTLS</h3>

<p>Just as HTTP may be secured using Transport Layer Security (TLS)
        over TCP, CoAP may be secured using Datagram TLS (DTLS) <a class='info' href='#RFC4347'>[RFC4347]<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security,&rdquo; April&nbsp;2006.</span><span>)</span></a> over UDP. This section gives a quick
        overview of how to
        secure CoAP with DTLS, along with the minimal configurations
        appropriate for constrained environments. DTLS is in practice TLS with
        added features to deal with the unreliable nature of the UDP
        transport.
</p>
<p>In some constrained nodes (limited flash and/or RAM) and networks
        (limited bandwidth or high scalability requirements), and
        depending on the specific cipher suites in use, DTLS may not be
        applicable. Some of DTLS' cipher suites can add significant
        implementation complexity as well as some initial handshake
        overhead needed when setting up the security association.
        Once the initial handshake is completed, DTLS adds a limited
        per-datagram overhead of approximately 13 bytes, not including
        any initialization vectors (which are generally implicitly derived
        with DTLS), integrity check values (e.g., 8 bytes with the proposed
        TLS_PSK_WITH_AES_128_CCM_8 <a class='info' href='#I-D.mcgrew-tls-aes-ccm'>[I&#8209;D.mcgrew&#8209;tls&#8209;aes&#8209;ccm]<span> (</span><span class='info'>McGrew, D. and D. Bailey, &ldquo;AES-CCM Cipher Suites for TLS,&rdquo; June&nbsp;2010.</span><span>)</span></a>) and padding
        required by the cipher suite.
        Whether and which mode of using
        DTLS is applicable for a CoAP-based application should be
        carefully weighed
        considering the specific cipher suites that may be applicable,
        and whether the session
        maintenance makes it compatible with application flows and sufficient
        resources are available on the constrained nodes and for the added
        network overhead.
        DTLS is not applicable to group keying (multicast
        communication); however, it may be a component in a future
        group key management protocol.
</p>
<p>Devices SHOULD support the Server Name Indication (SNI) to indicate
        their Authority Name in the SNI HostName field as defined in Section 3
        of <a class='info' href='#RFC6066'>[RFC6066]<span> (</span><span class='info'>Eastlake, D., &ldquo;Transport Layer Security (TLS) Extensions: Extension Definitions,&rdquo; January&nbsp;2011.</span><span>)</span></a>. This is needed so that when a host that
        acts as a virtual server for multiple Authorities receives a new DTLS
        connection, it knows which keys to use for the DTLS session.
</p>
<p>DTLS connections with certificates are set up using mutual
        authentication so they can remain up and be reused for future
        message exchanges in either direction. Devices can close a DTLS connection
        when they need to recover resources but in general they should keep
        the connection up for as long as possible. Closing the DTLS connection
        after every CoAP message exchange is very inefficient.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.1"></a><h3>10.2.1.&nbsp;
SharedKey &amp; MultiKey Modes</h3>

<p>When forming a connection to a new node, the system selects an
        appropriate key based on which nodes it is trying to reach then forms
        a DTLS session using a PSK (Pre-Shared Key) mode of DTLS.
        Implementations SHOULD support the mandatory to implement cipher suite
        TLS_PSK_WITH_AES_128_CBC_SHA as specified in <a class='info' href='#RFC4279'>[RFC4279]<span> (</span><span class='info'>Eronen, P. and H. Tschofenig, &ldquo;Pre-Shared Key Ciphersuites for Transport Layer Security (TLS),&rdquo; December&nbsp;2005.</span><span>)</span></a>; once TLS_PSK_WITH_AES_128_CCM_8 as
        specified in <a class='info' href='#I-D.mcgrew-tls-aes-ccm'>[I&#8209;D.mcgrew&#8209;tls&#8209;aes&#8209;ccm]<span> (</span><span class='info'>McGrew, D. and D. Bailey, &ldquo;AES-CCM Cipher Suites for TLS,&rdquo; June&nbsp;2010.</span><span>)</span></a> (or related cipher suites
        specified in <a class='info' href='#I-D.mcgrew-tls-aes-ccm-ecc'>[I&#8209;D.mcgrew&#8209;tls&#8209;aes&#8209;ccm&#8209;ecc]<span> (</span><span class='info'>McGrew, D., Bailey, D., Campagna, M., and R. Dugal, &ldquo;AES-CCM ECC Cipher Suites for TLS,&rdquo; January&nbsp;2011.</span><span>)</span></a>) in conjunction with
        <a class='info' href='#I-D.ietf-tls-rfc4347-bis'>[I&#8209;D.ietf&#8209;tls&#8209;rfc4347&#8209;bis]<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security version 1.2,&rdquo; July&nbsp;2010.</span><span>)</span></a>
        becomes available, this may
        be easier to implement on certain contemporary chipsets.
</p>
<p>The security considerations of <a class='info' href='#RFC4279'>[RFC4279]<span> (</span><span class='info'>Eronen, P. and H. Tschofenig, &ldquo;Pre-Shared Key Ciphersuites for Transport Layer Security (TLS),&rdquo; December&nbsp;2005.</span><span>)</span></a>
        (Section 7) apply.  In particular, applications should
        carefully weigh whether they need Perfect Forward Secrecy
        (PFS) or not and select an appropriate cipher suite (7.1).
        The entropy of the PSK must be sufficient to mitigate against
        brute-force and (where the PSK is not chosen randomly but by a
        human) dictionary attacks (7.2).  The cleartext communication
        of client identities may leak data or compromise privacy (7.3).
        
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2.2"></a><h3>10.2.2.&nbsp;
Certificate Mode</h3>

<p>As with IPsec, DTLS should be configured with a cipher suite
        compatible with any possible hardware engine on the node, for example
        AES-CBC in the case of IEEE 802.15.4. Implementations SHOULD support
        the mandatory to implement cipher suite TLS_RSA_WITH_AES_128_CBC_SHA
        as specified in <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>When a new connection is formed, the certificate from the remote
        device needs to be verified. If the CoAP node has a source of absolute
        time, then the node SHOULD check the validity dates are of the
        certificate are within range. The certificate MUST also be signed by
        an appropriate chain of trust. If the certificate contains a
        SubjectAltName, then the Authority Name MUST match at least one of the
        authority names of any CoAP URI found in a URI type fields in the
        SubjectAltName set. If there is no SubjectAltName in the certificate,
        then the Authoritative Name must match the CN found in the certificate
        using the matching rules defined in <a class='info' href='#RFC2818'>[RFC2818]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a>
        with the exception that certificates with wildcards are not
        allowed.
</p>
<p>If the system has a shared key in addition to the certificate, then
        a cipher suite that includes the shared key such as
        TLS_RSA_PSK_WITH_AES_128_CBC_SHA SHOULD be used. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Threat analysis and protocol limitations</h3>

<p>This section is meant to inform protocol and application developers
        about the security limitations of CoAP as described in this document.
        As CoAP realizes a subset of the features in HTTP/1.1, the security
        considerations in Section 15 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a> are
        also pertinent to CoAP. This section concentrates on describing
        limitations specific to CoAP and CoRE.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3.1"></a><h3>10.3.1.&nbsp;
Protocol Parsing, Processing URIs</h3>

<p>A network-facing application can exhibit vulnerabilities
          in its processing logic for incoming packets.
          Complex parsers are well-known as a likely source of such
          vulnerabilities, such as the ability to remotely crash a node, or
          even remotely execute arbitrary code on it.
          CoAP attempts to narrow the opportunities for introducing
          such vulnerabilities by reducing parser complexity, by giving the
          entire range of encodable values a meaning where possible, and by
          aggressively reducing complexity that is often caused by unnecessary
          choice between multiple representations that mean the same.
          Much of the URI processing has been moved to the clients,
          further reducing the opportunities for introducing
          vulnerabilities into the servers.
          Even so, the URI processing code in CoAP implementations
          is likely to be a large source of remaining
          vulnerabilities and should be implemented with special care.
          The most complex parser remaining could be the one for the
          link-format, although this also has been designed with a goal of
          reduced implementation complexity <a class='info' href='#I-D.ietf-core-link-format'>[I&#8209;D.ietf&#8209;core&#8209;link&#8209;format]<span> (</span><span class='info'>Shelby, Z., &ldquo;CoRE Link Format,&rdquo; December&nbsp;2010.</span><span>)</span></a>.
          (See also section
          15.2 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.)
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3.2"></a><h3>10.3.2.&nbsp;
Proxying and Caching</h3>

<p>
            As mentioned in 15.2 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, which
            see, proxies are by their very nature men-in-the-middle,
            breaking any IPsec or DTLS protection that a direct CoAP
            message exchange might have.  They are therefore interesting
            targets for breaking confidentiality or integrity of CoAP
            message exchanges.  As noted in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, they
            are also interesting targets for breaking availability.
          
</p>
<p>
            The threat to confidentiality and integrity of request/response
            data is amplified where proxies also cache.  Note that
            CoAP does not define any of the cache-suppressing
            Cache-Control options that HTTP/1.1 provides to better
            protect sensitive data.
          
</p>
<p>
            Finally, a proxy that fans out deferred responses to
            multiple original requesters may provide additional
            amplification (see below).
          
</p>
<a name="amplification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3.3"></a><h3>10.3.3.&nbsp;
Risk of amplification</h3>

<p>
            CoAP servers generally reply to a request packet with a
            response packet.  This response packet may be
            significantly larger than the request packet.
            An attacker might use CoAP nodes to turn a small attack
            packet into a larger attack packet, an approach known as
            amplification.
            There is therefore a danger that CoAP nodes could become
            implicated in denial of service (DoS) attacks by using the
            amplifying properties of the protocol:  An attacker that
            is attempting to overload a victim but is
            limited in the amount of traffic it can generate, can use
            amplification to generate a larger amount of traffic.
          
</p>
<p>
            This is particularly a problem in nodes that enable NoSec
            access and that are accessible from an attacker and can
            access potential victims (e.g. on the general Internet),
            as the UDP protocol provides no way to verify the source
            address given in the request packet.  An attacker need
            only place the IP address of the victim in the source
            address of a suitable request packet to generate a larger
            packet directed at the victim.
          
</p>
<p>
            As a mitigating factor, many constrained network will only
            be able to generate a small amount of traffic, which may
            make CoAP nodes less attractive for this attack.  However,
            the limited capacity of the constrained network makes the network
            itself a likely victim of an amplification attack.
          
</p>
<p>
            A CoAP server can reduce the amount of amplification it
            provides to an attacker by using slicing/blocking modes of
            CoAP <a class='info' href='#I-D.ietf-core-block'>[I&#8209;D.ietf&#8209;core&#8209;block]<span> (</span><span class='info'>Shelby, Z. and C. Bormann, &ldquo;Blockwise transfers in CoAP,&rdquo; October&nbsp;2010.</span><span>)</span></a> and offering large resource
            representations only in relatively small slices.  E.g., for
            a 1000 byte resource, a 10-byte request might result in an
            80-byte response (with a 64-byte block) instead of a
            1016-byte response, considerably reducing the amplification
            provided.
          
</p>
<p>
            CoAP also supports the use of multicast IP addresses in
            requests, an important requirement for M2M. Multicast CoAP
            requests may be the source of accidental or deliberate
            denial of service attacks, especially over constrained
            networks. This specification attempts to reduce the
            amplification effects of multicast requests by limiting
            when a response is returned. To limit the possibility of
            malicious use, CoAP servers SHOULD NOT accept multicast
            requests that can not be authenticated.  If possible a
            CoAP server SHOULD limit the support for multicast
            requests to specific resources where the feature is
            required.
          
</p>
<p>
            On some general purpose operating systems providing a
            Posix-style API, it is not straightforward to find out
            whether a packet received was addressed to a multicast
            address.  While many implementations will know whether they have
            joined a multicast group,
            this creates a problem for packets addressed to
            multicast addresses of the form FF0x::1, which are
            received by every IPv6 node.
            Implementations SHOULD make use of modern APIs such
            as IPV6_RECVPKTINFO <a class='info' href='#RFC3542'>[RFC3542]<span> (</span><span class='info'>Stevens, W., Thomas, M., Nordmark, E., and T. Jinmei, &ldquo;Advanced Sockets Application Program Interface (API) for IPv6,&rdquo; May&nbsp;2003.</span><span>)</span></a>, if
            available, to make this determination.
          
</p>
<a name="cross-protocol-attacks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3.4"></a><h3>10.3.4.&nbsp;
Cross-Protocol Attacks</h3>

<p>The ability to incite a CoAP end-point to send packets to a fake
          source address can be used not only for amplification, but also for
          cross-protocol attacks:
</p>
<p></p>
<ul class="text">
<li>the attacker sends a message to a CoAP end point with a fake source address,
</li>
<li>the CoAP end point replies with a message to the given source address,
</li>
<li>the victim at the given source address receives a UDP packet that it
            interprets according to the rules of a different protocol.
</li>
</ul>

<p>This may be used to circumvent firewall rules that prevent direct
          communication from the attacker to the victim, but happen to allow
          communication from the CoAP end-point (which may also host a valid
          role in the other protocol) to the victim.
</p>
<p>Also, CoAP end-points may be the victim of a cross-protocol attack
          generated through an endpoint of another UDP-based protocol such as
          DNS.  In both cases, attacks are possible if the security properties of
          the end-points rely on checking IP addresses (and firewalling off
          direct attacks sent from outside using fake IP addresses).  In
          general, because of their lack of context, UDP-based protocols are
          relatively easy targets for cross-protocol attacks.
</p>
<p>Finally, CoAP URIs transported by other means could be used to incite
          clients to send messages to end-points of other protocols.
</p>
<p>One mitigation against cross-protocol attacks is strict checking of
          the syntax of packets received, combined with sufficient
          difference in syntax.  As an example, it might help if it
          were difficult to incite a DNS server to send a DNS response that
          would pass the checks of a CoAP endpoint.  Unfortunately, the first
          two bytes of a DNS reply are an ID that can be chosen by the attacker,
          which map into the interesting part of the CoAP header, and the next
          two bytes are then interpreted as CoAP's Message ID (i.e., any
          value is acceptable).  The DNS count words may be interpreted as
          multiple instances of a (non-existent, but elective) CoAP option 0.
          The echoed query finally may be manufactured by the attacker to
          achieve a desired effect on the CoAP endpoint; the response added by
          the server (if any) might then just be interpreted as added payload.
</p><br /><hr class="insert" />
<a name="dns-header"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                1  1  1  1  1  1
  0  1  2  3  4  5  6  7  8  9  0  1  2  3  4  5
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                      ID                       | T, OC, code
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|QR|   Opcode  |AA|TC|RD|RA|   Z    |   RCODE   | message id
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    QDCOUNT                    | (options 0)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ANCOUNT                    | (options 0)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    NSCOUNT                    | (options 0)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                    ARCOUNT                    | (options 0)
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: DNS Header vs. CoAP Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In general, for any pair of protocols, one of the protocols can very
          well have been designed in a way that enables an attacker to cause the
          generation of replies that look like messages of the other protocol.
          It is often much harder to ensure or prove the absence of viable
          attacks than to generate examples that may not yet completely enable
          an attack but might be further developed by more creative minds.
          Cross-protocol attacks can therefore only be completely mitigated if
          end-points don't authorize actions desired by an attacker just based
          on trusting the source IP address of a packet.  Conversely, a NoSec
          environment that completely relies on a firewall for CoAP security not
          only needs to firewall off the CoAP end-points but also all other
          end-points that might be incited to send UDP messages to CoAP
          end-points using some other UDP-based protocol.
</p>
<p>In addition to the considerations above, the security considerations
          for DTLS with respect to cross-protocol attacks apply.  E.g., if the
          same DTLS security association ("connection") is used to carry data of
          multiple protocols, DTLS no longer provides protection against
          cross-protocol attacks between these protocols.
</p>
<a name="iana-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<a name="coap-code-registry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
CoAP Code Registry</h3>

<p>This document defines a registry for the values of the Code field
        in the CoAP header. The name of the registry is "CoAP Codes".
</p>
<p>Values are as follows:
        </p>
<blockquote class="text"><dl>
<dt>0</dt>
<dd>Indicates an empty message (see <a class='info' href='#message-types'>Section&nbsp;4.3<span> (</span><span class='info'>Message Types</span><span>)</span></a>)
</dd>
<dt>1-31</dt>
<dd>Assigned by the "Method Codes" sub-registry
          (see below)
</dd>
<dt>32-63</dt>
<dd>Reserved
</dd>
<dt>64-191</dt>
<dd>Assigned by the "Response Codes" sub-registry
          (see below)
</dd>
<dt>192-255</dt>
<dd>Reserved
</dd>
</dl></blockquote><p>
        
</p>
<a name="coap-code-registry-methods"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.1"></a><h3>11.1.1.&nbsp;
Method Codes</h3>

<p>The name of the sub-registry is "CoAP Method Codes".
</p>
<p>Each entry in the sub-registry must include the Method Code
          in the range 1-31, the name of the method, and a reference to
          the method's documentation.
</p>
<p>Initial entries in this sub-registry are as follows:
</p><br /><hr class="insert" />
<a name="tab-method-code-registry"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="right"><col align="left"><col align="left">
<tr><th align="right">Code</th><th align="left">Name</th><th align="left">Reference</th></tr>
<tr>
<td align="right"> 1</td>
<td align="left">GET   </td>
<td align="left"><a class='info' href='#get'>Section&nbsp;5.8.1<span> (</span><span class='info'>GET</span><span>)</span></a>   </td>
</tr>
<tr>
<td align="right"> 2</td>
<td align="left">POST  </td>
<td align="left"><a class='info' href='#post'>Section&nbsp;5.8.2<span> (</span><span class='info'>POST</span><span>)</span></a>  </td>
</tr>
<tr>
<td align="right"> 3</td>
<td align="left">PUT   </td>
<td align="left"><a class='info' href='#put'>Section&nbsp;5.8.3<span> (</span><span class='info'>PUT</span><span>)</span></a>   </td>
</tr>
<tr>
<td align="right"> 4</td>
<td align="left">DELETE</td>
<td align="left"><a class='info' href='#delete'>Section&nbsp;5.8.4<span> (</span><span class='info'>DELETE</span><span>)</span></a></td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 5: CoAP Method Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>All other Method Codes are Unassigned.
</p>
<p>The IANA policy for future additions to this registry is
          "IETF Review" as described by <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="coap-code-registry-responses"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.2"></a><h3>11.1.2.&nbsp;
Response Codes</h3>

<p>The name of the sub-registry is "CoAP Response Codes".
</p>
<p>Each entry in the sub-registry must include the Response Code
          in the range 64-191, a description of the Response Code, and a
          reference to the Response Code's documentation.
</p>
<p>Initial entries in this sub-registry are as follows:
</p><br /><hr class="insert" />
<a name="tab-response-code-registry"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="right"><col align="left"><col align="left">
<tr><th align="right">Code</th><th align="left">Description</th><th align="left">Reference</th></tr>
<tr>
<td align="right"> 64</td>
<td align="left">2.00 OK                      </td>
<td align="left"><a class='info' href='#ok'>Section&nbsp;5.9.1.1<span> (</span><span class='info'>2.00 OK</span><span>)</span></a>                      </td>
</tr>
<tr>
<td align="right"> 65</td>
<td align="left">2.01 Created                 </td>
<td align="left"><a class='info' href='#created'>Section&nbsp;5.9.1.2<span> (</span><span class='info'>2.01 Created</span><span>)</span></a>                 </td>
</tr>
<tr>
<td align="right"> 66</td>
<td align="left">2.02 Deleted                 </td>
<td align="left"><a class='info' href='#deleted'>Section&nbsp;5.9.1.3<span> (</span><span class='info'>2.02 Deleted</span><span>)</span></a>                 </td>
</tr>
<tr>
<td align="right"> 67</td>
<td align="left">2.03 Valid                   </td>
<td align="left"><a class='info' href='#valid'>Section&nbsp;5.9.1.4<span> (</span><span class='info'>2.03 Valid</span><span>)</span></a>                   </td>
</tr>
<tr>
<td align="right"> 68</td>
<td align="left">2.04 Changed                 </td>
<td align="left"><a class='info' href='#changed'>Section&nbsp;5.9.1.5<span> (</span><span class='info'>2.04 Changed</span><span>)</span></a>                 </td>
</tr>
<tr>
<td align="right">128</td>
<td align="left">4.00 Bad Request             </td>
<td align="left"><a class='info' href='#bad-request'>Section&nbsp;5.9.2.1<span> (</span><span class='info'>4.00 Bad Request</span><span>)</span></a>             </td>
</tr>
<tr>
<td align="right">129</td>
<td align="left">4.01 Unauthorized            </td>
<td align="left"><a class='info' href='#unauthorized'>Section&nbsp;5.9.2.2<span> (</span><span class='info'>4.01 Unauthorized</span><span>)</span></a>            </td>
</tr>
<tr>
<td align="right">130</td>
<td align="left">4.02 Bad Option              </td>
<td align="left"><a class='info' href='#bad-option'>Section&nbsp;5.9.2.3<span> (</span><span class='info'>4.02 Bad Option</span><span>)</span></a>              </td>
</tr>
<tr>
<td align="right">131</td>
<td align="left">4.03 Forbidden               </td>
<td align="left"><a class='info' href='#forbidden'>Section&nbsp;5.9.2.4<span> (</span><span class='info'>4.03 Forbidden</span><span>)</span></a>               </td>
</tr>
<tr>
<td align="right">132</td>
<td align="left">4.04 Not Found               </td>
<td align="left"><a class='info' href='#not-found'>Section&nbsp;5.9.2.5<span> (</span><span class='info'>4.04 Not Found</span><span>)</span></a>               </td>
</tr>
<tr>
<td align="right">133</td>
<td align="left">4.05 Method Not Allowed      </td>
<td align="left"><a class='info' href='#method-not-allowed'>Section&nbsp;5.9.2.6<span> (</span><span class='info'>4.05 Method Not Allowed</span><span>)</span></a>      </td>
</tr>
<tr>
<td align="right">141</td>
<td align="left">4.13 Request Entity Too Large</td>
<td align="left"><a class='info' href='#request-entity-too-large'>Section&nbsp;5.9.2.7<span> (</span><span class='info'>4.13 Request Entity Too Large</span><span>)</span></a></td>
</tr>
<tr>
<td align="right">143</td>
<td align="left">4.15 Unsupported Media Type  </td>
<td align="left"><a class='info' href='#unsupported-media-type'>Section&nbsp;5.9.2.8<span> (</span><span class='info'>4.15 Unsupported Media Type</span><span>)</span></a>  </td>
</tr>
<tr>
<td align="right">160</td>
<td align="left">5.00 Internal Server Error   </td>
<td align="left"><a class='info' href='#internal-server-error'>Section&nbsp;5.9.3.1<span> (</span><span class='info'>5.00 Internal Server Error</span><span>)</span></a>   </td>
</tr>
<tr>
<td align="right">161</td>
<td align="left">5.01 Not Implemented         </td>
<td align="left"><a class='info' href='#not-implemented'>Section&nbsp;5.9.3.2<span> (</span><span class='info'>5.01 Not Implemented</span><span>)</span></a>         </td>
</tr>
<tr>
<td align="right">162</td>
<td align="left">5.02 Bad Gateway             </td>
<td align="left"><a class='info' href='#bad-gateway'>Section&nbsp;5.9.3.3<span> (</span><span class='info'>5.02 Bad Gateway</span><span>)</span></a>             </td>
</tr>
<tr>
<td align="right">163</td>
<td align="left">5.03 Service Unavailable     </td>
<td align="left"><a class='info' href='#service-unavailable'>Section&nbsp;5.9.3.4<span> (</span><span class='info'>5.03 Service Unavailable</span><span>)</span></a>     </td>
</tr>
<tr>
<td align="right">164</td>
<td align="left">5.04 Gateway Timeout         </td>
<td align="left"><a class='info' href='#gateway-timeout'>Section&nbsp;5.9.3.5<span> (</span><span class='info'>5.04 Gateway Timeout</span><span>)</span></a>         </td>
</tr>
<tr>
<td align="right">165</td>
<td align="left">5.05 Proxying Not Supported  </td>
<td align="left"><a class='info' href='#proxying-not-supported'>Section&nbsp;5.9.3.6<span> (</span><span class='info'>5.05 Proxying Not Supported</span><span>)</span></a>  </td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 6: CoAP Response Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The Response Codes 96-127 are Reserved for future use. All other
          Response Codes are Unassigned.
</p>
<p>The IANA policy for future additions to this registry is
          "IETF Review" as described by <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="option-number-registry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Option Number Registry</h3>

<p>This document defines a registry for the option numbers used in
        CoAP options. The name of the registry is "CoAP Option Numbers".
</p>
<p>Each entry in the registry must include the Option Number, the name
        of the option and a a reference to the option's documentation.
</p>
<p>Initial entries in this registry are as follows:
</p><br /><hr class="insert" />
<a name="tab-option-registry"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="right"><col align="left"><col align="left">
<tr><th align="right">Number</th><th align="left">Name</th><th align="left">Reference</th></tr>
<tr>
<td align="right"> 1</td>
<td align="left">Content-Type </td>
<td align="left"><a class='info' href='#content-type'>Section&nbsp;5.10.4<span> (</span><span class='info'>Content-Type</span><span>)</span></a> </td>
</tr>
<tr>
<td align="right"> 2</td>
<td align="left">Max-Age      </td>
<td align="left"><a class='info' href='#max-age'>Section&nbsp;5.10.5<span> (</span><span class='info'>Max-Age</span><span>)</span></a>      </td>
</tr>
<tr>
<td align="right"> 3</td>
<td align="left">Proxy-Uri    </td>
<td align="left"><a class='info' href='#proxy-uri'>Section&nbsp;5.10.3<span> (</span><span class='info'>Proxy-Uri</span><span>)</span></a>    </td>
</tr>
<tr>
<td align="right"> 4</td>
<td align="left">Etag         </td>
<td align="left"><a class='info' href='#etag'>Section&nbsp;5.10.6<span> (</span><span class='info'>Etag</span><span>)</span></a>         </td>
</tr>
<tr>
<td align="right"> 5</td>
<td align="left">Uri-Host     </td>
<td align="left"><a class='info' href='#uri-options'>Section&nbsp;5.10.2<span> (</span><span class='info'>Uri-Host, Uri-Port, Uri-Path and Uri-Query</span><span>)</span></a>  </td>
</tr>
<tr>
<td align="right"> 6</td>
<td align="left">Location-Path</td>
<td align="left"><a class='info' href='#location-path'>Section&nbsp;5.10.7<span> (</span><span class='info'>Location-Path</span><span>)</span></a></td>
</tr>
<tr>
<td align="right"> 7</td>
<td align="left">Uri-Port     </td>
<td align="left"><a class='info' href='#uri-options'>Section&nbsp;5.10.2<span> (</span><span class='info'>Uri-Host, Uri-Port, Uri-Path and Uri-Query</span><span>)</span></a>  </td>
</tr>
<tr>
<td align="right"> 9</td>
<td align="left">Uri-Path     </td>
<td align="left"><a class='info' href='#uri-options'>Section&nbsp;5.10.2<span> (</span><span class='info'>Uri-Host, Uri-Port, Uri-Path and Uri-Query</span><span>)</span></a>  </td>
</tr>
<tr>
<td align="right">11</td>
<td align="left">Token        </td>
<td align="left"><a class='info' href='#token'>Section&nbsp;5.10.1<span> (</span><span class='info'>Token</span><span>)</span></a>        </td>
</tr>
<tr>
<td align="right">15</td>
<td align="left">Uri-Query    </td>
<td align="left"><a class='info' href='#uri-options'>Section&nbsp;5.10.2<span> (</span><span class='info'>Uri-Host, Uri-Port, Uri-Path and Uri-Query</span><span>)</span></a>  </td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 7: CoAP Option Numbers&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The Option Numbers 0 and 8 are Reserved for future use. The
        Option Numbers 14, 28, 42, ... are Reserved for "fenceposting"
        (see <a class='info' href='#option-format'>Section&nbsp;3.2<span> (</span><span class='info'>Option Format</span><span>)</span></a>). All other Option Numbers
        are Unassigned.
</p>
<p>The IANA policy for future additions to this registry is
        "IETF Review" as described by <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="media-type-registry"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
Media Type Registry</h3>

<p>Media types are identified by a string, such as "application/xml"
        <a class='info' href='#RFC2046'>[RFC2046]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types,&rdquo; November&nbsp;1996.</span><span>)</span></a>. In order to minimize the overhead of
        using these media types to indicate the format of payloads, this
        document defines a registry for a subset of Internet media types to
        be used in CoAP and assigns each a numeric identifier. The name of
        the registry is "CoAP Media Types".
</p>
<p>Each entry in the registry must include the media type registered
        with IANA, the numeric identifier in the range 0-65535 to be used for
        that media type in CoAP, and a reference to a document describing what
        payload with that media types means semantically.
</p>
<p>Initial entries in this registry are as follows:
</p><br /><hr class="insert" />
<a name="tab-mediatype"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="right"><col align="left">
<tr><th align="left">Media type</th><th align="right">Id.</th><th align="left">Reference</th></tr>
<tr>
<td align="left">text/plain; charset=utf-8</td>
<td align="right"> 0</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">text/xml; charset=utf-8</td>
<td align="right"> 1</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">text/csv; charset=utf-8</td>
<td align="right"> 2</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">text/html; charset=utf-8</td>
<td align="right"> 3</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/link-format</td>
<td align="right">40</td>
<td align="left"><a class='info' href='#I-D.ietf-core-link-format'>[I&#8209;D.ietf&#8209;core&#8209;link&#8209;format]<span> (</span><span class='info'>Shelby, Z., &ldquo;CoRE Link Format,&rdquo; December&nbsp;2010.</span><span>)</span></a></td>
</tr>
<tr>
<td align="left">application/xml</td>
<td align="right">41</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/octet-stream</td>
<td align="right">42</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/rdf+xml</td>
<td align="right">43</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/soap+xml</td>
<td align="right">44</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/atom+xml</td>
<td align="right">45</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/xmpp+xml</td>
<td align="right">46</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/exi</td>
<td align="right">47</td>
<td align="left"><a class='info' href='#EXIMIME'>[EXIMIME]<span> (</span><span class='info'>, &ldquo;Efficient XML Interchange (EXI) Format 1.0,&rdquo; December&nbsp;2009.</span><span>)</span></a>                  </td>
</tr>
<tr>
<td align="left">application/fastinfoset</td>
<td align="right">48</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/soap+fastinfoset</td>
<td align="right">49</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/json</td>
<td align="right">50</td>
<td align="left">                                          </td>
</tr>
<tr>
<td align="left">application/x-obix-binary</td>
<td align="right">51</td>
<td align="left"><a class='info' href='#OBIX1.1'>[OBIX1.1]<span> (</span><span class='info'>, &ldquo;OBIX Version 1.1,&rdquo; June&nbsp;2010.</span><span>)</span></a>                  </td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 8: CoAP Media Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The identifiers between 201 and 255 inclusive are reserved for
        Private Use. The identifiers between 256 and 65535 inclusive are
        Reserved for future use. All other identifiers are Unassigned.
</p>
<p>Because the name space is so small, the IANA policy for future
        additions to this registry is "Expert Review" as described by
        <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<p>
        In machine to machine applications, it is not expected that generic Internet
        media types such as text/plain, application/xml or application/octet-stream
        are useful for real applications. It is recommended that M2M applications making use of
        CoAP will request new Internet media types from IANA indicating semantic
        information about how to create or parse a payload. Correct examples from
        <a class='info' href='#tab-mediatype'>Table&nbsp;8<span> (</span><span class='info'>CoAP Media Types</span><span>)</span></a> include application/link-format, application/atom+xml
        and application/x-obix-binary. For example, a Smart Energy
        application payload carried as XML would request a more specific type like
        application/se+xml or application/se+exi.
        
</p>
<a name="uri-scheme-registration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.4"></a><h3>11.4.&nbsp;
URI Scheme Registration</h3>

<p>This document requests the registration of the Uniform Resource
        Identifier (URI) scheme "coap". The registration request complies with
        <a class='info' href='#RFC4395'>[RFC4395]<span> (</span><span class='info'>Hansen, T., Hardie, T., and L. Masinter, &ldquo;Guidelines and Registration Procedures for New URI Schemes,&rdquo; February&nbsp;2006.</span><span>)</span></a>.
        </p>
<blockquote class="text"><dl>
<dt>URI scheme name.</dt>
<dd>
          coap
</dd>
<dt>Status.</dt>
<dd>
          Provisional.
</dd>
<dt>URI scheme syntax.</dt>
<dd>
          Defined in <a class='info' href='#uri-syntax'>Section&nbsp;6.1<span> (</span><span class='info'>URI Scheme Syntax</span><span>)</span></a>.
</dd>
<dt>URI scheme semantics.</dt>
<dd>
          The "coap" URI scheme provides a way to identify resources that are
          potentially accessible over the Constrained Application Protocol
          (CoAP). This scheme can thus be compared to the "http" URI scheme
          <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>. See <a class='info' href='#uri'>Section&nbsp;6<span> (</span><span class='info'>CoAP URIs</span><span>)</span></a> for the details
          of operation.
</dd>
<dt>Encoding considerations.</dt>
<dd>
          The scheme encoding conforms to the encoding rules established for
          URIs in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</dd>
<dt>Applications/protocols that use this URI scheme name.</dt>
<dd>
          
          The scheme is used by CoAP end-points to access CoAP resources.
</dd>
<dt>Interoperability considerations.</dt>
<dd>
          None.
</dd>
<dt>Security considerations.</dt>
<dd>
          See "Security considerations" section above.
</dd>
<dt>Contact.</dt>
<dd>
          Zach Shelby &lt;zach@sensinode.com&gt;
</dd>
<dt>Author/Change controller.</dt>
<dd>
          Zach Shelby &lt;zach@sensinode.com&gt;
</dd>
<dt>References.</dt>
<dd>
          This document.
</dd>
</dl></blockquote><p>
        
</p>
<a name="port-registration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.5"></a><h3>11.5.&nbsp;
Service Name and Port Number Registration</h3>

<p>One of the functions of CoAP is resource discovery: A CoAP
        client can ask a CoAP server about the resources offered by it
        (see <a class='info' href='#discovery'>Section&nbsp;7.1<span> (</span><span class='info'>Resource Discovery</span><span>)</span></a>). To enable resource discovery
        just based on the knowledge of an IP address, the CoAP port for
        resource discovery needs to be standardized.
</p>
<p>This document requests the assignment of the port number 5683
        and the service name "coap", in accordance with
        <a class='info' href='#I-D.ietf-tsvwg-iana-ports'>[I&#8209;D.ietf&#8209;tsvwg&#8209;iana&#8209;ports]<span> (</span><span class='info'>Cotton, M., Eggert, L., Touch, J., Westerlund, M., and S. Cheshire, &ldquo;Internet Assigned Numbers Authority (IANA) Procedures for the Management of the Service Name and Transport Protocol Port Number Registry,&rdquo; December&nbsp;2010.</span><span>)</span></a>.
</p>
<p>Besides unicast, CoAP can be used with both multicast and anycast.
        </p>
<blockquote class="text"><dl>
<dt>Service Name.</dt>
<dd>
          coap
</dd>
<dt>Transport Protocol.</dt>
<dd>
          UDP
</dd>
<dt>Assignee.</dt>
<dd>
          IETF &lt;iesg@ietf.org&gt;
</dd>
<dt>Contact.</dt>
<dd>
          IESG &lt;iesg@ietf.org&gt;
</dd>
<dt>Description.</dt>
<dd>
          Constrained Application Protocol (CoAP)
</dd>
<dt>Reference.</dt>
<dd>
          This document.
</dd>
<dt>Port Number.</dt>
<dd>
          5683
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgements</h3>

<p>Special thanks to Peter Bigot and Cullen Jennings
      for substantial contributions to the ideas and text in the document, along
      with countless detailed reviews and discussions.
</p>
<p>Thanks to Michael Stuber, Richard Kelsey, Guido
      Moritz, Peter Van Der Stok, Adriano Pezzuto, Lisa Dussealt, Alexey
      Melnikov, Gilbert Clark, Salvatore Loreto, Petri Mutka, Szymon Sasin,
      Robert Quattlebaum, Robert Cragie, Angelo Castellani, Tom Herbst, Ed
      Beroset, Gilman Tolle, Robby Simpson, Colin O'Flynn, Eric Rescorla, 
      Matthieu Vial, Linyi Tian, Kerry Lynn, Dale Seed, Akbar Rahman and
      David Ryan for helpful comments and discussions that have shaped the
      document.
</p>
<p>Some of the text has been
      lifted from the working documents of the IETF httpbis working group.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2046">[RFC2046]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2046">Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types</a>,&rdquo; RFC&nbsp;2046, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2046.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3602">[RFC3602]</a></td>
<td class="author-text">Frankel, S., Glenn, R., and S. Kelly, &ldquo;<a href="http://tools.ietf.org/html/rfc3602">The AES-CBC Cipher Algorithm and Its Use with IPsec</a>,&rdquo; RFC&nbsp;3602, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3602.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3629">[RFC3629]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4279">[RFC4279]</a></td>
<td class="author-text">Eronen, P. and H. Tschofenig, &ldquo;<a href="http://tools.ietf.org/html/rfc4279">Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</a>,&rdquo; RFC&nbsp;4279, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4279.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[RFC4303]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4309">[RFC4309]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4309">Using Advanced Encryption Standard (AES) CCM Mode with IPsec Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4309, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4309.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4347">[RFC4347]</a></td>
<td class="author-text">Rescorla, E. and N. Modadugu, &ldquo;<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>,&rdquo; RFC&nbsp;4347, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4347.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4395">[RFC4395]</a></td>
<td class="author-text">Hansen, T., Hardie, T., and L. Masinter, &ldquo;<a href="http://tools.ietf.org/html/rfc4395">Guidelines and Registration Procedures for New URI Schemes</a>,&rdquo; BCP&nbsp;35, RFC&nbsp;4395, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4395.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4648">[RFC4648]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, October&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4648.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4835">[RFC4835]</a></td>
<td class="author-text">Manral, V., &ldquo;<a href="http://tools.ietf.org/html/rfc4835">Cryptographic Algorithm Implementation Requirements for Encapsulating Security Payload (ESP) and Authentication Header (AH)</a>,&rdquo; RFC&nbsp;4835, April&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4835.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5198">[RFC5198]</a></td>
<td class="author-text">Klensin, J. and M. Padlipsky, &ldquo;<a href="http://tools.ietf.org/html/rfc5198">Unicode Format for Network Interchange</a>,&rdquo; RFC&nbsp;5198, March&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5198.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5389.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5952">[RFC5952]</a></td>
<td class="author-text">Kawamura, S. and M. Kawashima, &ldquo;<a href="http://tools.ietf.org/html/rfc5952">A Recommendation for IPv6 Address Text Representation</a>,&rdquo; RFC&nbsp;5952, August&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5952.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5996">[RFC5996]</a></td>
<td class="author-text">Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;<a href="http://tools.ietf.org/html/rfc5996">Internet Key Exchange Protocol Version 2 (IKEv2)</a>,&rdquo; RFC&nbsp;5996, September&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5996.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC6066">[RFC6066]</a></td>
<td class="author-text">Eastlake, D., &ldquo;<a href="http://tools.ietf.org/html/rfc6066">Transport Layer Security (TLS) Extensions: Extension Definitions</a>,&rdquo; RFC&nbsp;6066, January&nbsp;2011 (<a href="http://www.rfc-editor.org/rfc/rfc6066.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="EUI64">[EUI64]</a></td>
<td class="author-text">&ldquo;<a href="http://standards.ieee.org/regauth/oui/tutorials/EUI64.html">GUIDELINES FOR 64-BIT GLOBAL IDENTIFIER (EUI-64) REGISTRATION AUTHORITY</a>,&rdquo; April&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="EXIMIME">[EXIMIME]</a></td>
<td class="author-text">&ldquo;<a href="http://www.w3.org/TR/2009/CR-exi-20091208/#mediaTypeRegistration">Efficient XML Interchange (EXI) Format 1.0</a>,&rdquo; December&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.eggert-core-congestion-control">[I-D.eggert-core-congestion-control]</a></td>
<td class="author-text">Eggert, L., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-eggert-core-congestion-control-00.txt">Congestion Control for the Constrained Application Protocol (CoAP)</a>,&rdquo; draft-eggert-core-congestion-control-00 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-eggert-core-congestion-control-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-core-block">[I-D.ietf-core-block]</a></td>
<td class="author-text">Shelby, Z. and C. Bormann, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-block-00.txt">Blockwise transfers in CoAP</a>,&rdquo; draft-ietf-core-block-00 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-block-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-core-link-format">[I-D.ietf-core-link-format]</a></td>
<td class="author-text">Shelby, Z., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-link-format-02.txt">CoRE Link Format</a>,&rdquo; draft-ietf-core-link-format-02 (work in progress), December&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-link-format-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tls-rfc4347-bis">[I-D.ietf-tls-rfc4347-bis]</a></td>
<td class="author-text">Rescorla, E. and N. Modadugu, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tls-rfc4347-bis-04.txt">Datagram Transport Layer Security version 1.2</a>,&rdquo; draft-ietf-tls-rfc4347-bis-04 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tls-rfc4347-bis-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-iana-ports">[I-D.ietf-tsvwg-iana-ports]</a></td>
<td class="author-text">Cotton, M., Eggert, L., Touch, J., Westerlund, M., and S. Cheshire, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-iana-ports-09.txt">Internet Assigned Numbers Authority (IANA) Procedures for the Management of the Service Name and Transport Protocol Port Number Registry</a>,&rdquo; draft-ietf-tsvwg-iana-ports-09 (work in progress), December&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-iana-ports-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.mcgrew-tls-aes-ccm">[I-D.mcgrew-tls-aes-ccm]</a></td>
<td class="author-text">McGrew, D. and D. Bailey, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-tls-aes-ccm-00.txt">AES-CCM Cipher Suites for TLS</a>,&rdquo; draft-mcgrew-tls-aes-ccm-00 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-tls-aes-ccm-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.mcgrew-tls-aes-ccm-ecc">[I-D.mcgrew-tls-aes-ccm-ecc]</a></td>
<td class="author-text">McGrew, D., Bailey, D., Campagna, M., and R. Dugal, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-tls-aes-ccm-ecc-01.txt">AES-CCM ECC Cipher Suites for TLS</a>,&rdquo; draft-mcgrew-tls-aes-ccm-ecc-01 (work in progress), January&nbsp;2011 (<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-tls-aes-ccm-ecc-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.oflynn-core-bootstrapping">[I-D.oflynn-core-bootstrapping]</a></td>
<td class="author-text">Sarikaya, B., Ohba, Y., Cao, Z., and R. Cragie, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-oflynn-core-bootstrapping-02.txt">Security Bootstrapping of Resource-Constrained Devices</a>,&rdquo; draft-oflynn-core-bootstrapping-02 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-oflynn-core-bootstrapping-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="OBIX1.1">[OBIX1.1]</a></td>
<td class="author-text">&ldquo;<a href="http://www.oasis-open.org/committees/download.php/38212/oBIX-1-1-spec-wd06.pdf">OBIX Version 1.1</a>,&rdquo; June&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3264">[RFC3264]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;3264, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3264.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3542">[RFC3542]</a></td>
<td class="author-text">Stevens, W., Thomas, M., Nordmark, E., and T. Jinmei, &ldquo;<a href="http://tools.ietf.org/html/rfc3542">Advanced Sockets Application Program Interface (API) for IPv6</a>,&rdquo; RFC&nbsp;3542, May&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3542.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3920">[RFC3920]</a></td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">Saint-Andre, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3920.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3920.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3920.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4944">[RFC4944]</a></td>
<td class="author-text">Montenegro, G., Kushalnagar, N., Hui, J., and D. Culler, &ldquo;<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>,&rdquo; RFC&nbsp;4944, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4944.txt">TXT</a>).</td></tr>
</table>

<a name="integer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Integer Option Value Format</h3>

<p>Options of type uint contain a non-negative integer that is represented
      in network byte order using a variable number of bytes, as shown in
      <a class='info' href='#fig-integer'>Figure&nbsp;11<span> (</span><span class='info'>Variable-length unsigned integer format</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="fig-integer"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Length = 0     (implies value of 0)

                0
                0 1 2 3 4 5 6 7
               +-+-+-+-+-+-+-+-+
Length = 1     |     0-255     |
               +-+-+-+-+-+-+-+-+

                0                   1
                0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
Length = 2     |            0-65535            |
               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Length = 3 is 24 bits, Length = 4 is 32 bits etc.
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: Variable-length unsigned integer format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Examples</h3>

<p>This section gives a number of short examples with message flows
      for GET requests. These examples demonstrate the basic operation, the
      operation in the presence of retransmissions, and multicast.
</p>
<p><a class='info' href='#fig-example-1'>Figure&nbsp;12<span> (</span><span class='info'>Confirmable request; Immediate response</span><span>)</span></a> shows a basic GET
      request causing an immediate response: The client sends a Confirmable
      GET request for the resource coap://server/temperature to the server
      with a Message ID of 0x7d34. The request includes one Uri-Path Option
      (Delta 0 + 9 = 9, Length 11, Value "temperature"); the Token is
      left at its default value (empty). This request is a total of 16
      bytes long. A 2.00 (OK) response is returned in the Acknowledgement
      message that acknowledges the Confirmable request, echoing both the
      Message ID 0x7d34 and the (implicitly empty) Token value. The response
      includes a Payload of "22.3 C" and is 10 bytes long.
</p><br /><hr class="insert" />
<a name="fig-example-1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d34] GET /temperature [] --------------------&gt;|
  |                                                          |
  |&lt;-------------------- ACK [0x7d34] 2.00 OK [] "22.3 C" ---+
  |                                                          |


 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 0 |   2   |     GET=1     |          MID=0x7d34           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   9   |  11   |      "temperature" (11 B) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 2 |   1   |    2.00=64    |          MID=0x7d34           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      "22.3 C" (6 B) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: Confirmable request; Immediate response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
<a class='info' href='#fig-example-1a'>Figure&nbsp;13<span> (</span><span class='info'>Confirmable request; Immediate response</span><span>)</span></a> shows a similar example, but with the
inclusion of an explicit Token option (Delta 9 + 2 = 11, Length 1,
Value 0x20) in the request and (Delta 11 + 0 = 11) in the response,
increasing the sizes to 18 and 12 bytes, respectively.

</p><br /><hr class="insert" />
<a name="fig-example-1a"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d34] GET /temperature [0x20] ----------------&gt;|
  |                                                          |
  |&lt;---------------- ACK [0x7d34] 2.00 OK [0x20] "22.3 C" ---+
  |                                                          |


 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 0 |   2   |     GET=1     |          MID=0x7d34           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   9   |  11   |      "temperature" (11 B) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   2   |   1   |     0x20      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| 1 | 2 |   1   |    2.00=64    |          MID=0x7d34           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  11   |   1   |     0x20      |      "22.3 C" (6 B) ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Confirmable request; Immediate response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In <a class='info' href='#fig-example-2'>Figure&nbsp;14<span> (</span><span class='info'>Confirmable request (retransmitted); Immediate response</span><span>)</span></a>, the
      Confirmable GET request is lost. After RESPONSE_TIMEOUT seconds,
      the client retransmits the request, resulting in an immediate response
      as in the previous example.
</p><br /><hr class="insert" />
<a name="fig-example-2"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d35] GET /temperature [0x31] -----X           |
  |                                                          |
  : TIMEOUT                                                  :
  |                                                          |
  +--- CON [0x7d35] GET /temperature [0x31] ----------------&gt;|
  |                                                          |
  |&lt;---------------- ACK [0x7d35] 2.00 OK [0x31] "22.3 C" ---+
  |                                                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Confirmable request (retransmitted); Immediate response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In <a class='info' href='#fig-example-3'>Figure&nbsp;15<span> (</span><span class='info'>Confirmable request; Immediate response (retransmitted)</span><span>)</span></a>, the first
      Acknowledgement message from the server to the client is lost. After
      RESPONSE_TIMEOUT seconds, the client retransmits the request.
</p><br /><hr class="insert" />
<a name="fig-example-3"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d36] GET /temperature [0x42] ----------------&gt;|
  |                                                          |
  |           X----- ACK [0x7d36] 2.00 OK [0x42] "22.3 C" ---+
  |                                                          |
  : TIMEOUT                                                  :
  |                                                          |
  +--- CON [0x7d36] GET /temperature [0x42] ----------------&gt;|
  |                                                          |
  |&lt;---------------- ACK [0x7d36] 2.00 OK [0x42] "22.3 C" ---+
  |                                                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;15: Confirmable request; Immediate response (retransmitted)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In <a class='info' href='#fig-example-4'>Figure&nbsp;16<span> (</span><span class='info'>Confirmable request; Deferred response</span><span>)</span></a>, the server
      acknowledges the Confirmable request and sends a 2.00 (OK) response
      separately in a Confirmable message. Note that the Acknowledgement
      message and the Confirmable response do not necessarily arrive in the same
      order as they were sent. The client acknowledges the Confirmable
      response.
</p><br /><hr class="insert" />
<a name="fig-example-4"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d36] GET /temperature [0x53] ----------------&gt;|
  |                                                          |
  |&lt;---------------------------------------- ACK [0x7d36] ---+
  |                                                          |
  |&lt;---------------- CON [0xad7b] 2.00 OK [0x53] "22.3 C" ---+
  |                                                          |
  +--- ACK [0xad7b] ----------------------------------------&gt;|
  |                                                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;16: Confirmable request; Deferred response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p><a class='info' href='#fig-example-5'>Figure&nbsp;17<span> (</span><span class='info'>Confirmable request; Deferred response (unexpected)</span><span>)</span></a> shows an example
      where the client loses its state (e.g., crashes and is rebooted) right after
      sending a Confirmable request,
      so the deferred response arriving some time later comes unexpected. In
      this case, the client rejects the Confirmable response with a Reset
      message.  Note that the unexpected ACK is silently ignored.
</p><br /><hr class="insert" />
<a name="fig-example-5"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- CON [0x7d37] GET /temperature [0x64] ----------------&gt;|
XXXXX                                                        |
  |&lt;---------------------------------------- ACK [0x7d37] ---+
  |                                                          |
  |&lt;---------------- CON [0xad7c] 2.00 OK [0x64] "22.3 C" ---+
  |                                                          |
  +--- RST [0xad7c] ----------------------------------------&gt;|
  |                                                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;17: Confirmable request; Deferred response (unexpected)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p><a class='info' href='#fig-example-6'>Figure&nbsp;18<span> (</span><span class='info'>Non-confirmable request; Non-confirmable response</span><span>)</span></a> shows a basic GET
      request where the request and the response are non-confirmable, so both may
      be lost without notice.
</p><br /><hr class="insert" />
<a name="fig-example-6"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                                     SERVER
  |                                                          |
  +--- NON [0x7d38] GET /temperature [0x75] ----------------&gt;|
  |                                                          |
  |&lt;---------------- NON [0xad7d] 2.00 OK [0x75] "22.3 C" ---+
  |                                                          |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;18: Non-confirmable request; Non-confirmable response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>In <a class='info' href='#fig-example-7'>Figure&nbsp;19<span> (</span><span class='info'>Non-confirmable request (multicast); Non-confirmable response</span><span>)</span></a>, the client
      sends a Non-confirmable GET request to a multicast address: all nodes
      in link-local scope. There are 3 servers on the link: A, B and C.
      Servers A and B have a matching resource, therefore they send back a
      Non-confirmable 2.00 (OK) response. The response sent by B is lost.
      C does not have matching response, therefore it sends a Non-confirmable
      4.04 (Not Found) response.
</p><br /><hr class="insert" />
<a name="fig-example-7"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
CLIENT                                           ff02::1  A  B  C
  |                                                 |     |  |  |
  +--- NON [0x7d39] GET /temperature [0x86] -------&gt;|     |  |  |
  |                                                       |  |  |
  |&lt;------------- NON [0x60b1] 2.00 OK [0x86] "22.3 C" ---+  |  |
  |                                                       |  |  |
  |           X----- NON [0x01a0] 2.00 OK [0x86] "20.9 C" ---+  |
  |                                                       |  |  |
  |&lt;------------------ NON [0x952a] 4.04 Not Found [0x86] ------+
  |                                                       |  |  |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;19: Non-confirmable request (multicast); Non-confirmable response&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="uri-examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
URI Examples</h3>

<p>The following examples demonstrate different sets of Uri options, and
      the result after constructing an URI from them.
      </p>
<ul class="text">
<li>coap://[2001:db8::2:1]/
        
<blockquote class="text">
<p>Destination IP Address = [2001:db8::2:1]
</p>
<p>Destination UDP Port = 5683
</p>
</blockquote>
        
</li>
<li>coap://example.net/
        
<blockquote class="text">
<p>Destination IP Address = [2001:db8::2:1]
</p>
<p>Destination UDP Port = 5683
</p>
<p>Uri-Host = "example.net"
</p>
</blockquote>
        
</li>
<li>coap://example.net/.well-known/core
        
<blockquote class="text">
<p>Destination IP Address = [2001:db8::2:1]
</p>
<p>Destination UDP Port = 5683
</p>
<p>Uri-Host = "example.net"
</p>
<p>Uri-Path = ".well-known"
</p>
<p>Uri-Path = "core"
</p>
</blockquote>
        
</li>
<li>coap://xn--18j4d.example/%E3%81%93%E3%82%93%E3%81%AB%E3%81%A1%E3%81%AF
        
<blockquote class="text">
<p>Destination IP Address = [2001:db8::2:1]
</p>
<p>Destination UDP Port = 5683
</p>
<p>Uri-Host = "xn--18j4d.example"
</p>
<p>Uri-Path = the string composed of the Unicode characters
          U+3053 U+3093 U+306b U+3061 U+306f, usually represented in UTF-8 as
          E38193E38293E381ABE381A1E381AF hexadecimal
</p>
</blockquote>
        
</li>
<li>coap://198.51.100.1:61616//%2F//?%2F%2F
        
<blockquote class="text">
<p>Destination IP Address = 198.51.100.1
</p>
<p>Destination UDP Port = 61616
</p>
<p>Uri-Path = ""
</p>
<p>Uri-Path = "/"
</p>
<p>Uri-Path = ""
</p>
<p>Uri-Path = ""
</p>
<p>Uri-Query = "%2F%2F"
</p>
</blockquote>
        
</li>
<li>coap://[2001:db8::2:1]/sensors/temp
        
<blockquote class="text">
<p>Destination IP Address = [::1]
</p>
<p>Destination UDP Port = 61616
</p>
<p>Uri-Host = "[2001:db8::2:1]"
</p>
<p>Uri-Port = 5683
</p>
<p>Uri-Path = "sensors"
</p>
<p>Uri-Path = "temp"
</p>
</blockquote>
        
</li>
</ul><p>
      
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Changelog</h3>

<p>Changes from ietf-03 to ietf-04: </p>
<blockquote class="text">
<p>o Major document reorganization (#51, #63, #71, #81).
</p>
<p>o Max-age length set to 0-4 bytes (#30).
</p>
<p>o Added variable unsigned integer definition (#31).
</p>
<p>o Clarification made on human readable error payloads (#50).
</p>
<p>o Definition of POST improved (#52).
</p>
<p>o Token length changed to 0-8 bytes (#53).
</p>
<p>o Section added on multiplexing CoAP, DTLS and STUN (#56).
</p>
<p>o Added cross-protocol attack considerations (#61).
</p>
<p>o Used new Immediate/Deferred response definitions (#73).
</p>
<p>o Improved request/response matching rules (#74).
</p>
<p>o Removed unnecessary media types and added recommendations for their use in M2M (#76).
</p>
<p>o Response codes changed to base 32 coding, new Y.XX naming (#77).
</p>
<p>o References updated as per AD review (#79).
</p>
<p>o IANA section completed (#80).
</p>
<p>o Proxy-Uri option added to diambiguate between proxy and non-proxy requests (#82).
</p>
<p>o Added text on critical options in cached states (#83).
</p>
<p>o HTTP mapping sections improved (#88).
</p>
<p>o Added text on reverse proxies (#72).
</p>
<p>o Some security text on multicast added (#54).
</p>
<p>o Trust model text added to introduction (#58, #60).
</p>
<p>o AES-CCM vs. AES-CCB text added (#55).
</p>
<p>o Text added about device capabilities (#59).
</p>
<p>o DTLS section improvements (#87).
</p>
<p>o Caching semantics aligned with RFC2616 (#78).
</p>
<p>o Uri-Path option split into multiple path segments.
</p>
<p>o MAX_RETRANSMIT changed to 4 to adjust for RESPONSE_TIME = 2.
</p>
</blockquote>

<p>Changes from ietf-02 to ietf-03: </p>
<blockquote class="text">
<p>o Token Option and related use in asynchronous requests added (#25). 
</p>
<p>o CoAP specific error codes added (#26).
</p>
<p>o Erroring out on unknown critical options changed to a MUST (#27).
</p>
<p>o Uri-Query option added. 
</p>
<p>o Terminology and definitions of URIs improved. 
</p>
<p>o Security section completed (#22).
</p>
</blockquote>

<p>Changes from ietf-01 to ietf-02: </p>
<blockquote class="text">
<p>o Sending an error on a critical option clarified (#18).
</p>
<p>o Clarification on behavior of PUT and idempotent operations
          (#19).
</p>
<p>o Use of Uri-Authority clarified along with server processing
          rules. Uri-Scheme option removed. (#20, #23)
</p>
<p>o Resource discovery section removed to a separate CoRE Link
          Format draft (#21)
</p>
<p>o Initial security section outline added.
</p>
</blockquote>

<p>Changes from ietf-00 to ietf-01: </p>
<blockquote class="text">
<p>o New cleaner transaction message model and header (#5)
</p>
<p>o Removed subscription while being designed (#1)
</p>
<p>o Section 2 re-written (#3)
</p>
<p>o Text added about use of short URIs (#4)
</p>
<p>o Improved header option scheme (#5, #14)
</p>
<p>o Date option removed whiled being designed (#6)
</p>
<p>o New text for CoAP default port (#7)
</p>
<p>o Completed proxying section (#8)
</p>
<p>o Completed resource discovery section (#9)
</p>
<p>o Completed HTTP mapping section (#10)
</p>
<p>o Several new examples added (#11)
</p>
<p>o URI split into 3 options (#12)
</p>
<p>o MIME type defined for link-format (#13, #16)
</p>
<p>o New text on maximum message size (#15)
</p>
<p>o Location Option added
</p>
</blockquote>

<p>Changes from shelby-01 to ietf-00: </p>
<blockquote class="text">
<p>o Removed the TCP binding section, left open for the future.
</p>
<p>o Fixed a bug in the example.
</p>
<p>o Marked current Sub/Notify as (Experimental) while under WG
          discussion.
</p>
<p>o Fixed maximum datagram size to 1280 for both IPv4 and IPv6 (for
          CoAP-CoAP proxying to work).
</p>
<p>o Temporarily removed the Magic Byte header as TCP is no longer
          included as a binding.
</p>
<p>o Removed the Uri-code Option as different URI encoding schemes
          are being discussed.
</p>
<p>o Changed the rel= field to desc= for resource discovery.
</p>
<p>o Changed the maximum message size to 1024 bytes to allow for
          IP/UDP headers.
</p>
<p>o Made the URI slash optimization and method impotence MUSTs
</p>
<p>o Minor editing and bug fixing.
</p>
</blockquote>

<p>Changes from shelby-00 to shelby-01: </p>
<blockquote class="text">
<p>o Unified the message header and added a notify message type.
</p>
<p>o Renamed methods with HTTP names and removed the NOTIFY
          method.
</p>
<p>o Added a number of options field to the header.
</p>
<p>o Combines the Option Type and Length into an 8-bit field.
</p>
<p>o Added the magic byte header.
</p>
<p>o Added new Etag option.
</p>
<p>o Added new Date option.
</p>
<p>o Added new Subscription option.
</p>
<p>o Completed the HTTP Code - CoAP Code mapping table appendix.
</p>
<p>o Completed the Content-type Identifier appendix and tables.
</p>
<p>o Added more simplifications for URI support.
</p>
<p>o Initial subscription and discovery sections.
</p>
<p>o A Flag requirements simplified.
</p>
</blockquote>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zach Shelby</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sensinode</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kidekuja 2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vuokatti  88600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358407796297</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:zach@sensinode.com">zach@sensinode.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Klaus Hartke</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universitaet Bremen TZI</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Postfach 330440</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bremen  D-28359</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49-421-218-63905</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+49-421-218-7000</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hartke@tzi.org">hartke@tzi.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Carsten Bormann</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universitaet Bremen TZI</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Postfach 330440</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bremen  D-28359</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49-421-218-63921</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+49-421-218-7000</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cabo@tzi.org">cabo@tzi.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Frank</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">SkyFoundry</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Richmond, VA  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian@skyfoundry.com">brian@skyfoundry.com</a></td></tr>
</table>
</body></html>
