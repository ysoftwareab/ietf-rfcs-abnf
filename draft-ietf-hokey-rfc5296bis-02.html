<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>EAP Extensions for EAP Re-authentication Protocol (ERP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 ERP Description">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 ERP With the Home ER Server">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 ERP with a Local ER Server">
<link href="#rfc.section.4" rel="Chapter" title="4 ER Key Hierarchy">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 rRK Derivation">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 rRK Properties">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 rIK Derivation">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 rIK Properties">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 rIK Usage">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 rMSK Derivation">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 rMSK Properties">
<link href="#rfc.section.5" rel="Chapter" title="5 Protocol Details">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 ERP Bootstrapping">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Steps in ERP">
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Multiple Simultaneous Runs of ERP">
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 ERP Failure Handling">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 New EAP Packets">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 EAP-Initiate/Re-auth-Start Packet">
<link href="#rfc.section.5.3.1.1" rel="Chapter" title="5.3.1.1 Authenticator Operation">
<link href="#rfc.section.5.3.1.2" rel="Chapter" title="5.3.1.2 Peer Operation">
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 EAP-Initiate/Re-auth Packet">
<link href="#rfc.section.5.3.3" rel="Chapter" title="5.3.3 EAP-Finish/Re-auth Packet">
<link href="#rfc.section.5.3.4" rel="Chapter" title="5.3.4 TV and TLV Attributes">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Replay Protection">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Channel Binding">
<link href="#rfc.section.6" rel="Chapter" title="6 Lower-Layer Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Transport of ERP Messages">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Change Log">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 draft-ietf-hokey-rfc5296bis-02">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgments">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 RFC 5296">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 RFC 5296bis">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Example ERP Exchange">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods. In systems where EAP is used for authentication, it is desirable to not repeat the entire EAP exchange with another authenticator. This document specifies extensions to EAP and the EAP keying hierarchy to support an EAP method-independent protocol for efficient re-authentication between the peer and an EAP re-authentication server through any authenticator. The re-authentication server may be in the home network or in the local network to which the peer is connecting." />
  <meta name="description" content="The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods. In systems where EAP is used for authentication, it is desirable to not repeat the entire EAP exchange with another authenticator. This document specifies extensions to EAP and the EAP keying hierarchy to support an EAP method-independent protocol for efficient re-authentication between the peer and an EAP re-authentication server through any authenticator. The re-authentication server may be in the home network or in the local network to which the peer is connecting." />
  <meta name="keywords" content="EAP keying, EMSK, re-authentication, inter-authenticator roaming" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">Q. Wu, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Huawei</td>
</tr>
<tr>
<td class="left">Obsoletes: 5296 (if approved)</td>
<td class="right">Z. Cao</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">China Mobile</td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right">Y. Shi</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">H3C</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">B. He</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">CATR</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">EAP Extensions for EAP Re-authentication Protocol (ERP)<br />
  <span class="filename">draft-ietf-hokey-rfc5296bis-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods. In systems where EAP is used for authentication, it is desirable to not repeat the entire EAP exchange with another authenticator. This document specifies extensions to EAP and the EAP keying hierarchy to support an EAP method-independent protocol for efficient re-authentication between the peer and an EAP re-authentication server through any authenticator. The re-authentication server may be in the home network or in the local network to which the peer is connecting.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">ERP Description</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">ERP With the Home ER Server</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">ERP with a Local ER Server</a>
</li>
<li>4.   <a href="#rfc.section.4">ER Key Hierarchy</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">rRK Derivation</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">rRK Properties</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">rIK Derivation</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">rIK Properties</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">rIK Usage</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">rMSK Derivation</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">rMSK Properties</a>
</li>
<li>5.   <a href="#rfc.section.5">Protocol Details</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">ERP Bootstrapping</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Steps in ERP</a>
</li>
<li>5.2.1.   <a href="#rfc.section.5.2.1">Multiple Simultaneous Runs of ERP</a>
</li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">ERP Failure Handling</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">New EAP Packets</a>
</li>
<li>5.3.1.   <a href="#rfc.section.5.3.1">EAP-Initiate/Re-auth-Start Packet</a>
</li>
<li>5.3.1.1.   <a href="#rfc.section.5.3.1.1">Authenticator Operation</a>
</li>
<li>5.3.1.2.   <a href="#rfc.section.5.3.1.2">Peer Operation</a>
</li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">EAP-Initiate/Re-auth Packet</a>
</li>
<li>5.3.3.   <a href="#rfc.section.5.3.3">EAP-Finish/Re-auth Packet</a>
</li>
<li>5.3.4.   <a href="#rfc.section.5.3.4">TV and TLV Attributes</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Replay Protection</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Channel Binding</a>
</li>
<li>6.   <a href="#rfc.section.6">Lower-Layer Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Transport of ERP Messages</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Change Log</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">draft-ietf-hokey-rfc5296bis-02</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgments</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">RFC 5296</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">RFC 5296bis</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Example ERP Exchange</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Extensible Authentication Protocol (EAP) is a an authentication framework that supports multiple authentication methods. The primary purpose is network access authentication, and a key-generating method is used when the lower layer wants to enforce access control. The EAP keying hierarchy defines two keys to be derived by all key-generating EAP methods: the Master Session Key (MSK) and the Extended MSK (EMSK).  In the most common deployment scenario, an EAP peer and an EAP server authenticate each other through a third party known as the EAP authenticator. The EAP authenticator or an entity controlled by the EAP authenticator enforces access control. After successful authentication, the EAP server transports the MSK to the EAP authenticator; the EAP authenticator and the EAP peer establish transient session keys (TSKs) using the MSK as the authentication key, key derivation key, or a key transport key, and use the TSK for per-packet access enforcement.</p>
<p id="rfc.section.1.p.2">When a peer moves from one authenticator to another, it is desirable to avoid a full EAP authentication to support fast handovers. The full EAP exchange with another run of the EAP method can take several round trips and significant time to complete, causing delays in handover times. Some EAP methods specify the use of state from the initial authentication to optimize re-authentications by reducing the computational overhead, but method-specific re-authentication takes at least 2 round trips with the original EAP server in most cases (e.g., <a href="#RFC4187">[RFC4187]</a>). It is also important to note that several methods do not offer support for re-authentication.</p>
<p id="rfc.section.1.p.3">Key sharing across authenticators is sometimes used as a practical solution to lower handover times. In that case, compromise of an authenticator results in compromise of keying material established via other authenticators. Other solutions for fast re-authentication exist in the literature <a href="#MSKHierarchy">[MSKHierarchy]</a>.</p>
<p id="rfc.section.1.p.4">In conclusion, to achieve low latency handovers, there is a need for a method-independent re-authentication protocol that completes in less than 2 round trips, preferably with a local server. The EAP re-authentication problem statement is described in detail in <a href="#RFC5169">[RFC5169]</a>.</p>
<p id="rfc.section.1.p.5">This document specifies EAP Re-authentication Extensions (ERXs) for efficient re-authentication using EAP. The protocol that uses these extensions is itself referred to as the EAP Re-authentication Protocol (ERP). It supports EAP method-independent re-authentication for a peer that has valid, unexpired key material from a previously performed EAP authentication. The protocol and the key hierarchy required for EAP re-authentication are described in this document.</p>
<p id="rfc.section.1.p.6">Note that to support ERP, lower-layer specifications may need to be revised to allow carrying EAP messages that have a code value higher than 4 and to accommodate the peer-initiated nature of ERP.  Specifically, the IEEE802.1x specification <a href="#IEEE_802.1X">[IEEE_802.1X]</a> must be revised and RFC 5996 <a href="#RFC5996">[RFC5996]</a> must be updated to carry ERP messages.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">This document uses the basic EAP terminology <a href="#RFC3748">[RFC3748]</a> and EMSK keying hierarchy terminology <a href="#RFC5295">[RFC5295]</a>. In addition, this document uses the following terms:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">ER Peer - An EAP peer that supports the EAP Re-authentication Protocol. All references to "peer" in this document imply an ER peer, unless specifically noted otherwise.</dd>
<dt></dt>
<dd style="margin-left: 8">ER Authenticator - An entity that supports the authenticator functionality for EAP re-authentication described in this document.  All references to "authenticator" in this document imply an ER authenticator, unless specifically noted otherwise.</dd>
<dt></dt>
<dd style="margin-left: 8">ER Server - An entity that performs the server portion of ERP described here. This entity may or may not be an EAP server. All references to "server" in this document imply an ER server, unless specifically noted otherwise. An ER server is a logical entity; it may not necessarily be co-located with, or physically part of, a full EAP server.</dd>
<dt></dt>
<dd style="margin-left: 8">ERX - EAP re-authentication extensions.</dd>
<dt></dt>
<dd style="margin-left: 8">ERP - EAP Re-authentication Protocol that uses the re-authentication extensions.</dd>
<dt></dt>
<dd style="margin-left: 8">rRK - re-authentication Root Key, derived from the EMSK or DSRK.</dd>
<dt></dt>
<dd style="margin-left: 8">rIK - re-authentication Integrity Key, derived from the rRK.</dd>
<dt></dt>
<dd style="margin-left: 8">rMSK - re-authentication MSK. This is a per-authenticator key, derived from the rRK.</dd>
<dt></dt>
<dd style="margin-left: 8">keyName-NAI - ERP messages are integrity protected with the rIK or the DS-rIK. The use of rIK or DS-rIK for integrity protection of ERP messages is indicated by the EMSKname <a href="#RFC5295">[RFC5295]</a>; the protocol, which is ERP; and the realm, which indicates the domain name of the ER server. The EMSKname is copied into the username part of the NAI.</dd>
<dt></dt>
<dd style="margin-left: 8">Domain - Refers to a "key management domain" as defined in <a href="#RFC5295">[RFC5295]</a>. For simplicity, it is referred to as "domain" in this document. The terms "home domain" and "local domain" are used to differentiate between the originating key management domain that performs the full EAP exchange with the peer and the local domain to which a peer may be attached at a given time.</dd>
</dl>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#overview" id="overview">ERP Description</a>
</h1>
<p id="rfc.section.3.p.1">ERP allows a peer and server to mutually verify proof of possession of keying material from an earlier EAP method run and to establish a security association between the peer and the authenticator. The authenticator acts as a pass-through entity for the Re-authentication Protocol in a manner similar to that of an EAP authenticator described in RFC 3748 <a href="#RFC3748">[RFC3748]</a>. ERP is a single round-trip exchange between the peer and the server; it is independent of the lower layer and the EAP method used during the full EAP exchange. The ER server may be in the home domain or in the same (visited) domain as the peer and the authenticator (i.e.,local domain).</p>
<p><a href="#erp_fig">Figure 2</a> shows the protocol exchange. The first time the peer attaches to any network, it performs a full EAP exchange (shown in <a href="#eap_fig">Figure 1</a>) with the EAP server; as a result, an MSK is distributed to the EAP authenticator. The MSK is then used by the authenticator and the peer to establish TSKs as needed. At the time of the initial EAP exchange, the peer and the server also derive an EMSK, which is used to derive a re-authentication Root Key (rRK). More precisely, a re-authentication Root Key is derived from the EMSK or from a Domain-Specific Root Key (DSRK), which is itself derived from the EMSK. The rRK is only available to the peer and the ER server and is never handed out to any other entity. Further, a re-authentication Integrity Key (rIK) is derived from the rRK; the peer and the ER server use the rIK to provide proof of possession while performing an ERP exchange. The rIK is also never handed out to any entity and is only available to the peer and server.</p>
<div id="#rfc.figure.1"></div>
<div id="#eap_fig"></div>
<pre>
EAP Peer           EAP Authenticator                 EAP Server
========           =================                 ==========

 &lt;--- EAP-Request/ ------
         Identity

 ----- EAP Response/ ---&gt;
         Identity          ---AAA(EAP Response/Identity)--&gt;

 &lt;--- EAP Method -------&gt;  &lt;------ AAA(EAP Method --------&gt;
        exchange                    exchange)

                           &lt;----AAA(MSK, EAP-Success)------
                        
 &lt;---EAP-Success---------
   
                        </pre>
<p></p>
<div id="#rfc.figure.2"></div>
<div id="#erp_fig"></div>
<pre>

Peer             ER Authenticator                   ER Server
====               =============                      ======

  &lt;-- EAP-Initiate/ -----
     Re-auth-Start 
 [&lt;-- EAP-Request/ ------
     Identity]


 ---- EAP-Initiate/ ----&gt; ----AAA(EAP-Initiate/ ----------&gt;
       Re-auth/                  Re-auth/        
      [Bootstrap]              [Bootstrap])       

 &lt;--- EAP-Finish/ ------&gt; &lt;---AAA(rMSK,EAP-Finish/--------- 
       Re-auth/                   Re-auth/       
     [Bootstrap]                [Bootstrap])
                        
Note: [] brackets indicate optionality.
                            
                        </pre>
<p></p>
<p id="rfc.section.3.p.5">Two new EAP codes, EAP-Initiate and EAP-Finish, are specified in this document for the purpose of EAP re-authentication. When the peer identifies a target authenticator that supports EAP re-authentication, it performs an ERP exchange, as shown in <a href="#erp_fig">Figure 2</a>; the exchange itself may happen when the peer attaches to a new authenticator supporting EAP re-authentication, or prior to attachment.  The peer initiates ERP by itself; it may also do so in response to an EAP-Initiate/Re-auth-Start message from the new authenticator. The EAP-Initiate/Re-auth-Start message allows the authenticator to trigger the ERP exchange. The EAP-Finish message also can be used by the authenticator to announce local domain name.</p>
<p id="rfc.section.3.p.6">It is plausible that the authenticator does not know whether the peer supports ERP and whether the peer has performed a full EAP authentication through another authenticator. The authenticator MAY initiate the ERP exchange by sending the EAP-Initiate/Re-auth-Start message, and if there is no response, it will send the EAP-Request/Identity message. Note that this avoids having two EAP messages in flight at the same time <a href="#RFC3748">[RFC3748]</a>. The authenticator may send the EAP-Initiate/Re-auth-Start message and wait for a short, locally configured amount of time. If the peer does not already know, this message indicates to the peer that the authenticator supports ERP. In response to this trigger from the authenticator, the peer can initiate the ERP exchange by sending an EAP-Initiate/Re-auth message. If there is no response from the peer after the necessary retransmissions (see <a href="#lowerlayer">Section 6</a>), the authenticator MUST initiate EAP by sending an EAP-Request message, typically the EAP-Request/Identity message. Note that the authenticator may receive an EAP-Initiate/Re-auth message after it has sent an EAP-Request/Identity message. If the authenticator supports ERP, it MUST proceed with the ERP exchange. When the EAP-Request/Identity times out, the authenticator MUST NOT close the connection if an ERP exchange is in progress or has already succeeded in establishing a re-authentication MSK.</p>
<p id="rfc.section.3.p.7">If the authenticator does not support ERP, it drops EAP-Initiate/Re-auth messages <a href="#RFC3748">[RFC3748]</a> as the EAP code of those packets is greater than 4. An ERP-capable peer will exhaust the EAP-Initiate/Re-auth message retransmissions and fall back to EAP authentication by responding to EAP Request/Identity messages from the authenticator. If the peer does not support ERP or if it does not have unexpired key material from a previous EAP authentication, it drops EAP-Initiate/Re-auth-Start messages. If there is no response to the EAP-Initiate/Re-auth-Start message, the authenticator SHALL send an EAP Request message (typically EAP Request/Identity) to start EAP authentication. From this stage onwards, RFC 3748 rules apply. Note that this may introduce some delay in starting EAP. In some lower layers, the delay can be minimized or even avoided by the peer initiating EAP by sending messages such as EAPoL-Start in the IEEE 802.1X specification <a href="#IEEE_802.1X">[IEEE_802.1X]</a>.</p>
<p id="rfc.section.3.p.8">The peer sends an EAP-Initiate/Re-auth message that contains the keyName-NAI to identify the ER server's domain and the rIK used to protect the message, and a sequence number for replay protection. The EAP-Initiate/Re-auth message is integrity protected with the rIK. The authenticator uses the realm in the keyName-NAI <a href="#RFC4282">[RFC4282]</a> field to send the message to the appropriate ER server. The server uses the keyName to look up the rIK. The server, after verifying proof of possession of the rIK, and freshness of the message, derives a re-authentication MSK (rMSK) from the rRK using the sequence number as an input to the key derivation. The server updates the expected sequence number to the received sequence number plus one.</p>
<p id="rfc.section.3.p.9">In response to the EAP-Initiate/Re-auth message, the server sends an EAP-Finish/Re-auth message; this message is integrity protected with the rIK. The server transports the rMSK along with this message to the authenticator. The rMSK is transported in a manner similar to that of the MSK along with the EAP-Success message in a full EAP exchange.  Ongoing work in <a href="#RFC5749">[RFC5749]</a> describes an additional key distribution protocol that can be used to transport the rRK from an EAP server to one of many different ER servers that share a trust relationship with the EAP server.</p>
<p id="rfc.section.3.p.10">The peer MAY request the server for the rMSK lifetime. If so, the ER server sends the rMSK lifetime in the EAP-Finish/Re-auth message.</p>
<p id="rfc.section.3.p.11">In an ERP bootstrap exchange, the peer MAY request the server for the rRK lifetime. If so, the ER server sends the rRK lifetime in the EAP-Finish/Re-auth message.</p>
<p id="rfc.section.3.p.12">The peer verifies the replay protection and the integrity of the message. It then uses the sequence number in the EAP-Finish/Re-auth message to compute the rMSK. The lower-layer security association protocol is ready to be triggered after this point.</p>
<p id="rfc.section.3.p.13">When the ER server is in the home domain, the peer and the server use the rIK and rRK derived from the EMSK; and when the ER server is in the local domain, they use the DS-rIK and DS-rRK corresponding to the local domain. The domain of the ER server is identified by the realm portion of the keyname-NAI in ERP messages.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> ERP With the Home ER Server</h1>
<p id="rfc.section.3.1.p.1">If the peer is in the home domain and does not know the domain name ( did not receive the domain name through the EAP-Initiate/Re-auth-Start message or via the lower-layer announcement, due to a missed announcement or lack of support for domain name announcements in a specific lower layer) or there is no the local server in the same domain as the peer, it SHOULD initiate ERP bootstrap exchange with the home ER server to obtain the domain name.</p>
<p id="rfc.section.3.1.p.2">The defined ER extensions allow executing the ERP with an ER server in the home domain. The home ER server may be co- located with a home AAA server. The ERP with the Home ER Server is the similar as ERP exchange described in <a href="#erp_fig">Figure 2</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#home_erp_fig"></div>
<pre>

Peer             ER Authenticator                   Home ER Server
====               =============                      ======

  &lt;-- EAP-Initiate/ -----
     Re-auth-Start 
 [&lt;-- EAP-Request/ ------
     Identity]


 ---- EAP-Initiate/ ----&gt; ----AAA(EAP-Initiate/ ----------&gt;
       Re-auth/                  Re-auth/        
      [Bootstrap]              [Bootstrap])       

 &lt;--- EAP-Finish/ ------&gt; &lt;---AAA(rMSK,EAP-Finish/--------- 
       Re-auth/                   Re-auth/       
     [Bootstrap]                [Bootstrap])
                        
Note: [] brackets indicate optionality.
                            
                        </pre>
<p></p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#local_er" id="local_er">ERP with a Local ER Server</a>
</h1>
<p id="rfc.section.3.2.p.1">The defined ER extensions allow executing the ERP with an ER server in the local domain (access network) if the peer moves out of home domain. The local ER server may be co-located with a local AAA server.  The peer may learn about the presence of a local ER server in the network and the local domain name (or ER server name) either via the lower layer or by means of ERP exchange. The peer uses the domain name and the EMSK to compute the DSRK and from that key, the DS-rRK; the peer also uses the domain name in the realm portion of the keyName-NAI for using ERP in the local domain. <a href="#local_erp_fig_init">Figure 4</a> shows the ER Implicit bootstrapping exchange through local ER Server;<a href="#local_erp_fig">Figure 5</a>shows ERP with a local ER server.</p>
<div id="#rfc.figure.4"></div>
<div id="#local_erp_fig_init"></div>
<pre>
Peer         EAP Authenticator     Local AAA Agent     Home EAP Server
              /ER Authenticator    /Local ER Server
====         =================     ===============     ===============

&lt;-- EAP-Request/ --
     Identity

-- EAP Response/--&gt;
     Identity      --AAA(EAP Response/--&gt;
                         Identity,       --AAA(EAP Response/ --&gt;
                     [domain name])             Identity,
                                             [DSRK Request, 
                                           domain name])

&lt;------------------------ EAP Method exchange------------------&gt;

                                         &lt;---AAA(MSK, DSRK, ----
                                                EMSKname,
                                              EAP-Success)

                    &lt;---  AAA(MSK,  -----
                         EAP-Success)

&lt;---EAP-Success-----
                            
                            
                        </pre>
<p></p>
<div id="#rfc.figure.5"></div>
<div id="#local_erp_fig"></div>
<pre>

Peer                ER Authenticator            Local ER Server
====                ================            ===============
 
 &lt;-- EAP-Initiate/ --------
     Re-auth-Start 
[&lt;-- EAP-Request/ ---------
     Identity]


 ---- EAP-Initiate/ -------&gt; ----AAA(EAP-Initiate/ --------&gt;
       Re-auth                        Re-auth)        

 
 &lt;--- EAP-Finish/ ---------- &lt;---AAA(rMSK,EAP-Finish/------- 
       Re-auth                        Re-auth)




                        </pre>
<p></p>
<p id="rfc.section.3.2.p.4">As shown in <a href="#local_erp_fig_init">Figure 4</a>, the local ER server may be present in the path of the full EAP exchange (e.g., this may be one of the AAA entities, such as AAA proxies, in the path between the EAP authenticator and the home EAP server of the peer). In that case, the local ER server requests the DSRK by sending the domain name to the home EAP server through AAA message. In response, the home EAP server computes the DSRK by following the procedure specified in <a href="#RFC5295">[RFC5295]</a> and sends the DSRK and the key name, EMSKname, to the ER server in the claimed domain (i.e., local ER Server). The local domain is responsible for announcing that same domain name via the lower layer to the peer, e.g., DHCP based local domain name discovery specified in <a href="#I-D.ietf-hokey-ldn-discovery">[I-D.ietf-hokey-ldn-discovery]</a>, or through the EAP-Initiate/Re-auth-Start message during subsequent ERP with local ER server.</p>
<p id="rfc.section.3.2.p.5">After receiving the DSRK and the EMSKname, the local ER server computes the DS-rRK and the DS-rIK from the DSRK as defined in Sections <a href="#rRKderv">4.1</a> and <a href="#rIKderv">4.3</a> below. After receiving the domain name, the peer also derives the DSRK, the DS-rRK, and the DS-rIK. These keys are referred to by a keyName-NAI formed as follows: the username part of the NAI is the EMSKname, the realm portion of the NAI is the domain name. Both parties also maintain a sequence number (initialized to zero) corresponding to the specific keyName-NAI.</p>
<p id="rfc.section.3.2.p.6">Subsequently, when the peer attaches to an authenticator within the local domain, it may perform an ERP exchange with the local ER server to obtain an rMSK for the new authenticator. The ERP with the local ER Server is the similar as ERP exchange described in <a href="#erp_fig">Figure 2</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#eap_er_kh" id="eap_er_kh">ER Key Hierarchy</a>
</h1>
<p id="rfc.section.4.p.1">Each time the peer re-authenticates to the network, the peer and the authenticator establish an rMSK. The rMSK serves the same purposes that an MSK, which is the result of full EAP authentication, serves. To prove possession of the rRK, we specify the derivation of another key, the rIK. These keys are derived from the rRK. Together they constitute the ER key hierarchy.</p>
<p id="rfc.section.4.p.2">The rRK is derived from either the EMSK or a DSRK as specified in <a href="#rRKderv">Section 4.1</a>. For the purpose of rRK derivation, this document specifies derivation of a Usage-Specific Root Key (USRK) or a Domain-Specific USRK (DSUSRK) in accordance with <a href="#RFC5295">[RFC5295]</a> for re-authentication. The USRK designated for re-authentication is the re-authentication root key (rRK). A DSUSRK designated for re-authentication is the DS-rRK available to a local ER server in a particular domain. For simplicity, the keys are referred to without the DS label in the rest of the document. However, the scope of the various keys is limited to just the respective domains they are derived for, in the case of the domain specific keys. Based on the ER server with which the peer performs the ERP exchange, it knows the corresponding keys that must be used.</p>
<div id="#rfc.figure.6"></div>
<div id="#rRK_fig"></div>
<pre>
                         rRK
                          |
                 +--------+--------+
                 |        |        |
                rIK     rMSK1 ...rMSKn
                    </pre>
<p id="rfc.section.4.p.3">The rRK is used to derive an rIK, and rMSKs for one or more authenticators. The figure below shows the key hierarchy with the rRK, rIK, and rMSKs. </p>
<p id="rfc.section.4.p.4">The derivations in this document are according to <a href="#RFC5295">[RFC5295]</a>. Key derivations and field encodings, where unspecified, default to that document.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#rRKderv" id="rRKderv">rRK Derivation</a>
</h1>
<p id="rfc.section.4.1.p.1">The rRK may be derived from the EMSK or DSRK. This section provides the relevant key derivations for that purpose.</p>
<p id="rfc.section.4.1.p.2">The rRK is derived as specified in <a href="#RFC5295">[RFC5295]</a>.</p>
<p id="rfc.section.4.1.p.3">rRK = KDF (K, S), where</p>

<ul class="empty">
<li>K = EMSK or K = DSRK and</li>
<li>S = rRK Label | "\0" | length</li>
</ul>
<p id="rfc.section.4.1.p.4">The rRK Label is an IANA-assigned 8-bit ASCII string: <a href="#RFC5295">[RFC5295]</a>.</p>

<ul class="empty"><li>EAP Re-authentication Root Key@ietf.org</li></ul>

<p> assigned from the "USRK key labels" name space in accordance with </p>
<p id="rfc.section.4.1.p.5">The KDF and algorithm agility for the KDF are as defined in <a href="#RFC5295">[RFC5295]</a>.</p>
<p id="rfc.section.4.1.p.6">An rRK derived from the DSRK is referred to as a DS-rRK in the rest of the document. All the key derivation and properties specified in this section remain the same.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> rRK Properties</h1>
<p id="rfc.section.4.2.p.1">The rRK has the following properties. These properties apply to the rRK regardless of the parent key used to derive it. </p>

<ul>
<li>The length of the rRK MUST be equal to the length of the parent key used to derive it.</li>
<li>The rRK is to be used only as a root key for re-authentication and never used to directly protect any data.</li>
<li>The rRK is only used for derivation of rIK and rMSK as specified in this document.</li>
<li>The rRK MUST remain on the peer and the server that derived it and MUST NOT be transported to any other entity.</li>
<li>The lifetime of the rRK is never greater than that of its parent key. The rRK is expired when the parent key expires and MUST be removed from use at that time.</li>
</ul>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#rIKderv" id="rIKderv">rIK Derivation</a>
</h1>
<p id="rfc.section.4.3.p.1">The re-authentication Integrity Key (rIK) is used for integrity protecting the ERP exchange. This serves as the proof of possession of valid keying material from a previous full EAP exchange by the peer to the server.</p>
<p id="rfc.section.4.3.p.2">The rIK is derived as follows.</p>
<p id="rfc.section.4.3.p.3">rIK = KDF (K, S), where</p>

<ul class="empty">
<li>K = rRK and</li>
<li>S = rIK Label | "\0" | cryptosuite | length</li>
</ul>
<p id="rfc.section.4.3.p.4">The rIK Label is the 8-bit ASCII string: <a href="#RFC5295">[RFC5295]</a>.</p>

<ul class="empty"><li>Re-authentication Integrity Key@ietf.org</li></ul>

<p> The length field refers to the length of the rIK in octets encoded as specified in </p>
<p id="rfc.section.4.3.p.5">The cryptosuite and length of the rIK are part of the input to the key derivation function to ensure cryptographic separation of keys if different rIKs of different lengths for use with different Message Authentication Code (MAC) algorithms are derived from the same rRK.  The cryptosuite is encoded as an 8-bit number; see <a href="#ReauthInit">Section 5.3.2</a> for the cryptosuite specification.</p>
<p id="rfc.section.4.3.p.6">The rIK is referred to by EMSKname-NAI within the context of ERP messages. The username part of EMSKname-NAI is the EMSKname; the realm is the domain name of the ER server. In case of ERP with the home ER server, the peer uses the realm from its original NAI; in case of a local ER server, the peer uses the domain name received at the lower layer or through an ERP bootstrapping exchange.</p>
<p id="rfc.section.4.3.p.7">An rIK derived from a DS-rRK is referred to as a DS-rIK in the rest of the document. All the key derivation and properties specified in this section remain the same.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> rIK Properties</h1>
<p id="rfc.section.4.4.p.1">The rIK has the following properties. </p>

<ul>
<li>The length of the rIK MUST be equal to the length of the rRK.</li>
<li>The rIK is only used for authentication of the ERP exchange as specified in this document.</li>
<li>The rIK MUST NOT be used to derive any other keys.</li>
<li>The rIK must remain on the peer and the server and MUST NOT be transported to any other entity.</li>
<li>The rIK is cryptographically separate from any other keys derived from the rRK.</li>
<li>The lifetime of the rIK is never greater than that of its parent key. The rIK MUST be expired when the EMSK expires and MUST be removed from use at that time.</li>
</ul>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> rIK Usage</h1>
<p id="rfc.section.4.5.p.1">The rIK is the key whose possession is demonstrated by the peer and the ERP server to the other party. The peer demonstrates possession of the rIK by computing the integrity checksum over the EAP-Initiate/Re-auth message. When the peer uses the rIK for the first time, it can choose the integrity algorithm to use with the rIK. The peer and the server MUST use the same integrity algorithm with a given rIK for all ERP messages protected with that key. The peer and the server store the algorithm information after the first use, and they employ the same algorithm for all subsequent uses of that rIK.</p>
<p id="rfc.section.4.5.p.2">If the server's policy does not allow the use of the cryptosuite selected by the peer, the server SHALL reject the EAP-Initiate/Re-auth message and SHOULD send a list of acceptable cryptosuites in the EAP-Finish/Re-auth message.</p>
<p id="rfc.section.4.5.p.3">The rIK length may be different from the key length required by an integrity algorithm. In case of hash-based MAC algorithms, the key is first hashed to the required key length as specified in <a href="#RFC2104">[RFC2104]</a>. In case of cipher-based MAC algorithms, if the required key length is less than 32 octets, the rIK is hashed using HMAC-SHA256 and the first k octets of the output are used, where k is the key length required by the algorithm. If the required key length is more than 32 octets, the first k octets of the rIK are used by the cipher-based MAC algorithm.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> rMSK Derivation</h1>
<p id="rfc.section.4.6.p.1">The rMSK is derived at the peer and server and delivered to the authenticator. The rMSK is derived following an EAP Re-auth Protocol exchange.</p>
<p id="rfc.section.4.6.p.2">The rMSK is derived as follows.</p>
<p id="rfc.section.4.6.p.3">rMSK = KDF (K, S), where</p>

<ul class="empty">
<li>K = rRK and</li>
<li>S = rMSK label | "\0" | SEQ | length</li>
</ul>
<p id="rfc.section.4.6.p.4">The rMSK label is the 8-bit ASCII string: <a href="#RFC5295">[RFC5295]</a>.</p>

<ul class="empty"><li>Re-authentication Master Session Key@ietf.org</li></ul>

<p> The length field refers to the length of the rMSK in octets.  The length field is encoded as specified in </p>
<p id="rfc.section.4.6.p.5">SEQ is the sequence number sent by the peer in the EAP-Initiate/Re-auth message. This field is encoded as a 16-bit number in network byte order (see <a href="#ReauthInit">Section 5.3.2</a>).</p>
<p id="rfc.section.4.6.p.6">An rMSK derived from a DS-rRK is referred to as a DS-rIK in the rest of the document. All the key derivation and properties specified in this section remain the same.</p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> rMSK Properties</h1>
<p id="rfc.section.4.7.p.1">The rMSK has the following properties: </p>

<ul>
<li>The length of the rMSK MUST be equal to the length of the rRK.</li>
<li>The rMSK is delivered to the authenticator and is used for the same purposes that an MSK is used at an authenticator.</li>
<li>The rMSK is cryptographically separate from any other keys derived from the rRK.</li>
<li>The lifetime of the rMSK is less than or equal to that of the rRK. It MUST NOT be greater than the lifetime of the rRK.</li>
<li>If a new rRK is derived, subsequent rMSKs MUST be derived from the new rRK. Previously delivered rMSKs MAY still be used until the expiry of the lifetime.</li>
<li>A given rMSK MUST NOT be shared by multiple authenticators.</li>
</ul>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Protocol Details</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#ERP-boot" id="ERP-boot">ERP Bootstrapping</a>
</h1>
<p id="rfc.section.5.1.p.1">We identify two types of bootstrapping for ERP: explicit and implicit bootstrapping. In implicit bootstrapping, if the local AAA client or Agent do not have the keying material(e.g., rMSK or rRK) corresponding to the peer, the local AAA client or agent supporting EAP re-authentication SHOULD include its domain name and SHOULD request the DSRK from the home AAA server during the initial EAP exchange, in the AAA message encapsulating the first EAP Response message sent by the peer. If such EAP exchange is successful, the home EAP server sends the DSRK for the specified local AAA client or agent (derived using the EMSK and the domain name as specified in <a href="#RFC5295">[RFC5295]</a>), EMSKname, and DSRK lifetime along with the EAP-Success message. The local AAA client or agent MUST extract the DSRK, EMSKname, and DSRK lifetime (if present) before forwarding the EAP-Success message to the peer, as specified in <a href="#I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a>. Note that the MSK (also present along with the EAP Success message) is extracted by the EAP authenticator as usual. The peer learns the domain name through the EAP-Initiate/Re-auth-Start message, lower-layer announcements <a href="#I-D.ietf-hokey-ldn-discovery">[I-D.ietf-hokey-ldn-discovery]</a> . When the domain name is available to the peer during or after the full EAP authentication, it attempts to use ERP when it associates with a new authenticator.</p>
<p id="rfc.section.5.1.p.2">If the peer does not know the domain name (did not receive the domain name through the EAP-Initiate/Re-auth-Start message or via the lower-layer announcement, due to a missed announcement or lack of support for domain name announcements in a specific lower layer), it SHOULD initiate Explicit ERP bootstrapping (ERP exchange with the bootstrap flag turned on) with the ER server to obtain the local domain name. The peer MAY also initiate bootstrapping to fetch information such as the rRK lifetime from the AAA server.</p>
<p id="rfc.section.5.1.p.3">The following steps describe the ERP Explicit Bootstrapping process: </p>

<ul>
<li>The peer sends the EAP-Initiate/Re-auth message with the bootstrapping flag turned on. The bootstrap message is always sent to the ER server, and the keyname-NAI attribute in the bootstrap message is constructed as follows: the username portion of the NAI contains the EMSKname, and the realm portion contains the home domain name.</li>
<li>In addition, the message MUST contain a sequence number for replay protection, a cryptosuite, and an integrity checksum. The cryptosuite indicates the authentication algorithm. The integrity checksum indicates that the message originated at the claimed entity, the peer indicated by the Peer-ID, or the rIKname.</li>
<li>The peer MAY additionally set the lifetime flag to request the key lifetimes.</li>
<li>When an ERP-capable authenticator receives the EAP-Initiate/Re-auth message from a peer, it copies the contents of the keyName-NAI into the User-Name attribute of RADIUS <a href="#RFC2865">[RFC2865]</a> and may include its domain name in the AAA message encapsulating the EAP-Initiate/Re-auth message sent by the peer. The rest of the process is similar to that described in <a href="#RFC3579">[RFC3579]</a>.</li>
<li>If a local ER server is present, the local ER server MUST verify whether it has DSRK corresponding to the peer. If the local ER server has the key materials corresponding to the peer, it MUST be able to respond directly in the same way as the home ER server does described in the following step without forwarding the ERP message to the home domain, even if this message contains the 'B' (bootstrapping) flag. Otherwise, the local ER server MUST include the DSRK request and its domain name in the AAA message encapsulating the EAP-Initiate/Re-auth message sent by the peer.  </li>
<li>Upon receipt of an EAP-Initiate/Re-auth message, the home ER server verifies whether the message is fresh or is a replay by evaluating whether the received sequence number is equal to or greater than the expected sequence number for that rIK. The home ER server then verifies to ensure that the cryptosuite used by the peer is acceptable. Next, it verifies the origin authentication of the message by looking up the rIK. If any of the checks fail, the home ER server sends an EAP-Finish/Re-auth message with the Result flag set to '1'. Please refer to <a href="#fail">Section 5.2.2</a> for details on failure handling. This error MUST NOT have any correlation to any EAP-Success message that may have been received by the EAP authenticator and the peer earlier. If the EAP-Initiate/Re-auth message is well-formed and valid, the server prepares the EAP-Finish/Re-auth message. The bootstrap flag MUST be set to indicate that this is a bootstrapping exchange. The message contains the following fields: <ul>
<li>A sequence number for replay protection.</li>
<li>The same keyName-NAI as in the EAP-Initiate/Re-auth message.</li>
<li>If the lifetime flag was set in the EAP-Initiate/Re-auth message, the ER server SHOULD include the rRK lifetime and the rMSK lifetime in the EAP-Finish/Re-auth message. The server may have a local policy for the network to maintain and enforce lifetime unilaterally. In such cases, the server need not respond to the peer's request for the lifetime.</li>
<li>If the bootstrap flag is set, the ER server MUST include the domain name to which the DSRK is being sent along with the EAP-Finish/Re-auth message.</li>
<li>If the ER server verifies the authorization of a local ER server, it MAY include the Authorization Indication TLV to indicate to the peer that the server (that received the DSRK and that is advertising the domain included in the domain name TLV) is authorized.</li>
<li>An authentication tag MUST be included to prove that the EAP-Finish/Re-auth message originates at a server that possesses the rIK corresponding to the EMSKname-NAI.</li>
</ul>
</li>
<li>If the home ER server gets involved in ERP exchange and the ERP exchange is successful, the home ER server SHOULD request the DSRK from the home EAP server during this ERP Explicit Bootstrapping as specified in <a href="#I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a>, the home EAP server MUST include the DSRK for the local ER server (derived using the EMSK and the domain name as specified in <a href="#RFC5295">[RFC5295]</a>), EMSKname, and DSRK lifetime along with the EAP-Finish/Re-auth message.</li>
<li>In addition, the rMSK is sent along with the EAP-Finish/Re-auth message, in a AAA attribute <a href="#I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a>.</li>
<li>The local ER server MUST extract the DSRK, EMSKname, and DSRK lifetime (if present) before forwarding the EAP-Success message to the peer, as specified in <a href="#I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a>.</li>
<li>The authenticator receives the rMSK.</li>
<li>When the peer receives an EAP-Finish/Re-auth message with the bootstrap flag set, if a local domain name is present, it MUST use that to derive the appropriate DSRK, DS-rRK, DS-rIK, and keyName-NAI, and initialize the replay counter for the DS-rIK. If not, the peer SHOULD derive the domain-specific keys using the domain name it learned via the lower layer or from the EAP-Initiate/Re-auth-Start message. If the peer does not know the domain name, it must assume that there is no local ER server available.</li>
<li>The peer MAY also verify the Authorization Indication TLV.</li>
<li>The procedures for encapsulating the ERP and obtaining relevant keys using Diameter are specified in <a href="#I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a>.</li>
</ul>
<p id="rfc.section.5.1.p.4">Since the ER bootstrapping exchange is typically done immediately following the full EAP exchange, it is feasible that the process is completed through the same entity that served as the EAP authenticator for the full EAP exchange. In this case, the lower layer may already have established TSKs based on the MSK received earlier. The lower layer may then choose to ignore the rMSK that was received with the ER bootstrapping exchange. Alternatively, the lower layer may choose to establish a new TSK using the rMSK. In either case, the authenticator and the peer know which key is used based on whether or not a TSK establishment exchange is initiated. The bootstrapping exchange may also be carried out via a new authenticator, in which case, the rMSK received SHOULD trigger a lower layer TSK establishment exchange.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Steps in ERP</h1>
<p id="rfc.section.5.2.p.1">When a peer that has an active rRK and rIK associates with a new authenticator that supports ERP, it may perform an ERP exchange with that authenticator. ERP is typically a peer-initiated exchange, consisting of an EAP-Initiate/Re-auth and an EAP-Finish/Re-auth message. The ERP exchange may be performed with a local ER server (when one is present) or with the original EAP server.</p>
<p id="rfc.section.5.2.p.2">It is plausible for the network to trigger the EAP re-authentication process, however. An ERP-capable authenticator SHOULD send an EAP-Initiate/Re-auth-Start message to indicate support for ERP. The peer may or may not wait for these messages to arrive to initiate the EAP-Initiate/Re-auth message.</p>
<p id="rfc.section.5.2.p.3">The EAP-Initiate/Re-auth-Start message SHOULD be sent by an ERP-capable authenticator. The authenticator may retransmit it a few times until it receives an EAP-Initiate/Re-auth message in response from the peer. The EAP-Initiate/Re-auth message from the peer may have originated before the peer receives either an EAP-Request/Identity or an EAP-Initiate/Re-auth-Start message from the authenticator. Hence, the Identifier value in the EAP-Initiate/Re-auth message is independent of the Identifier value in the EAP-Initiate/Re-auth-Start or the EAP-Request/Identity messages.</p>
<p id="rfc.section.5.2.p.4">Operational Considerations at the Peer:</p>
<p id="rfc.section.5.2.p.5">ERP requires that the peer maintain retransmission timers for reliable transport of EAP re-authentication messages. The reliability considerations of Section 4.3 of RFC 3748 apply with the peer as the retransmitting entity.</p>
<p id="rfc.section.5.2.p.6">The EAP Re-auth Protocol has the following steps:</p>

<ul class="empty">
<li>The ERP-capable authenticator sends the EAP-Initiate/Re-auth-Start message to trigger the ERP exchange.  </li>
<li>The peer sends an EAP-Initiate/Re-auth message. At a minimum, the message SHALL include the following fields: <ul class="empty">
<li>a 16-bit sequence number for replay protection</li>
<li>keyName-NAI as a TLV attribute to identify the rIK used to integrity protect the message.</li>
<li>cryptosuite to indicate the authentication algorithm used to compute the integrity checksum.</li>
<li>authentication tag over the message.</li>
</ul>
</li>
<li>When the peer is performing ERP with a local ER server, it MUST use the corresponding DS-rIK it shares with the local ER server.  The peer SHOULD set the lifetime flag to request the key lifetimes from the server. The peer can use the rRK lifetime to know when to trigger an EAP method exchange and the rMSK lifetime to know when to trigger another ERP exchange.</li>
<li>The authenticator copies the contents of the value field of the keyName-NAI TLV into the User-Name RADIUS attribute in the AAA message to the ER server.</li>
<li>The server uses the keyName-NAI to look up the rIK. It MUST first verify whether the sequence number is equal to or greater than the expected sequence number. If the server supports a sequence number window size greater than 1, it MUST verify whether the sequence number falls within the window and has not been received before. The server MUST then verify to ensure that the cryptosuite used by the peer is acceptable. The server then proceeds to verify the integrity of the message using the rIK, thereby verifying proof of possession of that key by the peer. If any of these verifications fail, the server MUST send an EAP-Finish/Re-auth message with the Result flag set to '1' (Failure). Please refer to <a href="#fail">Section 5.2.2</a> for details on failure handling. Otherwise, it MUST compute an rMSK from the rRK using the sequence number as the additional input to the key derivation.</li>
<li>In response to a well-formed EAP Re-auth/Initiate message, the server MUST send an EAP-Finish/Re-auth message with the following considerations: <ul class="empty">
<li>a 16-bit sequence number for replay protection, which MUST be the same as the received sequence number. The local copy of the sequence number MUST be incremented by 1. If the server supports multiple simultaneous ERP exchanges, it MUST instead update the sequence number window.</li>
<li>keyName-NAI as a TLV attribute to identify the rIK used to integrity protect the message.</li>
<li>cryptosuite to indicate the authentication algorithm used to compute the integrity checksum.</li>
<li>authentication tag over the message.</li>
<li>If the lifetime flag was set in the EAP-Initiate/Re-auth message, the ER server SHOULD include the rRK lifetime and the rMSK lifetime.</li>
</ul>
</li>
<li>The server transports the rMSK along with this message to the authenticator. The rMSK is transported in a manner similar to the MSK transport along with the EAP-Success message in a regular EAP exchange.</li>
<li>The peer looks up the sequence number to verify whether it is expecting an EAP-Finish/Re-auth message with that sequence number protected by the keyName-NAI. It then verifies the integrity of the message. If the verifications fail, the peer logs an error and stops the process; otherwise, it proceeds to the next step.</li>
<li>The peer uses the sequence number to compute the rMSK.</li>
<li>The lower-layer security association protocol can be triggered at this point.</li>
</ul>
<h1 id="rfc.section.5.2.1">
<a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#window" id="window">Multiple Simultaneous Runs of ERP</a>
</h1>
<p id="rfc.section.5.2.1.p.1">When a peer is within the range of multiple authenticators, it may choose to run ERP via all of them simultaneously to the same ER server. In that case, it is plausible that the ERP messages may arrive out of order, resulting in the ER server rejecting legitimate EAP-Initiate/Re-auth messages.</p>
<p id="rfc.section.5.2.1.p.2">To facilitate such operation, an ER server MAY allow multiple simultaneous ERP exchanges by accepting all EAP-Initiate/Re-auth messages with SEQ number values within a window of allowed values.  Recall that the SEQ number allows replay protection. Replay window maintenance mechanisms are a local matter.</p>
<h1 id="rfc.section.5.2.2">
<a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#fail" id="fail">ERP Failure Handling</a>
</h1>
<p id="rfc.section.5.2.2.p.1">If the processing of the EAP-Initiate/Re-auth message results in a failure, the ER server MUST send an EAP-Finish Re-auth message with the Result flag set to '1'. If the server has a valid rIK for the peer, it MUST integrity protect the EAP-Finish/Re-auth failure message. If the failure is due to an unacceptable cryptosuite, the server SHOULD send a list of acceptable cryptosuites (in a TLV of Type 5) along with the EAP-Finish/Re-auth message. In this case, the server MUST indicate the cryptosuite used to protect the EAP-Finish/Re-auth message in the cryptosuite. The rIK used with the EAP-Finish/Re-auth message in this case MUST be computed as specified in <a href="#rIKderv">Section 4.3</a> using the new cryptosuite. If the server does not have a valid rIK for the peer, the EAP-Finish/Re-auth message indicating a failure will be unauthenticated; the server MAY include a list of acceptable cryptosuites in the message.</p>
<p id="rfc.section.5.2.2.p.2">The peer, upon receiving an EAP-Finish/Re-auth message with the Result flag set to '1', MUST verify the sequence number and the Authentication Tag to determine the validity of the message. If the peer supports the cryptosuite, it MUST verify the integrity of the received EAP-Finish/Re-auth message. If the EAP-Finish message contains a TLV of Type 5, the peer SHOULD retry the ERP exchange with a cryptosuite picked from the list included by the server. The peer MUST use the appropriate rIK for the subsequent ERP exchange, by computing it with the corresponding cryptosuite, as specified in <a href="#rIKderv">Section 4.3</a>. If the PRF in the chosen cryptosuite is different from the PRF originally used by the peer, it MUST derive a new DSRK (if required), rRK, and rIK before proceeding with the subsequent ERP exchange.</p>
<p id="rfc.section.5.2.2.p.3">If the peer cannot verify the integrity of the received message, it MAY choose to retry the ERP exchange with one of the cryptosuites in the TLV of Type 5, after a failure has been clearly determined following the procedure in the next paragraph.</p>
<p id="rfc.section.5.2.2.p.4">If the replay or integrity checks fail, the failure message may have been sent by an attacker. It may also imply that the server and peer do not support the same cryptosuites; however, the peer cannot determine if that is the case. Hence, the peer SHOULD continue the ERP exchange per the retransmission timers before declaring a failure.</p>
<p id="rfc.section.5.2.2.p.5">When the peer runs explicit bootstrapping (ERP with the bootstrapping flag on), there may not be a local ER server available to send a DSRK Request and the domain name. In that case, the server cannot send the DSRK and MUST NOT include the domain name TLV. When the peer receives a response in the bootstrapping exchange without a domain name TLV, it assumes that there is no local ER server. The home ER server sends an rMSK to the ER authenticator, however, and the peer SHALL run the TSK establishment protocol as usual.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> New EAP Packets</h1>
<div id="#rfc.figure.7"></div>
<div id="#ReauthPkt"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |  Type-Data ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-                                
                        </pre>
<p id="rfc.section.5.3.p.1">Two new EAP Codes are defined for the purpose of ERP: EAP-Initiate and EAP-Finish. The packet format for these messages follows the EAP packet format defined in RFC 3748 <a href="#RFC3748">[RFC3748]</a>.  </p>
<p></p>

<ul class="empty">
<li>Code <ul class="empty">
<li>5 Initiate</li>
<li>6 Finish</li>
<li>Two new code values are defined for the purpose of ERP.</li>
</ul>
</li>
<li>Identifier <ul class="empty">
<li>The Identifier field is one octet. The Identifier field MUST be the same if an EAP-Initiate packet is retransmitted due to a timeout while waiting for a Finish message. Any new (non-retransmission) Initiate message MUST use a new Identifier field.</li>
<li>The Identifier field of the Finish message MUST match that of the currently outstanding Initiate message. A peer or authenticator receiving a Finish message whose Identifier value does not match that of the currently outstanding Initiate message MUST silently discard the packet.</li>
<li>In order to avoid confusion between new EAP-Initiate messages and retransmissions, the peer must choose an Identifier value that is different from the previous EAP-Initiate message, especially if that exchange has not finished. It is RECOMMENDED that the authenticator clear EAP Re-auth state after 300 seconds.</li>
</ul>
</li>
<li>Type <ul class="empty"><li>This field indicates that this is an ERP exchange. Two type values are defined in this document for this purpose -- Re-auth-Start (assigned Type 1) and Re-auth (assigned Type 2).</li></ul>
</li>
<li>Type-Data <ul class="empty"><li>The Type-Data field varies with the Type of re-authentication packet.</li></ul>
</li>
</ul>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#Re-auth-Start" id="Re-auth-Start">EAP-Initiate/Re-auth-Start Packet</a>
</h1>
<div id="#rfc.figure.8"></div>
<div id="#Re-auth-StartPkt"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |   Reserved    |     1 or more TVs or TLVs     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            </pre>
<p id="rfc.section.5.3.1.p.1">The EAP-Initiate/Re-auth-Start packet contains the parameters shown in <a href="#Re-auth-StartPkt">Figure 8</a>. </p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">Type = 1.</dd>
<dt></dt>
<dd style="margin-left: 8">Reserved, MUST be zero. Set to zero on transmission and ignored on reception.</dd>
<dt></dt>
<dd style="margin-left: 8">One or more TVs or TLVs are used to convey information to the peer; for instance, the authenticator may send the domain name to the peer.</dd>
<dt></dt>
<dd style="margin-left: 8">TVs or TLVs: In the TV payloads, there is a 1-octet type payload and a value with type-specific length. In the TLV payloads, there is a 1-octet type payload and a 1-octet length payload. The length field indicates the length of the value expressed in number of octets. <dl>
<dt></dt>
<dd style="margin-left: 8">Domain-Name: This is a TLV payload. The Type is 4. The domain name is to be used as the realm in an NAI <a href="#RFC4282">[RFC4282]</a>. The Domain-Name attribute SHOULD be present in an EAP-Initiate/Re-auth-Start message.</dd>
<dt></dt>
<dd style="margin-left: 8">In addition, channel binding information MAY be included; see <a href="#CB">Section 5.5</a> for discussion. See <a href="#TLV">Figure 12</a> for parameter specification.</dd>
</dl>
</dd>
</dl>
<h1 id="rfc.section.5.3.1.1">
<a href="#rfc.section.5.3.1.1">5.3.1.1.</a> Authenticator Operation</h1>
<p id="rfc.section.5.3.1.1.p.1">The authenticator SHOULD send the EAP-Initiate/Re-auth-Start message to indicate support for ERP to the peer and to initiate ERP if the peer has already performed full EAP authentication and has unexpired key material. The authenticator SHOULD include the domain name TLV to allow the peer to learn it without lower-layer support or the ERP bootstrapping exchange.</p>
<p id="rfc.section.5.3.1.1.p.2">The authenticator MAY include channel binding information so that the peer can send the information to the server in the EAP-Initiate/Re-auth message so that the server can verify whether the authenticator is claiming the same identity to both parties.</p>
<p id="rfc.section.5.3.1.1.p.3">The authenticator MAY re-transmit the EAP-Initiate/Re-auth-Start message a few times for reliable transport.</p>
<h1 id="rfc.section.5.3.1.2">
<a href="#rfc.section.5.3.1.2">5.3.1.2.</a> Peer Operation</h1>
<p id="rfc.section.5.3.1.2.p.1">The peer SHOULD send the EAP-Initiate/Re-auth message in response to the EAP-Initiate/Re-auth-Start message from the authenticator. If the peer does not recognize the Initiate code value, it silently discards the message. If the peer has already sent the EAP-Initiate/Re-auth message to begin the ERP exchange, it silently discards the message.</p>
<p id="rfc.section.5.3.1.2.p.2">If the EAP-Initiate/Re-auth-Start message contains the domain name, and if the peer does not already have the domain information, the peer SHOULD use the domain name to compute the DSRK and use the corresponding DS-rIK to send an EAP-Initiate/Re-auth message to start an ERP exchange with the local ER server. If there are the local ER server between the peer and the home ER server and the peer has already initiated an ERP exchange with the local ER server, it SHOULD choose to not start an ERP exchange with the home ER server.</p>
<h1 id="rfc.section.5.3.2">
<a href="#rfc.section.5.3.2">5.3.2.</a> <a href="#ReauthInit" id="ReauthInit">EAP-Initiate/Re-auth Packet</a>
</h1>
<div id="#rfc.figure.9"></div>
<div id="#ReauthInitPkt"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|B|L| Reserved|             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| cryptosuite  |        Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            </pre>
<p id="rfc.section.5.3.2.p.1">The EAP-Initiate/Re-auth packet contains the parameters shown in <a href="#ReauthInitPkt">Figure 9</a>. </p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">Type = 2.</dd>
<dt></dt>
<dd style="margin-left: 8">Flags <dl>
<dt></dt>
<dd style="margin-left: 8">'R' - The R flag is set to 0 and ignored upon reception.</dd>
<dt></dt>
<dd style="margin-left: 8">'B' - The B flag is used as the bootstrapping flag. If the flag is turned on, the message is a bootstrap message.</dd>
<dt></dt>
<dd style="margin-left: 8">'L' - The L flag is used to request the key lifetimes from the server.</dd>
<dt></dt>
<dd style="margin-left: 8">The rest of the 5 bits are set to 0 and ignored on reception.</dd>
</dl>
</dd>
<dt></dt>
<dd style="margin-left: 8">SEQ: A 16-bit sequence number is used for replay protection.  The SEQ number field is initialized to 0 every time a new rRK is derived.</dd>
<dt></dt>
<dd style="margin-left: 8">TVs or TLVs: In the TV payloads, there is a 1-octet type payload and a value with type-specific length. In the TLV payloads, there is a 1-octet type payload and a 1-octet length payload. The length field indicates the length of the value expressed in number of octets. <dl>
<dt></dt>
<dd style="margin-left: 8">keyName-NAI: This is carried in a TLV payload. The Type is 1. The NAI is variable in length, not exceeding 253 octets. The EMSKname is in the username part of the NAI and is encoded in hexadecimal values. The EMSKname is 64 bits in length and so the username portion takes up 128 octets. If the rIK is derived from the EMSK, the realm part of the NAI is the home domain name, and if the rIK is derived from a DSRK, the realm part of the NAI is the domain name used in the derivation of the DSRK. The NAI syntax follows <a href="#RFC4282">[RFC4282]</a>. Exactly one keyName-NAI attribute SHALL be present in an EAP-Initiate/Re-auth packet.</dd>
</dl>
<p> </p>
<dl>
<dt></dt>
<dd style="margin-left: 8">In addition, channel binding information MAY be included; see <a href="#CB">Section 5.5</a> for discussion. See <a href="#TLV">Figure 12</a> for parameter specification.</dd>
</dl>
</dd>
<dt></dt>
<dd style="margin-left: 8">Cryptosuite: This field indicates the integrity algorithm used for ERP. Key lengths and output lengths are either indicated or are obvious from the cryptosuite name. We specify some cryptosuites below: <ul>
<li>0 RESERVED</li>
<li>1 HMAC-SHA256-64</li>
<li>2 HMAC-SHA256-128</li>
<li>3 HMAC-SHA256-256</li>
</ul>
<p> HMAC-SHA256-128 is mandatory to implement and should be enabled in the default configuration.</p>
</dd>
<dt></dt>
<dd style="margin-left: 8">Authentication Tag: This field contains the integrity checksum over the ERP packet, excluding the authentication tag field itself. The length of the field is indicated by the Cryptosuite.</dd>
</dl>
<h1 id="rfc.section.5.3.3">
<a href="#rfc.section.5.3.3">5.3.3.</a> <a href="#ReauthFin" id="ReauthFin">EAP-Finish/Re-auth Packet</a>
</h1>
<div id="#rfc.figure.10"></div>
<div id="#ReauthInfPkt"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|B|L| Reserved |             SEQ               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| cryptosuite  |        Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            </pre>
<p id="rfc.section.5.3.3.p.1">The EAP-Finish/Re-auth packet contains the parameters shown in <a href="#ReauthInfPkt">Figure 10</a>. </p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">Type = 2.</dd>
<dt></dt>
<dd style="margin-left: 8">Flags <dl>
<dt></dt>
<dd style="margin-left: 8">'R' - The R flag is used as the Result flag. When set to 0, it indicates success, and when set to '1', it indicates a failure.</dd>
<dt></dt>
<dd style="margin-left: 8">'B' - The B flag is used as the bootstrapping flag. If the flag is turned on, the message is a bootstrap message.</dd>
<dt></dt>
<dd style="margin-left: 8">'L' - The L flag is used to indicate the presence of the rRK lifetime TLV.</dd>
<dt></dt>
<dd style="margin-left: 8">The rest of the 5 bits are set to 0 and ignored on reception.</dd>
</dl>
</dd>
<dt></dt>
<dd style="margin-left: 8">SEQ: A 16-bit sequence number is used for replay protection.  The SEQ number field is initialized to 0 every time a new rRK is derived.</dd>
<dt></dt>
<dd style="margin-left: 8">TVs or TLVs: In the TV payloads, there is a 1-octet type payload and a value with type-specific length. In the TLV payloads, there is a 1-octet type payload and a 1-octet length payload. The length field indicates the length of the value expressed in number of octets. <dl>
<dt></dt>
<dd style="margin-left: 8">keyName-NAI: This is carried in a TLV payload. The Type is 1. The NAI is variable in length, not exceeding 253 octets. EMSKname is in the username part of the NAI and is encoded in hexadecimal values. The EMSKname is 64 bits in length and so the username portion takes up 16 octets. If the rIK is derived from the EMSK, the realm part of the NAI is the home domain name, and if the rIK is derived from a DSRK, the realm part of the NAI is the domain name used in the derivation of the DSRK. The NAI syntax follows <a href="#RFC4282">[RFC4282]</a>. Exactly one instance of the keyName-NAI attribute SHALL be present in an EAP-Finish/Re-auth message.</dd>
<dt></dt>
<dd style="margin-left: 8">rRK Lifetime: This is a TV payload. The Type is 2. The value field is a 32-bit field and contains the lifetime of the rRK in seconds. If the 'L' flag is set, the rRK Lifetime attribute SHOULD be present.</dd>
<dt></dt>
<dd style="margin-left: 8">rMSK Lifetime: This is a TV payload. The Type is 3. The value field is a 32-bit field and contains the lifetime of the rMSK in seconds. If the 'L' flag is set, the rMSK Lifetime attribute SHOULD be present.</dd>
<dt></dt>
<dd style="margin-left: 8">Domain-Name: This is a TLV payload. The Type is 4. The domain name is to be used as the realm in an NAI <a href="#RFC4282">[RFC4282]</a>. Domain-Name attribute MUST be present in an EAP-Finish/Re-auth message if the bootstrapping flag is set and if the local ER server sent a DSRK request.</dd>
<dt></dt>
<dd style="margin-left: 8">List of cryptosuites: This is a TLV payload. The Type is 5. The value field contains a list of cryptosuites, each of size 1 octet. The cryptosuite values are as specified in <a href="#ReauthInitPkt">Figure 9</a>. The server SHOULD include this attribute if the cryptosuite used in the EAP-Initiate/Re-auth message was not acceptable and the message is being rejected. The server MAY include this attribute in other cases. The server MAY use this attribute to signal to the peer about its cryptographic algorithm capabilities.</dd>
<dt></dt>
<dd style="margin-left: 8">Authorization Indication: This is a TLV payload. The Type is 6. This attribute MAY be included in the EAP-Finish/Re-auth message when a DSRK is delivered to a local ER server and if the home EAP server can verify the authorization of the local ER server to advertise the domain name included in the domain TLV in the same message. The value field in the TLV contains an authentication tag computed over the entire packet, starting from the first bit of the code field to the last bit of the cryptosuite field, with the value field of the Authorization Indication TLV filled with all 0s for the computation. The key used for the computation MUST be derived from the EMSK with key label "DSRK Delivery Authorized Key@ietf.org" and optional data containing an ASCII string representing the key management domain that the DSRK is being derived for.</dd>
</dl>
<p> </p>
<dl>
<dt></dt>
<dd style="margin-left: 8">In addition, channel binding information MAY be included: see <a href="#CB">Section 5.5</a> for discussion. See <a href="#TLV">Figure 12</a> for parameter specification. The server sends this information so that the peer can verify the information seen at the lower layer, if channel binding is to be supported.</dd>
</dl>
</dd>
<dt></dt>
<dd style="margin-left: 8">Cryptosuite: This field indicates the integrity algorithm and the PRF used for ERP. Key lengths and output lengths are either indicated or are obvious from the cryptosuite name.</dd>
<dt></dt>
<dd style="margin-left: 8">Authentication Tag: This field contains the integrity checksum over the ERP packet, excluding the authentication tag field itself. The length of the field is indicated by the Cryptosuite.</dd>
</dl>
<h1 id="rfc.section.5.3.4">
<a href="#rfc.section.5.3.4">5.3.4.</a> TV and TLV Attributes</h1>
<div id="#rfc.figure.11"></div>
<div id="#TV"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |              Value ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            </pre>
<p id="rfc.section.5.3.4.p.1">The TV attributes that may be present in the EAP-Initiate or EAP-Finish messages are of the following format: </p>
<div id="#rfc.figure.12"></div>
<div id="#TLV"></div>
<pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |    Length     |            Value ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                            </pre>
<p id="rfc.section.5.3.4.p.2">The TLV attributes that may be present in the EAP-Initiate or EAP-Finish messages are of the following format: </p>
<p id="rfc.section.5.3.4.p.3">The following Types are defined in this document:</p>
<p></p>

<dl>
<dt></dt>
<dd style="margin-left: 8">'1' - keyName-NAI: This is a TLV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">'2' - rRK Lifetime: This is a TV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">'3' - rMSK Lifetime: This is a TV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">'4' - domain name: This is a TLV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">'5' - cryptosuite list: This is a TLV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">'6' - Authorization Indication: This is a TLV payload.</dd>
<dt></dt>
<dd style="margin-left: 8">The TLV type range of 128-191 is reserved to carry channel binding information in the EAP-Initiate and Finish/Re-auth messages. Below are the current assignments (all of them are TLVs): <ul class="empty">
<li>'128' - Called-Station-Id <a href="#RFC2865">[RFC2865]</a>
</li>
<li>'129' - Calling-Station-Id <a href="#RFC2865">[RFC2865]</a>
</li>
<li>'130' - NAS-Identifier <a href="#RFC2865">[RFC2865]</a>
</li>
<li>'131' - NAS-IP-Address <a href="#RFC2865">[RFC2865]</a>
</li>
<li>'132' - NAS-IPv6-Address <a href="#RFC3162">[RFC3162]</a>
</li>
</ul>
</dd>
</dl>
<p id="rfc.section.5.3.4.p.5">The length field indicates the length of the value part of the attribute in octets.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Replay Protection</h1>
<p id="rfc.section.5.4.p.1">For replay protection, ERP uses sequence numbers. The sequence number is maintained per rIK and is initialized to zero in both directions. In the first EAP-Initiate/Re-auth message, the peer uses the sequence number zero or higher. Note that the when the sequence number rotates, the rIK MUST be changed by running EAP authentication.  The server expects a sequence number of zero or higher. When the server receives an EAP-Initiate/Re-auth message, it uses the same sequence number in the EAP-Finish/Re-auth message. The server then sets the expected sequence number to the received sequence number plus 1. The server accepts sequence numbers greater than or equal to the expected sequence number.</p>
<p id="rfc.section.5.4.p.2">If the peer sends an EAP-Initiate/Re-auth message, but does not receive a response, it retransmits the request (with no changes to the message itself) a pre-configured number of times before giving up.  However, it is plausible that the server itself may have responded to the message and it was lost in transit. Thus, the peer MUST increment the sequence number and use the new sequence number to send subsequent EAP re-authentication messages. The peer SHOULD increment the sequence number by 1; however, it may choose to increment by a larger number.  When the sequence number rotates, the peer MUST run full EAP authentication.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#CB" id="CB">Channel Binding</a>
</h1>
<p id="rfc.section.5.5.p.1">ERP provides a protected facility to carry channel binding (CB) information, according to the guidelines in Section 7.15 of <a href="#RFC3748">[RFC3748]</a>. The TLV type range of 128-191 is reserved to carry CB information in the EAP-Initiate/Re-auth and EAP-Finish/Re-auth messages. Called-Station-Id, Calling-Station-Id, NAS-Identifier, NAS-IP-Address, and NAS-IPv6-Address are some examples of channel binding information listed in RFC 3748, and they are assigned values 128-132. Additional values are IANA managed based on IETF Consensus <a href="#RFC5226">[RFC5226]</a>.</p>
<p id="rfc.section.5.5.p.2">The authenticator MAY provide CB information to the peer via the EAP-Initiate/Re-auth-Start message. The peer sends the information to the server in the EAP-Initiate/Re-auth message; the server verifies whether the authenticator identity available via AAA attributes is the same as the identity provided to the peer.</p>
<p id="rfc.section.5.5.p.3">If the peer does not include the CB information in the EAP-Initiate/Re-auth message, and if the local ER server's policy requires channel binding support, it SHALL send the CB attributes for the peer's verification. The peer attempts to verify the CB information if the authenticator has sent the CB parameters, and it proceeds with the lower-layer security association establishment if the attributes match. Otherwise, the peer SHALL NOT proceed with the lower-layer security association establishment.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#lowerlayer" id="lowerlayer">Lower-Layer Considerations</a>
</h1>
<p id="rfc.section.6.p.1">The authenticator is responsible for retransmission of EAP-Initiate/Re-auth-Start messages. The authenticator MAY retransmit the message a few times or until it receives an EAP-Initiate/Re-auth message from the peer. The authenticator may not know whether the peer supports ERP; in those cases, the peer may be silently dropping the EAP-Initiate/Re-auth-Start packets. Thus, retransmission of these packets should be kept to a minimum. The exact number is up to each lower layer.</p>
<p id="rfc.section.6.p.2">The Identifier value in the EAP-Initiate/Re-auth packet is independent of the Identifier value in the EAP-Initiate/Re-auth-Start packet.</p>
<p id="rfc.section.6.p.3">The peer is responsible for retransmission of EAP-Initiate/Re-auth messages.</p>
<p id="rfc.section.6.p.4">Retransmitted packets MUST be sent with the same Identifier value in order to distinguish them from new packets. By default, where the EAP-Initiate message is sent over an unreliable lower layer, the retransmission timer SHOULD be dynamically estimated. A maximum of 3-5 retransmissions is suggested (this is based on the recommendation of <a href="#RFC3748">[RFC3748]</a>). Where the EAP-Initiate message is sent over a reliable lower layer, the retransmission timer SHOULD be set to an infinite value, so that retransmissions do not occur at the EAP layer. Please refer to RFC 3748 <a href="#RFC3748">[RFC3748]</a> for additional guidance on setting timers.</p>
<p id="rfc.section.6.p.5">The Identifier value in the EAP-Finish/Re-auth packet is the same as the Identifier value in the EAP-Initiate/Re-auth packet.</p>
<p id="rfc.section.6.p.6">If an authenticator receives a valid duplicate EAP-Initiate/Re-auth message for which it has already sent an EAP-Finish/Re-auth message, it MUST resend the EAP-Finish/Re-auth message without reprocessing the EAP-Initiate/Re-auth message. To facilitate this, the authenticator SHALL store a copy of the EAP-Finish/Re-auth message for a finite amount of time. The actual value of time is a local matter; this specification recommends a value of 100 milliseconds.</p>
<p id="rfc.section.6.p.7">The lower layer may provide facilities for exchanging information between the peer and the authenticator about support for ERP, for the authenticator to send the domain name information and channel binding information to the peer</p>
<p id="rfc.section.6.p.8">Note that to support ERP, lower-layer specifications may need to be revised. Specifically, the IEEE802.1x specification must be revised to allow carrying EAP messages of the new codes defined in this document in order to support ERP. Similarly, RFC 5996 must be updated to include EAP code values higher than 4 in order to use ERP with Internet Key Exchange Protocol version 2 (IKEv2). IKEv2 may also be updated to support peer-initiated ERP for optimized operation. Other lower layers may need similar revisions.</p>
<p id="rfc.section.6.p.9">Our analysis indicates that some EAP implementations are not RFC 3748 compliant in that instead of silently dropping EAP packets with code values higher than 4, they may consider it an error. To accommodate such non-compliant EAP implementations, additional guidance has been provided below. Furthermore, it may not be easy to upgrade all the peers in some cases. In such cases, authenticators may be configured to not send EAP-Initiate/Re-auth-Start; peers may learn whether an authenticator supports ERP via configuration, from advertisements at the lower layer.</p>
<p id="rfc.section.6.p.10">In order to accommodate implementations that are not compliant to RFC 3748, such lower layers SHOULD ensure that both parties support ERP; this is trivial for an instance when using a lower layer that is known to always support ERP. For lower layers where ERP support is not guaranteed, ERP support may be indicated through signaling (e.g., piggy-backed on a beacon) or through negotiation. Alternatively, clients may recognize environments where ERP is available based on pre-configuration. Other similar mechanisms may also be used. When ERP support cannot be verified, lower layers may mandate falling back to full EAP authentication to accommodate EAP implementations that are not compliant to RFC 3748.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#AAA" id="AAA">Transport of ERP Messages</a>
</h1>
<p id="rfc.section.7.p.1">AAA Transport of ERP messages is specified in <a href="#RFC5749">[RFC5749]</a> and <a href="#I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a>.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#SecCons" id="SecCons">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This section provides an analysis of the protocol in accordance with the AAA key management requirements specified in <a href="#RFC4962">[RFC4962]</a>.</p>
<p></p>

<ul class="empty">
<li>Cryptographic algorithm independence <ul class="empty"><li>The EAP Re-auth Protocol satisfies this requirement. The algorithm chosen by the peer for the MAC generation is indicated in the EAP-Initiate/Re-auth message. If the chosen algorithm is unacceptable, the EAP server returns an EAP-Finish/Re-auth message with Failure indication. Algorithm agility for the KDF is specified in <a href="#RFC5295">[RFC5295]</a>. Only when the algorithms used are acceptable, the server proceeds with derivation of keys and verification of the proof of possession of relevant keying material by the peer. A full-blown negotiation of algorithms cannot be provided in a single round trip protocol. Hence, while the protocol provides algorithm agility, it does not provide true negotiation.</li></ul>
</li>
<li>Strong, fresh session keys <ul class="empty"><li>ERP results in the derivation of strong, fresh keys that are unique for the given session. An rMSK is always derived on-demand when the peer requires a key with a new authenticator.  The derivation ensures that the compromise of one rMSK does not result in the compromise of a different rMSK at any time.</li></ul>
</li>
<li>Limit key scope <ul class="empty"><li>The scope of all the keys derived by ERP is well defined. The rRK and rIK are never shared with any entity and always remain on the peer and the server. The rMSK is provided only to the authenticator through which the peer performs the ERP exchange.  No other authenticator is authorized to use that rMSK.</li></ul>
</li>
<li>Replay detection mechanism <ul class="empty"><li>For replay protection of ERP messages, a sequence number associated with the rIK is used. The sequence number is maintained by the peer and the server, and initialized to zero when the rIK is generated. The peer increments the sequence number by one after it sends an ERP message. The server sets the expected sequence number to the received sequence number plus one after verifying the validity of the received message and responds to the message.</li></ul>
</li>
<li>Authenticate all parties <ul class="empty"><li>The EAP Re-auth Protocol provides mutual authentication of the peer and the server. Both parties need to possess the keying material that resulted from a previous EAP exchange in order to successfully derive the required keys. Also, both the EAP re-authentication Response and the EAP re-authentication Information messages are integrity protected so that the peer and the server can verify each other. When the ERP exchange is executed with a local ER server, the peer and the local server mutually authenticate each other via that exchange in the same manner. The peer and the authenticator authenticate each other in the secure association protocol executed by the lower layer, just as in the case of a regular EAP exchange.</li></ul>
</li>
<li>Peer and authenticator authorization <ul class="empty"><li>The peer and authenticator demonstrate possession of the same key material without disclosing it, as part of the lower-layer secure association protocol. Channel binding with ERP may be used to verify consistency of the identities exchanged, when the identities used in the lower layer differ from that exchanged within the AAA protocol.</li></ul>
</li>
<li>Keying material confidentiality <ul class="empty">
<li>The peer and the server derive the keys independently using parameters known to each entity. The AAA server sends the DSRK of a domain to the corresponding local ER server via the AAA protocol. Likewise, the ER server sends the rMSK to the authenticator via the AAA protocol.</li>
<li>Note that compromise of the DSRK results in compromise of all keys derived from it. Moreover, there is no forward secrecy within ERP. Thus, compromise of an DSRK retroactively compromises all ERP keys.</li>
<li>It is RECOMMENDED that the AAA protocol be protected using IPsec or TLS so that the keys are protected in transit. Note, however, that keys may be exposed to AAA proxies along the way and compromise of any of those proxies may result in compromise of keys being transported through them.</li>
<li>The home EAP server MUST NOT hand out a given DSRK to a local domain server more than once, unless it can verify that the entity receiving the DSRK after the first time is the same as that received the DSRK originally. If the home EAP server verifies authorization of a local domain server, it MAY hand out the DSRK to that domain more than once. In this case, the home EAP server includes the Authorization Indication TLV to assure the peer that DSRK delivery is secure.</li>
</ul>
</li>
<li>Confirm cryptosuite selection <ul class="empty"><li>Crypto algorithms for integrity and key derivation in the context of ERP MAY be the same as that used by the EAP method.  In that case, the EAP method is responsible for confirming the cryptosuite selection. Furthermore, the cryptosuite is included in the ERP exchange by the peer and confirmed by the server. The protocol allows the server to reject the cryptosuite selected by the peer and provide alternatives. When a suitable rIK is not available for the peer, the alternatives may be sent in an unprotected fashion. The peer is allowed to retry the exchange using one of the allowed cryptosuites. However, in this case, any en route modifications to the list sent by the server will go undetected. If the server does have an rIK available for the peer, the list will be provided in a protected manner and this issue does not apply.</li></ul>
</li>
<li>Uniquely named keys <ul class="empty"><li>All keys produced within the ERP context can be referred to uniquely as specified in this document. Also, the key names do not reveal any part of the keying material.</li></ul>
</li>
<li>Prevent the domino effect <ul class="empty">
<li>The compromise of one peer does not result in the compromise of keying material held by any other peer in the system. Also, the rMSK is meant for a single authenticator and is not shared with any other authenticator. Hence, the compromise of one authenticator does not lead to the compromise of sessions or keys held by any other authenticator in the system. Hence, the EAP Re-auth Protocol allows prevention of the domino effect by appropriately defining key scope.</li>
<li>However, if keys are transported using hop-by-hop protection, compromise of a proxy may result in compromise of key material, i.e., the DSRK being sent to a local ER server.</li>
</ul>
</li>
<li>Bind key to its context <ul class="empty"><li>All the keys derived for ERP are bound to the appropriate context using appropriate key labels. Lifetime of a child key is less than or equal to that of its parent key as specified in RFC 4962 <a href="#RFC4962">[RFC4962]</a>. The key usage, lifetime and the parties that have access to the keys are specified.</li></ul>
</li>
<li>Confidentiality of identity <ul class="empty"><li>Deployments where privacy is a concern may find the use of rIKname-NAI to route ERP messages serves their privacy requirements. Note that it is plausible to associate multiple runs of ERP messages since the rIKname is not changed as part of the ERP protocol. There was no consensus for that requirement at the time of development of this specification. If the rIKname is not used and the Peer-ID is used instead, the ERP exchange will reveal the Peer-ID over the wire.</li></ul>
</li>
<li>Authorization restriction <ul class="empty"><li>All the keys derived are limited in lifetime by that of the parent key or by server policy. Any domain-specific keys are further restricted for use only in the domain for which the keys are derived. All the keys specified in this document are meant for use in ERP only. Any other restrictions of session keys may be imposed by the specific lower layer and are out of scope for this specification.</li></ul>
</li>
</ul>
<p id="rfc.section.8.p.3">A denial-of-service (DoS) attack on the peer may be possible when using the EAP Initiate/Re-auth message. An attacker may send a bogus EAP-Initiate/Re-auth message, which may be carried by the authenticator in a RADIUS-Access-Request to the server; in response, the server may send an EAP-Finish/Re-auth with Failure indication in a RADIUS Access-Reject message. Note that such attacks may be plausible with the EAPoL-Start capability of IEEE 802.11 and other similar facilities in other link layers and where the peer can initiate EAP authentication. An attacker may use such messages to start an EAP method run, which fails and may result in the server sending a RADIUS Access-Reject message, thus resulting in the link-layer connections being terminated.</p>
<p id="rfc.section.8.p.4">To prevent such DoS attacks, an ERP failure should not result in deletion of any authorization state established by a full EAP exchange.  Alternatively, the lower layers and AAA protocols may define mechanisms to allow two link-layer security associations (SAs) derived from different EAP keying materials for the same peer to exist so that smooth migration from the current link layer SA to the new one is possible during rekey. These mechanisms prevent the link layer connections from being terminated when a re-authentication procedure fails due to the bogus EAP-Initiate/Re-auth message.</p>
<p id="rfc.section.8.p.5">When a DSRK is sent from a home EAP server to a local domain server or when a rMSK is sent from an ER server to an authenticator, in the absence of end-to-end security between the entity that is sending the key and the entity receiving the key, it is plausible for other entities to get access to keys being sent to an ER server in another domain. This mode of key transport is similar to that of MSK transport in the context of EAP authentication. We further observe that ERP is for access authentication and does not support end-to-end data security. In typical implementations, the traffic is in the clear beyond the access control enforcement point (the authenticator or an entity delegated by the authenticator for access control enforcement). The model works as long as entities in the middle of the network do not use keys intended for other parties to steal service from an access network. If that is not achievable, key delivery must be protected in an end-to-end manner.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#ianaCons" id="ianaCons">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document has no IANA actions; all values referenced in this document were previously assigned in RFC 5296 <a href="#RFC5296">[RFC5296]</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Change Log</h1>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> draft-ietf-hokey-rfc5296bis-02</h1>
<p id="rfc.section.10.1.p.1">The following are the major changes compared to previous version 00:</p>

<ul>
<li>Change using MAY in section 5.3.1.1 to using SHOULD</li>
<li>Mandate sending the EAP-Initiate/Re-auth-Start message instead of optional</li>
<li>Update obsolete reference RFC4306 into RFC5996</li>
<li>Allow local server respond to the peer directly without forwarding the ERP message to the home domain</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2104">[RFC2104]</b></td>
<td class="top">
<a href="mailto:hugo@watson.ibm.com" title="IBM, T.J. Watson Research Center">Krawczyk, H.</a>, <a href="mailto:mihir@cs.ucsd.edu" title="University of California at San Diego, Dept of Computer Science and Engineering">Bellare, M.</a> and <a href="mailto:canetti@watson.ibm.com" title="IBM T.J. Watson Research Center">R. Canetti</a>, "<a href="http://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>", RFC 2104, February 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4282">[RFC4282]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Beadles, M.</a>, <a>Arkko, J.</a> and <a>P. Eronen</a>, "<a href="http://tools.ietf.org/html/rfc4282">The Network Access Identifier</a>", RFC 4282, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5295">[RFC5295]</b></td>
<td class="top">
<a>Salowey, J.</a>, <a>Dondeti, L.</a>, <a>Narayanan, V.</a> and <a>M. Nakhjiri</a>, "<a href="http://tools.ietf.org/html/rfc5295">Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)</a>", RFC 5295, August 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4962">[RFC4962]</b></td>
<td class="top">
<a>Housley, R.</a> and <a>B. Aboba</a>, "<a href="http://tools.ietf.org/html/rfc4962">Guidance for Authentication, Authorization, and Accounting (AAA) Key Management</a>", BCP 132, RFC 4962, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4187">[RFC4187]</b></td>
<td class="top">
<a>Arkko, J.</a> and <a>H. Haverinen</a>, "<a href="http://tools.ietf.org/html/rfc4187">Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)</a>", RFC 4187, January 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5296">[RFC5296]</b></td>
<td class="top">
<a>Narayanan, V.</a> and <a>L. Dondeti</a>, "<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>", RFC 5296, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5169">[RFC5169]</b></td>
<td class="top">
<a>Clancy, T.</a>, <a>Nakhjiri, M.</a>, <a>Narayanan, V.</a> and <a>L. Dondeti</a>, "<a href="http://tools.ietf.org/html/rfc5169">Handover Key Management and Re-Authentication Problem Statement</a>", RFC 5169, March 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</b></td>
<td class="top">
<a>Bournelle, J</a>, <a>Morand, L</a>, <a>Decugis, S</a>, <a>Wu, W</a> and <a>G Zorn</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dime-erp-07">Diameter support for EAP Re-authentication Protocol (ERP)</a>", Internet-Draft draft-ietf-dime-erp-07, September 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-hokey-ldn-discovery">[I-D.ietf-hokey-ldn-discovery]</b></td>
<td class="top">
<a title="Network Zen">Zorn, G.</a>, <a title="Huawei">Wu, Q.</a> and <a title="Huawei">Y. Wang</a>, "<a href="http://tools.ietf.org/html/draft-ietf-hokey-ldn-discovery-05">The Local Domain Name DHCPv6 Option</a>", Internet-Draft draft-ietf-hokey-ldn-discovery-05, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</b></td>
<td class="top">
<a>Huawei</a><a>Network Zen</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dime-local-keytran-07">Diameter Attribute-Value Pairs for Cryptographic Key Transport</a>", Internet-Draft draft-ietf-dime-local-keytran-07, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5749">[RFC5749]</b></td>
<td class="top">
<a>Hoeper, K.</a>, <a>Nakhjiri, M.</a> and <a>Y. Ohba</a>, "<a href="http://tools.ietf.org/html/rfc5749">Distribution of EAP-Based Keys for Handover and Re-Authentication</a>", RFC 5749, March 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2865">[RFC2865]</b></td>
<td class="top">
<a>Rigney, C.</a>, <a>Willens, S.</a>, <a>Rubens, A.</a> and <a>W. Simpson</a>, "<a href="http://tools.ietf.org/html/rfc2865">Remote Authentication Dial In User Service (RADIUS)</a>", RFC 2865, June 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3162">[RFC3162]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Zorn, G.</a> and <a>D. Mitton</a>, "<a href="http://tools.ietf.org/html/rfc3162">RADIUS and IPv6</a>", RFC 3162, August 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3579">[RFC3579]</b></td>
<td class="top">
<a>Aboba, B.</a> and <a>P. Calhoun</a>, "<a href="http://tools.ietf.org/html/rfc3579">RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)</a>", RFC 3579, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="MSKHierarchy">[MSKHierarchy]</b></td>
<td class="top">
<a>Lopez, R. M.</a>, <a>Skarmeta, A. G.</a>, <a>Bournelle, J</a>, <a>Laurent-Maknavicus, M</a> and <a>J. M. Combes</a>, "<a>Improved EAP keying framework for a secure mobility access service</a>", IWCMC '06, Proceedings of the 2006 International Conference on Wireless Communications and                     Mobile Computing, New York, NY, USA, 2006.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE_802.1X">[IEEE_802.1X]</b></td>
<td class="top">
<a>Institute of Electrical and Electronics Engineers</a>, "<a>IEEE Standards for Local and Metropolitan Area Networks: Port based Network Access Control, IEEE Std 802.1X-2004</a>", December 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5996">[RFC5996]</b></td>
<td class="top">
<a>Kaufman, C.</a>, <a>Hoffman , P.</a>, <a>Nir, Y.</a> and <a>P. Eronen</a>, "<a href="http://tools.ietf.org/html/rfc5996">Internet Key Exchange Protocol Version 2 (IKEv2)</a>", RFC 5996, September 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#ack" id="ack">Acknowledgments</a>
</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> RFC 5296</h1>
<p id="rfc.section.Appendix A.1.p.1">In writing this document, we benefited from discussing the problem space and the protocol itself with a number of folks including Bernard Aboba, Jari Arkko, Sam Hartman, Russ Housley, Joe Salowey, Jesse Walker, Charles Clancy, Michaela Vanderveen, Kedar Gaonkar, Parag Agashe, Dinesh Dharmaraju, Pasi Eronen, Dan Harkins, Yoshi Ohba, Glen Zorn, Alan DeKok, Katrin Hoeper, and other participants of the HOKEY working group. The credit for the idea to use EAP-Initiate/Re-auth-Start goes to Charles Clancy, and the multiple link-layer SAs idea to mitigate the DoS attack goes to Yoshi Ohba.  Katrin Hoeper suggested the use of the windowing technique to handle multiple simultaneous ER exchanges. Many thanks to Pasi Eronen for the suggestion to use hexadecimal encoding for rIKname when sent as part of keyName-NAI field. Thanks to Bernard Aboba for suggestions in clarifying the EAP lock-step operation, and Joe Salowey and Glen Zorn for help in specifying AAA transport of ERP messages. Thanks to Sam Hartman for the DSRK Authorization Indication mechanism.</p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> RFC 5296bis</h1>
<p id="rfc.section.Appendix A.2.p.1">Glen Zorn wrote the initial draft for this document and provided useful reviews. Many thanks to him.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Example ERP Exchange</h1>
<div id="#rfc.figure.13"></div>
<pre>
0. Authenticator --&gt; Peer:  [EAP-Initiate/Re-auth-Start]

1. Peer --&gt; Authenticator:  EAP Initiate/Re-auth(SEQ, keyName-NAI,
                             cryptosuite,Auth-tag*)

1a. Authenticator --&gt; Re-auth-Server: AAA-Request{Authenticator-Id, 
                            EAP Initiate/Re-auth(SEQ,keyName-NAI, 
                             cryptosuite,Auth-tag*)

2. ER-Server --&gt; Authenticator: AAA-Response{rMSK,
                            EAP-Finish/Re-auth(SEQ,keyName-NAI,
                            cryptosuite,[CB-Info],Auth-tag*)

2b. Authenticator --&gt; Peer: EAP-Finish/Re-auth(SEQ,keyName-NAI,
                             cryptosuite,[CB-Info],Auth-tag*)

* Auth-tag computation is over the entire EAP Initiate/Finish message; 
  the code values for Initiate and Finish are different and thus 
  reflection attacks are mitigated.

                            </pre>
<p></p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Qin Wu</span> editor
	  <span class="n hidden">
		<span class="family-name">Wu</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd.</span>
	<span class="adr">
	  <span>101 Software Avenue, Yuhua District</span>

	  <span class="vcardline">
		<span class="locality">Nanjing</span>,  
		<span class="region">JiangSu</span> 
		<span class="code">210012</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Sunseawq@huawei.com">Sunseawq@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Zhen Cao</span> 
	  <span class="n hidden">
		<span class="family-name">Cao</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>53A Xibianmennei Ave., Xuanwu District</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region">Beijing</span> 
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:caozhen@chinamobile.com">caozhen@chinamobile.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yang Shi</span> 
	  <span class="n hidden">
		<span class="family-name">Shi</span>
	  </span>
	</span>
	<span class="org vcardline">H3C Tech. Co., Ltd</span>
	<span class="adr">
	  <span>Digital Technology Plaza, NO.9 Shangdi 9th Street,Haidian District</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code">100085</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:young@h3c.com">young@h3c.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Baohong He</span> 
	  <span class="n hidden">
		<span class="family-name">He</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hebaohong@catr.cn">hebaohong@catr.cn</a></span>

  </address>
</div>

</body>
</html>