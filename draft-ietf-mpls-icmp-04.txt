


MPLS Working Group                                             R. Bonica
Internet-Draft                                                    D. Gan
Expires: March 24, 2006                                 Juniper Networks
                                                               D. Tappan
                                                     Cisco Systems, Inc.
                                                      September 20, 2005


           ICMP Extensions for MultiProtocol Label Switching
                        draft-ietf-mpls-icmp-04

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on March 24, 2006.

Copyright Notice

   Copyright (C) The Internet Society (2005).

Abstract

   This memo defines an extension to ICMP that permits Label Switching
   Routers to append MPLS information to ICMP messages.  This extension
   has already been widely deployed and this memo is introduced to
   describe existing practice.





Bonica, et al.           Expires March 24, 2006                 [Page 1]

Internet-Draft                  ICMP MPLS                 September 2005


Table of Contents

   1.  Conventions Used In This Document . . . . . . . . . . . . . . . 3
   2.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . . . 3
   3.  Architectural Considerations  . . . . . . . . . . . . . . . . . 4
   4.  Application to TRACEROUTE . . . . . . . . . . . . . . . . . . . 4
   5.  Disclaimer  . . . . . . . . . . . . . . . . . . . . . . . . . . 4
   6.  MPLS Stack Entry Object . . . . . . . . . . . . . . . . . . . . 5
   7.  Security Considerations . . . . . . . . . . . . . . . . . . . . 6
   8.  IANA Considerations . . . . . . . . . . . . . . . . . . . . . . 6
   9.  Normative References  . . . . . . . . . . . . . . . . . . . . . 6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . . . 7
   Intellectual Property and Copyright Statements  . . . . . . . . . . 8






































Bonica, et al.           Expires March 24, 2006                 [Page 2]

Internet-Draft                  ICMP MPLS                 September 2005


1.   Conventions Used In This Document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC2119 [1].


2.  Introduction

   IP routers use the Internet Control Message Protocol (ICMP) [2] to
   convey control information to source hosts.  Network operators use
   this information to diagnose routing problems.

   When a router receives an undeliverable IP datagram, it can send an
   ICMP message to the host that originated the datagram.  The ICMP
   message indicates why the datagram could not be delivered.  It also
   contains the IP header and leading payload octets of the "original
   datagram" to which the ICMP message is a response.

   MPLS Label Switching Routers (LSR) also use ICMP to convey control
   information to source hosts.  Sections 2.3 and 2.4 of RFC 3032 [3]
   describe the interaction between MPLS and ICMP.

   When an LSR receives an undeliverable MPLS encapsulated datagram, it
   removes the entire MPLS label stack, exposing the previously
   encapsulated IP datagram.  The LSR then submits the IP datagram to an
   error processing module.  Error processing can include ICMP message
   generation.

   The ICMP message indicates why the original datagram could not be
   delivered.  It also contains the IP header and leading octets of the
   original datagram.

   The ICMP message, however, contains no information regarding the MPLS
   label stack that encapsulated the original datagram when it arrived
   at the LSR.  This omission is significant because the LSR would have
   routed the original datagram based upon information contained by the
   MPLS label stack.

   This memo defines an extension to ICMP that permits an LSR to append
   MPLS label stack information to ICMP messages.  ICMP messages
   regarding MPLS encapsulated datagrams SHOULD include the MPLS label
   stack, as it arrived at the router that is sending the ICMP message.
   The ICMP message MUST also include the IP header and leading payload
   octets of the original datagram.

   The ICMP extensions defined in this document must be preceded by by
   an ICMP Extension Structure Header and an ICMP Object Header.  Both



Bonica, et al.           Expires March 24, 2006                 [Page 3]

Internet-Draft                  ICMP MPLS                 September 2005


   are defined in [4].


3.  Architectural Considerations

   Only layer 3 information should be included in ICMP messages.  MPLS
   information can be included only in so much as MPLS participates in
   layer 3 routing.  Layer 2 information (e.g., ethernet, PPP) should
   not be included in ICMP messages.


4.  Application to TRACEROUTE

   ICMP extensions defined in this memo support enhancements to
   TRACEROUTE.  The enhanced TRACEROUTE application, like older
   implementations, indicates which nodes the original datagram visited
   en route to its destination.  It differs from older implementations
   in that it also reflects the original datagram's MPLS encapsulation
   status as it arrived at each node.

   Figure 1 contains sample output from an enhanced TRACEROUTE
   implementation.



     > traceroute 10.100.6.1

     traceroute to 10.100.6.1 (10.100.6.1), 30 hops max, 40 byte packets

      1  10.1.1.2 (10.1.1.2)  0.661 ms  0.618 ms  0.579 ms

      2  10.1.12.2 (10.1.12.2)  0.861 ms  0.718 ms  0.679 ms

        MPLS Label=100048 Exp=0 TTL=1 S=1

      3  10.1.24.2 (10.1.24.2)  0.822 ms  0.731 ms  0.708 ms

        MPLS Label=100016 Exp=0 TTL=1 S=1

      4  10.100.6.1 (10.100.6.1)  0.961 ms  8.676 ms  0.875 ms


   Figure 1: Enhanced TRACEROUTE Sample Output


5.  Disclaimer

   This memo does not define the general relationship between ICMP and



Bonica, et al.           Expires March 24, 2006                 [Page 4]

Internet-Draft                  ICMP MPLS                 September 2005


   MPLS.  Sections 2.3 and 2.4 of RFC3032 define this relationship.

   The current memo does not define encapsulation specific TTL
   manipulation procedures.  It defers to Section 5.4 of RFC 3034 [5]
   and Section 10 of RFC 3035 [6] in this matter.

   When encapsulation specific TTL manipulation procedures defeat the
   basic TRACEROUTE mechanism, they will also defeat enhanced TRACEROUTE
   implementations.


6.  MPLS Stack Entry Object

   This section defines an ICMP extention object that can be appended to
   the ICMP Time Exceeded and Destination Unreachable messages.  A
   single instance of the MPLS Entry Object class represents the entire
   MPLS label stack, formatted exactly as it was when it arrived at the
   LSR that sends the ICMP message

   Figure 2 depicts the MPLS Stack Entry Object.  It must be preceded by
   an ICMP Extension Structure Header and an ICMP Object Header.  Both
   are defined in [4].

   In the object payload, octets 0-3 depict the first member of the MPLS
   label stack.  Each remaining member of the MPLS label stack is
   represented by another 4 octets that share the same format.



           MPLS Stack Entry Class = 1, C-Type = 1.

              0             1             2            3
      +-------------+-------------+-------------+-------------+
      |              Label               |EXP |S|     TTL     |
      +-------------+-------------+-------------+-------------+
      |                                                       |
      |       // Remaining MPLS Stack Entries //              |
      |                                                       |
      +-------------+-------------+-------------+-------------+

   Figure 2: MPLS Stack Entry Object

   Label: 20 bits

   Exp: Experimental Use, 3 bits

   S: Bottom of Stack, 1 bit




Bonica, et al.           Expires March 24, 2006                 [Page 5]

Internet-Draft                  ICMP MPLS                 September 2005


   TTL: Time to Live, 8 bits


7.  Security Considerations

   This memo presents no security considerations beyond those already
   presented by current ICMP applications (e.g., traceroute).


8.  IANA Considerations

   IANA should should reserve an object class and object type for the
   MPLS Stack Entry Object from the ICMP Extension Object registry.

9.  Normative References

   [1]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", BCP 14, RFC 2119, March 1997.

   [2]  Postel, J., "Internet Control Message Protocol", STD 5, RFC 792,
        September 1981.

   [3]  Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y., Farinacci, D.,
        Li, T., and A. Conta, "MPLS Label Stack Encoding", RFC 3032,
        January 2001.

   [4]  Bonica, R., "Extending the Internet Control Message Protocol
        (ICMP)", draft-bonica-internet-icmp-00 (work in progress),
        September 2005.

   [5]  Conta, A., Doolan, P., and A. Malis, "Use of Label Switching on
        Frame Relay Networks Specification", RFC 3034, January 2001.

   [6]  Davie, B., Lawrence, J., McCloghrie, K., Rosen, E., Swallow, G.,
        Rekhter, Y., and P. Doolan, "MPLS using LDP and ATM VC
        Switching", RFC 3035, January 2001.















Bonica, et al.           Expires March 24, 2006                 [Page 6]

Internet-Draft                  ICMP MPLS                 September 2005


Authors' Addresses

   Ronald P. Bonica
   Juniper Networks
   2251 Corporate Park Drive
   Herndon, VA  20171
   US

   Email: rbonica@juniper.net


   Der-Hwa Gan
   Juniper Networks
   1194 N. Mathilda Ave.
   Sunnyvale, CA  94089
   US

   Email: dhg@juniper.net


   Daniel C. Tappan
   Cisco Systems, Inc.
   250 Apollo Drive
   Chelmsford, MA  01824
   US

   Email: tappan@cisco.com
























Bonica, et al.           Expires March 24, 2006                 [Page 7]

Internet-Draft                  ICMP MPLS                 September 2005


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Disclaimer of Validity

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY AND THE INTERNET
   ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED,
   INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
   INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Copyright Statement

   Copyright (C) The Internet Society (2005).  This document is subject
   to the rights, licenses and restrictions contained in BCP 78, and
   except as set forth therein, the authors retain all their rights.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.




Bonica, et al.           Expires March 24, 2006                 [Page 8]


