<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Email Policy Service ASN.1 Processing</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Email Policy Service ASN.1 Processing">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Schaad</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Soaring Hawk Consulting</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">January 21, 2011</td></tr>
<tr><td class="header">Expires: July 25, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Email Policy Service ASN.1 Processing<br />draft-schaad-eps-smime-00</h1>

<h3>Abstract</h3>

<p>When using the Email Policy Service model, there exist the communications with the policy server which are based in XML and there are the communications which are S/MIME based and thus done in ASN.1.  This document covers the ASN.1 requirements and the modifications in S/MIME processing needed to implement an Email Policy Service system.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 25, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Terminology<br />
<a href="#model">2.</a>&nbsp;
Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Sender<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#model-recip">2.3.</a>&nbsp;
Recipient<br />
<a href="#RI">3.</a>&nbsp;
Recipient Info Encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#eps-oka">3.1.</a>&nbsp;
EPS Other Key Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
EPS Content Type<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#extend">3.2.1.</a>&nbsp;
Extensibility<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.2.2.</a>&nbsp;
Multiple KEKs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.3.</a>&nbsp;
EPS URL Authenticated Attribute<br />
<a href="#sender">4.</a>&nbsp;
Sender Processing Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.1.</a>&nbsp;
Flow<br />
<a href="#recipient">5.</a>&nbsp;
Recipient Processing Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.1.</a>&nbsp;
Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.2.</a>&nbsp;
Reply and Forward Processing<br />
<a href="#anchor21">6.</a>&nbsp;
Policy Server Processing Rules<br />
<a href="#anchor22">7.</a>&nbsp;
Missing Pieces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">7.1.</a>&nbsp;
Sender/Policy Server Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">7.2.</a>&nbsp;
Recipient/Policy Server Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">7.3.</a>&nbsp;
MLA/Policy Server Protocol<br />
<a href="#algs">8.</a>&nbsp;
Manditory Algorithms<br />
<a href="#anchor26">9.</a>&nbsp;
Security Considerations<br />
<a href="#anchor27">10.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">11.</a>&nbsp;
Normative References<br />
<a href="#anchor29">Appendix&nbsp;A.</a>&nbsp;
2009 ASN.1 Module<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In the traditional e-mail system, the sender of a message is responsible for determining the list of recipiemnts for a message, obtaining a valid public or group key for each recipient, applying a security label to a message, and sending the message.  The recipient of a message is responsible for the enforcement of any security labels on a message.  While this system works in theory, in practice it has some difficulties that have lead to problems in getting S/MIME mail widely deployed.  This document is part of an effort to provide an alternative method of allocating the responsiblities above to different entities in an attempt to make the process work better.
</p>
<p>In an Email Policy Service deployment of S/MIME, the sender of the message is still responsible for determing the list of recipients for the message and determining the security label to be applied to the message, however the responsiblity of obtaining valid keys for each recipient is off-loaded to the policy server component.  The recipient is no longer responible for enforcment of the policy as this is also off-loaded to the policy server component.  Doing this allows for the following changes in behavior of the system:
        </p>
<ul class="text">
<li>The sender is no longer responsible for finding and validating the set of public keys used for the message.  This simplifies the complexity of the sender and lowers the resources required by the sender.
</li>
<li>The set of recipients that can decrypt the message can now be change dynamically after the message is sent, without resourting to a group keying stratigy.
</li>
<li>The enforcement of the policy is now done centrally, this means that updates to the policy are instantanous and the enforcement policy can be centerally audited.
</li>
<li>Since the label enforcement is done before the message is decrypted, there are no concerns about the message contents being leaked by poor client implemenations.
</li>
<li>Many of the same components used in a web-based deployment of policy enforcement in a confederation can be used for e-mail based deployment of information.
</li>
</ul><p>
      
</p>
<p>This document is layed out as follows:
        </p>
<ul class="text">
<li>In <a class='info' href='#model'>Section&nbsp;2<span> (</span><span class='info'>Model</span><span>)</span></a> a more complete discription of the components involved in the model are discussed.
</li>
<li>In <a class='info' href='#RI'>Section&nbsp;3<span> (</span><span class='info'>Recipient Info Encoding</span><span>)</span></a> I describe the new ASN.1 structures that are used to carry the additional information, and the way that these structures are used in a recipient info structure.
</li>
<li>In <a class='info' href='#sender'>Section&nbsp;4<span> (</span><span class='info'>Sender Processing Rules</span><span>)</span></a> I describe the modifications from the sender processing rules outlined in <a class='info' href='#SMIME-MSG'>[SMIME&#8209;MSG]<span> (</span><span class='info'>Ramsdell, B. and S. Turner, &ldquo;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification,&rdquo; January&nbsp;2010.</span><span>)</span></a>.
</li>
<li>In <a class='info' href='#recipient'>Section&nbsp;5<span> (</span><span class='info'>Recipient Processing Rules</span><span>)</span></a> I describe the modification from the recipient processing rules outlined in <a class='info' href='#SMIME-MSG'>[SMIME&#8209;MSG]<span> (</span><span class='info'>Ramsdell, B. and S. Turner, &ldquo;Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification,&rdquo; January&nbsp;2010.</span><span>)</span></a>.
</li>
</ul><p>
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Model</h3>

<p>To be supplied from the problem statement document.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>To be supplied from the problem statement document.
</p><br /><hr class="insert" />
<a name="fig1"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
                    (1)(2)(6)
        (3)(5)     +----------+    (7)
      +------------|Sending   |-------------+
      |            |Agent     |             |
(4)   |            +----------+             |
+----------+                           +---------+
|Email     |                           |Mail     |
|Policy    |                           |Transfer |
|Service   |                           |Agent    |
+----------+                           +---------+
 (4)  |            +----------+             |
      |            |Receiving |             |
      +------------|Agent     |-------------+
        (3)(5)     +----------+    (1)
                     (2)(6)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Message Access Control Actors&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>List the boxes above and give some info about them.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Sender</h3>

<p>The general steps that need to be taken by the sender of an EPS message are listed below.  The steps refer to the numbers in the upper halve of <a class='info' href='#fig1'>Figure&nbsp;1<span> (</span><span class='info'>Message Access Control Actors</span><span>)</span></a>.  Talk about the expansion in section x.x
</p>
<p>
          </p>
<ol class="text">
<li>The Sending Agent composes the message, determines the set of recipients and a policy label to be applied to the message.
</li>
<li>The Sending Agent randomly creates a KEK.
</li>
<li>The Sending Agent transmits the KEK, the list of recipents and the policy label to the Email Policy Service.  One possible protocol for this is <a class='info' href='#EPS-WS-TRUST'>[EPS&#8209;WS&#8209;TRUST]<span> (</span><span class='info'>Schaad, J., &ldquo;Using WS Trust as an EPS protocol,&rdquo; December&nbsp;2010.</span><span>)</span></a>.
</li>
<li>The Email Policy Service validates that the set of recipients, the sender and policy label are consistant.
</li>
<li>The Email Policy Service returns an EPS-KEK attribute to the Sending Agent.
</li>
<li>The Sending Agent creates a normal S/MIME encrypted data message, one of the recipient info structures being a KEK recipient using the KEK created in step 2 and the EPS-KEK attribute from step 5.
</li>
<li>The Sending Agent send the mesage to the Mail Transfer Agent using SMTP or a simliar protocol.
</li>
</ol><p>
        
</p>
<a name="model-recip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Recipient</h3>

<p>The general steps that need to be taken by a Reciving Agent for an EPS messaging system.  The steps refer to the bottom half ov <a class='info' href='#fig1'>Figure&nbsp;1<span> (</span><span class='info'>Message Access Control Actors</span><span>)</span></a>.  An expansion of this is covered in <a class='info' href='#recipient'>Section&nbsp;5<span> (</span><span class='info'>Recipient Processing Rules</span><span>)</span></a>.
</p>
<p>
          </p>
<ol class="text">
<li>The Recieving Agent obtains the message from a Mail Transfer Agent using IMAP, POP or simliar protocol.
</li>
<li>The Recieving Agent recognizes that a KEK recipient info with an EPS-KEK attribute exists and validates the attribute.
</li>
<li>The Recieving Agent sends the KEK idnetifer and the EPS-KEK attribute along with other information to the Email Policy Service.
</li>
<li>The Email Policy Service evalutes the policy label and the recipient information.
</li>
<li>The Email Policy Service returns the KEK to the Recieving Agent.
</li>
<li>The Recieving Agent decrypts the message and displays it to the user.
</li>
</ol><p>
        
</p>
<a name="RI"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Recipient Info Encoding</h3>

<p>When creating an Email Policy S/MIME message we use the Other Key Attribute field in the KEKRecipentInfo.kekid structure to hold the required information about how to find the KEK that is required to decrypt the message.  For the convenience of the reader we include the KEKRecipientInfo structure and its pieces here:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
KEKRecipientInfo ::= SEQUENCE {
    version CMSVersion,  -- always set to 4
    kekid KEKIdentifier,
    keyEncryptionAlgorithm KeyEncryptionAlgorithmIdentifier,
    encryptedKey EncryptedKey }

KEKIdentifier ::= SEQUENCE {
    keyIdentifier OCTET STRING,
    date GeneralizedTime OPTIONAL,
    other OtherKeyAttribute OPTIONAL }

OtherKeyAttribute ::= SEQUENCE {
    keyAttrId  KEY-ATTRIBUTE.
            &amp;id({SupportedKeyAttributes}),
    keyAttr    KEY-ATTRIBUTE.
            &amp;Type({SupportedKeyAttributes}{@keyAttrId})}
</pre></div>
<p> When you look at the KEKRecipientInfo structure you fill out the fields as follows:
        </p>
<blockquote class="text"><dl>
<dt>version</dt>
<dd>is set to the value of 4.
</dd>
<dt>kekid</dt>
<dd>is a sequence where the fields are:
            
<blockquote class="text"><dl>
<dt>keyIdentifier</dt>
<dd>is a randomly generated value.  The value is created without any internal symantics and should be unique within the message.  It is suggested that the value be between 20 and 30 octets in length.
</dd>
<dt>date</dt>
<dd>is not used and should be omitted.
</dd>
<dt>other</dt>
<dd>is a sequence where the fields are:
                
<blockquote class="text"><dl>
<dt>keyAttrId</dt>
<dd>contains the value id-keyatt-eps-token.
</dd>
<dt>keyAttr</dt>
<dd>contains a SignedData structure.  The internal details of this data structure are covered in <a class='info' href='#eps-oka'>Section&nbsp;3.1<span> (</span><span class='info'>EPS Other Key Attribute</span><span>)</span></a>.
</dd>
</dl></blockquote>
              
</dd>
</dl></blockquote>
          
</dd>
<dt>keyEncryptionAlgorithm</dt>
<dd>contains the identifier and the type information for the key encryption algorithm.  <a class='info' href='#algs'>Section&nbsp;8<span> (</span><span class='info'>Manditory Algorithms</span><span>)</span></a> lays out the manditory algorithms.  This algorithm must be understandable by the sender of the message and by the recipient of the message, but it is not a requirement that the Email Policy Server can process the algorithm.
</dd>
<dt>encryptedKey</dt>
<dd>contains the content encryption key encrypted by the key encryption key.
</dd>
</dl></blockquote><p>
      
</p>
<a name="eps-oka"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
EPS Other Key Attribute</h3>

<p>The EPS Other Key Attribute functions as the lock box for the key encryption key used in encrypting the content encryption key.  In addition to the KEK, the lock box also contains the information that is needed by the Email Policy Server to know the policy(s) applied to the encrypted data and possible parameters for the policy.
</p>
<p>The relevant section from the ASN.1 module which contains the content is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   --
   --
   --

   keyatt-eps-kek KEY-ATTRIBUTE ::= {
      SignedData IDENTIFIED BY id-keyatt-eps-token
   }

   id-keyatt-eps-token OBJECT IDENTIFIER ::= {1 1 1 1 2}
</pre></div>
<p>We define a new KEY-ATTRIBUTE called keyatt-eps-kek.  This attribute is identified by the id-keyatt-eps-token.  The data structure that is assocated with this key attribute is the CMS SignedData structure.
</p>
<p>When you look at the SignedData structure, the fields are filled in as follows (some less signficant fields are omitted):
          </p>
<blockquote class="text"><dl>
<dt>encapContentInfo</dt>
<dd> is a structure containing the fields:
              
<blockquote class="text"><dl>
<dt>eContentType</dt>
<dd> is id-envelopedData.
</dd>
<dt>eContent</dt>
<dd> is CMS EnvelopedData structure with the following fields:
                  
<blockquote class="text"><dl>
<dt>recipientInfos</dt>
<dd> contains the lock box for the Email Policy Server to get access to the data encrypted in this object.  See below for some additional dicussion on what lock boxes need to be created.
</dd>
<dt>encryptedContentInfo</dt>
<dd> is a structure containing the following elements:
                      
<blockquote class="text"><dl>
<dt>contentType</dt>
<dd> is id-ct-eps-LockBox.
</dd>
<dt>contentEncryptionAlgorithm</dt>
<dd> contains the identifier and parameters for the content encryption algorithm.  This algorithm only needs to be understood by the Email Policy Service.
</dd>
<dt>encryptedContent</dt>
<dd> contains the encrypted EPS LockBox content.  Details on this type are in the next section.
</dd>
</dl></blockquote>
                    
</dd>
</dl></blockquote>
                
</dd>
</dl></blockquote>
            
</dd>
<dt>certificates</dt>
<dd> SHOULD contain the set of certificates (up to but not including the trust anchor) needed to validate the set of signer info structures.
</dd>
<dt>signerInfos</dt>
<dd> will contain one or more signer info structures.  In each signature the signed attributes:
              
<blockquote class="text"><dl>
<dt></dt>
<dd>MUST contain the signing time, the message digest, the content type and the EPS url attributes.
</dd>
<dt></dt>
<dd>MAY contain the ESS security label attribute.
</dd>
<dt></dt>
<dd>other attributes can also be included.
</dd>
</dl></blockquote>
            
</dd>
</dl></blockquote><p>
        
</p>
<p>When creating the recipient info structures for the EnvelopedData structure, there will normally only need to be a single entry in the sequence as the only entity that needs to decrypt the EPS Lockbox is the Email Policy Service.  In the event that the service is distributed over multiple servers then multiple lock boxes may need to be created.  One of the implications of the fact that the originator of the message is the only recipient is that, although the signing key needs to be contained in a certificate, there is no corresponding requirement that the encryption key needs to be in a certificate.  Instead of using a certificate, a subject key identifer that is meaningful only to the Email Policy Service can be used.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
EPS Content Type</h3>

<p>The innermost content type for an EPS Other Key Attribute is always an EPS Lockbox.  This content is always contained in an encrypted CMS object which is encrypted for the Email Policy server itself, as such the contents and structure is known just to the EPS server.
</p>
<p>The relevant section from the ASN.1 module which devines this content is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   --
   --  EPS Content Type
   --

   ct-eps-LockBox CONTENT-TYPE ::= {
       TYPE EPS-LockBox
       IDENTIFIED BY id-ct-eps-LockBox
   }

   id-ct-eps-LockBox OBJECT IDENTIFIER ::= {1 1 1 1}

   EPS-LockBox ::= SEQUENCE {
      label        OneLabel,
      keyList      KeyList
   }

   KeyList ::= SEQUENCE {
      namedRecipients    [0] SEQUENCE SIZE (1..MAX) OF
                                NamedRecipient OPTIONAL,
      defaultRecipients  [1] SEQUENCE SIZE (1..MAX) OF
                                OneKek OPTIONAL
   }

   NamedRecipient ::= SEQUENCE {
      recipient    IA5String, -- name of the recipient
      kekValues    SEQUENCE SIZE (1..MAX) OF SEQUENCE {
         kekIdentifier          OCTET STRING,
         keyValue               RecipientInfo
      }
   }

   OneKek ::= SEQUENCE {
      kekIdentifier       OCTET STRING,
      kekValue            OCTET STRING
   }

   OneLabel ::= CHOICE {
        andLabels     [1] SEQUENCE SIZE (2..MAX) OF OneLabel,
        orLabels      [2] SEQUENCE SIZE (2..MAX) OF OneLabel,
        exclude       [3] SEQUENCE SIZE (2) OF OneLabel,
        uriLeaf       [4] SEQUENCE {
            policyId        UTF8String,
            names           SEQUENCE SIZE (1..MAX) OF
                                IA5String OPTIONAL
        },
        oidLeaf       [5] ESSSecurityLabel,
        ...
   }
</pre></div>
<p>In the above ASN.1, the following items are defined:
          </p>
<blockquote class="text"><dl>
<dt>ct-eps-LockBox</dt>
<dd> is a new CMS content type object, this object is to be added to the conten type object set ContentSet in <a class='info' href='#CMS-ASN'>[CMS&#8209;ASN]<span> (</span><span class='info'>Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for Cryptographic Message Syntax (CMS) and S/MIME,&rdquo; June&nbsp;2010.</span><span>)</span></a>.
</dd>
<dt>id-ct-eps-LockBox</dt>
<dd> is the identifier defined for the new content type.
</dd>
<dt>EPS-LockBox</dt>
<dd> is the new type defined for new content type.  This is a sequence <a class='info' href='#comment.anchor6'>[anchor6]<span> (</span><span class='info'>JLS: I wonder if this should be a sequence of rather than a sequence so that you can define multiple KEK values each with a different label on it as well as a set of KEKs that have a single common label.</span><span>)</span></a><a name='anchor6'></a> with the following fields:
              
<blockquote class="text"><dl>
<dt>label</dt>
<dd> contains the policy label that is to be applied to the KEK values in the keyList field.
</dd>
<dt>keyList</dt>
<dd> contains the KEK values.
</dd>
</dl></blockquote>
            
</dd>
<dt>KeyList</dt>
<dd> is a new type that contains the KEK values or the KeyRecipientInfo structures.  This allows for messages to be sent with either early-binding, where a RecipientInfo structure is filled out for the recieving agent, or late-binding, where the KEK value is sent from the Email Policy Service to the recieving agent.
              
<blockquote class="text"><dl>
<dt>namedRecipients</dt>
<dd> contains the recipient info structures for individually identified recipients.
</dd>
<dt>defaultRecipients</dt>
<dd> contains the KEK keys for those recipients that are not individual identified with their own recipient info structures.
</dd>
</dl></blockquote>
            
</dd>
<dt>NamedRecipient</dt>
<dd> contains the information identifying a single named recpient along with the recipient info structures for that recipient.
              
<blockquote class="text"><dl>
<dt>recipient</dt>
<dd> contains the name of the name of the recipient in the form of an RFC2822 email address.
</dd>
<dt>kekValues</dt>
<dd> contains the recipient info structures for the named recipient.  The information is contained in a sequence of values, one for each possible encrypted block.  The fields in the sequence are:
                  
<blockquote class="text"><dl>
<dt>kekIdentifier</dt>
<dd> contains the value of the kek identifier in the message.
</dd>
<dt>keyValue</dt>
<dd> contains a recpient info structure wrapping the CEK of the message.
</dd>
</dl></blockquote>
                
</dd>
</dl></blockquote>
            
</dd>
<dt>OneKek</dt>
<dd> contains the information that defines a single KEK to be used.  The sequence has the fields:
              
<blockquote class="text"><dl>
<dt>kekIdentifier</dt>
<dd> contains the identification value for the KEK.  This value matches the KEKIdentifier.keyIdentifier value in the recipient info information.
</dd>
<dt>kekValue</dt>
<dd> contains the KEK value.
</dd>
</dl></blockquote>
            
</dd>
<dt>OneLabel</dt>
<dd> is the type structure used to specify the individual policies and how the policies interact with each other.  The structure is explicitly setup to be extensible in future versions.  Information on how the extensisbility should be handled is in <a class='info' href='#extend'>Section&nbsp;3.2.1<span> (</span><span class='info'>Extensibility</span><span>)</span></a>.  The choices in the structure are:
              
<blockquote class="text"><dl>
<dt>andLabels</dt>
<dd>allows for a set of policies to be combined together in such as way as to state that for the overall statement to be true, each of the policies listed must also be true.  The ASN.1 is designed so that there must be at least two elements in the combined statement.
</dd>
<dt>orLabels</dt>
<dd>allows for a set of policies to be combined together in such a way as to state that for the overall statement to be true, any of the policies listed needs to be true.  The ASN.1 is designed so that there must be at least two elementsin the combined statement.
</dd>
<dt>exclude</dt>
<dd>allows for two policies to be combined together such as to state that for the overall policy to be true, the first policy must be true and the second policy must not be true.  This policy combination is designed to remove a set of people from the over all policy.  (I.e. every one in the general group but is not working for company X.)
</dd>
<dt>uriLeaf</dt>
<dd>allows for the specifiction of a policy as a URI.  If the policy is unknown then the policy evaluation fails.  The use of a URI allows for the addition of parameters to be added to the policy statement.<a class='info' href='#comment.anchor7'>[anchor7]<span> (</span><span class='info'>JLS: Do we want to change the type?  What do we want to say about internaltionalization?</span><span>)</span></a><a name='anchor7'></a>
</dd>
<dt>oidLeaf</dt>
<dd>allows for the specifiction of a policy as an object identifier.  THere is no option to provide for parameters. <a class='info' href='#comment.anchor8'>[anchor8]<span> (</span><span class='info'>JLS: We could add such an option if we desired.</span><span>)</span></a><a name='anchor8'></a> An unrecognized policy to evaluated as fails.
</dd>
</dl></blockquote>
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="extend"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Extensibility</h3>

<p>The ASN.1 type OneLabel has been explicitly defined to allow for later extensibility.  When a new element is added, it will be added with at the end of the choice with a different tag value.  ASN.1 decoders need to following the current recommendations on dealing with extensibility.  This means that when the decoder finds a new choice in this structure that is not part of the current syntax, the element should be treated as an unknown blob and returned to the caller as an unrecognized blob.  This allows for the calling code to make the decision on how the unknown element is treated.
</p>
<p>However the extensisiblity is not handled the same in all cases.  Each of the four different cases is outlined below.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.1"></a><h3>3.2.1.1.&nbsp;
Sender Composing</h3>

<p>The set of policies that can be used by the sender in applying a label is usually given as a list of policies, however under some circumstances the sender may be handed structured policies either for application or for checking that some policies can be used together.  If structured policies are provided to the sender, it will not matter to the sender that they cannot evaluate the policy unless the details are to be shown to the sending user.  Following the current ASN.1 rules which allow for the decoding and then re-encoding of a type which contains unknown nodes allows the sending agent the most flexiblity.
</p>
<p>The protocol used to give the policy information to the sending client may not use the ASN.1 structure provided here or configuration purposes but would generally be expected to provide for a different data format.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.2"></a><h3>3.2.1.2.&nbsp;
Sender to Email Policy Service</h3>

<p>In the sending agent to Email Policy Service protoocl (defined external to this document) the ASN.1 type OneLabel may or may not be used directly.  If it is used, then the Email Policy Server is expected to reject the label if it contiains elements which it does not understand.  The general expectation is that the Email Policy Service that the sender is communicating with is going to be the same one as is later enforcing the policy. It makes no sense for this server to accept a policy that it would later be unable to enforce.  The protocol should make provisions for the return of this as an explicit error code.  Having the ASN.1 decoded allows for the communication of the exact tag that is causing the problem.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.3"></a><h3>3.2.1.3.&nbsp;
Recipient to Email Policy Service</h3>

<p>The Email Policy Service which recipient communicates way is normally the same server as the sender communicated with.  However the server can be a different server, or the server may have been downgraded in the mean time.  In this case the policy evaluation need to be conservative.  There are two different way s of doing this evaluation.  The first option is to say that if an unknown node is found, then the policy evaluation fails for all cases.  The second option is to try and evaluation the policy, but to do so in a conserative manner.  If the second option is chosen then the following rules are used:
                </p>
<blockquote class="text"><dl>
<dt>uriLeaf</dt>
<dd> results in true, false or unknown.  The unknown state results if the policy is unknown or cannot currently be evaluated.
</dd>
<dt>oidLeaf</dt>
<dd>  results in true, false or unknown.  The unknown state results if the policy is unknown or cannot currently be evaluated.
</dd>
<dt>andLabels</dt>
<dd> results in false if any input node is false.  It results in true if all of the input nodes are true.  Otherwise it results in unknown.
</dd>
<dt>orLabels</dt>
<dd> results in unknown if any input node is unknown.  It results in true if any node is true and no nodes are unknown.  Otherwise it results in false.
</dd>
<dt>exclude</dt>
<dd> results in false if the second input is true or unknown. It results in true if the first input is true and the second is false.  Otherwise it results in unknown.
</dd>
</dl></blockquote><p>
                If the final node results in true, then access is gracted.  If the final result is either false or unknown then access is denied.  Any future element that is added to the choice needs to define a similar rule to the set of rules above.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1.4"></a><h3>3.2.1.4.&nbsp;
Recipient User Agent Display</h3>

<p>Recipient user agents may want to display the policy to the user.  This policy may be communicated from the Email Policy Service to the recipient using the OneLabel ASN.1 structure or using a different type.  The label has been successfully (or unsuccessfully) validated so access has been granted (or denied) to the message.  At this point we are only talking about a user interface issue.  The recipient user agent should make some type of provision for indicating that an operation was placed in that location of the tree, but the agent is not aware of what the operation is.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Multiple KEKs</h3>

<p>Discuss cases where multiple KEKs are placed in the message.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
EPS URL Authenticated Attribute</h3>

<p>It is required that the name of the Email Policy Server be securely communicated to the message recipient.  For this purpose a URL is used as this can communicate both a server name, but also additional parameters that can be used to identify a specific service on the server.
</p>
<p>The relevent section from the ASN.1 module for this attribute is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   --
   --  Define the Signed Attribute to carry the
   --       Email Policy Server URL
   --
   --  This attribute is added to the SignedAttributSet set of
   --  attributes in [CMS-ASN]
   --

   aa-eps-url ATTRIBUTE ::= {
      TYPE UTF8String IDENTIFIED BY id-aa-eps-url
   }

   id-aa-eps-url OBJECT IDENTIFIER ::= {1 1 1 1 1 3}
</pre></div>
<p>From this we can see the following:
          </p>
<blockquote class="text">
<p>A new attribute aa-eps-url has been defined.
</p>
<p>The OID value of id-aa-eps-url has been created to identify the new attribute.
</p>
<p>The type of the value associated with the attribute is a UTF8String which contains the URL for the Email Policy Server.  <a class='info' href='#comment.anchor15'>[anchor15]<span> (</span><span class='info'>jls: It might be that we should use IA5String for this depending on how you feel about the ability to include i18n strings in the domain name.  I.e. should it be done before it is placed here or afterwords?</span><span>)</span></a><a name='anchor15'></a><a class='info' href='#comment.anchor16'>[anchor16]<span> (</span><span class='info'>jls: Do we care about allowing things other than http here?  For example should these be specified as soap:... URIs?</span><span>)</span></a><a name='anchor16'></a>
</p>
<p>The new attribute is to appear only as a Signed Attribute in a SignedData structure.  It is therefore to be added to the attribute set SignedAttributeSet in the update ASN.1 module contained in <a class='info' href='#CMS-ASN'>[CMS&#8209;ASN]<span> (</span><span class='info'>Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for Cryptographic Message Syntax (CMS) and S/MIME,&rdquo; June&nbsp;2010.</span><span>)</span></a>.
</p>
</blockquote><p>
        
</p>
<p>The attribute structure defined for signed attributes allows for multiple values to be carried in a single attribute.  For this attribute there MUST be at least one value.  If there is more than one value, each value MUST be a unique.
</p>
<p>This attribute is only included in a SignedData object by an Email Policy Server.  There are no processing rules for the sender of a message.  The processing rules for a recipient can be found in <a class='info' href='#recipient'>Section&nbsp;5<span> (</span><span class='info'>Recipient Processing Rules</span><span>)</span></a>.
</p>
<a name="sender"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Sender Processing Rules</h3>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Flow</h3>

<p>This is the set of processing steps that a sender needs to do:
          </p>
<ol class="text">
<li>Sender Agent obtains the set of policies under which it can send a message.
</li>
<li>Sender Agent composes the message content.
</li>
<li>Sender Agent determines the policy label to be applied to the message.
</li>
<li>Sender Agent determines the set of recipients for the message.
</li>
<li>Sender Agent randomly creates the KEK.
</li>
<li>Sender Agent transmits the KEK, the list of recipients and the policy label to the EPS.
</li>
<li>Sender Agent recieves an EPS-KEK attribute from the policy server.  If the policy validation fails then the sender agent cannot send the message under the current policy label.
</li>
<li>Sender Agent verifies the signature on the signed data structure inside of the EPS-KEK attribute.
              
<ol class="text">
<li>Signature is current and passes cryptographic processing.
</li>
<li>Signed attributes contains the EPS URL attribute, and the attribute is consistant with the policy selected.
</li>
<li>Other checks
</li>
</ol>
            
</li>
<li>Sender Agent selects an appropriate content encryption algorithm and randomly generates a CEK and encrypts the message.
</li>
<li>Sender Agent creates a KEK recipient info structure with the EPS-KEK attribute.  Sender Agent also creates all other necessary recipient info structures including one itself if required.
</li>
<li>Sender Agent finishs encoding the message and transmits it to the MTA.
</li>
</ol><p>
        
</p>
<a name="recipient"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Recipient Processing Rules</h3>

<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Flow</h3>

<p>In this section we expand on the list of actions that are <a class='info' href='#model-recip'>Section&nbsp;2.3<span> (</span><span class='info'>Recipient</span><span>)</span></a>.  When looking at the validation steps that are given here, the results need to be the same but the order that the steps are taken can be different.  As an example, it can make sense to do the policy check in step X before doing the signature validation as this would not require any network access.
</p>
<p>This is the set of processing that the recipient needs to do:
          </p>
<ol class="text">
<li>The Recieving Agent obtains the message from a Mail Transfer Agent using IMAP, POP or a similar protocol.
</li>
<li>The Recieving Agent recognizes that a KEK recipient info exists with an EPS-KEK attribute.  It is recommended that the entire list of recipient info structures be checked for one that can be processed directly before processing this node.
</li>
<li>The Recieving Agent validates the EPS-KEK attribute.  THe following steps need to be taken for validation.
              
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>The signature on the SignedData structure is validated.  If the validation fails then processing ends.  If more than one SignerInfo element exists on the structure, then the validation succeeds and the signed attributes from that SignerInfo structure are used.  The order of performing the validation of the SignerInfo structures may be influenced by the content of EPS URL attribute.
</dd>
<dt>B.</dt>
<dd>If an ESS security label attribute (<a class='info' href='#ESS-BASE'>[ESS&#8209;BASE]<span> (</span><span class='info'>Hoffman, P., &ldquo;Enhanced Security Services for S/MIME,&rdquo; June&nbsp;1999.</span><span>)</span></a>) is present, then it must be evaluated and processing ends if the security label processing fails or is denied.
</dd>
<dt>C.</dt>
<dd>The EPS URL attribute is absent, then processing fails.
</dd>
<dt>D.</dt>
<dd>The URL value in the EPS URL attribute is checked againist local policy.  If the check fails then processing fails.  This check is performed so that information about the user is not given to random Email Policy Services.
</dd>
<dt>E.</dt>
<dd>...Other steps....
</dd>
</dl></blockquote>
            
</li>
<li>The recipient gathers the necessary identity and attribute statements, usual certificates or SASL statements. <a class='info' href='#comment.anchor19'>[anchor19]<span> (</span><span class='info'>JLS: At the present we don't give any idea of how this is to be done.</span><span>)</span></a><a name='anchor19'></a>
</li>
<li>The recipient establishing a secure connection to the Email Policy server and passes in the identity and attribute statements.
</li>
</ol><p>
        
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Reply and Forward Processing</h3>

<p>Cover the fact that a token should be returned when a message is read so that a reply message can be sent even if they do not normally have permission to send a message.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Policy Server Processing Rules</h3>

<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Missing Pieces</h3>

<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Sender/Policy Server Protocol</h3>

<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Recipient/Policy Server Protocol</h3>

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
MLA/Policy Server Protocol</h3>

<a name="algs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Manditory Algorithms</h3>

<p>KEK manditory to implement algorithms - MUST AES-128 KEK Wrap. SHOULD AES-256 KEK wrap.
</p>
<p>Key Transport - MUST RSA v 1.5
</p>
<p>Key Agreement - MUST EC-DH for group ...
</p>
<p>Content Encryption - MUST AES-128.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>Man in the middle attack on the protocol from the sending agent to the email policy server.
</p>
<p>Man in the middle attack on the protocol from the recieving agent to the email policy server.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>No action by IANA is required for this document.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CMS-ASN">[CMS-ASN]</a></td>
<td class="author-text">Hoffman, P. and J. Schaad, &ldquo;<a href="http://tools.ietf.org/html/rfc5911">New ASN.1 Modules for Cryptographic Message Syntax (CMS) and S/MIME</a>,&rdquo; RFC&nbsp;5911, June&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5911.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="EPS-WS-TRUST">[EPS-WS-TRUST]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-TBD.txt">Using WS Trust as an EPS protocol</a>,&rdquo; draft-TBD (work in progress), December&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-TBD">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="ESS-BASE">[ESS-BASE]</a></td>
<td class="author-text"><a href="mailto:phoffman@imc.org">Hoffman, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2634">Enhanced Security Services for S/MIME</a>,&rdquo; RFC&nbsp;2634, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2634.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMIME-MSG">[SMIME-MSG]</a></td>
<td class="author-text">Ramsdell, B. and S. Turner, &ldquo;<a href="http://tools.ietf.org/html/rfc5751">Secure/Multipurpose Internet Mail Extensions (S/MIME) Version 3.2 Message Specification</a>,&rdquo; RFC&nbsp;5751, January&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5751.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.comments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Editorial Comments</h3>
<table border="0">
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor6">
anchor6</a><a name="comment.anchor6"></a>:
</td><td class="author-text">
JLS: I wonder if this should be a sequence of rather than a sequence so that you can define multiple KEK values each with a different label on it as well as a set of KEKs that have a single common label.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor7">
anchor7</a><a name="comment.anchor7"></a>:
</td><td class="author-text">
JLS: Do we want to change the type?  What do we want to say about internaltionalization?</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor8">
anchor8</a><a name="comment.anchor8"></a>:
</td><td class="author-text">
JLS: We could add such an option if we desired.</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor15">
anchor15</a><a name="comment.anchor15"></a>:
</td><td class="author-text">
jls: It might be that we should use IA5String for this depending on how you feel about the ability to include i18n strings in the domain name.  I.e. should it be done before it is placed here or afterwords?</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor16">
anchor16</a><a name="comment.anchor16"></a>:
</td><td class="author-text">
jls: Do we care about allowing things other than http here?  For example should these be specified as soap:... URIs?</td></tr>
<tr><td class="author-text" valign="top">
<a class="info" href="#anchor19">
anchor19</a><a name="comment.anchor19"></a>:
</td><td class="author-text">
JLS: At the present we don't give any idea of how this is to be done.</td></tr>
</table>

<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
2009 ASN.1 Module</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
PolicySMime -- TBD Get a module number --
DEFINITIONS EXPLICIT TAGS ::=
BEGIN
  IMPORTS
   -- Cryptographic Message Syntax (CMS) [RFC5652]

   CONTENT-TYPE, RecipientInfo, KEY-ATTRIBUTE, SignedData
   FROM  CryptographicMessageSyntax-2009
     { iso(1) member-body(2) us(840) rsadsi(113549)
       pkcs(1) pkcs-9(9) smime(16) modules(0) id-mod-cms-2004-02(41) }

   -- Common PKIX structures [RFC5912]

   ATTRIBUTE
   FROM PKIX-CommonTypes-2009
     { iso(1) identified-organization(3) dod(6) internet(1)
       security(5) mechanisms(5) pkix(7) id-mod(0)
       id-mod-pkixCommon-02(57)}

   ESSSecurityLabel
   FROM ExtendedSecurityServices-2009
      { iso(1) member-body(2) us(840) rsadsi(113549) pkcs(1) pkcs-9(9)
        smime(16) modules(0) id-mod-ess-2006-02(42) }

   ;

   --
   --  EPS Content Type
   --

   ct-eps-LockBox CONTENT-TYPE ::= {
       TYPE EPS-LockBox
       IDENTIFIED BY id-ct-eps-LockBox
   }

   id-ct-eps-LockBox OBJECT IDENTIFIER ::= {1 1 1 1}

   EPS-LockBox ::= SEQUENCE {
      label        OneLabel,
      keyList      KeyList
   }

   KeyList ::= SEQUENCE {
      namedRecipients    [0] SEQUENCE SIZE (1..MAX) OF
                                NamedRecipient OPTIONAL,
      defaultRecipients  [1] SEQUENCE SIZE (1..MAX) OF
                                OneKek OPTIONAL
   }

   NamedRecipient ::= SEQUENCE {
      recipient    IA5String, -- name of the recipient
      kekValues    SEQUENCE SIZE (1..MAX) OF SEQUENCE {
         kekIdentifier          OCTET STRING,
         keyValue               RecipientInfo
      }
   }

   OneKek ::= SEQUENCE {
      kekIdentifier       OCTET STRING,
      kekValue            OCTET STRING
   }

   OneLabel ::= CHOICE {
        andLabels     [1] SEQUENCE SIZE (2..MAX) OF OneLabel,
        orLabels      [2] SEQUENCE SIZE (2..MAX) OF OneLabel,
        exclude       [3] SEQUENCE SIZE (2) OF OneLabel,
        uriLeaf       [4] SEQUENCE {
            policyId        UTF8String,
            names           SEQUENCE SIZE (1..MAX) OF
                                IA5String OPTIONAL
        },
        oidLeaf       [5] ESSSecurityLabel,
        ...
   }

   --
   --
   --

   keyatt-eps-kek KEY-ATTRIBUTE ::= {
      SignedData IDENTIFIED BY id-keyatt-eps-token
   }

   id-keyatt-eps-token OBJECT IDENTIFIER ::= {1 1 1 1 2}

   --
   --  Define the Signed Attribute to carry the
   --       Email Policy Server URL
   --
   --  This attribute is added to the SignedAttributSet set of
   --  attributes in [CMS-ASN]
   --

   aa-eps-url ATTRIBUTE ::= {
      TYPE UTF8String IDENTIFIED BY id-aa-eps-url
   }

   id-aa-eps-url OBJECT IDENTIFIER ::= {1 1 1 1 1 3}

END
</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jim Schaad</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Soaring Hawk Consulting</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ietf@augustcellars.com">ietf@augustcellars.com</a></td></tr>
</table>
</body></html>
