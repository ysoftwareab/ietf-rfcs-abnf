K = MD4(UNICODE(password)) 
         
Ksign = HMAC(K, "signature key")  //includes zero octet at end 
tmp = MD5(Ksign, concat(T, data)) 
CHKSUM = HMAC(K, tmp) 
    
    
T = the message type, encoded as a little-endian four byte integer. 
    
L = "fiftysixbits" //includes zero octet at end 
L = ""  // one octet of zero 
Ksign = HMAC(K, concat(L, T)) 
Confounder = nonce(8) // get an 8 octet nonce for a confounder 
Checksum = HMAC(Ksign, concat(Confounder, data)) 
Ke = Ksign 
Ke2 = HMAC(Ke, Checksum) 
data = RC4(Ke2, data) 
    
IV = SND_SEQ 
K = XOR(K, 0xf0f0f0f0f0f0f0f0f0f0f0f0f0f0f0) 
L = "fortybits" //includes zero octet at end 
L = "" // one octet of zero 
Ksign = HMAC(K, concat(L, T)) 
Ke = Ksign 
Ke2 = HMAC(Ke, IV) 
Data = RC4(Ke2, data) 
SND_SEQ = RC4(Ke, seq#) 
         
