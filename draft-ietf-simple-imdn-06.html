<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Instant Message Disposition
    Notification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Instant Message Disposition
    Notification">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIMPLE</td><td class="header">E. Burger</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">BEA Systems, Inc.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">H. Khartabil</td></tr>
<tr><td class="header">Expires: July 17, 2008</td><td class="header">January 14, 2008</td></tr>
</table></td></tr></table>
<h1><br />Instant Message Disposition
    Notification<br />draft-ietf-simple-imdn-06</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 17, 2008.</p>

<h3>Abstract</h3>

<p>Instant Messaging (IM) refers to the transfer of messages between
      users in real-time. This document provides a mechanism whereby endpoints
      can request Instant Message Disposition Notifications (IMDN), including
      delivery, processing, and read notifications, for page-mode instant
      messages. <br />
<br />
 The Common Profile for Instant
      Messaging (CPIM) data format specified in RFC 3862 is extended with new
      header fields that enable endpoints to request IMDNs. A new message
      format is also defined to convey IMDNs. <br />
<br />
 This
      document also describes how SIP entities behave using this
      extension.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
<a href="#Conventions">2.</a>&nbsp;
Conventions<br />
<a href="#terminology">3.</a>&nbsp;
Terminology<br />
<a href="#anchor1">4.</a>&nbsp;
Overview<br />
<a href="#disposition-states">5.</a>&nbsp;
Disposition Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">5.1.</a>&nbsp;
Delivery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.2.</a>&nbsp;
Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.3.</a>&nbsp;
Read<br />
<a href="#anchor5">6.</a>&nbsp;
New CPIM Header Fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">6.1.</a>&nbsp;
CPIM Header Field Namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.2.</a>&nbsp;
Disposition-Notification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.3.</a>&nbsp;
Message-ID<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.4.</a>&nbsp;
Original-To<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.5.</a>&nbsp;
IMDN-Record-Route<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.6.</a>&nbsp;
IMDN-Route<br />
<a href="#endpoint-behaviour">7.</a>&nbsp;
Endpoint Behaviour<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.1.</a>&nbsp;
IM Sender<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#construct_im">7.1.1.</a>&nbsp;
Constructing Instant Messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.1.2.</a>&nbsp;
Matching IMs with IMDNs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">7.1.3.</a>&nbsp;
Keeping State<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.1.4.</a>&nbsp;
Aggregation of IMDNs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.2.</a>&nbsp;
IM Recipient<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.2.1.</a>&nbsp;
Constructing IMDNs<br />
<a href="#intermediary-behaviour">8.</a>&nbsp;
Intermediary Behaviour<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#generate-processing-notification">8.1.</a>&nbsp;
Constructing Processing Notifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#aggregate-intermediary">8.2.</a>&nbsp;
Aggregation of IMDNs<br />
<a href="#identifying-messages">9.</a>&nbsp;
Identifying Messages<br />
<a href="#syntax">10.</a>&nbsp;
Header Fields Formal Syntax<br />
<a href="#imdn-format">11.</a>&nbsp;
IMDN Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">11.1.</a>&nbsp;
Structure of XML-Encoded IMDN Payload<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">11.1.1.</a>&nbsp;
The &lt;message-id&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">11.1.2.</a>&nbsp;
The &lt;datetime&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">11.1.3.</a>&nbsp;
The &lt;recipient-uri&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">11.1.4.</a>&nbsp;
The &lt;original-recipient-uri&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">11.1.5.</a>&nbsp;
The &lt;subject&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">11.1.6.</a>&nbsp;
The &lt;disposition&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">11.1.7.</a>&nbsp;
The &lt;status&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">11.1.8.</a>&nbsp;
The &lt;note&gt; Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mime-type">11.2.</a>&nbsp;
MIME Type for IMDN Payload<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schema">11.3.</a>&nbsp;
The RelaxNG Schema<br />
<a href="#anchor30">12.</a>&nbsp;
Transporting Messages using SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">12.1.</a>&nbsp;
Endpoint Behaviour<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">12.1.1.</a>&nbsp;
Sending Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">12.1.2.</a>&nbsp;
Sending Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">12.1.3.</a>&nbsp;
Receiving Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sip-intermediary-behaviour">12.2.</a>&nbsp;
Intermediary Behaviour<br />
<a href="#anchor38">13.</a>&nbsp;
Transporting Messages using MSRP<br />
<a href="#security">14.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">14.1.</a>&nbsp;
Forgery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">14.2.</a>&nbsp;
Confidentiality<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">14.3.</a>&nbsp;
Non-Repudiation<br />
<a href="#anchor42">15.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">15.1.</a>&nbsp;
message/imdn+xml MIME TYPE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">15.2.</a>&nbsp;
URN Sub-Namespace Registration for urn:ietf:params:xml:ns:imdn<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor45">15.3.</a>&nbsp;
Schema Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor46">15.4.</a>&nbsp;
Registration for urn:ietf:params:imdn<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor47">15.5.</a>&nbsp;
Message/CPIM Header Field Registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor48">15.6.</a>&nbsp;
Content-Disposition: notification<br />
<a href="#Ack">16.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">17.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">17.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">17.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In many user-to-user message exchange systems, message senders often
      wish to know if the human recipient actually received or read a message.
      <br />
<br />
 <a class='info' href='#RFC2821'>Electronic Mail<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; April&nbsp;2001.</span><span>)</span></a> [RFC2821]
      deals with this situation with <a class='info' href='#RFC3798'>Message Delivery
      Notifications<span> (</span><span class='info'>Hansen, T. and G. Vaudreuil, &ldquo;Message Disposition Notification,&rdquo; May&nbsp;2004.</span><span>)</span></a> [RFC3798]. After the recipient views the message, her mail
      user agent generates a Message Delivery Notification, or MDN. The MDN is
      an e-mail that follows the format prescribed by <a class='info' href='#RFC3798'>RFC 3798<span> (</span><span class='info'>Hansen, T. and G. Vaudreuil, &ldquo;Message Disposition Notification,&rdquo; May&nbsp;2004.</span><span>)</span></a> [RFC3798]. The fixed format ensures that an
      automaton can process the message.
</p>
<p>Message/CPIM <a class='info' href='#RFC3862'>[RFC3862]<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> is a message format used
      to generate instant messages. SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg et al., J., Shulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> can
      carry instant messages generated using message/CPIM in SIP MESSAGE
      requests <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., &ldquo;SIP Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p>This document extends Message/CPIM message format, much like Message
      Delivery Notifications extends Electronic Mail. This extension enables
      Instant Message Senders to request, create, and send Instant Message
      Disposition Notifications (IMDN). This mechanism works for page-mode as
      well as session mode instant messages. This document only discusses
      page-mode. Session mode is left for future standardisation efforts.
</p>
<p>IMDNs include positive delivery, negative delivery (i.e. a message
      did not get delivered successfully), read notifications as well as
      processed notifications. By using CPIM header fields, the IMDN request
      and delivery are abstracted outside the transport protocol allowing
      interoperability between different IM systems.
</p>
<a name="Conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>This document refers generically to the sender of a message in the
      masculine (he/him/his) and the recipient of the message in the feminine
      (she/her/hers). This convention is purely for convenience and makes no
      assumption about the gender of a message sender or recipient.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Terminology</h3>

<p></p>
<ul class="text">
<li>IM: An Instant Message generated using the Message/CPIM
          format.
</li>
<li>IMDN: An Instant Message Disposition Notification generated using
          the Message/CPIM format that carries an IMDN XML document.
</li>
<li>Message: an IM or an IMDN generated using the Message/CPIM
          format.
</li>
<li>IM Sender: An endpoint (User Agent) generating and sending an IM.
          Also, the endpoint request IMDNs for an IM. Quite often, the IM
          Sender is the IMDN Recipient. However, that is not always the case,
          since the IMDN uses the From header in the CPIM message. That value
          is often the IM Sender's Address of Record (AoR). This address may
          in fact resolve to different User Agents.
</li>
<li>IM Recipient: An endpoint (User Agent) that receives IMs. The IM
          Recipient, as the node that presumably renders the IM to the user,
          generates and sends delivery IMDNs to IMs, if requested by the IM
          Sender and allowed by the IM Recipient.
</li>
<li>Endpoint: An IM Sender or an IM Recipient.
</li>
<li>Intermediary: An entity in the network that is on the path of an
          IM to its final destination. Intermediaries also can generate and
          send processing IMDNs to IMs, if requested by the IM Sender and
          allowed by policy.
</li>
<li>IMDN Payload: An XML document carrying the disposition
          notification information. In this specification, it is of MIME type
          "message/imdn+xml".
</li>
<li>Disposition type: the type of IMDN that can be requested. This
          specification defines three, namely "delivery", "processing" and
          "read" disposition types.
</li>
<li>Transport Protocol Message: A SIP or other protocol message that
          contains an IM or IMDN.
</li>
</ul>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Overview</h3>

<p>The diagram below shows the basic protocol flow. An IM Sender creates
      an IM, adds IMDN request information the IM Sender is interested in
      receiving and then sends the IM. At a certain point in time, the IM
      Recipient or an intermediary determines that the user or application has
      received, did not receive, read, or otherwise disposed the IM. The
      mechanism by which an IM Recipient determines its user has read an IM is
      beyond the scope of this document. At that point, the IM Recipient or
      intermediary automatically generates a notification message to the IM
      Sender. This notification message is the Instant Message Disposition
      Notification (IMDN).
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>+--------------+                        +--------------+
|  IM Sender   |                        | IM Recipient |
|IMDN Recipient|                        | IMDN Sender  |
+--------------+                        +--------------+
        |                                       |
        |                                       |
        |         1. IM requesting IMDN         |
        |--------------------------------------&gt;|
        |                                       |
        |                                       |
        |         2. IMDN (disposition)         |
        |&lt;--------------------------------------|
        |                                       |
        |                                       |

</pre></div>
<p>Note that the recipient of an IMDN, in some instances, may not be the
      IM Sender. This is specifically true for page-mode IMs where the Address
      of Record (AOR) of the IM Sender, that is present in the IM, resolves to
      a different location or user agent than the IM originated. For
      simplicity, the rest of this document assumes that the IM Sender and the
      IMDN Recipient are the same and therefore will refer to both as the IM
      Sender.
</p>
<a name="disposition-states"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Disposition Types</h3>

<p>There are three broad categories of disposition states. They are
      delivery, processing, and read. Future extensions may introduce
      others.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Delivery</h3>

<p>The delivery notification type indicates whether the IM has been
        delivered to the IM Recipient or not. The delivery notification type
        can have the following states: </p>
<ul class="text">
<li>"delivered" to indicate successful delivery.
</li>
<li>"failed" to indicate failure in delivery.
</li>
<li>"forbidden" indicate denial for the IM Sender to receive the
            requested IMDN. The IM Recipient can send the "forbidden" state,
            but usually it is an intermediary that sends the message if one
            configures it to do so. For example, it is possible the
            administrator has disallowed IMDNs.
</li>
<li>"error" to indicate an error in determining the fate of an
            IM.
</li>
</ul>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Processing</h3>

<p>The processing notification type indicates that an intermediary has
        processed an IM. The processing notification type can have the
        following states: </p>
<ul class="text">
<li>"processed" is a general state of the IM indicating that the
            intermediary has performed its task on the IM.
</li>
<li>"stored" state indicates that the intermediary stored the IM
            for later delivery.
</li>
<li>"forbidden" indicate denial for the IM Sender to receive the
            requested IMDN. The "forbidden" state is sent by an intermediary
            that is configured to do so. For example, the administrator has
            disallowed IMDNs.
</li>
<li>"error" to indicate an error in determining the fate of an
            IM.
</li>
</ul>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Read</h3>

<p>The read notification type indicates whether the IM Recipient
        rendered the IM to the user or not. The read notification type can
        have the following states: </p>
<ul class="text">
<li>"read" is a state indicating that the IM has been rendered to
            the user.
</li>
<li>"forbidden" indicate denial, by the IM Recipient, for the IM
            Sender to receive the requested IMDN.
</li>
<li>"error" to indicate an error in determining the fate of an
            IM.
</li>
</ul>

<p>In addition to text, some IMs may contain audio, video, and still
        images. Therefore, the state "read" includes playing the audio or
        video file to the user.
</p>
<p>Since there is no positive acknowledgement from the user, one
        cannot determine a priori the user actually read the IM. Thus, one
        cannot use the protocol described here as a non-repudiation
        service.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
New CPIM Header Fields</h3>

<p>This specification extends the CPIM data format specified in RFC 3862
      <a class='info' href='#RFC3862'>[RFC3862]<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a>. A new namespace is created as well as a
      number of new CPIM header fields.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
CPIM Header Field Namespace</h3>

<p>Per <a class='info' href='#RFC3862'>CPIM<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862], this specification defines
        a new namespace for the CPIM extension header fields defined in the
        following sections. The namespace is: <br />
<br />

        urn:ietf:params:imdn <br />
<br />
 As per <a class='info' href='#RFC3862'>CPIM<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862] requirements, the new header fields
        defined in the following sections are prepended, in CPIM messages, by
        a prefix assigned to the URN through the NS header field of the CPIM
        message. The remaining of this specification always assumes an NS
        header field like this one: <br />
<br />
 NS: imdn
        &lt;urn:ietf:params:imdn&gt;.
</p>
<p>Of course, clients are free to use any prefix and servers must
        accept any legal namespace prefix specification.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Disposition-Notification</h3>

<p>The IM Sender MUST include the Disposition-Notification header
        field to indicate the desire to receive IMDNs from the IM Recipient,
        for that specific IM. This header field is not needed if the IM Sender
        does not request an IMDN. <a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the
        syntax.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Message-ID</h3>

<p>The IM Sender MUST include the Message-ID header field in the IM
        that he wishes to receive an IMDN on. The Message-ID contains a
        globally unique message identifier the IM Sender can use to correlate
        received IMDNs. When the IM Sender receives an IMDN, it can compare
        its value with the value of the &lt;message-id&gt; element present in
        the IMDN payload. IMDNs also carry this header field. Note that since
        the IMDN is itself an IM, the Message-ID of the IMDN will be different
        than the Message-ID of the original IM. <a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a>
        defines the syntax.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Original-To</h3>

<p>An intermediary MAY insert an Original-To header field to the IM.
        The value of the Original-To field MUST be the address of the IM
        Receiver. The IM Recipient uses this header to indicate the original
        IM address in the IMDNs. The IM Recipient does this by populating the
        &lt;original-recipient-uri&gt; element in the IMDN. The intermediary
        MUST insert this header if the intermediary changes the CPIM To header
        field value. The header field MUST NOT appear more than once in an IM.
        The intermediary MUST NOT change this header field value if it is
        already present. <a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the syntax.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
IMDN-Record-Route</h3>

<p>An intermediary MAY insert an IMDN-Record-Route header field to the
        IM. The value of the IMDN-Record-Route header field MUST be the
        address of the intermediary. Multiple IMDN-Record-Route header fields
        can appear in an IM. <a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the
        syntax.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
IMDN-Route</h3>

<p>The IMDN-Route header field provides routing information by
        including one or more addresses where to route the IMDN. An
        intermediary that needs the IMDN to flow back through the same
        intermediary MUST add the IMDN-Record-Route header. When the IM
        Recipient creates the corresponding IMDN, the IM Recipient copies the
        IMDN-Record-Route headers into corresponding IMDN-Route header fields.
        <a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the syntax.
</p>
<a name="endpoint-behaviour"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Endpoint Behaviour</h3>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
IM Sender</h3>

<a name="construct_im"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
Constructing Instant Messages</h3>

<p>An IM is constructed using CPIM Message Format defined in RFC
          3862 <a class='info' href='#RFC3862'>[RFC3862]<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1.1"></a><h3>7.1.1.1.&nbsp;
Adding a Message-ID Header Field</h3>

<p>If the IM sender requests the reception of IMDNs, the IM sender
            MUST include a Message-ID header field. The Message-ID field is
            populated with a value that is unique with at least 32 bits of
            randomness. This header field enables the IM Sender to match any
            IMDNs with their corresponding IMs.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1.2"></a><h3>7.1.1.2.&nbsp;
Adding a DateTime Header Field</h3>

<p>Some devices are not able to retain state over long periods.
            For example, mobile devices may have memory limits or battery
            limits. These limits may mean these devices may not be able to, or
            may chose not to, keep sent messages for the purposes of
            correlating IMDNs with sent IMs. To make some use of IMDN in this
            case, we add a time stamp to the IM to indicate when the user sent
            the message. The IMDN returns this time stamp to enable the user
            to correlate the IM with the IMDN at the human level. We use the
            DateTime CPIM header field for this purpose. Thus, if the IM
            Sender would like an IMDN, the IM Sender MUST include the DateTime
            CPIM header field.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1.3"></a><h3>7.1.1.3.&nbsp;
Adding a Disposition-Notification Header Field</h3>

<p>The Disposition-Notification conveys the type of disposition
            notification requested by the IM sender. There are three types of
            disposition notification: delivery, processing, and read. The
            delivery notification is further subdivided into failure and
            success delivery notifications. An IM Sender requests failure
            delivery notification by including a Disposition-Notification
            header field with value "negative-delivery". Similarly, a success
            notification is requested by including a Disposition-Notification
            header field with value "positive-delivery". The IM Send can
            request both types of delivery notifications for the same IM.
</p>
<p>The IM Sender can request a processing notification by
            including a Disposition-Notification header field with value
            "processing".
</p>
<p>The IM Sender can also request a read notification. The IM
            Sender MUST include a Disposition-Notification header field with
            the value "read" to request a read request.
</p>
<p>The absence of this header field or the presence of the header
            field with an empty value indicates that the IM Sender is not
            requesting any IMDNs. Disposition-Notification header field values
            are comma separated. The IM Sender MAY request more than one type
            of IMDN for a single IM.
</p>
<p>Future extensions may define other disposition notifications
            not defined in this document.
</p>
<p><a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> describes the formal syntax for
            the Disposition-Notification header field. The following is an
            example CPIM body of an IM where the IM Sender requests positive
            and negative delivery notifications, but neither read notification
            nor processing notifications:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
From: Alice &lt;im:alice@example.com&gt;
To: Bob &lt;im:bob@example.com&gt;
NS: imdn &lt;urn:ietf:params:imdn&gt;
imdn.Message-ID: 34jk324j
DateTime: 2006-04-04T12:16:49-05:00
imdn.Disposition-Notification: positive-delivery, negative-delivery
Content-type: text/plain
Content-length: 12

Hello World

</pre></div>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Matching IMs with IMDNs</h3>

<p>An IM Sender matches an IMDN to an IM by matching the Message-ID
          header field value in the IM with the &lt;message-id&gt; element
          value in the body of the IMDN. If the IM was delivered to multiple
          recipients, the IM Sender uses the &lt;recipient-uri&gt; element and
          the &lt;original-recipient-uri&gt; element in the XML body of the
          IMDN it received to determine if the IM was sent to multiple
          recipients and to identify the IM Recipient that sent the IMDN.
</p>
<p>An IM Sender can determine an IMDN is a disposition notification
          by noting the Content-Disposition in the IMDN is "notification".
          This does mean the IM Sender MUST understand the Content-Disposition
          MIME header in CPIM messages.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.3"></a><h3>7.1.3.&nbsp;
Keeping State</h3>

<p>This specification does not mandate the IM Sender to keep state
          for a sent IM.
</p>
<p>Once an IM Sender sends an IM containing an IMDN request, it MAY
          preserve the IM context, principally the Message-ID, and other
          user-identifiable information such as the IM subject or content, and
          date and time it was sent. Without preservation of the IM context,
          the IM Sender will not be able to correlate the IMDN with the IM it
          sent. The IM Sender may find it impossible to preserve IM state if
          it has limited resources or does not have non-volatile memory and
          then loses power.
</p>
<p>There is, however, the concept of "Sent Items" box in an
          application that stores sent IMs. This "Sent Items" box has the
          necessary information and may have a fancy user interface indicating
          the state of a sent IM. A unique Message-ID for this purpose proves
          to be useful. The length of time for items to remain in the "Sent
          Items" box is a user choice. The user is usually free to keep or
          delete items from the "Sent Items" box as she pleases or as the
          memory on the device reaches capacity.
</p>
<p>Clearly, if an IM Sender loses its sent items state, for example,
          the user deletes items from the "Send Items" box, the client may use
          a different display strategy in response to apparently unsolicited
          IMDNs.
</p>
<p>This specification also does not mandate an IM Sender to run any
          timers waiting for an IMDN. There are no time limits associated with
          when IMDNs may be received.
</p>
<p>IMDNs may legitimately never be received. Likewise, the recipient
          may take a long time to actually read the message, so the time
          between the sending of an IM and the generation and ultimate receipt
          of the IMDN may simply take a very long time. Some clients may
          choose to purge the state associated with the sent IM. This is the
          reason for adding the time stamp in the IM and having it returned in
          the IMDN. This gives the user some opportunity of remembering what
          IM was sent. For example if the IMDN indicates that the IM the user
          sent at 2 p.m. last Thursday was delivered, the user has a chance of
          remembering that they sent an IM at 2 p.m. last Thursday.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.4"></a><h3>7.1.4.&nbsp;
Aggregation of IMDNs</h3>

<p>An IM Sender may send an IM to multiple recipients in one
          Transport Protocol Message (typically using a URI-List server) and
          request IMDNs. An IM Sender that requested IMDNs MUST be prepared to
          receive multiple aggregated or non-aggregated IMDNs. See <a class='info' href='#aggregate-intermediary'>Section&nbsp;8.2<span> (</span><span class='info'>Aggregation of IMDNs</span><span>)</span></a> for details.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
IM Recipient</h3>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Constructing IMDNs</h3>

<p>IM recipients examine the contents of the
          Disposition-Notification header field of the CPIM message to
          determine if an IMDN must be generated for that IM.
          Disposition-Notification header fields of CPIM messages can include
          one or more values. This implies that IM recipients may need to
          generate zero, one, or more IMDNs for that IM, for example a
          delivery notification as well as a read notification. In this case,
          the IM Recipient MUST be able to construct multiple IMDNs per IM. An
          IM Recipient MUST NOT construct more than one IMDN per disposition
          type. That is, it must not generate a delivery notification
          indicating "delivered" then followed by a delivery notification
          indicating "failed" for the same IM. If the IM Sender requested only
          failure notifications and the IM was successfully delivered, then no
          IMDNs will be generated.
</p>
<p>The IM Recipient MUST NOT generate "processing"
          notifications.
</p>
<p>A Disposition-Notification header field MUST NOT appear in an
          IMDN since it is forbidden to request an IMDN for an IMDN. An IM
          Sender MUST ignore a delivery notification request in an IMDN if
          present. The IM Sender MUST NOT send an IMDN for an IMDN.
</p>
<p>An IMDN MUST contain a Message-ID header field. The same rules of
          uniqueness for the Message-ID header field that appears in an IM
          apply to an IMDN. The Message-ID header field in the IMDN is
          different and unrelated to the one in the IM.
</p>
<p>An IM may contain an IMDN-Record-Route header field (see <a class='info' href='#intermediary-behaviour'>Section&nbsp;8<span> (</span><span class='info'>Intermediary Behaviour</span><span>)</span></a> for details). If
          IMDN-Record-Route header fields appear in the IM, the IM Recipient
          constructing the IMDN MUST copy the contents of the
          IMDN-Record-Route header fields into IMDN-Route header fields in the
          IMDN and maintain the order. The IMDN is then sent to the URI in the
          top IMDN-Route header field. IMDN-Record-Route header fields do not
          make sense in an IMDN and therefore MUST NOT be placed in an IMDN.
          IMDN Recipients MUST ignore it if present.
</p>
<p>As stated in <a class='info' href='#RFC3862'>CPIM<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862], CPIM messages
          may need to support MIME headers other than Content-type. IM
          Recipients MUST insert a Content-Disposition header field, set to
          the value "notification". This indicates to the IM Sender that the
          message is an IMDN to an IM it has earlier sent.
</p>
<a name="generate-delivery-notification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1.1"></a><h3>7.2.1.1.&nbsp;
Constructing Delivery Notifications</h3>

<p>The IM Recipient constructs a delivery notification in a
            similar fashion as an IM, using a CPIM body <a class='info' href='#RFC3862'>[RFC3862]<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> that carries a Disposition Notification
            XML document formatted according to the rules specified in <a class='info' href='#imdn-format'>Section&nbsp;11<span> (</span><span class='info'>IMDN Format</span><span>)</span></a>. The MIME type of the Disposition
            Notification XML document is "message/imdn+xml".
</p>
<p><a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the schema for an
            IMDN.
</p>
<p>An example CPIM body of IMDN looks like the following:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
From: Bob &lt;im:bob@example.com&gt;
To: Alice &lt;im:alice@example.com&gt;
NS: imdn &lt;urn:ietf:params:imdn&gt;
imdn.Message-ID: d834jied93rf
Content-type: message/imdn+xml
Content-Disposition: notification
Content-length: ...

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;imdn xlmns="urn:ietf:params:xml:ns:imdn"&gt;
   &lt;message-id&gt;34jk324j&lt;/message-id&gt;
   &lt;datetime&gt;2006-04-04T12:16:49-05:00&lt;/datetime&gt;
   &lt;recipient-uri&gt;im:bob@example.com&lt;/recipient-uri&gt;
   &lt;original-recipient-uri&gt;
       im:bob@example.com
   &lt;/original-recipient-uri&gt;
   &lt;disposition&gt;
      &lt;delivery/&gt;
   &lt;/disposition&gt;
   &lt;status&gt;
      &lt;delivered/&gt;
   &lt;/status&gt;
   &lt;note lang="en"&gt;The IM was successfully Delivered&lt;/note&gt;
&lt;/imdn&gt;

</pre></div>
<a name="generate-read-notification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1.2"></a><h3>7.2.1.2.&nbsp;
Constructing Read Notifications</h3>

<p>The IM Recipient constructs a read notification in a similar
            fashion as the delivery notification. See <a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a> for details.
</p>
<p><a class='info' href='#syntax'>Section&nbsp;10<span> (</span><span class='info'>Header Fields Formal Syntax</span><span>)</span></a> defines the schema for an
            IMDN.
</p>
<p>An example looks like the following:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
From: Bob &lt;im:bob@example.com&gt;
To: Alice &lt;im:alice@example.com&gt;
NS: imdn &lt;urn:ietf:params:imdn&gt;
imdn.Message-ID: dfjkleriou432333
Content-type: message/imdn+xml
Content-Disposition: notification
Content-length: ...

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;imdn xlmns="urn:ietf:params:xml:ns:imdn"&gt;
   &lt;message-id&gt;34jk324j&lt;/message-id&gt;
   &lt;datetime&gt;2006-04-04T12:16:49-05:00&lt;/datetime&gt;
   &lt;recipient-uri&gt;im:bob@example.com&lt;/recipient-uri&gt;
   &lt;original-recipient-uri&gt;
       im:bob@example.com
   &lt;/original-recipient-uri&gt;
   &lt;disposition&gt;
      &lt;read/&gt;
   &lt;/disposition&gt;
   &lt;status&gt;
      &lt;read/&gt;
   &lt;/status&gt;
   &lt;note lang="en"&gt;The IM has been read&lt;/note&gt;
&lt;/imdn&gt;

</pre></div>
<p>There are situations where the IM Recipient cannot determine if
            or when the IM has been read. The IM Recipient in this case
            generates a read notification with a &lt;status&gt; value of
            "error" to indicate an internal error by the server. Note that the
            IM Recipient may choose to ignore any IMDN requests and not to
            send any IMDNs. An IM recipient may not wish to let a sender know
            she read, or did not read, a particular message. Likewise, she may
            not want anyone to know if she reads messages. This could be on a
            per-message, per-sender, or programmed policy choice.
</p>
<a name="intermediary-behaviour"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Intermediary Behaviour</h3>

<p>In this context, intermediaries are application servers (including
      URI-List servers and Store-and-Forward server) and gateways. A gateway
      is a server that translates between different IM systems that use
      different protocols.
</p>
<p>A URI-List server may change the IM Recipient address from its own to
      the address of the final recipient of that IM for every copy it makes
      that it sends to the list members (see <a class='info' href='#I-D.ietf-sip-uri-list-message'>[I&#8209;D.ietf&#8209;sip&#8209;uri&#8209;list&#8209;message]<span> (</span><span class='info'>Garcia-Martin, M. and G. Camarillo, &ldquo;Multiple-Recipient MESSAGE Requests in the Session Initiation           Protocol (SIP),&rdquo; December&nbsp;2007.</span><span>)</span></a> for details). In this
      case, if the IM Sender is requesting an IMDN, the intermediary SHOULD
      add an Original-To header field to the IM populating it with the address
      that was in the CPIM To header field before it was changed. I.e., the
      Original-To header field is populated with the intermediary address. An
      intermediary MUST NOT add an Original-To header field if one already
      exists. An intermediary MAY have an administrative configuration to not
      reveal the original Request-URI, and as such, MAY chose not to add an
      Original-To header.
</p>
<p>An intermediary MAY choose to remain on the path of IMDNs for a
      specific IM. It can do so by adding a CPIM IMDN-Record-Route header
      field as the top IMDN-Record-Route header field and populating it with
      its own address. An intermediary that does not support this extension
      will obviously not add the IMDN-Record-Route header field. This allows
      IMDNs to traverse directly from the IM Recipient to the IM Sender even
      if the IM traversed an intermediary not supporting this extension.
</p>
<p>An intermediary receiving an IMDN checks the top IMDN-Route header
      field. If that header field carries the intermediary address, the
      intermediary removes that value and forwards the IMDN to the address
      indicated in the now top IMDN-Route header field. If no IMDN-Route
      header fields are present, the IMDN is forwarded to the address in the
      CPIM To header field.
</p>
<p>An intermediary MUST remove any information about the final
      recipients of a list if the list membership is not disclosed. The
      intermediary does that by removing the &lt;recipient-uri&gt; element
      and/or &lt;original-recipient-uri&gt; element from the body of the IMDN
      before forwarding it to the IM Sender.
</p>
<a name="generate-processing-notification"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Constructing Processing Notifications</h3>

<p>Intermediaries are the only entities that construct processing
        notifications. They do so only if the IM Sender has requested a
        "processing" notification by including a Disposition-Notification
        header field with value "processing".
</p>
<p>The intermediary can create and send "processing" notifications
        indicating that an IM has been processed or stored. The intermediary
        MUST NOT send more than one IMDN for the same disposition type. I.e.,
        it must not send a "processing" notification indicating that an IM is
        being "processed" followed by another IMDN indicating that the same IM
        is "stored".
</p>
<p>An intermediary constructs a "processing" notification in a similar
        fashion as the delivery notification. See <a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a> for details.
</p>
<p>An example looks like the following:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Content-type: Message/CPIM

From: Bob &lt;im:bob@example.com&gt;
To: Alice &lt;im:alice@example.com&gt;
Content-type: message/imdn+xml
Content-Disposition: notification
Content-length: ...

&lt;imdn&gt;
   &lt;message-id&gt;34jk324j&lt;/message-id&gt;
   &lt;datetime&gt;2006-04-04T12:16:49-05:00&lt;/datetime&gt;
   &lt;recipient-uri&gt;im:bob@example.com&lt;/recipient-uri&gt;
   &lt;original-recipient-uri&gt;
       im:bob@example.com
   &lt;/original-recipient-uri&gt;
   &lt;disposition&gt;
      &lt;processing/&gt;
   &lt;/disposition&gt;
   &lt;status&gt;
      &lt;processed/&gt;
   &lt;/status&gt;
   &lt;note lang="en"&gt;The IM has been processed&lt;/note&gt;
&lt;/imdn&gt;

</pre></div>
<p>There are situations where the intermediary cannot know the fate of
        an IM. The intermediary in this case generates a processing
        notification with a &lt;status&gt; value of "error" to indicate
        so.
</p>
<a name="aggregate-intermediary"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Aggregation of IMDNs</h3>

<p>In this context, URI-List servers are defined as
        intermediaries.
</p>
<p>An intermediary may choose to aggregate IMDNs using local policy
        for making such a decision or it may send individual IMDNs instead.
        When a URI-List server receives an IM and decides to aggregate IMDNs,
        it can wait for a configurable period of time or until all recipients
        have sent the IMDN, whichever comes first, before the URI-List server
        sends an aggregated IMDN. Note that some IMDNs, for example "read"
        notifications, may never come due to user settings. It is an
        administrator configuration and an implementation issue how long to
        wait before sending an aggregated IMDN and before a URI-List server
        removes state for that IM.
</p>
<p>A URI-List server MAY choose to send multiple aggregated IMDNs. A
        timer can be started and when it fires, the URI-List server can
        aggregate whatever IMDNs it has so far for that IM, send the
        aggregated IMDN and restart the timer for the next batch. This is
        needed for scenarios where the IM Sender has requested more than one
        IMDN for a specific IM, for example, delivery notifications as well as
        read notifications, or when the URI-List server is short on resources
        and chooses to prioritise forwarding IMs over IMDNs.
</p>
<p>A second timer can be running and when it fires, the state of the
        IM is deleted. In this case, the URI-List server consumes any IMDNs
        that might arrive after that time.
</p>
<p>Please note the references to timers in the above paragraphs are
        not normative and are only present to help describe one way one might
        implement aggregation.
</p>
<p>A URI-List server MAY aggregate IMDNs for the case where the list
        membership information is not disclosed. There may be scenarios where
        the URI-List server starts sending aggregated IMDNs and switch to
        individual ones or visa versa. A timer firing so often may in fact
        have that effect.
</p>
<p>The aggregated IMDN is constructed using the multipart/mixed MIME
        type and including all the received IMDNs as message/imdn+xml as
        individual payloads.
</p>
<p>Below is an example of aggregated IMDNs.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
From: Bob &lt;im:bob@example.com&gt;
To: Alice &lt;im:alice@example.com&gt;
NS: imdn &lt;urn:ietf:params:imdn&gt;
imdn.Message-ID: d834jied93rf
Content-type: multipart/mixed;
                   boundary="imdn-boundary"
Content-Disposition: notification
Content-length: ...

--imdn-boundary
Content-type: message/imdn+xml

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;imdn xlmns="urn:ietf:params:xml:ns:imdn"&gt;
   &lt;message-id&gt;34jk324j&lt;/message-id&gt;
   &lt;datetime&gt;2006-04-04T12:16:49-05:00&lt;/datetime&gt;
   &lt;recipient-uri&gt;im:bob@example.com&lt;/recipient-uri&gt;
   &lt;original-recipient-uri&gt;
       im:bob@example.com
   &lt;/original-recipient-uri&gt;
   &lt;disposition&gt;
      &lt;delivery/&gt;
   &lt;/disposition&gt;
   &lt;status&gt;
      &lt;delivered/&gt;
   &lt;/status&gt;
   &lt;note lang="en"&gt;The IM was successfully Delivered&lt;/note&gt;
&lt;/imdn&gt;

--imdn-boundary
Content-type: message/imdn+xml

&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;imdn xlmns="urn:ietf:params:xml:ns:imdn"&gt;
   &lt;message-id&gt;34jk324j&lt;/message-id&gt;
   &lt;datetime&gt;2006-04-04T12:16:49-05:00&lt;/datetime&gt;
   &lt;recipient-uri&gt;im:bob@example.com&lt;/recipient-uri&gt;
   &lt;original-recipient-uri&gt;
       im:bob@example.com
   &lt;/original-recipient-uri&gt;
   &lt;disposition&gt;
      &lt;read/&gt;
   &lt;/disposition&gt;
   &lt;status&gt;
      &lt;read/&gt;
   &lt;/status&gt;
   &lt;note lang="en"&gt;The IM was successfully Delivered&lt;/note&gt;
&lt;/imdn&gt;

--imdn-boundary

</pre></div>
<a name="identifying-messages"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Identifying Messages</h3>

<p>Messages are typically carried in a transport protocol like SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg et al., J., Shulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>. If the payload carried by the transport
      protocol does not contain any parts of type Message/CPIM then the
      message is an IM. If the payload contains any parts of type
      Message/CPIM, and none of those parts contains a payload that is of type
      "message/imdn+xml", the message is an IM. It is not valid to attempt to
      carry both an IM and an IMDN in a multipart payload in a single
      transport protocol message.
</p>
<p>A message is identified as a delivery notification by examining its
      contents. The message is a delivery notification if the Content-type
      header field present has a value of "message/imdn+xml", the
      Content-Disposition header field has a value of "notification", and the
      &lt;disposition&gt; element in that xml body has a sub-element
      &lt;delivery&gt;.
</p>
<p>A message is identified as a processing notification or read
      notification in a similar fashion as a delivery notification. The
      difference is that the &lt;disposition&gt; element in that xml body has
      a sub-element of &lt;processing&gt; and &lt;read&gt; respectively.
</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Header Fields Formal Syntax</h3>

<p>The following syntax specification uses the message header field
      syntax as described in Section 3 of <a class='info' href='#RFC3862'>RFC
      3862<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862]. <br />
<br />
 Header field syntax is described
      without a namespace qualification. Following the rules in <a class='info' href='#RFC3862'>RFC 3862<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862], header field names and other text are
      case sensitive and MUST be used as given, using exactly the indicated
      upper case and lower case letters.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Disposition-Notification =
    "Disposition-Notification" ": "
    [(notify-req *(COMMA notify-req))]

notify-req =
    ("negative-delivery" / "positive-delivery" /
     "processing" / "read" / Token) *(SEMI disp-notif-params)

disp-notify-params = generic-param

Message-ID = "Message-ID" ": " Token

Original-To = "Original-To" ": "  [ Formal-name ] "&lt;" URI "&gt;"

IMDN-Record-Route =
    "IMDN-Record-Route" ": "  [ Formal-name ] "&lt;" URI "&gt;"

IMDN-Route = "IMDN-Route" ": "  [ Formal-name ] "&lt;" URI "&gt;"

</pre></div>
<a name="imdn-format"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IMDN Format</h3>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Structure of XML-Encoded IMDN Payload</h3>

<p>An IMDN Payload is an XML document <a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., &ldquo;Extensible Markup Language (XML) 1.0 (Second Edition),&rdquo; October&nbsp;2000.</span><span>)</span></a> that
        MUST be well formed and MUST be valid according to schemas, including
        extension schemas, available to the validater and applicable to the
        XML document. The IMDN Payload MUST be based on XML 1.0 and MUST be
        encoded using UTF-8. <br />
<br />
 The namespace
        identifier for elements defined by this specification is a URN <a class='info' href='#URN'>[URN]<span> (</span><span class='info'>Moats, R., &ldquo;The URN Syntax,&rdquo; May&nbsp;1997.</span><span>)</span></a>, using the namespace identifier 'ietf' defined by
        <a class='info' href='#URN_NS'>[URN_NS]<span> (</span><span class='info'>Moats, R., &ldquo;The URN Namespace for IETF Documents,&rdquo; August&nbsp;1999.</span><span>)</span></a> and extended by <a class='info' href='#IANA'>[IANA]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>. This urn is: urn:ietf:params:xml:ns:imdn.
        <br />
<br />
 This namespace declaration indicates the
        namespace on which the IMDN is based. <br />
<br />
 The
        root element is &lt;imdn&gt;. The &lt;imdn&gt; element has
        sub-elements, namely &lt;message-id&gt;, &lt;datetime&gt;,
        &lt;recipient-uri&gt;, &lt;original-recipient-uri&gt;,
        &lt;subject&gt;, &lt;disposition&gt;, &lt;status&gt;, and
        &lt;note&gt;. Those elements are described in details in the following
        sections. <br />
<br />
 &lt;disposition&gt; and
        &lt;status&gt; can be extended in the future to include new
        sub-elements not defined in this document. Those new elements MUST be
        defined in an RFC.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.1"></a><h3>11.1.1.&nbsp;
The &lt;message-id&gt; Element</h3>

<p>The &lt;message-id&gt; element is mandatory according to the XML
          schema and carries the message id that appeared in the Message-ID
          header field of the IM.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.2"></a><h3>11.1.2.&nbsp;
The &lt;datetime&gt; Element</h3>

<p>The &lt;datetime&gt; element is mandatory and carries the date
          and time the IM was sent (not the IMDN). This information is
          obtained from the DateTime header field of the IM.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.3"></a><h3>11.1.3.&nbsp;
The &lt;recipient-uri&gt; Element</h3>

<p>The &lt;recipient-uri&gt; element is optional and carries the URI
          of the final recipient. This information is obtained from the CPIM
          To header field of the IM.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.4"></a><h3>11.1.4.&nbsp;
The &lt;original-recipient-uri&gt; Element</h3>

<p>The &lt;original-recipient-uri&gt; element is optional and
          carries the URI of the original recipient. It MUST be present if the
          IM carried the Original-To header field. This information is
          obtained from the Original-To header field of the IM.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.5"></a><h3>11.1.5.&nbsp;
The &lt;subject&gt; Element</h3>

<p>The &lt;subject&gt; element is optional and carries the text that
          was in the Subject header field, if any. This allows for a human
          level correlation between an IM and an IMDN.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.6"></a><h3>11.1.6.&nbsp;
The &lt;disposition&gt; Element</h3>

<p>The &lt;disposition&gt; element is mandatory and carries the
          disposition type that the IM Sender requested and is being reported.
          It can carry one of the sub-elements &lt;delivery&gt;,
          &lt;processing&gt;, &lt;read&gt; or any other future extension.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.7"></a><h3>11.1.7.&nbsp;
The &lt;status&gt; Element</h3>

<p>The &lt;status&gt; element is mandatory and carries the result of
          the disposition request in the &lt;disposition&gt; element. For
          disposition type &lt;delivery&gt;, it can carry one of the
          sub-elements &lt;delivered&gt;, &lt;failed&gt;, &lt;forbidden&gt; or
          &lt;error&gt;. For disposition type &lt;read&gt;, it can carry one
          of the sub-elements &lt;read&gt;, &lt;forbidden&gt; or
          &lt;error&gt;. For disposition type &lt;processing&gt;, it can carry
          one of the sub-elements &lt;processed&gt;, &lt;stored&gt;,
          &lt;forbidden&gt; or &lt;error&gt;. &lt;forbidden&gt; means the
          disposition was denied. &lt;error&gt; means internal server error.
          It can also carry any other future extension.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1.8"></a><h3>11.1.8.&nbsp;
The &lt;note&gt; Element</h3>

<p>The &lt;note&gt; element is optional and carries a human readable
          text. It has the "lang" attribute that indicates the language the
          text is written in.
</p>
<a name="mime-type"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
MIME Type for IMDN Payload</h3>

<p>The MIME type for the IMDN Payload is "message/imdn+xml". The IMDN
        MUST identify the payload as MIME type "message/imdn+xml" in the
        Content-type header field.
</p>
<a name="schema"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
The RelaxNG Schema</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;grammar
  xmlns="http://relaxng.org/ns/structure/1.0"
  xmlns:a="http://relaxng.org/ns/compatibility/annotations/1.0"
  datatypeLibrary="http://www.w3.org/2001/XMLSchema-datatypes"
  ns="urn:ietf:params:xml:ns:imdn"&gt;

    &lt;start&gt;
        &lt;element name="imdn"&gt;
            &lt;element name="message-id"&gt;
                &lt;data type="token"/&gt;
            &lt;/element&gt;
            &lt;element name="datetime"&gt;
                &lt;data type="string"/&gt;
            &lt;/element&gt;
            &lt;optional&gt;
                &lt;element name="recipient-uri"&gt;
                    &lt;data type="anyURI"/&gt;
                &lt;/element&gt;
                &lt;element name="original-recipient-uri"&gt;
                    &lt;data type="anyURI"/&gt;
                &lt;/element&gt;
                &lt;element name="subject"&gt;
                    &lt;data type="string"/&gt;
                &lt;/element&gt;
            &lt;/optional&gt;
            &lt;choice&gt;
                &lt;ref name="deliveryNotification"/&gt;
                &lt;ref name="readNotification"/&gt;
                &lt;ref name="processingNotification"/&gt;
                &lt;zeroOrMore&gt;
                    &lt;empty/&gt;
                &lt;/zeroOrMore&gt;
            &lt;/choice&gt;
            &lt;ref name="note"/&gt;
            &lt;zeroOrMore&gt;
                &lt;ref name="Extension"/&gt;
            &lt;/zeroOrMore&gt;
            &lt;zeroOrMore&gt;
                &lt;ref name="anyIMDN"/&gt;
            &lt;/zeroOrMore&gt;
        &lt;/element&gt;
    &lt;/start&gt;

    &lt;define name="deliveryNotification"&gt;
        &lt;element name="disposition"&gt;
            &lt;element name="delivery"&gt;
                &lt;empty/&gt;
            &lt;/element&gt;
        &lt;/element&gt;
        &lt;element name="status"&gt;
            &lt;choice&gt;
                &lt;element name="delivered"&gt;
                    &lt;empty/&gt;
                &lt;/element&gt;
                &lt;element name="failed"&gt;
                    &lt;empty/&gt;
                &lt;/element&gt;
                &lt;ref name="commonDispositionStatus"&gt;&lt;/ref&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="Extension"/&gt;
                &lt;/zeroOrMore&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="anyIMDN"/&gt;
                &lt;/zeroOrMore&gt;
            &lt;/choice&gt;
        &lt;/element&gt;
    &lt;/define&gt;

    &lt;define name="readNotification"&gt;
        &lt;element name="disposition"&gt;
            &lt;element name="read"&gt;
                &lt;empty/&gt;
            &lt;/element&gt;
        &lt;/element&gt;
        &lt;element name="status"&gt;
            &lt;choice&gt;
                &lt;element name="read"&gt;
                    &lt;empty/&gt;
                &lt;/element&gt;
                &lt;ref name="commonDispositionStatus"&gt;&lt;/ref&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="Extension"/&gt;
                &lt;/zeroOrMore&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="anyIMDN"/&gt;
                &lt;/zeroOrMore&gt;
            &lt;/choice&gt;
        &lt;/element&gt;
    &lt;/define&gt;

    &lt;define name="processingNotification"&gt;
        &lt;element name="disposition"&gt;
            &lt;element name="processing"&gt;
                &lt;empty/&gt;
            &lt;/element&gt;
        &lt;/element&gt;
        &lt;element name="status"&gt;
            &lt;choice&gt;
                &lt;element name="processed"&gt;
                    &lt;empty/&gt;
                &lt;/element&gt;
                &lt;element name="stored"&gt;
                    &lt;empty/&gt;
                &lt;/element&gt;
                &lt;ref name="commonDispositionStatus"&gt;&lt;/ref&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="Extension"/&gt;
                &lt;/zeroOrMore&gt;
                &lt;zeroOrMore&gt;
                    &lt;ref name="anyIMDN"/&gt;
                &lt;/zeroOrMore&gt;
            &lt;/choice&gt;
        &lt;/element&gt;
    &lt;/define&gt;

    &lt;define name="commonDispositionStatus"&gt;
        &lt;choice&gt;
            &lt;element name="forbidden"&gt;
                &lt;empty/&gt;
            &lt;/element&gt;
            &lt;element name="error"&gt;
                &lt;empty/&gt;
            &lt;/element&gt;
            &lt;zeroOrMore&gt;
                &lt;ref name="Extension"/&gt;
            &lt;/zeroOrMore&gt;
            &lt;zeroOrMore&gt;
                &lt;ref name="anyIMDN"/&gt;
            &lt;/zeroOrMore&gt;
        &lt;/choice&gt;
    &lt;/define&gt;

    &lt;define name="note"&gt;
        &lt;element name="note"&gt;
            &lt;optional&gt;
                &lt;attribute&gt;
                    &lt;name ns="http://www.w3.org/XML/1998/namespace"&gt;
                        lang
                    &lt;/name&gt;
                    &lt;data type="language"/&gt;
                &lt;/attribute&gt;
            &lt;/optional&gt;
            &lt;data type="string"/&gt;
        &lt;/element&gt;
    &lt;/define&gt;

    &lt;define name="Extension"&gt;
        &lt;empty/&gt;
    &lt;/define&gt;

    &lt;define name="anyIMDN"&gt;
        &lt;element&gt;
            &lt;anyName&gt;
                &lt;except&gt;
                    &lt;nsName ns="urn:ietf:params:xml:ns:imdn"/&gt;
                    &lt;nsName ns=""/&gt;
                &lt;/except&gt;
            &lt;/anyName&gt;
            &lt;mixed&gt;
                &lt;zeroOrMore&gt;
                    &lt;choice&gt;
                        &lt;attribute&gt;
                            &lt;anyName/&gt;
                        &lt;/attribute&gt;
                        &lt;ref name="anyIMDN"/&gt;
                    &lt;/choice&gt;
                &lt;/zeroOrMore&gt;
            &lt;/mixed&gt;
        &lt;/element&gt;
    &lt;/define&gt;

&lt;/grammar&gt;

</pre></div>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Transporting Messages using SIP</h3>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Endpoint Behaviour</h3>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.1"></a><h3>12.1.1.&nbsp;
Sending Requests</h3>

<p>The IM Sender constructs a SIP MESSAGE request using <a class='info' href='#RFC3428'>RFC 3428<span> (</span><span class='info'>Campbell, B., &ldquo;SIP Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> [RFC3428]. The Content-type header field
          indicates the MIME type of the request payload. When using this
          extension, the Content-type header field MUST be of MIME type <a class='info' href='#RFC3862'>"message/cpim"<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862] for both IMs and IMDNs. The
          IM Sender constructs the payload according to <a class='info' href='#endpoint-behaviour'>Section&nbsp;7<span> (</span><span class='info'>Endpoint Behaviour</span><span>)</span></a>.
</p>
<p>The IM Sender constructs a SIP MESSAGE request to multiple
          recipients in a similar manner as a SIP MESSAGE request to a single
          recipient. <a class='info' href='#I-D.ietf-sip-uri-list-message'>Multiple-Recipient MESSAGE
          Requests in SIP<span> (</span><span class='info'>Garcia-Martin, M. and G. Camarillo, &ldquo;Multiple-Recipient MESSAGE Requests in the Session Initiation           Protocol (SIP),&rdquo; December&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;sip&#8209;uri&#8209;list&#8209;message] describes the differences.
</p>
<p>IM senders can remain anonymous. For example, the sender can set
          the SIP From header field of the SIP message to an anonymous URI. As
          there is no return address, anonymous IM senders SHOULD NOT request
          disposition notifications. An IM Recipient can ignore such request
          if the IM Sender is anonymous.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.2"></a><h3>12.1.2.&nbsp;
Sending Responses</h3>

<p>An endpoint receiving a SIP MESSAGE request constructs a SIP
          response according to RFC 3428 <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., &ldquo;SIP Extension for Instant Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>. Of
          course, an endpoint will send a response to the MESSAGE request
          regardless of the type of message (IM or IMDN) is has received, or
          the disposition type it has been asked for.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.3"></a><h3>12.1.3.&nbsp;
Receiving Requests</h3>

<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.3.1"></a><h3>12.1.3.1.&nbsp;
Instant Message</h3>

<p>A SIP MESSAGE request is identified as an IM by examining its
            contents according to <a class='info' href='#identifying-messages'>Section&nbsp;9<span> (</span><span class='info'>Identifying Messages</span><span>)</span></a>.
</p>
<p>If an IM Recipient received a SIP MESSAGE request that is an IM
            that requested a positive-delivery notification, and that IM
            Recipient has constructed and sent a SIP 2xx class response, it
            MAY generate a positive-delivery notification after making sure
            that the IM has been delivered to the user or application. A
            gateway, for example, can generate a 2xx response before the final
            recipient received the IM. The IM Recipient constructs a
            positive-delivery notification according to <a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a>. The IM Recipient
            places the message as the payload in a SIP MESSAGE request.
</p>
<p>If an IM Recipient received a SIP MESSAGE request that is an IM
            that requested a negative-delivery, and that IM Recipient has
            constructed and sent a 2xx class response, it SHOULD generate a
            negative-delivery notification if it learnt that the final
            recipient or application did not receive the IM (a gateway, for
            example, can generate a 2xx response before it has an error
            response from downstream or before any internal timers fire
            waiting for a response). The negative-delivery notification is
            constructed according to <a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a>. The message is
            then placed as the payload in a SIP MESSAGE request. <br />
<br />
 If an IM Recipient received a SIP MESSAGE
            request that is an IM that requested a negative-delivery
            notification, and the IM Recipient has constructed and sent an
            non-2xx final response, it MUST NOT generate a negative-delivery
            notification.
</p>
<p>If an IM Recipient received a SIP MESSAGE request that is an IM
            that requested a read notification, and that IM Recipient has
            constructed and sent a SIP 2xx class response, it MAY generate a
            read notification after making sure that the IM has been presented
            to the user or application. It is outside the scope of this
            document how such determination can be made. Note that the option
            to send a read notification or not can be left to the user. An
            application may allow a user to configure such choice. The IM
            Recipient constructs the read notification according to <a class='info' href='#generate-read-notification'>Section&nbsp;7.2.1.2<span> (</span><span class='info'>Constructing Read Notifications</span><span>)</span></a>. The IM Recipient
            places the message as the payload in a SIP MESSAGE request.
</p>
<p>For IMDNs, the IM Recipient populates the SIP Request-URI and
            the SIP To header field using the address that appeared in the SIP
            From header field in the IM.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.3.2"></a><h3>12.1.3.2.&nbsp;
Delivery Notification</h3>

<p>A SIP MESSAGE request is identified as delivery notification by
            examining its contents according to <a class='info' href='#identifying-messages'>Section&nbsp;9<span> (</span><span class='info'>Identifying Messages</span><span>)</span></a>.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.3.3"></a><h3>12.1.3.3.&nbsp;
Read Notification</h3>

<p>A SIP MESSAGE request is identified as read notification by
            examining its contents according to <a class='info' href='#identifying-messages'>Section&nbsp;9<span> (</span><span class='info'>Identifying Messages</span><span>)</span></a>.
</p>
<a name="sip-intermediary-behaviour"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Intermediary Behaviour</h3>

<p>In this context, intermediaries include application servers,
        including URI-List servers, store-and-forward servers, and gateways.
        SIP Proxies MUST NOT generate IMDNs but MUST forward them like any
        other SIP request.
</p>
<p>Intermediaries forward a SIP MESSAGE request to multiple recipients
        according to <a class='info' href='#I-D.ietf-sip-uri-list-message'>[I&#8209;D.ietf&#8209;sip&#8209;uri&#8209;list&#8209;message]<span> (</span><span class='info'>Garcia-Martin, M. and G. Camarillo, &ldquo;Multiple-Recipient MESSAGE Requests in the Session Initiation           Protocol (SIP),&rdquo; December&nbsp;2007.</span><span>)</span></a>.
</p>
<p>If an intermediary receives an IM, the intermediary examines the
        body. If the body is of type "message/cpim" the intermediary then
        looks for a Disposition-Notification CPIM header field in the message.
        If the Disposition-Notification CPIM header field has either the value
        "positive-delivery" or "negative-delivery", and, in processing the IM,
        the intermediary generates a SIP 2xx class response to the MESSAGE
        request, then the intermediary performs the following actions.
</p>
<p>If the Disposition-Notification header field contains a value of
        "positive-delivery", the intermediary MUST NOT generate a delivery
        notification if it receives a SIP 2xx class response for the sent IM.
        This is in anticipation of a failure downstream after a 2xx response
        has been generated.
</p>
<p>If the Disposition-Notification header field contains a value of
        "negative-delivery", the intermediary SHOULD generate a delivery
        notification if it receives a SIP 4xx, 5xx or 6xx class final response
        for the sent IM. If it has received a SIP 2xx class response followed
        by a negative-delivery notification, the intermediary forwards that
        negative-delivery notification or aggregates it.
</p>
<p>If the Disposition-Notification header field contains a value of
        "processing", the intermediary MAY generate a processing notification
        after it has forwarded or stored the IM. The rest of the procedures in
        <a class='info' href='#generate-processing-notification'>Section&nbsp;8.1<span> (</span><span class='info'>Constructing Processing Notifications</span><span>)</span></a> apply.
</p>
<p>The procedure for generating such IMDN is the same as that of an IM
        Recipient (<a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a>).
        <br />
<br />
 The &lt;recipient-uri&gt; element of the XML
        body is populated with the URI of the IM Recipient.
</p>
<p>If an intermediary receives a SIP MESSAGE request carrying a
        positive delivery notification or a read notification, it forwards it
        using the rules in <a class='info' href='#intermediary-behaviour'>Section&nbsp;8<span> (</span><span class='info'>Intermediary Behaviour</span><span>)</span></a>.
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Transporting Messages using MSRP</h3>

<p>MSRP already provides a built-in mechanism to supply positive and
      negative delivery reports. <br />
<br />
 While MSRP does not
      provide a built-in Read or Processing notification dispositions, those
      are generally not considered as useful information for session IM. This
      is because the assumption behind MSRP is that SEND requests do not reach
      a mailbox where incoming IMs have to be open, but to an application that
      renders sequentially those incoming IMs, providing the session
      experience. This kind of applications has no means of identifying when a
      user has read the IM and therefore cannot be useful information for the
      sender. <br />
<br />
 IMDN use cases for MSRP have not been
      fully explored. If new requirements arise in the future determining the
      need for IMDN in MSRP, new specifications can be drafted.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
Security Considerations</h3>

<p>IMDNs provide a fine-grained view of the activity of the IM Recipient
      and thus deserves particularly careful confidentiality protection so
      that only the intended recipient of the IMDN will receive the IMDN. In
      most cases, the intended recipient of the IMDN is the IM Sender.
</p>
<p>Since the IM transport protocol carries the IMDN, all security
      considerations of the underlying IM protocol also apply to the
      IMDNs.
</p>
<p>The threats in the IMDN system, over and beyond the threats inherent
      to IM include the following: </p>
<ul class="text">
<li>A malicious endpoint attempts to send messages to a user that
          would normally not wish to receive messages from that endpoint by
          convincing the IMDN system to "bounce" an IMDN from an unsuspecting
          endpoint to the user.
</li>
<li>A malicious endpoint attempts to flood an IM Sender with IMDNs by
          convincing a URI-List server to send IMDNs to an unsuspecting IM
          Sender.
</li>
<li>A malicious node in the network that attempts to modify an IMDN
          from an IM Recipient.
</li>
<li>A malicious intermediary attempts to forward an IMDN from an IM
          Recipient to the IM Sender, where the IM Recipient would not
          normally forward the IMDN to that IM Sender if the IM Recipient knew
          the identity of the IM Sender.
</li>
<li>A malicious endpoint that attempts to fish for a Request-URI of
          an endpoint beyond an intermediary, where the endpoint would
          normally wish to keep its identity private from the malicious
          endpoint.
</li>
<li>A malicious node in the network that attempts to eavesdrop on
          IMDN traffic to, for example, learn Request-URI or traffic pattern
          information.
</li>
<li>A malicious node in the network attempts to stage a denial of
          service attack on an intermediary by requesting a large list
          expansion.
</li>
</ul>

<p>The protocol cannot protect against attacks that include the
      following: </p>
<ul class="text">
<li>A malicious intermediary directly revealing the identity of a
          downstream endpoint that would not normally wish its identity
          revealed. Keeping such information private is an intermediary
          implementation issue.
</li>
<li>A malicious IM Recipient that alters the time of the IMDN. There
          is no protocol mechanism for ensuring that the IM Recipient does not
          lie about the time or purposely holds an IMDN for transmission to
          make it appear that the user read an IM later than they actually
          did.
</li>
<li>A deletion attack on an IMDN. This is a trade-off between privacy
          and security. The privacy considerations allow the IM Recipient to
          silently ignore an IMDN request. Any mechanism that would reliably
          indicate that a malicious node deleted an IM Recipient's IMDN would
          also serve the purpose of detecting an IM Recipient that chose not
          to issue an IMDN.
</li>
</ul>

<p>To combat eavesdropping, modification, and man-in-the-middle attacks,
      we require some level of authentication and integrity protections. That
      said, there are circumstances where strong integrity would be overkill.
      The presumption is the IM Sender has and sets the expectation for the
      level of protection. The procedures for integrity protection are as
      follows. </p>
<ul class="text">
<li>If the IM Recipient has a certificate, it MUST sign the IMDN.
          Signing the IMDN provides integrity protection. While an
          intermediary can replace the IMDN body, the IM Sender (the recipient
          of the IMDN) can validate the signature and note the IMDN does not
          come directly from the IM Receiver. This is not a problem if the IM
          Sender trusts the intermediary. Likewise, an IMDN in response to a
          signed IM without a signature indicates something bad might have
          happened.
</li>
<li>If the IM is encrypted, the IM Recipient or intermediary MUST
          encrypt the IMDN body, as an attacker may attempt to discern the
          user's activity profile and identity from sniffing IMDNs on the
          network.
</li>
<li>The two above rules are cumulative.
</li>
</ul><p>The IM Recipient or intermediary MUST be capable of accessing
      the IM Sender's public certificate in order to verify the signature in
      the IM.
</p>
<p><a class='info' href='#RFC3862'>CPIM security considerations<span> (</span><span class='info'>Klyne, G. and D. Atkins, &ldquo;Common Presence and Instant Messaging (CPIM): Message           Format,&rdquo; August&nbsp;2004.</span><span>)</span></a> [RFC3862] apply
      here, as this is an extension of CPIM. In order to make the IMDN
      mechanism independent of the transport protocol, the Work Group made the
      design choice of putting routing information into the IMDN application
      layer payload. One consequence of this choice is it eliminates the
      possibility of having end-to-end encryption.
</p>
<p>An attacker can mount a distributed denial of service attack on a
      node by sending lots of IMs to the node with IMDN requests. Note that
      this is the same problem as there is without IMDN; IMDN simply linearly
      increases the load on the node under attack. One can mitigate, but not
      eliminate this threat by the endpoint immediately ignoring requests that
      are not authenticated.
</p>
<p>Likewise, an attacker can mount a denial of service attack on an
      intermediary by asking the intermediary to explode a large list.
</p>
<p>The following security considerations apply when using IMDNs:
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.1"></a><h3>14.1.&nbsp;
Forgery</h3>

<p>IMs can be forged. To protect against that, an IM can be signed. An
        intermediary that receives a signed message and needs to modify any
        part of it that is included in the signature (like adding an
        Original-To header field to the CPIM header fields), MUST consume the
        IM and create a new copy of it that the intermediary signs itself.
        <br />
<br />
 IMDNs may be forged as easily as ordinary
        IMs. Endpoints and intermediaries that wish to make automatic use of
        IMDNs should take appropriate precautions to minimize the potential
        damage from denial-of-service attacks. Security threats related to
        forged IMDNs include the sending of a falsified IMDN when the
        indicated disposition of the IM has not actually occurred. For
        example, read notification could be forged to indicate that an IM
        Recipient has read the IM. Unsolicited IMDNs is also another form of
        forgery.
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.2"></a><h3>14.2.&nbsp;
Confidentiality</h3>

<p>There may be cases where an IM Recipient does not wish to reveal
        the information that he has received or in fact read the IM. In this
        situation, it is acceptable for the IM Recipient to silently ignore
        requests for an IMDN. It is strongly RECOMMENDED that the IM Recipient
        obtain the user's consent before sending an IMDN. Circumstances where
        the IM Recipient does not ask for the user's consent include IM
        systems that, for regulatory reasons, are required to issue an IMDN,
        such as in the health care field or financial community.
</p>
<p>An IM Recipient can obtain such consent by a prompt or dialog box
        on a per-IM basis, globally through the user's setting of a
        preference, or other, user-configurable mechanism. The user might also
        indicate globally that IMDNs are never to be sent or that a
        "forbidden" IMDN status is always sent in response to a request for an
        IMDN.
</p>
<p>There are situations where a user sends an IM and requests IMDNs to
        a list whose member information is not disclosed. In this situation,
        the user will learn of the list members. Therefore, in this case, the
        URI-List server MUST remove any information about list members. If the
        number of members in the list is also not disclosed, the URL-List
        server MUST only deliver one aggregated IMDN. Alternatively, the
        URI-list server MAY reject the IM.
</p>
<p>It is possible for a list server to not understand IMDN. IM
        Recipients may note the To is a list name and not the IM Recipient's
        name. In this case, the IM Recipient can take the appropriate action
        if it wishes to keep its identity private.
</p>
<p>An unencrypted IMDN could reveal confidential information about an
        encrypted IM. The same level of security applied to an IM MUST be
        applied to its IMDNs. For example, if an IM is signed and encrypted,
        the IMDN must be signed and encrypted.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.3"></a><h3>14.3.&nbsp;
Non-Repudiation</h3>

<p>IMDNs cannot be relied on as a guarantee that an IM was or was not
        seen by the user. Even if IMDNs are not actively forged, they may be
        lost in transit. Moreover, the IM Recipient may bypass the IMDN
        issuing mechanism through policy or manipulation of their User Agent
        Server.
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
IANA Considerations</h3>

<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.1"></a><h3>15.1.&nbsp;
message/imdn+xml MIME TYPE</h3>

<p>This document registers a new MIME type "message/imdn+xml", and
        registers a new XML namespace. <br />
<br />
 This
        specification follows the guidelines of <a class='info' href='#RFC3023'>RFC
        3023<span> (</span><span class='info'>Murata, M., &ldquo;XML Media Types,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC3023]. <br />
<br />
 MIME media type: message
        <br />
<br />
 MIME subtype name: imdn+xml <br />
<br />
 Mandatory parameters: none <br />
<br />

        Optional parameters: Same as charset parameter application/xml as
        specified in RFC 3023 <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., &ldquo;XML Media Types,&rdquo; March&nbsp;1997.</span><span>)</span></a>. <br />
<br />
 Encoding considerations: Same as encoding
        considerations of application/xml as specified in RFC 3023 <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., &ldquo;XML Media Types,&rdquo; March&nbsp;1997.</span><span>)</span></a>. <br />
<br />
 Security
        considerations: See section 10 of RFC 3023 <a class='info' href='#RFC3023'>[RFC3023]<span> (</span><span class='info'>Murata, M., &ldquo;XML Media Types,&rdquo; March&nbsp;1997.</span><span>)</span></a> and <a class='info' href='#security'>Section&nbsp;14<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> of this
        document. <br />
<br />
 Interoperability considerations:
        none. <br />
<br />
 Published specification: This
        document. <br />
<br />
 Applications which use this media
        type: This document type is used to support CPIM based instant
        messaging. <br />
<br />
 Additional information: None
        <br />
<br />
 Magic number: None <br />
<br />

        File extension: .cl or .xml <br />
<br />
 Macintosh file
        type code: "TEXT" <br />
<br />
 Personal and email address
        for further information: Hisham Khartabil (hisham.khartabil@gmail.com)
        <br />
<br />
 Intended Usage: COMMON <br />
<br />
 Author/change controller: The IETF .
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.2"></a><h3>15.2.&nbsp;
URN Sub-Namespace Registration for urn:ietf:params:xml:ns:imdn</h3>

<p>This section registers a new XML namespace, as per guidelines in
        the IETF XML Registry <a class='info' href='#IANA'>[IANA]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>. <br />
<br />
 URI: The URI for this namespace is
        urn:ietf:params:xml:ns:imdn. <br />
<br />
 Registrant
        Contact: IETF, SIMPLE working group, Hisham Khartabil
        (hisham.khartabil@gmail.com) .
</p>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.3"></a><h3>15.3.&nbsp;
Schema Registration</h3>

<p>This section registers a new XML schema per the procedures in <a class='info' href='#IANA'>[IANA]<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a>. <br />
<br />
 URI:
        urn:ietf:params:xml:ns:imdn <br />
<br />
 Registrant
        Contact: IETF, SIMPLE working group, Hisham Khartabil
        (hisham.khartabil@gmail.com) <br />
<br />
 The XML for
        this schema can be found as the sole content of <a class='info' href='#schema'>Section&nbsp;11.3<span> (</span><span class='info'>The RelaxNG Schema</span><span>)</span></a>.
</p>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.4"></a><h3>15.4.&nbsp;
Registration for urn:ietf:params:imdn</h3>

<p>Registry name: imdn <br />
<br />
 Specification: RFC
        XXXX. Additional values may be defined by standards track RFCs that
        update or obsolete RFC XXXX (Specification Required). <br />
<br />
 Repository: http://www.iana.org/assignments/imdn
        <br />
<br />
 Index value: The index value is a CPIM
        message IMDN header name, which may consist of a sequence from a
        restricted set of US-ASCII characters, as defined above. <br />
<br />
 URN Formation: The URI for a header is formed from
        its name by: </p>
<blockquote class="text">
<p>a) replacing any non-URN characters (as defined by RFC
            2141<a class='info' href='#URN'>[URN]<span> (</span><span class='info'>Moats, R., &ldquo;The URN Syntax,&rdquo; May&nbsp;1997.</span><span>)</span></a>) with the corresponding '%hh'
            escape sequence (per <a class='info' href='#RFC2396'>RFC 3986<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier           (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> [RFC2396]);
            and
</p>
<p>b) prepending the resulting string with
            'urn:ietf:params:imdn:'.
</p>
</blockquote><p> <br />
<br />
 Thus, the URI corresponding to the
        CPIM message IMDN header 'Disposition-Notification:' would be
        'urn:ietf:params:imdn:Disposition-Notification'.
</p>
<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.5"></a><h3>15.5.&nbsp;
Message/CPIM Header Field Registration</h3>

<p>This document registers the following message/cpim header fields in
        the imdn fields registry: <br />
<br />

        Disposition-Notification - [RFCXXXX] <br />
<br />

        Message-ID - [RFCXXXX] <br />
<br />
 Original-To -
        [RFCXXXX] <br />
<br />
 IMDN-Record-Route - [RFCXXXX]
        <br />
<br />
 IMDN-Route - [RFCXXXX]
</p>
<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15.6"></a><h3>15.6.&nbsp;
Content-Disposition: notification</h3>

<p>This document registers one new Content-Disposition header field
        "disposition-types": notification. The authors request that this value
        be recorded in the IANA registry for Content-Dispositions. <br />
<br />
 Descriptions of this "disposition-types", including
        motivation and examples, are given in <a class='info' href='#generate-delivery-notification'>Section&nbsp;7.2.1.1<span> (</span><span class='info'>Constructing Delivery Notifications</span><span>)</span></a> and <a class='info' href='#identifying-messages'>Section&nbsp;9<span> (</span><span class='info'>Identifying Messages</span><span>)</span></a>. <br />
<br />
 Short
        descriptions suitable for the IANA registry are: <br />
<br />
 notification the body of the message is a
        notification according to an earlier request for a disposition
        notification to an instant message
</p>
<a name="Ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
Acknowledgements</h3>

<p>The authors would like to thank Paul Kyzivat, Ben Campbell, Adam
      Roach, Gonzalo Camarillo, Sean Olson, Eva Leppanen, Miguel Garcia, Eric
      McMurry, Jari Urpalainen, Jon Peterson, and Robert Sparks for their
      comments and support.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement
          Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3862">[RFC3862]</a></td>
<td class="author-text">Klyne, G. and D. Atkins, &ldquo;<a href="http://tools.ietf.org/html/rfc3862">Common Presence and Instant Messaging (CPIM): Message
          Format</a>,&rdquo; RFC&nbsp;3862, August&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="IANA">[IANA]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; RFC&nbsp;3688, January&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="URN">[URN]</a></td>
<td class="author-text">Moats, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2141">The URN Syntax</a>,&rdquo; RFC&nbsp;2141, May&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3023">[RFC3023]</a></td>
<td class="author-text">Murata, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3023">XML Media Types</a>,&rdquo; RFC&nbsp;3023, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text">Bray, T., &ldquo;Extensible Markup Language (XML) 1.0 (Second Edition),&rdquo; &nbsp;W3C CR CR-xml11-20011006, October&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2396">[RFC2396]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier
          (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg et al., J., Shulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3428">[RFC3428]</a></td>
<td class="author-text">Campbell, B., &ldquo;<a href="http://tools.ietf.org/html/rfc3428">SIP Extension for Instant Messaging</a>,&rdquo; RFC&nbsp;3428, December&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2821">[RFC2821]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc2821">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;2821, April&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3798">[RFC3798]</a></td>
<td class="author-text">Hansen, T. and G. Vaudreuil, &ldquo;<a href="http://tools.ietf.org/html/rfc3798">Message Disposition Notification</a>,&rdquo; RFC&nbsp;3798, May&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="URN_NS">[URN_NS]</a></td>
<td class="author-text">Moats, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2648">The URN Namespace for IETF Documents</a>,&rdquo; RFC&nbsp;2648, August&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-uri-list-message">[I-D.ietf-sip-uri-list-message]</a></td>
<td class="author-text">Garcia-Martin, M. and G. Camarillo, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-uri-list-message-03.txt">Multiple-Recipient MESSAGE Requests in the Session Initiation
          Protocol (SIP)</a>,&rdquo; draft-ietf-sip-uri-list-message-03 (work in progress), December&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-uri-list-message-03.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Burger</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BEA Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4 Van de Graaff Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Burlington, MA  01803</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 781 993 7437</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1 603 457 5933</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:eric.burger@bea.com">eric.burger@bea.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hisham Khartabil</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Melbourne  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Australia</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+61 416 108 890</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hisham.khartabil@gmail.com">hisham.khartabil@gmail.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
