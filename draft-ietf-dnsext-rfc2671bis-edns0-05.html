<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Extension Mechanisms for DNS (EDNS0)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 EDNS Support Requirement">
<link href="#rfc.section.4" rel="Chapter" title="4 DNS Message changes">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Message Header">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Label Types">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 UDP Message Size">
<link href="#rfc.section.5" rel="Chapter" title="5 Extended Label Types">
<link href="#rfc.section.6" rel="Chapter" title="6 The OPT pseudo-RR">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 OPT Record Definition">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 OPT Record Wire Format">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Cache behaviour">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Fallback">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Requestor's Payload Size">
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 Responder's Payload Size">
<link href="#rfc.section.6.7" rel="Chapter" title="6.7 Payload Size Selection">
<link href="#rfc.section.6.8" rel="Chapter" title="6.8 Middleware Boxes">
<link href="#rfc.section.6.9" rel="Chapter" title="6.9 OPT Record TTL Field Use">
<link href="#rfc.section.6.10" rel="Chapter" title="6.10 Flags">
<link href="#rfc.section.6.11" rel="Chapter" title="6.11 OPT Options Code Allocation Procedure">
<link href="#rfc.section.7" rel="Chapter" title="7 Transport Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Domain Name System's wire protocol includes a number of fixed fields whose range has been or soon will be exhausted and does not allow requestors to advertise their capabilities to responders. This document describes backward compatible mechanisms for allowing the protocol to grow.  " />
  <meta name="description" content="The Domain Name System's wire protocol includes a number of fixed fields whose range has been or soon will be exhausted and does not allow requestors to advertise their capabilities to responders. This document describes backward compatible mechanisms for allowing the protocol to grow.  " />
  <meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, edns0, dns" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DNSEXT Working Group</td>
<td class="right">J.L.S.D. Damas</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">M.G. Graff</td>
</tr>
<tr>
<td class="left">Obsoletes: 2671, 2673 (if approved)</td>
<td class="right">P.V. Vixie</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Internet Systems Consortium</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right">March 07, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Extension Mechanisms for DNS (EDNS0)<br />
  <span class="filename">draft-ietf-dnsext-rfc2671bis-edns0-05</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Domain Name System's wire protocol includes a number of fixed fields whose range has been or soon will be exhausted and does not allow requestors to advertise their capabilities to responders. This document describes backward compatible mechanisms for allowing the protocol to grow.  </p>
<p>This document updates the EDNS0 specification [RFC2671] based on 10 years of deployment experience.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">EDNS Support Requirement</a>
</li>
<li>4.   <a href="#rfc.section.4">DNS Message changes</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Message Header</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Label Types</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">UDP Message Size</a>
</li>
<li>5.   <a href="#rfc.section.5">Extended Label Types</a>
</li>
<li>6.   <a href="#rfc.section.6">The OPT pseudo-RR</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">OPT Record Definition</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">OPT Record Wire Format</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Cache behaviour</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Fallback</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">Requestor's Payload Size</a>
</li>
<li>6.6.   <a href="#rfc.section.6.6">Responder's Payload Size</a>
</li>
<li>6.7.   <a href="#rfc.section.6.7">Payload Size Selection</a>
</li>
<li>6.8.   <a href="#rfc.section.6.8">Middleware Boxes</a>
</li>
<li>6.9.   <a href="#rfc.section.6.9">OPT Record TTL Field Use</a>
</li>
<li>6.10.   <a href="#rfc.section.6.10">Flags</a>
</li>
<li>6.11.   <a href="#rfc.section.6.11">OPT Options Code Allocation Procedure</a>
</li>
<li>7.   <a href="#rfc.section.7">Transport Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">DNS <a href="#RFC1035">[RFC1035]</a> specifies a Message Format and within such messages there are standard formats for encoding options, errors, and name compression. The maximum allowable size of a DNS Message is limited to 512 bytes. Many of DNS's protocol limits are too small for uses which are commom or desired to become common. RFC 1035 does not define any way for implementations to advertise their capabilities.  </p>
<p><a href="#RFC2671">[RFC2671]</a> added extension mechanism to DNS, this mechanism is widely supported and number of new DNS uses and protocol extensions depend on the presence of these extensions. This memo refines that specification and obsoletes <a href="#RFC2671">[RFC2671]</a>.  </p>
<p id="rfc.section.1.p.3">Unextended agents will not know how to interpret the protocol extensions defined in <a href="#RFC2671">[RFC2671]</a> and restated here.  Extended agents must be prepared for handling the interactions with unextended clients in the face of new protocol elements, and fall back gracefully to unextended DNS.  <a href="#RFC2671">[RFC2671]</a> proposed extensions to the basic DNS protocol to overcome these deficiencies.  This memo refines that specification and obsoletes <a href="#RFC2671">[RFC2671]</a>.  </p>
<p><a href="#RFC2671">[RFC2671]</a> specified extended label types. The only one proposed was in RFC2673 for a label type called "Bitstring Labels." For various reasons introducing a new label type was found to be extremely difficult, and RFC2673 was moved to Experimental.  This document Obsoletes Extended Labels.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">"Requestor" is the side which sends a request.  "Responder" is an authoritative, recursive resolver, or other DNS component which responds to questions.  </p>
<p id="rfc.section.2.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> EDNS Support Requirement</h1>
<p id="rfc.section.3.p.1">EDNS support is practically mandatory in a modern world. DNSSEC requires EDNS support, and many other features are made possible only by EDNS support to request or advertise them.  Many organizations are requiring DNSSEC.  Without common interoperability, DNSSEC cannot be as easily deployed.  </p>
<p id="rfc.section.3.p.2">DNS publishers are wanting to put more data in answers. DNSSEC DNSKEY records, negative answers, and many other DNSSEC queries cause larger answers to be returned.  In order to support this, DNS servers, middleware, and stub resolvers MUST support larger packet sizes advertised via EDNS0.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> DNS Message changes</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Message Header</h1>
<p id="rfc.section.4.1.p.1">The DNS Message Header's second full 16-bit word is divided into a 4-bit OPCODE, a 4-bit RCODE, and a number of 1-bit flags (see <a href="#RFC1035">, section 4.1.1</a> <cite title="NONE">[RFC1035]</cite>). Some of these were marked for future use, and most these have since been allocated. Also, most of the RCODE values are now in use. The OPT pseudo-RR specified below contains extensions to the RCODE bit field as well as additional flag bits.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Label Types</h1>
<p id="rfc.section.4.2.p.1">The first two bits of a wire format domain label are used to denote the type of the label.  <a href="#RFC1035">[RFC1035]</a> allocates two of the four possible types and reserves the other two.  More label types were defined in <a href="#RFC2671">[RFC2671]</a>. This document obsoletes the use of the 2-bit combination defined by <a href="#RFC2671">[RFC2671]</a> to identify extended label types.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> UDP Message Size</h1>
<p id="rfc.section.4.3.p.1">Traditional DNS Messages are limited to 512 octets in size when sent over UDP (<a href="#RFC1035">[RFC1035]</a>).  Today, many organizations wish to return many records in a single reply, and special tricks are needed to make the responses fit in this 512-byte limit.  Additionally, inclusion of DNSSEC records frequently requires a much larger response than a 512 byte message can hold.  </p>
<p id="rfc.section.4.3.p.2">EDNS0 is intended to address these larger packet sizes and continue to use UDP.  It specifies a way to advertise additional features such as larger response size capability, which is intended to help avoid truncated UDP responses which then cause retry over TCP.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Extended Label Types</h1>
<p id="rfc.section.5.p.1">The first octet in the on-the-wire representation of a DNS label specifies the label type; the basic DNS specification <a href="#RFC1035">[RFC1035]</a> dedicates the two most significant bits of that octet for this purpose.  </p>
<p><a href="#RFC2671">[RFC2671]</a> defined DNS label type 0b01 for use as an indication for Extended Label Types. A specific Extended Label Type is selected by the 6 least significant bits of the first octet. Thus, Extended Label Types are indicated by the values 64-127 (0b01xxxxxx) in the first octet of the label.  </p>
<p id="rfc.section.5.p.3">Extended Label Types are difficult to use due to support in clients and intermediate gateways as described in <a href="#RFC3364">[RFC3364]</a> which moves them to experimental status and <a href="#RFC3363">[RFC3363]</a>, which describes the pros and cons.  </p>
<p id="rfc.section.5.p.4">Therefore, this document moves them from experimental to historical, making them obsoleted. Additionally, the registry of Extended Label Types is requested to be closed.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> The OPT pseudo-RR</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> OPT Record Definition</h1>
<p id="rfc.section.6.1.p.1">An OPT pseudo-RR (sometimes called a meta-RR) MAY be added to the additional data section of a request.  </p>
<p id="rfc.section.6.1.p.2">The OPT RR has RR type 41.  </p>
<p id="rfc.section.6.1.p.3">If present in requests, compliant responders MUST include an OPT record in their respective responses.  </p>
<p id="rfc.section.6.1.p.4">An OPT record does not carry any DNS data. It is used only to contain control information pertaining to the question and answer sequence of a specific transaction. OPT RRs MUST NOT be cached, forwarded, or stored in or loaded from master files.  </p>
<p id="rfc.section.6.1.p.5">The OPT RR MAY be placed anywhere within the additional data section.  Only one OPT RR MAY be included within any DNS message. If a message with more than one OPT RR is received, a FORMERR (RCODE=1) MUST be returned.  The placement flexibility for the OPT RR does not override the need for the TSIG or SIG(0) RRs to be the last in the additional section whenever they are present.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> OPT Record Wire Format</h1>
<p id="rfc.section.6.2.p.1">An OPT RR has a fixed part and a variable set of options expressed as {attribute, value} pairs. The fixed part holds some DNS meta data and also a small collection of basic extension elements which we expect to be so popular that it would be a waste of wire space to encode them as {attribute, value} pairs.  </p>
<p id="rfc.section.6.2.p.2">The fixed part of an OPT RR is structured as follows: </p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>OPT RR Format</caption>
<thead><tr>
<th class="left">Field Name</th>
<th class="left">Field Type</th>
<th class="left">Description</th>
</tr></thead>
<tbody>
<tr>
<td class="left">NAME</td>
<td class="left">domain name</td>
<td class="left">Must be 0 (root domain)</td>
</tr>
<tr>
<td class="left">TYPE</td>
<td class="left">u_int16_t</td>
<td class="left">OPT (42)</td>
</tr>
<tr>
<td class="left">CLASS</td>
<td class="left">u_int16_t</td>
<td class="left">requestor's UDP payload size</td>
</tr>
<tr>
<td class="left">TTL</td>
<td class="left">u_int32_t</td>
<td class="left">extended RCODE and flags</td>
</tr>
<tr>
<td class="left">RDLEN</td>
<td class="left">u_int16_t</td>
<td class="left">length of all RDATA</td>
</tr>
<tr>
<td class="left">RDATA</td>
<td class="left">octet stream</td>
<td class="left">{attribute,value} pairs</td>
</tr>
</tbody>
</table>
<p id="rfc.section.6.2.p.3">The variable part of an OPT RR may contain zero or more options in the RDATA.  Each option must be treated as binary.  Each option is encoded as: </p>
<div id="#rfc.figure.1"></div>
<pre>
 
              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |                          OPTION-CODE                          |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: |                         OPTION-LENGTH                         |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
4: |                                                               |
   /                          OPTION-DATA                          /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre>
<p></p>

<dl>
<dt>OPTION-CODE</dt>
<dd style="margin-left: 6">
<br> Assigned by Expert Review.  </dd>
<dt>OPTION-LENGTH</dt>
<dd style="margin-left: 6">
<br> Size (in octets) of OPTION-DATA.  </dd>
<dt>OPTION-DATA</dt>
<dd style="margin-left: 6">
<br> Varies per OPTION-CODE. MUST be treated as binary.  </dd>
</dl>

<p> </p>
<p id="rfc.section.6.2.p.5">The order of appearance of option tuples is not defined.  If one option modifies the behavior of another or multiple options are related to one another in some way, they have the same effect regardless of ordering in the RDATA wire encoding.  </p>
<p id="rfc.section.6.2.p.6">Any OPTION-CODE values not understood by a responder or requestor MUST be ignored.  Specifications of such options might wish to include some kind of signaled acknowledgement.  For example, an option specification might say that if a responder sees option XYZ, it MUST include option XYZ in its response.  </p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> Cache behaviour</h1>
<p id="rfc.section.6.3.p.1">The OPT record MUST NOT be cached.  </p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Fallback</h1>
<p id="rfc.section.6.4.p.1">If a requestor detects that the remote end does not support EDNS0, it MAY issue queries without an OPT record.  It MAY cache this knowledge for a brief time in order to avoid fallback delays in the future.  However, if DNSSEC or any future option using EDNS is required, no fallback should be performed as they are only signaled through EDNS0.  If an implementation detects that some servers for the zone support EDNS(0) while others would force the use of TCP to fetch all data, preference SHOULD be given to those support EDNS(0).  </p>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> Requestor's Payload Size</h1>
<p id="rfc.section.6.5.p.1">The requestor's UDP payload size (encoded in the RR CLASS field) is the number of octets of the largest UDP payload that can be reassembled and delivered in the requestor's network stack.  Note that path MTU, with or without fragmentation, could be smaller than this.  Values lower than 512 MUST be treated as equal to 512.  </p>
<p id="rfc.section.6.5.p.2">The requestor SHOULD place a value in this field that it can actually receive.  For example, if a requestor sits behind a firewall which will block fragmented IP packets, a requestor SHOULD not choose a value which will cause fragmentation.  Doing so will prevent large responses from being received, and can cause fallback to occur.  </p>
<p id="rfc.section.6.5.p.3">Note that a 512-octet UDP payload requires a 576-octet IP reassembly buffer.  Choosing between 1280 and 1410 bytes for IP (v4 or v6) over Ethernet would be reasonable.  Choosing a very large value will guarantee fragmentation at the IP layer, and may prevent answers from being received due to a single fragment loss or misconfigured firewalls.  </p>
<p id="rfc.section.6.5.p.4">The requestor's maximum payload size can change over time. It MUST not be cached for use beyond the transaction in which it is advertised.  </p>
<h1 id="rfc.section.6.6">
<a href="#rfc.section.6.6">6.6.</a> Responder's Payload Size</h1>
<p id="rfc.section.6.6.p.1">The responder's maximum payload size can change over time, but can be reasonably expected to remain constant between two closely spaced sequential transactions;  for example, a meaningless QUERY to discover a responder's maximum UDP payload size, followed immediately by an UPDATE which takes advantage of this size.  This is considered preferable to the outright use of TCP for oversized requests, if there is any reason to suspect that the responder implements EDNS, and if a request will not fit in the default 512 payload size limit.  </p>
<h1 id="rfc.section.6.7">
<a href="#rfc.section.6.7">6.7.</a> Payload Size Selection</h1>
<p id="rfc.section.6.7.p.1">Due to transaction overhead, it is unwise to advertise an architectural limit as a maximum UDP payload size.  Just because your stack can reassemble 64KB datagrams, don't assume that you want to spend more than about 4KB of state memory per ongoing transaction.  </p>
<p id="rfc.section.6.7.p.2">A requestor MAY choose to implement a fallback to smaller advertised sizes to work around firewall or other network limitations.  A requestor SHOULD choose to use a fallback mechanism which begins with a large size, such as 4096.  If that fails, a fallback around the 1280-1410 byte range SHOULD be tried, as it has a reasonable chance to fit within a single Ethernet frame.  Failing that, a requestor MAY choose a 512 byte packet, which with large answers may cause a TCP retry.  </p>
<h1 id="rfc.section.6.8">
<a href="#rfc.section.6.8">6.8.</a> <a href="#middleboxes" id="middleboxes">Middleware Boxes</a>
</h1>
<p id="rfc.section.6.8.p.1">Middleware boxes (e.g. firewalls, SOHO routers, load balancers, etc) MUST NOT limit DNS messages over UDP to 512 bytes.  </p>
<p id="rfc.section.6.8.p.2">Middleware boxes which simply forward requests to a recursive resolver MUST NOT modify and MUST NOT delete the OPT record contents in either direction.  </p>
<p id="rfc.section.6.8.p.3">Middleware boxes which have additional functionality, such as answering certain queries or acting like an intelligent forwarder, MUST understand the OPT record.  These boxes MUST consider the incoming request and any outgoing requests as separate transactions if the characteristics of the messages are different.  </p>
<p id="rfc.section.6.8.p.4">A complete discussion of middleware boxes acting as DNS proxies and the impact of EDNS in those implementations is described in <a href="#RFC5625">[RFC5625]</a>.  </p>
<h1 id="rfc.section.6.9">
<a href="#rfc.section.6.9">6.9.</a> OPT Record TTL Field Use</h1>
<p id="rfc.section.6.9.p.1">The extended RCODE and flags (which OPT stores in the RR TTL field) are structured as follows: </p>
<div id="#rfc.figure.2"></div>
<pre>
              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |         EXTENDED-RCODE        |            VERSION            |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: | DO|                           Z                               |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
					</pre>
<p></p>

<dl>
<dt>EXTENDED-RCODE</dt>
<dd style="margin-left: 6">
<br> Forms upper 8 bits of extended 12-bit RCODE (together with the 4 bits defined in <a href="#RFC1035">[RFC1035]</a>.  Note that EXTENDED-RCODE value 0 indicates that an unextended RCODE is in use (values 0 through 15).  </dd>
<dt>VERSION</dt>
<dd style="margin-left: 6">
<br> Indicates the implementation level of whoever sets it.  Full conformance with this specification is indicated by version ``0.'' Requestors are encouraged to set this to the lowest implemented level capable of expressing a transaction, to minimize the responder and network load of discovering the greatest common implementation level between requestor and responder.  A requestor's version numbering strategy MAY ideally be a run time configuration option.  <br> If a responder does not implement the VERSION level of the request, then it answers with RCODE=BADVERS.  All responses MUST be limited in format to the VERSION level of the request, but the VERSION of each response SHOULD be the highest implementation level of the responder.  In this way a requestor will learn the implementation level of a responder as a side effect of every response, including error responses and including RCODE=BADVERS.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.10">
<a href="#rfc.section.6.10">6.10.</a> Flags</h1>
<p></p>

<dl>
<dt>DO</dt>
<dd style="margin-left: 6">
<br> DNSSEC OK bit as defined by <a href="#RFC3225">[RFC3225]</a>.  </dd>
<dt>Z</dt>
<dd style="margin-left: 6">
<br> Set to zero by senders and ignored by receivers, unless modified in a subsequent specification.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.11">
<a href="#rfc.section.6.11">6.11.</a> OPT Options Code Allocation Procedure</h1>
<p id="rfc.section.6.11.p.1">Allocations assigned by expert review.  Assignment of Option Codes should be liberal, but duplicate functionality is to be avoided.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Transport Considerations</h1>
<p id="rfc.section.7.p.1">The presence of an OPT pseudo-RR in a request should be taken as an indication that the requestor fully implements the given version of EDNS, and can correctly understand any response that conforms to that feature's specification.  </p>
<p id="rfc.section.7.p.2">Lack of presence of an OPT record in a request MUST be taken as an indication that the requestor does not implement any part of this specification and that the responder MUST NOT include an OPT record in its response.  </p>
<p id="rfc.section.7.p.3">Responders who do not implement these protocol extensions MUST respond with FORMERR messages without any OPT record.  </p>
<p id="rfc.section.7.p.4">If there is a problem with processing the OPT record itself, such as an option value that is badly formatted or includes out of range values, a FORMERR MUST be returned.  If this occurs the response MUST include an OPT record.  This is intended to allow the requestor to to distinguish between servers which do not implement EDNS and format errors within EDNS.  </p>
<p id="rfc.section.7.p.5">The minimal response must be the DNS header, question section, and an OPT record.  This must also occur when an truncated response (using the DNS header's TC bit) is returned.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">Requestor-side specification of the maximum buffer size may open a DNS denial of service attack if responders can be made to send messages which are too large for intermediate gateways to forward, thus leading to potential ICMP storms between gateways and responders.  </p>
<p id="rfc.section.8.p.2">Announcing very large UDP buffer sizes may result in dropping by middleboxes (see <a href="#middleboxes">Section 6.8</a>).  This could cause retransmissions with no hope of success.  Some devices have been found to reject fragmented UDP packets.  </p>
<p id="rfc.section.8.p.3">Announcing too small UDP buffer sizes may result in fallback to TCP with a corresponding load impact on DNS servers.  This is especially important with DNSSEC, where answers are much larger.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#iana_considerations" id="iana_considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">The IANA has assigned RR type code 41 for OPT.  </p>
<p><a href="#RFC2671">[RFC2671]</a> specified a number of IANA sub-registries within "DOMAIN NAME SYSTEM PARAMETERS:" </p>

<ul>
<li>EDNS Extended Label Type</li>
<li>EDNS Option Codes</li>
<li>EDNS Version Numbers</li>
<li>Domain System Response Code</li>
</ul>

<p> IANA is advised to re-parent these sub-registries to this document.  </p>
<p><a href="#RFC2671">[RFC2671]</a> created the "EDNS Extended Label Type Registry".  We request that this registry be closed.  </p>
<p id="rfc.section.9.p.4">This document assigns option code 65535 in the "EDNS Option Codes" registry to "Reserved for future expansion." </p>
<p><a href="#RFC2671">[RFC2671]</a> expands the RCODE space from 4 bits to 12 bits.  This allows more than the 16 distinct RCODE values allowed in <a href="#RFC1035">[RFC1035]</a>.  IETF Standards Action is required to add a new RCODE.  Adding new RCODEs should be avoided due to the difficulty in upgrading the installed base.  </p>
<p id="rfc.section.9.p.6">This document assigns EDNS Extended RCODE 16 to "BADVERS".  </p>
<p id="rfc.section.9.p.7">IETF Standards Action is required for assignments of new EDNS0 flags.  Flags SHOULD be used only when necessary for DNS resolution to function.  For many uses, a EDNS Option Code may be preferred.  </p>
<p id="rfc.section.9.p.8">IETF Standards Action is required to create new entries in the EDNS Version Number registry.  Expert Review is required for allocation of an EDNS Option Code.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a title="USC/ISI">Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>", STD 13, RFC 1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2671">[RFC2671]</b></td>
<td class="top">
<a href="mailto:vixie@isc.org" title="Internet Software Consortium">Vixie, P.</a>, "<a href="http://tools.ietf.org/html/rfc2671">Extension Mechanisms for DNS (EDNS0)</a>", RFC 2671, August 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3225">[RFC3225]</b></td>
<td class="top">
<a>Conrad, D.</a>, "<a href="http://tools.ietf.org/html/rfc3225">Indicating Resolver Support of DNSSEC</a>", RFC 3225, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3363">[RFC3363]</b></td>
<td class="top">
<a>Bush, R.</a>, <a>Durand, A.</a>, <a>Fink, B.</a>, <a>Gudmundsson, O.</a> and <a>T. Hain</a>, "<a href="http://tools.ietf.org/html/rfc3363">Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)</a>", RFC 3363, August 2002.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3364">[RFC3364]</b></td>
<td class="top">
<a>Austein, R.</a>, "<a href="http://tools.ietf.org/html/rfc3364">Tradeoffs in Domain Name System (DNS) Support for Internet Protocol version 6 (IPv6)</a>", RFC 3364, August 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5625">[RFC5625]</b></td>
<td class="top">
<a>Bellis, R.</a>, "<a href="http://tools.ietf.org/html/rfc5625">DNS Proxy Implementation Guidelines</a>", BCP 152, RFC 5625, August 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Joao Damas</span> 
	  <span class="n hidden">
		<span class="family-name">Damas</span>
	  </span>
	</span>
	<span class="org vcardline">Internet Systems Consortium</span>
	<span class="adr">
	  <span>950 Charter Street</span>

	  <span class="vcardline">
		<span class="locality">Redwood City</span>,  
		<span class="region">California</span> 
		<span class="code">94063</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 650.423.1312</span>

<span class="vcardline">EMail: <a href="mailto:joao@isc.org">joao@isc.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael Graff</span> 
	  <span class="n hidden">
		<span class="family-name">Graff</span>
	  </span>
	</span>
	<span class="org vcardline">Internet Systems Consortium</span>
	<span class="adr">
	  <span>950 Charter Street</span>

	  <span class="vcardline">
		<span class="locality">Redwood City</span>,  
		<span class="region">California</span> 
		<span class="code">94063</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 650.423.1304</span>

<span class="vcardline">EMail: <a href="mailto:mgraff@isc.org">mgraff@isc.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Vixie</span> 
	  <span class="n hidden">
		<span class="family-name">Vixie</span>
	  </span>
	</span>
	<span class="org vcardline">Internet Systems Consortium</span>
	<span class="adr">
	  <span>950 Charter Street</span>

	  <span class="vcardline">
		<span class="locality">Redwood City</span>,  
		<span class="region">California</span> 
		<span class="code">94063</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 650.423.1301</span>

<span class="vcardline">EMail: <a href="mailto:vixie@isc.org">vixie@isc.org</a></span>

  </address>
</div>

</body>
</html>