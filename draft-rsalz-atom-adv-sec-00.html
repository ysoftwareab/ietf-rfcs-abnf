<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Advanced Security Processing for Atom and APP Documents</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Advanced Security Processing for Atom and APP Documents">
<meta name="keywords" content="atom, app, security, trust">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">atompub</td><td class="header">F. Chen</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">M. Hondo</td></tr>
<tr><td class="header">Expires: February 12, 2010</td><td class="header">R. Salz</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">IBM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 11, 2009</td></tr>
</table></td></tr></table>
<h1><br />Advanced Security Processing for Atom and APP Documents<br />draft-rsalz-atom-adv-sec-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on February 12, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The Atom and APP specifications specify simple
      uses of cryptography to sign and encrypt their documents.
      Each document is processed completely, and in isolation.
      This document specifies additional uses that enable selective
      protection or encryption of content, and allow a "trust path" to
      be created across "atom:link" elements.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#notation">1.1.</a>&nbsp;
Notational Conventions and Terminology<br />
<a href="#ws-security">2.</a>&nbsp;
Using WS-Security<br />
<a href="#credentials">3.</a>&nbsp;
The "atomsec:credentials" element<br />
<a href="#anchor1">4.</a>&nbsp;
Selectively Signing parts of an Atom document<br />
<a href="#anchor2">5.</a>&nbsp;
Selectively Encrypting parts of an Atom document<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<a href="#security-considerations">7.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
Normative References<br />
<a href="#anchor4">Appendix&nbsp;A.</a>&nbsp;
Crypto and Security Primer<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Atom and APP specifications define how to use
      <a class='info' href='#W3C.REC-xmlenc-core-20021210'>XML Digital Signature<span> (</span><span class='info'>Eastlake, D. and J. Reagle, &ldquo;XML Encryption Syntax and Processing,&rdquo; December&nbsp;2002.</span><span>)</span></a> [W3C.REC&#8209;xmlenc&#8209;core&#8209;20021210],
      and
      <a class='info' href='#W3C.REC-xmlenc-core-20021210'>XML Encryption<span> (</span><span class='info'>Eastlake, D. and J. Reagle, &ldquo;XML Encryption Syntax and Processing,&rdquo; December&nbsp;2002.</span><span>)</span></a> [W3C.REC&#8209;xmlenc&#8209;core&#8209;20021210]
      to prevent the contents of a document from being modified or
      inadvertently disclosed.
      This specification profiles how to use <a class='info' href='#oasis-wssec-v1.1'>WS-Security<span> (</span><span class='info'>Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;Web Services Security: SOAP Message Security 1.1,&rdquo; February&nbsp;2006.</span><span>)</span></a> [oasis&#8209;wssec&#8209;v1.1] to provide selective protection and
      encryption of a document and allow a single document to be encrypted
      for multiple recipients.
</p>
<p>Linking is a key point of Atom and APP, and this document defines
      a new element that can be used to establish a chain of trust, from
      the document with the "atom:link" to the content being
      referred-to.
</p>
<a name="notation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Notational Conventions and Terminology</h3>

<p>The conventions and terminology of both <a class='info' href='#RFC4287'>The
          Atom Syndication Format<span> (</span><span class='info'>Nottingham, M., Ed. and R. Sayre, Ed., &ldquo;The Atom Syndication Format,&rdquo; December&nbsp;2005.</span><span>)</span></a> [RFC4287] and <a class='info' href='#RFC5023'>The Atom
          Publishing Protocol<span> (</span><span class='info'>Gregorio, J. and B. de hOra, &ldquo;The Atom Publishing Protocol,&rdquo; October&nbsp;2007.</span><span>)</span></a> [RFC5023], known as Atom and APP respectively,
        are incorporated here by reference. Within this document, the
        phrase "Atom document" is used to refer to any document defined by
        either RFC.
</p>
<p>The following namespace prefixes are used in this document:
        <table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="right"><col align="left">
<tr><th align="right">Prefix</th><th align="left">Namespace URI</th></tr>
<tr>
<td align="right">atom</td>
<td align="left">http://www.w3.org/2005/Atom</td>
</tr>
<tr>
<td align="right">app</td>
<td align="left">http://www.w3.org/2007/app</td>
</tr>
<tr>
<td align="right">atomsec</td>
<td align="left">http://www.ibm.com/xmlns/stdwip/atomext/security</td>
</tr>
<tr>
<td align="right">dsig</td>
<td align="left">http://www.w3.org/2000/09/xmldsig#</td>
</tr>
<tr>
<td align="right">xenc</td>
<td align="left">http://www.w3.org/2001/04/xmlenc#</td>
</tr>
<tr>
<td align="right">wsse</td>
<td align="left">http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd</td>
</tr>
<tr>
<td align="right">wsu</td>
<td align="left">"http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd</td>
</tr>
</table>
<br clear="all" />

      
</p>
<a name="ws-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Using WS-Security</h3>

<p>The "wsse:Security" element is part of a specification informally
      known as WS-Security. The element is defined as a container for
      security information, including security tokens, XML encryption keys,
      and/or XML digital signatures for SOAP message security. This
      specification uses the semantics of WS-Security processing to achieve
      the goals .
      
</p>
<p>An Atom or APP dcoument MUST NOT have more than one "wsse:Security"
        child element. While compatible with <a class='info' href='#oasis-wssec-v1.1'>[oasis&#8209;wssec&#8209;v1.1]<span> (</span><span class='info'>Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;Web Services Security: SOAP Message Security 1.1,&rdquo; February&nbsp;2006.</span><span>)</span></a> processing, the schema for the
        "wsse:Security" element is taken from <a class='info' href='#oasis-wssec-v1.0'>[oasis&#8209;wssec&#8209;v1.0]<span> (</span><span class='info'>Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;Web Services Security: SOAP Message Security 1.0,&rdquo; March&nbsp;2004.</span><span>)</span></a>.
    
</p>
<p>One feature of the WS-Security header is that it should be possible
      to process in a forward-streaming manner. That is, security tokens
      appear before they are used (such as in signatures), and encipherment
      keys appear before the encrypted data. Therefore, if present, the
      "wsse:Security" element SHOULD be the first child of the Atom
      document.
</p>
<p>The "wsse:SecurityTokenReference" element can be used to help
      enable streaming processing, and to reduce multiple occurrences of
      the same credentials. To do this, each credential is made the child
      of a "wsse:BinarySecurityToken" element, which in turn is a child of
      the "wsse:Security" element. For example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;wsse:Security&gt;
  &lt;wsse:BinarySecurityToken
      wsu:Id="ssl-cert-1"
      ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
    MII...
  &lt;/wsse:BinarySecurityToken&gt;.
  ...
&lt;/wsse:Security&gt;
</pre></div>
<p>Note that <a class='info' href='#W3C.REC-xmlenc-core-20021210'>[W3C.REC&#8209;xmlenc&#8209;core&#8209;20021210]<span> (</span><span class='info'>Eastlake, D. and J. Reagle, &ldquo;XML Encryption Syntax and Processing,&rdquo; December&nbsp;2002.</span><span>)</span></a> specifies
      many ways to identify key material, including Distinguished Name,
      Issuer/SerialNumber, etc. Any method other than embedding the
      entire certificate SHOULD NOT be used.
</p>
<p>In this document, anywhere a certificate is referenced, the content
      may instead be a "wsse:SecurityTokenReference" to a token in the
      "wsse:Security" element.  For example, the following two document
      fragments are semantically equivalent:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;dsig:KeyInfo&gt;
  &lt;dsig:X509Data&gt;
    &lt;wsse:SecurityTokenReference&gt;
      &lt;wsse:Reference URI="#ssl-cert-1"/&gt;
    &lt;/wsse:SecurityTokenReference&gt;
  &lt;/dsig:X509Data&gt;
&lt;dsig:KeyInfo&gt;

&lt;dsig:KeyInfo&gt;
  &lt;dsig:X509Data&gt;
    &lt;dsig:X509Certificate&gt;
      MII...
    &lt;/dsig:X509Certificate&gt;
  &lt;/dsig:X509Data&gt;
&lt;dsig:KeyInfo&gt;
</pre></div>
<p>A reference other than a direct reference using the "wsse:Reference"
      element MUST NOT be used.
</p>
<a name="credentials"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
The "atomsec:credentials" element</h3>

<p>The "atomsec:credentials" element is a child element of an
      "atom:link" element.
      It specifies one or more security tokens that may be used to
      validate the provenance of the data being linked-to. The "use"
      attribute specifies how the credentials are to be used. Two values
      are specified, "content" and "transport". If the attribute is not
      present, it is equivalent to providing it with the value
      "content".
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
atomSecCredentials =
    element atomsec:credentials {
        atomCommonAttributes*,
        attribute use { "content" | "transport" } ?,
        (extensionElement*)
    }
</pre></div>
<p>The "transport" value specifies that the credentials can be used to
      validate the SSL certificate of the server containing the linked-to
      data. The "content" value specifies that the credentials can be used
      to validate any digital signatures on the linked-to data.
</p>
<p>An "atom:link" element can have no more than two "atom:credentials"
      elements, one for each of content and transport credentials.
</p>
<p>The child elements of the "atomsec:credentials" element SHOULD be
      "dsig:KeyInfo" elmenents used to locate X.509 certificate data.
      These certificates can be used by the relying party to verify the
      specified trust chain.
</p>
<p>A party that has out of band knowledge MAY ignore this element.
</p>
<p>Here is an example of an Atom document pointing to signed content:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;atom:link href="http://www.example.org/2003/12/13/foo"&gt;
  &lt;atomsec:credentials&gt;
    &lt;!-- This is the certificate that should be signing the content
    at the href.  Or the signer's CA... --&gt;
    &lt;dsig:KeyInfo&gt;
      &lt;dsig:X509Data&gt;
        &lt;dsig:X509Certificate&gt;
          MII...
        &lt;/dsig:X509Certificate&gt;
      &lt;/dsig:X509Data&gt;
    &lt;/dsig:KeyInfo&gt;
  &lt;/atomsec:credentials&gt;
&lt;/atom:link&gt;
</pre></div>
<p>Here is another example, one that specifies the CA that issued the
      SSL/TLS certificate used by the server for the host
      www.example.com:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;atom:link href="https://www.example.org/2003/12/13/foo"&gt;
  &lt;atomsec:credentials use="transport"&gt;
    &lt;!-- SSL CA, presumably not a typical "browser trusted" one. --&gt;
    &lt;dsig:KeyInfo&gt;
      &lt;dsig:X509Data&gt;
        &lt;dsig:X509Certificate&gt;
          MII...
        &lt;/dsig:X509Certificate&gt;
      &lt;/dsig:X509Data&gt;
    &lt;/dsig:KeyInfo&gt;
  &lt;/atomsec:credentials&gt;
&lt;/atom:link&gt;
</pre></div>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Selectively Signing parts of an Atom document</h3>

<p>A "dsig:Signature" element in the "wsse:Security" element may
      be used to sign one or more elements of an Atom document. The
      signature should be detached, with one "dsig:Reference" for each item
      being signed.
</p>
<p>The processing rules are defined by sections 8.2 and 8.4 of
      <a class='info' href='#oasis-wssec-v1.1'>[oasis&#8209;wssec&#8209;v1.1]<span> (</span><span class='info'>Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;Web Services Security: SOAP Message Security 1.1,&rdquo; February&nbsp;2006.</span><span>)</span></a> with the following additions:
      </p>
<ul class="text">
<li>The SOAP message envelope is not used and the "wsse:Security"
          element MUST be the first element of the root document.
</li>
<li>Each element being signed MUST have a unique "xml:id"
          attribute if not already present.
</li>
<li>The enveloped-signature transform as defined by <a class='info' href='#W3C.REC-xmlenc-core-20021210'>[W3C.REC&#8209;xmlenc&#8209;core&#8209;20021210]<span> (</span><span class='info'>Eastlake, D. and J. Reagle, &ldquo;XML Encryption Syntax and Processing,&rdquo; December&nbsp;2002.</span><span>)</span></a> SHOULD be used to sign
          the root document. If there are additional signed elements, they
          MUST be signed first so that the root signature will include its
          descendant's signatures.
</li>
</ul><p>
    
</p>
<p>Here is an example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;feed xmlns="http://www.w3.org/2005/Atom" xml:id="id3"&gt;

  &lt;wsse:Security&gt;

    &lt;wsu:Timestamp xml:id="id1"&gt;
      &lt;wsu:Created&gt;XXXX-XX-XXT02:41:15Z&lt;/wsu:Created&gt;
      &lt;wsu:Expires&gt;XXXX-XX-XXT02:46:15Z&lt;/wsu:Expires&gt;
    &lt;/wsu:Timestamp&gt;

    &lt;wsse:BinarySecurityToken xml:id="SecurityToken-df8e8299-0d67-4eaf-bf5e-21c4dc6342ad"
        ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3"&gt;
      MII...
    &lt;/wsse:BinarySecurityToken&gt;
    &lt;Signature xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;
      &lt;SignedInfo&gt;
        &lt;CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
        &lt;SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
        &lt;Reference URI="#id1"&gt;
          &lt;Transforms&gt;
            &lt;Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
          &lt;/Transforms&gt;
          &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/&gt;
          &lt;DigestValue&gt;cHt...&lt;/DigestValue&gt;
        &lt;/Reference&gt;
        &lt;Reference URI="#id2"&gt;
          &lt;Transforms&gt;
            &lt;Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
          &lt;/Transforms&gt;
          &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/&gt;
          &lt;DigestValue&gt;Oj2...&lt;/DigestValue&gt;
        &lt;/Reference&gt;
      &lt;/SignedInfo&gt;
      &lt;SignatureValue&gt;SWz...&lt;/SignatureValue&gt;
      &lt;KeyInfo&gt;
        &lt;wsse:SecurityTokenReference&gt;
          &lt;wsse:Reference URI="#SecurityToken-df8e8299-0d67-4eaf-bf5e-21c4dc6342ad"/&gt;
        &lt;/wsse:SecurityTokenReference&gt;
      &lt;/KeyInfo&gt;
    &lt;/Signature&gt;

    &lt;!-- This is the enveloped signature, which covers all the other
         signatures and hence must be generated after all the other
         signatures are in place. --&gt;
    &lt;Signature xmlns="http://www.w3.org/2000/09/xmldsig#"&gt;
      &lt;SignedInfo&gt;
        &lt;CanonicalizationMethod Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
        &lt;SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/&gt;
        &lt;Reference URI="#id3"&gt;
          &lt;Transforms&gt;
            &lt;Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/&gt;
            &lt;Transform Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/&gt;
          &lt;/Transforms&gt;
          &lt;DigestMethod Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/&gt;
          &lt;DigestValue&gt;cRY...&lt;/DigestValue&gt;
        &lt;/Reference&gt;
      &lt;/SignedInfo&gt;
      &lt;SignatureValue&gt;QAw...&lt;/SignatureValue&gt;
      &lt;KeyInfo&gt;
        &lt;wsse:SecurityTokenReference&gt;
          &lt;wsse:Reference
              URI="#SecurityToken-df8e8299-0d67-4eaf-bf5e-21c4dc6342ad"/&gt;
        &lt;/wsse:SecurityTokenReference&gt;
      &lt;/KeyInfo&gt;
    &lt;/Signature&gt;
  &lt;/wsse:Security&gt;

  &lt;title&gt;Example Feed&lt;/title&gt;
  &lt;link href="http://example.org/"/&gt;
  &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
  &lt;author&gt;
     &lt;name&gt;John Doe&lt;/name&gt;
  &lt;/author&gt;
  &lt;id&gt;urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6&lt;/id&gt;

  &lt;entry xml:id="id1"&gt;
    &lt;title&gt;Atom-Powered Robots Run Amok&lt;/title&gt;
    &lt;link href="http://example.org/2003/12/13/atom03"/&gt;
    &lt;id&gt;urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a&lt;/id&gt;
    &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
    &lt;summary&gt;Some text.&lt;/summary&gt;
    &lt;content type="xhtml" xml:lang="en" xml:base="http://diveintomark.org/"&gt;
      &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;
        &lt;p&gt;&lt;i&gt;[Update: The Atom draft is finished.]&lt;/i&gt;&lt;/p&gt;
      &lt;/div&gt;
    &lt;/content&gt;

  &lt;/entry&gt;
&lt;/feed&gt;
</pre></div>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Selectively Encrypting parts of an Atom document</h3>

<p>The processing rules for encrypting parts of an Atom document are
      defined by sections 9.4.1 and 9.4.2 of <a class='info' href='#oasis-wssec-v1.1'>[oasis&#8209;wssec&#8209;v1.1]<span> (</span><span class='info'>Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;Web Services Security: SOAP Message Security 1.1,&rdquo; February&nbsp;2006.</span><span>)</span></a>
      with the following additions:
      </p>
<ul class="text">
<li>The SOAP message envelope is not used and the "wsse:Security"
        element MUST be the first element of the root document.
</li>
<li>Use WS-Security processing to encrypt the full document.
        If the encrypted result does not have to be valid according to the
        Atom schema's, then the <a class='info' href='#W3C.REC-xmlenc-core-20021210'>[W3C.REC&#8209;xmlenc&#8209;core&#8209;20021210]<span> (</span><span class='info'>Eastlake, D. and J. Reagle, &ldquo;XML Encryption Syntax and Processing,&rdquo; December&nbsp;2002.</span><span>)</span></a>
        standard SHOULD be used.
</li>
</ul><p>
    
</p>
<p>Here is an example:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;feed xmlns="http://www.w3.org/2005/Atom" xml:id="id3"&gt;

  &lt;wsse:Security&gt;
    &lt;xenc:EncryptedKey&gt;
      &lt;xenc:EncryptionMethod
          Algorithm="http://www.w3.org/2001/04/xmlenc#rsa-1_5"/&gt;
      &lt;dsig:KeyInfo&gt;
        &lt;wsse:SecurityTokenReference&gt;
          &lt;wsse:KeyIdentifier
              ValueType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-x509-token-profile-1.0#X509v3SubjectKeyIdentifier"&gt;
            YPArt...
          &lt;/wsse:KeyIdentifier&gt;
        &lt;/wsse:SecurityTokenReference&gt;
      &lt;/dsig:KeyInfo&gt;
      &lt;xenc:CipherData xmlns:dsig="http://www.w3.org/2000/09/xmldsig#"&gt;
        &lt;xenc:CipherValue&gt;
        JG0...
        &lt;/xenc:CipherValue&gt;
      &lt;/xenc:CipherData&gt;
      &lt;xenc:ReferenceList&gt;
        &lt;xenc:DataReference URI="#id1"/&gt;
        &lt;xenc:DataReference URI="#id2"/&gt;
      &lt;/xenc:ReferenceList&gt;
    &lt;/xenc:EncryptedKey&gt;
  &lt;/wsse:Security&gt;

  &lt;title&gt;Example Feed&lt;/title&gt;
  &lt;link href="http://example.org/"/&gt;
  &lt;updated&gt;2003-12-13T18:30:02Z&lt;/updated&gt;
  &lt;author&gt;
     &lt;name&gt;John Doe&lt;/name&gt;
  &lt;/author&gt;
  &lt;id&gt;urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6&lt;/id&gt;

  &lt;!-- this encrypted an atom:entry element. --&gt;
  &lt;xenc:EncryptedData Id="id1"
      Type="http://www.w3.org/2001/04/xmlenc#Element"&gt;
    &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#tripledes-cbc"/&gt;
    &lt;CipherData xmlns="http://www.w3.org/2001/04/xmlenc#"&gt;
      &lt;CipherValue&gt;
      Clm...
      &lt;/CipherValue&gt;
    &lt;/CipherData&gt;
  &lt;/xenc:EncryptedData&gt;

  &lt;!-- this encrypted another atom:entry element. --&gt;
  &lt;xenc:EncryptedData Id="id2" Type="http://www.w3.org/2001/04/xmlenc#Element"&gt;
    &lt;EncryptionMethod Algorithm="http://www.w3.org/2001/04/xmlenc#tripledes-cbc"/&gt;
    &lt;CipherData xmlns="http://www.w3.org/2001/04/xmlenc#"&gt;
      &lt;CipherValue&gt;
      Clm...
      &lt;/CipherValue&gt;
    &lt;/CipherData&gt;
  &lt;/xenc:EncryptedData&gt;

&lt;/feed&gt;
</pre></div>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>None.
</p>
<a name="security-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>This entire document is about securing Atom documents.
      Authentication and authorization (e.g., to delete a update or delete
      a posting via APP) are not discussed here.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4287">[RFC4287]</a></td>
<td class="author-text"><a href="mailto:mnot@pobox.com">Nottingham, M., Ed.</a> and <a href="mailto:rfsayre@boswijck.com">R. Sayre, Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc4287">The Atom Syndication Format</a>,&rdquo; RFC&nbsp;4287, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4287.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc4287.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc4287.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5023">[RFC5023]</a></td>
<td class="author-text">Gregorio, J. and B. de hOra, &ldquo;<a href="http://tools.ietf.org/html/rfc5023">The Atom Publishing Protocol</a>,&rdquo; RFC&nbsp;5023, October&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5023.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xmldsig-core-20080610">[W3C.REC-xmldsig-core-20080610]</a></td>
<td class="author-text">Solo, D., Roessler, T., Reagle, J., Hirsch, F., and D. Eastlake, &ldquo;<a href="http://www.w3.org/TR/2008/REC-xmldsig-core-20080610">XML Signature Syntax and Processing (Second Edition)</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xmldsig-core-20080610, June&nbsp;2008 (<a href="http://www.w3.org/TR/2008/REC-xmldsig-core-20080610">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="W3C.REC-xmlenc-core-20021210">[W3C.REC-xmlenc-core-20021210]</a></td>
<td class="author-text">Eastlake, D. and J. Reagle, &ldquo;<a href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210">XML Encryption Syntax and Processing</a>,&rdquo; World Wide Web Consortium Recommendation&nbsp;REC-xmlenc-core-20021210, December&nbsp;2002 (<a href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="oasis-wssec-v1.0">[oasis-wssec-v1.0]</a></td>
<td class="author-text">Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;<a href="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0.pdf">Web Services Security: SOAP Message Security 1.0</a>,&rdquo; OASIS Standard&nbsp;200401, March&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="oasis-wssec-v1.1">[oasis-wssec-v1.1]</a></td>
<td class="author-text">Nadalin, A., Kaler, C., Hallam-Baker, P., and R. Monzillo, &ldquo;<a href="http://docs.oasis-open.org/wss/v1.1/wss-v1.1-spec-os-SOAPMessageSecurity.pdf">Web Services Security: SOAP Message Security 1.1</a>,&rdquo; OASIS Standard&nbsp;(WS-Security 2004), February&nbsp;2006.</td></tr>
</table>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Crypto and Security Primer</h3>

<p>This section provides a very brief overview of common cryptographic
      techniques and how they are used. It is intended only to provide the
      smallest amount of information so that the rest of this document is
      understandable. It is not normative.
</p>
<p>
      Public-key cryptography is done using two numbers that are related to
      each other. One of these numbers is public and can be known or used
      by anyone, while the other is private and should only be known by its
      "owner." The numbers have two very important properties. First,
      anything encrypted with the public key can only be decrypted with the
      private key. This means that anyone can generate text that is only
      legible to the key's owner. The second is that anything that is
      encrypted with the private key can be decrypted by anyone who has the
      public key. This allows anyone receiving such an encrypted item to
      know that it came from the key holder. The most common public-key
      algorithms are RSA and Elliptic-Curve.
</p>
<p>A message digest, or hash takes an arbitrary sequence of bytes and
      returns a fixed-size identifier. The most important property is that
      it is statistically unlikely for two different streams to result in
      the same hash. The most useful hash algorithms are SHA-1 and SHA-256.
</p>
<p>A message digest encrypted with a private key is a signature. Anyone
      with the original document can generate their own digest, decrypt the
      received one, and compare them. If the values do not match, then the
      document has been modified. The most common signature method is
      RSA/SHA-n.
</p>
<p>In symmetric cryptography, the same key is used for encryption and
      decryption. This means that both sender and receiver have to have the
      same key. Common symmetric (or shared-secret) algorithms are AES and
      triple-DES.
</p>
<p>A common technique is to "wrap" a symmetric key by encyrpting it
      with the recipient's public key. The bulk of the data is then
      encrypted using the symmetric key. This allows multiple recipients to
      see the data by only encrypting the symmetric key multiple times,
      rather than the entire data.
</p>
<p>An X.509 certificate is a datum that contains a name and other
      identifying information, and a public key that can be associated with
      that name. The certificate also contains information such as its
      validity period, the ways in which the keys are to be used, and so
      on. For details see the IETF PKI Profile, RFC XXX. A certificate is
      signed by a CA, and common practice is for the entity receiving a
      certificate to be configured to trust everything signed by the CA, or
      perhaps the CA's CA, or further up the chain.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fred (Xiangfu) Chen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Rogers Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cambridge, MA  02142</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 617-693-6313</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:chenfr@us.ibm.com">chenfr@us.ibm.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.ibm.com">http://www.ibm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Maryann Hondo</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Rogers Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cambridge, MA  02142</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 617-693-1236</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mhondo@us.ibm.com">mhondo@us.ibm.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.ibm.com">http://www.ibm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rich Salz</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Rogers Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cambridge, MA  02142</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 617-693-3808</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rsalz@us.ibm.com">rsalz@us.ibm.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="https://www.ibm.com/developerworks/mydeveloperworks/blogs/soma/">https://www.ibm.com/developerworks/mydeveloperworks/blogs/soma/</a></td></tr>
</table>
</body></html>
