<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Diameter Support for Proxy Mobile IPv6 Localized Routing</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Solution Overview">
<link href="#rfc.section.3" rel="Chapter" title="3 Localized Routing Service Authorization">
<link href="#rfc.section.4" rel="Chapter" title="4 Diameter Server Authorizes MAG Location Query">
<link href="#rfc.section.5" rel="Chapter" title="5 Localized Routing Service Authorization in Networks with Multiple AAA Servers">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Contributors">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgement">
<link href="#rfc.section.10" rel="Chapter" title="10 Change Log">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 draft-ietf-dime-pmip6-lr-03">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 draft-ietf-dime-pmip6-lr-04">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 draft-ietf-dime-pmip6-lr-05">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="In Proxy Mobile IPv6, packets received from a Mobile Node (MN) by the Mobile Access Gateway (MAG) to which it is attached are typically tunneled to a Local Mobility Anchor (LMA) for routing. The term "localized routing" refers to a method by which packets are routed directly between an MN's MAG and the MAG of its Correspondent Node (CN) without involving any LMA. In order to establish a localized routing session between two Mobile Access Gateways in a Proxy Mobile IPv6 domain, two tasks must be accomplished: " />
  <meta name="description" content="In Proxy Mobile IPv6, packets received from a Mobile Node (MN) by the Mobile Access Gateway (MAG) to which it is attached are typically tunneled to a Local Mobility Anchor (LMA) for routing. The term "localized routing" refers to a method by which packets are routed directly between an MN's MAG and the MAG of its Correspondent Node (CN) without involving any LMA. In order to establish a localized routing session between two Mobile Access Gateways in a Proxy Mobile IPv6 domain, two tasks must be accomplished: " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">G. Zorn</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Network Zen</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Q. Wu</td>
</tr>
<tr>
<td class="left">Expires: December 31, 2011</td>
<td class="right">Huawei</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Liebsch</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">NEC</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Korhonen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">NSN</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 29, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Diameter Support for Proxy Mobile IPv6 Localized Routing<br />
  <span class="filename">draft-ietf-dime-pmip6-lr-05</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>In Proxy Mobile IPv6, packets received from a Mobile Node (MN) by the Mobile Access Gateway (MAG) to which it is attached are typically tunneled to a Local Mobility Anchor (LMA) for routing. The term "localized routing" refers to a method by which packets are routed directly between an MN's MAG and the MAG of its Correspondent Node (CN) without involving any LMA. In order to establish a localized routing session between two Mobile Access Gateways in a Proxy Mobile IPv6 domain, two tasks must be accomplished: </p>

<ol>
<li>The usage of localized routing must be authorized for both MAGs and</li>
<li>The address of the MAG to which the Correspondent Node (CN) is attached must be ascertained</li>
</ol>

<p> This document specifies how to accomplish these tasks using the Diameter protocol.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 31, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Solution Overview</a>
</li>
<li>3.   <a href="#rfc.section.3">Localized Routing Service Authorization</a>
</li>
<li>4.   <a href="#rfc.section.4">Diameter Server Authorizes MAG Location Query</a>
</li>
<li>5.   <a href="#rfc.section.5">Localized Routing Service Authorization in Networks with Multiple AAA Servers</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Contributors</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgement</a>
</li>
<li>10.   <a href="#rfc.section.10">Change Log</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">draft-ietf-dime-pmip6-lr-03</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">draft-ietf-dime-pmip6-lr-04</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">draft-ietf-dime-pmip6-lr-05</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#RFC5213">Proxy Mobile IPv6 (PMIPv6)</a> <cite title="NONE">[RFC5213]</cite> allows the Mobility Access Gateway to optimize media delivery by locally routing packets within itself, avoiding tunneling them to the Mobile Node's Local Mobility Anchor. This is referred to as "local routing" in RFC 5213. However, this mechanism is not applicable to the typical scenario in which the MN and CN are connected to different MAGs and are registered to different LMAs. In this scenario (<a href="#RFC6279">as described in</a> <cite title="NONE">[RFC6279]</cite>), the relevant information needed to set up a localized routing path (e.g., the addresses of the Mobile Access Gateways to which the MN and CN are respectively attached) is distributed between their respective Local Mobility Anchors. This may complicate the setup and maintenance of localized routing. <br><br>Therefore, in order to establish a localized routing path between the two Mobile Access Gateways, the Mobile Node's MAG must identify the LMA that is managing the Correspondent Node's traffic and then obtain the address of the Correspondent Node's MAG from that LMA.  In Proxy Mobile IPv6, the LMA to be assigned to the CN may be maintained as a configured entry in the Correspondent Node's policy profile located on an Authentication, Authorization and Accounting (AAA) server.  However, there is no relevant work discussing how AAA-based mechanisms can be used by the Mobile Node's MAG or LMA to discover the address of the Correspondent Node's LMA during the setup of localized routing. The method by which the Mobile Node's MAG or LMA interacts with the Correspondent Node's LMA to identify the Correspondent Node's MAG is also unspecified. <br><br> This document describes AAA support for the authorization and discovery of PMIPv6 mobility entities during localized routing. In LMA discovery, Diameter <a href="#RFC3588">[RFC3588]</a> is used to authorize the localized routing service and provide the Mobile Node's MAG/LMA with information regarding the Correspondent Node's LMA. In MAG discovery, AAA is used to determine whether Mobile Node's MAG is allowed to fetch the address of the Correspondent Node's MAG from the Correspondent Node's LMA. If MAG discovery is successful, the Correspondent Node's LMA will respond to the Mobile Node's MAG with the address of the Correspondent Node's MAG.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Solution Overview</h1>
<div id="#rfc.figure.1"></div>
<div id="#ref_arch"></div>
<pre>
                      +---------+
           LMA2?      |  AAA &amp;  |
              +------&gt;| Policy  |&lt;----------+
              |       | Profile |           |
          Diameter    +---------+        Diameter
          (Step a)                       (Step b)
              |                             |
              |                             |
              |                             |
     LMA2? +--V-+             +----+        |
  +-------&gt;|LMA1|             |LMA2|&lt;-------+
  |        +----+             +----+
  |          |                  |
  |         //                  \\
 PMIP      //                    \\
  |       //                      \\
  |       |                        |
  |     +----+  MAG2?            +----+
  +----&gt;|MAG1|&lt;--------          |MAG2|
        +----+                   +----+
           :                        :
        +---+                     +---+
        |MN1|                     |MN2|
        +---+                     +---+
</pre>
<p id="rfc.section.2.p.1">MAG/LMA discovery is a prerequisite to the establishment of a direct routing path between MAG1 and MAG2 (associated with MN1 and MN2 respectively). This document addresses how to resolve the destination MN&#8217;s MAG by means of interaction between the LMA and the AAA server.  <a href="#ref_arch">Figure 1</a> shows the reference architecture for Localized Routing Service Authorization. This reference architecture assumes </p>

<ul>
<li>MN1 and MN2 belong to different LMAs or the same LMA. If MN1 and MN2 belong to the same LMA, the LMA1 and LMA2 to which MN1 and MN2 are anchored in the figure1 should be the same LMA.</li>
<li>The MAG and LMA support Diameter client functionality.</li>
</ul>

<p> </p>

<ol style="list-style-type: lower-alpha">
<li>The interaction of LMA1 with the AAA server is used to authorize the localized routing service and, if necessary, fetch the IP address of LMA2 (Step a in Figure 1)</li>
<li>LMA2 interaction with the AAA server is used to determine whether MAG1 or LMA1 is allowed to obtain the IP address of MAG2 (Step b in Figure 1)</li>
</ol>

<p>Note that if MN1 and MN2 are connected to different MAGs but share the same LMA, the interaction between LMA1 and the AAA server should be exactly the same as the case where MNs belong to MAGs under different LMAs.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Localized Routing Service Authorization</h1>
<p id="rfc.section.3.p.1">Localized Routing Service Authorization also can happen during the network access authentication procedure <a href="#RFC5779">[RFC5779]</a>,i.e., before Localized routing is initialized.  In this case, the preauthorized pairs of LMA/prefix sets can be downloaded to Proxy Mobile IPv6 entities during RFC5779 procedure.  Localized routing can be initiated once a destination of received packet matches to some of the prefixes received during RFC5779 procedure.</p>
<p><a href="#fig2">Figure 2</a> shows an example scenario where MAG1 acts as a Diameter client, processing the data packet from MN1 to MN2 and requesting authorization of localized routing. In this example scenario, MN1 and MN2 are anchored to LMA1 and LMA2 respectively if MN1 and MN2 belong to the different LMA, otherwise, the LMA to which MN1 and MN2 are anchored should be the same LMA,i.e., LMA1 or LMA2. In the case where MNs belong to the different LMAs, in order to setup a localized routing path with MAG2, MAG1 must first locate the entity that maintains the data required to setup the path (i.e., LMA2) by sending a Request message to LMA1. Note that the discovery of LMA2 is only done once and the request message is Localized routing initialization (LRI) message in the <a href="#fig2">Figure 2</a> and belong to the Initial phase of the localized routing; once LMA1 has obtained the address of LMA2 from the AAA serer, LMA1 may associate address of LMA2 with the Mobile Node's cached data for future use (e.g., in the case of a handover). The Diameter client in LMA1 sends an AA-Request (AAR) message to the Diameter server. The message contains an instance of the MIP6-Feature-Vector (MFV) AVP (<a href="#RFC5447">[RFC5447]</a>, Section 4.2.5) with the INTER_MAG_ROUTING_SUPPORTED bit (<a href="#IANA">Section 7</a>) set and an instance of the MIP6-Home-Link-Prefix AVP (<a href="#RFC5447">[RFC5447]</a>, Section 4.2.4) containing the IP address of MN2. <br><br>The Diameter server checks if MN2 is allowed to use localized routing and if so, responds with an AA-Answer (AAA) message encapsulating an instance of the MIP6-Agent-Info AVP <a href="#RFC5779">[RFC5779]</a> containing the IP address and/or Fully Qualified Domain Name (FQDN) of LMA2. LMA1 then determines the IP address of LMA2 using the data returned in the MIP6-Agent-Info and responds to MAG1 with the address of LMA2 in the localized routing acknowledge message (LRA in the <a href="#fig2">Figure 2</a>). MAG1 can verify whether both MAGs are under the same LMA by comparing LMA1 address with LMA2 address. MAG1 then requests the address of MAG2 from LMA2 and uses that address to setup the localized routing path between itself and MAG2 via a Proxy Binding Update (PBU)/Proxy Binding Acknowledgement (PBA) message exchange <a href="#RFC5213">[RFC5213]</a>.</p>
<p id="rfc.section.3.p.3">In the case where MNs share the same LMA, the MAG1 should send a request message (LRI in the <a href="#fig2">Figure 2</a>) to LMA for localized routing which includes IP address of MN2. The subsequent interaction between LMA1 and the AAA should be exact the same as the case where MNs belong to different LMAs. If authorization is successful, the LMA may look up MAG2 address directly based on IP address of MN2 and respond a message to the MAG1 with IP address of MAG2 included.</p>
<div id="#rfc.figure.2"></div>
<div id="#fig2"></div>
<pre>
+---+    +----+    +----+     +---+    +----+  +----+   +---+
|MN1|    |MAG1|    |LMA1|     |AAA|    |LMA2|  |MAG2|   |MN2|
+-+-+    +-+--+    +-+--+     +-+-+    +-+--+  +-+--+   +-+-+
  |        |         |          |        |       |        |
  |     Anchored     |          |        |    Anchored    |
  o------------------o          |        o-------+--------o
Data[MN1-&gt;MN2]       |          |        |       |        |
  |-------&gt;| LRI(MN2)|          |        |       |        |
  |        |--------&gt;|          |        |       |        |
  |        |         | AAR(MN2,MFV)      |       |        |
  |        |         |---------&gt;|        |       |        |
  |        |         |  AAA(LMA2)        |       |        |
  |      LRA([LMA2]) |&lt;---------|        |       |        |
  |        |&lt;--------|          |        |       |        |
  |                  |          |        |       |        |
</pre>
<p></p>
<p><a href="#fig3">Figure 3</a> shows another example scenario, in which the LMA1 acts as a Diameter client, processing the data packet from MN2 to MN1 and requesting the authorization of localized routing. In this example scenario, MN1 and MN2 are anchored to LMA1 and LMA2 respectively. In contrast with the signaling flow of <a href="#fig2">Figure 2</a>, the difference is that it is LMA1 instead of MAG1 which initiates the setup of the localized routing path. <br><br> The Diameter client in LMA1 sends an AA-Request (AAR) message to the Diameter server. The message contains an instance of the MIP6-Feature-Vector AVP (<a href="#RFC5447">[RFC5447]</a>, Section 4.2.5) with the INTER_MAG_ROUTING_SUPPORTED bit set and an instance of the MIP6-Home-Link-Prefix AVP (<a href="#RFC5447">[RFC5447]</a>, Section 4.2.4) containing the IP address of MN2. The Diameter server checks if MN2 is allowed to use localized routing and if so, responds with an AA-Answer (AAA) message encapsulating an instance of the MIP6-Agent-Info AVP <a href="#RFC5779">[RFC5779]</a> containing the IP address and/or Fully Qualified Domain Name (FQDN) of LMA2. LMA1 then determines the IP address of LMA2 using the data returned in the MIP6-Agent-Info AVP and responds to MAG1 with the address of LMA2.</p>
<p id="rfc.section.3.p.6">In the case where MNs share the same LMA, the Diameter client in LMA1 sends an AA-Request (AAR) message to the Diameter server. The interaction between LMA1 and the AAA should be exact the same as the case where MNs belong to different LMAs. If authorization is successful, the LMA may look up MAG2 address directly based on IP address of MN2 and send a request message (LRI in the <a href="#fig3">Figure 3</a>) to the MAG1 for localized routing with IP address of MAG2 included. The MAG1 confirms the success of localized routing if localized routing path can be setup.</p>
<div id="#rfc.figure.3"></div>
<div id="#fig3"></div>
<pre>
      +---+    +----+  +----+     +---+      +----+  +----+   +---+
      |MN1|    |MAG1|  |LMA1|     |AAA|      |LMA2|  |MAG2|   |MN2|
      +-+-+    +-+--+  +-+--+     +-+-+      +-+--+  +-+--+   +-+-+
        |        |       |          |          |       |        |
        |     Anchored   |          |          |    Anchored    |
        o--------+-------o Data[MN2-&gt;MN1]      o-------+--------o
        |        |       |&lt;-----    |          |       |        |
        |        |       |AAR(MFV,MN2)         |       |        |
        |        |       |---------&gt;|          |       |        |
        |          LRI   |AAA(LMA2) |          |       |        |
        |    (MN2,[LMA2])|&lt;---------|          |       |        |
        |        |&lt;------|          |          |       |        |
        |     LRA(Succ)  |          |          |       |        |
        |        |------&gt;|          |          |       |        |
</pre>
<p></p>
<div id="#rfc.figure.4"></div>
<div id="#fig4"></div>
<pre>
     +---+    +----+  +----+     +---+      +----+  +----+   +---+
     |MN1|    |MAG1|  |LMA1|     |AAA|      |LMA2|  |MAG2|   |MN2|
     +-+-+    +-+--+  +-+--+     +-+-+      +-+--+  +-+--+   +-+-+
       |        |       |          |          |       |        |
       |     Anchored   |          |          |    Anchored    |
       o--------+-------o Data[MN2-&gt;MN1]      o-------+--------o
       |        |       |&lt;-----    |          |       |        |
       |        |       |AAR(MFV,MN2)         |       |        |
       |        |       |---------&gt;|          |       |        |
       |        |       |AAA(LMA2) |          |       |        |
       |        |       |&lt;---------|          |       |        |
       |        |       Localized routing setup       |        |
       |        |       |&lt;-------------------&gt;|       |        |
</pre>
<p><a href="#fig4">Figure 4</a> shows another example scenario, similar to the example scenario illustrated in <a href="#fig3">Figure 3</a>, LMA1 does not respond to MAG1 with the address of LMA2, instead setting up a localized routing path directly between itself and LMA2 via localized routing signaling.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Diameter Server Authorizes MAG Location Query</h1>
<div id="#rfc.figure.5"></div>
<div id="#fig5"></div>
<pre>
 +---+    +----+  +----+     +---+      +----+  +----+   +---+
 |MN1|    |MAG1|  |LMA1|     |AAA|      |LMA2|  |MAG2|   |MN2|
 +-+-+    +-+--+  +-+--+     +-+-+      +-+--+  +-+--+   +-+-+
   |        |       |          |          |       |        |
   |     Anchored   |          |          |    Anchored    |
   o----------------o          |          o-------+--------o
 Data[MN1-&gt;MN2]     |          |          |       |        |
   |-------&gt;|       |          |          |       |        |
   |        |       LRI(MN1,MN2 )         |       |        |
   |        |-------+----------+---------&gt;|\      |        |
   |        |       |          |          | |     |        |
   |        |       |         AAR(MFV,MN1)|Option 1        |
   |        |       |          |&lt;-------- | |     |        |
   |        |       |          | AAA(LMA1)| |     |        |
   |        |       |          |---------&gt;| |     |        |
   |        |       LRA(MAG2 )            | |     |        |
   |        |&lt;--------------------------- |/      |        |
   |        |                             |       |        |
   |        |       |LRI(MN1,MN2)         |\      |        |
   |        |       +----------+---------&gt;| |     |        |
   |        |       |         AAR(MFV,MN1)|Option 2        |
   |        |       |          |&lt;-------- | |     |        |
   |        |       |          | AAA(LMA1)| |     |        |
   |        |       |          |---------&gt;| |     |        |
   |        |       |    LRA(MAG2)        | |     |        |
   |        |       |&lt;------------------- |/      |        |
   |        |       |                             |        |
   |        |       |Localized routing setup      |        |
   |        |&lt;------+----------------------------&gt;|        |
   |        |===================================-&gt;|        |
   |        |       |          |          |       |-------&gt;|
   |        |       |          |          |    Data[MN2-&gt;MN1]
   |&lt;------ |&lt;-===================================|&lt;-------|
   |        |       |          |          |       |        |
</pre>
<p><a href="#fig5">Figure 5</a> shows an example scenario in which LMA2 acts as a Diameter client, receiving MAG location request and requesting authorization for MAG location Query to the AAA server. In this example scenario, MN1 and MN2 may be anchored to LMA1 and LMA2 respectively or belong to the same LMA. In the case where MNs belong to the different LMAs, MAG1 or LMA1 should has already known the recipient of localized routing is LMA2. If MAG1 initiates LR, MAG1 may take option 1 in the <a href="#fig5">Figure 5</a> and solicit LMA2 to look up the IP address of the MAG to which MN2 is currently attached (in this case, MAG2) according to the IP addresses/HNPs of MN2. If LMA1 initiate LR, LMA1 may take option 2 in the <a href="#fig5">Figure 5</a> and solicit LMA2 to look up IP address of the MAG to which MN2 is currently attached. LMA2 validates the request (LRI in the <a href="#fig5">Figure 5</a>) from MAG1 by sending an AAR to the AAA server containing the IP address/HNP of MN1 (encapsulated in an instance of the MIP6-Home- Link-Prefix AVP) and an instance of the MIP6-Feature-Vector AVP (<a href="#RFC5447">[RFC5447]</a>, Section 4.2.5) with the INTER_MAG_ROUTING_SUPPORTED bit set. If the authorization is successful, LMA2 then looks up the IP address of MAG2 based on the IP address/HNP of MN2 and responds to MAG1 or LMA1 with the IP address of MAG2. </p>
<p id="rfc.section.4.p.2">In the case where MNs share the same LMA, LR should be initiated by LMA1(i.e.,LMA2) since only LMA1 knows both MN1 and MN2 belong to itself by lookup its binding cache corresponding to MN1 and MN2. Unlike the case where MNs belong to different LMAs, the interaction between LMAs in option 2 is omitted since LMA1 is LMA2. The interaction between LMA1 and the AAA should be exact the same as the case where MNs belong to different LMAs.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Localized Routing Service Authorization in Networks with Multiple AAA Servers</h1>
<div id="#rfc.figure.6"></div>
<div id="#fig6"></div>
<pre>
                   +------------------------------------+
                   (                      AAA           )
                   (     +--------+     Backend         )
                   (     |Redirect|                     )
                   (     | Agent  |                     )
                   (     +--------+                     )
                   (         ^                          )
                   (         |                          )
                   (         |                          )
                   (         v                          )
                   (  +---------+          +---------+  )
                +----&gt;| AAA1 &amp;  |          | AAA2 &amp;  |&lt;---+
                |  (  | Policy  |&lt;--------&gt;| Policy  |  ) |
                |  (  | Profile |          | Profile |  ) |
                |  (  +---------+          +---------+  ) |
                |  (      ^                     ^       ) |
                |  +----- | ------------------- |-------+ |
                |         A1                    A2        |
                |         |                     |         |
                |         |                     |         |
             Diameter     v                     v      Diameter
                B1       +----+  LMA2 ?     +----+        B2
                |        |LMA1| ------&gt;     |LMA2|        |
                |        +----+             +----+        |
                |          |                  |           |
                |         //                  \\          |
                |        //                    \\         |
                |       //                      \\        |
                |       |                        |        |
                |     +----+                   +----+     |
                +----&gt;|MAG1|                   |MAG2|&lt;----+
                      +----+                   +----+
                         :                        :
                      +---+                     +---+
                      |MN1|                     |MN2|
                      +---+                     +---+
</pre>
<p id="rfc.section.5.p.1">Referring to an architecture with multiple AAA servers (as illustrated in <a href="#fig6">Figure 6</a>), AAA1 may not maintain the LMA to be assigned to MN2 as a configured entry in the Correspondent Node's Policy profile, as AAA2 holds this information in its policy store. In such a case, AAA1 contacts a Diameter redirect agent [RFC3588] to request the AAA server being responsible for maintaining MN2's policy profile. AAA2 checks if MN2 is allowed to use localized routing and if so, responds with the IP address of LMA2 corresponding to MN2 and sends the results back to LMA1 via AAA1. Details about the use of redirect agents in this context are beyond scope of this document.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">The security considerations for the <a href="#RFC4005">Diameter NASREQ</a> <cite title="NONE">[RFC4005]</cite> and <a href="#RFC5779">Diameter Proxy Mobile IPv6</a> <cite title="NONE">[RFC5779]</cite> applications are also applicable to this document. <br><br> The service authorization solicited by the MAG or the LMA relies upon the existing trust relationship between the MAG/LMA and the AAA server.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This specification specifies a new value in the Mobility Capability registry <a href="#RFC5447">[RFC5447]</a> for use with the MIP6-Feature-Vector AVP: INTER_MAG_ROUTING_SUPPORTED (0x0000080000000000).</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Contributors</h1>
<p id="rfc.section.8.p.1">Paulo Loureiro, Jinwei Xia and Yungui Wang all contributed to early versions of this document.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgement</h1>
<p id="rfc.section.9.p.1">The authors would like to thank Carlos Jes&#250;s Bernardos Cano for his valuable comments and suggestions on this document.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Change Log</h1>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> draft-ietf-dime-pmip6-lr-03</h1>
<p id="rfc.section.10.1.p.1">The following are the major changes compared to previous version 02: </p>

<ul>
<li>Allow return the LMA address in all cases.</li>
<li>Using localized routing for terminology consistency.</li>
<li>Allow localized routing service authorization before localized routing is initialized.</li>
<li>Treat MAGs under the different LMA in the same way as the MAGs under the same LMA.</li>
<li>Get rid of references to individual drafts and only get alignment with Localized routing PS document.</li>
</ul>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> draft-ietf-dime-pmip6-lr-04</h1>
<p id="rfc.section.10.2.p.1">The following are the major changes compared to previous version 03: </p>

<ul>
<li>Move the last paragraph in section 3 to the first paragraph.</li>
<li>Using &#8220;request&#8221; rather than &#8220;localized routing optimization request&#8221;.</li>
<li>Using &#8220;respond&#8221; rather than &#8220;localized routing optimization response&#8221;.</li>
<li>Remove the informative reference to [I-D.wu-netext-local-ro].</li>
<li>Using &#8220;discovery&#8221; rather than &#8220;resolution&#8221;.</li>
<li>Section 5 Fix Typo: &#8220;LMA&#8221;-&gt;&#8221;LMA2&#8221;.</li>
</ul>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> draft-ietf-dime-pmip6-lr-05</h1>
<p id="rfc.section.10.3.p.1">The following are the major changes compared to previous version 04: </p>

<ul>
<li>Redraw the figure 1 to get alignment with the described text.</li>
<li>Section 2 Fix Typo: &#8220;the interaction between LMA1 interaction and the AAA server-&gt; the interaction between LMA1 and the AAA server&#8221;</li>
<li>Section 3 Fix Typo &#8220;the data packet from MN1 to MN2 and requesting -&gt; the data packet from MN2 to MN1 and requesting&#8221;</li>
<li>Section 4 Fix Typo: &#8220;MAG1 or LMA may solicit-&gt; MAG1 or LMA1 may solicit"&#8221;</li>
<li>Differentiate MAG initiated case from LMA initiated case in Figure5</li>
<li>Add text in section 3 and 4 to explicitly explain how LR authorization works in A21.</li>
<li>Change &#8220;localized routing is allowed between MAG1 and MAG2&#8221; in section 3,4,5 to &#8220;MN2 is allowed to use localized routing&#8221;.</li>
<li>Update the abstract to make the description consistent</li>
<li>Highlight the figure 2,3,4,5 and related texts are examples of how LR authorization works using Diameter AAA protocol.</li>
<li>Reference Update.</li>
</ul>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5779">[RFC5779]</b></td>
<td class="top">
<a>Korhonen, J.</a>, <a>Bournelle, J.</a>, <a>Chowdhury, K.</a>, <a>Muhanna, A.</a> and <a>U. Meyer</a>, "<a href="http://tools.ietf.org/html/rfc5779">Diameter Proxy Mobile IPv6: Mobile Access Gateway and Local Mobility Anchor Interaction with Diameter Server</a>", RFC 5779, February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5213">[RFC5213]</b></td>
<td class="top">
<a>Gundavelli, S.</a>, <a>Leung, K.</a>, <a>Devarapalli, V.</a>, <a>Chowdhury, K.</a> and <a>B. Patil</a>, "<a href="http://tools.ietf.org/html/rfc5213">Proxy Mobile IPv6</a>", RFC 5213, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4005">[RFC4005]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Zorn, G.</a>, <a>Spence, D.</a> and <a>D. Mitton</a>, "<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>", RFC 4005, August 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5447">[RFC5447]</b></td>
<td class="top">
<a>Korhonen, J.</a>, <a>Bournelle, J.</a>, <a>Tschofenig, H.</a>, <a>Perkins, C.</a> and <a>K. Chowdhury</a>, "<a href="http://tools.ietf.org/html/rfc5447">Diameter Mobile IPv6: Support for Network Access Server to Diameter Server Interaction</a>", RFC 5447, February 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC6279">[RFC6279]</b></td>
<td class="top">
<a>Liebsch, M.</a>, <a>Jeong, S.</a> and <a>Q. Wu</a>, "<a href="http://tools.ietf.org/html/rfc6279">PMIPv6 Localized Routing Problem Statement</a>", RFC 6279, June 2011.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Glen Zorn</span> 
	  <span class="n hidden">
		<span class="family-name">Zorn</span>
	  </span>
	</span>
	<span class="org vcardline">Network Zen</span>
	<span class="adr">
	  <span>227/358 Thanon Sanphawut</span>

	  <span class="vcardline">
		<span class="locality">Bang Na</span>,  
		<span class="region">Bangkok</span> 
		<span class="code">10260</span>
	  </span>
	  <span class="country-name vcardline">Thailand</span>
	</span>
	<span class="vcardline">Phone: +66 (0) 87-040-4617</span>

<span class="vcardline">EMail: <a href="mailto:gwz@net-zen.net">gwz@net-zen.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Qin Wu</span> 
	  <span class="n hidden">
		<span class="family-name">Wu</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd.</span>
	<span class="adr">
	  <span>101 Software Avenue, Yuhua District</span>

	  <span class="vcardline">
		<span class="locality">Nanjing</span>,  
		<span class="region">Jiangsu</span> 
		<span class="code">21001</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">Phone: +86-25-84565892</span>

<span class="vcardline">EMail: <a href="mailto:sunseawq@huawei.com">sunseawq@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Marco Liebsch</span> 
	  <span class="n hidden">
		<span class="family-name">Liebsch</span>
	  </span>
	</span>
	<span class="org vcardline">NEC Europe Ltd.</span>
	<span class="adr">
	  <span>Kurfuersten-Anlage 36</span>

	  <span class="vcardline">
		<span class="locality">Heidelberg</span>,  
		<span class="region"></span>
		<span class="code">69115</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:liebsch@nw.neclab.eu">liebsch@nw.neclab.eu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jouni Korhonen</span> 
	  <span class="n hidden">
		<span class="family-name">Korhonen</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Linnoitustie 6</span>

	  <span class="vcardline">
		<span class="locality">Espoo FI-02600</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jouni.nospam@gmail.com">jouni.nospam@gmail.com</a></span>

  </address>
</div>

</body>
</html>