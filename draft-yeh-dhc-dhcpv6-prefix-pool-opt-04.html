<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Prefix Pool Option for DHCPv6 Relay Agent on Provider Edge Router</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology and Language">
<link href="#rfc.section.3" rel="Chapter" title="3 Scenario and Network Architecture">
<link href="#rfc.section.4" rel="Chapter" title="4 Prefix Pool Option">
<link href="#rfc.section.5" rel="Chapter" title="5 Relay Agent Behavior">
<link href="#rfc.section.6" rel="Chapter" title="6 Server Behavior">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.section.10" rel="Chapter" title="10 Changes Log">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Prefix Pool option provides an automatic mechanism based on the DHCPv6-PD, allowing the DHCPv6 server to notify the DHCPv6 relay agent implemented only on the Provider Edge (PE) router about the information of prefix pools.  The information of prefix pools can be used to enforce IPv6 route aggregation on the PE router by adding or removing the aggregated routes per the status of the prefix pools. The advertising of the aggregated routes in the routing protocol enabled on the network-facing interface of PE router will dramatically decreases the number of the routes entries in the ISP network." />
  <meta name="description" content="The Prefix Pool option provides an automatic mechanism based on the DHCPv6-PD, allowing the DHCPv6 server to notify the DHCPv6 relay agent implemented only on the Provider Edge (PE) router about the information of prefix pools.  The information of prefix pools can be used to enforce IPv6 route aggregation on the PE router by adding or removing the aggregated routes per the status of the prefix pools. The advertising of the aggregated routes in the routing protocol enabled on the network-facing interface of PE router will dramatically decreases the number of the routes entries in the ISP network." />
  <meta name="keywords" content="DHCPv6, Prefix Pool, Aggregation Route" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DHC Working Group</td>
<td class="right">L. Yeh, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">T. Tsou</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Huawei Technologies</td>
</tr>
<tr>
<td class="left">Expires: December 29, 2011</td>
<td class="right">M. Boucadair</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Hu</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">China Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">June 27, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Prefix Pool Option for DHCPv6 Relay Agent on Provider Edge Router<br />
  <span class="filename">draft-yeh-dhc-dhcpv6-prefix-pool-opt-04</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Prefix Pool option provides an automatic mechanism based on the DHCPv6-PD, allowing the DHCPv6 server to notify the DHCPv6 relay agent implemented only on the Provider Edge (PE) router about the information of prefix pools.  The information of prefix pools can be used to enforce IPv6 route aggregation on the PE router by adding or removing the aggregated routes per the status of the prefix pools. The advertising of the aggregated routes in the routing protocol enabled on the network-facing interface of PE router will dramatically decreases the number of the routes entries in the ISP network.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 29, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology and Language</a>
</li>
<li>3.   <a href="#rfc.section.3">Scenario and Network Architecture</a>
</li>
<li>4.   <a href="#rfc.section.4">Prefix Pool Option</a>
</li>
<li>5.   <a href="#rfc.section.5">Relay Agent Behavior</a>
</li>
<li>6.   <a href="#rfc.section.6">Server Behavior</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.section.10">Changes Log</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#s1" id="s1">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">DHCPv6 <a href="#RFC3315">[RFC3315]</a> protocol specifies a mechanism for the assignment of IPv6 address and configuration information to IPv6 nodes. DHCPv6 Prefix Delegation (DHCPv6-PD) <a href="#RFC3633">[RFC3633]</a> specifies a mechanism for the delegation of IPv6 prefixes from the Delegating Router (DR) acting as the DHCPv6 server to the Requesting Router (RR) acting as the DHCPv6 Client. DHCPv6 servers always maintain authoritative information related to their operations including, but not limited to, binding data of the delegated IPv6 prefixes, lease data of the delegated IPv6 prefixes, and binding data of their prefix pools, etc.</p>
<p id="rfc.section.1.p.2">In the scenario of the centralized DHCP server, the Provider Edge (PE) routers act as a DHCPv6 relay agents when the DHCPv6 Server acting as DR and the DHCPv6 clients acting as RRs are not on the same link. For the reachability purpose, the PE routers always need to add or withdraw the route entries directing to each customer network in their routing table to reflect the status of IPv6 prefixes delegated by the DHCPv6 Server to customer routers (a.k.a. Routed-RG or Routed-CPE), which acts as RRs. (see Section 6.2, <a href="#BBF%20TR-177">[BBF TR-177]</a>).</p>
<p id="rfc.section.1.p.3">When a routing protocol is enabled on the network-facing interface of the PE router, all the routes directing to the customer networks are advertised in the ISP network. This will make the number of route entries in the routing table on the ISP router to be unacceptable huge, so that it is necessary to aggregate the routes directing to the customer networks on the PE router.</p>
<p id="rfc.section.1.p.4">Because the prefixes of the customer networks can not guarantee always to be valid and continuous, the routing protocol enabled on the PE router can not make one aggregated route automatically to cover all the prefixes delegated within the prefix pool. The PE router needs other ways to make the aggregated routes. One way to make the aggregated routes is to configure them manually and permanently per the provision of the prefix pools, but PE router doesn't know the information about the prefix pools when it acts as the relay agent.</p>
<p id="rfc.section.1.p.5">This document proposes a new Prefix Pool option for the DHCPv6 reply agent implemented only on the PE routers, allowing the server to notify the relay agent about the information of prefix pools. After the PE router got the information of the prefix pools, the aggregated route entries (e.g., black-hole routes) pointing to each of the prefix pools can be added or withdrawn in the routing table of the PE router. The aggregated routes will be advertised into the ISP network through the routing protocol enabled on the PE's network-facing interface.</p>
<p id="rfc.section.1.p.6">DHCPv6 Bulk Leasequery <a href="#RFC5460">[RFC5460]</a> specifies a mechanism for bulk transfer of the binding data of each delegated prefix from the server to the requestor (i.e. DHCPv6 relay agent), to support the replacement or reboot event of relay agent. In this document, the capability of DHCPv6 Bulk Leasequery will be extended to support the bulk transfer of the binding data of prefix pool for the route aggregation.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#s2" id="s2">Terminology and Language</a>
</h1>
<p id="rfc.section.2.p.1">This document describes new DHCPv6 options of prefix pool and the associated mechanism on the relay agent and server. This document should be read in conjunction with the DHCPv6 specification, RFC3315, RFC3633, RFC5007 and RFC5460 for a complete mechanism. Definitions for terms and acronyms not specifically defined in this document are defined in RFC3315, RFC3633, <a href="#RFC3769">[RFC3769]</a>, <a href="#RFC5007">[RFC5007]</a> and RFC5460.</p>
<p id="rfc.section.2.p.2">The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD, SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL, when they appear in this document, are to be interpreted as described in BCP 14, <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#s3" id="s3">Scenario and Network Architecture</a>
</h1>
<p id="rfc.section.3.p.1">Figure 1 and Figure 2 illustrate two typical cases of the targeted network architectures.</p>
<div id="#rfc.figure.1"></div>
<div id="#f1"></div>
<pre>
          +------+------+
          |    DHCPv6   |  DHCPv6-PD Delegating Router
          |    Server   |  (e.g.  binding entry: 
          +------+------+         pe#1 - 2001:db8:1230::/44 
        _________|_________       extract pe_id=pe#1
       /                   \      from the interface_id=pe#1_cfi#2)
      |  ISP Core Network   |
       \___________________/
                 |
                 |  Network-facing interface
          +------+------+
          |             |  Provider Edge Router
          |     PE      |  DHCPv6 Relay Agent
          |             |  (e.g.  pe_id=pe#1;
          +------+------+         prefix pool=2001:db8:1230::/44)
                 |  Customer-facing interface (Interface ID)  
                 |  (e.g., interface_id=pe#1_cfi#2)
                 |
          +------+------+  Customer Router
          |     CPE     |  DHCPv6 Client
          |             |  DHCPv6-PD Requesting Router
          +------+------+  (e.g.  customer network
                 |                =2001:db8:1234:5600:/56)
        _________|_________
       /                   \
      |  Customer Network   |
       \___________________/	  	  
	  </pre>
<div id="#rfc.figure.2"></div>
<div id="#f2"></div>
<pre>
          +------+------+
          |    DHCPv6   |  DHCPv6-PD Delegating Router
          |    Server   |  (e.g.  binding entry: 
          +------+------+         pe#3_cfi#4 - 2001:db8:3400::/40)
        _________|_________
       /                   \
      |  ISP Core Network   |
       \___________________/
                 |
                 |  Network-facing interface
          +------+------+
          |      PE     |  Provider Edge Router
          |             |  DHCPv6 Relay Agent
          +------+------+
                 |  Customer-facing interface (Interface ID)
                 |  (e.g.  interface_id=pe#3_cfi#4; 
                 |         prefix pool=2001:db8:3400::/40)
        _________|_________
       /                   \
      |   Access Network    |
       \___________________/
                 |
          +------+------+  Customer Router
          |     CPE     |  DHCPv6 Client
          |             |  DHCPv6-PD Requesting Router
          +------+------+  (e.g.  customer network
                 |                =2001:db8:3456:7800::/56)
        _________|_________
       /                   \
      |  Customer Network   |
       \___________________/

	  </pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#s4" id="s4">Prefix Pool Option</a>
</h1>
<p id="rfc.section.4.p.1">The format of the Prefix Pool option is shown is Figure 3.</p>
<div id="#rfc.figure.3"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|        OPTION_PREFIX_POOL     |           option-length       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  pfx-pool-len |                                               |
+-+-+-+-+-+-+-+-+           ipv6-prefix                         +
|                           (16 octets)                         |
|                                                               |
|                                                               |
+               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |     status    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    
option-code:    OPTION_PREFIX_POOL (TBD)
option-length:  18
pfx-pool-len:   Length for the prefix pool in bits
ipv6-prefix:    IPv6 prefix of the prefix pool
status:         Status of the prefix pool, indicating the 
                availability of the prefix pool maintained 
                on the server.
</pre>
<p id="rfc.section.4.p.2">The codes of the status are defined in the following table.</p>
<div id="#rfc.figure.4"></div>
<pre>
Name      Code
Valid     0
Released  1
Reserved  2~255
</pre>
<p id="rfc.section.4.p.3">The status of 'Valid' in the Prefix Pool option can be used to add the prefix pool and the associated aggregated route on the relay agent; while the status of 'Released' in the Prefix Pool option can be used to withdraw the prefix pool and the associated aggregated route on the relay agent.</p>
<p id="rfc.section.4.p.4">If the administrative policy on the server permit and support the route aggregation on the relay agent, the status of prefix pool can be determined by the delegated prefixes within the associated prefix pool. If there is one delegated prefix within the pool that has valid lease, the status of prefix pool will be 'Valid'. Otherwise, the status of prefix pool is 'Released'. If the administrative policy on the server don't permit or support the route aggregation on the relay agent, the status of prefix pool will always be 'Released'.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#s5" id="s5">Relay Agent Behavior</a>
</h1>
<p id="rfc.section.5.p.1">The relay agent who needs the information of prefix pools, must includes Option Request option (OPTION_ORO, 6) to request Prefix Pool option from the server, who maintains the status of the prefix pools associated to the relay agent itself (Figure 1) or its particular customer-facing interface (Figure 2) where receiving the DHCPv6-PD message from clients. The relay agent can include this Option Request option for Prefix Pool option in the relay-forward (12) message of SOLICIT (1), REQUEST (3), RENEW(5), REBIND (6) and RELEASE (8). The relay agent may also include Prefix Pool option with the field values of pfx-pool-len and IPv6-prefix as its preference which the relay agent would like the server to return.</p>
<p id="rfc.section.5.p.2">The relay agent should include Interface ID option (OPTION_INTERFACE_ID, 18) for the server to identify the relay agent itself or its particular customer-facing interface where the prefix pool is associated, if the server would not like to use link-address specified in the DHCPv6 message encapsulation of relay-forward message to identify the interface of the link on which the clients are located.</p>
<p id="rfc.section.5.p.3">After received the Prefix Pool option for the relay agent itself or its particular customer-facing interface in the relay-reply message (13) of REPLY (7) from the server, the relay agent shall add or withdraw the aggregated route entry per the status of the prefix pool. If the status of the prefix pool got from the server is 'Valid', the relay agent shall add an aggregated route entry in its routing table, if the same entry has not been added in. If the status of the prefix pool got from the server is 'Released', the relay agent shall withdraw the associated aggregated route entry in its routing table, if the same entry has not been withdrawn. If there is no route entry directing to the customer network within the associated aggregated route, the relay agent shall automatically withdraw the aggregated route.</p>
<p id="rfc.section.5.p.4">The relay agent advertises its routing table including the entries of the aggregated routes based on the information of prefix pools when the routing protocol is enabled on its network-facing interface.</p>
<p id="rfc.section.5.p.5">The Relay Agent (i.e. Requestor) can use DHCPv6 Bulk Leasequery <a href="#RFC5460">[RFC5460]</a> to query the binding data of prefix pools in the 'Valid' status from the server. After established a TCP connection with the DHCPv6 server, the relay agent must include Query option (OPTION_LQ_QUERY, 44) and set the proper query-type (QUERY_BY_RELAY_ID, QUERY_BY_LINK_ADDRESS, QUERY_BY_REMOTE_ID), link-address and query-options in the LEASEQUERY (14) message. The query options must include Option Request option (OPTION_ORO, 6) to request Prefix Pool option from the server.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#s6" id="s6">Server Behavior</a>
</h1>
<p id="rfc.section.6.p.1">Per DHCPv6-PD <a href="#RFC3633">[RFC3633]</a>, if the prefix of the customer network requested in relay-forward message of SOLICIT , REQUEST, RENEW, REBIND by the Client (i.e. RR) has valid lease, the Server (i.e. DR) will delegate the prefix with the relevant parameters in the relay-reply message of REPLY. In order to give a meaningful reply, the server has to be able to maintains the binding data of the delegated IPv6 prefixes with the identification of the client. Interface ID option (OPTION_INTERFACE_ID, 18) nested in the relay-forward message is usually used to identify the access line of the client.</p>
<p id="rfc.section.6.p.2">After receiving the Option Request option (OPTION_ORO, 6) to request Prefix Pool option in the relay-forward message of PD, the server must include Prefix Pool option with the status indicated for the associated relay agent itself (Figure 1) or its customer-facing interface (Figure 2) in the relay-reply message of PD if the relay-forward message of PD received is valid.</p>
<p id="rfc.section.6.p.3">The server may use the link-address specified in relay-forward message to identify the relay agent itself or its particular customer-facing interface where the prefix pool is associated, but the server has to maintain the binding data of prefix pools in association with these link-addresses. To be more readable, the server can alternatively use the Interface ID option (OPTION_INTERFACE_ID, 18) included in the relay-forward message by the relay agent, to identify the relay agent itself (Figure 1) or its particular customer-facing interface (Figure 2) where the prefix pool is associated. In order to give a meaningful reply, the server has to maintain the binding data of prefix pools in association with the information derived from the Interface ID option.</p>
<p id="rfc.section.6.p.4">Per DHCPv6 <a href="#RFC3315">[RFC3315]</a>, the server shall copy the same Interface ID option got from the relay-forward message into the relay-reply message.</p>
<p id="rfc.section.6.p.5">If the server is set to support the route aggregation on the relay agent for the particular prefix pool, the status of this prefix pool can be determined by the delegated prefixes within the associated prefix pool. If at least one of delegated prefix in the associated prefix pool has valid lease, the server shall set the status of the prefix pool to be 'Valid'. If the lease of each delegated prefix within the associated prefix pool got expired, or if the delegated prefix in the relay-forward message of RELEASE is the last prefix releasing in the associated prefix pool, the server shall set the status of the associated prefix pool to be 'Released'. If the server is set to not support the route aggregation on the relay agent for the particular prefix pool, the status of prefix pool will always be 'Released'.</p>
<p id="rfc.section.6.p.6">When the administrator of the server changes the setting to support the route aggregation on the relay agent for the particular prefix pool or not, the server may initiates the relay-reply message of RECONFIGURE (10) including Prefix Pool option to add or withdraw the prefix pool and the associated aggregated route on the relay agent if at least one delegated prefix within the prefix pool still has the valid lease.</p>
<p id="rfc.section.6.p.7">Note that multiple prefix pools may associate with the same PE router implementing relay agent (Figure 1) or its customer-facing interface (Figure 2) in the binding table on the server, and the delegated prefix is only from one prefix pool.</p>
<p id="rfc.section.6.p.8">After received the LEASEQUERY (14) message from the relay agent with the Query option (OPTION_LQ_QUERY, 44) including Option Request option (OPTION_ORO, 6) to request Prefix Pool option, the server must include the Client Data options (OPTION_CLIENT_DATA, 45) in the LEASEQUERY-REPLY (15) and LEASEQUERY-DATA (16) message to convey the binding data of the associated prefix pools with the 'Valid' status through the established TCP connection per RFC5460. Each Client Data option shall contain Prefix Pool option, and might contain the Interface ID option. In order to be able to give the meaningful replies to different type of query, the server has to be able to maintain the relevant association of prefix pools with the RELAY_ID, link addresses or Remote_ID of the relay agent in its binding database.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#s7" id="s7">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">Security issues related DHCPv6 are described in section 23 of RFC 3315.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#s8" id="s8">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">IANA is requested to assign an option code to Option_Prefix_Pool from the "DHCPv6 and DHCPv6 options" registry (http://www.iana.org/assignments/dhcpv6-parameters/dhcpv6- parameters.xml).</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#s9" id="s9">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">Thanks to the DHC working group members, Bernie Volz, Eliot Lear, Ole Troan, Roberta Maglione, Ted Lemon, for the discussion in the mailing list. Thanks to Christian Jacquenet for pointing out the draft should cover one more use case of ISP-Customer network where CPE is directly connected to PE. Thanks to Sven Ooghe for some revison after the email review. Thanks to Shrinivas Ashok Joshi for pointing out the draft should cover the robust mechanism against the case of reboot.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#s10" id="s10">Changes Log</a>
</h1>
<p id="rfc.section.10.p.1">If this document is accepted for publication as an RFC, this change log is to be removed before publication.</p>
<p id="rfc.section.10.p.2">Rev. -04 </p>

<ol style="list-style-type: lower-alpha">
<li>Re-titled the draft to emphasize that the new mechanism with DHCPv6-PD is only designed for the PE router.</li>
<li>Re-write the abstract and some words in the introduction.</li>
</ol>
<p id="rfc.section.10.p.3">Rev. -03 </p>

<ol style="list-style-type: lower-alpha">
<li>Revisions on the behavior of Relay Agent about the automatic withdrawal of the aggregated route.</li>
<li>Re-correct the behavior of Server about the Interface ID option.</li>
</ol>
<p id="rfc.section.10.p.4">Rev. -02 </p>

<ol style="list-style-type: lower-alpha">
<li>Add one more use case of ISP network architecture where CPE is directly connected to PE.</li>
<li>Revisions on the usage of the 'status' field in Prefix Pool option.</li>
<li>Extend DHCPv6 Bulk Leasequery (RFC5460) for the new usage.</li>
</ol>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3633">[RFC3633]</b></td>
<td class="top">
<a>Troan, O.</a> and <a>R. Droms</a>, "<a href="http://tools.ietf.org/html/rfc3633">IPv6 Prefix Options for Dynamic Host Configuration Protocol (DHCP) version 6</a>", RFC 3633, December 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3769">[RFC3769]</b></td>
<td class="top">
<a>Miyakawa, S.</a> and <a>R. Droms</a>, "<a href="http://tools.ietf.org/html/rfc3769">Requirements for IPv6 Prefix Delegation</a>", RFC 3769, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5007">[RFC5007]</b></td>
<td class="top">
<a>Brzozowski, J.</a>, <a>Kinnear, K.</a>, <a>Volz, B.</a> and <a>S. Zeng</a>, "<a href="http://tools.ietf.org/html/rfc5007">DHCPv6 Leasequery</a>", RFC 5007, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5460">[RFC5460]</b></td>
<td class="top">
<a>Stapp, M.</a>, "<a href="http://tools.ietf.org/html/rfc5460">DHCPv6 Bulk Leasequery</a>", RFC 5460, February 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="BBF TR-177">[BBF TR-177]</b></td>
<td class="top">
<a>Broadband Forum, </a>, "<a>IPv6 in the context of TR-101, Issue 1</a>", November 2010.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Leaf Y. Yeh</span> editor
	  <span class="n hidden">
		<span class="family-name">Yeh</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies</span>
	<span class="adr">
	  <span>Area F, Huawei Park, Bantian,</span>

	  <span class="vcardline">
		<span class="locality">Longgang District</span>,  
		<span class="region">Shenzhen</span> 
		<span class="code">518129</span>
	  </span>
	  <span class="country-name vcardline">P.R.China</span>
	</span>
	<span class="vcardline">Phone: +86-755-28971871</span>

<span class="vcardline">EMail: <a href="mailto:leaf.y.yeh@huawei.com">leaf.y.yeh@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tina Tsou</span> 
	  <span class="n hidden">
		<span class="family-name">Tsou</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tena@huawei.com">tena@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mohamed Boucadair</span> 
	  <span class="n hidden">
		<span class="family-name">Boucadair</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Rennes</span>,  
		<span class="region"></span>
		<span class="code">35000</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mohamed.boucadair@orange-ftgroup.com">mohamed.boucadair@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jie Hu</span> 
	  <span class="n hidden">
		<span class="family-name">Hu</span>
	  </span>
	</span>
	<span class="org vcardline">China Telecom</span>
	<span class="adr">
	  <span>No.118, Xi Zhi Men-Nei Da Jie,</span>

	  <span class="vcardline">
		<span class="locality">Xicheng District</span>,  
		<span class="region">Beijing</span> 
		<span class="code">100035</span>
	  </span>
	  <span class="country-name vcardline">P.R.China</span>
	</span>
	<span class="vcardline">Phone: +86-10-58552808</span>

<span class="vcardline">EMail: <a href="mailto:huj@ctbri.com.cn">huj@ctbri.com.cn</a></span>

  </address>
</div>

</body>
</html>