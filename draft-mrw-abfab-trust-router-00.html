<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Application Bridging for Federation Beyond the Web (ABFAB) Trust Router Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Trust Router Protocol">
<link href="#rfc.section.4" rel="Chapter" title="4 Trust Router Messages">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Hello Message">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Trust Link Database Message">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Trust Link Update Message">
<link href="#rfc.section.5" rel="Chapter" title="5 Trust Router Operation">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Hello Message Exchange">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Exchanging Initial Trust Link Databases">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Trust Link Updates">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Serial Numbers">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 TCP Connection Handling">
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Conceptual Data Structures">
<link href="#rfc.section.5.6.1" rel="Chapter" title="5.6.1 Peer Table">
<link href="#rfc.section.5.6.2" rel="Chapter" title="5.6.2 Trust Link Database">
<link href="#rfc.section.6" rel="Chapter" title="6 Trust Path Query">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Trust Path Query Messages">
<link href="#rfc.section.6.1.1" rel="Chapter" title="6.1.1 Trust Path Query Request">
<link href="#rfc.section.6.1.2" rel="Chapter" title="6.1.2 Trust Path Query Response">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Trust Path Query Operation">
<link href="#rfc.section.7" rel="Chapter" title="7 Message Representation">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Message Encoding">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Hello Message Representation">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Trust Link Database/Update Representation">
<link href="#rfc.section.7.3.1" rel="Chapter" title="7.3.1 Trust Link Ordering">
<link href="#rfc.section.7.3.2" rel="Chapter" title="7.3.2 Entity Identity">
<link href="#rfc.section.7.3.3" rel="Chapter" title="7.3.3 Trust Link Entry">
<link href="#rfc.section.7.3.4" rel="Chapter" title="7.3.4 Trust Link Database Message">
<link href="#rfc.section.7.3.5" rel="Chapter" title="7.3.5 Trust Link Update Message">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Trust Path Query Representation">
<link href="#rfc.section.7.4.1" rel="Chapter" title="7.4.1 Trust Link Query Request">
<link href="#rfc.section.7.4.2" rel="Chapter" title="7.4.2 Trust Link Query Response">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Message Examples">
<link href="#rfc.section.7.5.1" rel="Chapter" title="7.5.1 Hello Message Example">
<link href="#rfc.section.7.5.2" rel="Chapter" title="7.5.2 Trust Link Database Example">
<link href="#rfc.section.7.5.3" rel="Chapter" title="7.5.3 Trust Link Update Example">
<link href="#rfc.section.7.5.4" rel="Chapter" title="7.5.4 Trust Path Query Request Example">
<link href="#rfc.section.7.5.5" rel="Chapter" title="7.5.5 Trust Path Query Response Example">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="A Trust Router is an infrastucture element used to construct multihop Application Bridging for Federated Authentication Beyond the Web (ABFAB) federations, as discussed in draft-mrw-abfab-multihop-fed-01.txt.  This document defines both the Trust Router Protocol and the Trust Path Query, as discussed in the multihop federation document.  " />
  <meta name="description" content="A Trust Router is an infrastucture element used to construct multihop Application Bridging for Federated Authentication Beyond the Web (ABFAB) federations, as discussed in draft-mrw-abfab-multihop-fed-01.txt.  This document defines both the Trust Router Protocol and the Trust Path Query, as discussed in the multihop federation document.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Wasserman</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Painless Security</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">October 24, 2011</td>
</tr>
<tr>
<td class="left">Expires: April 26, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Application Bridging for Federation Beyond the Web (ABFAB) Trust Router Protocol<br />
  <span class="filename">draft-mrw-abfab-trust-router-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>A Trust Router is an infrastucture element used to construct multihop Application Bridging for Federated Authentication Beyond the Web (ABFAB) federations, as discussed in draft-mrw-abfab-multihop-fed-01.txt.  This document defines both the Trust Router Protocol and the Trust Path Query, as discussed in the multihop federation document.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 26, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Trust Router Protocol</a>
</li>
<li>4.   <a href="#rfc.section.4">Trust Router Messages</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Hello Message</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Trust Link Database Message</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Trust Link Update Message</a>
</li>
<li>5.   <a href="#rfc.section.5">Trust Router Operation</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Hello Message Exchange</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Exchanging Initial Trust Link Databases</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Trust Link Updates</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Serial Numbers</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">TCP Connection Handling</a>
</li>
<li>5.6.   <a href="#rfc.section.5.6">Conceptual Data Structures</a>
</li>
<li>5.6.1.   <a href="#rfc.section.5.6.1">Peer Table</a>
</li>
<li>5.6.2.   <a href="#rfc.section.5.6.2">Trust Link Database</a>
</li>
<li>6.   <a href="#rfc.section.6">Trust Path Query</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Trust Path Query Messages</a>
</li>
<li>6.1.1.   <a href="#rfc.section.6.1.1">Trust Path Query Request</a>
</li>
<li>6.1.2.   <a href="#rfc.section.6.1.2">Trust Path Query Response</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Trust Path Query Operation</a>
</li>
<li>7.   <a href="#rfc.section.7">Message Representation</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Message Encoding</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Hello Message Representation</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Trust Link Database/Update Representation</a>
</li>
<li>7.3.1.   <a href="#rfc.section.7.3.1">Trust Link Ordering</a>
</li>
<li>7.3.2.   <a href="#rfc.section.7.3.2">Entity Identity</a>
</li>
<li>7.3.3.   <a href="#rfc.section.7.3.3">Trust Link Entry</a>
</li>
<li>7.3.4.   <a href="#rfc.section.7.3.4">Trust Link Database Message</a>
</li>
<li>7.3.5.   <a href="#rfc.section.7.3.5">Trust Link Update Message</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Trust Path Query Representation</a>
</li>
<li>7.4.1.   <a href="#rfc.section.7.4.1">Trust Link Query Request</a>
</li>
<li>7.4.2.   <a href="#rfc.section.7.4.2">Trust Link Query Response</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Message Examples</a>
</li>
<li>7.5.1.   <a href="#rfc.section.7.5.1">Hello Message Example</a>
</li>
<li>7.5.2.   <a href="#rfc.section.7.5.2">Trust Link Database Example</a>
</li>
<li>7.5.3.   <a href="#rfc.section.7.5.3">Trust Link Update Example</a>
</li>
<li>7.5.4.   <a href="#rfc.section.7.5.4">Trust Path Query Request Example</a>
</li>
<li>7.5.5.   <a href="#rfc.section.7.5.5">Trust Path Query Response Example</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">A Trust Router is an infrastucture element used to construct multihop Application Bridging for Federated Authentication Beyond the Web (ABFAB) federations, as discussed in draft-mrw-abfab-multihop-fed-01.txt.  This document defines both the Trust Router Protocol and the Trust Path Query, as discussed in the multihop federation document.  </p>
<p id="rfc.section.1.p.2">This document defines the protocol used between Trust Routers to exchange information about Trust Paths available within an ABFAB federation.  It also defines the messages that a federated service will use to obtain Trust Path information from its local Trust Router, so that it can use the ABFAB Key Negotiation Protocol (KNP) to forge a Chain of Trust across a federation.  The Chain of Trust will lead to an Authentication, Authorization and Accounting (AAA) Server for a user's Identity Provider, which will then be used to authenticate and authorize the user.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Requirements Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Trust Router Protocol</h1>
<p id="rfc.section.3.p.1">The Trust Router protocol is a TCP-based protocol that is used to exchange information between Trust Routers about available Trust Links within an ABFAB Federation.  </p>
<p id="rfc.section.3.p.2">As discussed in the multihop federation document, When a Trust Router advertises a Trust Link, such as A(T) -&gt; B(T), it is making an assertion that Trust Router A is able, and willing, to provide temporary identities (via KNP) that can be used to reach Trust Router B.  </p>
<p id="rfc.section.3.p.3">Trust Routers use the information they receive about available Trust Links to construct Trust Paths that can be used to reach AAA Servers (i.e. RADIUS or DIAMETER servers) for a set of Identity Providers (IDPs) within a ABFAB federation.  They then return the shortest path to a specific IDP in response to Trust Path Queries.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Trust Router Messages</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Hello Message</h1>
<p id="rfc.section.4.1.p.1">Hello Messages are the first messages exchanged by Trust Routers when they bring up a new TCP connection, and they may be exchanged at other times to ensure that database information is synchronized, or to trigger a full Trust Link Database download.  The first Hello messages exchanged over a new TCP connection are also used as the vehicle to establish an authenticated and encrypted GSS-API session.  </p>
<p id="rfc.section.4.1.p.2">TBD:  We need to discuss how GSS-API will be used with this protocol.  Maybe we need separate authentication messages before the Hello messages are exchanged? </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Trust Link Database Message</h1>
<p id="rfc.section.4.2.p.1">A Trust Link Database Message contains a full (potentially filtered) set of Trust Links that can be reached through the sending Trust Router.  This message may be quite large, and is only sent when solicited by the receiver.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Trust Link Update Message</h1>
<p id="rfc.section.4.3.p.1">Trust Routers send Trust Link Update messages to other Trust Routers to whom they are connected whenever their Trust Link Database is updated.  Trust Link Update messages contain the portions of the Trust Link Database that have changed since the last update.  They also contain a serial number that can be used by the receiving Trust Router to determine if any updates have been missed, in which case a full Trust Router Database download is needed.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Trust Router Operation</h1>
<p id="rfc.section.5.p.1">This section describes how Trust Routers work, in general.  Detailed message formats are described in later sections of the document.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Hello Message Exchange</h1>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Exchanging Initial Trust Link Databases</h1>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Trust Link Updates</h1>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Serial Numbers</h1>
<p></p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> TCP Connection Handling</h1>
<p id="rfc.section.5.5.p.1">Trust Routers communicate by exchanging full JSON-encoded messages over a TCP connection.  If incomplete messages are received, or if the TCP connection is interrupted before a complete message is received, the incomplete messages will be discarded, and no protocol actions will be taken based on the contents of the incomplete message.  </p>
<p id="rfc.section.5.5.p.2">In the Trust Router Protocol, no information about the availability of Trust Links is inferred from a TCP reset, or a retransmission timeout on the TCP connection to another Trust Router.  A Trust Router is only considered unreachable after an attempt to reestablish a TCP connection to that Trust Router is reset or times out.  </p>
<p id="rfc.section.5.5.p.3">When a Trust Router is found to be unreachable, the Trust Links supplied by that Trust Router are not removed from the local Trust Link Database.  They will however, be marked as deprecated until a connection can be reestablished with the Trust Router that sent them, and it can be verified that the sequence number of that Trust Router's Database still matches the sequence number of the most recent Trust Link information received.  </p>
<p id="rfc.section.5.5.p.4">When Trust Links are marked as deprecated, they will not be used if another, non-deprecated path exists to reach the target Identity Provider.  If there are no paths to the target Identity Provider that traverse only non-deprecated Trust Links, a path containing a deprecated Trust Link will be used.  </p>
<h1 id="rfc.section.5.6">
<a href="#rfc.section.5.6">5.6.</a> Conceptual Data Structures</h1>
<h1 id="rfc.section.5.6.1">
<a href="#rfc.section.5.6.1">5.6.1.</a> Peer Table</h1>
<p></p>
<h1 id="rfc.section.5.6.2">
<a href="#rfc.section.5.6.2">5.6.2.</a> Trust Link Database</h1>
<p></p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Trust Path Query</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Trust Path Query Messages</h1>
<h1 id="rfc.section.6.1.1">
<a href="#rfc.section.6.1.1">6.1.1.</a> Trust Path Query Request</h1>
<h1 id="rfc.section.6.1.2">
<a href="#rfc.section.6.1.2">6.1.2.</a> Trust Path Query Response</h1>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Trust Path Query Operation</h1>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Message Representation</h1>
<p id="rfc.section.7.p.1">This section provides details about the contents and encoding of both Trust Router Protocol messages and Trust Path Query messages.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> Message Encoding</h1>
<p id="rfc.section.7.1.p.1">The Trust Router Protocol and Trust Path Query messages are encoded in JavaScript Object Notation (JSON) [RFC4627].  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> Hello Message Representation</h1>
<p id="rfc.section.7.2.p.1">Name or Realm (??) Auth-Token (??) Database-Serial-Number Database-Request </p>
<p id="rfc.section.7.2.p.2">TBD: It is unclear what sort of authentication information needs to be in this message for GSS-API authentication.  </p>
<p id="rfc.section.7.2.p.3">Database-Serial-Number field contains the current serial number of the sending Trust Router's Trust Link Database.  This information may be used by a receiving Trust Router to determine whether it should request a full Trust Link Database download.  </p>
<p id="rfc.section.7.2.p.4">The Database-Request field indicates whether the receiving Trust Router should respond to this message with a Trust Link Database message, to share its full Trust Link Database with the sending Trust Router.  If this field has a value of "true", a download is requested.  If it is "false", a download is not requested.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> Trust Link Database/Update Representation</h1>
<p id="rfc.section.7.3.p.1">In the Trust Router Protocol, each Trust Router will send a (potentially filtered) set of Trust Links to its neighboring Trust Routers.  The representation of these Trust Links is designed for efficient encoding, and to allow easy population of a conceptual Trust Link Table  on the receiving Trust Router.  Each Trust Router will only distribute a set of Trust Links that form a connected tree rooted at the sending Trust Router.  </p>
<p id="rfc.section.7.3.p.2">Conceptually, a Trust Link consists: </p>

<ul>
<li>A Trust Router that is willing to provide a temporary identity.</li>
<li>The Trust Router or AAA Server which the identity can be provided </li>
<li>The Communities-of-Interest to whom the link is available.</li>
<li>A lifetime for this link, in seconds.</li>
</ul>

<p> However, the actual Trust Links passed in the Trust Router protocol rely on inference and ordering to eliminate the need to include the first Trust Router identity in each distributed link.  Instead, we use an Index variable, which indicates each Trust Link's level in a conceptual tree, and we order the Trust Links, so that a Trust Link with an Index of N is subordinate to the closest previous Trust Link with an index of N-1 that applies to the same Community-of-Interest.  Each conceptual tree is rooted at the sending Trust Router, which is represented by an an entry with an Index value of 0.  </p>
<h1 id="rfc.section.7.3.1">
<a href="#rfc.section.7.3.1">7.3.1.</a> Trust Link Ordering</h1>
<p></p>
<h1 id="rfc.section.7.3.2">
<a href="#rfc.section.7.3.2">7.3.2.</a> Entity Identity</h1>
<p id="rfc.section.7.3.2.p.1">When we send Trust Router or AAA Server identities in the Trust Router Protocol, that information will be sent in an Entity Identity structure containing the following fields: </p>

<ul>
<li>Name</li>
<li>Type</li>
<li>Realm</li>
</ul>

<p> </p>
<p id="rfc.section.7.3.2.p.2">The Name field will typically contain a fully-qualified domain name (FQDN) that can be used to reach the indicated entity (e.g.  "tr-A.example.net").  </p>
<p id="rfc.section.7.3.2.p.3">The Type field indicates that the entity is a Trust Router (Type = "T") or a AAA Server (Type = "R").  </p>
<p id="rfc.section.7.3.2.p.4">The Realm field contains the security realm associated with the entity (e.g. "example.net").  </p>
<h1 id="rfc.section.7.3.3">
<a href="#rfc.section.7.3.3">7.3.3.</a> Trust Link Entry</h1>
<p id="rfc.section.7.3.3.p.1">As transmitted in the Trust Router Protocol, a Trust Link entry will have the following fields: </p>

<ul>
<li>Index</li>
<li>Target-Entity</li>
<li>Communities-of-Interest</li>
<li>Lifetime</li>
</ul>

<p> </p>
<p id="rfc.section.7.3.3.p.2">The Index field contains a non-zero integer value, indicating the depth of this Trust Link in a conceptual tree of links rooted at the sending Trust Router.  The maximum value of this field is 255.  </p>
<p id="rfc.section.7.3.3.p.3">The Target-Entity field contains a the Trust Router or AAA Server for which temporary identities can be generated.  This also represents the Trust Router that can generate identities for any directly subordinate nodes in the conceptual tree.  </p>
<p id="rfc.section.7.3.3.p.4">The Communities-of-Interest field contains an array of strings, each containing a Community-of-Interest for which this link is available.  </p>
<p id="rfc.section.7.3.3.p.5">The Lifetime field contains an integer that indicates the lifetime of this Trust Link in seconds.  Links are removed from the the conceptual Trust Link Table if their lifetime expires.  </p>
<h1 id="rfc.section.7.3.4">
<a href="#rfc.section.7.3.4">7.3.4.</a> Trust Link Database Message</h1>
<p id="rfc.section.7.3.4.p.1">A Trust Link Databases will consist two fields: </p>

<ul>
<li>Serial-Number</li>
<li>Trust-Links</li>
</ul>

<p> </p>
<p id="rfc.section.7.3.4.p.2">The Serial-Number field contains an integer indicating the version of the information contained in this database.  The maximum value for this field is (2^32 - 1).  </p>
<p id="rfc.section.7.3.4.p.3">The Trust-Links field contains an array of Trust Link Entries.  </p>
<h1 id="rfc.section.7.3.5">
<a href="#rfc.section.7.3.5">7.3.5.</a> Trust Link Update Message</h1>
<p></p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Trust Path Query Representation</h1>
<h1 id="rfc.section.7.4.1">
<a href="#rfc.section.7.4.1">7.4.1.</a> Trust Link Query Request</h1>
<p id="rfc.section.7.4.1.p.1">TBD: Pending resolution of open architectural questions regarding what will be queried/returned in these messages.  </p>
<h1 id="rfc.section.7.4.2">
<a href="#rfc.section.7.4.2">7.4.2.</a> Trust Link Query Response</h1>
<p id="rfc.section.7.4.2.p.1">TBD: Pending resolution of open architectural questions regarding what will be queried/returned in these messages.  </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> Message Examples</h1>
<p id="rfc.section.7.5.p.1">This section contains example of Trust Router Protocol and Trust Query messages encoded in JSON, as they will be sent over the nework.  </p>
<h1 id="rfc.section.7.5.1">
<a href="#rfc.section.7.5.1">7.5.1.</a> Hello Message Example</h1>
<p></p>
<h1 id="rfc.section.7.5.2">
<a href="#rfc.section.7.5.2">7.5.2.</a> Trust Link Database Example</h1>
<p></p>
<h1 id="rfc.section.7.5.3">
<a href="#rfc.section.7.5.3">7.5.3.</a> Trust Link Update Example</h1>
<p></p>
<h1 id="rfc.section.7.5.4">
<a href="#rfc.section.7.5.4">7.5.4.</a> Trust Path Query Request Example</h1>
<p id="rfc.section.7.5.4.p.1">TBD: Pending resolution of open architectural questions regarding what will be queried/returned in these messages.  </p>
<h1 id="rfc.section.7.5.5">
<a href="#rfc.section.7.5.5">7.5.5.</a> Trust Path Query Response Example</h1>
<p id="rfc.section.7.5.5.p.1">TBD: Pending resolution of open architectural questions regarding what will be queried/returned in these messages.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">[TBD] </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">IANA has allocated the following TCP port numbers for use by protocols described in this document: </p>
<p id="rfc.section.9.p.2">[TBD] </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgements</h1>
<p id="rfc.section.10.p.1">This document was written using the xml2rfc tool described in RFC 2629 <a href="#RFC2629">[RFC2629]</a>.  </p>
<p id="rfc.section.10.p.2">The following people provided useful comments or feedback on this document:  Sam Hartman, Josh Howlett.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Margaret Wasserman</span> 
	  <span class="n hidden">
		<span class="family-name">Wasserman</span>
	  </span>
	</span>
	<span class="org vcardline">Painless Security</span>
	<span class="adr">
	  <span>356 Abbott Street</span>

	  <span class="vcardline">
		<span class="locality">North Andover</span>,  
		<span class="region">MA</span> 
		<span class="code">01845</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 781 405 7464</span>

<span class="vcardline">EMail: <a href="mailto:mrw@painless-security.com">mrw@painless-security.com</a></span>

<span class="vcardline">URI: <a href="http://www.painless-security.com">http://www.painless-security.com</a></span>

  </address>
</div>

</body>
</html>