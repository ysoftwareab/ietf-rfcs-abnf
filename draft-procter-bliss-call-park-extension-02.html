<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Implementing Call Park and Retrieve using the
			Session Initiation Protocol (SIP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Implementing Call Park and Retrieve using the
			Session Initiation Protocol (SIP)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">BLISS</td><td class="header">M. Procter</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">VoIP.co.uk</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">August 17, 2008</td></tr>
<tr><td class="header">Expires: February 18, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Implementing Call Park and Retrieve using the
			Session Initiation Protocol (SIP)<br />draft-procter-bliss-call-park-extension-02</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on February 18, 2009.</p>

<h3>Abstract</h3>

<p>
Call Park and Call Retrieve are useful telephony services that are
familiar to many users.  Existing implementations using the Session
Initiation Protocol (SIP) show that a variety of approaches can be
taken, with varying degrees of interoperability.  This draft discusses a
number of feature variations, and how they may be implemented.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Overview<br />
<a href="#anchor2">2.</a>&nbsp;
Parking a call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Parking a call without an orbit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Parking a call with a specified orbit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
Parking a call with a Park-Server allocated orbit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.4.</a>&nbsp;
A failed attempt to park a call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.5.</a>&nbsp;
Parking a call without a Park Server<br />
<a href="#anchor8">3.</a>&nbsp;
Retrieving a Parked Call<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.1.</a>&nbsp;
Retrieving a call from a Park Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.</a>&nbsp;
Retrieving a call from a User Agent<br />
<a href="#anchor11">4.</a>&nbsp;
User Agent Configuration<br />
<a href="#anchor12">5.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor13">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor14">7.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Overview</h3>

<p>
Call Park is a feature that enables UAs to make a call inactive
but not terminated, in such a way as to allow the call to be resumed
by the UA that parked the call, or by a different UA.

</p>
<p>
This feature is typically used when User A wishes to transfer a call in
progress to User B, but doesn't necessarily know how to reach User B's
UA directly.  In this situation, User A parks the call, and then tells
User B where the call is parked.  User B may then retrieve the call
using a convenient UA.

</p>
<p>
Other uses include allowing multiple calls to be parked at the same
'location', and forming a queue.  In this way, a simple 'ACD' (Automatic
Call Distribution) system can
be implemented that permits calls to be initially sorted and placed in
one of a number of queues, ready to be handled when an appropriate agent
becomes available (and retrieves the next call from the queue).

</p>
<p>
In all cases, the parked call is subsequently identifiable by a short
(typically 3 or 4 digit) label known as an 'orbit'.  This orbit is often
allocated by the user parking the call, but some environments favour
allocation of the orbit by a Park Server.  Both approaches are described
in this document.

</p>
<p>
Having a Park Server for parked calls is a useful approach, which
secures parked calls against User Agent rebooting and other losses of
service.  However, being able to park and retrieve
calls without a Park Server is also a useful model, both in terms of
decentralised network design and also for smaller installations that
don't necessarily merit a separate Park Server.  Therefore,
parking with and without a Park Server are discussed in this document.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Parking a call</h3>

<p>
A basic call flow for Call Park is given in 
<a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>
(section
2.15), and this forms the basis of the feature.  This approach uses the
SIP dialog ID between the parked endpoint and the park server itself as
the unique parked call identifier.  Using the dialog ID has a number of
advantages since it is unique and allocated by both the parked user and
the Park Server.  However, it is also long, which can lead to problems
when trying to identify parked calls by verbal or human-written
mechanisms.

</p>
<p>
   Traditional PBX users have become accustomed to parking a call
   against a short number (typically 3 or 4 digits), and then using this
   identifier to communicate to the retrieving party which call to
   retrieve.  This information may be passed verbally, or by means of
   small paper notes.  Whilst collisions may occur, they are generally
   avoided satisfactorily by administrative policies.

</p>
<p>
This draft attempts to reconcile these two models by allowing a short
label to be attached to a parked call (the 'orbit').  The retrieving
party can then use the same tag to locate the relevant dialog ID in
order to retrieve the parked call.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Parking a call without an orbit</h3>

<p>
Certain environments do not require an 'orbit' to be used, either
because calls are parked in a single queue, or the dialog identifiers
are readily passed between concerned UAs.  In this scenario, the flow
described in <a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a> is followed without deviation.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Parking a call with a specified orbit</h3>

<p>
The message flow of parking a call in this scenario is identical to
that illustrated in <a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>.  The difference that this 
draft introduces is in the REFER message to the Park Server.  The 
details of the REFER message changes are discussed below.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Alice           Bob        Park Server       Carol
             |              |              |              |
             |   INVITE F1  |              |              |
             |-------------&gt;|              |              |
             |180 Ringing F2|              |              |
             |&lt;-------------|              |              |
             |  200 OK F3   |              |              |
             |&lt;-------------|              |              |
             |    ACK F4    |              |              |
             |-------------&gt;|              |              |
             |  RTP Media   |              |              |
             |&lt;============&gt;|              |              |
             |      Bob Parks Call         |              |
             |              |   REFER Refer-To: A F5      |
             |              |-------------&gt;|              |
             |              |    202 F6    |              |
             |              |&lt;-------------|              |
             |              |   NOTIFY F7  |              |
             |              |&lt;-------------|              |
             |              |    200 F8    |              |
             |              |-------------&gt;|              |
             |  INVITE F9 Replaces: B      |              |
             |&lt;----------------------------|              |
             |          200 OK F10         |              |
             |----------------------------&gt;|              |
             |           ACK F11           |              |
             |&lt;----------------------------|              |
             |(Music-on-Hold or other RTP?)|              |
             |&lt;===========================&gt;|              |
             |     BYE F12  |              |              |
             |-------------&gt;|  NOTIFY F14  |              |
             |  200 OK F13  |&lt;-------------|              |
             |&lt;-------------|  200 OK F15  |              |
             |              |-------------&gt;|              |
</pre></div>
<p>
   The URI &lt;sips:park-server@example.com;orbit=1234&gt; is used instead of
   directing the request to the URI &lt;sips:park@server.example.com&gt;.  The
   addition of the orbit parameter effectively tags the parked call with
   a short memorable code entered by the user.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F5 REFER Bob -&gt; Park Server

   REFER sips:park-server@example.com;orbit=1234 SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKnashds9
   Max-Forwards: 70
   From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=02134
   To: Park Server &lt;sips:park-server@example.com;orbit=1234&gt;
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 1 REFER
 &lt;allOneLine&gt;
   Refer-To: &lt;sips:alice@client.atlanta.example.com?Replaces=
   12345601%40atlanta.example.com%3Bfrom-tag%3D314159
   %3Bto-tag%3D1234567&gt;
 &lt;/allOneLine&gt;
   Referred-By: &lt;sips:bob@biloxi.example.com&gt;
   Contact: &lt;sips:bob@client.biloxi.example.com&gt;
   Content-Length: 0
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Parking a call with a Park-Server allocated orbit</h3>

<p>
Sometimes an orbit number assignment policy needs to be implemented.
This may be to ensure that all orbit numbers are a particular length,
or have a form that means that they can be dialled directly (given
suitable extensions to an Application Server).  It may also be
implemented to eliminate the problem of trying to park more than one
call on the same orbit.

</p>
<p>
To enforce a policy, we ensure that the orbit number is not allocated
by the UA (entered by the user, or by configuration etc.)  but is
instead allocated by the Park Server, and relayed to the UA.  The
approach taken here is analogous to the Conference Factory approach
described in <a class='info' href='#RFC4579'>[RFC4579]<span> (</span><span class='info'>Johnston, A. and O. Levin, &ldquo;Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents,&rdquo; August&nbsp;2006.</span><span>)</span></a>.  Bob sends a REFER to
the preconfigured Park Server URI, but without any 'orbit' parameter
added.  The Park Server then responds by redirecting Bob to the correct
orbit by using a '302 Moved Temporarily' response.  The orbit can then
be found by inspecting this new target.  Note that an intermediate proxy
may recurse on this 302 response and Bob may never see the redirect.  In
this scenario, Bob can still extract the orbit from Contact of 2xx
response to the original REFER.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Alice           Bob        Park Server       Carol
             |              |              |              |
             |   INVITE F1  |              |              |
             |-------------&gt;|              |              |
             |180 Ringing F2|              |              |
             |&lt;-------------|              |              |
             |  200 OK F3   |              |              |
             |&lt;-------------|              |              |
             |    ACK F4    |              |              |
             |-------------&gt;|              |              |
             |  RTP Media   |              |              |
             |&lt;============&gt;|              |              |
             |      Bob Parks Call         |              |
             |              |   REFER Refer-To: A F5      |
             |              |-------------&gt;|              |
             |              |302 Orbit allocated F6       |
             |              |&lt;-------------|              |
             |              |   REFER Refer-To: A F7      |
             |              |-------------&gt;|              |
             |              |202 Accepted F8              |
             |              |&lt;-------------|              |
             |              |   NOTIFY     |              |
             |              |&lt;-------------|              |
             |              |    200 OK    |              |
             |              |-------------&gt;|              |
             |  INVITE  Replaces: Bob      |              |
             |&lt;----------------------------|              |
             |          200 OK             |              |
             |----------------------------&gt;|              |
             |           ACK               |              |
             |&lt;----------------------------|              |
             |(Music-on-Hold or other RTP?)|              |
             |&lt;===========================&gt;|              |
             |     BYE      |              |              |
             |-------------&gt;|  NOTIFY      |              |
             |  200 OK      |&lt;-------------|              |
             |&lt;-------------|  200 OK      |              |
             |              |-------------&gt;|              |
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F5 REFER Bob -&gt; Park Server

   REFER sips:park-server@example.com SIP/2.0
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKnashdsB
   Max-Forwards: 70
   From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=22134
   To: Park Server &lt;sips:park-server@example.com&gt;
   Call-ID: 4802029847@biloxi.example.com
   CSeq: 1 REFER
&lt;allOneLine&gt;
   Refer-To: &lt;sips:alice@client.atlanta.example.com?Replaces=
   12345601%40atlanta.example.com%3Bfrom-tag%3D314159
   %3Bto-tag%3D1234567&gt;
&lt;/allOneLine&gt;
   Referred-By: &lt;sips:bob@biloxi.example.com&gt;
   Contact: &lt;sips:bob@client.biloxi.example.com&gt;
   Content-Length: 0
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   F6 302 Orbit Allocated Park Server -&gt; Bob

   SIP/2.0 202 Orbit Allocated
   Via: SIP/2.0/TLS client.biloxi.example.com:5061
    ;branch=z9hG4bKnashdsB
    ;received=192.0.2.105
   From: Bob &lt;sips:bob@biloxi.example.com&gt;;tag=22134
   To: Park Server &lt;sips:park-server@example.com&gt;;tag=56324
   Call-ID: 4802029848@biloxi.example.com
   CSeq: 1 REFER
   Contact: &lt;sips:park-server@example.com;orbit=1234&gt;
   Content-Length: 0
</pre></div>
<p>
Once Bob's UA learns of the allocated orbit (either by finding it in 
the 302 response, or by finding it in the Contact of the 202 response 
to the REFER), it can be passed to the user (Bob) in an appropriate
manner.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
A failed attempt to park a call</h3>

<p>
A Park Server may choose to reject a park attempt for many reasons,
including prohibiting multiple calls being parked against the same
orbit, or prohibiting certain users from parking calls on certain
orbits.  Whatever the reason, the response sent to Bob will enable Bob
to take appropriate action.  The following example shows the Park Server
rejecting a call due to the orbit already being in use.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Alice           Bob        Park Server       Carol
             |              |              |              |
             |   INVITE F1  |              |              |
             |-------------&gt;|              |              |
             |180 Ringing F2|              |              |
             |&lt;-------------|              |              |
             |  200 OK F3   |              |              |
             |&lt;-------------|              |              |
             |    ACK F4    |              |              |
             |-------------&gt;|              |              |
             |  RTP Media   |              |              |
             |&lt;============&gt;|              |              |
             |      Bob Parks Call         |              |
             |              |   REFER Refer-To: A F5      |
             |              |-------------&gt;|              |
             |              |486 Busy Here |              |
             |              |&lt;-------------|              |
</pre></div>
<p>
When Bob's parking attempt is rejected, Bob may choose to attempt to park
the call again, but using a different orbit number.  The ability for Bob
to recover from failed parking attempts such as this without dropping the 
call to Alice is an important consequence of Bob sending the REFER to the
Park Server, rather than sending the REFER to Alice so that she can park
herself.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Parking a call without a Park Server</h3>

<p>
Sometimes, it is useful to be able to park a call without using a Park
Server.  The original dialog between Alice and Bob is maintained, even
though Bob has notionally parked the call.  As a consequence, the only
changes that occur may be within Bob's UA, and will not necessarily
involve any SIP signalling.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Retrieving a Parked Call</h3>

<p>
In order to retrieve a parked call, Carol needs to obtain the dialog 
identifiers for the dialog between Alice and wherever Alice is parked.

</p>
<p>
The dialog identifiers can be obtained by issuing a SUBSCRIBE for the
dialog event package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a>.  The resulting NOTIFY
will contain details of all pertinent calls, including the dialog
identifiers.  Carol may (if presented with multiple dialogs) choose
which call to retrieve.  Many implementations choose the first dialog
listed, although some use the &lt;duration&gt; element to identify which
call has been parked for the longest time.  Obtaining the dialog information in
this way follows the flow described in 
<a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Retrieving a call from a Park Server</h3>

<p>
By subscribing to the dialog event package <a class='info' href='#RFC4235'>[RFC4235]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2005.</span><span>)</span></a>
at the same URI used for parking the call, i.e.
&lt;sips:park-server@example.com;orbit=1234&gt;, all the information that
is required for the call to be retrieved by C is delivered in the
corresponding NOTIFY.

</p>
<p>
Similarly, if the call was parked in an environment that does not
require 'orbit' parameters, subscribing to the URI used for parking the
call, i.e. &lt;sips:park-server@example.com&gt;, will still result in
the necessary information being provided for the call to be retrieved.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           Alice           Bob        Park Server       Carol
             |              |              |              |
             |              |              | SUBSCRIBE F1 |
             |              |              |&lt;-------------|
             |              |              |  200 OK F2   |
             |              |              |-------------&gt;|
             |              |              |  NOTIFY F3   |
             |              |              |-------------&gt;|
             |              |              |  200 OK F4   |
             |              |              |&lt;-------------|
             |              |              |              |
             |              |              |              |
             |           INVITE Replaces: Park Server F5  |
             |&lt;-------------------------------------------|
             |              |              |   200 F6     |
             |-------------------------------------------&gt;|
             |              |              |    ACK F7    |
             |&lt;-------------------------------------------|
             |                  RTP Media                 |
             |&lt;==========================================&gt;|
             |           BYE F8            |              |
             |----------------------------&gt;|              |
             |          200 OK F9          |              |
             |&lt;----------------------------|              |
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F1 SUBSCRIBE  Carol -&gt; Park Server

SUBSCRIBE sips:park-server@example.com;orbit=1234 SIP/2.0
Via: SIP/2.0/TLS chicago.example.com:5061;branch=z9hG4bK92bz
Max-Forwards: 70
From: Carol &lt;sips:carol@chicago.example.com&gt;;tag=8672349
To: &lt;sips:park-server@example.com;orbit=1234&gt;
Call-ID: xt4653gs2ham@chicago.example.com
CSeq: 1 SUBSCRIBE
Contact: &lt;sips:carol@client.chicago.example.com&gt;
Event: dialog
Subscription-State: active;expires=0
Accept: application/dialog-info+xml
Content-Length: 0
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F2 200 OK  Park Server -&gt; Carol

SIP/2.0 200 OK
Via: SIP/2.0/TLS chicago.example.com:5061;branch=z9hG4bK92bz
 ;received=192.0.2.114
Max-Forwards: 70
From: Carol &lt;sips:carol@chicago.example.com&gt;;tag=8672349
To: &lt;sips:park-server@example.com;orbit=1234&gt;;tag=1234567
Call-ID: xt4653gs2ham@chicago.example.com
CSeq: 1 SUBSCRIBE
Content-Length: 0
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F3 NOTIFY  Park Server -&gt; Carol

NOTIFY sips:carol@client.chicago.example.com SIP/2.0
Via: SIP/2.0/TLS chicago.example.com:5061;branch=z9hG4bK93ca
Max-Forwards: 70
To: Carol &lt;sips:carol@chicago.example.com&gt;;tag=8672349
From: &lt;sips:park-server@example.com;orbit=1234&gt;;tag=1234567
Call-ID: xt4653gs2ham@chicago.example.com
CSeq: 2 NOTIFY
Contact: &lt;sips:park-server@example.com;orbit=1234&gt;
Event: dialog
Subscription-State: terminated
Content-Type: application/dialog-info+xml
Content-Length: ...

&lt;?xml version="1.0"?&gt;
&lt;dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
   version="0" state="full"
   entity="sips:park@park.server.example.com;orbit=1234"&gt;
   &lt;dialog id="94992014524" call-id="12345600@atlanta.example.com"
      local-tag="3145678" remote-tag="1234567" direction="recipient"
      remote-uri="alice@atlanta.example.com"
      remote-target="alice@client.atlanta.example.com"&gt;
   &lt;state&gt;confirmed&lt;/state&gt;
   &lt;/dialog&gt;
&lt;/dialog-info&gt;
</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F4 200 OK  Carol -&gt; Park Server

SIP/2.0 200 OK
Via: SIP/2.0/TLS chicago.example.com:5061;branch=z9hG4bK93ca
To: Carol &lt;sips:carol@chicago.example.com&gt;;tag=8672349
From: &lt;sips:park@server.example.com;orbit=1234&gt;;tag=1234567
Call-ID: xt4653gs2ham@chicago.example.com
CSeq: 2 NOTIFY
Contact: &lt;sips:carol@client.chicago.example.com&gt;
Content-Length: 0
</pre></div>
<p>
   The remainder of the frames are the same as the corresponding frames
   from <a class='info' href='#I-D.ietf-sipping-service-examples'>[I&#8209;D.ietf&#8209;sipping&#8209;service&#8209;examples]<span> (</span><span class='info'>Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;Session Initiation Protocol Service Examples,&rdquo; July&nbsp;2008.</span><span>)</span></a>, since the required dialog ID has been
   obtained through the SUBSCRIBE / NOTIFY cycle from the Park Server.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Retrieving a call from a User Agent</h3>

<p>
Retrieving a parked call from a User Agent is very similar to retrieving
a call from a Park Server.  The main difference is identifying which URI
should be used for the initial subscription, in order to find the dialog
identifiers for the parked call.

</p>
<p>
The URI most likely to be known for a particular User Agent is the AoR.  
But this may correspond to multiple UAs.  Therefore, if Carol subscribes
to the AoR, she should be prepared for multiple NOTIFY responses, should
her SUBSCRIBE fork.

</p>
<p>
It is tempting to state that Carol should subscribe to the GRUU of the
UA with the parked call.  This will work well if the GRUU is known in
advance (possibly by Carol having a long-lived subscription to Bob's
UA).  If the GRUU is not known in advance, then it may prove too onerous
to expect it to be typed in on Carol's UA, just to retrieve a parked
call.

</p>
<p>
Open issue:  Is subscribing to the AoR the best we can offer?

</p>
<p>
Using the 'orbit' parameter in conjunction with parking calls on User
Agents can lead to difficulties in ensuring that the 'orbit' parameter
is delivered to the User Agent.  Current thinking favours an approach based upon
<a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>.

</p>
<p>
Open issue: Once this has moved on a little, we can ensure it meets our needs.

</p>
<p>
If the 'orbit' parameter is not used, then Carol will eventually find
out about all the dialogs currently in progress at Bob's UA.
Distinguishing the parked call from other dialogs may prove challenging
(assuming that all calls marked as held is not acceptable).  There may
be an opportunity to reuse some BLISS-MLA work here, which permits
dialogs to be marked as 'exclusive', which indicates that other UAs
should not attempt to pick them up.

</p>
<p>
Open issue: How should a parked call be identified when parked on a UA
with other (potentially non-parked) dialogs in progress?  Does this
problem only exist when an orbit is not used?

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
User Agent Configuration</h3>

<p>
For Bob and Carol to be able to park and retrieve calls using a Park
Server, both need to be configured with the URI of the Park Server.  In
addition, Bob and Carol should be configured to understand whether or
not an orbit will be required for park and retrieve.  Finally, Bob also
needs to be configured to determine whether Bob should provide the orbit
or whether the orbit will be allocated by the Park Server.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>
The following individuals were part of the Call Park Design Team, and
have helped to shape this document:

</p>
<p>Francois Audet, Jason Fischl, Derek Macdonald, Shida Schubert, Sanjay Sinha,
Dale Worley and Theo Zourzouvillys.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>None.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>Open issue: presumably need to define the new uri-parameter 'orbit'.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sipping-service-examples">[I-D.ietf-sipping-service-examples]</a></td>
<td class="author-text">Johnston, A., Sparks, R., Cunningham, C., Donovan, S., and K. Summers, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-service-examples-15.txt">Session Initiation Protocol Service Examples</a>,&rdquo; draft-ietf-sipping-service-examples-15 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-service-examples-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4235">[RFC4235]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and R. Mahy, &ldquo;<a href="http://tools.ietf.org/html/rfc4235">An INVITE-Initiated Dialog Event Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4235, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4235.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4579">[RFC4579]</a></td>
<td class="author-text">Johnston, A. and O. Levin, &ldquo;<a href="http://tools.ietf.org/html/rfc4579">Session Initiation Protocol (SIP) Call Control - Conferencing for User Agents</a>,&rdquo; BCP&nbsp;119, RFC&nbsp;4579, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4579.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4244">[RFC4244]</a></td>
<td class="author-text">Barnes, M., &ldquo;<a href="http://tools.ietf.org/html/rfc4244">An Extension to the Session Initiation Protocol (SIP) for Request History Information</a>,&rdquo; RFC&nbsp;4244, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4244.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Procter</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">VoIP.co.uk</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Commerce House</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Telford Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bicester, Oxfordshire  OX26 4LD</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UK</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:michael@voip.co.uk">michael@voip.co.uk</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://voip.co.uk">http://voip.co.uk</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
