<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Session Matching Update for the Message Session Relay Protocol (MSRP) </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability statement">
<link href="#rfc.section.4" rel="Chapter" title="4 Sessmatch mechanism">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 General">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Session matching">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Usage of 'sessmatch' option-tag">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Uniqueness of the session-id">
<link href="#rfc.section.5" rel="Chapter" title="5 ALG assumptions">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 General">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 MSRP awareness">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 TCP connection reuse">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 SDP integrity">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 TLS">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 MSRP URI as shared secret">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Man in the middle">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 TLS">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 IANA Registration of the sessmatch Option Tag">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.section.9" rel="Chapter" title="9 Change Log">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines an extension, sessmatch, for the Message Session Relay Protocol (MSRP) session matching procedure of MSRP entities. The extension extends the applicability of MSRP communication to network scenarios where Application Layer Gateway (ALG) functions modify the Session Description Protocol (SDP) MSRP address information. The document also defines a Session Initiation Protocol (SIP) option-tag, sessmatch, that is used by MSRP entities to indicate support of the sessmatch extension.  " />
  <meta name="description" content="This document defines an extension, sessmatch, for the Message Session Relay Protocol (MSRP) session matching procedure of MSRP entities. The extension extends the applicability of MSRP communication to network scenarios where Application Layer Gateway (ALG) functions modify the Session Description Protocol (SDP) MSRP address information. The document also defines a Session Initiation Protocol (SIP) option-tag, sessmatch, that is used by MSRP entities to indicate support of the sessmatch extension.  " />
  <meta name="keywords" content="MSRP, ALG, IBCF, SBC, relay" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">SIMPLE Working Group</td>
<td class="right">C.H. Holmberg</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">S.B. Blau</td>
</tr>
<tr>
<td class="left">Expires: November 13, 2011</td>
<td class="right">Ericsson AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">May 12, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Session Matching Update for the Message Session Relay Protocol (MSRP) <br />
  <span class="filename">draft-ietf-simple-msrp-sessmatch-11.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines an extension, sessmatch, for the Message Session Relay Protocol (MSRP) session matching procedure of MSRP entities. The extension extends the applicability of MSRP communication to network scenarios where Application Layer Gateway (ALG) functions modify the Session Description Protocol (SDP) MSRP address information. The document also defines a Session Initiation Protocol (SIP) option-tag, sessmatch, that is used by MSRP entities to indicate support of the sessmatch extension.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted to IETF in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 13, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability statement</a>
</li>
<li>4.   <a href="#rfc.section.4">Sessmatch mechanism</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">General</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Session matching</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Usage of 'sessmatch' option-tag</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Uniqueness of the session-id</a>
</li>
<li>5.   <a href="#rfc.section.5">ALG assumptions</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">General</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">MSRP awareness</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">TCP connection reuse</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">SDP integrity</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">TLS</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">MSRP URI as shared secret</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Man in the middle</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">TLS</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">IANA Registration of the sessmatch Option Tag</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.section.9">Change Log</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The Message Session Relay Protocol (MSRP) <a href="#RFC4975">[RFC4975]</a> is designed to use MSRP relays <a href="#RFC4976">[RFC4976]</a> as a means for Network Address Translation (NAT) traversal and policy enforcement.  </p>
<p id="rfc.section.1.p.2">However, many Session Initiation Protocol (SIP) <a href="#RFC3261">[RFC3261]</a> networks, in which MSRP usage is emerging, also contain SIP Application Layer Gateways (ALGs), which anchor and controls media, perform tasks such as NAT traversal, performance monitoring, lawful intercept, address domain bridging, interconnect Service Layer Agreement (SLA) policy enforcement, etc. An example is the Interconnect Border Control Function (IBCF) <a href="#3GPP.23.228">[3GPP.23.228]</a> defined by the 3rd Generation Partnership Project (3GPP), which controls a media relay that handles all types of SIP session media (voice, video, MSRP, etc).  </p>
<p id="rfc.section.1.p.3">MSRP, as defined in RFC 4975 <a href="#RFC4975">[RFC4975]</a> and RFC 4976 <a href="#RFC4976">[RFC4976]</a>, does not work when an MSRP entities communicate with such ALGs, unless the ALGs implement MSRP Back-To-Back User Agent (B2BUA) functionality. The reason is that entities use the MSRP URI comparison <a href="#RFC4975">[RFC4975]</a> procedure in order to match an MSRP message to an MSRP session. That requires consistency between the address information in the MSRP messages and the address information carried in the SDP a=path attribute. The matching will fail if ALGs modify the address information of the SDP a=path attribute, but do not implement MSRP B2BUA functionality and perform the corresponding modification in the associated MSRP messages. However, few ALGs implement MSRP B2BUA functionality, due to complexity and poor scalability.  </p>
<p id="rfc.section.1.p.4">This specification defines an MSRP extension, sessmatch, that allows MSRP entities to communicate with ALGs that do not implement MSRP B2BUA functionality. MSRP entities that support the sessmatch extension use a different mechanism for matching an MSRP message with an MSRP session, called session matching.  Instead of using the MSRP URI comparison procedure defined in RFC 4975, only the MSRP session-id part is used for the session matching.  </p>
<p id="rfc.section.1.p.5">The sessmatch extension is backward compatible. In the absence of ALGs, MSRP entities that do not implement the sessmatch extension can interoperate with entities that do implement it. The reason is that the matching of an MSRP message to an ongoing session will not fail. MSRP entities that do not implement the sessmatch extension, and communicate with ALGs that do not implement MSRP B2BUA functionality, can normally not establish MSRP sessions, since the session matching will fail in case the address information of the SDP a=path attribute has been modified by the ALGs.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Conventions</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">In this specification the terminology "fingerprint based TLS authentication" and "name based TLS authentication" are used to refer to the two cases where: </p>
<p id="rfc.section.2.p.3">1.	An endpoint use a self-signed TLS certificate and sends a certificate fingerprint in SDP (fingerprint based TLS authentication).  </p>
<p id="rfc.section.2.p.4">2.	An endpoint use a certificate from a well known certificate authority and the other endpoint matches the hostname in the received TLS communication SubjectAltName parameter towards the hostname received in the MSRP URI in SDP (name based TLS authentication).  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Applicability statement</h1>
<p id="rfc.section.3.p.1">This document defines an MSRP extension, sessmatch. Support of the extension is optional. MSRP entities can implement the extension in order to allow MSRP communication in networks where ALGs that might modify the address information of the SDP a=path attribute, but do not implement MSRP B2BUA functionality, are present.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Sessmatch mechanism</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> General</h1>
<p id="rfc.section.4.1.p.1">This section defines how an MSRP entity that supports the sessmatch extension performs session matching, i.e. matches an incoming MSRP message to an MSRP session.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Session matching</h1>
<p id="rfc.section.4.2.p.1">The difference between the session matching mechanism in RFC 4975, and the one defined in this specification for the sessmatch extension, is that while the mechanism in RFC 4975 uses the MSRP URI comparison rules for session matching, the sessmatch extension only uses the session-id part of the MSRP URI.  </p>
<p id="rfc.section.4.2.p.2">When an MSRP entity that receives the first MSRP request for an MSRP session, the To-Path header field of the request should contain a URI with a session-id part that was provided in the SDP associated with the MSRP session. The entity that accepted the connection looks up the session-id part of the MSRP URI in the received requests, in order to determine which session it matches. The session-id part is compared as case sensitive. If a match exists, the entity MUST assume that the host that formed the connection is the host to which this URI was given. If no match exists, the entity MUST reject the request with a 481 response. The entity MUST also check to make sure the session is not already in use on another connection. If the session is already in use, it MUST reject the request with a 506 response.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Usage of 'sessmatch' option-tag</h1>
<p id="rfc.section.4.3.p.1">This section describes how an MSRP entity that supports the sessmatch extension uses the sessmatch option-tag.  </p>
<p id="rfc.section.4.3.p.2">An MSRP entity that supports the sessmatch extension, and is not located behind an MSRP relay, MUST insert the 'sessmatch' option-tag in the Supported header field of the initial INVITE request for a session that contains MSRP media. If at least one reliably sent successful response to the intial INVITE request contains the 'sessmatch' option-tag in the Supported header field of the response, the MSRP entity MUST use the session matching procedures defined in this specification during the session. Otherwise, if the MSRP entity wants the MSRP session to proceed, the MSRP entity MUST use the procedures defined in RFC 4975.  </p>
<p id="rfc.section.4.3.p.3">If an MSRP entity that supports the sessmatch extension receives an initial INVITE request that contains the 'sessmatch' option-tag in the Supported or Require header field of the request, and if it is not located behind an MSRP relay, it MUST insert the 'sessmatch' option-tag in the Supported header field of at least one reliably sent successful response to the intial INVITE request, and it MUST use the session matching procedures defined in this specification during the session.  Otherwise, if the MSRP entity wants the MSRP session to proceed, the MSRP entity MUST NOT insert the 'sessmatch' option-tag in a successful response to the initial INVITE request, and it MUST use the session matching procedures defined in RFC 4975.  </p>
<p id="rfc.section.4.3.p.4">In addition to inserting the 'sessmatch' option-tag in the Supported header field of the INVITE request, if an entity is performing MSRP related procedures that require the remote MSRP entity to support the sessmatch extension in order to enable MSRP media, it MUST also insert the 'sessmatch' option-tag in the Require header field.  </p>
<p id="rfc.section.4.3.p.5">NOTE: An example of a scenarios where an entity needs to insert the 'sessmatch' option-tag in the Require header field, is when it acts as an intermediary entity that modifies the SDP a=path attribute address information, in order to anchor and forward MSRP traffic, but will not be able to perform the corresponding address information changes in the associated MSRP messages. The actions taken by such entity in case the remote MSRP entity does not support the sessmatch extension, and therfore sends a 420 (Not Supported) response to the INVITE request, is outside the scope of this specification.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#sec-security-unique" id="sec-security-unique">Uniqueness of the session-id</a>
</h1>
<p id="rfc.section.4.4.p.1">The session-id used to perform session matching is retrieved from the To-Path header field MSRP URI of a received MSRP message. The session-id has been generated by the receiving MSRP entity itself. The MSRP entity MUST ensure that the session-id is unique among the other session-ids generated by that MSRP entity.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> ALG assumptions</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> General</h1>
<p id="rfc.section.5.1.p.1">This document does not specify ALG behavior. However, as the main reason behind the sessmatch extension is to allow MSRP entities to communicate in networks where ALGs are present, this document makes certain assumptions regarding to how such ALGs behave.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> MSRP awareness</h1>
<p id="rfc.section.5.2.p.1">This document assumes that an ALG is MSRP aware, meaning that it modifies the address information in the SDP a=path attribute in order to anchor the MSRP communication, but that the ALG does not perform the associated modification in the To-Path and From-Path header fields of MSRP messages.  </p>
<p id="rfc.section.5.2.p.2">NOTE: Other types of media traffic are normally routed using the SDP c/m-lines, which an ALG can modify in order to anchor such media communication.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> TCP connection reuse</h1>
<p id="rfc.section.5.3.p.1">When the sessmatch extension is used, ALGs are not required to parse and modify the MSRP payload.  An ALG that does not parse the MSRP payload might not enable re-usage of TCP connections for multiple MSRP sessions. Instead, in order to associate an MSRP message with a specific session, the ALG often assigns a unique local address:port combination for each MSRP session.  </p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> SDP integrity</h1>
<p id="rfc.section.5.4.p.1">This document assumes that an ALG, in order to anchor the MSRP communication, modifies the address and port information in the SDP a=path attribute, and therefor can not be deployed in environments that require SIP identity based peer-to-peer SDP protection.  </p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> TLS</h1>
<p id="rfc.section.5.5.p.1">This document considers two approaches how an ALG handles TLS protected MSRP connections.  </p>
<p id="rfc.section.5.5.p.2">In the first approach, the ALG relays the MSRP media packages at the transport layer. The TLS handshake and resulting security association (SA) are established peer-to-peer between the MSRP endpoints. The ALG will see encrypted MSRP media pacakges, but is unable to inspect the cleartext content.  </p>
<p id="rfc.section.5.5.p.3">In the second approach, the ALG acts as a TLS B2BUA, meaning that separate SAs are established between the ALG and each MSRP endpoint. The ALG decrypts MSRP media packages received from one MSRP endpoint, and then re-encrypts them before sending them toward the other MSRP endpoint. With this approach, the ALG can inspect and modify the cleartext content.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-security" id="sec-security">Security Considerations</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#sec-security-secret" id="sec-security-secret">MSRP URI as shared secret</a>
</h1>
<p id="rfc.section.6.1.p.1">An MSRP entity that does not support the sessmatch extension uses the complete MSRP URI (scheme, authority, transport, session-id) as a shared secret in order to determine that an incoming transport connection originates from the intended endpoint device.  The shared secret needs to be hard to guess, but in reality only the session-id part with it's minimum 80 bit of randomness is hard to guess. Using only the MSRP URI session-id part as shared secret is therefore roughly as good as using the complete URI.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#sec-security-mitm" id="sec-security-mitm">Man in the middle</a>
</h1>
<p id="rfc.section.6.2.p.1">The sessmatch extension makes it easier for a man in the middle (MiTM) to transparently insert itself in the communication between MSRP endpoints in order to monitor or record unproteted MSRP communication. It does not however enable a MiTM to monitor TLS protected MSRP or to in any significant way modify the MSRP communication content.  That would require the MiTM to terminate the TCP/MSRP or TCP/TLS/MSRP connection in both directions, eventhough it would not need to allign the address information in the TCP/IP header of the media packets with the modification in the associated SDP a=path attribute.  </p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#sec-security-tls" id="sec-security-tls">TLS</a>
</h1>
<p id="rfc.section.6.3.p.1">If an ALG relays TLS connections, MSRP endpoints will not be able to use name based authentication nor fingerprint based authentication for TLS.  </p>
<p id="rfc.section.6.3.p.2">With name based authentication the problem is that each MSRP endpoint would present a certificate associated to its the hostname, which would match the authority part of the MSRP URI inserted in the SDP a=path attribute of the offer or answer. However, when the ALG modifies the MSRP URI in the SDP a=path attribute, the resulting authority part will no long match, and the TLS handshake will fail.  </p>
<p id="rfc.section.6.3.p.3">With fingerprint based authentication the problem is instead that the "SIP Identity" based integrity protection of SDP will break.  </p>
<p id="rfc.section.6.3.p.4">If an ALG acts as a TLS B2BUA, MSRP endpoints will be able to use both name based and fingerprint based authentication for TLS, as the ALG acts as a TLS endpoint. As the ALG acts as a TLS endpoints, MSRP endpoint might be given an incorrect impression that there is an end-to-end SA between the MSRP endpoints.  </p>
<p id="rfc.section.6.3.p.5">Considering the issues above, in order for MSRP endpoints to be able to authenticate TLS in a secure manner in a network where ALGs are present, an MSRP endpoint supporting the sessmatch extension SHOULD, in addition to the authentication mechanisms described in RFC 4975, support an authentication mechanism that does not rely on the a=path attribute value being transported unchanged peer-to-peer. It is RECOMMENDED that an MSRP endpoint supporting the sessmatch extension supports one of the following authentication mechanisms: </p>
<p id="rfc.section.6.3.p.6">1) TLS certificates together with support of interacting with a Certificate Management Service [ref to draft-ietf-sip-certs], to which it publishes the public version of its own self-signed certificate and from which it fetches on need the public certificates of other endpoints; or </p>
<p id="rfc.section.6.3.p.7">2) TLS-PSK managed e.g by MIKEY-TICKET based Key Management and Key Management Service <a href="#RFC6043">[RFC6043]</a>.  </p>
<p id="rfc.section.6.3.p.8">An MSRP endpoint that supports the sessmatch extension and one of the mechanisms above SHALL, when it creates an SDP offer for MSRPS, in addition to including the SDP attributes associated with the TLS authentication mechanisms described in RFC 4975, include the SDP attributes associated with the supported authentication mechanism above. If both MSRP endpoints support the same authentication mechanism based on pre-shared secrets, that mechanism SHALL be used, rather than a mechanism defined in RFC 4975.  </p>
<p id="rfc.section.6.3.p.9">NOTE: 3GPP has specified usage of the MIKEY-TICKET based Key Management and Key Management Service authentication mechanism for the IP Multimedia Subsystem (IMS).  </p>
<p id="rfc.section.6.3.p.10">If MSRP endpoints supporting sessmatch do not support a common TLS authentication based on a pre-shared secret, and neither MSRP endpoint is located behind an MSRP relay, they SHALL either (based on local policy or configuration): </p>
<p id="rfc.section.6.3.p.11">1) Use a TLS authenctication mechanism defined in RFC 4975, which will succeed if there are no ALGs in the MSRP path; or </p>
<p id="rfc.section.6.3.p.12">2) When support of the sessmatch extension is indicated in a request or response received from the other MSRP endpoint, use fingerprint based authentication without performing SIP Identity based integrity check, and thus trust the network entities in the signaling path.  </p>
<p id="rfc.section.6.3.p.13">NOTE: The second alternative is needed, in networks where ALGs are present, if the user whishes to establish a TLS based communication even if one of the MSRP endpoint, or the network, does not support a common TLS authentication mechanism based on a pre-shared secret. As defined in RFC 4975, if TLS autentication fails, users need to be able to decide whether to try to establish an MSRP connection without TLS protection.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<p id="rfc.section.7.p.1">This section registers a new SIP option-tag, according to the procedures of RFC 3261.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> IANA Registration of the sessmatch Option Tag</h1>
<p id="rfc.section.7.1.p.1">This section registers a new SIP option tag, sessmatch. The required information for this registration, as specified in RFC 3261, is: </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#sec-acks" id="sec-acks">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">Thanks to Ben Campbell, Remi Denis-Courmont, Nancy Greene, Hadriel Kaplan, Adam Roach, Robert Sparks, Salvatore Loreto, Shida Schubert, Ted Hardie and Richard L Barnes for their guidance and input in order to produce this document.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Change Log</h1>
<p id="rfc.section.9.p.1">[RFC EDITOR NOTE: Please remove this section when publishing]</p>
<p id="rfc.section.9.p.2">Changes from draft-ietf-simple-msrp-sessmatch-10 </p>

<ul><li>Sessmatch option-tag added, based on WG discussions and concensus.</li></ul>

<p> </p>
<p id="rfc.section.9.p.3">Changes from draft-ietf-simple-msrp-sessmatch-08 </p>

<ul><li>OPEN ISSUE regarding the need for a sessmatch option-tag removed.</li></ul>

<p> </p>
<p id="rfc.section.9.p.4">Changes from draft-ietf-simple-msrp-sessmatch-07 </p>

<ul>
<li>Sessmatch defined as an MSRP extension, rather than MSRP update</li>
<li>Additional security considerations text added</li>
</ul>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4975">[RFC4975]</b></td>
<td class="top">
<a>Campbell, B.</a>, <a>Mahy, R.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>", RFC 4975, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4976">[RFC4976]</b></td>
<td class="top">
<a>Jennings, C.</a>, <a>Mahy, R.</a> and <a>A.B. Roach</a>, "<a href="http://tools.ietf.org/html/rfc4976">Relay Extensions for the Message Sessions Relay Protocol (MSRP)</a>", RFC 4976, September 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC6043">[RFC6043]</b></td>
<td class="top">
<a>Mattsson, J.</a> and <a>T. Tian</a>, "<a href="http://tools.ietf.org/html/rfc6043">MIKEY-TICKET: Ticket-Based Modes of Key Distribution in Multimedia Internet KEYing (MIKEY)</a>", RFC 6043, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="3GPP.23.228">[3GPP.23.228]</b></td>
<td class="top">
<a>3GPP</a>, "<a>IP Multimedia Subsystem (IMS); Stage 2</a>", 3GPP TS 23.228 10.6.0, September 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Christer Holmberg</span> 
	  <span class="n hidden">
		<span class="family-name">Holmberg</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Hirsalantie 11</span>

	  <span class="vcardline">
		<span class="locality">Jorvas</span>,  
		<span class="region"></span>
		<span class="code">02420</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:christer.holmberg@ericsson.com">christer.holmberg@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Staffan Blau</span> 
	  <span class="n hidden">
		<span class="family-name">Blau</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson AB</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">12637</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:staffan.blau@ericsson.com">staffan.blau@ericsson.com</a></span>

  </address>
</div>

</body>
</html>