<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>HTTP State Management Mechanism</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="HTTP State Management Mechanism">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">httpstate</td><td class="header">A. Barth</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">U.C. Berkeley</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2965'>2965</a> (if&nbsp;approved)</td><td class="header">December 20, 2010</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: June 23, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />HTTP State Management Mechanism<br />draft-ietf-httpstate-cookie-20</h1>

<h3>Abstract</h3>

<p>This document defines the HTTP Cookie and Set-Cookie header fields.
      These header fields can be used by HTTP servers to store state (called
      cookies) at HTTP user agents, letting the servers maintain a stateful
      session over the mostly stateless HTTP protocol. Although cookies have
      many historical infelicities that degrade their security and privacy, the
      Cookie and Set-Cookie header fields are widely used on the Internet.
</p>
<h3>Editorial Note (To be removed by RFC Editor)</h3>

<p>If you have suggestions for improving this document, please send
      email to <a href='mailto:http-state@ietf.org'>mailto:http-state@ietf.org</a>. Suggestions with
      test cases are especially appreciated.  Further Working Group information
      is available from <a href='https://tools.ietf.org/wg/httpstate/'>https://tools.ietf.org/wg/httpstate/</a>.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on June 23, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#conformance-criteria">2.1.</a>&nbsp;
Conformance Criteria<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#syntax-notation">2.2.</a>&nbsp;
Syntax Notation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#terminology">2.3.</a>&nbsp;
Terminology<br />
<a href="#overview">3.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">3.1.</a>&nbsp;
Examples<br />
<a href="#sane-profile">4.</a>&nbsp;
Server Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-set-cookie">4.1.</a>&nbsp;
Set-Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-set-cookie-syntax">4.1.1.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-set-cookie-semantics">4.1.2.</a>&nbsp;
Semantics (Non-Normative)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-cookie">4.2.</a>&nbsp;
Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-cookie-syntax">4.2.1.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sane-cookie-semantics">4.2.2.</a>&nbsp;
Semantics<br />
<a href="#ua-requirements">5.</a>&nbsp;
User Agent Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#algorithms">5.1.</a>&nbsp;
Subcomponent Algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cookie-date">5.1.1.</a>&nbsp;
Dates<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cookie-domain-canonicalize">5.1.2.</a>&nbsp;
Canonicalized host names<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cookie-domain">5.1.3.</a>&nbsp;
Domain matching<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cookie-path">5.1.4.</a>&nbsp;
Paths and path-match<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#set-cookie">5.2.</a>&nbsp;
The Set-Cookie Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#expires-attribute">5.2.1.</a>&nbsp;
The Expires Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#max-age-attribute">5.2.2.</a>&nbsp;
The Max-Age Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#domain-attribute">5.2.3.</a>&nbsp;
The Domain Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#path-attribute">5.2.4.</a>&nbsp;
The Path Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#secure-attribute">5.2.5.</a>&nbsp;
The Secure Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#httponly-attribute">5.2.6.</a>&nbsp;
The HttpOnly Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#storage-model">5.3.</a>&nbsp;
Storage Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cookie">5.4.</a>&nbsp;
The Cookie Header<br />
<a href="#implementation-considerations">6.</a>&nbsp;
Implementation Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#implementation-limits">6.1.</a>&nbsp;
Limits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#implementation-apis">6.2.</a>&nbsp;
Application Programming Interfaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#idna-migration">6.3.</a>&nbsp;
IDNA dependency and migration<br />
<a href="#privacy-considerations">7.</a>&nbsp;
Privacy Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#third-party-cookies">7.1.</a>&nbsp;
Third-Party Cookies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#user-controls">7.2.</a>&nbsp;
User Controls<br />
<a href="#security-considerations">8.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#section-overview">8.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ambient-authority">8.2.</a>&nbsp;
Ambient Authority<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#clear-text">8.3.</a>&nbsp;
Clear Text<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#session-identifiers">8.4.</a>&nbsp;
Session Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#weak-confidentiality">8.5.</a>&nbsp;
Weak Confidentiality<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#weak-integrity">8.6.</a>&nbsp;
Weak Integrity<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#reliance-on-dns">8.7.</a>&nbsp;
Reliance on DNS<br />
<a href="#iana-considerations">9.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">9.1.</a>&nbsp;
Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">9.2.</a>&nbsp;
Set-Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">9.3.</a>&nbsp;
Cookie2<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">9.4.</a>&nbsp;
Set-Cookie2<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#anchor8">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document defines the HTTP Cookie and Set-Cookie header fields.
      Using the Set-Cookie header field, an HTTP server can pass name/value
      pairs and associated metadata (called cookies) to a user agent.  When the
      user agent makes subsequent requests to the server, the user agent uses
      the metadata and other information to determine whether to return the
      name/value pairs in the Cookie header.
</p>
<p>Although simple on their surface, cookies have a number of
      complexities. For example, the server indicates a scope for each cookie
      when sending it to the user agent. The scope indicates the maximum
      amount of time the user agent should return the cookie, the servers to
      which the user agent should return the cookie, and the URI schemes for
      which the cookie is applicable.
</p>
<p>For historical reasons, cookies contain a number of security and
      privacy infelicities. For example, a server can indicate that a given
      cookie is intended for "secure" connections, but the Secure attribute
      does not provide integrity in the presence of an active network
      attacker. Similarly, cookies for a given host are shared across all the
      ports on that host, even though the usual "same-origin policy" used by
      web browsers isolates content retrieved via different ports.
</p>
<p>Prior to this document, there were at least three descriptions of
      cookies: the so-called "Netscape cookie specification" <a class='info' href='#Netscape'>[Netscape]<span> (</span><span class='info'>Netscape Communications Corp., &ldquo;Persistent Client State -- HTTP Cookies,&rdquo; 1999.</span><span>)</span></a>, RFC 2109 <a class='info' href='#RFC2109'>[RFC2109]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; February&nbsp;1997.</span><span>)</span></a>, and RFC 2965
      <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>. However, none of these documents describe how
      the Cookie and Set-Cookie headers are actually used on the Internet (see
      <a class='info' href='#Kri2001'>[Kri2001]<span> (</span><span class='info'>Kristol, D., &ldquo;HTTP Cookies: Standards, Privacy, and Politics,&rdquo; November&nbsp;2001.</span><span>)</span></a> for historical context).  This document
      specifies the syntax and semantics of these headers as they are actually
      used on the Internet.
</p>
<p>In particular, this document does not create new syntax or semantics
      beyond those in use today, but neither does it recommend all of the
      syntactic and semantic variations in use today.  The recommendations in
      this document represent a preferred subset of current behaviors.  Where
      some existing software differs from the recommended protocol in
      significant ways, the document contains a note explaining the
      difference.
</p>
<p>Therefore, in relation to previous IETF specifications of HTTP state
      management mechanisms, this document requests the following actions:
      </p>
<ol class="text">
<li>Change the status of <a class='info' href='#RFC2109'>[RFC2109]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; February&nbsp;1997.</span><span>)</span></a> to Historic (it has
        already been obsoleted by <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>).
</li>
<li>Change the status of <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a> to Historic.
</li>
<li>Indicate that <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a> is obsoleted by this
        document.
</li>
</ol><p>
      In particular, in moving RFC 2965 to Historic and obsoleting it, this
      document deprecates the use of the Cookie2 and Set-Cookie2 header
      fields.
</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions</h3>

<a name="conformance-criteria"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Conformance Criteria</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>Requirements phrased in the imperative as part of algorithms (such
        as "strip any leading space characters" or "return false and abort
        these steps") are to be interpreted with the meaning of the key word
        ("MUST", "SHOULD", "MAY", etc) used in introducing the algorithm.
</p>
<p>Conformance requirements phrased as algorithms or specific steps can
        be implemented in any manner, so long as the end result is equivalent.
        In particular, the algorithms defined in this specification are
        intended to be easy to understand and are not intended to be
        performant.
</p>
<a name="syntax-notation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Syntax Notation</h3>

<p>This specification uses the Augmented Backus-Naur Form (ABNF)
        notation of <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The following core rules are included by reference, as defined in
        <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>, Appendix B.1: ALPHA (letters), CR (carriage
        return), CRLF (CR LF), CTL (controls), DIGIT (decimal 0-9), DQUOTE
        (double quote), HEXDIG (hexadecimal 0-9/A-F/a-f), LF (line feed), NUL
        (null octet), OCTET (any 8-bit sequence of data except NUL), SP (space),
        HTAB (horizontal tab), CHAR (any US-ASCII character), VCHAR (any
        visible US-ASCII character), and WSP (whitespace).
</p>
<p>The OWS (optional whitespace) rule is used where zero or more
        linear whitespace characters MAY appear:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
<dfn>OWS</dfn>            = <span class='rep'>*</span>( [ <cite class='id'>obs-fold</cite> ] <cite class='key'>WSP</cite> )
                 <em>; "optional" whitespace</em>
<dfn>obs-fold</dfn>       = <cite class='key'>CRLF</cite>
</pre></div><p>

        OWS SHOULD either not be produced or be produced as a single SP
        character.
</p>
<a name="terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Terminology</h3>

<p>The terms user agent, client, server, proxy, and origin server have
        the same meaning as in the HTTP/1.1 specification (<a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, Section 1.3).
</p>
<p>The request-host is the name of the host, as known by the user
        agent, to which the user agent is sending an HTTP request or is
        receiving an HTTP response from (i.e., the name of the host to which it
        sent the corresponding HTTP request).
</p>
<p>The term request-uri is defined in Section 5.1.2 of <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<p>Two sequences of octets are said to case-insensitively match each
        other if and only if they are equivalent under the i;ascii-casemap
        collation defined in <a class='info' href='#RFC4790'>[RFC4790]<span> (</span><span class='info'>Newman, C., Duerst, M., and A. Gulbrandsen, &ldquo;Internet Application Protocol Collation Registry,&rdquo; March&nbsp;2007.</span><span>)</span></a>.
</p>
<p>The term string means a sequence of non-NUL octets.
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>This section outlines a way for an origin server to send state
      information to a user agent and for the user agent to return the state
      information to the origin server.
</p>
<p>To store state, the origin server includes a Set-Cookie header in an
      HTTP response. In subsequent requests, the user agent returns a Cookie
      request header to the origin server. The Cookie header contains
      cookies the user agent received in previous Set-Cookie headers. The
      origin server is free to ignore the Cookie header or use its contents
      for an application-defined purpose.
</p>
<p>Origin servers can send a Set-Cookie response header with any
      response. An origin server can include multiple Set-Cookie header fields
      in a single response.  The presence of a Cookie or a Set-Cookie header
      field does not preclude HTTP caches from storing and reusing a
      response.
</p>
<p>Origin servers SHOULD NOT fold multiple Set-Cookie header fields into
      a single header field.  The usual mechanism for folding HTTP headers
      fields (i.e., as defined in <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>) might change the
      semantics of the Set-Cookie header field because the %x2C (",") character
      is used by Set-Cookie in a way that conflicts with such folding.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Examples</h3>

<p>Using the Set-Cookie header, a server can send the user agent a
        short string in an HTTP response that the user agent will return in
        future HTTP requests that are within the scope of the cookie. For
        example, the server can send the user agent a "session identifier"
        named SID with the value 31d4d96e407aad42. The user agent then returns
        the session identifier in subsequent requests.
</p>
<p>
== Server -> User Agent ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Set-Cookie: SID=31d4d96e407aad42
</pre></div>
<p>
== User Agent -> Server ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Cookie: SID=31d4d96e407aad42
</pre></div>
<p>The server can alter the default scope
        of the cookie using the Path and Domain attributes. For example, the
        server can instruct the user agent to return the cookie to every path
        and every subdomain of example.com.
</p>
<p>
== Server -> User Agent ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Set-Cookie: SID=31d4d96e407aad42; Path=/; Domain=example.com
</pre></div>
<p>
== User Agent -> Server ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Cookie: SID=31d4d96e407aad42
</pre></div>
<p>As shown in the next example, the server can store multiple cookies
        at the user agent. For example, the server can store a session
        identifier as well as the user's preferred language by returning two
        Set-Cookie header fields.  Notice that the server uses the Secure and
        HttpOnly attributes to provide additional security protections for the
        more-sensitive session identifier (see <a class='info' href='#sane-set-cookie-semantics'>Section&nbsp;4.1.2<span> (</span><span class='info'>Semantics (Non-Normative)</span><span>)</span></a>.)
</p>
<p>
== Server -> User Agent ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Set-Cookie: SID=31d4d96e407aad42; Path=/; Secure; HttpOnly
Set-Cookie: lang=en-US; Path=/; Domain=example.com
</pre></div>
<p>
== User Agent -> Server ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Cookie: SID=31d4d96e407aad42; lang=en-US
</pre></div>
<p>Notice that the Cookie header above contains two cookies, one named
        SID and one named lang.  If the server wishes the user agent to persist
        the cookie over multiple "sessions" (e.g., user agent restarts), the
        server can specify an expiration date in the Expires attribute. Note
        that the user agent might delete the cookie before the expiration date
        if the user agent's cookie store exceeds its quota or if the user
        manually deletes the server's cookie.
</p>
<p>
== Server -> User Agent ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Set-Cookie: lang=en-US; Expires=Wed, 09 Jun 2021 10:18:14 GMT
</pre></div>
<p>
== User Agent -> Server ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Cookie: SID=31d4d96e407aad42; lang=en-US
</pre></div>
<p>Finally, to remove a cookie, the server returns a Set-Cookie header
        with an expiration date in the past. The server will be successful in
        removing the cookie only if the Path and the Domain attribute in the
        Set-Cookie header match the values used when the cookie was
        created.
</p>
<p>
== Server -> User Agent ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Set-Cookie: lang=; Expires=Sun, 06 Nov 1994 08:49:37 GMT
</pre></div>
<p>
== User Agent -> Server ==
          
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Cookie: SID=31d4d96e407aad42
</pre></div>
<a name="sane-profile"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Server Requirements</h3>

<p>This section describes the syntax and semantics of a well-behaved
      profile of the Cookie and Set-Cookie headers. Servers SHOULD limit
      themselves to the profile described in this section, both to maximize
      interoperability with existing user agents and because a future version
      of the Cookie or Set-Cookie headers could remove support for some of the
      esoteric semantics described in <a class='info' href='#ua-requirements'>Section&nbsp;5<span> (</span><span class='info'>User Agent Requirements</span><span>)</span></a>. User
      agents, however, MUST implement the requirements in <a class='info' href='#ua-requirements'>Section&nbsp;5<span> (</span><span class='info'>User Agent Requirements</span><span>)</span></a> to ensure interoperability with servers
      making use of the full semantics.
</p>
<a name="sane-set-cookie"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Set-Cookie</h3>

<p>The Set-Cookie HTTP response header is used to send cookies from the
        server to the user agent.
</p>
<a name="sane-set-cookie-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Syntax</h3>

<p>Informally, the Set-Cookie response header contains the header
          name "Set-Cookie" followed by a ":" and a cookie.  Each cookie
          begins with a name-value pair, followed by zero or more
          attribute-value pairs.  Servers SHOULD NOT send Set-Cookie headers
          that fail to conform to the following grammar:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

<dfn>set-cookie-header</dfn> = "<span class='str'>Set-Cookie:</span>" <cite class='key'>SP</cite> <cite class='id'>set-cookie-string</cite>
<dfn>set-cookie-string</dfn> = <cite class='id'>cookie-pair</cite> <span class='rep'>*</span>( "<span class='str'>;</span>" <cite class='key'>SP</cite> <cite class='id'>cookie-av</cite> )
<dfn>cookie-pair</dfn>       = <cite class='id'>cookie-name</cite> "<span class='str'>=</span>" <cite class='id'>cookie-value</cite>
<dfn>cookie-name</dfn>       = <cite class='id'>token</cite>
<dfn>cookie-value</dfn>      = <cite class='id'>token</cite>
<dfn>token</dfn>             = &lt;<span class='str'>token, defined in [RFC2616], Section 2.2</span>&gt;

<dfn>cookie-av</dfn>         = <cite class='id'>expires-av</cite> / <cite class='id'>max-age-av</cite> / <cite class='id'>domain-av</cite> /
                    <cite class='id'>path-av</cite> / <cite class='id'>secure-av</cite> / <cite class='id'>httponly-av</cite> /
                    <cite class='id'>extension-av</cite>
<dfn>expires-av</dfn>        = "<span class='str'>Expires=</span>" <cite class='id'>sane-cookie-date</cite>
<dfn>sane-cookie-date</dfn>  = &lt;<span class='str'>rfc1123-date, defined in [RFC2616], Section 3.3.1</span>&gt;
<dfn>max-age-av</dfn>        = "<span class='str'>Max-Age=</span>" <cite class='id'>non-zero-digit</cite> <span class='rep'>*</span><cite class='key'>DIGIT</cite>
                      <em>; In practice, both expires-av and max-age-av are limited</em>
                      <em>; to dates representable by the user agent.</em>
<dfn>non-zero-digit</dfn>    = <span class='val'>%x31-39</span>
                      <em>; digits 1 through 9</em>
<dfn>domain-av</dfn>         = "<span class='str'>Domain=</span>" <cite class='id'>domain-value</cite>
<dfn>domain-value</dfn>      = &lt;<span class='str'>subdomain</span>&gt;
                      <em>; defined in [RFC1034], Section 3.5, as</em>
                      <em>; enhanced by [RFC1123], Section 2.1</em>
<dfn>path-av</dfn>           = "<span class='str'>Path=</span>" <cite class='id'>path-value</cite>
<dfn>path-value</dfn>        = &lt;<span class='str'>any CHAR except CTLs or ";"</span>&gt;
<dfn>secure-av</dfn>         = "<span class='str'>Secure</span>"
<dfn>httponly-av</dfn>       = "<span class='str'>HttpOnly</span>"
<dfn>extension-av</dfn>      = &lt;<span class='str'>any CHAR except CTLs or ";"</span>&gt;

</pre></div>
<p>Note that some of the grammatical terms above reference documents
          that use different grammatical notations than this document (which
          uses ABNF from <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>).
</p>
<p>The semantics of the cookie-value are not defined by this
          document.
</p>
<p>To maximize compatibility with user agents, servers that wish to
          store arbitrary data in a cookie-value SHOULD encode that data, for
          example, using Base 16 <a class='info' href='#RFC4648'>[RFC4648]<span> (</span><span class='info'>Josefsson, S., &ldquo;The Base16, Base32, and Base64 Data Encodings,&rdquo; October&nbsp;2006.</span><span>)</span></a>.
</p>
<p>The portions of the set-cookie-string produced by the cookie-av
          term are known as attributes.  To maximize compatibility with user
          agents, servers SHOULD NOT produce two attributes with the same name
          in the same set-cookie-string.  (See <a class='info' href='#storage-model'>Section&nbsp;5.3<span> (</span><span class='info'>Storage Model</span><span>)</span></a>
          for how user agents handle this case.)
</p>
<p>Servers SHOULD NOT include more than one Set-Cookie header field
          in the same response with the same cookie-name.  (See <a class='info' href='#set-cookie'>Section&nbsp;5.2<span> (</span><span class='info'>The Set-Cookie Header</span><span>)</span></a> for how user agents handle this case.)
</p>
<p>If a server sends multiple responses containing Set-Cookie headers
          concurrently to the user agent (e.g., when communicating with the
          user agent over multiple sockets), these responses create a "race
          condition" that can lead to unpredictable behavior.
</p>
<p>NOTE: Some existing user agents differ on their interpretation of
          two-digit years. To avoid compatibility issues, servers SHOULD use
          the rfc1123-date format, which requires a four-digit year.
</p>
<p>NOTE: Some user agents represent dates using 32-bit UNIX time_t
          values.  Some of these user agents might contain bugs that cause them
          to process dates after the year 2038 incorrectly.
</p>
<a name="sane-set-cookie-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Semantics (Non-Normative)</h3>

<p>This section describes a simplified semantics of the Set-Cookie
          header. These semantics are detailed enough to be useful for
          understanding the most common uses of cookies by servers. The full
          semantics are described in <a class='info' href='#ua-requirements'>Section&nbsp;5<span> (</span><span class='info'>User Agent Requirements</span><span>)</span></a>.
</p>
<p>When the user agent receives a Set-Cookie header, the user agent
          stores the cookie together with its attributes. Subsequently, when
          the user agent makes an HTTP request, the user agent includes the
          applicable, non-expired cookies in the Cookie header.
</p>
<p>If the user agent receives a new cookie with the same cookie-name,
          domain-value, and path-value as a cookie that it has already stored,
          the existing cookie is evicted and replaced with the new cookie.
          Notice that servers can delete cookies by sending the user agent a
          new cookie with an Expires attribute with a value in the past.
</p>
<p>Unless the cookie's attributes indicate otherwise, the cookie is
          returned only to the origin server (and not, e.g., to any
          subdomains), and it expires at the end of the current session (as
          defined by the user agent). User agents ignore unrecognized cookie
          attributes (but not the entire cookie).
</p>
<a name="sane-expires"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.1"></a><h3>4.1.2.1.&nbsp;
The Expires Attribute</h3>

<p>The Expires attribute indicates the maximum lifetime of the
            cookie, represented as the date and time at which the cookie
            expires. The user agent is not required to retain the cookie
            until the specified date has passed. In fact, user agents often
            evict cookies due to memory pressure or privacy concerns.
</p>
<a name="sane-max-age"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.2"></a><h3>4.1.2.2.&nbsp;
The Max-Age Attribute</h3>

<p>The Max-Age attribute indicates the maximum lifetime of the
            cookie, represented as the number of seconds until the cookie
            expires. The user agent is not required to retain the cookie for
            the specified duration. In fact, user agents often evict
            cookies from due to memory pressure or privacy concerns.
            </p>
<blockquote class="text">
<p>NOTE: Some existing user agents do not support the Max-Age
              attribute. User agents that do not support the Max-Age attribute
              ignore the attribute.
</p>
</blockquote><p>
            
</p>
<p>If a cookie has both the Max-Age and the Expires attribute, the
            Max-Age attribute has precedence and controls the expiration date
            of the cookie.  If a cookie has neither the Max-Age nor the Expires
            attribute, the user agent will retain the cookie until "the current
            session is over" (as defined by the user agent).
</p>
<a name="sane-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.3"></a><h3>4.1.2.3.&nbsp;
The Domain Attribute</h3>

<p>The Domain attribute specifies those hosts to which the cookie
            will be sent. For example, if the value of the Domain attribute
            is "example.com", the user agent will include the cookie in
            the Cookie header when making HTTP requests to example.com,
            www.example.com, and www.corp.example.com. (Note that a leading
            %x2E ("."), if present, is ignored even though that character is
            not permitted, but a trailing %x2E ("."), if present, will cause
            the user agent to ignore the attribute.) If the server omits the
            Domain attribute, the user agent will return the cookie only to the
            origin server.
            </p>
<blockquote class="text">
<p>WARNING: Some existing user agents treat an absent Domain
              attribute as if the Domain attribute were present and contained
              the current host name. For example, if example.com returns a
              Set-Cookie header without a Domain attribute, these user agents
              will erroneously send the cookie to www.example.com as well.
</p>
</blockquote><p>
            
</p>
<p>The user agent will reject cookies unless the Domain attribute
            specifies a scope for the cookie that would include the origin
            server. For example, the user agent will accept a cookie with a
            Domain attribute of "example.com" or of "foo.example.com" from
            foo.example.com, but the user agent will not accept a cookie with
            a Domain attribute of "bar.example.com" or of
            "baz.foo.example.com".
</p>
<p>NOTE: For security reasons, many user agents are configured to
            reject Domain attributes that correspond to "public suffixes".  For
            example, some user agents will reject Domain attributes of "com" or
            "co.uk".  (See <a class='info' href='#storage-model'>Section&nbsp;5.3<span> (</span><span class='info'>Storage Model</span><span>)</span></a> for more
            information.)
</p>
<a name="sane-path"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.4"></a><h3>4.1.2.4.&nbsp;
The Path Attribute</h3>

<p>The scope of each cookie is limited to a set of paths,
            controlled by the Path attribute.  If the server omits the Path
            attribute, the user agent will use the "directory" of the
            request-uri's path component as the default value. (See <a class='info' href='#cookie-path'>Section&nbsp;5.1.4<span> (</span><span class='info'>Paths and path-match</span><span>)</span></a> for more details.)
</p>
<p>The user agent will include the cookie in an HTTP request only
            if the path portion of the request-uri matches (or is a
            subdirectory of) the cookie's Path attribute, where the %x2F
            ("/") character is interpreted as a directory separator.
</p>
<p>Although seemingly useful for isolating cookies between
            different paths within a given host, the Path attribute cannot
            be relied upon for security (see <a class='info' href='#security-considerations'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>).
</p>
<a name="sane-secure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.5"></a><h3>4.1.2.5.&nbsp;
The Secure Attribute</h3>

<p>The Secure attribute limits the scope of the cookie to "secure"
            channels (where "secure" is defined by the user agent). When a
            cookie has the Secure attribute, the user agent will include the
            cookie in an HTTP request only if the request is transmitted over a
            secure channel (typically HTTP over Transport Layer Security (TLS)
            <a class='info' href='#RFC2818'>[RFC2818]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a>).
</p>
<p>Although seemingly useful for protecting cookies from active
            network attackers, the Secure attribute protects only the cookie's
            confidentiality. An active network attacker can overwrite Secure
            cookies from an insecure channel, disrupting their integrity (see
            <a class='info' href='#weak-integrity'>Section&nbsp;8.6<span> (</span><span class='info'>Weak Integrity</span><span>)</span></a> for more details).
</p>
<a name="sane-httponly"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.6"></a><h3>4.1.2.6.&nbsp;
The HttpOnly Attribute</h3>

<p>The HttpOnly attribute limits the scope of the cookie to HTTP
            requests. In particular, the attribute instructs the user agent to
            omit the cookie when providing access to cookies via "non-HTTP"
            APIs (such as a web browser API that exposes cookies to
            scripts).
</p>
<p>Note that the HttpOnly attribute is independent of the Secure
            attribute: a cookie can have both the HttpOnly and the Secure
            attribute.
</p>
<a name="sane-cookie"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Cookie</h3>

<a name="sane-cookie-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Syntax</h3>

<p>The user agent sends stored cookies to the origin server in the
          Cookie header. If the server conforms to the requirements in <a class='info' href='#sane-set-cookie'>Section&nbsp;4.1<span> (</span><span class='info'>Set-Cookie</span><span>)</span></a> (and the user agent conforms to the
          requirements in <a class='info' href='#ua-requirements'>Section&nbsp;5<span> (</span><span class='info'>User Agent Requirements</span><span>)</span></a>), the user
          agent will send a Cookie header that conforms to the following
          grammar:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
<dfn>cookie-header</dfn> = "<span class='str'>Cookie:</span>" <cite class='id'>OWS</cite> <cite class='id'>cookie-string</cite> <cite class='id'>OWS</cite>
<dfn>cookie-string</dfn> = <cite class='id'>cookie-pair</cite> <span class='rep'>*</span>( "<span class='str'>;</span>" <cite class='key'>SP</cite> <cite class='id'>cookie-pair</cite> )
</pre></div>
<a name="sane-cookie-semantics"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Semantics</h3>

<p>Each cookie-pair represents a cookie stored by the user agent.
          The cookie-pair contains the cookie-name and cookie-value the user
          agent received in the Set-Cookie header.
</p>
<p>Notice that the cookie attributes are not returned. In
          particular, the server cannot determine from the Cookie header alone
          when a cookie will expire, for which hosts the cookie is valid,
          for which paths the cookie is valid, or whether the cookie was set
          with the Secure or HttpOnly attributes.
</p>
<p>The semantics of individual cookies in the Cookie header are not
          defined by this document. Servers are expected to imbue these cookies
          with application-specific semantics.
</p>
<p>Although cookies are serialized linearly in the Cookie header,
          servers SHOULD NOT rely upon the serialization order. In particular,
          if the Cookie header contains two cookies with the same name (e.g.,
          that were set with different Path or Domain attributes), servers
          SHOULD NOT rely upon the order in which these cookies appear in the
          header.
</p>
<a name="ua-requirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
User Agent Requirements</h3>

<p>For historical reasons, the full semantics of cookies (as presently
      deployed on the Internet) contain a number of exotic quirks. This section
      is intended to specify the Cookie and Set-Cookie headers in sufficient
      detail to allow a user agent implementing these requirements precisely to
      interoperate with existing servers.
</p>
<a name="algorithms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Subcomponent Algorithms</h3>

<p>This section defines some algorithms used by user agents to process
        specific subcomponents of the Cookie and Set-Cookie headers.
</p>
<a name="cookie-date"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Dates</h3>

<p>The user agent MUST use an algorithm equivalent to the following
          algorithm to parse a cookie-date. Note that the various boolean
          flags defined as a part of the algorithm (i.e., found-time,
          found-day-of-month, found-month, found-year) are initially "not set".
          </p>
<ol class="text">
<li>Using the grammar below, divide the cookie-date into
            date-tokens.
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre><span class='err'>
cookie-date     = *delimiter date-token-list *delimiter
date-token-list = date-token *( 1*delimiter date-token )
date-token      = 1*non-delimiter

delimiter       = %x09 / %x20-2F / %x3B-40 / %x5B-60 / %x7B-7E
non-delimiter   = %x00-08 / %x0A-1F / DIGIT / ":" / ALPHA / %x7F-FF
non-digit       = %x00-2F / %x3A-FF

day-of-month    = 1*2DIGIT ( non-digit *OCTET )
month           = ( "jan" / "feb" / "mar" / "apr" /
                    "may" / "jun" / "jul" / "aug" /
                    "sep" / "oct" / "nov" / "dec" ) *OCTET
year            = 1*4DIGIT ( non-digit *OCTET )
time            = hms-time ( non-digit *OCTET )
hms-time        = time-field ":" time-field ":" time-field
time-field      = 1*2DIGIT
              </span></pre></div>
            
</li>
<li>Process each date-token sequentially in the order the
            date-tokens appear in the cookie-date:
            
<ol class="text">
<li>If the found-time flag is not set and the token matches the
              time production, set the found-time flag and set the hour-value,
              minute-value, and second-value to the numbers denoted by the
              digits in the date-token, respectively. Skip the remaining
              sub-steps and continue to the next date-token.
</li>
<li>If the found-day-of-month flag is not set and the date-token
              matches the day-of-month production, set the found-day-of-month
              flag and set the day-of-month-value to the number denoted by the
              date-token. Skip the remaining sub-steps and continue to the
              next date-token.
</li>
<li>If the found-month flag is not set and the date-token matches
              the month production, set the found-month flag and set the
              month-value to the month denoted by the date-token. Skip the
              remaining sub-steps and continue to the next date-token.
</li>
<li>If the found-year flag is not set and the date-token matches
              the year production, set the found-year flag and set the
              year-value to the number denoted by the date-token. Skip the
              remaining sub-steps and continue to the next date-token.
</li>
</ol>
            
</li>
<li>If the year-value is greater than or equal to 70 and less than
            or equal to 99, increment the year-value by 1900.
</li>
<li>If the year-value is greater than or equal to 0 and less than
            or equal to 69, increment the year-value by 2000.
            
<ol class="text">
<li>NOTE: Some existing user agents interpret two-digit years
              differently.
</li>
</ol>
            
</li>
<li>Abort these steps and fail to parse the cookie-date if
            
<ul class="text">
<li>at least one of the found-day-of-month, found-month,
              found-year, or found-time flags is not set,
</li>
<li>the day-of-month-value is less than 1 or greater than 31,
</li>
<li>the year-value is less than 1601,
</li>
<li>the hour-value is greater than 23,
</li>
<li>the minute-value is greater than 59, or
</li>
<li>the second-value is greater than 59.
</li>
</ul>
            (Note that leap seconds cannot be represented in this syntax.)
            
</li>
<li>Let the parsed-cookie-date be the date whose day-of-month,
            month, year, hour, minute, and second (in UTC) are the
            day-of-month-value, the month-value, the year-value, the
            hour-value, the minute-value, and the second-value,
            respectively. If no such date exists, abort these steps and fail
            to parse the cookie-date.
</li>
<li>Return the parsed-cookie-date as the result of this
            algorithm.
</li>
</ol><p>
          
</p>
<a name="cookie-domain-canonicalize"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Canonicalized host names</h3>

<p>A canonicalized host name is the string generated by the following algorithm:
          </p>
<ol class="text">
<li>Convert the host name to a sequence of individual domain name
            labels.
</li>
<li>Convert each label that is not a NR-LDH label, to a A-label
            (see Section 2.3.2.1 of <a class='info' href='#RFC5890'>[RFC5890]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA):           Definitions and Document Framework,&rdquo; August&nbsp;2010.</span><span>)</span></a> for the fomer and
            latter), or to a "punycode label" (a label resulting from the
            "ToASCII" conversion in Section 4 of <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>), as
            appropriate (see Section 6.3 of this specification).
</li>
<li>Concatentate the resulting labels, separated by a %x2E (".")
            character.
</li>
</ol><p>
          
</p>
<a name="cookie-domain"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
Domain matching</h3>

<p>A string domain-matches a given domain string if at least one of
          the following conditions hold:
          </p>
<ul class="text">
<li>The domain string and the string are identical.  (Note that both
            the domain string and the string will have been canonicalized to
            lower case at this point.)
</li>
<li>All of the following conditions hold:
            
<ul class="text">
<li>The domain string is a suffix of the string.
</li>
<li>The last character of the string that is not included in the
              domain string is a %x2E (".") character.
</li>
<li>The string is a host name (i.e., not an IP address).
</li>
</ul>
            
</li>
</ul><p>
          
</p>
<a name="cookie-path"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.4"></a><h3>5.1.4.&nbsp;
Paths and path-match</h3>

<p>The user agent MUST use an algorithm equivalent to the following
          algorithm to compute the default-path of a cookie:
          </p>
<ol class="text">
<li>Let uri-path be the path portion of the request-uri if such a
            portion exists (and empty otherwise). For example, if the
            request-uri contains just a path (and optional query string), then
            the uri-path is that path (without the %x3F ("?") character or
            query string), and if the request-uri contains a full absoluteURI,
            the uri-path is the path component of that URI.
</li>
<li>If the uri-path is empty or if the first character of the
            uri-path is not a %x2F ("/") character, output %x2F ("/") and skip
            the remaining steps.
</li>
<li>If the uri-path contains only a single %x2F ("/") character,
            output %x2F ("/") and skip the remaining steps.
</li>
<li>Output the characters of the uri-path from the first character
            up to, but not including, the right-most %x2F ("/").
</li>
</ol><p>
          
</p>
<p>A request-path path-matches a given cookie-path if at least one of
          the following conditions hold:
          </p>
<ul class="text">
<li>The cookie-path and the request-path are identical.
</li>
<li>The cookie-path is a prefix of the request-path and the last
            character of the cookie-path is %x2F ("/").
</li>
<li>The cookie-path is a prefix of the request-path and the first
            character of the request-path that is not included in the
            cookie-path is a %x2F ("/") character.
</li>
</ul><p>
          
</p>
<a name="set-cookie"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
The Set-Cookie Header</h3>

<p>When a user agent receives a Set-Cookie header field in an HTTP
        response, the user agent MAY ignore the Set-Cookie header field in its
        entirety. For example, the user agent might wish to block responses to
        "third-party" requests from setting cookies.
</p>
<p>If the user agent does not ignore the Set-Cookie header field in its
        entirety, the user agent MUST parse the field-value of the Set-Cookie
        header field as a set-cookie-string (defined below).
</p>
<p>NOTE: The algorithm below is more permissive than the grammar in
        <a class='info' href='#sane-set-cookie'>Section&nbsp;4.1<span> (</span><span class='info'>Set-Cookie</span><span>)</span></a>. For example, the algorithm strips
        leading and trailing whitespace from the cookie name and value (but
        maintains internal whitespace), whereas the grammar in <a class='info' href='#sane-set-cookie'>Section&nbsp;4.1<span> (</span><span class='info'>Set-Cookie</span><span>)</span></a> forbids whitespace in these positions.
        User agents use this algorithm so as to interoperate with servers that
        do not follow the recommendations in <a class='info' href='#sane-profile'>Section&nbsp;4<span> (</span><span class='info'>Server Requirements</span><span>)</span></a>.
</p>
<p>A user agent MUST use an algorithm equivalent to the following
        algorithm to parse a "set-cookie-string":
        </p>
<ol class="text">
<li>If the set-cookie-string contains a %x3B (";") character:
          
<blockquote class="text">
<p>The name-value-pair string consists of the characters up to,
            but not including, the first %x3B (";"), and the
            unparsed-attributes consist of the remainder of the
            set-cookie-string (including the %x3B (";") in question).
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>The name-value-pair string consists of all the characters
            contained in the set-cookie-string, and the unparsed-attributes
            is the empty string.
</p>
</blockquote>
          
</li>
<li>If the name-value-pair string lacks a %x3D ("=") character,
          ignore the set-cookie-string entirely.
</li>
<li>The (possibly empty) name string consists of the characters up to,
          but not including, the first %x3D ("=") character, and the
          (possibly empty) value string consists of the characters after the
          first %x3D ("=") character.
</li>
<li>Remove any leading or trailing WSP characters from the name
          string and the value string.
</li>
<li>If the name string is empty, ignore the set-cookie-string
          entirely.
</li>
<li>The cookie-name is the name string, and the cookie-value is the
          value string.
</li>
</ol><p>
        
</p>
<p>The user agent MUST use an algorithm equivalent to the following
        algorithm to parse the unparsed-attributes:
        </p>
<ol class="text">
<li>If the unparsed-attributes string is empty, skip the rest of
          these steps.
</li>
<li>Discard the first character of the unparsed-attributes (which
          will be a %x3B (";") character).
</li>
<li>If the remaining unparsed-attributes contains a %x3B (";")
          character:
          
<blockquote class="text">
<p>Consume the characters of the unparsed-attributes up to, but
            not including, the first %x3B (";") character.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Consume the remainder of the unparsed-attributes.
</p>
</blockquote>
          Let the cookie-av string be the characters consumed in this
          step.
</li>
<li>If the cookie-av string contains a %x3D ("=") character:
          
<blockquote class="text">
<p>The (possibly empty) attribute-name string consists of the
            characters up to, but not including, the first %x3D ("=")
            character, and the (possibly empty) attribute-value string
            consists of the characters after the first %x3D ("=")
            character.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>The attribute-name string consists of the entire cookie-av
            string, and the attribute-value string is empty.
</p>
</blockquote>
          
</li>
<li>Remove any leading or trailing WSP characters from the
          attribute-name string and the attribute-value string.
</li>
<li>Process the attribute-name and attribute-value according to the
          requirements in the following subsections.  (Notice that attributes
          with unrecognized attribute-names are ignored.)
</li>
<li>Return to Step 1 of this algorithm.
</li>
</ol><p>
        
</p>
<p>When the user agent finishes parsing the set-cookie-string, the user
        agent is said to "receive a cookie" from the request-uri with name
        cookie-name, value cookie-value, and attributes cookie-attribute-list.
        (See <a class='info' href='#storage-model'>Section&nbsp;5.3<span> (</span><span class='info'>Storage Model</span><span>)</span></a> for additional requirements
        triggered by receiving a cookie.)
</p>
<a name="expires-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
The Expires Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Expires", the user agent MUST process the cookie-av as follows.
</p>
<p>Let the expiry-time be the result of parsing the attribute-value
          as cookie-date (see <a class='info' href='#cookie-date'>Section&nbsp;5.1.1<span> (</span><span class='info'>Dates</span><span>)</span></a>).
</p>
<p>If the attribute-value failed to parse as a cookie date, ignore
          the cookie-av.
</p>
<p>If the expiry-time is later than the last date the user agent
          can represent, the user agent MAY replace the expiry-time with the
          last representable date.
</p>
<p>If the expiry-time is earlier than the earliest date the user
          agent can represent, the user agent MAY replace the expiry-time with
          the earliest representable date.
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Expires and an attribute-value of expiry-time.
</p>
<a name="max-age-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
The Max-Age Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Max-Age", the user agent MUST process the cookie-av as follows.
</p>
<p>If the first character of the attribute-value is not a DIGIT or a
          "-" character, ignore the cookie-av.
</p>
<p>If the remainder of attribute-value contains a non-DIGIT
          character, ignore the cookie-av.
</p>
<p>Let delta-seconds be the attribute-value converted to an
          integer.
</p>
<p>If delta-seconds is less than or equal to zero (0), let
          expiry-time be the earliest representable date and time. Otherwise,
          let the expiry-time be the current date and time plus delta-seconds
          seconds.
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Max-Age and an attribute-value of expiry-time.
</p>
<a name="domain-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
The Domain Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Domain", the user agent MUST process the cookie-av as follows.
</p>
<p>If the attribute-value is empty, the behavior is undefined.
          However, user agent SHOULD ignore the cookie-av entirely.
</p>
<p>If the first character of the attribute-value string is %x2E
          ("."):
          </p>
<blockquote class="text">
<p>Let cookie-domain be the attribute-value without the leading
            %x2E (".") character.
</p>
</blockquote><p>
          Otherwise:
          </p>
<blockquote class="text">
<p>Let cookie-domain be the entire attribute-value.
</p>
</blockquote><p>
          
</p>
<p>Convert the cookie-domain to lower case.
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Domain and an attribute-value of
          cookie-domain.
</p>
<a name="path-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
The Path Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Path", the user agent MUST process the cookie-av as follows.
</p>
<p>If the attribute-value is empty or if the first character of the
          attribute-value is not %x2F ("/"):
          </p>
<blockquote class="text">
<p>Let cookie-path be the default-path.
</p>
</blockquote><p>
          Otherwise:
          </p>
<blockquote class="text">
<p>Let cookie-path be the attribute-value.
</p>
</blockquote><p>
          
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Path and an attribute-value of cookie-path.
</p>
<a name="secure-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
The Secure Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Secure", the user agent MUST append an attribute to the
          cookie-attribute-list with an attribute-name of Secure and an empty
          attribute-value.
</p>
<a name="httponly-attribute"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
The HttpOnly Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "HttpOnly", the user agent MUST append an attribute to the
          cookie-attribute-list with an attribute-name of HttpOnly and an
          empty attribute-value.
</p>
<a name="storage-model"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Storage Model</h3>

<p>The user agent stores the following fields about each cookie: name,
        value, expiry-time, domain, path, creation-time, last-access-time,
        persistent-flag, host-only-flag, secure-only-flag, and
        http-only-flag.
</p>
<p>When the user agent "receives a cookie" from a request-uri with name
        cookie-name, value cookie-value, and attributes cookie-attribute-list,
        the user agent MUST process the cookie as follows:
        </p>
<ol class="text">
<li>A user agent MAY ignore a received cookie in its entirety. For
          example, the user agent might wish to block receiving cookies from
          "third-party" responses or the user agent might not wish to store
          cookies that exceed some size.
</li>
<li>Create a new cookie with name cookie-name, value cookie-value.
          Set the creation-time and the last-access-time to the current date
          and time.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Max-Age":
          
<blockquote class="text">
<p>Set the cookie's persistent-flag to true.
</p>
<p>Set the cookie's expiry-time to attribute-value of the last
            attribute in the cookie-attribute-list with an attribute-name of
            "Max-Age".
</p>
</blockquote>
          Otherwise, if the cookie-attribute-list contains an attribute with
          an attribute-name of "Expires" (and does not contain an attribute
          with an attribute-name of "Max-Age"):
          
<blockquote class="text">
<p>Set the cookie's persistent-flag to true.
</p>
<p>Set the cookie's expiry-time to attribute-value of the last
            attribute in the cookie-attribute-list with an attribute-name of
            "Expires".
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Set the cookie's persistent-flag to false.
</p>
<p>Set the cookie's expiry-time to the latest representable
            date.
</p>
</blockquote>
          
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Domain":
          
<blockquote class="text">
<p>Let the domain-attribute be the attribute-value of the last
            attribute in the cookie-attribute-list with an attribute-name of
            "Domain".
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Let the domain-attribute be the empty string.
</p>
</blockquote>
          
</li>
<li>If the user agent is configured to reject "public suffixes" and
          the domain-attribute is a public suffix:
          
<blockquote class="text">
<p>If the domain-attribute is identical to the canonicalized
            request-host:
            </p>
<blockquote class="text">
<p>Let the domain-attribute be the empty string.
</p>
</blockquote>
            Otherwise:
            
<blockquote class="text">
<p>Ignore the cookie entirely and abort these steps.
</p>
</blockquote>
            

<p>NOTE: A "public suffix" is a domain that is controlled by a
            public registry, such as "com", "co.uk", and "pvt.k12.wy.us".
            This step is essential for preventing attacker.com from
            disrupting the integrity of example.com by setting a cookie with
            a Domain attribute of "com". Unfortunately, the set of public
            suffixes (also known as "registry controlled domains") changes
            over time. If feasible, user agents SHOULD use an up-to-date
            public suffix list, such as the one maintained by the Mozilla
            project at <a href='http://publicsuffix.org/'>http://publicsuffix.org/</a>.
</p>
</blockquote>
          
</li>
<li>If the domain-attribute is non-empty:
          
<blockquote class="text">
<p>If the canonicalized request-host does not domain-match the
            domain-attribute:
            </p>
<blockquote class="text">
<p>Ignore the cookie entirely and abort these steps.
</p>
</blockquote>
            Otherwise:
            
<blockquote class="text">
<p>Set the cookie's host-only-flag to false.
</p>
<p>Set the cookie's domain to the domain-attribute.
</p>
</blockquote>
            

</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Set the cookie's host-only-flag to true.
</p>
<p>Set the cookie's domain to the canonicalized request-host.
</p>
</blockquote>
          
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Path", set the cookie's path to attribute-value
          of the last attribute in the cookie-attribute-list with an
          attribute-name of "Path". Otherwise, set cookie's path to the
          default-path of the request-uri.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Secure", set the cookie's secure-only-flag to
          true.  Otherwise, set cookie's secure-only-flag to false.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "HttpOnly", set the cookie's http-only-flag to
          true.  Otherwise, set cookie's http-only-flag to false.
</li>
<li>If the cookie was received from a "non-HTTP" API and the
          cookie's http-only-flag is set, abort these steps and ignore the
          cookie entirely.
</li>
<li>If the cookie store contains a cookie with the same name, domain,
          and path as the newly created cookie:
          
<ol class="text">
<li>Let old-cookie be the existing cookie with the same name,
            domain, and path as the newly created cookie.  (Notice that this
            algorithm maintains the invariant that there is at most one such
            cookie.)
</li>
<li>If the newly created cookie was received from a "non-HTTP"
            API and the old-cookie's http-only-flag is set, abort these
            steps and ignore the newly created cookie entirely.
</li>
<li>Update the creation-time of the newly created cookie to match
            the creation-time of the old-cookie.
</li>
<li>Remove the old-cookie from the cookie store.
</li>
</ol>
          
</li>
<li>Insert the newly created cookie into the cookie store.
</li>
</ol><p>
        
</p>
<p>A cookie is "expired" if the cookie has an expiry date in the
        past.
</p>
<p>The user agent MUST evict all expired cookies from the cookie store
        if, at any time, an expired cookie exists in the cookie store.
</p>
<p>At any time, the user agent MAY "remove excess cookies" from the
        cookie store if the number of cookies sharing a domain field exceeds
        some implementation defined upper bound (such as 50 cookies).
</p>
<p>At any time, the user agent MAY "remove excess cookies" from the
        cookie store if the cookie store exceeds some predetermined upper bound
        (such as 3000 cookies).
</p>
<p>When the user agent removes excess cookies from the cookie store,
        the user agent MUST evict cookies in the following priority order:
        </p>
<ol class="text">
<li>Expired cookies.
</li>
<li>Cookies that share a domain field with more than a predetermined
          number of other cookies.
</li>
<li>All cookies.
</li>
</ol><p>
        
</p>
<p>If two cookies have the same removal priority, the user agent MUST
        evict the cookie with the earliest last-access date first.
</p>
<p>When "the current session is over" (as defined by the user agent),
        the user agent MUST remove from the cookie store all cookies with the
        persistent-flag set to false.
</p>
<a name="cookie"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
The Cookie Header</h3>

<p>The user agent includes stored cookies in the Cookie HTTP request
        header.
</p>
<p>When the user agent generates an HTTP request, the user agent MUST
        NOT attach more than one Cookie header field.
</p>
<p>A user agent MAY omit the Cookie header in its entirety. For
        example, the user agent might wish to block sending cookies during
        "third-party" requests.
</p>
<p>If the user agent does attach a Cookie header field to an HTTP
        request, the user agent MUST send the cookie-string (defined below) as
        the value of the header field.
</p>
<p>The user agent MUST use an algorithm equivalent to the following
        algorithm to compute the "cookie-string" from a cookie store and a
        request-uri:
        </p>
<ol class="text">
<li>Let cookie-list be the set of cookies from the cookie store
          that meet all of the following requirements:
          
<ul class="text">
<li>Either:
            
<blockquote class="text">
<p>The cookie's host-only-flag is true and the canonicalized
              request-host is identical to the cookie's domain.
</p>
</blockquote>
            Or:
            
<blockquote class="text">
<p>The cookie's host-only-flag is false and the canonicalized
              request-host domain-matches cookie's domain.
</p>
</blockquote>
            
</li>
<li>The request-uri's path path-matches cookie's path.
</li>
<li>If the cookie's secure-only-flag is true, then the
            request-uri's scheme must denote a "secure" protocol (as defined
            by the user agent).
            
<blockquote class="text">
<p>NOTE: The notion of a "secure" protocol is not defined by
              this document.  Typically, user agents consider a protocol
              secure if the protocol makes use of transport-layer security,
              such as SSL or TLS.  For example, most user agents consider
              "https" to be a scheme that denotes a secure protocol.
</p>
</blockquote>
            
</li>
<li>If the cookie's http-only-flag is true, then exclude the
            cookie if the cookie-string is being generated for a
            "non-HTTP" API (as defined by the user agent).
</li>
</ul>
          
</li>
<li>The user agent SHOULD sort the cookie-list in the following
          order:
          
<ul class="text">
<li>Cookies with longer paths are listed before cookies
            with shorter paths.
</li>
<li>Among cookies that have equal length path fields, cookies
            with earlier creation-times are listed before cookies with later
            creation-times.
</li>
</ul>
          NOTE: Not all user agents sort the cookie-list in this order, but
          this order reflects common practice when this document was written,
          and, historically, there have been servers that (erroneously)
          depended on this order.
</li>
<li>Update the last-access-time of each cookie in the cookie-list
          to the current date and time.
</li>
<li>Serialize the cookie-list into a cookie-string by processing each
          cookie in the cookie-list in order:
          
<ol class="text">
<li>Output the cookie's name, the %x3D ("=") character, and the
            cookie's value.
</li>
<li>If there is an unprocessed cookie in the cookie-list, output
            the characters %x3B and %x20 ("; ").
</li>
</ol>
          
</li>
</ol><p>
        NOTE: Despite its name, the cookie-string is actually a sequence of
        octets, not a sequence of characters. To convert the cookie-string (or
        components thereof) into a sequence of characters (e.g., for
        presentation to the user), the user agent might wish use the UTF-8
        character encoding <a class='info' href='#RFC3629'>[RFC3629]<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a> to decode the octet
        sequence.
</p>
<a name="implementation-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Implementation Considerations</h3>

<a name="implementation-limits"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Limits</h3>

<p>Practical user agent implementations have limits on the number
        and size of cookies that they can store.  General-use user agents
        SHOULD provide each of the following minimum capabilities:
        </p>
<ul class="text">
<li>At least 4096 bytes per cookie (as measured by the sum of the
          length of the cookie's name, value, and attributes).
</li>
<li>At least 50 cookies per domain.
</li>
<li>At least 3000 cookies total.
</li>
</ul><p>
        
</p>
<p>Servers SHOULD use as few and as small cookies as possible to avoid
        reaching these implementation limits and to minimize network bandwidth
        due to the Cookie header being included in every request.
</p>
<p>Servers SHOULD gracefully degrade if the user agent fails to return
        one or more cookies in the Cookie header because the user agent might
        evict any cookie at any time on orders from the user.
</p>
<a name="implementation-apis"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Application Programming Interfaces</h3>

<p>One reason the Cookie and Set-Cookie headers uses such esoteric
        syntax is because many platforms (both in servers and user agents)
        provide a string-based application programing interface (API) to
        cookies, requiring application-layer programmers to generate and parse
        the syntax used by the Cookie and Set-Cookie headers, which many
        programmers have done incorrectly, resulting in interoperability
        problems.
</p>
<p>Instead of providing string-based APIs to cookies, platforms would
        be well-served by providing more semantic APIs. It is beyond the scope
        of this document to recommend specific API designs, but there are
        clear benefits to accepting an abstract "Date" object instead of a
        serialized date string.
</p>
<a name="idna-migration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
IDNA dependency and migration</h3>

<p>IDNA2008 <a class='info' href='#RFC5890'>[RFC5890]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA):           Definitions and Document Framework,&rdquo; August&nbsp;2010.</span><span>)</span></a> supersedes IDNA2003 <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.  However, there are differences between the two
        specifications, and thus there can be differences in processing (e.g.
        converting) domain name labels that have been registered under one from
        those registered under the other.  There will be a transition period of
        some time during which IDNA2003-based domain name labels will exist in
        the wild.  User agents SHOULD implement IDNA2008 <a class='info' href='#RFC5890'>[RFC5890]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA):           Definitions and Document Framework,&rdquo; August&nbsp;2010.</span><span>)</span></a> and MAY implement <a class='info' href='#UTS46'>[UTS46]<span> (</span><span class='info'>Davis, M. and M. Suignard, &ldquo;Unicode IDNA Compatibility Processing,&rdquo; 2010.</span><span>)</span></a> or <a class='info' href='#RFC5895'>[RFC5895]<span> (</span><span class='info'>Resnick, P. and P. Hoffman, &ldquo;Mapping Characters for Internationalized Domain Names in           Applications (IDNA) 2008,&rdquo; September&nbsp;2010.</span><span>)</span></a> in order to facilitate their IDNA transition.  If a user agent does
        not implement IDNA2008, the user agent MUST implement IDNA2003 <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</p>
<a name="privacy-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Privacy Considerations</h3>

<p>Cookies are often criticized for letting servers track
        users. For example, a number of "web analytics" companies use cookies
        to recognize when a user returns to a web site or visits another web
        site. Although cookies are not the only mechanism servers can use to
        track users across HTTP requests, cookies facilitate tracking because
        they are persistent across user agent sessions and can be shared
        between hosts.
</p>
<a name="third-party-cookies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Third-Party Cookies</h3>

<p>Particularly worrisome are so-called "third-party" cookies. In
          rendering an HTML document, a user agent often requests resources
          from other servers (such as advertising networks). These third-party
          servers can use cookies to track the user even if the
          user never visits the server directly.
</p>
<p>Some user agents restrict how third-party cookies behave. For
          example, some of these user agents refuse to send the Cookie
          header in third-party requests. Others refuse to process the
          Set-Cookie header in responses to third-party requests. User
          agents vary widely in their third-party cookie policies. This
          document grants user agents wide latitude to experiment with
          third-party cookie policies that balance the privacy and
          compatibility needs of their users. However, this document does
          not endorse any particular third-party cookie policy.
</p>
<p>Third-party cookie blocking policies are often ineffective at
          achieving their privacy goals if servers attempt to work around
          their restrictions to track users. In particular, two collaborating
          servers can often track users without using cookies at all by
          injecting identifying information into dynamic URLs.
</p>
<a name="user-controls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
User Controls</h3>

<p>User agents should provide users with a mechanism for managing
          the cookies stored in the cookie store. For example, a user agent
          might let users delete all cookies received during a specified time
          period or all the cookies related to a particular domain. In
          addition, many user agents include a user interface element that lets
          users examine the cookies stored in their cookie store.
</p>
<p>User agents should provide users with a mechanism for disabling
          cookies. When cookies are disabled, the user agent MUST NOT include
          a Cookie header in outbound HTTP requests and the user agent MUST
          NOT process Set-Cookie headers in inbound HTTP responses.
</p>
<p>Some user agents provide users the option of preventing
          persistent storage of cookies across sessions. When configured
          thusly, user agents MUST treat all received cookies as if the
          persistent-flag were set to false.
</p>
<p>Some user agents provide users with the ability to approve
          individual writes to the cookie store. In many common usage
          scenarios, these controls generate a large number of prompts.
          However, some privacy-conscious users find these controls useful
          nonetheless.
</p>
<a name="security-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<a name="section-overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Overview</h3>

<p>Cookies have a number of security pitfalls.  This section overviews
        a few of the more salient issues.
</p>
<p>In particular, cookies encourage developers to rely on ambient
        authority for authentication, often becoming vulnerable to attacks
        such as cross-site request forgery <a class='info' href='#CSRF'>[CSRF]<span> (</span><span class='info'>Barth, A., Jackson, C., and J. Mitchell, &ldquo;Robust Defenses for Cross-Site Request Forgery,&rdquo; 2008.</span><span>)</span></a>. Also, when
        storing session identifiers in cookies, developers often create session
        fixation vulnerabilities.
</p>
<p>Transport-layer encryption, such as that employed in HTTPS, is
        insufficient to prevent a network attacker from obtaining or altering
        a victim's cookies because the cookie protocol itself has various
        vulnerabilities (see "Weak Confidentiality" and "Weak Integrity",
        below). In addition, by default, cookies do not provide
        confidentiality or integrity from network attackers, even when used in
        conjunction with HTTPS.
</p>
<a name="ambient-authority"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Ambient Authority</h3>

<p>A server that uses cookies to authenticate users can suffer
        security vulnerabilities because some user agents let remote parties
        issue HTTP requests from the user agent (e.g., via HTTP redirects or
        HTML forms). When issuing those requests, user agents attach cookies
        even if the remote party does not know the contents of the cookies,
        potentially letting the remote party exercise authority at an unwary
        server.
</p>
<p>Although this security concern goes by a number of names (e.g.,
        cross-site request forgery, confused deputy), the issue stems from
        cookies being a form of ambient authority. Cookies encourage server
        operators to separate designation (in the form of URLs) from
        authorization (in the form of cookies). Consequently, the user agent
        might supply the authorization for a resource designated by the
        attacker, possibly causing the server or its clients to undertake
        actions designated by the attacker as though they were authorized by
        the user.
</p>
<p>Instead of using cookies for authorization, server operators might
        wish to consider entangling designation and authorization by treating
        URLs as capabilities. Instead of storing secrets in cookies, this
        approach stores secrets in URLs, requiring the remote entity to supply
        the secret itself. Although this approach is not a panacea, judicious
        application of these principles can lead to more robust security.
</p>
<a name="clear-text"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Clear Text</h3>

<p>Unless sent over a secure channel (such as TLS), the information in
        the Cookie and Set-Cookie headers is transmitted in the clear.
        </p>
<ol class="text">
<li>All sensitive information conveyed in these headers is exposed to
          an eavesdropper.
</li>
<li>A malicious intermediary could alter the headers as they travel
          in either direction, with unpredictable results.
</li>
<li>A malicious client could alter the Cookie header before
          transmission, with unpredictable results.
</li>
</ol><p>
        
</p>
<p>Servers SHOULD encrypt and sign the contents of cookies when
        transmitting them to the user agent (even when sending the cookies
        over a secure channel). However, encrypting and signing cookie
        contents does not prevent an attacker from transplanting a cookie from
        one user agent to another or from replaying the cookie at a later
        time.
</p>
<p>In addition to encrypting and signing the contents of every
        cookie, servers that require a higher level of security SHOULD use the
        Cookie and Set-Cookie headers only over a secure channel. When using
        cookies over a secure channel, servers SHOULD set the Secure
        attribute (see <a class='info' href='#sane-secure'>Section&nbsp;4.1.2.5<span> (</span><span class='info'>The Secure Attribute</span><span>)</span></a>) for every cookie. If a
        server does not set the Secure attribute, the protection provided by
        the secure channel will be largely moot.
</p>
<a name="session-identifiers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Session Identifiers</h3>

<p>Instead of storing session information directly in a cookie (where
        it might be exposed to or replayed by an attacker), servers commonly
        store a nonce (or "session identifier") in a cookie. When the server
        receives an HTTP request with a nonce, the server can look up state
        information associated with the cookie using the nonce as a key.
</p>
<p>Using session identifier cookies limits the damage an attacker can
        cause if the attacker learns the contents of a cookie because the
        nonce is useful only for interacting with the server (unlike non-nonce
        cookie content, which might itself be sensitive). Furthermore, using a
        single nonce prevents an attacker from "splicing" together cookie
        content from two interactions with the server, which could cause the
        server to behave unexpectedly.
</p>
<p>Using session identifiers is not without risk. For example, the
        server SHOULD take care to avoid "session fixation" vulnerabilities. A
        session fixation attack proceeds in three steps. First, the
        attacker transplants a session identifier from his or her user agent
        to the victim's user agent. Second, the victim uses that session
        identifier to interact with the server, possibly imbuing the session
        identifier with the user's credentials or confidential information.
        Third, the attacker uses the session identifier to interact with
        server directly, possibly obtaining the user's authority or
        confidential information.
</p>
<a name="weak-confidentiality"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Weak Confidentiality</h3>

<p>Cookies do not provide isolation by port. If a cookie is readable
        by a service running on one port, the cookie is also readable by a
        service running on another port of the same server. If a cookie is
        writable by a service on one port, the cookie is also writable by a
        service running on another port of the same server. For this reason,
        servers SHOULD NOT both run mutually distrusting services on different
        ports of the same host and use cookies to store security-sensitive
        information.
</p>
<p>Cookies do not provide isolation by scheme. Although most commonly
        used with the http and https schemes, the cookies for a given host
        might also be available to other schemes, such as ftp and gopher.
        Although this lack of isolation by scheme is most apparent in
        non-HTTP APIs that permit access to cookies (e.g., HTML's
        document.cookie API), the lack of isolation by scheme is actually
        present in requirements for processing cookies themselves (e.g.,
        consider retrieving a URI with the gopher scheme via HTTP).
</p>
<p>Cookies do not always provide isolation by path. Although the
        network-level protocol does not send cookies stored for one path to
        another, some user agents expose cookies via non-HTTP APIs, such as
        HTML's document.cookie API. Because some of these user agents (e.g.,
        web browsers) do not isolate resources received from different paths,
        a resource retrieved from one path might be able to access cookies
        stored for another path.
</p>
<a name="weak-integrity"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Weak Integrity</h3>

<p>Cookies do not provide integrity guarantees for sibling domains
        (and their subdomains). For example, consider foo.example.com and
        bar.example.com. The foo.example.com server can set a cookie with a
        Domain attribute of "example.com" (possibly overwriting an existing
        "example.com" cookie set by bar.example.com), and the user agent will
        include that cookie in HTTP requests to bar.example.com. In the worst
        case, bar.example.com will be unable to distinguish this cookie from a
        cookie it set itself. The foo.example.com server might be able to
        leverage this ability to mount an attack against bar.example.com.
</p>
<p>Even though the Set-Cookie header supports the Path attribute, the
        Path attribute does not provide any integrity protection because the
        user agent will accept an arbitrary Path attribute in a Set-Cookie
        header. For example, an HTTP response to a request for
        http://example.com/foo/bar can set a cookie with a Path attribute of
        "/qux". Consequently, servers SHOULD NOT both run mutually distrusting
        services on different paths of the same host and use cookies to store
        security-sensitive information.
</p>
<p>An active network attacker can also inject cookies into the
        Cookie header sent to https://example.com/ by impersonating a response
        from http://example.com/ and injecting a Set-Cookie header. The HTTPS
        server at example.com will be unable to distinguish these cookies from
        cookies that it set itself in an HTTPS response. An active network
        attacker might be able to leverage this ability to mount an attack
        against example.com even if example.com uses HTTPS exclusively.
</p>
<p>Servers can partially mitigate these attacks by encrypting and
        signing the contents of their cookies. However, using cryptography
        does not mitigate the issue completely because an attacker can replay
        a cookie he or she received from the authentic example.com server in
        the user's session, with unpredictable results.
</p>
<p>Finally, an attacker might be able to force the user agent to
        delete cookies by storing a large number of cookies. Once the user agent
        reaches its storage limit, the user agent will be forced to evict some
        cookies. Servers SHOULD NOT rely upon user agents retaining
        cookies.
</p>
<a name="reliance-on-dns"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
Reliance on DNS</h3>

<p>Cookies rely upon the Domain Name System (DNS) for security. If the
        DNS is partially or fully compromised, the cookie protocol might fail
        to provide the security properties required by applications.
</p>
<a name="iana-considerations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>The permanent message header field registry (see <a class='info' href='#RFC3864'>[RFC3864]<span> (</span><span class='info'>Klyne, G., Nottingham, M., and J. Mogul, &ldquo;Registration Procedures for Message Header Fields,&rdquo; September&nbsp;2004.</span><span>)</span></a>) should be updated with the following
      registrations:
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Cookie</h3>

<p>Header field name: Cookie
</p>
<p>Applicable protocol: http
</p>
<p>Status: standard
</p>
<p>Author/Change controller: IETF
</p>
<p>Specification document: this specification (<a class='info' href='#cookie'>Section&nbsp;5.4<span> (</span><span class='info'>The Cookie Header</span><span>)</span></a>)
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Set-Cookie</h3>

<p>Header field name: Set-Cookie
</p>
<p>Applicable protocol: http
</p>
<p>Status: standard
</p>
<p>Author/Change controller: IETF
</p>
<p>Specification document: this specification (<a class='info' href='#set-cookie'>Section&nbsp;5.2<span> (</span><span class='info'>The Set-Cookie Header</span><span>)</span></a>)
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
Cookie2</h3>

<p>Header field name: Cookie2
</p>
<p>Applicable protocol: http
</p>
<p>Status: obsoleted
</p>
<p>Author/Change controller: IETF
</p>
<p>Specification document: <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Set-Cookie2</h3>

<p>Header field name: Set-Cookie2
</p>
<p>Applicable protocol: http
</p>
<p>Status: obsoleted
</p>
<p>Author/Change controller: IETF
</p>
<p>Specification document: <a class='info' href='#RFC2965'>[RFC2965]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; October&nbsp;2000.</span><span>)</span></a>
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts
            and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1123">[RFC1123]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1123">Requirements for Internet Hosts - Application and
          Support</a>,&rdquo; STD&nbsp;3, RFC&nbsp;1123, October&nbsp;1989 (<a href="http://www.rfc-editor.org/rfc/rfc1123.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3490">[RFC3490]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3490.txt">TXT</a>).<p>
See <a class='info' href='#idna-migration'>Section&nbsp;6.3<span> (</span><span class='info'>IDNA dependency and migration</span><span>)</span></a> for an explanation why the
          normative reference to an obsoleted specification is needed.
</p>
</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4790">[RFC4790]</a></td>
<td class="author-text">Newman, C., Duerst, M., and A. Gulbrandsen, &ldquo;<a href="http://tools.ietf.org/html/rfc4790">Internet Application Protocol Collation Registry</a>,&rdquo; RFC&nbsp;4790, March&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4790.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text"><a href="mailto:dcrocker@bbiw.net">Crocker, D., Ed.</a> and <a href="mailto:paul.overell@thus.net">P. Overell</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5890">[RFC5890]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5890">Internationalized Domain Names for Applications (IDNA):
          Definitions and Document Framework</a>,&rdquo; RFC&nbsp;5890, August&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5890.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2109">[RFC2109]</a></td>
<td class="author-text"><a href="mailto:dmk@bell-labs.com">Kristol, D.</a> and <a href="mailto:montulli@netscape.com">L. Montulli</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2109">HTTP State Management Mechanism</a>,&rdquo; RFC&nbsp;2109, February&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2965">[RFC2965]</a></td>
<td class="author-text"><a href="mailto:dmk@bell-labs.com">Kristol, D.</a> and <a href="mailto:lou@montulli.org">L. Montulli</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2965">HTTP State Management Mechanism</a>,&rdquo; RFC&nbsp;2965, October&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Netscape">[Netscape]</a></td>
<td class="author-text">Netscape Communications Corp., &ldquo;<a href="http://web.archive.org/web/20020803110822/http://wp.netscape.com/newsref/std/cookie_spec.html">Persistent Client State -- HTTP Cookies</a>,&rdquo; 1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="Kri2001">[Kri2001]</a></td>
<td class="author-text">Kristol, D., &ldquo;<a href="http://arxiv.org/abs/cs.SE/0105018">HTTP Cookies: Standards, Privacy, and Politics</a>,&rdquo; ACM Transactions on Internet Technology&nbsp;Vol. 1, #2, November&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3629">[RFC3629]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="ftp://ftp.rfc-editor.org/in-notes/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4648">[RFC4648]</a></td>
<td class="author-text">Josefsson, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4648">The Base16, Base32, and Base64 Data Encodings</a>,&rdquo; RFC&nbsp;4648, October&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3864">[RFC3864]</a></td>
<td class="author-text">Klyne, G., Nottingham, M., and J. Mogul, &ldquo;<a href="http://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>,&rdquo; BCP&nbsp;90, RFC&nbsp;3864, September&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5895">[RFC5895]</a></td>
<td class="author-text">Resnick, P. and P. Hoffman, &ldquo;<a href="http://tools.ietf.org/html/rfc5895">Mapping Characters for Internationalized Domain Names in
          Applications (IDNA) 2008</a>,&rdquo; RFC&nbsp;5895, September&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5895.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UTS46">[UTS46]</a></td>
<td class="author-text">Davis, M. and M. Suignard, &ldquo;<a href="http://unicode.org/reports/tr46/">Unicode IDNA Compatibility Processing</a>,&rdquo; Unicode Technical Standards&nbsp;# 46, 2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="CSRF">[CSRF]</a></td>
<td class="author-text">Barth, A., Jackson, C., and J. Mitchell, &ldquo;<a href="http://www.adambarth.com/papers/2008/barth-jackson-mitchell-b.pdf">Robust Defenses for Cross-Site Request Forgery</a>,&rdquo; 2008.</td></tr>
</table>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>This document borrows heavily from RFC 2109 <a class='info' href='#RFC2109'>[RFC2109]<span> (</span><span class='info'>Kristol, D. and L. Montulli, &ldquo;HTTP State Management Mechanism,&rdquo; February&nbsp;1997.</span><span>)</span></a>.
      We are indebted to David M. Kristol and Lou Montulli for their efforts to
      specify cookies. David M. Kristol, in particular, provided invaluable
      advice on navigating the IETF process. We would also like to thank Thomas
      Broyer, Tyler Close, Bil Corry, corvid, Lisa Dusseault, Roy T. Fielding,
      Blake Frantz, Anne van Kesteren, Eran Hammer-Lahav, Jeff Hodges, Bjoern
      Hoehrmann, Achim Hoffmann, Georg Koppen, Dean McNamee, Alexey Melnikov,
      Mark Miller, Mark Pauley, Yngve N. Pettersen, Julian Reschke, Peter
      Saint-Andre, Mark Seaborn, Maciej Stachowiak, Daniel Stenberg, Tatsuhiro
      Tsujikawa, David Wagner, Dan Winship, and Dan Witte for their valuable
      feedback on this document.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adam Barth</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of California, Berkeley</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:abarth@eecs.berkeley.edu">abarth@eecs.berkeley.edu</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.adambarth.com/">http://www.adambarth.com/</a></td></tr>
</table>
</body></html>
