<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>The Diameter 'Application Bridging for Federated Access Beyond Web (ABFAB)' Application</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Application Identifiers">
<link href="#rfc.section.4" rel="Chapter" title="4 Protocol Description">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Session Management">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Session-Termination-Request">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Session-Termination-Answer">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Abort-Session-Request">
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 Abort-Session-Answer">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Accounting for ABFAB services">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Accounting-Request">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Accounting-Answer">
<link href="#rfc.section.5" rel="Chapter" title="5 Command Codes">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Diameter-EAP-Request">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Diameter-EAP-Answer">
<link href="#rfc.section.6" rel="Chapter" title="6 AVPs">
<link href="#rfc.section.7" rel="Chapter" title="7 Result-Code AVP Values">
<link href="#rfc.section.8" rel="Chapter" title="8 AVP Occurrence Tables">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 DER, DEA AVP/Command-Code Table">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Coupled Accounting Model AVP Table">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 AVP Codes">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Application Identifier">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Application Bridging for Federated Access Beyond Web (ABFAB) architecture provides cross-domain authentication, authorization and accounting functionality by utilizing well-established technologies, such as Diameter, the Extensible Authentication Protocol (EAP), and the Generic Security Services API (GSS-API)." />
  <meta name="description" content="The Application Bridging for Federated Access Beyond Web (ABFAB) architecture provides cross-domain authentication, authorization and accounting functionality by utilizing well-established technologies, such as Diameter, the Extensible Authentication Protocol (EAP), and the Generic Security Services API (GSS-API)." />
  <meta name="keywords" content="Internet-Draft, Federated Authentication, AAA, Diameter, GSS-API, EAP, SASL" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">ABFAB</td>
<td class="right">M. Jones</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Bridgewater Systems</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">H. Tschofenig</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right">Nokia Siemens Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 07, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">The Diameter 'Application Bridging for Federated Access Beyond Web (ABFAB)' Application<br />
  <span class="filename">draft-jones-diameter-abfab-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Application Bridging for Federated Access Beyond Web (ABFAB) architecture provides cross-domain authentication, authorization and accounting functionality by utilizing well-established technologies, such as Diameter, the Extensible Authentication Protocol (EAP), and the Generic Security Services API (GSS-API).</p>
<p>This document defines a Diameter application for usage with the ABFAB architecture to convey authentication information, and authorization decisions from the Diameter server (acting as the identity provider) to the Diameter client (acting as a relying party) encoded in a Security Assertion Markup Language (SAML) encoding.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Application Identifiers</a>
</li>
<li>4.   <a href="#rfc.section.4">Protocol Description</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Session Management</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Session-Termination-Request</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Session-Termination-Answer</a>
</li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Abort-Session-Request</a>
</li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">Abort-Session-Answer</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Accounting for ABFAB services</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Accounting-Request</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Accounting-Answer</a>
</li>
<li>5.   <a href="#rfc.section.5">Command Codes</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Diameter-EAP-Request</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Diameter-EAP-Answer</a>
</li>
<li>6.   <a href="#rfc.section.6">AVPs</a>
</li>
<li>7.   <a href="#rfc.section.7">Result-Code AVP Values</a>
</li>
<li>8.   <a href="#rfc.section.8">AVP Occurrence Tables</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">DER, DEA AVP/Command-Code Table</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Coupled Accounting Model AVP Table</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">AVP Codes</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Application Identifier</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgments</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Application Bridging for Federated Access Beyond Web (ABFAB) architecture <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a> provides cross-domain authentication, authorization and accounting functionality by utilizing well-established technologies, such as Diameter, the Extensible Authentication Protocol (EAP), and the Generic Security Services API (GSS-API).</p>
<p id="rfc.section.1.p.2">The steps taken generally in an ABFAB federated authentication/authorization exchange are as follows: </p>
<p></p>

<ol>
<li>Principal provides NAI to Application: Somehow the client is configured with at least the realm portion of an NAI, which represents the IdP to be discovered.</li>
<li>Authentication mechanism selection: this is the step necessary to indicate that the GSS-EAP SASL/GS2 mechanism will be used for authentication/authorization.  </li>
<li>Client Application provides NAI to RP: At the conclusion of mechanism selection the NAI must be provided to the RP for discovery.  </li>
<li>Discovery of federated IdP: This is discussed in detail below.  Either the RP is configured with authorized IdPs, or it makes use of a federation proxy.  </li>
<li>Request from Relying Party to IdP: Once the RP knows who the IdP is, it or its agent will forward RADIUS request that encapsulates a GSS/EAP access request to an IdP.  This may or may not contain a SAML request as a series of attributes. At this stage, the RP will likely  have no idea who the principal is.  The RP claims its identity to the IdP in AAA attributes, and it makes whatever SAML Attribute Requests through a AAA attribute.  </li>
<li>IdP informs the principal of which EAP method to use: The available and appropriate methods are discussed below in this memo.  </li>
<li>A bunch of EAP messages happen between the endpoints: Messages are exchanged between the principal and the IdP until a result is determined.  The number and content of those messages will depend on the EAP method.  If the IdP is unable to authenticate the principal, the process concludes here.  As part of this process, the principal will, under protection of EAP, assert the identity of the RP to which it intends to authenticate.  </li>
<li>Successful Authentication: At the very least the IdP (its EAP server) and EAP peer / subject have authenticated one another.  As a result of this step, the subject and the IdP hold two cryptographic keys- a Master Session Key (MSK), and an Extended MSK (EMSK).  If the asserted identity of the RP by the principal matches the identity the RP itself asserted, there is some confidence that the RP is now authenticated to the IdP.  </li>
<li>Local IdP Policy Check: At this stage, the IdP checks local policy to determine whether the RP and subject are authorized for a given transaction/service, and if so, what if any, attributes will be released to the RP.  Additional policy checks will likely have been made earlier just through the process of discovery.  </li>
<li>Response from the IdP to the Relying Party: Once the IdP has made a determination of whether and how to authenticate or authorize the principal to the RP, it returns either a negative AAA result to the RP, or it returns a positive result to the RP, along with an optional set of AAA attributes associated with the principal that could include one or more SAML assertions.  In addition, an EAP MSK is returned to the subject.  </li>
<li>RP Processes Results.  When the RP receives the result from the IdP, it should have enough information to either grant or refuse a resource access request.  It may have information that leads it to make additional attribute queries.  It may have information that associates the principal with specific authorization identies.  It will apply these results in an application-specific way.</li>
<li>RP returns results to principal: Once the RP has a response it must inform the client application of the result.  If all has gone well, all are authenticated, and the application proceeds with appropriate authorization levels.  </li>
</ol>

<p> </p>
<div id="#rfc.figure.1"></div>
<div id="#abfab-arch"></div>
<pre>
                                 +--------------+
                                 |  AAA Server  |
                                 |  (Identity   |
                                 |  Provider)   |
                                 +-^----------^-+
                                   * EAP      | RADIUS/
                                   *          | Diameter
                                 --v----------v--
                              ///                \\\
                            //                      \\   ***
                           |        Federation        |  back-
                           |                          |  end
                            \\                      //   ***
                              \\\                ///
                                 --^----------^--
                                   * EAP      | RADIUS/
                 Application       *          | Diameter
+-------------+  Data            +-v----------v--+
|             |&lt;----------------&gt;|               |
| Client      |  EAP/EAP Method  | Server Side   |
| Application |&lt;****************&gt;| Application   |
| @ End Host  |  GSS-API         |(Relying Party)|
|             |&lt;----------------&gt;|               |
|             |  Application     |               |
|             |  Protocol        |               |
|             |&lt;================&gt;|               |
+-------------+                  +---------------+
               *** front-end ***

Legend:

 &lt;****&gt;: End-to-end exchange
 &lt;----&gt;: Hop-by-hop exchange
 &lt;====&gt;: Protocol through which GSS-API/GS2 exchanges are tunnelled
</pre>
<p id="rfc.section.1.p.4">The involved entities are shown in <a href="#abfab-arch">Figure 1</a>.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">This document uses terminology defined <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Application Identifiers</h1>
<p id="rfc.section.3.p.1">This specification defines a new Diameter application and the respective Application Identifier: </p>
<div id="#rfc.figure.2"></div>
<pre> 
   Diameter ABFAB   (ABFAB)  [[TBD by IANA]]

      </pre>
<p></p>
<p id="rfc.section.3.p.3">The Diameter ABFAB related accounting information generated by the Diameter client uses the ABFAB Application Identifier in the case of coupled accounting model. The Diameter Base Accounting Application Identifier (value of 3) is used in case of the split accounting model. Refer to <a href="#accounting_models">Section 4.2</a> for more information regarding the accounting models.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Protocol Description</h1>
<div id="#rfc.figure.3"></div>
<div id="#msg"></div>
<pre>
    Relying Party    Client App       IdP

       |              (1)             | Client App gets NAI (somehow)
       |               |              |
       |&lt;-----(2)-----&gt;|              | Mechanism Selection
       |               |              |
       |&lt;-----(3)-----&lt;|              | NAI transmitted to RP
       |               |              |
       |&lt;=====(4)====================&gt;| Discovery
       |               |              |
       |&gt;=====(5)====================&gt;| Access request from RP to IdP
       |               |              |
       |               |&lt; - - (6) - -&lt;| EAP method to Principal
       |               |              |
       |               |&lt; - - (7) - -&gt;| EAP Exchange to authenticate
       |               |              | Principal
       |               |              |
       |               |           (8 &amp; 9) Local Policy Check
       |               |              |
       |&lt;====(10)====================&lt;| IdP Assertion to RP
       |               |              |
       |               |              | (11) RP Processes results.
       |               |              |
       |&gt;----(12)-----&gt;|              | Results to client app.



     ----- = Between Client App and RP
     ===== = Between RP and IdP
     - - - = Between Client App and IdP



        </pre>
<p></p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Session Management</h1>
<p id="rfc.section.4.1.p.1">The Diameter server may maintain state or may be stateless. This is indicated in the Auth-Session-State AVP (or its absence). The Diameter client MUST support the Authorization Session State Machine defined in <a href="#RFC3588">[RFC3588]</a>.  </p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> Session-Termination-Request</h1>
<p id="rfc.section.4.1.1.p.1">The Session-Termination-Request (STR) message <a href="#RFC3588">[RFC3588]</a> is sent by the Diameter client to inform the Diameter server that an authorized session is being terminated.</p>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> Session-Termination-Answer</h1>
<p id="rfc.section.4.1.2.p.1">The Session-Termination-Answer (STA) message <a href="#RFC3588">[RFC3588]</a> is sent by the Diameter server to acknowledge the notification that the session has been terminated.</p>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> Abort-Session-Request</h1>
<p id="rfc.section.4.1.3.p.1">The Abort-Session-Request (ASR) message <a href="#RFC3588">[RFC3588]</a> is sent by the Diameter server to the Diameter client to terminate the authorized session. When the Diameter client receives the ASR message, it MUST take further actions to terminate the established application context.  </p>
<h1 id="rfc.section.4.1.4">
<a href="#rfc.section.4.1.4">4.1.4.</a> Abort-Session-Answer</h1>
<p id="rfc.section.4.1.4.p.1">The Abort-Session-Answer (ASA) message <a href="#RFC3588">[RFC3588]</a> is sent by the Home Agent in response to an ASR message.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#accounting_models" id="accounting_models">Accounting for ABFAB services</a>
</h1>
<p id="rfc.section.4.2.p.1">The Diameter client collects accounting records needed for service control and charging MUST support the accounting procedures and the Accounting Session State Machine as defined in <a href="#RFC3588">[RFC3588]</a>.</p>
<p id="rfc.section.4.2.p.2">The Diameter application design guideline <a href="#I-D.ietf-dime-app-design-guide">[I-D.ietf-dime-app-design-guide]</a> defines two separate models for accounting:</p>
<p></p>

<dl>
<dt>Split accounting model:</dt>
<dd style="margin-left: 8">
<br><br> According to this model, the accounting messages use the Diameter Base Accounting Application Identifier (value of 3).  Since accounting is treated as an independent application, accounting commands may be routed separately from the rest of application messages and thus the accounting messages generally end up in a central accounting server. Since the Diameter ABFAB application does not define its own unique accounting commands, this is the preferred choice, since it permits use of centralized accounting for several applications.<br><br>
</dd>
<dt>Coupled accounting model:</dt>
<dd style="margin-left: 8">
<br><br> In this model, the accounting messages will use the ABFAB Application Identifiers. This means that accounting messages will be routed like any other Diameter ABFAB application messages. This requires the Diameter server in charge of the Diameter ABFAB application to handle the accounting records (e.g., sends them to a proper accounting server).</dd>
</dl>

<p> </p>
<p id="rfc.section.4.2.p.4">As mentioned above, the preferred choice is to use the split accounting model and thus to choose Diameter Base Accounting Application Identifier (value of 3) for accounting messages.</p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> Accounting-Request</h1>
<p id="rfc.section.4.2.1.p.1">The Accounting-Request command <a href="#RFC3588">[RFC3588]</a> is sent by the Diameter client to the Diameter server to exchange accounting information.</p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> Accounting-Answer</h1>
<p id="rfc.section.4.2.2.p.1">The Accounting-Answer command <a href="#RFC3588">[RFC3588]</a> is sent by the Diameter server to the Diameter client to acknowledge an Accounting-Request.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Command Codes</h1>
<p id="rfc.section.5.p.1">The Diameter ABFAB application defined in this document reuses the Diameter EAP application <a href="#RFC4072">[RFC4072]</a> commands: Diameter-EAP-Request (DER) and Diameter-EAP-Answer (DEA).  This specification extends the existing DER and DEA command ABNFs to offer the necessary ABFAB functionality. Other than new additional AVPs and the corresponding additions to the command ABNFs, the Diameter EAP application command ABNFs remain unchanged. The ABNF language is defined in <a href="#RFC3588">[RFC3588]</a>.  </p>
<div id="#rfc.figure.4"></div>
<div id="#cmd-eap"></div>
<pre>
Command-Name          Abbrev. Code Reference 
---------------------------------------------
Diameter-EAP-Request  DER     268  RFC 4072  
Diameter-EAP-Answer   DEA     268  RFC 4072  
</pre>
<p></p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Diameter-EAP-Request</h1>
<p id="rfc.section.5.1.p.1">The Diameter-EAP-Request (DER) message, indicated by the Command-Code field set to 268 and the 'R' bit set in the Command Flags field, is sent by the Diameter client to the Diameter server to initiate a Diameter ABFAB authentication and authorization procedure. The Application-ID field of the Diameter Header MUST be set to the Diameter ABFAB Application ID (value of TDB).</p>
<div id="#rfc.figure.5"></div>
<pre>
&lt;Diameter-EAP-Request&gt; ::= &lt; Diameter Header: 268, REQ, PXY &gt;
                           &lt; Session-Id &gt;
                           { Auth-Application-Id }
                           { Origin-Host }
                           { Origin-Realm }
                           { Destination-Realm }
                           { Auth-Request-Type }
                           [ Destination-Host ]
                           [ NAS-Identifier ]
                           [ NAS-IP-Address ]
                           [ NAS-IPv6-Address ]
                           [ NAS-Port-Type ]
                           [ User-Name ]
                           ...
                           { EAP-Payload }
                           ...
                           [ SAML-AuthnRequest ]
                           ...
                         * [ AVP ]
</pre>
<p></p>
<p id="rfc.section.5.1.p.3">The SAML-AuthnRequest AVP is only included in the first DER message send by the Diameter client. The user is both authenticated and during the EAP method authentication. Authorization happens immediately after the authentication procedure has been completed.  Thus, the Auth-Request-Type AVP MUST be set to the value AUTHORIZE_AUTHENTICATE.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Diameter-EAP-Answer</h1>
<p id="rfc.section.5.2.p.1">The Diameter-EAP-Answer (DEA) message, indicated by the Command-Code field set to 268 and 'R' bit cleared in the Command Flags field, is sent in response to the Diameter-EAP-Request message (DER). The Application-Id field in the Diameter message header MUST be set to the Diameter ABFAB Application-Id (value of TBD).  </p>
<div id="#rfc.figure.6"></div>
<pre>
&lt;Diameter-EAP-Answer&gt; ::= &lt; Diameter Header: 268, PXY &gt;
                          &lt; Session-Id &gt;
                          { Auth-Application-Id }
                          { Auth-Request-Type }
                          { Result-Code }
                          { Origin-Host }
                          { Origin-Realm }
                          [ User-Name ]
                          [ EAP-Payload ]
                          [ EAP-Reissued-Payload ]
                          [ EAP-Master-Session-Key ]
                          [ EAP-Key-Name ]
                          [ Multi-Round-Time ]
                          ...
                          [ SAML-AuthnResponse ]
                          [ SAML-Assertion ]
                          ...
                        * [ AVP ]                                     
</pre>
<p></p>
<p id="rfc.section.5.2.p.3">SAML related attributes are only included in the final message exchange.  Either the SAML-AuthnResponse AVP is included in the response or a SAML-Assertion but not both.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> AVPs</h1>
<div id="#rfc.figure.7"></div>
<pre>
                                      +--------------------+
                                      |   AVP Flag rules   |
                                      +----+---+------+----+----+
                     AVP              |    |   |SHOULD|MUST|MAY |
 Attribute Name      Code  Value Type |MUST|MAY| NOT  | NOT|Encr|
+-------------------------------------+----+---+------+----+----+
|SAML-Assertion      TBD   UTF8String |    | P |      | V  | Y  |
+-------------------------------------+----+---+------+----+----+
|SAML-AuthnRequest   TBD   UTF8String |    | P |      | V  | Y  |
+-------------------------------------+----+---+------+----+----+
|SAML-AuthnResponse  TBD   UTF8String |    | P |      | V  | Y  |
+-------------------------------------+----+---+------+----+----+
</pre>
<p></p>
<p id="rfc.section.6.p.2">[Editor's Note: SAML encryption requirements are FFS. The "MAY Encr" column in the above table refers to XML-Enc rather than the defunct Diameter AVP encryption.]</p>
<p id="rfc.section.6.p.3">The SAML-Assertion AVP contains the UTF8String encoded SAML assertion.</p>
<p id="rfc.section.6.p.4">The SAML-AuthnRequest AVP contains the UTF8String encoded SAML AuthnRequest message.</p>
<p id="rfc.section.6.p.5">The SAML-AuthnResponse AVP contains the UTF8String encoded SAML AuthnResponse message.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#result" id="result">Result-Code AVP Values</a>
</h1>
<p id="rfc.section.7.p.1">This section defines new Result-Code <a href="#RFC3588">[RFC3588]</a> values that MUST be supported by all Diameter implementations that conform to this specification.</p>
<p id="rfc.section.7.p.2">[Editor's Note: ABFAB specific error values may need to be added here.]</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#avps" id="avps">AVP Occurrence Tables</a>
</h1>
<p id="rfc.section.8.p.1">The following tables present the AVPs defined in this document and their occurrences in Diameter messages.</p>
<p id="rfc.section.8.p.2">The table uses the following symbols:</p>
<p></p>

<dl>
<dt>0:</dt>
<dd style="margin-left: 8">
<br><br>The AVP MUST NOT be present in the message.<br><br>
</dd>
<dt>0+:</dt>
<dd style="margin-left: 8">
<br><br>Zero or more instances of the AVP MAY be present in the message.<br><br>
</dd>
<dt>0-1:</dt>
<dd style="margin-left: 8">
<br><br>Zero or one instance of the AVP MAY be present in the message.<br><br>
</dd>
<dt>1:</dt>
<dd style="margin-left: 8">
<br><br>One instance of the AVP MUST be present in the message. </dd>
</dl>

<p> </p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> DER, DEA AVP/Command-Code Table</h1>
<div id="#rfc.figure.8"></div>
<pre>

                                  +------------+
                                  |Command-Code|       
                                  |-----+------+
   AVP Name                       | DER | DEA  |
   -------------------------------|-----+------+
   SAML-Assertion                 |  0  |  1   |
   SAML-AuthnRequest              |  1  |  0   |
   SAML-AuthnResponse             |  0  |  1   |
                                  +-----+------+
                  </pre>
<p></p>
<p id="rfc.section.8.1.p.2">[Editor's Note: Is it possible to return more than one SAML-Assertion?]</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> Coupled Accounting Model AVP Table</h1>
<p id="rfc.section.8.2.p.1">The table in this section is used to represent which AVPs defined in this document are to be present in the Accounting messages, as defined in <a href="#RFC3588">[RFC3588]</a>.</p>
<div id="#rfc.figure.9"></div>
<pre>
                                           +-------------+
                                           | Command-Code|
                                           |------+------+
      Attribute Name                       |  ACR |  ACA |
      -------------------------------------|------+------+
      Accounting-Input-Octets              | 0-1  |  0-1 |
      Accounting-Input-Packets             | 0-1  |  0-1 |
      Accounting-Output-Octets             | 0-1  |  0-1 |
      Accounting-Output-Packets            | 0-1  |  0-1 |
      Acct-Multi-Session-Id                | 0-1  |  0-1 |
      Acct-Session-Time                    | 0-1  |  0-1 |
      -------------------------------------|------+------+
          </pre>
<p></p>
<p id="rfc.section.8.2.p.3">[Editor's Note: Do we need any application specific accounting messages for ABFAB?]</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">This section contains the namespaces that have either been created in this specification or had their values assigned to existing namespaces managed by IANA.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> AVP Codes</h1>
<p id="rfc.section.9.1.p.1">This specification requires IANA to register the following new AVPs from the AVP Code namespace defined in <a href="#RFC3588">[RFC3588]</a>.<br><br> <br><br>The AVPs are defined in <a href="#avps">Section 8</a>.  </p>

<ul>
<li>SAML-Assertion</li>
<li>SAML-AuthnRequest</li>
<li>SAML-AuthnResponse</li>
</ul>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> Application Identifier</h1>
<p id="rfc.section.9.2.p.1">This specification requires IANA to allocate a new application ID from the Application Identifier namespace defined in <a href="#RFC3588">[RFC3588]</a>.  </p>
<div id="#rfc.figure.10"></div>
<pre> 
Application Identifier             | Value
-----------------------------------+------
Diameter ABFAB (ABFAB)             | TBD

      </pre>
<p></p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Security Considerations</h1>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Acknowledgments</h1>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4072">[RFC4072]</b></td>
<td class="top">
<a>Eronen, P.</a>, <a>Hiller, T.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>", RFC 4072, August 2005.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-dime-app-design-guide">[I-D.ietf-dime-app-design-guide]</b></td>
<td class="top">
<a>Fajardo, V</a>, <a>Tschofenig, H</a> and <a>L Morand</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dime-app-design-guide-12">Diameter Applications Design Guidelines</a>", Internet-Draft draft-ietf-dime-app-design-guide-12, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</b></td>
<td class="top">
<a>Howlett, J</a>, <a>Hartman, S</a>, <a>Tschofenig, H</a> and <a>E Lear</a>, "<a href="http://tools.ietf.org/html/draft-lear-abfab-arch-02">Application Bridging for Federated Access Beyond Web (ABFAB) Architecture</a>", Internet-Draft draft-lear-abfab-arch-02, March 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mark Jones</span> 
	  <span class="n hidden">
		<span class="family-name">Jones</span>
	  </span>
	</span>
	<span class="org vcardline">Bridgewater Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mark@azu.ca">mark@azu.ca</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hannes Tschofenig</span> 
	  <span class="n hidden">
		<span class="family-name">Tschofenig</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Linnoitustie 6</span>

	  <span class="vcardline">
		<span class="locality">Espoo</span>,  
		<span class="region"></span>
		<span class="code">02600</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">Phone: +358 (50) 4871445</span>

<span class="vcardline">EMail: <a href="mailto:Hannes.Tschofenig@gmx.net">Hannes.Tschofenig@gmx.net</a></span>

<span class="vcardline">URI: <a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></span>

  </address>
</div>

</body>
</html>