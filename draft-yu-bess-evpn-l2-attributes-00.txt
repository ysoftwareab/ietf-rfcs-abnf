



BGP Enabled ServiceS                                               T. Yu
Internet-Draft                                       Huawei Technologies
Intended status: Standards Track                        November 3, 2018
Expires: May 7, 2019


     EVPN Layer 2 Attributes Extended Community Usage in EVPN ELAN
                  draft-yu-bess-evpn-l2-attributes-00

Abstract

   This document aims to define a negotiation mechanism for L2
   capabilities in an EVPN ELAN scenario.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on May 7, 2019.

Copyright Notice

   Copyright (c) 2018 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.






Yu                         Expires May 7, 2019                  [Page 1]

Internet-Draft         L2 Attributes in EVPN ELAN          November 2018


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  EVPN Layer 2 Attributes Extended Community  . . . . . . . . .   2
   3.  Control Flags Processing  . . . . . . . . . . . . . . . . . .   3
   4.  L2 MTU Processing . . . . . . . . . . . . . . . . . . . . . .   4
   5.  Other Considerations  . . . . . . . . . . . . . . . . . . . .   4
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   4
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   4
   8.  Normative References  . . . . . . . . . . . . . . . . . . . .   4
   Author's Address  . . . . . . . . . . . . . . . . . . . . . . . .   5

1.  Introduction

   EVPN [RFC7432] is lacking a negotiation mechanism on L2 capabilities.
   If the L2 capablities between Ethernet Segments are different, they
   are not able to communicate properly.

   This document aims to define a negotiation mechanism for L2
   capabilities in an EVPN ELAN scenario.

2.  EVPN Layer 2 Attributes Extended Community

   EVPN Layer 2 Attributes Extended Community is defined in RFC 8214
   [RFC8214].  This document describes the behaviors how it adapts to
   EVPN ELAN.  EVPN Layer 2 Attributes Extended Community is advertised
   along with Ethernet Auto-discovery.  The definition of EVPN Layer 2
   Attributes Extended Community is listed as below for convenience.

                +-------------------------------------------+
                |  Type (0x06) / Sub-type (0x04) (2 octets) |
                +-------------------------------------------+
                |  Control Flags  (2 octets)                |
                +-------------------------------------------+
                |  L2 MTU (2 octets)                        |
                +-------------------------------------------+
                |  Reserved (2 octets)                      |
                +-------------------------------------------+

   Figure 1: EVPN Layer 2 Attributes Extended Community

   The definition of Control Flags is as below:

             0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |   MBZ                 |F|C|MBZ|  (MBZ = MUST Be Zero)
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




Yu                         Expires May 7, 2019                  [Page 2]

Internet-Draft         L2 Attributes in EVPN ELAN          November 2018


   Figure 2: Control Flags

   The P bit and B bit defined in RFC 8214 [RFC8214] must be zero when
   used in ELAN mode.  This is because RFC 7432 has defined ESI Label
   Extended Community to achieve single-active redundancy mode.

   C bit indicates the control word enable status of known unicast
   traffic.  If set to 1, then a control word [RFC4448] MUST be present
   when sending known unicast EVPN packets to this PE.  It is
   recommended that the control word be included in the absence of an
   entropy label [RFC6790].  C bit MUST set 0 if PE has no capability of
   processing control word.  C bit MUST be same across all Ethernet
   Segments within one EVI on a local PE.

   BUM traffic SHOULD NOT include control word when forwarded no matter
   C bit is set to 1 or 0.

   F bit is newly defined to achieve Flow-Aware Transport Labels
   [RFC6391] in EVPN.  It can be used in both EVPN ELAN and VPWS.  When
   F bit is set to 1, the PE announces it has capability of both sending
   and receiving flow label.

   Other bits in Control Flags are reserved for future investigation and
   MUST be zero.

   L2 MTU is a 2-octet value indicating the CE-PE link MTU in bytes.  It
   MUST be same across all ES within one EVI on a local PE.

3.  Control Flags Processing

   When a PE receives Auto-discovery routes, handing procedures of
   Control Word Extended Community is as below: If EVPN Layer 2
   Attributes Extended Community is included, PE MUST validate if
   Control Flags status is same with local behavior.  If there is a is
   mismatch, the local PE MUST NOT add the remote PE as a valid EVPN
   destination for corresponding EVI.

   If local PE does not support EVPN Layer 2 Attributes Extended
   Community, this community MUST be ignored.  If EVPN Layer 2
   Attributes Extended Community is not included, local PE MUST always
   the remote PE as a valid EVPN destination.  When a PE receives A-D
   routes with C or F bits enabled, the behavior will spread to all MAC
   tables towards the corresponding ES.  When interoperating with
   devices not supporting EVPN Layer 2 Attributes Extended Community,
   A-D routes received will not contain such community.  Local PE SHOULD
   assume the behavior of all remote PE is same with local.





Yu                         Expires May 7, 2019                  [Page 3]

Internet-Draft         L2 Attributes in EVPN ELAN          November 2018


   When data plane is not using MPLS, both C and F bit MUST NOT set 1.
   Control word and FAT is only applicable to MPLS data plane.

4.  L2 MTU Processing

   If a non-zero MTU attribute is received, it MUST be checked against
   local MTU value if the local value is not zero.  If there is a
   mismatch, the local PE MUST NOT add the remote PE as the EVPN
   destination.

5.  Other Considerations

   To achieve interoperability with remote PE without support for EVPN
   Layer 2 Attributes Extended Community, a route policy can be
   implemented to specify L2 behavior manually.  This function SHOULD be
   used only for interoperability.  A PE SHOULD NOT overwrite existing
   EVPN Layer 2 Attributes Extended Community in a received route.

   It is strongly encouraged to keep control word and flow label
   behavior consistent within the same EVI.

6.  Security Considerations

   There are no new security considerations due to the text of this
   document.

7.  IANA Considerations

   This document does not make any requests from IANA.

8.  Normative References

   [RFC4448]  Martini, L., Ed., Rosen, E., El-Aawar, N., and G. Heron,
              "Encapsulation Methods for Transport of Ethernet over MPLS
              Networks", RFC 4448, DOI 10.17487/RFC4448, April 2006,
              <https://www.rfc-editor.org/info/rfc4448>.

   [RFC6391]  Bryant, S., Ed., Filsfils, C., Drafz, U., Kompella, V.,
              Regan, J., and S. Amante, "Flow-Aware Transport of
              Pseudowires over an MPLS Packet Switched Network",
              RFC 6391, DOI 10.17487/RFC6391, November 2011,
              <https://www.rfc-editor.org/info/rfc6391>.

   [RFC6790]  Kompella, K., Drake, J., Amante, S., Henderickx, W., and
              L. Yong, "The Use of Entropy Labels in MPLS Forwarding",
              RFC 6790, DOI 10.17487/RFC6790, November 2012,
              <https://www.rfc-editor.org/info/rfc6790>.




Yu                         Expires May 7, 2019                  [Page 4]

Internet-Draft         L2 Attributes in EVPN ELAN          November 2018


   [RFC7432]  Sajassi, A., Ed., Aggarwal, R., Bitar, N., Isaac, A.,
              Uttaro, J., Drake, J., and W. Henderickx, "BGP MPLS-Based
              Ethernet VPN", RFC 7432, DOI 10.17487/RFC7432, February
              2015, <https://www.rfc-editor.org/info/rfc7432>.

   [RFC8214]  Boutros, S., Sajassi, A., Salam, S., Drake, J., and J.
              Rabadan, "Virtual Private Wire Service Support in Ethernet
              VPN", RFC 8214, DOI 10.17487/RFC8214, August 2017,
              <https://www.rfc-editor.org/info/rfc8214>.

Author's Address

   Tianpeng Yu
   Huawei Technologies
   Beijing
   China

   EMail: yutianpeng@huawei.com

































Yu                         Expires May 7, 2019                  [Page 5]
