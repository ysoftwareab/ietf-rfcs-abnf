



6man Working Group                                                 C. Li
Internet-Draft                                       Huawei Technologies
Intended status: Standards Track                                W. Cheng
Expires: March 8, 2021                                      China Mobile
                                                                   Z. Li
                                                                D. Dhody
                                                     Huawei Technologies
                                                       September 4, 2020


                 Encapsulation of Path Segment in SRv6
                draft-li-6man-srv6-path-segment-encap-03

Abstract

   Segment Routing (SR) allows for a flexible definition of end-to-end
   paths by encoding paths as sequences of sub-paths, called "segments".
   Segment routing architecture can be implemented over IPv6 data plane,
   called SRv6.  In some use-cases such as end-to-end SR Path Protection
   and Performance Measurement (PM), SRv6 path need to be identified.
   This document defines the encoding and processing of Path Segment in
   SRv6 networks.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on March 8, 2021.

Copyright Notice

   Copyright (c) 2020 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of



Li, et al.                Expires March 8, 2021                 [Page 1]

Internet-Draft               SRv6 PSID Encap              September 2020


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
     1.2.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Encoding of SRv6 Path Segment . . . . . . . . . . . . . . . .   3
     2.1.  Encapsulation of SRv6 Path Segment  . . . . . . . . . . .   4
     2.2.  Format of SRv6 Path Segment . . . . . . . . . . . . . . .   5
       2.2.1.  SRv6 Path Segment: Locator and Local ID . . . . . . .   5
       2.2.2.  SRv6 Path Segment: Global ID  . . . . . . . . . . . .   5
   3.  Processing of SRv6 Path Segment . . . . . . . . . . . . . . .   6
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   6.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   7
   7.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   7
     7.1.  Normative References  . . . . . . . . . . . . . . . . . .   7
     7.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9

1.  Introduction

   Segment routing (SR) [RFC8402] is a source routing paradigm that
   explicitly indicates the forwarding path for packets at the ingress
   node by inserting an ordered list of instructions, called segments.

   When segment routing is deployed on IPv6 dataplane, it is called SRv6
   [RFC8754], and it uses the a new IPv6 [RFC8200] Extension Header (EH)
   called the IPv6 Segment Routing Header (SRH) [RFC8754] to construct
   SRv6 path.  As per [I-D.ietf-spring-srv6-network-programming], an
   SRv6 segment is a 128-bit value, which can be represented as
   LOC:FUNCT, where LOC is the L most significant bits and FUNCT is the
   128-L least significant bits.  Most often the LOC part of the SID is
   routable and leads to the node which instantiates that SID.  The
   FUNCT part of the SID is an opaque identification of a local function
   bound to the SID.

   In several use cases, such as binding bidirectional path
   [I-D.ietf-pce-sr-bidir-path] and end-to-end performance measurement
   [I-D.gandhi-spring-twamp-srpm], the ability to implement path
   identification is a pre-requisite.  In SRv6, an SRv6 path can be
   identified by the content of the segment list.  However, the segment



Li, et al.                Expires March 8, 2021                 [Page 2]

Internet-Draft               SRv6 PSID Encap              September 2020


   list may not be a good key to identify an SRv6 path, since the length
   of segment list is too long and flexible according to the number of
   SIDs.  Therefore, [I-D.li-spring-srv6-path-segment] defines SRv6 Path
   Segment in order to identify an SRv6 path.

   This document defines the encoding and processing of SRv6 Path
   Segment in SRv6 networks.

1.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

1.2.  Terminology

   PM: Performance Measurement.

   SID: Segment ID.

   SL: Segment List.

   SR: Segment Routing.

   SRH: Segment Routing Header.

   PSID: Path Segment Identifier.

   PSP: Penultimate Segment Popping.

   Further, this document makes use of the terms defined in [RFC8402]
   and [I-D.ietf-spring-srv6-network-programming].

2.  Encoding of SRv6 Path Segment

   This section will describe the encoding of SRv6 Path Segment
   [I-D.li-spring-srv6-path-segment] in SRH.  As per
   [I-D.li-spring-srv6-path-segment], an SRv6 Path Segment is a 128-bits
   value, which identifies an SRv6 path.  Depending on the use case, an
   SRv6 Path Segment can identify:

   o  an SRv6 path within an SRv6 domain

   o  an SRv6 Policy





Li, et al.                Expires March 8, 2021                 [Page 3]

Internet-Draft               SRv6 PSID Encap              September 2020


   o  a Candidate-paths or a SID-List in a SRv6 Policy
      [I-D.ietf-spring-segment-routing-policy].

2.1.  Encapsulation of SRv6 Path Segment

   The SRv6 Path Segment MUST appear only once in a SID list, and it
   MUST appear at the last entry, so the SRv6 Path Segment MUST NOT be
   copied to the IPv6 destination address.  The format of the SRv6 Path
   Segment follows the format described in section 2.2.

   In order to indicate the existence of Path Segment in the SRH, this
   document defines a P-bit in SRH flag field.  The encapsulation of
   SRv6 Path Segment is shown below.

           0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Next Header   |  Hdr Ext Len  | Routing Type  | Segments Left |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Last Entry   |     Flags   |P|              Tag              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |            Segment List[0] (128 bits IPv6 address)            |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |                                                               |
                                     ...
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |          Segment List[n-1] (128 bits IPv6 address)            |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                                                               |
       |    SRv6 Path Segment (Segment List[n],128 bits IPv6 value)    |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       //                                                             //
       //         Optional Type Length Value objects (variable)       //
       //                                                             //
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                   Figure 1. SRv6 Path Segment in SID List



Li, et al.                Expires March 8, 2021                 [Page 4]

Internet-Draft               SRv6 PSID Encap              September 2020


   o  P-bit: set when SRv6 Path Segment is inserted.  It SHOULD be
      ignored when a node does not support SRv6 Path Segment processing.

2.2.  Format of SRv6 Path Segment

   This document proposes two types of SRv6 Path Segment format.

   Editor's Note: Authors would like to request comments of these
   encoding mechanisms of SRv6 Path Segment.  The appropriate encoding
   will be maintained while the rest will be deleted in the future
   version of this document.

2.2.1.  SRv6 Path Segment: Locator and Local ID

   As per [I-D.ietf-spring-srv6-network-programming], an SRv6 segment is
   a 128-bit value, which can be represented as LOC:FUNCT, where LOC is
   the L most significant bits and FUNCT is the 128-L least significant
   bits.  L is called the locator length and is flexible.  Each operator
   is free to use the locator length it chooses.  Most often the LOC
   part of the SID is routable and leads to the node which instantiates
   that SID.  The FUNCT part of the SID is an opaque identification of a
   local function bound to the SID.  The FUNCT value zero is invalid.

   SRv6 Path Segment can follow the format, where the LOC part
   identifies the egress node that allocates the Path Segment, and the
   FUNCT part is an unique local ID to identify an SRv6 Path towards to
   the egress on the egress.

   The Function Type of SRv6 Path Segment is END.PSID (End Function with
   Path Segment Identifier, to be allocated by IANA).

   The proposed P bit can be used to identify that the last SID is an
   SRv6 Path Segment.

    +--------------------------------------------------------------+
    |  Locator              |        Function ID                   |
    +--------------------------------------------------------------+

    |<-------------------------128 bits--------------------------->|

                 Figure 2. PSID in Format LOC:FUNCT

2.2.2.  SRv6 Path Segment: Global ID

   An SRv6 Path Segment ID can be a Global ID, and its format depends on
   the use case.





Li, et al.                Expires March 8, 2021                 [Page 5]

Internet-Draft               SRv6 PSID Encap              September 2020


   The SRv6 Path Segment will not be copied to the IPv6 Destination
   Address, so the SRv6 Path Segment ID can be allocated from an
   independent 128-bits ID Space.  In this case, a new table should be
   maintained at the node for SRv6 Path Segment.  The proposed P bit can
   be used to identify that the last SID is an SRv6 Path Segment and
   need to be looked up in the SRv6 Path Segment table.

    +--------------------------------------------------------------+
    |                         Global ID/PSID                       |
    +--------------------------------------------------------------+

    |<-------------------------128 bits--------------------------->|

                Figure 3. A Global ID as an PSID

3.  Processing of SRv6 Path Segment

   As per [I-D.li-spring-srv6-path-segment], an SRv6 Path Segment is a
   local segment allocated by an egress node.  An SRv6 Path Segment can
   be allocated through several ways, such as CLI, BGP
   [I-D.ietf-idr-sr-policy-path-segment], PCEP
   [I-D.ietf-pce-sr-path-segment] or other means.  The mechanisms
   through which an SRv6 Path Segment is allocated is out of scope of
   this document.

   When the SRv6 Path Segment is allocated by the egress, it MUST be
   distributed to the ingress node.  In this case, only the egress will
   process the SRv6 Path Segment, and other nodes specified by SIDs in
   the SID list do not know how to process the SRv6 Path Segment.

   An SRv6 Path Segment may be distributed to the SRv6 nodes along the
   SRv6 path.  In this case, the SRv6 nodes that learn SRv6 Path Segment
   may process the SRv6 Path Segment depending on the use case.

   When the SRv6 Path Segment is used, the following rules apply:

   o  The SRv6 Path Segment MUST appear only once in a SID list, and it
      MUST appear at the last entry.  Only the one that appears at the
      last entry in the SID list will be processed.  SRv6 Path Segment
      appears at other location in the SID list will be treated as an
      error.

   o  When an SRv6 Path Segment is inserted, the SL MUST be initiated to
      be less than the value of Last Entry, and will not point to SRv6
      Path Segment.  For instance, when the Last entry is 4, the SID
      List[4] is the SRv6 Path Segment, so the SL MUST be set to 3 or
      other numbers less than Last entry.




Li, et al.                Expires March 8, 2021                 [Page 6]

Internet-Draft               SRv6 PSID Encap              September 2020


   o  The SRv6 Path Segment MUST NOT be copied to the IPv6 destination
      address.

   o  Penultimate Segment Popping (PSP, as defined in
      [I-D.ietf-spring-srv6-network-programming]) MUST be disabled.

   o  The ingress needs to set the P-bit when an SRv6 Path Segment is
      inserted in the SID List.  Nodes that supporting SRv6 Path Segment
      processing will inspect the last entry to process SRv6 Path
      Segment when the P-bit is set.  When the P-bit is unset, the nodes
      will not inspect the last entry.

   o  The specific SRv6 Path Segment processing depends on use cases,
      and it is out of scope of this document.

4.  IANA Considerations

   TBA

5.  Security Considerations

   TBA

6.  Acknowledgements

   TBA

7.  References

7.1.  Normative References

   [I-D.ietf-spring-srv6-network-programming]
              Filsfils, C., Camarillo, P., Leddy, J., Voyer, D.,
              Matsushima, S., and Z. Li, "SRv6 Network Programming",
              draft-ietf-spring-srv6-network-programming-18 (work in
              progress), August 2020.

   [I-D.li-spring-srv6-path-segment]
              Li, C., Cheng, W., Chen, M., Dhody, D., and R. Gandhi,
              "Path Segment for SRv6 (Segment Routing in IPv6)", draft-
              li-spring-srv6-path-segment-05 (work in progress), March
              2020.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.




Li, et al.                Expires March 8, 2021                 [Page 7]

Internet-Draft               SRv6 PSID Encap              September 2020


   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8200]  Deering, S. and R. Hinden, "Internet Protocol, Version 6
              (IPv6) Specification", STD 86, RFC 8200,
              DOI 10.17487/RFC8200, July 2017,
              <https://www.rfc-editor.org/info/rfc8200>.

   [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,
              Decraene, B., Litkowski, S., and R. Shakir, "Segment
              Routing Architecture", RFC 8402, DOI 10.17487/RFC8402,
              July 2018, <https://www.rfc-editor.org/info/rfc8402>.

   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,
              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header
              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,
              <https://www.rfc-editor.org/info/rfc8754>.

7.2.  Informative References

   [I-D.gandhi-spring-twamp-srpm]
              Gandhi, R., Filsfils, C., Voyer, D., Chen, M., and B.
              Janssens, "Performance Measurement Using TWAMP Light for
              Segment Routing Networks", draft-gandhi-spring-twamp-
              srpm-10 (work in progress), August 2020.

   [I-D.ietf-idr-sr-policy-path-segment]
              Li, C., Li, Z., Telecom, C., Cheng, W., and K. Talaulikar,
              "SR Policy Extensions for Path Segment and Bidirectional
              Path", draft-ietf-idr-sr-policy-path-segment-01 (work in
              progress), August 2020.

   [I-D.ietf-pce-sr-bidir-path]
              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,
              "PCEP Extensions for Associated Bidirectional Segment
              Routing (SR) Paths", draft-ietf-pce-sr-bidir-path-02 (work
              in progress), March 2020.

   [I-D.ietf-pce-sr-path-segment]
              Li, C., Chen, M., Cheng, W., Gandhi, R., and Q. Xiong,
              "Path Computation Element Communication Protocol (PCEP)
              Extension for Path Segment in Segment Routing (SR)",
              draft-ietf-pce-sr-path-segment-01 (work in progress), May
              2020.






Li, et al.                Expires March 8, 2021                 [Page 8]

Internet-Draft               SRv6 PSID Encap              September 2020


   [I-D.ietf-spring-segment-routing-policy]
              Filsfils, C., Talaulikar, K., Voyer, D., Bogdanov, A., and
              P. Mattes, "Segment Routing Policy Architecture", draft-
              ietf-spring-segment-routing-policy-08 (work in progress),
              July 2020.

Authors' Addresses

   Cheng Li
   Huawei Technologies

   Email: c.l@huawei.com


   Weiqiang Cheng
   China Mobile

   Email: chengweiqiang@chinamobile.com


   Zhenbin Li
   Huawei Technologies
   Huawei Campus, No. 156 Beiqing Rd.
   Beijing  100095
   China

   Email: lizhenbin@huawei.com


   Dhruv Dhody
   Huawei Technologies
   Divyashree Techno Park, Whitefield
   Bangalore  560066
   India

   Email: dhruv.ietf@gmail.com















Li, et al.                Expires March 8, 2021                 [Page 9]
