<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Layer 2 Virtual Private Networks Using BGP for Auto-discovery
      and Signaling</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Layer 2 Virtual Private Networks Using BGP for Auto-discovery
      and Signaling">
<meta name="keywords" content="BGP L2VPN discovery signaling pseudowire">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">K. Kompella</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">B. Kothari</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">R. Cherukuri</td></tr>
<tr><td class="header">Expires: January 15, 2010</td><td class="header">Juniper Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 14, 2009</td></tr>
</table></td></tr></table>
<h1><br />Layer 2 Virtual Private Networks Using BGP for Auto-discovery
      and Signaling<br />draft-kompella-l2vpn-l2vpn-03.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 15, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
	  Layer 2 Virtual Private Networks (L2VPNs) based on Frame
	  Relay or ATM circuits have been around a long time; more
	  recently, Ethernet VPNs, including Virtual Private LAN
	  Service, have become popular.  Traditional L2VPNs often
	  required a separate Service Provider infrastructure for each
	  type, and yet another for the Internet and IP VPNs.  In
	  addition, L2VPN provisioning was cumbersome.  This document
	  presents a new approach to the problem of offering L2VPN
	  services where the L2VPN customer's experience is virtually
	  identical to that offered by traditional Layer 2 VPNs, but
	  such that a Service Provider can maintain a single network
	  for L2VPNs, IP VPNs and the Internet, as well as a common
	  provisioning methodology for all services.
	
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.2.</a>&nbsp;
Advantages of Layer 2 VPNs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.1.</a>&nbsp;
Separation of Administrative Responsibilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.2.2.</a>&nbsp;
Migrating from Traditional Layer 2 VPNs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.2.3.</a>&nbsp;
Privacy of Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">1.2.4.</a>&nbsp;
Layer 3 Independence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">1.2.5.</a>&nbsp;
PE Scaling<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">1.2.6.</a>&nbsp;
Ease of Configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">1.3.</a>&nbsp;
Advantages of Layer 3 VPNs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">1.3.1.</a>&nbsp;
Layer 2 Independence<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">1.3.2.</a>&nbsp;
SP Routing as Added Value<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">1.3.3.</a>&nbsp;
Class-of-Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">1.4.</a>&nbsp;
Multicast Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">1.5.</a>&nbsp;
Conventions used in this document<br />
<a href="#anchor15">2.</a>&nbsp;
Contributors<br />
<a href="#anchor16">3.</a>&nbsp;
Operation of a Layer 2 VPN<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">3.1.</a>&nbsp;
Network Topology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">3.2.</a>&nbsp;
Configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">3.2.1.</a>&nbsp;
CE Configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">3.2.2.</a>&nbsp;
PE Configuration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">3.2.3.</a>&nbsp;
Adding a New Site<br />
<a href="#bgp-proto">4.</a>&nbsp;
PE Information Exchange<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.1.</a>&nbsp;
Circuit Status Vector<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">4.2.</a>&nbsp;
Generalizing the VPN Topology<br />
<a href="#anchor24">5.</a>&nbsp;
Layer 2 Interworking<br />
<a href="#anchor25">6.</a>&nbsp;
Packet Transport<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">6.1.</a>&nbsp;
Layer 2 MTU<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">6.2.</a>&nbsp;
Layer 2 Frame Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">6.3.</a>&nbsp;
IP-only Layer 2 Interworking<br />
<a href="#anchor29">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor30">8.</a>&nbsp;
Acknowledgments<br />
<a href="#IANA">9.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
    The earliest Virtual Private Networks (VPNs) were based on Layer 2
    circuits: X.25, Frame Relay and ATM (see <a class='info' href='#Kosiur'>[Kosiur]<span> (</span><span class='info'>Kosiur, D., &ldquo;Building and Managing Virtual Private Networks,&rdquo; November&nbsp;1996.</span><span>)</span></a>).
    More recently, VPNs based on Ethernet Virtual Local Area Networks
    (VLANs) and Virtual Private LAN Service (VPLS)
    (<a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#RFC4762'>[RFC4762]<span> (</span><span class='info'>Lasserre, M. and V. Kompella, &ldquo;Virtual Private LAN Service (VPLS) Using Label Distribution Protocol (LDP) Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a>) have
    become quite popular.  All of these come under the classification
    of Layer 2 VPNs (L2VPNs), as the customer to Service Provider (SP)
    hand-off is at Layer 2.
  
</p>
<p>
    There are at least two factors that adversely affected the cost of
    offering L2VPNs.  The first is that the easiest way to offer a
    L2VPN of a given type of Layer 2 was over an infrastructure of the
    same type.  This approach required that the Service Provider build
    a separate infrastructure for each Layer 2 encapsulation -- e.g.,
    an ATM infrastructure for ATM VPNs, an Ethernet infrastructure for
    Ethernet VPNs, etc.  In addition, a separate infrastructure was
    needed for the Internet and IP VPNs (<a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a>, and possibly yet another
    for voice services.  Going down this path meant a proliferation of
    networks.
  
</p>
<p>
    The other is that each of these networks had different
    provisioning methodologies.  Furthermore, the provisioning of a
    L2VPN was fairly complex.  It is important to distinguish between
    a single Layer 2 circuit, which connects two customer sites, and a
    Layer 2 VPN, which is a set of circuits that connect sites
    belonging to the same customer.  The fact that two different
    circuits belonged to the same VPN was typically known only to the
    provisioning system, not to the switches offering the service;
    this complicated the setting up, and subsequently, the
    troubleshooting, of a L2VPN.  Also, each switch offering the
    service had to be provisioned with the address of every other
    switch in the same VPN, requiring, in the case of full-mesh VPN
    connectivity, provisioning proportional to the square of the
    number of sites.  This made full-mesh L2VPN connectivity
    prohibitively expensive for the SP, and thus in turn for
    customers.  Finally, even setting up a individual circuit often
    required the provisioning of every switch along the path.
   
</p>
<p>
    Of late, there has been much progress in network "convergence",
    whereby Layer 2 traffic, Internet traffic and IP VPN traffic can
    be carried over a single, consolidated network infrastructure
    based on IP/MPLS tunnels; this is made possible by techniques such
    as those described in <a class='info' href='#RFC4448'>[RFC4448]<span> (</span><span class='info'>Martini, L., Rosen, E., El-Aawar, N., and G. Heron, &ldquo;Encapsulation Methods for Transport of Ethernet over MPLS Networks,&rdquo; April&nbsp;2006.</span><span>)</span></a>,
    <a class='info' href='#RFC4618'>[RFC4618]<span> (</span><span class='info'>Martini, L., Rosen, E., Heron, G., and A. Malis, &ldquo;Encapsulation Methods for Transport of PPP/High-Level Data Link Control (HDLC) over MPLS Networks,&rdquo; September&nbsp;2006.</span><span>)</span></a>, <a class='info' href='#RFC4619'>[RFC4619]<span> (</span><span class='info'>Martini, L., Kawa, C., and A. Malis, &ldquo;Encapsulation Methods for Transport of Frame Relay over Multiprotocol Label Switching (MPLS) Networks,&rdquo; September&nbsp;2006.</span><span>)</span></a>, and
    <a class='info' href='#RFC4717'>[RFC4717]<span> (</span><span class='info'>Martini, L., Jayakumar, J., Bocci, M., El-Aawar, N., Brayley, J., and G. Koleyni, &ldquo;Encapsulation Methods for Transport of Asynchronous Transfer Mode (ATM) over MPLS Networks,&rdquo; December&nbsp;2006.</span><span>)</span></a> for Layer 2 traffic, and
    <a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a> for IP VPN traffic.  This development
    goes a long way toward addressing the problem of network
    profileration.  This document goes one step further and shows how
    a Service Provider can offer Layer 2 VPNs using protocol and
    provisioning methodologies similar to that used for VPLS
    (<a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a>) and IP VPNs (<a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a>),
    thereby achieving a significant degree of operational convergence
    as well.  In particular, all of these methodologies include the
    notion of a VPN identifier that serves to unify components of a
    given VPN, and the concept of auto-discovery, which simplifies the
    provisioning of dense VPN topologies (for example, a full mesh).
    In addition, similar techniques are used in all of the
    above-mentioned VPN technologies to offer inter-AS and
    inter-provider VPNs (i.e., VPNs whose sites are connected to
    multiple Autonomous Systems (ASs) or service providers).
   
</p>
<p>
     Technically, the approach proposed here uses the concepts and
     solution and described in <a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a>, which
     describes VPLS, a particular form of a Layer 2 VPN.  That
     document in turn borrowed much from <a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a>.
     This includes the use of BGP for auto-discovery and
     "demultiplexor" (see below) exchange, and the concepts of Route
     Distinguishers to make VPN advertisements unique, and Route
     Targets to control VPN topology.  In addition, all three
     documents share the idea that routers not directly connected to
     VPN customers should carry no VPN state, restricting the
     provisioning of individual connections to just the edge devices.
     This is achieved by using tunnels to carry the data, with a
     demultiplexor that identifies individual VPN circuits.  These
     tunnels could be based on MPLS, GRE, or any other tunnel
     technology that offers a demultiplexing field; the signaling of
     these tunnels is outside the scope of this document.  The
     specific approach taken here is to use an MPLS label as the
     demultiplexor.
   
</p>
<p>
    Layer 2 VPNs typically require that all sites in the VPN connect
    to the SP with the same Layer 2 encapsulation.  To ease this
    restriction, this document proposes a limited form of Layer 2
    interworking, by restricting the Layer 3 protocol to IP only
    (see Section 5).
   
</p>
<p>
     It may be instructive to compare the approach in
     <a class='info' href='#RFC4447'>[RFC4447]<span> (</span><span class='info'>Martini, L., Rosen, E., El-Aawar, N., Smith, T., and G. Heron, &ldquo;Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP),&rdquo; April&nbsp;2006.</span><span>)</span></a> with the one described here, keeping in
     mind that the solution described therein does not include
     auto-discovery.
   
</p>
<p>
    The rest of this section discusses the relative merits of Layer
    2 and Layer 3 VPNs.  Section 3 describes the operation of a
    Layer 2 VPN.  Section 5 describes IP-only Layer 2 interworking.
    Section 6 describes how the L2 packets are transported across
    the SP network.
  
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Terminology</h3>

<p>
    The terminology used is from <a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a> and
    <a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a>, and is briefly repeated here.  A
    "customer" is a customer of a Service Provider seeking to
    interconnect their various "sites" (each an independent network)
    at Layer 2 through the Service Provider's network, while
    maintaining privacy of communication and address space.  The
    device in a customer site that connects to a Service Provider
    router is termed the CE (customer edge) device; this device may be
    a router or a switch.  The Service Provider router to which a CE
    connects is termed a PE.  A router in the Service Provider's
    network which doesn't connect directly to any CE is termed
    P. Every pair of PEs is connected by a "tunnel"; within a tunnel,
    VPN data is distinguished by a "demultiplexor", which in this
    document is an MPLS label.
   
</p>
<p>
    Each CE within a VPN is assigned a CE ID, a number that uniquely
    identifies a CE within an L2 VPN.  More accurately, the CE ID
    identifies a physical connection from the CE device to the PE,
    since a CE may be connected to multiple PEs (or multiply connected
    to a PE); in such a case, the CE would have a CE ID for each
    connection.  A CE may also be part of many L2 VPNs; it would need
    one (or more) CE ID(s) for each L2 VPN of which it is a member.
    The number space for CE IDs is scoped to a given VPN.
   
</p>
<p>
    In the case of inter-Provider L2 VPNs, there needs to be some
    coordination of allocation of CE IDs.  One solution is to allocate
    ranges for each SP.  Other solutions may be forthcoming.
   
</p>
<p>
    Within each physical connection from a CE to a PE, there may be
    multiple virtual circuits.  These will be referred to as
    Attachment Circuits (ACs), following <a class='info' href='#RFC4447'>[RFC4447]<span> (</span><span class='info'>Martini, L., Rosen, E., El-Aawar, N., Smith, T., and G. Heron, &ldquo;Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP),&rdquo; April&nbsp;2006.</span><span>)</span></a>.
    Similarly, the entity that connects two attachment circuits across
    the Service Provider network is called a pseudo-wire (PW).
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Advantages of Layer 2 VPNs</h3>

<p>
      A Layer 2 VPN is one where a Service Provider provides Layer 2
      connectivity to the customer.  The Service Provider does not
      participate in the customer's Layer 3 network, in particular, in
      the routing, resulting in several advantages to the SP as a
      whole and to PE routers in particular.
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.1"></a><h3>1.2.1.&nbsp;
Separation of Administrative Responsibilities</h3>

<p>
	In a Layer 2 VPN, the Service Provider is responsible for
	Layer 2 connectivity; the customer is responsible for Layer 3
	connectivity, which includes routing.  If the customer says
	that host x in site A cannot reach host y in site B, the
	Service Provider need only demonstrate that site A is
	connected to site B. The details of how routes for host y
	reach host x are the customer's responsibility.
   
</p>
<p>
	Another important factor is that once a PE provides Layer 2
	connectivity to its connected CE, its job is done.  A
	misbehaving CE can at worst flap its interface, but route
	flaps in the customer network have little effect on the SP
	network.  On the other hand, a misbehaving CE in a Layer 3 VPN
	can flap its routes, leading to instability of the PE router
	or even the entire SP network.  Thus, when offering a Layer 3
	VPN, a SP should proactively protect itself from Layer 3
	instability in the CE network.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.2"></a><h3>1.2.2.&nbsp;
Migrating from Traditional Layer 2 VPNs</h3>

<p>
	  Since "traditional" Layer 2 VPNs (i.e., real Frame Relay
	  circuits connecting sites) are indistinguishable from
	  tunnel-based VPNs from the customer's point-of-view,
	  migrating from one to the other raises few issues.  Layer 3
	  VPNs, on the other hand, require a considerable re-design of
	  the customer's Layer 3 routing architecture.  Furthermore,
	  with Layer 3 VPNs, special care has to be taken that routes
	  within the traditional VPN are not preferred over the Layer
	  3 VPN routes (the so-called "backdoor routing" problem,
	  whose solution requires protocol changes that are somewhat
	  ad hoc).
      
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.3"></a><h3>1.2.3.&nbsp;
Privacy of Routing</h3>

<p>
	    In a Layer 2 VPN, the privacy of customer routing is a
	    natural fallout of the fact that the Service Provider does
	    not participate in routing.  The SP routers need not do
	    anything special to keep customer routes separate from
	    other customers or from the Internet; there is no need for
	    per-VPN routing tables, and the additional complexity this
	    imposes on PE routers.
	
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.4"></a><h3>1.2.4.&nbsp;
Layer 3 Independence</h3>

<p>
	      Since the Service Provider simply provides Layer 2
	      connectivity, the customer can run any Layer 3 protocols
	      they choose.  If the SP were participating in customer
	      routing, it would be vital that the customer and SP both
	      use the same Layer 3 protocol(s) and routing protocols.
      
</p>
<p>
	      Note that IP-only Layer 2 interworking doesn't have this
	      benefit as it restricts the Layer 3 to IP only.
      
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.5"></a><h3>1.2.5.&nbsp;
PE Scaling</h3>

<p>
	      In the Layer 2 VPN scheme described below, each PE
	      transmits a single small chunk of information about
	      every CE that the PE is connected to to every other PE.
	      That means that each PE need only maintain a single
	      chunk of information from each CE in each VPN, and keep
	      a single "route" to every site in every VPN.  This means
	      that both the Forwarding Information Base and the
	      Routing Information Base scale well with the number of
	      sites and number of VPNs.  Furthermore, the scaling
	      properties are independent of the customer: the only
	      germane quantity is the total number of VPN sites.
      
</p>
<p>
	      This is to be contrasted with Layer 3 VPNs, where each
	      CE in a VPN may have an arbitrary number of routes that
	      need to be carried by the SP.  This leads to two issues.
	      First, both the information stored at each PE and the
	      number of routes installed by the PE for a CE in a VPN
	      can be (in principle) unbounded, which means in practice
	      that a PE must restrict itself to installing routes
	      associated with the VPNs that it is currently a member
	      of.  Second, a CE can send a large number of routes to
	      its PE, which means that the PE must protect itself
	      against such a condition.  Thus, the SP must enforce
	      limits on the number of routes accepted from a CE; this
	      in turn requires the PE router to offer such control.
      
</p>
<p>
	      The scaling issues of Layer 3 VPNs come into sharp focus
	      at a BGP route reflector (RR).  An RR cannot keep all
	      the advertised routes in every VPN since the number of
	      routes will be too large.  The following
	      solutions/extensions are needed to address this issue:
      
</p>
<p>
	      1.  RRs could be partitioned so that each RR services a
	      subset of VPNs so that no single RR has to carry all the
	      routes.
      
</p>
<p>
	      2.  An RR could use a preconfigured list of
	      Route-Targets for its inbound route filtering.  The RR
	      may choose to perform Route Target Filtering, described
	      in <a class='info' href='#RFC4684'>[RFC4684]<span> (</span><span class='info'>Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk, R., Patel, K., and J. Guichard, &ldquo;Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs),&rdquo; November&nbsp;2006.</span><span>)</span></a>.
      
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2.6"></a><h3>1.2.6.&nbsp;
Ease of Configuration</h3>

<p>
	      Configuring traditional Layer 2 VPNs with dense
	      topologies was a burden primarily because of the O(n*n)
	      nature of the task.  If there are n CEs in a Frame Relay
	      VPN, say full-mesh connected, n*(n-1)/2 DLCI PVCs must
	      be provisioned across the SP network.  At each CE, (n-1)
	      DLCIs must be configured to reach each of the other CEs.
	      Furthermore, when a new CE is added, n new DLCI PVCs
	      must be provisioned; also, each existing CE must be
	      updated with a new DLCI to reach the new CE.  Finally,
	      each PVC requires state in every transit switch.
      
</p>
<p>
	      In our proposal, PVCs are tunnelled across the SP
	      network.  The tunnels used are provisioned independently
	      of the L2VPNs, using signalling protocols (in case of
	      MPLS, LDP or RSVP-TE can be used), or set up by
	      configuration; and the number of tunnels is independent
	      of the number of L2VPNs.  This reduces a large part of
	      the provisioning burden.
      
</p>
<p>
	      Furthermore, we assume that DLCIs at the CE edge are
	      relatively cheap; and VPN labels in the SP network are
	      cheap.  This allows the SP to "over-provision" VPNs: for
	      example, allocate 50 CEs to a VPN when only 20 are
	      needed.  With this over-provisioning, adding a new CE to
	      a VPN requires configuring just the new CE and its
	      associated PE; existing CEs and their PEs need not be
	      re-configured.  Note that if DLCIs at the CE edge are
	      expensive, e.g. if these DLCIs are provisioned across a
	      switched network, one could provision them as and when
	      needed, at the expense of extra configuration.  This
	      need not still result in extra state in the SP network,
	      i.e. an intelligent implementation can allow
	      overprovisioning of the pool of VPN labels.
      
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Advantages of Layer 3 VPNs</h3>

<p>
      Layer 3 VPNs (<a class='info' href='#RFC4364'>[RFC4364]<span> (</span><span class='info'>Rosen, E. and Y. Rekhter, &ldquo;BGP/MPLS IP Virtual Private Networks (VPNs),&rdquo; February&nbsp;2006.</span><span>)</span></a> in particular) offer a
      good solution when the customer traffic is wholly IP, customer
      routing is reasonably simple, and the customer sites connect to
      the SP with a variety of Layer 2 technologies.
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.1"></a><h3>1.3.1.&nbsp;
Layer 2 Independence</h3>

<p>
	One major restriction in a Layer 2 VPN is that the Layer 2
	medium with which the various sites of a single VPN connect to
	the SP must be uniform.  On the other hand, the various sites
	of a Layer 3 VPN can connect to the SP with any supported
	media; for example, some sites may connect with Frame Relay
	circuits, and others with Ethernet.
   
</p>
<p>
	This restriction of Layer 2 VPN is alleviated by the IP-only
	Layer 2 interworking proposed in this document.  This comes at
	the cost of losing the Layer 3 independence.
   
</p>
<p>
	A corollary to this is that the number of sites that can be in
	a Layer 2 VPN is determined by the number of Layer 2 circuits
	that the Layer 2 technology provides.  For example, if the
	Layer 2 technology is Frame Relay with 2-octet DLCIs, a CE can
	connect to at most about a thousand other CEs in a VPN.
      
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.2"></a><h3>1.3.2.&nbsp;
SP Routing as Added Value</h3>

<p>
   Another problem with Layer 2 VPNs is that the CE router in a VPN must
   be able to deal with having N routing peers, where N is the number of
   sites in the VPN.  This can be alleviated by manipulating the
   topology of the VPN.  For example, a hub-and-spoke VPN architecture
   means that only one CE router (the hub) needs to deal with N
   neighbors.  However, in a Layer 3 VPN, a CE router need only deal
   with one neighbor, the PE router.  Thus, the SP can offer Layer 3
   VPNs as a value-added service to its customers.
   
</p>
<p>
   Moreover, with Layer 2 VPNs it is up to a customer to build and
   operate the whole network.  With Layer 3 VPNs, a customer is just
   responsible for building and operating routing within each site,
   which is likely to be much simpler than building and operating
   routing for the whole VPN.  That, in turn, makes Layer 3 VPNs more
   suitable for customers who don't have sufficient routing expertise,
   again allowing the SP to provide added value.
   
</p>
<p>
   As mentioned later, multicast routing and forwarding is another
   value-added service that an SP can offer.
      
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3.3"></a><h3>1.3.3.&nbsp;
Class-of-Service</h3>

<p>
   Class-of-Service issues have been addressed for Layer 3 VPNs.  Since
   the PE router has visibility into the network Layer (IP), the PE
   router can take on the tasks of CoS classification and routing.  This
   restriction on Layer 2 VPNs is again eased in the case of IP-only
   Layer 2 interworking, as the PE router has visibility into the
   network Layer (IP).
      
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Multicast Routing</h3>

<p>
   There are two aspects to multicast routing that we will consider.  On
   the protocol front, supporting IP multicast in a Layer 3 VPN requires
   PE routers to participate in the multicast routing instance of the
   customer, and thus keep some related state information.
    
</p>
<p>
   In the Layer 2 VPN case, the CE routers run native multicast routing
   directly.  The SP network just provides pipes to connect the CE
   routers; PEs are unaware whether the CEs run multicast or not, and
   thus do not have to participate in multicast protocols or keep
   multicast state information.
    
</p>
<p>
   On the forwarding front, in a Layer 3 VPN, CE routers do not
   replicate multicast packets; thus, the CE-PE link carries only one
   copy of a multicast packet.  Whether replication occurs at the
   ingress PE, or somewhere within the SP network depends on the
   sophistication of the Layer 3 VPN multicast solution.  The simple
   solution where a PE replicates packets for each of its CEs may place
   considerable burden on the PE.  More complex solutions may require
   VPN multicast state in the SP network, but may significantly reduce
   the traffic in the SP network by delaying packet replication until
   needed.
    
</p>
<p>
   In a Layer 2 VPN, packet replication occurs at the CE.  This has
   the advantage of distributing the burden of replication among the
   CEs rather than focusing it on the PE to which they are attached,
   and thus will scale better.  However, the CE-PE link will need to
   carry the multiple copies of multicast packets.  In the case of
   Virtual Private LAN Service (a specific type of L2 VPN; see
   <a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a>), however, the CE-PE link need transport
   only one copy of a multicast packet.
    
</p>
<p>
   Thus, just as in the case of unicast routing, the SP has the choice
   to offer a value-added service (multicast routing and forwarding) at
   some cost (multicast state and packet replication) using a Layer 3
   VPN, or to keep it simple and use a Layer 2 VPN.
    
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Conventions used in this document</h3>

<p>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Contributors</h3>

<p>
   The following contributed to this document.
  
</p>
<p>
   Manoj Leelanivas, Juniper Networks <br />

   Quaizar Vohra, Juniper Networks <br />

   Javier Achirica, Consultant <br />

   Ronald Bonica, Juniper Networks <br />

   Dave Cooper, Global Crossing <br />

   Chris Liljenstolpe, Telstra <br />

   Eduard Metz, KPN Dutch Telecom <br />

   Hamid Ould-Brahim, Nortel <br />

   Chandramouli Sargor <br />

   Himanshu Shah, Ciena <br />

   Vijay Srinivasan <br />

   Zhaohui Zhang, Juniper Networks
   
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Operation of a Layer 2 VPN</h3>

<p>
   The following simple example of a customer with 4 sites connected to
   3 PE routers in a Service Provider network will hopefully illustrate
   the various aspects of the operation of a Layer 2 VPN.  For
   simplicity, we assume that a full-mesh topology is desired.
  
</p>
<p>
   In what follows, Frame Relay serves as the Layer 2 medium, and each
   CE has multiple DLCIs to its PE, each to connect to another CE in the
   VPN.  If the Layer 2 medium were ATM, then each CE would have
   multiple VPI/VCIs to connect to other CEs.  For PPP and Cisco HDLC,
   each CE would have multiple physical interfaces to connect to other
   CEs.  In the case of IP-only Layer 2 interworking, each CE could have
   a mix of one or more of the above Layer 2 mediums to connect to other
   CEs.
   
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Network Topology</h3>

<p>
   Consider a Service Provider network with edge routers PE0, PE1, and
   PE2.  Assume that PE0 and PE1 are IGP neighbors, and PE2 is more than
   one hop away from PE0.
    
</p>
<p>
   Suppose that a customer C has 4 sites S0, S1, S2 and S3 that C
   wants to connect via the Service Provider's network using Frame
   Relay.  Site S0 has CE0 and CE1 both connected to PE0.  Site S1 has
   CE2 connected to PE0.  Site S2 has CE3 connected to PE1 and CE4
   connected to PE2.  Site S3 has CE5 connected to PE2.  (See
   <a class='info' href='#fig1'>Figure&nbsp;1<span> (</span><span class='info'>Example Network Topology</span><span>)</span></a> below.)  Suppose further that C wants to
   "over-provision" each current site, in expectation that the number
   of sites will grow to at least 10 in the near future.  However, CE4
   is only provisioned with 9 DLCIs.  (Note that the signalling
   mechanism discussed in Section 4 will allow a site to grow in terms
   of connectivity to other sites at a later point of time at the cost
   of additional signalling, i.e., over- provisioning is not a must
   but a recommendation).
    
</p>
<p>
   Suppose finally that CE0 and CE2 have DLCIs 100 through 109
   provisioned; CE1 and CE3 have DLCIs 200 through 209 provisioned; CE4
   has DLCIs 107, 209, 265, 301, 414, 555, 654, 777 and 888 provisioned;
   and CE5 has DLCIs 417-426.
    
</p>
<p>
      <br /><hr class="insert" />
<a name="fig1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           S0                                                   S3
     ..............                                       ..............
     .            .                                       .            .
     .    +-----+ .                                       .            .
     .    | CE0 |-----------+                             .   +-----+  .
     .    +-----+ .         |                             .   | CE5 |  .
     .            .         |                             .   +--+--+  .
     .    +-----+ .         |                             .      |     .
     .    | CE1 |-------+   |                             .......|......
     .    +-----+ .     |   |                                   /
     .            .     |   |                                  /
     ..............     |   |                                 /
                        |   |         SP Network             /
                   .....|...|.............................../.....
                   .    |   |                              /     .
                   .  +-+---+-+       +-------+           /      .
                   .  |  PE0  |-------|   P   |--        |       .
                   .  +-+---+-+       +-------+  \       |       .
                   .   /    \                     \  +---+---+   .
                   .  |      -----+                --|  PE2  |   .
                   .  |           |                  +---+---+   .
                   .  |       +---+---+                 /        .
                   .  |       |  PE1  |                /         .
                   .  |       +---+---+               /          .
                   .  |            \                 /           .
                   ...|.............|.............../.............
                      |             |              /
                      |             |             /
                      |             |            /
          S1          |             |    S2     /
     ..............   |     ........|........../......
     .            .   |     .       |         |      .
     .    +-----+ .   |     .    +--+--+   +--+--+   .
     .    | CE2 |-----+     .    | CE3 |   | CE4 |   .
     .    +-----+ .         .    +-----+   +-----+   .
     .            .         .                        .
     ..............         ..........................

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Example Network Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Configuration</h3>

<p>
   The following sub-sections detail the configuration that is needed to
   provision the above VPN.  For the purpose of exposition, we assume
   that the customer will connect to the SP with Frame Relay circuits.
   
</p>
<p>
   While we focus primarily on the configuration that an SP has to do,
   we touch upon the configuration requirements of CEs as well.  The
   main point of contact in CE-PE configuration is that both must agree
   on the DLCIs that will be used on the interface connecting them.
   
</p>
<p>
   If the PE-CE connection is Frame Relay, it is recommended to run LMI
   between the PE and CE.  For the case of ATM VCs, OAM cells may be
   used; for PPP and Cisco HDLC, keepalives may be used directly between
   CEs; however, in this case, PEs would not have visibility as to the
   liveness of customers circuits.
   
</p>
<p>
   In case of IP-only Layer 2 interworking, if CE1, attached to PE0,
   connects to CE3, attached to PE1, via a L2VPN circuit, the Layer 2
   medium between CE1 and PE0 is independent of the Layer 2 medium
   between CE3 and PE1.  Each side will run its own Layer 2 specific
   link management protocol, e.g., LMI, LCP, etc.  PE0 will inform PE1
   about the status of its local circuit to CE1 via the circuit status
   vector TLV defined in Section 4.  Similarly PE1 will inform PE0 about
   the status of its local circuit to CE3.
    
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
CE Configuration</h3>

<p>
   Each CE that belongs to a VPN is given a "CE ID".  CE IDs must be
   unique in the context of a VPN.  For the example, we assume that the
   CE ID for CE-k is k.
   
</p>
<p>
   Each CE is configured to communicate with its corresponding PE with
   the set of DLCIs given above; for example, CE0 is configured with
   DLCIs 100 through 109.  In general, a CE is configured with a list of
   circuits, all with the same Layer 2 encapsulation type, e.g., DLCIs,
   VCIs, physical PPP interface etc.  (IP-only Layer 2 interworking
   allows a mix of Layer 2 encapsulation types).  The size of this list/
   set determines the number of remote CEs a given CE can communicate
   with.  Denote the size of this list/set as the CE's range.  A CE's
   range must be at least the number of remote CEs that the CE will
   connect to in a given VPN; if the range exceeds this, then the CE is
   over-provisioned, in anticipation of growth of the VPN.
   
</p>
<p>
   Each CE also "knows" which DLCI connects it to each other CE.  The
   methodology followed in this example is to use the CE ID of the other
   CE as an index into the DLCI list this CE has (with zero-based
   indexing, i.e., 0 is the first index).  For example, CE0 is connected
   to CE3 through its fourth DLCI, 103; CE4 is connected to CE2 by the
   third DLCI in its list, namely 265.  This is just the methodology
   used in the example below; the actual methodology used to pick the
   DLCI to be used is a local matter; the key factor is that CE-k may
   communicate with CE-m using a different DLCI from the DLCI that CE-m
   uses to communicate to CE-k, i.e., the SP network effectively acts as
   a giant Frame Relay switch.  This is very important, as it decouples
   the DLCIs used at each CE site, making for much simpler provisioning.
      
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
PE Configuration</h3>

<p>
   Each PE is configured with the VPNs in which it participates.  Each
   VPN is associated with one or more Route Target communities
   <a class='info' href='#RFC4360'>[RFC4360]<span> (</span><span class='info'>Sangli, S., Tappan, D., and Y. Rekhter, &ldquo;BGP Extended Communities Attribute,&rdquo; February&nbsp;2006.</span><span>)</span></a> which serve to define the topology of the
   VPN.  For each VPN, the PE must determine a Route Distinguisher
   (RD) to use; this may either be configured or chosen by the PE.
   RDs do not have to be unique across the VPN.  For each CE attached
   to the PE in a given VPN, the PE must know the set of virtual
   circuits (DLCI, VCI/VPI or VLAN) connecting it to the CE, and a CE
   ID identifying the CE within the VPN.  CE IDs must be unique in the
   context of a given VPN.
      
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.3"></a><h3>3.2.3.&nbsp;
Adding a New Site</h3>

<p>
   The first step in adding a new site to a VPN is to pick a new CE ID.
   If all current members of the VPN are over-provisioned, i.e., their
   range includes the new CE ID, adding the new site is a purely local
   task.  Otherwise, the sites whose range doesn't include the new CE ID
   and wish to communicate directly with the new CE must have their
   ranges increased by allocating additional local circuits to
   incorporate the new CE ID.
   
</p>
<p>
   The next step is ensuring that the new site has the required
   connectivity.  This usually requires adding a new virtual circuit
   between the PE and CE; in most cases, this configuration is limited
   to the PE in question.
   
</p>
<p>
   The rest of the configuration is a local matter between the new CE
   and the PE to which it is attached.
   
</p>
<p>
   It bears repeating that the key to making additions easy is over-
   provisioning and the algorithm for mapping a CE-id to a DLCI which is
   used for connecting to the corresponding CE.  However, what is being
   over-provisioned is the number of DLCIs/VCIs that connect the CE to
   the PE.  This is a local matter between the PE and CE, and does not
   affect other PEs or CEs.
      
</p>
<a name="bgp-proto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
PE Information Exchange</h3>

<p>
    When a PE is configured with all the required information for a
    CE, it advertises to other PEs the fact that it is participating
    in a VPN via BGP messages, as per <a class='info' href='#RFC4761'>[RFC4761]<span> (</span><span class='info'>Kompella, K. and Y. Rekhter, &ldquo;Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling,&rdquo; January&nbsp;2007.</span><span>)</span></a>,
    section 3.  BGP was chosen as the means for exchanging L2 VPN
    information for two reasons: it offers mechanisms for both
    auto-discovery and signaling, and allows for operational
    convergence, as explained in Section 1.  A bonus for using BGP is
    a robust inter-AS solution for L2VPNs.
  
</p>
<p>
    There are two modifications to the formating of messages.  The
    first is that the set of Encaps Types carried in the L2-info
    extended community has been expanded to include those from
    <a class='info' href='#tab1'>Table&nbsp;1<span> (</span><span class='info'>Encaps Types</span><span>)</span></a>.  The value of the Encaps Type field
    identifies the Layer 2 encapsulation, e.g., ATM, Frame Relay etc.
  
</p>
<p>
    <br /><hr class="insert" />
<a name="tab1"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Encaps Type</th><th align="left">Description</th><th align="left">Reference</th></tr>
<tr>
<td align="left">0</td>
<td align="left">Reserved</td>
<td align="left">-</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">Frame Relay</td>
<td align="left">RFC 4446</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">ATM AAL5 SDU VCC transport</td>
<td align="left">RFC 4446</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">ATM transparent cell transport</td>
<td align="left">RFC 4816</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">Ethernet (VLAN) Tagged Mode</td>
<td align="left">RFC 4448</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">Ethernet Raw Mode</td>
<td align="left">RFC 4448</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">Cisco HDLC</td>
<td align="left">RFC 4618</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left">PPP</td>
<td align="left">RFC 4618</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">SONET/SDH Circuit Emulation Service</td>
<td align="left">RFC 4842</td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">ATM n-to-one VCC cell transport</td>
<td align="left">RFC 4717</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">ATM n-to-one VPC cell transport</td>
<td align="left">RFC 4717</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">IP Layer 2 Transport</td>
<td align="left">RFC 3032</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">Frame Relay Port mode</td>
<td align="left">RFC 4619</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">Structure-agnostic E1 over packet</td>
<td align="left">RFC 4553</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">Structure-agnostic T1 (DS1) over packet</td>
<td align="left">RFC 4553</td>
</tr>
<tr>
<td align="left">19</td>
<td align="left">VPLS</td>
<td align="left">RFC 4761</td>
</tr>
<tr>
<td align="left">20</td>
<td align="left">Structure-agnostic T3 (DS3) over packet</td>
<td align="left">RFC 4553</td>
</tr>
<tr>
<td align="left">21</td>
<td align="left">Nx64kbit/s Basic Service using Structure-aware</td>
<td align="left">RFC 5086</td>
</tr>
<tr>
<td align="left">25</td>
<td align="left">Frame Relay DLCI</td>
<td align="left">RFC 4619</td>
</tr>
<tr>
<td align="left">40</td>
<td align="left">Structure-agnostic E3 over packet</td>
<td align="left">RFC 4553</td>
</tr>
<tr>
<td align="left">41 (1)</td>
<td align="left">Octet-aligned payload for Structure-agnostic DS1 circuits</td>
<td align="left">RFC 4553</td>
</tr>
<tr>
<td align="left">42 (2)</td>
<td align="left">E1 Nx64kbit/s with CAS using Structure-aware</td>
<td align="left">RFC 5086</td>
</tr>
<tr>
<td align="left">43</td>
<td align="left">DS1 (ESF) Nx64kbit/s with CAS using Structure-aware</td>
<td align="left">RFC 5086</td>
</tr>
<tr>
<td align="left">44</td>
<td align="left">DS1 (SF) Nx64kbit/s with CAS using Structure-aware</td>
<td align="left">RFC 5086</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Encaps Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


    
<p>
      Note (1): Allocation of a separate code point for Encaps Type
      eliminates the need for TDM payload size.
    
</p>
    
<p>
      Note (2): Having separate code points for Encaps Types 42-44
      allows specifying the trunk framing (i.e, E1, T1 ESF or T1 SF)
      with CAS.
    
</p>
    
<p>
      The second is the introduction of TLVs (Type-Length-Value
      triplets) in the VPLS NLRI.  L2VPN TLVs can be added to extend
      the information carried in the NLRI, using the format shown in
      <a class='info' href='#fig3'>Figure&nbsp;2<span> (</span><span class='info'>Format of TLVs</span><span>)</span></a>.  In L2VPN TLVs, Type is 1 octet, Length
      is 2 octets and represents the size of the Value field in bits.
    
</p>
    
<p>
      <br /><hr class="insert" />
<a name="fig3"></a>
</p>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 +------+--------+------------...-------+
 | Type | Length | Value ...            |
 +------+--------+------------...-------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Format of TLVs&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
    <br /><hr class="insert" />
<a name="tab2"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center">
<tr><th align="center">TLV Type</th><th align="center">Description</th></tr>
<tr>
<td align="center">1</td>
<td align="center">Circuit Status Vector</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: TLV Types&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

  

<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Circuit Status Vector</h3>

<p>
   This sub-TLV carries the status of a L2VPN PVC between a pair of PEs.
   Note that a L2VPN PVC is bidirectional, composed of two simplex
   connection going in opposite directions.  A simplex connection
   consists of the 3 segments: 1) the local access circuit between the
   source CE and the ingress PE, 2) the tunnel LSP between the ingress
   and egress PEs, and 3) the access circuit between the egress PE and
   the destination CE.
   
</p>
<p>
   To monitor the status of a PVC, a PE needs to monitor the status of
   both simplex connections.  Since it knows that status of its access
   circuit, and the status of the tunnel towards the remote PE, it can
   inform the remote PE of these two.  Similarly, the remote PE can
   inform the status of its access circuit to its local CE and the
   status of the tunnel to the first PE.  Combining the local and the
   remote information, a PE can determine the status of a PVC.
   
</p>
<p>
   The basic unit of advertisement in L2VPN for a given CE is a label-
   block.  Each label within a label-block corresponds to a PVC on the
   CE.  The local status information for all PVCs corresponding to a
   label-block is advertised along with the NLRI for the label-block
   using the status vector TLV.  The Type field of this TLV is 1.  The
   Length field of the TLV specifies the length of the value field in
   bits.  The Value field of this TLV is a bit-vector, each bit of which
   indicates the status of the PVC associated with the corresponding
   label in the label-block.  Bit value 0 corresponds to the PVC
   associated with the first label in the label block, and indicates
   that the local circuit and the tunnel LSP to the remote PE is up,
   while a value of 1 indicates that either or both of them are down.
   The Value field is padded to the nearest octet boundary.
   
</p>
<p>
   If PE A receives an L2VPN NLRI, while selecting a label from a label-
   block (advertised by PE B, for remote CE m, and VPN X) for one of its
   local CE n (in VPN X) can also determine the status of the
   corresponding PVC (between CE n and CE m) by looking at the
   appropriate bit in the circuit status vector.
    
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Generalizing the VPN Topology</h3>

<p>
   In the above, we assumed for simplicity that the VPN was a full mesh.
   To allow for more general VPN topologies, a mechanism based on
   filtering on BGP extended communities can be used (see Section 4).
    
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Layer 2 Interworking</h3>

<p>
   As defined so far in this document, all CE-PE connections for a given
   Layer 2 VPN must use the same Layer 2 encapsulation, e.g., they must
   all be Frame Relay.  This is often a burdensome restriction.  One
   answer is to use an existing Layer 2 interworking mechanism, for
   example, Frame Relay-ATM interworking.
  
</p>
<p>
   In this document, we take a different approach: we postulate that the
   network Layer is IP, and base Layer 2 interworking on that.  Thus,
   one can choose between pure Layer 2 VPNs, with a stringent Layer 2
   restriction but with Layer 3 independence, or a Layer 2 interworking
   VPNs, where there is no restriction on Layer 2, but Layer 3 must be
   IP.  Of course, a PE may choose to implement Frame Relay-ATM
   interworking.  For example, an ATM Layer 2 VPN could have some CEs
   connect via Frame Relay links, if their PE could translate Frame
   Relay to ATM transparent to the rest of the VPN.  This would be
   private to the CE-PE connection, and such a course is outside the
   scope of this document.
  
</p>
<p>
   For Layer 2 interworking as defined here, when an IP packet arrives
   at a PE, its Layer 2 address is noted, then all Layer 2 overhead is
   stripped, leaving just the IP packet.  Then, a VPN label is added,
   and the packet is encapsulated in the PE-PE tunnel (as required by
   the tunnel technology).  Finally, the packet is forwarded.  Note that
   the forwarding decision is made on the basis of the Layer 2
   information, not the IP header.  At the egress, the VPN label
   determines to which CE the packet must be sent, and over which
   virtual circuit; from this, the egress PE can also determine the
   Layer 2 encapsulation to place on the packet once the VPN label is
   stripped.
  
</p>
<p>
   An added benefit of restricting interworking to IP only as the Layer
   3 technology is that the provider's network can provide IP Diffserv
   or any other IP based QOS mechanism to the L2VPN customer.  The
   ingress PE can set up IP/TCP/UDP based classifiers to do DiffServ
   marking, and other functions like policing and shaping on the L2
   circuits of the VPN customer.  Note the division of labor: the CE
   determines the destination CE, and encodes that in the Layer 2
   address.  The ingress PE thus determines the egress PE and VPN label
   based on the Layer 2 address supplied by the CE, but the ingress PE
   can choose the tunnel to reach the egress PE (in the case that there
   are different tunnels for each CoS/DiffServ code point), or the CoS
   bits to place in the tunnel (in the case where a single tunnel
   carries multiple CoS/DiffServ code points) based on its own
   classification of the packet.
  
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Packet Transport</h3>

<p>
   When a packet arrives at a PE from a CE in a Layer 2 VPN, the Layer 2
   address of the packet identifies to which other CE the packet is
   destined.  The procedure outlined above installs a route that maps
   the Layer 2 address to a tunnel (which identifies the PE to which the
   destination CE is attached) and a VPN label (which identifies the
   destination CE).  If the egress PE is the same as the ingress PE, no
   tunnel or VPN label is needed.
  
</p>
<p>
   The packet may then be modified (depending on the Layer 2
   encapsulation).  In case of IP-only Layer 2 interworking, the Layer 2
   header is completely stripped off till the IP header.  Then, a VPN
   label and tunnel encapsulation are added as specified by the route
   described above, and the packet is sent to the egress PE.
  
</p>
<p>
   If the egress PE is the same as the ingress, the packet "arrives"
   with no labels.  Otherwise, the packet arrives with the VPN label,
   which is used to determine which CE is the destination CE.  The
   packet is restored to a fully-formed Layer 2 packet, and then sent to
   the CE.
   
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Layer 2 MTU</h3>

<p>
   This document requires that the Layer 2 MTU configured on all the
   access circuits connecting CEs to PEs in a L2VPN be the same.  This
   can be ensured by passing the configured Layer 2 MTU in the Layer2-
   info extended community when advertising L2VPN label-blocks.  On
   receiving L2VPN label-block from remote PEs in a VPN, the MTU value
   carried in the Layer2-info extendend community should be compared
   against the configured value for the VPN.  If they don't match, then
   the label-block should be ignored.
    
</p>
<p>
   The MTU on the Layer 2 access links MUST be chosen such that the size
   of the L2 frames plus the L2VPN header does not exceed the MTU of the
   SP network.  Layer 2 frames that exceed the MTU after encapsulation
   MUST be dropped.  For the case of IP-only Layer 2 interworking the IP
   MTU on the Layer 2 access link must be chosen such that the size of
   the IP packet and the L2VPN header does not exceed the MTU of the SP
   network.
   
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Layer 2 Frame Format</h3>

<p>
   The modification to the Layer 2 frame depends on the Layer 2 type.
   This document requires that the encapsulation methods used in
   transporting of Layer 2 frames over tunnels be the same as
   described in <a class='info' href='#RFC4448'>[RFC4448]<span> (</span><span class='info'>Martini, L., Rosen, E., El-Aawar, N., and G. Heron, &ldquo;Encapsulation Methods for Transport of Ethernet over MPLS Networks,&rdquo; April&nbsp;2006.</span><span>)</span></a>, <a class='info' href='#RFC4618'>[RFC4618]<span> (</span><span class='info'>Martini, L., Rosen, E., Heron, G., and A. Malis, &ldquo;Encapsulation Methods for Transport of PPP/High-Level Data Link Control (HDLC) over MPLS Networks,&rdquo; September&nbsp;2006.</span><span>)</span></a>,
   <a class='info' href='#RFC4619'>[RFC4619]<span> (</span><span class='info'>Martini, L., Kawa, C., and A. Malis, &ldquo;Encapsulation Methods for Transport of Frame Relay over Multiprotocol Label Switching (MPLS) Networks,&rdquo; September&nbsp;2006.</span><span>)</span></a>, and <a class='info' href='#RFC4717'>[RFC4717]<span> (</span><span class='info'>Martini, L., Jayakumar, J., Bocci, M., El-Aawar, N., Brayley, J., and G. Koleyni, &ldquo;Encapsulation Methods for Transport of Asynchronous Transfer Mode (ATM) over MPLS Networks,&rdquo; December&nbsp;2006.</span><span>)</span></a>, except in
   the case of IP-only Layer 2 Interworking which is described next.
    
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
IP-only Layer 2 Interworking</h3>

<p>
      <br /><hr class="insert" />
<a name="fig2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      +----------------------------+
      | Tunnel |  VPN  |    IP     |     VPN label is the
      | Encap  | Label |  Packet   |     demultiplexing field
      +----------------------------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Format of IP-only Layer 2 interworking packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

    
</p>
<p>
   At the ingress PE, an L2 frame's L2 header is completely stripped
   off and is carried over as an IP packet within the SP network
   (<a class='info' href='#fig2'>Figure&nbsp;3<span> (</span><span class='info'>Format of IP-only Layer 2 interworking packet</span><span>)</span></a>).  The forwarding decision is still based
   on the L2 address of the incoming L2 frame.  At the egress PE, the
   IP packet is encapsulated back in an L2 frame and transported over
   to the destination CE.  The forwarding decision at the egress PE is
   based on the VPN label as before.  The L2 technology between egress
   PE and CE is independent of the L2 technology between ingress PE
   and CE.
    
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
    RFC 4761, on which this document is based, has a detailed
    discussion of security considerations, most of which apply to this
    document as well.  No new security concerns are introduced in this
    document.
  
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p>
    The authors would like to thank Chaitanya Kodeboyina, Dennis
    Ferguson, Der-Hwa Gan, Dave Katz, Nischal Sheth, John Stewart, and
    Paul Traina for the enlightening discussions that helped shape the
    ideas presented here, and Ross Callon for his valuable comments.
  
</p>
<p>
    The idea of using extended communities for more general
    connectivity of a Layer 2 VPN was a contribution by Yakov Rekhter,
    who also gave many useful comments on the text; many thanks to
    him.
  
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
    IANA is requested to create two new registries: one for the Encaps
    Type field of the L2-info extended community, and the other for
    TLVs of the L2VPN NLRI.  Both of these are defined in
    <a class='info' href='#bgp-proto'>Section&nbsp;4<span> (</span><span class='info'>PE Information Exchange</span><span>)</span></a>; proposed values for these fields are
    also defined in the same section, in <a class='info' href='#tab1'>Table&nbsp;1<span> (</span><span class='info'>Encaps Types</span><span>)</span></a> and
    <a class='info' href='#tab2'>Table&nbsp;2<span> (</span><span class='info'>TLV Types</span><span>)</span></a>.
  
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4360">[RFC4360]</a></td>
<td class="author-text">Sangli, S., Tappan, D., and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4360">BGP Extended Communities Attribute</a>,&rdquo; RFC&nbsp;4360, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4360.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4364">[RFC4364]</a></td>
<td class="author-text">Rosen, E. and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>,&rdquo; RFC&nbsp;4364, February&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4364.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4446">[RFC4446]</a></td>
<td class="author-text">Martini, L., &ldquo;<a href="http://tools.ietf.org/html/rfc4446">IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)</a>,&rdquo; BCP&nbsp;116, RFC&nbsp;4446, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4446.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4448">[RFC4448]</a></td>
<td class="author-text">Martini, L., Rosen, E., El-Aawar, N., and G. Heron, &ldquo;<a href="http://tools.ietf.org/html/rfc4448">Encapsulation Methods for Transport of Ethernet over MPLS Networks</a>,&rdquo; RFC&nbsp;4448, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4448.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4618">[RFC4618]</a></td>
<td class="author-text">Martini, L., Rosen, E., Heron, G., and A. Malis, &ldquo;<a href="http://tools.ietf.org/html/rfc4618">Encapsulation Methods for Transport of PPP/High-Level Data Link Control (HDLC) over MPLS Networks</a>,&rdquo; RFC&nbsp;4618, September&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4618.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4619">[RFC4619]</a></td>
<td class="author-text">Martini, L., Kawa, C., and A. Malis, &ldquo;<a href="http://tools.ietf.org/html/rfc4619">Encapsulation Methods for Transport of Frame Relay over Multiprotocol Label Switching (MPLS) Networks</a>,&rdquo; RFC&nbsp;4619, September&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4619.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4717">[RFC4717]</a></td>
<td class="author-text">Martini, L., Jayakumar, J., Bocci, M., El-Aawar, N., Brayley, J., and G. Koleyni, &ldquo;<a href="http://tools.ietf.org/html/rfc4717">Encapsulation Methods for Transport of Asynchronous Transfer Mode (ATM) over MPLS Networks</a>,&rdquo; RFC&nbsp;4717, December&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4717.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4761">[RFC4761]</a></td>
<td class="author-text">Kompella, K. and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4761">Virtual Private LAN Service (VPLS) Using BGP for Auto-Discovery and Signaling</a>,&rdquo; RFC&nbsp;4761, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4761.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4447">[RFC4447]</a></td>
<td class="author-text">Martini, L., Rosen, E., El-Aawar, N., Smith, T., and G. Heron, &ldquo;<a href="http://tools.ietf.org/html/rfc4447">Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)</a>,&rdquo; RFC&nbsp;4447, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4447.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4762">[RFC4762]</a></td>
<td class="author-text">Lasserre, M. and V. Kompella, &ldquo;<a href="http://tools.ietf.org/html/rfc4762">Virtual Private LAN Service (VPLS) Using Label Distribution Protocol (LDP) Signaling</a>,&rdquo; RFC&nbsp;4762, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4762.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4684">[RFC4684]</a></td>
<td class="author-text">Marques, P., Bonica, R., Fang, L., Martini, L., Raszuk, R., Patel, K., and J. Guichard, &ldquo;<a href="http://tools.ietf.org/html/rfc4684">Constrained Route Distribution for Border Gateway Protocol/MultiProtocol Label Switching (BGP/MPLS) Internet Protocol (IP) Virtual Private Networks (VPNs)</a>,&rdquo; RFC&nbsp;4684, November&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4684.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Kosiur">[Kosiur]</a></td>
<td class="author-text">Kosiur, D., &ldquo;Building and Managing Virtual Private Networks,&rdquo; November&nbsp;1996.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kireeti Kompella</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juniper Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1194 N. Mathilda Ave.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sunnyvale, CA  94089</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kireeti@juniper.net">kireeti@juniper.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bhupesh Kothari</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juniper Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1194 N. Mathilda Ave.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sunnyvale, CA  94089</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bhupesh@juniper.net">bhupesh@juniper.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rao Cherukuri</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juniper Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1194 N. Mathilda Ave.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sunnyvale, CA  94089</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cherukuri@juniper.net">cherukuri@juniper.net</a></td></tr>
</table>
</body></html>
