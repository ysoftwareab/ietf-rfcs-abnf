<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Encryption of Header Extensions in the Secure Real-Time Transport Protocol (SRTP) </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Encryption Mechanism">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Example Encryption Mask">
<link href="#rfc.section.4" rel="Chapter" title="4 Signaling (Setup) Information">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Backward compatibility">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Test Vectors">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Key derivation test vectors">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Header Encryption Test Vectors using AES-CM">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Changes From Earlier Versions">
<link href="#rfc.appendix.Appendix%20B.1" rel="Chapter" title="Appendix B.1 Changes from draft-ietf-avtcore -00">
<link href="#rfc.appendix.Appendix%20B.2" rel="Chapter" title="Appendix B.2 Changes from draft-lennox-avtcore -00">
<link href="#rfc.appendix.Appendix%20B.3" rel="Chapter" title="Appendix B.3 Changes from draft-lennox-avt -02">
<link href="#rfc.appendix.Appendix%20B.4" rel="Chapter" title="Appendix B.4 Changes From Individual Submission Draft -01">
<link href="#rfc.appendix.Appendix%20B.5" rel="Chapter" title="Appendix B.5 Changes From Individual Submission Draft -00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Secure Real-Time Transport Protocol (SRTP) provides authentication, but not encryption, of the headers of Real-Time Transport Protocol (RTP) packets.  However, RTP header extensions may carry sensitive information for which participants in multimedia sessions want confidentiality.  This document provides a mechanism, extending the mechanisms of SRTP, to selectively encrypt RTP header extensions in SRTP." />
  <meta name="description" content="The Secure Real-Time Transport Protocol (SRTP) provides authentication, but not encryption, of the headers of Real-Time Transport Protocol (RTP) packets.  However, RTP header extensions may carry sensitive information for which participants in multimedia sessions want confidentiality.  This document provides a mechanism, extending the mechanisms of SRTP, to selectively encrypt RTP header extensions in SRTP." />
  <meta name="keywords" content="real-time transport protocol, rtp, header extensions, security" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">AVTCORE</td>
<td class="right">J. Lennox</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Vidyo</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">October 29, 2011</td>
</tr>
<tr>
<td class="left">Expires: May 01, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Encryption of Header Extensions in the Secure Real-Time Transport Protocol (SRTP) <br />
  <span class="filename">draft-ietf-avtcore-srtp-encrypted-header-ext-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Secure Real-Time Transport Protocol (SRTP) provides authentication, but not encryption, of the headers of Real-Time Transport Protocol (RTP) packets.  However, RTP header extensions may carry sensitive information for which participants in multimedia sessions want confidentiality.  This document provides a mechanism, extending the mechanisms of SRTP, to selectively encrypt RTP header extensions in SRTP.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 01, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Encryption Mechanism</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Example Encryption Mask</a>
</li>
<li>4.   <a href="#rfc.section.4">Signaling (Setup) Information</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Backward compatibility</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Test Vectors</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Key derivation test vectors</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Header Encryption Test Vectors using AES-CM</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Changes From Earlier Versions</a>
</li>
<li>Appendix B.1.   <a href="#rfc.appendix.Appendix%20B.1">Changes from draft-ietf-avtcore -00</a>
</li>
<li>Appendix B.2.   <a href="#rfc.appendix.Appendix%20B.2">Changes from draft-lennox-avtcore -00</a>
</li>
<li>Appendix B.3.   <a href="#rfc.appendix.Appendix%20B.3">Changes from draft-lennox-avt -02</a>
</li>
<li>Appendix B.4.   <a href="#rfc.appendix.Appendix%20B.4">Changes From Individual Submission Draft -01</a>
</li>
<li>Appendix B.5.   <a href="#rfc.appendix.Appendix%20B.5">Changes From Individual Submission Draft -00</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The <a href="#RFC3711">Secure Real-Time Transport Protocol</a> <cite title="NONE">[RFC3711]</cite> specification provides confidentiality, message authentication, and replay protection for multimedia payloads sent using of the <a href="#RFC3550">Real-Time Protocol (RTP)</a> <cite title="NONE">[RFC3550]</cite>.  However, in order to preserve RTP header compression efficiency, SRTP provides only authentication and replay protection for the headers of RTP packets, not confidentiality.  </p>
<p id="rfc.section.1.p.2">For the standard portions of an RTP header, this does not normally present a problem, as the information carried in an RTP header does not provide much information beyond that which an attacker could infer by observing the size and timing of RTP packets.  Thus, there is little need for confidentiality of the header information.</p>
<p id="rfc.section.1.p.3">However, this is not necessarily true for information carried in RTP header extensions.  A number of recent proposals for header extensions using the <a href="#RFC5285">General Mechanism for RTP Header Extensions</a> <cite title="NONE">[RFC5285]</cite> carry information for which confidentiality could be desired or essential.  Notably, two recent drafts (<a href="#I-D.ietf-avtext-client-to-mixer-audio-level">[I-D.ietf-avtext-client-to-mixer-audio-level]</a> and <a href="#I-D.ietf-avtext-mixer-to-client-audio-level">[I-D.ietf-avtext-mixer-to-client-audio-level]</a>) carry information about per-packet sound levels of the media data carried in the RTP payload, and exposing this to an eavesdropper may be unacceptable in many circumstances.</p>
<p id="rfc.section.1.p.4">This document, therefore, defines a mechanism by which encryption can be applied to RTP header extensions when they are transported using SRTP.  As an RTP sender may wish some extension information to be sent in the clear (for example, it may be useful for a network monitoring device to be aware of <a href="#RFC5450">RTP transmission time offsets</a> <cite title="NONE">[RFC5450]</cite>), this mechanism can be selectively applied to a subset of the header extension elements carried in an SRTP packet.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite> and indicate requirement levels for compliant implementations.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#mechanism" id="mechanism">Encryption Mechanism</a>
</h1>
<p id="rfc.section.3.p.1">Encrypted header extension elements are carried in the same manner as non-encrypted header extension elements, as defined by <a href="#RFC5285">[RFC5285]</a>.  The (one- or two-byte) header of the extension elements is not encrypted, nor is any of the header extension padding.  If multiple different header extension elements are being encrypted, they have separate element identifier values, just as they would if they were not encrypted; similarly, encrypted and non-encrypted header extension elements have separate identifier values.</p>
<p id="rfc.section.3.p.2">Encrypted extension headers are only carried in packets encrypted using the <a href="#RFC3711">Secure Real-Time Transport Protocol</a> <cite title="NONE">[RFC3711]</cite>.  To encrypt (or decrypt) encrypted extension headers, an SRTP participant first uses the SRTP Key Derivation Algorithm, specified in Section 4.3.1 of <a href="#RFC3711">[RFC3711]</a>, to generate header encryption and header salting keys, using the same pseudo-random function family as are used for the key derivation for the SRTP session.  These keys are derived as follows: </p>

<ul>
<li>k_he (SRTP header encryption): &lt;label&gt; = 0x06, n=n_e.</li>
<li>k_hs (SRTP header salting key): &lt;label&gt; = 0x07, n=n_s.</li>
</ul>

<p> where n_e and n_s are from the cryptographic context: the same size encryption key and salting key are used as are used for the SRTP payload.  (Note that since RTP headers, including extension headers, are authenticated in SRTP, no new authentication key is needed for extension headers.) </p>
<p id="rfc.section.3.p.3">For SRTP encryption transforms that operate by generating a keystream, a header keystream is generated for each packet containing an encrypted header, using the same encryption transform and Initialization Vector (IV) as is used for the SRTP payload, except that the SRTP encryption and salting keys k_e and k_s are replaced by the SRTP header encryption and header salting keys k_he and k_hs, respectively.</p>
<p id="rfc.section.3.p.4">The AES-CM and AES-f8 transforms defined in <a href="#RFC3711">[RFC3711]</a> both operate in this keystream mode, as do the AES_192_CM and AES_256_CM transforms defined in <a href="#RFC6188">[RFC6188]</a>.  For other transforms (for example, Authenticated Encryption with Associated Data (AEAD) cryptographic transforms, such as <a href="#I-D.ietf-avt-srtp-aes-gcm">AES_GCM and AES_CCM</a> <cite title="NONE">[I-D.ietf-avt-srtp-aes-gcm]</cite>) their usage of header extensions MUST be specified explicitly.  (As of this writing, it is believed that it will be sufficient for SRTP packets protected with AEAD transforms to use a CM transform with equivalent algorithms and key lengths for their encrypted headers; however, this guidance is not normative.)</p>
<p id="rfc.section.3.p.5">Once the header keystream is generated, the SRTP participant then computes an encryption mask for the header extension, identifying the portions of the header extension that are, or are to be, encrypted.  This encryption mask corresponds to the entire payload of each header extension element that is encrypted.  It does not include any non-encrypted header extension elements, any extension element headers, or any padding octets.  The encryption mask has all-bits-1 octets (i.e., hexadecimal 0xff) for header extension octets which are to be encrypted, and all-bits-0 octets for header extension octets which are not to be.</p>
<p id="rfc.section.3.p.6">For those octets indicated in the encryption mask, the SRTP participant bitwise exclusive-ors the header extension with the keystream to produce the ciphertext version of the header extension.  Those octets not indicated in the encryption mask are left unmodified.  Thus, conceptually, the encryption mask is logically ANDed with the keystream to produce a masked keystream.  The sender and receiver MUST use the same encryption mask.  The set of extension elements to be encrypted is communicated between the sender and the receiver using the signaling mechanisms described in <a href="#signaling">Section 4</a>.</p>
<p id="rfc.section.3.p.7">The SRTP authentication tag is computed across the encrypted header extension, i.e., the data that is actually transmitted on the wire.  Thus, header extension encryption MUST be done before the authentication tag is computed, and authentication tag validation MUST be done on the encrypted header extensions.  For receivers, header extension decryption SHOULD be done only after the receiver has validated the packet's message authentication tag, and the receiver MUST NOT take any actions based on decrypted headers that could affect the security or proper functioning of the system, prior to validating the authentication tag.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#example" id="example">Example Encryption Mask</a>
</h1>
<p id="rfc.section.3.1.p.1">If a sender wished to send a header extension containing an encrypted <a href="#RFC5484">SMPTE timecode</a> <cite title="NONE">[RFC5484]</cite> with ID 1, a plaintext <a href="#RFC5450">transmission time offset</a> <cite title="NONE">[RFC5450]</cite> with ID 2, an encrypted <a href="#I-D.ietf-avtext-client-to-mixer-audio-level">audio level indication</a> <cite title="NONE">[I-D.ietf-avtext-client-to-mixer-audio-level]</cite> with ID 3, and an encrypted <a href="#RFC6051">NTP Timestamp</a> <cite title="NONE">[RFC6051]</cite> with ID 4, the plaintext RTP header extension might look like this:</p>
<div id="#rfc.figure.1"></div>
<div id="#plaintext"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  ID=1 | len=7 |     SMTPE timecode (long form)                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       SMTPE timecode (continued)                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| SMTPE (cont'd)|  ID=2 | len=2 | toffset                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| toffset (ct'd)|  ID=3 | len=0 | audio level   |  ID=4 | len=6 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       NTP Timestamp (Variant B)                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       NTP Timestamp (Variant B, cont.)        | padding = 0   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

</pre>
<p id="rfc.section.3.1.p.2">The corresponding encryption mask would then be:</p>
<div id="#rfc.figure.2"></div>
<div id="#mask"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0 0 0 0 0|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 1 1 1 1 1 1 1|0 0 0 0 0 0 0 0|0 0 0 0 0 0 0 0|0 0 0 0 0 0 0 0|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0 0 0 0 0|0 0 0 0 0 0 0 0|1 1 1 1 1 1 1 1|0 0 0 0 0 0 0 0|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|1 1 1 1 1 1 1 1|0 0 0 0 0 0 0 0|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.3.1.p.3">In the mask, the octets corresponding to the payloads of the encrypted header extension elements are set to all-1 values, and octets corresponding to non-encrypted elements, element headers, and header extension padding are set to all-0 values.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#signaling" id="signaling">Signaling (Setup) Information</a>
</h1>
<p id="rfc.section.4.p.1">Encrypted header extension elements are signaled in the SDP extmap attribute, using the URI "urn:ietf:params:rtp-hdrext:encrypt", followed by the URI of the header extension element being encrypted as well as any extensionattributes that extension normally takes.  Thus, for example, to signal an SRTP session using encrypted <a href="#RFC5484">SMPTE timecodes</a> <cite title="NONE">[RFC5484]</cite>, while simultaneously signaling plaintext <a href="#RFC5450">transmission time offsets</a> <cite title="NONE">[RFC5450]</cite>, an SDP document could contain (line breaks added for formatting):</p>
<div id="#rfc.figure.3"></div>
<div id="#exthdr"></div>
<pre>
m=audio 49170 RTP/SAVP 0
a=crypto:1 AES_CM_128_HMAC_SHA1_32 \
  inline:NzB4d1BINUAvLEw6UzF3WSJ+PSdFcGdUJShpX1Zj|2^20|1:32
a=extmap:1 urn:ietf:params:rtp-hdrext:encrypt \
    urn:ietf:params:rtp-hdrext:smpte-tc 25@600/24
a=extmap:2 urn:ietf:params:rtp-hdrext:toffset

</pre>
<p id="rfc.section.4.p.2">This example uses <a href="#RFC4568">SDP Security Descriptions</a> <cite title="NONE">[RFC4568]</cite> for SRTP keying, but this is merely for illustration; any SRTP keying mechanism to establish session keys will work.</p>
<p id="rfc.section.4.p.3">The extmap SDP attribute is defined in <a href="#RFC5285">[RFC5285]</a> as being either a session or media attribute.  If the extmap for an encrypted header extension is specified as a media attribute, it MUST only be specified for media which use SRTP-based RTP profiles.  If such an extmap is specified as a session attribute, there MUST be at least one media in the SDP session which uses an SRTP-based RTP profile; the session-level extmap applies to all the SRTP-based media in the session, and MUST be ignored for all other (non-SRTP or non-RTP) media.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Backward compatibility</h1>
<p id="rfc.section.4.1.p.1">Following the procedures in <a href="#RFC5285">[RFC5285]</a>, an SDP endpoint which does not understand the "urn:ietf:params:rtp-hdrext:encrypt" extension URI will ignore the extension, and (for SDP offer/answer) negotiate not to use it.</p>
<p id="rfc.section.4.1.p.2">In a negotiated session (whether using offer/answer or some other means), best-effort encryption of a header extension element is possible: an endpoint MAY offer the same header extension element both encrypted and unencrypted.  Receivers which understand header extension encryption SHOULD choose the encrypted form and mark the unencrypted form "inactive", unless they have an explicit reason to prefer the unencrypted form.  (Note that, as always, users of best-effort encryption MUST be cautious of bid-down attacks, and ensure, for example, that signaling is integrity-protected.)</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The security properties of header extension elements protected by the mechanism in this document are equivalent to those for SRTP payloads.</p>
<p id="rfc.section.5.p.2">The mechanism defined in this document does not provide confidentiality about which header extension elements are used for a given SRTP packet, only for the content of those header extension elements.  This appears to be in the spirit of SRTP itself, which does not encrypt RTP headers.  If this is a concern, an alternate mechanism would be needed to provide confidentiality.</p>
<p id="rfc.section.5.p.3">For the two-byte-header form of header extension elements (0x100x), this mechanism does not provide any protection to zero-length header extension elements (for which their presence or absence is the only information they carry).  It also does not provide any protection for the two-byte-headers' app bits (field 256, the lowest four bits of the "defined by profile" field).  Neither of these features are used in for one-byte-header form of header extension elements (0xBEDE), so these limitations do not apply in that case.</p>
<p id="rfc.section.5.p.4">This document does not specify the circumstances in which extension header encryption should be used.  Documents defining specific header extension elements should provide guidance on when encryption is appropriate for these elements.</p>
<p id="rfc.section.5.p.5">If a middlebox does not have access to the SRTP authentication keys, it has no way to verify the authenticity of unencrypted RTP header extension elements (or the unencrypted RTP header), even though it can monitor them.  Therefore, such middleboxes MUST treat such headers as untrusted and potentially generated by an attacker.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This document defines a new extension URI to the RTP Compact Header Extensions subregistry of the Real-Time Transport Protocol (RTP) Parameters registry, according to the following data:</p>
<p></p>

<dl>
<dt>Extension URI:</dt>
<dd style="margin-left: 8">urn:ietf:params:rtp-hdrext:encrypt</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Encrypted extension header element</dd>
<dt>Contact:</dt>
<dd style="margin-left: 8">jonathan@vidyo.com</dd>
<dt>Reference:</dt>
<dd style="margin-left: 8">RFC XXXX</dd>
</dl>

<p> </p>
<p id="rfc.section.6.p.3">(Note to the RFC-Editor: please replace "XXXX" with the number of this document prior to publication as an RFC.)</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Acknowledgments</h1>
<p id="rfc.section.7.p.1">Thanks to Roni Even, Kevin Igoe, David McGrew, David Singer, Qin Wu, and Felix Wyss for their comments and suggestions in the development of this specification.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5285">[RFC5285]</b></td>
<td class="top">
<a>Singer, D.</a> and <a>H. Desineni</a>, "<a href="http://tools.ietf.org/html/rfc5285">A General Mechanism for RTP Header Extensions</a>", RFC 5285, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3711">[RFC3711]</b></td>
<td class="top">
<a>Baugher, M.</a>, <a>McGrew, D.</a>, <a>Naslund, M.</a>, <a>Carrara, E.</a> and <a>K. Norrman</a>, "<a href="http://tools.ietf.org/html/rfc3711">The Secure Real-time Transport Protocol (SRTP)</a>", RFC 3711, March 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6188">[RFC6188]</b></td>
<td class="top">
<a>McGrew, D.</a>, "<a href="http://tools.ietf.org/html/rfc6188">The Use of AES-192 and AES-256 in Secure RTP</a>", RFC 6188, March 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5450">[RFC5450]</b></td>
<td class="top">
<a>Singer, D.</a> and <a>H. Desineni</a>, "<a href="http://tools.ietf.org/html/rfc5450">Transmission Time Offsets in RTP Streams</a>", RFC 5450, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-avtext-client-to-mixer-audio-level">[I-D.ietf-avtext-client-to-mixer-audio-level]</b></td>
<td class="top">
<a>Lennox, J</a>, <a>Ivov, E</a> and <a>E Marocco</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avtext-client-to-mixer-audio-level-06">A Real-Time Transport Protocol (RTP) Header Extension for Client-to- Mixer Audio Level Indication</a>", Internet-Draft draft-ietf-avtext-client-to-mixer-audio-level-06, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4568">[RFC4568]</b></td>
<td class="top">
<a>Andreasen, F.</a>, <a>Baugher, M.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc4568">Session Description Protocol (SDP) Security Descriptions for Media Streams</a>", RFC 4568, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-avtext-mixer-to-client-audio-level">[I-D.ietf-avtext-mixer-to-client-audio-level]</b></td>
<td class="top">
<a>Ivov, E</a>, <a>Marocco, E</a> and <a>J Lennox</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avtext-mixer-to-client-audio-level-06">A Real-Time Transport Protocol (RTP) Header Extension for Mixer-to- Client Audio Level Indication</a>", Internet-Draft draft-ietf-avtext-mixer-to-client-audio-level-06, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5484">[RFC5484]</b></td>
<td class="top">
<a>Singer, D.</a>, "<a href="http://tools.ietf.org/html/rfc5484">Associating Time-Codes with RTP Streams</a>", RFC 5484, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6051">[RFC6051]</b></td>
<td class="top">
<a>Perkins, C.</a> and <a>T. Schierl</a>, "<a href="http://tools.ietf.org/html/rfc6051">Rapid Synchronisation of RTP Flows</a>", RFC 6051, November 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-avt-srtp-aes-gcm">[I-D.ietf-avt-srtp-aes-gcm]</b></td>
<td class="top">
<a>McGrew, D</a> and <a>K Igoe</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avt-srtp-aes-gcm-02">AES-GCM and AES-CCM Authenticated Encryption in Secure RTP (SRTP)</a>", Internet-Draft draft-ietf-avt-srtp-aes-gcm-02, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Test Vectors</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> <a href="#kdatestvect" id="kdatestvect">Key derivation test vectors</a>
</h1>
<p id="rfc.section.Appendix A.1.p.1">This section provides test data for the header extension key derivation function, using AES-128 in Counter Mode.  (The algorithms and keys used are the same as those for the the test vectors in Appendix B.3 of <a href="#RFC3711">[RFC3711]</a>.)</p>
<p id="rfc.section.Appendix A.1.p.2">The inputs to the key derivation function are the 16 octet master key and the 14 octet master salt: </p>

<ul class="empty">
<li>master key:  E1F97A0D3E018BE0D64FA32C06DE4139</li>
<li>master salt: 0EC675AD498AFEEBB6960B3AABE6</li>
</ul>

<p> </p>
<p id="rfc.section.Appendix A.1.p.3">Following <a href="#RFC3711">[RFC3711]</a>, the input block for AES-CM is generated by exclusive-oring the master salt with the concatenation of the encryption key label 0x06 with (index DIV kdr), then padding on the right with two null octets (which implements the multiply-by-2^16 operation, see Section 4.3.3 of <a href="#RFC3711">[RFC3711]</a>).  The resulting value is then AES-CM- encrypted using the master key to get the cipher key.</p>
<div id="#rfc.figure.4"></div>
<pre>
  index DIV kdr:                    000000000000
  label:                          06
  master salt:      0EC675AD498AFEEBB6960B3AABE6
  --------------------------------------------------
  xor:              0EC675AD498AFEEDB6960B3AABE6     (x, PRF input)

  x*2^16:           0EC675AD498AFEEDB6960B3AABE60000 (AES-CM input)

  hdr. cipher key:  549752054D6FB708622C4A2E596A1B93 (AES-CM output)
</pre>
<p id="rfc.section.Appendix A.1.p.4">Next, we show how the cipher salt is generated.  The input block for AES-CM is generated by exclusive-oring the master salt with the concatenation of the encryption salt label.  That value is padded and encrypted as above.</p>
<div id="#rfc.figure.5"></div>
<pre>
  index DIV kdr:                    000000000000
  label:                          07
  master salt:      0EC675AD498AFEEBB6960B3AABE6

  --------------------------------------------------
  xor:              0EC675AD498AFEECB6960B3AABE6     (x, PRF input)

  x*2^16:           0EC675AD498AFEECB6960B3AABE60000 (AES-CM input)

                    AB01818174C40D39A3781F7C2D270733 (AES-CM ouptut)

  hdr. cipher salt: AB01818174C40D39A3781F7C2D27
</pre>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Header Encryption Test Vectors using AES-CM</h1>
<p id="rfc.section.Appendix A.2.p.1">This section provides test vectors for the encryption of a header extension, using the AES_CM cryptographic transform.</p>
<p id="rfc.section.Appendix A.2.p.2">The header extension element is encrypted using the header cipher key and header cipher salt computed in <a href="#kdatestvect">Appendix Appendix A.1</a>.</p>
<div id="#rfc.figure.6"></div>
<pre>
    Session Key:      549752054D6FB708622C4A2E596A1B93
    Session Salt:     AB01818174C40D39A3781F7C2D27

    SSRC:                     CAFEBABE
    Rollover Counter:                 00000000
    Sequence Number:                          1234
    ----------------------------------------------
    Init. Counter:    AB018181BE3AB787A3781F7C3F130000
</pre>
<p id="rfc.section.Appendix A.2.p.3">The RTP session was negotiated to indicate that header extension ID values 1, 3 and 4 are encrypted.</p>
<p id="rfc.section.Appendix A.2.p.4">In hexidecimal, the header extension being encrypted is (spaces added to show the internal structure of the header extension):</p>
<div id="#rfc.figure.7"></div>
<pre>
  17 414273A475262748 22 0000C8 30 8E 46 55996386B395FB 00
</pre>
<p id="rfc.section.Appendix A.2.p.5">This header extension is 24 bytes long.  (Its values are intended to represent plausible values of the header extension elements shown in <a href="#example">Section 3.1</a>, but their specific meaning is not important for the example.)</p>
<p id="rfc.section.Appendix A.2.p.6">In hexidecimal, the corresponding encryption mask selecting the bodies of header extensions 1, 2, and 4 (corresponding to the mask in <a href="#mask">Figure 2</a> is:</p>
<div id="#rfc.figure.8"></div>
<pre>
   00 FFFFFFFFFFFFFFFF 00 000000 00 FF 00 FFFFFFFFFFFFFF 00
</pre>
<p id="rfc.section.Appendix A.2.p.7">Finally, we compute the keystream from the session key and the initial counter, apply the mask to the keystream, and then xor the keystream with the plaintext:</p>
<div id="#rfc.figure.9"></div>
<pre>
    Initial keystream:  1E19C8E1D481C779549ED1617AAA1B7A
                        FC0D933AE7ED6CC8
    Mask (Hex):         00FFFFFFFFFFFFFFFF0000000000FF00
                        FFFFFFFFFFFFFF00
    Masked keystream:   0019C8E1D481C7795400000000001B00
                        FC0D933AE7ED6C00
    Plaintext:          17414273A475262748220000C8308E46
                        55996386B395FB00
    Ciphertext:         17588A9270F4E15E1C220000C8309546
                        A994F0BC54789700
</pre>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Changes From Earlier Versions</h1>
<p id="rfc.section.Appendix B.p.1">Note to the RFC-Editor: please remove this section prior to publication as an RFC.</p>
<h1 id="rfc.appendix.Appendix B.1">
<a href="#rfc.appendix.Appendix%20B.1">Appendix B.1.</a> Changes from draft-ietf-avtcore -00</h1>
<p id="rfc.section.Appendix B.1.p.1">Clarified usage of Key Derivation Algorithm</p>
<p id="rfc.section.Appendix B.1.p.2">Provided non-normative guidance for how to use this mechanism with Authenticated Encryption with Associated Data (AEAD) transforms.</p>
<p id="rfc.section.Appendix B.1.p.3">Corrected SMPTE Timecode header extension element in example header extension (it's eight bytes, not sixteen).  Added an NTP timestamp to the example to fill it back out to original size.</p>
<p id="rfc.section.Appendix B.1.p.4">Specified applicability of the extmap attribute if it's specified as a session-level attribute.</p>
<p id="rfc.section.Appendix B.1.p.5">Added description of backward compatibility, including a description of how you can negotiate best-effort encryption.</p>
<p id="rfc.section.Appendix B.1.p.6">Added a note to the security considerations about the dangers for middleboxes observing unencrypted headers (both header extension elements and RTP headers) without being able to verify the authentication keys.</p>
<p id="rfc.section.Appendix B.1.p.7">Added test vectors.</p>
<p id="rfc.section.Appendix B.1.p.8">Added acknowledgments section.</p>
<h1 id="rfc.appendix.Appendix B.2">
<a href="#rfc.appendix.Appendix%20B.2">Appendix B.2.</a> Changes from draft-lennox-avtcore -00</h1>
<p></p>

<ul>
<li>Published as working group item.</li>
<li>Added discussion of limitations when used with the two-byte-header form of header extension elements.</li>
<li>Added open issue about how to use this mechanism with Authenticated Encryption with Associated Data (AEAD) transforms.</li>
<li>Updated references.</li>
</ul>
<h1 id="rfc.appendix.Appendix B.3">
<a href="#rfc.appendix.Appendix%20B.3">Appendix B.3.</a> Changes from draft-lennox-avt -02</h1>
<p></p>

<ul>
<li>Retargeted at AVTCORE working group.</li>
<li>Updated references.</li>
</ul>
<h1 id="rfc.appendix.Appendix B.4">
<a href="#rfc.appendix.Appendix%20B.4">Appendix B.4.</a> Changes From Individual Submission Draft -01</h1>
<p></p>

<ul><li>Minor editorial changes.</li></ul>
<h1 id="rfc.appendix.Appendix B.5">
<a href="#rfc.appendix.Appendix%20B.5">Appendix B.5.</a> Changes From Individual Submission Draft -00</h1>
<p></p>

<ul>
<li>Clarified description of encryption mask creation.</li>
<li>Added example encryption mask.</li>
<li>Editorial changes.</li>
</ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jonathan Lennox</span> 
	  <span class="n hidden">
		<span class="family-name">Lennox</span>
	  </span>
	</span>
	<span class="org vcardline">Vidyo, Inc.  </span>
	<span class="adr">
	  <span>433 Hackensack Avenue</span>
<span>Seventh Floor</span>

	  <span class="vcardline">
		<span class="locality">Hackensack</span>,  
		<span class="region">NJ</span> 
		<span class="code">07601</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jonathan@vidyo.com">jonathan@vidyo.com</a></span>

  </address>
</div>

</body>
</html>