<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Resolver side mitigations</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Resolver side mitigations">
<meta name="keywords" content="DNS, forgery, spoof, poison, resilience">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DNS Extensions Working Group</td><td class="header">W. Wijngaards</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NLnet Labs</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">February 24, 2009</td></tr>
<tr><td class="header">Expires: August 28, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Resolver side mitigations<br />draft-wijngaards-dnsext-resolver-side-mitigation-01</h1>

<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 28, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This document describes a set of mitigations that stop the known
variations of the Kaminsky cache poisoning attacks against the DNS
system, for which only resolver side deployment is necessary.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<br />
<a href="#anchor2">2.</a>&nbsp;
Criteria<br />
<br />
<a href="#anchor3">3.</a>&nbsp;
Mitigations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Add Entropy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Use Care with the Cache<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Obtain Authoritative Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
Detection<br />
<br />
<a href="#anchor8">4.</a>&nbsp;
Variants to Protect against<br />
<br />
<a href="#anchor9">5.</a>&nbsp;
Security Considerations<br />
<br />
<a href="#anchor10">6.</a>&nbsp;
IANA Considerations<br />
<br />
<a href="#anchor11">7.</a>&nbsp;
Acknowledgments<br />
<br />
<a href="#rfc.references1">8.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> [WW: These are the counter measures for the Kaminsky attack
scenarios that I envision for the Unbound resolver (http://unbound.net).
These are counter measures that require resolver side deployment only.
Depending on working group input this document could remain an Unbound
specific information document or can be made more generic, and move
towards a BCP.] 
</p>
<p>
This document describes the mitigations that a resolver can deploy
on its own in the meantime, while a more comprehensive (read: DNSSEC)
solution is being rolled out.  For counter measures that require changes
to authoritative and recursive servers everywhere, DNSSEC provides the
most protection, followed by Nonce-based approaches (e.g. EDNS PING),
followed by transport protocol games.  Because Unbound implements DNSSEC
validation already, and DNSSEC provides the most protection (e.g. against
new unknown variations and also against full man-in-the-middle attacks),
this is a good long term choice.

</p>
<p>
The solutions covered in this document hope to cover all of the variations
in the recent Kaminsky-style attacks.  However, it seems likely that
other variations besides the ones described in this document are going
to be discovered.  For that reason a number of generic protections are
included, chief amongst those is the use of extra entropy.

</p>
<p>
Since this document focuses on Unbound it is worth noting that although
current versions implement these mitigations, they are not all turned on
by default. Unbound
should support the mitigations considered 'best' by the community.
This means without weird, ill-considered, mitigations of its own.
Hence this document.

</p>
<p>
It is assumed the reader is aware of, and implementing, the
forgery-resilience <a class='info' href='#RFC5452'>[RFC5452]<span> (</span><span class='info'>Hubert, A. and R. van Mook, &ldquo;Measures for Making DNS More Resilient against Forged Answers,&rdquo; January&nbsp;2009.</span><span>)</span></a> recommendations.

</p>
<p>
In Section 2 the criteria are listed.  In Section 3 the various measures
that can be used to mitigate threats are described.  Section 4 enumerates
Kaminsky-style attack variations, and shows what measures provide
protection against each one of them.  Section 5 discusses consequences
caused by the mitigations.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Criteria</h3>

<p>
The first and foremost criterium is that these are resolver side
solutions, thus only the resolver needs to be redeployed, or the software
updated, for this to work.  The reason behind this is that a short term
deployment is possible.  The idea is to provide some (partial) protection
on the short term.  On the long term it is possible to redeploy both
authority and recursors, and the solution space is greatly increased
(e.g. options range from EDNS PING, using TCP or SCTP, to DNSSEC
deployment).

</p>
<p>
Many solutions in this document could also be used in stub resolvers.
Stub resolvers are not mentioned specifically further on, the main focus
is on the caching recursive server.

</p>
<p>
The solutions have to follow the DNS protocol.

</p>
<p> The solutions have to be non disruptive, and non anti-social.
Specifically, they must not put the costs of the solution with 3rd
parties.  For example, large scale fallback to TCP both uses a limited
resource (TCP connections to authority servers), and disrupts deployment
behind many middle boxes.  
</p>
<p>
Solutions without an 'attack mode' are preferred.  An 'attack mode' is a
different state of behaviour that the resolver enters into after something
anomalous is detected.  It may be for only a subset of operations or only
a limited time.  One reason to avoid such modal design is that paranoia
dictates that maximal protection should always be used.  A second reason
is that if a protection measure cannot be used always, it is likely to be
disruptive (see above).  Such an 'attack mode' complicates implementation,
testing and especially security analysis.  
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Mitigations</h3>

<p>
Below, the resolver side mitigations are described.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Add Entropy</h3>

<p>
The mitigations in this section increase the transaction entropy above the
16 bits in the ID number.  This is pretty close to the forgery-resilience
<a class='info' href='#RFC5452'>[RFC5452]<span> (</span><span class='info'>Hubert, A. and R. van Mook, &ldquo;Measures for Making DNS More Resilient against Forged Answers,&rdquo; January&nbsp;2009.</span><span>)</span></a>
text, differences are in the rtt banding text and 0x20 consideration.

</p>
<p></p>
<ul class="text">
<li> port randomisation
	<br />
<br />

	As many as possible, using only 1000 or 2000 ports (as some
	commercial DNS products do) is not enough.  A range of 59000
	port numbers (15.8 bits) can be usefully achieved.  This causes
	operational problems (NAT boxes using predictable port numbers),
	portability problems (bugs, features not available), and volume
	problems (using port number uses limited resource).

</li>
<li> 0x20.
	<br />
<br />

	Breaks queries to some authorities, but more than 99.9% works. It
	is like a proposal that needs authority server deployment where
	the authority servers are already deployed to a large extent.
	<a class='info' href='#I-D.vixie-dnsext-dns0x20'>[I&#8209;D.vixie&#8209;dnsext&#8209;dns0x20]<span> (</span><span class='info'>Vixie, P. and D. Dagon, &ldquo;Use of Bit 0x20 in DNS Labels to Improve Transaction Identity,&rdquo; March&nbsp;2008.</span><span>)</span></a>.

</li>
<li> rtt banding
	<br />
<br />

	RTT banding refers to the method of picking a random nameserver
	for the query out of the set of nameservers that are within a RTT
	band (say at most 200 msec slower) from the fastest nameserver.

	<br />
<br />

	New attack opportunities can be created by sending a new fake
	question to be resolved by the resolver.  Therefore the actual
	size of the roundtrip time window is not as important as the
	additional entropy gained by selecting randomly from a set
	of servers.

</li>
<li> IPv4 - IPv6
	<br />
<br />

	When both IPv4 and IPv6 are available, the protocol can be chosen
	randomly together with rtt banding to provide more entropy.

</li>
<li> source address randomisation
	<br />
<br />

	If the resolver has multiple public IP addresses these can be
	used to randomise with.

</li>
</ul>

<p>
If all the above entropy settings are in use, it is estimated that
Unbound can provide about 44 bits of entropy (16 ID, 15.8 port bits,
about 8 0x20 bits, about 2 rtt banding + protocol bits and about 2 source
address bits).  Without user configuration or queries amenable to 0x20,
34 bits of entropy are likely, or even 18 if a NAT box kills the port
randomisation.  Entropy thus provides only limited protection.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Use Care with the Cache</h3>

<p></p>
<ul class="text">
<li> rfc2181 adherence
	<br />
<br />

	This means that RRsets are ranked in trustworthiness depending
	on whether they come from the answer section, or from another
	part of the message.  The authoritative answers are preferred.
	<a class='info' href='#RFC2181'>[RFC2181]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Clarifications to the DNS Specification,&rdquo; July&nbsp;1997.</span><span>)</span></a>
	<br />
<br />

	In addition, do not give data obtained from authority or 
	additional sections in answer sections to clients.

</li>
<li> CNAME chain.
	<br />
<br />

	Only use first entry in answer section.  Perform new lookups for 
	remainder.

</li>
<li> DNAME chain.
	<br />
<br />

	Only use the first entry DNAME and its synthesized CNAME from the
	answer section.  Perform new lookups for remainder.

</li>
<li> no DNAME from cache 
	<br />
<br />

	Do not pick a DNAME RR out of the cache for a query for which
	that DNAME RR was not returned.  Thus, a DNAME is only used
	for query names for which answers have been received from the
	authority server.

	<br />
<br />

	When the DNAME is signed with DNSSEC, it is allowed to synthesize
	new CNAMEs from it to answer new queries with it.  This is
	because the zone owner whose zone is redirected is signing away
	his own zone.

</li>
</ul>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Obtain Authoritative Data</h3>

<p></p>
<ul class="text">
<li> Authority query for NS after referral
	<br />
<br />

	The idea is to obtain authoritative data for the NS RRset instead
	of using data tacked along on another message.	Care must be
	taken to avoid DoSing parent nameservers, and not break resolution
	in common cases where the NS RRsets in parent and child differ.

	<br />
<br />

	On a referral, the data from the referral may be used to continue
	answering the current query, but it is not stored in the cache.
	If the question equals the referred zone name and has qtype NS,
	then the NS RRset from the referral does get stored in the cache.

	<br />
<br />

	If the question is not that already, a new lookup is performed
	for the referred zone name with qtype NS. The results from that
	lookup are cached normally. The lookup has to start at a parent of
	the referred zone, so that a new referral is obtained.

	<br />
<br />

	The upshot is that RFC2181 adherence pins the NS RRset data in
	the cache because it is seen in the answer section, and tacked
	on data from other messages is ignored until the TTL expires.
	It should be noted that most infrastructure TTLs for NS records
	are very large.

	<br />
<br />

	It does not break existing disjoint RRsets, or servers that do
	not answer for qtype NS at all, or servers that are offline,
	because the referral is cached when making the qtype NS
	query. This is why the qtype NS query has to be made in such
	a way that it elicits a fresh referral from the parent server.
	This gives a once per TTL opportunity for spoofing the referral.

	<br />
<br />

	The NS RRset answered from the child side of the zone cut
	overrides the NS RRset picked up from the referral.  This causes
	the same data to be used as today, where the authority section
	NS set sent along by the child server overrides the NS set seen
	from the referral. 
	<br />
<br />

	Additional queries are sent for this solution.  This increases
	resolver and authority server load and bandwith usage.

</li>
<li> Authority queries for nameserver addresses, A and AAAA.
	<br />
<br />

	Same idea, like NS query above. You ask for A or AAAA records
	directly at the authoritative server.  It is not necessary to
	elicit the referral again, the query can be directed at the
	best server.
	<br />
<br />

	Additional queries are sent for this solution.  This increases
	resolver and authority server load and bandwith usage.

</li>
</ul>

<p>
A bonus when using the above methods to obtain authoritative data is
that when using DNSSEC, the data can be validated, and thus spoofed
infrastructure data can be detected and handled appropriately.  This
protects DNSSEC, where the referral contains unsigned NS, A and AAAA
records from spoofed infrastructure data.  Of course, DNSSEC is designed
to protect end-user data anyway, whether or not the referral data was
poisoned.  It simply adds the opportunity to add another layer of defense.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Detection</h3>

<p></p>
<ul class="text">
<li> trouble counter
	<br />
<br />

	This is a simple detection method.  It counts all packets that
	were not asked for.  The only thing noted about the packet is
	that it is a query reply (QR bit) and was not asked for.

	<br />
<br />

	This may show false positives due to UDP packet duplicates,
	delayed responses (delayed for longer than the implementation
	cares to keep track of what it asks for).  The idea is that false
	positives are probably a low amount.  Conversely, some unasked for
	packets may not be noticed because the implementation may not be
	listening to particular ports, or whatever implementation choices.

	<br />
<br />

	When a particular threshold is met, the cache is wiped clean.

	<br />
<br />

	The threshold is set so that denial of service does not become
	all that much easier, and that false positives do not (often)
	result in cache wipes.	A threshold in the range of 10 million
	is proposed.  This many packets itself is already a sizable denial
	of service attack, and also, the amount of data sent gets close
	to the cache size of the resolver to keep amplification towards
	the authority servers low.

	<br />
<br />

	Since this mitigation is meant to protect against hitherto
	unknown variations, it does not help to examine the packets any
	further than the QR bit (and the fact that they were not used
	for regular processing).

	<br />
<br />

	The result of this is that the probability that there is a
	poisoned item present in the cache is capped at some maximum.
	The exact value depends on the entropy per message and the
	threshold.

</li>
</ul>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Variants to Protect against</h3>

<p>
In the descriptions below a short title is given to quickly summarize
the exploit.  The query 'q:' is what the attacker sends as fake
question to the resolver to answer.  The answer, authority 'auth:' and
additional 'add:' sections list the content that the spoofer provides.
The mitigation strategy, and sometimes discussion, is provided in the
'protected:' line.

</p>
<p>
The real target is example.com or www.example.com or ns1.example.com,
which is the real nameserver for example.com here.  The domain
evil.example.net is under control of the attacker and 192.0.2.66(evil)
is an IP address under control of the attacker.  The label 'bad123'
is used in place of a label that the attacker varies every attempt to
obtain new spoofing windows.

</p>
<p>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Glue with new DNS server
q: bad123.example.com.
answer: bad123.example.com. A whatever
auth: example.com. NS evil.example.com.
add: evil.example.com. A 192.0.2.66(evil)
protected: 2181 adherence plus NS record pinned by NS query.
Also name error or no data answers could be used, instead of
this answer section.

Glue for DNS server
q: bad123.example.com.
answer: bad123.example.com. A whatever
auth: example.com. NS ns1.example.com. (normal entry)
add: ns1.example.com. A 192.0.2.66(evil)
protected: 2181 adherence plus NS record pinned by NS query,
plus A record pinned by glue query.
Also name error or no data answers could be used, instead of
this answer section.

Glue for Web server
q: bad123.example.com.
answer: bad123.example.com. A whatever
auth: example.com. NS www.example.com.
add: www.example.com. A 192.0.2.66(evil)
protected: 2181 adherence plus NS record pinned by NS query.

Glue smaller
q: bad123.example.com.
answer: bad123.example.com. A 192.0.2.66(evil)
auth: example.com. NS bad123.example.com.
protected: 2181 adherence plus NS record pinned by NS query.

NS change
q: bad123.example.com.
answer: bad123.example.com. A whatever
auth: example.com. NS evil.example.net.
protected: 2181 adherence plus NS record pinned by NS query.

NS server migration
q: bad123.example.com.
answer: bad123.example.com. A whatever
auth: example.com. NS ns1.example.com. (normal entry)
auth: example.com. NS ns2.example.com.evil.example.net.
      (evil, looks like typo in server migration)
protected: 2181 adherence plus NS record pinned by NS query.

CNAME
q: bad123.example.com.
answer: bad123.example.com. CNAME www.example.com.
answer: www.example.com. A 192.0.2.66(evil)
protected: CNAME chain cutoff.

DNAME one message
q: www.bad123.example.com.
answer: bad123.example.com. DNAME example.com.
answer: www.bad123.example.com. CNAME www.example.com.
answer: www.example.com. A 192.0.2.66(evil)
protected: DNAME chain cutoff.

DNAME whole zone
q: bad123.example.com.
answer: example.com. DNAME evil.example.net.
answer: bad123.example.com. CNAME bad123.evil.example.net.
answer: bad123.evil.example.net. A whatever
protected: no DNAME from cache.

New Delegation - rigged
q: bad123.www.example.com.
answer: (empty)
auth: www.example.com. NS www.example.com.
add: www.example.com. A 192.0.2.66(evil)
protected: the NS queries that ask referral confirmation
together with glue queries.

New Delegation - looks normal
q: bad123.www.example.com.
answer: (empty)
auth: www.example.com. NS ns1.evil.example.net.
auth: www.example.com. NS ns2.evil.example.net.
protected: the NS queries that ask referral confirmation
together with glue queries.

New Delegation - for glue
q: bad123.example.com.
answer: (empty)
auth: bad123.example.com. NS ns1.example.com.
additional:  ns1.example.com. A 192.0.2.66(evil)
protected: rfc2181 adherence.

Another hitherto unknown variation
These are a lot of variations and it is very likely that other
people can come up with better, different ideas.
protected: by entropy measures, by the count-and-wipe measure.
Long term solutions (PING, TCP, DNSSEC) also aim to protect
against these much more thoroughly.
</pre></div>
<p>
</p>


<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
All of the mitigations aim to provide more security.  But, several of
these mitigations have adverse effects on performance and bandwith.

</p>
<p>
The CNAME, DNAME, NS and nameserver address mitigations all require that
additional lookups be performed.  The CNAME and DNAME target lookups
cause the answer to the client to be delayed.  The NS set and nameserver
address lookups cause a higher load on both authority and resolver servers.

</p>
<p>
The detection mechanism is susceptible to denial of service attacks.
A small, calculated, amount of additional DoS leverage is provided.
This changes some spoof attacks into a denial of service.

</p>
<p>
The NS set and nameserver address lookups cause the NS, A and AAAA RRsets
to be pinned in the cache until the TTL expires.  This provides cache
overwriting protection, but at the cost of not picking up updates to these
RRsets in the course of normal resolution.  Changes to these RRsets are
then no longer seen on the next query, but only after the TTL times out.
This adversely affects the coherency of the DNS server infrastructure,
as it becomes more likely that resolvers operate using out of date
nameserver data.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
None.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgments</h3>

<p>
Thanks to Nicholas Weaver (ICSI Berkeley) and Olaf Kolkman (NLnet Labs).

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.vixie-dnsext-dns0x20">[I-D.vixie-dnsext-dns0x20]</a></td>
<td class="author-text">Vixie, P. and D. Dagon, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-vixie-dnsext-dns0x20-00.txt">Use of Bit 0x20 in DNS Labels to Improve Transaction Identity</a>,&rdquo; draft-vixie-dnsext-dns0x20-00 (work in progress), March&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-vixie-dnsext-dns0x20-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2181">[RFC2181]</a></td>
<td class="author-text"><a href="mailto:kre@munnari.OZ.AU">Elz, R.</a> and <a href="mailto:randy@psg.com">R. Bush</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2181">Clarifications to the DNS Specification</a>,&rdquo; RFC&nbsp;2181, July&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2181.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2181.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2181.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5452">[RFC5452]</a></td>
<td class="author-text">Hubert, A. and R. van Mook, &ldquo;<a href="http://tools.ietf.org/html/rfc5452">Measures for Making DNS More Resilient against Forged Answers</a>,&rdquo; RFC&nbsp;5452, January&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5452.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wouter Wijngaards</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NLnet Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Science Park 140</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Amsterdam  1098 XG</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Netherlands</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+31-20-888-4551</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:wouter@nlnetlabs.nl">wouter@nlnetlabs.nl</a></td></tr>
</table>
</body></html>
