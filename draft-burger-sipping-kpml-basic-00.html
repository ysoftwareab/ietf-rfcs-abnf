<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A Baisc Profile of the Session Initiation
    Protocol (SIP) Event Package for Key Press Stimulus (KPML)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A Baisc Profile of the Session Initiation
    Protocol (SIP) Event Package for Key Press Stimulus (KPML)">
<meta name="keywords" content="SIP, Media Services, KPML, DTMF">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIPPING</td><td class="header">E. Burger</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">BEA Systems, Inc.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">November 12, 2007</td></tr>
<tr><td class="header">Expires: May 15, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />A Baisc Profile of the Session Initiation
    Protocol (SIP) Event Package for Key Press Stimulus (KPML)<br />draft-burger-sipping-kpml-basic-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 15, 2008.</p>

<h3>Abstract</h3>

<p>This document describes a profile of the SIP Event Package "kpml"
      that enables simple monitoring of DTMF signals and uses XML documents
      referred to as Key Press Markup Language (KPML). This profile assumes
      devices of lesser capability that may have trouble parsing subscription
      requests or producing generic XML documents. This is a profile of RFC
      4730, KPML.
</p>
<h3>Conventions used in this document</h3>

<p><a class='info' href='#RFC2119'>RFC2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119] provides the interpretations
      for the key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" found in
      this document.
</p>
<p>The <a class='info' href='#I-D.ietf-sipping-app-interaction-framework'>Application
      Interaction Framework document<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Framework for Application Interaction in the Session           Initiation Protocol (SIP),&rdquo; July&nbsp;2005.</span><span>)</span></a> [I&#8209;D.ietf&#8209;sipping&#8209;app&#8209;interaction&#8209;framework] provides the interpretations for
      the terms "User Device", "SIP Application", and "User Input". This
      document uses the term "Application" and "Requesting Application"
      interchangeably with "SIP Application".
</p>
<p>Additionally, the Application Interaction Framework document
      discusses User Device Proxies. A common instantiation of a User Device
      Proxy is a Public Switched Telephone Network (PSTN) gateway. Because the
      normative behavior of a presentation free User Interface is identical
      for a presentation free SIP User Agent and a presentation free User
      Device Proxy, this document uses "User Device" for both cases.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Protocol Overview<br />
<a href="#anchor3">3.</a>&nbsp;
Event Package Formal Definition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.</a>&nbsp;
Event Package Name<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Event Package Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
SUBSCRIBE Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.4.</a>&nbsp;
Subscription Duration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.5.</a>&nbsp;
NOTIFY Bodies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.6.</a>&nbsp;
Subscriber generation of SUBSCRIBE requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.7.</a>&nbsp;
Notifier processing of SUBSCRIBE requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.8.</a>&nbsp;
Notifier generation of NOTIFY requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.9.</a>&nbsp;
Subscriber processing of NOTIFY requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.10.</a>&nbsp;
Handling of Forked Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.11.</a>&nbsp;
Rate of notifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">3.12.</a>&nbsp;
State Agents and Lists<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">3.13.</a>&nbsp;
Behavior of a Proxy Server<br />
<a href="#anchor17">4.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.1.</a>&nbsp;
SIP Event Package Registration<br />
<a href="#S.security">5.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#anchor21">Appendix&nbsp;A.</a>&nbsp;
Contributors<br />
<a href="#anchor22">Appendix&nbsp;B.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document describes a profile for the SIP Event Package "kpml"
      that enables monitoring of key presses and utilizes XML documents
      referred to as <a class='info' href='#RFC4730'>Key Press Markup Language
      (KPML)<span> (</span><span class='info'>Burger, E. and M. Dolly, &ldquo;A Session Initiation Protocol (SIP) Event Package for Key           Press Stimulus (KPML),&rdquo; November&nbsp;2006.</span><span>)</span></a> [RFC4730], RFC 4730.
</p>
<p>A goal of KPML is to fit in an extremely small memory and processing
      footprint. However, some believe that even with this lightweight goal,
      the burden of parsing generic XML subscription requests and generating
      arbitrary XML is too complex. This document provides a basic profile
      that eliminates the requirement of a KPML server to parse arbitrary
      subscription requests or generate arbitrary XML documents.
</p>
<p>Of course, we strongly suggest implementing the full KPML protocol.
      However, this profile provides the benefits of KPML, namely not sharing
      the SIP dialog with the underlying SIP session. Note that by reporting
      on a digit-by-digit basis, quite a lot of bandwidth and packets are
      wasted. That said, with the exception of subscription establishment,
      this mechanism uses virtually identical bandwidth, and identical packet
      use, of INFO-based digit reporting schemes.
</p>
<p>We considered having the invite, offering a kpml-basic event, to
      automatically generate a subscription for the kpml-basic profile.
      However, this is not workable, because the client making the request has
      no way of correlating the automatically generated subscription to the
      underlying SIP session. This is differnt from the <a class='info' href='#RFC3515'>REFER<span> (</span><span class='info'>Sparks, R., &ldquo;The Session Initiation Protocol (SIP) Refer Method,&rdquo; April&nbsp;2003.</span><span>)</span></a> [RFC3515] situation, where the new REFER dialog
      establishes the subscription dialog.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Overview</h3>

<p>As a profile of KPML, the protocol operates identically to KPML.
      However, by advertising the kpml-basic event package, as opposed to
      kpml, the protocol described in this document superceeds the negotiation
      of KPML. In particular, the server MUST ignore any subscription body and
      substitute it with an expression similar to <a class='info' href='#F.request'>Figure&nbsp;1<span> (</span><span class='info'>Sample Default Request</span><span>)</span></a>. This matches every key press and reports on
      every key press.
</p>
<p>The server can optimize reporting by using a template XML document,
      substituting only the particular key press entered into the
      template.
</p>
<p>The client assumes a persistent subscription.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Event Package Formal Definition</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Event Package Name</h3>

<p>This document defines a SIP Event Package as defined in <a class='info' href='#RFC3265'>RFC 3265<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event           Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3265]. The event-package token name for
        this package is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>"kpml-basic"
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Event Package Parameters</h3>

<p>This package defines three Event Package parameters: call-id,
        remote-tag, and local-tag. These parameters MUST be present, to
        identify the subscription dialog. The User Interface matches the
        local-tag against the to tag, the remote-tag against the from tag, and
        the call-id against the Call-ID.
</p>
<p>call-id = "call-id" EQUAL ( token / DQUOTE callid DQUOTE
        )<br />
 ;; NOTE: any DQUOTEs inside callid MUST be
        escaped!<br />
 remote-tag = "remote-tag" EQUAL token<br />

        local-tag = "local-tag" EQUAL token
</p>
<p>If any call-ids contain embedded double-quotes, those double-quotes
        MUST be escaped using the backslash-quoting mechanism. Note that the
        call-id parameter may need to be expressed as a quoted string. This is
        because the ABNF for the callid production and the word production,
        which is used by callid (both from RFC 3261 [1]), allow some
        characters (such as "@", "[", and ":") that are not allowed within a
        token.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
SUBSCRIBE Bodies</h3>

<p>Applications using this event package have an empty body in the
        SUBSCRIBE request. The server MUST interpret this request as if it had
        a document requesting every possible single key press pattern. A
        sample of an application/kpml-request+xml document follows. Note if
        there are other defined digits, the server includes them in the
        pattern
</p><br /><hr class="insert" />
<a name="F.request"></a>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>&lt;?xml version="1.0"&gt;
&lt;kpml-request xmlns="urn:ietf:params:xml:ns:kpml-request"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation=
        "urn:ietf:params:xml:ns:kpml-request kpml-request.xsd"
      version="1.0"&gt;
  &lt;pattern&gt;
    &lt;regex&gt;[0123456789ABCDR*#]&lt;/regex&gt;
  &lt;/pattern&gt;
&lt;/kpml-request&gt;</pre></div>
<p>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Sample Default Request&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Subscription Duration</h3>

<p>The subscription lifetime should be longer than the expected call
        time. Subscriptions to this event package MAY range from minutes to
        weeks. Subscriptions in hours or days are more typical and are
        RECOMMENDED. The default subscription duration for this event package
        is 7200 seconds.
</p>
<p>Subscribers MUST be able to handle the User Interface returning an
        Expires value smaller than the requested value. Per <a class='info' href='#RFC3265'>RFC3265<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event           Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3265], the subscription duration is the
        value returned by the Notifier in the 200 OK Expires header.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
NOTIFY Bodies</h3>

<p>NOTIFY requests MUST contain well-formed
        application/kpml-response+xml (KPML Response) bodies. The syntax of
        this body type is formally described in RFC 4730.
</p>
<p>The KPML server MAY use a template such as the following to send
        its responses.
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>?xml version="1.0" encoding="UTF-8"?&gt;
&lt;kpml-response xmlns="urn:ietf:params:xml:ns:kpml-response"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation=
        "urn:ietf:params:xml:ns:kpml-response kpml-response.xsd"
      version="1.0"
      code="200" text="OK"
      digits="2"/&gt;</pre></div>
<p>
</p>
<p>In the above example, the key pressed was a "2". Presumably, the
        KPML server would fill in the exact key pressed instead of the 2.
</p>
<p>It is very important to note the KPML client (the subscriber) MUST
        be capable of parsing arbitrary XML documents. There is no guarantee
        the server will use the above template. Since the server can use any
        legal, well-formed, application/kpml-response+xml template. There is
        no guarantee the server will use the above example as its
        template.
</p>
<p>Notifiers MAY send notifications with any format acceptable to the
        subscriber (based on the subscriber inclusion of these formats in an
        Accept header). A future extension MAY define other NOTIFY bodies. If
        no "Accept" header is present in the SUBSCRIBE, the body type defined
        in this document MUST be assumed.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Subscriber generation of SUBSCRIBE requests</h3>

<p>A kpml-basic request has no attached document.
</p>
<p>Because of the potentially sensitive nature of the information
        reported by KPML, subscribers SHOULD use sips: and MAY use S/MIME on
        the content.
</p>
<p>Subscribers MUST be prepared for the notifier to insist on
        authentication of the subscription request. Subscribers MUST be
        prepared for the notifier to insist on using a secure communication
        channel.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.7"></a><h3>3.7.&nbsp;
Notifier processing of SUBSCRIBE requests</h3>

<p>The user information transported by KPML is potentially sensitive.
        For example, it could include calling card or credit card numbers.
        Thus the User Interface (notifier) MUST authenticate the requesting
        party in some way before accepting the subscription.
</p>
<p>User Interfaces MUST implement SIP Digest authentication as
        required by <a class='info' href='#RFC3261'>RFC3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] and MUST implement
        the sips: scheme and TLS.
</p>
<p>Upon authenticating the requesting party, the User Interface
        determines if the requesting party has authorization to monitor the
        user's key presses. Determining authorization policies and procedures
        is beyond the scope of this specification.
</p>
<p>The User Interface returns a Contact URI that may have <a class='info' href='#I-D.ietf-sip-gruu'>GRUU<span> (</span><span class='info'>Rosenberg, J., &ldquo;Obtaining and Using Globally Routable User Agent (UA) URIs           (GRUU) in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;sip&#8209;gruu] properties in the Contact
        header of a SIP INVITE, 1xx, or 2xx response.
</p>
<p>Following the semantics of SUBSCRIBE, if the User Interface
        receives a resubscription, the User Interface MUST terminate the
        existing KPML request and replace it with the new request.
</p>
<p>It is possible for the INVITE usage of the dialog to terminate
        during key press collection. The cases enumerated here are explicit
        subscription termination, automatic subscription termination, and
        underlying (INVITE-initiated) dialog termination.
</p>
<p>If a SUBSCRIBE request has an expires of zero (explicit SUBSCRIBE
        termination) and there is buffered User Input, the User Interface MUST
        generate the appropriate KPML report with the KPML status code of 200.
        The SIP NOTIFY body terminates the subscription by setting the
        subscription state to "terminated" and a reason of "timeout".
</p>
<p>If the SUBSCRIBE request has an expires of zero or the expires
        timer on the SUBSCRIBE-initiated dialog fires at the User Interface
        (notifier), then the User Interface MUST issue a KPML report with the
        KPML status code 487, Subscription Expired. This could be the null
        string.
</p>
<p>Per the mechanisms of <a class='info' href='#RFC3265'>RFC3265<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event           Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3265], the
        User Interface MUST terminate the SIP SUBSCRIBE dialog. The User
        Interface does this via the SIP NOTIFY body transporting the final
        report described in the preceding paragraph. In particular, the
        subscription state will be "terminated" and a reason of "timeout".
</p>
<p>Terminating the subscription when a dialog terminates ensures
        reauthorization (if necessary) for attaching to subsequent
        subscriptions.
</p>
<p>If a SUBSCRIBE request references a dialog that is not present at
        the User Interface, the User Interface MUST generate a KPML report
        with the KPML status code 481, Dialog Not Found. The User Interface
        terminates the subscription by setting the subscription state to
        "terminated".
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.8"></a><h3>3.8.&nbsp;
Notifier generation of NOTIFY requests</h3>

<p>The User Interface (notifier in SUBSCRIBE/NOTIFY parlance)
        generates NOTIFY requests based on the requirements of <a class='info' href='#RFC3265'>RFC3265<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event           Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3265]. Specifically, if a SUBSCRIBE request
        is valid and authorized, it will result in an immediate NOTIFY.
</p>
<p>The KPML payload distinguishes between an initial NOTIFY and a
        NOTIFY informing of key presses. If there is no User Input buffered at
        the time of the SUBSCRIBE (see below) or the buffered User Input does
        not match the new KPML document, then the immediate NOTIFY MUST NOT
        contain a KPML body. If User Interface has User Input buffered that
        result in a match using the new KPML document, then the NOTIFY MUST
        return the appropriate KPML document.
</p>
<p>The NOTIFY in response to a SUBSCRIBE request has no KPML if there
        are no matching buffered digits.
</p>
<p>All subscriptions MUST be authenticated, particularly those that
        match on buffered input.
</p>
<p>KPML specifies the key press notification report format. The MIME
        type for KPML reports is application/kpml-response+xml. The default
        MIME type for the kpml event package is
        application/kpml-response+xml.
</p>
<p>If the requestor is not using a secure transport protocol such as
        TLS for every hop (e.g., by using a sips: URI), the User Interface
        SHOULD use S/MIME to protect the user information in responses.
</p>
<p>Note that if the monitored (INVITE-initiated) dialog terminates,
        the Notifier still MUST explicitly terminate the KPML subscriptions
        monitoring that dialog.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.9"></a><h3>3.9.&nbsp;
Subscriber processing of NOTIFY requests</h3>

<p>If there is no KPML body, it means the SUBSCRIBE was successful.
        This establishes the dialog if there is no buffered User Input to
        report.
</p>
<p>If there is a KPML document, and the KPML status code is 200, then
        a match occurred.
</p>
<p>If there is a KPML document, and the KPML status code is between
        400 and 499, then an error occurred with User Input collection. The
        most likely cause is a timeout condition.
</p>
<p>If there is a KPML document, and the KPML status code is between
        500 and 599, then an error occurred with the subscription. See RFC
        4730 for more on the meaning of KPML status codes.
</p>
<p>The subscriber MUST be mindful of the subscription state. The User
        Interface may terminate the subscription at any time.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.10"></a><h3>3.10.&nbsp;
Handling of Forked Requests</h3>

<p>Forked requests are NOT ALLOWED for this event type. This can be
        ensured if the Subscriptions to this event package are sent to SIP
        URIs which have GRUU properties.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.11"></a><h3>3.11.&nbsp;
Rate of notifications</h3>

<p>The User Interface MUST NOT generate messages faster than 25
        messages per second, or one message every 40 milliseconds. This is the
        minimum time period for MF digit spills. Even 30-millisecond DTMF, as
        one sometimes finds in Japan, has a 20-millisecond off time, resulting
        in a 50-millisecond interdigit time.
</p>
<p>The sustained rate of notification shall be no more than 100
        Notifies per minute.
</p>
<p>The User Interface MUST reliably deliver notifications. Because
        there is no meaningful metric for throttling requests, the User
        Interface SHOULD send NOTIFY messages over a congestion-controlled
        transport, such as TCP. </p>
<blockquote class="text">
<p>Note that all SIP implementations are already required to
            implement SIP over TCP.
</p>
</blockquote>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.12"></a><h3>3.12.&nbsp;
State Agents and Lists</h3>

<p>KPML requests are sent to a specific SIP URI, which may have GRUU
        properties, and attempt to monitor a specific stream that corresponds
        with a specific target dialog. Consequently, implementers MUST NOT
        define state agents for this event package nor allow subscriptions for
        this event package to resource lists using the <a class='info' href='#RFC4662'>event list extension<span> (</span><span class='info'>Roach, A., Campbell, B., and J. Rosenberg, &ldquo;A Session Initiation Protocol (SIP) Event Notification           Extension for Resource Lists,&rdquo; August&nbsp;2006.</span><span>)</span></a> [RFC4662].
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.13"></a><h3>3.13.&nbsp;
Behavior of a Proxy Server</h3>

<p>There are no additional requirements on a SIP Proxy, other than to
        transparently forward the SUBSCRIBE and NOTIFY methods as required in
        SIP.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>This document registers a new SIP Event Package.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
SIP Event Package Registration</h3>

<p></p>
<blockquote class="text"><dl>
<dt>Package name:</dt>
<dd>kpml-basic
</dd>
<dt>Type:</dt>
<dd>package
</dd>
<dt>Contact:</dt>
<dd>Eric Burger,
            &lt;eburger@standardstrack.com&gt;
</dd>
<dt>Change Controller:</dt>
<dd>SIPPING Working Group delegated
            from the IESG
</dd>
<dt>Published Specification:</dt>
<dd>RFCXXXX
</dd>
</dl></blockquote>

<a name="S.security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>The user information transported by KPML is potentially sensitive.
      For example, it could include calling card or credit card numbers. This
      potentially private information could be provided accidentally if the
      notifier does not properly authenticate or authorize a subscription.
      Similarly private information (such as a credit card number or calling
      card number) could be revealed to an otherwise legitimate subscriber
      (one operating an IVR) if digits buffered earlier in the session are
      provided unintentionally to the new subscriber.
</p>
<p>Likewise, an eavesdropper could view KPML digit information if it is
      not encrypted, or an attacker could inject fraudulent notifications
      unless the messages or the SIP path over which they travel are integrity
      protected.
</p>
<p>Therefore, User Interfaces MUST NOT downgrade their own security
      policy. That is, if a User Interface policy is to restrict notifications
      to authenticated and authorized subscribers over secure communications,
      then the User Interface must not accept an unauthenticated, unauthorized
      subscription over an insecure communication channel.
</p>
<p>As an XML markup, all of the security considerations of <a class='info' href='#RFC3023'>RFC3023<span> (</span><span class='info'>Murata, M., St. Laurent, S., and D. Kohn, &ldquo;XML Media Types,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3023] and <a class='info' href='#RFC3406'>RFC3406<span> (</span><span class='info'>Daigle, L., van Gulik, D., Iannella, R., and P. Faltstrom, &ldquo;Uniform Resource Names (URN) Namespace Definition           Mechanisms,&rdquo; October&nbsp;2002.</span><span>)</span></a> [RFC3406] must be met. Pay particular attention to
      the robustness requirements of parsing XML.
</p>
<p>Key press information is potentially sensitive. For example, it can
      represent credit card, calling card, or other personal information.
      Hijacking sessions allow unauthorized entities access to this sensitive
      information. Therefore, signaling SHOULD be secure, e.g., use of TLS and
      sips: SHOULD be used. Moreover, the information itself is sensitive;
      therefore the use of S/MIME or other appropriate mechanism SHOULD be
      used.
</p>
<p>Subscriptions MUST be authenticated in some manner. As required by
      the core <a class='info' href='#RFC3261'>SIP<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] specification, all SIP
      implementations MUST support digest authentication. In addition, User
      Interfaces MUST implement support for the sips: scheme and SIP over TLS.
      Subscribers MUST expect the User Interface to demand the use of an
      authentication scheme. If the local policy of a User Interface is to use
      authentication or secure communication channels, the User Interface MUST
      reject subscription requests that do not meet that policy.
</p>
<p>User Interfaces MUST begin buffering User Input upon receipt of an
      authenticated and accepted subscription. This buffering is done on a per
      subscription basis.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement
          Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3023">[RFC3023]</a></td>
<td class="author-text">Murata, M., St. Laurent, S., and D. Kohn, &ldquo;<a href="http://tools.ietf.org/html/rfc3023">XML Media Types</a>,&rdquo; RFC&nbsp;3023, January&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3023.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3265">[RFC3265]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event
          Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3406">[RFC3406]</a></td>
<td class="author-text">Daigle, L., van Gulik, D., Iannella, R., and P. Faltstrom, &ldquo;<a href="http://tools.ietf.org/html/rfc3406">Uniform Resource Names (URN) Namespace Definition
          Mechanisms</a>,&rdquo; BCP&nbsp;66, RFC&nbsp;3406, October&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3406.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4730">[RFC4730]</a></td>
<td class="author-text">Burger, E. and M. Dolly, &ldquo;<a href="http://tools.ietf.org/html/rfc4730">A Session Initiation Protocol (SIP) Event Package for Key
          Press Stimulus (KPML)</a>,&rdquo; RFC&nbsp;4730, November&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4730.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-gruu">[I-D.ietf-sip-gruu]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">Obtaining and Using Globally Routable User Agent (UA) URIs
          (GRUU) in the Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-gruu-15 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3515">[RFC3515]</a></td>
<td class="author-text">Sparks, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3515">The Session Initiation Protocol (SIP) Refer Method</a>,&rdquo; RFC&nbsp;3515, April&nbsp;2003 (<a href="ftp://ftp.isi.edu/in-notes/rfc3515.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sipping-app-interaction-framework">[I-D.ietf-sipping-app-interaction-framework]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-app-interaction-framework-05.txt">A Framework for Application Interaction in the Session
          Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sipping-app-interaction-framework-05 (work in progress), July&nbsp;2005 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sipping-app-interaction-framework-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4662">[RFC4662]</a></td>
<td class="author-text">Roach, A., Campbell, B., and J. Rosenberg, &ldquo;<a href="http://tools.ietf.org/html/rfc4662">A Session Initiation Protocol (SIP) Event Notification
          Extension for Resource Lists</a>,&rdquo; RFC&nbsp;4662, August&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4662.txt">TXT</a>).</td></tr>
</table>

<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Contributors</h3>

<p>This is my own invention, but we cannot forget the many people who
      contributed to KPML, RFC 4730.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Acknowledgements</h3>

<p>Rohan Mahy asked for this one time too many.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Burger</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BEA Systems, Inc.</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:eburger@standardstrack.com">eburger@standardstrack.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
