<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A Network Address Translator (NAT) Traversal mechanism for media controlled by Real-Time Streaming Protocol (RTSP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Definitions">
<link href="#rfc.section.3" rel="Chapter" title="3 Solution Overview">
<link href="#rfc.section.4" rel="Chapter" title="4 RTSP Extensions">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 ICE Transport Lower Layer">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 ICE Candidate Transport Header Parameter">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 ICE Password and Username Transport Header Parameters">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 ICE Feature Tag">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Status Codes">
<link href="#rfc.section.4.5.1" rel="Chapter" title="4.5.1 150 ICE connectivity checks in progress">
<link href="#rfc.section.4.5.2" rel="Chapter" title="4.5.2 480 ICE Processing Failed">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 New Reason for PLAY_NOTIFY">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Server Side SDP Attribute for ICE Support ">
<link href="#rfc.section.4.8" rel="Chapter" title="4.8 ICE Features Not Required in RTSP">
<link href="#rfc.section.4.8.1" rel="Chapter" title="4.8.1 ICE-Lite">
<link href="#rfc.section.4.8.2" rel="Chapter" title="4.8.2 ICE-Mismatch">
<link href="#rfc.section.4.8.3" rel="Chapter" title="4.8.3 ICE Remote Candidate Transport Header Parameter">
<link href="#rfc.section.5" rel="Chapter" title="5 Detailed Solution">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Session description and RTSP DESCRIBE (optional)">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Setting up the Media Streams">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 RTSP SETUP Request">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Gathering Candidates">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 RTSP Server Response">
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 Server to Client ICE Connectivity Checks">
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Client to Server ICE Connectivity Check">
<link href="#rfc.section.5.8" rel="Chapter" title="5.8 Client Connectivity Checks Complete">
<link href="#rfc.section.5.9" rel="Chapter" title="5.9 Server Connectivity Checks Complete">
<link href="#rfc.section.5.10" rel="Chapter" title="5.10 Releasing Candidates">
<link href="#rfc.section.5.11" rel="Chapter" title="5.11 Steady State">
<link href="#rfc.section.5.12" rel="Chapter" title="5.12 re-SETUP">
<link href="#rfc.section.5.13" rel="Chapter" title="5.13 Server Side Changes After Steady State">
<link href="#rfc.section.6" rel="Chapter" title="6 ICE and Proxies">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Media Handling Proxies">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Signalling Only Proxies">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Non-supporting Proxies">
<link href="#rfc.section.7" rel="Chapter" title="7 RTP and RTCP Multiplexing">
<link href="#rfc.section.8" rel="Chapter" title="8 Fallback">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 RTSP Feature Tags">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Transport Protocol Specifications">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 RTSP Transport Parameters">
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 RTSP Status Codes">
<link href="#rfc.section.9.5" rel="Chapter" title="9.5 Notify-Reason value">
<link href="#rfc.section.9.6" rel="Chapter" title="9.6 SDP Attribute">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 ICE and RTSP">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines a solution for Network Address Translation (NAT) traversal for datagram based media streams setup and controlled with Real-time Streaming Protocol version 2 (RTSP 2.0). It uses Interactive Connectivity Establishment (ICE) adapted to use RTSP as a signalling channel, defining the necessary extra RTSP extensions and procedures." />
  <meta name="description" content="This document defines a solution for Network Address Translation (NAT) traversal for datagram based media streams setup and controlled with Real-time Streaming Protocol version 2 (RTSP 2.0). It uses Interactive Connectivity Establishment (ICE) adapted to use RTSP as a signalling channel, defining the necessary extra RTSP extensions and procedures." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J.I. Goldberg</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">M. Westerlund</td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T. Zeng</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Nextwave Wireless, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A Network Address Translator (NAT) Traversal mechanism for media controlled by Real-Time Streaming Protocol (RTSP)<br />
  <span class="filename">draft-ietf-mmusic-rtsp-nat-10</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines a solution for Network Address Translation (NAT) traversal for datagram based media streams setup and controlled with Real-time Streaming Protocol version 2 (RTSP 2.0). It uses Interactive Connectivity Establishment (ICE) adapted to use RTSP as a signalling channel, defining the necessary extra RTSP extensions and procedures.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Definitions</a>
</li>
<li>3.   <a href="#rfc.section.3">Solution Overview</a>
</li>
<li>4.   <a href="#rfc.section.4">RTSP Extensions</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">ICE Transport Lower Layer</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">ICE Candidate Transport Header Parameter</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">ICE Password and Username Transport Header Parameters</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">ICE Feature Tag</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Status Codes</a>
</li>
<li>4.5.1.   <a href="#rfc.section.4.5.1">150 ICE connectivity checks in progress</a>
</li>
<li>4.5.2.   <a href="#rfc.section.4.5.2">480 ICE Processing Failed</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">New Reason for PLAY_NOTIFY</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">Server Side SDP Attribute for ICE Support </a>
</li>
<li>4.8.   <a href="#rfc.section.4.8">ICE Features Not Required in RTSP</a>
</li>
<li>4.8.1.   <a href="#rfc.section.4.8.1">ICE-Lite</a>
</li>
<li>4.8.2.   <a href="#rfc.section.4.8.2">ICE-Mismatch</a>
</li>
<li>4.8.3.   <a href="#rfc.section.4.8.3">ICE Remote Candidate Transport Header Parameter</a>
</li>
<li>5.   <a href="#rfc.section.5">Detailed Solution</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Session description and RTSP DESCRIBE (optional)</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Setting up the Media Streams</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">RTSP SETUP Request</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Gathering Candidates</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">RTSP Server Response</a>
</li>
<li>5.6.   <a href="#rfc.section.5.6">Server to Client ICE Connectivity Checks</a>
</li>
<li>5.7.   <a href="#rfc.section.5.7">Client to Server ICE Connectivity Check</a>
</li>
<li>5.8.   <a href="#rfc.section.5.8">Client Connectivity Checks Complete</a>
</li>
<li>5.9.   <a href="#rfc.section.5.9">Server Connectivity Checks Complete</a>
</li>
<li>5.10.   <a href="#rfc.section.5.10">Releasing Candidates</a>
</li>
<li>5.11.   <a href="#rfc.section.5.11">Steady State</a>
</li>
<li>5.12.   <a href="#rfc.section.5.12">re-SETUP</a>
</li>
<li>5.13.   <a href="#rfc.section.5.13">Server Side Changes After Steady State</a>
</li>
<li>6.   <a href="#rfc.section.6">ICE and Proxies</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Media Handling Proxies</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Signalling Only Proxies</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Non-supporting Proxies</a>
</li>
<li>7.   <a href="#rfc.section.7">RTP and RTCP Multiplexing</a>
</li>
<li>8.   <a href="#rfc.section.8">Fallback</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">RTSP Feature Tags</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Transport Protocol Specifications</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">RTSP Transport Parameters</a>
</li>
<li>9.4.   <a href="#rfc.section.9.4">RTSP Status Codes</a>
</li>
<li>9.5.   <a href="#rfc.section.9.5">Notify-Reason value</a>
</li>
<li>9.6.   <a href="#rfc.section.9.6">SDP Attribute</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">ICE and RTSP</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgements</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p><a href="#RFC2326">Real-time Streaming Protocol (RTSP)</a> <cite title="NONE">[RFC2326]</cite> and <a href="#I-D.ietf-mmusic-rfc2326bis">RTSP 2.0</a> <cite title="NONE">[I-D.ietf-mmusic-rfc2326bis]</cite> is protocols used to setup and control one or more media streams delivering media to receivers. It is RTSP's functionality of setting up media streams that cause serious issues with <a href="#RFC3022">Network Address Translators (NAT)</a> <cite title="NONE">[RFC3022]</cite> unless extra provisions are taken by the protocol. There is thus a need for a NAT traversal mechanism for the media setup using RTSP.</p>
<p><a href="#RFC2326">RTSP 1.0</a> <cite title="NONE">[RFC2326]</cite> has suffered from the lack of a standardized NAT traversal mechanism for a long time, however due to quality of the RTSP 1.0 specification, the work has had to wait on the specification of <a href="#I-D.ietf-mmusic-rfc2326bis">RTSP 2.0</a> <cite title="NONE">[I-D.ietf-mmusic-rfc2326bis]</cite>. RTSP 2.0 is similar to RTSP 1.0 in many respects but significantly for this work, it contains a well defined extension mechanism so allowing a NAT traversal extension to be defined that is backwards compatible with RTSP 2.0 peers not supporting the extension.  This extension mechanism was not possible in RTSP 1.0 as it would break RTSP 1.0 syntax so causing compatibility issues.</p>
<p id="rfc.section.1.p.3">There have been a number of suggested ways of resolving the NAT-traversal of media for RTSP of which a large number are already used in implementations. The <a href="#I-D.ietf-mmusic-rtsp-nat-evaluation">evaluation of these NAT traversal solutions in</a> <cite title="NONE">[I-D.ietf-mmusic-rtsp-nat-evaluation]</cite> has shown that there are many issues to consider, so after extensive evaluation, we selected a mechanism based on Interactive Connectivity Establishment (ICE). This was mainly two reasons: Firstly the mechanism supports RTSP servers behind NATs and secondly the mechanism solves the security threat that uses RTSP servers as Distributed Denial of Service (DDoS) attack tools.</p>
<p id="rfc.section.1.p.4">This document specifies an ICE based solution that is optimized for media delivery server to client. If in the future extensions are specified for other delivery modes than PLAY, then the optimizations in regards to when PLAY request are sent needs to be reconsidered.</p>
<p id="rfc.section.1.p.5">The NAT problem for RTSP signalling traffic itself is beyond the scope of this document and is left for future study should the need arise, because it is a less prevalent problem than the NAT problem for RTSP media streams.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Definitions</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Solution Overview</h1>
<p id="rfc.section.3.p.1">This overview assumes that the reader has some familiarity with how <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> in the context of <a href="#RFC3261">"SIP: Session Initiation Protocol"</a> <cite title="NONE">[RFC3261]</cite> and <a href="#RFC3264">"An Offer/Answer Model with the Session Description Protocol (SDP)"</a> <cite title="NONE">[RFC3264]</cite> works, as it primarily points out how the different ICE steps are accomplished in RTSP.</p>
<p></p>

<ol>
<li>RTSP server should indicate it has support for ICE via an <a href="#RFC4566">SDP</a> <cite title="NONE">[RFC4566]</cite> attribute ("a=rtsp-ice-d-m") in, for example, the SDP returned in RTSP DESCRIBE message. This allows RTSP clients to only send the new ICE interchanges with servers that support ICE so as to limit the overhead on current non-ICE supporting RTSP servers. If RTSP DESCRIBE is used the normal capability determination mechanism should also be used, i.e.  "Supported" header and the defined feature tag. Note: Both mechanisms should be used as there are use cases when either of them are not used.</li>
<li>The RTSP client reviews the session description returned, for example by an RTSP DESCRIBE message, to determine what media streams need to be setup. For each of these media streams where the transport protocol supports <a href="#RFC5389">Session Traversal Utilities for (NAT) (STUN)</a> <cite title="NONE">[RFC5389]</cite> based connectivity checks, the client gathers candidate addresses. See section 4.1.1 in <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>. The client also installs the STUN servers on each of the local candidates.</li>
<li>The RTSP client sends SETUP requests with both a transport specification with a lower layer indicating ICE and a new RTSP Transport header parameter listing the ICE candidates for each media stream.</li>
<li>After receiving the list of candidates from a client, the RTSP server gathers its own candidates. If the server has a public IP address, then a single candidate per address family (e.g. IPv4 and IPv6), media stream and media component tuple can be included to reduce the number of combinations and speed up the completion.</li>
<li>The server sets up the media and if successful responds to the SETUP request with a 200 OK response. In that response the server selects the transport specification using ICE and includes its candidates in the server candidate parameter.</li>
<li>The server starts the connectivity checks following the procedures described in Section 5.7 and 5.8 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>. If the server has a public IP address with a single candidate per media stream, component and address family then one may configure the server to not initiate connectivity checks.</li>
<li>The client receives the SETUP response and learns the candidate address to use for the connectivity checks, and then initiates its connectivity check, following the procedures in Section 6 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>.</li>
<li>When a connectivity check from the client reaches the server it will result in a triggered check from the server. This is why servers with a public IP address can wait until this triggered check to send out any checks for itself so saving resources and mitigating the DDoS potential from server connectivity checks.</li>
<li>When the client has concluded its connectivity checks, including promoting candidates, and has correspondingly received the server connectivity checks on the promoted candidates for all mandatory components of all media streams, it can issue a PLAY request. If the connectivity checks have not concluded successfully then the client may send a new SETUP request assuming it has any new information or believes the server may be able to do more that can result in successful checks.</li>
<li>When the RTSP servers receives a PLAY request it checks to see the connectivity checks has concluded successfully and only then can play the stream. If there is a problem with the checks then the server sends to the client either a 150 (ICE connectivity checks in progress) response to show that it is still working on the connectivity checks or a 480 (ICE Processing Failed) response to indicate a failure of the checks. If the checks are successful then the server sends a 200 OK response and starts delivering media.</li>
</ol>

<p>The client and server may release unused candidates when the ICE processing has concluded and a single candidate per component has been promoted and a PLAY response has been receiver or sent.</p>
<p id="rfc.section.3.p.3">The client shall continue to use STUN to send keep-alive for the used bindings. This is important as often RTSP media sessions only contain media traffic from the server to the client so the bindings in the NAT needs to be refreshed by the client to server traffic provided by the STUN keep-alive.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> RTSP Extensions</h1>
<p id="rfc.section.4.p.1">This section defines the necessary RTSP extensions for performing ICE with RTSP. Note that these extensions are based on the SDP attributes in the ICE specification unless expressly indicated.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sec-ice-tll" id="sec-ice-tll">ICE Transport Lower Layer</a>
</h1>
<p id="rfc.section.4.1.p.1">A new lower layer "D-ICE" for transport specifications is defined.  This lower layer is datagram clean except that the protocol used must be demultiplexiable with STUN messages (see <a href="#RFC5389">STUN</a> <cite title="NONE">[RFC5389]</cite>). With datagram clean we mean that it must be capable of describing the length of the datagram, transport that datagram (as a binary chunk of data) and provide it at the receiving side as one single item. This lower layer can be any transport type defined for ICE which does provide datagram transport capabilities. Though only UDP is defined at present, however <a href="#RFC4340">"Datagram Congestion Control Protocol (DCCP)"</a> <cite title="NONE">[RFC4340]</cite> or <a href="#RFC0793">"Transmission Control Protocol" (TCP)</a> <cite title="NONE">[RFC0793]</cite> with framing may be specified and used in the future.</p>
<p id="rfc.section.4.1.p.2">This lower layer uses ICE to determine which of the different candidates shall be used and then when the ICE processing has concluded, uses the selected candidate to transport the datagrams over this transport.</p>
<p id="rfc.section.4.1.p.3">This lower layer transport can be combined with all upper layer media transport protocols that are possible to demultiplex with STUN and which use datagrams. This specification defines the following combinations:</p>
<p></p>

<ul>
<li>RTP/AVP/D-ICE</li>
<li>RTP/AVPF/D-ICE</li>
<li>RTP/SAVP/D-ICE</li>
<li>RTP/SAVPF/D-ICE</li>
</ul>
<p id="rfc.section.4.1.p.5">This list can easily be extended with more transport specifications after having performed the evaluation that they are compatible with D-ICE as lower layer.</p>
<p id="rfc.section.4.1.p.6">The lower-layer "D-ICE" has the following rules for the inclusion of transport parameters:</p>
<p></p>

<dl>
<dt>unicast:</dt>
<dd style="margin-left: 8">As ICE only supports unicast operations, thus it is REQUIRED that one include the unicast indicator parameter, see section 16.46 in <a href="#I-D.ietf-mmusic-rfc2326bis">RTSP 2.0</a> <cite title="NONE">[I-D.ietf-mmusic-rfc2326bis]</cite>.</dd>
<dt>candidates:</dt>
<dd style="margin-left: 8">The "candidates" parameter SHALL be included as this specify at least one candidate to try to establish a working transport path with.</dd>
<dt>dest_addr:</dt>
<dd style="margin-left: 8">This parameter SHALL NOT be included as "candidates" is used instead to provide the necessary address information.</dd>
<dt>ICE-Password:</dt>
<dd style="margin-left: 8">This parameter SHALL be included.</dd>
<dt>ICE-ufrag:</dt>
<dd style="margin-left: 8">This parameter SHALL be included.</dd>
</dl>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#sec-ice-cand" id="sec-ice-cand">ICE Candidate Transport Header Parameter</a>
</h1>
<p id="rfc.section.4.2.p.1">This section defines a new RTSP transport parameter for carrying ICE candidates related to the transport specification they appear within, which may then be validated with an end-to-end connectivity check using <a href="#RFC5389">STUN</a> <cite title="NONE">[RFC5389]</cite>. Transport parameters may only occur once in each transport specification. For transport specification using "D-ICE" as lower layer, this parameter needs to be present. The parameter can contain one or more ICE candidates. In the SETUP response there is only a single transport specification, and if that uses the "D-ICE" lower layer this parameter MUST be present and include the server side candidates.</p>
<div id="#rfc.figure.1"></div>
<pre>trns-parameter = &lt;Defined in Section 20.2.3 of 
                  [I-D.ietf-mmusic-rfc2326bis]&gt;
trns-parameter =/ SEMI ice-trn-par
ice-trn-par    = "candidates" EQUAL DQ SWS ice-candidate 
                                    *(SEMI ice-candidate) SWS DQ
ice-candidate  = foundation SP 
                 component-id SP 
                 transport SP
                 priority SP
                 connection-address SP 
                 port SP         
                 cand-type
                 [SP rel-addr]
                 [SP rel-port]
                 *(SP extension-att-name SP extension-att-value) 

foundation            = &lt;See section 15.1 of [RFC5245]&gt;
component-id          = &lt;See section 15.1 of [RFC5245]&gt;
transport             = &lt;See section 15.1 of [RFC5245]&gt;
transport-extension   = &lt;See section 15.1 of [RFC5245]&gt;
priority              = &lt;See section 15.1 of [RFC5245]&gt;
cand-type             = &lt;See section 15.1 of [RFC5245]&gt;
candidate-types       = &lt;See section 15.1 of [RFC5245]&gt;
rel-addr              = &lt;See section 15.1 of [RFC5245]&gt;
rel-port              = &lt;See section 15.1 of [RFC5245]&gt;
extension-att-name    = &lt;See section 15.1 of [RFC5245]&gt;
extension-att-value   = &lt;See section 15.1 of [RFC5245]&gt;
ice-char              = &lt;See section 15.1 of [RFC5245]&gt;
connection-address    = &lt;See [RFC4566]&gt; 
port                  = &lt;See [RFC4566]&gt;                              
EQUAL                 = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
DQ                    = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
SWS                   = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
SEMI                  = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
 </pre>
<p></p>
<p id="rfc.section.4.2.p.3">&lt;connection-address&gt;: is the IP address of the candidate, allowing for IPv4 addresses, IPv6 addresses and Fully qualified domain names (FQDN), taken from <a href="#RFC4566">ICE</a> <cite title="NONE">[RFC4566]</cite>. The connection address SHOULD be on the same format (explicit IP or FQDN) as in the dest_addr parameter used to express fallbacks. An IP address SHOULD be used, but an FQDN MAY be used in place of an IP address. In that case, when receiving an SETUP request or response containing an FQDN in an candidate parameter, the FQDN is looked up in the DNS first using an AAAA record (assuming the agent supports IPv6), and if no result is found or the agent only supports IPv4, using an A record. If the DNS query returns more than one IP address, one is chosen, and then used for the remainder of ICE processing which in RTSP is subsequent RTSP SETUPs for the same RTSP session.</p>
<p id="rfc.section.4.2.p.4">&lt;port&gt;: is the port of the candidate taken from <a href="#RFC4566">SDP</a> <cite title="NONE">[RFC4566]</cite>.</p>
<p id="rfc.section.4.2.p.5">&lt;transport&gt;: indicates the transport protocol for the candidate. The ICE specification only defines UDP. However, extensibility is provided to allow for future transport protocols to be used with ICE, such as <a href="#RFC0793">TCP</a> <cite title="NONE">[RFC0793]</cite> or the <a href="#RFC4340">Datagram Congestion Control Protocol (DCCP)</a> <cite title="NONE">[RFC4340]</cite>.</p>
<p id="rfc.section.4.2.p.6">&lt;foundation&gt;: is an identifier that is equivalent for two candidates that are of the same type, share the same base, and come from the same STUN server, and is composed of one to thirty two &lt;ice-char&gt;. The foundation is used to optimize ICE performance in the Frozen algorithm.</p>
<p id="rfc.section.4.2.p.7">&lt;component-id&gt;: identifies the specific component of the media stream for which this is a candidate and os a positive integer between 1 and 256. It MUST start at 1 and MUST increment by 1 for each component of a particular candidate. For media streams based on RTP, candidates for the actual RTP media MUST have a component ID of 1, and candidates for RTCP MUST have a component ID of 2. Other types of media streams which require multiple components MUST develop specifications which define the mapping of components to component IDs. See Section 14 for additional discussion on extending ICE to new media streams.</p>
<p id="rfc.section.4.2.p.8">&lt;priority&gt;: is a positive integer between 1 and (2**31 - 1).</p>
<p id="rfc.section.4.2.p.9">&lt;cand-type&gt;: encodes the type of candidate. The ICE specification defines the values "host", "srflx", "prflx" and "relay" for host, server reflexive, peer reflexive and relayed candidates, respectively. The set of candidate types is extensible for the future.</p>
<p id="rfc.section.4.2.p.10">&lt;rel-addr&gt; and &lt;rel-port&gt;: convey transport addresses related to the candidate, useful for diagnostics and other purposes.  &lt;rel-addr&gt; and &lt;rel-port&gt; MUST be present for server reflexive, peer reflexive and relayed candidates. If a candidate is server or peer reflexive, &lt;rel-addr&gt; and &lt;rel-port&gt; is equal to the base for that server or peer reflexive candidate. If the candidate is relayed, &lt;rel-addr&gt; and &lt;rel-port&gt; is equal to the mapped address in the Allocate Response that provided the client with that relayed candidate (see Appendix B.3 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> for a discussion of its purpose). If the candidate is a host candidate &lt;rel-addr&gt; and &lt;rel-port&gt; MUST be omitted.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sec-ice-pwd" id="sec-ice-pwd">ICE Password and Username Transport Header Parameters</a>
</h1>
<p id="rfc.section.4.3.p.1">The ICE password and username for each agent needs to be transported using RTSP. For that purpose new transport header parameters are defined.</p>
<p id="rfc.section.4.3.p.2">There MUST be an "ICE-Password" and "ICE-ufrag" parameter for each media stream. If two SETUP requests in the same RTSP session have identical ICE-ufrag's, they MUST have identical ICE-Password's. The ICE-ufrag and ICE-Password attributes MUST be chosen randomly at the beginning of a session. The ICE-ufrag attribute MUST contain at least 24 bits of randomness, and the ICE-Password attribute MUST contain at least 128 bits of randomness. This means that the ICE-ufrag attribute will be at least 4 characters long, and the ICE-Password at least 22 characters long, since the grammar for these attributes allows for 6 bits of randomness per character. The attributes MAY be longer than 4 and 22 characters respectively, of course, up to 256 characters. The upper limit allows for buffer sizing in implementations. Its large upper limit allows for increased amounts of randomness to be added over time.</p>
<p id="rfc.section.4.3.p.3">The <a href="#RFC5234">ABNF</a> <cite title="NONE">[RFC5234]</cite> for these parameters are:</p>
<div id="#rfc.figure.2"></div>
<pre>trns-parameter   =/ SEMI ice-password-par
trns-parameter   =/ SEMI ice-ufrag-par
ice-password-par = "ICE-Password" EQUAL password
ice-ufrag-par    = "ICE-ufrag" EQUAL ufrag
password         = &lt;Defined in [RFC5245]&gt;
ufrag            = &lt;Defined in [RFC5245]&gt;
EQUAL            = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
SEMI             = &lt;Defined in [I-D.ietf-mmusic-rfc2326bis]&gt;
 </pre>
<p></p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#ice-feature-tag" id="ice-feature-tag">ICE Feature Tag</a>
</h1>
<p id="rfc.section.4.4.p.1">A feature tag is defined for use in the RTSP capabilities mechanism for ICE support of media transport using datagrams: "setup.ice-d-m".  This feature tag indicates that one supports all the mandatory functions of this specification. It is applicable to all types of RTSP agents; clients, servers and proxies.</p>
<p id="rfc.section.4.4.p.2">The RTSP client SHOULD send the feature tag "setup.ice-d-m" in the "Supported" header in all SETUP requests that contain the "D-ICE" lower layer transport.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Status Codes</h1>
<p id="rfc.section.4.5.p.1">ICE needs two new RTSP response codes to indicate correctly progress and errors.</p>
<p></p>
<div id="#rfc.table.1"></div>
<div id="#tab-status"></div>
<p></p>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>New Status codes and their usage with RTSP methods</caption>
<thead><tr>
<th class="left">Code</th>
<th class="left">Reason</th>
<th class="left">Method</th>
</tr></thead>
<tbody>
<tr>
<td class="left">150</td>
<td class="left">Server still working on ICE connectivity checks</td>
<td class="left">PLAY</td>
</tr>
<tr>
<td class="left"></td>
<td class="left"></td>
<td class="left"></td>
</tr>
<tr>
<td class="left">480</td>
<td class="left">ICE Connectivity check failure</td>
<td class="left">PLAY, SETUP</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.4.5.1">
<a href="#rfc.section.4.5.1">4.5.1.</a> <a href="#sec-sc-150" id="sec-sc-150">150 ICE connectivity checks in progress</a>
</h1>
<p id="rfc.section.4.5.1.p.1">The 150 response code indicates that ICE connectivity checks are still in progress and haven't concluded. This response SHALL be sent within 200 milliseconds of receiving a PLAY request that currently can't be fulfilled because ICE connectivity checks are still running. Subsequently, every 3 seconds after the previous sent one, a 150 reply shall be sent until the ICE connectivity checks conclude either successfully or in failure, and a final response for the request can be provided.</p>
<h1 id="rfc.section.4.5.2">
<a href="#rfc.section.4.5.2">4.5.2.</a> <a href="#sec-sc-480" id="sec-sc-480">480 ICE Processing Failed</a>
</h1>
<p id="rfc.section.4.5.2.p.1">The 480 client error response code is used in cases when the request can't be fulfilled due to a failure in the ICE processing, such as that all the connectivity checks have timed out. This error message can appear either in response to a SETUP request to indicate that no candidate pair can be constructed or to a PLAY request that the server's connectivity checks resulted in failure.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> <a href="#sec-notify-reason" id="sec-notify-reason">New Reason for PLAY_NOTIFY</a>
</h1>
<div id="#rfc.figure.3"></div>
<pre>
Notify-Reas-val =/ "ice-restart"
 </pre>
<p id="rfc.section.4.6.p.1">A new value used in the PLAY_NOTIFY methods Notify-Reason header is defined: "ice-restart". This reason indicates that a ICE restart needs to happen on the identified resource and session. </p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> Server Side SDP Attribute for ICE Support </h1>
<p id="rfc.section.4.7.p.1">If the server supports the media NAT traversal for RTSP controlled sessions, as described in this RFC, then the Server SHOULD include the "a=rtsp-ice-d-m" SDP attribute in any SDP (if used) describing content served by the server. This is an session level attribute.</p>
<div id="#rfc.figure.4"></div>
<pre>rtsp-ice-d-m-attr = "a=" "rtsp-ice-d-m"
 </pre>
<p></p>
<p></p>
<h1 id="rfc.section.4.8">
<a href="#rfc.section.4.8">4.8.</a> ICE Features Not Required in RTSP</h1>
<p id="rfc.section.4.8.p.1">A number of ICE signalling features are not needed with RTSP and are discussed below.</p>
<p></p>
<h1 id="rfc.section.4.8.1">
<a href="#rfc.section.4.8.1">4.8.1.</a> ICE-Lite</h1>
<p id="rfc.section.4.8.1.p.1">The ICE-Lite attribute shall not be used in the context of RTSP.  The ICE specification describes two implementations of ICE: Full and Lite, where hosts that are not behind a NAT are allowed to implement only Lite. For RTSP, the Lite implementation is insufficient because it does not cause the media server to send a connectivity check, which are used to protect against making the RTSP server a denial of service tool. This document defines another variation implementation of ICE, called ICE-RTSP. It has its own set of simplifications suitable to RTSP. Conceptually, this implementation of ICE-RTSP is between ICE-FULL and ICE-LITE for a server and simpler than ICE-FULL for clients.</p>
<h1 id="rfc.section.4.8.2">
<a href="#rfc.section.4.8.2">4.8.2.</a> ICE-Mismatch</h1>
<p id="rfc.section.4.8.2.p.1">The ice-mismatch parameter indicates that the offer arrived with a default destination for a media component that didn't have a corresponding candidate attribute. This is not needed for RTSP as the ICE based lower layer transport specification either is supported or another alternative transport is used. This is always explicitly indicated in the SETUP request and response.</p>
<h1 id="rfc.section.4.8.3">
<a href="#rfc.section.4.8.3">4.8.3.</a> ICE Remote Candidate Transport Header Parameter</h1>
<p id="rfc.section.4.8.3.p.1">The Remote candidate attribute is not needed for RTSP for the following reasons. Each SETUP results in a independent ICE processing chain which either fails or results in promoting a single candidate pair to usage. If a new SETUP request for the same media is sent this needs to use a new userfragment and password to avoid any race conditions or uncertainty for which processing round the STUN requests relate to.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Detailed Solution</h1>
<p id="rfc.section.5.p.1">This section describes in detail how the interaction and flow of ICE works with RTSP messages.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Session description and RTSP DESCRIBE (optional)</h1>
<p id="rfc.section.5.1.p.1">The RTSP server should indicate it has support for ICE by sending the "a=rtsp-ice-d-m" SDP attribute in the response to the RTSP DESCRIBE message if SDP is used. This allows RTSP clients to only send the new ICE interchanges with servers that support ICE so limiting the overhead on current non-ICE supporting RTSP servers. When not using RTSP DESCRIBE it is still recommended to use the SDP attribute for session description.</p>
<p id="rfc.section.5.1.p.2">A Client can also use the DESCRIBE request to determine explicitly if both server and any proxies support ICE. The client includes the "Supported" header with its supported feature tags, including "setup.ice-d-m". Any proxy upon seeing the "Supported" header will include the "Proxy-Supported" header with the feature tags it supports. The server will echo back the "Proxy-Supported" header and its own version of the Supported header so enabling a client to determine if all involved parties support ICE or not. Note that even if a proxy is present in the chain that doesn't indicate support for ICE, it may still work.</p>
<div id="#rfc.figure.5"></div>
<pre>For example:
     C-&gt;S: DESCRIBE rtsp://server.example.com/fizzle/foo RTSP/2.0
           CSeq: 312
           User-Agent: PhonyClient 1.2
           Accept: application/sdp, application/example
           Supported: setup.ice-d-m, setup.rtp.rtcp.mux

     S-&gt;C: RTSP/2.0 200 OK
           CSeq: 312
           Date: 23 Jan 1997 15:35:06 GMT
           Server: PhonyServer 1.1
           Content-Type: application/sdp
           Content-Length: 367
           Supported: setup.ice-d-m, setup.rtp.rtcp.mux

           v=0
           o=mhandley 2890844526 2890842807 IN IP4 192.0.2.46
           s=SDP Seminar
           i=A Seminar on the session description protocol
           u=http://www.example.com/lectures/sdp.ps
           e=seminar@example.com (Seminar Management)
           t=2873397496 2873404696
           a=recvonly
           a=rtsp-ice-d-m
           a=control: *           
           m=audio 3456 RTP/AVP 0
           a=control: /audio
           m=video 2232 RTP/AVP 31
           a=control: /video
 </pre>
<p></p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Setting up the Media Streams</h1>
<p id="rfc.section.5.2.p.1">The RTSP client reviews the session description returned, for example by an RTSP DESCRIBE message, to determine what media resources that need to be setup. For each of these media streams where the transport protocol supports ICE connectivity checks, the client SHALL gather candidate addresses as described in section 4.1.1 in <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> according to standard ICE rather than the ICE-Lite implementation.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> RTSP SETUP Request</h1>
<p id="rfc.section.5.3.p.1">The RTSP client will then send at least one SETUP request per media stream to establish the media streams required for the desired session. For each media stream where it desires to use ICE it will include a transport specification with "D-ICE" as the lower layer, and each media stream SHALL have its own unique ICE candidates. This transport specification SHOULD be placed first in the list to give it highest priority. It is RECOMMENDED that additional transport specifications are provided as a fallback in case of non ICE supporting proxies. For example (Note that some lines are broken in contradiction with the defined syntax due to space restrictions in the documenting format:</p>
<div id="#rfc.figure.6"></div>
<pre>
C-&gt;S: SETUP rtsp://server.example.com/fizzle/foo/audio RTSP/2.0
      CSeq: 302
      Transport: RTP/AVP/D-ICE; unicast; ICE-ufrag=8hhY;
                ICE-Password=asd88fgpdd777uzjYhagZg; candidates="
                1 1 UDP 2130706431 10.0.1.17 8998 typ host;
                2 1 UDP 1694498815 192.0.2.3 45664 typ srflx 
                         raddr 10.0.1.17 rport 9002"; RTCP-mux,
                RTP/AVP/UDP; unicast; dest_addr=":6970"/":6971",
                RTP/AVP/TCP;unicast;interleaved=0-1
      Accept-Ranges: NPT, UTC
      User-Agent: PhonyClient/1.2
      Supported: setup.ice-d-m, setup.rtp.rtcp.mux

</pre>
<p id="rfc.section.5.3.p.2">The RTSP client will be initiating and thus the controlling party in the ICE processing.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#server-gather" id="server-gather">Gathering Candidates</a>
</h1>
<p id="rfc.section.5.4.p.1">Upon receiving a SETUP request the server can determine what media resource should be delivered and which transport alternatives that the client supports. If one based on D-ICE is on the list of supported transports and prefered among the support, the below applies.</p>
<p id="rfc.section.5.4.p.2">The transport specification will provide which media protocol is to be used and based on this and the clients candidates, the server determines the protocol and if it supports ICE with that protocol. The server shall then gather its candidates according to section 4.1.1 in <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>. Servers that have an address that is generally reachable by any clients within the address scope the server intends to serve MAY be specially configured (high-reachability configuration). This special configuration has the goal of reducing the server side candidate to preferably a single one per (address family, media stream, media component) tuple. Instead of gathering all possible addresses including relayed and server reflexive addresses, the server uses a single address per address family that it knows it should be reachable by a client behind one or more NATs. The reason for this special configuration is two fold: Firstly it reduces the load on the server in address gathering and in ICE processing during the connectivity checks. Secondly it will reduce the number of permutations for candidate pairs significantly thus potentially speeding up the conclusion of the ICE processing. Note however that using this option on a server that doesn't fulfill the requirement of being reachable is counter-productive and it is important that this is correctly configured.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> RTSP Server Response</h1>
<p id="rfc.section.5.5.p.1">The server determines if the SETUP request is successful from the other perspectives and will return a 200 OK response, otherwise returning an error code from the list in Table 4 in <a href="#I-D.ietf-mmusic-rfc2326bis">[I-D.ietf-mmusic-rfc2326bis]</a>. At that point the server, having selected a transport specification using the "D-ICE" lower layer, will need to include that transport specification in the response message. The transport specification shall include the candidates gathered in <a href="#server-gather">Section 5.4</a> in the "candidates" transport header parameter as well as the server's username and password. In the case that there are no valid candidate pairs with the combination of the client and servers candidates, a 480 (ICE Processing Failed) error response shall be returned which must include the servers' candidates. The return of a 480 error allows both the server and client to release its candidates.</p>
<div id="#rfc.figure.7"></div>
<pre>S-&gt;C: RTSP/2.0 200 OK 
      CSeq: 302
      Session: 12345678
      Transport: RTP/AVP/D-ICE; unicast; RTCP-mux; ICE-ufrag=MkQ3;
                ICE-Password=pos12Dgp9FcAjpq82ppaF; candidates="
                 1 1 UDP 2130706431 192.0.2.56 50234 typ host"
      Accept-Ranges: NPT
      Date: 23 Jan 1997 15:35:06 GMT
      Server: PhonyServer 1.1
      Supported: setup.ice-d-m, setup.rtp.rtcp.mux
 </pre>
<p></p>
<h1 id="rfc.section.5.6">
<a href="#rfc.section.5.6">5.6.</a> Server to Client ICE Connectivity Checks</h1>
<p id="rfc.section.5.6.p.1">The server shall start the connectivity checks following the procedures described in Section 5.7 and 5.8 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> unless it is configured to use the high-reachability option. If it is then it can suppress its own checks until the servers checks are triggered by the client's connectivity checks.</p>
<p id="rfc.section.5.6.p.2">Please note that section 5.8 does specify that the initiation of the checks are paced and new ones are only started every Ta milliseconds. The motivation for this is documented in Appendix B.1 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite> as for SIP/SDP all media streams within an offer/answer dialog are running using the same queue. To ensure the same behavior with RTSP, the server SHALL use a single pacer queue for all media streams within each RTSP session.</p>
<p id="rfc.section.5.6.p.3">The values for the pacing of STUN and TURN transactions Ta and RTO can be configured but have some minimum values defined in the ICE specification.</p>
<p id="rfc.section.5.6.p.4">When a connectivity check from the client reaches the server it will result in a triggered check from the server as specified in section 7.2.1.4 of <a href="#RFC5245">ICE</a> <cite title="NONE">[RFC5245]</cite>. This is why servers with a high reachability address can wait until this triggered check to send out any checks for itself so saving resources and mitigating the DDoS potential.</p>
<h1 id="rfc.section.5.7">
<a href="#rfc.section.5.7">5.7.</a> Client to Server ICE Connectivity Check</h1>
<p id="rfc.section.5.7.p.1">The client receives the SETUP response and learns the candidate address to use for the connectivity checks. The client shall initiate its connectivity check, following the procedures in Section 6 of <a href="#RFC5245">[RFC5245]</a>. The STUN transaction pacer SHALL be used across all media streams part of the same RTSP session.</p>
<p id="rfc.section.5.7.p.2">Aggressive nomination SHALL be used with RTSP. This doesn't have the negative impact that it has in offer/answer as media playing only starts after issuing a PLAY request.</p>
<h1 id="rfc.section.5.8">
<a href="#rfc.section.5.8">5.8.</a> Client Connectivity Checks Complete</h1>
<p id="rfc.section.5.8.p.1">When the client has concluded all of its connectivity checks and has nominated its desired candidate for a particular media stream, it MAY issue a PLAY request for that stream. Note, that due to the aggressive nomination, there is a risk that any outstanding check may nominate another pair than what was already nominated. If the client has locally determined that its checks have failed it may try providing an extended set of candidates and update the server candidate list by issuing a new SETUP request for the media stream.</p>
<p id="rfc.section.5.8.p.2">If the client concluded its connectivity checks successfully and therefore sent a PLAY request but the server cannot conclude successfully, the server will respond with a 480 (ICE Processing Failed). Upon receiving the 480 (ICE Processing Failed) response, the client may send a new SETUP request assuming it has any new information that can be included in the candidate list. If the server is still performing the checks it will respond with a 150 (CE connectivity checks in progress) response to indicate this.</p>
<h1 id="rfc.section.5.9">
<a href="#rfc.section.5.9">5.9.</a> Server Connectivity Checks Complete</h1>
<p id="rfc.section.5.9.p.1">When the RTSP server receives a PLAY request, it checks to see that the connectivity checks have concluded successfully and only then will it play the stream. If the PLAY request is for a particular media stream, the server only needs to check that the connectivity checks for that stream completely successfully. If the server has not concluded its connectivity checks the server indicates that by sending the <a href="#sec-sc-150">150 (ICE connectivity checks in progress)</a> <cite title="NONE">[sec-sc-150]</cite>. If there is a problem with the checks then the server sends to the client a 480 response to indicate a failure of the checks. If the checks are successful then the server sends a 200 OK response and starts delivering media.</p>
<h1 id="rfc.section.5.10">
<a href="#rfc.section.5.10">5.10.</a> Releasing Candidates</h1>
<p id="rfc.section.5.10.p.1">Both server and client may release its non nominated candidates as soon as a 200 PLAY response has been issued/received and no outstanding connectivity checks exist.</p>
<h1 id="rfc.section.5.11">
<a href="#rfc.section.5.11">5.11.</a> Steady State</h1>
<p id="rfc.section.5.11.p.1">The client will continue to use STUN to send keep-alive for the nominated candidate pair(s). This is important as normally RTSP play mode sessions only contain traffic from the server to the client so the bindings in the NAT need to be refreshed by the client to server traffic provided by the STUN keep-alive.</p>
<h1 id="rfc.section.5.12">
<a href="#rfc.section.5.12">5.12.</a> re-SETUP</h1>
<p id="rfc.section.5.12.p.1">The server SHALL support SETUP requests in PLAYING state, as long as the SETUP changes only the ICE parameters, which are: ICE-Password, ICE-ufrag and the content of ICE candidates.</p>
<p id="rfc.section.5.12.p.2">If the client decides to change any parameters related to the media stream setup it will send a new SETUP request. In this new SETUP request the client SHALL include a new different username and password to use in the ICE processing. This request will also cause the ICE processing to start from the beginning again.</p>
<p id="rfc.section.5.12.p.3">If the RTSP session is in playing state at the time of sending the SETUP request, the ICE connectivity checks SHALL use Regular nomination. Any ongoing media delivery continues on the previously nominated candidate pairs until the new pairs have been nominated for the individual candidate. Once the nomination of the new candidate pair has completed, all unused candidates may be released.</p>
<h1 id="rfc.section.5.13">
<a href="#rfc.section.5.13">5.13.</a> Server Side Changes After Steady State</h1>
<p id="rfc.section.5.13.p.1">A Server may require an ICE restart because of server side load balancing or a failure resulting in an IP address and a port number change. It shall use the PLAY_NOTIFY method to inform the client (<a href="#I-D.ietf-mmusic-rfc2326bis">Section 13.5</a> <cite title="NONE">[I-D.ietf-mmusic-rfc2326bis]</cite>) with a new Notify-Reason header: ice-restart. The server will identify if the change is for a single media or for the complete session by including the corresponding URI in the PLAY_NOTIFY request.</p>
<p id="rfc.section.5.13.p.2">Upon receiving and responding to this PLAY_NOTIFY with ice-restart reason the client SHALL gather new ICE candidates, send SETUP requests for each media stream part of the session. The server provides its candidates in the SETUP response the same way as for the first time ICE processing. Both server and client shall provide new ICE usernames and passwords. The client MAY issue the SETUP request while the session is in PLAYING state.</p>
<p id="rfc.section.5.13.p.3">If the RTSP session is in PLAYING state when the client issues the SETUP request, the client SHALL use regular nomination. If not the client will use the same procedures as for when first creating the session.</p>
<p id="rfc.section.5.13.p.4">Note that keepalives on the previous set of candidate pairs should continue until all new candidate pairs have been nominated. After having nominated a new set of candidate pairs, the client may continue to receive media for some additional time. Even if the server stops delivering media over that candidate pair at the time of nomination, media may arrive for up to one maximum segment lifetime as defined in TCP (2 minutes). Unfortuntately, if the RTSP server is divided into a separate controller and media streame, a failure may result in continued media delivery for a longer time than the maximum segment liftime, thus source filtering is recommended.</p>
<div id="#rfc.figure.8"></div>
<pre>For example:
     
S-&gt;C: PLAY_NOTIFY rtsp://example.com/fizzle/foo RTSP/2.0
      CSeq: 854
      Notify-Reason: ice-restart
      Session: uZ3ci0K+Ld
      Server: PhonyServer 1.1

C-&gt;S: RTSP/2.0 200 OK
      CSeq: 854
      User-Agent: PhonyClient/1.2

C-&gt;S: SETUP rtsp://server.example.com/fizzle/foo/audio RTSP/2.0
      CSeq: 302
      Session: uZ3ci0K+Ld
      Transport: RTP/AVP/D-ICE; unicast; ICE-ufrag=Kl1C;
                 ICE-Password=H4sICGjBsEcCA3Rlc3RzLX; candidates="
                 1 1 UDP 2130706431 10.0.1.17 8998 typ host;
                 2 1 UDP 1694498815 192.0.2.3 51456 typ srflx 
                         raddr 10.0.1.17 rport 9002"; RTCP-mux,
                 RTP/AVP/UDP; unicast; dest_addr=":6970"/":6971",
                 RTP/AVP/TCP;unicast;interleaved=0-1
      Accept-Ranges: NPT, UTC
      User-Agent: PhonyClient/1.2

C-&gt;S: SETUP rtsp://server.example.com/fizzle/foo/video RTSP/2.0
      CSeq: 303
      Session: uZ3ci0K+Ld
      Transport: RTP/AVP/D-ICE; unicast; ICE-ufrag=hZv9;
                 ICE-Password=JAhA9myMHETTFNCrPtg+kJ; candidates="
                 1 1 UDP 2130706431 10.0.1.17 9000 typ host;
                 2 1 UDP 1694498815 192.0.2.3 51576 typ srflx 
                         raddr 10.0.1.17 rport 9004"; RTCP-mux,
                 RTP/AVP/UDP; unicast; dest_addr=":6972"/":6973",
                 RTP/AVP/TCP;unicast;interleaved=0-1
      Accept-Ranges: NPT, UTC
      User-Agent: PhonyClient/1.2

S-&gt;C: RTSP/2.0 200 OK 
      CSeq: 302
      Session: uZ3ci0K+Ld
      Transport: RTP/AVP/D-ICE; unicast; RTCP-mux; ICE-ufrag=CbDm;
                 ICE-Password=OfdXHws9XX0eBr6j2zz9Ak; candidates="
                 1 1 UDP 2130706431 192.0.2.56 50234 typ host"
      Accept-Ranges: NPT
      Date: 11 March 2011 13:17:46 GMT
      Server: PhonyServer 1.1

S-&gt;C: RTSP/2.0 200 OK 
      CSeq: 303
      Session: uZ3ci0K+Ld
      Transport: RTP/AVP/D-ICE; unicast; RTCP-mux; ICE-ufrag=jigs;
                 ICE-Password=Dgx6fPj2lsa2WI8b7oJ7+s; candidates="
                 1 1 UDP 2130706431 192.0.2.56 47233 typ host"
      Accept-Ranges: NPT
      Date: 11 March 2011 13:17:47 GMT
      Server: PhonyServer 1.1
           </pre>
<p></p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> ICE and Proxies</h1>
<p id="rfc.section.6.p.1">RTSP allows for proxies which can be of two fundamental types depending if they relay and potentially cache the media or not. Their differing impact on the RTSP NAT traversal solution, including backwards compatibility, is explained below.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Media Handling Proxies</h1>
<p id="rfc.section.6.1.p.1">An RTSP proxy that relays or caches the media stream for a particular media session can be considered to split the media transport into two parts: A media transport between the server and the proxy according to the proxies need, and delivery from the proxy to the client. This split means that the NAT traversal solution will need to be run on each individual media leg according to need.</p>
<p id="rfc.section.6.1.p.2">It is RECOMMENDED that any media handling proxy support the media NAT traversal defined within this specification. This is for two reasons: Firstly to enable clients to perform NAT traversal for the media between the proxy and itself and secondly to allow the proxy to be topology independent so able to support performing NAT traversal for non-NAT traversal capable clients present in the same address domain.</p>
<p id="rfc.section.6.1.p.3">For a proxy to support the media NAT traversal defined in this specification a proxy will need to implement the solution fully and be ready as both a controlling and a controlled ICE peer. The proxy also SHALL include the "setup.ice-d-m" feature tag in any applicable capability negotiation headers, such as "Proxy-Supported."</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> Signalling Only Proxies</h1>
<p id="rfc.section.6.2.p.1">A signalling only proxy handles only the RTSP signalling and does not have the media relayed through proxy functions. This type of proxy is not likely to work unless the media NAT traversal solution is in place between the client and the server, because the DoS protection measures usually prevent media delivery to other addresses other than from where the RTSP signalling arrives at the server.</p>
<p id="rfc.section.6.2.p.2">The solution for the Signalling Only proxy is that it must forward the RTSP SETUP requests including any transport specification with the "D-ICE" lower layer and the related transport parameters. A proxy supporting this functionality SHOULD indicate its capability by always including the "setup.ice-d-m" feature tag in the "Proxy-Supported" header.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> Non-supporting Proxies</h1>
<p id="rfc.section.6.3.p.1">A media handling proxy that doesn't support the ICE media NAT traversal specified here is assumed to remove the transport specification and use any of the lower prioritized transport specifications if provided by the requester. The specification of such a non ICE transport enables the negotiation to complete, although with a less prefered method as a NAT between the proxy and the client will likely result in failure of the media path.</p>
<p id="rfc.section.6.3.p.2">A non-media handling transport proxy is expected to ignore and simply forward all unknown transport specifications, however, this can only be guaranteed for proxies following the published RTSP 2.0 specification.</p>
<p id="rfc.section.6.3.p.3">Unfortunately the usage of the "setup.ice-d-m" feature tag in the proxy-require will have contradicting results. For a non ICE supporting media handling proxy, the inclusion of the feature tag will result in aborting the setup and indicating that it isn't supported, which is desirable if you want to provide other fallbacks or other transport configurations to handle the situation. For non-supporting non-media handling proxies the result will also result in aborting the setup, however, setup might have worked if the proxy-require tag wasn't present. This variance in results is the reason we don't recommend the usage of the Proxy-Require header. Instead we recommend the usage of the Supported header to force proxies to include the feature tags they support in the proxy-supported which will provide a positive indication when all proxies in the chain between the client and server support the functionality. Even if not explicitly indicating support, any SETUP response including a transport specification with "D-ICE" will be implicit indication that the proxy chain supports at least passthrough of this media.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#rtp-mux" id="rtp-mux">RTP and RTCP Multiplexing</a>
</h1>
<p><a href="#RFC5761">"Multiplexing RTP Data and Control Packets on a Single Port"</a> <cite title="NONE">[RFC5761]</cite> specifies how and when RTP and RTCP can be multiplexed on the same port. This multiplexing SHALL be combined with ICE as it makes RTP and RTCP need only a single component per media stream instead of two, so reducing the load on the connectivity checks.  For details on how one negotiate RTP and RTCP multiplexing, see Appendix B of <a href="#I-D.ietf-mmusic-rfc2326bis">RTSP 2.0</a> <cite title="NONE">[I-D.ietf-mmusic-rfc2326bis]</cite>.</p>
<p id="rfc.section.7.p.2">Multiplexing RTP and RTCP has the benefit that it avoids the need for handling two components per media stream when RTP is used as the media transport protocol. This eliminates at least one STUN check per media stream and will also reduce the time needed to complete the ICE processing by at least the time it takes to pace out the additional STUN checks of up to one complete round trip time for a single media stream.  In addition to the protocol performance improvements, the server and client side complexities are reduced as multiplexing halves the total number of STUN instances and holding the associate state. Multiplexing will also reduce the combinations and length of the list of possible candidates.</p>
<p id="rfc.section.7.p.3">The implementation of RTP and RTCP multiplexing is additional work required for this solution. However, when implementing the ICE solution a server or client will need to implement a de-multiplexer between the STUN, and RTP or RTCP packets below the RTP/RTCP implementation anyway, so the additional work of one new demultiplexing point directly connected to the STUN and RTP/RTCP seems small relative to the benefits provided.</p>
<p id="rfc.section.7.p.4">Due to the above mentioned benefits, RTSP servers and clients that supports "D-ICE" lower layer transport in combination with RTP SHALL also implement RTP and RTCP multiplexing as specified in this section and <a href="#RFC5761">[RFC5761]</a>.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Fallback</h1>
<p id="rfc.section.8.p.1">The need for fallback from ICE in RTSP should be less than for SIP using ICE in SDP offer/answer where a default destination candidate is very important. This as capability determination for ICE can happen prior to the RTSP SETUP request. Thus a client should normally not needed to include fallback alternatives when offering ICE, as the capability for ICE will already be determined. Thus this section likely applies more to the cases where the server is not ICE capable and the client wishes to use part of the ICE functionality to improve NAT/Firewall traversal.</p>
<p><a href="#RFC5245">Section 4.1.4 of the ICE</a> <cite title="NONE">[RFC5245]</cite> specification does recommend that the default destination, i.e. what is used in fallback if the peer isn't ICE capable is a candidate of relayed type to maximize the likelyhood of succesfull transport of media. This is based on that the peer in SIP SDP offer/answer is almost as likely as the RTSP client to be behind a NAT. For RTSP the deployement of servers are much more heavily weighted towards deployment with public reachability. In fact due to that servers behind NAT either needs to support ICE or have static configurations that allow traversal one can assume that the server will have a public address or support ICE. Thus, the selection of the default destination address for RTSP can be differently prioritized.  </p>
<p id="rfc.section.8.p.3">As an ICE enabled client needs to configured with a STUN server address to be able to gather candidates successfully, this can be utilized to derive a server reflexive candidate for the clients port.  How useful this is for an RTSP client as default candidate depends on the properties of the NAT. As long as the NAT use an address independent mapping, then using a STUN derived reflexive candidate is likely to be successfully. This is however brittle in several ways. First, the NATs behavior can be determined using STUN as described in <a href="#RFC3489">[RFC3489]</a>, however this might not be represenative of the behavior encountered in another mapping. Secondly, filter state towards the ports used by the server needs to be established. This requires that the server actually include both address and ports in its response to the SETUP request. Thirdly messages needs to be sent to these ports for keep-alive at a regular interval. How a server reacts to such unsolicited traffic is unknown. This brittleness may be accepted in fallback due to lack of support on the server side. </p>
<p id="rfc.section.8.p.4">Fallback addresses needs to be provided in their own transport specification using a specifier that do not include the "D-ICE" lower layer transport. Instead the selected protocol, e.g. UDP needs to be explicitly or implictly indicated. Secondly the selected default candidate needs to be included in the SETUP request. If this candidate is server reflexive or relayed the aspect of keep-alive needs to be ensured. </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document request registration in a number of registries, both for RTSP and SDP.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> RTSP Feature Tags</h1>
<p id="rfc.section.9.1.p.1">This document request that one RTSP 2.0 feature tags are registered in the "RTSP 2.0 feature tag" registry:</p>
<p></p>

<dl>
<dt>setup.ice-d-m</dt>
<dd style="margin-left: 8">See <a href="#ice-feature-tag">Section 4.4</a>.</dd>
</dl>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> Transport Protocol Specifications</h1>
<p id="rfc.section.9.2.p.1">This document needs to register a number of transport protocol combinations are registered in RTSP 2.0's "Transport Protocol Specifications" registry.</p>
<p></p>

<dl>
<dt>"RTP/AVP/D-ICE"</dt>
<dd style="margin-left: 8"></dd>
<dt>"RTP/AVPF/D-ICE"</dt>
<dd style="margin-left: 8"></dd>
<dt>"RTP/SAVP/D-ICE"</dt>
<dd style="margin-left: 8"></dd>
<dt>"RTP/SAVPF/D-ICE"</dt>
<dd style="margin-left: 8"></dd>
</dl>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> RTSP Transport Parameters</h1>
<p id="rfc.section.9.3.p.1">This document requests that 3 transport parameters are registered in RTSP 2.0's "Transport Parameters":</p>
<p></p>

<dl>
<dt>"candidates":</dt>
<dd style="margin-left: 8">See Section <a href="#sec-ice-cand">Section 4.2</a>.</dd>
<dt>"ICE-Password":</dt>
<dd style="margin-left: 8">See Section <a href="#sec-ice-pwd">Section 4.3</a>.</dd>
<dt>"ICE-ufrag":</dt>
<dd style="margin-left: 8">See Section <a href="#sec-ice-pwd">Section 4.3</a>.</dd>
</dl>
<h1 id="rfc.section.9.4">
<a href="#rfc.section.9.4">9.4.</a> RTSP Status Codes</h1>
<p id="rfc.section.9.4.p.1">This document requests that 2 assignments are done in the "RTSP 2.0 Status Codes" registry. The suggested values are:</p>
<p></p>

<dl>
<dt>150:</dt>
<dd style="margin-left: 8">See Section <a href="#sec-sc-150">Section 4.5.1</a>.</dd>
<dt>480:</dt>
<dd style="margin-left: 8">See Section <a href="#sec-sc-480">Section 4.5.2</a>.</dd>
</dl>
<h1 id="rfc.section.9.5">
<a href="#rfc.section.9.5">9.5.</a> Notify-Reason value</h1>
<p id="rfc.section.9.5.p.1">This document requests that one assignment is done in the RTSP 2.0 Notify-Reason header value registry. The defined value is:</p>
<p></p>

<dl>
<dt>ice-restart:</dt>
<dd style="margin-left: 8">See section <a href="#sec-notify-reason">Section 4.6</a>.</dd>
</dl>
<h1 id="rfc.section.9.6">
<a href="#rfc.section.9.6">9.6.</a> SDP Attribute</h1>
<div id="#rfc.figure.9"></div>
<pre>   SDP Attribute ("att-field"):

     Attribute name:     rtsp-ice-d-m
     Long form:          ICE for RTSP datagram media NAT traversal 
     Type of name:       att-field
     Type of attribute:  Session level only
     Subject to charset: No
     Purpose:            RFC XXXX
     Reference:          RFC XXXX
     Values:             No values defined.
     Contact:            Magnus Westerlund
                         E-mail: magnus.westerlund@ericsson.com
                         phone: +46 10 714 82 87
 </pre>
<p id="rfc.section.9.6.p.1">The registration of one SDP attribute is requested: </p>
<p></p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">ICE <a href="#RFC5245">[RFC5245]</a> provides an extensive discussion on security considerations which applies here as well.</p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> ICE and RTSP</h1>
<p id="rfc.section.10.1.p.1">A long-standing risk with transmitting a packet stream over UDP is that the host may not be interested in receiving the stream. On today's Internet many hosts are behind NATs or operate host firewalls which do not respond to unsolicited packets with an ICMP port unreachable error. Thus, an attacker can construct RTSP SETUP requests with a victim's IP address and cause a flood of media packets to be sent to a victim. The addition of ICE, as described in this document, provides protection from the attack described above. By performing the ICE connectivity check, the media server receives confirmation that the RTSP client wants the media. While this protection could also be implemented by requiring the IP addresses in the SDP match the IP address of the RTSP signaling packet, such a mechanism does not protect other hosts with the same IP address (such as behind the same NAT), and such a mechanism would prohibit separating the RTSP controller from the media playout device (e.g., an IP-enabled remote control and an IP-enabled television), it also forces RTSP proxies to relay the media streams through them, even if they only are signalling proxies.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.11.p.1">The authors would like to thank R&#233;mi Denis-Courmont for suggesting the method of integrating ICE in RTSP signalling, Dan Wing for help with the security section and numerous other issues.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5389">[RFC5389]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mmusic-rfc2326bis">[I-D.ietf-mmusic-rfc2326bis]</b></td>
<td class="top">
<a>Schulzrinne, H</a>, <a>Rao, A</a>, <a>Lanphier, R</a>, <a>Westerlund, M</a> and <a>M Stiemerling</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mmusic-rfc2326bis-28">Real Time Streaming Protocol 2.0 (RTSP)</a>", Internet-Draft draft-ietf-mmusic-rfc2326bis-28, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5245">[RFC5245]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5761">[RFC5761]</b></td>
<td class="top">
<a>Perkins, C.</a> and <a>M. Westerlund</a>, "<a href="http://tools.ietf.org/html/rfc5761">Multiplexing RTP Data and Control Packets on a Single Port</a>", RFC 5761, April 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-mmusic-rtsp-nat-evaluation">[I-D.ietf-mmusic-rtsp-nat-evaluation]</b></td>
<td class="top">
<a>Westerlund, M</a> and <a>T Zeng</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mmusic-rtsp-nat-evaluation-04">The Evaluation of Different Network Addres Translator (NAT) Traversal Techniques for Media Controlled by Real-time Streaming Protocol (RTSP)</a>", Internet-Draft draft-ietf-mmusic-rtsp-nat-evaluation-04, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0793">[RFC0793]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>", STD 7, RFC 793, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3022">[RFC3022]</b></td>
<td class="top">
<a>Srisuresh, P.</a> and <a>K. Egevang</a>, "<a href="http://tools.ietf.org/html/rfc3022">Traditional IP Network Address Translator (Traditional NAT)</a>", RFC 3022, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2326">[RFC2326]</b></td>
<td class="top">
<a href="mailto:schulzrinne@cs.columbia.edu" title="Columbia University, Dept. of Computer Science">Schulzrinne, H.</a>, <a href="mailto:anup@netscape.com" title="Netscape Communications Corp.">Rao, A.</a> and <a href="mailto:robla@real.com" title="RealNetworks">R. Lanphier</a>, "<a href="http://tools.ietf.org/html/rfc2326">Real Time Streaming Protocol (RTSP)</a>", RFC 2326, April 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4340">[RFC4340]</b></td>
<td class="top">
<a>Kohler, E.</a>, <a>Handley, M.</a> and <a>S. Floyd</a>, "<a href="http://tools.ietf.org/html/rfc4340">Datagram Congestion Control Protocol (DCCP)</a>", RFC 4340, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3489">[RFC3489]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Weinberger, J.</a>, <a>Huitema, C.</a> and <a>R. Mahy</a>, "<a href="http://tools.ietf.org/html/rfc3489">STUN - Simple Traversal of User Datagram Protocol (UDP) Through Network Address Translators (NATs)</a>", RFC 3489, March 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jeff Goldberg</span> 
	  <span class="n hidden">
		<span class="family-name">Goldberg</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco</span>
	<span class="adr">
	  <span>11 New Square, Bedfont Lakes</span>

	  <span class="vcardline">
		<span class="locality">Feltham,</span>,  
		<span class="region">Middx</span> 
		<span class="code">TW14 8HA</span>
	  </span>
	  <span class="country-name vcardline">United Kingdom</span>
	</span>
	<span class="vcardline">Phone: +44 20 8824 1000</span>

<span class="vcardline">EMail: <a href="mailto:jgoldber@cisco.com">jgoldber@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Magnus Westerlund</span> 
	  <span class="n hidden">
		<span class="family-name">Westerlund</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Torshamsgatan 23</span>

	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">SE-164 80</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">Phone: +46 8 719 0000</span>

<span class="vcardline">EMail: <a href="mailto:magnus.westerlund@ericsson.com">magnus.westerlund@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Thomas Zeng</span> 
	  <span class="n hidden">
		<span class="family-name">Zeng</span>
	  </span>
	</span>
	<span class="org vcardline">Nextwave Wireless, Inc.</span>
	<span class="adr">
	  <span>12670 High Bluff Drive</span>

	  <span class="vcardline">
		<span class="locality">San Diego</span>,  
		<span class="region">CA</span> 
		<span class="code">92130</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 858 480 3100</span>

<span class="vcardline">EMail: <a href="mailto:thomas.zeng@gmail.com">thomas.zeng@gmail.com</a></span>

  </address>
</div>

</body>
</html>