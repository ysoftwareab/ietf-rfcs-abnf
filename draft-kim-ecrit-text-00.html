<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Emergency Text Messaging using SIP
    MESSAGE</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Emergency Text Messaging using SIP
    MESSAGE">
<meta name="keywords" content="emergency, text">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">ECRIT</td><td class="header">J. Kim</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">W. Song</td></tr>
<tr><td class="header">Intended status: BCP</td><td class="header">H. Schulzrinne</td></tr>
<tr><td class="header">Expires: May 21, 2010</td><td class="header">Columbia University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">P. Boni</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Armstrong</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Verizon</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 17, 2009</td></tr>
</table></td></tr></table>
<h1><br />Emergency Text Messaging using SIP
    MESSAGE<br />draft-kim-ecrit-text-00</h1>

<h3>Abstract</h3>

<p>This memo describes best current practices on how to use the SIP
      MESSAGE method for emergency text messaging from citizen and visitors to
      authorities.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 21, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Terminology<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#overview">3.</a>&nbsp;
Overview of operation<br />
<a href="#CallerUAC">4.</a>&nbsp;
Caller UAC Processing<br />
<a href="#ProxyProcessing">5.</a>&nbsp;
Proxy Processing<br />
<a href="#conversion">6.</a>&nbsp;
Conversion to SIP MESSAGE<br />
<a href="#Security">7.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Terminology</h3>

<p>This document uses terms from <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., Ed., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant           Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>.
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>The SIP MESSAGE method <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., Ed., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant           Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> is used for
      page-mode messaging. In page mode, each individual message is sent
      independently and not as part of any session. On the other hand, there
      are session-mode text messaging standards such as the Message Session
      Relay Protocol (MSRP) <a class='info' href='#RFC4975'>[RFC4975]<span> (</span><span class='info'>Campbell, B., Ed., Mahy, R., Ed., and C. Jennings, Ed., &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a> and Real Time Text
      (RTT) <a class='info' href='#RFC5194'>[RFC5194]<span> (</span><span class='info'>van Wijk, A., Ed. and G. Gybels, Ed., &ldquo;Framework for Real-Time Text over IP Using the Session           Initiation Protocol (SIP),&rdquo; June&nbsp;2008.</span><span>)</span></a> where every message is part of a
      session with a definite start and end. Which mode to use in an emergency
      depends on what the endpoint is capable of.
</p>
<p>This document describes how the SIP MESSAGE method is used to support
      emergency text messaging within the framework described in <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a>. The existing framework does
      not consider methods that do not create a session or are not a part of
      it. The main difference between the existing framework and the MESSAGE
      approach is in the way the proxies handle SIP MESSAGE methods.
</p>
<p>This document assumes that the Emergency Services network (ESInet)
      and PSAPs are SIP-based infrastructures. However, the caller-facing
      access network may or may not be IP based. Emergency messages may be
      sent end-to-end using the SIP MESSAGE method, or it may be in a
      different format and protocol in the caller side and have to be
      converted to SIP MESSAGE somewhere along the path towards the call
      taker. Therefore, we also describe recommendations on how a SIP MESSAGE
      is formed from non-SIP text protocols.
</p>
<p>Presence is beyond the scope of this document.
</p>
<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview of operation</h3>

<p><br /><hr class="insert" />
<a name="figure_textflow"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>                                               +-------+
                                               | PSAP2 |
                                               +-------+

  +------+ [SIP] +-------+     +------+     +-------+
  |SIP UA| -----&gt;| Proxy |----&gt;| ESRP |----&gt;| PSAP1 |-----&gt; Call-Taker
  +------+       +-------+     +------+     +-------+
                                   ^
  +----------+ [SMS] +--------+    |           +-------+
  |Cell phone| -----&gt;| SMS GW |----| [SIP]     | PSAP3 |
  +----------+       +--------+                +-------+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Emergency Text Flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>Emergency text communication may utilize SIP MESSAGE end-to-end from
      the caller's end device or application to the call taker, or may start
      as another form of text messaging scheme such as SMS but ultimately be
      converted to a SIP MESSAGE. Text handling after the conversion is the
      same. In any case, the MESSAGE request is constructed as described in
      <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., Ed., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant           Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a>. The body of the request contains the
      message to be delivered. Then the values for various emergency header
      fields are filled as stated in <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a>. If the location information
      is appended to the body of the request, the caller's message and the
      location information must be inserted into the body of the request as
      multiple MIME attachments. These are explained in more detail in <a class='info' href='#CallerUAC'>Section&nbsp;4<span> (</span><span class='info'>Caller UAC Processing</span><span>)</span></a>.
</p>
<p>The main difference of this approach from both the traditional SIP
      MESSAGE routing and the emergency framework is in the way the MESSAGE is
      handled along the path. In emergency handling, the path that the first
      MESSAGE request takes is important. Subsequent MESSAGE requests from the
      same person or device must follow the same path as the first one so that
      they are delivered correctly to the same call taker. Otherwise, if
      subsequent MESSAGE requests are delievered to another call taker or
      another PSAP, there will be considerable confusion for both the sender
      and the receiver. Therefore, the path of the first MESSAGE request is
      determined by location and/or local policy, but all subsequent MESSAGE
      requests must follow the path of the first request regardless of
      location or local policy.
</p>
<p>This means that entities within the path that determine the next hop
      based on location or local policy need to keep track of MESSAGE requests
      that it forwards. Emergency Service Routing Proxy <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a> is an example of such entity.
      How such proxy behaves is described in <a class='info' href='#ProxyProcessing'>Section&nbsp;5<span> (</span><span class='info'>Proxy Processing</span><span>)</span></a>. However, this behavior is not confined
      to proxies. SIP UAs and call distributing entities within the PSAPs are
      also affected. If the SIP UA does not keep track of MESSAGE requests,
      then it would query LoST <a class='info' href='#RFC5222'>[RFC5222]<span> (</span><span class='info'>Hardie, T., Newton , A., Schulzrinne , H., and H. Tschofenig , &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; August&nbsp;2008.</span><span>)</span></a> everytime a
      MESSAGE is sent. This is a big problem if the caller is moving while
      sending messages. The SIP UA may send the MESSAGE requests to different
      PSAPs. Call distributing entities need to keep track of MESSAGE requests
      so that requests from one caller is forwarded consistently to one call
      taker. For these entities, the same state-keeping mechanisms described
      in <a class='info' href='#ProxyProcessing'>Section&nbsp;5<span> (</span><span class='info'>Proxy Processing</span><span>)</span></a> can be used.
</p>
<p>When the call taker sends a reply to the caller, the application
      constructs a SIP MESSAGE request without location or other special
      header fields used in emergency and sends it towards the caller. The
      reply follows the normal SIP routing path. If the caller's original
      message was not SIP, then the replies from call taker must also be
      converted from SIP MESSAGE request to the original message format and
      tranport protocol. As an example, if the caller's original message was
      an SMS message, then the call taker's reply may have to be converted to
      an SMS message so that the caller can receive it on his/her cell phone.
      There may be other protocols, such as proprietary IM protocols, that may
      need conversion. Gateways, such as the SMS gateway shown in <a class='info' href='#figure_textflow'>Figure&nbsp;1<span> (</span><span class='info'>Emergency Text Flow</span><span>)</span></a>, handles these conversions. Conversion
      is described in <a class='info' href='#conversion'>Section&nbsp;6<span> (</span><span class='info'>Conversion to SIP MESSAGE</span><span>)</span></a>.
</p>
<a name="CallerUAC"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Caller UAC Processing</h3>

<p>Caller UAC follows the rules of SIP MESSAGE <a class='info' href='#RFC3428'>[RFC3428]<span> (</span><span class='info'>Campbell, B., Ed., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant           Messaging,&rdquo; December&nbsp;2002.</span><span>)</span></a> and those of <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a>. The following description of
      caller UAC processing is derived from the union of the two documents
      mentioned earlier.
</p>
<p>The UAC may include location information in the body as type
      "xml/pidf-lo" with a corresponding Geolocation header field, or include
      a reference to the location information in the Geolocation header field
      as specified in <a class='info' href='#I-D.ietf-sip-location-conveyance'>[I&#8209;D.ietf&#8209;sip&#8209;location&#8209;conveyance]<span> (</span><span class='info'>Polk, J. and B. Rosen, &ldquo;Location Conveyance for the Session Initiation           Protocol,&rdquo; July&nbsp;2009.</span><span>)</span></a>.
      In the former case, the UAC needs to include both the sender's message
      and the location information in one body. To do so, the UAC must use
      multipart MIME. Here is an example:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC
MIME-Version: 1.0
Content-ID: &lt;3252.1224700600.5@NG911_Desktop1&gt;
Content-Type: text/plain
Content-Transfer-Encoding: 8bit

Hello, I need help.

----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC
MIME-Version: 1.0
Content-ID: caller@x.y
Content-Type: application/pidf+xml
Content-Transfer-Encoding: UTF-8

&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;presence xmlns="urn:ietf:params:xml:ns:pidf"
  xmlns:gp="urn:ietf:params:xml:ns:pidf:geopriv10"
  xmlns:cl="urn:ietf:params:xml:ns:pidf:geopriv10:civicLoc"
  entity="sip:caller@x.y"&gt;
  &lt;tuple id="id94954"&gt;
    &lt;status&gt;
      &lt;gp:geopriv&gt;
        &lt;gp:location-info&gt;
          &lt;cl:civicAddress&gt;
            &lt;cl:country&gt;us&lt;/cl:country&gt;
            &lt;cl:A1&gt;ny&lt;/cl:A1&gt;
            &lt;cl:A3&gt;new york&lt;/cl:A3&gt;
            &lt;cl:A6&gt;amsterdam&lt;/cl:A6&gt;
            &lt;cl:HNO&gt;1214&lt;/cl:HNO&gt;
            &lt;cl:PC&gt;10027&lt;/cl:PC&gt;
          &lt;/cl:civicAddress&gt;
        &lt;/gp:location-info&gt;
        &lt;gp:method&gt;Manual&lt;/gp:method&gt;
      &lt;/gp:geopriv&gt;
    &lt;/status&gt;
    &lt;contact priority="1.0"&gt;sip:caller@x.y&lt;/contact&gt;
    &lt;timestamp&gt;2008-11-14T19:43:43Z&lt;/timestamp&gt;
  &lt;/tuple&gt;
&lt;/presence&gt;
----- =_RjhENkI3RjQ4NUE0QjI2Q0VEODdGNjIwMkMwNjZC</pre></div><p>

</p>
<p>The UAC should resolve the location to a URI by querying LoST <a class='info' href='#RFC5222'>[RFC5222]<span> (</span><span class='info'>Hardie, T., Newton , A., Schulzrinne , H., and H. Tschofenig , &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; August&nbsp;2008.</span><span>)</span></a> and should include the URI in the Route header
      field. This should be done only once in the beginning of conversation to
      make sure all subsequent MESSAGE requests follow the same next-hop as
      the first request. If the UAC is not able to resolve the location, then
      it should not include a Route header field.
</p>
<p>It is out of the scope of this document to decide when the
      conversation begins or ends. The UAC may use a user-interface-based
      approach for this, i.e., start a new conversation when the user opens a
      new chat window, and then terminate the conversation when the user
      closes that window. However, this is only an example.
</p>
<p>If the UAC receives a non-200 response, it should notify the sender
      of the response and give the sender the option of dialing the emergency
      number instead of sending another MESSAGE request.
</p>
<a name="ProxyProcessing"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Proxy Processing</h3>

<p>As described in <a class='info' href='#overview'>Section&nbsp;3<span> (</span><span class='info'>Overview of operation</span><span>)</span></a>, proxies that
      determine the next hop of an emergency request based on location or
      local policy need to keep track of MESSAGE requests it handles. On the
      other hand, proxies that foward MESSAGE requests based on the To header
      field or the Route header field do not need to keep track since the
      MESSAGE requests will be delivered consistently.
</p>
<p>The proxies that need to track MESSAGE requests, e.g., the Emergency
      Services Routing Proxy <a class='info' href='#I-D.ietf-ecrit-framework'>[I&#8209;D.ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; July&nbsp;2009.</span><span>)</span></a>,
      MUST perform additional record keeping for MESSAGE requests if all of
      the following conditions are met.
</p>
<p></p>
<ol class="text">
<li>The destination (obtained from the To header field) is
          urn:service:sos.
</li>
<li>This is the first MESSAGE from a particular source (obtained from
          the From header field). In other words, the proxy has no record of
          the source sending a MESSAGE to urn:service:sos.
</li>
</ol>

<p>The record is a (source, next-hop, expiration timer) triplet. The
      source is obtained from the From header field of the request. The
      next-hop is determined by a LoST query <a class='info' href='#RFC5222'>[RFC5222]<span> (</span><span class='info'>Hardie, T., Newton , A., Schulzrinne , H., and H. Tschofenig , &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; August&nbsp;2008.</span><span>)</span></a>
      based on the location information or a reference to the location
      information within the first request. Location information in subsequent
      requests do not affect the next-hop value. The expiration timer is a
      value in seconds that will keep the record from expiring. Each
      subsequent request resets the expiration timer. For example, if the
      configured value of the expiration timer is 30 seconds, then the
      countdown begins after the first request is processed. When the second
      request comes in, the expiration timer is reset to 30 seconds and the
      countdown starts again. If the timer falls to zero, the record is no
      longer valid.
</p>
<p>Proxies route all subsequent MESSAGE request from the same source to
      the same next-hop while the expiration timer is greater than zero. Each
      subsequent MESSAGE request resets the expiration timer to its maximum
      value. This is to ensure that a 'conversation' between the caller and
      the call taker is consistent.
</p>
<a name="conversion"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Conversion to SIP MESSAGE</h3>

<p>The original message may not be SIP. It may be an SMS message or an
      IM message in a proprietary format and protocol. In these cases, the
      original format and protocol must be converted to a SIP MESSAGE.
</p>
<p>The following is the minimum information needed to convert a non-SIP
      message to a valid SIP MESSAGE.
</p><table class="all" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Type of Information</th><th align="left">Correspoding SIP MESSAGE element</th></tr>
<tr>
<td align="left">Origination address or number</td>
<td align="left">From header field</td>
</tr>
<tr>
<td align="left">User message</td>
<td align="left">In the body as type "text/plain"</td>
</tr>
<tr>
<td align="left">Location information</td>
<td align="left">Geolocation header field and in the body as type "xml/pidf-lo"
        (Geolocation header field only if conveying location by reference)</td>
</tr>
</table>
<br clear="all" />

<p>The SIP URI for the From header field must be created by merging the
      origination address or number and the IP address and port of the
      converting entity. For example, let's say the origination address or
      number is 123-456-7890 and the IP address and port number of the
      converting entity is 128.59.19.184:5060. Then the SIP URI should be
      sip:1234567890@128.59.19.184:5060.
</p>
<p>The To header field must contain an emergency string such as
      "urn:service:sos". The destination address or number, e.g., 9-1-1, in
      the original non-SIP message is retained and carried along with the SIP
      message in the History-Info header <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., Ed., &ldquo;An Extension to the Session Initiation Protocol (SIP) for           Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a>. The
      destination address could be useful in post incident call analysis for
      PSAP personnel to identify network issues such as mis-routed text
      messages allowing more efficient trouble clearing with the appropriate
      network provider.
</p>
<p>The next hop entity should be determined by quering LoST with the
      provided location information and it should be included in the Route
      header field.
</p>
<p>If the converter receives a 200 OK response, it should send a success
      indicator to the original sender. There may not be a one-to-one match
      between SIP responses and the original protocol, especially when non-200
      responses are received. In this case, the converter must indicate
      failure and may send the reason text as a message to the sender.
</p>
<p>The call taker's reply, which is another SIP MESSAGE request in the
      reverse direction, should be sent to the origination address or number
      in its original format. The origination address or number can be
      extracted from the To header field. The From header field may contain
      "urn:service:sos", in which case it must be replaced with the original
      emergency number or string.
</p>
<p>If the sender protocol allows provisional and final responses, the
      converter should make use of them to indicate the status of the call
      taker. For example, the converter should send a 202 Accepted response
      upon receiving the call taker's MESSAGE, and then a 200 OK upon
      receiving the final success indication from the sender. If the sender
      protocol does not allow such elaborate responses, the converter must
      send a 200 OK upon receiving the call taker's MESSAGE.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>TBD
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ecrit-framework">[I-D.ietf-ecrit-framework]</a></td>
<td class="author-text">Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet
          Multimedia,&rdquo; July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-location-conveyance">[I-D.ietf-sip-location-conveyance]</a></td>
<td class="author-text">Polk, J. and B. Rosen, &ldquo;Location Conveyance for the Session Initiation
          Protocol,&rdquo; July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3428">[RFC3428]</a></td>
<td class="author-text">Campbell, B., Ed., Rosenberg, J., Schulzrinne, H., Huitema, C., and D. Gurle, &ldquo;Session Initiation Protocol (SIP) Extension for Instant
          Messaging,&rdquo; December&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4244">[RFC4244]</a></td>
<td class="author-text">Barnes, M., Ed., &ldquo;An Extension to the Session Initiation Protocol (SIP) for
          Request History Information,&rdquo; November&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4975">[RFC4975]</a></td>
<td class="author-text">Campbell, B., Ed., <a href="mailto:">Mahy, R., Ed.</a>, and <a href="mailto:">C. Jennings, Ed.</a>, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5194">[RFC5194]</a></td>
<td class="author-text">van Wijk, A., Ed. and <a href="mailto:">G. Gybels, Ed.</a>, &ldquo;Framework for Real-Time Text over IP Using the Session
          Initiation Protocol (SIP),&rdquo; June&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5222">[RFC5222]</a></td>
<td class="author-text">Hardie, T., Newton , A., Schulzrinne , H., and H. Tschofenig , &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; August&nbsp;2008.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jong Yul Kim</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jyk@cs.columbia.edu">jyk@cs.columbia.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wonsang Song</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:wonsang@cs.columbia.edu">wonsang@cs.columbia.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Henning Schulzrinne</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New York, NY  </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hgs@cs.columbia.edu">hgs@cs.columbia.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Piotr Boni</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Verizon</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:p.boni@verizon.com">p.boni@verizon.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Armstrong</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Verizon</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:michael.g.armstrong@verizon.com">michael.g.armstrong@verizon.com</a></td></tr>
</table>
</body></html>
