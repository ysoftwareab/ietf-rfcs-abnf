<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>AFSVol Tag-Length-Value Remote Procedure Call Extensions</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="AFSVol Tag-Length-Value Remote Procedure Call Extensions">
<meta name="keywords" content="afsvol">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">N/A</td><td class="header">T. Keiser</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Jenkins</td></tr>
<tr><td class="header">Intended status: BCP</td><td class="header">Sine Nomine</td></tr>
<tr><td class="header">Expires: May 21, 2010</td><td class="header">November 17, 2009</td></tr>
</table></td></tr></table>
<h1><br />AFSVol Tag-Length-Value Remote Procedure Call Extensions<br />draft-tkeiser-afs3-volser-tlv-00</h1>

<h3>Abstract</h3>

<p>
        AFS-3 heavily leverages Remote Procedure Calls (RPCs). 
        This proposal adds a new mechanism to better manage the 
        addition of new, enhancement-specific RPCs through the 
        use of both capability bits via the GetCapabilities RPC, and 
        via standardization of backwards-compatibility behaviors for 
        enhancement-specific RPCs.  These goals are accomplished
        through standardization of Tag-Length-Value (TLV) 
        get/set/enumerate RPCs with  
        value payloads encoded using an XDR discriminated union.
        The XDR union decode problem is circumvented by
        specifying an opaque default leg.  Tags are allocated for 
        existing volume and transaction metadata, and 
        implementation-private tags are allocated for metadata 
        related to the OpenAFS Demand Attach File Server.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 21, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">2.</a>&nbsp;
GetCapabilities RPC<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Description<br />
<a href="#anchor5">3.</a>&nbsp;
Backward Compatibility<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
GetCapabilities<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.1.1.</a>&nbsp;
AFSVol<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.1.2.</a>&nbsp;
Capability Bit Allocations<br />
<a href="#anchor9">4.</a>&nbsp;
TLV Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.1.</a>&nbsp;
Encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.2.</a>&nbsp;
Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.2.1.</a>&nbsp;
Qualifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.2.2.</a>&nbsp;
Tag Introspection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.2.3.</a>&nbsp;
TLV Get<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.2.4.</a>&nbsp;
TLV Streaming Get<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.2.4.1.</a>&nbsp;
Split call stream encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.2.5.</a>&nbsp;
TLV Set<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.2.5.1.</a>&nbsp;
Call preprocessing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">4.2.5.2.</a>&nbsp;
Call processing<br />
<a href="#anchor25">5.</a>&nbsp;
Mapping of existing metadata onto TLV namespace<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">5.1.</a>&nbsp;
volintXInfo<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">5.2.</a>&nbsp;
transDebugInfo<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">5.3.</a>&nbsp;
Additional de facto-standardized fields<br />
<a href="#anchor29">6.</a>&nbsp;
Extended volume state exportation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">6.1.</a>&nbsp;
Mapped volume states<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">6.2.</a>&nbsp;
Mapped process types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">6.3.</a>&nbsp;
TLV tuples<br />
<a href="#Acknowledgements">7.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor33">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor34">9.</a>&nbsp;
GCO Registrar Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">9.1.</a>&nbsp;
Namespace allocations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">9.2.</a>&nbsp;
Assigned numbers allocations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">9.2.1.</a>&nbsp;
VICED capability bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">9.2.2.</a>&nbsp;
AFSVol capability bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">9.2.3.</a>&nbsp;
AFS-3 TLV payload types<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">9.2.4.</a>&nbsp;
AFSVol TLV tags<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">9.2.5.</a>&nbsp;
VOLS error table<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor42">9.2.6.</a>&nbsp;
AFSVol mapped volume names<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">9.2.7.</a>&nbsp;
AFS-3 program types<br />
<a href="#Security">10.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#app-cap-xdr">Appendix&nbsp;A.</a>&nbsp;
XDR Grammar for FS-CM Capabilities Mechanism<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        The AFS protocol stores data in volumes on fileservers. 
        Status information for volumes is accessible via various 
        AFSVol RPCs. Adding or modifying fields currently 
        requires creation of new RPCs. As these new RPCs differ 
        only slightly from existing ones, a scalable approach 
        to RPC modification is needed. This is accomplished 
        through the creation of Tag-Length-Value (TLV) RPCs for 
        the existing RPCs; for example, AFSVolGetOneVolumeTLV 
        is the Tag-Length-Value equivalent to the AFS-3 
        AFSVolListOneVolume RPC.
      
</p>
<p>
        As a concrete example of Tag-Length-Value RPCs for 
        volume status information, the Demand Attach File Server 
        creates new states for volumes.  Several new tags are
        allocated by this memo to export raw and canonical
        state information which DAFS can provide, but which
        legacy AFS-3 is incapable of communicating.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
GetCapabilities RPC</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Description</h3>

<p>
          The AFS-3 specifications (<a class='info' href='#AFS3-FSCM'>[AFS3&#8209;FSCM]<span> (</span><span class='info'>Zayas, E., &ldquo;AFS-3 Programmer's Reference: File Server/Cache Manager Interface,&rdquo; August&nbsp;1991.</span><span>)</span></a>, <a class='info' href='#AFS3-VVL'>[AFS3&#8209;VVL]<span> (</span><span class='info'>Zayas, E., &ldquo;AFS-3 Programmer's Reference: Volume Server/Volume Location Server Interface,&rdquo; August&nbsp;1991.</span><span>)</span></a>) describe various 
          AFS RPCs. As new extensions and modifications to AFS 
          occur, a mechanism needs to be in place so that growth 
          of RPCs is done in a manageable fashion. Of particular 
          concern is a proliferation of modified versions of RPCs 
          that differ from each other in minor ways; examples are:
        
</p>
<p>
          </p>
<ul class="text">
<li>RXAFSCB_InitCallBackState, RXAFSCB_InitCallBackState2, and RXAFSCB_InitCallBackState3
</li>
<li>RXAFS_FetchData versus RXAFS_FetchData64
</li>
</ul><p>
        
</p>
<p>
          Instead of continuing the practice of adding a version 
          number, width of value, or other identifier to the end 
          of the RPC name, this document specifies that RPC 
          extensions, where necessary, be created with a "TLV" 
          suffix denoting "Tag-Length-Value", a tag-value 
          identifier be obtained from the Registrar, and that 
          interoperability done according to the following section.
        
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Backward Compatibility</h3>

<p>
        Services providing extended Tag-Length-Value RPCs MUST 
        provide backwards compatible interfaces to both legacy 
        clients and servers. Additionally, interoperability 
        between TLV versions must also be specified if they do 
        not comply with the following requirements:
      
</p>
<p>
        </p>
<ol class="text">
<li>
            AFS-3 TLV servers replying to AFS-3 clients MUST 
            provide the identical response to an AFS-3 server.
          
</li>
<li>
            AFS-3 TLV clients communicating with AFS-3 servers 
            MUST fall back to using non-TLV RPCs. 
          
</li>
<li>
            AFS-3 TLV clients to AFS-3 TLV servers:

            
<blockquote class="text"><dl>
<dt>A.</dt>
<dd>
                Where capabilities match or the server can 
                provide capabilities including those which the 
                client requests, the server MUST reply with exactly 
                the capabilities requested.
              
</dd>
<dt>B.</dt>
<dd>
                Where the client requests capabilities that the 
                server does not provide it MUST either return an
                'unknown tag' error code, or (OPTIONAL) fall back 
                to an AFS-3 response.
              
</dd>
</dl></blockquote>
          
</li>
</ol><p>
      
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
GetCapabilities</h3>

<p>
          All AFS-3 Rx services with Tag-Length-Value RPCs MUST 
          implement a GetCapabilities RPC analogous to that done 
          for the FS-CM interface.
        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
AFSVol</h3>

<p>
            This memo introduces a capabilities namespace, and 
            GetCapabilities interface to the AFSVol service. For 
            AFSVol the GetCapabilities interface will be be 
            identical to the afsint interface, and will be defined 
            as follows:
          
</p><br /><hr class="insert" />
<a name="getcaps"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
proc GetCapabilities(
    OUT Capabilities * capabilities
) = XXX;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
            The "Capabilities" type is defined by the existing afsint 
            interface, which is included here for reference:
          
</p><br /><hr class="insert" />
<a name="getcaps_consts"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
const AFSCAPABILITIESMAX = 192;

typedef afs_int32 Capabilities&lt;AFSCAPABILITIESMAX&gt;;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Capability Bit Allocations</h3>

<p>
            Three new capability bit allocations will need to be 
            processed by the Grand Central Registrar:
          
</p>
<p>
            </p>
<blockquote class="text"><dl>
<dt>VICED_CAPABILITY_DAFS</dt>
<dd>
                Announce that this file server supports the OpenAFS 
                Demand Attach File Server version 1 semantics
              
</dd>
<dt>AFSVOL_CAPABILITY_DAFS</dt>
<dd>
                Announce that this volume server supports the OpenAFS 
                Demand Attach File Server version 1 semantics
              
</dd>
<dt>AFSVOL_CAPABILITY_TLV</dt>
<dd>
                Announce that this volume server supports the 
                Tag-Length-Value RPC
              
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
TLV Interface</h3>

<p>
        A new suite of RPCs will be standardized to get/set 
        tag-length-value tuples, and to enumerate supported tags. The 
        tag namespace will be controlled by the Grand Central 
        Registrar as an assigned numbers namespace.
      
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Encoding</h3>

<p>
          The TLV data will be encoded using the following XDR 
          specification:
        
</p><br /><hr class="insert" />
<a name="tag_enum"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
/* registrar-controlled tag namespace */

enum AFSVol_TLV_tag {
    ...
};

const AFSINT_TLV_TAG_MAX = 1024;         /* upper-bound on number of
                                          * TLV tuples per RPC */
const AFSINT_TLV_OPAQUE_MAX = 262144;    /* upper-bound on size of
                                          * value payload */

enum afsint_TLV_type {
    AFSINT_TLV_TYPE_NULL     = 0,
    AFSINT_TLV_TYPE_TRUE     = 1,
    AFSINT_TLV_TYPE_FALSE    = 2,
    AFSINT_TLV_TYPE_UINT64   = 3,
    AFSINT_TLV_TYPE_UUID     = 4,
    AFSINT_TLV_TYPE_STRING   = 5,
    AFSINT_TLV_TYPE_OPAQUE   = 6
};

union afsint_TLV_value switch(afsint_TLV_type type) {
 case AFSINT_TLV_TYPE_NULL:
 case AFSINT_TLV_TYPE_TRUE:
 case AFSINT_TLV_TYPE_FALSE:
  void;

 case AFSINT_TLV_TYPE_UINT64:
    afs_uint64 u_64;

 case AFSINT_TLV_TYPE_UUID:
    afsUUID u_uuid;

 case AFSINT_TLV_TYPE_STRING:
    string u_string&lt;AFSINT_TLV_OPAQUE_MAX&gt;;

 case AFSINT_TLV_TYPE_OPAQUE:
 default:
    opaque u_opaque&lt;AFSINT_TLV_OPAQUE_MAX&gt;;
};

const AFSINT_TLV_FLAG_UNSUPPORTED = 0x1;
const AFSINT_TLV_FLAG_READ_ERROR = 0x2;
const AFSINT_TLV_FLAG_CRITICAL = 0x4;

struct afsint_TLV {
    afs_uint32 tlv_tag;
    afs_uint32 tlv_flags;
    afsint_TLV_value tlv_value;
};
</pre></div>
<p style='text-align: center'>TLV XDR specification
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
          In order to solve the XDR discriminated union decoding 
          problem, all future afsint_TLV_type allocations will 
          map to opaque. All implementations MUST support all 
          arms in the afsint_TLV_value XDR union, as defined above.
        
</p>
<p>
          It is RECOMMENDED that future protocol augmentations 
          requiring the transmission of new data types request 
          allocation of a new standards-track payload type code. 
          Allocation of a type code should coincide with 
          standardization of the payload encoding associated with 
          the type code allocation. However, in limited 
          circumstances where:
        
</p>
<p>
          </p>
<ol class="text">
<li>
              it is known a priori that there will never be any 
              encoding ambiguity, and 
            
</li>
<li>
              the cost of type code allocation and encoding 
              standardization are deemed too high
            
</li>
</ol><p>
        
</p>
<p>
          use of the type code AFSINT_TLV_TYPE_OPAQUE may be permissible.
        
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Interface</h3>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Qualifiers</h3>

<p>
            In some cases the value associated with a tag will be 
            large, structured data. A qualifier is a tag-specific 
            parameter which allows a caller to address a subset of 
            the value stored in a tag. For TLV get interfaces, 
            specifying a qualifer can reduce the amount of data 
            sent over the wire. For TLV set interfaces, specifying 
            a qualifier permits a client to modify a subset of a 
            structured value without endangering cache coherence. 
            Qualifiers are marshalled over the wire as type 
            afsint_TLV_value. Unless otherwise noted, it should be 
            assumed that a tag only supports the null qualifier 
            (XDR union discriminator set to AFSINT_TLV_TYPE_NULL). 
            The null qualifier always references the entire value 
            for a given tag.
          
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Tag Introspection</h3>

<p>
            The Rx procedure specification for the tag support RPC 
            will be as follows:
          
</p><br /><hr class="insert" />
<a name="tlv_get_tags"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
proc GetVolumeTLVTags(
    IN AFSVol_TLV_tag offset,
    OUT AFSVol_TLV_tag * tags&lt;AFSINT_TLV_TAG_MAX&gt;
) = XXX;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
            The call parameters are defined as follows:

            </p>
<blockquote class="text"><dl>
<dt>offset</dt>
<dd>
                The offset IN parameter specifies the numeric offset of 
                the first tag to return. A value of zero indicates that 
                the client wants to start the enumeration at the 
                beginning of the tag list.
              
</dd>
<dt>tags</dt>
<dd>
                The tags OUT parameter contains a sorted list of 
                supported tags, beginning with the first supported tag 
                greater than or equal to the offset IN parameter.
              
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
TLV Get</h3>

<p>
            The Rx procedure specification for the TLV get 
            interface will be as follows:
          
</p><br /><hr class="insert" />
<a name="tlv_get_single"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
struct AFSVol_TLV_query {
    AFSVol_TLV_tag tq_tag;
    afsint_TLV_value tq_qualifier;
};

proc GetOneVolumeTLV(
    IN afs_uint32 partId,
    IN afs_uint64 volId,
    IN AFSVol_TLV_query queries&lt;AFSINT_TLV_TAG_MAX&gt;,
    OUT afsint_TLV * tuples&lt;AFSINT_TLV_TAG_MAX&gt;
) = XXX;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
            The call parameters are defined as follows:

            </p>
<blockquote class="text"><dl>
<dt>partId</dt>
<dd>
                The partId IN parameter specifies the disk partition on 
                which the volume is located.
              
</dd>
<dt>volId</dt>
<dd>
                The volId IN parameter specifies the volume for which 
                TLV tuples are being requested.
              
</dd>
<dt>queries</dt>
<dd>
                The queries IN parameter specifies an optional list of 
                tags for which TLV tuples are desired. If this 
                parameter is zero-length, then the server will return 
                up to AFSINT_TLV_TAG_MAX TLV tuples. If an unknown tag 
                identifier is passed in the tags parameter, then the 
                server will return a tuple with the 
                AFSINT_TLV_FLAG_UNSUPPORTED bit asserted in 
                afsint_TLV.tlv_flags, and the tlv type set to 
                AFSINT_TLV_TYPE_NULL. Similarly, if the server is 
                unable to retrieve the value for a supported tag, then 
                a tuple will be returned with 
                AFSINT_TLV_FLAG_READ_ERROR set in the 
                afsint_TLV.tlv_flags field, and the tlv type set to 
                AFSINT_TLV_TYPE_NULL. The AFSVol_TLV_query.tq_qualifier 
                field contains optional tag-specific qualifiers which 
                would allow the implementation to return a subset of 
                the data for a specific tag.
              
</dd>
<dt>tuples</dt>
<dd>
                The tuples OUT parameter contains up to 
                AFSINT_TLV_TAG_MAX TLV tuples for this volume.
              
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.4"></a><h3>4.2.4.&nbsp;
TLV Streaming Get</h3>

<p>
            This call is similar to the call described in the 
            previous section, with the exception that TLV tuples 
            will be returned for multiple volumes at once using an 
            Rx split call interface. The Rx procedure specification 
            is as follows:
          
</p><br /><hr class="insert" />
<a name="tlv_get_multi"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
const AFSVOL_BULK_GETVOLUME_MAX = 1024;

proc GetVolumesTLV(
    IN afs_uint32 partIds&lt;AFSVOL_BULK_GETVOLUME_MAX&gt;,
    IN afs_uint64 volIds&lt;AFSVOL_BULK_GETVOLUME_MAX&gt;,
    IN AFSVol_TLV_query queries&lt;AFSINT_TLV_TAG_MAX&gt;
) split = XXX;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
            The call parameters are defined as follows:

            </p>
<blockquote class="text"><dl>
<dt>partIds</dt>
<dd>
                The partIds IN parameter specifies as list of vice 
                partitions. If this list is zero-length, then TLV 
                information is requested for all volumes on all vice 
                partitions. If this list is non-zero length, then TLV 
                information is requested only for volumes on specific 
                vice partitions.
              
</dd>
<dt>volIds</dt>
<dd>
                The volIds IN parameter specifies a list of volume IDs. 
                If this list is zero-length, then TLV information is 
                requested for all volumes on the vice partitions 
                specified in partIds. 

                <br />

                If the volIds array is non-zero length, then its length 
                MUST match the length of the partIds array. In this 
                case, each matching index in the partIds and volIds 
                arrays together form a tuple which uniquely addresses a 
                volume on a given vice partition.
              
</dd>
<dt>queries</dt>
<dd>
                The queries IN parameter specifies an optional list of 
                tags for which TLV tuples are desired. If this 
                parameter is zero-length, then the server will return 
                up to AFSINT_TLV_TAG_MAX TLV tuples. If an unknown tag 
                identifier is passed in the tags parameter, then the 
                server will return a tuple with the 
                AFSINT_TLV_FLAG_UNSUPPORTED bit asserted in 
                afsint_TLV.tlv_flags, and the tlv type set to 
                AFSINT_TLV_TYPE_NULL. Similarly, if the server is 
                unable to retrieve the value for a supported tag, then 
                a tuple will be returned with 
                AFSINT_TLV_FLAG_READ_ERROR set in the 
                afsint_TLV.tlv_flags field, and the tlv type set to 
                AFSINT_TLV_TYPE_NULL. The AFSVol_TLV_query.tq_qualifier 
                field contains optional tag-specific qualifiers which 
                would allow the implementation to return a subset of 
                the data for a specific tag.
              
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.4.1"></a><h3>4.2.4.1.&nbsp;
Split call stream encoding</h3>

<p>
              The contents of the split call stream shall be an 
              xdrrec stream containing a finite sequence of 
              XDR-encoded afsint_TLV structures, each of which shall 
              be marked as a separate record (typically by calling 
              xdrrec_endofrecord). End of sequence will be annotated 
              by a dummy tuple containing the special tag type 
              AFSVOL_TLV_TAG_EOS.
            
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5"></a><h3>4.2.5.&nbsp;
TLV Set</h3>

<p>
            The Rx procedure specification for the TLV set 
            interface will be as follows:
          
</p><br /><hr class="insert" />
<a name="tlv_set"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
struct AFSVol_TLV_store {
    afsint_TLV ts_tuple;
    afsint_TLV_value ts_qualifier;
};

proc SetVolumeTLV(
    IN afs_int32 trans,
    IN AFSVol_TLV_store tuples&lt;AFSINT_TLV_TAG_MAX&gt;,
    OUT afs_int32 * results&lt;AFSINT_TLV_TAG_MAX&gt;
) = XXX;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
            The call parameters are defined as follows:

            </p>
<blockquote class="text"><dl>
<dt>trans</dt>
<dd>
                The trans IN parameter specifies the transaction ID 
                returned by a previous invocation of AFSVolTransCreate.
              
</dd>
<dt>tuples</dt>
<dd>
                The tuples IN parameter contains the list of TLV tuples 
                to be set by the server. 
              
</dd>
<dt>results</dt>
<dd>
                The results OUT parameter contains a list of error 
                codes, one per tuple. These error codes provide 
                specific information regarding the success/failure of 
                each TLV set operation. Valid error codes include: 
                VOLSERTAGUNSUPPORTED, VOLSERTAGREADONLY, 
                VOLSERTAGWRITEFAILED, VOLSERTAGDECODEFAILED, 
                VOLSERTAGUNSUPPORTEDENCODING, 
                VOLSERTAGINVALIDQUALIFIER, and VOLSERFAILEDOP.
              
</dd>
</dl></blockquote><p>
          
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1"></a><h3>4.2.5.1.&nbsp;
Call preprocessing</h3>

<p>
              The SetVolumeTLV begins by scanning all elements within 
              the tuples array. If any elements have the 
              AFSINT_TLV_FLAG_CRITICAL bit asserted in 
              tuples[i].ts_tuple.ts_flags, then preprocessing of the 
              tuple must occur. For each tuple with the critical bit 
              set, several preprocessing validation steps will be taken.
            
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1.1"></a><h3>4.2.5.1.1.&nbsp;
Verify tag is supported</h3>

<p>
                The tag stored in tuples[i].ts_tuple.tlv_tag is checked 
                to ensure that the server supports it. In the event 
                that the tag is not supported, then the corresponding 
                array index in the results array will be set to 
                VOLSERTAGUNSUPPORTED, and the RPC call abort at the 
                conclusion of critical tuple preprocessing with error 
                code VOLSERFAILEDOP.
              
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1.2"></a><h3>4.2.5.1.2.&nbsp;
Verify tag is writeable</h3>

<p>
                The tag stored in tuples[i].ts_tuple.tlv_flag is 
                checked to ensure that it is a writeable property. In 
                the event that the tag is read-only, then the 
                corresponding array index in the results array will be 
                set to VOLSERTAGREADONLY, and the RPC call will abort 
                at the conclusion of critical tuple preprocessing with 
                error code VOLSERFAILEDOP.
              
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1.3"></a><h3>4.2.5.1.3.&nbsp;
Verify value encoding is supported</h3>

<p>
                The XDR union discriminator in 
                tuples[i].ts_tuple.tlv_value is checked to make sure 
                that it is a supported type. If the discriminator is 
                not a supported type, then the corresponding array 
                index in the results array will be set to 
                VOLSERTAGUNSUPPORTEDENCODING, and the RPC call will 
                abort at the conclusion of critical tuple preprocessing 
                with error code VOLSERFAILEDOP.
              
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1.4"></a><h3>4.2.5.1.4.&nbsp;
Verify value can be decoded</h3>

<p>
                The value stored in tuples[i].ts_tuple.tlv_value is 
                checked to make sure that it can be decoded. If the 
                wire-encoded data cannot be decoded, then the 
                corresponding array index in the results array will be 
                set to VOLSERTAGDECODEFAILED, and the RPC call will 
                abort at the conclusion of critical tuple preprocessing 
                with error code VOLSERFAILEDOP.
              
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.1.5"></a><h3>4.2.5.1.5.&nbsp;
Verify qualifier is supported</h3>

<p>
                Qualifiers are specific to a given tag. If for any 
                reason the tag-specific validation logic determines 
                that the qualifier is invalid, it may set the 
                corresponding array index in the results array to one 
                of VOLSERTLVQUALIFIERUNSUPPORTEDENCODING, 
                VOLSERTLVQUALIFIERDECODEFAILED, or 
                VOLSERTLVQUALIFIERINVALID. As with the other validation 
                steps, if a critical tuple fails qualifier validation, 
                then the RPC call will abort at the conclusion of 
                critical tuple preprocessing with error code VOLSERFAILEDOP.
              
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5.2"></a><h3>4.2.5.2.&nbsp;
Call processing</h3>

<p>
              Once the necessary validation steps have been 
              performed, the call will perform the set operations for 
              each tuple. Errors encountered during the processing of 
              each tuple will be recorded in the appropriate array 
              index of the results array. At the conclusion the RPC 
              will either return 0 if all set operations succeeded, 
              or VOLSERFAILEDOP if any failed.
            
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Mapping of existing metadata onto TLV namespace</h3>

<p>
        Existing metadata available from several interfaces 
        will also be exported as TLV tuples. This is being done 
        not only for completeness, but also to prevent data 
        races between AFSVolGetOneVolumeTLV, and the various 
        legacy introspection interfaces. 
      
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
volintXInfo</h3>

<p>
          All metadata exported via the volintXInfo XDR structure 
          will now be exported as TLV tuples. Unless otherwise 
          specified, the values associated with each tag shall be 
          identical to that returned for the associated field in 
          volintXInfo by the AFSVolXListOneVolume interface. The 
          following tuples will be allocated to export existing 
          members of volintXInfo:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSVOL_TLV_TAG_VOL_NAME</dt>
<dd>
              This is the TLV analogue of volintXInfo.name. This 
              tuple MUST have a payload of type 
              AFSINT_TLV_TYPE_STRING. The u_string payload field MUST 
              contain a null-terminated string.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STATUS</dt>
<dd>
              This is the TLV analogue of volintXInfo.status. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_IN_USE</dt>
<dd>
              This is the TLV analogue of volintXInfo.inUse. This 
              tuple will contain a boolean value, and therefore MUST 
              have a payload type of either: AFSINT_TLV_TYPE_TRUE, or 
              AFSINT_TLV_TYPE_FALSE.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_ID</dt>
<dd>
              This is the TLV analogue of volintXInfo.volid. This 
              tuple MUST have a payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TYPE</dt>
<dd>
              This is the TLV analogue of volintXInfo.type. This 
              tuple MUST have a payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_CLONE_ID</dt>
<dd>
              This is the TLV analogue of volintXInfo.cloneID. This 
              tuple MUST have a payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_BACKUP_ID</dt>
<dd>
              This is the TLV analogue of volintXInfo.backupID. This 
              tuple MUST have a payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_PARENT_ID</dt>
<dd>
              This is the TLV analogue of volintXInfo.parentID. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_COPY_DATE</dt>
<dd>
              This is the TLV analogue of volintXInfo.copyDate. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64. 
              This timestamp shall be encoded using the rules 
              specified in the forthcoming afs3 RPC refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_CREATE_DATE</dt>
<dd>
              This is the TLV analogue of volintXInfo.creationDate. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This timestamp shall be encoded 
              using the rules specified in the forthcoming afs3 RPC 
              refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_ACCESS_DATE</dt>
<dd>
              This is the TLV analogue of volintXInfo.accessDate. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This timestamp shall be encoded 
              using the rules specified in the forthcoming afs3 RPC 
              refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_UPDATE_DATE</dt>
<dd>
              This is the TLV analogue of volintXInfo.updateDate. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This timestamp shall be encoded 
              using the rules specified in the forthcoming afs3 RPC 
              refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_BACKUP_DATE</dt>
<dd>
              This is the TLV analogue of volintXInfo.backupDate. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This timestamp shall be encoded 
              using the rules specified in the forthcoming afs3 RPC 
              refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_SIZE</dt>
<dd>
              This is the TLV analogue of volintXInfo.size. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_tLV_TAG_VOL_FILE_COUNT</dt>
<dd>
              This is the TLV analogue of volintXInfo.filecount. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_MAX_QUOTA</dt>
<dd>
              This is the TLV analogue of volintXInfo.maxquota. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_DAY_USE</dt>
<dd>
              This is the TLV analogue of volintXInfo.dayUse. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_READS</dt>
<dd>
              This is the TLV analogue of volintXInfo.stat_reads. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_OPAQUE. The opaque contents shall be an 
              XDR-encoded structure defined as follows:

              <br /><hr class="insert" />
<a name="tlv_stat_rw"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
const VOLINT_STATS_NUM_RWINFO_FIELDS = 4;

struct AFSVol_stat_rw {
    afs_uint64 stat_rw[VOLINT_STATS_NUM_RWINFO_FIELDS];
};
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_WRITES</dt>
<dd>
              This is the TLV analogue of volintXInfo.stat_reads. 
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_OPAQUE. The opaque contents shall be an 
              XDR-encoded structure as defined for 
              AFSVOL_TLV_TAG_VOL_STAT_READS.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_FILE_SAME_AUTHOR</dt>
<dd>
              This is the TLV analogue of 
              volintXInfo.stat_fileSameAuthor. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_OPAQUE. The opaque 
              contents shall be an XDR-encoded structure defined as follows:

              <br /><hr class="insert" />
<a name="tlv_stat_time"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
const VOLINT_STATS_NUM_TIME_FIELDS = 6;

struct AFSVol_stat_time {
    afs_uint64 stat_rw[VOLINT_STATS_NUM_TIME_FIELDS];
};
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_FILE_DIFFERENT_AUTHOR</dt>
<dd>
              This is the TLV analogue of 
              volintXInfo.stat_fileDiffAuthor. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_OPAQUE. The opaque 
              contents shall be the XDR-encoded structure 
              AFSVol_stat_time, as defined for 
              AFSVOL_TLV_TAG_VOL_STAT_FILE_SAME_AUTHOR.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_DIR_SAME_AUTHOR</dt>
<dd>
              This is the TLV analogue of 
              volintXInfo.stat_dirSameAuthor. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_OPAQUE. The opaque 
              contents shall be the XDR-encoded structure 
              AFSVol_stat_time, as defined for 
              AFSVOL_TLV_TAG_VOL_STAT_FILE_SAME_AUTHOR.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STAT_DIR_DIFFERENT_AUTHOR</dt>
<dd>
              This is the TLV analogue of 
              volintXInfo.stat_dirDiffAuthor. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_OPAQUE. The opaque 
              contents shall be the XDR-encoded structure 
              AFSVol_stat_time, as defined for 
              AFSVOL_TLV_TAG_VOL_STAT_FILE_SAME_AUTHOR.
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
transDebugInfo</h3>

<p>
          All metadata exported via the transDebugInfo XDR 
          structure will now be exported as TLV tuples. Unless 
          otherwise specified, the values associated with each 
          tag shall be identical to that returned for the 
          associated field in transDebugInfo by the 
          AFSVolMonitor interface. The following tuples will be 
          allocated to export existing members of transDebugInfo:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_TID</dt>
<dd>
              This is the TLV analogue of transDebugInfo.tid. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_TIME</dt>
<dd>
              This is the TLV analogue of transDebugInfo.time. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64. 
              This timestamp shall be encoded using the rules 
              specified in the forthcoming afs3 RPC refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_CREATE_TIME</dt>
<dd>
              This is the TLV analogue of 
              transDebugInfo.creationTime. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_UINT64. This timestamp 
              shall be encoded using the rules specified in the 
              forthcoming afs3 RPC refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_RETURN_CODE</dt>
<dd>
              This is the TLV analogue of transDebugInfo.returnCode. 
              This tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_ATTACH_MODE</dt>
<dd>
              This is the TLV analogue of transDebugInfo.iflags. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_STATUS</dt>
<dd>
              This is the TLV analogue of transDebugInfo.vflags This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_FLAGS</dt>
<dd>
              This is the TLV analogue of transDebugInfo.tflags. This 
              tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_LAST_PROC_NAME</dt>
<dd>
              This is the TLV analogue of 
              transDebugInfo.lastProcName. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_STRING. The u_string 
              payload field MUST contain a null-terminated string.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_CALL_VALID</dt>
<dd>
              This is the TLV analogue of transDebugInfo.callValid. 
              This tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_READ_NEXT</dt>
<dd>
              This is the TLV analogue of transDebugInfo.readNext. 
              This tuple MUST have payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_XMIT_NEXT</dt>
<dd>
              This is the TLV analogue of 
              transDebugInfo.transmitNext. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_UINT64.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_LAST_RECV_TIME</dt>
<dd>
              This is the TLV analogue of 
              transDebugInfo.lastReceiveTime. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_UINT64. This timestamp 
              shall be encoded using the rules specified in the 
              forthcoming afs3 RPC refresh document.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_TRANS_LAST_SEND_TIME</dt>
<dd>
              This is the TLV analogue of 
              transDebugInfo.lastSendTime. This tuple MUST have 
              payload of type AFSINT_TLV_TYPE_UINT64. This timestamp 
              shall be encoded using the rules specified in the 
              forthcoming afs3 RPC refresh document.
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Additional de facto-standardized fields</h3>

<p>
          Certain fields from the IBM AFS and OpenAFS file 
          server's VolumeDiskData header are generally useful. In 
          particular, several fields exported via the 
          AFSVolGetFlags and AFSVolSetFlags RPCs should be 
          exported via the TLV interface. The full list of 
          supported TLV tuples are:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSVOL_TLV_TAG_VOL_IN_SERVICE</dt>
<dd>
              This tuple will contain a boolean value, and therefore 
              MUST have a payload type of either: 
              AFSINT_TLV_TYPE_TRUE, or AFSINT_TLV_TYPE_FALSE. When 
              this bit is not asserted, the volume is 
              administratively prohibited from coming online.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_BLESSED</dt>
<dd>
              This tuple will contain a boolean value, and therefore 
              MUST have a payload type of either: 
              AFSINT_TLV_TYPE_TRUE, or AFSINT_TLV_TYPE_FALSE. When 
              this bit is not asserted, the volume is 
              administratively prohibited from coming online.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_RESTORED_FROM_ID</dt>
<dd>
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. When this field is non-zero, it 
              contains the volume ID contained in the dump from which 
              it was restored.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_DESTROYED</dt>
<dd>
              This tuple will contain a boolean value, and therefore 
              MUST have a payload type of either: 
              AFSINT_TLV_TYPE_TRUE, or AFSINT_TLV_TYPE_FALSE. When 
              this bit is asserted, this volume is flagged for deletion.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_NEEDS_SALVAGE</dt>
<dd>
              This tuple will contain a boolean value, and therefore 
              MUST have a payload type of either: 
              AFSINT_TLV_TYPE_TRUE, or AFSINT_TLV_TYPE_FALSE. When 
              this bit is asserted, this volume requires a salvage.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_OFFLINE_MESSAGE</dt>
<dd>
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_STRING. The u_string payload field MUST 
              contain a null-terminated string. This field stores an 
              administrative message to indicate why the volume is offline.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_EXPIRATION_DATE</dt>
<dd>
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This timestamp shall be encoded 
              using the rules specified in the forthcoming afs3 RPC 
              refresh document. To the best knowledge of the authors, 
              this field is not standardized by any implementation.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_RESERVATION</dt>
<dd>
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. This field, otherwise known as 
              minquota, specifies the amount of storage (in units of 
              1024 octets) that are reserved on the underlying 
              storage for use by this volume.
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Extended volume state exportation</h3>

<p>
        In addition to exporting the existing volser state, DAFS
        state metadata will also be exported via the TLV interface.
        Specifically, an extended volume state field, and a raw
        DAFS state debugging tag, will be exported.
      
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Mapped volume states</h3>

<p>
          Given that volume state information is useful across 
          all server implementations, a collection of generic 
          states shall be standardized. The following states are 
          initially defined in the namespace:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSVOL_VOLUME_STATE_OUT_OF_SERVICE</dt>
<dd>
              This volume is administratively out of service. For 
              example, the IBM AFS and OpenAFS implementations both 
              permit an administrator to force a volume offline by 
              mutating the blessed and inService bits.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_OFFLINE</dt>
<dd>
              This volume is offline for reasons other than 
              administrative intervention.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_READY</dt>
<dd>
              This volume is not online, but it is ready to be 
              brought online by the server on-demand.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_ONLINE</dt>
<dd>
              This volume is online.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_BUSY</dt>
<dd>
              This volume is busy performing some operation 
              which requires exclusive access.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_IO_BUSY</dt>
<dd>
              This volume is busy performing an I/O operation which 
              requires exclusive access.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_SALVAGING</dt>
<dd>
              This volume is currently being salvaged in the background.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_SALVAGE_NEEDED</dt>
<dd>
              This volume is offline, and will require a salvage 
              before it can be brought online.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_ERROR</dt>
<dd>
              This volume has been forced offline due to a 
              non-recoverable error. Manual intervention by an 
              administrator will be necessary to bring this volume 
              back to an operable state.
            
</dd>
<dt>AFSVOL_VOLUME_STATE_VOLUME_OPERATION</dt>
<dd>
              This volume is currently offline because a volume 
              transaction requires exclusive access.
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Mapped process types</h3>

<p>
          It is useful to be able to track volume ownership by 
          process type. In order to do this, a new program type 
          namespace must be defined. The following types are 
          initially defined in the program type namespace:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSINT_PROGRAM_TYPE_FILE_SERVER</dt>
<dd>
              Refers to an afs file server process (Rx udp port 7000, 
              service ID 0).
            
</dd>
<dt>AFSINT_PROGRAM_TYPE_VOLUME_SERVER</dt>
<dd>
              Refers to an afs volume server process (Rx udp port 
              7005, service ID 4).
            
</dd>
<dt>AFSINT_PROGRAM_TYPE_SALVAGER</dt>
<dd>
              Refers to an afs stand-alone salvager process.
            
</dd>
<dt>AFSINT_PROGRAM_TYPE_SALVAGE_SERVER</dt>
<dd>
              Refers to an OpenAFS DAFS salvage server process.
            
</dd>
<dt>AFSINT_PROGRAM_TYPE_VOLUME_UTILITY</dt>
<dd>
              Refers to any ancillary stand-alone volume utility process.
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
TLV tuples</h3>

<p>
          Volume state will be exported via three new TLV tuples:
        
</p>
<p>
          </p>
<blockquote class="text"><dl>
<dt>AFSVOL_TLV_TAG_VOL_STATE_MAPPED</dt>
<dd>
              This tuple MUST have payload of type 
              AFSINT_TLV_TYPE_UINT64. The u_64 payload shall contain 
              a volume state enumeration value, as defined in [sub:Mapped-volume-states].
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_STATE_DAFS_RAW</dt>
<dd>
              For servers exporting capability 
              AFSVOL_CAPABILITY_DAFS, this payload MUST be of type 
              AFSINT_TLV_TYPE_OPAQUE. Encoding of raw state is 
              unspecified and implementation-private.
            
</dd>
<dt>AFSVOL_TLV_TAG_VOL_OWNING_PROCESS</dt>
<dd>
              For servers exporting capability 
              AFSVOL_CAPABILITY_DAFS, this payload MUST be of type 
              AFSINT_TLV_TYPE_UINT64. The u_64 payload shall contain 
              a program type enumeration value, as defined in [sub:Mapped-process-types].
            
</dd>
</dl></blockquote><p>
        
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>
        We would like to thank all of the participants at the 2009 Edinburgh AFS 
        hackathon for their input into the design of this TLV mechanism.  Alistair
        Ferguson has provided much useful feedback, especially with regard to backwards
        compatibility and discriminated union type identifier namespace allocations.
        Andrew Deason and Michael Meffie have provided considerable input with
        regard to the discriminated union XDR decoding problem, GCO registrar
        and namespace allocation concerns, what metadata should be exported in the
        initial revision, the notion of data qualifiers, as well as commentary about
        how they envision this extension being used to support future protocol
        extensions.
      
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
GCO Registrar Considerations</h3>

<p>
        The Grand Central Registrar will need to consider 
        several assigned numbers requests.
      
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Namespace allocations</h3>

<p>
          First and foremost, this memo requests that the GCO 
          Registrar assume control over several new namespaces:
        
</p>
<p>
          </p>
<ol class="text">
<li>AFSVol capability bit namespace
</li>
<li>AFS-3 TLV payload type namespace
</li>
<li>AFSVol TLV tag namespace
</li>
<li>AFSVol mapped volume state namespace
</li>
<li>AFS-3 program type namespace
</li>
</ol><p>
        
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Assigned numbers allocations</h3>

<p>
          In addition to requesting the allocation of new 
          namespaces, this memo also requests several new 
          allocations within existing assigned numbers 
          namespaces. 
        
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.1"></a><h3>9.2.1.&nbsp;
VICED capability bits</h3>

<p>
            One new capability bit is requested:

            </p>
<ul class="text">
<li>VICED_CAPABILITY_DAFS
</li>
</ul><p>

          
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.2"></a><h3>9.2.2.&nbsp;
AFSVol capability bits</h3>

<p>
            Two new capability bits are requested:

            </p>
<ul class="text">
<li>AFSVOL_CAPABILITY_DAFS
</li>
<li>AFSVOL_CAPABILITY_TLV
</li>
</ul><p>
          
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.3"></a><h3>9.2.3.&nbsp;
AFS-3 TLV payload types</h3>

<p>
            The following payload type allocations are requested:
          
</p>
<p>
            </p>
<ul class="text">
<li>AFSINT_TLV_TYPE_NULL
</li>
<li>AFSINT_TLV_TYPE_TRUE
</li>
<li>AFSINT_TLV_TYPE_FALSE
</li>
<li>AFSINT_TLV_TYPE_UINT64
</li>
<li>AFSINT_TLV_TYPE_UUID
</li>
<li>AFSINT_TLV_TYPE_STRING
</li>
<li>AFSINT_TLV_TYPE_OPAQUE
</li>
</ul><p>
          
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.4"></a><h3>9.2.4.&nbsp;
AFSVol TLV tags</h3>

<p>
            The following tag allocations are requested:
          
</p>
<p>
            </p>
<ul class="text">
<li>AFSVOL_TLV_TAG_VOL_NAME
</li>
<li>AFSVOL_TLV_TAG_VOL_STATUS
</li>
<li>AFSVOL_TLV_TAG_VOL_IN_USE
</li>
<li>AFSVOL_TLV_TAG_VOL_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_TYPE
</li>
<li>AFSVOL_TLV_TAG_VOL_CLONE_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_BACKUP_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_PARENT_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_COPY_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_CREATE_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_ACCESS_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_UPDATE_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_BACKUP_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_SIZE
</li>
<li>AFSVOL_TLV_TAG_VOL_FILE_COUNT
</li>
<li>AFSVOL_TLV_TAG_VOL_MAX_QUOTA
</li>
<li>AFSVOL_TLV_TAG_VOL_DAY_USE
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_READS
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_WRITES
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_FILE_SAME_AUTHOR
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_FILE_DIFFERENT_AUTHOR
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_DIR_SAME_AUTHOR
</li>
<li>AFSVOL_TLV_TAG_VOL_STAT_DIR_DIFFERENT_AUTHOR
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_TIME
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_CREATE_TIME
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_RETURN_CODE
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_ATTACH_MODE
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_STATUS
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_FLAGS
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_LAST_PROC_NAME
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_CALL_VALID
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_READ_NEXT
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_XMIT_NEXT
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_LAST_RECV_TIME
</li>
<li>AFSVOL_TLV_TAG_VOL_TRANS_LAST_SEND_TIME
</li>
<li>AFSVOL_TLV_TAG_VOL_IN_SERVICE
</li>
<li>AFSVOL_TLV_TAG_VOL_BLESSED
</li>
<li>AFSVOL_TLV_TAG_VOL_RESTORED_FROM_ID
</li>
<li>AFSVOL_TLV_TAG_VOL_DESTROYED
</li>
<li>AFSVOL_TLV_TAG_VOL_NEEDS_SALVAGE
</li>
<li>AFSVOL_TLV_TAG_VOL_OFFLINE_MESSAGE
</li>
<li>AFSVOL_TLV_TAG_VOL_EXPIRATION_DATE
</li>
<li>AFSVOL_TLV_TAG_VOL_RESERVATION
</li>
<li>AFSVOL_TLV_TAG_VOL_STATE_MAPPED
</li>
<li>AFSVOL_TLV_TAG_VOL_STATE_RAW
</li>
<li>AFSVOL_TLV_TAG_VOL_OWNING_PROCESS
</li>
<li>AFSVOL_TLV_TAG_EOS
</li>
</ul><p>
          
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.5"></a><h3>9.2.5.&nbsp;
VOLS error table</h3>

<p>
            Within the VOLS error table (offset 1492325120), 
            several new codes need to be allocated: 
          
</p>
<p>
            </p>
<ul class="text">
<li>VOLSERTAGUNSUPPORTED
</li>
<li>VOLSERTAGREADONLY
</li>
<li>VOLSERTAGWRITEFAILED
</li>
<li>VOLSERTAGDECODEFAILED
</li>
<li>VOLSERTAGUNSUPPORTEDENCODING
</li>
<li>VOLSERTLVQUALIFIERUNSUPPORTEDENCODING
</li>
<li>VOLSERTLVQUALIFIERDECODEFAILED
</li>
<li>VOLSERTLVQUALIFIERINVALID
</li>
</ul><p>
          
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.6"></a><h3>9.2.6.&nbsp;
AFSVol mapped volume names</h3>

<p>
            Within the new AFSVol mapped volume state namespace, 
            the following allocations are requested:
          
</p>
<p>
            </p>
<ul class="text">
<li>AFSVOL_VOLUME_STATE_OUT_OF_SERVICE
</li>
<li>AFSVOL_VOLUME_STATE_OFFLINE
</li>
<li>AFSVOL_VOLUME_STATE_READY
</li>
<li>AFSVOL_VOLUME_STATE_ONLINE
</li>
<li>AFSVOL_VOLUME_STATE_BUSY
</li>
<li>AFSVOL_VOLUME_STATE_IO_BUSY
</li>
<li>AFSVOL_VOLUME_STATE_SALVAGING
</li>
<li>AFSVOL_VOLUME_STATE_SALVAGE_NEEDED
</li>
<li>AFSVOL_VOLUME_STATE_ERROR
</li>
<li>AFSVOL_VOLUME_STATE_VOLUME_OPERATION
</li>
</ul><p>
          
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2.7"></a><h3>9.2.7.&nbsp;
AFS-3 program types</h3>

<p>
            Within the new AFS program type namespace, the 
            following allocations are requested:
          
</p>
<p>
            </p>
<ul class="text">
<li>AFSINT_PROGRAM_TYPE_FILE_SERVER
</li>
<li>AFSINT_PROGRAM_TYPE_VOLUME_SERVER
</li>
<li>AFSINT_PROGRAM_TYPE_SALVAGER
</li>
<li>AFSINT_PROGRAM_TYPE_SALVAGE_SERVER
</li>
<li>AFSINT_PROGRAM_TYPE_VOLUME_UTILITY
</li>
</ul><p>
          
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
        Security and authorization issues are tag-specific.  The legacy
        AFSVol RPCs permitted rxnull connections to perform the four
        ListVolume RPCs, and AFSVolMonitor.  Arguably, it is time to 
        re-evaluate this decision, and restrict access to certain
        tags, as they do permit potentially sensitive
        volume or operational metadata to leak onto public networks.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="AFS3-FSCM">[AFS3-FSCM]</a></td>
<td class="author-text">Zayas, E., &ldquo;AFS-3 Programmer's Reference: File Server/Cache Manager Interface,&rdquo; Tech. Rep.&nbsp;FS-00-D162, August&nbsp;1991.</td></tr>
<tr><td class="author-text" valign="top"><a name="AFS3-VVL">[AFS3-VVL]</a></td>
<td class="author-text">Zayas, E., &ldquo;AFS-3 Programmer's Reference: Volume Server/Volume Location Server Interface,&rdquo; Tech. Rep.&nbsp;FS-00-D165, August&nbsp;1991.</td></tr>
</table>

<a name="app-cap-xdr"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
XDR Grammar for FS-CM Capabilities Mechanism</h3>
<br /><hr class="insert" />
<a name="fscm-cap-xdr"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
const AFSCAPABILITIESMAX = 196;

typedef afs_uint32 Capabilities&lt;AFSCAPABILITIESMAX&gt;;

/* Viced Capability Flags */
const VICED_CAPABILITY_ERRORTRANS   = 0x0001;
const VICED_CAPABILITY_64BITFILES   = 0x0002;
const VICED_CAPABILITY_WRITELOCKACL = 0x0004;
const VICED_CAPABILITY_SANEACLS     = 0x0008;

/* Cache Manager Capability Flags */
const CLIENT_CAPABILITY_ERRORTRANS  = 0x0001;
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Thomas Keiser</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sine Nomine Associates</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">43596 Blacksmith Square</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ashburn, VA  20147</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 703 723 6673</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tkeiser@sinenomine.net">tkeiser@sinenomine.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Steven Jenkins</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sine Nomine Associates</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">43596 Blacksmith Square</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ashburn, VA  20147</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 703 723 6673</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:sjenkins@sinenomine.net">sjenkins@sinenomine.net</a></td></tr>
</table>
</body></html>
