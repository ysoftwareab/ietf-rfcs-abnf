



MPLS Working Group                                              W. Cheng
Internet-Draft                                              China Mobile
Intended status: Standards Track                                  X. Min
Expires: September 8, 2020                                           ZTE
                                                                 T. Zhou
                                                                  Huawei
                                                                 X. Dong
                                                               FiberHome
                                                                Y. Peleg
                                                                Broadcom
                                                           March 7, 2020


 Encapsulation For MPLS Performance Measurement with Alternate Marking
                                 Method
              draft-cheng-mpls-inband-pm-encapsulation-03

Abstract

   This document defines the encapsulation for MPLS performance
   measurement with alternate marking method, which performs flow-based
   packet loss, delay, and jitter measurements on live traffic.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on September 8, 2020.

Copyright Notice

   Copyright (c) 2020 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of



Cheng, et al.           Expires September 8, 2020               [Page 1]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
     1.1.  Conventions Used in This Document . . . . . . . . . . . .   3
       1.1.1.  Terminology . . . . . . . . . . . . . . . . . . . . .   3
       1.1.2.  Requirements Language . . . . . . . . . . . . . . . .   3
   2.  Flow-based PM Encapsulation in MPLS . . . . . . . . . . . . .   4
     2.1.  Examples for Applying Flow-ID Label in a label stack  . .   5
   3.  Procedures of Encapsulation, Look-up and Decapsulation  . . .   7
   4.  Procedures of Flow-ID allocation  . . . . . . . . . . . . . .   8
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   9
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   9
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   9
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  10
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .  10
     8.2.  Informative References  . . . . . . . . . . . . . . . . .  10
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  11

1.  Introduction

   [RFC8321] describes a passive performance measurement method, which
   can be used to measure packet loss, delay, and jitter on live
   traffic.  Since this method is based on marking consecutive batches
   of packets, the method is often referred to as Alternate Marking
   Method.

   [RFC8372] discusses the desired capabilities for MPLS flow
   identification, in order to perform a better in-band performance
   monitoring of user data packets.  Synonymous Flow Label (SFL), which
   is introduced in [I-D.ietf-mpls-sfl-framework], is identified as a
   method of accomplishing MPLS flow identification.  This document
   employs a method, other than SFL, to accomplish MPLS flow
   identification.  The method described in this document is simple and
   flexible, furthermore, it complies with the current MPLS forwarding
   paradigm.

   On one hand, the method described in this document is complementary
   to the SFL method [I-D.ietf-mpls-sfl-framework]
   [I-D.bryant-mpls-sfl-control], the former targets at hop-by-hop
   performance measurement, and the latter targets at end-to-end
   performance measurement, furthermore, the former supports the



Cheng, et al.           Expires September 8, 2020               [Page 2]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   application scenario where Flow-ID is applied to MPLS LSP and MPLS
   VPN synchronously, and the latter doesn't support this kind of
   application scenario.  On the other hand, the method described in
   this document is complementary to the In-situ OAM method
   [I-D.ietf-ippm-ioam-data] [I-D.ietf-ippm-ioam-direct-export], the
   former doesn't introduce any new header but the latter introduces a
   new In-situ OAM header, furthermore, the former allows the network
   nodes to report the refined data (e.g. calculated performance
   metrics) associated with a specified flow, nevertheless the latter
   requests the network nodes to report the data (e.g. ingress interface
   and egress interface) associated with a specified packet.

   This document defines the encapsulation for MPLS performance
   measurement with alternate marking method, which performs flow-based
   packet loss, delay, and jitter measurements on live traffic.

1.1.  Conventions Used in This Document

1.1.1.  Terminology

   LSP: Label Switched Path

   MPLS: Multi-Protocol Label Switching

   NMS: Network Management System

   PM: Performance Measurement

   PW: PseudoWire

   SFL: Synonymous Flow Label

   TC: Traffic Class

   TTL: Time to Live

   VC: Virtual Channel

   VPN: Virtual Private Network

1.1.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.




Cheng, et al.           Expires September 8, 2020               [Page 3]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


2.  Flow-based PM Encapsulation in MPLS

   Flow-based MPLS performance measurement encapsulation with alternate
   marking method has the following format:


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Extension Label (15)         |  TC |S|      TTL      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Flow-ID Label Indicator (TBA1)    |  TC |S|      TTL      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Flow-ID Label             |  TC |S|      TTL      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


               Figure 1: Flow-based PM Encapsulation in MPLS

   Flow-ID Label Indicator is an Extended Special Purpose Label (eSPL),
   which is combined with the Extension Label (XL, value 15) to form a
   Composite Special Purpose Label (cSPL), as defined in
   [I-D.ietf-mpls-spl-terminology].  Flow-ID Label Indicator is defined
   in this document as value TBA1.

   Analogous to Entropy Label Indicator [RFC6790], the TC and TTL for
   the Extension Label and the Flow-ID Label Indicator SHOULD follow the
   same field values of that label immediately preceding the Extension
   Label, otherwise, the TC and TTL for the Extension Label and the
   Flow-ID Label Indicator MAY be different values if it is known that
   the Extension Label will not be exposed as the top label at any point
   along the LSP.  The S bit for the Extension Label and the Flow-ID
   Label Indicator MUST be zero.

   Flow-ID Label is used as MPLS flow identification [RFC8372], its
   value should be unique within the administrative domain.  Flow-ID
   values can be allocated by an external NMS or a controller, based on
   measurement object instance such as LSP or PW.  There is a one-to-one
   mapping between Flow-ID and flow.  The specific method on how to
   allocate the Flow-ID values is described in Section 4.

   Analogous to Entropy Label [RFC6790], the Flow-ID Label can be placed
   at either the bottom or the middle of the MPLS label stack, and the
   Flow-ID Label MAY appear multiple times in a label stack.
   Section 2.1 of this document provides several examples to illustrate
   how to apply Flow-ID Label in a label stack.  Again analogous to
   Entropy Label, the TTL for the Flow-ID Label MUST be zero to ensure
   that it is not used inadvertently for forwarding, the TC for the



Cheng, et al.           Expires September 8, 2020               [Page 4]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   Flow-ID Label may be any value, the S bit for the Flow-ID Label
   depends on whether or not there are more labels in the label stack.

   Besides flow identification, a color-marking field is also necessary
   for alternate marking method.  To achieve the purpose of coloring the
   MPLS traffic, it's RECOMMENDED to reuse the Flow-ID Label's TC, i.e.,
   using TC's highest order two bits (called double-marking methodology
   [RFC8321]) as color-marking bits.  Alternatively, one more specific
   MPLS color-marking label may be placed immediately following the
   Flow-ID label.

2.1.  Examples for Applying Flow-ID Label in a label stack

   Three examples on different layout of Flow-ID Label (4 octets) are
   illustrated as follows:

   (1) Layout of Flow-ID Label when applied to MPLS LSP.


                +----------------------+
                |          LSP         |
                |         Label        |
                +----------------------+
                |       Extension      | <--+
                |         Label        |    |
                +----------------------+    |--- cSPL
                |     Flow-ID Label    |    |
                |       Indicator      | <--+
                +----------------------+
                |        Flow-ID       |
                |         Label        |
                +----------------------+
                |          VPN         |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


                  Figure 2: Applying Flow-ID to MPLS LSP

   (2) Layout of Flow-ID Label when applied to MPLS VPN traffic.







Cheng, et al.           Expires September 8, 2020               [Page 5]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


                +----------------------+
                |          LSP         |
                |         Label        |
                +----------------------+
                |          VPN         |
                |         Label        |
                +----------------------+
                |       Extension      | <--+
                |         Label        |    |
                +----------------------+    |--- cSPL
                |     Flow-ID Label    |    |
                |       Indicator      | <--+
                +----------------------+
                |        Flow-ID       |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


                  Figure 3: Applying Flow-ID to MPLS VPN

   (3) Layout of Flow-ID Label when applied to both MPLS LSP and MPLS
   VPN traffic.

























Cheng, et al.           Expires September 8, 2020               [Page 6]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


                +----------------------+
                |          LSP         |
                |         Label        |
                +----------------------+
                |       Extension      | <--+
                |         Label        |    |
                +----------------------+    |--- cSPL
                |     Flow-ID Label    |    |
                |       Indicator      | <--+
                +----------------------+
                |        Flow-ID       |
                |         Label        |
                +----------------------+
                |          VPN         |
                |         Label        |
                +----------------------+
                |       Extension      | <--+
                |         Label        |    |
                +----------------------+    |--- cSPL
                |     Flow-ID Label    |    |
                |       Indicator      | <--+
                +----------------------+
                |        Flow-ID       |
                |         Label        |
                +----------------------+ <= Bottom of stack
                |                      |
                |        Payload       |
                |                      |
                +----------------------+


         Figure 4: Applying Flow-ID to both MPLS LSP and MPLS VPN

   Note that here VPN label can be MPLS PW label, MPLS Ethernet VPN
   label or MPLS IP VPN label, and it's also called VC label as defined
   in [RFC4026].

   Also note that for this example the two Flow-ID values appearing in a
   label stack MUST be different, that is to say, Flow-ID Label applied
   to MPLS LSP and Flow-ID Label applied to MPLS VPN share the same
   value space.

3.  Procedures of Encapsulation, Look-up and Decapsulation

   The procedures for Flow-ID label encapsulation, look-up and
   decapsulation are summarized as follows:





Cheng, et al.           Expires September 8, 2020               [Page 7]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   o  The ingress node inserts the Extension Label, the Flow-ID Label
      Indicator, alongside with the Flow-ID label, into the MPLS label
      stack.  At the same time, the ingress node sets the color-marking
      field, as needed by alternate-marking technique, and sets the
      Flow-ID value, as defined in this document.

   o  The transit nodes look up the Flow-ID label with the help of the
      Extension Label and the Flow-ID Label Indicator, and transmit the
      collected information to an external NMS or a controller, which
      includes the values of the block counters and the timestamps of
      the marked packets, along with the value of the Flow-ID, referring
      to the procedures of alternate marking method.

   o  The egress node pops the Extension Label and the Flow-ID Label
      Indicator, alongside with the Flow-ID label, from the MPLS label
      stack.  This document doesn't introduce any new procedure
      regarding to the process of the decapsulated packet.

4.  Procedures of Flow-ID allocation

   There are two ways of allocating Flow-ID, one way is to allocate
   Flow-ID by manual trigger from the network operator, and the other
   way is to allocate Flow-ID by automatic trigger from the ingress
   node, details are as follows:

   o  In the case of manual trigger, the network operator would manually
      input the characteristics (e.g.  IP five tuples and IP DSCP) of
      the measured IP traffic flow, then the NMS or the controller would
      generate one or two Flow-IDs based on the input from the network
      operator, and provision the ingress node with the characteristics
      of the measured IP traffic flow and the corresponding allocated
      Flow-ID(s).

   o  In the case of automatic trigger, the ingress node would identify
      the IP traffic flow entering the measured path, export the
      characteristics of the identified IP traffic flow to the NMS or
      the controller by IPFIX [RFC7011], then the NMS or the controller
      would generate one or two Flow-IDs based on the export from the
      ingress node, and provision the ingress node with the
      characteristics of the identified IP traffic flow and the
      corresponding allocated Flow-ID(s).

   The policy pre-configured at the NMS or the controller decides
   whether one Flow-ID or two Flow-IDs would be generated.  If the
   performance measurement on VPN traffic is enabled, then one Flow-ID
   applied to MPLS VPN would be generated; if the performance
   measurement on LSP tunnel is enabled, then one Flow-ID applied to
   MPLS LSP would be generated; if both of them are enabled, then two



Cheng, et al.           Expires September 8, 2020               [Page 8]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   Flow-IDs respectively applied to MPLS VPN and MPLS LSP would be
   generated.

   Whether using manual trigger or using automatic trigger, the NMS or
   the controller MUST guarantee every generated Flow-ID is unique
   within the administrative domain.

5.  Security Considerations

   This document introduces the performance measurement domain that is
   the scope of a Flow-ID Label.  The Flow-ID Label Indicator and Flow-
   ID Label MUST NOT be signaled and distributed outside one performance
   measurement domain.  Improper configuration so that the Flow-ID Label
   being passed from one domain to another would likely result in
   potential Flow-ID conflicts.

   To prevent packets carrying Flow-ID Label from leaking from one
   domain to another, the domain boundary nodes SHOULD deploy some
   policies (e.g., ACL) to filter out the packets.  Specifically, in the
   sending end, the domain boundary node SHOULD filter out the packets
   that carry the Flow-ID Label Indicator and are sent to other domain;
   in the receiving end, the domain boundary node SHOULD drop the
   packets that carry the Flow-ID Label Indicator and are from other
   domains.

6.  IANA Considerations

   In the Special-Purpose MPLS Label Values registry defined in
   [SP-MPLS-Label], a new Extended Special-Purpose MPLS Label Value for
   Flow-ID Label Indicator is requested from IANA as follows:

   +-----------------------+----------------+--------------+-----------+
   | Extended Special-     | Description    | Semantics    | Reference |
   | Purpose MPLS Label    |                | Definition   |           |
   | Value                 |                |              |           |
   +-----------------------+----------------+--------------+-----------+
   | TBA1                  | Flow-ID Label  | Section 2    | This      |
   |                       | Indicator      |              | Document  |
   +-----------------------+----------------+--------------+-----------+

    Table 1: New Extended Special-Purpose MPLS Label Value for Flow-ID
                              Label Indicator

7.  Acknowledgements

   The authors would like to acknowledge Loa Andersson, Tarek Saad,
   Stewart Bryant, Rakesh Gandhi, Greg Mirsky, Aihua Liu, Shuangping
   Zhan and Ming Ke for their careful review and very helpful comments.



Cheng, et al.           Expires September 8, 2020               [Page 9]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


8.  References

8.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [SP-MPLS-Label]
              "Special-Purpose MPLS Label Values", 2019,
              <https://www.iana.org/assignments/mpls-label-values/mpls-
              label-values.xml>.

8.2.  Informative References

   [I-D.bryant-mpls-sfl-control]
              Bryant, S., Swallow, G., and S. Sivabalan, "A Simple
              Control Protocol for MPLS SFLs", draft-bryant-mpls-sfl-
              control-06 (work in progress), January 2020.

   [I-D.ietf-ippm-ioam-data]
              Brockners, F., Bhandari, S., Pignataro, C., Gredler, H.,
              Leddy, J., Youell, S., Mizrahi, T., Mozes, D., Lapukhov,
              P., remy@barefootnetworks.com, r., daniel.bernier@bell.ca,
              d., and J. Lemon, "Data Fields for In-situ OAM", draft-
              ietf-ippm-ioam-data-08 (work in progress), October 2019.

   [I-D.ietf-ippm-ioam-direct-export]
              Song, H., Gafni, B., Zhou, T., Li, Z., Brockners, F.,
              Bhandari, S., Sivakolundu, R., and T. Mizrahi, "In-situ
              OAM Direct Exporting", draft-ietf-ippm-ioam-direct-
              export-00 (work in progress), February 2020.

   [I-D.ietf-mpls-sfl-framework]
              Bryant, S., Chen, M., Li, Z., Swallow, G., Sivabalan, S.,
              and G. Mirsky, "Synonymous Flow Label Framework", draft-
              ietf-mpls-sfl-framework-06 (work in progress), October
              2019.

   [I-D.ietf-mpls-spl-terminology]
              Andersson, L., Kompella, K., and A. Farrel, "Special
              Purpose Label terminology", draft-ietf-mpls-spl-
              terminology-01 (work in progress), November 2019.



Cheng, et al.           Expires September 8, 2020              [Page 10]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   [RFC4026]  Andersson, L. and T. Madsen, "Provider Provisioned Virtual
              Private Network (VPN) Terminology", RFC 4026,
              DOI 10.17487/RFC4026, March 2005,
              <https://www.rfc-editor.org/info/rfc4026>.

   [RFC6790]  Kompella, K., Drake, J., Amante, S., Henderickx, W., and
              L. Yong, "The Use of Entropy Labels in MPLS Forwarding",
              RFC 6790, DOI 10.17487/RFC6790, November 2012,
              <https://www.rfc-editor.org/info/rfc6790>.

   [RFC7011]  Claise, B., Ed., Trammell, B., Ed., and P. Aitken,
              "Specification of the IP Flow Information Export (IPFIX)
              Protocol for the Exchange of Flow Information", STD 77,
              RFC 7011, DOI 10.17487/RFC7011, September 2013,
              <https://www.rfc-editor.org/info/rfc7011>.

   [RFC8321]  Fioccola, G., Ed., Capello, A., Cociglio, M., Castaldelli,
              L., Chen, M., Zheng, L., Mirsky, G., and T. Mizrahi,
              "Alternate-Marking Method for Passive and Hybrid
              Performance Monitoring", RFC 8321, DOI 10.17487/RFC8321,
              January 2018, <https://www.rfc-editor.org/info/rfc8321>.

   [RFC8372]  Bryant, S., Pignataro, C., Chen, M., Li, Z., and G.
              Mirsky, "MPLS Flow Identification Considerations",
              RFC 8372, DOI 10.17487/RFC8372, May 2018,
              <https://www.rfc-editor.org/info/rfc8372>.

Authors' Addresses

   Weiqiang Cheng
   China Mobile
   Beijing
   China

   Email: chengweiqiang@chinamobile.com


   Xiao Min
   ZTE
   Nanjing
   China

   Email: xiao.min2@zte.com.cn








Cheng, et al.           Expires September 8, 2020              [Page 11]

Internet-Draft         Encap For MPLS PM with AMM             March 2020


   Tianran Zhou
   Huawei
   Beijing
   China

   Email: zhoutianran@huawei.com


   Ximing Dong
   FiberHome
   Wuhan
   China

   Email: dxm@fiberhome.com


   Yoav Peleg
   Broadcom
   USA

   Email: yoav.peleg@broadcom.com






























Cheng, et al.           Expires September 8, 2020              [Page 12]
