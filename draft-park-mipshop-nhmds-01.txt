

   IETF MIPSHOP Working Group                            
   Internet Draft                                         Youngjun Park 
                                                           Kyungjoo Suh 
   Document: draft-park-mipshop-nhmds-01.txt        Samsung Electronics 
   Expires: July 2004                                      January 2004 
                   
                   
           Non-hierarchical MAP Discovery and Selection in HMIPv6 
                   
                   
               Status of this Memo 
    
   This document is an Internet-Draft and is in full conformance with 
   all provisions of Section 10 of RFC2026 [i].  
    
   Internet-Drafts are working documents of the Internet Engineering 
   Task Force (IETF), its areas, and its working groups.  Note that      
   other groups may also distribute working documents as Internet-Drafts. 
    
   Internet-Drafts are draft documents valid for a maximum of six months 
   and may be updated, replaced, or obsoleted by other documents at any 
   time.  It is inappropriate to use Internet-Drafts as reference 
   material or to cite them other than as "work in progress." 
    
   The list of current Internet-Drafts can be accessed at 
        http://www.ietf.org/ietf/1id-abstracts.txt 
   The list of Internet-Draft Shadow Directories can be accessed at 
        http://www.ietf.org/shadow.html. 
    
    
    
Abstract 
    
   This memo introduces an alternative dynamic MAP (Mobility Anchor 
   Point) discovery and selection procedure for HMIPv6 (Hierarchical 
   Mobile IPv6).  
        
   A new dynamic MAP discovery method is defined in order to change the 
   size of MAP domain. Subsequent MAP selection algorithm enables to 
   locate MAP on the closest and highest level of hierarchical structure 
   of routers. Addressed method is beneficial not only for the 
   performance of localized mobility management but also for the 
   location privacy. Also it gives flexible domain designing capability 
   to the operators. 
    
    
    
    
    
    
 
 
Park and Suh             Expires - July 2004                 [Page 1] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
Conventions used in this document 
    
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
   "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this 
   document are to be interpreted as described in RFC-2119 [ii]. 
    
    
    
Table of Contents 
    
   1. Introduction...................................................3 
    
   2. Overview.......................................................3 
 
      2.1. MAP Discovery and Selection...............................3 
 
      2.2. MAP Domain Notification...................................3 
    
   3. MAP Discovery and Selection....................................5 
     
      3.1. MAP Operations............................................5 
   
      3.2. Router Operations.........................................7 
     
      3.3. Mobile Node Operations....................................8 
     
   4. Compatibility Considerations..................................10 
    
   Security Considerations..........................................10 
    
   References.......................................................10 
    
   Author's Addresses...............................................11 
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
 
 
Park and Suh             Expires - July 2004                 [Page 2] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
1 Introduction 
    
   HMIPv6 is suggested to reduce signalling overhead of MIPv6. By 
   introducing a MAP as the local mobility agent, overhead incurred by 
   binding updates to home agent and correspondent node can be decreased.  
    
   In HMIPv6, a dynamic MAP discovery and a MAP selection are used by 
   mobile nodes to locate MAPs [vi]. Alternative MAP discovery algorithm 
   and MAP selection criteria are introduced in this memo. Suggested  
   MAP discovery algorithm helps finding the closest MAP on the highest 
   level of the hierarchy of routers. In addition, a method to change 
   the boundary of the MAP domain is suggested. 
    
    
    
2 Overview 
    
   In HMIPv6, a mobile node must carry out binding updates to both home 
   agent and correspondent node whenever serving MAP is changed. Binding 
   update to the distant home agent and correspondent node produces 
   packet reception latency and this latency results in the loss of 
   packets from correspondent node. Therefore the performance of HMIPv6 
   is determined by the time a mobile node can be served by a single MAP 
   continuously. 
    
   A mobile node can use HMIPv6 when it can locate MAP at the visited 
   network. MAP discovery is the process by which mobile node can find 
   the remote MAP. MAPs and routers are in charge of MAP discovery. Each 
   MAP propagates its MAP option to the neighbor routers and each router 
   distributes received MAP options to other routers. 
    
   If the domain of each MAP is wider, the less HMIPv6 mobile node 
   changes serving MAP. But at the same time, traffic and computational 
   load of each MAP and local binding signalling latency will increase. 
   Otherwise, MAP has smaller load and mobile node can update local 
   binding quickly, but MAP service discontinuity increases. Two cases 
   have trade-off. 
    
   The coverage of MAP is determined by the MAP option propagation 
   method. In the dynamic MAP discovery [vi], MAP option is distributed 
   only to the lower level routers. Therefore, MAP domain is bounded to 
   the routers located below the MAP. 
    
   In this memo, two MAP options are used to achieve adjustable MAP 
   domain; modified MAP option and DOMAIN option. Differs from the 
   original MAP option, proposed MAP options are distributed to the 
   whole subnet even to the higher level routers. MAP domain boundary is 
   determined not by distribution scheme, but by another option message 
   which indicates the highest router of MAP domain. 
 
 
Park and Suh             Expires - July 2004                 [Page 3] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
   2.1. MAP Discovery and Selection 
    
   The basic idea of the proposed method is to introduce the concept of 
   direction to the hierarchy of routers. New value "Upward" is defined 
   to represent the number of times MAP option is delivered from the 
   router located on lower level to the router located on higher level. 
   "Distance" of original MAP option represents the number of times MAP 
   option is delivered from a router to another router. The relative 
   height of MAP to the recipient of MAP option can be calculated by the 
   difference between "Distance" and "Upward". 
    
   Proposed MAP dynamic discovery method distributes MAP options to the 
   whole subnet. MAP and the intermediate routers forward MAP options to 
   all the neighbor routers. Routers receiving MAP options calculate and 
   modify the value of "Distance" and "Upward". The operation continues 
   until MAP option is delivered to mobile node. 
     
   Upon reception of MAP option, mobile node must select one MAP to 
   perform local binding update. Basic criterion of proposed MAP 
   selection is to select the closest MAP on the highest level in a 
   given MAP domain. Delivered "Distance" and "Upward" values are used 
   in determining optimal MAP. 
    
    
   2.2. MAP Domain Notification 
    
   Mobile node requests local binding to particular MAP when it moves in 
   corresponding MAP domain. The MAP domain is a logical area which 
   consists of routers and access routers. To provide adjustable MAP 
   domain, MAP generates and sends DOMAIN option in this memo. DOMAIN 
   option conveys information about the boundary router of MAP domain. 
   When the boundary router receives this option, it limits MAP service 
   up to itself. 
    
    














 
 
Park and Suh             Expires - July 2004                 [Page 4] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
3 MAP Discovery and Selection 
 
   3.1 MAP Operations 
    
   0                   1                   2                   3          
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |     Type      |    Length     |  Dist |  Pref |R|I|P|V| Upward|      
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |                      Valid Lifetime                           |     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |                                                               |     
   +                                                               +     
   |                                                               |     
   +                   Global IP Address for MAP                   +     
   |                                                               |     
   +                                                               +     
   |                                                               |     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    
               Figure 1: New MAP option message format 
    
    
    
   0                   1                   2                   3          
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |     Type      |    Length     |  Dist | Level |Resrvd | Upward|      
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0|     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     
   |                                                               |     
   +                                                               +     
   |                                                               |     
   +                   Global IP Address for MAP                   +     
   |                                                               |     
   +                                                               +     
   |                                                               |     
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
    
               Figure 2: New DOMAIN option message format 
                   
                   






 
 
Park and Suh             Expires - July 2004                 [Page 5] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
   Fields:    
    
      Upward       A 4 bit unsigned integer indicating the number of 
                   times MAP option has been forwarded to a higher level 
                   router. When a router receives a MAP option sent from 
                   the lower level, it increase "Upward" by two before 
                   distributing MAP option to other routers. 
    
      Level        A 4 bit unsigned integer indicating the hierarchical 
                   level of a router. The router indicated by this value 
                   becomes the highest router of new MAP domain. 
    
      32-bit zeros This field is used to distinguish DOMAIN option from 
                   MAP option. A valid MAP option has non-zero "Valid 
                   lifetime" value. When a router receives MAP option 
                   whose "Valid lifetime" is zero, such MAP options are 
                   considered as DOMAIN option. 
    
   The basic process of a MAP is similar to that of dynamic MAP 
   discovery method described in HMIPv6 [vi]. MAP serves as the local 
   home agent for mobile nodes in a visited network. To announce 
   essential information for local binding update such as subnet prefix, 
   MAP generates and propagates MAP options in the router advertisement. 
    
   All MAPs must be configured so that they can send its MAP option onto 
   all the interfaces. No manually configured hierarchical forwarding 
   path is needed. 
     
   "Distance" field has default initial value one for all MAPs. This 
   field indicates the logical distance between the MAP and mobile node. 
   Thus, "Distance" value increases by one whenever the MAP option 
   passes a router. 
    
   "Upward" field has default initial value zero for all MAPs. This 
   field indicates the relative height of the mobile node to the MAP in 
   the hierarchy. "Upward" value increases by two whenever the MAP option 
   is delivered upward from the lower level router to the higher level 
   router. 
    
   "Preference" field may be configured by operators and can be changed 
   by policy or performance based decisions. Definition and usage of 
   other fields including R, I, P, and V flags are identical with the 
   description of HMIPv6. 
    
   After propagating its MAP option in router advertisement, MAP waits 
   for a mobile node to send local binding update. Upon reception of 
   local binding update, MAP checks validity of remaining lifetime of 
   RCoA provided by the mobile node. If the local binding update is 

 
 
Park and Suh             Expires - July 2004                 [Page 6] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
   acceptable, MAP sends binding acknowledgement to the mobile node 
   including type 2 routing header with the RCoA. 
    
   When a MAP needs to change its domain, it generates and sends DOMAIN 
   option. The differences of DOMAIN option from MAP option are 1) The 
   "Valid lifetime" of MAP option has non-zero value, 2) MAP option is 
   sent periodically, but DOMAIN option is sent only when a MAP changes 
   its domain, and 3) the recipients of MAP option are all the routers 
   and mobile nodes in the subnet, but DOMAIN option targets only the 
   router which located on the highest level of new MAP domain. 
    
   MAP domain is identified by the router located on highest level of 
   MAP domain. The value "Level" represents the relative height of 
   target router to the MAP. For example, if MAP wants to limit MAP 
   domain to the routers located on two level higher than it, MAP sends 
   DOMAIN option with "Level" = 2. If "Level" = 0, the highest router of 
   MAP domain is MAP itself, so new MAP domain is routers located below 
   the MAP. This domain is identical to the MAP domain of original 
   dynamic MAP discovery.   
    
    
   3.2 Router Operations 
    
   Upon receiving router advertisement including MAP option, a router 
   inspects the list of MAP options included in the advertisement.  
    
   The router must check whether newly received MAP option is duplicated 
   one. If "Global IP address for MAP" field of newly received MAP 
   option is identical with the MAP option received before, two MAP 
   options are duplicated. Identical MAP options may have different 
   propagation paths because they are distributed via all the interfaces 
   of all the routers. In this case, two MAP options from same MAP may 
   have different "Distance" or "Upward" values. In addition, 
   "Preference" value may be changes by network operators by the policy 
   or performance reason. Thus duplicated MAP options may have different 
   values. The Router checks if two options have same "Distance", 
   "Upward", and "Preference" values. The router computes the difference 
   between "Distance" and "Upward" for all the duplicated MAP options 
   and accepts the MAP option which has smallest difference. 
    
   After accepting a unique MAP option for a MAP, the router examines 
   the value of "Valid lifetime" If the value is zero, received MAP 
   option is DOMAIN option. Then the router computes and compares the 
   value of (Upward - Distance + 1) with the value of "Level". 
    
   If the value of (Upward - Distance + 1) is equal to the value of 
   "Level" the router finds itself the highest router of the MAP domain. 
   From then, when a MAP option from the MAP which sent DOMAIN option, 
   the router forwards MAP option to the routers located on the lower 
 
 
Park and Suh             Expires - July 2004                 [Page 7] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
   level. Also the router changes the value of "Preference" to zero and 
   forward MAP option to the routers located on the higher level.  
    
   Resultantly, when the routers and mobile nodes outside the new MAP 
   domain receive MAP option propagated by this router, they do not 
   request local binding update to the MAP. For all subtraction 
   operations, the values below zero are considered as zero. 
    
   If the value of (Upward - Distance + 1) is less than the value of 
   "Level" the router forwards DOMAIN options to the neighbor routers.  
    
   If received option is not a DOMAIN option but a MAP option, router 
   changes the values of "Distance" and "Upward" and retransmits MAP 
   option via all the interfaces. The modifications of these values are 
   classified into three cases: 
    
   (1) If the MAP option is sent from the routers on the higher levels, 
       then the router must increase "Distance" value by one. 
    
   (2) If the MAP option is sent from the routers on the lower level,  
       then the router must increase both "Distance" value by one and  
       "Upward" value by two.   
    
   (3) If the MAP option is sent from the router on the same level, then 
       the router must not modify any value in the MAP option. If the  
       router can not determine the level of router from which MAP    
       option is sent, the received router must not change any value in 
       the MAP option. 
    
   A router sends MAP option in its router advertisement after it 
   adjusts "Distance" and "Upward" values. 
    
    
   3.3 Mobile Node Operations 
    
   After moving from an access router to new access router, mobile node 
   listens for router advertisement. If received router advertisement 
   contains information about new access router, mobile node can 
   determine its movement and configures its LCoA by stateless or 
   stateful address autoconfiguration [iii]. If no router advertisement 
   has been received, a mobile node can send router solicitation to new 
   access router in order to invoke router advertisement [v]. 
    
   Mobile node inspects the MAP option extension included in the router 
   advertisement. First, it checks the value of "Valid lifetime" field. 
   Because DOMAIN option has meaning only to the intermediate routers, 
   mobile node ignores received MAP option if the value is zero. 
    

 
 
Park and Suh             Expires - July 2004                 [Page 8] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
   For MAP options with non-zero "Valid lifetime", if either "Distance" 
   field or "Upward" field of previous MAP has changed, the mobile node 
   determines that it may change MAP. If previous MAP does not exist in 
   the list of MAPs mobile node received, mobile node decides to select 
   new MAP. 
    
   MAP selection procedure of mobile node has three steps.  
   First, mobile node tries to find the MAP located on the highest level. 
   Second, mobile node tries to find the closest MAP if two or more MAPs 
   are selected in the previous step. Last, mobile node selects possible 
   previous MAP or random MAP in the case more than one MAP are selected 
   in the second step. 
    
   To find the MAP located on the highest level, mobile node estimates 
   the level of each Map. The level of MAP can be defined as the 
   difference between "Distance" and "Upward" value as described in the 
   section 2. Mobile node arranges MAPs in descendent order of 
   difference and selects the MAP which has largest difference. 
    
   If two or more MAPs have the largest difference in common, the mobile 
   node arranges these MAPs in ascending order of "Distance". The mobile 
   node selects one has smallest "Distance" value among these MAPs. 
    
   If more than one MAP still remain as candidates after above two steps, 
   mobile node tries to select the previous MAP where it already has 
   local binding. Selecting previous MAP well meets the context of MAP 
   selection because mobile node should be lazy in releasing existing 
   binding [vi]. But, if previous MAP does not exist in the lists of MAPs, 
   mobile node chooses random MAP from remaining candidates. 
   For all of above cases, mobile node must confirm that "Preference" 
   value of selected MAP is not zero. 
    
   After selecting new MAP, mobile node must perform local binding 
   update. If selected MAP is previous one, mobile node must perform 
   local binding update to the previous MAP by using new LCoA and old 
   RCoA. Binding update to neither home agent nor correspondent node is 
   needed when previous MAP is reselected. 
   Otherwise, the mobile node must configure new RCoA by using prefix 
   extracted from the MAP option. Mobile node must perform local binding 
   update to the new MAP by using new LCoA and new RCoA. Upon granting 
   binding acknowledgement, mobile node sends binding update to home 
   agent and to correspondent node respectively. 







 
 
Park and Suh             Expires - July 2004                 [Page 9] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
4 Compatibility Considerations 
    
   The MAP option and addressed in this memo is completely compatible 
   with HMIPv6 mobile node which uses original dynamic MAP discovery and 
   selection.  
   The "Upward" field is the last four bits of fourth octet and these 
   bits are defined as "Reserved" in HMIPv6 [vi]. Other fields have the 
   same meaning and value with those of the MAP option used in dynamic 
   MAP discovery.  
    
   DOMAIN option is not defined to be passed to mobile node. But all 
   zero-valued "Valid lifetime" of DOMAIN option makes mobile node 
   ignore the option when mobile node receives DOMAIN option 
   . 
   When a HMIPv6 mobile node gains a connection to new access router, it 
   will eventually receive the MAP option described in the section 3.1. 
   If the mobile node is not capable of MAP selection described in the 
   section 3.3, it can select the MAP as defined in dynamic MAP 
   discovery and operate with appropriate MAP. 
    
    
    
Security Considerations 
    
   A strong authentication is needed between MAPs and mobile nodes 
   especially when mobile nodes have local bindings to remote MAPs. 
   Detailed security problems will be considered in the next version of 
   this memo. 
    
    
    
References 
    
      
   [i] S. Brandner, "The Internet Standards Process - Revision 3",        
      RFC 2026. 
    
   [ii]  Bradner, S., "Key words for use in RFCs to Indicate Requirement 
      Levels", BCP 14, RFC 2119, March 1997 
    
   [iii] S. Thomson and T. Narten, "IPv6 Stateless Address         
      Autoconfiguration", RFC 2462. 
    
   [iv] T. Narten, E. Nordmark and W. Simpson, "Neighbor Discovery for 
      IP Version 6",RFC 2461. 
    
   [v] D. Johnson, C. Perkins and J. Arkko, "Mobility Support in IPv6", 
      draft-ietf-mobileip-ipv6-24. 
    
 
 
Park and Suh             Expires - July 2004                [Page 10] 
                MAP discovery and selection in HMIPv6    January 2004 
 
 
          
   [vi] H. Soliman, C. Castelluccia, K. El-Malki and L. Bellier, 
      "Hierarchical Mobile IPv6 mobility management", draft-ietf-
      mobileip-hmipv6-08. (work in progress) 
    
    
    
Author's Addresses 
    
   Questions about this memo can be directed to: 
    
   Youngjun Park 
   Samsung Electronics Co., Ltd. 
    
   Dong Suwon P.O.BOX 105 
   416 Maetan-3Dong, Youngtong-Gu, 
   Suwon-City, Gyeonggi-Do, Korea, 442-600 
   Email: youngjun74.park@samsung.com 
    
   Kyungjoo Suh  
   Email: joo.suh@samsung.com 
    



























 
 
Park and Suh             Expires - July 2004                [Page 11] 
