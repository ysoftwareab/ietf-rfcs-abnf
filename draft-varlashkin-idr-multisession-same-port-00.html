<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Multisession BGP extensions
    without new TCP ports</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Multisession BGP extensions
    without new TCP ports">
<meta name="keywords" content="I-D, Internet-Draft, IDR">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">IDR Working Group</td><td class="header">I. Varlashkin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Easynet Global Services</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc4271'>4271</a>, <a href='http://tools.ietf.org/html/rfc4760'>4760</a></td><td class="header">April 09, 2010</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: October 11, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Multisession BGP extensions
    without new TCP ports<br />draft-varlashkin-idr-multisession-same-port-00</h1>

<h3>Abstract</h3>

<p>This document proposes minor backward-compatible changes to BGP for
      enabling multiple sessions to be established between pair of BGP
      speakers for different AFI/SAFI or groups of thereof. It also describes
      mechanism for handling each session in separate process (for information
      only). This memo updates BGP and multiprotocol extensions for BGP-4
      specifications .
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on October 11, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Interoperability with legacy implementations<br />
<a href="#anchor4">4.</a>&nbsp;
Conformance requirement<br />
<a href="#anchor5">5.</a>&nbsp;
Overview of operations<br />
<a href="#anchor6">6.</a>&nbsp;
OPEN message handling<br />
<a href="#anchor7">7.</a>&nbsp;
BGP connection collision handling modification<br />
<a href="#anchor8">8.</a>&nbsp;
AFI/SAFI grouping<br />
<a href="#anchor9">9.</a>&nbsp;
Discussion<br />
<a href="#anchor10">10.</a>&nbsp;
Security considerations<br />
<a href="#anchor11">11.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor12">12.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#session_handover">Appendix&nbsp;A.</a>&nbsp;
Example of session handover<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>There is desire from both network operators and vendors to separate
      exchange of information for different AFI/SAFI into multiple sessions
      between same pair of BGP speakers, particularly to allow various
      AFI/SAFI or groups of thereof to be handled in different system
      processes. Two methods have been already proposed to achieve desired
      functionality as described in <a class='info' href='#I-D.ietf-idr-bgp-multisession'>[I&#8209;D.ietf&#8209;idr&#8209;bgp&#8209;multisession]<span> (</span><span class='info'>Scudder, J. and C. Appanna, &ldquo;Multisession BGP,&rdquo; March&nbsp;2010.</span><span>)</span></a> and <a class='info' href='#I-D.raszuk-ti-bgp'>[I&#8209;D.raszuk&#8209;ti&#8209;bgp]<span> (</span><span class='info'>Raszuk, R. and K. Patel, &ldquo;Transport Instance BGP,&rdquo; March&nbsp;2010.</span><span>)</span></a>. Both of these methods rely on
      introduction of new TCP ports in addition to existing well-known BGP
      port, which is neither desirable from operational prospective nor
      necessary from implementation prospective (at least no sufficient
      evidence has been made available to justify the need).
</p>
<p>This memo describes alternative approach to achieve desired
      functionality without requiring additional TCP ports, and solicits
      discussion from the community in respect to proposed changes.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>In addition to commonly used keywords this memo uses following
      terminology:
</p>
<p></p>
<ol class="text">
<li>Legacy implementation or legacy BGP speaker/peer refers to
          implementation and speaker respectively that implement original BGP
          and multiprotocol extensions specifications, but do not implement
          changes specified in this memo.
</li>
<li>New implementation or new BGP speaker refers to
          implementation/speaker that implements changes specified in this
          memo and not running in compatibility mode.
</li>
<li>Compatibility mode refers to a BGP implementation/speaker that
          behaves as it would be legacy implementation, i.e. it is able to
          support changes specified in this memo but does not use them because
          it either has been administratively configured to do so or has
          detected (through mechanism described later in this memo) that it
          cannot use new features for particular legacy peer.
</li>
<li>If not explicitly mentioned otherwise, BGP speaker refers to new
          BGP speaker from this point on.
</li>
</ol>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Interoperability with legacy implementations</h3>

<p>Mechanisms described in this memo rely on backward-compatible
      modification of Multiprotocol Extensions capability and
      backward-compatible modification of BGP connection collision detection.
      When BGP speaker detects (through information in the OPEN message)
      legacy peer it simply behaves as legacy BGP speaker towards that
      peer.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Conformance requirement</h3>

<p>Implementations conforming to this specification MUST NOT enable
      changes described here by default. They MUST provide configuration
      option to explicitly enable new functionality; the option SHOULD be
      available on per-peer basis. Conforming implementations MUST implement
      both new format of multiprotocol extensions capability code and the new
      procedure for connection collision detection.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Overview of operations</h3>

<p>BGP speaker initiates session using modified multiprotocol extensions
      capability code in OPEN message. If the session is the only session
      between particular pair of BGP speakers (whether new or legacy) both
      sides continue according to legacy specifications.
</p>
<p>If new session comes up when there is already existing session then
      BGP speaker attempts to detect whether peer is new or legacy peer (by
      looking at OPEN message from the peer). If peer is a new implementation
      then BGP speaker continues behaving as new implementation, otherwise it
      reverts to legacy behaviour. After connection collision detection has
      been performed and BGP session established, BGP speaker proceeds
      exchanging BGP messages with the peer similar to legacy
      implementation.
</p>
<p>Once session is established BGP speaker is free to handle it within
      the same process as the one that accepted connection, transfer it to
      another already running process or create a new process and transfer
      session to it. Exact mechanism of such handover is up to implementation
      and is not part of this specification. However if session handover is
      used, then implementation MUST (or SHOULD?) ensure aliveness of the
      process handling particular session and restart session (or process or
      both) if problem detected.
</p>
<p>Note there is no restriction whether initial session setup is
      performed by single multiplexing process or by a process dedicated to
      particular AFI/SAFI or a group of thereof. <a class='info' href='#session_handover'>Appendix&nbsp;A<span> (</span><span class='info'>Example of session handover</span><span>)</span></a> of this memo contains information on
      how session handover could be implemented, but actual implementation MAY
      choose different approach.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
OPEN message handling</h3>

<p>Optional parameter related to multisession: The Capability Value
      field is defined by <a class='info' href='#RFC4760'>[RFC4760]<span> (</span><span class='info'>Bates, T., Chandra, R., Katz, D., and Y. Rekhter, &ldquo;Multiprotocol Extensions for BGP-4,&rdquo; January&nbsp;2007.</span><span>)</span></a> as:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

                     0       7      15      23      31
                     +-------+-------+-------+-------+
                     |      AFI      | Res.  | SAFI  |
                     +-------+-------+-------+-------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure1: Capability Value field&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Currently section 8 of RFC4760 defines Reserved field as:
</p>
<p>Res. - Reserved (8 bit) field. SHOULD be set to 0 by the sender and
      ignored by the receiver. Note that not setting the field value to 0 may
      create issues for a receiver not ignoring the field. In addition, this
      definition is problematic if it is ever attempted to redefine the
      field.
</p>
<p>This document proposes following modification:
</p>
<p>The highest order bit of Reserved field MUST be set to 1 if
      implementation supports multisession. Old implementation is expected to
      ignore value of this field and will set it to zero when sending its own
      OPEN message.
</p>
<p>If multisession-capable router detects that peer has old
      implementation (Reserved field set to zero), then multisession-capable
      router MUST revert to the old behaviour (i.e. single session only) by
      using connection collision detection procedure described in section 6.8
      of <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a>. Note reverting to old behaviour means
      multisession is not possible between given pair of BGP speakers.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
BGP connection collision handling modification</h3>

<p>Modifications described in this section apply only when router
      operates as new implementation towards particular peer, otherwise
      original RFC4271 section 6.8 applies.
</p>
<p>If AFI/SAFI lists of OPEN messages do not overlap new session
      proceeds as another session wouldn't exist at all, i.e. new session is
      established.
</p>
<p>If AFI/SAFI lists of OPEN messages match exactly, original procedure
      from section 6.8 of <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a> MUST be used.
</p>
<p>If AFI/SAFI list of new incoming OPEN message is subset of an
      existing, even in established state, session (i.e. it overlaps but new
      list contains fewer AFI/SAFI), then behaviour is as follows:
</p>
<p>Alternative 1: receiving side drops incoming session and initiates
      new session for those AFI/SAFIs which are found in the just dropped
      session but not in the old one. Receiver of this session (i.e.
      originator of the just collided session) MAY accept this proposal or
      drop it. Receiver SHOULD NOT attempt to send OPEN message with the list
      that has caused original collision (this will cause unnecessary stress).
      As special case this scenario may result in keeping old session and
      blocking new one until operators intervention.
</p>
<p>Alternative 2: Receiving side drops incoming session and sends OPEN
      for combined AFI/SAFI for both existing and just dropped session. If
      originator of just collided session accepts this proposal, existing
      session is dropped but already exchanged prefixes are retained (possibly
      via graceful-restart).
</p>
<p>Alternative 3: Receiving side accepts the proposal, gracefully
      transfers overlapping AFI/SAFI from the old session to the new one
      (using graceful restart mechanism).
</p>
<p>While alternatives 2 and 3 may sound outlandish they in fact may
      become handy when operator needs to regroup AFI/SAFI as they avoid
      outage during the migration.
</p>
<p>If AFI/SAFI list of new incoming OPEN message is superset of an
      existing, even in established state, session (i.e. it overlaps but new
      list contains more AFI/SAFI) and receiving BGP speaker is configured to
      support all involved AFI/SAFI, then behaviour is as follows:
</p>
<p>Receiving side proceeds with new session, then gracefully transfers
      routing information from the old session to the new one and closes old
      connection.
</p>
<p>If AFI/SAFI list of new incoming OPEN message partially overlaps with
      the existing, even in established state, but it's neither subset nor
      superset, then behaviour is as follows:
</p>
<p>Alternative 1: Receiver accepts proposal, gracefully transfers
      overlapping AFI/SAFI from the old session to the new one (possibly via
      graceful-restart).
</p>
<p>Alternative 2: Receiver drops incoming session and instead proposes
      three separate session - first that has AFI/SAFI unique to existing
      session, second with AFI/SAFI overlapping between sessions and third
      with AFI/SAFI unique to just dropped session.
</p>
<p>Alternative 3: Receiver drops incoming session. Originator of just
      dropped session SHOULD NOT make further attempts to establish session
      with the same AFI/SAFI list until operator's intervention.
</p>
<p>DISCUSSION: Choice of alternatives is open for discussion.
      Particularly whether single method should be chosen or a mechanism
      should be introduced as to inform which method is used.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
AFI/SAFI grouping</h3>

<p>This specification does not explicitly define grouping capability.
      However this is not required to produce conforming implementation in
      order to achieve grouping as long as (S)AFI combinations in groups are
      not hardcoded. The grouping capability is implied by virtue of
      specifying more than one AFI/SAFI: if BGP speaker supports and
      configured to group particular set of AFI/SAFI then it simply advertises
      only given AFI/SAFI in OPEN message, and each session advertises
      different set of AFI/SAFI.
</p>
<p>In order to ensure interoperability a BGP implementation SHOULD NOT
      impose particular (S)AFI grouping at coding time, otherwise it SHOULD
      provide at least one-(S)AFI-per-session alternative.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Discussion</h3>

<p>This specification allows implementing per-AFI/SAFI or per-group BGP
      session using different host system processes without introduction of
      new TCP ports.
</p>
<p>Some parts of this specification describe several behaviours. It's a
      request to the community to discuss which of the alternatives should be
      adopted, and whether or not this specification should contain formal
      definition of BGP FSM changes in format used by <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a>.
</p>
<p>This specification relies on availability of a mechanism to pass TCP
      session from one process to another. Many modern operating systems
      provide such functionality. This mechanism may be significantly
      different from system to system, but from protocol prospective they all
      allow achieving desired result. Author of this memo does not rule out
      possibility that a BGP implementation may exist that uses operating
      system without such facilities. In such cases it's believed that BGP
      implementer should work together with operating system implementers to
      organise required functionality, because such approach avoids penalising
      other protocol implementers and users.
</p>
<p>Some network operators or BGP implementers may wish to restrict which
      AFI/SAFI are handled by specific process or how AFI/SAFI are grouped in
      multiple sessions. This specification allows achieving this without
      imposing restriction on protocol itself while permitting
      interoperability between implementations that impose restrictions and an
      implementation without restrictions. However if two implementations
      insist on non-matching grouping of AFI/SAFI then BGP session cannot be
      established. Therefore its recommended that AFI/SAFI grouping is left
      for configuration-time. Request to the community is to review whether
      this poses practical problem and how alternative multisession
      implementations would handle such situation.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security considerations</h3>

<p>The changes proposed in this document do not introduce any new
      security concerns to BGP itself.
</p>
<p>If BGP implementation involves handover of BGP session(s) between
      processes, interprocess communication is subject to security model and
      threats of the host operating system.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>The changes to BGP proposed by this memo do not require any new
      allocations from IANA.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>The author would like to thank Robert Raszuk for valuable comments
      and for help with translation of the document to XML format.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4271">[RFC4271]</a></td>
<td class="author-text">Rekhter, Y., Li, T., and S. Hares, &ldquo;<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>,&rdquo; RFC&nbsp;4271, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4271.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4760">[RFC4760]</a></td>
<td class="author-text">Bates, T., Chandra, R., Katz, D., and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4760">Multiprotocol Extensions for BGP-4</a>,&rdquo; RFC&nbsp;4760, January&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4760.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idr-bgp-multisession">[I-D.ietf-idr-bgp-multisession]</a></td>
<td class="author-text">Scudder, J. and C. Appanna, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idr-bgp-multisession-05.txt">Multisession BGP</a>,&rdquo; draft-ietf-idr-bgp-multisession-05 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idr-bgp-multisession-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.raszuk-ti-bgp">[I-D.raszuk-ti-bgp]</a></td>
<td class="author-text">Raszuk, R. and K. Patel, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-raszuk-ti-bgp-01.txt">Transport Instance BGP</a>,&rdquo; draft-raszuk-ti-bgp-01 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-raszuk-ti-bgp-01.txt">TXT</a>).</td></tr>
</table>

<a name="session_handover"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example of session handover</h3>

<p>When BGP implementation runs on a host operating system that is
      similar to BSD, the session handover can use socket passing technique as
      described by W. Richard Stevens.
</p>
<p>Basic idea is to establish Unix-socket session between process that
      initially accepts or creates TCP connection and the process which will
      actually handle the connection. In respect to BGP implementation
      following approach could be used (though other may exist):
</p>
<p></p>
<ol class="text">
<li>a master process is responsible for obtaining TCP connection with
          a peer (either actively attempting to establish the connection or
          listening for incoming connection on well-known BGP port)
</li>
<li>when TCP connection is established, this master process exchanges
          OPEN messages with the peer and optionally handles connection
          collision detection
</li>
<li>after determining which AFI/SAFI peer would like to exchange over
          this session, the master process sends specially formed message on a
          UNIX socket to target process to initiate socket handover
</li>
<li>when recipient process acknowledged its readiness to take over,
          master process stops handling this BGP session
</li>
<li>(optionally, but highly desirable) master and recipient process
          keep exchanging keep-alive messages over Unix-socket to ensure that
          BGP session is being handled. If recipient process dies or becomes
          malfunctioning master process can take action to revive affected BGP
          session.
</li>
</ol>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ilya Varlashkin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Easynet Global Services</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Harburger Schlossstr. 1</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hamburg,   21079</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ilya.varlashkin@de.easynet.net">ilya.varlashkin@de.easynet.net</a></td></tr>
</table>
</body></html>
