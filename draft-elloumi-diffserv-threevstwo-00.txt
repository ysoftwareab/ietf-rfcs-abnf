Internet Engineering Task Force                             Omar Elloumi
INTERNET DRAFT                                        Stefaan De Cnodder
<draft-elloumi-diffserv-threevstwo-00.txt>                 Kenny Pauwels
                                                                 Alcatel


                                                              July, 1999
                                                   Expires January, 2000

  Usefullness of three drop precedences in Assured Forwarding service


Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.


Abstract

   This informational memo points out advantages of using three drop
   precedences (compared to two) in the Assured Forwarding (AF) Per-
   Hop-Behavior (PHB) when the traffic is composed of responsive TCP and
   non responsive UDP traffic.  Our simulation results show that while
   two drop precedences can, in some cases, guarantee to an aggregate
   consisting of TCP traffic the full utilization of the reserved
   bandwidth, they cannot allow to access the unreserved bandwidth in
   the presence of high bit rate unresponsive UDP traffic. When three
   drop precedences are appropriately used TCP aggregates can fully use
   the minimum reserved bandwidth and share the unreserved one.

1. Introduction



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 1]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   The Assured Forwarding PHB [RFC2597] group is intended to provide
   high probability packets forwarding to traffic not exceeding the
   subscribed profile (in-profile). Users are authorised to exceed the
   subscribed profile, however the excess traffic (out-of-profile) is
   not delivered with a high probability as the in-profile one. The data
   traffic is subject to marking in order to provide a low drop
   probability for in-profile traffic and a higher drop probability for
   out-of-profile one. The AF PHB specifies three drop precedences
   within each of four defined traffic classes. While the use of 3
   levels of drop precedences was mainly proposed to prevent non
   responsive traffic from getting more than its fair share of the non
   reserved bandwidth, several contributions presented simulations where
   the use of only two drop precedences is enough to achieve the
   protection of TCP traffic [Goyal1, Goyal2]. In [Ibanez, Yeom]
   simulation results show that 2 drop precedences are not enough to
   fully utilize the reserved bandwidth. In this memo, we present some
   simulation configurations in which the use of three levels of drop
   precedences can be used to allow TCP traffic to achieve its reserved
   bandwidth.

2. Simulation configuration

   Our simulation configuration is depicted in Figure 2.1. The network
   is composed of 4 pairs of interconnected LANs. Each LAN is attached
   to a customer router (C1-C4, C1'-C4'). Customer routers are connected
   via a 139 Mbps link to the backbone composed of a single bottleneck
   link between the edge routers ER1 and ER2. In LAN1, LAN2 and LAN3
   (connected respectively to C1, C2 and C3) a set of 10 TCP-SACK
   sources are performing infinite file transfer to destinations in
   LAN1', LAN2' and LAN3' (connected respectively to C1', C2' and C3').
   The MSS for TCP is set to 536 Bytes. In LAN4 (connected to C4) a UDP
   source is sending fixed sized packets of 576 Bytes to a UDP
   destination in LAN4' (connected to C4'). The inter packets sending
   time is exponentially distributed. The mean UDP rate varies for the
   different simulations from 0 Mbps up to 60 Mbps. The customer routers
   perform traffic conditioning: packets are marked with the appropriate
   drop precedence according to a certain traffic profile. In order to
   compare the performance of two color and three color markers we use
   the Token Bucket Marker (TBM) allowing two drop precedences and the
   two rate Three Color Marker (trTCM) allowing three drop precedences
   [Heinanen].

   With the TBM, tokens are generated at a constant rate, i.e. the
   Committed Information Rate (CIR), up to a maximum value, i.e the
   Committed Burst Size (CBS). When a packet arrives, the bucket
   occupancy is decremented by the packet size and the packet is marked
   with the drop precedence 0 if enough tokens are available. The packet
   is marked with the drop precedence 1 otherwise. In the latter case



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 2]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   the bucket occupancy is not decremented.

   With the trTCM, two buckets, with sizes CBS and Peak Burst Size
   (PBS), and two generation rates, CIR and Peak Information Rate (PIR),
   are used. Tokens in each bucket are generated at a constant rate: CIR
   and PIR respectively. Two modes of operation can be considered: the
   color blind and the color aware mode. In our simulation we used only
   the color blind mode in which each arriving packet is forwarded with
   the drop precedence 0 if the packet size is less than the first and
   the second bucket occupancy (both buckets are decremented by the
   packet size), with drop precedence 1 if the packet size is more than
   the the first bucket occupancy but less than the the second (the
   second bucket is decremented by the packet size) and finally with
   drop precedence 2 if the packet size is more than the first and the
   second bucket occupancy.

       2.5 ms, 139 Mbps                         2.5 ms, 139 Mbps
        <------------>                           <------------>
   \+---+                                                     +---+/
   -| C1|---------                                   ---------|C1'|-
   /+---+        |   +----------+     +----------+   |        +---+\
   \+---+        |---|          |     |          |---|        +---+/
   -| C2|------      |          |     |          |      ------|C2'|-
   /+---+     |------|          |     |          |------|     +---+\
   \+---+     |------|    ER1   |-----|    ER2   |------|     +---+/
   -| C3|------      |          |     |          |      ------|C3'|-
   /+---+        |---|          |     |          |---|        +---+\
   \+---+        |   +----------+     +----------+   |        +---+/
   -| C4|---------              <----->              ---------|C4'|-
   /+---+                    10 ms, 34 Mbps                   +---+\

   Figure 2.1: Simulation model

   The simulation parameters of the TBM and trTCM are, respectively,
   given in Table 2.1 and Table 2.2.  We configured the simulation
   parameters for the trTCM such that all the excess traffic for TCP
   sources is marked with drop precedence 1 and all the excess traffic
   from the UDP source is marked with drop precedence 2. This is done by
   setting the PIR for customers running TCP sources to a very high
   value (equal to the link rate) and to the CIR for the customer
   running the UDP source.

       Table 2.1: Simulation parameters for TBM
                              Scenario 1      Scenario 2      Scenario 3
       CBS (C1, C2, C3, C4)   5 KB            10 KB           50 KB
       CIR (C1, C2, C3, C4)   2 Mbps          2 Mbps          2 Mbps

       Table 2.2: Simulation parameters for trTCM



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 3]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


                              Scenario 1      Scenario 2      Scenario 3
       CBS (C1, C2, C3, C4)   5 KB            10 KB           50 KB
       PBS (C1, C2, C3, C4)   5 KB            10 KB           50 KB
       CIR (C1, C2, C3, C4)   2 Mbps          2 Mbps          2 Mbps
       PIR (C1, C2, C3)       139 Mbps        139 Mbps        139 Mbps
       PIR (C4)               2 Mbps          2 Mbps          2 Mbps

   Routers ER1 and ER2 implement the RIO algorithm [Clark] that we have
   extended to support three drop precedences instead of two. The
   parameter maxp was set to 0.02, 0.05 and 0.1 for drop precedence 0, 1
   and 2 respectively. The thresholds (minth, maxth) in KB for drop
   precedences 0, 1 and 2 are respectively (45, 90), (90, 180) and (180,
   360). For each drop precedence, i, an average queue length is
   calculated using the current buffer occupancy of all packets with
   drop precedences ranging from 0 to i. As in [Floyd], the weight to
   calculate the average queue length is set to 0.002.

3. Simulation Results

   In this section we present simulation results obtained with 2 and 3
   drop precedences. Tables 3.1, 3.2 and 3.3 give the simulation results
   for Scenario 1, Scenario 2 and Scenario 3, respectively, described in
   Section 2.

   From Tables 3.1, 3.2 and 3.3 we can see that when only two drop
   precedences are used the TCP aggregates are, in most cases, only able
   to consume their reserved bandwidth (i.e. the CIR) and a portion of
   the unreserved bandwidth if the UDP sending rate is less than its CIR
   plus the unreserved bandwidth. For low values of CBS (Table 3.1) TCP
   aggregates are not able to fully utilize the CIR when the UDP sending
   rate exceeds its CIR plus the unreserved bandwidth.

   When 3 drop precedences are used the UDP source is only able to fully
   utilize its CIR. The unreserved bandwidth is fully utilized by TCP
   aggregates. In addition the obtained results do not vary when the CBS
   varies (Tables 3.1, 3.2 and 3.3).

   Table 3.1: Simulation results for Scenario 1.
   ------------------------------------------------------------------
           | with two drop precedences  | with three drop precedences
   UDP rate| Sum(TCP Throu.)| UDP Throu.| Sum(TCP Throu.)| UDP Throu.
   ------------------------------------------------------------------
   0              33.98           -            33.98           -
   5              29.05          4.92          31.96          2.03
   10             24.20          9.90          31.93          2.05
   15             19.34         14.65          31.97          2.02
   20             14.66         19.32          31.94          2.05
   25             10.62         23.31          31.94          2.04



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 4]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   30              7.80         26.11          31.93          2.06
   35              6.34         27.56          31.94          2.04
   40              5.60         28.30          31.93          2.06
   45              5.29         28.61          31.93          2.05
   50              5.22         28.70          31.93          2.04
   55              5.14         28.77          31.92          2.06
   60              5.01         28.91          31.93          2.05

   Table 3.2: Simulation results for Scenario 2.
   ------------------------------------------------------------------
           | with two drop precedences  | with three drop precedences
   UDP rate| Sum(TCP Throu.)| UDP Throu.| Sum(TCP Throu.)| UDP Throu.
   ------------------------------------------------------------------
   0              33.98           -            33.98           -
   5              29.06          4.91          31.95          2.03
   10             24.18          9.79          31.95          2.03
   15             19.29         14.68          31.95          2.03
   20             14.71         19.32          31.93          2.05
   25             10.60         23.38          31.95          2.03
   30              7.96         25.94          31.90          2.07
   35              6.81         27.08          31.94          2.04
   40              6.36         27.53          31.94          2.04
   45              6.15         27.74          31.95          2.02
   50              5.97         27.92          31.91          2.06
   55              5.87         28.01          31.90          2.08
   60              5.78         28.50          31.93          2.05

   Table 3.3: Simulation results for Scenario 3.
   ------------------------------------------------------------------
           | with two drop precedences  | with three drop precedences
   UDP rate| Sum(TCP Throu.)| UDP Throu.| Sum(TCP Throu.)| UDP Throu.
   ------------------------------------------------------------------
   0              33.98           -            33.98           -
   5              29.03          4.97          31.97          2.04
   10             24.15          9.85          31.94          2.05
   15             19.33         14.67          31.97          2.04
   20             14.69         19.31          31.95          2.06
   25             10.52         23.43          31.97          2.04
   30              7.89         26.05          31.94          2.07
   35              6.90         27.02          31.95          2.06
   40              6.52         27.40          31.93          2.05
   45              6.29         27.61          31.93          2.07
   50              6.25         27.66          31.91          2.09
   55              6.19         27.71          31.92          2.09
   60              6.08         27.80          31.91          2.09


4. Simulations with large RTT and large CIR



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 5]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   In this paragraph we study the effect of having a large RTT (large
   propagation delay) and a large value for the CIR. The simulation
   model studied is similar to the one presented in paragraph 2. The
   only diffrences are: the propagation delay of the link between
   customer 2 and ER1 is set to 100 ms instead of 2.5 ms and customer 3
   has a CIR of 20 Mbps instead of 2 Mbps. The UDP source is sending
   fixed sized packets of 576 Bytes with an inter packet sending time
   exponentially distributed. The mean rate is set to 25 Mbps for all
   simulations. We performed 5 sets of simulations with the following
   CBS values: 5, 10, 50, 100, 500 KB. The simulation parameters are
   summarized in Table 4.1. The remaining parameters are set as in
   section 2. We also performed simulations with the Rate Adaptive
   Shaper (RAS) [Bonaventure] which is combined with the TBM and the
   trTCM. The RAS is used in front of the marker and aims at increasing
   the number of low drop precedence packets by reducing the burstiness
   of the traffic.

   Tables 4.2, 4.3, 4.4 and 4.5 give the simulation results.

   From Table 4.2 we can see that with only two drop precedences
   customer 3 is never (for the used values of CBS) able to use its
   reserved bandwidth (i.e. CIR). Customer 2 succeeds to use its CIR for
   high values of the CBS (50, 100, 500 KB).

   When 2 drop precedences are used in combination with the RAS (see
   Table 4.3) mostly all customers, except customer 3 when the CBS is
   too small, can fully utilize their CIR. The use of the shaper allows
   the customers to obtain an aggregate throughput close to the CIR but
   the unreserved bandwidth is mostly utilized by the UDP source.

   When 3 drop precedences are used (see Table 4.4) it appears clearly
   that all customers obtain an aggregate throughput which is higher
   than the CIR. The unreserved bandwidth is mostly used by the TCP
   aggregates. In addition the obtained aggregate throughput do not vary
   a lot when the CBS vary.

   Finally the use of three drop precedences combined with the RAS gives
   results very close to ones obtained without the RAS for this
   configuration.

   From this set of simulations we have shown the following properties:

   - The use of 2 drop precedences do not allow, in the presence of UDP
   traffic, the TCP aggregates to utilize the unreserved bandwidth which
   is mostly consumed by the UDP source.  TCP aggregates can fully
   utilize their CIR when the appropriate CBS values are used. The use
   of the RAS can help TCP aggregates to utilize their CIR much better
   but not the unreserved bandwidth.



Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 6]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   - The use of 3 drop precedences allows the TCP aggregates to share
   the unreserved bandwidth. In addition the obtained throughput does
   not vary a lot with CBS variations.

   Table 4.1: Simulation parameters
   customer 1: CIR of 2 Mbps
   customer 2: CIR of 2 Mbps, large RTT
   customer 3: CIR of 20 Mbps
   customer 4: CIR of 2 Mbps, UDP of 25 Mbps
   CBS       : 5, 10, 50, 100, 500 KB

   Table 4.2: Simulation results with 2 drop precedences
   CBS     customer 1  customer 2  customer 3  customer 4
   5         2.39        1.65        13.59       16.35
   10        2.36        1.86        14.05       15.71
   50        2.21        2.00        18.42       11.35
   100       2.21        2.02        18.53       11.22
   500       2.26        2.12        19.41       10.20

   Table 4.3: Simulation results with 2 drop precedences - shaper
   CBS     customer 1  customer 2  customer 3  customer 4
   5         2.09        1.99        19.07       10.84
   10        2.08        1.99        19.32       10.59
   50        2.05        1.99        19.83       10.11
   100       2.10        1.99        19.80       10.08
   500       2.05        1.99        19.83       10.11

   Table 4.4: Simulation results with 3 drop precedences
   CBS     customer 1  customer 2  customer 3  customer 4
   5         6.80        2.98        21.96       2.23
   10        6.65        2.96        22.22       2.15
   50        6.54        3.03        22.14       2.28
   100       6.36        3.05        22.23       2.34
   500       6.37        2.97        22.46       2.19

   Table 4.5: Simulation results with 3 drop precedences - shaper
   CBS     customer 1  customer 2  customer 3  customer 4
   5         6.64        3.36        21.72       2.26
   10        6.01        3.56        22.19       2.23
   50        6.03        3.54        22.15       2.26
   100       6.23        3.40        22.12       2.23
   500       5.89        3.64        22.18       2.27

5. Conclusion

   Simulation results presented in this memo can be summarized as
   follows:




Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 7]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


   - When only two drop precedences are used TCP aggregates can, in most
   cases, fully use their reserved bandwidth if the markers' parameters
   are appropriately set (CBS value). However the unreserved bandwidth
   is mostly used by UDP sources.

   - The use of three drop precedences allows the TCP aggregates to
   fully use their reserved bandwidth and to share the unreserved one.
   In addition the obtained throughputs do not vary a lot with the
   variations of the CBS parameter. However the unreserved bandwidth is
   not fairly distributed among the TCP aggregates.

6. References


[Bonaventure]
        O.Bonaventure, S. De Cnodder, A rate adaptive shaper for dif-
        ferentiated services. Internet draft, IETF, draft-bonaventure-
        diffserv-rashaper-00.txt. Work in progress.


[Clark] D. D. Clark, W. Fang, Explicit Allocation of Best-Effort Packet
        Delivery Service. IEEE/ACM Trans. on Networking, Vol. 6, No. 4,
        August 1998.


[Floyd] S. Floyd, V. Jacobson, Random Early Detection Gateways for
        Congestion Avoidance. IEEE/ACM Transactions on Networking,
        August 1993.


[Ibanez]J. Ibanez, K. Nichols, Preliminary Simulation Evaluation of an
        Assured Service. Internet draft, IETF, draft-ibanez-diffserv-
        assured-eval-00.txt. Work in progress.


[Goyal1]M. Goyal, P. Misra, R. Jain, Effect of Number of Drop Pre-
        cedences in Assured Forwarding. Internet draft, IETF, draft-
        goyal-dpsty-diffserv-00.txt. Work in progress.


[Goyal2]M. Goyal, P. Misra, R. Jain, Effect of number of drop pre-
        cedences in Assured Forwarding. Available from
        http://www.cis.ohio-state.edu/~
        jain/papers/dpstdy_globecom99.htm


[Heinanen]
        J. Heinanen, and R. Guerin, A Two Rate Three Color Marker.



Elloumi, De Cnodder, Pauwels Drop precedences in AF             [Page 8]


Internet Draft  draft-elloumi-diffserv-threevstwo-00.txt       June 1999


        Internet draft, IETF, draft-heinanen-diffserv-trtcm-01.txt.
        Work in progress.


[RFC2597]J. Heinanen, F. Baker, W. Weiss, J. Wrockawski, Assured For-
        warding PHB Group. RFC 2597, June 1999.


[Yeom]  I. Yeom, A. L. N. Reddy, Realizing throughput guarantees in a
        differentiated services network. IEEE ICMCS'99, June 1999.

Acknowledgments

        The authors would like to thank Jordi Nelissen for several dis-
        cussions.

Authors' Addresses

   Omar Elloumi
   Alcatel Corporate Research Center
   Fr. Wellesplein 1, B-2018 Antwerpen, Belgium.
   Phone : 32-3-240-7833
   Fax   : 32-3-240-9932
   E-mail: Omar.Elloumi@alcatel.be

   Stefaan De Cnodder
   Alcatel Corporate Research Center
   Fr. Wellesplein 1, B-2018 Antwerpen, Belgium.
   Phone : 32-3-240-8515
   Fax   : 32-3-240-9932
   E-mail: stefaan.de_cnodder@alcatel.be

   Kenny Pauwels
   Alcatel Corporate Research Center
   Fr. Wellesplein 1, B-2018 Antwerpen, Belgium.
   Phone : 32-3-241-5941
   Fax   : 32-3-240-9932
   E-mail: kenny.pauwels@alcatel.be













Elloumi, De Cnodder, Pauwels     Drop precedences in AF         [Page 9]


