<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 Flow Label Specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 Flow Label Specification">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">6MAN</td><td class="header">S. Amante</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Level 3</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc3697'>3697</a> (if&nbsp;approved)</td><td class="header">B. Carpenter</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc2205'>2205</a>, <a href='http://tools.ietf.org/html/rfc2460'>2460</a></td><td class="header">Univ. of Auckland</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">S. Jiang</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Huawei Technologies Co., Ltd</td></tr>
<tr><td class="header">Expires: August 4, 2011</td><td class="header">J. Rajahalme</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia-Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 31, 2011</td></tr>
</table></td></tr></table>
<h1><br />IPv6 Flow Label Specification<br />draft-ietf-6man-flow-3697bis-00</h1>

<h3>Abstract</h3>

<p>This document specifies the IPv6 Flow Label field and the minimum
   requirements for IPv6 nodes labeling flows, IPv6 nodes
   forwarding labeled packets, and flow state establishment methods.
   Even when mentioned as examples of possible uses of the flow
   labeling, more detailed requirements for specific use cases are out
   of scope for this document.

</p>
<p>The usage of the Flow Label field enables efficient IPv6 flow
   classification based only on IPv6 main header fields in fixed
   positions.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on August 4, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#spec">2.</a>&nbsp;
IPv6 Flow Label Specification<br />
<a href="#labreq">3.</a>&nbsp;
Flow Labeling Requirements<br />
<a href="#estreq">4.</a>&nbsp;
Flow State Establishment Requirements<br />
<a href="#anchor1">5.</a>&nbsp;
Essential correction to RFC 2205<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#theft">6.1.</a>&nbsp;
Theft and Denial of Service<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ipsec">6.2.</a>&nbsp;
IPsec and Tunneling Interactions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">6.3.</a>&nbsp;
Security Filtering Interactions<br />
<a href="#iana">7.</a>&nbsp;
IANA Considerations<br />
<a href="#ack">8.</a>&nbsp;
Acknowledgements<br />
<a href="#changes">9.</a>&nbsp;
Change log<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>A flow is a sequence of packets sent from a particular source to a
   particular unicast, anycast, or multicast destination that a node
   desires to label as a flow.  A flow could consist of all packets in a
   specific transport connection or a media stream.  However, a flow is
   not necessarily 1:1 mapped to a transport connection. 
</p>
<p>Traditionally, flow classifiers have been based on the 5-tuple of the
   source and destination addresses, ports, and the transport protocol
   type.  However, some of these fields may be unavailable due to either
   fragmentation or encryption, or locating them past a chain of IPv6
   extension headers may be inefficient.  Additionally, if classifiers
   depend only on IP layer headers, later introduction of alternative
   transport layer protocols will be easier. 
</p>
<p>The usage of the 3-tuple of the Flow Label and the Source and
   Destination Address fields enables efficient IPv6 flow
   classification, where only IPv6 main header fields in fixed positions
   are used. 
</p>
<p>The minimum level of IPv6 flow support consists of labeling the
   flows. A specific goal is to enable and encourage the use of the
   flow label for various forms of stateless load distribution, especially across
   Equal Cost Multi-Path (EMCP) and/or Link Aggregation Group (LAG) paths.
   ECMP and LAG are methods to bond together multiple physical links used to 
   procure the required capacity necessary to carry an offered load
   greater than the bandwidth of an individual physical link.     
   IPv6 source nodes SHOULD be able
   to label known flows (e.g., TCP connections, application streams),
   even if the node itself does not require any flow-specific
   treatment.  Node requirements for flow
   labeling are given in <a class='info' href='#labreq'>Section&nbsp;3<span> (</span><span class='info'>Flow Labeling Requirements</span><span>)</span></a>. 
</p>
<p>The flow label can be used most simply in stateless models, but stateful
   mechanisms are also possible. Specific flow state establishment methods
   and the related service models are out of scope for this specification,
   but the generic requirements enabling co-existence of different methods in
   IPv6 nodes are set forth in <a class='info' href='#estreq'>Section&nbsp;4<span> (</span><span class='info'>Flow State Establishment Requirements</span><span>)</span></a>.  The associated
   scaling characteristics (such as nodes involved in state establishment,
   amount of state maintained by them, and state growth function) will be specific to
   particular service models. 
</p>
<p>This document replaces <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a> and Appendix A of <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>. 
A rationale for the changes made is documented in <a class='info' href='#I-D.ietf-6man-flow-update'>[I&#8209;D.ietf&#8209;6man&#8209;flow&#8209;update]<span> (</span><span class='info'>Amante, S., Carpenter, B., and S. Jiang, &ldquo;Rationale for update to the IPv6 flow label specification,&rdquo; January&nbsp;2011.</span><span>)</span></a>.
The present document also includes
a correction to <a class='info' href='#RFC2205'>[RFC2205]<span> (</span><span class='info'>Braden, B., Zhang, L., Berson, S., Herzog, S., and S. Jamin, &ldquo;Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification,&rdquo; September&nbsp;1997.</span><span>)</span></a> concerning the flow label.
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="spec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
IPv6 Flow Label Specification</h3>

<p>The 20-bit Flow Label field in the IPv6 header <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> is used by a
   node to label packets of a flow.  A Flow Label of zero is used to
   indicate packets not part of any flow.  Packet classifiers can use the
   triplet of Flow Label, Source Address, and Destination Address fields
   to identify which flow a particular packet belongs to.  Packets are
   processed in a flow-specific manner by nodes that are able to do so in a
   stateless manner, or that have been set up with flow-specific state.
   The nature of the specific treatment and the methods for flow state establishment
   are out of scope for this specification. 
</p>
<p>Once set to a non-zero value, the Flow Label MUST be delivered unchanged to
   the destination node(s). A forwarding node MUST NOT change the flow label value in an arriving packet if
   it is non-zero. However, there are two qualifications to this rule: 

 
 </p>
<ol class="text">
<li>Implementers are advised that forwarding nodes, especially those acting as domain border devices,
 might nevertheless be configured to change the flow label value in packets (e.g., to a new pseudo-random
 value). This is undetectable, unless  some future version of 
 IPsec authentication <a class='info' href='#RFC4302'>[RFC4302]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> protects the flow label value. 
</li>
<li>To enable stateless load distribution at any point in the Internet, a network domain MUST NOT forward packets
outside the domain whose flow label values are other than zero or pseudo-random. 
Neither domain border egress routers nor intermediate routers/devices (using a flow-label, for example, as a part of an input-key for a load-distribution hash) can determine by inspection that a value is not pseudo-random.  Therefore, if nodes within a domain ignore the above recommendations to set zero or pseudo-random flow label values, and such packets are forwarded outside the domain, this would likely result in undesirable operational implications (e.g., congestion, reordering) for not only the inappropriately flow-labelled packets, but also well-behaved flow-labelled packets, during forwarding at various intermediate devices. Thus, a domain must protect its peers by never exporting inappropriately labelled packets. This document does not specify the method for enforcing this rule.
The suggested way to enforce it is that nodes within a domain MUST NOT set the flow label to a non-zero and non-pseudo-random number if the packet will leave the domain. If this is not known to be the case, the border router will need to change outgoing flow labels. 
</li>
</ol><p>
 

</p>
<p> There is no way to verify whether a flow label has been modified en route.
Therefore, no Internet-wide mechanism can depend mathematically on immutable
flow labels; they have a "best effort" quality. This leads to the following formal rules:
</p>
<p>IPv6 nodes MUST NOT assume that the Flow Label value in a incoming packet
is identical to the value set by the source node. 
</p>
<p>Forwarding nodes such as routers and load balancers MUST NOT depend only on Flow Label
values being randomly distributed. In any usage such as a hash key for load distribution,
the Flow Label bits MUST be combined with bits from other sources within the packet,
so as to produce a constant hash value for each flow and a suitable distribution of hash
values across flows. 
</p>
<p> Although a pseudo-random flow
label is recommended, and will always be helpful for load balancing, it is unsafe to assume
its presence in the general case, and the use case needs to work even if the flow label
value is zero. 
</p>
<p>Nodes keeping dynamic flow state MUST NOT assume packets arriving 120
   seconds or more after the previous packet of a flow still belong to
   the same flow, unless a flow state establishment method in use
   defines a longer flow state lifetime or the flow state has been
   explicitly refreshed within the lifetime duration. 
</p>
<p>The use of the Flow Label field does not necessarily signal any
   requirement on packet reordering.  Especially, the zero label does
   not imply that significant reordering is acceptable. 
</p>
<p>An IPv6 node that does not set or make use of the flow label MUST
   ignore it when receiving or forwarding a packet. 
</p>
<a name="labreq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Flow Labeling Requirements</h3>

<p>To enable Flow Label based classification, source nodes SHOULD assign
   each unrelated transport connection and application data stream to a
   new flow. It is RECOMMENDED that source hosts support the flow label by 
   setting the flow label field for all packets of a flow to the same pseudo-random value. 
   Both stateful and stateless methods of assigning a pseudo-random value could be used,
   but it is outside the scope of this specification to mandate an algorithm.  
</p>
<p>An OPTIONAL algorithm for generating such a pseudo-random value is
   described in <a class='info' href='#I-D.gont-6man-flowlabel-security'>[I&#8209;D.gont&#8209;6man&#8209;flowlabel&#8209;security]<span> (</span><span class='info'>Gont, F., &ldquo;Security Assessment of the IPv6 Flow Label,&rdquo; November&nbsp;2010.</span><span>)</span></a>. 
</p>
<p>[[ QUESTION TO WG: Should we incorporate that algorithm here, or leave it as a separate draft? ]]
</p>
<p>A source node which does not otherwise set the flow label
   MUST set its value to zero. 
</p>
<p>A node that forwards a flow whose flow label value in arriving packets is zero
MAY set the flow label value. In that case, it is RECOMMENDED 
that the forwarding node sets the flow label field for a flow to a pseudo-random value. 
</p>
<ul class="text">
<li>The same considerations apply as to source hosts setting the flow label. 
</li>
<li>This option, if implemented, would presumably be used by first-hop or ingress routers. It might place a
 considerable per-packet processing load on them, even if they adopted a stateless method of 
 flow identification and label assignment. This is why the principal recommendation is that 
 the source host should set the label.
 
</li>
</ul>
<p>The preceding rules taken together allow a given network domain to
include routers that set flow labels on behalf of hosts that do not do so.
They also recommend that flow labels exported
to the Internet are always either zero or pseudo-random. 
</p>
<p>The node that sets the flow label MAY also take part in flow state
   establishment methods that result in assigning certain packets to
   specific flows.  
</p>
<p>To enable applications and transport protocols to define what packets
   constitute a flow, the source node MUST provide means for the
   applications and transport protocols to specify the Flow Label values
   to be used with their flows.  The use of the means to specify Flow
   Label values is subject to appropriate privileges (see <a class='info' href='#theft'>Section&nbsp;6.1<span> (</span><span class='info'>Theft and Denial of Service</span><span>)</span></a>).
   The source node SHOULD be able to select unused Flow Label values for
   flows not requesting a specific value to be used. 
</p>
<p>[[ QUESTION TO WG: Should we reduce this whole paragraph to a MAY? ]]
</p>
<p>A source node MUST ensure that it does not unintentionally reuse Flow
   Label values it is currently using or has recently used when creating
   new flows.  Flow Label values previously used with a specific pair of
   source and destination addresses MUST NOT be assigned to new flows
   with the same address pair within 120 seconds of the termination of
   the previous flow.  The source node SHOULD provide the means for the
   applications and transport protocols to specify quarantine periods
   longer than the default 120 seconds for individual flows. 
</p>
<p>To avoid accidental Flow Label value reuse, the source node SHOULD
   select new Flow Label values in a well-defined way
   and use an initial value that avoids
   reuse of recently used Flow Label values each time the system
   restarts.  The initial value SHOULD be derived from a previous value
   stored in non-volatile memory, or in the absence of such history, a
   randomly generated initial value using techniques that produce good
   randomness properties SHOULD be used <a class='info' href='#I-D.gont-6man-flowlabel-security'>[I&#8209;D.gont&#8209;6man&#8209;flowlabel&#8209;security]<span> (</span><span class='info'>Gont, F., &ldquo;Security Assessment of the IPv6 Flow Label,&rdquo; November&nbsp;2010.</span><span>)</span></a>. 
</p>
<a name="estreq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Flow State Establishment Requirements</h3>

<p>To enable stateful flow-specific treatment, flow state needs to be established
   on all or a subset of the IPv6 nodes on the path from the source to
   the destination(s).  The methods for the state establishment, as well
   as the models for flow-specific treatment will be defined in separate
   specifications. 
</p>
<p>To enable co-existence of different methods in IPv6 nodes, the
   methods MUST meet the following basic requirements: 
</p>
<ol class="text">
<li>  The method MUST provide the means for flow state clean-up from
        the IPv6 nodes providing the flow-specific treatment.  Signaling
        based methods where the source node is involved are free to
        specify flow state lifetimes longer than the default 120
        seconds. 
</li>
<li>  Flow state establishment methods MUST be able to recover from
        the case where the requested flow state cannot be supported.  
</li>
</ol>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Essential correction to RFC 2205</h3>

<p><a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> reduced the size of the flow label field from 24 to 20 bits.
The references to a 24 bit flow label field on pages 87 and 88 of <a class='info' href='#RFC2205'>[RFC2205]<span> (</span><span class='info'>Braden, B., Zhang, L., Berson, S., Herzog, S., and S. Jamin, &ldquo;Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification,&rdquo; September&nbsp;1997.</span><span>)</span></a> are updated accordingly. 
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>This section considers security issues raised by the use of the Flow
   Label, primarily the potential for denial-of-service attacks, and the
   related potential for theft of service by unauthorized traffic
   (<a class='info' href='#theft'>Section&nbsp;6.1<span> (</span><span class='info'>Theft and Denial of Service</span><span>)</span></a>).  <a class='info' href='#ipsec'>Section&nbsp;6.2<span> (</span><span class='info'>IPsec and Tunneling Interactions</span><span>)</span></a> addresses the use of the Flow Label in
   the presence of IPsec including its interaction with IPsec tunnel
   mode and other tunneling protocols.  We also note that inspection of
   unencrypted Flow Labels may allow some forms of traffic analysis by
   revealing some structure of the underlying communications.  Even if
   the flow label were encrypted, its presence as a constant value in a
   fixed position might assist traffic analysis and cryptoanalysis. 
</p>
<p>The flow label is not protected in any way and can be forged by an on-path
attacker.  On the other hand, a pseudo-random flow label cannot be readily
guessed by an off-path attacker; see 
<a class='info' href='#I-D.gont-6man-flowlabel-security'>[I&#8209;D.gont&#8209;6man&#8209;flowlabel&#8209;security]<span> (</span><span class='info'>Gont, F., &ldquo;Security Assessment of the IPv6 Flow Label,&rdquo; November&nbsp;2010.</span><span>)</span></a> for further discussion. 
</p>
<a name="theft"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Theft and Denial of Service</h3>

<p>Since the mapping of network traffic to flow-specific treatment is
   triggered by the IP addresses and Flow Label value of the IPv6
   header, an adversary may be able to obtain better service by
   modifying the IPv6 header or by injecting packets with false
   addresses and/or labels.  Taken to its limits, such theft-of-service
   becomes a denial-of-service attack when the modified or injected
   traffic depletes the resources available to forward it and other
   traffic streams.  A curiosity is that if a DoS attack were undertaken
   against a given Flow Label (or set of Flow Labels), then traffic
   containing an affected Flow Label might well experience worse-than-
   best-effort network performance. 
</p>
<p>Note that since the treatment of IP headers by nodes is typically
   unverified, there is no guarantee that flow labels sent by a node are
   set according to the recommendations in this document.  Therefore,
   any assumptions made by the network about header fields such as flow
   labels should be limited to the extent that the upstream nodes are
   explicitly trusted. 
</p>
<p>Since flows are identified by the 3-tuple of the Flow Label and the
   Source and Destination Address, the risk of theft or denial of
   service introduced by the Flow Label is closely related to the risk
   of theft or denial of service by address spoofing.  An adversary who
   is in a position to forge an address is also likely to be able to
   forge a label, and vice versa. 
</p>
<p>There are two issues with different properties: Spoofing of the Flow
   Label only, and spoofing of the whole 3-tuple, including Source and
   Destination Address. 
</p>
<p>The former can be done inside a node which is using or transmitting
   the correct source address.  The ability to spoof a Flow Label
   typically implies being in a position to also forge an address, but
   in many cases, spoofing an address may not be interesting to the
   spoofer, especially if the spoofer's goal is theft of service, rather
   than denial of service. 
</p>
<p>The latter can be done by a host which is not subject to ingress
   filtering <a class='info' href='#RFC2827'>[RFC2827]<span> (</span><span class='info'>Ferguson, P. and D. Senie, &ldquo;Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing,&rdquo; May&nbsp;2000.</span><span>)</span></a> or by an intermediate router.  Due to its
   properties, such is typically useful only for denial of service.  In
   the absence of ingress filtering, almost any third party could
   instigate such an attack. 
</p>
<p>In the presence of ingress filtering, forging a non-zero Flow Label
   on packets that originated with a zero label, or modifying or
   clearing a label, could only occur if an intermediate system such as
   a router was compromised, or through some other form of man-in-the-
   middle attack.  However, the risk is limited to traffic receiving
   better or worse quality of service than intended.  For example, if
   Flow Labels are altered or cleared at random, flow classification
   will no longer happen as intended, and the altered packets will
   receive default treatment.  If a complete 3-tuple is forged, the
   altered packets will be classified into the forged flow and will
   receive the corresponding quality of service; this will create a
   denial of service attack subtly different from one where only the
   addresses are forged.  Because it is limited to a single flow
   definition, e.g., to a limited amount of bandwidth, such an attack
   will be more specific and at a finer granularity than a normal
   address-spoofing attack. 
</p>
<p>Since flows are identified by the complete 3-tuple, ingress filtering
   <a class='info' href='#RFC2827'>[RFC2827]<span> (</span><span class='info'>Ferguson, P. and D. Senie, &ldquo;Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing,&rdquo; May&nbsp;2000.</span><span>)</span></a> will, as noted above, mitigate part of the risk.  If the
   source address of a packet is validated by ingress filtering, there
   can be a degree of trust that the packet has not transited a
   compromised router, to the extent that ISP infrastructure may be
   trusted.  However, this gives no assurance that another form of man-
   in-the-middle attack has not occurred. 
</p>
<p>Only applications with an appropriate privilege in a sending host
   will be entitled to set a non-zero Flow Label.  Mechanisms for this
   are operating system dependent.  Related policy and authorization
   mechanisms may also be required; for example, in a multi-user host,
   only some users may be entitled to set the Flow Label.  Such
   authorization issues are outside the scope of this specification. 
</p>
<a name="ipsec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
IPsec and Tunneling Interactions</h3>

<p>The IPsec protocol, as defined in <a class='info' href='#RFC4301'>[RFC4301]<span> (</span><span class='info'>Kent, S. and K. Seo, &ldquo;Security Architecture for the Internet Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#RFC4302'>[RFC4302]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a>,
   <a class='info' href='#RFC4303'>[RFC4303]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a> does not include
   the IPv6 header's Flow Label in any of its cryptographic calculations
   (in the case of tunnel mode, it is the outer IPv6 header's Flow Label
   that is not included).  Hence modification of the Flow Label by a
   network node has no effect on IPsec end-to-end security, because it
   cannot cause any IPsec integrity check to fail.  As a consequence,
   IPsec does not provide any defense against an adversary's
   modification of the Flow Label (i.e., a man-in-the-middle attack). 
</p>
<p>IPsec tunnel mode provides security for the encapsulated IP header's
   Flow Label.  A tunnel mode IPsec packet contains two IP headers: an
   outer header supplied by the tunnel ingress node and an encapsulated
   inner header supplied by the original source of the packet.  When an
   IPsec tunnel is passing through nodes performing flow classification,
   the intermediate network nodes operate on the Flow Label in the outer
   header.  At the tunnel egress node, IPsec processing includes
   removing the outer header and forwarding the packet (if required)
   using the inner header.  The IPsec protocol requires that the inner
   header's Flow Label not be changed by this decapsulation processing
   to ensure that modifications to label cannot be used to launch theft-
   or denial-of-service attacks across an IPsec tunnel endpoint.  This
   document makes no change to that requirement; indeed it forbids
   changes to the Flow Label. 
</p>
<p>When IPsec tunnel egress decapsulation processing includes a
   sufficiently strong cryptographic integrity check of the encapsulated
   packet (where sufficiency is determined by local security policy),
   the tunnel egress node can safely assume that the Flow Label in the
   inner header has the same value as it had at the tunnel ingress node. 
</p>
<p>This analysis and its implications apply to any tunneling protocol
   that performs integrity checks.  Of course, any Flow Label set in an
   encapsulating IPv6 header is subject to the risks described in the
   previous section. 
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Security Filtering Interactions</h3>

<p>The Flow Label does nothing to eliminate the need for packet
   filtering based on headers past the IP header, if such filtering is
   deemed necessary for security reasons on nodes such as firewalls or
   filtering routers. 
</p>
<p>However, security devices that clear or rewrite non-zero flow label values would
be in violation of this specification. 
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This document requests no action by IANA. 
</p>
<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>Steve Deering and Alex Conta were co-authors of RFC 3697, on which this document is based. 
</p>
<p>
Valuable comments and contributions were made by
Fred Baker,
Steve Blake,
Remi Despres,
Alan Ford,
Fernando Gont,
Brian Haberman,
Tony Hain,
Joel Halpern,
Qinwen Hu,
Chris Morrow,
Thomas Narten,
Mark Smith,
Pascal Thubert,
Iljitsch van Beijnum,
and other participants in the 6man working group.
</p>
<p>Contributors to the development of RFC 3697 included
   Ran Atkinson, Steve Blake, Jim Bound, Francis Dupont,
   Robert Elz, Tony Hain, Robert Hancock, Bob Hinden, Christian Huitema,
   Frank Kastenholz, Thomas Narten, Charles Perkins, Pekka Savola,
   Hesham Soliman, Michael Thomas, Margaret Wasserman, and Alex Zinin. 
</p>
<p>This document was produced using the xml2rfc tool
<a class='info' href='#RFC2629'>[RFC2629]<span> (</span><span class='info'>Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<a name="changes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Change log</h3>

<p>draft-ietf-6man-flow-3697bis-00: original version, built from RFC3697 and draft-ietf-6man-flow-update-01, 2011-01-31
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.gont-6man-flowlabel-security">[I-D.gont-6man-flowlabel-security]</a></td>
<td class="author-text">Gont, F., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-gont-6man-flowlabel-security-01.txt">Security Assessment of the IPv6 Flow Label</a>,&rdquo; draft-gont-6man-flowlabel-security-01 (work in progress), November&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-gont-6man-flowlabel-security-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2205">[RFC2205]</a></td>
<td class="author-text"><a href="mailto:Braden@ISI.EDU">Braden, B.</a>, <a href="mailto:lixia@cs.ucla.edu">Zhang, L.</a>, <a href="mailto:Berson@ISI.EDU">Berson, S.</a>, <a href="mailto:Herzog@WATSON.IBM.COM">Herzog, S.</a>, and <a href="mailto:jamin@EECS.UMICH.EDU">S. Jamin</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2205">Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</a>,&rdquo; RFC&nbsp;2205, September&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2205.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2205.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2205.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-6man-flow-update">[I-D.ietf-6man-flow-update]</a></td>
<td class="author-text">Amante, S., Carpenter, B., and S. Jiang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-6man-flow-update-02.txt">Rationale for update to the IPv6 flow label specification</a>,&rdquo; draft-ietf-6man-flow-update-02 (work in progress), January&nbsp;2011 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-6man-flow-update-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2629">[RFC2629]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2629.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2629.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2629.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2827">[RFC2827]</a></td>
<td class="author-text">Ferguson, P. and D. Senie, &ldquo;<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>,&rdquo; BCP&nbsp;38, RFC&nbsp;2827, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2827.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3697">[RFC3697]</a></td>
<td class="author-text">Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3697">IPv6 Flow Label Specification</a>,&rdquo; RFC&nbsp;3697, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3697.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4301">[RFC4301]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4301.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[RFC4302]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4302.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[RFC4303]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shane Amante</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Level 3 Communications, LLC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1025 Eldorado Blvd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Broomfield, CO  80021</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:shane@level3.net">shane@level3.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Carpenter</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Auckland</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PB 92019</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Auckland,   1142</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New Zealand</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian.e.carpenter@gmail.com">brian.e.carpenter@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sheng Jiang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies Co., Ltd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Building, No.3 Xinxi Rd.,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shang-Di Information Industry Base, Hai-Dian District, Beijing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R. China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:shengjiang@huawei.com">shengjiang@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jarno Rajahalme</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia-Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TBD</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TBD</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jarno.rajahalme@nsn.com">jarno.rajahalme@nsn.com</a></td></tr>
</table>
</body></html>
