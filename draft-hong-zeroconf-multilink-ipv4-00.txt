





INTERNET DRAFT                                            Yong-Geun Hong
Expires: May 2002                                           Yong-Jin Kim
                                                                    ETRI
                                                           Min-Tae Hwang
                                                    Changwon Nat'l Univ.    
                                                           November 2001


     Autoconfiguration of IPv4 Link-Local Addresses in Multilink Networks
                  <draft-hong-zeroconf-multilink-ipv4-00.txt>


Status of this Memo

     This document is an Internet-Draft and is in full conformance with
     all provisions of Section 10 of RFC2026.

     Internet Drafts are working documents of the Internet Engineering
     Task Force (IETF), its areas, and working groups. Note that other
     groups may also distribute working documents as Internet-Drafts.

     Internet-Drafts are draft documents valid for a maximum of six
     months and may be updated, replaced, or obsolete by other documents
     at anytime. It is inappropriate to use Internet Drafts as reference
     material or to cite them other than as "work in progress."

     The list of current Internet-Drafts can be accessed at
     http://www.ietf.org/ietf/1id-abstracts.txt.

     The list of Internet-Draft Shadow Directories can be accessed at
     http://www.ietf.org/shadow.html.


Abstract

     This document describes a RPM(Router Proxy for Multilink) protocol 
     for proxy DAD(Duplication Address Detection) and proxy ARP(Address
     Resolution Protocol)in multilink networks using IPv4 link-local 
     addresses. Herein we consider the multilink network dangled to a 
     single router as a single subnet, not as multiple subnets. Each 
     host generates an IPv4 link-local address automatically and checks 
     its duplication using DAD procedure. To check the address 
     duplication over all links the gateway router uses the proxy DAD 
     function. The router searches for link-local address lookup table 
     whether the desired address is already in use in the other links.
     The router received an ARP request broadcasts messages as a proxy 
     DAD. During the proxy DAD function, the link-local address 
     lookup table is made. Also the router uses the proxy ARP function
     to support the inter link communication. The proxy ARP in the 
     router replies to the request after looking up the lookup table 
     and broadcasts an ARP request packet only to the link that the 
     receiver host is located in for address resolution. 




Hong, Kim, Hwang             Expires  May 2002                  [Page 1]


INTERNET-DRAFT    RPM(Router Proxy for Multilink)          November 2001


Table of Contents:

     1. Introduction
     2. Example of Multilink Network
     3. Operations of RPM(Router Proxy for Multilink) Protocol
     3.1 Selecting an IPv4 Link-Local Address
     3.2 Duplicate Address Detection over Multilink
     3.3 Finding Router's Link-Local Address
     3.4 Intra Link Communication
     3.5 Inter Link Communication
     4. Other Considerations
     References




1. Introduction

     It is possible for home networks to include multiple links. This
     issue can arise, for example, in the case of a home network
     supporting IEEE 802.11 wireless as well as IEEE 1394 and Ethernet.

     In multilink small networks connected by a single router, it is 
     desirable for the people to be able to use IP application 
     software without the inconvenience of having to manually configure
     static IP addresses or set up a DHCP server.  Therefore the use of
     zero configuration address is especially valuable in environments
     where no other configuration mechanism is available.

     In this document we describe a RPM(Router Proxy for Multilink)
     protocol for proxy DAD and proxy ARP in multilink networks using 
     IPv4 link-local addresses.

     Hosts in multilink network automatically configure their 
     interfaces with an IPv4 link-local addresses in the 169.254/16
     range[1]. It will be desirable to consider the multilink networks
     connected by a single router as a single subnet, not as multiple 
     subnets.  Therefore we extend the normal DAD procedure[1] to prove
     the uniqueness of their own link-local address to the whole links, 
     not confining to a single link. To check the address duplication 
     over all links the gateway router uses the proxy DAD function. 
     The router searches for link-local address lookup table whether 
     the desired address is already in use in the other links. The 
     router received an ARP request broadcasts messages as a proxy DAD.
     During the proxy DAD function, the link-local address lookup table
     is made. Also we describe the inter link communication using IPv4
     link-local address with the help of a router's ARP proxy. The 
     proxy ARP in the router replies to the request after looking up the
     lookup table and broadcasts an ARP request packet only to the link 
     that the receiver host is located in for address resolution. 






Hong, Kim, Hwang              Expires May 2002                  [Page 2]


INTERNET-DRAFT    RPM(Router Proxy for Multilink)          November 2001


2. Example of Multilink Network

     Figure 1 shows an example of multilink network model.


          OUTSIDE : Multilink       Host-A      Host-B
                  :  network          |           |
                  :               +---+-----------+----- USB
                  :               |
                  :  +--------+   |   Host-C     Host-D
                  :  |        |---+      |          |
               ------+ Router |==========+====+=====+=== Ethernet
                  :  |        |****           |
                  :  +--------+   *        Host-E
                  :               *
                  :               ****+***********+***** IEEE1394
                  :                   |           |
                  :                Host-F       Host-G
                  :

               Figure 1 Example of Multilink Network


     Several home networking technologies, such as HomePNA(Home
     Phoneline Networking Alliances), IEEE 802.11 wireless LAN, IrDA,
     PLC(Powerline Communication), etc., are possible to be connected to
     the router. The router helps the inter link communication. 



3. Operations of RPM(Router Proxy for Multilink) Protocol

     The RPM protocol uses some proxy functions in the router, such as
     a proxy DAD to support the DAD procedure over multiple links and 
     a proxy ARP to support the inter link communication, in order to
     emulate the multilink network as a single subnet to obey the 
     non-forwarding rule.

     The non-forwarding rule means that hosts may assume that all
     169.254/16 destination addresses are on-link and directly
     reachable.

     3.1 Selecting an IPv4 Link-Local Address

     The selection, defense and delivery of IPv4 link-local address
     within a link can be borrowed from the document[1].

     When a host wishes to configure a link-local address, it selects an
     address using a random (or pseudo-random) number generator with a
     uniform distribution in the range from 169.254.1.0 to
     169.254.254.255.





Hong, Kim, Hwang              Expires May 2002                  [Page 3]


INTERNET-DRAFT    RPM(Router Proxy for Multilink)          November 2001


     3.2 Duplicate Address Detection over Multilink

     In order to probe the uniqueness of the selected address, the host
     broadcasts an ARP request for the desired address. On a network 
     such as Ethernet that supports ARP, address collision detection is
     done using ARP probe[1]. 

     When the link-local address is already in use in the same link, 
     the reply message notifies the address confliction. Then the host
     tries again to generate another link-local address. 
 
     To check address collision over all links, the router searches for
     the link-local address lookup table whether the desired address is
     already in use in the other links. The router received an ARP 
     request may broadcast messages to each attached link in the 
     multilink, except one from which the ARP request was just 
     received. So the router acts as a proxy DAD.  

     If the link-local address is already in use in the other link, the
     router send a reply message to the originating host of the ARP
     request. Then the originating host knows it and tries again to 
     generate another link-local address.
     
     If not, the originating host may use the desired address. In this 
     case the router adds the link local address to the link-local 
     address lookup table in the appropriate entry.  The router creates
     and maintains the link-local address lookup table. Figure 2 shows 
     an example of link-local address lookup table.

            +---------------+---------------+---------------+
            |     Link 1    |     Link 2    |     Link 3    |
            +---------------+---------------+---------------+
            | 169.254.1.11  | 169.254.3.234 | 169.254.2.123 |
            +---------------+---------------+---------------+
            | 169.254.2.151 | 169.254.9.8   | 169.254.1.5   |
            +---------------+---------------+---------------+
            |       :       | 169.254.2.111 |       :       |
            +               +---------------+               +
            |               |        :      |               |
            +---------------+---------------+---------------+

           Figure 2. Example of Link-Local Address Lookup Table

 
     3.3 Finding Router's Link-Local Address

     At a multilink network, the router has multiple interfaces and
     each interface has a unique link-local address.

     The host which wants to know the router's link-local address 
     generates a RS(Router Solicitation) message. And  the router 
     sends a reply message to the originating host. 




Hong, Kim, Hwang          Expires May 2002                      [Page 4]


INTERNET-DRAFT    RPM(Router Proxy for Multilink)          November 2001


     Then the host gets the router's link-local address.
     Also, a router may send RA(Router Advertisement) messages 
     periodically through each interface.  The hosts received this RA 
     message know the router's link-local address.

     3.4 Intra Link Communication

     We don't describe this operation in this document. See [1].

     3.5 Inter Link Communication

     In the multilink network environment, the link layer address 
     used in one link is different from that of the other links, when
     the implementation technologies(e.g. USB, IEEE 1394, Ethernet) 
     are different each other.  Therefore the inter link 
     communication by using ARP broadcasting for address resolution 
     is not possible.

     We describe the proxy ARP in the router to support the inter link
     communication.

     A host which wants to communicate with the hosts on the other links
     broadcasts an ARP request on the same link.  In this case the
     proxy ARP in the router replies to the request after looking up the
     lookup table when the receiver's link-local address is in the
     table.  Then the originating host knows the receiver's link layer
     address, herein the router's link layer address, and sends a packet
     to the router.

     The router broadcasts an ARP request packet only to the link
     that the receiver host is located in for address resolution. Then
     the receiver replies its link layer address to the router and the
     router sends the received packet to the receiver host.

     Figure 3 shows a procedure of inter link communication.

      Sender host		    Router	  	  Receiver host
	  |  			      :: 		          |					   
	  |        ARP request        ::			  |
	  |-------------------------->::			  |
	  |  	       		 Lookup Table			  |
	  |	    ARP reply	      ::       ARP request	  |
	  |<--------------------------::------------------------->|
	  |	  		      ::	ARP reply	  |
	  |	  IP packet send      ::<-------------------------|
	  |-------------------------->::   ARP request(optional)  |
	  |			      ::------------------------->|	
	  |			      ::    ARP reply(optional)	  |
	  |			      ::<-------------------------|
	  |			      ::      IP packet send	  |
	  |		 	      ::------------------------->|
	  |	     Link 1	      ::	 Link 2 	  |
	    	   
	       Figure 3 Procedure of inter link communication


Hong, Kim, Hwang              Expires May 2002                  [Page 5]


INTERNET-DRAFT    RPM(Router Proxy for Multilink)          November 2001


4. Other Considerations

     The router must dynamically update the link-local address lookup
     table when a host is down or going up.

     To consider a multilink network in IPv6, see [2].
          
     The security condition between links is not concerned in this
     document.






References


[1]  Stuart Cheshire, "Dynamic Configuration of IPv4 Link-Local
     Addresses", <draft-ietf-zeroconf-ipv4-linklocal-04.txt>, 2001.

[2]  Dave Thaler, "Multi-link Subnets Support in IPv6", <draft-thaler-
     -ipngwg-multilink-subnets-01.txt>, 2001.


Authors Addresses

  Yong-Geun Hong, Yong-Jin Kim
  ETRI PEC
  161 Gajeong-Dong, Yuseong-Gu, Daejon 305-350, Korea
  Tel : +82 42 860 6557
  Fax : +82 42 861 5404
  E-mail : {yghong, yjkim}@pec.etri.re.kr

  Min-Tae Hwang
  Changwon National University
  9 Sarim-Dong, Changwon, 641-773, Korea
  Tel : +82 55 279 7632
  Fax : +82 55 279 7639
  E-mail : mthwang@sarim.changwon.ac.kr















Hong, Kim, Hwang          Expires January 2002                  [Page 6]
