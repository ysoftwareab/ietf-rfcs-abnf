<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Routing a Traffic Class</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Scope">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Structure of the paper">
<link href="#rfc.section.2" rel="Chapter" title="2 The fundamental concept of routing a class">
<link href="#rfc.section.2.1" rel="Chapter" title='2.1 Define: "traffic class"'>
<link href="#rfc.section.2.2" rel="Chapter" title='2.2 Define: "metric"'>
<link href="#rfc.section.2.3" rel="Chapter" title='2.3 Define: "route announcement"'>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Route Precedence">
<link href="#rfc.section.3" rel="Chapter" title="3 Sketch of a distance vector implementation">
<link href="#rfc.section.4" rel="Chapter" title="4 Sketch of a link state implementation">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.section.8" rel="Chapter" title="8 Change Log">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This note addresses the concept of routing a traffic class. This has many possible implementations, IGP and BGP, and link state as well as distance vector. The fundamental impetus is the question raised in RFC 3704 and shim6 of exit routing, the question raised by Mike O'Dell of source/destination routing, and the "fish" problem, raised in many networks, in which distinct traffic classes that could conceivably use the same route predictably use different routes. Instead of handling these as "destination routing with a twist", the paper looks at the matter systemically." />
  <meta name="description" content="This note addresses the concept of routing a traffic class. This has many possible implementations, IGP and BGP, and link state as well as distance vector. The fundamental impetus is the question raised in RFC 3704 and shim6 of exit routing, the question raised by Mike O'Dell of source/destination routing, and the "fish" problem, raised in many networks, in which distinct traffic classes that could conceivably use the same route predictably use different routes. Instead of handling these as "destination routing with a twist", the paper looks at the matter systemically." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">F.J. Baker</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">July 02, 2011</td>
</tr>
<tr>
<td class="left">Expires: January 03, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Routing a Traffic Class<br />
  <span class="filename">draft-baker-fun-routing-class-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This note addresses the concept of routing a traffic class. This has many possible implementations, IGP and BGP, and link state as well as distance vector. The fundamental impetus is the question raised in RFC 3704 and shim6 of exit routing, the question raised by Mike O'Dell of source/destination routing, and the "fish" problem, raised in many networks, in which distinct traffic classes that could conceivably use the same route predictably use different routes. Instead of handling these as "destination routing with a twist", the paper looks at the matter systemically.</p>
<h1><a>Requirements</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 03, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Scope</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Structure of the paper</a>
</li>
<li>2.   <a href="#rfc.section.2">The fundamental concept of routing a class</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Define: "traffic class"</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Define: "metric"</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Define: "route announcement"</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">Route Precedence</a>
</li>
<li>3.   <a href="#rfc.section.3">Sketch of a distance vector implementation</a>
</li>
<li>4.   <a href="#rfc.section.4">Sketch of a link state implementation</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.section.8">Change Log</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This note addresses the concept of routing a traffic class. This has many possible implementations, IGP and BGP, and link state as well as distance vector. The fundamental impetus is the question raised in <a href="#RFC3704">[RFC3704]</a> and shim6 of exit routing, the question raised by Mike O'Dell of source/destination routing, and the "fish" problem, raised in many networks, in which distinct traffic classes that could conceivably use the same route predictably use different routes. Instead of handling these as "destination routing with a twist", the paper looks at the matter systemically.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Scope</h1>
<p id="rfc.section.1.1.p.1">The question of implementation of IPv4 or IPv6 routes is moot; the algorithms discussed here can be used for either. Examples, however, will be drawn from <a href="#RFC2460">IPv6</a> <cite title="NONE">[RFC2460]</cite> and will presume its <a href="#RFC4291">addressing architecture</a> <cite title="NONE">[RFC4291]</cite>.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Structure of the paper</h1>
<p id="rfc.section.1.2.p.1">The paper looks first at the fundamental concept in <a href="#fundamental">Section 2</a>. It then goes on to imagine an <a href="#RFC5308">IS-IS-like</a> <cite title="NONE">[RFC5308]</cite> <a href="#RFC6119">[RFC6119]</a> implementation. Unfortunately, this really can't be implemented in IS-IS by adding a TLV, which is our usual approach, due to the changed concept of a metric. However, given the changed concepts of a metric and a TLV, it shows how the same exchange and calculation algorithms can be used to build such a routing protocol. It also looks at a <a href="#RFC2080">RIP-like</a> <cite title="NONE">[RFC2080]</cite> algorithm that includes a sequence number (derived from <a href="#RFC3561">AODV</a> <cite title="NONE">[RFC3561]</cite>) to simplify count-to-infinity-related problems. It stops short of a BGP implementation, although one modeled on the distance vector model would make sense.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#fundamental" id="fundamental">The fundamental concept of routing a class</a>
</h1>
<p id="rfc.section.2.p.1">This section introduces the fundamental concepts involved in routing a traffic class. These include the definitions of </p>

<ul>
<li>a "traffic class", which is a set-theoretic definition - all traffic matching a constraint,</li>
<li>a "metric", which is an administrative number applied to a class of traffic crossing an interface, and</li>
<li>a "route announcement", which is the accumulation of information regarding the routing of a traffic class as modified by various metrics en route.</li>
</ul>
<p id="rfc.section.2.p.2">In addition, it describes the fundamental algorithm applied in modifying a route announced by a predecessor node using a metric for announcement on the interface implied.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#class" id="class">Define: "traffic class"</a>
</h1>
<p id="rfc.section.2.1.p.1">A "class" of traffic, in any routing protocol, is the selector that is used to identify a traffic stream for the purpose of routing. For traditional internet routing protocols like RIP, OSPF, IS-IS, EIGRP, or BGP, a "traffic class" is "the traffic destined to a stated prefix". In the context of this design, a traffic class is the traffic that goes </p>

<ul>
<li>to a destination prefix, which may be a default route (::/0), a host route (any /128 prefix), or anything in between,</li>
<li>from a source prefix, which may be a default route (::/0), a host route (any /128 prefix), or anything in between, and</li>
<li>using one of a set of <a href="#RFC2474">DSCP</a> <cite title="NONE">[RFC2474]</cite> values.</li>
</ul>
<p id="rfc.section.2.1.p.2">The set of DSCP values includes and "any DSCP". "Any DSCP" has the obvious meaning: we are not really looking at the DSCP in traffic classification.</p>
<p id="rfc.section.2.1.p.3">A protocol could also identify a route as a "null route"; this is like any other route, but specifically directs that traffic matching the traffic class is to be dropped.</p>
<p id="rfc.section.2.1.p.4">A traffic class is represented in this document as </p>

<ul class="empty"><li>{destination, source, {list of DSCPs}|any|none}</li></ul>
<p id="rfc.section.2.1.p.5">Examples of common traffic classes include: </p>

<dl>
<dt>Standard Default Route:</dt>
<dd style="margin-left: 8">{::/0, ::/0, any}</dd>
<dt>Default Route using a source prefix</dt>
<dd style="margin-left: 8">{::/0, source, any}</dd>
<dt>Default route used only for a QoS Traffic Class:</dt>
<dd style="margin-left: 8">{::/0, ::/0, {list of DSCPs}}</dd>
</dl>
<p id="rfc.section.2.1.p.6">Examples of QoS traffic classes are found in the <a href="#RFC4594">Configuration Guidelines for DiffServ Service Classes</a> <cite title="NONE">[RFC4594]</cite> and related documents <a href="#RFC5127">[RFC5127]</a> and <a href="#RFC5865">[RFC5865]</a>.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#metric" id="metric">Define: "metric"</a>
</h1>
<p id="rfc.section.2.2.p.1">A "metric" is an attribute of an interface, and associates a traffic class with a administrative value used in comparison of routes. In this document, it is represented as </p>

<ul class="empty"><li>{{destination, source, {DSCP}|any|none}, administrative value}</li></ul>

<p> and should be understood as "the metric for traffic from source to destination using DSCP".</p>
<p id="rfc.section.2.2.p.2">For example, if an interface is available to all VoIP traffic, one of the metrics on an interface might be </p>

<ul class="empty"><li>{{::/0, ::/0, {EF}}, administrative value}</li></ul>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#route" id="route">Define: "route announcement"</a>
</h1>
<p id="rfc.section.2.3.p.1">A route announcement is identical to a metric in structure, but is semantically different. Where a metric is an attribute of an interface, a route is an entry in the route table calculated by the routing protocol, and is used in making forwarding decisions.</p>
<p id="rfc.section.2.3.p.2">The calculation of a route follows the following logic: </p>

<ol>
<li>Inputs to the route calculation are a route announcement (which may be derived from an interface metric in the case of local routes, or received from a neighboring route for remote routes), and a metric associated with an interface.</li>
<li>The source, destination, and set of DSCPs of the route announcement and the metric are intersected to generate the traffic class for the resulting route.</li>
<li>The resulting route's administrative value is the sum of the original route's administrative value and the interface's administrative value.</li>
</ol>
<p id="rfc.section.2.3.p.3">For example, in <a href="#example1">Figure 1</a>, if the prefix allocated by ISP-1 to a network is 2001:db8:1::/48 and the prefix allocated by ISP-2 to the network is 2001:db8:2::/48, the exit routers for the network might advertise into the network the default routes </p>

<ul>
<li>{{2000::/3, 2001:db8:1::/48, any}, 1} ("unicast traffic using source addresses in 2001:db8:1::/48 for any application"), and</li>
<li>{{::/0, 2001:db8:2::/48, any}, 2} ("all traffic using source addresses in 2001:db8:2::/48 for any application").</li>
</ul>
<div id="#rfc.figure.1"></div>
<div id="#example1"></div>
<pre>
\                     /          \                     /
 `.       ISP-1     ,'            `.      ISP-2      ,'
   '--.         _.-'                '--.         _.-'
       `---+--''                        `--+---''
           |                               |
        +--+---+                        +--+---+
        | Exit |                        | Exit |
        |Router|                        |Router|
        +---+--+                        +---+--+
      ------+------------+-  -+-------------+-----
                       +-+----+-+
                       |Interior|
                       | Router |
                       +---+----+
                    -------+--------</pre>
<p id="rfc.section.2.3.p.4">One edge case is the case in which a route intersected with the available metrics yields the null set. In such a case, the resulting route cannot be used as no traffic matches it.</p>
<p id="rfc.section.2.3.p.5">If an interior distance vector router in the network receives </p>

<ul class="empty">
<li>{{2000::/3, 2001:db8:1::/48, any}, 1} and</li>
<li>{{::/0, 2001:db8:2::/48, any}, 2}</li>
</ul>
<p id="rfc.section.2.3.p.6">from its upstream router, and on a given interface has a metric </p>

<ul class="empty"><li>{{::/0, ::/0, {EF}}, 5} ("any VoIP traffic"),</li></ul>
<p id="rfc.section.2.3.p.7">it would validly infer the routes </p>

<ul class="empty">
<li>{{2000::/3, 2001:db8:1::/48, {EF}}, 6} ("unicast VoIP traffic using source addresses in 2001:db8:1::/48") and</li>
<li>{{::/0, 2001:db8:2::/48, {EF}}, 7} ("all VoIP traffic using source addresses in 2001:db8:2::/48").</li>
</ul>
<p id="rfc.section.2.3.p.8">It would install the routes it received into its own route table, and advertise the calculated routes to neighboring routers.</p>
<p id="rfc.section.2.3.p.9">Note that there is no question of a unicast RPF or other forms of <a href="#RFC2827">Ingress Filtering</a> <cite title="NONE">[RFC2827]</cite> required in such a network. If a host spoofs a source address in another routing domain and sends a datagram upstream, there is no route in the network "from" that routing domain, and the router has no idea what to do with it. In such cases the router would silently drop the traffic (it might be nice to respond with an ICMP, but to whom?); it should of course maintain appropriate counters and/or logs. Similarly, since traffic is routed according to both its source and destination addresses, traffic using a source address in 2001:db8:2::/48 would have no chance of existing to ISP-1. It is still possible for traffic from outside to come in, however, as such routes would have a source prefix of ::/0 or 2000::/3.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#precedence" id="precedence">Route Precedence</a>
</h1>
<p id="rfc.section.2.4.p.1">Precedence in selection of routes is based on intersection, and follows the rule "most specific first". This is a generalization of the "longest match first" rule used in destination routing. That may require, in generating the Forwarding Information Base (FIB) from the Routing Information Base (RIB), that we calculate the least intersection of two route announcements.</p>
<p id="rfc.section.2.4.p.2">In calculating routes, either one route's traffic class is a subset of another's, or they mutually incompatible. If one is a subset of the other, we consider the superset to be "less specific" and the subset to be "more specific"; the most specific matching traffic class rules.  If the most specific option is in fact multiple traffic classes none of which are subsets of the others, we calculate the intersections of those routes for the purpose of comparison, and apply the rule to the resulting route announcements.</p>
<p id="rfc.section.2.4.p.3">For example, consider the two routes </p>

<ul class="empty">
<li>{{2000::/3, ::/0, any}, 1} and</li>
<li>{{::/0, 2000::/3, any}, 5}.</li>
</ul>
<p id="rfc.section.2.4.p.4">They are not comparable because neither is a subset of the other.  We therefore calculate the intersection, which is a choice between </p>

<ul class="empty">
<li>{{2000::/3, 2000::/3, any}, 1} and</li>
<li>{{2000::/3, 2000::/3, any}, 5}.</li>
</ul>
<p id="rfc.section.2.4.p.5">Given that choice, the metric clearly selects {{2000::/3, 2000::/3, any}, 1}. So we install in the RIB the three routes </p>

<ul class="empty">
<li>{{2000::/3, 2000::/3, any}, 1},</li>
<li>{{2000::/3, ::/0, any}, 1}, and</li>
<li>{{::/0, 2000::/3, any}, 5}.</li>
</ul>
<p id="rfc.section.2.4.p.6">The first is used by unicast traffic, as it is the most specific that matches traffic from and to addresses in 2000::/3. The second is used, for example, with traffic that is from addresses whose most significant three bits are not 001 and to an address in 2000::/3. The third is used for traffic that is to addresses whose most significant three bits are not 001 but are from addresses in 2000::/3.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#dv" id="dv">Sketch of a distance vector implementation</a>
</h1>
<p id="rfc.section.3.p.1">A distance vector implementation would operate much as described in <a href="#fundamental">Section 2</a>. In addition, however, we might take advantage of an algorithm used in <a href="#RFC3561">AODV</a> <cite title="NONE">[RFC3561]</cite>) to simplify count-to-infinity-related problems.</p>
<p id="rfc.section.3.p.2">To this end, we use the mechanisms and algorithms of <a href="#RFC2080">[RFC2080]</a> with certain modifications.</p>
<p id="rfc.section.3.p.3">A Route Table Entry (RTE), in this model, might be structured as in <a href="#rte">Figure 2</a>.</p>
<div id="#rfc.figure.2"></div>
<div id="#rte"></div>
<pre> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         route tag (2)         |A|N| flags     |  metric (1)   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Announcement sequence number (4)           |
+---------------------------------------------------------------+
|                                                               |
~                    IPv6 originator address  (16)              ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|dest prefix len|source prf len |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                    IPv6 destination prefix  (up to 16)        ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                    IPv6 source prefix (up to 16)              ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    IPv6 Traffic Class DSCP (64 bits)          |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.3.p.4">The fields are: </p>

<dl>
<dt>Route Tag:</dt>
<dd style="margin-left: 8">The Route Tag is as defined in <a href="#RFC2080">[RFC2080]</a>.</dd>
<dt>A:</dt>
<dd style="margin-left: 8">If 1, any DSCP applies, and the IPv6 Traffic Class DSCP mask is absent. If 0, the IPv6 Traffic Class DSCP is present.</dd>
<dt>N:</dt>
<dd style="margin-left: 8">if 1, a null route; traffic in this traffic class and not in more explicit match SHOULD be dropped.</dd>
<dt>flags:</dt>
<dd style="margin-left: 8">unspecified in this version of the specification. Set to 0 on transmission and ignored on receipt.  Future versions may specify additional flags.</dd>
<dt>Metric:</dt>
<dd style="margin-left: 8">The Metric is as defined in <a href="#RFC2080">[RFC2080]</a>.</dd>
<dt>Announcement sequence number:</dt>
<dd style="margin-left: 8">0..FFFFFFFF, follows the rules for a sequence number specified in <a href="#RFC3561">[RFC3561]</a>.</dd>
<dt>IPv6 originator address:</dt>
<dd style="margin-left: 8">One of the global addresses of the router originating this RTE, presumably the one used on the relevant interface, which is in control of the sequence number. See <a href="#RFC3561">[RFC3561]</a> for considerations and algorithms.</dd>
<dt>Destination Prefix Length:</dt>
<dd style="margin-left: 8">0..128</dd>
<dt>Source Prefix Length:</dt>
<dd style="margin-left: 8">0..128</dd>
<dt>IPv6 destination prefix:</dt>
<dd style="margin-left: 8">The significant bits of the prefix in question. Occupies ceiling(destination prefix length/8) bytes.</dd>
<dt>IPv6 source prefix:</dt>
<dd style="margin-left: 8">The significant bits of the prefix in question. Occupies ceiling(source prefix length/8) bytes.</dd>
<dt>IPv6 Traffic Class DSCP:</dt>
<dd style="margin-left: 8">if A=0, not present; if A=0, the most significant bit is numbered 0, and indicates that the traffic class includes traffic with a DSCP of 000000; if A=1, not present.</dd>
</dl>
<p id="rfc.section.3.p.5">Distribution and calculation of routes follows <a href="#RFC2080">[RFC2080]</a>, including split horizon (an announcement received from a router on the interface should not be reannounced to the same router). and poison reverse (which should be used on triggered updates but not regular announcements).</p>
<p id="rfc.section.3.p.6">Elimination of stale routing information of routes follows the algorithm with the sequence number specified in <a href="#RFC3561">[RFC3561]</a>.</p>
<p id="rfc.section.3.p.7">Intersection of route announcements with interface metric data is as described in <a href="#fundamental">Section 2</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#spf" id="spf">Sketch of a link state implementation</a>
</h1>
<p id="rfc.section.4.p.1">A link state (SPF) implementation would also operate much as described in <a href="#fundamental">Section 2</a>, although the algorithm operates in memory as opposed to being distributed.</p>
<p id="rfc.section.4.p.2">To this end, we use the mechanisms and algorithms of <a href="#RFC5308">[RFC5308]</a> with certain modifications.</p>
<p id="rfc.section.4.p.3">IS-IS structures its network as a lattice of routers that lead one to sets of hosts identified by "TLVs". A TLV, in this model, might be structured as in <a href="#TLV">Figure 3</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#TLV"></div>
<pre>
        
        
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Type = ???   |    Length     |          Metric ..            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          .. Metric            |U|X|S| Reserve |  TLV  
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  TLV ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Sub-TLV Len(*) | Sub-TLVs(*) ...
* - if present

TLV or sub-TLV format:
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|dest prefix len|source prf len |A|N|flags      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                    IPv6 destination prefix  (up to 16)        ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                    IPv6 source prefix (up to 16)              ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    IPv6 Traffic Class DSCP (64 bits)          |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.4.p.4">The fields are: </p>

<dl>
<dt>U:</dt>
<dd style="margin-left: 8">up/down bit</dd>
<dt>X:</dt>
<dd style="margin-left: 8">external original bit</dd>
<dt>S:</dt>
<dd style="margin-left: 8">subtlv present bit</dd>
<dt>A:</dt>
<dd style="margin-left: 8">If 1, any DSCP applies, and the IPv6 Traffic Class DSCP mask is absent. If 0, the IPv6 Traffic Class DSCP is present.</dd>
<dt>N:</dt>
<dd style="margin-left: 8">if 1, a null route; traffic in this traffic class and not in more explicit match SHOULD be dropped.</dd>
<dt>flags:</dt>
<dd style="margin-left: 8">unspecified in this version of the specification. Set to 0 on transmission and ignored on receipt.  Future versions may specify additional flags.</dd>
<dt>Destination Prefix Length:</dt>
<dd style="margin-left: 8">0..128</dd>
<dt>Source Prefix Length:</dt>
<dd style="margin-left: 8">0..128</dd>
<dt>IPv6 destination prefix:</dt>
<dd style="margin-left: 8">The significant bits of the prefix in question. Occupies ceiling(destination prefix length/8) bytes.</dd>
<dt>IPv6 source prefix:</dt>
<dd style="margin-left: 8">The significant bits of the prefix in question. Occupies ceiling(source prefix length/8) bytes.</dd>
<dt>IPv6 Traffic Class DSCP:</dt>
<dd style="margin-left: 8">if A=0, not present; if A=0, the most significant bit is numbered 0, and indicates that the traffic class includes traffic with a DSCP of 000000; if A=1, not present.</dd>
</dl>
<p id="rfc.section.4.p.5">Distribution and calculation of routes follows <a href="#RFC5308">[RFC5308]</a>.</p>
<p id="rfc.section.4.p.6">Intersection of route announcements with interface metric data is as described in <a href="#fundamental">Section 2</a>.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">At this point, this memo asks the IANA for no new parameters and gives the IANA no instructions. As development progresses, that might change.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Security issues in routing protocols such as these are the same as in other distance vector and link state routing protocols, and need to be mitigated in the same ways. Since this paper looks primarily at the algorithms for route calculation, those issues are largely ignored. If a protocol such as described in <a href="#dv">Section 3</a> or <a href="#spf">Section 4</a> is implemented, however, care must be taken to ensure the integrity of communications between routers and their mutual authentication.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">Dana Blair reviewed the initial version of the draft.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#log" id="log">Change Log</a>
</h1>
<p></p>

<dl>
<dt>Initial Version:</dt>
<dd style="margin-left: 8">Sat Mar 26 12:25:46 CET 2011</dd>
</dl>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4291">[RFC4291]</b></td>
<td class="top">
<a>Hinden, R.</a> and <a>S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>", RFC 4291, February 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2080">[RFC2080]</b></td>
<td class="top">
<a href="mailto:gmalkin@Xylogics.COM" title="Xylogics, Inc.">Malkin, G.</a> and <a href="mailto:minnear@ipsilon.com" title="Ipsilon Networks, Inc.">R. Minnear</a>, "<a href="http://tools.ietf.org/html/rfc2080">RIPng for IPv6</a>", RFC 2080, January 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a href="mailto:kmn@cisco.com" title="Cisco Systems">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com" title="Torrent Networking Technologies">Blake, S.</a>, <a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a> and <a href="mailto:black_david@emc.com" title="EMC Corporation">D.L. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2827">[RFC2827]</b></td>
<td class="top">
<a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3561">[RFC3561]</b></td>
<td class="top">
<a>Perkins, C.</a>, <a>Belding-Royer, E.</a> and <a>S. Das</a>, "<a href="http://tools.ietf.org/html/rfc3561">Ad hoc On-Demand Distance Vector (AODV) Routing</a>", RFC 3561, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3704">[RFC3704]</b></td>
<td class="top">
<a>Baker, F.</a> and <a>P. Savola</a>, "<a href="http://tools.ietf.org/html/rfc3704">Ingress Filtering for Multihomed Networks</a>", BCP 84, RFC 3704, March 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4594">[RFC4594]</b></td>
<td class="top">
<a>Babiarz, J.</a>, <a>Chan, K.</a> and <a>F. Baker</a>, "<a href="http://tools.ietf.org/html/rfc4594">Configuration Guidelines for DiffServ Service Classes</a>", RFC 4594, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5127">[RFC5127]</b></td>
<td class="top">
<a>Chan, K.</a>, <a>Babiarz, J.</a> and <a>F. Baker</a>, "<a href="http://tools.ietf.org/html/rfc5127">Aggregation of DiffServ Service Classes</a>", RFC 5127, February 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5308">[RFC5308]</b></td>
<td class="top">
<a>Hopps, C.</a>, "<a href="http://tools.ietf.org/html/rfc5308">Routing IPv6 with IS-IS</a>", RFC 5308, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5865">[RFC5865]</b></td>
<td class="top">
<a>Baker, F.</a>, <a>Polk, J.</a> and <a>M. Dolly</a>, "<a href="http://tools.ietf.org/html/rfc5865">A Differentiated Services Code Point (DSCP) for Capacity-Admitted Traffic</a>", RFC 5865, May 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6119">[RFC6119]</b></td>
<td class="top">
<a>Harrison, J.</a>, <a>Berger, J.</a> and <a>M. Bartlett</a>, "<a href="http://tools.ietf.org/html/rfc6119">IPv6 Traffic Engineering in IS-IS</a>", RFC 6119, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fred Baker</span> 
	  <span class="n hidden">
		<span class="family-name">Baker</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Santa Barbara</span>,  
		<span class="region">California</span> 
		<span class="code">93117</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fred@cisco.com">fred@cisco.com</a></span>

  </address>
</div>

</body>
</html>