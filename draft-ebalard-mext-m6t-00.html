<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>MIPv6 from IPv4-only networks</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="MIPv6 from IPv4-only networks">
<meta name="keywords" content="Mobile IPv6, DSMIPv6">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">A. Ebalard</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">EADS</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">August 06, 2010</td></tr>
<tr><td class="header">Expires: February 7, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />MIPv6 from IPv4-only networks<br />draft-ebalard-mext-m6t-00</h1>

<h3>Abstract</h3>

<p> MIPv6 [RFC3775] protocol has been designed to
     work on IPv6 networks: nothing was initially provisioned in the
     specification to support movement of Mobile Nodes to IPv4-only
     networks (with or without NAT) or the communication with IPv4
     peers.
</p>
<p> DSMIPv6 [RFC5555] is the official solution
     specified to address those needs. It requires IPv4/NAT-awareness
     by the MIPv6 module, IKE module and IPsec stack. The global
     approach selected by DSMIPv6 requires changes to implementations
     and increase complexity. 
</p>
<p> This memo presents an alternative approach to support
     operations of a mobile nodes from an IPv4-only network. It does
     not require changes to MIPv6 modules, IKE module and IPsec
     stack. 
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 7, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Initial thoughts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.2.</a>&nbsp;
Rationale<br />
<a href="#probandsols">2.</a>&nbsp;
Problems and solutions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
UDP port to use on the tunnel GW<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
MN's CoA on the tunnel interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
Maintaining NAT states<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.4.</a>&nbsp;
Route management on the tunnel GW<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.5.</a>&nbsp;
Multiple tunnel interfaces on a MN<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.6.</a>&nbsp;
MTU considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.7.</a>&nbsp;
Miscellanous<br />
<a href="#anchor10">3.</a>&nbsp;
Protocol operations<br />
<a href="#anchor11">4.</a>&nbsp;
Pros and cons<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.1.</a>&nbsp;
Preventing DoS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.1.1.</a>&nbsp;
Against the MN<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.1.2.</a>&nbsp;
Against the HA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.1.3.</a>&nbsp;
Against the GW<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.1.4.</a>&nbsp;
Against the Infrastructure<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Initial thoughts</h3>

<p>MIPv6 <a class='info' href='#RFC3775'>[RFC3775]<span> (</span><span class='info'>Johnson, D., Perkins, C., and J. Arkko, &ldquo;Mobility Support in IPv6,&rdquo; June&nbsp;2004.</span><span>)</span></a> protocol has been designed
	to work on IPv6 networks: nothing was initially provisioned in
	the specification to support movement of Mobile Nodes to
	IPv4-only networks (with or without NAT) or the communication
	with IPv4 peers.
</p>
<p> In order to address the need to support those use cases,
	DSMIPv6 <a class='info' href='#RFC5555'>[RFC5555]<span> (</span><span class='info'>Soliman, H., &ldquo;Mobile IPv6 Support for Dual Stack Hosts and Routers,&rdquo; June&nbsp;2009.</span><span>)</span></a> has been published: it
	provides a global solution to support the movement of mobile
	nodes to IPv4 only networks with and without NAT and their
	communication with IPv4 peers via the Home Agent. The use of
	DSMIPv6 inhibits Route Optimization mechanism. 
</p>
<p> The approach selected by DSMIPv6 is to implement IPv4 and
	NAT awareness on the MN and its HA. Even if this probably has
	advantages (efficient on-wire format), this IPv4/NAT-awareness
	also adds a lot of complexity to the MIPv6 process and in its
	relationships with IPsec and IKE.
</p>
<p> Considering the initial problems at hand:<br />
<br />


	</p>
<ol class="text">
<li> Supporting the use of MIPv6 for MN stuck in IPv4-only
	  networks.
</li>
<li> Supporting the communication of MIPv6 MN with IPv4
	  peers.
</li>
</ol><p>
	
</p>
<p>the following separate approaches are possible:<br />
<br />


	</p>
<ol class="text">
<li> Use of a simple tunnel (over IPv4/UDP) between the MN
	  and its HA
</li>
<li> Use of NAT64 mechanism in the Home Network.
</li>
</ol><p>
	
</p>
<p>This document tries and address the first problem by covering the
	first approach.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Rationale</h3>

<p>MIPv6 works fine when IPv6 connectivity is available
	because its logic remains quite simple. The absence of NAT on
	IPv6 networks (i.e. flat routing) has made it possible to
	greatly simplify the protocol and its deployment, compared to
	MIPv4.
</p>
<p>IPsec and IKE have seen limited deployment in IPv4 networks
	(in favor of TLS) partly due to the difficulty or inability to
	use them in ubiquitous NAT environments. When IPv6
	connectivity is available, IPsec and IKE work and interoperate
	easily. The interactions with MIPv6 in order to secure the
	operation of the protocol are quite simple (see <a class='info' href='#MIGRATE'>[MIGRATE]<span> (</span><span class='info'>Ebalard, A. and S. Decugis, &ldquo;PF_KEY Extension as an Interface between Mobile IPv6 	and IPsec/IKE,&rdquo; August&nbsp;2008.</span><span>)</span></a>).
</p>
<p>Basically, if it is possible to mask the existence of IPv4
	and NAT to MIPv6, IPsec and IKE, it may be possible to allow
	its use from IPv4-only networks without invasive and costly
	changes in the implementation.
</p>
<p>Additionally, the rationale for this work also results
	from:<br />
<br />


	</p>
<ul class="text">
<li> Considerations on the limited set of flows associated
	  with MIPv6 protocol: when RO is not used, MN's traffic is
	  always tunneled via the HA.
</li>
<li> The use of Teredo by the author on IPv4 networks as an
	  alternative solution to DSMIPv6 (due to its unavailability
	  on most platform). 
</li>
<li> Considerations on the architectural requirements and
	  drawbacks of Teredo (qualification procedure, reliance on
	  Teredo servers, MTU considerations, ...) in the specific
	  context of a MIPv6 MN.
</li>
</ul><p>
	
</p>
<a name="probandsols"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Problems and solutions</h3>

<p> As discussed above, the idea is to provide IPv6 connectivity
	via a simple tunnel over IPv4 and UDP to the HA. On the MN,
	the tunnel interface hides the existence of IPv4/NAT and makes
	it possible to operate MIPv6 in a transparent fashion. On a
	gateway in front of the HA (or on the HA), this provides the
	same benefit. Nonetheless, creating, using and maintaining
	this tunnel both on the MN and the gateway in front of the HA
	requires some care. Problems and selected solutions are
	discussed below. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
UDP port to use on the tunnel GW</h3>

<p> Clients of the tunnel gateway (MN or MR) need to access
	it on a fixed port. It is nonetheless not worth asking IANA to
	allocate a dedicated port for that purpose.
</p>
<p>Basically, the tunnel mechanism described in this memo is a
	custom version of what STUN <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a> or Teredo
	<a class='info' href='#RFC4380'>[RFC4380]<span> (</span><span class='info'>Huitema, C., &ldquo;Teredo: Tunneling IPv6 over UDP through Network Address 	Translations (NATs),&rdquo; February&nbsp;2006.</span><span>)</span></a> provide. As the tunnel GW is a closed
	service dedicated to the MN, it may be possible to have the GW
	listen on STUN or Teredo ports (respectively 3478/udp and
	3544/udp). 
</p>
<p> As filtering may be in place in the IPv4 networks the MN
	found themselves, it could be possible to use a destination
	port associated with a protocol which is usually authorized,
	like 4500/udp, 500/udp or 53/udp. 
</p>
<p>As the choice of the specific ports to be used for a given
	MN community highly depends on the habits of the MN and the
	foreign networks they are usually in, the choice of the
	port on which the tunnel qateway should listen is left as a
	local decision. The service of the gateway may be available on
	different ports. 
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
MN's CoA on the tunnel interface</h3>

<p>A MN needs an IPv6 address to use as source for the
	  packets it sends to the HA, i.e. to be configured on the
	  MN's tunnel interface. Because this address will be the
	  one seen by the HA for the MN, it needs to be unique among
	  all the MN. Additionally, all the addresses used by the MN
	  for their tunnel connectivity needs to be routed to the
	  tunnel gateway.
</p>
<p> The MN has a unique address available: its
	  HoA. Nonetheless, it is not directly usable over the
	  tunnel because the associated prefix is also the home
	  prefix. Using this would create additional routing
	  complexities on the HA and may create additional attack
	  vectors.
</p>
<p> As the addresses used by the MN will never be directly
	  routed over the Internet, it is possible to use a Unique
	  Local prefix for that purpose. Generation of an ULA prefix
	  should be performed as described in <a class='info' href='#RFC4193'>[RFC4193]<span> (</span><span class='info'>Hinden, R. and B. Haberman, &ldquo;Unique Local IPv6 Unicast Addresses,&rdquo; October&nbsp;2005.</span><span>)</span></a>. The remaining of the address after the
	  48 bits ULA prefix are set as follows.
</p>
<p> The 16 bits directly following the first 48 bits of ULA
	  prefix are available for the administrator to configure
	  additional subnets if needed. 
</p>
<p> The interface identifier is constructed in the following
	  fashion by a MN: <br />
<br />

	  
	  </p>
<ul class="text">
<li> the first 16 bits are filled with the MN ID, a value
	    known by the MN. It does not need to be known by the
	    tunnel GW or the HA. It is just required to be unique
	    among the set of MN using the /64 prefix.
</li>
<li> the following 48 bits are filled with random bits by
	    the MN each time it changes its point of attachment in the
	    IPv4 infrastructure. The rationale for this random value
	    is given later in the document. 
</li>
</ul><p>
	  
</p>
<p>From a theroretical standpoint, the combination of the
	  subnet ID and the MN ID allows an administrator to support
	  up to 2**32 MN, i.e. those are not a limiting factors. 
</p>
<p>In the end, the tunneling component on the MN should be
	  provided directly with the /80 prefix. 
</p>
<p>To summarize, the prefix has the following format:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    +---------------------+---------+---------+-------------------+
    |    /48 ULA prefix   | 16 bits | 16 bits |      48 bits      |
    |                     |subnet ID|  MN ID  |    random value   |
    +---------------------+---------+---------+-------------------+
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Maintaining NAT states</h3>

<p>The MN needs to maintain states in the NAT GW which
	  handles its traffic in order to remain reachable from the HA 
	  (i.e. by peers which use the MN-HA tunnel). 
</p>
<p> The MN basically needs to exchange keep-alive messages
	  with the tunnel GW in order for the states in the NAT GW to
	  be maintained. Those exchanges are required only when no
	  traffic is exchanged between the MN and its HA. 
</p>
<p> If the MN has not sent and received traffic via the
	  tunnel for 30 seconds (default refresh interval borrowed
	  from Teredo specification), the tunneling component on the
	  MN will send an empty IPv6 packet (Next Header in IPv6
	  header set to 59) via the tunnel. The IPv6 source address of
	  the packet is set to the tunnel interface address and the
	  destination address is set to fe80::1. 
</p>
<p> When the tunnel component receives the IPv6 packet over
	  the tunnel, the specific destination address (fe80::1) and
	  the absence of upper layer (next header set to 59) indicate
	  the packet is a keep-alive message. It verifies an active
	  state exists for the source address in the packet and that
	  the IPv4 parameters match the state. If this is the case, it
	  replies with a similar message but with the addresses
	  reversed. Otherwise, it silently drops the packet. 
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Route management on the tunnel GW</h3>

<p> Route management on the tunnel gateway is implementation
	dependent but reflects the status of active states. An active
	state is created only from a temporary state (a packet was
	recently forwarded from the tunnel gateway to the HA) when the
	HA replies with traffic to the MN. 
</p>
<p> Regarding the removal of old states or routes, an
	invalidation timer should be use in order to garbage collect
	old states. This timer should be refreshed each time traffic
	(data or keep-alive messages) is exchanged with a MN over the
	tunnel. In practice, the protocol does not offer a way for a
	MN to deregister a state. When the MN registers from a new
	IPv4-only network, it generates a new IPv6 address and uses
	it. As no traffic is exchanged after some point via the unnel
	for that address, it is garbage collected automatically. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Multiple tunnel interfaces on a MN</h3>

<p>A MN may want to use multiple tunnel interfaces
	simultaneously, via the same tunnel gateway. The addressing
	scheme and the protocol does not prevent that. This is mainly
	a matter of preference among the different
	interfaces. Additionally, if the same prefix, subnet ID and MN
	ID are used for all the tunnel interfaces of the MN (i.e. the
	same /80 prefix), then some local syncrhonization is required
	to prevent the 48 simultaneous use of identical 48 bits random
	values. 
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.6"></a><h3>2.6.&nbsp;
MTU considerations</h3>

<p> Proposed approach is based on UDP tunneling. As for Teredo
	protocol, implementation of this specification SHOULD NOT set
	the DF bit of the encapsulating IPv4 header.
</p>
<p> Nonetheless, packets exchanged between the MN and its HA
	via the tunnel may undergo PMTUD both at the IPv6 level
	(between the tunnel GW and the HA) and at the IPv4 level
	(between the MN and the tunnel GW). When implementing the
	mechanism, PMTUD should be one of the first things to
	validate.
</p>
<p> Teredo does not provide a mechanism for a Teredo client to
	control the MTU of its Teredo interface and the one on the
	relay. It is statically set to 1280, which is a safe bet to
	counter the possible filtering of ICMP messages in the IPv4
	internet.
</p>
<p> In the protocol described in this memo, a different
	approach is selected. The MTU of the tunnel interface is
	initially set to a default value of 1472 bytes on both
	sides (on the MN and on its tunnel GW). Reception of ICMP
	Packet too big messages from IPv4 routers on the path. 
</p>
<p> For use in specific environments, implementations should
	provide a mean for admnistrator to set the default MTU to a
	different value. 
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.7"></a><h3>2.7.&nbsp;
Miscellanous</h3>

<p> This subsection covers additional miscellanous
	points:<br />
<br />
 
	  
	  </p>
<ul class="text">
<li> HA reachability via the tunnel GW: monitoring the
	    reachability of the HA via the tunnel gateway is outside
	    the scope of the protcol but may be implemented if
	    needed. The reachability will usually depends on the UDP
	    ports used for contacting the GW, i.e. on the filtering
	    implemented by the IPv4 network (probably by the NAT
	    GW).
</li>
<li> Teredo automatic sunset equivalent: Teredo provides an
	    automatic sunset mechanism. The protocol does not provide
	    one. This is left has an implementation decision. It
	    should be noted that the use of the tunnel from an
	    fast IPv4-only network (ethernet access) may be more
	    efficient in some case than the use of a native
	    IPv6-enabled connection mean via an slower network (3G).
</li>
<li> Usability from a public address: when a public IPv4
	    address is available at the MN, other transition
	    mechanisms (e.g. 6to4) may be used to get IPv6
	    connectivity. From an encapsulation standpoint, 6to4 is
	    more efficient (8 bytes gain per packet). Additionally,
	    unlike 6to4, current approach require (no matter the
	    characteristics of the available IPv4 address) to
	    implement and use the keep-alive mechanism described
	    above. Nonetheless, compared to 6to4, proposed approach
	    may provide a shorter path to join the HA via the tunnel
	    GW.
</li>
<li> Behavior on IPv6-enabled networks: the mechanism is
	    useful from IPv4-only networks (with or without NAT) but
	    also works when IPv6 and IPv4 are both available. When
	    usable (i.e. IPv4 is available), the mechanism provides an
	    additional IPv6 interface on the system that the MIPv6
	    module can consider. The activation of the mechanism does
	    not inhibit other existing interfaces. 
</li>
</ul><p>
	
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol operations</h3>

<p> This short section describe the operation of the protocol.
</p>
<p> The tunnel component on a MN is initially configured with:
      <br />
<br />
 
	  
	  </p>
<ul class="text">
<li> The IPv4 address of the tunnel gateway associated with
	    its HA 
</li>
<li> A /80 prefix created as described in previous section.
</li>
</ul><p>
      
</p>
<p>When a MN gets IPv4 connectivity (IPv4 address and route), it
      selects a random 48 bits value. It concatenates this values to 
      its configured /80 prefix and installs the address on the tunnel
      interface. A default route is configured for IPv6 traffic to
      flow via this tunnel. A UDP socket is created for further
      emission to the HA IPv4 address.
</p>
<p>At that point, if the MIPv6 module decides to use the newly
      configured address as CoA (e.g. this is the only one available
      at the moment on the MN), it sends an IPsec-protected Binding
      Update message to its HA (or an IKE packet for negotiating IPsec
      SA for protecting the Binding Update message). The packet is
      routed via the tunnel interface and sent to the tunnel GW via
      the UDP socket. 
</p>
<p>The tunnel GW in front (or on) the HA receives the IPv4
      packet and process it after some sanity checks on the
      addresses (as described in previous section). It creates a
      temporary state containing the addresses and ports and forwards
      the packet to the final destination (the HA). 
</p>
<p>The HA processes the packet and sends a reply to the MN
      (IPsec protected BA, IKE packet, ...). The tunnel gateway
      handles that packet and first verifies if an active state exists 
      for that destination. If it is the case, the packet is forwarded
      to the remote IPv4 NAT GW using the parameters available in the
      state. If no active state exists, then, a lookup in the
      temporary states is performed: if one is found, it is marked
      active and used. 
</p>
<p>Temporary states are garbage-collected often. Active states
      are garbage-collected less often and updated when traffic is
      exchanged in both directions. 
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Pros and cons</h3>

<p> This short section provides the pros and cons of the
      approach.
</p>
<p>The approach described in this memo is simple, standalone
      and transparent both on the MN and the HA. It does not
      require any changes to the MIPv6, IKE or IPsec code running on
      both compoments. It is fully compatible with NEMO.
</p>
<p> Unlike DSMIPv6, as the approach does not modify MIPv6
      implementations, it does not extend MIPv6 protocol to
      support communications with IPv4 peers. NAT64 may be used at the
      edge of the Home Network to allow communications with IPv4
      peers. Additionally, DSMIPv6 provides IPv4 address stability to
      the MN (i.e. an IPv4 HoA). The approach described in this memo
      does not provide that either. In most environments, IPv4 address
      stability is usually not needed or useful because nodes are
      usually provisioned with private IPv4 address and have for that
      reason limited reachability outside their private domain.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Preventing DoS</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Against the MN</h3>

<p> Nothing is done to prevent an attacker located on the
	 path between the MN and the tunnel GW. Because such an
	 attacker has access to all the traffic exchanged with the
	 tunnel GW and the HA, there is not much that can be done.
</p>
<p>Nonetheless, the protocol provides protection for the MN
	 against off-path attackers. This is done in order to avoid
	 such an attacker to redirect traffic expected for the MN to a
	 controlled location.
</p>
<p> Protection against such attacks is obtained by
	 randomizing the last 48 bits of the interface identifier. A
	 new value is selected each time the MN changes its point of
	 attachment to the IPv4 network.
</p>
<p> It would also be possible to change that value more often
	 if needed. 
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Against the HA</h3>

<p> The access via the tunnel GW is not expected to open
	  additional DoS possibilities against the HA.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
Against the GW</h3>

<p>The Gateway is basically a single point of failure for
	  the MN which use it as their connection mean to their HA
	  from IPv4 network. If an attacker manages to perform a DoS
	  against the tunnel GW, this may prevent legitimate peers to
	  access their HA. 
</p>
<p>In order to prevent that, care is needed when
	  implementing the tunnel GW. Rate limiting and garbage
	  collection can be used for that purpose. 
</p>
<p> When a packet is received from a new IPv4 address (port
	  does not matter), some initial sanity checks are performed
	  on the packet (IPv4 address is public, IPv6 destination
	  address is HA address, IPv6 address is from the configured
	  ULA prefix, ...).
</p>
<p> After that initial validation of the packet, a state is
	  recorded, containing the IPv4 source @, the UDP source port
	  and the IPv6 source address of the packet. Such a state
	  should be associated a very low (few ms) garbage collection
	  timer. The value should be configured based on the
	  environment in which the tunnel GW is deployed: it should
	  basically match the expected processing time of a packet on
	  the HA (first IKE packet, BU, ...). 
</p>
<p> Creation of such states should also be rate-limited on a
	  per IPv4 address basis (not considering the source port):
	  this would prevent an individual attacker to perform a DoS
	  against the service. It would basically require her to have
	  access to a set of bot. The upper limit to use per IPv4
	  address is not specified in this memo. It should be
	  configured locally based on the environment. It may be
	  possible for some deployments to expect multiple
	  simultaneous connections originatig from the same NAT GW. In
	  all cases, that number is expected to be low. 
</p>
<p> When a packet is received by the tunnel GW from the HA,
	  a lookup is performed to check if a valid state exists for
	  the IPv6 destination address. If one is found, it provides
	  the IPv4 destination address and port of the NAT GW
	  associated with that IPv6 address. If it does not yet exist,
	  then a lookup for the address in the pending states is
	  performed. If one is found, it becomes active. The packet is
	  forwarded to the remote GW on the given IPv4 address and UDP
	  port. Garbage collecting for that state is activated: the
	  purpose is for state to be removed if no traffic is
	  exchanged in both direction for more than the expected NAT
	  GW timeout. The maintenance of the state is left to the
	  MN as described in a previous section of the document.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.4"></a><h3>5.1.4.&nbsp;
Against the Infrastructure</h3>

<p> An attacker may want to use the tunnel GW to create
	  amplification attacks against elements of the IPv4
	  infrastructure. For the reasons explained above, an attacker
	  will not be able to redirect a MN's traffic to a controlled
	  address. But the HA is still expected to reply to some
	  unauthenticated probes. For instance, if an attacker targets
	  it's IKE daemon via the tunnel GW, it will get an answer. If
	  it is able to spoof its source address, the response will be
	  sent to the spoofed source address. This kind of attack is
	  still already possible on the IPv4 infrastructure and the
	  attacker would not get additional gain in using the tunnel
	  GW for such a scenario.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3775">[RFC3775]</a></td>
<td class="author-text">Johnson, D., Perkins, C., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3775">Mobility Support in IPv6</a>,&rdquo; RFC&nbsp;3775, June&nbsp;2004 (<a href="http://www.ietf.org/rfc/rfc3775.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4193">[RFC4193]</a></td>
<td class="author-text">Hinden, R. and B. Haberman, &ldquo;<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>,&rdquo; RFC&nbsp;4193, October&nbsp;2005 (<a href="http://www.ietf.org/rfc/rfc4193.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5555">[RFC5555]</a></td>
<td class="author-text">Soliman, H., &ldquo;<a href="http://tools.ietf.org/html/rfc5555">Mobile IPv6 Support for Dual Stack Hosts and Routers</a>,&rdquo; RFC&nbsp;5555, June&nbsp;2009 (<a href="http://www.ietf.org/rfc/rfc5555.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="MIGRATE">[MIGRATE]</a></td>
<td class="author-text">Ebalard, A. and S. Decugis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ebalard-mext-pfkey-enhanced-migrate-00.txt">PF_KEY Extension as an Interface between Mobile IPv6
	and IPsec/IKE</a>,&rdquo; draft-ebalard-mext-pfkey-enhanced-migrate-00 (work in progress), August&nbsp;2008 (<a href="http://tools.ietf.org/id/draft-ebalard-mext-pfkey-enhanced-migrate-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4380">[RFC4380]</a></td>
<td class="author-text">Huitema, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4380">Teredo: Tunneling IPv6 over UDP through Network Address
	Translations (NATs)</a>,&rdquo; RFC&nbsp;4380, February&nbsp;2006 (<a href="http://www.ietf.org/rfc/rfc4380.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="http://www.ietf.org/rfc/rfc5389.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arnaud Ebalard</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">EADS Innovation Works</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">12, rue Pasteur - BP76</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suresnes  92152</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+33 1 46 97 30 28</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:arnaud.ebalard@eads.net">arnaud.ebalard@eads.net</a></td></tr>
</table>
</body></html>
