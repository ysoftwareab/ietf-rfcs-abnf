<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Control Messages Protocol for Use with Network Time Protocol Version 4</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 NTP Control Message Format">
<link href="#rfc.section.3" rel="Chapter" title="3 Status Words ">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 System Status Word ">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Peer Status Word">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Clock Status Word ">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Error Status Word">
<link href="#rfc.section.4" rel="Chapter" title="4 Commands">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the structure of the control messages used with the Network Time Protocol. These control messages can be used to monitor and control the Network Time Protocol application running on any IP network attached computer. The information in this informational RFC was originally described in Appendix B of RFC 1305." />
  <meta name="description" content="This document describes the structure of the control messages used with the Network Time Protocol. These control messages can be used to monitor and control the Network Time Protocol application running on any IP network attached computer. The information in this informational RFC was originally described in Appendix B of RFC 1305." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">D. L. . Mills</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">University of Delaware</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">K.F. O'Donoghue, Ed.</td>
</tr>
<tr>
<td class="left">Expires: April 26, 2012</td>
<td class="right">Internet Society</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 24, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Control Messages Protocol for Use with Network Time Protocol Version 4<br />
  <span class="filename">draft-odonoghue-ntpv4-control-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the structure of the control messages used with the Network Time Protocol. These control messages can be used to monitor and control the Network Time Protocol application running on any IP network attached computer. The information in this informational RFC was originally described in Appendix B of RFC 1305.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 26, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">NTP Control Message Format</a>
</li>
<li>3.   <a href="#rfc.section.3">Status Words </a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">System Status Word </a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Peer Status Word</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Clock Status Word </a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Error Status Word</a>
</li>
<li>4.   <a href="#rfc.section.4">Commands</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Editor's Note (to be removed prior to publication): The text below is taken directly from RFC 1305. Input is requested to update the text to reflect current practice. This is required to fully obsolete RFC 1305. </p>
<p id="rfc.section.1.p.2">In a comprehensive network-management environment, facilities are presumed available to perform routine NTP control and monitoring functions, such as setting the leap-indicator bits at the primary servers, adjusting the various system parameters and monitoring regular operations. Ordinarily, these functions can be implemented using a network-management protocol such as SNMP and suitable extensions to the MIB database. However, in those cases where such facilities are not available, these functions can be implemented using special NTP control messages described herein. These messages are intended for use only in systems where no other management facilities are available or appropriate, such as in dedicated-function bus peripherals. Support for these messages is not required in order to conform to this specification.</p>
<p id="rfc.section.1.p.3">The NTP Control Message has the value 6 specified in the mode field of the first octet of the NTP header and is formatted as shown below.  The format of the data field is specific to each command or response; however, in most cases the format is designed to be constructed and viewed by humans and so is coded in free-form ASCII. This facilitates the specification and implementation of simple management tools in the absence of fully evolved network-management facilities. As in ordinary NTP messages, the authenticator field follows the data field. If the authenticator is used the data field is zero-padded to a 32-bit boundary, but the padding bits are not considered part of the data field and are not included in the field count.</p>
<p id="rfc.section.1.p.4">IP hosts are not required to reassemble datagrams larger than 576 octets; however, some commands or responses may involve more data than will fit into a single datagram. Accordingly, a simple reassembly feature is included in which each octet of the message data is numbered starting with zero. As each fragment is transmitted the number of its first octet is inserted in the offset field and the number of octets is inserted in the count field. The more-data (M) bit is set in all fragments except the last.</p>
<p id="rfc.section.1.p.5">Most control functions involve sending a command and receiving a response, perhaps involving several fragments. The sender chooses a distinct, nonzero sequence number and sets the status field and R and E bits to zero. The responder interprets the opcode and additional information in the data field, updates the status field, sets the R bit to one and returns the three 32-bit words of the header along with additional information in the data field. In case of invalid message format or contents the responder inserts a code in the status field, sets the R and E bits to one and, optionally, inserts a diagnostic message in the data field.</p>
<p id="rfc.section.1.p.6">Some commands read or write system variables and peer variables for an association identified in the command. Others read or write variables associated with a radio clock or other device directly connected to a source of primary synchronization information. To identify which type of variable and association a 16-bit association identifier is used. System variables are indicated by the identifier zero. As each association is mobilized a unique, nonzero identifier is created for it. These identifiers are used in a cyclic fashion, so that the chance of using an old identifier which matches a newly created association is remote. A management entity can request a list of current identifiers and subsequently use them to read and write variables for each association.  An attempt to use an expired identifier results in an exception response, following which the list can be requested again.</p>
<p id="rfc.section.1.p.7">Some exception events, such as when a peer becomes reachable or unreachable, occur spontaneously and are not necessarily associated with a command. An implementation may elect to save the event information for later retrieval or to send an asynchronous response (called a trap) or both. In case of a trap the IP address and port number is determined by a previous command and the sequence field is set as described below.  Current status and summary information for the latest exception event is returned in all normal responses. Bits in the status field indicate whether an exception has occurred since the last response and whether more than one exception has occurred.</p>
<p id="rfc.section.1.p.8">Commands need not necessarily be sent by an NTP peer, so ordinary access-control procedures may not apply; however, the optional mask/match mechanism suggested elsewhere in this document provides the capability to control access by mode number, so this could be used to limit access for control messages (mode 6) to selected address ranges.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> NTP Control Message Format</h1>
<p id="rfc.section.2.p.1">The format of the NTP Control Message header, which immediately follows the UDP header, is shown in Figure 1. Following is a description of its fields. Bit positions marked as zero are reserved and should always be transmitted as zero.</p>
<p id="rfc.section.2.p.2">Version Number (VN): This is a three-bit integer indicating the NTP version number, currently three (3).</p>
<p id="rfc.section.2.p.3">Mode: This is a three-bit integer indicating the mode. It must have the value 6, indicating an NTP control message.</p>
<p id="rfc.section.2.p.4">Response Bit (R): Set to zero for commands, one for responses.</p>
<p id="rfc.section.2.p.5">Error Bit (E): Set to zero for normal response, one for error response.</p>
<p id="rfc.section.2.p.6">More Bit (M): Set to zero for last fragment, one for all others.</p>
<p id="rfc.section.2.p.7">Operation Code (Op): This is a five-bit integer specifying the command function. Values currently defined include the following:</p>
<div id="#rfc.figure.1"></div>
<pre>+-------+--------------------------------------------------+ 
|  Code |                     Meaning                      | 
+-------+--------------------------------------------------+ 
|   0   | reserved                                         | 
|   1   | read status command/response                     | 
|   2   | read variables command/response                  |  
|   3   | write variables command/response                 | 
|   4   | read clock variables command/response            | 
|   5   | write clock variables command/response           | 
|   6   | set trap address/port command/response           | 
|   7   | trap response                                    | 
|  8-31 | reserved                                         | 
+-------+--------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.2.p.9">Sequence: This is a 16-bit integer indicating the sequence number of the command or response.</p>
<p id="rfc.section.2.p.10">Status: This is a 16-bit code indicating the current status of the system, peer or clock, with values coded as described in following sections.</p>
<p id="rfc.section.2.p.11">Association ID: This is a 16-bit integer identifying a valid association.</p>
<p id="rfc.section.2.p.12">Offset: This is a 16-bit integer indicating the offset, in octets, of the first octet in the data area.</p>
<p id="rfc.section.2.p.13">Count: This is a 16-bit integer indicating the length of the data field, in octets.</p>
<p id="rfc.section.2.p.14">Data: This contains the message data for the command or response. The maximum number of data octets is 468.</p>
<p id="rfc.section.2.p.15">Authenticator (optional): When the NTP authentication mechanism is implemented, this contains the authenticator information defined in Appendix C of RFC 1305.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Status Words </h1>
<p id="rfc.section.3.p.1">Status words indicate the present status of the system, associations and clock. They are designed to be interpreted by network-monitoring programs and are in one of four 16-bit formats shown in Figure 6 and described in this section. System and peer status words are associated with responses for all commands except the read clock variables, write clock variables and set trap address/port commands. The association identifier zero specifies the system status word, while a nonzero identifier specifies a particular peer association. The status word returned in response to read clock variables and write clock variables commands indicates the state of the clock hardware and decoding software. A special error status word is used to report malformed command fields or invalid values.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> System Status Word </h1>
<p id="rfc.section.3.1.p.1">The system status word appears in the status field of the response to a read status or read variables command with a zero association identifier. The format of the system status word is as follows:</p>
<p id="rfc.section.3.1.p.2">Leap Indicator (LI): This is a two-bit code warning of an impending leap second to be inserted/deleted in the last minute of the current day, with bit 0 and bit 1, respectively, coded as follows:</p>
<div id="#rfc.figure.2"></div>
<pre>+------+------------------------------------------------------------+ 
|  LI  |                       Meaning                              | 
+------+------------------------------------------------------------+ 
|  00  | no warning                                                 | 
|  01  | read status command/response                               | 
|  10  | read variables command/response                            | 
|  11  | write variables command/response                           | 
+------+------------------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.3.1.p.4">Clock Source: This is a six-bit integer indicating the current synchronization source, with values coded as follows:</p>
<div id="#rfc.figure.3"></div>
<pre>+-------+-----------------------------------------------------------+ 
|  Code |                     Meaning                               | 
+-------+-----------------------------------------------------------+ 
|   0   | unspecified or unknown                                    | 
|   1   | Calibrated atomic clock (e.g.,, HP 5061)                  | 
|   2   | VLF (band 4) or LF (band 5) radio (e.g.,, OMEGA,, WWVB)   | 
|   3   | HF (band 7) radio (e.g.,, CHU,, MSF,, WWV/H)              | 
|   4   | UHF (band 9) satellite (e.g.,, GOES,, GPS)                | 
|   5   | local net (e.g.,, DCN,, TSP,, DTS)                        | 
|   6   | UDP/NTP                                                   | 
|   7   | UDP/TIME                                                  | 
|   8   | eyeball-and-wristwatch                                    | 
|   9   | telephone modem (e.g.,, NIST)                             | 
| 10-63 | reserved                                                  | 
+-------+-----------------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.3.1.p.6">System Event Counter: This is a four-bit integer indicating the number of system exception events occurring since the last time the system status word was returned in a response or included in a trap message. The counter is cleared when returned in the status field of a response and freezes when it reaches the value 15.</p>
<p id="rfc.section.3.1.p.7">System Event Code: This is a four-bit integer identifying the latest system exception event, with new values overwriting previous values, and coded as follows:</p>
<div id="#rfc.figure.4"></div>
<pre>+-------+---------------------------------------------------------------+ 
|  Code |                         Meaning                               | 
+-------+---------------------------------------------------------------+ 
|   0   | unspecified                                                   | 
|   1   | system restart                                                | 
|   2   | system or hardware fault                                      | 
|   3   | system new status word (leap bits or synchronization change)  | 
|   4   | system new synchronization source or stratum (sys.peer or     | 
|       |      sys.stratum change)                                      | 
|   5   | system clock reset (offset correction exceeds CLOCK.MAX)      | 
|   6   | system invalid time or date (see NTP specification)           | 
|   7   | system clock exception (see system clock status word)         | 
|  8-15 | reserved                                                      | 
+-------+---------------------------------------------------------------+</pre>
<p></p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Peer Status Word</h1>
<p id="rfc.section.3.2.p.1">A peer status word is returned in the status field of a response to a read status, read variables or write variables command and appears also in the list of association identifiers and status words returned by a read status command with a zero association identifier. The format of a peer status word is as follows:</p>
<p id="rfc.section.3.2.p.2">Peer Status: This is a five-bit code indicating the status of the peer determined by the packet procedure, with bits assigned as follows:</p>
<div id="#rfc.figure.5"></div>
<pre>+-------------+------------------------------------------------------------+ 
| Peer Status |                      Meaning                               | 
+-------------+------------------------------------------------------------+ 
|      0      | configured (peer.config)                                   | 
|      1      | authentication enabled (peer.authenable)                   | 
|      2      | authentication okay (peer.authentic)                       | 
|      3      | reachability okay (peer.reach &lt;F128M&gt;?F255D&gt; 0)            | 
|      4      | reserved                                                   | 
+-------------+------------------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.3.2.p.4">Peer Selection (Sel): This is a three-bit integer indicating the status of the peer determined by the clock-selection procedure, with values coded as follows:</p>
<div id="#rfc.figure.6"></div>
<pre>+-------+---------------------------------------------------------------------+ 
|  Sel  |                        Meaning                                      | 
+-------+---------------------------------------------------------------------+ 
|   0   | rejected                                                            | 
|   1   | passed sanity checks (tests 1 through 8 in Section 3.4.3)           | 
|   2   | passed correctness checks (intersection algorithm in Section 4.2.1) | 
|   3   | passed candidate checks (if limit check implemented)                | 
|   4   | passed outlyer checks (clustering algorithm in Section 4.2.2)       | 
|   5   | current synchronization source; max distance exceeded               | 
|       |      (if limit check implemented)                                   | 
|   6   | current synchronization source; max distance okay                   | 
|   7   | reserved                                                            | 
+-------+---------------------------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.3.2.p.6">Peer Event Counter: This is a four-bit integer indicating the number of peer exception events that occurred since the last time the peer status word was returned in a response or included in a trap message. The counter is cleared when returned in the status field of a response and freezes when it reaches the value 15. Peer Event Code: This is a four-bit integer identifying the latest peer exception event, with new values overwriting previous values, and coded as follows:</p>
<div id="#rfc.figure.7"></div>
<pre>+--------+---------------------------------------------------------------------+ 
| Peer   |                                                                     | 
| Event  |                            Meaning                                  | 
| Code   |                                                                     | 
+--------+---------------------------------------------------------------------+ 
|    0   | unspecified                                                         | 
|    1   | peer IP error                                                       | 
|    2   | peer authentication failure (peer.authentic bit was one now zero)   | 
|    3   | peer unreachable (peer.reach was nonzero now zero)                  | 
|    4   | peer reachable (peer.reach was zero now nonzero)                    | 
|    5   | peer clock exception (see peer clock status word)                   | 
|  6-15  | reserved                                                            | 
+--------+---------------------------------------------------------------------+</pre>
<p></p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Clock Status Word </h1>
<p id="rfc.section.3.3.p.1">There are two ways a reference clock can be attached to a NTP service host, as an dedicated device managed by the operating system and as a synthetic peer managed by NTP. As in the read status command, the association identifier is used to identify which one, zero for the system clock and nonzero for a peer clock. Only one system clock is supported by the protocol, although many peer clocks can be supported.  A system or peer clock status word appears in the status field of the response to a read clock variables or write clock variables command.  This word can be considered an extension of the system status word or the peer status word as appropriate. The format of the clock status word is as follows:</p>
<p id="rfc.section.3.3.p.2">Clock Status: This is an eight-bit integer indicating the current clock status, with values coded as follows:</p>
<div id="#rfc.figure.8"></div>
<pre>+--------------+------------------------------------------------------------+ 
| Clock Status |                      Meaning                               | 
+--------------+------------------------------------------------------------+ 
|       0      | clock operating within nominals                            | 
|       1      | reply timeout                                              | 
|       2      | bad reply format                                           | 
|       3      | hardware or software fault                                 | 
|       4      | propagation failure                                        | 
|       5      | bad date format or value                                   | 
|       6      | bad time format or value                                   | 
|     7-255    | reserved                                                   | 
+--------------+------------------------------------------------------------+</pre>
<p></p>
<p id="rfc.section.3.3.p.4">Clock Event Code: This is an eight-bit integer identifying the latest clock exception event, with new values overwriting previous values. When a change to any nonzero value occurs in the radio status field, the radio status field is copied to the clock event code field and a system or peer clock exception event is declared as appropriate.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Error Status Word</h1>
<p id="rfc.section.3.4.p.1">An error status word is returned in the status field of an error response as the result of invalid message format or contents. Its presence is indicated when the E (error) bit is set along with the response (R) bit in the response. It consists of an eight-bit integer coded as follows:</p>
<div id="#rfc.figure.9"></div>
<pre>+--------------+------------------------------------------------------------+ 
| Error Status |                    Meaning                                 | 
+--------------+------------------------------------------------------------+ 
|       0      | unspecified                                                | 
|       1      | authentication failure                                     | 
|       2      | invalid message length or format                           | 
|       3      | invalid opcode                                             | 
|       4      | unknown association identifier                             | 
|       5      | unknown variable name                                      | 
|       6      | invalid variable value                                     | 
|       7      | administratively prohibited                                | 
|     8-255    | reserved                                                   | 
+--------------+------------------------------------------------------------+</pre>
<p></p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Commands</h1>
<p id="rfc.section.4.p.1">Commands consist of the header and optional data field shown in Figure 6 of RFC 1305. When present, the data field contains a list of identifiers or assignments in the form &lt;&lt;identifier&gt;&gt;[=&lt;&lt;value&gt;&gt;],&lt;&lt;identifier&gt;&gt;[=&lt;&lt;value&gt;&gt;],...  where &lt;&lt;identifier&gt;&gt; is the ASCII name of a system or peer variable specified in Table 2 or Table 3 of RFC 1305 and &lt;&lt;value&gt;&gt; is expressed as a decimal, hexadecimal or string constant in the syntax of the C programming language. Where no ambiguity exists, the &lt;169&gt;sys.&lt;170&gt; or &lt;169&gt;peer.&lt;170&gt; prefixes shown in Table 2 or Table 4 of RFC 1305 can be suppressed.  Whitespace (ASCII nonprinting format effectors) can be added to improve readability for simple monitoring programs that do not reformat the data field. Internet addresses are represented as four octets in the form [n.n.n.n], where n is in decimal notation and the brackets are optional.  Timestamps, including reference, originate, receive and transmit values, as well as the logical clock, are represented in units of seconds and fractions, preferably in hexadecimal notation, while delay, offset, dispersion and distance values are represented in units of milliseconds and fractions, preferably in decimal notation. All other values are represented as-is, preferably in decimal notation.</p>
<p id="rfc.section.4.p.2">Implementations may define variables other than those listed in Table 2 or Table 3 of RFC 1305. Called extramural variables, these are distinguished by the inclusion of some character type other than alphanumeric or &lt;169&gt;.&lt;170&gt; in the name. For those commands that return a list of assignments in the response data field, if the command data field is empty, it is expected that all available variables defined in Table 3 or Table 4 of RFC 1305 will be included in the response. For the read commands, if the command data field is nonempty, an implementation may choose to process this field to individually select which variables are to be returned.</p>
<p id="rfc.section.4.p.3">Commands are interpreted as follows:</p>
<p id="rfc.section.4.p.4">Read Status (1): The command data field is empty or contains a list of identifiers separated by commas. The command operates in two ways depending on the value of the association identifier. If this identifier is nonzero, the response includes the peer identifier and status word.  Optionally, the response data field may contain other information, such as described in the Read Variables command. If the association identifier is zero, the response includes the system identifier (0) and status word, while the data field contains a list of binary-coded pairs &lt;&lt;association identifier&gt;&gt; &lt;&lt;status word&gt;&gt;, one for each currently defined association.</p>
<p id="rfc.section.4.p.5">Read Variables (2): The command data field is empty or contains a list of identifiers separated by commas. If the association identifier is nonzero, the response includes the requested peer identifier and status word, while the data field contains a list of peer variables and values as described above. If the association identifier is zero, the data field contains a list of system variables and values. If a peer has been selected as the synchronization source, the response includes the peer identifier and status word; otherwise, the response includes the system identifier (0) and status word.</p>
<p id="rfc.section.4.p.6">Write Variables (3): The command data field contains a list of assignments as described above. The variables are updated as indicated.  The response is as described for the Read Variables command.</p>
<p id="rfc.section.4.p.7">Read Clock Variables (4): The command data field is empty or contains a list of identifiers separated by commas. The association identifier selects the system clock variables or peer clock variables in the same way as in the Read Variables command. The response includes the requested clock identifier and status word and the data field contains a list of clock variables and values, including the last timecode message received from the clock.</p>
<p id="rfc.section.4.p.8">Write Clock Variables (5): The command data field contains a list of assignments as described above. The clock variables are updated as indicated. The response is as described for the Read Clock Variables command.</p>
<p id="rfc.section.4.p.9">Set Trap Address/Port (6): The command association identifier, status and data fields are ignored. The address and port number for subsequent trap messages are taken from the source address and port of the control message itself. The initial trap counter for trap response messages is taken from the sequence field of the command. The response association identifier, status and data fields are not significant. Implementations should include sanity timeouts which prevent trap transmissions if the monitoring program does not renew this information after a lengthy interval.</p>
<p id="rfc.section.4.p.10">Trap Response (7): This message is sent when a system, peer or clock exception event occurs. The opcode field is 7 and the R bit is set. The trap counter is incremented by one for each trap sent and the sequence field set to that value. The trap message is sent using the IP address and port fields established by the set trap address/port command. If a system trap the association identifier field is set to zero and the status field contains the system status word. If a peer trap the association identifier field is set to that peer and the status field contains the peer status word. Optional ASCII-coded information can be included in the data field.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">Editor's Note: To be reviewed by the working group prior to completion.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Editor's Note: To be supplied by the working group prior to completion.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p></p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dr. David L. Mills</span> 
	  <span class="n hidden">
		<span class="family-name">Mills</span>
	  </span>
	</span>
	<span class="org vcardline">University of Delaware </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Newark</span>,  
		<span class="region">Deleware</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mills@udel.edu">mills@udel.edu</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Karen O'Donoghue</span> editor
	  <span class="n hidden">
		<span class="family-name">O'Donoghue</span>
	  </span>
	</span>
	<span class="org vcardline">Internet Society</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">King George</span>,  
		<span class="region">Virginia</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:odonoghue@isoc.org">odonoghue@isoc.org</a></span>

  </address>
</div>

</body>
</html>