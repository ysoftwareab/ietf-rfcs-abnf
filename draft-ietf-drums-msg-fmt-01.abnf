CTL             =       %d1..%d31 /     ; Control characters, inc. delete
                        %d127

NO-WS-CTL       =       %d1..%d8 /      ; US-ASCII control characters 
                        %d11 /          ;  which do not include the
                        %d12 /          ;  carriage return, linefeed,
                        %d14..%d31 /    ;  and whitespace characters
                        %d127

text            =       %d1..%d9 /      ; Characters excluding CR and LF
                        %d11..%d12 /
                        %d14..%d127 /
                        obs-text

specials        =       "(" / ")" /     ; Special characters used in other
                        "<" / ">" /     ;  parts of the syntax
                        "[" / "]" /
                        ":" / ";" /
                        <"> / "\" /
                        "," / "." /
                        "@"

quoted-pair     =       ("\" text) / obs-qp

WS              =       SPACE / HTAB            ; Whitespace characters
FWS             =       (*WS [CRLF WS] *WS) /   ; Folding white-space
                        obs-FWS

ctext           =       NO-WS-CTL /     ; Non-white-space controls

                        %d33..%d39 /    ; The rest of the US-ASCII
                        %d42..%d91 /    ;  characters not including "(",
                        %d93..%d127     ;  ")", or "\"

comment         =       "(" *(FWS (ctext / quoted-pair / comment)) ")"

CFWS            =       WS / comment / (FWS *(comment FWS))

atext           =       ALPHA / DIGIT / ; Any character except CTL,
                        "!" / "#" /     ;  SPACE, and specials.
                        "$" / "%" /     ;  Used for atoms
                        "&" / "'" /
                        "*" / "+" /
                        "-" / "/" /
                        "=" / "?" /
                        "^" / "_" /
                        "`" / "{" /
                        "|" / "}" /
                        "~"

atom            =       *CFWS 1*atext *CFWS

dot-atom        =       *CFWS 1*(atext ["." atext]) *CFWS

qtext           =       NO-WS-CTL /     ; Non-white-space controls

                        %d33 /          ; The rest of the US-ASCII
                        %d35..%d91 /    ;  characters not including "\"
                        %d93..%d127     ;  or the quote character

quoted-string   =       *CFWS <"> *(FWS (qtext / quoted-pair)) <"> *CFWS

word            =       atom / quoted-string

phrase          =       1*word

unstructured    =       *(FWS text) / obs-unstruct

date-time       =       [ day-of-week "," ] date 1*CFWS time

day-of-week     =       1*CFWS day-name 1*CFWS

day-name        =       "Mon" / "Tue" / "Wed" / "Thu" /
                        "Fri" / "Sat" / "Sun"

date            =       day month year

year            =       (*CFWS 4*DIGIT *CFWS) / obs-year

month           =       1*CFWS month-name 1*CFWS

month-name      =       "Jan" / "Feb" / "Mar" / "Apr" /
                        "May" / "Jun" / "Jul" / "Aug" /
                        "Sep" / "Oct" / "Nov" / "Dec"

day             =       *CFWS 1*2DIGIT *CFWS

time            =       time-of-day *CFWS zone

time-of-day     =       hour ":" minute [ ":" second ]

hour            =       *CFWS 2DIGIT *CFWS

minute          =       *CFWS 2DIGIT *CFWS

second          =       *CFWS 2DIGIT *CFWS

zone            =       (( "+" / "-" ) 4DIGIT) / obs-zone

address         =       mailbox / group

mailbox         =       phrase-addr / addr-spec / obs-mailbox

phrase-addr     =       [phrase] *CFWS "<" addr-spec ">" *CFWS

group           =       phrase ":" #mailbox ";" *CFWS

addr-spec       =       local-part "@" domain

local-part      =       dot-atom / quoted-string / obs-local-part

domain          =       dot-atom / domain-literal / obs-domain

domain-literal  =       *CFWS "[" *(FWS (dtext / quoted-pair)) "]" *CFWS

dtext           =       NO-WS-CTL /     ; Non-white-space controls

                        %d33..%d90 /    ; The rest of the US-ASCII
                        %d94..%d127     ;  characters not including "[",
                                        ;  "]", or "\"

message         =       (fields / obs-fields)
                        [CRLF body]

body            =       *(*998text CRLF) *998text / obs-body

fields          =       {[trace]
                        *resent
                        orig-date
                        originator
                        [identifier]
                        [informational]
                        [destination]
                        *optional-field}

orig-date       =       "Date:" date-time CRLF

originator      =       {(from / sender)
                         [reply-to]}

reply-to        =       "Reply-To:" 1#mailbox CRLF

sender          =       {"Sender:" mailbox CRLF
                         "From:" 1#mailbox CRLF}

from            =       "From:" mailbox CRLF

destination     =       {["To:" 1#address CRLF]
                         ["Cc:" 1#address CRLF]
                         ["Bcc:" 1#address CRLF]}

identifier      =       {["Message-ID:" msg-id CRLF]
                         ["In-Reply-To:" msg-id CRLF]
                         ["References:" msg-id *(*CFWS msg-id) CRLF]}

msg-id          =       "<" addr-spec ">"

informational   =       {["Subject:" unstructured CRLF]
                         ["Comments:" unstructured CRLF]
                         ["Keywords:" 1#phrase CRLF]}

resent          =       {resent-orig CRLF
                         "Resent-Date:" date-time CRLF
                         ["Resent-To:" 1#address CRLF]
                         ["Resent-Cc:" 1#address CRLF]
                         ["Resent-Bcc:" 1#address CRLF]
                         ["Resent-Message-ID:" 1#address CRLF]

resent-orig     =       ("Resent-From:" mailbox CRLF) /
                         {"Resent-Sender:" mailbox CRLF
                          "Resent-From:" 1#mailbox CRLF}

trace           =       [return]
                        1*received

return          =       "Return-Path:" *(CFWS text) CRLF

received        =       "Received:" *(CFWS text) CRLF

optional-field  =       field-name ":" unstructured

field-name      =       1*ftext

ftext           =       %d33..%d57 /            ; Any character except CTL,
                        %d58..%d126             ;  SPACE, and ":".

obs-qp          =       "\" CHAR                ; CHAR is %d0..%d127

obs-body        =       *(*998obs-text CRLF) *998obs-text

obs-unstruct    =       *(FWS / obs-text)

obs-text        =       *(obs-char /
                          (*CR obs-char) /
                          (*LF *CR obs-char))

obs-char        =       text / %d0              ; %d0..%d127 except CR and LF

obs-FWS         =       *(WS [CRLF WS])


obs-year        =       2*DIGIT

obs-zone        =       "UT" / "GMT" /          ; Universal Time
                                                ; North American : UT
                        "EST" / "EDT" /         ; Eastern:  - 5/ - 4
                        "CST" / "CDT" /         ; Central:  - 6/ - 5
                        "MST" / "MDT" /         ; Mountain: - 7/ - 6
                        "PST" / "PDT" /         ; Pacific:  - 8/ - 7
                        ("A".."I" / "K".."Z")   ; Military zone

obs-mailbox     =       obs-addr-spec / [obs-phrase] route-addr

route-addr      =       *CFWS "<" [route] obs-addr-spec ">" *CFWS

route           =       *CFWS 1#("@" obs-domain) ":" *CFWS

obs-addr-spec   =       obs-local-part "@" obs-domain

obs-local-part  =       quoted-string / atom *("." atom)

obs-domain      =       atom *("." atom) / domain-literal

obs-fields      =       {[obs-trace]
                        obs-orig-date
                        obs-originator
                        *obs-destination
                        *obs-identifier
                        *obs-information
                        *obs-resent
                        *obs-optional}

obs-trace       =       {[obs-return CRLF]
                        1*obs-received}

obs-return      =       "Return-Path" *CFWS ":" *(obs-text / CFWS) CRLF

obs-received    =       "Received" *CFWS ":" *(obs-text / CFWS) CRLF

obs-orig-date   =       "Date" *CFWS ":" date-time CRLF

obs-originator  =       {(obs-from / obs sender)
                         [obs-reply-to]

obs-from        =       "From" *CFWS ":" obs-mailbox CRLF

obs-sender      =       {"Sender" *CFWS ":" obs-mailbox CRLF
                         "From" *CFWS ":" 1#obs-mailbox CRLF}

obs-reply-to    =       "Reply-To" *CFWS ":" 1#obs-mailbox CRLF

obs-destination =       {["To" *CFWS ":" 1#address CRLF]
                         ["Cc" *CFWS ":" 1#address CRLF]
                         ["Bcc" *CFWS ":" 1#address CRLF]}

obs-identifier  =       {["Message-ID" *CFWS ":" obs-msg-id CRLF]
                         ["In-Reply-To" *CFWS ":" *(phrase / obs-msg-id) 
obs-msg-id      =       *CFWS "<" obs-addr-spec ">" *CFWS

obs-information =       {["Subject" *CFWS ":" obs-unstruct CRLF]
                         ["Comments" *CFWS ":" obs-unstruct CRLF]
                         ["Keywords" *CFWS ":" 1#phrase CRLF]}

obs-resent      =       {obs-resent-orig CRLF
                         "Resent-Date" *CFWS ":" obs-date-time CRLF
                         ["Resent-To" *CFWS ":" 1#address CRLF]
                         ["Resent-Cc" *CFWS ":" 1#address CRLF]
                         ["Resent-Bcc" *CFWS ":" 1#address CRLF]
                         ["Resent-Message-ID" *CFWS ":" 1#address CRLF]}

obs-resent-orig =       {("Resent-From" *CFWS ":" obs-mailbox CRLF /
                          {"Resent-Sender" *CFWS ":" obs-mailbox CRLF
                           "Resent-From" *CFWS ":" 1#mailbox CRLF})
                         ["Resent-Reply-To" *CFWS ":" 1#address CRLF]}

obs-optional    =       field-name *CFWS ":" obs-unstruct CRLF

