<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Opaque MSRP Path Uri</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Opaque MSRP Path Uri">
<meta name="keywords" content="MSRP Topology Hiding, Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIMPLE</td><td class="header">D. MacDonald</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">CounterPath Solutions, Inc.</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">March 10, 2009</td></tr>
<tr><td class="header">Expires: September 11, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Opaque MSRP Path Uri<br />draft-macdonald-simple-msrp-opaque-path-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 11, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The Message Session Relay Protocol(MSRP) does not allow privacy and
      topology hiding, such that MSRP users can hide the IP Address of their
      systems. This limitation is due to the fact that MSRP Path headers
      contain physical IP addresses. This document describes a mechanism which
      adds a level of indirection to allow privacy and topology hiding, to
      prevent remote parties and a man-in-the-middle from learning the IP 
      Address and port information of the MSRP client.  It also defines the
      option tag msrp-opaque, to indicate such support.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Applicability<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#anchor3">3.</a>&nbsp;
Overview of Operations<br />
<a href="#anchor4">4.</a>&nbsp;
MSRP Opaque URI<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Opaque URI Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Generating an Opaque Uri<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
MSRP URI Parameter<br />
<a href="#anchor8">5.</a>&nbsp;
SIP Option Tag<br />
<a href="#anchor9">6.</a>&nbsp;
Backwards Compatibility with RFC 4975 and 4976<br />
<a href="#anchor10">7.</a>&nbsp;
Example Scenario<br />
<a href="#anchor11">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Applicability</h3>

<p>This technique may be used in any MSRP deployment where all MSRP
      endpoints support the <a class='info' href='#I-D.ietf-simple-msrp-acm'>[I&#8209;D.ietf&#8209;simple&#8209;msrp&#8209;acm]<span> (</span><span class='info'>Holmberg, C. and S. Blau, &ldquo;An Alternative Connection Model for the Message Session Relay Protocol  (MSRP),&rdquo; January&nbsp;2009.</span><span>)</span></a>  extension 
      when routing to/from on an MSRP URI.  Not all MSRP endpoints must support
      this opaque extension; they only need to support draft-ACM.
      This document only describes an SDP based mechanism for binding a
      physical address to an opaque MSRP URI that limits possible topologies.
      <a class='info' href='#RFC4976'>[RFC4976]<span> (</span><span class='info'>Jennings, C., Mahy, R., and A. Roach, &ldquo;Relay Extensions for the Message Sessions Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a> MSRP relays will not be able to
      route from opaque MSRP URI's.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>A frequent requirement of network architectures is to hide the
      systems of the core network from external user agents. It is also often 
      desirable to hide the IP address of a user agent from other user agents 
      in the network. This is usually accomplished using a SIP B2BUA or other 
      relay element. MSRP does not allow an efficient approach to this problem
      because the payload of the protocol contains physical IP addresses, and
      thus the B2BUA needs to modify MSRP messages in order to hide topology
      information.
</p>
<p>Furthermore, users of MSRP or their system administrators may not wish
      to provide remote MSRP agents the IP Address and port of their local MSRP
      host machines, for security or anonymity reasons.  Revealing such might
      expose the host machines to external attacks, even through NATs/Firewalls.
      One means of providing user anonymity is by using a TURN server; however in
      practice there are few TURN servers available, and other relay agents such
      as SBC's may already be in the path.  The opaque MSRP URI concept defined
      in this draft is usable with a TURN server, SBC, or MSRP B2BUA.  It is not
      usable with MSRP Relays unless their functionality is extended.
</p>
<p>This specification defines an opaque MSRP URI, that does not contain
      a routable IP address. The opaque URI is a mapping to a physical address
      that is exchanged outside the MSRP protocol. This allows topology hiding
      without re-writing any MSRP messages between the MSRP User Agents.
</p>
<p>The opaque URI is a pointer to an externally conveyed routable URI.
      This document describes a mechanism to convey the routable URI in the
      SDP offer/answer exchange used to initiate the MSRP session, based on the 
      changes in draft-ACM. The opaque URI is used in the MSRP message headers, 
      while the transport addressing conveyed in SDP is used for the transport 
      layer connections.
</p>
<p>The basic concept is that instead of indicating the MSRP transport
      connection information in the MSRP "path" SDP attribute, and using such in
      the to-path/from-path MSRP headers, a pseudo-random string is used
      instead: the MSRP opaque URI. An MSRP client inserts a pseudo-random
      MSRP opaque URI value in the SDP MSRP path attribute, and uses this
      value in MSRP messages for its path headers. Actual transport connection
      information is instead conveyed in the standard SDP connection and media
      lines, per draft-ACM.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview of Operations</h3>

<p>An MSRP User Agent following this document's mechanism will generate
      a SIP INVITE for an MSRP-based media session by populating the SDP
      connection line and media line with transport addressing information, as
      is done for COMEDIA and draft-ACM, along with an MSRP opaque URI for 
      the SDP MSRP path attribute. It will also insert the new 'msrp-opaque' 
      option tag into a SIP Require header field.
</p>
<p>The SIP UAS receiving the INVITE request will see the MSRP URI is an
      opaque type, due to a new 'opaque' URI parameter defined later in this
      document. It will then respond with an SDP answer also indicating an
      MSRP opaque URI, with its actual transport address information in the
      SDP connection and media lines.
</p>
<p>Per <a class='info' href='#RFC4975'>[RFC4975]<span> (</span><span class='info'>Campbell, B., Mahy, R., and C. Jennings, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a>, the UAC will initiate
      the TCP connection to the UAS, however per draft-ACM the TCP
      connection would use the SDP connection and media lines for addressing
      info instead of the MSRP URI directly.
</p>
<p>The MSRP messages generated by the UAC and UAS MUST continue to use
      the MSRP path attribute opaque URI for the to/from-path MSRP headers.
      Since the URI is not directly dereferenceable for transport addressing,
      each UA maintains an internal binding of MSRP opaque-URI to connection
      transport information.
</p>
<p>If the TCP connection for MSRP were to go directly from the UAC to
      the UAS, then clearly one could simply learn the UA addressing on the
      wire, or by looking at SDP information, and anonymity would not be
      achieved. It is expected that in typical deployment the media transport
      information is obfuscated through some other means, such as SBC's or
      ALG's performing media relay functions, but that is beyond
      the scope of this document: the goal of this document is to provide
      anonymity for MSRP, not SIP nor SDP.
</p>
<p>The approach defined in this document does not fit with the MSRP
      Relay model of RFC 4976, where an MSRP client can use a special
      intermediary called an "MSRP Relay".  Instead, this mechanism works 
      with MSRP Application  Servers, acting as full MSRP Back-to-Back User 
      Agents, or with typical SIP intermediate types of devices, such as SBCs 
      and ALGs. One of the goals of this specification is to be able to 
      make MSRP work across such intermediaries.
</p>
<p>[Note: the MSRP opaque URI model *could* be made to work with MSRP
      Relays, if the Relays were to know about such URIs in advance - it is
      TBD whether it is worth specifying how that could/should work]
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
MSRP Opaque URI</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Opaque URI Format</h3>

<p>The opaque URI is an MSRP URI that has a domain name in the
        .invalid TLD, and an 'opaque' URI parameter as defined later. A
        globally unique identifier is generated and encoded as a URI in the
        .invalid TLD. For example:
        path:msrp://f7jey483rydfhkyerky3.invalid:7394/2s93u93udj;tcp;opaque.
        The opaque URI pointer is the first portion of the URI before
        .invalid: f7jey483rydfhkyerky3. The port is arbitrary. [Note:
        Should there be a fixed value for the port?]
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Generating an Opaque Uri</h3>

<p>The identifying portion of the opaque uri is the portion up to
        .invalid. This portion should be cryptographically unique and MUST
        be encoded so it obeys rfc3986. Opaque URIs do not modify the grammar
        of rfc4975.
</p>
<p>TODO: determine generation scheme and encoding
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
MSRP URI Parameter</h3>

<p>This document defines a new MSRP URI parameter: "opaque". The
        opaque URI parameter indicates that this URI follows this
        specification, and MUST appear to identify an opaque URI whenever one
        is used. The ABNF for this parameter, following <a class='info' href='#RFC4975'>RFC4975<span> (</span><span class='info'>Campbell, B., Mahy, R., and C. Jennings, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a> [RFC4975], is as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
            URI-parameter = opaque-param / (token ["=" token])
            opaque-param  = "opaque"</pre></div>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
SIP Option Tag</h3>

<p>This specification registers a new SIP option tag, as per the
      guidelines in Section 27.1 of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>Name: msrp-opaque
</p>
<p>Description: This option-tag is used to identify UAs that support
      the mechanism defined in this document.
</p>
<p>SIP User Agents MUST include a Requires header field with the
      "msrp-opaque" option-tag when using an opaque URI in an SDP offer or
      answer in a SIP message.
</p>
<p>SIP User Agents SHOULD include a Supported header field with an the
      "msrp-opaque" option-tag if they support this specification but still
      wish to generate a non-opaque URI in the SDP. This allows the UAS to
      reject the request with a Require header field containing "msrp-opaque"
      to indicate the UAS requires the UAC to use an opaque URI; and this
      allows for backwards compatibility as described in the next section.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Backwards Compatibility with RFC 4975 and 4976</h3>

<p>When a UAC initiates an MSRP session, it may need to interoperate
      with legacy devices based on RFC 4975 and 4976. This can be accomplished
      with the opaque URI mechanism in the following way, as long as the UAC
      does not itself require anonymization of its URI: the UAC generates a
      legacy RFC 4975 MSRP URI, but adds the 'opaque' parameter to the end of
      it, and sets the SDP connection and media lines to be the real transport
      addresses as well, and adds a Supported option tag of "msrp-opaque".
</p>
<p>If the answering UAS only supports RFC 4975 and/or 4976, it will
      ignore the opaque parameter and Supported option tag, and respond and
      act as per RFC 4975. If the UAS supports the opaque mechanism, and
      wishes to anonymize its MSRP URI, it responds with a real MSRP opaque
      URI, and a SIP Require header field with the "msrp-opaque" option
      tag.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Example Scenario</h3>

<p>In the following example, Alice invites Bob to an MSRP session. Alice
      does not wish her IP address to be known, as it conveys information
      about her location and might make her system vulnerable to attacks.
      Similarly, the Atlanta network has a policy of not exposing such
      details about their network or their users. In this case Alice and Bob
      are both at atlanta.example.com
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        Alice                Atlanta Network       Bob
        |                    |                   |
        |------INVITE-------&gt;| 1                 |
        |                    |------INVITE------&gt;| 2
        |                    |&lt;------200---------| 3
        |&lt;------200----------| 4                 |
        |-------ACK---------&gt;|                   |
        |                    |-------ACK--------&gt;|
        |                    |                   |

</pre></div>
<p>Message 1 is an INVITE where msrp-opaque is required and an opaque
      MSRP URI is used in the SDP.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        INVITE sip:bob@atlanta.example.com SIP/2.0
        To: &lt;sip:bob@atlnata.example.com&gt;
        From: &lt;sip:alice@atlanta.example.com&gt;;tag=786
        Call-ID: 3413an89KU
        Requires: msrp-opaque
        Content-Type: application/sdp
        -
        c=IN IP4 192.168.0.100
        m=message 12454 TCP/MSRP *
        a=path:msrp://f7jey483rydfhkyerky3.invalid.com:7394/jshA7weztas;tcp;opaque
</pre></div>
<p>The connection c-line of the SDP identifies Alice's actual transport
      address for the MSRP connection, and the media m-line port portion
      identifies the TCP port; as opposed to the msrp path attribute as
      defined in <a class='info' href='#RFC4975'>RFC4975<span> (</span><span class='info'>Campbell, B., Mahy, R., and C. Jennings, &ldquo;The Message Session Relay Protocol (MSRP),&rdquo; September&nbsp;2007.</span><span>)</span></a> [RFC4975]. They may be changed by
      intermediate nodes to point to an address:port on a TCP relay service in
      the Atlanta network.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        c=IN IP4 border.altanta.example.com
        m=message 22454 TCP/MSRP *
        a=path:msrp://f7jey483rydfhkyerky3.invalid.com:7394/jshA7weztas;tcp;opaque
</pre></div>
<p>The relevant portion on the SDP from Message 3. For simplicity, Bob's
      UA has been given a publicly reachable IP address.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        c=IN IP4 bob.altanta.example.com
        m=message 34313 TCP/MSRP *
        a=path:msrp://a6ghr7yv6egw33r.invalid.com:7394/kjhd37s2s20w2a;tcp;opaque
</pre></div>
<p>Which is re-written to point to the border element.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        c=IN IP4 border.altanta.example.com
        m=message 27784 TCP/MSRP *
        a=path:msrp://a6ghr7yv6egw33r.invalid.com:7394/kjhd37s2s20w2a;tcp;opaque
</pre></div>
<p>After this exchange is complete Alice will form a connection to the
      border.atlanta.example.com which will in turn connect to Bob's UA.
      border.atlanta.example.com acts as a simple TCP relay between Bob and
      Alice until the TCP connection is torn down by either party.
</p>
<p>While some of this functionality can be achieved with the MSRP relay
      specification, or by using TURN-TCP, this approach has its own
      advantages and disadvantages.
</p>
<p>Advantages: </p>
<blockquote class="text">
<p>The opaque-uri provides topology hiding. This can also be
          provided by TURN-TCP, but will end up w/ two TURN allocations being
          used.
</p>
<p>At the media level, the opaque-uri approach only requires a TCP
          relay that has no knowledge of MSRP.
</p>
<p>It is a small change for endpoints that already support
          MSRP.
</p>
</blockquote>

<p>Disadvantages: </p>
<blockquote class="text">
<p>Until the TCP relay has connected to the second peer(Bob), any
          MSRP requests from Alice must be rate-limited or cached. In
          practice, rate limiting seems to work well; if the connection to Bob
          fails, the connection to Alice would be torn down. This does not
          provide the same level of error reporting as MSRP-Relay.
</p>
<p>Mapping rules must be conveyed from the signal-plane(SIP/SDP) to
          the Media Plane(TCP relay)
</p>
</blockquote>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>Hiding host system IP Address and port information may be considered
      by some to be a form of anonymity or obfuscation for malevolent purposes, 
      but it actually represents a simple form of host protection.  SIP and
      MSRP User Agents are not just clients - they are servers as well, from
      both a protocol and use-case perspective.  SIP in particular typically
      uses a UDP socket, and even when using TCP, agents frequently run a listen
      server socket in order to receive inbound requests.  If the connection
      information of SIP or MSRP applications running on a host are revealed, the
      local user of the system and/or its administrators have no simple means by 
      which to prevent any device on the Internet from attempting to send messages
      to the host for malicious purposes.  For example, the NAT will have opened
      a port and created a binding for the SIP UDP port, and some NATs are fully
      conical and will allow any remote device to send packets in through their
      open bindings.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4975">[RFC4975]</a></td>
<td class="author-text">Campbell, B., Mahy, R., and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>,&rdquo; RFC&nbsp;4975, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4975.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4976">[RFC4976]</a></td>
<td class="author-text">Jennings, C., Mahy, R., and A. Roach, &ldquo;<a href="http://tools.ietf.org/html/rfc4976">Relay Extensions for the Message Sessions Relay Protocol (MSRP)</a>,&rdquo; RFC&nbsp;4976, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4976.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-simple-msrp-acm">[I-D.ietf-simple-msrp-acm]</a></td>
<td class="author-text">Holmberg, C. and S. Blau, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-msrp-acm-00.txt">An Alternative Connection Model for the Message Session Relay Protocol  (MSRP)</a>,&rdquo; draft-ietf-simple-msrp-acm-00 (work in progress), January&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-msrp-acm-00.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Derek C. MacDonald</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CounterPath Solutions, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 300, One Bentall Centre, 505 Burrard St</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vancouver, BC  V7X1M3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-604-320-3344</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:derek@counterpath.com">derek@counterpath.com</a></td></tr>
</table>
</body></html>
