next_ephemeral_port = 1024;  /*initialization, could be random */

count = max_ephemeral - min_ephemeral + 1;

port = next_ephemeral;
next_ephemeral = min_ephemeral;
next_ephemeral = min_ephemeral + random()
                           % (max_ephemeral - min_ephemeral + 1);

count = max_ephemeral - min_ephemeral + 1;

next_ephemeral = min_ephemeral;
next_ephemeral = 0;  /* could be random */

offset = F(local_IP, remote_IP, remote_port, secret_key);
count = max_ephemeral - min_ephemeral + 1;

port = min_ephemeral + (next_ephemeral + offset)
                      % (max_ephemeral - min_ephemeral + 1);
offset = F(local_IP, remote_IP, remote_port, secret_key);
index = G(offset);
count = max_ephemeral - min_ephemeral + 1;

port = min_ephemeral + (offset + table[index])
                      % (max_ephemeral - min_ephemeral + 1);

s = socket();
