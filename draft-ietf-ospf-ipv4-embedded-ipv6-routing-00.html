<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Routing for IPv4-embedded IPv6 Packets</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 The Scenario">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Routing Solution per RFC5565">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 An Alternative Routing Solution with OSPFv3">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 OSPFv3 Routing with a Specific Topology">
<link href="#rfc.section.2" rel="Chapter" title="2 Provisioning">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Deciding the IPv4-embedded IPv6 Topology">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Maintaining a Dedicated IPv4-embedded IPv6 Routing Table">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 OSPFv3 Topology with a Separate Instance ID">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 OSPFv3 Topology with the Default Instance">
<link href="#rfc.section.3" rel="Chapter" title="3 IP Packets Translation">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Address Translation">
<link href="#rfc.section.4" rel="Chapter" title="4 Advertising IPv4-embedded IPv6 Routes">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Advertising IPv4-embedded IPv6 Routes into IPv6 Transit Network">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Routing Metrics">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Forwarding Address">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Advertising IPv4 Addresses into Client Networks">
<link href="#rfc.section.5" rel="Chapter" title="5 Aggregation on IPv4 Addresses and Prefixes">
<link href="#rfc.section.6" rel="Chapter" title="6 Forwarding">
<link href="#rfc.section.7" rel="Chapter" title="7 MTU Issues">
<link href="#rfc.section.8" rel="Chapter" title="8 Backdoor Connections">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes routing packets destined to IPv4-embedded IPv6 addresses across IPv6 transit core using OSPFv3 with a separate routing table." />
  <meta name="description" content="This document describes routing packets destined to IPv4-embedded IPv6 addresses across IPv6 transit core using OSPFv3 with a separate routing table." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">D. Cheng</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Huawei Technologies</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">M. Boucadair</td>
</tr>
<tr>
<td class="left">Expires: October 15, 2011</td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">April 13, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Routing for IPv4-embedded IPv6 Packets<br />
  <span class="filename">draft-ietf-ospf-ipv4-embedded-ipv6-routing-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes routing packets destined to IPv4-embedded IPv6 addresses across IPv6 transit core using OSPFv3 with a separate routing table.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">The Scenario</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Routing Solution per RFC5565</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">An Alternative Routing Solution with OSPFv3</a>
</li>
<li>1.4.   <a href="#rfc.section.1.4">OSPFv3 Routing with a Specific Topology</a>
</li>
<li>2.   <a href="#rfc.section.2">Provisioning</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Deciding the IPv4-embedded IPv6 Topology</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Maintaining a Dedicated IPv4-embedded IPv6 Routing Table</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">OSPFv3 Topology with a Separate Instance ID</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">OSPFv3 Topology with the Default Instance</a>
</li>
<li>3.   <a href="#rfc.section.3">IP Packets Translation</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Address Translation</a>
</li>
<li>4.   <a href="#rfc.section.4">Advertising IPv4-embedded IPv6 Routes</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Advertising IPv4-embedded IPv6 Routes into IPv6 Transit Network</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Routing Metrics</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Forwarding Address</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Advertising IPv4 Addresses into Client Networks</a>
</li>
<li>5.   <a href="#rfc.section.5">Aggregation on IPv4 Addresses and Prefixes</a>
</li>
<li>6.   <a href="#rfc.section.6">Forwarding</a>
</li>
<li>7.   <a href="#rfc.section.7">MTU Issues</a>
</li>
<li>8.   <a href="#rfc.section.8">Backdoor Connections</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgements</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This document describes a routing scenario where IPv4 packets are transported over IPv6 network.</p>
<p id="rfc.section.1.p.2">In this document the following terminology is used: </p>

<ul>
<li>An IPv4-embedded IPv6 address denotes an IPv6 address which contains an embedded 32-bit IPv4 address constructed according to the rules defined in <a href="#RFC6052">[RFC6052]</a>. </li>
<li>IPv4-embedded IPv6 packets are packets of which destination addresses are IPv4-embedded IPv6 addresses. </li>
<li>AFBR (Address Family Border Router, <a href="#RFC5565">[RFC5565]</a>) refers to an edge router, which supports both IPv4 and IPv6 address families, of a backbone that supports only IPv4 or IPv6 address family. </li>
<li>AFXLBR (Address Family Translation Border Router) is defined in this document. It refers to a border router that supports both IPv4 and IPv6 address families, located on the boundary of IPv4-only network and IPv6-only network, and is capable of performing IP header translation between IPv4 and IPv6 according to <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>. </li>
</ul>
<p></p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#scenario" id="scenario">The Scenario</a>
</h1>
<p id="rfc.section.1.1.p.1">Due to exhaustion of public IPv4 addresses, there has been continuing effort within IETF on IPv6 transitional techniques. In the course of transition, it is certain that networks based on IPv4 and IPv6 transfer capabilities, respectively, will co-exist at least for some time. One scenario of the co-existence is that IPv4-only networks inter-connecting with IPv6-only networks, and in particular, when an IPv6-only network serves as a transit network that inter-connects several segregated IPv4-only networks. In this scenario, IPv4 packets are transported over the IPv6 transit network between IPv4 networks.  In order to forward an IPv4 packet from a source IPv4 network to the destination IPv4 network, IPv4 reachability information must be exchanged among involved networks by dedicated means.</p>
<p id="rfc.section.1.1.p.2">Unlike dual-stack networks, operating an IPv6-only network would allow optimize OPEX and maintenance operations in particular. Some solutions have been proposed to allow delivery of IPv4 services over an IPv6-only network. This document focuses on an engineering techniques which aims to separate the routing instance dedicated to IPv4-embedded IPv6 destination from native IPv6 ones. </p>
<p id="rfc.section.1.1.p.3">The purpose of running separate instances or topologies for IPv4-embedded IPv6 traffic is to distinguish from the native IPv6 routing topology, and the topology that is used for routing IPv4-embedded IPv6 datagram only. Separate instances/topologies are also meant to prevent any overload of the native IPv6 routing tables by IPv4-embedded IPv6 routes.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Routing Solution per RFC5565</h1>
<p id="rfc.section.1.2.p.1">The aforementioned scenario is described in <a href="#RFC5565">[RFC5565]</a>, i.e.- IPv4-over-IPv6 scenario, where the network core is IPv6-only, and the inter-connected IPv4 networks are called IPv4 client networks. The P routers in the core only support IPv6 but the AFBRs (Address Family Border Routers) support IPv4 on interface facing IPv4 client networks, and IPv6 on interface facing the core. The routing solution defined in <a href="#RFC5565">[RFC5565]</a> for this scenario is to run i-BGP among AFBRs to exchange IPv4 routing information with each other, and the IPv4 packets are forwarded from one IPv4 client network to the other through a softwire using tunneling technology such as MPLS LSP, GRE, L2TPv3, etc.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> An Alternative Routing Solution with OSPFv3</h1>
<p id="rfc.section.1.3.p.1">In this document, we propose an alternative routing solution for the scenario described in <a href="#scenario">Section 1.1</a>, where several segregated IPv4 networks, called IPv4 client networks, are interconnected by an IPv6 transit network, and in particular, we name the border node on the boundary of an IPv4 client network and the IPv6 transit network as Address Family Translation Border Router, or AFXLBR, which supports both IPv4 and IPv6 address families, and is capable of translating an IPv4 packet to an IPv6 packet, and vice versa, according to <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>.</p>
<p id="rfc.section.1.3.p.2">Since the scenario occurs most in a single ISP operating environment, an IPv6 prefix can be locally allocated and used to construct IPv4-embedded IPv6 addresses according to <a href="#RFC6052">[RFC6052]</a> by each AFXLBR, where the embedded IPv4 addresses are associated with an IPv4 client network that is connected to the AFXLBR, and each IPv4 address is an individual IPv4 address or prefix. An AFXLBR injects IPv4-embedded IPv6 addresses/prefixes into the IPv6 transit network using OSPFv3 and also installs those advertised by other AFXLBRs. When an IPv4 packet is sent from one IPv4 client network to the other, it is first encapsulated with an IPv6 header, where the source and destination IPv6 address are constructed, in a stateless manner, as IPv4-embedded IPv6 address, respectively, and then forwarded to the destination AFXLBR that is the advertising router of the destination IPv4-embedded IPv6 address. The destination AFXLBR replaces the IPv6 header by the corresponding IPv4 header, where the source and destination IPv4 addresses are derived from the IPv4-embedded IPv6 source and destination addresses, respectively, and then forwards the IPv4 packet using its IPv4 routing table in the attached IPv4 client network.</p>
<p id="rfc.section.1.3.p.3">There are use cases where the proposed routing solution is useful.  One case is that some border nodes do not participate in i-BGP for routes exchange (one example is documented in <a href="#I-D.boucadair-softwire-dslite-v6only">[I-D.boucadair-softwire-dslite-v6only]</a>), or i-BGP is not used at all. Another case is that tunnel mechanism is not used in the IPv6 transit network, or native IPv6 forwarding is preferred. Note also that with this routing solution, the IPv4-IPv6 inter-connection and associated header translation that occurs at an AFXLBR is stateless.</p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> OSPFv3 Routing with a Specific Topology</h1>
<p id="rfc.section.1.4.p.1">Routing IPv4-embedded IPv6 packets in the IPv6 transit network using OSPFv3, in general, may be performed by the OSPFv3 operation that is already running in the IPv6 network. One concern however, is that IPv4-embedded IPv6 routes would flood throughout the entire transit network and stored on every router, which may not be desirable. Also, since all IPv6 routes are stored in the same routing table, it might be more difficult to manage the resource required for routing and forwarding based on traffic category, if so desired. To solve this problem and to ease the separation between native IPv6 and IPv4-inferred routing policies, a separate OSPFv3 routing table can be constructed that is dedicated to IPv4-embedded IPv6 topology, and that table is solely used for routing IPv4-embedded IPv6 packets (i.e., IPv4 part of the Internet) in the transit network. Further, only a set of routers in the transit network are required to be involved in such routing scheme, including AFXLBRs that connect to IPv4 client networks along with a set of P routers in the core for routing path.</p>
<p id="rfc.section.1.4.p.2">There are two methods to build a separate OSPFv3 routing table for IPv4-embedded IPv6 routing. </p>

<ul>
<li>The first one is to run a separate OSPFv3 instance for IPv4-embedded IPv6 topology in the IPv6 transit network according to <a href="#RFC5838">[RFC5838]</a>, </li>
<li>The second one is to stay with the existing OSPFv3 instance that already operates in the transit network, but maintain a separate IPv4-embedded topology, according to <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a>. </li>
</ul>
<p id="rfc.section.1.4.p.3">With both methods, there would be a dedicated IPv4-embedded IPv6 topology that is maintained by OSPFv3 speakers and thus a dedicated IPv4-embedded IPv6 routing table, which is then used for routing IPv4-embedded IPv6 packets (i.e., packets destined to an IPv4 destination). It would be operators&#8217; preference as which method is going to be used. This document elaborates on how configuration is done for each method and related routing issues that is common to both.</p>
<p id="rfc.section.1.4.p.4">This document only focuses on unicast routing for IPv4-embedded IPv6 packets using OSPFv3.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Provisioning</h1>
<p></p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Deciding the IPv4-embedded IPv6 Topology</h1>
<p id="rfc.section.2.1.p.1">Before making appropriate configuration in order to generate a separate OSPFv3 routing table for IPv4-embedded IPv6 addresses/prefixes, decision must be made on the set of routers and their interfaces in the IPv6 transit network that should be on the IPv4-embedded IPv6 topology. </p>
<p id="rfc.section.2.1.p.2">For the purpose of this topology, all AFXLBRs that connect to IPv4 client networks should be members of this topology, and also at least some of their network core facing interfaces, which depends on which P routers in the IPv6 transit network would be on this topology.</p>
<p id="rfc.section.2.1.p.3">The IPv4-embedded IPv6 topology is a sub-topology of the entire IPv6 transit network, and if all routers (including AFXLBRs and P-routers) and their interfaces are included, the two topologies converge. In general, as more P routers and their interfaces are configured on this sub-topology, it would increase the inter-connectivity and potentially, there would be more routing paths cross the transit network from one IPv4 client network to the other, at the cost that more routers need to participate the IPv4-embedded IPv6 routing. In any case, the IPv4-embedded IPv6 topology must be continuous with no partitions.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Maintaining a Dedicated IPv4-embedded IPv6 Routing Table</h1>
<p id="rfc.section.2.2.p.1">In an IPv6 transit network, in order to maintain a separate IPv6 routing table that contains routes for IPv4-embedded IPv6 destinations only, OSPFv3 needs to use the mechanism defined either in <a href="#RFC5838">[RFC5838]</a> or <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a> with required configuration tasks, as described in the following sub-sections.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> OSPFv3 Topology with a Separate Instance ID</h1>
<p id="rfc.section.2.3.p.1">It is assumed that the scenario as described in this document is under a single ISP and as such, an OSPFv3 instance ID (IID) is allocated locally and used for an OSPFv3 operation dedicated to unicast IPv4-embedded IPv6 routing in an IPv6 transit network. This IID is configured on each OSPFv3 interface of routers that participates in this routing instance. </p>
<p id="rfc.section.2.3.p.2">The range for a locally configured OSPFv3 IID is from 128 to 255, inclusively, and this number must be used to encode the &#8220;Instance ID&#8221; field in the OSPFv3 packet header on every router that executes this instance in the IPv6 transit network.</p>
<p id="rfc.section.2.3.p.3">In addition, the &#8220;AF&#8221; bit in the OSPFv3 Option field must be set.</p>
<p id="rfc.section.2.3.p.4">During the Hello packets processing, adjacency may only be established when received Hello packets contain the same Instance ID as configured on the receiving interface for OSPFv3 instance dedicated to the IPv4-embedded IPv6 routing.</p>
<p id="rfc.section.2.3.p.5">For more details, the reader is referred to <a href="#RFC5838">[RFC5838]</a>.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> OSPFv3 Topology with the Default Instance</h1>
<p id="rfc.section.2.4.p.1">Similar to that as described in the previous section, an OSPFv3 multi-topology ID (MT-ID) is locally allocated and used for an OSPFv3 operation including unicast IPv4-embedded IPv6 routing in an IPv6 transit network. This MTID is configured on each OSPFv3 interface of routers that participates in this routing topology.</p>
<p id="rfc.section.2.4.p.2">The range for a locally configured OSPFv3 MT-ID is from 32 to 255, inclusively, and this number must be used to encode the &#8220;MT-ID&#8221; field that is included in some of the extended LSAs as documented in <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a>.</p>
<p id="rfc.section.2.4.p.3">In addition, the MT bit in the OSPFv3 Option field must be set.</p>
<p id="rfc.section.2.4.p.4">For more details, the reader is referred to <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#translation" id="translation">IP Packets Translation</a>
</h1>
<p id="rfc.section.3.p.1">When transporting IPv4 packets across an IPv6 transit network with the mechanism described above, an IPv4 packet is translated to an IPv6 packet at ingress AFXLBR, and the IPv6 packet is translated back to the original IPv4 packet at egress AFXLBR. The IP packet translation is accomplished in stateless manner according to rules specified in <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>, with the address translation detail explained in the next sub-section.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Address Translation</h1>
<p id="rfc.section.3.1.p.1">Prior to the operation, an IPv6 prefix is allocated by the ISP and it is used to form an IPv4-embedded IPv6 address.</p>
<p id="rfc.section.3.1.p.2">The IPv6 prefix can either be a well-known IPv6 prefix (WKP) 64:ff9b::/96, or a network-specific prefix that is unique to the ISP, and for the later case, the IPv6 prefix length may be 32, 40, 48, 56 or 64. In either case, this IPv6 prefix is used during the address translation between an IPv4 address and an IPv4-embedded IPv6 address, which is performed according to <a href="#RFC6052">[RFC6052]</a>.</p>
<p id="rfc.section.3.1.p.3">During translation from an IPv4 header to an IPv6 header at an ingress AFXLBR, the source IPv4 address and destination IPv4 address are translated into the corresponding IPv6 source address and destination IPv6 address, respectively, and during translation from an IPv6 header to an IPv4 header at an egress AFXLBR, the source IPv6 address and destination IPv6 address are translated into the corresponding IPv4 source address and destination IPv4 address, respectively. Note that the address translation is accomplished in a stateless manner.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Advertising IPv4-embedded IPv6 Routes</h1>
<p id="rfc.section.4.p.1">In order to forward IPv4 packets to the proper destination across IPv6 transit network, IPv4 reachability needs to be disseminated throughout the IPv6 transit network and this work is performed by AFXLBRs that connect to IPv4 client networks using OSPFv3.</p>
<p id="rfc.section.4.p.2">With the scenario described in this document, i.e. - a set of AFXLBRs that inter-connect a bunch of IPv4 client networks with an IPv6 transit network, we view that IPv4 networks and IPv6 networks belong to separate Autonomous Systems, and as such, these AFXLBRs are OSPFv3 ASBRs.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Advertising IPv4-embedded IPv6 Routes into IPv6 Transit Network</h1>
<p id="rfc.section.4.1.p.1">IPv4 addresses and prefixes in an IPv4 client network are translated into IPv4-embedded IPv6 addresses and prefixes, respectively, using the same IPv6 prefix allocated by the ISP and the method specified in <a href="#RFC6052">[RFC6052]</a>, and then advertised by one or more attached ASBRs into the IPv6 transit network using AS External LSA <a href="#RFC5340">[RFC5340]</a>, i.e. - with the advertising scope throughout the entire Autonomous System.</p>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> Routing Metrics</h1>
<p id="rfc.section.4.1.1.p.1">By default, the metric in an AS External LSA that carries an IPv4-embedded IPv6 address or prefixes is a Type 1 external metric, which is then to be added to the metric of an intra-AS path during OSPFv3 routes calculation. By configuration on an ASBR, the metric can be set to a Type 2 external metric, which is considered much larger than that on any intra-AS path. The detail is referred to OSPFv3 specification <a href="#RFC5340">[RFC5340]</a>. In either case, an external metric may be exact the same unit as in an IPv4 network (running OSPFv2 or others), but may also be specified by a routing policy, the detail is outside of the scope of this document.</p>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> Forwarding Address</h1>
<p id="rfc.section.4.1.2.p.1">If the &#8220;Forwarding Address&#8221; field of an OSPFv3 AS External LSA is used to carry an IPv6 address, that must also be an IPv4-embedded IPv6 address where the embedded IPv4 address is the actual address in an IPv4 client network to which, data traffic is forwarded to. However, since an AFXLBR sits on the border of an IPv4 network and an IPv6 network, it is recommended that the &#8220;Forwarding Address&#8221; field not to be used by setting the F bit in the associated OSPFv3 AS-external-LSA to zero, so that the AFXLBR can make the forwarding decision based on its own IPv4 routing table.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Advertising IPv4 Addresses into Client Networks</h1>
<p id="rfc.section.4.2.p.1">IPv4-embedded IPv6 routes injected into the IPv6 transit network from one IPv4 client network may be advertised into another IPv4 client network, after the associated destination addresses/prefixes are translated back to IPv4 addresses/prefixes format. This operation is similar to the regular OSPFv3 operation, wherein an AS External LSA can be advertised in a non-backbone area by default.</p>
<p id="rfc.section.4.2.p.2">An IPv4 client network that does not want to receive such advertisement can be configured as a stub area or with other routing policy. </p>
<p id="rfc.section.4.2.p.3">For the purpose of this document, IPv4-embedded IPv6 routes must not advertised into any IPv6 client networks that also connected to the IPv6 transit network.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Aggregation on IPv4 Addresses and Prefixes</h1>
<p id="rfc.section.5.p.1">In order to reduce the amount of AS External LSAs that are injected to the IPv6 transit network, effort must be made to aggregate IPv4 addresses and prefixes at each AFXLBR before advertising.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Forwarding</h1>
<p id="rfc.section.6.p.1">There are three cases in forwarding IP packets in the scenario as described in this document, as follows:</p>

<ol>
<li>On an AFXLBR, if an IPv4 packet that is received on an interface connecting to an IPv4 client network with the destination IPv4 address belong to another IPv4 client network, the header of the packet is translated to a corresponding IPv6 header as described in <a href="#translation">Section 3</a>, and the packet is then forwarded to the destination AFXLBR that advertises the IPv4-embedded IPv6 address through the IPv6 transit network.</li>
<li>On an AFXLBR, if an IPv4-embedded IPv6 packet is received and the embedded destination IPv4 address is in its IPv4 routing table, the header of the packet is translated to a corresponding IPv4 header as described in Section 3, and the packet is then forwarded accordingly.</li>
<li>On any router that is within the IPv4-embedded IPv6 topology located in the IPv6 transit network, if an IPv4-embedded IPv6 packet is received and a route is found in the IPv4-embedded IPv6 routing table, the packet is forwarded accordingly.</li>
</ol>
<p id="rfc.section.6.p.2">The classification of IPv4-embedded IPv6 packet is according to the IPv6 prefix of the destination address, which is either the Well Known Prefix (i.e., 64:ff9b::/96) or locally allocated as defined in <a href="#RFC6052">[RFC6052]</a>.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> MTU Issues</h1>
<p id="rfc.section.7.p.1">In the IPv6 transit network, there is no new MTU issue introduced by this document. If a separate OSPFv3 instance (per <a href="#RFC5838">[RFC5838]</a>) is used for IPv4-embedded IPv6 routing, the MTU handling in the transit network is the same as that of the default OSPFv3 instance. If a separate OSPFv3 topology (per <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a>) is used for IPv4-embedded IPv6 routing, the MTU handling in the transit network is the same as that of the default OSPFv3 topology.</p>
<p id="rfc.section.7.p.2">However, the MTU in the IPv6 transit network may be different than that of IPv4 client networks. Since an IPv6 router will never fragment a packet, the packet size of any IPv4-embedded IPv6 packet entering the IPv6 transit network must be equal to or smaller than the MTU of the IPv6 transit network. In order to achieve this requirement, it is recommended that AFXLBRs to perform IPv6 path discovery among themselves and the resulting MTU, after taking into account of the difference between IPv4 header length and IPv6 header length, must be &#8220;propagated&#8221; into IPv4 client networks, e.g.- included in the OSPFv3 Database Description packet.</p>
<p id="rfc.section.7.p.3">The detail of passing the proper MTU into IPv4 client networks is beyond the scope of this document.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Backdoor Connections</h1>
<p id="rfc.section.8.p.1">In some deployments, there may exist direct connections among IPv4 client networks themselves in addition to the IPv6 transit network, as &#8220;backdoor&#8221; connections referring to, where IPv4 packets can either be transported between those IPv4 client networks via backdoor connections, or through the IPv6 transit network. In general, routing policies should be as such that the &#8220;backdoor&#8221; path is preferred since the packet forwarding is within a single address family without the need for IP header translation, among other things.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document does not introduce any security issue than what has been identified in <a href="#RFC5838">[RFC5838]</a>, <a href="#I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</a> and <a href="#RFC6052">[RFC6052]</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.10.p.1">No new IANA assignments are required for this document.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Acknowledgements</h1>
<p id="rfc.section.11.p.1">Many thanks to Acee Lindem, Dan Wing and Joel Halpern for their comments.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5340">[RFC5340]</b></td>
<td class="top">
<a>Coltun, R.</a>, <a>Ferguson, D.</a>, <a>Moy, J.</a> and <a>A. Lindem</a>, "<a href="http://tools.ietf.org/html/rfc5340">OSPF for IPv6</a>", RFC 5340, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5838">[RFC5838]</b></td>
<td class="top">
<a>Lindem, A.</a>, <a>Mirtorabi, S.</a>, <a>Roy, A.</a>, <a>Barnes, M.</a> and <a>R. Aggarwal</a>, "<a href="http://tools.ietf.org/html/rfc5838">Support of Address Families in OSPFv3</a>", RFC 5838, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-ospf-mt-ospfv3">[I-D.ietf-ospf-mt-ospfv3]</b></td>
<td class="top">
<a>Mirtorabi, S</a> and <a>A Roy</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ospf-mt-ospfv3-03">Multi-topology routing in OSPFv3 (MT-OSPFv3)</a>", Internet-Draft draft-ietf-ospf-mt-ospfv3-03, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6052">[RFC6052]</b></td>
<td class="top">
<a>Bao, C.</a>, <a>Huitema, C.</a>, <a>Bagnulo, M.</a>, <a>Boucadair, M.</a> and <a>X. Li</a>, "<a href="http://tools.ietf.org/html/rfc6052">IPv6 Addressing of IPv4/IPv6 Translators</a>", RFC 6052, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</b></td>
<td class="top">
<a>Li, X</a>, <a>Bao, C</a> and <a>F Baker</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-v6v4-xlate-23">IP/ICMP Translation Algorithm</a>", Internet-Draft draft-ietf-behave-v6v4-xlate-23, September 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5565">[RFC5565]</b></td>
<td class="top">
<a>Wu, J.</a>, <a>Cui, Y.</a>, <a>Metz, C.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc5565">Softwire Mesh Framework</a>", RFC 5565, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.boucadair-softwire-dslite-v6only">[I-D.boucadair-softwire-dslite-v6only]</b></td>
<td class="top">
<a>Boucadair, M</a>, <a>Jacquenet, C</a>, <a>Grimault, J</a>, <a>Kassi-Lahlou, M</a>, <a>Levis, P</a>, <a>Cheng, D</a> and <a>Y Lee</a>, "<a href="http://tools.ietf.org/html/draft-boucadair-softwire-dslite-v6only-01">Deploying Dual-Stack Lite in IPv6 Network</a>", Internet-Draft draft-boucadair-softwire-dslite-v6only-01, April 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dean Cheng</span> 
	  <span class="n hidden">
		<span class="family-name">Cheng</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies</span>
	<span class="adr">
	  <span>2330 Central Expressway</span>

	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code">95050</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:dean.cheng@huawei.com">dean.cheng@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mohamed Boucadair</span> 
	  <span class="n hidden">
		<span class="family-name">Boucadair</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Rennes</span>,  
		<span class="region"></span>
		<span class="code">35000</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mohamed.boucadair@orange-ftgroup.com">mohamed.boucadair@orange-ftgroup.com</a></span>

  </address>
</div>

</body>
</html>