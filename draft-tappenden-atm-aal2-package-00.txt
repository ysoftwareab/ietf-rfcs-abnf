                                                           C. Tappenden 
Internet Draft                                             Alcatel 
Document: draft-tappenden-atm-aal2-package-00                         
Category: Informational	                             	     Nov. 2001 
Expires: April 2002
 
 
                    H.248 control of AAL2 CID Allocation
 
Status of this Memo 
 
This document is an Internet-Draft and is in full conformance with all 
provisions of Section 10 of RFC2026.         
   
Internet-Drafts are working documents of the Internet Engineering Task 
Force (IETF), its areas, and its working groups.  Note that other groups 
may also distribute working documents as Internet-Drafts. 
    
Internet-Drafts are draft documents valid for a maximum of six months 
and may be updated, replaced, or obsoleted by other documents at any 
time.  It is inappropriate to use Internet-Drafts as reference material 
or to cite them other than as "work in progress." 

The list of current Internet-Drafts can be accessed at 
http://www.ietf.org/ietf/1id-abstracts.txt 
The list of Internet-Draft Shadow Directories can be accessed at 
http://www.ietf.org/shadow.html. 
    
    
Abstract:

This contribution proposes specific procedures that media gateways shall 
follow for H.248 Allocation of AAL2 CIDs.  This proposal covers gateways 
using non-AAL2 signalling (no Q.2630.x) with a backward SPVC call setup 
mode.  

This contribution attempts to build upon existing RFCs and expand upon 
the expected behavior of Media Gateways when receiving H.248 messaging 
designed to set-up and tear down AAL2 connections.


1.0 Introduction:

RFC3108 describes parameters that may be used within H.248 to transport 
AAL2 information between the various media gateways and media gateway 
controllers.  However, it does not outline the expected behavior of the 
MG when it receives this information.  Specifically, RFC3018 does not 
outline how the H.248 messaging should be tied with SPVC/SVC messaging 
for AAL2. 

Not doing so results in many different interpretations and solutions for 
handling H.248 control of AAL2 and the dynamic allocation/deallocation 
of multiple CIDs within an AAL2 connection by H.248.  The wide variety 
of interpretations makes it highly unlikely that different vendor's 
solutions will interoperate.  This contribution attempts to resolve some 

                 H.248 control of AAL2 CID Allocation          Nov. 2001

of those interpretations by proposing procedures that the MG must follow 
in order to ensure interoperability between different vendor's 
implementations.  

This contribution makes no changes to RFC3108 or RFC3015 and does not 
require any modifications to existing SPVC standards.  It merely 
attempts to clarify how the two sets of standards fit together to ensure 
a common reference point for vendor interoperability.

1.1 Scope

This document proposes specific procedures that media gateways shall 
follow for H.248 Allocation of AAL2 CIDs.  This proposal covers gateways 
using non-AAL2 signalling (no Q.2630.x) with a backward SPVC call setup 
mode.  This contribution makes no attempt to cover gateways that use 
AAL2 signalling (Q.2630.x), SVCs or a forward call setup model.  It is 
assumed that gateways using such schemes will not be compatible with 
gateways using a backward SPVC call setup model.

1.2 Architecture Overview

This contribution assumes the same architecture as used in RFC3015 and 
RFC3108.  It assumes that the MGC will not be aware of the underlying 
ATM network topology and will expect the MGs to negotiate such items as 
which CID or AAL2 connection to use.  In addition, both MGs must support 
a backward SPVC call setup model.


2.0 Solution Overview

With this solution, at the start of a voice call, the Originating 
Gateway shall select a VPI/VCI for any new SPVC connection and relay to 
the Terminating MG via H.248 message.  The Terminating MG will use that 
information in setting up any new SPVC.  The Terminating MG will select 
a CID for the chosen SPVC and relay the necessary information back to 
the Originating MG via H.248 messaging.

At the Originating MG, information must be stored linking the SPVC 
connection and voice call with the incoming H.248 messaging.  This shall 
be done by matching the Terminating MG's ATM address and VPI/VCI 
obtained through the H.248 Modify message's Remote Descriptor to the 
SPVC.

Refer to the following call flow for more detail.

2.1 Call Flow

This call flow details the expected Media Gateway behavior. In this 
example no connection exists or additional connections are required 
between the Originating and Terminating Gateways.  The Originating 
Gateway identifies a unique AAL2 connection by using the Terminating 
MG's NSAP address with the terminating MG's VPI/VCI.

1) Add from MGC to Originating MG

Tappenden                 Informational                       Page 2
                H.248 control of AAL2 CID Allocation          Nov. 2001

Add
Local {
C= ATM - -
M = audio $/$/$/$ ...
}

2) Add Reply from Originating MG to MGC
Add Reply
Local {
C = ATM NSAP 0123456789...
M = audio 1/1/2/1 AAL2/ITU 1 AAL2/custom 100 AAL2/ITU 2
}

3) Add from MGC to Terminating MG
Add
Local {
C = ATM - -
M = audio $/$/$/$ ...
}
Remote {
C=ATM NSAP 0123456789...
M=audio 1/1/2/1 AAL2/ITU 1 AAL2/custom 100 AAL2/ITU 2
}

4) Set-Up Message launched from Terminating MG to Originating MG
Set-Up Message contains the Originating MG's VPI/VCI in the SPVC IE and 
the Terminating MG's NSAP Address in the Calling Party Number IE

5) Add Reply from Terminating MG to MGC
Add Reply
Local {
C = ATM NSAP 987654321...
M = audio 1/3/4/23 AAL2/ITU 1
}
Remote {
C=ATM NSAP 0123456789...
M=audio 1/1/2/1 AAL2/ITU 1  AAL2/custom 100 AAL2/ITU 2
}

6) Modify from MGC to Originating MGC 
Local {
C=ATM NSAP 0123456789...
M=audio 1/1/2/1 AAL2/ITU 1  AAL2/custom 100 AAL2/ITU 2
}
Remote {
C = ATM NSAP 987654321...
M = audio 1/3/4/23 AAL2/ITU 1
}

2.1.1 Description of call flow steps:

1) The MGC initiates a call setup using an ADD. 
2) The Originating MG replies by sending connection information in the 
   H.248 reply message including the VPI/VCI and NSAP address for any new 

Tappenden                 Informational                       Page 3
                H.248 control of AAL2 CID Allocation          Nov. 2001

   SPVC to connect to.  The VPI/VCI identifies the VPI/VCI on the 
   Originating MG's side of the connection.
3) The MGC sends an ADD to the Terminating MG containing the information 
   that the Originating MG sent.
4) The Terminating MG takes the information in the remote descriptor of 
   the H.248 message and uses that information to a) determine that there 
   is no available connection between the two gateways and b) set up a new 
   SPVC connection to the Originating MG.  In this case the Terminating MG 
   will take the VPI/VCI sent by the Originating MG and place it into the 
   Set-Up message's SPVC IE, the Terminating MG's NSAP address will be 
   placed in the Set-Up message's Calling Party Number IE so that the 
   Originating MG will know where the SPVC is coming from. This VPI/VCI 
   information will be used to connect to the Originating MG on the 
   Originating MG's side of the SPVC.  The Terminating Gateway will route 
   the call based on the ATM address specified by the Originating Gateway.  
   The Terminating MG will also be expected to select the CID in the AAL2 
   connection to be used. 
5) The Terminating Gateway will reply to the ADD message with parameters 
   in the Local descriptor including the VPI/VCI information on the 
   terminating MG's side of the SPVC and the NSAP address for the 
   terminating MG, along with the CID being used
6) The Originating Gateway connects the voice call by identifying the 
   SPVC being used by using the information in the Terminating Gateway's 
   H.248 message.  Specifically the Originating MG will identify the SPVC 
   by matching the Terminating MG's NSAP to the Terminating MG's VPI/VCI.  
   The Originating MG will obtain the Terminating MG's VPI/VCI through the 
   Modify message's Remote descriptor.


3.0 Media Gateway Procedures

To work successfully, both the Originating and Terminating Media 
Gateways must follow certain procedures outlined below.  

3.1 Media Gateway Controller:

The Media Gateway Controller shall use the following Virtual Connection 
ID format in the media descriptor when setting up and tearing down AAL2 
calls using H.248.

<ex_portId>/<ex_vpi>/<ex_vci>/<ex_cid> 

3.2 Originating Media Gateway:

The Originating MG will transfer information in the SDP parameters via 
H.248 signalling for use by the Terminating MG in setting up the SPVC.  
At the start of a voice call, the Originating Gateway will not be aware 
whether a new SPVC has to be set up for this voice call.  Thus the 
Originating MG will select a VPI/VCI for any new SPVC connection and 
place that information in the media descriptor of the H.248 message.  
The CID variable will not be relevant at this point of the call.

If the call requires a new SPVC to be set-up, the Originating MG will 

Tappenden                 Informational                       Page 4
                H.248 control of AAL2 CID Allocation          Nov. 2001

accept the incoming SPVC as per standard SPVC processing.  The 
Originating MG will identify the uniqueness of the SPVC through the 
following two identifiers:
1) The VPI/VCI contained in the Set-Up Message's SPVC IE.  This 
   identifies the Originating MG's side of the ATM connection. 
2) The ATM Address of the Originating MG contained in the Set-Up 
   message's Called Party Number IE.  
These elements will allow the Originating MG to uniquely identify the 
SPVC and later map that SPVC to a voice call when the Originating MG 
receives an H.248 Modify message later in the voice call setup.  

Upon receiving an H.248 Modify message once the Terminating MG has set-
up the SPVC, the originating MG will connect the voice call according to 
the information received in the H.248 Modify message.  The originating 
MG will map the following elements of the Modify message to identify a 
particular SPVC.
1) The VPI/VCI information in the Local descriptor's Virtual Connection 
   ID identifies the Originating MG's side of the ATM connection and maps 
   to the VPI/VCI in the Set-Up message's SPVC IE.  If no new SPVC 
   connection was set-up then this information will not be needed. 
2) The VPI/VCI information in the Remote descriptor's Virtual Connection 
   ID identifies the Terminating MG's side of the ATM connection.  This 
   information is not sent in the SPVC Set-Up message but will be needed to 
   identify additional voice calls that will be added to an existing AAL2 
   connection. 
3) The ATM Address in the Remote Descriptor's Connection Information 
   Line identifies the Terminating MG's ATM address and maps to the  Set-Up 
   message's Calling Party Number IE. 
The Originating MG will need to know the ATM Address of the Terminating 
MG as well as the VPI/VCI on the Terminating MG's side of the SPVC 
connection.  Thus to tie the SPVC with an incoming H.248 message, the 
Originating MG will need to match the Originating VPI/VCI with the 
Terminating MG's ATM address and VPI/VCI once a SPVC is initially 
established.  After that point, the Originating MG only needs to use the 
Terminating MG's ATM address and VPI/VCI, which is obtained from the 
H.248 Modify message's Remote descriptor.

The Modify message will also identify the CID of the channel the voice 
call is using.  This CID shall be contained within the Virtual 
Connection ID of the Remote Descriptor.  The Originating MG will connect 
the voice call to the identified SPVC using this CID.  

3.3 Terminating Media Gateway:

The Terminating MG will be expected to recognize whether a SPVC has been 
set up between the Terminating and Originating MGs.  In addition, the 
Terminating MG will be expected to know whether any connections between 
the Originating and Terminating MG have additional capacity for another 
channel.

The Terminating Gateway may be in one of two states: Connected, Not-
Connected.


Tappenden                 Informational                       Page 5
                H.248 control of AAL2 CID Allocation          Nov. 2001

3.3.1 Connected State:

In this state a connection exists between the Terminating and 
Originating Gateway.  This existing connection also has the capability 
to have an additional voice call added to it.  In this case the 
Terminating Gateway will designate an available CID to be used in that 
connection for the voice call.  The Terminating Gateway will signal that 
CID to the Originating Gateway in the Add Reply via the following use of 
H.248 messaging:
1) The VPI/VCI of the Terminating MG's side of the ATM connection will 
   be placed in the Local Descriptor's Media Descriptor.
2) The CID identified for use by the Terminating MG will be placed in 
   the Local Descriptor's Virtual Connection ID.
3) The Terminating MG's ATM Address will be placed in the Local 
   Descriptor's Connection Information Line.
In this case the Terminating Gateway shall ignore the connection 
information sent by the Originating Gateway.  The Terminating MG will 
also always send its ATM address and VPI/VCI in any H.248 message so 
that the Originating MG will be able to identify the SPVC for the voice 
call.

3.3.2 Not-Connected State:

In this state the Terminating Gateway either does not have a connection 
to the Originating Gateway or if it does then that connection is not 
available for use (e.g. due to bandwidth constraints) and thus a new 
SPVC must be set up between the two gateways.  If there is no available 
connection between the Terminating and Originating Gateway, the 
Terminating Gateway shall set-up an SPVC connection with the originating 
Gateway based on the information sent by the Originating Gateway.  The 
following shall occur when the SPVC is set-up:
1) The VPI/VCI contained in the Remote descriptor's Virtual Connection 
   ID shall be placed in the Set-Up message's SPVC IE.  This identifies the 
   Originating MG's side of the ATM connection and will be used in 
   establishing the SPVC at the Originating MG.
2) The ATM Address of the Terminating MG shall be placed in the Set-Up 
   message's Calling Party Number IE.  
The Terminating Gateway will designate an available CID to be used in 
that connection for the voice call.  The Terminating Gateway shall 
signal that CID to the Originating Gateway in the Add Reply via the 
following use of H.248 messaging:
1) The VPI/VCI of the Terminating MG's side of the ATM connection will 
   be placed in the Local Descriptor's Media Descriptor.
2) The CID identified for use by the Terminating MG will be placed in 
   the Local Descriptor's Virtual Connection ID.
3) The Terminating MG's ATM Address (from the Set-Up message's Calling 
   Party Number IE) will be placed in the Local Descriptor's Connection 
   Information Line.

Disconnecting calls shall follow normal procedures.

4.0 Security Considerations
   Not sure what statement should be made here.

Tappenden                 Informational                       Page 6
                H.248 control of AAL2 CID Allocation          Nov. 2001

5.0 References: 

1) Kumar, R. and Mostafa, M., " Conventions for the use of the Session 
Description Protocol (SDP) for ATM Bearer Connections", RFC 3108, May 
2001.

2) Cuervo, F., Greene, N., Rayhan, A., Huitema, C., Rosen, B. and J.  
Segers, "Megaco Protocol Version 1.0", RFC 3015, November 2000.


6.0 Author's Address: 
   
   Chris Tappenden 
   Alcatel 
   600 March Road
   Ottawa, Ontario                  Phone:  +1 613 784 1104 
   Canada K2K 2E6             	Email:  chris.tappenden@alcatel.com

Full Copyright Statment

      "Copyright (C) The Internet Society (date).  All Rights Reserved.
      This document and translations of it may be copied and furnished
      to others, and derivative works that comment on or otherwise
      explain it or assist in its implementation may be prepared,    
      copied, published and distributed, in whole or in part, without
      restriction of any kind, provided that the above copyright notice
      and this paragraph are included on all such copies and derivative
      works.  However, this document itself may not be modified in any
      way, such as by removing the copyright notice or references to the
      Internet Society or other Internet organizations, except as needed
      for the purpose of developing Internet standards in which case the
      procedures for copyrights defined in the Internet Standards
      process must be followed, or as required to translate it into

