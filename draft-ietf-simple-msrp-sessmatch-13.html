<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP) </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability statement">
<link href="#rfc.section.4" rel="Chapter" title="4 Connection Establishment for Media Anchoring Mechanism">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 General">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 MSRP Offerer Procedures">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 MSRP Answerer Procedures">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Usage With The Alternative Connection Model">
<link href="#rfc.section.5" rel="Chapter" title="5 Middlebox assumptions">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 General">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 MSRP awareness">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 TCP connection reuse">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 SDP integrity">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 TLS">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Man in the middle">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 TLS">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 IANA Registration of the SDP a=msrp-cema attribute">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.section.9" rel="Chapter" title="9 Change Log">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document defines an MSRP extension, Connection Establishment for Media Anchoring (CEMA). Support of the extension is optional. MSRP endpoints can implement the extension in order to allow MSRP communication in networks where Middleboxes anchor the MSRP connection, without the need for the Middleboxes to enable MSRP B2BUA functionality in most cases. The document also defines a Session Description Protocol (SDP) " />
  <meta name="description" content="This document defines an MSRP extension, Connection Establishment for Media Anchoring (CEMA). Support of the extension is optional. MSRP endpoints can implement the extension in order to allow MSRP communication in networks where Middleboxes anchor the MSRP connection, without the need for the Middleboxes to enable MSRP B2BUA functionality in most cases. The document also defines a Session Description Protocol (SDP) " />
  <meta name="keywords" content="MSRP, CEMA, Middlebox, IBCF, SBC, relay" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">SIMPLE Working Group</td>
<td class="right">C.H. Holmberg</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S.B. Blau</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left">Expires: December 18, 2011</td>
<td class="right">June 16, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Connection Establishment for Media Anchoring (CEMA) for the Message Session Relay Protocol (MSRP) <br />
  <span class="filename">draft-ietf-simple-msrp-sessmatch-13.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document defines an MSRP extension, Connection Establishment for Media Anchoring (CEMA). Support of the extension is optional. MSRP endpoints can implement the extension in order to allow MSRP communication in networks where Middleboxes anchor the MSRP connection, without the need for the Middleboxes to enable MSRP B2BUA functionality in most cases. The document also defines a Session Description Protocol (SDP) <a href="#RFC4566">[RFC4566]</a> attribute, a=msrp-cema, that can be used by MSRP endpoints to indicate support of the CEMA extension.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted to IETF in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 18, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability statement</a>
</li>
<li>4.   <a href="#rfc.section.4">Connection Establishment for Media Anchoring Mechanism</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">General</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">MSRP Offerer Procedures</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">MSRP Answerer Procedures</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Usage With The Alternative Connection Model</a>
</li>
<li>5.   <a href="#rfc.section.5">Middlebox assumptions</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">General</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">MSRP awareness</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">TCP connection reuse</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">SDP integrity</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">TLS</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Man in the middle</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">TLS</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">IANA Registration of the SDP a=msrp-cema attribute</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.section.9">Change Log</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The Message Session Relay Protocol (MSRP) <a href="#RFC4975">[RFC4975]</a> is designed to use MSRP relays <a href="#RFC4976">[RFC4976]</a> as a means for Network Address Translation (NAT) traversal and policy enforcement.  </p>
<p id="rfc.section.1.p.2">However, many Session Initiation Protocol (SIP) <a href="#RFC3261">[RFC3261]</a> networks, in which MSRP usage is emerging, also contain Middleboxes, that anchor and control media, perform tasks such as NAT traversal, performance monitoring, lawful intercept, address domain bridging, interconnect Service Layer Agreement (SLA) policy enforcement, etc. An example is the Interconnection Border Control Function (IBCF) <a href="#3GPP.23.228">[3GPP.23.228]</a>, defined by the 3rd Generation Partnership Project (3GPP). The IBCF controls a media relay that handles all types of SIP session media (voice, video, MSRP, etc).  </p>
<p id="rfc.section.1.p.3">MSRP, as defined in RFC 4975 <a href="#RFC4975">[RFC4975]</a> and RFC 4976 <a href="#RFC4976">[RFC4976]</a>, cannot be anchored when MSRP endpoints communicate with such Middleboxes, unless the Middleboxes implement and enable MSRP Back-To-Back User Agent (B2BUA) functionality for all calls.  The reason is that Middleboxes modify the address:port information in SDP c/m-line in order to anchor media, and since the active MSRP UA establishes the MSRP TCP connection based on the MSRP URI of the SDP a=path attribute, this means that the MSRP connection will not, unless the Middlebox also modifies the MSRP URI of the topmost SDP a=path attribute be routed through the Middlebox, which in many scenarios will prevent the MSRP connection from being established. However, if the Middlebox modifies the MSRP URI of the SDP a=path attribute, then the MSRP URI comparison procedure <a href="#RFC4975">[RFC4975]</a>, which requires consistency between the address information in the MSRP messages and the address information carried in the MSRP URI of the SDP a=path attribute, will fail. The matching will fail if Middleboxes modify the address information in the MSRP URI of the SDP a=path attribute, but do not enable MSRP B2BUA functionality and perform the corresponding modification in the associated MSRP messages.  However, the enabling of MSRP B2BUA functionality requires substantially more resource usage in the Middlebox, that normally result in negative performance impact.  </p>
<p id="rfc.section.1.p.4">This specification defines an MSRP extension, Connection Establishment for Media Anchoring (CEMA), that in most cases allows MSRP endpoints to communicate with Middleboxes without a need for the Middleboxes to enable MSRP B2BUA  functionality.  In such cases, Middleboxes that want to anchor the MSRP connection simply modify the SDP c/m-line address information (similar to what it does for non-MSRP media types), and MSRP endpoints that support the CEMA extension will use the SDP c/m-line address information for establishing the TCP (or TLS) connection to be used for sending and receiving of MSRP messages.  </p>
<p id="rfc.section.1.p.5">The CEMA extension is fully backward compatible. In scenarios where MSRP endpoints that do not support the CEMA extension are able to establish MSRP connectivity, an MSRP endpoint that supports the CEMA extension behaves in the same way as an MSRP endpoint that does not support it.  The CEMA extension only provides an alternative mechanism for negotiating and providing the address information for the MSRP TCP connection. Once the MSRP TCP connection has been created, an MSRP endpoint that supports the CEMA extension acts according to the procedures (e.g. for creating MSRP messages, performing checks when receiving MSRP messages etc) defined in RFC 4975 (and RFC 4976, when it is using a relay for MSRP communication).  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Conventions</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14, RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">In this specification the terminology "fingerprint based TLS authentication" and "name based TLS authentication" are used to refer to the two cases where: </p>
<p id="rfc.section.2.p.3">1.	An MSRP endpoint uses a self-signed TLS certificate and sends a certificate fingerprint in SDP (fingerprint based TLS authentication).  </p>
<p id="rfc.section.2.p.4">2.	An MSRP endpoint uses a certificate from a well known certificate authority and the other endpoint matches the hostname in the received TLS communication SubjectAltName parameter towards the hostname received in the MSRP URI in SDP (name based TLS authentication).  </p>
<p id="rfc.section.2.p.5">Middlebox:    Within the scope of this document, Middlebox refers to a network SIP device that modifies SDP media address:port information in order to steer (anchor) media flows described in the SDP, including TCP connections used for MSRP communication, through a media proxy function controlled by the SIP device. In most cases the media proxy function relays the MSRP messages without modification, while in other cases it enables MSRP B2BUA functionality. Other SIP related functions (e.g. related to routing, modification of SIP information etc) performed by the SIP device, and whether it acts a SIP B2BUA or not, is outside the scope of the definition. Section 5 describes additional assumptions regarding how the Middlebox handles MSRP in order to support the extension defined in this document.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Applicability statement</h1>
<p id="rfc.section.3.p.1">This document defines an MSRP extension, Connection Establishment for Media Anchoring (CEMA). Support of the extension is optional. MSRP endpoints can implement the extension in order to allow MSRP communication in networks where Middleboxes anchor the MSRP connection, without the need for the Middleboxes to enable MSRP B2BUA functionality in most cases. The document also defines a Session Description Protocol (SDP) <a href="#RFC4566">[RFC4566]</a> attribute, a=msrp-cema, that can be used by MSRP endpoints to indicate support of the CEMA extension.  </p>
<p id="rfc.section.3.p.2">The CEMA extension is primarily intended for MSRP endpoints that operate in networks in which Middleboxes that want to anchor media connections are deployed, without the need for the Middleboxes to enable MSRP B2BUA functionality. An example of such network is the IP Multimedia Subsystem (IMS) defined by the 3rd Generation Partnership Project (3GPP). The extension is also useful for other MSRP endpoints operating in other networks, but that communicate with MSRP endpoints in networks with such Middleboxes, unless there is a gateway between the networks that by default always enable MSRP B2BUA functionality.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Connection Establishment for Media Anchoring Mechanism</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> General</h1>
<p id="rfc.section.4.1.p.1">This section defines how an MSRP endpoint that supports the CEMA extension generates SDP offers and answers for MSRP, and what SDP information elements the MSRP endpoint uses when creating the TCP connection for the MSRP messages.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> MSRP Offerer Procedures</h1>
<p id="rfc.section.4.2.p.1">When an MSRP endpoint sends an SDP offer for MSRP, it generates the SDP offer according to the procedures in RFC 4975 (and RFC 4976, if it is using a relay for MSRP communication), with the following additions and modifications: </p>
<p id="rfc.section.4.2.p.2">1) The MSRP endpoint MUST include an SDP a=msrp-cema attribute in the MSRP media description of the SDP offer.  </p>
<p id="rfc.section.4.2.p.3">2) If the MSRP endpoint is not using a relay for MSRP communication, it MUST include an SDP a=setup attribute in the MSRP media description of the SDP offer, according to the procedures in RFC <a href="#RFC6135">[RFC6135]</a>.  </p>
<p id="rfc.section.4.2.p.4">3) If the MSRP endpoint is using a relay for MSRP communication, it MUST include the address information on the relay (the MSRP URI of the topmost SDP a=path attribute), rather than the address information of itself, in the SDP c/m-line associated with the MSRP media description. In addition, it MUST include an SDP a=setup:actpass attribute in the MSRP media description of the SDP offer.  </p>
<p id="rfc.section.4.2.p.5">When the MSRP endpoint receives the first SDP answer to the SDP offer above, and the SDP answer indicates that the offered MSRP media has been accepted by the remote MSRP endpoint (i.e. the port number of the MSRP media description is not set to zero), if the MSRP media description of the SDP answer does not contain an SDP a=msrp-cema attribute, the MSRP endpoint MUST check whether any of the following criteria is fulfilled: </p>
<p id="rfc.section.4.2.p.6">1) The SDP c/m-line address information associated with the MSRP media description does not match the information in the MSRP URI of the topmost SDP a=path attribute, and the MSRP media description contains an SDP a=setup:active attribute (indicating that the remote MSRP endpoint is "active").  </p>
<p id="rfc.section.4.2.p.7">2) The MSRP media description contains multiple SDP a=path attributes (indicating that MSRP relays are used).  </p>
<p id="rfc.section.4.2.p.8">If any, or both, of the criteria above is fulfilled, the MSRP endpoint MUST fallback to RFC 4975 behavior, by sending a new SDP offer according to the procedures in RFC 4975 and RFC 4976. The new offer MUST NOT contain an SDP a=msrp-cema attribute.  </p>
<p id="rfc.section.4.2.p.9">NOTE: In the absence of the SDP a=msrp-cema attribute in the new offer, the Middlebox will in all cases have to, in order to be able to anchor MSRP media, enable MSRP B2BUA functionality.  </p>
<p id="rfc.section.4.2.p.10">NOTE: The MSRP endpoint can send the new offer within the existing early dialog <a href="#RFC3261">[RFC3261]</a>, or it can terminate the early dialog and establish a new dialog by sending the new offer in a new initial INVITE request.  </p>
<p id="rfc.section.4.2.p.11">In all other cases, where the MSRP endpoint becomes "active", it MUST use the SDP c/m-line for establishing the MSRP TCP connection. If the MSRP endpoint becomes "passive", it will wait for the remote MSRP endpoint to establish the TCP connection, according to the procedures in RFC 4975.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> MSRP Answerer Procedures</h1>
<p id="rfc.section.4.3.p.1">When an MSRP endpoint receives an SDP offer for MSRP, it MUST check the following criteria: </p>
<p id="rfc.section.4.3.p.2">1) Both MSRP endpoints are using relays for MSRP communication.  </p>
<p id="rfc.section.4.3.p.3">NOTE: If the MSRP media description of the SDP offer contains contains multiple SDP a=path attributes, it can be determined that the remote MSRP endpoint is using a relay for MSRP communication.  </p>
<p id="rfc.section.4.3.p.4">2) The remote MSRP endpoint uses a relay for MSRP communciation, and will become "active" (either by default, or if the MSRP media description of the SDP offer contains an SDP a=setup:active attribute).  </p>
<p id="rfc.section.4.3.p.5">NOTE: This case should not occur if the remote MSRP endpoint supports the CEMA extension, as the remote MSRP endpoint would include an SDP a=setup:actpass attribute in the SDP offer, as described in section 4.2.  </p>
<p id="rfc.section.4.3.p.6">3) The MSRP endpoint uses a relay for MSRP communication, and is not able to become "passive" (the MSRP media description of the offer contains an SDP a=setup:passive attribute).  </p>
<p id="rfc.section.4.3.p.7">NOTE: This case should never occur, as an MSRP entity is not allowed to include an SDP a=setup:passive attribute in an SDP offer, as described in RFC 6135.  </p>
<p id="rfc.section.4.3.p.8">4) The MSRP media description of the SDP offer does not contain an SDP a=msrp-cema attribute, the SDP c/m-line address information associated with the MSRP media description does not match the information in the MSRP URI of the topmost SDP a=path attribute, and the remote MSRP endpoint will become "active" (either by default, or if the MSRP media description of the SDP offer contains an SDP a=setup:active attribute).  </p>
<p id="rfc.section.4.3.p.9">If any, or all, of the criteria above is fulfilled, the MSRP endpoint MUST fallback to RFC 4975 behavior, and generate the associated SDP answer according to the procedures in RFC 4975 and RFC 4976.  The MSRP endpoint MUST NOT insert an SDP a=msrp-cema attribute in the MSRP media description of the SDP answer.  </p>
<p id="rfc.section.4.3.p.10">In all other cases, the MSRP endpoint generates the associated SDP answer according to the procedures in RFC 4975 and RFC 4976, with the following additions and modifications: </p>
<p id="rfc.section.4.3.p.11">1) The MSRP endpoint MUST include an SDP a=msrp-cema attribute in the MSRP media description of the SDP answer.  </p>
<p id="rfc.section.4.3.p.12">2) If the MSRP endpoint is not using a relay for MSRP communication, it MUST include an SDP a=setup attribute in the MSRP media description of the answer, according to the procedures in RFC 6135.  </p>
<p id="rfc.section.4.3.p.13">3) If the MSRP endpoint is using a relay for MSRP communication, it MUST include the address information on the relay (the MSRP URI of the topmost SDP a=path attribute), rather than the address information of itself, in the SDP c/m-line associated with the MSRP media description. In addition, it MUST include an SDP a=setup: passive attribute in the MSRP media description of the SDP answer.  </p>
<p id="rfc.section.4.3.p.14">If the MSRP endpoint included an SDP a=msrp-cema attribute in the MSRP media description of the SDP answer, and if the MSRP endpoint becomes "active", it MUST use the received SDP c/m-line for establishing the MSRP TCP connection. If the MSRP endpoint becomes "passive", it will wait for the remote MSRP endpoint to establish the TCP connection, according to the procedures in RFC 4975.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Usage With The Alternative Connection Model</h1>
<p id="rfc.section.4.4.p.1">An MSRP endpoint that supports the CEMA extension MUST in addition also support the mechanism defined in RFC 6135, as it extends the number of scenarios where the CEMA extension can be used, and Middleboxes do not need to enable MSRP B2BUA functionality. An example is where a MSRP endpoint is using a relay for MSRP communication, and it needs to be "passive" in order to use the CEMA extension (instead of doing a fallback to RFC 4975 behavior.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Middlebox assumptions</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> General</h1>
<p id="rfc.section.5.1.p.1">This document does not specify explicit Middlebox behavior, eventhough some of the procedures will be enabled by Middleboxes. However, as the main reason behind the CEMA extension is to allow MSRP endpoints to communicate in networks where Middleboxes that want to anchor media are present, this document makes certain assumptions regarding to how such Middleboxes behave.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> MSRP awareness</h1>
<p id="rfc.section.5.2.p.1">This document assumes that an Middlebox, in order to support interoperability between UAs that support the CEMA extension and UAs that do not support the extension, is MSRP aware, meaning that it implements MSRP B2BUA functionality, and that it enables that functionality in cases where support of the CEMA extension is not indicated. In cases where support of the CEMA extension is indicated by at least one MSRP endpoint, the Middlebox can simply modifies the SDP c/m-line address information for the MSRP connection. However, MSRP communication will work if the Middlebox enables MSRP B2BUA functionality also in such cases.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> TCP connection reuse</h1>
<p id="rfc.section.5.3.p.1">When the CEMA extension is used, in cases where Middleboxes do not need to enable MSRP B2BUA functionality, the Middleboxes are not required to parse and modify the MSRP payload. An Middlebox that does not parse the MSRP payload might not enable re-usage of TCP connections for multiple MSRP sessions. Instead, in order to associate an MSRP message with a specific session, the Middlebox often assigns a unique local address:port combination for each MSRP session.  </p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> SDP integrity</h1>
<p id="rfc.section.5.4.p.1">This document assumes that Middleboxes are able to modify the SDP address information associated with the MSRP media, and therefore can not be deployed in environments that require SIP identity <a href="#RFC4916">[RFC4916]</a> based peer-to-peer SDP protection.  </p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> TLS</h1>
<p id="rfc.section.5.5.p.1">This document considers two approaches how an Middlebox handles TLS protected MSRP connections.  </p>
<p id="rfc.section.5.5.p.2">In the first approach, the Middlebox relays the MSRP media packets at the transport layer. The TLS handshake and resulting security association (SA) are established peer-to-peer between the MSRP endpoints. The Middlebox will see encrypted MSRP media packets, but is unable to inspect the cleartext content.  </p>
<p id="rfc.section.5.5.p.3">In the second approach, the Middlebox acts as a TLS B2BUA, meaning that separate SAs are established between the Middlebox and each MSRP endpoint. The Middlebox decrypts MSRP media packets received from one MSRP endpoint, and then re-encrypts them before sending them toward the other MSRP endpoint. With this approach, the Middlebox can inspect and modify the MSRP message content.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sec-security" id="sec-security">Security Considerations</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#sec-security-mitm" id="sec-security-mitm">Man in the middle</a>
</h1>
<p id="rfc.section.6.1.p.1">In some cases, where MSRP B2BUA functionality does not need to be enabled, the CEMA extension makes it easier for a man in the middle (MiTM) to transparently insert itself in the communication between MSRP endpoints in order to monitor or record unprotected MSRP communication. It does not however make it easier for a MiTM to monitor TLS protected MSRP, or in any significant way modify TLS protected MSRP content or even find out that the packets contain MSRP messages, since that would require the MiTM to implement MSRP B2BUA functionality, no matter if UAs support the CEMA extension or not. It would thus require the MiTM to terminate the TCP/TLS/MSRP connection in both directions.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#sec-security-tls" id="sec-security-tls">TLS</a>
</h1>
<p id="rfc.section.6.2.p.1">The CEMA extension supports the usage of name based authentication for TLS, also in the presence of Middleboxes.  </p>
<p id="rfc.section.6.2.p.2">NOTE: If an Middlebox acts as a TLS B2BUA, MSRP endpoints will also be able to use fingerprint based authentication for TLS, no matter if they support the CEMA extension or not. In such cases, as the Middlebox acts as a TLS endpoints, MSRP endpoints might be given an incorrect impression that there is an end-to-end SA between the MSRP endpoints.  </p>
<p id="rfc.section.6.2.p.3">If an Middlebox does not act as a TLS B2BUA, fingerprint based authentication will not work, as the "SIP Identity" based integrity protection of SDP will break.  Therefore, in addition to the authentication mechanisms defined in RFC 4975, an MSRP endpoint supporting the CEMA extension SHOULD also support an authentication mechanism that does not rely on peer-to-peer SDP integrity.  </p>
<p id="rfc.section.6.2.p.4">It is RECOMMENDED that an MSRP endpoint supports one of the following authentication mechanisms: </p>
<p id="rfc.section.6.2.p.5">1) TLS certificates together with support of interacting with a Certificate Management Service [ref to draft-ietf-sip-certs], to which it publishes the public version of its own self-signed certificate and from which it fetches on need the public certificates of other endpoints.  </p>
<p id="rfc.section.6.2.p.6">2) TLS-PSK managed e.g. by MIKEY-TICKET based Key Management and Key Management Service <a href="#RFC6043">[RFC6043]</a>.  </p>
<p id="rfc.section.6.2.p.7">NOTE: 3GPP has specified usage of the MIKEY-TICKET based Key Management and Key Management Service authentication mechanism for the IP Multimedia Subsystem (IMS).  </p>
<p id="rfc.section.6.2.p.8">When an MSRP endpoint generates an SDP offer for MSRPS it MUST, in addition to the SDP attributes associated with the TLS authentication mechanisms described in RFC 4975, it MUST include any information elements associated with the other authentication mechanisms that it supports.  </p>
<p id="rfc.section.6.2.p.9">Unless the MSRP endpoints are able to use name based authentication, and they support a common authentication mechanism, they MUST use that mechanism.  If the MSRP endpoints do not support such common authentication mechanism, they MUST try fingerprint based authentication, which will succeed if there are no Middleboxes present. If that also fails, the MSRP endpoints MUST either: </p>
<p id="rfc.section.6.2.p.10">1) Consider the TLS authentication as failed, in accordance with RFC 4975; or </p>
<p id="rfc.section.6.2.p.11">2) If the SIP signalling between the MSRP endpoints is protected through e.g.  SIPS, use fingerprint based authentication without requiring peer-to-peer SDP integrity, and thus trust the network endpoints in the signaling path for SDP integrity.  </p>
<p id="rfc.section.6.2.p.12">NOTE: As defined in RFC 4975, if TLS authentication fails, the user need to be able to decide whether to try to anyway establish an MSRP connection.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> IANA Registration of the SDP a=msrp-cema attribute</h1>
<p id="rfc.section.7.1.p.1">This section registers a new SDP attribute, a=msrp-cema. The required information for this registration, as specified in RFC 4566, is: </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#sec-acks" id="sec-acks">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">Thanks to Ben Campbell, Remi Denis-Courmont, Nancy Greene, Hadriel Kaplan, Adam Roach, Robert Sparks, Salvatore Loreto, Shida Schubert, Ted Hardie, Richard L Barnes, Inaki Baz Castillo, Saul Ibarra Corretge and Adrian Georgescu for their guidance and input in order to produce this document.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Change Log</h1>
<p id="rfc.section.9.p.1">[RFC EDITOR NOTE: Please remove this section when publishing]</p>
<p id="rfc.section.9.p.2">Changes from draft-ietf-simple-msrp-sessmatch-12 </p>

<ul>
<li>Extension name changed to Connection Establishment for Media Anchoring (CEMA).</li>
<li>Middlebox defintion added.</li>
<li>ALG terminology replaced with Middlebox.</li>
<li>SDP attribute name changed to a=msrp-cema.</li>
<li>Applicability Statement section expanded.</li>
<li>Re-structuring of MSRP Answerer section.</li>
<li>Changes based on comments from Sa&#250;l Ibarra Corretg&#233; (1406111).</li>
</ul>

<p> </p>
<p id="rfc.section.9.p.3">Changes from draft-ietf-simple-msrp-sessmatch-11 </p>

<ul>
<li>Modification of the sessmatch mechanism.</li>
<li>- Extension name changed to Alternative Connection Establishment (ACE)</li>
<li>- Session matching procedure no longer updated.</li>
<li>- SDP c/m-line used for MSRP TCP connection.</li>
<li>- sessmatch option-tag removed.</li>
<li>- a=msrp-ace attribute defined.</li>
<li>- Support of RFC 6135 mandatory.</li>
</ul>

<p> </p>
<p id="rfc.section.9.p.4">Changes from draft-ietf-simple-msrp-sessmatch-10 </p>

<ul><li>Sessmatch option-tag added, based on WG discussions and concensus.</li></ul>

<p> </p>
<p id="rfc.section.9.p.5">Changes from draft-ietf-simple-msrp-sessmatch-08 </p>

<ul><li>OPEN ISSUE regarding the need for a sessmatch option-tag removed.</li></ul>

<p> </p>
<p id="rfc.section.9.p.6">Changes from draft-ietf-simple-msrp-sessmatch-07 </p>

<ul>
<li>Sessmatch defined as an MSRP extension, rather than MSRP update</li>
<li>Additional security considerations text added</li>
</ul>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4975">[RFC4975]</b></td>
<td class="top">
<a>Campbell, B.</a>, <a>Mahy, R.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4975">The Message Session Relay Protocol (MSRP)</a>", RFC 4975, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4976">[RFC4976]</b></td>
<td class="top">
<a>Jennings, C.</a>, <a>Mahy, R.</a> and <a>A.B. Roach</a>, "<a href="http://tools.ietf.org/html/rfc4976">Relay Extensions for the Message Sessions Relay Protocol (MSRP)</a>", RFC 4976, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6135">[RFC6135]</b></td>
<td class="top">
<a>Holmberg, C.</a> and <a>S. Blau</a>, "<a href="http://tools.ietf.org/html/rfc6135">An Alternative Connection Model for the Message Session Relay Protocol (MSRP)</a>", RFC 6135, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4916">[RFC4916]</b></td>
<td class="top">
<a>Elwell, J.</a>, "<a href="http://tools.ietf.org/html/rfc4916">Connected Identity in the Session Initiation Protocol (SIP)</a>", RFC 4916, June 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6043">[RFC6043]</b></td>
<td class="top">
<a>Mattsson, J.</a> and <a>T. Tian</a>, "<a href="http://tools.ietf.org/html/rfc6043">MIKEY-TICKET: Ticket-Based Modes of Key Distribution in Multimedia Internet KEYing (MIKEY)</a>", RFC 6043, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="3GPP.23.228">[3GPP.23.228]</b></td>
<td class="top">
<a>3GPP</a>, "<a>IP Multimedia Subsystem (IMS); Stage 2</a>", 3GPP TS 23.228 10.6.0, September 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Christer Holmberg</span> 
	  <span class="n hidden">
		<span class="family-name">Holmberg</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Hirsalantie 11</span>

	  <span class="vcardline">
		<span class="locality">Jorvas</span>,  
		<span class="region"></span>
		<span class="code">02420</span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:christer.holmberg@ericsson.com">christer.holmberg@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Staffan Blau</span> 
	  <span class="n hidden">
		<span class="family-name">Blau</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">12637</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:staffan.blau@ericsson.com">staffan.blau@ericsson.com</a></span>

  </address>
</div>

</body>
</html>