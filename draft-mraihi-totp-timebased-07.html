<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>TOTP: Time-based One-time Password Algorithm</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="TOTP: Time-based One-time Password Algorithm">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">D. M'Raihi</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Verisign, Inc.</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">S. Machani</td></tr>
<tr><td class="header">Expires: July 8, 2011</td><td class="header">Diversinet Corp.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">M. Pei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Symantec</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Rydell</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Portwise, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 4, 2011</td></tr>
</table></td></tr></table>
<h1><br />TOTP: Time-based One-time Password Algorithm<br />draft-mraihi-totp-timebased-07.txt</h1>

<h3>Abstract</h3>

<p>This document describes an extension of one-time password (OTP) algorithm, namely
      the HAMC-Based One-Time Password (HOTP) Algorithm as defined in RFC 4226,  
      to support time-based moving factor. The HOTP algorithm specifies an event
      based OTP algorithm where the moving factor is an event counter. The present work 
      bases the moving factor on a time value.  A time-based variant of the OTP algorithm 
      provides short-lived OTP values, which are desirable for enhanced security.
</p>
<p>The proposed algorithm can be used across a wide range of network applications ranging from 
      remote Virtual Private Network (VPN) access, Wi-Fi network logon to transaction-oriented Web
      applications. The authors believe that a common and shared algorithm will facilitate adoption of 
      two-factor authentication on the Internet by enabling interoperability across commercial and 
      open-source implementations.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 8, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Section-Introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.2.</a>&nbsp;
Background<br />
<a href="#terms">2.</a>&nbsp;
Notation and Terminology<br />
<a href="#AlgorithmRequirements">3.</a>&nbsp;
Algorithm Requirements<br />
<a href="#Section-Time-based-Variant">4.</a>&nbsp;
TOTP Algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Notations">4.1.</a>&nbsp;
Notations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
Description<br />
<a href="#Section-Security">5.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.2.</a>&nbsp;
Validation and Time-step Size<br />
<a href="#anchor6">6.</a>&nbsp;
Resynchronization<br />
<a href="#anchor7">7.</a>&nbsp;
IANA Considerations<br />
<a href="#Section-Acknowledgements">8.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative references<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#Section-Reference-Impl">Appendix&nbsp;A.</a>&nbsp;
TOTP Algorithm: Reference Implementation<br />
<a href="#Section-Test-Vectors">Appendix&nbsp;B.</a>&nbsp;
Test Vectors<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="Section-Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Scope</h3>

<p>This document describes an extension of one-time password (OTP) algorithm 
        HOTP as defined in <a class='info' href='#RFC4226'>[RFC4226]<span> (</span><span class='info'>M'Raihi, D., Bellare, M., Hoornaert, F., Naccache, D., and O. Ranen, &ldquo;HOTP: An HMAC-Based One-Time Password Algorithm,&rdquo; December&nbsp;2005.</span><span>)</span></a> to support time based moving factor.
        
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Background</h3>

<p>As defined in <a class='info' href='#RFC4226'>[RFC4226]<span> (</span><span class='info'>M'Raihi, D., Bellare, M., Hoornaert, F., Naccache, D., and O. Ranen, &ldquo;HOTP: An HMAC-Based One-Time Password Algorithm,&rdquo; December&nbsp;2005.</span><span>)</span></a> the HOTP algorithm is based on the HMAC-SHA-1 algorithm, as specified in <a class='info' href='#RFC2104'>[RFC2104]<span> (</span><span class='info'>Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;HMAC: Keyed-Hashing for Message Authentication,&rdquo; February&nbsp;1997.</span><span>)</span></a> applied to an increasing counter value representing the message in the HMAC computation.
</p>
<p>Basically, the output of the HMAC-SHA-1 calculation is truncated to obtain user-friendly values:
</p>
<p>HOTP(K,C) = Truncate(HMAC-SHA-1(K,C))
</p>
<p>where Truncate represents the function that can convert an HMAC-SHA-1 value into an HOTP value. <br />
<br />

</p>
<p>TOTP is the time-based variant of this algorithm where a value T derived from a time reference and a time step replaces the counter C in the HOTP computation.
</p>
<p>The default HMAC-SHA-1 function could be replaced by HMAC-SHA-256 or HMAC-SHA-512 to leverage HMAC implementations based on SHA-256 or SHA-512 hash functions.
</p>
<a name="terms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Notation and Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>, &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>
</p>
<a name="AlgorithmRequirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Algorithm Requirements</h3>

<p> This section summarizes the requirements taken into account for designing the TOTP algorithm. 
</p>
<p> R1 - The prover (e.g. token, soft token) and verifier (authentication or validation server) MUST have access to the Unix Time 
</p>
<p> R2 - The prover and verifier MUST either share a same secret or the knowledge of a secret transformation to generate a shared secret 
</p>
<p> R3 - The algorithm MUST use HOTP [RFC4226] as a key building block. 
</p>
<p> R4 - The prover and verifier MUST use the same time step value X. 
</p>
<p> R5 - There MUST be a unique secret (key) for each prover. 
</p>
<p> R6 - The keys SHOULD be randomly generated or derived using a key derivation algorithms. 
</p>
<p> R7 - The keys MAY be stored in a tamper-resistant device and SHOULD be protected against unauthorized access and usage. 
</p>
<p> R8 - The TOTP algorithm SHOULD be used for online application. 
</p>
<a name="Section-Time-based-Variant"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
TOTP Algorithm</h3>

<p>This variant of the HOTP algorithm specifies the calculation of a one-time 
        password value, based on a representation of the counter as a time factor.
</p>
<a name="Notations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Notations</h3>

<p>- X represents the time step in seconds (default value X = 30 seconds) and is a system parameter;
</p>
<p>- T0 is the Unix time to start counting time steps (default value is 0, Unix epoch) and is also a system parameter.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Description</h3>

<p> Basically, we define TOTP as TOTP = HOTP(K, T) where T is an integer and represents the number of time steps between 
    		the initial counter time T0 and the current Unix time (i.e. the number of seconds elapsed since midnight UTC of January 1, 1970).
</p>
<p> More specifically T = (Current Unix time - T0) / X where:
</p>
<p>- X represents the time step in seconds (default value X = 30 seconds) and is a system parameter;
</p>
<p>- T0 is the Unix time to start counting time steps (default value is 0, Unix epoch) and is also a system parameter;
</p>
<p>- The default floor function is used in the computation. For example, with T0 = 0 and time step X = 30, T = 1 if the current 
			Unix time is 59 seconds and T = 2 if the current Unix time is 60 seconds.
</p>
<a name="Section-Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
General</h3>

<p> The security and strength of this algorithm depends on the 
    properties of the underlying building block HOTP, which is a 
    construction based on HMAC <a class='info' href='#RFC2104'>[RFC2104]<span> (</span><span class='info'>Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;HMAC: Keyed-Hashing for Message Authentication,&rdquo; February&nbsp;1997.</span><span>)</span></a> using
    SHA-1 as the hash function. 
</p>
<p> The conclusion of the security analysis detailed in 
    <a class='info' href='#RFC4226'>[RFC4226]<span> (</span><span class='info'>M'Raihi, D., Bellare, M., Hoornaert, F., Naccache, D., and O. Ranen, &ldquo;HOTP: An HMAC-Based One-Time Password Algorithm,&rdquo; December&nbsp;2005.</span><span>)</span></a> is that, for all practical 
    purposes, the outputs of the dynamic truncation on distinct 
    inputs are uniformly and independently distributed strings. 
</p>
<p> The analysis demonstrates that the best possible attack against the 
    HOTP function is the brute force attack. 
</p>
<p> As indicated in the algorithm requirement section, keys SHOULD be 
    chosen at random or using a cryptographically strong pseudo-random 
    generator properly seeded with a random value. 
</p>
<p> Keys SHOULD be of the length of the HMAC output to facilitate
    interoperability. 
</p>
<p> We RECOMMEND following the recommendations in 
    <a class='info' href='#RFC4086'>[RFC4086]<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Recommendations for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a> for all pseudo-random and 
    random generations. The pseudo-random numbers used for
    generating the keys SHOULD successfully pass the 
    randomness test specified in <a class='info' href='#CN'>[CN]<span> (</span><span class='info'>Coron, J. and D. Naccache, &ldquo;An accurate evaluation of Maurer's universal test,&rdquo; February&nbsp;1999.</span><span>)</span></a> or
    a similar well-recognized test. 
</p>
<p> All the communications SHOULD take place over a secure 
    channel e.g. SSL/TLS, IPsec connections. 
</p>
<p> We also RECOMMEND storing the keys securely in the 
    validation system, and more specifically encrypting them using 
    tamper-resistant hardware encryption and exposing them only when 
    required: for example, the key is decrypted when needed to verify 
    an OTP value, and re-encrypted immediately to limit exposure in 
    the RAM for a short period of time. 
</p>
<p> The key store MUST be in a secure area, to avoid as much as possible 
    direct attack on the validation system and secrets database. 
    Particularly, access to the key material should be limited to programs 
    and processes required by the validation system only. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Validation and Time-step Size</h3>

<p>An OTP generated within the same Time-step will be the same.  
            When an OTP is received at a validation system, it doesn't 
            know a client's exact timestamp when an OTP was generated. The
            validation system may typically use the timestamp when an OTP is 
            received for OTP comparison. Due to the network latency for an OTP
            to transmit from a requesting application to a validation system
            and user's actual input time of an OTP to a receiving system, such
            timestamp gap between the actual OTP generation time and server's
            receiving time may be large. The receiving time at the validation
            system and the actual OTP generation may not fall within the 
            same Time-step window that produce the same OTP. When an OTP
            is generated at the end of a Time-step window, the receiving time
            most likely falls into the next Time-step window. 
            A validation system SHOULD typically set a policy for an 
            acceptable OTP transmission delay window for validation. 
            The validation system should compare OTPs not only with the 
            receiving timestamp but also the past timesteps that are 
            within the transmission delay. A larger acceptable delay window
            would introduce some OTP attack window. We RECOMMEND that 
            at most one time step is allowed as the network delay. 
</p>
<p>The Time-step size has impact on both security and usability.
            A larger Time-step size means larger validity window for an OTP
            to be accepted by a validation system. There are the following
            implications with a larger Time-step size.
</p>
<p>At first, a larger Time-step size exposes larger window for
            attack. When an OTP is generated and exposed to a third party
            before it is consumed, the third party can consume the OTP within
            the Time-step window.
</p>
<p>We RECOMMEND default Time-step size for 30 seconds.
</p>
<p>Secondly, the next different OTP must be generated in the next 
            Time-step window. A user must wait till the clock moves to the
            next Time-step window from the last submission. The waiting time
            may not be exactly the length of Time-step depending on when
            the last OTP was generated. For example, if the last OTP was 
            generated at the half way in a Time-step window, the waiting
            time for the next OTP is half of length of Time-step. In general,
            a larger Time-step window means larger waiting time for
            a user to get the next valid OTP after the last successfully 
            OTP validation. A too large window, for example 10 minutes,
            most probably won't be suitable for typical internet login 
            use cases; a user may not be able to get the next OTP within
            10 minutes and therefore re-login back to the same site
            in 10 minutes. The default Time-step size 30 seconds is 
            recommended.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Resynchronization</h3>

<p> Because of possible clock drifts between a client and a validation
            server, we RECOMMEND that the validator be set with a specific
            limit to the number of time steps a prover can be 'out of synch' 
            before being not validated/rejected.
</p>
<p> This limit can be set both forward and backwards from the calculated
            time step on receipt of the OTP value. If the time step is 30 seconds 
            as recommended, and the validator is set to only accept 2 time step 
            backwards then the maximum elapsed time drift would be around 
            89 seconds, i.e. 29 seconds in the calculated time step and 60 for 
            two backward time steps. 
</p>
<p> This would mean the validator could perform a validation against
 	    the current time and then further two validations for each backward
            step (for a total of 3 validations). Upon successful validation,
            the validation server can record the detected clock drift for
            the token in terms of number of Time-step. When a new OTP
            is received after this step, the validator can validate the OTP with
            current timestamp adjusted with recorded number of Time-step clock 
            drifts for the token.
</p>
<p> Also, it is important to note that the longer a prover has not sent 
            an OTP to a validation system, the longer (potentially) the accumulated 
            clock drift between the prover and the verifier. In such cases, 
            the default synchronization may not be proper when the drift exceeds 
            beyond allowed threshold. Additional authentication measures SHOULD 
            be used for the validation system to safely authenticate the prover. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>The OTP algorithm defined in this document can be referred by a URI defined in a 
      separate document. <a class='info' href='#ALGP'>[ALGP]<span> (</span><span class='info'>Hoyer, P., Pei, M., Machani, S., and A. Doherty, &ldquo;Additional Portable Symmetric Key Container (PSKC) Algorithm Profiles,&rdquo; December&nbsp;2008.</span><span>)</span></a> is such an attempt that defines various OTP related algorithm URIs. There is no registration needed in this document.
</p>
<p>
</p>
<a name="Section-Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>The authors of this draft would like to thank the following people
   for their contributions and support to make this a better
   specification: Hannes Tschofenig, Jonathan Tuliani, David Dix, Siddharth Bajaj, 
   Stu Veath, Shuh Chang, Oanh Hoang, John Huang, and Siddhartha Mohapatra.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative references</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2104">[RFC2104]</a></td>
<td class="author-text">Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;<a href="http://www.ietf.org/rfc/rfc2104.txt">HMAC: Keyed-Hashing for Message Authentication</a>,&rdquo; RFC&nbsp;2104, February&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">&ldquo;<a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement
          Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4086">[RFC4086]</a></td>
<td class="author-text">Eastlake, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://www.ietf.org/rfc/rfc4086.txt">Randomness Recommendations for Security</a>,&rdquo; RFC&nbsp;4086, June&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4226">[RFC4226]</a></td>
<td class="author-text">M'Raihi, D., Bellare, M., Hoornaert, F., Naccache, D., and O. Ranen, &ldquo;<a href="http://www.ietf.org/rfc/rfc4226.txt">HOTP: An HMAC-Based One-Time Password Algorithm</a>,&rdquo; RFC&nbsp;4226, December&nbsp;2005.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ALGP">[ALGP]</a></td>
<td class="author-text">Hoyer, P., Pei, M., Machani, S., and A. Doherty, &ldquo;<a href="http://tools.ietf.org/id/draft-hoyer-keyprov-pskc-algorithm-profiles-01.txt">Additional Portable Symmetric Key Container (PSKC) Algorithm Profiles</a>,&rdquo; December&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="CN">[CN]</a></td>
<td class="author-text">Coron, J. and D. Naccache, &ldquo;<a href="http://www.gemplus.com/smart/rd/publications/pdf/CN99maur.pdf">An accurate evaluation of Maurer's universal test</a>,&rdquo; LNCS&nbsp;1556, February&nbsp;1999.</td></tr>
</table>

<a name="Section-Reference-Impl"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
TOTP Algorithm: Reference Implementation</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
import java.lang.reflect.UndeclaredThrowableException;
import java.security.GeneralSecurityException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.math.BigInteger;
import java.util.TimeZone;

/**
 * This an example implementation of the OATH TOTP algorithm.
 * Visit www.openauthentication.org for more information.
 *
 * @author Johan Rydell, PortWise, Inc.
 */
public class TOTP {

	private TOTP() {}


	/**
	 * This method uses the JCE to provide the crypto
	 * algorithm.
	 * HMAC computes a Hashed Message Authentication Code with the
	 * crypto hash algorithm as a parameter.
	 *
	 * @param crypto     the crypto algorithm (HmacSHA1, HmacSHA256,
	 *                            HmacSHA512)
	 * @param keyBytes   the bytes to use for the HMAC key
	 * @param text       the message or text to be authenticated.
	 */
	private static byte[] hmac_sha(String crypto, byte[] keyBytes,
			byte[] text){
		try {
			Mac hmac;
			hmac = Mac.getInstance(crypto);
			SecretKeySpec macKey =
				new SecretKeySpec(keyBytes, "RAW");
			hmac.init(macKey);
			return hmac.doFinal(text);
		} catch (GeneralSecurityException gse) {
			throw new UndeclaredThrowableException(gse);
		}
	}


	/**
	 * This method converts HEX string to Byte[]
	 *
	 * @param hex   the HEX string
	 *
	 * @return      A byte array
	 */
	private static byte[] hexStr2Bytes(String hex){
		// Adding one byte to get the right conversion
		// values starting with "0" can be converted
		byte[] bArray = new BigInteger("10" + hex,16).toByteArray();

		// Copy all the REAL bytes, not the "first"
		byte[] ret = new byte[bArray.length - 1];
		for (int i = 0; i &lt; ret.length ; i++)
			ret[i] = bArray[i+1];
		return ret;
	}


	private static final int[] DIGITS_POWER
	// 0 1  2   3    4     5      6       7        8
	= {1,10,100,1000,10000,100000,1000000,10000000,100000000 };


	/**
	 * This method generates an TOTP value for the given
	 * set of parameters.
	 *
	 * @param key   the shared secret, HEX encoded
	 * @param time     a value that reflects a time
	 * @param returnDigits     number of digits to return
	 *
	 * @return      A numeric String in base 10 that includes
	 *              {@link truncationDigits} digits
	 */
	public static String generateTOTP(String key,
			String time,
			String returnDigits){
		return generateTOTP(key, time, returnDigits, "HmacSHA1");
	}


	/**
	 * This method generates an TOTP value for the given
	 * set of parameters.
	 *
	 * @param key   the shared secret, HEX encoded
	 * @param time     a value that reflects a time
	 * @param returnDigits     number of digits to return
	 *
	 * @return      A numeric String in base 10 that includes
	 *              {@link truncationDigits} digits
	 */
	public static String generateTOTP256(String key,
			String time,
			String returnDigits){
		return generateTOTP(key, time, returnDigits, "HmacSHA256");
	}


	/**
	 * This method generates an TOTP value for the given
	 * set of parameters.
	 *
	 * @param key   the shared secret, HEX encoded
	 * @param time     a value that reflects a time
	 * @param returnDigits     number of digits to return
	 *
	 * @return      A numeric String in base 10 that includes
	 *              {@link truncationDigits} digits
	 */
	public static String generateTOTP512(String key,
			String time,
			String returnDigits){
		return generateTOTP(key, time, returnDigits, "HmacSHA512");
	}


	/**
	 * This method generates an TOTP value for the given
	 * set of parameters.
	 *
	 * @param key   the shared secret, HEX encoded
	 * @param time     a value that reflects a time
	 * @param returnDigits     number of digits to return
	 * @param crypto    the crypto function to use
	 *
	 * @return      A numeric String in base 10 that includes
	 *              {@link truncationDigits} digits
	 */
	public static String generateTOTP(String key,
			String time,
			String returnDigits,
			String crypto){
		int codeDigits = Integer.decode(returnDigits).intValue();
		String result = null;

		// Using the counter
		// First 8 bytes are for the movingFactor
		// Complaint with base RFC 4226 (HOTP)
		while(time.length() &lt; 16 )
			time = "0" + time;

		// Get the HEX in a Byte[]
		byte[] msg = hexStr2Bytes(time);
		byte[] k = hexStr2Bytes(key);

		byte[] hash = hmac_sha(crypto, k, msg);

		// put selected bytes into result int
		int offset = hash[hash.length - 1] &amp; 0xf;

		int binary =
			((hash[offset] &amp; 0x7f) &lt;&lt; 24) |
			((hash[offset + 1] &amp; 0xff) &lt;&lt; 16) |
			((hash[offset + 2] &amp; 0xff) &lt;&lt; 8) |
			(hash[offset + 3] &amp; 0xff);

		int otp = binary % DIGITS_POWER[codeDigits];

		result = Integer.toString(otp);
		while (result.length() &lt; codeDigits) {
			result = "0" + result;
		}
		return result;
	}


	public static void main(String[] args) {
		// Seed for HMAC-SHA1 - 20 bytes
		String seed = "3132333435363738393031323334353637383930";
		// Seed for HMAC-SHA256 - 32 bytes
		String seed32 = "3132333435363738393031323334353637383930" +
		"313233343536373839303132";
		// Seed for HMAC-SHA512 - 64 bytes
		String seed64 = "3132333435363738393031323334353637383930" +
		"3132333435363738393031323334353637383930" +
		"3132333435363738393031323334353637383930" +
		"31323334";
		long T0 = 0;
		long X = 30;
		long testTime[] = {59L, 1111111109L, 1111111111L,
				1234567890L, 2000000000L, 20000000000L};

		String steps = "0";
		DateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
		df.setTimeZone(TimeZone.getTimeZone("UTC"));

		try{
			System.out.println(
					"+---------------+-----------------------+" +
			"------------------+--------+--------+");
			System.out.println(
					"|  Time(sec)    |   Time (UTC format)   " +
			"| Value of T(Hex)  |  TOTP  | Mode   |");
			System.out.println(
					"+---------------+-----------------------+" +
			"------------------+--------+--------+");

			for(int i=0; i&lt;testTime.length; i++) {
				long T = (testTime[i] - T0)/X;
				steps = Long.toHexString(T).toUpperCase();
				while(steps.length() &lt; 16) steps = "0" + steps;
				String fmtTime = String.format("%1$-11s", testTime[i]);
				String utcTime = df.format(new Date(testTime[i]*1000));
				System.out.print("|  " + fmtTime + "  |  " + utcTime +
						"  | " + steps + " |");
				System.out.println(generateTOTP(seed, steps, "8",
				"HmacSHA1") + "| SHA1   |");
				System.out.print("|  " + fmtTime + "  |  " + utcTime +
						"  | " + steps + " |");
				System.out.println(generateTOTP(seed32, steps, "8",
				"HmacSHA256") + "| SHA256 |");
				System.out.print("|  " + fmtTime + "  |  " + utcTime +
						"  | " + steps + " |");
				System.out.println(generateTOTP(seed64, steps, "8",
				"HmacSHA512") + "| SHA512 |");

				System.out.println(
						"+---------------+-----------------------+" +
				"------------------+--------+--------+");
			}
		}catch (final Exception e){
			System.out.println("Error : " + e);
		}
	}
}
</pre></div>
<p>
</p>
<a name="Section-Test-Vectors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Test Vectors</h3>

<p>This section provides test values that can be used for HOTP time-based 
      variant algorithm interoperability test.
</p>
<p>The test token shared secret uses the ASCII string value 
      "12345678901234567890". 
      
      With Time Step X = 30, and Unix epoch as initial value to count time steps
      where T0 = 0, the TOTP algorithm will display the following  values 
      for specified modes and timestamps.
</p><br /><hr class="insert" />
<a name="TOTPTable"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="center"><col align="center"><col align="center"><col align="center">
<tr><th align="center">Time (sec)</th><th align="center">UTC Time</th><th align="center">Value of T (hex)</th><th align="center">TOTP</th><th align="center">Mode</th></tr>
<tr>
<td align="center">59</td>
<td align="center">1970-01-01 00:00:59</td>
<td align="center">0000000000000001</td>
<td align="center">94287082</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">59</td>
<td align="center">1970-01-01 00:00:59</td>
<td align="center">0000000000000001</td>
<td align="center">46119246</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">59</td>
<td align="center">1970-01-01 00:00:59</td>
<td align="center">0000000000000001</td>
<td align="center">90693936</td>
<td align="center">SHA512</td>
</tr>
<tr>
<td align="center">1111111109</td>
<td align="center">2005-03-18 01:58:29</td>
<td align="center">00000000023523EC</td>
<td align="center">07081804</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">1111111109</td>
<td align="center">2005-03-18 01:58:29</td>
<td align="center">00000000023523EC</td>
<td align="center">68084774</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">1111111109</td>
<td align="center">2005-03-18 01:58:29</td>
<td align="center">00000000023523EC</td>
<td align="center">25091201</td>
<td align="center">SHA512</td>
</tr>
<tr>
<td align="center">1111111111</td>
<td align="center">2005-03-18 01:58:31</td>
<td align="center">00000000023523ED</td>
<td align="center">14050471</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">1111111111</td>
<td align="center">2005-03-18 01:58:31</td>
<td align="center">00000000023523ED</td>
<td align="center">67062674</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">1111111111</td>
<td align="center">2005-03-18 01:58:31</td>
<td align="center">00000000023523ED</td>
<td align="center">99943326</td>
<td align="center">SHA512</td>
</tr>
<tr>
<td align="center">1234567890</td>
<td align="center">2009-02-13 23:31:30</td>
<td align="center">000000000273EF07</td>
<td align="center">89005924</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">1234567890</td>
<td align="center">2009-02-13 23:31:30</td>
<td align="center">000000000273EF07</td>
<td align="center">91819424</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">1234567890</td>
<td align="center">2009-02-13 23:31:30</td>
<td align="center">000000000273EF07</td>
<td align="center">93441116</td>
<td align="center">SHA512</td>
</tr>
<tr>
<td align="center">2000000000</td>
<td align="center">2033-05-18 03:33:20</td>
<td align="center">0000000003F940AA</td>
<td align="center">69279037</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">2000000000</td>
<td align="center">2033-05-18 03:33:20</td>
<td align="center">0000000003F940AA</td>
<td align="center">90698825</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">2000000000</td>
<td align="center">2033-05-18 03:33:20</td>
<td align="center">0000000003F940AA</td>
<td align="center">38618901</td>
<td align="center">SHA512</td>
</tr>
<tr>
<td align="center">20000000000</td>
<td align="center">2603-10-11 11:33:20</td>
<td align="center">0000000027BC86AA</td>
<td align="center">65353130</td>
<td align="center">SHA1</td>
</tr>
<tr>
<td align="center">20000000000</td>
<td align="center">2603-10-11 11:33:20</td>
<td align="center">0000000027BC86AA</td>
<td align="center">77737706</td>
<td align="center">SHA256</td>
</tr>
<tr>
<td align="center">20000000000</td>
<td align="center">2603-10-11 11:33:20</td>
<td align="center">0000000027BC86AA</td>
<td align="center">47863826</td>
<td align="center">SHA512</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: TOTP Table&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">David M'Raihi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Verisign, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">685 E. Middlefield Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mountain View, CA  94043</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:davidietf@gmail.com">davidietf@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Salah Machani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Diversinet Corp.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2225 Sheppard Avenue East, Suite 1801</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Toronto, Ontario  M2J 5C2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:smachani@diversinet.com">smachani@diversinet.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mingliang Pei</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Symantec</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">510 E. Middlefield Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mountain View, CA  94043</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Mingliang_Pei@symantec.com">Mingliang_Pei@symantec.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Johan Rydell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Portwise, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">275 Hawthorne Ave, Suite 119</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94301</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:johan.rydell@portwise.com">johan.rydell@portwise.com</a></td></tr>
</table>
</body></html>
