<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Sieve Email Filtering: Include Extension </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction and Overview">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions Used in This Document">
<link href="#rfc.section.3" rel="Chapter" title="3 Include Extension">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 General Considerations">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Control Structure include">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Control Structure return">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Interaction with Variables">
<link href="#rfc.section.3.4.1" rel="Chapter" title="3.4.1 Control Structure global">
<link href="#rfc.section.3.4.2" rel="Chapter" title="3.4.2 Variables Namespace global">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title='5.1 "include" Extension Registration'>
<link href="#rfc.references" rel="Chapter" title="6 References">
<link href="#rfc.references.1" rel="Chapter" title="6.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="6.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgments">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Change History (to be removed prior to publication as an RFC)">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Sieve Email Filtering "include" extension permits users to include one Sieve script inside another. This can make managing large scripts or multiple sets of scripts much easier, and allows a site and its users to build up libraries of scripts. Users are able to include their own personal scripts or site-wide scripts.  " />
  <meta name="description" content="The Sieve Email Filtering "include" extension permits users to include one Sieve script inside another. This can make managing large scripts or multiple sets of scripts much easier, and allows a site and its users to build up libraries of scripts. Users are able to include their own personal scripts or site-wide scripts.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">C. Daboo</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">A. Stone</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">September 24, 2011</td>
</tr>
<tr>
<td class="left">Expires: March 27, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Sieve Email Filtering: Include Extension <br />
  <span class="filename">draft-ietf-sieve-include-12</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Sieve Email Filtering "include" extension permits users to include one Sieve script inside another. This can make managing large scripts or multiple sets of scripts much easier, and allows a site and its users to build up libraries of scripts. Users are able to include their own personal scripts or site-wide scripts.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 27, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction and Overview</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions Used in This Document</a>
</li>
<li>3.   <a href="#rfc.section.3">Include Extension</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">General Considerations</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Control Structure include</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Control Structure return</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Interaction with Variables</a>
</li>
<li>3.4.1.   <a href="#rfc.section.3.4.1">Control Structure global</a>
</li>
<li>3.4.2.   <a href="#rfc.section.3.4.2">Variables Namespace global</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">"include" Extension Registration</a>
</li>
<li>6.   <a href="#rfc.references">References</a>
</li>
<li>6.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>6.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgments</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Change History (to be removed prior to publication as an RFC)</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction and Overview</h1>
<p id="rfc.section.1.p.1">It's convenient to be able to break <a href="#RFC5228">SIEVE</a> <cite title="NONE">[RFC5228]</cite> scripts down into smaller components which can be reused in a variety of different circumstances. For example, users may want to have a default script and a special 'vacation' script, the latter being activated when the user goes on vacation. In that case the default actions should continue to be run, but a vacation command should be executed first. One option is to edit the default script to add or remove the vacation command as needed. Another is to have a vacation script that simply has a vacation command and then includes the default script.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Conventions Used in This Document</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">Conventions for notations are as in <a href="#RFC5228">SIEVE</a> <cite title="NONE">[RFC5228]</cite> Section 1.1.  </p>
<p id="rfc.section.2.p.3">The following key phrases are used to describe scripts and script execution: </p>

<dl>
<dt>script</dt>
<dd style="margin-left: 8">
<br> a valid Sieve script.  </dd>
<dt>script execution</dt>
<dd style="margin-left: 8">
<br> an instance of a Sieve interpreter invoked for a given message delivery, starting with the user's active script and continuing through any included scripts until the final disposition of the message (e.g. delivered, forwarded, discarded, rejected, etc.).  </dd>
<dt>immediate script</dt>
<dd style="margin-left: 8">
<br> the individual Sieve script file being executed.  </dd>
<dt>including script</dt>
<dd style="margin-left: 8">
<br> the individual Sieve script file that had an include statement which included the immediate script.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Include Extension</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> General Considerations</h1>
<p id="rfc.section.3.1.p.1">Sieve implementations that implement the "include", "return", and "global" commands described below have an identifier of "include" for use with the capability mechanism. If any of the "include", "return", or "global" commands are used in a script, the "include" capability MUST be listed in the "require" statement in that script.  </p>
<p id="rfc.section.3.1.p.2">Sieve implementations need to track the use of actions in included scripts so that implicit "keep" behavior can be properly determined based on whether any actions have executed in any script.  </p>
<p id="rfc.section.3.1.p.3">Sieve implementations are allowed to limit the total number of nested included scripts, but MUST provide for a total of at least three levels of nested scripts including the top-level script. An error MUST be generated either when the script is uploaded to the Sieve repository, or when the script is executed, if any nesting limit is exceeded. If such an error is detected whilst processing a Sieve script, an implicit "keep" action MUST be executed to prevent loss of any messages.  </p>
<p id="rfc.section.3.1.p.4">Sieve implementations MUST NOT allow recursive script inclusion.  An error MUST be generated when such a script is executed. An error SHOULD be generated when such a script is marked active with <a href="#RFC5804">MANAGESIEVE</a> <cite title="NONE">[RFC5804]</cite> or similar mechanisms.  Implementations MUST NOT generate errors for recursive inclusions at upload time, as this would force an upload ordering requirement upon script authors / generators. However, if an active script is replaced with a faulty script and would remain the active script, an error MUST be generated and the upload MUST fail.  If an include recursion error is detected during script execution, an implicit "keep" action MUST be executed to prevent loss of any messages.  </p>
<p id="rfc.section.3.1.p.5">Sieve implementations MUST generate an error at execution time if an included script does not exist, except when the ":optional" parameter is specified. Implementations MUST NOT generate errors for scripts missing at upload time, as this would force an upload ordering requirement upon script authors / generators.  </p>
<p id="rfc.section.3.1.p.6">If the Sieve "variables" extension <a href="#RFC5229">[RFC5229]</a> is present, an issue arises with the "scope" of variables defined in scripts that may include each other. For example, if a script defines the variable "${status}" with one particular meaning or usage, and another defines "${status}" with a different meaning, then if one script includes the other there is an issue as to which "${status}" is being referenced. To solve this problem, Sieve implementations MUST follow the scoping rules defined in <a href="#variables">Section 3.4</a> and support the "global" command defined there.  </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Control Structure include</h1>
<div id="#rfc.figure.1"></div>
<pre>
   Usage:  include [LOCATION] [":once"] [":optional"] &lt;value: string&gt;

           LOCATION = ":personal" / ":global"
</pre>
<p id="rfc.section.3.2.p.1">The "include" command takes an optional "location" parameter, an optional ":once" parameter, an optional ":optional" parameter, and a single string argument representing the name of the script to include for processing at that point. Implementations MUST restrict script names according to <a href="#RFC5804">MANAGESIEVE</a> <cite title="NONE">[RFC5804]</cite>, Section 1.6. The script name argument MUST be a constant string as defined in <a href="#RFC5229">VARIABLES</a> <cite title="NONE">[RFC5229]</cite>, Section 3; implementations MUST NOT allow variable expansion in the script name argument.  </p>
<p id="rfc.section.3.2.p.2">The "location" parameter MUST default to ":personal" if not specified.  The "location" parameter MUST NOT be specified more than once.  The "location" has the following meanings: </p>
<p></p>

<dl>
<dt>:personal</dt>
<dd style="margin-left: 8">
<br> Indicates that the named script is stored in the user's own personal (private) Sieve repository.  </dd>
<dt>:global</dt>
<dd style="margin-left: 8">
<br> Indicates that the named script is stored in a site-wide Sieve repository, accessible to all users of the Sieve system.  </dd>
</dl>

<p> </p>
<p id="rfc.section.3.2.p.4">The ":once" parameter tells the interpreter only to include the named script if it has not already been included at any other point during script execution. If the script has already been included, processing continues immediately following the include command. Implementations MUST NOT generate an error if an "include :once" command names a script whose inclusion would be recursive; in this case, the script MUST be considered previously included and therefore "include :once" will not include it again.  </p>
<p id="rfc.section.3.2.p.5">The ":optional" parameter indicates that the script may be missing.  Ordinarily, an implementation MUST generate an error at runtime if an include command specifies a script that does not exist. When ":optional" is specified, implementations MUST NOT generate an error for a missing script, and MUST continue as if the include command had not been present.  </p>
<p id="rfc.section.3.2.p.6">Note: It is RECOMMENDED that script authors / generators use this parameter only when including a script that performs general duties such as declaring global variables and making sanity checks of the environment.  </p>
<p id="rfc.section.3.2.p.7">The included script MUST be a valid Sieve script. Each script MUST have its own "require" statements for all optional capabilities used by that script. The scope of a "require" statement is the script in which it immediately appears, and neither inherits nor passes on capabilities to other scripts during the course of execution.  </p>
<p id="rfc.section.3.2.p.8">A "stop" command in an included script MUST stop all script processing, including the processing of the scripts that include the immediate one. The "return" command (described below) stops processing of the immediate script only, and allows the scripts that include it to continue.  </p>
<p id="rfc.section.3.2.p.9">The "include" command MAY appear anywhere in a script where a control structure is legal, and MAY be used within another control structure, e.g., within an "if" or "foreverypart" block (<a href="#RFC5703">MIME</a> <cite title="NONE">[RFC5703]</cite>).  </p>
<p id="rfc.section.3.2.p.10">Examples:</p>
<p id="rfc.section.3.2.p.11">The user has four scripts stored in their personal repository:</p>
<p id="rfc.section.3.2.p.12">"default"</p>
<p></p>

<ul class="empty"><li>This is the default active script that includes several others.</li></ul>
<div id="#rfc.figure.2"></div>
<pre>
   require ["include"];
   
   include :personal "always_allow";
   include :global "spam_tests";
   include :personal "spam_tests";
   include :personal "mailing_lists";
</pre>
<p id="rfc.section.3.2.p.14">Personal script "always_allow"</p>
<p></p>

<ul class="empty"><li>This script special-cases some correspondent email addresses and makes sure any message containing those addresses are always kept.  </li></ul>
<div id="#rfc.figure.3"></div>
<pre>
   if address :is "from" "boss@example.com"
   {
       keep;
   }
   elsif address :is "from" "ceo@example.com"
   {
       keep;
   }
</pre>
<p id="rfc.section.3.2.p.16">Personal script "spam_tests" (uses "reject" <a href="#RFC5429">[RFC5429]</a>)</p>
<p></p>

<ul class="empty"><li>This script does some user-specific spam tests to catch spam messages not caught by the site-wide spam tests.  </li></ul>
<div id="#rfc.figure.4"></div>
<pre>
   require ["reject"];
   
   if header :contains "Subject" "XXXX"
   {
       reject "Subject XXXX is unacceptable.";
   }
   elsif address :is "from" "money@example.com"
   {
       reject "Mail from this sender is unwelcome.";
   }
</pre>
<p id="rfc.section.3.2.p.18">Personal script "mailing_lists"</p>
<p></p>

<ul class="empty"><li>This script looks for messages from different mailing lists and files each into a mailbox specific to the mailing list.  </li></ul>
<div id="#rfc.figure.5"></div>
<pre>
   require ["fileinto"];
   
   if header :is "List-ID" "sieve.ietf.org"
   {
       fileinto "lists.sieve";
   }
   elsif header :is "List-ID" "ietf-imapext.imc.org"
   {
       fileinto "lists.imapext";
   }
</pre>
<p id="rfc.section.3.2.p.20">There is one script stored in the global repository:</p>
<p id="rfc.section.3.2.p.21">Site script "spam_tests" (uses "reject" <a href="#RFC5429">[RFC5429]</a>)</p>
<p></p>

<ul class="empty"><li>This script does some site-wide spam tests which any user at the site can include in their own scripts at a suitable point. The script content is kept up to date by the site administrator.  </li></ul>
<div id="#rfc.figure.6"></div>
<pre>
   require ["reject"];
   
   if anyof (header :contains "Subject" "$$",
             header :contains "Subject" "Make money")
   {
       reject "No thank you.";
   }
</pre>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Control Structure return</h1>
<div id="#rfc.figure.7"></div>
<pre>
   Usage:  return
</pre>
<p id="rfc.section.3.3.p.1">The "return" command stops processing of the immediately included script only and returns processing control to the script which includes it. If used in the main script (i.e., not in an included script), it has the same effect as the "stop" command, including the appropriate "keep" action if no other actions have been executed up to that point.  </p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#variables" id="variables">Interaction with Variables</a>
</h1>
<p id="rfc.section.3.4.p.1">In order to avoid problems of variables in an included script "overwriting" those from the script that includes it, this specification requires that all variables defined in a script MUST be kept "private" to the immediate script by default - that is, they are not "visible" to other scripts. This ensures that two script authors cannot inadvertently cause problems by choosing the same name for a variable.  </p>
<p id="rfc.section.3.4.p.2">However, sometimes there is a need to make a variable defined in one script available to others. This specification defines the new command "global" to declare that a variable is shared among scripts.  Effectively, two namespaces are defined: one local to the immediate script, and another shared among all scripts. Implementations MUST allow a non-global variable to have the same name as a global variable but have no interaction between them.  </p>
<h1 id="rfc.section.3.4.1">
<a href="#rfc.section.3.4.1">3.4.1.</a> Control Structure global</h1>
<div id="#rfc.figure.8"></div>
<pre>
   Usage:  global &lt;value: string-list&gt;
</pre>
<p id="rfc.section.3.4.1.p.1">The "global" command accepts a string list argument that defines one or more names of variables to be stored in the global variable space.  Each name MUST be a constant string and conform to the syntax of variable-name as defined in <a href="#RFC5229">VARIABLES</a> <cite title="NONE">[RFC5229]</cite>, Section 3. Match variables cannot be specified and namespace prefixes are not allowed. An invalid name MUST be detected as a syntax error.  </p>
<p id="rfc.section.3.4.1.p.2">The "global" command is only available when the script has both "include" and "variables" in its require line. If the "global" command appears when only "include" or only "variables" has been required, an error MUST be generated when the script is uploaded.  </p>
<p id="rfc.section.3.4.1.p.3">If a "global" command is given the name of a variable that has previously been defined in the immediate script with "set", an error MUST be generated either when the script is uploaded or at execution time.  </p>
<p id="rfc.section.3.4.1.p.4">If a "global" command lists a variable that has not been defined in the global namespace, the name of the variable is now marked as global, and any subsequent "set" command will set the value of the variable in global scope.  </p>
<p id="rfc.section.3.4.1.p.5">A variable has global scope in all scripts that have declared it with the "global" command.  If a script uses that variable name without declaring it global, the name specifies a separate, non-global variable within that script.  </p>
<p id="rfc.section.3.4.1.p.6">Interpretation of a string containing a variable marked as global, but without any value set, SHALL behave as any other access to an unknown variable, as specified in <a href="#RFC5229">VARIABLES</a> <cite title="NONE">[RFC5229]</cite>, Section 3 (i.e., evaluates to an empty string).  </p>
<p id="rfc.section.3.4.1.p.7">Example:</p>
<p id="rfc.section.3.4.1.p.8">The active script</p>
<p></p>

<ul class="empty"><li>The included script may contain repetitive code that is effectively a subroutine that can be factored out. In this script, the test which matches last will leave its value in the test_mailbox variable and the top-level script will file the message into that mailbox. If no tests matched, the message will be implicitly kept in the INBOX.  </li></ul>
<div id="#rfc.figure.9"></div>
<pre>
   require ["fileinto", "include", "variables", "relational"];
   global "test";
   global "test_mailbox";

   set "test" "$$";
   include "spam_checks";

   set "test" "Make money";
   include "spam_checks";

   if string :count "eq" "${test_mailbox}" "1"
   {
       fileinto "${test_mailbox}";
       stop;
   }
</pre>
<p id="rfc.section.3.4.1.p.10">Personal script "spam_checks"</p>
<p></p>

<ul class="empty"><li>This script performs a number of tests against the message, sets the global test_mailbox variable with a folder to file the message into, then falls back to the top-level script.  </li></ul>
<div id="#rfc.figure.10"></div>
<pre> require ["include", "variables"]; global
          ["test", "test_mailbox"];

   if header :contains "Subject" "${test}"
   {
       set "test_mailbox" "spam-${test}";
   }
</pre>
<h1 id="rfc.section.3.4.2">
<a href="#rfc.section.3.4.2">3.4.2.</a> Variables Namespace global</h1>
<p id="rfc.section.3.4.2.p.1">In addition to the "global" command, this document defines the variables namespace "global", as specified in <a href="#RFC5229">VARIABLES</a> <cite title="NONE">[RFC5229]</cite>, Section 3.  The global namespace has no sub-namespaces (e.g., 'set "global.data.from" "me@example.com";' is not allowed).  The variable-name part MUST be a valid identifier (e.g., 'set "global.12" "value";' is not valid because "12" is not a valid identifier).  </p>
<p id="rfc.section.3.4.2.p.2">Example:</p>
<div id="#rfc.figure.11"></div>
<pre>
   require ["variables", "include"];

   set "global.i_am_on_vacation" "1";
</pre>
<p id="rfc.section.3.4.2.p.3">Variables declared global and variables accessed via the global namespace MUST be one and the same. In the following example script, we see the variable "i_am_on_vacation" used in a "global" command, and again with the "global." namespace. Consider these as two syntaxes with identical meaning.  </p>
<p id="rfc.section.3.4.2.p.4">Example:</p>
<div id="#rfc.figure.12"></div>
<pre>
   require ["variables", "include", "vacation"];
   global "i_am_on_vacation";

   set "global.i_am_on_vacation" "1";

   if string :is "${i_am_on_vacation}" "1"
   {
       vacation "It's true, I am on vacation.";
   }
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Security Considerations</h1>
<p id="rfc.section.4.p.1">Sieve implementations MUST ensure adequate security for the global script repository to prevent unauthorized changes to global scripts.  For example, a site policy might enable only certain users with administrative privileges to modify the global scripts. Site are advised against allowing all users to have write access to the site's global scripts.  </p>
<p id="rfc.section.4.p.2">Sieve implementations MUST ensure that script names are checked for validity and proper permissions prior to inclusion, in order to prevent a malicious user from gaining access to files accessible to the mail server software that should not be accessible to the user.  </p>
<p id="rfc.section.4.p.3">Beyond these, the "include" extension does not raise any security considerations that are not present in the base <a href="#RFC5228">SIEVE</a> <cite title="NONE">[RFC5228]</cite> document and the <a href="#RFC5229">VARIABLES</a> <cite title="NONE">[RFC5229]</cite> extension.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The following template specifies the IANA registration of the Sieve extension specified in this document: </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#iana-include" id="iana-include">"include" Extension Registration</a>
</h1>
<div id="#rfc.figure.13"></div>
<pre>
   Capability name: include
   Description:     adds the "include" command to execute other Sieve
                    scripts, the "return" action from an included
                    script, and the "global" command and "global"
                    variables namespace to access variables shared
                    among included scripts.
   RFC number:      this RFC
   Contact address: the Sieve discussion list &lt;sieve@ietf.org&gt;
</pre>
<h1 id="rfc.references">
<a href="#rfc.references">6.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">6.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5228">[RFC5228]</b></td>
<td class="top">
<a>Guenther, P.</a> and <a>T. Showalter</a>, "<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>", RFC 5228, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5229">[RFC5229]</b></td>
<td class="top">
<a>Homme, K.</a>, "<a href="http://tools.ietf.org/html/rfc5229">Sieve Email Filtering: Variables Extension</a>", RFC 5229, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5804">[RFC5804]</b></td>
<td class="top">
<a>Melnikov, A.</a> and <a>T. Martin</a>, "<a href="http://tools.ietf.org/html/rfc5804">A Protocol for Remotely Managing Sieve Scripts</a>", RFC 5804, July 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">6.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5429">[RFC5429]</b></td>
<td class="top">
<a>Stone, A.</a>, "<a href="http://tools.ietf.org/html/rfc5429">Sieve Email Filtering: Reject and Extended Reject Extensions</a>", RFC 5429, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5703">[RFC5703]</b></td>
<td class="top">
<a>Hansen, T.</a> and <a>C. Daboo</a>, "<a href="http://tools.ietf.org/html/rfc5703">Sieve Email Filtering: MIME Part Tests, Iteration, Extraction, Replacement, and Enclosure</a>", RFC 5703, October 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgments</h1>
<p id="rfc.section.Appendix A.p.1">Thanks to Ken Murchison, Rob Siemborski, Alexey Melnikov, Marc Mutz, Kjetil Torgrim Homme, Stephan Bosch, Arnt Gulbrandsen, Barry Leiba, and Jeffrey Hutzelman for comments and corrections.  </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Change History (to be removed prior to publication as an RFC)</h1>
<p id="rfc.section.Appendix B.p.1">Changes from ietf-10 to ietf-11: </p>

<ol style="list-style-type: lower-alpha">
<li>Nits from Dilyan Palauzov.</li>
<li>Nits from Stephan Bosch.</li>
<li>Nits from Alexey Melnikov.</li>
</ol>

<p> </p>
<p id="rfc.section.Appendix B.p.2">Changes from ietf-09 to ietf-10: </p>

<ol style="list-style-type: lower-alpha">
<li>Another example script error caught by Stephan Bosch.</li>
<li>Add :optional argument to allow a missing script to be ignored.</li>
</ol>

<p> </p>
<p id="rfc.section.Appendix B.p.3">Changes from ietf-08 to ietf-09: </p>

<ol style="list-style-type: lower-alpha"><li>Better variables language from Stephan Bosch.</li></ol>

<p> </p>
<p id="rfc.section.Appendix B.p.4">Changes from ietf-07 to ietf-08: </p>

<ol style="list-style-type: lower-alpha">
<li>Nits from Stephan Bosch.</li>
<li>Nits from Barry Leiba.</li>
<li>Wordsmithing and layout wrangling.</li>
</ol>

<p> </p>
<p id="rfc.section.Appendix B.p.5">Changes from ietf-06 to ietf-07: </p>

<ol style="list-style-type: lower-alpha"><li>Nits from Stephan Bosch.</li></ol>

<p> </p>
<p id="rfc.section.Appendix B.p.6">Changes from ietf-05 to ietf-06: </p>

<ol style="list-style-type: lower-alpha"><li>Nits from Barry Leiba.</li></ol>

<p> </p>
<p id="rfc.section.Appendix B.p.7">Changes from ietf-04 to ietf-05: </p>

<ol style="list-style-type: lower-alpha"><li>Integrate review from Barry Leiba.</li></ol>
<p id="rfc.section.Appendix B.p.8">Changes from ietf-03 to ietf-04: </p>

<ol style="list-style-type: lower-alpha"><li>No changes.</li></ol>
<p id="rfc.section.Appendix B.p.9">Changes from ietf-02 to ietf-03: </p>

<ol style="list-style-type: lower-alpha">
<li>Setting a variable then calling global on it is an error (something like 'use strict').</li>
<li>Specify that the 'global' keyword is only available when 'variables' has also been required.</li>
<li>Uploading a script that includes a nonexistent script is not an error at upload time.</li>
</ol>
<p id="rfc.section.Appendix B.p.10">Changes from ietf-01 to ietf-02: </p>

<ol style="list-style-type: lower-alpha">
<li>Require that script names must be constant strings, not subject to variable expansion.</li>
<li>Try the phrase immediate script instead of current script.</li>
<li>Clarify that "global 'varname'" and "global.varname" refer to the same variable.</li>
<li>Drop the requirement the global keywords come after require and before anything else.</li>
</ol>
<p id="rfc.section.Appendix B.p.11">Changes from ietf-00 to ietf-01: </p>

<ol style="list-style-type: lower-alpha">
<li>Replaced import/export with global.</li>
<li>Added :once modifier to include.</li>
<li>Added global namespace to see if it holds water.</li>
</ol>
<p id="rfc.section.Appendix B.p.12">Changes from daboo-06 to ietf-00: </p>

<ol style="list-style-type: lower-alpha"><li>None</li></ol>
<p id="rfc.section.Appendix B.p.13">Changes from -05 to -06: </p>

<ol style="list-style-type: lower-alpha">
<li>Aaron Stone joins as author.</li>
<li>Removed | characters from the script examples.</li>
<li>Updated draft references to published RFCs.</li>
</ol>
<p id="rfc.section.Appendix B.p.14">Changes from -04 to -05: </p>

<ol style="list-style-type: lower-alpha">
<li>Fixed examples.</li>
<li>Relaxed requirement that imported/exported variables be set before being used.</li>
</ol>
<p id="rfc.section.Appendix B.p.15">Changes from -03 to -04: </p>

<ol style="list-style-type: lower-alpha">
<li>Fixed missing 2119 definitions.</li>
<li>Defined interaction with variables through use of import and export commands.</li>
</ol>
<p id="rfc.section.Appendix B.p.16">Changes from -02 to -03: </p>

<ol style="list-style-type: lower-alpha">
<li>Refreshing expired draft (updated for nits).</li>
<li>Syntax -&gt; Usage.</li>
<li>Updated to 3028bis reference.</li>
</ol>
<p id="rfc.section.Appendix B.p.17">Changes from -01 to -02: </p>

<ol style="list-style-type: lower-alpha"><li>Minor formatting changes only - refreshing expired draft.</li></ol>
<p id="rfc.section.Appendix B.p.18">Changes from -00 to -01: </p>

<ol style="list-style-type: lower-alpha">
<li>Added IPR boiler plate.</li>
<li>Re-ordered sections at start to conform to RFC style.</li>
<li>Moved recursion comment into General Considerations section.</li>
<li>Switched to using optional parameter to indicate personal vs global.</li>
<li>Explicitly state that an error occurs when a missing script is included.</li>
</ol>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Cyrus Daboo</span> 
	  <span class="n hidden">
		<span class="family-name">Daboo</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:cyrus@daboo.name">cyrus@daboo.name</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Aaron Stone</span> 
	  <span class="n hidden">
		<span class="family-name">Stone</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:aaron@serendipity.cx">aaron@serendipity.cx</a></span>

  </address>
</div>

</body>
</html>