<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Diameter support for EAP
    Re-authentication Protocol (ERP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Diameter support for EAP
    Re-authentication Protocol (ERP)">
<meta name="keywords" content="Internet-Draft, ERP, Diameter, Re-authentication">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Diameter Maintenance and</td><td class="header">S. Decugis, Ed.</td></tr>
<tr><td class="header">Extensions (DIME)</td><td class="header">NICT</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">June 08, 2009</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: December 10, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Diameter support for EAP
    Re-authentication Protocol (ERP)<br />draft-sdecugis-dime-diameter-erp-01</h1>

<h3>Status of This Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on December 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The EAP Re-authentication Protocol (ERP) provides a mechanism to
      optimize EAP authentication delay in the case of re-authentication,
      which can be significant in roaming mobile situation. This mechanism
      assumes that a protocol for Authentication, Authorization and Accounting
      (AAA) is available to transport ERP between the authenticator(s) and the
      EAP/ERP server. draft-gaonkar-radext-erp-attrs-03 specifies the
      transport of ERP using RADIUS. This document specifies the transport of
      ERP using Diameter.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.1.</a>&nbsp;
Differences with other documents<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Requirements Language<br />
<a href="#Overview">3.</a>&nbsp;
Overview<br />
<a href="#ApplicationId">4.</a>&nbsp;
Application Id<br />
<a href="#AVPs">5.</a>&nbsp;
AVPs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.1.</a>&nbsp;
ERP-RK-Request AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.2.</a>&nbsp;
ERP-Realm AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.3.</a>&nbsp;
ERP-RK-Answer AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.4.</a>&nbsp;
ERP-RK AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.5.</a>&nbsp;
ERP-RK-Name AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.6.</a>&nbsp;
ERP-RK-Lifetime AVP<br />
<a href="#Commands">6.</a>&nbsp;
Commands<br />
<a href="#Bootstrapping">7.</a>&nbsp;
Bootstrapping options<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">7.1.</a>&nbsp;
Bootstrapping during initial EAP authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.2.</a>&nbsp;
Bootstrapping during first re-authentication<br />
<a href="#Re-authentication">8.</a>&nbsp;
Re-Authentication<br />
<a href="#Sessions">9.</a>&nbsp;
Sessions<br />
<a href="#anchor12">10.</a>&nbsp;
Contributors<br />
<a href="#Acknowledgements">11.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">12.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">12.1.</a>&nbsp;
Diameter ERP application<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">12.2.</a>&nbsp;
New AVPs<br />
<a href="#Security">13.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p><a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> defines the EAP Re-authentication
      Protocol (ERP) and mechanism that consists in the two following
      steps:</p>
<ol class="text">
<li>Bootstrapping: creation of a root key for re-authentication,
          after initial EAP authentication of the peer. This root key is
          distributed from the EAP server to the ER server. How this key is
          tranported is not specified in the ERP mechanism.
</li>
<li>Re-authentication: one-round-trip exchange between the peer and
          the ER server, functionally equivalent to a full EAP
          authentication.
</li>
</ol>

<p>This document specifies how Diameter is used to carry the
      re-authentication exchange (second step). For this purpose, we define a
      new Application Id for ERP, and re-use the Diameter EAP commands
      (DER/DEA).
</p>
<p>We also discuss the key distribution (first step, bootstrapping) and
      propose some solutions for different architectures. Anyway, implementors
      are free to choose a different mechanism for key distribution, as for
      example using RADIUS <a class='info' href='#I-D.ietf-hokey-key-mgm'>[I&#8209;D.ietf&#8209;hokey&#8209;key&#8209;mgm]<span> (</span><span class='info'>Hoeper, K. and Y. Ohba, &ldquo;Distribution of EAP based keys for handover and re-authentication,&rdquo; April&nbsp;2009.</span><span>)</span></a>.
      Security considerations for key distribution are explained in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Differences with other documents</h3>

<p>This document differs from <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Dondeti, L., Bournelle, J., Morand, L., and S. Decugis, &ldquo;Diameter Support for EAP Re-authentication Protocol,&rdquo; January&nbsp;2009.</span><span>)</span></a>
        in its design and scope. In this new version, we use a new Diameter
        application id for messages with ERP payload exchanged between
        authenticator and ER server. This simplifies the routing of Diameter
        messages to the appropriate server, and allows more flexibility in the
        deployment of ERP.
</p>
<p>The scope of previous documents (<a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Dondeti, L., Bournelle, J., Morand, L., and S. Decugis, &ldquo;Diameter Support for EAP Re-authentication Protocol,&rdquo; January&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#I-D.wu-dime-local-keytran'>[I&#8209;D.wu&#8209;dime&#8209;local&#8209;keytran]<span> (</span><span class='info'>Wu, W., &ldquo;Diameter support for local key transport protocol between local server and  home AAA server,&rdquo; May&nbsp;2009.</span><span>)</span></a>) was focused on the
        bootstrapping of the mechanism. In particular, these documents did not
        consider the routing of Diameter message for re-authentication
        exchanges (ERP exchange, and also <a class='info' href='#RFC4187'>[RFC4187]<span> (</span><span class='info'>Arkko, J. and H. Haverinen, &ldquo;Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA),&rdquo; January&nbsp;2006.</span><span>)</span></a> for
        the second document). By re-using the Diameter EAP application, they
        create implicit constraints on routing of messages that cannot be met
        by standard Diameter routing algorithm, as defined in the <a class='info' href='#RFC3588'>Diameter Base Protocol<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588].
</p>
<p>A separate Diameter application solves this routing issue, and can
        also allow the authenticator to dynamically discover if the local
        domain supports re-authentication or not.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>We re-use in this document the terminology from <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. In particular, unless specified otherwise, the
      EAP server has implicit support for ERP extensions for generation of ERP
      keying material and its transmission to ER server. These terms
      "authenticator", "ER server", "EAP server" designate logical functional
      entities and make no assumption on the real implementation and
      deployment.
</p>
<p>"Root key" (RK) or "bootstrapping material" refer to the rRK or rDSRK
      derived from an EMSK, depending on the location of the ER server in home
      or foreign domain.
</p>
<p>We re-use also some terminology and abbreviations from <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>, for example DER/DEA.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="Overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>During the lifetime of an EMSK (derived during a full EAP
      authentication by compatible EAP methods), a peer may attach to several
      authenticators. In this case, re-authentication is more efficient than
      full authentication, especially in the case of roaming. ERP provides a
      mechanism for re-authentication independent of the link layer, so it can
      be used in case of multihoming or handovers between different access
      technologies. The following figure shows the components involved in ERP,
      and their interactions. When the peer attaches to a new authenticator,
      the ER server involved in the transaction may change, for example in the
      case of inter-domain roaming. The home EAP server is assumed to be
      constant for a given peer.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                        Diameter                    +--------+
        +-------------+   ERP   +-----------+  (*)  |  Home  |
Peer &lt;-&gt;|Authenticator|&lt;=======&gt;| ER server | &lt;---&gt; |  EAP   |
        +-------------+         +-----------+       | server |
                                                    +--------+
    (*) Several protocols can be used between ER server and
       home EAP server to transport bootstrapping material.
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 1. Diameter applications used in the ERP mechanism.&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The ER server may be located in the home domain (same as EAP server)
      or the visited domain (same as authenticator, when it differs from the
      home domain). <a class='info' href='#comment.Editor1'>[Editor1]<span> (</span><span class='info'>Can the ER server be located in a third domain (ex: broker's)?</span><span>)</span></a><a name='Editor1'></a>
</p>
<p>The bootstrapping of the ER server has to occur sometime between the
      initial EAP authentication and the first ERP re-authentication with this
      ER server. See section <a class='info' href='#Bootstrapping'>Section&nbsp;7<span> (</span><span class='info'>Bootstrapping options</span><span>)</span></a> for detail
      on this process. Then, the peer re-authenticates, for example after a
      movement that makes it attach to a new authenticator. The following
      figure describes this re-authentication, and shows how Diameter is used
      in this context. See section <a class='info' href='#Re-authentication'>Section&nbsp;8<span> (</span><span class='info'>Re-Authentication</span><span>)</span></a>
      for a detailed description, and following sections for details on the
      Diameter messages format.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                        ER server
                                                      (bootstrapped)
 Peer                 Authenticator               (local or home domain)
 ====                 =============               ======================
 [ &lt;------------------------         ]
 [optional EAP-Initiate/Re-auth-start]

   -----------------------&gt;
     EAP-Initiate/Re-auth
                           ==================================&gt;
                                Diameter ERP, cmd code DER
                                  User-Name: Keyname-NAI
                              EAP-Payload: EAP-Initiate/Re-auth

                           &lt;==================================
                                Diameter ERP, cmd code DEA
                              EAP-Payload: EAP-Finish/Re-auth
                               EAP-Master-Session-Key: rMSK
    &lt;----------------------
      EAP-Finish/Re-auth
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 2. Diameter ERP exchange. &nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="ApplicationId"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Application Id</h3>

<p>We define a Diameter ERP Application in this document, with an
      Application Id value of <a class='info' href='#comment.IANA1'>[IANA1]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA1'></a>. Diameter nodes
      conforming to this specification (in the role of ER server or
      authenticator) MUST advertise support by including the Diameter ERP
      Application ID value in the Auth-Application-Id AVP of the
      Capabilities-Exchange-Request and Capabilities-Exchange-Answer command
      <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
</p>
<p>The primary use of the Diameter ERP Application Id is to ensure
      proper routing of the messages, and that the nodes that advertise the
      support for this application do understand the new AVPs defined in the
      next section (although these AVP have the 'M' flag cleared).
</p>
<a name="AVPs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
AVPs</h3>

<p>This specification defines the following new AVPs.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
ERP-RK-Request AVP</h3>

<p>The ERP-RK-Request AVP (AVP Code <a class='info' href='#comment.IANA2'>[IANA2]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA2'></a>)
        is of type grouped AVP. It is used by the ER server to request root
        key material used in ERP.
</p>
<p>This AVP has the M and V bits cleared.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
      ERP-RK-Request ::= &lt; AVP Header: TBD &gt;
                         { ERP-Realm }
                       * [ AVP ]
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 3. ERP-RK-Request ABNF&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
ERP-Realm AVP</h3>

<p>The ERP-Realm AVP (AVP Code <a class='info' href='#comment.IANA3'>[IANA3]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA3'></a>) is of
        type <a class='info' href='#comment.Editor2'>[Editor2]<span> (</span><span class='info'>DiameterIdentity? OctetString?</span><span>)</span></a><a name='Editor2'></a>. It
        contains the name of the realm in which the ER server is located.
</p>
<p><a class='info' href='#comment.Editor3'>[Editor3]<span> (</span><span class='info'>FFS: We may re-use Origin-Realm here instead? On the other hand, ERP-Realm may be useful in CER/CEA with a NAS...</span><span>)</span></a><a name='Editor3'></a>
</p>
<p>This AVP has the M and V bits cleared.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
ERP-RK-Answer AVP</h3>

<p>The ERP-RK-Answer AVP (AVP Code <a class='info' href='#comment.IANA4'>[IANA4]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA4'></a>) is
        of type grouped AVP. It is used by the home EAP server to provide ERP
        root key material to the ER server.
</p>
<p>This AVP has the M and V bits cleared.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
       ERP-RK-Answer ::= &lt; AVP Header: TBD &gt;
                         { ERP-RK }
                         { ERP-RK-Name }
                         { ERP-RK-Lifetime }
                       * [ AVP ]
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 4. ERP-RK-Answer ABNF&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
ERP-RK AVP</h3>

<p>The ERP-RK AVP (AVP Code <a class='info' href='#comment.IANA5'>[IANA5]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA5'></a>) is of
        type OctetString. It contains the root key (either rRK or rDSRK) to be
        used for ERP with the peer to which the current session belongs. How
        this material is derived and used is specified in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p><a class='info' href='#comment.Editor4'>[Editor4]<span> (</span><span class='info'>Can we re-use EAP-Master-Session-Key here?</span><span>)</span></a><a name='Editor4'></a>
</p>
<p>This AVP has the M and V bits cleared.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
ERP-RK-Name AVP</h3>

<p>The ERP-RK AVP (AVP Code <a class='info' href='#comment.IANA6'>[IANA6]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA6'></a>) is of
        type OctetString. This AVP contains the EMSKname which identifies the
        keying material. How this name is derived is beyond the scope of this
        document and defined in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p><a class='info' href='#comment.Editor5'>[Editor5]<span> (</span><span class='info'>Can we re-use EAP-Key-Name here?</span><span>)</span></a><a name='Editor5'></a>
</p>
<p>This AVP has the M and V bits cleared.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
ERP-RK-Lifetime AVP</h3>

<p>The ERP-RK-Lifetime AVP (AVP Code <a class='info' href='#comment.IANA7'>[IANA7]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA7'></a>)
        is of type <a class='info' href='#comment.Editor6'>[Editor6]<span> (</span><span class='info'>Unsigned64? 32?</span><span>)</span></a><a name='Editor6'></a> and contains
        the root key material remaining lifetime in seconds. It MUST not be
        greater than the remaining lifetime of the EMSK it is derived from.
        <a class='info' href='#comment.Editor7'>[Editor7]<span> (</span><span class='info'>FFS: is it better to pass an absolute value here, for example expiration date? How to express it then (TZ, ...)? Synchronization problems?</span><span>)</span></a><a name='Editor7'></a>
</p>
<p>This AVP has the M and V bits cleared.
</p>
<a name="Commands"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Commands</h3>

<p>We do not define any new command in this specification. We reuse the
      Diameter-EAP-Request and Diameter-EAP-Answer commands defined in <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The Application Id field in the command header <a class='info' href='#comment.Editor8'>[Editor8]<span> (</span><span class='info'>and the value in Auth-Application-Id AVP which is redundant???</span><span>)</span></a><a name='Editor8'></a> can be set to Diameter EAP application or Diameter
      ERP application, depending on the situation, as explained in the next
      sections.
</p>
<p>Since the original ABNF of these commands allow other optional AVPs
      ("* [ AVP ]"), and the new AVPs defined in this specification do not
      have the 'M' flag set, the ABNF does not need any change. Anyway, a
      Diameter node that advertize support for the Diameter ERP application
      MUST support the ERP-RK-Request and ERP-RK-Answer AVP <a class='info' href='#comment.Editor9'>[Editor9]<span> (</span><span class='info'>Therefore, in DER/DEA with Diameter ERP application ID, do we set the 'M' flag to these AVPs?</span><span>)</span></a><a name='Editor9'></a>.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Command-Name          Abbrev. Code Reference Application
   ---------------------------------------------------------
   Diameter-EAP-Request  DER     268  RFC 4072  Diameter ERP
   Diameter-EAP-Answer   DEA     268  RFC 4072  Diameter ERP
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 5. Command Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Bootstrapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Bootstrapping options</h3>

<p>Bootstrapping involves the ER server and the EAP server directly, but
      also indirectly the peer and the authenticator. For ERP to be
      successful, the peer must derive the same keying material as the ER
      server. To make this possible, it must learn the domain name of the ER
      server. How this is achieved is outside the scope of this specification,
      but it usually involves that the authenticator is configured to
      advertize this domain name. This could be achieved for example by
      including the ERP-Realm AVP in a CER/CEA exchange.
</p>
<p>As stated in the <a class='info' href='#Overview'>Section&nbsp;3<span> (</span><span class='info'>Overview</span><span>)</span></a>, the bootstrapping
      of an ER server has to happen between the initial EAP authentication of
      the peer, when the EMSK is created, and the moment the peer
      re-authenticates with this ER server, when the bootstrapping material is
      needed. While asynchrounous solutions are perfectly possible, it is
      usually easier to bootstrap the ER server during one of these
      events.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Bootstrapping during initial EAP authentication</h3>

<p>Bootstrapping an ER server during the initial EAP authentication
        offers the advantage that the server is immediatly available for
        re-authentication of the peer, thus minimizing the re-authentication
        delay.
</p>
<p>On the other hand, re-authentication may only concern a small
        number of peers in the visited domain. Deriving and caching key
        material for all the peers (for example, for the peers that do not
        support ERP, or that are not mobile) is a waste of resources and
        SHOULD be avoided. In addition, bootstrapping ERP during full EAP
        authentication may prevent re-authentication in case of inter-domain
        roaming. Hence, while this mecanism is useful in some situations, it
        should be deployed with care.
</p>
<p>In the case where ER server is collocated with the Home EAP server,
        ER bootstrapping is transparent with regards to this specification,
        although some sort of communication might be needed inside the node.
        In this case, the server MUST advertise support of both the Diameter
        EAP application and the Diameter ERP application, but the new AVPs
        defined in this specification are not used.
</p>
<p>When ER server and EAP server are different entities with regards
        to Diameter, one or more Diameter EAP proxy(ies) is(are) needed in the
        same domain as the ER server. While this(these) proxy(ies) might be
        separate entity(ies) with secure communication channel with the ER
        server, it is functionally equivalent to consider that the ER server
        acts as a Diameter EAP proxy. In the rest of this section, we consider
        that the ER server acts as a Diameter EAP proxy in its domain.
</p>
<p>In order to bootstrap the ER server during full EAP authentication,
        this server must be on the route, and act as a proxy, for the first
        and last round of exchanges of the full EAP authentication, as
        captured in the figure bellow.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         ER server &amp;
Authenticator             EAP Proxy               Home EAP server
=============            ===========              ===============
     -------------------------&gt;
         Diameter EAP/DER
          (EAP-Response)
                               -------------------------&gt;
                                  Diameter EAP/DER
                                   (EAP-Response)
                                  (ERP-RK-Request)

     &lt;==================================================&gt;
        Multi-round Diameter EAP exchanges, unmodified

                               &lt;-------------------------
                                   Diameter EAP/DEA
                                    (EAP-Success)
                                        (MSK)
                                   (ERP-RK-Answer)
     &lt;-------------------------
         Diameter EAP/DEA
           (EAP-Success)
               (MSK)
            [ERP-Realm]
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 6. ERP bootstrapping during full EAP authentication&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The ER server proxies the first DER of the full EAP authentication
        and adds the ERP-RK-Request AVP inside, if this AVP is not already in
        the message, then forwards the request.
</p>
<p>If the EAP server does not support ERP extensions, it will simply
        ignore this grouped AVP and continue as specified in <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>. If the server supports the ERP extensions,
        it caches the ERP-Realm value with the session, and continues the EAP
        authentication. When the authentication is complete, if it is
        successful and the EAP method generated an EMSK, the server MUST
        compute the rRK or rDSRK (depending on the value of ERP-Realm) as
        specified in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>, and add an ERP-RK-Answer
        AVP in the Diameter-EAP-Request message, in addition to the MSK and
        EAP-Success payload. <a class='info' href='#comment.Editor10'>[Editor10]<span> (</span><span class='info'>FFS: is it important to check that the server that added the ERP-RK-Request is in the path of the answer? What's the worst that can happen?</span><span>)</span></a><a name='Editor10'></a>
</p>
<p>When the ER server proxies a Diameter-EAP-Answer message with a
        Session-Id corresponding to a message to which it added an
        ERP-RK-Answer, and the Result-Code is DIAMETER_SUCCESS, it MUST
        examine the message and remove any ERP-RK-Answer AVP, and save its
        content. If the message does not contain an ERP-RK-Answer AVP, the ER
        server MAY save this information to avoid possible attempts later for
        this session. In any case, the information stored SHOULD NOT have a
        lifetime greater than the EMSK lifetime <a class='info' href='#comment.Editor11'>[Editor11]<span> (</span><span class='info'>FFS: how does the ER server knows the EMSK lifetime, if there is no ERP-RK-Answer? What is the lifetime of the MSK for example?</span><span>)</span></a><a name='Editor11'></a>
</p>
<p>If the ER server is successfully bootstrapped, it MAY also add the
        ERP-Realm AVP after removing the ERP-RK-Answer AVP in the
        Diameter-EAP-Answer message. This could be used by the authenticator
        to notify the peer that ERP is bootstrapped, with the ER domain
        information. How this information can be transmitted to the peer is
        outside the scope of this document. <a class='info' href='#comment.Editor12'>[Editor12]<span> (</span><span class='info'>Is it possible? It would be useful...</span><span>)</span></a><a name='Editor12'></a>
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Bootstrapping during first re-authentication</h3>

<p>Bootstrapping the ER server during the first re-authentication
        offers several advantages: it saves resources, since we generate and
        cache only useful keying material, it can also accomodate inter-domain
        roaming or ER servers that loose their state (for example after
        reboot).
</p>
<p>On the other hand, the first re-authentication with the ER server
        requires a one-round-trip with the home EAP server, which adds some
        delay to the process (but it is more efficient than a full EAP
        authentication in any case). Note that following re-authentications
        for the same session with the same ER server will not have this
        additional delay.
</p>
<p><a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> describes two types of bootstrapping
        for ERP: implicit bootstrapping and explicit bootstrapping. In
        implicit bootstrapping, the peer knows the domain it is located in,
        and assumes that the ER server already possess the keying material for
        the session. In this case, the peer uses a Keyname-NAI in the form
        "EMSKname@localdomain". In explicit bootstrapping, the Keyname-NAI is
        in the form "EMSKname@homedomain". As we will see in next section
        <a class='info' href='#Re-authentication'>Section&nbsp;8<span> (</span><span class='info'>Re-Authentication</span><span>)</span></a>, the domain part of the
        Keyname-NAI becomes the Destination-Realm of the Diameter message, and
        the Application Id is set to Diameter ERP application.
</p>
<p>In the case of implicit bootstrapping (how the peer learns that the
        ER server is bootstrapped is outside the scope of this specification)
        or after a first succesful re-authentication in the visited domain,
        the message is routed to the local ER server following normal Diameter
        routing. If the ER server does not have key information corresponding
        to this EMSKname, <a class='info' href='#comment.Editor13'>[Editor13]<span> (</span><span class='info'>return an error to the peer? proxy the request and send ERP-RK-Request to the home EAP server? How do we learn which is the home domain?</span><span>)</span></a><a name='Editor13'></a>. See the next section
        <a class='info' href='#Re-authentication'>Section&nbsp;8<span> (</span><span class='info'>Re-Authentication</span><span>)</span></a> for detail.
</p>
<p>In the case of explicit bootstrapping (the ERP message has its 'B'
        flag set), if an ER server exists in the visited domain, it SHOULD be
        configured for and act as a Diameter ERP proxy, and process the
        messages as described below. If not, the ER server in the home domain
        will be used, which is less efficient. The description that follow for
        the ER server in the visited domain is also valid for the ER server in
        the home domain.
</p>
<p><a class='info' href='#comment.Editor14'>[Editor14]<span> (</span><span class='info'>What should we do if the ER server receives an explicit bootstrapping request but already possess the rDSRK?</span><span>)</span></a><a name='Editor14'></a>
</p>
<p>The ER server proxies the request (DER with Diameter ERP
        application code) as follow, in addition to standard proxy
        operations:</p>
<blockquote class="text">
<p>Change the Application Id in the header of the message to
            Diameter EAP Application (code 5). <a class='info' href='#comment.Editor15'>[Editor15]<span> (</span><span class='info'>What about the Application-Auth-Id AVP?</span><span>)</span></a><a name='Editor15'></a>
</p>
<p>Add the ERP-RK-Request AVP, which contains the name of the
            domain the ER server is located in (with regards to ERP).
</p>
</blockquote><p>Then the request is forwarded as usual. With its Diameter EAP
        application id and Destination-Realm set to the home domain of the
        peer, the request reaches the home EAP server. If this server does not
        support ERP extensions, it replies with an error since the
        encapsulated EAP-Initiate/Re-auth command is not understood.
        Otherwise, it processes the ERP request as described in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. In particular, it includes the Domain-Name
        TLV attribute with the content from the ERP-Realm AVP. It creates the
        DEA reply message following standard processing from <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> (in particular EAP-Master-Session-Key AVP is
        used to transport the rMSK), and includes the ERP-RK-Answer AVP.
</p>
<p>The ER server receives this DEA and proxies it as follow, in
        addition to standard proxy operations:</p>
<blockquote class="text">
<p>Set the Application Id back to Diameter ERP (code <a class='info' href='#comment.IANA8'>[IANA8]<span> (</span><span class='info'>TBD</span><span>)</span></a><a name='IANA8'></a>)
</p>
<p>Extract and cache the content of the ERP-RK-Answer.
</p>
</blockquote><p>The DEA is then forwarded to the authenticator, that can use
        the rMSK as described in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The figure below captures this Diameter ERP Proxy behavior:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Authenticator            ER server             Home EAP server
=============            =========             ===============
      -----------------------&gt;
          Diameter ERP/DER
           (EAP-Initiate)
                              ------------------------&gt;
                                    Diameter EAP/DER
                                     (EAP-Initiate)
                                    (ERP-RK-Request)

                              &lt;------------------------
                                    Diameter EAP/DEA
                                      (EAP-Finish)
                                     (ERP-RK-Answer)
                                         (rMSK)
      &lt;----------------------
          Diameter ERP/DEA
            (EAP-Finish)
               (rMSK)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 7. ERP explicit bootstrapping message flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Re-authentication"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Re-Authentication</h3>

<p>This section describes a re-authentication exchange with a
      bootstrapped ER server. The peer is assumed to know the domain of the
      bootstrapped ER server in advance. See previous section <a class='info' href='#Bootstrapping'>Section&nbsp;7<span> (</span><span class='info'>Bootstrapping options</span><span>)</span></a> for more information.
      EAP-Initiate/Re-auth-start with Domain-Name TLV is a possibility for the
      peer to learn the domain of the ER server attached to the
      authenticator.
</p>
<p>The following figure describes the re-authentication exchange.
      Explication follow.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                                Bootstrapped ER server
Peer                 Authenticator             (in local or home domain)
====                 =============             =========================
[ &lt;------------------------         ]
[optional EAP-Initiate/Re-auth-start]

   -----------------------&gt;
    EAP-Initiate/Re-auth
                           =================================&gt;
                               Diameter ERP, cmd code DER
                                 User-Name: Keyname-NAI
                            EAP-Payload: EAP-Initiate/Re-auth

                           &lt;=================================
                               Diameter ERP, cmd code DEA
                             EAP-Payload: EAP-Finish/Re-auth
                              EAP-Master-Session-Key: rMSK
   &lt;----------------------
     EAP-Finish/Re-auth
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 8. Diameter ERP exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The authenticator that does not support ERP <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> discards EAP packets with unknown ERP-specific
      code (EAP-Initiate). The peer falls back to full EAP authentication in
      that case.
</p>
<p>When the ERP-compatible authenticator receives an
      EAP-Initiate/Re-auth message from the peer (or after having sent a
      EAP-Initiate/Re-auth-start packet), it process as described in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a> with regards to the EAP state machine, and
      similarly to <a class='info' href='#RFC4072'>Diameter EAP<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4072], with regards to
      Diameter, with the following differences:</p>
<blockquote class="text">
<p>The application id is set to Diameter ERP instead of Diameter
          EAP.
</p>
<p>The User-Name and Destination-Realm are derived from the
          Keyname-NAI.
</p>
<p><a class='info' href='#comment.Editor16'>[Editor16]<span> (</span><span class='info'>How do we create / retrieve the Session-Id?</span><span>)</span></a><a name='Editor16'></a>
</p>
</blockquote>

<p>The ER server receives this request and process the ERP payload as
      described in <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>. If re-authentication is
      successful, it creates a DEA answer as described in Diameter EAP, with
      the following differences:</p>
<blockquote class="text">
<p>The application id is set to Diameter ERP.
</p>
<p>The EAP-Payload AVP contains the ERP message:
          EAP-Finish/Re-auth
</p>
<p>The EAP-Master-Session-Key AVP contains the rMSK
</p>
<p>The Result-Code AVP contains DIAMETER_SUCCESS.
</p>
</blockquote><p>In case the re-authentication fails, the Result-Code AVP
      contains an error code, and no EAP-Master-Session-Key AVP is
      included.
</p>
<p>When the authenticator receives this answer, it processes it as
      described in Diameter EAP: forwards the EAP payload to the peer, and use
      the rMSK as a shared secret in Secure Association Protocol.
</p>
<a name="Sessions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Sessions</h3>

<p>This section describes how sessions are handled in case of
      re-authentication.
</p>
<p><a class='info' href='#comment.Editor17'>[Editor17]<span> (</span><span class='info'>The content of this section is to be written, I am just listing the ideas here.</span><span>)</span></a><a name='Editor17'></a>
</p>
<p>See guidelines in <a class='info' href='#I-D.ietf-dime-app-design-guide'>[I&#8209;D.ietf&#8209;dime&#8209;app&#8209;design&#8209;guide]<span> (</span><span class='info'>Fajardo, V., Asveren, T., Tschofenig, H., McGregor, G., and J. Loughney, &ldquo;Diameter Applications Design Guidelines,&rdquo; November&nbsp;2008.</span><span>)</span></a>.
</p>
<p>During initial full EAP authentication, the identity of the peer is
      used to create the Session-Id AVP, which is then used during accounting.
      When the peer attaches to a new authenticator and performs ERP, its
      identity is not disclosed to the authenticator. Instead, the peer
      presents the Keyname-NAI. This identifiers contains the EMSKName as user
      part. The new authenticator will therefore derive the new Session-Id
      from this EMSKName and use this for accounting purpose.
</p>
<p>Although the home EAP server is able to link EMSKName with the peer's
      identity, the other Diameter entities do not have this mapping. In
      particular, the realm part of Keyname-NAI is the visited network. How
      does the authenticator figures out that the account records must be sent
      to the home domain of the peer?
</p>
<p>It is possible to cache the necessary information at the ER server
      level. Is it useful to specify this mechanism in this document? It would
      involve:</p>
<blockquote class="text">
<p>An additional AVP during bootstrapping of ER server, in the
          ERP-RK-Answer, to pass the real User-Name and Session-Id (only in
          case of explicit bootstrapping)
</p>
<p>An additional AVP in Diameter ERP/DEA (EAP-Finish/Re-Auth) to
          pass the real Session-Id and User-Name and Destination-Realm of the
          re-authenticated peer, for accounting messages.
</p>
</blockquote>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Contributors</h3>

<p>Hannes Tschofenig, Lakshminath Dondeti, Julien Bournelle, and Lionel
      Morand wrote the initial Diameter ERP draft document.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>Vidya Narayanan reviewed a rough draft version of the previous
      document and found some errors.
</p>
<p>Qin Wu and Glen Zorn actively participated in the discussions on the
      design for Diameter ERP, providing the point of view and experience from
      HOKEY workgroup.
</p>
<p>Hannes Tschofenig provided useful advices for the writing of this
      document.
</p>
<p>Many thanks to these people!
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
IANA Considerations</h3>

<p>This document requires IANA registration of the following new
      elements in the <a href='http://www.iana.org/assignments/aaa-parameters/'>Authentication,
      Authorization, and Accounting (AAA) Parameters</a> registries.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Diameter ERP application</h3>

<p>This specification requires IANA to allocate a new value "Diameter
        ERP" in the "Application IDs" registry created by in <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Application Identifier             | Value
   -----------------------------------+------
   Diameter ERP                       | TBD
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;IANA consideration for Diameter ERP application&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
New AVPs</h3>

<p>This specification requires IANA to allocate new values from the
        "AVP Codes" registry defined in <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> for the
        following AVPs:</p>
<blockquote class="text">
<p>ERP-RK-Request
</p>
<p>ERP-Realm
</p>
<p>ERP-RK-Answer
</p>
<p>ERP-RK
</p>
<p>ERP-RK-Name
</p>
<p>ERP-RK-Lifetime
</p>
</blockquote><p>These AVPs are defined in section <a class='info' href='#AVPs'>Section&nbsp;5<span> (</span><span class='info'>AVPs</span><span>)</span></a>.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Security Considerations</h3>

<p>The security considerations from the following RFC apply here: <a class='info' href='#RFC3588'>[RFC3588]<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#RFC4072'>[RFC4072]<span> (</span><span class='info'>Eronen, P., Hiller, T., and G. Zorn, &ldquo;Diameter Extensible Authentication Protocol (EAP) Application,&rdquo; August&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#RFC5247'>[RFC5247]<span> (</span><span class='info'>Aboba, B., Simon, D., and P. Eronen, &ldquo;Extensible Authentication Protocol (EAP) Key Management Framework,&rdquo; August&nbsp;2008.</span><span>)</span></a>, <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>, and <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p><a class='info' href='#comment.Editor18'>[Editor18]<span> (</span><span class='info'>FFS: Do we really respect these security considerations with the mechanism we describe here? Is it safe to use ERP-RK-Request / Answer AVPs? What is the worst case?</span><span>)</span></a><a name='Editor18'></a>
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4072">[RFC4072]</a></td>
<td class="author-text">Eronen, P., Hiller, T., and G. Zorn, &ldquo;<a href="http://tools.ietf.org/html/rfc4072">Diameter Extensible Authentication Protocol (EAP) Application</a>,&rdquo; RFC&nbsp;4072, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4072.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5295">[RFC5295]</a></td>
<td class="author-text">Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;<a href="http://tools.ietf.org/html/rfc5295">Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)</a>,&rdquo; RFC&nbsp;5295, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5295.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5296">[RFC5296]</a></td>
<td class="author-text">Narayanan, V. and L. Dondeti, &ldquo;<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>,&rdquo; RFC&nbsp;5296, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5296.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.gaonkar-radext-erp-attrs">[I-D.gaonkar-radext-erp-attrs]</a></td>
<td class="author-text">Gaonkar, K., Dondeti, L., Narayanan, V., and G. Zorn, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-gaonkar-radext-erp-attrs-03.txt">RADIUS Support for EAP Re-authentication Protocol</a>,&rdquo; draft-gaonkar-radext-erp-attrs-03 (work in progress), February&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-gaonkar-radext-erp-attrs-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-app-design-guide">[I-D.ietf-dime-app-design-guide]</a></td>
<td class="author-text">Fajardo, V., Asveren, T., Tschofenig, H., McGregor, G., and J. Loughney, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-app-design-guide-08.txt">Diameter Applications Design Guidelines</a>,&rdquo; draft-ietf-dime-app-design-guide-08 (work in progress), November&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-app-design-guide-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a></td>
<td class="author-text">Dondeti, L., Bournelle, J., Morand, L., and S. Decugis, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-erp-00.txt">Diameter Support for EAP Re-authentication Protocol</a>,&rdquo; draft-ietf-dime-erp-00 (work in progress), January&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-erp-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hokey-key-mgm">[I-D.ietf-hokey-key-mgm]</a></td>
<td class="author-text">Hoeper, K. and Y. Ohba, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hokey-key-mgm-06.txt">Distribution of EAP based keys for handover and re-authentication</a>,&rdquo; draft-ietf-hokey-key-mgm-06 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-hokey-key-mgm-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wu-dime-local-keytran">[I-D.wu-dime-local-keytran]</a></td>
<td class="author-text">Wu, W., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wu-dime-local-keytran-00.txt">Diameter support for local key transport protocol between local server and  home AAA server</a>,&rdquo; draft-wu-dime-local-keytran-00 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-wu-dime-local-keytran-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3748">[RFC3748]</a></td>
<td class="author-text">Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3748, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3748.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4187">[RFC4187]</a></td>
<td class="author-text">Arkko, J. and H. Haverinen, &ldquo;<a href="http://tools.ietf.org/html/rfc4187">Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)</a>,&rdquo; RFC&nbsp;4187, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4187.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5247">[RFC5247]</a></td>
<td class="author-text">Aboba, B., Simon, D., and P. Eronen, &ldquo;<a href="http://tools.ietf.org/html/rfc5247">Extensible Authentication Protocol (EAP) Key Management Framework</a>,&rdquo; RFC&nbsp;5247, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5247.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sebastien Decugis (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NICT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4-2-1 Nukui-Kitamachi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Koganei, Tokyo  184-8795</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JP</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:sdecugis@nict.go.jp">sdecugis@nict.go.jp</a></td></tr>
</table>
</body></html>
