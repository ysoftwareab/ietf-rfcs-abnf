<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Population Count Extensions to PIM</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Requirements Notation">
<link href="#rfc.section.2" rel="Chapter" title="2 Introduction">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 New Hello TLV Pop-Count Support">
<link href="#rfc.section.4" rel="Chapter" title="4 New Pop-Count Join Attribute Format">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Options">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Link Speed Encoding">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Example message layouts">
<link href="#rfc.section.5" rel="Chapter" title="5 How to use Pop-Count Encoding">
<link href="#rfc.section.6" rel="Chapter" title="6 Implementation Approaches">
<link href="#rfc.section.7" rel="Chapter" title="7 Caveats">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This specification defines a method for providing multicast distribution-tree accounting data.  Simple extensions to the PIM protocol allow a rough approximation of tree-based data in a scalable fashion." />
  <meta name="description" content="This specification defines a method for providing multicast distribution-tree accounting data.  Simple extensions to the PIM protocol allow a rough approximation of tree-based data in a scalable fashion." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">Dino Farinacci</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Greg Shepherd</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">Yiqun Cai</td>
</tr>
<tr>
<td class="left">Expires: January 07, 2012</td>
<td class="right">Stig Venaas</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 06, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Population Count Extensions to PIM<br />
  <span class="filename">draft-ietf-pim-pop-count-04.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification defines a method for providing multicast distribution-tree accounting data.  Simple extensions to the PIM protocol allow a rough approximation of tree-based data in a scalable fashion.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 07, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Requirements Notation</a>
</li>
<li>2.   <a href="#rfc.section.2">Introduction</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">New Hello TLV Pop-Count Support</a>
</li>
<li>4.   <a href="#rfc.section.4">New Pop-Count Join Attribute Format</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Options</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Link Speed Encoding</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Example message layouts</a>
</li>
<li>5.   <a href="#rfc.section.5">How to use Pop-Count Encoding</a>
</li>
<li>6.   <a href="#rfc.section.6">Implementation Approaches</a>
</li>
<li>7.   <a href="#rfc.section.7">Caveats</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgments</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Requirements Notation</h1>
<p id="rfc.section.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Introduction</h1>
<p id="rfc.section.2.p.1">This draft proposes a mechanism to convey accounting information using the PIM protocol <a href="#RFC4601">[RFC4601]</a> <a href="#RFC5015">[RFC5015]</a>. Putting the mechanism in PIM allows efficient distribution and maintenance of such accounting information. Previous mechanisms require data to be correlated from multiple router sources.</p>
<p id="rfc.section.2.p.2">This proposal allows a single router to be queried to obtain accounting and statistic information for a multicast distribution tree as a whole or any distribution sub-tree downstream from a queried router. The amount of information is fixed and does not increase as multicast membership, tree diameter, or branching increase.</p>
<p id="rfc.section.2.p.3">The sort of accounting data this draft provides, on a per multicast route basis, are:</p>
<p></p>

<ol>
<li>The number of branches in a distribution tree.</li>
<li>The membership type of the distribution tree, that is SSM or ASM.</li>
<li>Routing domain and time zone boundary information.</li>
<li>On-tree node and tree diameter counters.</li>
<li>Effective MTU and bandwidth.</li>
</ol>
<p id="rfc.section.2.p.5">This draft adds a new PIM Join Attribute type <a href="#RFC5384">[RFC5384]</a> to the Join/Prune message as well as a new Hello TLV. The mechanism is applicable to IPv4 and IPv6 multicast. </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Terminology</h1>
<p id="rfc.section.2.1.p.1">This section defines the terms used in this draft.</p>
<p></p>

<dl>
<dt>Multicast Route: </dt>
<dd style="margin-left: 8">A (S,G) or (*,G) entry regardless if the route is in ASM, SSM, or Bidir mode of operation.</dd>
<dt>Stub Link: </dt>
<dd style="margin-left: 8">A link with members joined to the group via IGMP or MLD.</dd>
<dt>Transit Link: </dt>
<dd style="margin-left: 8">A link put in the oif-list for a multicast route because it was joined by PIM routers.</dd>
</dl>
<p id="rfc.section.2.1.p.3">Note that a link can be both a Stub Link and a Transit Link at the same time.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> New Hello TLV Pop-Count Support</h1>
<p id="rfc.section.3.p.1">When a PIM router sends a Join/Prune message to a neighbor, it will encode the data in a new PIM Join Attribute type (described in this draft) when the PIM router determines the neighbor can support this draft. If a PIM router supports this draft, it must send the Pop-Count-Supported TLV. The format of the TLV is defined to be:</p>
<div id="#rfc.figure.1"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          OptionType           |         OptionLength          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          OptionValue                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<p id="rfc.section.3.p.2">OptionType = 29, OptionLength = 4, there is no OptionValue semantics defined at this time but will be included for expandability and be  defined in future revisions of this draft. The format will look like:</p>
<div id="#rfc.figure.2"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             29                |              4                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                      Unallocated Flags                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<p></p>

<dl>
<dt>Unallocated Flags: </dt>
<dd style="margin-left: 8">for now should be sent as 0 and ignored on receipt. </dd>
</dl>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> New Pop-Count Join Attribute Format</h1>
<p id="rfc.section.4.p.1">When a PIM router supports this draft and has determined from a received Hello, the neighbor supports this draft, it will send Join/Prune messages that MAY include a Pop-Count attribute. The mechanism to process PIM Join Attribute is described in <a href="#RFC5384">[RFC5384]</a>.  The format of the new attribute is described in the following. </p>
<div id="#rfc.figure.3"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |F|E| Attr Type |    Length     |        Effective MTU          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |             Flags             |        Options Bitmap         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            Options                            |
   .                               .                               .
   .                               .                               .
   .                               .                               .
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<p id="rfc.section.4.p.2">The above format is used only for entries in the join-list section of the Join/Prune message.</p>
<div id="#rfc.figure.4"></div>
<p></p>

<p></p>
<pre>
        0                   1
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |  Unalloc/Reserved   |P|a|t|A|S|
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<div id="#rfc.figure.5"></div>
<p></p>
<pre>
        A-flag   S-flag   Description
        ------   ------   -----------------------------------------
          0        0      There are no members for the group 
                          ('Stub Oif-List Count' is 0)
          0        1      All group members are only SSM capable
          1        0      All group members are only ASM capable
          1        1      There is a mixture of SSM and ASM capable 
            </pre>
<p></p>
<div id="#rfc.figure.6"></div>
<p></p>
<pre>
         0                   1
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        |T|s|m|M|d|n|D|z| Unalloc/Rsrvd |
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<div id="#rfc.figure.7"></div>
<p></p>
<pre>
         bit     Option
        -----   ------------------------
          T      Transit Oif-List Count
          s      Stub Oif-List Count
          m      Minimum Speed Link
          M      Maximum Speed Link
          d      Domain Count
          n      Node Count
          D      Diameter Count
          z      TZ Count
              </pre>
<p></p>
<dl>
<dt>F bit: </dt>
<dd style="margin-left: 8">0 Non-Transitive Attribute. </dd>
<dt>E bit: </dt>
<dd style="margin-left: 8">As specified by <a href="#RFC5384">[RFC5384]</a>. </dd>
<dt>Attr Type: </dt>
<dd style="margin-left: 8">2. </dd>
<dt>Length: </dt>
<dd style="margin-left: 8">The minimum length is 6. </dd>
<dt>Effective MTU: </dt>
<dd style="margin-left: 8">This contains the minimum MTU for any link in the oif-list. The sender of Join/Prune message takes the minimum value for the MTU (in bytes) from each link in the oif-list. If this value is less than the value stored for the multicast route (the one received from downstream joiners) then the value should be reset and sent in Join/Prune message. Otherwise, the value should remain unchanged. </dd>
<dt></dt>
<dd style="margin-left: 8">This provides one to obtain the MTU supported by multicast distribution tree when examined at the first-hop router(s) or for sub-tree for any router on the distribution tree.</dd>
<dt>Flags: </dt>
<dd style="margin-left: 8">The flags field has the following format: </dd>
<dt></dt>
<dd style="margin-left: 8"><dl>
<dt>Unallocated Flags: </dt>
<dd style="margin-left: 8">The flags which are currently not defined. If a new flag is defined and sent by a new implementation, an old implementation should preserve the bit settings. This means that if a bit was set in a PIM Join message from any of the downstream routers, then it MUST also be set in any PIM Join sent upstream.</dd>
<dt>S flag: </dt>
<dd style="margin-left: 8">If an IGMPv3 or MLDv2 report was received on any oif-list entry or the bit was set from any PIM Join message. This bit should only be cleared when the above becomes untrue.</dd>
<dt>A flag: </dt>
<dd style="margin-left: 8">If an IGMPv1, IGMPv2, or MLDv1 report was received on any oif-list entry or the bit was set from any PIM Join message. This bit should only be cleared when the above becomes untrue.</dd>
<dt></dt>
<dd style="margin-left: 8">A combination of settings for these bits indicate: </dd>
<dt>t flag: </dt>
<dd style="margin-left: 8">If there are any tunnels on the distribution tree. If a tunnel is in the oif-list, a router should set this bit in its Join/Prune messages. Otherwise, it propagates the bit setting from downstream joiners.</dd>
<dt>a flag: </dt>
<dd style="margin-left: 8">If there are any auto-tunnels on the distribution tree. If an auto-tunnel is in the oif-list, a router should set this bit in its Join/Prune messages.  Otherwise, it propagates the bit setting from downstream joiners. An example of an auto-tunnel is an tunnel setup by the AMT <a href="#AMT">[AMT]</a> protocol.</dd>
<dt>P flag: </dt>
<dd style="margin-left: 8">This flag remains set if all downstream routers support this specification. That is, they are PIM pop-count capable. This allows one to tell if the entire sub-tree is completely accounting capable.</dd>
</dl></dd>
<dt>Options Bitmap: </dt>
<dd style="margin-left: 8">This is a bitmap that shows which options are present. The format of the bitmap is as follows: <a href="#options">Section 4.1</a> for details on the different options. The unallocated bits are reserved. Any unknown bits MUST be set to 0 when a message is sent, and treated as 0 (ignored) when received. This means that unknown options which are denoted by unknown bits are ignored.</dd>
<dt></dt>
<dd style="margin-left: 8">By using this bitmap we can specify at most 16 options. If there becomes a need for more than 16 options, one can define a new option that contains a bitmap, which can then be used to specify which further options are present. The last bit in the current bitmap could be used for that option. The exact definition of this is however left for future documents.</dd>
<dt>Options: </dt>
<dd style="margin-left: 8">This field contains options. Which options are present are determined by the flag bits. As new flags and options may be defined in the future, any unknown/reserved flags MUST be ignored, and any additional trailing options MUST be ignored. See  <a href="#options">Section 4.1</a> for details on the options defined in this document.</dd>
</dl>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#options" id="options">Options</a>
</h1>
<p id="rfc.section.4.1.p.1">There are several options defined in this document. For each option, there is also a related flag that shows whether the option is present. See the Options Bitmap above for a list of the options and their respective bits. Each option has a fixed size.  </p>

<dl>
<dt>Transit Oif-List Count: </dt>
<dd style="margin-left: 8">This is filled in by a router sending a Join/Prune message which is equal to the number of oifs for the multicast route that has been joined by PIM. This indicates the transit branches on a multicast distribution tree (no members on the links between this router and joining routers). This is added to the value advertised by all downstream PIM routers that have joined on this oif.  Length 2 octets.</dd>
<dt>Stub Oif-List Count: </dt>
<dd style="margin-left: 8">This is filled in by a router sending a Join/Prune message which is equal to the number of oifs for the multicast route that has been joined by IGMP or MLD. This indicates the links where there are host members for the multicast route. This is added to the value advertised by all downstream PIM routers that have joined on this oif. Length 2 octets.</dd>
<dt>Minimum Speed Link: </dt>
<dd style="margin-left: 8">This contains the minimum bandwidth rate for any link in the oif-list and is encoded as specified in <a href="#speedenc">Section 4.1.1</a>. The sender of Join/Prune message takes the minimum value for each link in the oif-list for the multicast route. If this value is less than the value stored for the multicast route (the one received from downstream joiners) then the value should be reset and sent in Join/Prune message. Otherwise, the value should remain unchanged. This together with the Maximum Speed Link option provides a way to obtain the lowest and highest speed link for the multicast distribution tree.  Length 2 octets.</dd>
<dt>Maximum Speed Link: </dt>
<dd style="margin-left: 8">This contains the maximum bandwidth rate for any link in the oif-list and is encoded as specified in <a href="#speedenc">Section 4.1.1</a>. The sender of Join/Prune message takes the maximum value for each link in the oif-list for the multicast route. If this value is greater than the value stored for the multicast route (the one received from downstream joiners) then the value should be reset and sent in Join/Prune message. Otherwise, the value should remain unchanged. This together with the Minimum Speed Link option provides a way to obtain the lowest and highest speed link for the multicast distribution tree.  Length 2 octets.</dd>
<dt>Domain Count: </dt>
<dd style="margin-left: 8">This indicates the number of routing domains the distribution tree traverses. A router should increment this value if it is sending a Join/Prune message over a link which traverses a domain boundary. Length 1 octet.</dd>
<dt>Node Count: </dt>
<dd style="margin-left: 8">This indicates the number of routers on the distribution tree. Each router will sum up all the Node Counts from all joiners on all oifs and increment by 1 before including this value in the Join/Prune message.  Length 1 octet.</dd>
<dt>Diameter Count: </dt>
<dd style="margin-left: 8">This indicates the longest length of any given branch of the tree in router hops. Each router that sends a Join increments the max value received by all downstream joiners by 1. Length 1 octet.</dd>
<dt>TZ Count: </dt>
<dd style="margin-left: 8">This indicates the number of timezones the distribution tree traverses. A router should increment this value if it is sending a Join/Prune message over a link which traverses a time zone. This can be a configured link attribute or use other means to determine the timezone is acceptable. Length 1 octet.</dd>
</dl>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#speedenc" id="speedenc">Link Speed Encoding</a>
</h1>
<div id="#rfc.figure.8"></div>
<p id="rfc.section.4.1.1.p.1">The speed is encoded using 2 octets as follows: </p>

<p></p>
<pre>
         0                   1           
         0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        | Exponent  |    Significand    | 
        +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                </pre>
<p></p>
<div id="#rfc.figure.9"></div>
<p id="rfc.section.4.1.1.p.2">Here are some examples how this is used: </p>

<p></p>
<pre>
         Link Speed     Exponent     Significand
        ------------   ----------   -------------
         500 kbps       0            500
         500 kbps       2              5
         155 Mbps       3            155
         40 Gpbs        6             40
         100 Gpbs       6            100
         100 Gpbs       8              1
                </pre>
<p></p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Example message layouts</h1>
<p id="rfc.section.4.2.p.1">We will here give a few examples to illustrate the use of flags and options.</p>
<div id="#rfc.figure.10"></div>
<p id="rfc.section.4.2.p.2">A minimum size message has no option flags set, and looks like this: </p>

<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |F|E| Attr Type |  Length = 6   |        Effective MTU          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Unalloc/Reserved   |P|a|t|A|S|0|0|0|0|0|0|0|0| Unalloc/Rsrvd |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<div id="#rfc.figure.11"></div>
<p id="rfc.section.4.2.p.3">A message containing all the options defined in this document would look like this: </p>

<p></p>
<pre>
            &lt;figure&gt;
            &lt;preamble&gt;&lt;/preamble&gt;
            &lt;artwork&gt;&lt;![CDATA[
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |F|E| Attr Type |  Length = 18  |        Effective MTU          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Unalloc/Reserved   |P|a|t|A|S|1|1|1|1|1|1|1|1| Unalloc/Rsrvd |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Transit Oif-List Count     |     Stub Oif-List Count       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |      Minimum Speed Link       |      Maximum Speed Link       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Domain Count |  Node Count   | Diameter Count|    TZ Count   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<div id="#rfc.figure.12"></div>
<p id="rfc.section.4.2.p.4">A message containing only Stub Oif-List Count and Node Count would look like this: </p>

<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |F|E| Attr Type |  Length = 9   |        Effective MTU          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Unalloc/Reserved   |P|a|t|A|S|0|1|0|0|0|1|0|0| Unalloc/Rsrvd |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Stub Oif-List Count       |  Node count   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            </pre>
<p></p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> How to use Pop-Count Encoding</h1>
<p id="rfc.section.5.p.1">A router supporting this draft MUST include PIM Join Attribute TLV in its PIM Hellos.  See <a href="#RFC5384">[RFC5384]</a> and <a href="#HELLO">[HELLO]</a> for details. </p>
<p id="rfc.section.5.p.2">It is very important to note that any changes to the values maintained in  this draft MUST NOT trigger a new Join/Prune message. Due to the periodic nature of PIM, the values can be accurately obtained at 1 minute intervals (or whatever Join/Prune interval used).</p>
<p id="rfc.section.5.p.3">When a router removes a link from an oif-list, it must be able to reevaluate the values that it will advertise upstream.  This happens when an oif-list entry is timed out or a Prune is received.</p>
<p id="rfc.section.5.p.4">It is recommended that the Join Attribute defined in this draft be  used for entries in the join-list part of the Join/Prune message. If the new encoding is used in the prune-list or an Assert message, an implementation must ignore them but still process the Prune as if it was in the original encoding described in <a href="#RFC4601">[RFC4601]</a>.</p>
<p id="rfc.section.5.p.5">It is also recommended that join suppression be disabled on a LAN when Pop-Count is used.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Implementation Approaches</h1>
<p id="rfc.section.6.p.1">An implementation can decide how the accounting attributes are maintained.  The values can be stored as part of the multicast route data structure by combining the local information it has with the joined information on a per oif basis. So when it is time to send a Join/Prune message, the values stored in the multicast route can be copied to the message.</p>
<p id="rfc.section.6.p.2">Or, an implementation could store the accounting values per oif and when a Join/Prune message is sent, it can combine the oifs with its local information. Then the combined information can be copied to the message.</p>
<p id="rfc.section.6.p.3">When a downstream joiner stops joining, accounting values cached must be evaluated. There are two approaches which can be taken. One is to keep values learned from each joiner so when the joiner goes away the count/max/min values are known and the combined value can be adjusted. The other approach is to set the value to 0 for the oif, and then start accumulating new values as subsequent Joins are received.</p>
<p id="rfc.section.6.p.4">The same issue arises when an oif is removed from the oif-list.  Keeping per-oif values allows you to adjust the per-route values when an oif goes away.  Or, alternatively, a delay for reporting the new set a values from the route can occur while all oif values are zeroed (where accumulation of new values from subsequent Joins cause re-population of values and a new max/min/ count can be reevaluated for the route).</p>
<p id="rfc.section.6.p.5">It is recommended that when triggered Join/Prune messages are sent by a downstream router, that the accounting information not be included in the message. This way when convergence is important, avoiding the processing time to build an accounting record in a downstream router and processing time to parse the message in the upstream router will help reduce convergence time.  An upstream router should not interpret a Join/Prune message received with no accounting data to mean clearing or resetting what accounting data it has cached.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Caveats</h1>
<p id="rfc.section.7.p.1">This draft requires each router on a multicast distribution tree to support this draft or else the accounting attributes for the tree will not be known.</p>
<p id="rfc.section.7.p.2">However, if there are a contiguous set of routers downstream in the distribution tree, they can maintain accounting information for the sub-tree.</p>
<p id="rfc.section.7.p.3">If there are a set of contiguous routers supporting this draft upstream on the multicast distribution tree, accounting information will be available but it will not represent an accurate assessment of the entire tree. Also, it will not be clear for how much of the distribution tree the accounting information covers.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">A new PIM Hello Option type, 29, has been assigned. See <a href="#HELLO">[HELLO]</a> for details. </p>
<p id="rfc.section.8.p.2">A new PIM Join Attribute type needs to be assigned. 2 is proposed in this draft. </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Security Considerations</h1>
<p id="rfc.section.9.p.1">There are no security considerations for this design other than what is already in the main PIM specification <a href="#RFC4601">[RFC4601]</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgments</h1>
<p id="rfc.section.10.p.1">The authors would like to thank John Zwiebel, Amit Jain, and Clayton Wagar for their review comments on the initial versions of this draft. Further review and comments were provided by Thomas Morin and Zhaohui (Jeffrey) Zhang.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4601">[RFC4601]</b></td>
<td class="top">
<a>Fenner, B.</a>, <a>Handley, M.</a>, <a>Holbrook, H.</a> and <a>I. Kouvelas</a>, "<a href="http://tools.ietf.org/html/rfc4601">Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)</a>", RFC 4601, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5015">[RFC5015]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Kouvelas, I.</a>, <a>Speakman, T.</a> and <a>L. Vicisano</a>, "<a href="http://tools.ietf.org/html/rfc5015">Bidirectional Protocol Independent Multicast (BIDIR-PIM)</a>", RFC 5015, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5384">[RFC5384]</b></td>
<td class="top">
<a>Boers, A.</a>, <a>Wijnands, I.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc5384">The Protocol Independent Multicast (PIM) Join Attribute Format</a>", RFC 5384, November 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="HELLO">[HELLO]</b></td>
<td class="top">
<a>IANA, </a>, "<a>PIM Hello Options</a>", PIM-HELLO-OPTIONS per RFC4601 http://www.iana.org/assignments/pim-hello-options, March 2007.</td>
</tr>
<tr>
<td class="reference"><b id="AMT">[AMT]</b></td>
<td class="top">
<a>Thaler, D.</a>, <a>Talwar, M.</a>, <a>Aggarwal, A.</a>, <a>Vicisano, L.</a> and <a>T. Pusateri</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mboned-auto-multicast-10.txt">Automatic IP Multicast Without Explicit Tunnels (AMT)</a>", Internet-Draft draft-ietf-mboned-auto-multicast-10.txt, March 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dino Farinacci</span> 
	  <span class="n hidden">
		<span class="family-name">Dino Farinacci</span>
	  </span>
	</span>
	<span class="org vcardline">cisco Systems</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:dino@cisco.com">dino@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Greg Shepherd</span> 
	  <span class="n hidden">
		<span class="family-name">Greg Shepherd</span>
	  </span>
	</span>
	<span class="org vcardline">cisco Systems</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:gjshep@gmail.com">gjshep@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yiqun Cai</span> 
	  <span class="n hidden">
		<span class="family-name">Yiqun Cai</span>
	  </span>
	</span>
	<span class="org vcardline">cisco Systems</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ycai@cisco.com">ycai@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stig Venaas</span> 
	  <span class="n hidden">
		<span class="family-name">Stig Venaas</span>
	  </span>
	</span>
	<span class="org vcardline">cisco Systems</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:stig@cisco.com">stig@cisco.com</a></span>

  </address>
</div>

</body>
</html>