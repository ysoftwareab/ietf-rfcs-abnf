<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Diameter Group Signaling</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Grouping User Sessions">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Group assignment at session initiation">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Mid-session group assignment modifications">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 Client-initiated group assignment changes">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 Server-initiated group assignment changes">
<link href="#rfc.section.4" rel="Chapter" title="4 Protocol Description">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Session Management">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Authorization Session State Machine">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Server Initiated Group Re-auth">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Session Group Termination">
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 Aborting a Group of Sessions">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Commands">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Group-Re-Auth-Request">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Group-Re-Auth-Answer">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Group-Session-Termination-Request">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Group-Session-Termination-Answer">
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 Group-Abort-Session-Request">
<link href="#rfc.section.4.2.6" rel="Chapter" title="4.2.6 Group-Abort-Session-Answer">
<link href="#rfc.section.5" rel="Chapter" title="5 AVPs">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Session-Group-Id AVP">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Session-Group-Action AVP">
<link href="#rfc.section.6" rel="Chapter" title="6 Result-Code AVP Values">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Command Codes">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 AVP Codes">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="In large network deployments, a single Diameter peer can support over a million concurrent Diameter sessions. Recent use cases have revealed the need for Diameter peers to apply the same operation to a large group of Diameter sessions concurrently. The Diameter base protocol commands operate on a single session so these use cases could result in many thousands of command exchanges in order to enforce the same operation on each session in the group. In order to reduce signaling, it would be desirable to enable bulk operations on all (or part of) the sessions managed by a Diameter peer using a single or a few command exchanges. This document specifies the Diameter protocol extensions to achieve this signaling optimization." />
  <meta name="description" content="In large network deployments, a single Diameter peer can support over a million concurrent Diameter sessions. Recent use cases have revealed the need for Diameter peers to apply the same operation to a large group of Diameter sessions concurrently. The Diameter base protocol commands operate on a single session so these use cases could result in many thousands of command exchanges in order to enforce the same operation on each session in the group. In order to reduce signaling, it would be desirable to enable bulk operations on all (or part of) the sessions managed by a Diameter peer using a single or a few command exchanges. This document specifies the Diameter protocol extensions to achieve this signaling optimization." />
  <meta name="keywords" content="Internet-Draft, AAA, Diameter" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DIME</td>
<td class="right">M. Jones</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Bridgewater Systems</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">October 24, 2011</td>
</tr>
<tr>
<td class="left">Expires: April 26, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Diameter Group Signaling<br />
  <span class="filename">draft-jones-diameter-group-signaling-00.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>In large network deployments, a single Diameter peer can support over a million concurrent Diameter sessions. Recent use cases have revealed the need for Diameter peers to apply the same operation to a large group of Diameter sessions concurrently. The Diameter base protocol commands operate on a single session so these use cases could result in many thousands of command exchanges in order to enforce the same operation on each session in the group. In order to reduce signaling, it would be desirable to enable bulk operations on all (or part of) the sessions managed by a Diameter peer using a single or a few command exchanges. This document specifies the Diameter protocol extensions to achieve this signaling optimization.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 26, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Grouping User Sessions</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Group assignment at session initiation</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Mid-session group assignment modifications</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">Client-initiated group assignment changes</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">Server-initiated group assignment changes</a>
</li>
<li>4.   <a href="#rfc.section.4">Protocol Description</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Session Management</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Authorization Session State Machine</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Server Initiated Group Re-auth</a>
</li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Session Group Termination</a>
</li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">Aborting a Group of Sessions</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Commands</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Group-Re-Auth-Request</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Group-Re-Auth-Answer</a>
</li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">Group-Session-Termination-Request</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Group-Session-Termination-Answer</a>
</li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">Group-Abort-Session-Request</a>
</li>
<li>4.2.6.   <a href="#rfc.section.4.2.6">Group-Abort-Session-Answer</a>
</li>
<li>5.   <a href="#rfc.section.5">AVPs</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Session-Group-Id AVP</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Session-Group-Action AVP</a>
</li>
<li>6.   <a href="#rfc.section.6">Result-Code AVP Values</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Command Codes</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">AVP Codes</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgments</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">In large network deployments, a single Diameter peer can support over a million concurrent Diameter sessions. Recent use cases have revealed the need for Diameter peers to apply the same operation to a large group of Diameter sessions concurrently. For example, a policy decision point may need to modify the authorized quality of service for all active users having the same type of subscription. The Diameter base protocol commands operate on a single session so these use cases could result in many thousands of command exchanges in order to enforce the same operation on each session in the group. In order to reduce signaling, it would be desirable to enable bulk operations on all (or part of) the sessions managed by a Diameter peer using a single or a few command exchanges.</p>
<p id="rfc.section.1.p.2">This document describes a mechanism for grouping Diameter sessions and performing re-authentication, re-authorization, termination and abortion of groups of sessions. This document does not define a new Diameter application. Instead it defines mechanisms, commands and AVPs that may be used by any Diameter application that requires management of groups of sessions.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">This document uses terminology defined <a href="#RFC3588">[RFC3588]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Grouping User Sessions</h1>
<p id="rfc.section.3.p.1">Either Diameter peer may assign a session to a group. Diameter AAA applications typically assign client and server roles to the Diameter peers. In this document, a Diameter client is a node at the edge of the network that performs access control. A Diameter server is a node that performs authentication and/or authorization of the user.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Group assignment at session initiation</h1>
<p id="rfc.section.3.1.p.1">To assign a session to a group at session initiation, a Diameter client sends a service specific auth request, e.g. NASREQ AAR <a href="#RFC4005">[RFC4005]</a>, containing one or more client-assigned group identifiers. Assuming the user is successfully authenticated and/or authorized, the Diameter server responds with service-specific auth response, e.g. NASREQ AAA <a href="#RFC4005">[RFC4005]</a>, containing both the client-assigned group identifiers and the server-assigned group identifiers.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Mid-session group assignment modifications</h1>
<p id="rfc.section.3.2.p.1">Either Diameter peer may modify the group membership of an active Diameter session. A Diameter client MAY remove the group(s) assigned to the active session by the Diameter server and vice versa.</p>
<p id="rfc.section.3.2.p.2">Editor's Note: It is FFS whether this document should define a default permission model limiting removal of a session from a group.  For example, the server MUST NOT remove a session from a group assigned by the client.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> Client-initiated group assignment changes</h1>
<p id="rfc.section.3.2.1.p.1">To update the assigned groups mid-session, a Diameter client sends a service specific re-authorization request containing the updated list of group identifiers. Assuming the user is successfully authenticated and/or authorized, the Diameter server responds with a service-specific auth response containing the updated list of group identifiers received in the request.</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> Server-initiated group assignment changes</h1>
<p id="rfc.section.3.2.2.p.1">To update the assigned groups mid-session, a Diameter server sends a Re-authorization Request (RAR) message requesting re-authorization and the client responds with a Re-authorization Answer (RAA) message.  The Diameter client sends a service specific re-authorization request containing the current list of group identifiers and the Diameter server responds with a service-specific auth response containing the updated list of group identifiers.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Protocol Description</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Session Management</h1>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> Authorization Session State Machine</h1>
<p id="rfc.section.4.1.1.p.1">Section 8.1 in <a href="#RFC3588">[RFC3588]</a> defines a set of finite state machines, representing the life cycle of Diameter sessions, and which MUST be observed by all Diameter implementations that make use of the authentication and/or authorization portion of a Diameter application.  This section defines the additional state transitions related to the processing of the new commands which may impact multiple sessions.</p>
<p id="rfc.section.4.1.1.p.2">The group membership is session state and therefore only those state machines from <a href="#RFC3588">[RFC3588]</a> in which the server is maintaining session state are relevant in this document.  As in <a href="#RFC3588">[RFC3588]</a>, the term Service-Specific below refers to a message defined in a Diameter application (e.g., Mobile IPv4, NASREQ).</p>
<p id="rfc.section.4.1.1.p.3">The following state machine is observed by a client when state is maintained on the server. State transitions which are unmodified from <a href="#RFC3588">[RFC3588]</a> are not repeated here.</p>
<div id="#rfc.figure.1"></div>
<pre>
                           CLIENT, STATEFUL
   State     Event                          Action       New State
   ---------------------------------------------------------------
   Idle      Client or Device Requests      Send         Pending
             access                         service
                                            specific
                                            auth req
                                            optionally
                                            including
                                            groups

   Open      BASR received with             Send BASA    Discon
             Session-Group-Action           with
             = ALL_GROUPS,                  Result-Code
             session is assigned to         = SUCCESS,
             received group(s) and          Send BSTR.
             client will comply with        
             request to end the session  
 
   Open      BASR received with             Send BASA    Discon
             Session-Group-Action           with
             = PER_GROUPS,                  Result-Code
             session is assigned to         = SUCCESS,
             received group(s) and          Send BSTR
             client will comply with        per group
             request to end the session  
 
   Open      BASR received with             Send BASA    Discon
             Session-Group-Action           with
             = PER_SESSION,                 Result-Code
             session is assigned to         = SUCCESS,
             received group(s) and          Send STR
             client will comply with        per session
             request to end the session
                                            
   Open      BASR received,                 Send BASA    Open
             client will not comply with    with
             request to end all session     Result-Code
             in received group(s)           != SUCCESS
                                            
   Discon    BSTA Received                  Discon.      Idle
                                            user/device

   Open      BRAR received with             Send BRAA,   Pending
             Session-Group-Action           Send 
             = ALL_GROUPS,                  service
             session is assigned to         specific
             received group(s) and          group
             client will perform            re-auth req
             subsequent re-auth

   Open      BRAR received with             Send BRAA,   Pending
             Session-Group-Action           Send 
             = PER_GROUP,                   service
             session is assigned to         specific
             received group(s) and          group
             client will perform            re-auth req
             subsequent re-auth             per group

   Open      BRAR received with             Send BRAA,   Pending
             Session-Group-Action           Send 
             = PER_SESSION,                 service
             session is assigned to         specific
             received group(s) and          re-auth req
             client will perform            per session
             subsequent re-auth

   Open      BRAR received and client will  Send BRAA    Idle
             not perform subsequent         with
             re-auth                        Result-Code
                                            != SUCCESS,
                                            Discon.
                                            user/device

   Pending   Successful service-specific    Provide      Open
             group re-authorization answer  service
             received.
             
   Pending   Failed service-specific        Discon.      Idle
             group re-authorization answer  user/device
             received.             
             
</pre>
<p></p>
<p id="rfc.section.4.1.1.p.5">The following state machine is observed by a server when it is maintaining state for the session. State transitions which are unmodified from <a href="#RFC3588">[RFC3588]</a> are not repeated here.</p>
<div id="#rfc.figure.2"></div>
<pre>
                             SERVER, STATEFUL
   State     Event                          Action       New State
   ---------------------------------------------------------------

   Idle      Service-specific authorization Send         Open
             request received, and user     successful
             is authorized                  service
                                            specific
                                            answer
                                            optionally 
                                            including
                                            groups
                                            
   Open      Server wants to terminate      Send BASR    Discon   
             group(s)

   Discon    BASA received                  Cleanup      Idle
   
   Any       BSTR received                  Send BSTA,   Idle 
                                            Cleanup

   Open      Server wants to reauth         Send BRAR    Pending
             group(s)

   Pending   BRAA received with Result-Code Update       Open
             = SUCCESS                      session(s)

   Pending   BRAA received with Result-Code Cleanup      Idle
             != SUCCESS                     session(s) 

   Open      Service-specific group         Send         Open
             re-authoization request        successful
             received and user is           service           
             authorized                     specific
                                            group
                                            re-auth
                                            answer

   Open      Service-specific group         Send         Idle
             re-authorization request       failed
             received and user is           service           
             not authorized                 specific
                                            group
                                            re-auth
                                            answer,
                                            cleanup
                                           
</pre>
<p></p>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> Server Initiated Group Re-auth</h1>
<p id="rfc.section.4.1.2.p.1">TODO: rules/restrictions governing group re-auth</p>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> Session Group Termination</h1>
<p id="rfc.section.4.1.3.p.1">TODO: rules/restrictions governing session group termination</p>
<h1 id="rfc.section.4.1.4">
<a href="#rfc.section.4.1.4">4.1.4.</a> Aborting a Group of Sessions</h1>
<p id="rfc.section.4.1.4.p.1">TODO: rules/restrictions governing aborting groups of session</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#commands" id="commands">Commands</a>
</h1>
<p id="rfc.section.4.2.p.1">This specification extends the existing RAR, RAA, STR, STA, ASR and ASA command ABNFs.  </p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> Group-Re-Auth-Request</h1>
<p id="rfc.section.4.2.1.p.1">The Group-Re-Auth-Request (GRAR), indicated by the Command-Code set to TBD and the message flags' 'R' bit set, may be sent by any server to the access device that is providing session service, to request that one or more groups of users be re-authenticated and/or re-authorized.  </p>
<div id="#rfc.figure.3"></div>
<pre>
      &lt;GRAR&gt;  ::= &lt; Diameter Header: TBD, REQ, PXY &gt;
                * { Session-Group-Id }
                  { Origin-Host }
                  { Origin-Realm }
                  { Destination-Realm }
                  { Destination-Host }
                  { Auth-Application-Id }
                  { Re-Auth-Request-Type }
                  [ User-Name ]
                  [ Origin-State-Id ]
                * [ Proxy-Info ]
                * [ Route-Record ]
                  [ Session-Group-Action ]
                * [ AVP ]
</pre>
<p></p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> Group-Re-Auth-Answer</h1>
<p id="rfc.section.4.2.2.p.1">The Group-Re-Auth-Answer (GRAA), indicated by the Command-Code set to TBD and the message flags' 'R' bit clear, is sent in response to the GRAR.  The Result-Code AVP MUST be present, and indicates the disposition of the request.</p>
<p id="rfc.section.4.2.2.p.2">[Editor's Note: Move these detailed behaviour requirements to earlier section?]</p>
<p id="rfc.section.4.2.2.p.3">A successful GRAA message MUST be followed by an application-specific authentication and/or authorization message. The Group-Action AVP in the Group-Re-Auth-Request indicates whether a single exchange, per-group or per-session is required.</p>
<p id="rfc.section.4.2.2.p.4">If the peer receiving the GRAR has no active sessions which are assigned to the groups listed in the Session-Group-Id AVPs, it MUST return a GRAA with the Result-Code set to TBD.</p>
<p id="rfc.section.4.2.2.p.5">The Session-Group-Id AVPs in the GRAA indicate the groups for which the GRAR receiver has active sessions assigned to those groups.  </p>
<div id="#rfc.figure.4"></div>
<pre>
      &lt;GRAA&gt;  ::= &lt; Diameter Header: TBD, PXY &gt;
                * { Session-Group-Id }
                  { Result-Code }
                  { Origin-Host }
                  { Origin-Realm }
                  [ User-Name ]
                  [ Origin-State-Id ]
                  [ Error-Message ]
                  [ Error-Reporting-Host ]
                * [ Failed-AVP ]
                * [ Redirect-Host ]
                  [ Redirect-Host-Usage ]
                  [ Redirect-Host-Cache-Time ]
                * [ Proxy-Info ]
                * [ AVP ]   
</pre>
<p></p>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> Group-Session-Termination-Request</h1>
<p id="rfc.section.4.2.3.p.1">The Group-Session-Termination-Request (GSTR), indicated by the Command-Code set to TBD and the Command Flags' 'R' bit set, is sent by the access device to inform the Diameter Server that one or more groups of authenticated and/or authorized sessions are being terminated.</p>
<div id="#rfc.figure.5"></div>
<pre>
      &lt;GSTR&gt;  ::= &lt; Diameter Header: TBD, REQ, PXY &gt;
                * { Session-Group-Id }
                  { Origin-Host }
                  { Origin-Realm }
                  { Destination-Realm }
                  { Auth-Application-Id }
                  { Termination-Cause }
                  [ User-Name ]
                  [ Destination-Host ]
                * [ Class ]
                  [ Origin-State-Id ]
                * [ Proxy-Info ]
                * [ Route-Record ]
                * [ AVP ]        
</pre>
<p></p>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> Group-Session-Termination-Answer</h1>
<p id="rfc.section.4.2.4.p.1">The Group-Session-Termination-Answer (GSTA), indicated by the Command-Code set to TBD and the message flags' 'R' bit clear, is sent by the Diameter Server to acknowledge the notification that one or more groups of session have been terminated.  The Result-Code AVP MUST be present, and MAY contain an indication that an error occurred while servicing the GSTR.</p>
<p id="rfc.section.4.2.4.p.2">Upon sending or receipt of the GSTA, the Diameter Server MUST release all resources for all sessions belonging to the groups indicated by the Session-Group-Id AVP.  Any intermediate server in the Proxy-Chain MAY also release any resources, if necessary.</p>
<div id="#rfc.figure.6"></div>
<pre>
      &lt;GSTA&gt;  ::= &lt; Diameter Header: TBD, PXY &gt;
                * { Session-Group-Id }
                  { Result-Code }
                  { Origin-Host }
                  { Origin-Realm }
                  [ User-Name ]
                * [ Class ]
                  [ Error-Message ]
                  [ Error-Reporting-Host ]
                * [ Failed-AVP ]
                  [ Origin-State-Id ]
                * [ Redirect-Host ]
                  [ Redirect-Host-Usage ]
                  [ Redirect-Max-Cache-Time ]
                * [ Proxy-Info ]
                * [ AVP ]
</pre>
<p></p>
<h1 id="rfc.section.4.2.5">
<a href="#rfc.section.4.2.5">4.2.5.</a> Group-Abort-Session-Request</h1>
<p id="rfc.section.4.2.5.p.1">The Group-Abort-Session-Request (GASR), indicated by the Command-Code set to TBD and the message flags' 'R' bit set, may be sent by any server to the access device that is providing session service, to request that the sessions identified by the Session-Group-Id be stopped.</p>
<div id="#rfc.figure.7"></div>
<pre>
      &lt;GASR&gt;  ::= &lt; Diameter Header: TBD, REQ, PXY &gt;
                * { Session-Group-Id }
                  { Origin-Host }
                  { Origin-Realm }
                  { Destination-Realm }
                  { Destination-Host }
                  { Auth-Application-Id }
                  [ User-Name ]
                  [ Origin-State-Id ]
                * [ Proxy-Info ]
                * [ Route-Record ]
                  [ Group-Action ]
                * [ AVP ]
</pre>
<p></p>
<h1 id="rfc.section.4.2.6">
<a href="#rfc.section.4.2.6">4.2.6.</a> Group-Abort-Session-Answer</h1>
<p id="rfc.section.4.2.6.p.1">The Group-Abort-Session-Answer (GASA), indicated by the Command-Code set to TBD and the message flags' 'R' bit clear, is sent in response to the GASR.  The Result-Code AVP MUST be present, and indicates the disposition of the request.</p>
<p id="rfc.section.4.2.6.p.2">If the sessions identified by Session-Group-Id in the GASR were successfully terminated, Result-Code is set to DIAMETER_SUCCESS.  If the session is not currently active, Result-Code is set to DIAMETER_UNKNOWN_SESSION_ID.  If the access device does not stop the session for any other reason, Result-Code is set to DIAMETER_UNABLE_TO_COMPLY.</p>
<p id="rfc.section.4.2.6.p.3">[Editor's Note: Move these detailed behaviour requirements to earlier section.]</p>
<p id="rfc.section.4.2.6.p.4">A successful GASA message MUST be followed by one or more STR or GSTR to the authorizing server. The Group-Action AVP in the Group-Abort-Session-Request indicates whether a GSTR per group of sessions, a GSTR per group or an STR per session is required.</p>
<p id="rfc.section.4.2.6.p.5">If the peer receiving the GASR has no active sessions which are assigned the groups listed in the Session-Group-Id AVPs, it MUST return a GASA with the Result-Code set to TBD.</p>
<p id="rfc.section.4.2.6.p.6">The Session-Group-Id AVPs in the GASA indicate the groups for which the GASR receiver has active sessions assigned to those groups.  </p>
<div id="#rfc.figure.8"></div>
<pre>
      &lt;GASA&gt;  ::= &lt; Diameter Header: TBD, PXY &gt;
                * { Session-Group-Id }
                  { Result-Code }
                  { Origin-Host }
                  { Origin-Realm }
                  [ User-Name ]
                  [ Origin-State-Id ]
                  [ Error-Message ]
                  [ Error-Reporting-Host ]
                * [ Failed-AVP ]
                * [ Redirect-Host ]
                  [ Redirect-Host-Usage ]
                  [ Redirect-Max-Cache-Time ]
                * [ Proxy-Info ]
                * [ AVP ]
</pre>
<p></p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#avps" id="avps">AVPs</a>
</h1>
<div id="#rfc.figure.9"></div>
<pre>
                                        +--------------------+
                                        |   AVP Flag rules   |
                                        +----+---+------+----+
                      AVP               |    |   |SHOULD|MUST|
 Attribute Name       Code  Value Type  |MUST|MAY| NOT  | NOT|
+---------------------------------------+----+---+------+----+
|Session-Group-Id     TBD   OctetString |    | P |      | V  |
|Session-Group-Action TBD   Enumerated  |    | P |      | V  |
+---------------------------------------+----+---+------+----+
</pre>
<p></p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Session-Group-Id AVP</h1>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Session-Group-Action AVP</h1>
<p id="rfc.section.5.2.p.1">The Session-Group-Action AVP (AVP Code TBD) is of type Enumerated and specifies how the peer SHOULD issue follow up exchanges in response to a command which impacts mulitple sessions. The following values are supported:</p>
<p></p>

<dl>
<dt>ALL_GROUPS (0)</dt>
<dd style="margin-left: 8">
<br> Follow up exchanges should be performed with a single message exchange for all impacted groups.  </dd>
<dt>PER_GROUP (1)</dt>
<dd style="margin-left: 8">
<br> Follow up exchanges should be performed with a message exchange for each impacted group.  </dd>
<dt>PER_SESSION (2)</dt>
<dd style="margin-left: 8">
<br> Follow up exchanges should be performed with a message exchange for each impacted session.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#result" id="result">Result-Code AVP Values</a>
</h1>
<p id="rfc.section.6.p.1">This section defines new Result-Code <a href="#RFC3588">[RFC3588]</a> values that MUST be supported by all Diameter implementations that conform to this specification.</p>
<p id="rfc.section.6.p.2">[Editor's Note: Group specific error values may need to be added here.]</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<p id="rfc.section.7.p.1">This section contains the namespaces that have either been created in this specification or had their values assigned to existing namespaces managed by IANA.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> Command Codes</h1>
<p id="rfc.section.7.1.p.1">This specification requires IANA to register the following new Commands from the Command Code namespace defined in <a href="#RFC3588">[RFC3588]</a>.  <a href="#commands">Section 4.2</a>.  </p>

<ul>
<li>Group-Re-Auth-Request/Answer</li>
<li>Group-Session-Termination-Request/Answer</li>
<li>Group-Abort-Session-Request/Answer</li>
</ul>

<p> The commands are defined in </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> AVP Codes</h1>
<p id="rfc.section.7.2.p.1">This specification requires IANA to register the following new AVPs from the AVP Code namespace defined in <a href="#RFC3588">[RFC3588]</a>.  <a href="#avps">Section 5</a>.  </p>

<ul>
<li>Session-Group-Id</li>
<li>Session-Group-Action</li>
</ul>

<p> The AVPs are defined in </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">TODO</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgments</h1>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4005">[RFC4005]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Zorn, G.</a>, <a>Spence, D.</a> and <a>D. Mitton</a>, "<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>", RFC 4005, August 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mark Jones</span> 
	  <span class="n hidden">
		<span class="family-name">Jones</span>
	  </span>
	</span>
	<span class="org vcardline">Bridgewater Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mark@azu.ca">mark@azu.ca</a></span>

  </address>
</div>

</body>
</html>