<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>LDP Downstream-on-Demand in Seamless MPLS</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Reference Topologies">
<link href="#rfc.section.3" rel="Chapter" title="3 LDP DoD Use Cases">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Access Node Start-Up">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Access Node Service Provisioning">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Access Node Service Decommissioning">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Service Failure">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Network Transport Failure">
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 Access Node Failure">
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 Access Node Uplink Failure">
<link href="#rfc.section.3.5.3" rel="Chapter" title="3.5.3 AGN node failure">
<link href="#rfc.section.3.5.4" rel="Chapter" title="3.5.4 AGN network-side reachability failure">
<link href="#rfc.section.4" rel="Chapter" title="4 LDP Downstream on Demand Procedures">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 LDP Label Distribution Modes">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 IPv6 Support">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 LDP DoD Session Negotiation">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Label Request Procedures">
<link href="#rfc.section.4.4.1" rel="Chapter" title="4.4.1 AN Label Request Procedure">
<link href="#rfc.section.4.4.2" rel="Chapter" title="4.4.2 AGN Label Request Procedure">
<link href="#rfc.section.4.4.3" rel="Chapter" title="4.4.3 Label Request Retry Procedure">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Label Withdraw Procedure">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Label Release Procedure">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Local Repair">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access devices, based on their position in the network topology and their compute and memory constraints limit the amount of state they can hold. This can be achieved with LDP Downstream-on-Demand (LDP DoD) as specified in " />
  <meta name="description" content="Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access devices, based on their position in the network topology and their compute and memory constraints limit the amount of state they can hold. This can be achieved with LDP Downstream-on-Demand (LDP DoD) as specified in " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">T. Beckhaus</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Deutsche Telekom AG</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">B. Decraene</td>
</tr>
<tr>
<td class="left">Expires: January 05, 2012</td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">K. Tiruveedhula</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Konstantynowicz</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 04, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">LDP Downstream-on-Demand in Seamless MPLS<br />
  <span class="filename">draft-beckhaus-ldp-dod-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access devices, based on their position in the network topology and their compute and memory constraints limit the amount of state they can hold. This can be achieved with LDP Downstream-on-Demand (LDP DoD) as specified in <a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite>. This document describes LDP DoD use cases and lists LDP DoD procedures in the context of Seamless MPLS design.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 05, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Reference Topologies</a>
</li>
<li>3.   <a href="#rfc.section.3">LDP DoD Use Cases</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Access Node Start-Up</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Access Node Service Provisioning</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Access Node Service Decommissioning</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Service Failure</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Network Transport Failure</a>
</li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">Access Node Failure</a>
</li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">Access Node Uplink Failure</a>
</li>
<li>3.5.3.   <a href="#rfc.section.3.5.3">AGN node failure</a>
</li>
<li>3.5.4.   <a href="#rfc.section.3.5.4">AGN network-side reachability failure</a>
</li>
<li>4.   <a href="#rfc.section.4">LDP Downstream on Demand Procedures</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">LDP Label Distribution Modes</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">IPv6 Support</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">LDP DoD Session Negotiation</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Label Request Procedures</a>
</li>
<li>4.4.1.   <a href="#rfc.section.4.4.1">AN Label Request Procedure</a>
</li>
<li>4.4.2.   <a href="#rfc.section.4.4.2">AGN Label Request Procedure</a>
</li>
<li>4.4.3.   <a href="#rfc.section.4.4.3">Label Request Retry Procedure</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Label Withdraw Procedure</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">Label Release Procedure</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">Local Repair</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgements</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Seamless MPLS design enables a single IP/MPLS network to scale over core, metro and access parts of a large network infrastructure using standardized IP/MPLS protocols. One of the key goals of Seamless MPLS is to meet requirements specific to access devices, based on their position in the network topology and their compute and memory constraints limit the amount of state they can hold. This can be achieved with LDP Downstream-on-Demand (LDP DoD) as specified in <a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite>. This document describes LDP DoD use cases and lists LDP DoD procedures in the context of Seamless MPLS design.</p>
<p id="rfc.section.1.p.2">In Seamless MPLS topologies described in [seamless-mpls] , IP/MPLS protocol optimization is possible due to a relatively simple network topology that access nodes (AN) are part of.</p>
<p id="rfc.section.1.p.3">AN connectivity options include:</p>
<p><a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite>. This is because the original LDP DoD specification has been mainly used for ATM and FR&#8211;based MPLS LSRs in order to conserve available label space (i.e. with labels encoded in VPI/VCI).</p>

<ul>
<li>AN single-homed to an aggregation node (AGN)<ul>
<li>with single link</li>
<li>with multiple parallel links (IP ECMP or L2 LAG)</li>
</ul>
</li>
<li>AN dual-homed to two AGNs<ul>
<li>with single link</li>
<li>with multiple parallel links (IP ECMP or L2 LAG)</li>
</ul>
</li>
<li>AN daisy-chained via hub-AN<ul>
<li>with single link</li>
<li>with multiple parallel links (IP ECMP or L2 LAG)</li>
</ul>
</li>
</ul>

<p>With such topologies AN can implement the simplest IP routing configuration with static routes, limiting number of IP RIB and FIB entries required on AN. Furthermore MPLS label assignment can be addressed with LDP Downstream-on-Demand (LDP DoD) distribution. In general MPLS routers implement LDP Downstream Unsolicited (LDP DU) label distribution, advertising MPLS labels for all routes in their RIB. This is seen as very insufficient as ANs only require a small subset of total routes (and associated labels). LDP DoD enables on-request label distribution ensuring that only required labels are requested, provided and installed. Note that LDP DoD implementation is not widely available in today&#8217;s IP/MPLS devices despite the fact that it has been described in the original LDP specification </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Reference Topologies</h1>
<p id="rfc.section.2.p.1">Following reference end to end network topology is used for review the LDP DoD use cases based on Seamless MPLS <a href="#I-D.ietf-mpls-seamless-mpls">[I-D.ietf-mpls-seamless-mpls]</a>:</p>
<div id="#rfc.figure.1"></div>
<pre>              +-------+   +-------+   +------+   +------+
              |       |   |       |   |      |   |      |
           +--+ AGN11 +---+ AGN21 +---+ ABR1 +---+ LSR1 +--&gt; to AGN
          /   |       |  /|       |   |      |   |      |
   +----+/    +-------+\/ +-------+   +------+  /+------+
   | AN |              /\                     \/
   +----+\    +-------+  \+-------+   +------+/\ +------+
          \   |       |   |       |   |      |  \|      |
           +--+ AGN12 +---+ AGN22 +---+ ABR2 +---+ LSR2 +--&gt; to AGN
              |       |   |       |   |      |   |      |
              +-------+   +-------+   +------+   +------+

   static route     ISIS L1 LDP             ISIS L2 LDP

   &lt;-Access-&gt;&lt;--Aggregation Domain--&gt;&lt;---------Core---------&gt;
</pre>
<p></p>

<p>Figure 1. End-to-end reference network topology.</p>
<p id="rfc.section.2.p.3">Access Node is either single or dual homed to AGN1(s), with either a single or multiple parallel links to AGN1(s). AN has an LDP DoD session configured between its loopback address and the loopback address(es) of AGN1s. The reference AN configuration is shown in figure below.</p>
<div id="#rfc.figure.2"></div>
<pre>           +----+                        +-------+
           |    +------------------------+       +-------
           |AN1 |                        | AGN11 |
           |    +-------\    /-----------+       +-\    /
           +----+        \  /            +-------+  \  /
                          \/                         \/
                          /\                         /\
           +----+        /  \            +-------+  /  \
           |    +-------/    \-----------+       +-/    \
           |AN2 |                        | AGN12 |
           |    +------------------------+       +-------
           +----+                        +-------+
        
           --(a)-&gt;                        &lt;-(b)--
        
        (a) static route 0/0 default (/32 destinations optional)
        (b) static route for /32 AN loopback
        
              &lt;----------LDP DoD-----------&gt; &lt;--LDP DU--&gt;
</pre>
<p></p>

<p>Figure 2. Dual-homed AN topology.</p>
<p id="rfc.section.2.p.5">A variant of AN topology is daisy-chained ANs shown in figure below:</p>
<div id="#rfc.figure.3"></div>
<pre>                                           +-------+
                                           |       |---/
                                      /----+ AGN11 |
        +----+   +----+   +----+     /     |       |---\
        |    |   |    |   |    +----/      +-------+
        |ANn +...|AN2 +---+AN1 |                    
        |    |   |    |   |    +----\      +-------+
        +----+   +----+   +----+     \     |       |---/
                                      \----+ AGN12 |
                &lt;-(a)--   &lt;-(b)--          |       |---\
        --(d)-&gt; --(d)-&gt;   --(d)-&gt;          +-------+
                                           
                                           &lt;-(c)--
        
        (a) static routes for /32 AN loopbacks 3..n
        (b) static routes for /32 AN loopbacks 2..n
        (c) static routes for /32 AN loopbacks 1..n
        (d) static routes 0/0 default, (/32 destinations optional)
        
          &lt;------------LDP DoD----------------&gt; &lt;--LDP DU--&gt;</pre>
<p></p>

<p>Figure 3. Daisy-chained AN topology.</p>
<p id="rfc.section.2.p.7">Access Node has at least following routing entries configured:</p>

<ul>
<li>Static default routes (0.0.0.0/0) pointing to all interfaces linking to AGN1 nodes, one per interface.</li>
<li>Specific static routes for /32 loopback address of the directly connected AGN1, pointing to all interfaces linked to this AGN1.</li>
</ul>
<p id="rfc.section.2.p.8">If AN does not support <a href="#RFC5283">RFC 5283</a> <cite title="NONE">[RFC5283]</cite> and LDP label acceptance based on the longest match in the RIB, specific static routes to all required /32 destinations will be configured on this AN.  This configuration is service dependent: every unique destination requires a distinct /32 static routing entry pointing to interfaces linking to AGN1 nodes.</p>
<p id="rfc.section.2.p.9">AGN1s have specific /32 static routes for adjacent AN&#8217;s loopback address, pointing to all interfaces linked to this AN. If interfaces to AN are up, AGN1 advertises this /32 FEC over LDP Downstream Unsolicited (LDP DU) sessions to AGN2s.</p>
<p id="rfc.section.2.p.10">Note: Additional LDP features should be supported to comply with Seamless MPLS fast service restoration requirements as follows:</p>

<ul>
<li>AN should support local-repair in case of AGN1 uplink or AGN1 failure, by using either LDP LFA or simple ECMP or primary/backup switchover.</li>
<li>AGN1 should support local-repair in case of AN downlink failure, by implementing IGP LFA (w/ LDP support).</li>
<li>AGN should be configured with LDP-IGP synchronization to avoid traffic loss where there is no LDP label allocated to the downstream best IGP next hop.</li>
<li>AN and AGN should be configured with LDP session protection to avoid delay upon the recovery from link failure.</li>
</ul>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> LDP DoD Use Cases</h1>
<p id="rfc.section.3.p.1">LDP DoD operation is driven by Seamless MPLS use cases. This section describes these use cases focusing on services provisioned on Access Node and required LDP DoD operation on AN and AGN. For simplicity an example of MPLS PWE3 service is used to illustrate the service use cases.</p>
<p id="rfc.section.3.p.2">Described LDP DoD operations apply equally to ANs connected over single links or parallel links (IP ECMP or L2 LAG).</p>
<p id="rfc.section.3.p.3">This document is focusing on IPv4 LDP DoD procedures. Similar procedures are required with IPv6 LDP DoD, however some extension specific to IPv6 will apply including LSP mapping, peer discovery, transport connection establishment. These will be added in this document once LDP IPv6 standardization is advanced as per <a href="#I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</a>.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Access Node Start-Up</h1>
<p id="rfc.section.3.1.p.1">Access Node (AN) is commissioned without any service provisioned.  AN may request labels for loopback addresses of AGN1, AGN2 or other nodes within Seamless MPLS. During the initial AN configuration no services are provisioned on it. It is assumed that AGN1 has required IP/MPLS configuration for network-side connectivity.</p>
<p id="rfc.section.3.1.p.2">AN is only provisioned with the following static IP routing entries:</p>
<p></p>

<ul>
<li>Static default route 0/0 pointing to interfaces connected to AGN1 (AGN11 and AGN12 if present).</li>
<li>Static route for adjacent AGN1&#8217;s loopback, pointing to interfaces connected to AGN1.</li>
<li>(Optional) Static route for local metro AGN2&#8217;s loopback, pointing to interfaces connected to AGN1.</li>
<li>(Optional) Static routes for other nodes within Seamless MPLS network.</li>
</ul>
<p id="rfc.section.3.1.p.4">Note: last two entries are optional and not required if AN supports inter-area LDP <a href="#RFC5283">RFC 5283</a> <cite title="NONE">[RFC5283]</cite> and triggering of LDP DoD label mapping request by service (e.g. PW) configuration.</p>
<p id="rfc.section.3.1.p.5">IP/MPLS configuration on AN includes LDP sessions to loopback addresses of adjacent AGN1&#8217;s. Source IP address for this LDP session is the loopback address of AN.</p>
<p id="rfc.section.3.1.p.6">AGN1 is provisioned with a static route for AN's loopback, pointing to the interface connected to this AN. When the interface and link are up, AGN1 advertises this AN's static route into network side routing protocols i.e. IGP and/or MP-BGP Labeled Unicast.</p>
<p id="rfc.section.3.1.p.7">Access Node SHOULD request labels over LDP DoD session(s) to AGN1(s) for all configured static routes if this static routes are configured with LDP DoD request policy. It is expected that all /32 static routes will be configured with such policy.</p>
<p id="rfc.section.3.1.p.8">AGN1 provides AN with requested labels and MUST install the labels in its label table (LIB) and its forwarding table (LFIB). Access Node MUST also install the labels in its LIB and LFIB.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Access Node Service Provisioning</h1>
<p id="rfc.section.3.2.p.1">AN is provisioned with a new pseudowire service instance. AN requests a required /32 FEC label from AGN1x using LDP DoD procedures.</p>
<p id="rfc.section.3.2.p.2">Following the initial setup phase described in section 3.1, the first service instance gets provisioned on AN. Let us assume this is a pseudowire (PW) that is associated with either an attachment circuit (AC for VPWS service) or a virtual switching instance (VSI for VPLS service). The type of PW service does not matter. This PW will be signaled using targeted LDP FEC128 (0x80). Hence the PW is provisioned with the PW ID and the loopback IP address of destination node.</p>
<p id="rfc.section.3.2.p.3">From IP/MPLS perspective, following label operations need to complete successfully to establish PW service:</p>

<ul>
<li>LSP label for destination /32 FEC needs to be signaled using LDP DoD.</li>
<li>PW label for specific PW ID FEC128 needs to be signaled using targeted LDP and PWE3 signaling procedure as per <a href="#RFC4447">RFC 4447</a> <cite title="NONE">[RFC4447]</cite>
</li>
</ul>
<p id="rfc.section.3.2.p.4">AN has to establish a TCP/IP connection to the destination node for the targeted LDP session. This is done either by an explicit targeted LDP session configuration on AN (most likely) or automatically at the time of provisioning the PW.</p>
<p id="rfc.section.3.2.p.5">Destination node may be located in the local metro region or in a remote region. In the former case destination node is reachable via both native IP and MPLS LSPs, in the latter only via MPLS LSPs as transit core nodes do not hold remote AN IP routes. To ensure a common behavior for both cases, it is required that IP packets associated with this tLDP TCP/IP connection must be forwarded over an MPLS LSP to the destination, in other words LDP DoD label must be pushed on those packets by AN. This requires that LDP DoD is used for setting up MPLS LSP before tLDP session is established.</p>
<p id="rfc.section.3.2.p.6">To establish an LSP for destination /32 FEC, AN looks up its local routing table for this /32 and chooses outgoing interface. If label for this /32 route is not already installed based on the configured static route with LDP DoD request policy, AN MUST send an LDP DoD label mapping request over this interface to adjacent AGN1. AGN1 replies with its label for this FEC. AGN1 MUST install this incoming label in its LIB and FIB. Upon receiving label mapping Access Node MUST accept this label based on the exact route match between advertised FEC and route entry in its RIB or based on the longest match based on <a href="#RFC5283">[RFC5283]</a>. If AN accepts the label it MUST install it as outgoing label in its LIB and FIB.</p>
<p id="rfc.section.3.2.p.7">If AN is dual homed to two AGN1&#8217;s and routing entries for these AGN1&#8217;s are configured as equal cost paths, Access Node MUST send LDP DoD label requests to both AGN1&#8217;s and install all received labels in its LIB and FIB. If AN has multiple parallel links to AGN1 and routing entries for these links are configured as equal cost paths, same label should be used in LIB and programmed in the FIB for all these links.</p>
<p id="rfc.section.3.2.p.8">Following establishment of targeted LDP session, AN and the destination node exchange their PW label bindings based on the configured PW ID, and activate the PW service.</p>
<p id="rfc.section.3.2.p.9">In order to forward payload packets over the established PW, AN has to push PW encapsulation including the PW labels, followed by pushing the LSP label. AN chooses the LSP label based on the locally configured static route. If a specific route is reachable via multiple interfaces to AGN1 nodes (AN dual-homed, parallel links or both) and the route has multiple equal cost paths, Access Node MUST implement Equal Cost Multi-Path (ECMP) functionality. This involves AN to use hash-based load-balancing mechanism and send the PW packets in a flow-aware manner with appropriate LSP labels via all equal cost uplinks.</p>
<p id="rfc.section.3.2.p.10">ECMP mechanism is applicable in an equal manner for parallel links between two network elements and multiple paths towards the destination. The traffic demand is distributed over the available paths.</p>
<p id="rfc.section.3.2.p.11">To handle local link or adjacent node failures, AN should handle these local failures in a local-repair manner, that is AN should implement a simple LFA scheme. This will involve AN in case of primary interface failure choosing ECMP alternative or if not available a second best link.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Access Node Service Decommissioning</h1>
<p id="rfc.section.3.3.p.1">The last PW service instance is decommissioned. The LSP label is released.</p>
<p id="rfc.section.3.3.p.2">With the decommissioning of the service, the Pseudowire is deleted.  If it is the last PW to the specific destination node, targeted LDP session is not longer needed and SHOULD be terminated (automated or by configuration).</p>
<p id="rfc.section.3.3.p.3">The LSP label is not longer required on AN for carrying any service.</p>
<p id="rfc.section.3.3.p.4">If the LSP label was originally requested based on the static route configuration with LDP DoD request policy, the label MUST be retained by AN.</p>
<p id="rfc.section.3.3.p.5">If /32 FEC label was originally requested based on tLDP session configuration, AN SHOULD delete the label from its LIB and FIB. The deletion of the label MAY be done immediately or with a Garbage Collection mechanism.</p>
<p id="rfc.section.3.3.p.6">If AN deletes the label, it MUST signal to AGN1 the Label Release Message, indicating the label is not longer required. This MAY be done immediately or with a Garbage Collection mechanism. The AGN1 MAY use this message to delete the label in its FIB, if it is not needed for other peers. However AGN1 MAY retain the label in its LIB.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Service Failure</h1>
<p id="rfc.section.3.4.p.1">A service instance has failed due to a network event. No impact on LDP DoD /32 FEC label.</p>
<p id="rfc.section.3.4.p.2">Variety of network events can trigger PW failure: </p>

<ul>
<li>Local or remote attachment circuit has failed (remote end status signaled by targeted LDP).</li>
<li>Local or remote PSN-facing PW (ingress or egress) has failed (remote end signaled by targeted LDP).</li>
<li>PW is not in a enabled state for operation.</li>
<li>PW OAM has signaled a failure (e.g. VCCV).</li>
<li>Targeted LDP session is broken.</li>
<li>Network link or node failures (described in <a href="sec%203.5">sec 3.5</a>).</li>
</ul>

<p>In all cases except the last one, the status of the PW service MUST not have any impact on the LSP label signaling. Therefore AN MUST NOT modify associated LSP label entries in its LIB and FIB.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> Network Transport Failure</h1>
<p id="rfc.section.3.5.p.1">Number of different network events can impact services on AN.  Following sections describe network event types that impact LDP DoD operation on AN and AGN1.</p>
<h1 id="rfc.section.3.5.1">
<a href="#rfc.section.3.5.1">3.5.1.</a> Access Node Failure</h1>
<p id="rfc.section.3.5.1.p.1">Event: Access Node fails. Adjacent AGN1s delete LDP DoD /32 FEC labels for this AN.</p>
<p id="rfc.section.3.5.1.p.2">If AN fails, the link between AN and AGN1 goes down.</p>
<p id="rfc.section.3.5.1.p.3">AGN1 MUST remove associated static route(s) pointing to this AN from its routing table. AGN1 MUST also remove the associated outgoing label(s) for this AN&#8217;s /32 loopback(s) from its FIB.  AGN1 MAY remove the incoming labels provided to affected AN subject to other nodes using those labels or label retention procedures implemented on this AGN1.</p>
<p id="rfc.section.3.5.1.p.4">AGN1 SHOULD implement all relevant global-repair IP/MPLS procedures to propagate the AN failure towards the network.</p>
<h1 id="rfc.section.3.5.2">
<a href="#rfc.section.3.5.2">3.5.2.</a> Access Node Uplink Failure</h1>
<p id="rfc.section.3.5.2.p.1">Event: Link between AN and AGN1 fails. If last link, LDP DoD /32 FEC labels get deleted on AN and AGN1s.</p>
<p id="rfc.section.3.5.2.p.2">In the event when AN-AGN1 link fails (and there are no more active L3 links connecting AN and AGN1) or the LDP DoD session between AN and AGN1 fails, both AN and AGN1 should take following actions.</p>
<p></p>

<ul>
<li>AN MUST delete /32 FEC label entries for labels provided by AGN1 affected by this link failure event, and remove those labels from its LIB and FIB tables.</li>
<li>AGN1 MUST remove associated static route(s) pointing to this AN from its routing table.</li>
<li>AGN1 MUST also remove the associated outgoing label(s) for this AN&#8217;s /32 loopback(s) from its FIB.</li>
<li>AGN1 MAY remove the incoming labels provided to affected AN subject to other nodes using those labels or label retention procedures implemented on this AGN1.</li>
<li>In the event of interface or LDP DoD session coming back up, AN MUST request required labels observing procedures against link flapping.</li>
<li>If AN is not redundantly connected to AGN1 nodes, in case of link failure, the service MUST go into a failure status on AN.  When the failed link comes up again, the service MUST be reestablished automatically.</li>
<li>If AN is connected to AGN1 over multiple parallel links implementing ECMP, in case of link failure, the service SHOULD be immediately re-routed to remaining links with the same /32 FEC label.</li>
<li>If AN is dual homed to two AGN1s (i.e. AGN11 and AGN12 in the reference topology), in case of link failure and isolation from one of the AGN1s, the service SHOULD be immediately re-routed by AN to use link(s) to the other AGN1.</li>
</ul>
<h1 id="rfc.section.3.5.3">
<a href="#rfc.section.3.5.3">3.5.3.</a> AGN node failure</h1>
<p id="rfc.section.3.5.3.p.1">AGN1 node fails. Adjacent ANs delete LDP DoD /32 FEC labels provided by this AGN1.</p>
<p id="rfc.section.3.5.3.p.2">If AGN1 fails, all links between this AGN1 and adjacent ANs go down.</p>
<p id="rfc.section.3.5.3.p.3">AN MUST remove from its RIB static route(s) pointing to this AGN1 as a next hop. AN MUST also remove from its LIB and FIB all the outgoing labels provided by now failed AGN1. Access Node SHOULD use local-repair procedures to re-route away from the failure.</p>
<h1 id="rfc.section.3.5.4">
<a href="#rfc.section.3.5.4">3.5.4.</a> AGN network-side reachability failure</h1>
<p id="rfc.section.3.5.4.p.1">AGN1 loses network reachability to a specific destination or set of destinations. Associated /32 FEC labels are withdrawn from AN.</p>
<p id="rfc.section.3.5.4.p.2">In case of a network event that makes AGN1 lose its network reachability to a destination or set of destinations used by AN, AGN1 MUST send LDP Label Withdraw messages to all local ANs and withdraw labels for affected /32 FECs. Upon receiving those messages from AGN1, ANs MUST remove those labels from their LIB and FIB tables, and use alternative LSPs instead if available as part of global-repair.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> LDP Downstream on Demand Procedures</h1>
<p id="rfc.section.4.p.1">Label Distribution Protocol is specified in <a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite>, and all LDP DoD implementations must follow this specification.</p>
<p id="rfc.section.4.p.2">In MPLS network traffic flows from upstream to downstream LSR (<a href="#RFC3031">RFC3031</a> <cite title="NONE">[RFC3031]</cite>, section 3.2). In case of downstream assigned labels as described in this document, labels are assigned by the downstream LSR and signaled to the upstream LSR as shown in figure below.</p>
<div id="#rfc.figure.4"></div>
<pre>              +----------+      +------------+
              | upstream |      | downstream |
        ------+   LSR    +------+    LSR     +----
    traffic   |          |      |            |  address 
    source    +----------+      +------------+  (/32 for IPv4)
                                                traffic
             label distribution for IPv4 FEC    destination
               &lt;-------------------------      
                                               
                      traffic flow             
               -------------------------&gt;
</pre>
<p></p>

<p>Figure 4. LDP label assignment direction</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> LDP Label Distribution Modes</h1>
<p id="rfc.section.4.1.p.1">The LDP protocol specification <a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> section 2.6) defines two modes for label distribution control:</p>

<ul>
<li>Independent &#8211; an LSR recognizes a particular FEC and makes the decision to bind a label to the FEC independently to distribute the bindings to its peers. The new FECs are recognized whenever new routes become visible to the router.</li>
<li>Ordered &#8211; an LSR binds a label to a particular FEC if and only if it is the egress router or it has received a label binding for the FEC from its next hop LSR.</li>
</ul>
<p id="rfc.section.4.1.p.2">The LDP protocol specification (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> section 2.6) defines two modes for label retention: </p>

<ul>
<li>Conservative &#8211; the bindings between a label and an FEC received from LSRs that are not the next hop for a given FEC are discarded. This mode requires an LSR to maintain fewer labels.</li>
<li>Liberal &#8211; the bindings between a label and an FEC received from LSRs that are not the next hop for a given FEC are retained. This mode allows for quicker adaptation to topology changes and allows for the switching of traffic to other LSRs in case of change.</li>
</ul>
<p id="rfc.section.4.1.p.3">Note: In conservative label retention mode, if the next hop for FEC changes, then the LSR has to request a new label from the new next hop before labeled packets can be forwarded.</p>
<p id="rfc.section.4.1.p.4">For the LDP DoD Advertisement mode on AN an ordered label distribution mode and conservative label retention mode MUST be supported.</p>
<p id="rfc.section.4.1.p.5">With the ordered distribution mode, the AGN1 provides the access node only with FEC/label binding, where the AGN1 has a correct label binding itself.</p>
<p id="rfc.section.4.1.p.6">With the conservative retention mode, the AN retains only FEC/label binding on an interface, if the interface where the FEC/label mapping was received is a valid next hop. The DoD mode is explicitly mentioned in the description of the conservative mode in (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> section 2.6.2.1).</p>
<p id="rfc.section.4.1.p.7">The downstream labels on AGN1 may be allocated by LDP Downstream on Demand (LDP DoD) or LDP Downstream Unsolicited (LDP DU) or BGP labeled unicast routes that are learned as per <a href="#RFC3107">RFC 3107</a> <cite title="NONE">[RFC3107]</cite>. AGN1 should use the conservative label retention mode in case of Downstream on Demand label advertisement. AGN1 should use liberal retention mode in case of LDP DU label advertisement mode.  AGN1 should establish either LDP DoD or LDP DU session to peer LSR based on LDP session negotiation procedure, specified in section 4.3.  AGN1 must support interworking between LDP DoD and LDP DU sessions to different LSR peers.</p>
<p></p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> IPv6 Support</h1>
<p id="rfc.section.4.2.p.1">The current standard specifies the usage of IPv4 in LDP either as transport protocol or as service (binding of MPLS labels to Ipv4 addresses). <a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> also describes the usage of IPv6 as transport protocol, but not as the service. For the future deployment, LDP DoD MUST also support IPv6 for transport and services. This is still under development (<a href="#I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</a>).</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> LDP DoD Session Negotiation</h1>
<p id="rfc.section.4.3.p.1">The AN should propose the Downstream on Demand label advertisement by setting "A" value as 1 in the Common Session Parameters TLV of the Initialization message. The rules for negotiating the label advertisement mode are specified in the section 3.5.3 of LDP protocol specification (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> .</p>
<p id="rfc.section.4.3.p.2">To establish Downstream on Demand session both AN and AGN1 should propose the Downstream on Demand label advertisement mode in the Initialization message for other than ATM/FR links. If AGN1 proposes Downstream Unsolicited mode, AN should send Notification with status "Session Rejected/Parameters Advertisement Mode&#8221; and then close the LDP session.</p>
<p id="rfc.section.4.3.p.3">If AN is acting as active role, it should re-attempt the LDP session immediately. If AN receives same Downstream Unsolicited mode again, AN should follow the exponential backoff algorithm as specified in the (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> with delay of 15 seconds and subsequent delays grow to a maximum delay of 2 minutes.</p>
<p id="rfc.section.4.3.p.4">In case a PWE3 service is required between AN and AGN1, and LDP DoD has been negotiated for IPv4 and IPv6 FECs, the same LDP session should be used for PWE3 FECs. Even if DoD label advertisement has been negotiated for IPv4 and IPv6 LDP FECs as described earlier, LDP session should use Downstream Unsolicited label advertisement for PWE3 FECs as specified in <a href="#RFC4447">RFC4447</a> <cite title="NONE">[RFC4447]</cite>.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Label Request Procedures</h1>
<p id="rfc.section.4.4.p.1">The access node requests an MPLS label from the AGN1 with the Label Request Message (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> , section 3.5.8). The FEC is the specific IP address of the requested Forwarding Equivalent Class (FEC). The MPLS Label is delivered with the Label Mapping Message (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> section 3.5.7).</p>
<h1 id="rfc.section.4.4.1">
<a href="#rfc.section.4.4.1">4.4.1.</a> AN Label Request Procedure</h1>
<p id="rfc.section.4.4.1.p.1">AN will request label bindings for AGN1 nodes as well as labels for the possible loopback addresses within seamless MPLS network based on following trigger events in addition to <a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite>, section 3.5.8.1: </p>

<ul>
<li>AN is configured with /32 static route with LDP DoD label request policy in line with AN start-up use case specified in section 3.1.</li>
<li>AN is configured with service (e.g. PW) in line with PW provisioning use case described in section 2.2.</li>
<li>AN and AGN1 link comes up and LDP DoD session is established.  In this case AN should send label request messages for all /32 static routes configured with LDP DoD policy and all /32 routes related to provisioned services (PW) that are not covered by static routes with LDP DoD policy.</li>
</ul>
<p id="rfc.section.4.4.1.p.2">AGN1 will respond with label mapping message with a non-null label if any of the below conditions are met on AGN1: </p>

<ul>
<li>Requested FEC is a BGP labelled unicast route <a href="#RFC3107">RFC 3107</a> <cite title="NONE">[RFC3107]</cite> and this BGP route is the best selected for this FEC or</li>
<li>Requested FEC is an IGP or static route and there is an LDP label already learnt from downstream router (by LDP DU or LDP DoD), and this downstream router is the best next hop selected for this FEC. If selected downstream peer is LDP DoD and there is no label for this FEC, AGN1 will send a further label request message to this peer. In such case AGN1 will respond to AN only after getting a label from downstream peer.</li>
</ul>
<p id="rfc.section.4.4.1.p.3">AGN1 may send a label mapping with explicit-null or implicit-null label if it is acting as an egress for the requested FEC, or it may respond with &#8220;No Route&#8220; notification if no route exists.</p>
<h1 id="rfc.section.4.4.2">
<a href="#rfc.section.4.4.2">4.4.2.</a> AGN Label Request Procedure</h1>
<p id="rfc.section.4.4.2.p.1">AGN should send label request message based on the following trigger events in addition to <a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite>, section 3.5.8.1: </p>

<ul>
<li>AGN receives a label request from upstream LDP peer, has no downstream label for requested FEC and the downstream peer is LDP DoD, or</li>
<li>AGN is configured with /32 static route with LDP DoD label request policy.</li>
</ul>
<p id="rfc.section.4.4.2.p.2">In case of ECMP, AGN should send label requests over all LDP DoD sessions associated with selected ECMP best next hops. In case of LFA, AGN should request labels over LDP DoD sessions associated with both primary and backup next hop routers.</p>
<p id="rfc.section.4.4.2.p.3">In both ECMP and LFA cases, downstream LSR may be AN. AN should respond back with label mapping to AGN if corresponding /32 route configuration (loopback address) exists, otherwise AN responds with &#8220;No route&#8220; notification.</p>
<h1 id="rfc.section.4.4.3">
<a href="#rfc.section.4.4.3">4.4.3.</a> Label Request Retry Procedure</h1>
<p id="rfc.section.4.4.3.p.1">If AN or AGN receives a &#8220;No route&#8221; Notification in response to its label request message, it should retry with exponential backoff algorithm similar to the backoff algoritm mentioned in the LDP session negotiation section 4.3.</p>
<p id="rfc.section.4.4.3.p.2">If there is no response to the sent label request message, the LDP specification <a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite> (section A.1.1, page# 100) states that LSR should not send another request for the same label to the peer and mandates that a duplicate label request is considered a protocol error and should be dropped by the receiving LSR by sending Notification message.</p>
<p id="rfc.section.4.4.3.p.3">AN or AGN1 should not send duplicate label request message again if there is no response from downstream peer.</p>
<p id="rfc.section.4.4.3.p.4">If the static route gets deleted or DoD request policy rejected for particular FEC before receiving label mapping message, then AN or AGN1 should send a Label Abort message to downstream router.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Label Withdraw Procedure</h1>
<p id="rfc.section.4.5.p.1">If an MPLS label in the AGN1 is no longer valid, the AGN1 withdraws this FEC/label binding from the access nodes with the Label Withdraw Message ( <a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite> section 3.5.10) with a specified label TLV or with an empty label TLV.</p>
<p id="rfc.section.4.5.p.2">AGN1 should withdraw a label for specific FEC in the following cases: </p>

<ul>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by BGP labelled unicast route, this route is withdrawn.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP (DoD or DU) and IGP route is withdrawn from the RIB or downstream LDP session is lost.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP (DoD or DU) and received label is withdrawn by the downstream LSR.</li>
<li>If LDP DoD ingress label is associated with an outgoing label assigned by LDP, route next hop changed and <ol style="list-style-type: lower-alpha">
<li>there is no LDP session to the new next hop. To minimize probability of this, AGN should implement LDP-IGP synchronization procedures as specified in <a href="#RFC5443">RFC 5443</a> <cite title="NONE">[RFC5443]</cite>.</li>
<li>there is an LDP session but no label from downstream LSR.  See note below.</li>
</ol>
</li>
<li>If AGN1 is configured with a policy to reject exporting label mappings to AN.</li>
</ul>
<p id="rfc.section.4.5.p.3">The access node responds with the Label Release Message (<a href="#RFC5036">RFC5036</a> <cite title="NONE">[RFC5036]</cite> section 3.5.11).</p>
<p id="rfc.section.4.5.p.4">After sending label release message to AGN1, AN should keep retry sending label request message again, assuming AN still requires the label.</p>
<p id="rfc.section.4.5.p.5">AN should withdraw a label if the local route configuration (/32 loopback) is deleted on the AN. But if a service (PW) is decommissioned, then AN will release the label &#8211; see cases described in the next section 4.6.</p>
<p id="rfc.section.4.5.p.6">Note: For any events inducing next hop change, AGN1 should attempt to converge the LSP locally before withdrawing the label from an upstream AN. For example if the next hop changes for a particular FEC and if the new next hop allocates labels by LDP DoD session, then AGN1 must send label request on the new next hop session. If AGN1 doesn&#8216;t get label mapping for some duration, then and only then AGN1 must withdraw the upstream label.</p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> Label Release Procedure</h1>
<p id="rfc.section.4.6.p.1">If an access node does not need any longer a label for an FEC, it sends a Label Release Message (<a href="#RFC5036">RFC 5036</a> <cite title="NONE">[RFC5036]</cite> section 3.5.11) to the AGN1 with or without the label TLV.</p>
<p id="rfc.section.4.6.p.2">If AN or AGN1 receive unsolicited label mapping on DoD session, they should release the label by sending label release message.</p>
<p id="rfc.section.4.6.p.3">AN should send a label release message in the following cases: </p>

<ul>
<li>If it receives a label withdraw from AGN.</li>
<li>If /32 static route with LDP DoD label request policy is deleted.</li>
<li>If service (PW) gets decommissioned and there is no corresponding /32 static route with LDP DoD label request policy configured.</li>
<li>If the route next hop changed, and the label does not point to the best next hop.</li>
</ul>
<p id="rfc.section.4.6.p.4">AGN should send a label release message to downstream DoD session in the following cases:</p>

<ul>
<li>If /32 static route with LDP DoD label request policy is deleted.</li>
<li>If the route next hop changed, then AGN should send label release on the old next hop DoD session.</li>
<li>If it receives label withdraw from downstream DoD session.</li>
</ul>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> Local Repair</h1>
<p id="rfc.section.4.7.p.1">To support local-repair with LFA, AGN1 should request labels from both primary (best) next hop and for backup (second best) next hop LDP DoD sessions as specified in the label request procedures in the section 4.4.2. This will enable AGN1 to pre-program the backup forwarding path with the backup label if the primary next hop link fails, and invoke LFA switch-over procedure.</p>
<p id="rfc.section.4.7.p.2">To support local repair on AN, AN should request label from the backup (second best) next hop. This will enable AN1 to pre-program the backup forwarding path with the backup label if the primary next hop link fails, and invoke LFA switch-over procedure.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document makes no request of IANA.</p>
<p id="rfc.section.5.p.2">Note to RFC Editor: this section may be removed on publication as an RFC.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p></p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.7.p.1">The authors would like to thank Nischal Sheth, Nitin Bahadur and Nicolai Leymann for their suggestions and review.</p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4447">[RFC4447]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a>, <a>Smith, T.</a> and <a>G. Heron</a>, "<a href="http://tools.ietf.org/html/rfc4447">Pseudowire Setup and Maintenance Using the Label Distribution Protocol (LDP)</a>", RFC 4447, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4446">[RFC4446]</b></td>
<td class="top">
<a>Martini, L.</a>, "<a href="http://tools.ietf.org/html/rfc4446">IANA Allocations for Pseudowire Edge to Edge Emulation (PWE3)</a>", BCP 116, RFC 4446, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5283">[RFC5283]</b></td>
<td class="top">
<a>Decraene, B.</a>, <a>Le Roux, JL.</a> and <a>I. Minei</a>, "<a href="http://tools.ietf.org/html/rfc5283">LDP Extension for Inter-Area Label Switched Paths (LSPs)</a>", RFC 5283, July 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5036">[RFC5036]</b></td>
<td class="top">
<a>Andersson, L.</a>, <a>Minei, I.</a> and <a>B. Thomas</a>, "<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>", RFC 5036, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="http://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3107">[RFC3107]</b></td>
<td class="top">
<a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="http://tools.ietf.org/html/rfc3107">Carrying Label Information in BGP-4</a>", RFC 3107, May 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5443">[RFC5443]</b></td>
<td class="top">
<a>Jork, M.</a>, <a>Atlas, A.</a> and <a>L. Fang</a>, "<a href="http://tools.ietf.org/html/rfc5443">LDP IGP Synchronization</a>", RFC 5443, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-seamless-mpls">[I-D.ietf-mpls-seamless-mpls]</b></td>
<td class="top">
<a>Leymann, N</a>, <a>Decraene, B</a>, <a>Filsfils, C</a>, <a>Konstantynowicz, M</a> and <a>D Steinberg</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-seamless-mpls-00">Seamless MPLS Architecture</a>", Internet-Draft draft-ietf-mpls-seamless-mpls-00, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-ldp-ipv6">[I-D.ietf-mpls-ldp-ipv6]</b></td>
<td class="top">
<a>Asati, R</a>, <a>Manral, V</a>, <a>Papneja, R</a> and <a>C Pignataro</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-ldp-ipv6-05">Updates to LDP for IPv6</a>", Internet-Draft draft-ietf-mpls-ldp-ipv6-05, August 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Thomas Beckhaus</span> 
	  <span class="n hidden">
		<span class="family-name">Beckhaus</span>
	  </span>
	</span>
	<span class="org vcardline">Deutsche Telekom AG</span>
	<span class="adr">
	  <span>Heinrich-Hertz-Strasse 3-7</span>

	  <span class="vcardline">
		<span class="locality">Darmstadt</span>,  
		<span class="region"></span>
		<span class="code">64307</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49 6151 58 12825</span>

<span class="vcardline">EMail: <a href="mailto:thomas.beckhaus@telekom.de">thomas.beckhaus@telekom.de</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bruno Decraene</span> 
	  <span class="n hidden">
		<span class="family-name">Decraene</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom</span>
	<span class="adr">
	  <span>38-40 rue du General Leclerc</span>

	  <span class="vcardline">
		<span class="locality">Issy Moulineaux cedex 9</span>,  
		<span class="region"></span>
		<span class="code">92794</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bruno.decraene@orange-ftgroup.com">bruno.decraene@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kishore Tiruveedhula</span> 
	  <span class="n hidden">
		<span class="family-name">Tiruveedhula</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>10 Technology Park Drive</span>

	  <span class="vcardline">
		<span class="locality">Westford</span>,  
		<span class="region">Massachusetts</span> 
		<span class="code">01886</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: 1-(978)-589-8861</span>

<span class="vcardline">EMail: <a href="mailto:kishoret@juniper.net">kishoret@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Maciek Konstantynowicz</span> 
	  <span class="n hidden">
		<span class="family-name">Konstantynowicz</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:maciek@juniper.net">maciek@juniper.net</a></span>

  </address>
</div>

</body>
</html>