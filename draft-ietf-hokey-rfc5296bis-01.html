<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>EAP Extensions for EAP Re-authentication Protocol
    (ERP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="EAP Extensions for EAP Re-authentication Protocol
    (ERP)">
<meta name="keywords" content="EAP keying, EMSK, re-authentication, inter-authenticator roaming">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">Q. Wu, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Huawei</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc5296'>5296</a> (if&nbsp;approved)</td><td class="header">Z. Cao</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">China Mobile</td></tr>
<tr><td class="header">Expires: April 23, 2011</td><td class="header">Y. Shi</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H3C</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">B. He</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">CATR</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 20, 2010</td></tr>
</table></td></tr></table>
<h1><br />EAP Extensions for EAP Re-authentication Protocol
    (ERP)<br />draft-ietf-hokey-rfc5296bis-01</h1>

<h3>Abstract</h3>

<p>The Extensible Authentication Protocol (EAP) is a generic framework
      supporting multiple types of authentication methods. In systems where
      EAP is used for authentication, it is desirable to not repeat the entire
      EAP exchange with another authenticator. This document specifies
      extensions to EAP and the EAP keying hierarchy to support an EAP
      method-independent protocol for efficient re-authentication between the
      peer and an EAP re-authentication server through any authenticator. The
      re-authentication server may be in the home network or in the local
      network to which the peer is connecting.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on April 23, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#overview">3.</a>&nbsp;
ERP Description<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.1.</a>&nbsp;
ERP With the Home ER Server<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#local_er">3.2.</a>&nbsp;
ERP with a Local ER Server<br />
<a href="#eap_er_kh">4.</a>&nbsp;
ER Key Hierarchy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rRKderv">4.1.</a>&nbsp;
rRK Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
rRK Properties<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rIKderv">4.3.</a>&nbsp;
rIK Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.4.</a>&nbsp;
rIK Properties<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.5.</a>&nbsp;
rIK Usage<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.6.</a>&nbsp;
rMSK Derivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.7.</a>&nbsp;
rMSK Properties<br />
<a href="#anchor8">5.</a>&nbsp;
Protocol Details<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ERP-boot">5.1.</a>&nbsp;
ERP Bootstrapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.2.</a>&nbsp;
Steps in ERP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#window">5.2.1.</a>&nbsp;
Multiple Simultaneous Runs of ERP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#fail">5.2.2.</a>&nbsp;
ERP Failure Handling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.3.</a>&nbsp;
New EAP Packets<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Re-auth-Start">5.3.1.</a>&nbsp;
EAP-Initiate/Re-auth-Start Packet<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.3.1.1.</a>&nbsp;
Authenticator Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.3.1.2.</a>&nbsp;
Peer Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ReauthInit">5.3.2.</a>&nbsp;
EAP-Initiate/Re-auth Packet<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ReauthFin">5.3.3.</a>&nbsp;
EAP-Finish/Re-auth Packet<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.3.4.</a>&nbsp;
TV and TLV Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.4.</a>&nbsp;
Replay Protection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CB">5.5.</a>&nbsp;
Channel Binding<br />
<a href="#lowerlayer">6.</a>&nbsp;
Lower-Layer Considerations<br />
<a href="#AAA">7.</a>&nbsp;
Transport of ERP Messages<br />
<a href="#SecCons">8.</a>&nbsp;
Security Considerations<br />
<a href="#ianaCons">9.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#ack">Appendix&nbsp;A.</a>&nbsp;
Acknowledgments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">A.1.</a>&nbsp;
RFC 5296<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">A.2.</a>&nbsp;
RFC 5296bis<br />
<a href="#anchor19">Appendix&nbsp;B.</a>&nbsp;
Example ERP Exchange<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Extensible Authentication Protocol (EAP) is a an authentication
      framework that supports multiple authentication methods. The primary
      purpose is network access authentication, and a key-generating method is
      used when the lower layer wants to enforce access control. The EAP
      keying hierarchy defines two keys to be derived by all key-generating
      EAP methods: the Master Session Key (MSK) and the Extended MSK (EMSK).
      In the most common deployment scenario, an EAP peer and an EAP server
      authenticate each other through a third party known as the EAP
      authenticator. The EAP authenticator or an entity controlled by the EAP
      authenticator enforces access control. After successful authentication,
      the EAP server transports the MSK to the EAP authenticator; the EAP
      authenticator and the EAP peer establish transient session keys (TSKs)
      using the MSK as the authentication key, key derivation key, or a key
      transport key, and use the TSK for per-packet access enforcement.
</p>
<p>When a peer moves from one authenticator to another, it is desirable
      to avoid a full EAP authentication to support fast handovers. The full
      EAP exchange with another run of the EAP method can take several round
      trips and significant time to complete, causing delays in handover
      times. Some EAP methods specify the use of state from the initial
      authentication to optimize re-authentications by reducing the
      computational overhead, but method-specific re-authentication takes at
      least 2 round trips with the original EAP server in most cases (e.g.,
      <a class='info' href='#RFC4187'>[RFC4187]<span> (</span><span class='info'>Arkko, J. and H. Haverinen, &ldquo;Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA),&rdquo; January&nbsp;2006.</span><span>)</span></a>). It is also important to note that
      several methods do not offer support for re-authentication.
</p>
<p>Key sharing across authenticators is sometimes used as a practical
      solution to lower handover times. In that case, compromise of an
      authenticator results in compromise of keying material established via
      other authenticators. Other solutions for fast re-authentication exist
      in the literature <a class='info' href='#MSKHierarchy'>[MSKHierarchy]<span> (</span><span class='info'>Lopez, R., Skarmeta, A., Bournelle, J., Laurent-Maknavicus, M., and J. Combes, &ldquo;Improved EAP keying framework for a secure mobility access           service,&rdquo; 2006.</span><span>)</span></a>.
</p>
<p>In conclusion, to achieve low latency handovers, there is a need for
      a method-independent re-authentication protocol that completes in less
      than 2 round trips, preferably with a local server. The EAP
      re-authentication problem statement is described in detail in <a class='info' href='#RFC5169'>[RFC5169]<span> (</span><span class='info'>Clancy, T., Nakhjiri, M., Narayanan, V., and L. Dondeti, &ldquo;Handover Key Management and Re-Authentication Problem Statement,&rdquo; March&nbsp;2008.</span><span>)</span></a>.
</p>
<p>This document specifies EAP Re-authentication Extensions (ERXs) for
      efficient re-authentication using EAP. The protocol that uses these
      extensions is itself referred to as the EAP Re-authentication Protocol
      (ERP). It supports EAP method-independent re-authentication for a peer
      that has valid, unexpired key material from a previously performed EAP
      authentication. The protocol and the key hierarchy required for EAP
      re-authentication are described in this document.
</p>
<p>Note that to support ERP, lower-layer specifications may need to be
      revised to allow carrying EAP messages that have a code value higher
      than 4 and to accommodate the peer-initiated nature of ERP.
      Specifically, the IEEE802.1x specification must be revised and RFC 4306
      must be updated to carry ERP messages.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>This document uses the basic EAP terminology <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> and EMSK keying hierarchy terminology <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>. In addition, this document uses the following
      terms:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>ER Peer - An EAP peer that supports the EAP Re-authentication
          Protocol. All references to "peer" in this document imply an ER
          peer, unless specifically noted otherwise.
</dd>
<dt></dt>
<dd>ER Authenticator - An entity that supports the authenticator
          functionality for EAP re-authentication described in this document.
          All references to "authenticator" in this document imply an ER
          authenticator, unless specifically noted otherwise.
</dd>
<dt></dt>
<dd>ER Server - An entity that performs the server portion of ERP
          described here. This entity may or may not be an EAP server. All
          references to "server" in this document imply an ER server, unless
          specifically noted otherwise. An ER server is a logical entity; it
          may not necessarily be co-located with, or physically part of, a
          full EAP server.
</dd>
<dt></dt>
<dd>ERX - EAP re-authentication extensions.
</dd>
<dt></dt>
<dd>ERP - EAP Re-authentication Protocol that uses the
          re-authentication extensions.
</dd>
<dt></dt>
<dd>rRK - re-authentication Root Key, derived from the EMSK or
          DSRK.
</dd>
<dt></dt>
<dd>rIK - re-authentication Integrity Key, derived from the rRK.
</dd>
<dt></dt>
<dd>rMSK - re-authentication MSK. This is a per-authenticator key,
          derived from the rRK.
</dd>
<dt></dt>
<dd>keyName-NAI - ERP messages are integrity protected with the rIK
          or the DS-rIK. The use of rIK or DS-rIK for integrity protection of
          ERP messages is indicated by the EMSKname <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>; the protocol, which is ERP; and the realm,
          which indicates the domain name of the ER server. The EMSKname is
          copied into the username part of the NAI.
</dd>
<dt></dt>
<dd>Domain - Refers to a "key management domain" as defined in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>. For simplicity, it is referred to as
          "domain" in this document. The terms "home domain" and "local
          domain" are used to differentiate between the originating key
          management domain that performs the full EAP exchange with the peer
          and the local domain to which a peer may be attached at a given
          time.
</dd>
</dl></blockquote>

<a name="overview"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
ERP Description</h3>

<p>ERP allows a peer and server to mutually verify proof of possession
      of keying material from an earlier EAP method run and to establish a
      security association between the peer and the authenticator. The
      authenticator acts as a pass-through entity for the Re-authentication
      Protocol in a manner similar to that of an EAP authenticator described
      in RFC 3748 <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>. ERP is a single round-trip
      exchange between the peer and the server; it is independent of the lower
      layer and the EAP method used during the full EAP exchange. The ER
      server may be in the home domain or in the same (visited) domain as the
      peer and the authenticator (i.e.,local domain).
</p>
<p><a class='info' href='#erp_fig'>Figure&nbsp;2<span> (</span><span class='info'>ERP Exchange</span><span>)</span></a> shows the protocol exchange. The first
      time the peer attaches to any network, it performs a full EAP exchange
      (shown in <a class='info' href='#eap_fig'>Figure&nbsp;1<span> (</span><span class='info'>EAP Authentication</span><span>)</span></a>) with the EAP server; as a
      result, an MSK is distributed to the EAP authenticator. The MSK is then
      used by the authenticator and the peer to establish TSKs as needed. At
      the time of the initial EAP exchange, the peer and the server also
      derive an EMSK, which is used to derive a re-authentication Root Key
      (rRK). More precisely, a re-authentication Root Key is derived from the
      EMSK or from a Domain-Specific Root Key (DSRK), which is itself derived
      from the EMSK. The rRK is only available to the peer and the ER server
      and is never handed out to any other entity. Further, a
      re-authentication Integrity Key (rIK) is derived from the rRK; the peer
      and the ER server use the rIK to provide proof of possession while
      performing an ERP exchange. The rIK is also never handed out to any
      entity and is only available to the peer and server.
</p>
<p><br /><hr class="insert" />
<a name="eap_fig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
EAP Peer           EAP Authenticator                 EAP Server
========           =================                 ==========

 &lt;--- EAP-Request/ ------
         Identity

 ----- EAP Response/ ---&gt;
         Identity          ---AAA(EAP Response/Identity)--&gt;

 &lt;--- EAP Method -------&gt;  &lt;------ AAA(EAP Method --------&gt;
        exchange                    exchange)

                           &lt;----AAA(MSK, EAP-Success)------

 &lt;---EAP-Success---------

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: EAP Authentication&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p><br /><hr class="insert" />
<a name="erp_fig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Peer             ER Authenticator                   ER Server
====               =============                      ======

 [&lt;-- EAP-Initiate/ -----
     Re-auth-Start]
 [&lt;-- EAP-Request/ ------
     Identity]


 ---- EAP-Initiate/ ----&gt; ----AAA(EAP-Initiate/ ----------&gt;
       Re-auth/                  Re-auth/
      [Bootstrap]              [Bootstrap])

 &lt;--- EAP-Finish/ ------&gt; &lt;---AAA(rMSK,EAP-Finish/---------
       Re-auth/                   Re-auth/
     [Bootstrap]                [Bootstrap])

Note: [] brackets indicate optionality.

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: ERP Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>Two new EAP codes, EAP-Initiate and EAP-Finish, are specified in this
      document for the purpose of EAP re-authentication. When the peer
      identifies a target authenticator that supports EAP re-authentication,
      it performs an ERP exchange, as shown in <a class='info' href='#erp_fig'>Figure&nbsp;2<span> (</span><span class='info'>ERP Exchange</span><span>)</span></a>;
      the exchange itself may happen when the peer attaches to a new
      authenticator supporting EAP re-authentication, or prior to attachment.
      The peer initiates ERP by itself; it may also do so in response to an
      EAP-Initiate/Re-auth-Start message from the new authenticator. The
      EAP-Initiate/Re-auth-Start message allows the authenticator to trigger
      the ERP exchange. The EAP-Finish message also can be used by the
      authenticator to announce local domain name.
</p>
<p>It is plausible that the authenticator does not know whether the peer
      supports ERP and whether the peer has performed a full EAP
      authentication through another authenticator. The authenticator MAY
      initiate the ERP exchange by sending the EAP-Initiate/Re-auth-Start
      message, and if there is no response, it will send the
      EAP-Request/Identity message. Note that this avoids having two EAP
      messages in flight at the same time <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>. The
      authenticator may send the EAP-Initiate/Re-auth-Start message and wait
      for a short, locally configured amount of time. If the peer does not
      already know, this message indicates to the peer that the authenticator
      supports ERP. In response to this trigger from the authenticator, the
      peer can initiate the ERP exchange by sending an EAP-Initiate/Re-auth
      message. If there is no response from the peer after the necessary
      retransmissions (see <a class='info' href='#lowerlayer'>Section&nbsp;6<span> (</span><span class='info'>Lower-Layer Considerations</span><span>)</span></a>), the
      authenticator MUST initiate EAP by sending an EAP-Request message,
      typically the EAP-Request/Identity message. Note that the authenticator
      may receive an EAP-Initiate/Re-auth message after it has sent an
      EAP-Request/Identity message. If the authenticator supports ERP, it MUST
      proceed with the ERP exchange. When the EAP-Request/Identity times out,
      the authenticator MUST NOT close the connection if an ERP exchange is in
      progress or has already succeeded in establishing a re-authentication
      MSK.
</p>
<p>If the authenticator does not support ERP, it drops
      EAP-Initiate/Re-auth messages <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> as the EAP
      code of those packets is greater than 4. An ERP-capable peer will
      exhaust the EAP-Initiate/Re-auth message retransmissions and fall back
      to EAP authentication by responding to EAP Request/Identity messages
      from the authenticator. If the peer does not support ERP or if it does
      not have unexpired key material from a previous EAP authentication, it
      drops EAP-Initiate/Re-auth-Start messages. If there is no response to
      the EAP-Initiate/Re-auth-Start message, the authenticator SHALL send an
      EAP Request message (typically EAP Request/Identity) to start EAP
      authentication. From this stage onwards, RFC 3748 rules apply. Note that
      this may introduce some delay in starting EAP. In some lower layers, the
      delay can be minimized or even avoided by the peer initiating EAP by
      sending messages such as EAPoL-Start in the IEEE 802.1X specification
      <a class='info' href='#IEEE_802.1X'>[IEEE_802.1X]<span> (</span><span class='info'>Institute of Electrical and Electronics             Engineers, &ldquo;IEEE Standards for Local and Metropolitan Area Networks: Port           based Network Access Control, IEEE Std 802.1X-2004,&rdquo; December&nbsp;2004.</span><span>)</span></a>.
</p>
<p>The peer sends an EAP-Initiate/Re-auth message that contains the
      keyName-NAI to identify the ER server's domain and the rIK used to
      protect the message, and a sequence number for replay protection. The
      EAP-Initiate/Re-auth message is integrity protected with the rIK. The
      authenticator uses the realm in the keyName-NAI <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a> field to send the message to the appropriate ER
      server. The server uses the keyName to look up the rIK. The server,
      after verifying proof of possession of the rIK, and freshness of the
      message, derives a re-authentication MSK (rMSK) from the rRK using the
      sequence number as an input to the key derivation. The server updates
      the expected sequence number to the received sequence number plus
      one.
</p>
<p>In response to the EAP-Initiate/Re-auth message, the server sends an
      EAP-Finish/Re-auth message; this message is integrity protected with the
      rIK. The server transports the rMSK along with this message to the
      authenticator. The rMSK is transported in a manner similar to that of
      the MSK along with the EAP-Success message in a full EAP exchange.
      Ongoing work in <a class='info' href='#RFC5749'>[RFC5749]<span> (</span><span class='info'>Hoeper, K., Nakhjiri, M., and Y. Ohba, &ldquo;Distribution of EAP-Based Keys for Handover and Re-Authentication,&rdquo; March&nbsp;2010.</span><span>)</span></a> describes an additional
      key distribution protocol that can be used to transport the rRK from an
      EAP server to one of many different ER servers that share a trust
      relationship with the EAP server.
</p>
<p>The peer MAY request the server for the rMSK lifetime. If so, the ER
      server sends the rMSK lifetime in the EAP-Finish/Re-auth message.
</p>
<p>In an ERP bootstrap exchange, the peer MAY request the server for the
      rRK lifetime. If so, the ER server sends the rRK lifetime in the
      EAP-Finish/Re-auth message.
</p>
<p>The peer verifies the replay protection and the integrity of the
      message. It then uses the sequence number in the EAP-Finish/Re-auth
      message to compute the rMSK. The lower-layer security association
      protocol is ready to be triggered after this point.
</p>
<p>When the ER server is in the home domain, the peer and the server use
      the rIK and rRK derived from the EMSK; and when the ER server is in the
      local domain, they use the DS-rIK and DS-rRK corresponding to the local
      domain. The domain of the ER server is identified by the realm portion
      of the keyname-NAI in ERP messages.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
ERP With the Home ER Server</h3>

<p>If the peer is in the home domain and does not know the domain name
        ( did not receive the domain name through the
        EAP-Initiate/Re-auth-Start message or via the lower-layer
        announcement, due to a missed announcement or lack of support for
        domain name announcements in a specific lower layer) or there is no
        the local server in the same domain as the peer, it SHOULD initiate
        ERP bootstrap exchange with the home ER server to obtain the domain
        name.
</p>
<p>The defined ER extensions allow executing the ERP with an ER server
        in the home domain. The home ER server may be co- located with a home
        AAA server. The ERP with the Home ER Server is the similar as ERP
        exchange described in <a class='info' href='#erp_fig'>Figure&nbsp;2<span> (</span><span class='info'>ERP Exchange</span><span>)</span></a>.
</p>
<p><br /><hr class="insert" />
<a name="home_erp_fig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Peer             ER Authenticator                   Home ER Server
====               =============                      ======

 [&lt;-- EAP-Initiate/ -----
     Re-auth-Start]
 [&lt;-- EAP-Request/ ------
     Identity]


 ---- EAP-Initiate/ ----&gt; ----AAA(EAP-Initiate/ ----------&gt;
       Re-auth/                  Re-auth/
      [Bootstrap]              [Bootstrap])

 &lt;--- EAP-Finish/ ------&gt; &lt;---AAA(rMSK,EAP-Finish/---------
       Re-auth/                   Re-auth/
     [Bootstrap]                [Bootstrap])

Note: [] brackets indicate optionality.

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: ER ExplicitBootstrapping Exchange/ERP with the Home ER Sever&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<a name="local_er"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
ERP with a Local ER Server</h3>

<p>The defined ER extensions allow executing the ERP with an ER server
        in the local domain (access network) if the peer moves out of home
        domain. The local ER server may be co-located with a local AAA server.
        The peer may learn about the presence of a local ER server in the
        network and the local domain name (or ER server name) either via the
        lower layer or by means of ERP exchange. The peer uses the domain name
        and the EMSK to compute the DSRK and from that key, the DS-rRK; the
        peer also uses the domain name in the realm portion of the keyName-NAI
        for using ERP in the local domain. <a class='info' href='#local_erp_fig_init'>Figure&nbsp;4<span> (</span><span class='info'>Local ERP Exchange, Initial EAP Exchange</span><span>)</span></a> shows the ER Implicit
        bootstrapping exchange through local ER Server;<a class='info' href='#local_erp_fig'>Figure&nbsp;5<span> (</span><span class='info'>Local ERP Exchange</span><span>)</span></a>shows ERP with a local ER server.
</p>
<p><br /><hr class="insert" />
<a name="local_erp_fig_init"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Peer         EAP Authenticator     Local AAA Agent     Home EAP Server
              /ER Authenticator    /Local ER Server
====         =================     ===============     ===============

&lt;-- EAP-Request/ --
     Identity

-- EAP Response/--&gt;
     Identity      --AAA(EAP Response/--&gt;
                         Identity,       --AAA(EAP Response/ --&gt;
                     [domain name])             Identity,
                                             [DSRK Request,
                                           domain name])

&lt;------------------------ EAP Method exchange------------------&gt;

                                         &lt;---AAA(MSK, DSRK, ----
                                                EMSKname,
                                              EAP-Success)

                    &lt;---  AAA(MSK,  -----
                         EAP-Success)

&lt;---EAP-Success-----


</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Local ERP Exchange, Initial EAP Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p><br /><hr class="insert" />
<a name="local_erp_fig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Peer                ER Authenticator            Local ER Server
====                ================            ===============

[&lt;-- EAP-Initiate/ --------
     Re-auth-Start]
[&lt;-- EAP-Request/ ---------
     Identity]


 ---- EAP-Initiate/ -------&gt; ----AAA(EAP-Initiate/ --------&gt;
       Re-auth                        Re-auth)


 &lt;--- EAP-Finish/ ---------- &lt;---AAA(rMSK,EAP-Finish/-------
       Re-auth                        Re-auth)




</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: Local ERP Exchange&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>As shown in <a class='info' href='#local_erp_fig_init'>Figure&nbsp;4<span> (</span><span class='info'>Local ERP Exchange, Initial EAP Exchange</span><span>)</span></a>, the local ER
        server may be present in the path of the full EAP exchange (e.g., this
        may be one of the AAA entities, such as AAA proxies, in the path
        between the EAP authenticator and the home EAP server of the peer). In
        that case, the local ER server requests the DSRK by sending the domain
        name to the home EAP server through AAA message. In response, the home
        EAP server computes the DSRK by following the procedure specified in
        <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a> and sends the DSRK and the key name,
        EMSKname, to the ER server in the claimed domain (i.e., local ER
        Server). The local domain is responsible for announcing that same
        domain name via the lower layer to the peer, e.g., DHCP based local
        domain name discovery specified in <a class='info' href='#I-D.ietf-hokey-ldn-discovery'>[I&#8209;D.ietf&#8209;hokey&#8209;ldn&#8209;discovery]<span> (</span><span class='info'>Zorn, G., Wu, Q., and Y. Wang, &ldquo;The Local Domain Name DHCPv6 Option,&rdquo; September&nbsp;2010.</span><span>)</span></a>, or through the
        EAP-Initiate/Re-auth-Start message during subsequent ERP with local ER
        server.
</p>
<p>After receiving the DSRK and the EMSKname, the local ER server
        computes the DS-rRK and the DS-rIK from the DSRK as defined in
        Sections <a class='info' href='#rRKderv'>4.1<span> (</span><span class='info'>rRK Derivation</span><span>)</span></a> and <a class='info' href='#rIKderv'>4.3<span> (</span><span class='info'>rIK Derivation</span><span>)</span></a> below. After receiving the
        domain name, the peer also derives the DSRK, the DS-rRK, and the
        DS-rIK. These keys are referred to by a keyName-NAI formed as follows:
        the username part of the NAI is the EMSKname, the realm portion of the
        NAI is the domain name. Both parties also maintain a sequence number
        (initialized to zero) corresponding to the specific keyName-NAI.
</p>
<p>Subsequently, when the peer attaches to an authenticator within the
        local domain, it may perform an ERP exchange with the local ER server
        to obtain an rMSK for the new authenticator. The ERP with the local ER
        Server is the similar as ERP exchange described in <a class='info' href='#erp_fig'>Figure&nbsp;2<span> (</span><span class='info'>ERP Exchange</span><span>)</span></a>.
</p>
<a name="eap_er_kh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
ER Key Hierarchy</h3>

<p>Each time the peer re-authenticates to the network, the peer and the
      authenticator establish an rMSK. The rMSK serves the same purposes that
      an MSK, which is the result of full EAP authentication, serves. To prove
      possession of the rRK, we specify the derivation of another key, the
      rIK. These keys are derived from the rRK. Together they constitute the
      ER key hierarchy.
</p>
<p>The rRK is derived from either the EMSK or a DSRK as specified in
      <a class='info' href='#rRKderv'>Section&nbsp;4.1<span> (</span><span class='info'>rRK Derivation</span><span>)</span></a>. For the purpose of rRK derivation, this
      document specifies derivation of a Usage-Specific Root Key (USRK) or a
      Domain-Specific USRK (DSUSRK) in accordance with <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a> for re-authentication. The USRK designated for
      re-authentication is the re-authentication root key (rRK). A DSUSRK
      designated for re-authentication is the DS-rRK available to a local ER
      server in a particular domain. For simplicity, the keys are referred to
      without the DS label in the rest of the document. However, the scope of
      the various keys is limited to just the respective domains they are
      derived for, in the case of the domain specific keys. Based on the ER
      server with which the peer performs the ERP exchange, it knows the
      corresponding keys that must be used.
</p>
<p>The rRK is used to derive an rIK, and rMSKs for one or more
      authenticators. The figure below shows the key hierarchy with the rRK,
      rIK, and rMSKs. <br /><hr class="insert" />
<a name="rRK_fig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         rRK
                          |
                 +--------+--------+
                 |        |        |
                rIK     rMSK1 ...rMSKn
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Re-authentication Key Hierarchy&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The derivations in this document are according to <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>. Key derivations and field encodings, where
      unspecified, default to that document.
</p>
<a name="rRKderv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
rRK Derivation</h3>

<p>The rRK may be derived from the EMSK or DSRK. This section provides
        the relevant key derivations for that purpose.
</p>
<p>The rRK is derived as specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>rRK = KDF (K, S), where</p>
<blockquote class="text">
<p>K = EMSK or K = DSRK and
</p>
<p>S = rRK Label | "\0" | length
</p>
</blockquote>

<p>The rRK Label is an IANA-assigned 8-bit ASCII string: </p>
<blockquote class="text">
<p>EAP Re-authentication Root Key@ietf.org
</p>
</blockquote><p> assigned from the "USRK key labels" name space in accordance
        with <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The KDF and algorithm agility for the KDF are as defined in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>An rRK derived from the DSRK is referred to as a DS-rRK in the rest
        of the document. All the key derivation and properties specified in
        this section remain the same.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
rRK Properties</h3>

<p>The rRK has the following properties. These properties apply to the
        rRK regardless of the parent key used to derive it. </p>
<ul class="text">
<li>The length of the rRK MUST be equal to the length of the parent
            key used to derive it.
</li>
<li>The rRK is to be used only as a root key for re-authentication
            and never used to directly protect any data.
</li>
<li>The rRK is only used for derivation of rIK and rMSK as
            specified in this document.
</li>
<li>The rRK MUST remain on the peer and the server that derived it
            and MUST NOT be transported to any other entity.
</li>
<li>The lifetime of the rRK is never greater than that of its
            parent key. The rRK is expired when the parent key expires and
            MUST be removed from use at that time.
</li>
</ul>

<a name="rIKderv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
rIK Derivation</h3>

<p>The re-authentication Integrity Key (rIK) is used for integrity
        protecting the ERP exchange. This serves as the proof of possession of
        valid keying material from a previous full EAP exchange by the peer to
        the server.
</p>
<p>The rIK is derived as follows.
</p>
<p>rIK = KDF (K, S), where</p>
<blockquote class="text">
<p>K = rRK and
</p>
<p>S = rIK Label | "\0" | cryptosuite | length
</p>
</blockquote>

<p>The rIK Label is the 8-bit ASCII string: </p>
<blockquote class="text">
<p>Re-authentication Integrity Key@ietf.org
</p>
</blockquote><p> The length field refers to the length of the rIK in octets
        encoded as specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The cryptosuite and length of the rIK are part of the input to the
        key derivation function to ensure cryptographic separation of keys if
        different rIKs of different lengths for use with different Message
        Authentication Code (MAC) algorithms are derived from the same rRK.
        The cryptosuite is encoded as an 8-bit number; see <a class='info' href='#ReauthInit'>Section&nbsp;5.3.2<span> (</span><span class='info'>EAP-Initiate/Re-auth Packet</span><span>)</span></a> for the cryptosuite specification.
</p>
<p>The rIK is referred to by EMSKname-NAI within the context of ERP
        messages. The username part of EMSKname-NAI is the EMSKname; the realm
        is the domain name of the ER server. In case of ERP with the home ER
        server, the peer uses the realm from its original NAI; in case of a
        local ER server, the peer uses the domain name received at the lower
        layer or through an ERP bootstrapping exchange.
</p>
<p>An rIK derived from a DS-rRK is referred to as a DS-rIK in the rest
        of the document. All the key derivation and properties specified in
        this section remain the same.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
rIK Properties</h3>

<p>The rIK has the following properties. </p>
<ul class="text">
<li>The length of the rIK MUST be equal to the length of the
            rRK.
</li>
<li>The rIK is only used for authentication of the ERP exchange as
            specified in this document.
</li>
<li>The rIK MUST NOT be used to derive any other keys.
</li>
<li>The rIK must remain on the peer and the server and MUST NOT be
            transported to any other entity.
</li>
<li>The rIK is cryptographically separate from any other keys
            derived from the rRK.
</li>
<li>The lifetime of the rIK is never greater than that of its
            parent key. The rIK MUST be expired when the EMSK expires and MUST
            be removed from use at that time.
</li>
</ul>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
rIK Usage</h3>

<p>The rIK is the key whose possession is demonstrated by the peer and
        the ERP server to the other party. The peer demonstrates possession of
        the rIK by computing the integrity checksum over the
        EAP-Initiate/Re-auth message. When the peer uses the rIK for the first
        time, it can choose the integrity algorithm to use with the rIK. The
        peer and the server MUST use the same integrity algorithm with a given
        rIK for all ERP messages protected with that key. The peer and the
        server store the algorithm information after the first use, and they
        employ the same algorithm for all subsequent uses of that rIK.
</p>
<p>If the server's policy does not allow the use of the cryptosuite
        selected by the peer, the server SHALL reject the EAP-Initiate/Re-auth
        message and SHOULD send a list of acceptable cryptosuites in the
        EAP-Finish/Re-auth message.
</p>
<p>The rIK length may be different from the key length required by an
        integrity algorithm. In case of hash-based MAC algorithms, the key is
        first hashed to the required key length as specified in <a class='info' href='#RFC2104'>[RFC2104]<span> (</span><span class='info'>Krawczyk, H., Bellare, M., and R. Canetti, &ldquo;HMAC: Keyed-Hashing for Message Authentication,&rdquo; February&nbsp;1997.</span><span>)</span></a>. In case of cipher-based MAC algorithms, if
        the required key length is less than 32 octets, the rIK is hashed
        using HMAC-SHA256 and the first k octets of the output are used, where
        k is the key length required by the algorithm. If the required key
        length is more than 32 octets, the first k octets of the rIK are used
        by the cipher-based MAC algorithm.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
rMSK Derivation</h3>

<p>The rMSK is derived at the peer and server and delivered to the
        authenticator. The rMSK is derived following an EAP Re-auth Protocol
        exchange.
</p>
<p>The rMSK is derived as follows.
</p>
<p>rMSK = KDF (K, S), where</p>
<blockquote class="text">
<p>K = rRK and
</p>
<p>S = rMSK label | "\0" | SEQ | length
</p>
</blockquote>

<p>The rMSK label is the 8-bit ASCII string: </p>
<blockquote class="text">
<p>Re-authentication Master Session Key@ietf.org
</p>
</blockquote><p> The length field refers to the length of the rMSK in octets.
        The length field is encoded as specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<p>SEQ is the sequence number sent by the peer in the
        EAP-Initiate/Re-auth message. This field is encoded as a 16-bit number
        in network byte order (see <a class='info' href='#ReauthInit'>Section&nbsp;5.3.2<span> (</span><span class='info'>EAP-Initiate/Re-auth Packet</span><span>)</span></a>).
</p>
<p>An rMSK derived from a DS-rRK is referred to as a DS-rIK in the
        rest of the document. All the key derivation and properties specified
        in this section remain the same.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
rMSK Properties</h3>

<p>The rMSK has the following properties: </p>
<ul class="text">
<li>The length of the rMSK MUST be equal to the length of the
            rRK.
</li>
<li>The rMSK is delivered to the authenticator and is used for the
            same purposes that an MSK is used at an authenticator.
</li>
<li>The rMSK is cryptographically separate from any other keys
            derived from the rRK.
</li>
<li>The lifetime of the rMSK is less than or equal to that of the
            rRK. It MUST NOT be greater than the lifetime of the rRK.
</li>
<li>If a new rRK is derived, subsequent rMSKs MUST be derived from
            the new rRK. Previously delivered rMSKs MAY still be used until
            the expiry of the lifetime.
</li>
<li>A given rMSK MUST NOT be shared by multiple authenticators.
</li>
</ul>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Protocol Details</h3>

<a name="ERP-boot"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
ERP Bootstrapping</h3>

<p>We identify two types of bootstrapping for ERP: explicit and
        implicit bootstrapping. In implicit bootstrapping, the local AAA
        client or agent supporting EAP re-authentication SHOULD include its
        domain name and SHOULD request the DSRK from the home AAA server
        during the initial EAP exchange, in the AAA message encapsulating the
        first EAP Response message sent by the peer. If such EAP exchange is
        successful, the home EAP server sends the DSRK for the specified local
        AAA client or agent (derived using the EMSK and the domain name as
        specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>), EMSKname, and DSRK
        lifetime along with the EAP-Success message. The local AAA client or
        agent MUST extract the DSRK, EMSKname, and DSRK lifetime (if present)
        before forwarding the EAP-Success message to the peer, as specified in
        <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;Diameter Support for the EAP Re-authentication Protocol (ERP),&rdquo; September&nbsp;2010.</span><span>)</span></a>. Note that the MSK (also
        present along with the EAP Success message) is extracted by the EAP
        authenticator as usual. The peer learns the domain name through the
        EAP-Initiate/Re-auth-Start message, lower-layer announcements <a class='info' href='#I-D.ietf-hokey-ldn-discovery'>[I&#8209;D.ietf&#8209;hokey&#8209;ldn&#8209;discovery]<span> (</span><span class='info'>Zorn, G., Wu, Q., and Y. Wang, &ldquo;The Local Domain Name DHCPv6 Option,&rdquo; September&nbsp;2010.</span><span>)</span></a> or via ER Explicit
        bootstrapping exchange. When the domain name is available to the peer
        during or after the full EAP authentication, it attempts to use ERP
        when it associates with a new authenticator.
</p>
<p>If the peer does not know the domain name (did not receive the
        domain name through the EAP-Initiate/Re-auth-Start message or via the
        lower-layer announcement, due to a missed announcement or lack of
        support for domain name announcements in a specific lower layer), it
        SHOULD initiate Explicit ER bootstrap exchange (ERP exchange with the
        bootstrap flag turned on) with the ER server in the same (visited)
        domain as the peer to obtain the local domain name. The peer MAY also
        initiate bootstrapping to fetch information such as the rRK lifetime
        from the AAA server.
</p>
<p>The following steps describe the ERP explicit bootstrapping
        process: </p>
<ul class="text">
<li>The peer sends the EAP-Initiate/Re-auth message with the
            bootstrapping flag turned on. The bootstrap message is always sent
            to the ER server, and the keyname-NAI attribute in the bootstrap
            message is constructed as follows: the username portion of the NAI
            contains the EMSKname, and the realm portion contains the home
            domain name.
</li>
<li>In addition, the message MUST contain a sequence number for
            replay protection, a cryptosuite, and an integrity checksum. The
            cryptosuite indicates the authentication algorithm. The integrity
            checksum indicates that the message originated at the claimed
            entity, the peer indicated by the Peer-ID, or the rIKname.
</li>
<li>The peer MAY additionally set the lifetime flag to request the
            key lifetimes.
</li>
<li>When an ERP-capable authenticator receives the
            EAP-Initiate/Re-auth message from a peer, it copies the contents
            of the keyName-NAI into the User-Name attribute of RADIUS <a class='info' href='#RFC2865'>[RFC2865]<span> (</span><span class='info'>Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;Remote Authentication Dial In User Service (RADIUS),&rdquo; June&nbsp;2000.</span><span>)</span></a>. The rest of the process is similar to
            that described in <a class='info' href='#RFC3579'>[RFC3579]<span> (</span><span class='info'>Aboba, B. and P. Calhoun, &ldquo;RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP),&rdquo; September&nbsp;2003.</span><span>)</span></a>.
</li>
<li>Upon receipt of an EAP-Initiate/Re-auth message, the server
            verifies whether the message is fresh or is a replay by evaluating
            whether the received sequence number is equal to or greater than
            the expected sequence number for that rIK. The server then
            verifies to ensure that the cryptosuite used by the peer is
            acceptable. Next, it verifies the origin authentication of the
            message by looking up the rIK. If any of the checks fail, the
            server sends an EAP-Finish/Re-auth message with the Result flag
            set to '1'. Please refer to <a class='info' href='#fail'>Section&nbsp;5.2.2<span> (</span><span class='info'>ERP Failure Handling</span><span>)</span></a> for
            details on failure handling. This error MUST NOT have any
            correlation to any EAP-Success message that may have been received
            by the EAP authenticator and the peer earlier. If the
            EAP-Initiate/Re-auth message is well-formed and valid, the server
            prepares the EAP-Finish/Re-auth message. The bootstrap flag MUST
            be set to indicate that this is a bootstrapping exchange. The
            message contains the following fields: 
<ul class="text">
<li>A sequence number for replay protection.
</li>
<li>The same keyName-NAI as in the EAP-Initiate/Re-auth
                message.
</li>
<li>If the lifetime flag was set in the EAP-Initiate/Re-auth
                message, the ER server SHOULD include the rRK lifetime and the
                rMSK lifetime in the EAP-Finish/Re-auth message. The server
                may have a local policy for the network to maintain and
                enforce lifetime unilaterally. In such cases, the server need
                not respond to the peer's request for the lifetime.
</li>
<li>If the bootstrap flag is set, the ER server MUST include
                the domain name to which the DSRK is being sent along with the
                EAP-Finish/Re-auth message.
</li>
<li>If the ER server verifies the authorization of a local
                domain server, it MAY include the Authorization Indication TLV
                to indicate to the peer that the server (that received the
                DSRK and that is advertising the domain included in the domain
                name TLV) is authorized.
</li>
<li>An authentication tag MUST be included to prove that the
                EAP-Finish/Re-auth message originates at a server that
                possesses the rIK corresponding to the EMSKname-NAI.
</li>
</ul>
</li>
<li>If the ERP exchange is successful, the ER server SHOULD request
            the DSRK from the home EAP server during the initial EAP exchange
            as specified in <a class='info' href='#I-D.ietf-dime-local-keytran'>[I&#8209;D.ietf&#8209;dime&#8209;local&#8209;keytran]<span> (</span><span class='info'>, Q. and G. , &ldquo;Diameter Attribute-Value Pairs for Cryptographic Key           Transport,&rdquo; July&nbsp;2010.</span><span>)</span></a>, the home EAP server
            MUST include the DSRK for the local ER server (derived using the
            EMSK and the domain name as specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>), EMSKname, and DSRK lifetime along with
            the EAP-Finish/Re-auth message.
</li>
<li>In addition, the rMSK is sent along with the EAP-Finish/Re-auth
            message, in a AAA attribute <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;Diameter Support for the EAP Re-authentication Protocol (ERP),&rdquo; September&nbsp;2010.</span><span>)</span></a>.
</li>
<li>The ER server MUST extract the DSRK, EMSKname, and DSRK
            lifetime (if present) before forwarding the EAP-Success message to
            the peer, as specified in <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;Diameter Support for the EAP Re-authentication Protocol (ERP),&rdquo; September&nbsp;2010.</span><span>)</span></a>.
</li>
<li>The authenticator receives the rMSK.
</li>
<li>When the peer receives an EAP-Finish/Re-auth message with the
            bootstrap flag set, if a local domain name is present, it MUST use
            that to derive the appropriate DSRK, DS-rRK, DS-rIK, and
            keyName-NAI, and initialize the replay counter for the DS-rIK. If
            not, the peer SHOULD derive the domain-specific keys using the
            domain name it learned via the lower layer or from the
            EAP-Initiate/Re-auth-Start message. If the peer does not know the
            domain name, it must assume that there is no local ER server
            available.
</li>
<li>The peer MAY also verify the Authorization Indication TLV.
</li>
<li>The procedures for encapsulating the ERP and obtaining relevant
            keys using Diameter are specified in <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;Diameter Support for the EAP Re-authentication Protocol (ERP),&rdquo; September&nbsp;2010.</span><span>)</span></a>.
</li>
</ul>

<p>Since the ER bootstrapping exchange is typically done immediately
        following the full EAP exchange, it is feasible that the process is
        completed through the same entity that served as the EAP authenticator
        for the full EAP exchange. In this case, the lower layer may already
        have established TSKs based on the MSK received earlier. The lower
        layer may then choose to ignore the rMSK that was received with the ER
        bootstrapping exchange. Alternatively, the lower layer may choose to
        establish a new TSK using the rMSK. In either case, the authenticator
        and the peer know which key is used based on whether or not a TSK
        establishment exchange is initiated. The bootstrapping exchange may
        also be carried out via a new authenticator, in which case, the rMSK
        received SHOULD trigger a lower layer TSK establishment exchange.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Steps in ERP</h3>

<p>When a peer that has an active rRK and rIK associates with a new
        authenticator that supports ERP, it may perform an ERP exchange with
        that authenticator. ERP is typically a peer-initiated exchange,
        consisting of an EAP-Initiate/Re-auth and an EAP-Finish/Re-auth
        message. The ERP exchange may be performed with a local ER server
        (when one is present) or with the original EAP server.
</p>
<p>It is plausible for the network to trigger the EAP
        re-authentication process, however. An ERP-capable authenticator
        SHOULD send an EAP-Initiate/Re-auth-Start message to indicate support
        for ERP. The peer may or may not wait for these messages to arrive to
        initiate the EAP-Initiate/Re-auth message.
</p>
<p>The EAP-Initiate/Re-auth-Start message SHOULD be sent by an
        ERP-capable authenticator. The authenticator may retransmit it a few
        times until it receives an EAP-Initiate/Re-auth message in response
        from the peer. The EAP-Initiate/Re-auth message from the peer may have
        originated before the peer receives either an EAP-Request/Identity or
        an EAP-Initiate/Re-auth-Start message from the authenticator. Hence,
        the Identifier value in the EAP-Initiate/Re-auth message is
        independent of the Identifier value in the EAP-Initiate/Re-auth-Start
        or the EAP-Request/Identity messages.
</p>
<p>Operational Considerations at the Peer:
</p>
<p>ERP requires that the peer maintain retransmission timers for
        reliable transport of EAP re-authentication messages. The reliability
        considerations of Section 4.3 of RFC 3748 apply with the peer as the
        retransmitting entity.
</p>
<p>The EAP Re-auth Protocol has the following steps:</p>
<blockquote class="text">
<p>The peer sends an EAP-Initiate/Re-auth message. At a minimum,
            the message SHALL include the following fields: </p>
<blockquote class="text">
<p>a 16-bit sequence number for replay protection
</p>
<p>keyName-NAI as a TLV attribute to identify the rIK used to
                integrity protect the message.
</p>
<p>cryptosuite to indicate the authentication algorithm used
                to compute the integrity checksum.
</p>
<p>authentication tag over the message.
</p>
</blockquote>

<p>When the peer is performing ERP with a local ER server, it MUST
            use the corresponding DS-rIK it shares with the local ER server.
            The peer SHOULD set the lifetime flag to request the key lifetimes
            from the server. The peer can use the rRK lifetime to know when to
            trigger an EAP method exchange and the rMSK lifetime to know when
            to trigger another ERP exchange.
</p>
<p>The authenticator copies the contents of the value field of the
            keyName-NAI TLV into the User-Name RADIUS attribute in the AAA
            message to the ER server.
</p>
<p>The server uses the keyName-NAI to look up the rIK. It MUST
            first verify whether the sequence number is equal to or greater
            than the expected sequence number. If the server supports a
            sequence number window size greater than 1, it MUST verify whether
            the sequence number falls within the window and has not been
            received before. The server MUST then verify to ensure that the
            cryptosuite used by the peer is acceptable. The server then
            proceeds to verify the integrity of the message using the rIK,
            thereby verifying proof of possession of that key by the peer. If
            any of these verifications fail, the server MUST send an
            EAP-Finish/Re-auth message with the Result flag set to '1'
            (Failure). Please refer to <a class='info' href='#fail'>Section&nbsp;5.2.2<span> (</span><span class='info'>ERP Failure Handling</span><span>)</span></a> for details
            on failure handling. Otherwise, it MUST compute an rMSK from the
            rRK using the sequence number as the additional input to the key
            derivation.
</p>
<p>In response to a well-formed EAP Re-auth/Initiate message, the
            server MUST send an EAP-Finish/Re-auth message with the following
            considerations: </p>
<blockquote class="text">
<p>a 16-bit sequence number for replay protection, which MUST
                be the same as the received sequence number. The local copy of
                the sequence number MUST be incremented by 1. If the server
                supports multiple simultaneous ERP exchanges, it MUST instead
                update the sequence number window.
</p>
<p>keyName-NAI as a TLV attribute to identify the rIK used to
                integrity protect the message.
</p>
<p>cryptosuite to indicate the authentication algorithm used
                to compute the integrity checksum.
</p>
<p>authentication tag over the message.
</p>
<p>If the lifetime flag was set in the EAP-Initiate/Re-auth
                message, the ER server SHOULD include the rRK lifetime and the
                rMSK lifetime.
</p>
</blockquote>

<p>The server transports the rMSK along with this message to the
            authenticator. The rMSK is transported in a manner similar to the
            MSK transport along with the EAP-Success message in a regular EAP
            exchange.
</p>
<p>The peer looks up the sequence number to verify whether it is
            expecting an EAP-Finish/Re-auth message with that sequence number
            protected by the keyName-NAI. It then verifies the integrity of
            the message. If the verifications fail, the peer logs an error and
            stops the process; otherwise, it proceeds to the next step.
</p>
<p>The peer uses the sequence number to compute the rMSK.
</p>
<p>The lower-layer security association protocol can be triggered
            at this point.
</p>
</blockquote>

<a name="window"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Multiple Simultaneous Runs of ERP</h3>

<p>When a peer is within the range of multiple authenticators, it
          may choose to run ERP via all of them simultaneously to the same ER
          server. In that case, it is plausible that the ERP messages may
          arrive out of order, resulting in the ER server rejecting legitimate
          EAP-Initiate/Re-auth messages.
</p>
<p>To facilitate such operation, an ER server MAY allow multiple
          simultaneous ERP exchanges by accepting all EAP-Initiate/Re-auth
          messages with SEQ number values within a window of allowed values.
          Recall that the SEQ number allows replay protection. Replay window
          maintenance mechanisms are a local matter.
</p>
<a name="fail"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
ERP Failure Handling</h3>

<p>If the processing of the EAP-Initiate/Re-auth message results in
          a failure, the ER server MUST send an EAP-Finish Re-auth message
          with the Result flag set to '1'. If the server has a valid rIK for
          the peer, it MUST integrity protect the EAP-Finish/Re-auth failure
          message. If the failure is due to an unacceptable cryptosuite, the
          server SHOULD send a list of acceptable cryptosuites (in a TLV of
          Type 5) along with the EAP-Finish/Re-auth message. In this case, the
          server MUST indicate the cryptosuite used to protect the
          EAP-Finish/Re-auth message in the cryptosuite. The rIK used with the
          EAP-Finish/Re-auth message in this case MUST be computed as
          specified in <a class='info' href='#rIKderv'>Section&nbsp;4.3<span> (</span><span class='info'>rIK Derivation</span><span>)</span></a> using the new
          cryptosuite. If the server does not have a valid rIK for the peer,
          the EAP-Finish/Re-auth message indicating a failure will be
          unauthenticated; the server MAY include a list of acceptable
          cryptosuites in the message.
</p>
<p>The peer, upon receiving an EAP-Finish/Re-auth message with the
          Result flag set to '1', MUST verify the sequence number and the
          Authentication Tag to determine the validity of the message. If the
          peer supports the cryptosuite, it MUST verify the integrity of the
          received EAP-Finish/Re-auth message. If the EAP-Finish message
          contains a TLV of Type 5, the peer SHOULD retry the ERP exchange
          with a cryptosuite picked from the list included by the server. The
          peer MUST use the appropriate rIK for the subsequent ERP exchange,
          by computing it with the corresponding cryptosuite, as specified in
          <a class='info' href='#rIKderv'>Section&nbsp;4.3<span> (</span><span class='info'>rIK Derivation</span><span>)</span></a>. If the PRF in the chosen cryptosuite
          is different from the PRF originally used by the peer, it MUST
          derive a new DSRK (if required), rRK, and rIK before proceeding with
          the subsequent ERP exchange.
</p>
<p>If the peer cannot verify the integrity of the received message,
          it MAY choose to retry the ERP exchange with one of the cryptosuites
          in the TLV of Type 5, after a failure has been clearly determined
          following the procedure in the next paragraph.
</p>
<p>If the replay or integrity checks fail, the failure message may
          have been sent by an attacker. It may also imply that the server and
          peer do not support the same cryptosuites; however, the peer cannot
          determine if that is the case. Hence, the peer SHOULD continue the
          ERP exchange per the retransmission timers before declaring a
          failure.
</p>
<p>When the peer runs explicit bootstrapping (ERP with the
          bootstrapping flag on), there may not be a local ER server available
          to send a DSRK Request and the domain name. In that case, the server
          cannot send the DSRK and MUST NOT include the domain name TLV. When
          the peer receives a response in the bootstrapping exchange without a
          domain name TLV, it assumes that there is no local ER server. The
          home ER server sends an rMSK to the ER authenticator, however, and
          the peer SHALL run the TSK establishment protocol as usual.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
New EAP Packets</h3>

<p>Two new EAP Codes are defined for the purpose of ERP: EAP-Initiate
        and EAP-Finish. The packet format for these messages follows the EAP
        packet format defined in RFC 3748 <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>.
        <br /><hr class="insert" />
<a name="ReauthPkt"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |  Type-Data ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: EAP Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text">
<p>Code </p>
<blockquote class="text">
<p>5 Initiate
</p>
<p>6 Finish
</p>
<p>Two new code values are defined for the purpose of ERP.
</p>
</blockquote>

<p>Identifier </p>
<blockquote class="text">
<p>The Identifier field is one octet. The Identifier field
                MUST be the same if an EAP-Initiate packet is retransmitted
                due to a timeout while waiting for a Finish message. Any new
                (non-retransmission) Initiate message MUST use a new
                Identifier field.
</p>
<p>The Identifier field of the Finish message MUST match that
                of the currently outstanding Initiate message. A peer or
                authenticator receiving a Finish message whose Identifier
                value does not match that of the currently outstanding
                Initiate message MUST silently discard the packet.
</p>
<p>In order to avoid confusion between new EAP-Initiate
                messages and retransmissions, the peer must choose an
                Identifier value that is different from the previous
                EAP-Initiate message, especially if that exchange has not
                finished. It is RECOMMENDED that the authenticator clear EAP
                Re-auth state after 300 seconds.
</p>
</blockquote>

<p>Type </p>
<blockquote class="text">
<p>This field indicates that this is an ERP exchange. Two type
                values are defined in this document for this purpose --
                Re-auth-Start (assigned Type 1) and Re-auth (assigned Type
                2).
</p>
</blockquote>

<p>Type-Data </p>
<blockquote class="text">
<p>The Type-Data field varies with the Type of
                re-authentication packet.
</p>
</blockquote>

</blockquote>

<a name="Re-auth-Start"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
EAP-Initiate/Re-auth-Start Packet</h3>

<p>The EAP-Initiate/Re-auth-Start packet contains the parameters
          shown in <a class='info' href='#Re-auth-StartPkt'>Figure&nbsp;8<span> (</span><span class='info'>EAP-Initiate/Re-auth-Start Packet</span><span>)</span></a>. <br /><hr class="insert" />
<a name="Re-auth-StartPkt"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |   Reserved    |     1 or more TVs or TLVs     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: EAP-Initiate/Re-auth-Start Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = 1.
</dd>
<dt></dt>
<dd>Reserved, MUST be zero. Set to zero on transmission and
              ignored on reception.
</dd>
<dt></dt>
<dd>One or more TVs or TLVs are used to convey information to the
              peer; for instance, the authenticator may send the domain name
              to the peer.
</dd>
<dt></dt>
<dd>TVs or TLVs: In the TV payloads, there is a 1-octet type
              payload and a value with type-specific length. In the TLV
              payloads, there is a 1-octet type payload and a 1-octet length
              payload. The length field indicates the length of the value
              expressed in number of octets. 
<blockquote class="text"><dl>
<dt></dt>
<dd>Domain-Name: This is a TLV payload. The Type is 4. The
                  domain name is to be used as the realm in an NAI <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>. The Domain-Name attribute SHOULD
                  be present in an EAP-Initiate/Re-auth-Start message.
</dd>
<dt></dt>
<dd>In addition, channel binding information MAY be included;
                  see <a class='info' href='#CB'>Section&nbsp;5.5<span> (</span><span class='info'>Channel Binding</span><span>)</span></a> for discussion. See <a class='info' href='#TLV'>Figure&nbsp;12<span> (</span><span class='info'>TLV Attribute Format</span><span>)</span></a> for parameter specification.
</dd>
</dl></blockquote>
</dd>
</dl></blockquote>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1.1"></a><h3>5.3.1.1.&nbsp;
Authenticator Operation</h3>

<p>The authenticator MAY send the EAP-Initiate/Re-auth-Start
            message to indicate support for ERP to the peer and to initiate
            ERP if the peer has already performed full EAP authentication and
            has unexpired key material. The authenticator SHOULD include the
            domain name TLV to allow the peer to learn it without lower-layer
            support or the ERP bootstrapping exchange.
</p>
<p>The authenticator MAY include channel binding information so
            that the peer can send the information to the server in the
            EAP-Initiate/Re-auth message so that the server can verify whether
            the authenticator is claiming the same identity to both
            parties.
</p>
<p>The authenticator MAY re-transmit the
            EAP-Initiate/Re-auth-Start message a few times for reliable
            transport.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1.2"></a><h3>5.3.1.2.&nbsp;
Peer Operation</h3>

<p>The peer SHOULD send the EAP-Initiate/Re-auth message in
            response to the EAP-Initiate/Re-auth-Start message from the
            authenticator. If the peer does not recognize the Initiate code
            value, it silently discards the message. If the peer has already
            sent the EAP-Initiate/Re-auth message to begin the ERP exchange,
            it silently discards the message.
</p>
<p>If the EAP-Initiate/Re-auth-Start message contains the domain
            name, and if the peer does not already have the domain
            information, the peer SHOULD use the domain name to compute the
            DSRK and use the corresponding DS-rIK to send an
            EAP-Initiate/Re-auth message to start an ERP exchange with the
            local ER server. If there are the local ER server between the peer
            and the home ER server and the peer has already initiated an ERP
            exchange with the local ER server, it SHOULD choose to not start
            an ERP exchange with the home ER server.
</p>
<a name="ReauthInit"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
EAP-Initiate/Re-auth Packet</h3>

<p>The EAP-Initiate/Re-auth packet contains the parameters shown in
          <a class='info' href='#ReauthInitPkt'>Figure&nbsp;9<span> (</span><span class='info'>EAP-Initiate/Re-auth Packet</span><span>)</span></a>. <br /><hr class="insert" />
<a name="ReauthInitPkt"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|B|L| Reserved|             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| cryptosuite  |        Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: EAP-Initiate/Re-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = 2.
</dd>
<dt></dt>
<dd>Flags 
<blockquote class="text"><dl>
<dt></dt>
<dd>'R' - The R flag is set to 0 and ignored upon
                  reception.
</dd>
<dt></dt>
<dd>'B' - The B flag is used as the bootstrapping flag. If
                  the flag is turned on, the message is a bootstrap
                  message.
</dd>
<dt></dt>
<dd>'L' - The L flag is used to request the key lifetimes
                  from the server.
</dd>
<dt></dt>
<dd>The rest of the 5 bits are set to 0 and ignored on
                  reception.
</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>SEQ: A 16-bit sequence number is used for replay protection.
              The SEQ number field is initialized to 0 every time a new rRK is
              derived.
</dd>
<dt></dt>
<dd>TVs or TLVs: In the TV payloads, there is a 1-octet type
              payload and a value with type-specific length. In the TLV
              payloads, there is a 1-octet type payload and a 1-octet length
              payload. The length field indicates the length of the value
              expressed in number of octets. 
<blockquote class="text"><dl>
<dt></dt>
<dd>keyName-NAI: This is carried in a TLV payload. The Type
                  is 1. The NAI is variable in length, not exceeding 253
                  octets. The EMSKname is in the username part of the NAI and
                  is encoded in hexadecimal values. The EMSKname is 64 bits in
                  length and so the username portion takes up 128 octets. If
                  the rIK is derived from the EMSK, the realm part of the NAI
                  is the home domain name, and if the rIK is derived from a
                  DSRK, the realm part of the NAI is the domain name used in
                  the derivation of the DSRK. The NAI syntax follows <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>. Exactly one keyName-NAI attribute
                  SHALL be present in an EAP-Initiate/Re-auth packet.
</dd>
</dl></blockquote> 
<blockquote class="text"><dl>
<dt></dt>
<dd>In addition, channel binding information MAY be included;
                  see <a class='info' href='#CB'>Section&nbsp;5.5<span> (</span><span class='info'>Channel Binding</span><span>)</span></a> for discussion. See <a class='info' href='#TLV'>Figure&nbsp;12<span> (</span><span class='info'>TLV Attribute Format</span><span>)</span></a> for parameter specification.
</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>Cryptosuite: This field indicates the integrity algorithm
              used for ERP. Key lengths and output lengths are either
              indicated or are obvious from the cryptosuite name. We specify
              some cryptosuites below: 
<ul class="text">
<li>0 RESERVED
</li>
<li>1 HMAC-SHA256-64
</li>
<li>2 HMAC-SHA256-128
</li>
<li>3 HMAC-SHA256-256
</li>
</ul> HMAC-SHA256-128 is mandatory to implement and should
              be enabled in the default configuration.
</dd>
<dt></dt>
<dd>Authentication Tag: This field contains the integrity
              checksum over the ERP packet, excluding the authentication tag
              field itself. The length of the field is indicated by the
              Cryptosuite.
</dd>
</dl></blockquote>

<a name="ReauthFin"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3"></a><h3>5.3.3.&nbsp;
EAP-Finish/Re-auth Packet</h3>

<p>The EAP-Finish/Re-auth packet contains the parameters shown in
          <a class='info' href='#ReauthInfPkt'>Figure&nbsp;10<span> (</span><span class='info'>EAP-Finish/Re-auth Packet</span><span>)</span></a>. <br /><hr class="insert" />
<a name="ReauthInfPkt"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|B|L| Reserved |             SEQ               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| cryptosuite  |        Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: EAP-Finish/Re-auth Packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Type = 2.
</dd>
<dt></dt>
<dd>Flags 
<blockquote class="text"><dl>
<dt></dt>
<dd>'R' - The R flag is used as the Result flag. When set to
                  0, it indicates success, and when set to '1', it indicates a
                  failure.
</dd>
<dt></dt>
<dd>'B' - The B flag is used as the bootstrapping flag. If
                  the flag is turned on, the message is a bootstrap
                  message.
</dd>
<dt></dt>
<dd>'L' - The L flag is used to indicate the presence of the
                  rRK lifetime TLV.
</dd>
<dt></dt>
<dd>The rest of the 5 bits are set to 0 and ignored on
                  reception.
</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>SEQ: A 16-bit sequence number is used for replay protection.
              The SEQ number field is initialized to 0 every time a new rRK is
              derived.
</dd>
<dt></dt>
<dd>TVs or TLVs: In the TV payloads, there is a 1-octet type
              payload and a value with type-specific length. In the TLV
              payloads, there is a 1-octet type payload and a 1-octet length
              payload. The length field indicates the length of the value
              expressed in number of octets. 
<blockquote class="text"><dl>
<dt></dt>
<dd>keyName-NAI: This is carried in a TLV payload. The Type
                  is 1. The NAI is variable in length, not exceeding 253
                  octets. EMSKname is in the username part of the NAI and is
                  encoded in hexadecimal values. The EMSKname is 64 bits in
                  length and so the username portion takes up 16 octets. If
                  the rIK is derived from the EMSK, the realm part of the NAI
                  is the home domain name, and if the rIK is derived from a
                  DSRK, the realm part of the NAI is the domain name used in
                  the derivation of the DSRK. The NAI syntax follows <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>. Exactly one instance of the
                  keyName-NAI attribute SHALL be present in an
                  EAP-Finish/Re-auth message.
</dd>
<dt></dt>
<dd>rRK Lifetime: This is a TV payload. The Type is 2. The
                  value field is a 32-bit field and contains the lifetime of
                  the rRK in seconds. If the 'L' flag is set, the rRK Lifetime
                  attribute SHOULD be present.
</dd>
<dt></dt>
<dd>rMSK Lifetime: This is a TV payload. The Type is 3. The
                  value field is a 32-bit field and contains the lifetime of
                  the rMSK in seconds. If the 'L' flag is set, the rMSK
                  Lifetime attribute SHOULD be present.
</dd>
<dt></dt>
<dd>Domain-Name: This is a TLV payload. The Type is 4. The
                  domain name is to be used as the realm in an NAI <a class='info' href='#RFC4282'>[RFC4282]<span> (</span><span class='info'>Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;The Network Access Identifier,&rdquo; December&nbsp;2005.</span><span>)</span></a>. Domain-Name attribute MUST be
                  present in an EAP-Finish/Re-auth message if the
                  bootstrapping flag is set and if the local ER server sent a
                  DSRK request.
</dd>
<dt></dt>
<dd>List of cryptosuites: This is a TLV payload. The Type is
                  5. The value field contains a list of cryptosuites, each of
                  size 1 octet. The cryptosuite values are as specified in
                  <a class='info' href='#ReauthInitPkt'>Figure&nbsp;9<span> (</span><span class='info'>EAP-Initiate/Re-auth Packet</span><span>)</span></a>. The server SHOULD
                  include this attribute if the cryptosuite used in the
                  EAP-Initiate/Re-auth message was not acceptable and the
                  message is being rejected. The server MAY include this
                  attribute in other cases. The server MAY use this attribute
                  to signal to the peer about its cryptographic algorithm
                  capabilities.
</dd>
<dt></dt>
<dd>Authorization Indication: This is a TLV payload. The Type
                  is 6. This attribute MAY be included in the
                  EAP-Finish/Re-auth message when a DSRK is delivered to a
                  local ER server and if the home EAP server can verify the
                  authorization of the local ER server to advertise the domain
                  name included in the domain TLV in the same message. The
                  value field in the TLV contains an authentication tag
                  computed over the entire packet, starting from the first bit
                  of the code field to the last bit of the cryptosuite field,
                  with the value field of the Authorization Indication TLV
                  filled with all 0s for the computation. The key used for the
                  computation MUST be derived from the EMSK with key label
                  "DSRK Delivery Authorized Key@ietf.org" and optional data
                  containing an ASCII string representing the key management
                  domain that the DSRK is being derived for.
</dd>
</dl></blockquote> 
<blockquote class="text"><dl>
<dt></dt>
<dd>In addition, channel binding information MAY be included:
                  see <a class='info' href='#CB'>Section&nbsp;5.5<span> (</span><span class='info'>Channel Binding</span><span>)</span></a> for discussion. See <a class='info' href='#TLV'>Figure&nbsp;12<span> (</span><span class='info'>TLV Attribute Format</span><span>)</span></a> for parameter specification. The server
                  sends this information so that the peer can verify the
                  information seen at the lower layer, if channel binding is
                  to be supported.
</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>Cryptosuite: This field indicates the integrity algorithm and
              the PRF used for ERP. Key lengths and output lengths are either
              indicated or are obvious from the cryptosuite name.
</dd>
<dt></dt>
<dd>Authentication Tag: This field contains the integrity
              checksum over the ERP packet, excluding the authentication tag
              field itself. The length of the field is indicated by the
              Cryptosuite.
</dd>
</dl></blockquote>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4"></a><h3>5.3.4.&nbsp;
TV and TLV Attributes</h3>

<p>The TV attributes that may be present in the EAP-Initiate or
          EAP-Finish messages are of the following format: <br /><hr class="insert" />
<a name="TV"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |              Value ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: TV Attribute Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The TLV attributes that may be present in the EAP-Initiate or
          EAP-Finish messages are of the following format: <br /><hr class="insert" />
<a name="TLV"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |    Length     |            Value ...
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: TLV Attribute Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The following Types are defined in this document:
</p>
<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>'1' - keyName-NAI: This is a TLV payload.
</dd>
<dt></dt>
<dd>'2' - rRK Lifetime: This is a TV payload.
</dd>
<dt></dt>
<dd>'3' - rMSK Lifetime: This is a TV payload.
</dd>
<dt></dt>
<dd>'4' - domain name: This is a TLV payload.
</dd>
<dt></dt>
<dd>'5' - cryptosuite list: This is a TLV payload.
</dd>
<dt></dt>
<dd>'6' - Authorization Indication: This is a TLV payload.
</dd>
<dt></dt>
<dd>The TLV type range of 128-191 is reserved to carry channel
              binding information in the EAP-Initiate and Finish/Re-auth
              messages. Below are the current assignments (all of them are
              TLVs): 
<blockquote class="text"><dl>
<dt></dt>
<dd>'128' - Called-Station-Id <a class='info' href='#RFC2865'>[RFC2865]<span> (</span><span class='info'>Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;Remote Authentication Dial In User Service (RADIUS),&rdquo; June&nbsp;2000.</span><span>)</span></a>
</dd>
<dt></dt>
<dd>'129' - Calling-Station-Id <a class='info' href='#RFC2865'>[RFC2865]<span> (</span><span class='info'>Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;Remote Authentication Dial In User Service (RADIUS),&rdquo; June&nbsp;2000.</span><span>)</span></a>
</dd>
<dt></dt>
<dd>'130' - NAS-Identifier <a class='info' href='#RFC2865'>[RFC2865]<span> (</span><span class='info'>Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;Remote Authentication Dial In User Service (RADIUS),&rdquo; June&nbsp;2000.</span><span>)</span></a>
</dd>
<dt></dt>
<dd>'131' - NAS-IP-Address <a class='info' href='#RFC2865'>[RFC2865]<span> (</span><span class='info'>Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;Remote Authentication Dial In User Service (RADIUS),&rdquo; June&nbsp;2000.</span><span>)</span></a>
</dd>
<dt></dt>
<dd>'132' - NAS-IPv6-Address <a class='info' href='#RFC3162'>[RFC3162]<span> (</span><span class='info'>Aboba, B., Zorn, G., and D. Mitton, &ldquo;RADIUS and IPv6,&rdquo; August&nbsp;2001.</span><span>)</span></a>
</dd>
</dl></blockquote>
</dd>
</dl></blockquote>

<p>The length field indicates the length of the value part of the
          attribute in octets.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Replay Protection</h3>

<p>For replay protection, ERP uses sequence numbers. The sequence
        number is maintained per rIK and is initialized to zero in both
        directions. In the first EAP-Initiate/Re-auth message, the peer uses
        the sequence number zero or higher. Note that the when the sequence
        number rotates, the rIK MUST be changed by running EAP authentication.
        The server expects a sequence number of zero or higher. When the
        server receives an EAP-Initiate/Re-auth message, it uses the same
        sequence number in the EAP-Finish/Re-auth message. The server then
        sets the expected sequence number to the received sequence number plus
        1. The server accepts sequence numbers greater than or equal to the
        expected sequence number.
</p>
<p>If the peer sends an EAP-Initiate/Re-auth message, but does not
        receive a response, it retransmits the request (with no changes to the
        message itself) a pre-configured number of times before giving up.
        However, it is plausible that the server itself may have responded to
        the message and it was lost in transit. Thus, the peer MUST increment
        the sequence number and use the new sequence number to send subsequent
        EAP re-authentication messages. The peer SHOULD increment the sequence
        number by 1; however, it may choose to increment by a larger number.
        When the sequence number rotates, the peer MUST run full EAP
        authentication.
</p>
<a name="CB"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Channel Binding</h3>

<p>ERP provides a protected facility to carry channel binding (CB)
        information, according to the guidelines in Section 7.15 of <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>. The TLV type range of 128-191 is reserved to
        carry CB information in the EAP-Initiate/Re-auth and
        EAP-Finish/Re-auth messages. Called-Station-Id, Calling-Station-Id,
        NAS-Identifier, NAS-IP-Address, and NAS-IPv6-Address are some examples
        of channel binding information listed in RFC 3748, and they are
        assigned values 128-132. Additional values are IANA managed based on
        IETF Consensus <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The authenticator MAY provide CB information to the peer via the
        EAP-Initiate/Re-auth-Start message. The peer sends the information to
        the server in the EAP-Initiate/Re-auth message; the server verifies
        whether the authenticator identity available via AAA attributes is the
        same as the identity provided to the peer.
</p>
<p>If the peer does not include the CB information in the
        EAP-Initiate/Re-auth message, and if the local ER server's policy
        requires channel binding support, it SHALL send the CB attributes for
        the peer's verification. The peer attempts to verify the CB
        information if the authenticator has sent the CB parameters, and it
        proceeds with the lower-layer security association establishment if
        the attributes match. Otherwise, the peer SHALL NOT proceed with the
        lower-layer security association establishment.
</p>
<a name="lowerlayer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Lower-Layer Considerations</h3>

<p>The authenticator is responsible for retransmission of
      EAP-Initiate/Re-auth-Start messages. The authenticator MAY retransmit
      the message a few times or until it receives an EAP-Initiate/Re-auth
      message from the peer. The authenticator may not know whether the peer
      supports ERP; in those cases, the peer may be silently dropping the
      EAP-Initiate/Re-auth-Start packets. Thus, retransmission of these
      packets should be kept to a minimum. The exact number is up to each
      lower layer.
</p>
<p>The Identifier value in the EAP-Initiate/Re-auth packet is
      independent of the Identifier value in the EAP-Initiate/Re-auth-Start
      packet.
</p>
<p>The peer is responsible for retransmission of EAP-Initiate/Re-auth
      messages.
</p>
<p>Retransmitted packets MUST be sent with the same Identifier value in
      order to distinguish them from new packets. By default, where the
      EAP-Initiate message is sent over an unreliable lower layer, the
      retransmission timer SHOULD be dynamically estimated. A maximum of 3-5
      retransmissions is suggested (this is based on the recommendation of
      <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a>). Where the EAP-Initiate message is sent
      over a reliable lower layer, the retransmission timer SHOULD be set to
      an infinite value, so that retransmissions do not occur at the EAP
      layer. Please refer to RFC 3748 <a class='info' href='#RFC3748'>[RFC3748]<span> (</span><span class='info'>Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;Extensible Authentication Protocol (EAP),&rdquo; June&nbsp;2004.</span><span>)</span></a> for
      additional guidance on setting timers.
</p>
<p>The Identifier value in the EAP-Finish/Re-auth packet is the same as
      the Identifier value in the EAP-Initiate/Re-auth packet.
</p>
<p>If an authenticator receives a valid duplicate EAP-Initiate/Re-auth
      message for which it has already sent an EAP-Finish/Re-auth message, it
      MUST resend the EAP-Finish/Re-auth message without reprocessing the
      EAP-Initiate/Re-auth message. To facilitate this, the authenticator
      SHALL store a copy of the EAP-Finish/Re-auth message for a finite amount
      of time. The actual value of time is a local matter; this specification
      recommends a value of 100 milliseconds.
</p>
<p>The lower layer may provide facilities for exchanging information
      between the peer and the authenticator about support for ERP, for the
      authenticator to send the domain name information and channel binding
      information to the peer
</p>
<p>Note that to support ERP, lower-layer specifications may need to be
      revised. Specifically, the IEEE802.1x specification must be revised to
      allow carrying EAP messages of the new codes defined in this document in
      order to support ERP. Similarly, RFC 4306 must be updated to include EAP
      code values higher than 4 in order to use ERP with Internet Key Exchange
      Protocol version 2 (IKEv2). IKEv2 may also be updated to support
      peer-initiated ERP for optimized operation. Other lower layers may need
      similar revisions.
</p>
<p>Our analysis indicates that some EAP implementations are not RFC 3748
      compliant in that instead of silently dropping EAP packets with code
      values higher than 4, they may consider it an error. To accommodate such
      non-compliant EAP implementations, additional guidance has been provided
      below. Furthermore, it may not be easy to upgrade all the peers in some
      cases. In such cases, authenticators may be configured to not send
      EAP-Initiate/Re-auth-Start; peers may learn whether an authenticator
      supports ERP via configuration, from advertisements at the lower
      layer.
</p>
<p>In order to accommodate implementations that are not compliant to RFC
      3748, such lower layers SHOULD ensure that both parties support ERP;
      this is trivial for an instance when using a lower layer that is known
      to always support ERP. For lower layers where ERP support is not
      guaranteed, ERP support may be indicated through signaling (e.g.,
      piggy-backed on a beacon) or through negotiation. Alternatively, clients
      may recognize environments where ERP is available based on
      pre-configuration. Other similar mechanisms may also be used. When ERP
      support cannot be verified, lower layers may mandate falling back to
      full EAP authentication to accommodate EAP implementations that are not
      compliant to RFC 3748.
</p>
<a name="AAA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Transport of ERP Messages</h3>

<p>AAA Transport of ERP messages is specified in <a class='info' href='#RFC5749'>[RFC5749]<span> (</span><span class='info'>Hoeper, K., Nakhjiri, M., and Y. Ohba, &ldquo;Distribution of EAP-Based Keys for Handover and Re-Authentication,&rdquo; March&nbsp;2010.</span><span>)</span></a> and <a class='info' href='#I-D.ietf-dime-erp'>[I&#8209;D.ietf&#8209;dime&#8209;erp]<span> (</span><span class='info'>Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;Diameter Support for the EAP Re-authentication Protocol (ERP),&rdquo; September&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="SecCons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>This section provides an analysis of the protocol in accordance with
      the AAA key management requirements specified in <a class='info' href='#RFC4962'>[RFC4962]<span> (</span><span class='info'>Housley, R. and B. Aboba, &ldquo;Guidance for Authentication, Authorization, and Accounting (AAA) Key Management,&rdquo; July&nbsp;2007.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text">
<p>Cryptographic algorithm independence </p>
<blockquote class="text">
<p>The EAP Re-auth Protocol satisfies this requirement. The
              algorithm chosen by the peer for the MAC generation is indicated
              in the EAP-Initiate/Re-auth message. If the chosen algorithm is
              unacceptable, the EAP server returns an EAP-Finish/Re-auth
              message with Failure indication. Algorithm agility for the KDF
              is specified in <a class='info' href='#RFC5295'>[RFC5295]<span> (</span><span class='info'>Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK),&rdquo; August&nbsp;2008.</span><span>)</span></a>. Only when the
              algorithms used are acceptable, the server proceeds with
              derivation of keys and verification of the proof of possession
              of relevant keying material by the peer. A full-blown
              negotiation of algorithms cannot be provided in a single round
              trip protocol. Hence, while the protocol provides algorithm
              agility, it does not provide true negotiation.
</p>
</blockquote>

<p>Strong, fresh session keys </p>
<blockquote class="text">
<p>ERP results in the derivation of strong, fresh keys that are
              unique for the given session. An rMSK is always derived
              on-demand when the peer requires a key with a new authenticator.
              The derivation ensures that the compromise of one rMSK does not
              result in the compromise of a different rMSK at any time.
</p>
</blockquote>

<p>Limit key scope </p>
<blockquote class="text">
<p>The scope of all the keys derived by ERP is well defined. The
              rRK and rIK are never shared with any entity and always remain
              on the peer and the server. The rMSK is provided only to the
              authenticator through which the peer performs the ERP exchange.
              No other authenticator is authorized to use that rMSK.
</p>
</blockquote>

<p>Replay detection mechanism </p>
<blockquote class="text">
<p>For replay protection of ERP messages, a sequence number
              associated with the rIK is used. The sequence number is
              maintained by the peer and the server, and initialized to zero
              when the rIK is generated. The peer increments the sequence
              number by one after it sends an ERP message. The server sets the
              expected sequence number to the received sequence number plus
              one after verifying the validity of the received message and
              responds to the message.
</p>
</blockquote>

<p>Authenticate all parties </p>
<blockquote class="text">
<p>The EAP Re-auth Protocol provides mutual authentication of
              the peer and the server. Both parties need to possess the keying
              material that resulted from a previous EAP exchange in order to
              successfully derive the required keys. Also, both the EAP
              re-authentication Response and the EAP re-authentication
              Information messages are integrity protected so that the peer
              and the server can verify each other. When the ERP exchange is
              executed with a local ER server, the peer and the local server
              mutually authenticate each other via that exchange in the same
              manner. The peer and the authenticator authenticate each other
              in the secure association protocol executed by the lower layer,
              just as in the case of a regular EAP exchange.
</p>
</blockquote>

<p>Peer and authenticator authorization </p>
<blockquote class="text">
<p>The peer and authenticator demonstrate possession of the same
              key material without disclosing it, as part of the lower-layer
              secure association protocol. Channel binding with ERP may be
              used to verify consistency of the identities exchanged, when the
              identities used in the lower layer differ from that exchanged
              within the AAA protocol.
</p>
</blockquote>

<p>Keying material confidentiality </p>
<blockquote class="text">
<p>The peer and the server derive the keys independently using
              parameters known to each entity. The AAA server sends the DSRK
              of a domain to the corresponding local ER server via the AAA
              protocol. Likewise, the ER server sends the rMSK to the
              authenticator via the AAA protocol.
</p>
<p>Note that compromise of the DSRK results in compromise of all
              keys derived from it. Moreover, there is no forward secrecy
              within ERP. Thus, compromise of an DSRK retroactively
              compromises all ERP keys.
</p>
<p>It is RECOMMENDED that the AAA protocol be protected using
              IPsec or TLS so that the keys are protected in transit. Note,
              however, that keys may be exposed to AAA proxies along the way
              and compromise of any of those proxies may result in compromise
              of keys being transported through them.
</p>
<p>The home EAP server MUST NOT hand out a given DSRK to a local
              domain server more than once, unless it can verify that the
              entity receiving the DSRK after the first time is the same as
              that received the DSRK originally. If the home EAP server
              verifies authorization of a local domain server, it MAY hand out
              the DSRK to that domain more than once. In this case, the home
              EAP server includes the Authorization Indication TLV to assure
              the peer that DSRK delivery is secure.
</p>
</blockquote>

<p>Confirm cryptosuite selection </p>
<blockquote class="text">
<p>Crypto algorithms for integrity and key derivation in the
              context of ERP MAY be the same as that used by the EAP method.
              In that case, the EAP method is responsible for confirming the
              cryptosuite selection. Furthermore, the cryptosuite is included
              in the ERP exchange by the peer and confirmed by the server. The
              protocol allows the server to reject the cryptosuite selected by
              the peer and provide alternatives. When a suitable rIK is not
              available for the peer, the alternatives may be sent in an
              unprotected fashion. The peer is allowed to retry the exchange
              using one of the allowed cryptosuites. However, in this case,
              any en route modifications to the list sent by the server will
              go undetected. If the server does have an rIK available for the
              peer, the list will be provided in a protected manner and this
              issue does not apply.
</p>
</blockquote>

<p>Uniquely named keys </p>
<blockquote class="text">
<p>All keys produced within the ERP context can be referred to
              uniquely as specified in this document. Also, the key names do
              not reveal any part of the keying material.
</p>
</blockquote>

<p>Prevent the domino effect </p>
<blockquote class="text">
<p>The compromise of one peer does not result in the compromise
              of keying material held by any other peer in the system. Also,
              the rMSK is meant for a single authenticator and is not shared
              with any other authenticator. Hence, the compromise of one
              authenticator does not lead to the compromise of sessions or
              keys held by any other authenticator in the system. Hence, the
              EAP Re-auth Protocol allows prevention of the domino effect by
              appropriately defining key scope.
</p>
<p>However, if keys are transported using hop-by-hop protection,
              compromise of a proxy may result in compromise of key material,
              i.e., the DSRK being sent to a local ER server.
</p>
</blockquote>

<p>Bind key to its context </p>
<blockquote class="text">
<p>All the keys derived for ERP are bound to the appropriate
              context using appropriate key labels. Lifetime of a child key is
              less than or equal to that of its parent key as specified in RFC
              4962 <a class='info' href='#RFC4962'>[RFC4962]<span> (</span><span class='info'>Housley, R. and B. Aboba, &ldquo;Guidance for Authentication, Authorization, and Accounting (AAA) Key Management,&rdquo; July&nbsp;2007.</span><span>)</span></a>. The key usage, lifetime and
              the parties that have access to the keys are specified.
</p>
</blockquote>

<p>Confidentiality of identity </p>
<blockquote class="text">
<p>Deployments where privacy is a concern may find the use of
              rIKname-NAI to route ERP messages serves their privacy
              requirements. Note that it is plausible to associate multiple
              runs of ERP messages since the rIKname is not changed as part of
              the ERP protocol. There was no consensus for that requirement at
              the time of development of this specification. If the rIKname is
              not used and the Peer-ID is used instead, the ERP exchange will
              reveal the Peer-ID over the wire.
</p>
</blockquote>

<p>Authorization restriction </p>
<blockquote class="text">
<p>All the keys derived are limited in lifetime by that of the
              parent key or by server policy. Any domain-specific keys are
              further restricted for use only in the domain for which the keys
              are derived. All the keys specified in this document are meant
              for use in ERP only. Any other restrictions of session keys may
              be imposed by the specific lower layer and are out of scope for
              this specification.
</p>
</blockquote>

</blockquote>

<p>A denial-of-service (DoS) attack on the peer may be possible when
      using the EAP Initiate/Re-auth message. An attacker may send a bogus
      EAP-Initiate/Re-auth message, which may be carried by the authenticator
      in a RADIUS-Access-Request to the server; in response, the server may
      send an EAP-Finish/Re-auth with Failure indication in a RADIUS
      Access-Reject message. Note that such attacks may be plausible with the
      EAPoL-Start capability of IEEE 802.11 and other similar facilities in
      other link layers and where the peer can initiate EAP authentication. An
      attacker may use such messages to start an EAP method run, which fails
      and may result in the server sending a RADIUS Access-Reject message,
      thus resulting in the link-layer connections being terminated.
</p>
<p>To prevent such DoS attacks, an ERP failure should not result in
      deletion of any authorization state established by a full EAP exchange.
      Alternatively, the lower layers and AAA protocols may define mechanisms
      to allow two link-layer security associations (SAs) derived from
      different EAP keying materials for the same peer to exist so that smooth
      migration from the current link layer SA to the new one is possible
      during rekey. These mechanisms prevent the link layer connections from
      being terminated when a re-authentication procedure fails due to the
      bogus EAP-Initiate/Re-auth message.
</p>
<p>When a DSRK is sent from a home EAP server to a local domain server
      or when a rMSK is sent from an ER server to an authenticator, in the
      absence of end-to-end security between the entity that is sending the
      key and the entity receiving the key, it is plausible for other entities
      to get access to keys being sent to an ER server in another domain. This
      mode of key transport is similar to that of MSK transport in the context
      of EAP authentication. We further observe that ERP is for access
      authentication and does not support end-to-end data security. In typical
      implementations, the traffic is in the clear beyond the access control
      enforcement point (the authenticator or an entity delegated by the
      authenticator for access control enforcement). The model works as long
      as entities in the middle of the network do not use keys intended for
      other parties to steal service from an access network. If that is not
      achievable, key delivery must be protected in an end-to-end manner.
</p>
<a name="ianaCons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This document has no IANA actions; all values referenced in this
      document were previously assigned in RFC 5296 <a class='info' href='#RFC5296'>[RFC5296]<span> (</span><span class='info'>Narayanan, V. and L. Dondeti, &ldquo;EAP Extensions for EAP Re-authentication Protocol (ERP),&rdquo; August&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2104">[RFC2104]</a></td>
<td class="author-text"><a href="mailto:hugo@watson.ibm.com">Krawczyk, H.</a>, <a href="mailto:mihir@cs.ucsd.edu">Bellare, M.</a>, and <a href="mailto:canetti@watson.ibm.com">R. Canetti</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>,&rdquo; RFC&nbsp;2104, February&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2104.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3748">[RFC3748]</a></td>
<td class="author-text">Aboba, B., Blunk, L., Vollbrecht, J., Carlson, J., and H. Levkowetz, &ldquo;<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3748, June&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3748.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4282">[RFC4282]</a></td>
<td class="author-text">Aboba, B., Beadles, M., Arkko, J., and P. Eronen, &ldquo;<a href="http://tools.ietf.org/html/rfc4282">The Network Access Identifier</a>,&rdquo; RFC&nbsp;4282, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4282.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5295">[RFC5295]</a></td>
<td class="author-text">Salowey, J., Dondeti, L., Narayanan, V., and M. Nakhjiri, &ldquo;<a href="http://tools.ietf.org/html/rfc5295">Specification for the Derivation of Root Keys from an Extended Master Session Key (EMSK)</a>,&rdquo; RFC&nbsp;5295, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5295.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-erp">[I-D.ietf-dime-erp]</a></td>
<td class="author-text">Bournelle, J., Morand, L., Wu, W., and G. Zorn, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-erp-04.txt">Diameter Support for the EAP Re-authentication Protocol (ERP)</a>,&rdquo; draft-ietf-dime-erp-04 (work in progress), September&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-erp-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a></td>
<td class="author-text">, Q. and G. , &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-local-keytran-07.txt">Diameter Attribute-Value Pairs for Cryptographic Key
          Transport</a>,&rdquo; draft-ietf-dime-local-keytran-07 (work in progress), July&nbsp;2010 (<a href="http://datatracker.ietf.org/doc/draft-ietf-dime-local-keytran/">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-hokey-ldn-discovery">[I-D.ietf-hokey-ldn-discovery]</a></td>
<td class="author-text">Zorn, G., Wu, Q., and Y. Wang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-hokey-ldn-discovery-05.txt">The Local Domain Name DHCPv6 Option</a>,&rdquo; draft-ietf-hokey-ldn-discovery-05 (work in progress), September&nbsp;2010 (<a href="http://datatracker.ietf.org/doc/draft-ietf-hokey-ldn-discovery/">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IEEE_802.1X">[IEEE_802.1X]</a></td>
<td class="author-text">Institute of Electrical and Electronics
            Engineers, &ldquo;IEEE Standards for Local and Metropolitan Area Networks: Port
          based Network Access Control, IEEE Std 802.1X-2004,&rdquo; December&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="MSKHierarchy">[MSKHierarchy]</a></td>
<td class="author-text">Lopez, R., Skarmeta, A., Bournelle, J., Laurent-Maknavicus, M., and J. Combes, &ldquo;Improved EAP keying framework for a secure mobility access
          service,&rdquo; IWCMC&nbsp;'06, Proceedings&nbsp;of the 2006 International Conference on Wireless Communications and                     Mobile Computing, New York, NY, USA, 2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2865">[RFC2865]</a></td>
<td class="author-text">Rigney, C., Willens, S., Rubens, A., and W. Simpson, &ldquo;<a href="http://tools.ietf.org/html/rfc2865">Remote Authentication Dial In User Service (RADIUS)</a>,&rdquo; RFC&nbsp;2865, June&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2865.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3162">[RFC3162]</a></td>
<td class="author-text">Aboba, B., Zorn, G., and D. Mitton, &ldquo;<a href="http://tools.ietf.org/html/rfc3162">RADIUS and IPv6</a>,&rdquo; RFC&nbsp;3162, August&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3162.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3579">[RFC3579]</a></td>
<td class="author-text">Aboba, B. and P. Calhoun, &ldquo;<a href="http://tools.ietf.org/html/rfc3579">RADIUS (Remote Authentication Dial In User Service) Support For Extensible Authentication Protocol (EAP)</a>,&rdquo; RFC&nbsp;3579, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3579.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4187">[RFC4187]</a></td>
<td class="author-text">Arkko, J. and H. Haverinen, &ldquo;<a href="http://tools.ietf.org/html/rfc4187">Extensible Authentication Protocol Method for 3rd Generation Authentication and Key Agreement (EAP-AKA)</a>,&rdquo; RFC&nbsp;4187, January&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4187.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4962">[RFC4962]</a></td>
<td class="author-text">Housley, R. and B. Aboba, &ldquo;<a href="http://tools.ietf.org/html/rfc4962">Guidance for Authentication, Authorization, and Accounting (AAA) Key Management</a>,&rdquo; BCP&nbsp;132, RFC&nbsp;4962, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4962.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5169">[RFC5169]</a></td>
<td class="author-text">Clancy, T., Nakhjiri, M., Narayanan, V., and L. Dondeti, &ldquo;<a href="http://tools.ietf.org/html/rfc5169">Handover Key Management and Re-Authentication Problem Statement</a>,&rdquo; RFC&nbsp;5169, March&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5169.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5296">[RFC5296]</a></td>
<td class="author-text">Narayanan, V. and L. Dondeti, &ldquo;<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>,&rdquo; RFC&nbsp;5296, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5296.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5749">[RFC5749]</a></td>
<td class="author-text">Hoeper, K., Nakhjiri, M., and Y. Ohba, &ldquo;<a href="http://tools.ietf.org/html/rfc5749">Distribution of EAP-Based Keys for Handover and Re-Authentication</a>,&rdquo; RFC&nbsp;5749, March&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5749.txt">TXT</a>).</td></tr>
</table>

<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgments</h3>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
RFC 5296</h3>

<p>In writing this document, we benefited from discussing the problem
        space and the protocol itself with a number of folks including Bernard
        Aboba, Jari Arkko, Sam Hartman, Russ Housley, Joe Salowey, Jesse
        Walker, Charles Clancy, Michaela Vanderveen, Kedar Gaonkar, Parag
        Agashe, Dinesh Dharmaraju, Pasi Eronen, Dan Harkins, Yoshi Ohba, Glen
        Zorn, Alan DeKok, Katrin Hoeper, and other participants of the HOKEY
        working group. The credit for the idea to use
        EAP-Initiate/Re-auth-Start goes to Charles Clancy, and the multiple
        link-layer SAs idea to mitigate the DoS attack goes to Yoshi Ohba.
        Katrin Hoeper suggested the use of the windowing technique to handle
        multiple simultaneous ER exchanges. Many thanks to Pasi Eronen for the
        suggestion to use hexadecimal encoding for rIKname when sent as part
        of keyName-NAI field. Thanks to Bernard Aboba for suggestions in
        clarifying the EAP lock-step operation, and Joe Salowey and Glen Zorn
        for help in specifying AAA transport of ERP messages. Thanks to Sam
        Hartman for the DSRK Authorization Indication mechanism.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
RFC 5296bis</h3>

<p>Glen Zorn wrote the initial draft for this document and provided
        useful reviews. Many thanks to him.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Example ERP Exchange</h3>

<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
0. Authenticator --&gt; Peer:  [EAP-Initiate/Re-auth-Start]

1. Peer --&gt; Authenticator:  EAP Initiate/Re-auth(SEQ, keyName-NAI,
                             cryptosuite,Auth-tag*)

1a. Authenticator --&gt; Re-auth-Server: AAA-Request{Authenticator-Id,
                            EAP Initiate/Re-auth(SEQ,keyName-NAI,
                             cryptosuite,Auth-tag*)

2. ER-Server --&gt; Authenticator: AAA-Response{rMSK,
                            EAP-Finish/Re-auth(SEQ,keyName-NAI,
                            cryptosuite,[CB-Info],Auth-tag*)

2b. Authenticator --&gt; Peer: EAP-Finish/Re-auth(SEQ,keyName-NAI,
                             cryptosuite,[CB-Info],Auth-tag*)

* Auth-tag computation is over the entire EAP Initiate/Finish message;
  the code values for Initiate and Finish are different and thus
  reflection attacks are mitigated.

</pre></div><p>

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Qin Wu (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies Co.,
      Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">101 Software Avenue, Yuhua District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nanjing, JiangSu  210012</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Sunseawq@huawei.com">Sunseawq@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Zhen Cao</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China Mobile</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">53A Xibianmennei Ave., Xuanwu District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing, Beijing  100053</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R. China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:caozhen@chinamobile.com">caozhen@chinamobile.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yang Shi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">H3C Tech. Co., Ltd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Digital Technology Plaza, NO.9 Shangdi 9th Street,Haidian
          District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing  100085</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:young@h3c.com">young@h3c.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Baohong He</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hebaohong@catr.cn">hebaohong@catr.cn</a></td></tr>
</table>
</body></html>
