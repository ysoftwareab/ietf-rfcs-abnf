<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Accessing HTTP resources over CoAP</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 CoAP/HTTP Proxying">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 GET">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 PUT">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 DELETE">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 POST">
<link href="#rfc.section.3" rel="Chapter" title="3 Implementation Considerations">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Payloads and Media Types">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Max-Age and ETag Options">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Block-wise Transfers">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 HTTP Status Codes 1xx and 3xx">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Example">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The CoAP/HTTP proxying mechanism defined in this document enables Constrained Application Protocol (CoAP) clients to access a Hypertext Transfer Protocol (HTTP) resource by delegating the task of retrieving resource representations and manipulating resources to a CoAP intermediary." />
  <meta name="description" content="The CoAP/HTTP proxying mechanism defined in this document enables Constrained Application Protocol (CoAP) clients to access a Hypertext Transfer Protocol (HTTP) resource by delegating the task of retrieving resource representations and manipulating resources to a CoAP intermediary." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">CoRE Working Group</td>
<td class="right">K. Hartke</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Universitaet Bremen TZI</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">March 07, 2011</td>
</tr>
<tr>
<td class="left">Expires: September 08, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Accessing HTTP resources over CoAP<br />
  <span class="filename">draft-hartke-core-coap-http-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The CoAP/HTTP proxying mechanism defined in this document enables Constrained Application Protocol (CoAP) clients to access a Hypertext Transfer Protocol (HTTP) resource by delegating the task of retrieving resource representations and manipulating resources to a CoAP intermediary.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 08, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">CoAP/HTTP Proxying</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">GET</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">PUT</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">DELETE</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">POST</a>
</li>
<li>3.   <a href="#rfc.section.3">Implementation Considerations</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Payloads and Media Types</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Max-Age and ETag Options</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Block-wise Transfers</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">HTTP Status Codes 1xx and 3xx</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Example</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">The Constrained Application Protocol (CoAP) <a href="#I-D.ietf-core-coap">[I-D.ietf-core-coap]</a> allows clients to specify an arbitrary, absolute Uniform Resource Identifier (URI) <a href="#RFC3986">[RFC3986]</a> in requests to CoAP proxies. This document defines what it means to perform a CoAP request on a Hypertext Transfer Protocol (HTTP) URI <a href="#RFC2616">[RFC2616]</a>.</p>
<p id="rfc.section.1.p.2">The resulting CoAP/HTTP proxying mechanism enables CoAP clients to access HTTP resources over CoAP by delegating the task of retrieving resource representations and manipulating resources to a CoAP intermediary. This relieves the client from the burden of implementing any HTTP functionality itself.</p>
<p id="rfc.section.1.p.3">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#proxying" id="proxying">CoAP/HTTP Proxying</a>
</h1>
<p id="rfc.section.2.p.1">If a request contains a Proxy-URI Option with an 'http' or 'https' URI <a href="#RFC2616">[RFC2616]</a>, then the receiving CoAP end-point (called "the proxy" henceforth) is requested to perform the operation specified by the request method on the indicated HTTP resource and return the result to the client.</p>
<p id="rfc.section.2.p.2">This section specifies for any CoAP request the CoAP response that the proxy should return to the client. How the proxy actually satisfies the request is an implementation detail, although the typical case is expected to be the proxy translating and forwarding the request to an HTTP origin server (see <a href="#implementation">Section 3</a>).</p>
<p id="rfc.section.2.p.3">Since HTTP and CoAP share the basic set of request methods, performing a CoAP request on an HTTP resource is not so different from performing it on a CoAP resource. The meanings of the individual CoAP methods when performed on HTTP resources are explained below.</p>
<p id="rfc.section.2.p.4">If the proxy is unable or unwilling to service a request with an HTTP URI, a 5.05 (Proxying Not Supported) response MUST be returned to the client. If the proxy services the request by interacting with a third party (such as the HTTP origin server) and is unable to obtain a result within a reasonable timeframe, a 5.04 (Gateway Timeout) response MUST be returned; if a result can be obtained but is not understood, a 5.02 (Bad Gateway) response MUST be returned.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#get" id="get">GET</a>
</h1>
<p id="rfc.section.2.1.p.1">The GET method requests the proxy to return a representation of the HTTP resource identified by the request URI.</p>
<p id="rfc.section.2.1.p.2">Upon success, a 2.00 (OK) response SHOULD be returned. The payload of the response MUST be a representation of the target HTTP resource, and the Content-Type Option be set accordingly. The response MUST indicate a Max-Age value that is no greater than the remaining time the representation can be considered fresh. If the HTTP entity has an entity tag, the proxy SHOULD include an ETag Option in the response and process ETag Options in requests as described below.</p>
<p id="rfc.section.2.1.p.3">A client can influence the processing of a GET request by including the following options: </p>

<dl>
<dt>Lifetime:</dt>
<dd style="margin-left: 8">The request MAY include a Lifetime Option <a href="#I-D.ietf-core-observe">[I-D.ietf-core-observe]</a>. This requests the proxy to notify the client of any changes to the state of the target HTTP resource. If the proxy is unable to detect changes to the resource or is unwilling to establish an observation relationship, the proxy MUST silently ignore the option. Otherwise, the proxy establishes an observation relationship as described in <a href="#I-D.ietf-core-observe">[I-D.ietf-core-observe]</a> and, whenever the state of the HTTP resource changes, sends a 2.00 (OK) notification response to the client.</dd>
<dt>ETag:</dt>
<dd style="margin-left: 8">The request MAY include one or more ETag Options, identifying responses that the client has stored. This requests the proxy to send a 2.03 (Valid) response whenever it would send a 2.00 (OK) response with an entity tag in the requested set otherwise.  (See also <a href="#max-age-etag">Section 3.2</a>.)</dd>
<dt>Block:</dt>
<dd style="margin-left: 8">The request MAY include a Block Option <a href="#I-D.ietf-core-block">[I-D.ietf-core-block]</a>, specifying the block the client is interested in. This requests the proxy to send only the requested block in a 2.00 (OK) response instead of the whole representation.  (See also <a href="#block-wise">Section 3.3</a>.)</dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#put" id="put">PUT</a>
</h1>
<p id="rfc.section.2.2.p.1">The PUT method requests the proxy to update or create the HTTP resource identified by the request URI with the enclosed representation.</p>
<p id="rfc.section.2.2.p.2">If a new resource is created at the request URI, a 2.01 (Created) response MUST be returned to the client. If an existing resource is modified, a 2.04 (Changed) response MUST be returned to indicate successful completion of the request.</p>
<p id="rfc.section.2.2.p.3">A client can influence the processing of a PUT request by including the following options: </p>

<dl>
<dt>Block:</dt>
<dd style="margin-left: 8">The request MAY include a Block Option, indicating a block-wise transfer as described in <a href="#I-D.ietf-core-block">[I-D.ietf-core-block]</a>. (See also <a href="#block-wise">Section 3.3</a>.)</dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#delete" id="delete">DELETE</a>
</h1>
<p id="rfc.section.2.3.p.1">The DELETE method requests the proxy to delete the HTTP resource identified by the request URI at the HTTP origin server.</p>
<p id="rfc.section.2.3.p.2">A 2.02 (Deleted) response MUST be returned to client upon success or if the resource does not exist at the time of the request.</p>
<p id="rfc.section.2.3.p.3">No further options are defined to enable the client to influence the processing of a DELETE request.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#post" id="post">POST</a>
</h1>
<p id="rfc.section.2.4.p.1">The POST method requests the proxy to have the representation enclosed in the request be processed by the HTTP origin server. The actual function performed by the POST method is determined by the origin server and dependent on the resource identified by the request URI.</p>
<p id="rfc.section.2.4.p.2">If the action performed by the POST method does not result in a resource that can be identified by a URI, a 2.04 (Changed) response MUST be returned to the client. If a resource has been created on the origin server, a 2.01 (Created) response MUST be returned.</p>
<p id="rfc.section.2.4.p.3">A client can influence the processing of a PUT request by including the following options: </p>

<dl>
<dt>Block:</dt>
<dd style="margin-left: 8">The request MAY include a Block Option, indicating a block-wise transfer as described in <a href="#I-D.ietf-core-block">[I-D.ietf-core-block]</a>. (See also <a href="#block-wise">Section 3.3</a>.)</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#implementation" id="implementation">Implementation Considerations</a>
</h1>
<p id="rfc.section.3.p.1">The CoAP/HTTP proxying requirements described in <a href="#proxying">Section 2</a> deliberately make no restrictions on how a proxy implementation actually satisfies a request to produce the expected response.  Obviously, these requirements would not be very useful if they could not be implemented.  Also, some of the proxies will run on nodes that exhibit some constraints and may use networks that also are constrained.</p>
<p id="rfc.section.3.p.2">In general, an implementation will translate and forward CoAP requests to the HTTP origin server and translate back HTTP responses to CoAP responses, typically employing a certain amount of caching to make this translation more efficient.  This non-normative section gives some hints for implementing the translation.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#payloads-media-types" id="payloads-media-types">Payloads and Media Types</a>
</h1>
<p id="rfc.section.3.1.p.1">CoAP supports only a subset of media types. A proxy should convert payloads and approximate content-types as closely as possible. For example, if a HTTP server returns a resource representation in "text/plain; charset=iso-8859-1" format, the proxy should convert the payload to "text/plain; charset=utf-8" format. If conversion is not possible, the proxy can specify a media type of "application/octet-stream".</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#max-age-etag" id="max-age-etag">Max-Age and ETag Options</a>
</h1>
<p id="rfc.section.3.2.p.1">The proxy can determine the Max-Age Option for responses to GET requests by calculating the freshness lifetime (see Section 13.2.4 of <a href="#RFC2616">[RFC2616]</a>) of the HTTP resource representation retrieved. The Max-Age Option for responses to POST, PUT or DELETE requests should always be set to 0.</p>
<p id="rfc.section.3.2.p.2">The proxy can assign entity tags to responses it sends to a client.  These can be generated locally, if the proxy employs a cache, or be derived from the ETag header field in a response from the HTTP origin server, in which case the proxy can optimize future requests to the HTTP by using Conditional Requests. Note that CoAP does not support weak entity tags.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#block-wise" id="block-wise">Block-wise Transfers</a>
</h1>
<p id="rfc.section.3.3.p.1">The proxy can optimize the processing of many requests. For example, when a GET request includes a Block Option, the proxy can use HTTP Range Requests to retrieve only the requested block(s) of the HTTP resource from the origin server instead of retrieving the whole resource.</p>
<p><a href="#proxying">Section 2</a> makes no restrictions on whether the proxy attempts to re-assemble all block-wise PUT requests into a single HTTP PUT request or attempts to push each request forward by making use of the HTTP Content-Range header field (which is not widely implemented for PUT outside WebDAV). In either case, the handling chosen MUST be reflected in the More bit sent back in the CoAP response as specified in <a href="#I-D.ietf-core-block">[I-D.ietf-core-block]</a>.</p>
<p id="rfc.section.3.3.p.3">For POST, similar considerations as with PUT apply, except that HTTP Content-Range is even less widely implemented with HTTP POST.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#one-and-three" id="one-and-three">HTTP Status Codes 1xx and 3xx</a>
</h1>
<p id="rfc.section.3.4.p.1">CoAP does not have provisional responses (HTTP Status Codes 1xx) or responses indicating that further action needs to be taken (HTTP Status Codes 3xx). When a proxy receives such a response from the HTTP server, the response should cause the proxy to complete the request, for example, by following redirects. If the proxy is unable or unwilling to do so, it can return a 5.02 (Bad Gateway) error.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#example" id="example">Example</a>
</h1>
<p id="rfc.section.3.5.p.1">The example in <a href="#fig-example-1">Figure 1</a> shows a possible implementation of a basic CoAP GET request with an HTTP URI as the value of a Proxy-URI Option. The proxy retrieves a representation of the target resource from the HTTP origin server. It converts the payload to UTF-8 charset, calculates the Max-Age Option from the Expires header field, and derives an entity-tag from the ETag header field.</p>
<div id="#rfc.figure.1"></div>
<div id="#fig-example-1"></div>
<pre>
 CoAP CoAP/HTTP HTTP
Client  Proxy  Server
   |      |      |
   |      |      |
   +-----&gt;|      |   Header:    GET (T=CON, Code=1, MID=0x1633)
   | GET  |      |   Token:     0x5a
   |      |      |   Proxy-URI: http://www.example.com/foo/bar
   |      |      |
   |      |      |
   |      +-----&gt;|   GET /foo/bar HTTP/1.1
   |      | GET  |   Host: www.example.com
   |      |      |
   |      |      |
   |&lt;- - -+      |   Header:    (T=ACK, Code=0, MID=0x1633)
   |      |      |
   |      |      |
   |      |&lt;-----+   HTTP/1.1 200 OK
   |      |  200 |   Date: Tue, 01 Mar 2011 15:00:00 GMT
   |      |      |   Content-Type: text/plain; charset=iso-8859-1
   |      |      |   Content-Length: 11
   |      |      |   Expires: Tue, 01 Mar 2011 16:00:00 GMT
   |      |      |   ETag: "xyzzy"
   |      |      |   Connection: close
   |      |      |
   |      |      |   Hello World
   |      |      |
   |      |      |
   |&lt;-----+      |   Header:    2.00 OK (T=CON, Code=64, MID=0xAAF0)
   | 2.00 |      |   Token:     0x5a
   |      |      |   C'-Type:   text/plain; charset=utf-8
   |      |      |   Max-Age:   3600
   |      |      |   ETag:      0x78797A7A79
   |      |      |   Payload:   "Hello World"
   |      |      |
   |      |      |
   +- - -&gt;|      |   Header:    (T=ACK, Code=0, MID=0xAAF0)
   |      |      |
   |      |      |
</pre>
<p id="rfc.section.3.5.p.2">The example in <a href="#fig-example-2">Figure 2</a> builds on the previous example and shows a possible implementation of a GET request that includes a previously returned ETag Option. The proxy makes a Conditional Request to the HTTP origin server by including an If-None-Match header field in the HTTP GET request. The CoAP response indicates that the response stored by the client is fresh. It includes a Max-Age Option calculated from the HTTP response's Expires header field.</p>
<div id="#rfc.figure.2"></div>
<div id="#fig-example-2"></div>
<pre>
 CoAP CoAP/HTTP HTTP
Client  Proxy  Server
   |      |      |
   |      |      |
   +-----&gt;|      |   Header:    GET (T=CON, Code=1, MID=0x1CB0)
   | GET  |      |   Token:     0x7b
   |      |      |   Proxy-URI: http://www.example.com/foo/bar
   |      |      |   ETag:      0x78797A7A79
   |      |      |
   |      |      |
   |      +-----&gt;|   GET /foo/bar HTTP/1.1
   |      | GET  |   Host: www.example.com
   |      |      |   If-None-Match: "xyzzy"
   |      |      |
   |      |      |
   |&lt;- - -+      |   Header:    (T=ACK, Code=0, MID=0x1CB0)
   |      |      |
   |      |      |
   |      |&lt;-----+   HTTP/1.1 304 Not Modified
   |      |  304 |   Date: Tue, 01 Mar 2011 17:00:00 GMT
   |      |      |   Expires: Tue, 01 Mar 2011 18:00:00 GMT
   |      |      |   ETag: "xyzzy"
   |      |      |   Connection: close
   |      |      |
   |      |      |
   |&lt;-----+      |   Header:    2.03 Valid (T=CON, Code=67, MID=0xAAFF)
   | 2.03 |      |   Token:     0x7b
   |      |      |   Max-Age:   3600
   |      |      |   ETag:      0x78797A7A79
   |      |      |
   |      |      |
   +- - -&gt;|      |   Header:    (T=ACK, Code=0, MID=0xAAFF)
   |      |      |
   |      |      |
</pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">When CoAP NoSec mode is used, a CoAP to HTTP proxy provides a way for a UDP sender to initiate an HTTP transfer, possibly using a fake source address, making the original request untraceable in general. (I.e. the usual minimal protection afforded to HTTP proxies by the TCP three-way handshake does not apply.) CoAP/HTTP proxies MUST be used in a way that they don't attract attackers that want to exploit this, e.g., by requiring communication security and/or by running them in a protected network.</p>
<p id="rfc.section.4.p.2">The security considerations of section 15.7 of RFC 2616 apply and MUST be heeded. (TODO: Add further text about the perils of proxies, e.g., cache poisoning.)</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This document does not require IANA action.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.6.p.1">Some text for <a href="#implementation">Section 3</a> and <a href="#security">Section 4</a> was contributed by Carsten Bormann.</p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-coap">[I-D.ietf-core-coap]</b></td>
<td class="top">
<a>Shelby, Z</a>, <a>Hartke, K</a>, <a>Bormann, C</a> and <a>B Frank</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-coap-04">Constrained Application Protocol (CoAP)</a>", Internet-Draft draft-ietf-core-coap-04, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-block">[I-D.ietf-core-block]</b></td>
<td class="top">
<a>Shelby, Z</a> and <a>C Bormann</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-block-01">Blockwise transfers in CoAP</a>", Internet-Draft draft-ietf-core-block-01, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-core-observe">[I-D.ietf-core-observe]</b></td>
<td class="top">
<a>Hartke, K</a> and <a>Z Shelby</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-observe-01">Observing Resources in CoAP</a>", Internet-Draft draft-ietf-core-observe-01, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Klaus Hartke</span> 
	  <span class="n hidden">
		<span class="family-name">Hartke</span>
	  </span>
	</span>
	<span class="org vcardline">Universitaet Bremen TZI</span>
	<span class="adr">
	  <span>Postfach 330440</span>

	  <span class="vcardline">
		<span class="locality">Bremen</span>,  
		<span class="region"></span>
		<span class="code">D-28359</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49-421-218-63905</span>

<span class="vcardline">EMail: <a href="mailto:hartke@tzi.org">hartke@tzi.org</a></span>

  </address>
</div>

</body>
</html>