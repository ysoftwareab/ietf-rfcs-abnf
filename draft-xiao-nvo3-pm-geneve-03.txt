



NVO3 Working Group                                                X. Min
Internet-Draft                                                 G. Mirsky
Intended status: Standards Track                               ZTE Corp.
Expires: November 18, 2021                                 S. Pallagatti
                                                                  VMware
                                                            May 17, 2021


                   Performance Measurement for Geneve
                      draft-xiao-nvo3-pm-geneve-03

Abstract

   This document describes the method to achieve Performance Measurement
   (PM) in point-to-point Generic Network Virtualization Encapsulation
   (Geneve) tunnels used to make up an overlay network.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on November 18, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Min, et al.             Expires November 18, 2021               [Page 1]

Internet-Draft                PM for Geneve                     May 2021


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   2
     2.1.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   2
     2.2.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   3.  PM Packet Transmission over Geneve Tunnel . . . . . . . . . .   3
     3.1.  PM Encapsulation With Inner Ethernet/IP/UDP Header  . . .   3
     3.2.  PM Encapsulation With Inner IP/UDP Header . . . . . . . .   5
   4.  Reception of PM packet from Geneve Tunnel . . . . . . . . . .   7
     4.1.  Demultiplexing of the PM packet . . . . . . . . . . . . .   7
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   7
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   7
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .   8
     8.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   8

1.  Introduction

   "Generic Network Virtualization Encapsulation" (Geneve) [RFC8926]
   provides an encapsulation scheme that allows building an overlay
   network by decoupling the address space of the attached virtual hosts
   from that of the network.

   This document describes the use of "Simple Two-way Active Measurement
   Protocol" (STAMP) [RFC8762] and "Simple Two-Way Active Measurement
   Protocol Optional Extensions" (STAMP Optional Extensions) [RFC8972],
   to enable measuring the performance of the path between two Geneve
   tunnel endpoints, like delay, delay variation, and packet loss.

   Analogous to [I-D.ietf-nvo3-bfd-geneve], in this document, Network
   Virtualization Edge (NVE) represents the Geneve tunnel endpoint,
   Tenant System (TS) represents the physical or virtual device attached
   to a Geneve tunnel endpoint from the outside, Virtual Access Point
   (VAP) represents the NVE side of the interface between the NVE and
   the TS, the usage of Management Virtual Network Identifier (VNI) is
   described in [I-D.ietf-nvo3-geneve-oam] and outside the scope of this
   document.

2.  Conventions Used in This Document

2.1.  Abbreviations

   Geneve: Generic Network Virtualization Encapsulation

   NVE: Network Virtualization Edge



Min, et al.             Expires November 18, 2021               [Page 2]

Internet-Draft                PM for Geneve                     May 2021


   PM: Performance Measurement

   SSID: STAMP Session Identifier

   STAMP: Simple Two-way Active Measurement Protocol

   TS: Tenant System

   VAP: Virtual Access Point

   VNI: Virtual Network Identifier

2.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  PM Packet Transmission over Geneve Tunnel

   PM session is originated and terminated at VAP of an NVE, selection
   of the PM packet encapsulation is based on how the VAP encapsulates
   the data packets.  This document defines two formats of PM packet
   encapsulation in Geneve:

   o  with Ethernet and IP/UDP encapsulation;

   o  with IP/UDP encapsulation.

3.1.  PM Encapsulation With Inner Ethernet/IP/UDP Header

   If the VAP that originates the PM packets is used to encapsulate
   Ethernet data frames, then PM packets are encapsulated in Geneve as
   described below, here the PM packets are STAMP test packets.















Min, et al.             Expires November 18, 2021               [Page 3]

Internet-Draft                PM for Geneve                     May 2021


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Outer Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer UDP Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Geneve Header                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Inner Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Inner IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Inner UDP Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        STAMP Test Packet                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Outer Ethernet FCS                     |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

        Figure 1: Geneve Encapsulation of PM Packet With the Inner
                          Ethernet/IP/UDP Header

   The STAMP test packet MUST be carried inside the inner Ethernet frame
   of the Geneve packet, immediately after the inner Ethernet/IP/UDP
   header.  The inner Ethernet frame carrying the STAMP test packet has
   the following format:

      The Ethernet header and IP header are encoded as defined in
      Section 3.1 of [I-D.ietf-nvo3-bfd-geneve].



Min, et al.             Expires November 18, 2021               [Page 4]

Internet-Draft                PM for Geneve                     May 2021


      The destination UDP port MUST follow the STAMP UDP port usage
      defined in Section 4.1 of [RFC8762].

   The STAMP test packet can be STAMP Session-Sender test packet or
   STAMP Session-Reflector test packet.  The STAMP test packet is
   encoded as specified in [RFC8762] and [RFC8972].

   When the PM packets are encapsulated in Geneve in this way, the
   values in the Geneve header are set as specified in Section 3.1 of
   [I-D.ietf-nvo3-bfd-geneve].

3.2.  PM Encapsulation With Inner IP/UDP Header

   If the VAP that originates the PM packets is used to encapsulate IP
   data packets, then PM packets are encapsulated in Geneve as described
   below, here the PM packets are STAMP test packets.



































Min, et al.             Expires November 18, 2021               [Page 5]

Internet-Draft                PM for Geneve                     May 2021


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Ethernet Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer UDP Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Geneve Header                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Inner IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Inner UDP Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        STAMP Test Packet                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               FCS                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

     Figure 2: Geneve Encapsulation of PM Packet With the Inner IP/UDP
                                  Header

   The STAMP test packet MUST be carried inside the inner IP packet that
   immediately follows the Geneve header.  The inner IP packet carrying
   the STAMP test packet has the following format:

      The IP header is encoded as defined in Section 3.2 of
      [I-D.ietf-nvo3-bfd-geneve].

      The destination UDP port MUST follow the STAMP UDP port usage
      defined in Section 4.1 of [RFC8762].





Min, et al.             Expires November 18, 2021               [Page 6]

Internet-Draft                PM for Geneve                     May 2021


   The STAMP test packet can be STAMP Session-Sender test packet or
   STAMP Session-Reflector test packet.  The STAMP test packet is
   encoded as specified in [RFC8762] and [RFC8972].

   When the PM packets are encapsulated in Geneve in this way, the
   values in the Geneve header are set as specified in Section 3.2 of
   [I-D.ietf-nvo3-bfd-geneve].

4.  Reception of PM packet from Geneve Tunnel

   Once a packet is received, the NVE MUST validate the packet as
   specified in Section 4 of [I-D.ietf-nvo3-bfd-geneve], except that the
   received STAMP test packet would be processed by STAMP Session-Sender
   or STAMP Session-Reflector, instead of BFD.

4.1.  Demultiplexing of the PM packet

   Analogous to BFD over Geneve, multiple STAMP sessions for the same
   VNI may be running between two NVEs, so there needs to be a mechanism
   for demultiplexing received STAMP test packets to the proper session.

   If the STAMP test packet is received with STAMP Session Identifier
   (SSID) equals to 0, the procedure for demultiplexing the received
   STAMP test packets would follow the procedure for demultiplexing the
   received BFD packets with Your Discriminator equals to 0, which is
   specified in Section 4.1 of [I-D.ietf-nvo3-bfd-geneve].

   If the STAMP test packet is received with a non-zero SSID, then the
   STAMP session MUST be demultiplexed only with SSID as the key.

5.  Security Considerations

   This document does not raise any additional security issues beyond
   those of the specifications referred to in the list of references.

6.  IANA Considerations

   This document has no IANA action requested.

7.  Acknowledgements

   TBA.

8.  References







Min, et al.             Expires November 18, 2021               [Page 7]

Internet-Draft                PM for Geneve                     May 2021


8.1.  Normative References

   [I-D.ietf-nvo3-bfd-geneve]
              Min, X., Mirsky, G., Pallagatti, S., and J. Tantsura, "BFD
              for Geneve", draft-ietf-nvo3-bfd-geneve-02 (work in
              progress), March 2021.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8762]  Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple
              Two-Way Active Measurement Protocol", RFC 8762,
              DOI 10.17487/RFC8762, March 2020,
              <https://www.rfc-editor.org/info/rfc8762>.

   [RFC8926]  Gross, J., Ed., Ganga, I., Ed., and T. Sridhar, Ed.,
              "Geneve: Generic Network Virtualization Encapsulation",
              RFC 8926, DOI 10.17487/RFC8926, November 2020,
              <https://www.rfc-editor.org/info/rfc8926>.

   [RFC8972]  Mirsky, G., Min, X., Nydell, H., Foote, R., Masputra, A.,
              and E. Ruffini, "Simple Two-Way Active Measurement
              Protocol Optional Extensions", RFC 8972,
              DOI 10.17487/RFC8972, January 2021,
              <https://www.rfc-editor.org/info/rfc8972>.

8.2.  Informative References

   [I-D.ietf-nvo3-geneve-oam]
              Mirsky, G., Boutros, S., Black, D., and S. Pallagatti,
              "OAM for use in GENEVE", draft-ietf-nvo3-geneve-oam-01
              (work in progress), November 2020.

Authors' Addresses

   Xiao Min
   ZTE Corp.
   Nanjing
   China

   Phone: +86 25 88013062
   Email: xiao.min2@zte.com.cn



Min, et al.             Expires November 18, 2021               [Page 8]

Internet-Draft                PM for Geneve                     May 2021


   Greg Mirsky
   ZTE Corp.
   USA

   Email: gregory.mirsky@ztetx.com


   Santosh Pallagatti
   VMware

   Email: santosh.pallagatti@gmail.com








































Min, et al.             Expires November 18, 2021               [Page 9]
