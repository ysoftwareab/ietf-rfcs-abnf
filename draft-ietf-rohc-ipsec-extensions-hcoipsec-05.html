<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPsec Extensions to Support Robust Header Compression over IPsec (ROHCoIPsec)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPsec Extensions to Support Robust Header Compression over IPsec (ROHCoIPsec)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Ertekin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">C. Christou</td></tr>
<tr><td class="header">Expires: February 13, 2010</td><td class="header">Booz Allen Hamilton</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">C. Bormann</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Universitaet Bremen TZI</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">August 12, 2009</td></tr>
</table></td></tr></table>
<h1><br />IPsec Extensions to Support Robust Header Compression over IPsec (ROHCoIPsec)<br />draft-ietf-rohc-ipsec-extensions-hcoipsec-05</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on February 13, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
   Integrating ROHC with IPsec (ROHCoIPsec) offers the combined benefits
   of IP security services and efficient bandwidth utilization.  However, 
   in order to integrate ROHC with IPsec, extensions to the SPD and SAD are required.
   This document describes the IPsec extensions required to support ROHCoIPsec.
                        
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Extensions to IPsec Databases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Security Policy Database (SPD)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
Security Association Database (SAD)<br />
<a href="#anchor5">3.</a>&nbsp;
Extensions to IPsec Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.1.</a>&nbsp;
Addition to the IANA Protocol Numbers Registry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.2.</a>&nbsp;
Verifying the Integrity of Decompressed Packet Headers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.2.1.</a>&nbsp;
ICV Computation and Integrity Verification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.3.</a>&nbsp;
ROHC Segmentation and IPsec Tunnel MTU<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.4.</a>&nbsp;
Nested IPComp and ROHCoIPsec Processing<br />
<a href="#anchor11">4.</a>&nbsp;
Security Considerations<br />
<a href="#anchor12">5.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor13">6.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
   Using IPsec ([IPSEC]) protection offers various security services for
   IP traffic.  However, these
   benefits come at the cost of additional packet headers, which
   increase packet overhead.  As described in [ROHCOIPSEC], Robust
   Header Compression (ROHC [ROHC]) can be used with IPsec to reduce the
   overhead associated with IPsec-protected packets.
                        
</p>
<p>
   IPsec-protected traffic is carried over Security
   Associations (SAs), whose parameters are negotiated on a case-by-case
   basis.  The Security Policy Database (SPD) specifies the services
   that are to be offered to IP datagrams, and the parameters associated
   with SAs that have been established are stored in the Security
   Association Database (SAD).  For ROHCoIPsec,
   various extensions to the SPD and SAD that incorporate ROHC-relevant
   parameters are required.
                        
</p>
<p>
   In addition, three extensions to IPsec processing are
   required.  First, a mechanism for identifying ROHC packets must be
   defined.  Second, a mechanism to ensure the integrity of the 
   decompressed packet is needed.  Finally, the order of the inbound and outbound 
   processing must be enumerated when nesting IP Compression (IPComp [IPCOMP]), ROHC, and IPsec processing. 
                        
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Extensions to IPsec Databases</h3>

<p>
   The following subsections specify extensions to the SPD and the SAD
   to support ROHCoIPsec.
			
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Security Policy Database (SPD)</h3>

<p>
   In general, the SPD is responsible for specifying the security
   services that are offered to IP datagrams.  Entries in the SPD
   specify how to derive the corresponding values for SAD entries.  To
   support ROHC, the SPD must be extended to include per-channel ROHC
   parameters.  Together, the existing IPsec SPD parameters and the 
   ROHC parameters will dictate the security and header compression services that are provided to 
   packets.
			
</p>
<p>
   The fields contained within each SPD entry are defined in [IPSEC],
   Section 4.4.1.2.  To support ROHC, several processing info fields
   must be added to the SPD; these fields contain information regarding
   the ROHC profiles and channel parameters supported by the local ROHC
   instance.  
</p>
<p>
   The following ROHC channel parameters must be 
   included if the processing info field in the SPD is set to PROTECT:
			
</p>
<p>
</p>
<blockquote class="text">
<p>
      MAX_CID: The field indicates the highest context ID that will be decompressed by the local decompressor.  
      MAX_CID must be at least 0 and at most 16383 (The value 0 implies having one context).  
				
</p>
</blockquote>
<p>
</p>
<blockquote class="text">
<p>
      MRRU: The MRRU parameter indicates the the size of the largest reconstructed unit (in octets) that 
      the local decompressor is expected to reassemble from ROHC segments.  This size includes the CRC and the ROHC ICV.  
      NOTE: Since in-order delivery of ROHC packets cannot be guaranteed, the MRRU parameter is recommended 
      to be set to 0 (as stated in Section 5.2.5.1 of [ROHC] and Section 6.1 of [ROHCV2]), which indicates 
      that no segment headers are allowed on the ROHCoIPsec channel.
				
</p>
</blockquote>
<p>
</p>
<blockquote class="text">
<p>
      PROFILES: This field is a list of ROHC profiles supported by the local
      decompressor.  Possible values for this list 
      are contained in the [ROHCPROF] registry.
				
</p>
</blockquote>
<p>
   In addition to these ROHC channel parameters, a field within the SPD 
   is required to store a list of integrity algorithms supported 
   by the ROHCoIPsec instance:  
                        
</p>
<p></p>
<blockquote class="text">
<p>
      INTEGRITY ALGORITHM: This field is a list of integrity algorithms supported
      by the ROHCoIPsec instance.  This will be used 
      by the ROHC process to ensure that packet headers are properly
      decompressed (see Section 3.2).  Algorithms that must be supported are specified in Section 3.2 of [CRYPTO-ALG].  More explicitly, the implementation conformance requirements for authentication algorithms are as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Requirement    Algorithm
   -----------    ----------------
   Must           AUTH_HMAC_SHA1_96
   Should+        AUTH_AES_XCBC_MAC_96
   May            AUTH_HMAC_MD5_96
</pre></div>
</blockquote>

<p>
Several other ROHC channel parameters are omitted from the SPD, 
because they are set implicitly.  The omitted channel parameters are 
LARGE_CIDS and FEEDBACK_FOR.  The LARGE_CIDS channel parameter 
is set implicitly, based on the value of MAX_CID (e.g. if MAX_CID is 
&lt;= 15, LARGE_CIDS is assumed to be 0).  Finally, the ROHC FEEDBACK_FOR 
channel parameter is set implicitly to the ROHC channel associated 
with the SA in the reverse direction.  If an SA in the reverse direction 
does not exist, the FEEDBACK_FOR channel parameter is not set, and 
ROHC must not operate in bidirectional Mode.
 			
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Security Association Database (SAD)</h3>

<p>
   Each entry within the SAD defines the parameters associated with each
   established SA.  Unless the "populate from packet" (PFP) flag is
   asserted for a particular field, SAD entries are determined by the
   corresponding SPD entries during the creation of the SA.  
				
</p>
<p>
   The data items contained within the SAD are defined in [IPSEC],
   Section 4.4.2.1.  To support ROHC, this list of data items is
   augmented to include a "ROHC Data Item" that contains the parameters used by ROHC instance.  
   The ROHC Data Item exists for both inbound and outbound SAs.  
				
</p>
<p>
   The ROHC Data Item includes the ROHC channel parameters for the SA.  These channel parameters 
   (i.e., MAX_CID, PROFILES, MRRU) are enumerated above in Section 2.1.  For inbound SAs, the ROHC Data Item
   includes ROHC channel parameters that are used by the local decompressor instance; conversely, for outbound SAs, 
   the ROHC Data Item includes ROHC channel parameters that are used by local compressor instance.
				
</p>
<p>
   In addition to these ROHC channel parameters, the ROHC Data Item for both inbound and outbound SAs includes two 
   additional parameters. Specifically, these parameters store the integrity algorithm and respective key used by ROHC 
   (see Section 3.2).  The integrity algorithm and its associated key are used to calculate a ROHC ICV; this ICV 
   is used to verify the packet headers post-decompression.
				
</p>
<p>
   Finally, for inbound SAs, the ROHC Data Item includes a FEEDBACK_FOR parameter.  The parameter is a 
   reference to a ROHC channel in the opposite direction (i.e., the outbound SA) between the same compression endpoints.  
   A ROHC channel associated with an inbound SA and a ROHC channel associated with an outbound SA may 
   be coupled to form a Bi-directional ROHC channel as defined in Section 6.1 and Section 6.2 in [ROHC-TERM].
				
</p>
<p>"ROHC Data Item" values
   may be initialized manually (i.e., administratively configured for
   manual SAs), or initialized via a key exchange protocol (e.g.  IKEv2
   [IKEV2]) that has been extended to support the signaling of ROHC
   parameters [IKEV2EXT].
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Extensions to IPsec Processing</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Addition to the IANA Protocol Numbers Registry</h3>

<p>
   In order to demultiplex header-compressed from uncompressed traffic
   on a ROHC-enabled SA, a "ROHC" value must be reserved in the IANA
   Protocol Numbers registry.  If an outbound packet has a compressed
   header, the Next Header field of the security protocol header (e.g.,
   AH [AH], ESP [ESP]) must be set to the "ROHC" protocol identifier.  If 
   the packet header has not been compressed by ROHC, the Next Header 
   field does not contain the "ROHC" protocol identifier.  Conversely, 
   for an inbound packet, the value of the security protocol Next 
   Header field is checked to determine if the packet includes a 
   ROHC header, in order to determine if it requires ROHC decompression.	
				
</p>
<p>
   Use of the "ROHC" protocol identifier for purposes other than
   ROHCOIPsec is currently not defined.  Future protocols
   that make use of the allocation (e.g., other applications of ROHC in multi-hop environments)
   require specification of the logical compression channel between the ROHC 
   compressor and decompressor.  In addition, these specifications will require 
   the investigation of the security considerations associated 
   with use of the "ROHC" protocol identifier outside the context of the next-header
   field of security protocol headers.
				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Verifying the Integrity of Decompressed Packet Headers</h3>

<p>
   Since ROHC is inherently a lossy compression algorithm, ROHCoIPsec may use an additional Integrity Algorithm (and respective
   key) to compute a second Integrity Check Value (ICV) for the
   uncompressed packet.  This ICV is computed over the uncompressed IP header, as well at the higher-layer headers and the packet payload, and is appended to the ROHC-compressed packet.  At the decompressor, the
   decompressed packet (including the uncompressed IP header, higher-layer headers, and packet payload; but not including the authentication data) will be used with the integrity algorithm (and
   its respective key) to compute a value that will be compared to the appended
   ICV.  If these values are not identical, the decompressed packet must
   be dropped by the decompressor.
				
</p>
<p>Figure 1 illustrates the composition of a ROHCoIPsec-processed IPv4 packet.  In the example, TCP/IP compression is applied, and the packet is processed with tunnel mode ESP.
</p>
<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
             BEFORE COMPRESSION AND APPLICATION OF ESP
             ----------------------------
       IPv4  |orig IP hdr  |     |      |
             |(any options)| TCP | Data |
             ----------------------------

	      AFTER ROHCOIPSEC COMPRESSION AND APPLICATION OF ESP
            ------------------------------------------------------
      IPv4  | new IP hdr  |     | Cmpr. |    | ROHC | ESP   | ESP|
            |(any options)| ESP | Hdr.  |Data| ICV  |Trailer| ICV|
            ------------------------------------------------------

</pre></div>
<p>Figure 1. Example of a ROHCoIPsec-processed packet.
</p>
<p>
Note: The authentication data must not be included in the calculation of the ICV.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
ICV Computation and Integrity Verification</h3>

<p>
In order to correctly verify the integrity of the decompressed packets, the processing steps for ROHCoIPsec must be implemented in a specific order, as given below.
					
</p>
<p>For outbound packets that are processed by ROHC and IPsec-protected:
						</p>
<ul class="text">
<li>
Compute an ICV for the uncompressed packet with the negotiated (ROHC) integrity algorithm and its respective key
							
</li>
<li>
Compress the packet headers (as specified by the ROHC process)
							
</li>
<li>
Append the ICV to the compressed packet
							
</li>
<li>
Apply AH or ESP processing to the packet, as specified in the appropriate SAD entry
							
</li>
</ul><p>
					
</p>
<p>For inbound packets that are to be decompressed by ROHC:
						</p>
<ul class="text">
<li>
Apply AH or ESP processing, as specified in the appropriate SAD entry 
							
</li>
<li>
Remove the ICV from the packet
							
</li>
<li>
Decompress the packet header(s)
							
</li>
<li>
Compute an ICV for the decompressed packet with the negotiated (ROHC) integrity algorithm and its respective key
							
</li>
<li>
Compare the computed ICV to the original ICV calculated at the compressor: if these two values differ, the packet must be dropped; otherwise resume IPsec processing
							
</li>
</ul><p>
					
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
ROHC Segmentation and IPsec Tunnel MTU</h3>

<p>In certain scenarios, a ROHCoIPsec-processed packet may exceed the size of the IPsec tunnel MTU.  [IPSEC] currently stipulates the following for outbound
traffic that exceeds the SA PMTU:
</p>
<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>       Case 1: Original (cleartext) packet is IPv4 and has the DF
               bit set.  The implementation should discard the packet
               and send a PMTU ICMP message.

       Case 2: Original (cleartext) packet is IPv4 and has the DF
               bit clear.  The implementation should fragment (before or
               after encryption per its configuration) and then forward
               the fragments.  It should not send a PMTU ICMP message.

       Case 3: Original (cleartext) packet is IPv6.  The implementation
               should discard the packet and send a PMTU ICMP message.
</pre></div><p>

</p>
<p>For ROHCOIPsec, Cases 1 and 3, and the post-encryption fragmentation for Case 2 are employed.  However, since current 
ROHC compression profiles do not support the compression of IP packet fragments, pre-encryption fragmentation is not compatible
with the current set of ROHC profiles.  In place of pre-encryption fragmentation, ROHC segmentation may be used at the compressor to 
divide the packet, where each segment conforms to the tunnel MTU. However, because in-order delivery of ROHC segments is 
not guaranteed, the use of ROHC segmentation is not recommended.
</p>
<p>If the compressor determines that the compressed packet exceeds the tunnel MTU, ROHC segmentation may be applied to the compressed packet
before AH or ESP processing.  This determination can be made by comparing the anticipated ROHCoIPsec packet size to the Path MTU data item 
specified in the SAD entry.  If the MRRU for the channel is non-zero, the compressor applies ROHC segmentation.  The segmentation process should account for the additional overhead imposed by IPsec 
process (e.g., AH or ESP overhead, crypto synchronization data, the additional IP header, etc.) such that the final IPsec-processed segments are 
less than the tunnel MTU.  After segmentation, each ROHC segment receives AH or ESP processing. 
</p>
<p>For channels where the MRRU is non-zero, the ROHCoIPsec decompressor must re-assemble the ROHC segments that are received.  To accomplish 
this, the decompressor must identify the ROHC segments (as documented in Section 5.2.6 of [ROHC]), and attempt reconstruction using the ROHC segmentation
protocol (Section 5.2.5 of [ROHC]).  If reconstruction fails, the packet must be discarded.
</p>
<p>As stated in Section 3.2.1, if the ROHC integrity algorithm is used to verify the decompression of packet headers, this ICV is appended to the compressed packet. 
If ROHC segmentation is performed, the segmentation algorithm is executed on the compressed packet and the appended ICV.   Note that the ICV is not appended to each ROHC segment.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Nested IPComp and ROHCoIPsec Processing</h3>

<p>
   IPComp ([IPCOMP]) is another mechanism that can be implemented to
   reduce the size of an IP datagram.  If IPComp and ROHCoIPsec are
   implemented in a nested fashion, the following steps must be followed for outbound and inbound packets. 
				
</p>
<p>
For outbound packets that are to be processed by IPcomp and ROHC:
					</p>
<ul class="text">
<li>
The ICV is computed for the uncompressed packet, and the appropriate ROHC compression profile is applied to the packet
						
</li>
<li>
IPComp is applied, and the packet is sent to the IPsec process
						
</li>
<li>
The security protocol is applied to the packet
						
</li>
</ul><p>
				
</p>
<p>
Conversely, for inbound packets that are to be both ROHC- and IPcomp-decompressed:
					</p>
<ul class="text">
<li>
A packet received on a ROHC-enabled SA is IPsec-processed
						
</li>
<li>
The datagram is decompressed based on the appropriate IPComp algorithm
						
</li>
<li>
The packet is sent to the ROHC module for header decompression and integrity verification
						
</li>
</ul><p>
				
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>
   A ROHCoIPsec implementer should consider the strength of protection 
   provided by the integrity check algorithm used to verify the valid 
   decompression of ROHC-compressed packets.  Failure to implement a 
   strong integrity check algorithm increases the probability of an 
   invalidly decompressed packet to be forwarded by a ROHCoIPsec device 
   into a protected domain.  
			
</p>
<p>
   The implementation of ROHCoIPsec may increase the susceptibility for traffic
   flow analysis, where an attacker can
   identify new traffic flows by monitoring the relative size of the
   encrypted packets (i.e. a group of "long" packets, followed by a long
   series of "short" packets may indicate a new flow for some ROHCoIPsec
   implementations).  To mitigate this concern, ROHC padding mechanisms
   may be used to arbitrarily add padding to transmitted packets to
   randomize packet sizes.  This technique, however, reduces the overall 
   efficiency benefit offered by header compression.
			
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
   IANA is requested to allocate one value within the "Protocol Numbers"
   registry [PROTOCOL] for "ROHC".  This value will be used to indicate
   that the next level protocol header is a ROHC header.
			
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgments</h3>

<p>
   The authors would like to thank Mr. Sean O'Keeffe, Mr. James Kohler,
   Ms. Linda Noone of the Department of Defense, and Mr. A. Rich Espy of
   OPnet for their contributions and support for developing this
   document.  
</p>
<p>The authors would also like to thank Mr. Yoav Nir, and Mr. 
   Robert A Stangarone Jr.: both served as committed document reviewers 
   for this specification.
</p>
<p>Finally, the authors would like to thank the following for their numerous reviews and comments to
   this document:
</p>
<p>
				</p>
<ul class="text">
<li>Mr. Magnus Westerlund
</li>
<li>Dr. Stephen Kent
</li>
<li>Mr. Lars-Erik Jonsson
</li>
<li>Mr. Carl Knutsson
</li>
<li>Mr. Pasi Eronen
</li>
<li>Dr. Jonah Pezeshki
</li>
<li>Mr. Tero Kivinen
</li>
<li>Dr. Joseph Touch
</li>
<li>Mr. Rohan Jasani
</li>
</ul><p>
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IPSEC">[IPSEC]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHC">[ROHC]</a></td>
<td class="author-text">Jonsson, L-E., Pelletier, G., and K. Sandlund, &ldquo;<a href="http://tools.ietf.org/html/rfc4995">The RObust Header Compression (ROHC) Framework</a>,&rdquo; RFC&nbsp;4995, July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCV2">[ROHCV2]</a></td>
<td class="author-text">Pelletier, G. and K. Sandlund, &ldquo;<a href="http://tools.ietf.org/html/rfc5225">RObust Header Compression Version 2 (ROHCv2): Profiles for RTP, UDP, IP, ESP and UDP-Lite</a>,&rdquo; RFC&nbsp;5225.</td></tr>
<tr><td class="author-text" valign="top"><a name="IPCOMP">[IPCOMP]</a></td>
<td class="author-text">Shacham, A., Monsour, R., Pereira, and Thomas, &ldquo;<a href="http://tools.ietf.org/html/rfc3173">IP Payload Compression Protocol (IPComp)</a>,&rdquo; RFC&nbsp;3173, September&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="IKEV2">[IKEV2]</a></td>
<td class="author-text">Kaufman, C., &ldquo;<a href="http://tools.ietf.org/html/rfc4306">Internet Key Exchange (IKEv2) Protocol</a>,&rdquo; RFC&nbsp;4306, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="IKEV2EXT">[IKEV2EXT]</a></td>
<td class="author-text">Ertekin, et al., &ldquo;Extensions to IKEv2 to Support Robust Header Compression over IPsec (ROHCoIPsec),&rdquo; work in progress&nbsp;, August&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="AH">[AH]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="ESP">[ESP]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ROHCOIPSEC">[ROHCOIPSEC]</a></td>
<td class="author-text">Ertekin, E., Jasani, R., Christou, C., and C. Bormann, &ldquo;Integration of Header Compression over IPsec Security Associations,&rdquo; work in progress&nbsp;, August&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHCPROF">[ROHCPROF]</a></td>
<td class="author-text">&ldquo;RObust Header Compression (ROHC) Profile Identifiers,&rdquo; www.iana.org/assignments/rohc-pro-ids&nbsp;, October&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="CRYPTO-ALG">[CRYPTO-ALG]</a></td>
<td class="author-text">Manral, V., &ldquo;<a href="http://tools.ietf.org/html/rfc4835">Cryptographic Algorithm Implementation Requirements for Encapsulating Security Payload (ESP) and Authentication Header (AH)</a>,&rdquo; RFC&nbsp;4835, April&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="ROHC-TERM">[ROHC-TERM]</a></td>
<td class="author-text">Jonsson, L-E., &ldquo;<a href="http://tools.ietf.org/html/rfc3759">Robust Header Compression (ROHC): Terminology and Channel Mapping Examples</a>,&rdquo; RFC&nbsp;3759, April&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="PROTOCOL">[PROTOCOL]</a></td>
<td class="author-text">IANA, &ldquo;"Assigned Internet Protocol Numbers", IANA registry at: http://www.iana.org/assignments/protocol-numbers.&rdquo;</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Emre Ertekin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ertekin_emre@bah.com">ertekin_emre@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chris Christou</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Booz Allen Hamilton</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">13200 Woodland Park Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20171</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:christou_chris@bah.com">christou_chris@bah.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Carsten Bormann</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Universitaet Bremen TZI</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Postfach 330440</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bremen  D-28334</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cabo@tzi.org">cabo@tzi.org</a></td></tr>
</table>
</body></html>
