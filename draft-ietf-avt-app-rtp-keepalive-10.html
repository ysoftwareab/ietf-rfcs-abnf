<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Application Mechanism for keeping alive the Network Address Translator (NAT) mappings associated to RTP/RTCP flows.  </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Requirements">
<link href="#rfc.section.4" rel="Chapter" title="4 List of Alternatives for Performing RTP Keepalive">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Transport Packet of 0-byte">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 RTP Packet with Comfort Noise Payload">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 RTCP Packets Multiplexed with RTP Packets">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 STUN Indication Packet">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 RTP Packet with Incorrect Version Number">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 RTP Packet with Unknown Payload Type">
<link href="#rfc.section.5" rel="Chapter" title="5 Recommended Solution for Keepalive Mechanism">
<link href="#rfc.section.6" rel="Chapter" title="6 Media Format Exceptions">
<link href="#rfc.section.7" rel="Chapter" title="7 Timing and Transport Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 RTCP Flow Keepalive">
<link href="#rfc.section.9" rel="Chapter" title="9 Security Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 IANA Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative references">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative references">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document lists the different mechanisms that enable applications using Real-time Transport Protocol (RTP) and RTP control protocol (RTCP) to maintain their RTP Network Address Translator (NAT) mappings alive.  It also makes a recommendation for a preferred mechanism.  This document is not applicable to Interactive Connectivity Establishment (ICE) agents.  " />
  <meta name="description" content="This document lists the different mechanisms that enable applications using Real-time Transport Protocol (RTP) and RTP control protocol (RTCP) to maintain their RTP Network Address Translator (NAT) mappings alive.  It also makes a recommendation for a preferred mechanism.  This document is not applicable to Interactive Connectivity Establishment (ICE) agents.  " />
  <meta name="keywords" content="AVT, NAT, RTP, SDP, port, mapping" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">X. Marjou</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">A. Sollaud</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">France Telecom Orange</td>
</tr>
<tr>
<td class="left">Expires: September 05, 2011</td>
<td class="right">March 04, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Application Mechanism for keeping alive the Network Address Translator (NAT) mappings associated to RTP/RTCP flows.  <br />
  <span class="filename"></span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document lists the different mechanisms that enable applications using Real-time Transport Protocol (RTP) and RTP control protocol (RTCP) to maintain their RTP Network Address Translator (NAT) mappings alive.  It also makes a recommendation for a preferred mechanism.  This document is not applicable to Interactive Connectivity Establishment (ICE) agents.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted to IETF in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 05, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Requirements</a>
</li>
<li>4.   <a href="#rfc.section.4">List of Alternatives for Performing RTP Keepalive</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Transport Packet of 0-byte</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">RTP Packet with Comfort Noise Payload</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">RTCP Packets Multiplexed with RTP Packets</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">STUN Indication Packet</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">RTP Packet with Incorrect Version Number</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">RTP Packet with Unknown Payload Type</a>
</li>
<li>5.   <a href="#rfc.section.5">Recommended Solution for Keepalive Mechanism</a>
</li>
<li>6.   <a href="#rfc.section.6">Media Format Exceptions</a>
</li>
<li>7.   <a href="#rfc.section.7">Timing and Transport Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">RTCP Flow Keepalive</a>
</li>
<li>9.   <a href="#rfc.section.9">Security Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">IANA Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgements</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative references</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative references</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Documents <a href="#RFC4787">[RFC4787]</a> and <a href="#RFC5382">[RFC5382]</a> describe Network Address Translator (NAT) behaviors and point out that two key aspects of NAT are mappings (a.k.a. bindings) and keeping them refreshed.  This introduces a derived requirement for applications engaged in a multimedia session involving NAT traversal: they need to generate a minimum of flow activity in order to create NAT mappings and maintain them.</p>
<p id="rfc.section.1.p.2">When applied to applications using the real-time transport protocol (RTP) <a href="#RFC3550">[RFC3550]</a>, the RTP media stream packets themselves normally fulfill this requirement.  However there exist some cases where RTP does not generate the minimum required flow activity.</p>
<p id="rfc.section.1.p.3">The examples are:<br><br> </p>

<ul>
<li>In some RTP usages, such as the Session Inititation Protocol (SIP) <a href="#RFC3550">[RFC3550]</a>, agents can negotiate a unidirectional media stream by using the Session Description Protocol (SDP) <a href="#RFC4566">[RFC4566]</a> "recvonly" attribute on one agent and "sendonly" on the peer, as defined in <a href="#RFC3264">[RFC3264]</a>.  <a href="#RFC3264">[RFC3264]</a> directs implementations not to transmit media on the receiving agent.  In case the agent receiving the media is located in the private side of a NAT, it will never receive RTP packets from the public peer if the NAT mapping has not been created.<br><br>
</li>
<li>Similarly, a bidirectional media stream can be "put on hold".  This is accomplished by using the SDP "sendonly" or "inactive" attributes.  Again <a href="#RFC3264">[RFC3264]</a> directs implementations to cease transmission of media in these cases.  However, doing so may cause NAT bindings to timeout, and media won't be able to come off hold.<br><br>
</li>
<li>Some RTP payload formats, such as the payload format for text conversation <a href="#RFC4103">[RFC4103]</a>, may send packets so infrequently that the interval exceeds the NAT binding timeouts.</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.4">To solve these problems, an agent therefore needs to periodically send keepalive data within the outgoing RTP session of an RTP media stream  regardless of whether the media stream is currently inactive, sendonly, recvonly or sendrecv, and regardless of the presence or value of the bandwidth attribute.  </p>
<p id="rfc.section.1.p.5">It is important to note that NAT traversals constraints also usually require the agents to use Symmetric RTP / RTP Control Protocol (RTCP) <a href="#RFC4961">[RFC4961]</a> in addition to RTP keepalive.  </p>
<p id="rfc.section.1.p.6">This document first states the requirements that must be supported to perform RTP keepalives (<a href="#requirements">Section 3</a>).  In a second step, the document reports the different mechanisms to overcome this problem (<a href="#alternatives">Section 4</a>).  <a href="#recommend">Section 5</a> finally states the recommended solution for RTP keepalive.  <a href="#exceptions">Section 6</a> discusses some media format exceptions.  <a href="#additional">Section 7</a> adds details about timing and transport considerations.  <a href="#rtcp">Section 8</a> documents how to maintain NAT bindings for RTCP.  </p>
<p id="rfc.section.1.p.7">This document is not applicable to Interactive Connectivity Establishment (ICE) <a href="#RFC5245">[RFC5245]</a> agents.  Indeed, the ICE protocol together with Session Traversal Utilities for NAT (STUN) <a href="#RFC5389">[RFC5389]</a> and Traversal Using Relays around NAT (TURN)  <a href="#RFC5766">[RFC5766]</a> solve the overall Network Address Translator (NAT) traversal mechanism of media streams.  In the context of RTP media streams, some agents may not require all ICE functionalities and may only need a keepalive mechanism.  This document thus applies to such agents, and does not apply to agents implementing ICE.  </p>
<p id="rfc.section.1.p.8">Note that if a given media uses a codec that already integrates a keepalive mechanism, no additional keepalive mechanism is required at the RTP level.</p>
<p id="rfc.section.1.p.9">As mentioned in Section 3.5 of <a href="#RFC5405">[RFC5405]</a> "It is important to note that keepalive messages are NOT RECOMMENDED for general use -- they are unnecessary for many applications and can consume significant amounts of system and network resources."</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">In this document, the key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#requirements" id="requirements">Requirements</a>
</h1>
<p id="rfc.section.3.p.1">This section outlines the key requirements that need to be satisfied in order to provide RTP media keepalive.</p>
<p></p>

<dl>
<dt>REQ-1 </dt>
<dd>Some data is sent periodically within the outgoing RTP session for the whole duration of the RTP media stream.<br><br>
</dd>
<dt>REQ-2 </dt>
<dd>Any type of transport (e.g. UDP, TCP) MUST be supported.<br><br>
</dd>
<dt>REQ-3 </dt>
<dd>Any media type (e.g. audio, video, text) MUST be supported.<br><br>
</dd>
<dt>REQ-4 </dt>
<dd>Any media format (e.g. G.711, H.263) MUST be supported.<br><br>
</dd>
<dt>REQ-5 </dt>
<dd>Session signaling protocols SHOULD NOT be impacted.<br><br>
</dd>
<dt>REQ-6 </dt>
<dd>Impacts on existing software SHOULD be minimized.<br><br>
</dd>
<dt>REQ-7 </dt>
<dd>Remote peer SHOULD NOT be impacted.<br><br>
</dd>
<dt>REQ-8 </dt>
<dd>The support for RTP keepalive SHOULD be described in the SDP.<br><br>
</dd>
<dt>REQ-9 </dt>
<dd>The solution SHOULD cover the integration with RTCP.<br><br>
</dd>
</dl>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#alternatives" id="alternatives">List of Alternatives for Performing RTP Keepalive</a>
</h1>
<p id="rfc.section.4.p.1">This section lists, in no particular order, some alternatives that can be used to perform a keepalive message within RTP media streams.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#transport" id="transport">Transport Packet of 0-byte</a>
</h1>
<p id="rfc.section.4.1.p.1">The application sends an empty transport packet (e.g. UDP packet, DCCP packet).</p>
<p id="rfc.section.4.1.p.2">Cons: </p>

<ul><li>This alternative is specific to each transport protocol.</li></ul>

<p> </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#comfort-noise" id="comfort-noise">RTP Packet with Comfort Noise Payload</a>
</h1>
<p id="rfc.section.4.2.p.1">The application sends an RTP packet with a comfort-noise payload <a href="#RFC3389">[RFC3389]</a>.</p>
<p id="rfc.section.4.2.p.2">Cons: </p>

<ul>
<li>This alternative is limited to audio formats only. </li>
<li>Comfort Noise needs to be supported by the remote peer.</li>
<li>Comfort Noise needs to be signalled in SDP offer/answer.</li>
<li>The peer is likely to render comfort noise at the other side, so the content of the payload (the noise level) needs to be carefully chosen.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#rtcp-mux" id="rtcp-mux">RTCP Packets Multiplexed with RTP Packets</a>
</h1>
<p id="rfc.section.4.3.p.1">The application sends RTCP packets in the RTP media path itself (i.e. same tuples for both RTP and RTCP packets) <a href="#RFC5761">[RFC5761]</a>.  RTCP packets therefore maintain the NAT mappings open as long as the requirements on parameter selection are fulfilled as discussed in <a href="#rtcp">Section 8</a>.</p>
<p id="rfc.section.4.3.p.2">Note: "on hold" procedures of <a href="#RFC3264">[RFC3264]</a> do not impact RTCP  transmissions.</p>
<p id="rfc.section.4.3.p.3">Cons: </p>

<ul>
<li>Multiplexing RTP and RTCP must be supported by the remote peer.</li>
<li>Some RTCP monitoring tools expect that RTCP packets are not multiplexed.</li>
<li>RTCP must be configured so that Tmin value <a href="#RFC3550">[RFC3550]</a> is lower or equal to the Tr interval.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#stun" id="stun">STUN Indication Packet</a>
</h1>
<p id="rfc.section.4.4.p.1">The application sends a STUN <a href="#RFC5389">[RFC5389]</a> Binding Indication packet as specified in ICE <a href="#RFC5245">[RFC5245]</a>.</p>
<p id="rfc.section.4.4.p.2">Thanks to the RTP validity check, STUN packets will be ignored by the RTP stack.</p>
<p id="rfc.section.4.4.p.3">Cons: </p>

<ul><li>The sending agent needs to support STUN.</li></ul>

<p> </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#incorrect-version" id="incorrect-version">RTP Packet with Incorrect Version Number</a>
</h1>
<p id="rfc.section.4.5.p.1">The application sends an RTP packet with an incorrect version number, which value is zero.</p>
<p id="rfc.section.4.5.p.2">Based on RTP specification <a href="#RFC3550">[RFC3550]</a>, the peer should perform a header validity check, and therefore ignore these types of packet.</p>
<p id="rfc.section.4.5.p.3">Cons: </p>

<ul>
<li>Only four version numbers are possible. Using one of them for RTP keepalive would be wasteful.</li>
<li>
<a href="#RFC4566">[RFC4566]</a> and <a href="#RFC3264">[RFC3264]</a> mandate not to send media with inactive and recvonly attributes, however this is mitigated as no real media is sent with this mechanism.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> <a href="#unknown-pt" id="unknown-pt">RTP Packet with Unknown Payload Type</a>
</h1>
<p id="rfc.section.4.6.p.1">The application sends an RTP packet of 0 length with a dynamic payload type that has not been negotiated by the peers (e.g. not negotiated within the SDP offer/answer, and thus not mapped to any media format). </p>
<p id="rfc.section.4.6.p.2">The sequence number is incremented by one for each packet, as it is sent within the same RTP session as the actual media.  The timestamp contains the same value a media packet would have at this time.  The marker bit is not significant for the keepalive packets and is thus set to zero.  </p>
<p id="rfc.section.4.6.p.3">The SSRC is the same as for the media for which keepalive is sent.</p>
<p id="rfc.section.4.6.p.4">Normally the peer will ignore this packet, as RTP <a href="#RFC3550">[RFC3550]</a> states that "a receiver MUST ignore packets with payload types that it does not understand".</p>
<p id="rfc.section.4.6.p.5">Cons: </p>

<ul>
<li>
<a href="#RFC4566">[RFC4566]</a> and <a href="#RFC3264">[RFC3264]</a> mandate not to send media with inactive and recvonly attributes, however this is mitigated as no real media is sent with this mechanism.</li>
<li>
<a href="#RFC3550">[RFC3550]</a> does not preclude examination of received packets by the peer in an attempt to determine if it is under attack.</li>
<li>The statement "RTP Packet with Unknown Payload Type" of RFC3550 is not always observed in real life.</li>
<li>There is no  RTCP reporting for the keepalive packets as RFC3550 mandates to ignore "RTP Packet with Unknown Payload Type".</li>
<li>Some RTP payload formats do not handle gaps in RTP sequence number well.</li>
</ul>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#recommend" id="recommend">Recommended Solution for Keepalive Mechanism</a>
</h1>
<p id="rfc.section.5.p.1">The RECOMMENDED mechanism is the "RTCP packets multiplexed with RTP packets" (<a href="#rtcp-mux">Section 4.3</a>).  This mechanism is desirable because it reduces the number of ports when RTP and RTCP are used.  It also has the advantage of taking into account RTCP aspects, which is not the case of other mechanisms.</p>
<p id="rfc.section.5.p.2">Other mechanisms (<a href="#transport">Section 4.1</a>, <a href="#comfort-noise">Section 4.2</a>, <a href="#stun">Section 4.4</a>, <a href="#incorrect-version">Section 4.5</a>, <a href="#unknown-pt">Section 4.6</a>) are NOT RECOMMENDED. </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#exceptions" id="exceptions">Media Format Exceptions</a>
</h1>
<p id="rfc.section.6.p.1">When a given media format does not allow the keepalive solution recommended in <a href="#recommend">Section 5</a>, an alternative mechanism SHOULD be defined in the payload format specification for this media format.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#additional" id="additional">Timing and Transport Considerations</a>
</h1>
<p id="rfc.section.7.p.1">An application supporting this specification MUST transmit either keepalive packets or media packets at least once every Tr seconds during the whole duration of the media session.  </p>
<p id="rfc.section.7.p.2">Tr has different value according to the transport protocol</p>
<p id="rfc.section.7.p.3">For UDP, the minimum RECOMMENDED Tr value is 15 seconds, and Tr SHOULD be configurable to larger values.</p>
<p id="rfc.section.7.p.4">For TCP, the recommended Tr value is 7200 seconds.</p>
<p id="rfc.section.7.p.5">When using the "RTCP packets multiplexed with RTP packets" solution for keepalive, Tr MUST comply with the RTCP timing rules of <a href="#RFC3550">[RFC3550]</a>.  </p>
<p id="rfc.section.7.p.6">Keepalive packets within a particular RTP session MUST use the tuple (source IP address, source TCP/UDP ports, target IP address, target TCP/UDP Port) of the regular RTP packets.</p>
<p id="rfc.section.7.p.7">The agent SHOULD only send RTP keepalive when it does not send regular RTP packets.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#rtcp" id="rtcp">RTCP Flow Keepalive</a>
</h1>
<p id="rfc.section.8.p.1">RTCP packets are sent periodically and can thus normally maintain the NAT mappings open as long as they are sent frequently enough. There are two conditions for that.  First RTCP needs to be used bi-directionally and in a symmetric fashion, as described in <a href="#RFC4961">[RFC4961]</a>.  Secondly, RTCP needs to be sent frequently enough. However, there are certain configurations that can break this latter assumption.</p>
<p id="rfc.section.8.p.2">There are two factors that need to be considered to ensure that RTCP is sent frequently enough. First the RTCP bandwidth needs to be sufficiently large so that transmission will occur more frequently than the longest acceptable packet transmission interval (Tr). The worst case RTCP interval (Twc) can be calculated using this formula by inserting the max value of the following parameters: </p>

<ul>
<li>Maximum RTCP packet size (avg_rtcp_size_max)</li>
<li>Maximum number of participants (members_max)</li>
<li>RTCP receiver bandwidth (rtcp_bw)</li>
</ul>

<p> </p>
<p id="rfc.section.8.p.3">The RTCP bandwidth value to use here is for a worst case, which will be the receiver proportion when all members are not senders except one.  This can be approximated to be all members. Thus for sessions where RR and RS values are used, then rtcp_bw shall be set to RR. For sessions where the <a href="#RFC3550">[RFC3550]</a> defines proportions of 1/4 for sender and 3/4 for receivers are used, then rtcp_bw will be 5% of 3/4 of the AS value in bits per second.</p>
<p id="rfc.section.8.p.4">Twc = 1.5 / 1.21828 * members_max * rtcp_bw / avg_rtcp_size_max * 8</p>
<p id="rfc.section.8.p.5">The second factor is the minimum RTCP interval Tmin defined in <a href="#RFC3550">[RFC3550]</a>.  Its base value is 5 seconds, but it might also be scaled to 360 divided by the session bandwidth in kbps. The Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF) <a href="#RFC4585">[RFC4585]</a> also allows for the setting of a trr-int parameter which is a minimal RTCP interval for regular RTCP packets. It is also used as the Tmin value in the regular Td calculation. An analysis of the algorithm gives that the longest possible regular RTCP interval possible are:</p>
<p id="rfc.section.8.p.6">RTCP_int_max = trr-int * 1.5 + Td * 1.5 / 1.21828</p>
<p id="rfc.section.8.p.7">And as long as the there is sufficient bandwidth according to criteria 1, then this can be simplified by setting Td = trr-int giving</p>
<p id="rfc.section.8.p.8">RTCP_int_max = trr-int * (1.5 + 1.5 / 1.21828) = 2.73123 * trr-int</p>
<p id="rfc.section.8.p.9">Thus the requirements on the RTCP parameters are the following for functioning keepalive: </p>

<ol>
<li>Ensure that sufficient RTCP bandwidth is provided by calculating Twc and ensure that this is less than or equal to Tr.</li>
<li>If AVP or SAVP is used the Tmin value can't be greater that Tr divided by 1.5 / (e-3/2).</li>
<li>If AVPF or SAVPF is to be used trr-min must not be set to a greater value than Tr / 3.</li>
</ol>

<p> </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Security Considerations</h1>
<p id="rfc.section.9.p.1">The RTP keepalive packets are sent on the same path as regular RTP media packets and may be perceived as an attack by a peer.  However, <a href="#RFC3550">[RFC3550]</a> mandates a peer to "ignore packets with payload types that it does not understand". A peer that does not understand the keepalive message will thus appropriately drop the received packets.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> IANA Considerations</h1>
<p id="rfc.section.10.p.1">None.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> Acknowledgements</h1>
<p id="rfc.section.11.p.1">Jonathan Rosenberg provided the major inputs for this draft via the ICE specification. Magnus Westerlund provided the text for the RTCP flow keepalive section.  In addition, thanks to Alfred E. Heggestad, Colin Perkins, Dan Wing, Gunnar Hellstrom, Hadriel Kaplan, Randell Jesup, Remi Denis-Courmont, Robert Sparks, and Steve Casner for their useful inputs and comments.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative references</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5405">[RFC5405]</b></td>
<td class="top">
<a>Eggert, L.</a> and <a>G. Fairhurst</a>, "<a href="http://tools.ietf.org/html/rfc5405">Unicast UDP Usage Guidelines for Application Designers</a>", BCP 145, RFC 5405, November 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4961">[RFC4961]</b></td>
<td class="top">
<a>Wing, D.</a>, "<a href="http://tools.ietf.org/html/rfc4961">Symmetric RTP / RTP Control Protocol (RTCP)</a>", BCP 131, RFC 4961, July 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5761">[RFC5761]</b></td>
<td class="top">
<a>Perkins, C.</a> and <a>M. Westerlund</a>, "<a href="http://tools.ietf.org/html/rfc5761">Multiplexing RTP Data and Control Packets on a Single Port</a>", RFC 5761, April 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative references</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4787">[RFC4787]</b></td>
<td class="top">
<a>Audet, F.</a> and <a>C. Jennings</a>, "<a href="http://tools.ietf.org/html/rfc4787">Network Address Translation (NAT) Behavioral Requirements for Unicast UDP</a>", BCP 127, RFC 4787, January 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5382">[RFC5382]</b></td>
<td class="top">
<a>Guha, S.</a>, <a>Biswas, K.</a>, <a>Ford, B.</a>, <a>Sivakumar, S.</a> and <a>P. Srisuresh</a>, "<a href="http://tools.ietf.org/html/rfc5382">NAT Behavioral Requirements for TCP</a>", BCP 142, RFC 5382, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5245">[RFC5245]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc5245">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>", RFC 5245, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3264">[RFC3264]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>", RFC 3264, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5389">[RFC5389]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>D. Wing</a>, "<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>", RFC 5389, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4566">[RFC4566]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Jacobson, V.</a> and <a>C. Perkins</a>, "<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>", RFC 4566, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4103">[RFC4103]</b></td>
<td class="top">
<a>Hellstrom, G.</a> and <a>P. Jones</a>, "<a href="http://tools.ietf.org/html/rfc4103">RTP Payload for Text Conversation</a>", RFC 4103, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3389">[RFC3389]</b></td>
<td class="top">
<a>Zopf, R.</a>, "<a href="http://tools.ietf.org/html/rfc3389">Real-time Transport Protocol (RTP) Payload for Comfort Noise (CN)</a>", RFC 3389, September 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5766">[RFC5766]</b></td>
<td class="top">
<a>Mahy, R.</a>, <a>Matthews, P.</a> and <a>J. Rosenberg</a>, "<a href="http://tools.ietf.org/html/rfc5766">Traversal Using Relays around NAT (TURN): Relay Extensions to Session Traversal Utilities for NAT (STUN)</a>", RFC 5766, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4585">[RFC4585]</b></td>
<td class="top">
<a>Ott, J.</a>, <a>Wenger, S.</a>, <a>Sato, N.</a>, <a>Burmeister, C.</a> and <a>J. Rey</a>, "<a href="http://tools.ietf.org/html/rfc4585">Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF)</a>", RFC 4585, July 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Xavier Marjou</span> 
	  <span class="n hidden">
		<span class="family-name">Marjou</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom Orange</span>
	<span class="adr">
	  <span>2, avenue Pierre Marzin</span>

	  <span class="vcardline">
		<span class="locality">Lannion</span>,  
		<span class="region"></span>
		<span class="code">22307</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:xavier.marjou@orange-ftgroup.com">xavier.marjou@orange-ftgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Aurelien Sollaud</span> 
	  <span class="n hidden">
		<span class="family-name">Sollaud</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom Orange</span>
	<span class="adr">
	  <span>2, avenue Pierre Marzin</span>

	  <span class="vcardline">
		<span class="locality">Lannion</span>,  
		<span class="region"></span>
		<span class="code">22307</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:aurelien.sollaud@orange-ftgroup.com">aurelien.sollaud@orange-ftgroup.com</a></span>

  </address>
</div>

</body>
</html>