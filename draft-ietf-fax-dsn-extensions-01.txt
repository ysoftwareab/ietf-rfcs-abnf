Fax Working Group                                               Dan Wing 
Internet Draft                                             Cisco Systems
June 8, 1998                                              Larry Masinter
Expires November 1998                                         Xerox PARC
draft-ietf-fax-dsn-extensions-01.txt


           Extensions to Delivery Status Notifications for Fax

Status of this memo

   This document is an Internet-Draft. Internet-Drafts are working
   documents of the Internet Engineering Task Force (IETF), its areas,
   and its working groups.  Note that other groups may also distribute
   working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   To view the entire list of current Internet-Drafts, please check
   the "1id-abstracts.txt" listing contained in the Internet-Drafts
   Shadow Directories on ftp.is.co.za (Africa), ftp.nordu.net
   (Northern Europe), ftp.nis.garr.it (Southern Europe), munnari.oz.au
   (Pacific Rim), ftp.ietf.org (US East Coast), or ftp.isi.edu
   (US West Coast).

Copyright Notice

   Copyright (C) The Internet Society (1998).  All Rights Reserved.
 
1.  Abstract

   The Internet fax specification [RFC2305] describes a simple mode of
   operation for fax over SMTP.  [EIFAX] requires that offramp gateways
   implemented using SMTP implement DSN [RFC1891], and this document
   provides extensions to message format of delivery status
   notifications [RFC1894] and error codes [RFC1893] to provide better
   support for fax offramps implemented as SMTP servers.

2. Introduction
 
   This document describes the following enhancements to DSN
   [RFC1891-1894] for fax:
   
     *  fields for call length, dialed number, and number
        of pages transmitted (section 3)
     *  enhanced status codes for fax-specific errors (section 4)

   [FAX-REQ] should be consulted for detailed background
   information.
   
   This draft is being discussed on the "ietf-fax" mailing list.  To
   subscribe, send a message to:
      ietf-fax-request@imc.org
   with the line:
      subscribe
   in the body of the message.  Archives are available from
   <http://www.imc.org/ietf-fax>.

2.1.  Definitions

   offramp:  A device which receives an SMTP message, calls a fax
      machine on the GSTN, translates the incoming SMTP message to a fax
      image, and transmits the fax image to the remote fax machine over
      the GSTN.  
     
   GSTN:  Global Switched Telephone Network.

3.  Delivery Status Notification Message Fields

   A message that is gatewayed by a fax offramp will cause a telephone
   call to be made.  This section describes mechanisms for the fax
   offramp to provide information about the telephone call:  the the
   length of the call, number of pages transmitted, and the dialed
   telephone number.

3.1.  New Message Fields

   Two new per-recipient extension fields, as described in [RFC1894
   section 2.3], are defined using the ABNF format described in
   [RFC2234]:

      extension-field = call-duration / transmitted-pages

      call-duration     = "Fax-Call-Duration" ":" elapsed-time
      transmitted-pages = "Fax-Transmitted-Pages" ":" xmit-pages

      elapsed-time = hour ":" minute ":" second [ ":" hundred ]
      
      hour    = 2DIGIT
      minute  = 2DIGIT
      second  = 2DIGIT
      hundred = 2DIGIT
      
      xmit-pages = 1*DIGIT
      
   Examples:
   
      Fax-Call-Duration: 06:30:23.32
      Fax-Call-Duration: 00:00:45
      
      Fax-Transmitted-Pages: 104
      Fax-Transmitted-Pages: 0

3.2.  Use of Existing Message Fields

   The Final-Recipient field can indicate the actual number dialed.
   Reference [RFC1894, section 2.3.2], for the format of the
   Final-Recipient field.

   Delivery Status Notifications compliant with this document should
   have an "address-type" is "e164".  The "generic-address" is a
   telephone number in the format of "global-phone", which is
   defined in [RFC2303].

   Examples:
   
     Final-Recipient: e164; +1-408-457-5208
     Final-Recipient: e164; +599-78760
     
4.  Enhanced Mail System Status Codes

   While Enhanced Mail System Status Codes [RFC1893] is quite complete
   in its description of events specific to email, it does not provide
   error codes which map directly to all the error codes necessary for
   other services such as gatewaying to GSTN-based fax.

   This document describes how existing codes from [ENH-CODES] can be
   used with a fax offramp, and documents new codes that are necessary
   to support fax offramps.  [ENH-CODES] allows new codes to be defined.
   The following table maps fax-specific codes to [ENH-CODES] codes
   where possible, and defines new fax-specific codes if [ENH-CODES]
   doesn't already have a suitable mapping.

4.1.  New Enhanced Mail System Status Codes for Fax

   The new fax-specific per-recipient codes are:

     "X.2.50   no carrier"

         The number was successfully dialed, but no fax carrier
         was ever heard by the sending fax modem.  This is
         useful as a persistent transient (4.X.X) or permanent 
         error (5.X.X).
      
     "X.2.51   unable to train"

         The number was successfully dialed, and a fax carrier
         was heard, but the fax modem was unable to communicate
         with the remote fax machine successfully.  This is
         useful as a persistent transient error (4.X.X).
         
     "X.2.52   no confirmation received"
     
         After transmission of a page to the remote fax machine the
         remote fax machine did not acknowledge receiving the page.
         This is useful as a persistent transient error (4.X.X).

4.2.  Use of Existing Enhanced Mail System Status Codes 

   Many of the codes described in [ENH-CODES] map well to fax
   offramp failure and success codes, and should be used to
   promote interoperability between fax and email.  The text
   shown in parentheses is from [RFC1893].

      "X.1.1   No such telephone number"
              ("Bad destination mailbox address" in [RFC1893])

         The telephone number does not exist or is not a dialable
         telephone number.  This code is only useful for permanent
         failures (5.X.X).

      "X.1.3   Unable to parse telephone number"
              ("Bad destination mailbox address syntax" in [RFC1893])

         The destination address was syntactically invalid.  This can
         apply to any field in the address.  This code is only useful
         for permanent failures (5.X.X).

      "X.4.1   No answer"
              ("No answer from host" in [RFC1893])

         The outbound connection attempt was not answered.  This is
         useful for both permanent (5.X.X) and persistent transient
         error (4.X.X).

      "X.3.2   Persistently Busy"
              ("System not accepting network messages" in [RFC1893])
   
         The dialed telephone number was busy.  This is useful for both
         permanent (5.X.X) and presistent transient errors (4.X.X).

5.  Security Considerations

  The Final-Recipient could disclose long-distance access codes that
  would be otherwise unknown to the sender.
  
6.  Acknowledgments


7.  References

   [EIFAX] L. Masinter, D. Wing, "Extended Facsimile Using Internet
   Mail", Internet Draft, Work in Progress, draft-ietf-fax-eifax-XX.txt

   [FAX-REQ] L. Masinter, "Requirements for Internet FAX", Internet
   Draft, Work in Progress, draft-ietf-fax-requirements-XX.txt.

   [RFC1891] K. Moore, "SMTP Service Extension for Delivery Status
   Notifications", RFC 1891, January 1996.

   [RFC1893] G. Vaudreuil, "Enhanced Mail System Status Codes", RFC
   1893, January 1996.
   
   [RFC1894] K. Moore, G. Vaudreuil, "An Extensible Message Format for
   Delivery Status Notifications", RFC 1894, January 1996.

   [RFC2303] C. Allocchio, "Minimal PSTN address format in Internet 
   Mail", RFC 1303, March 1998.

   [RFC2305] K. Toyoda, H. Ohno, J. Murai, D. Wing, "A Simple Mode of
   Facsimile Using Internet Mail", RFC 2305, March 1998.

   [RFC2234] D. Crocker, P. Overell, "Augmented BNF for Syntax
   Specifications:  ABNF", RFC 2234, November 1997.


9.  Copyright

   Copyright (C) The Internet Society 1998.  All Rights Reserved.
 
   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implmentation may be prepared, copied, published and
   distributed, in whole or in part, without restriction of any kind,
   provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the  purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.
 
   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.
 
   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

10.  Authors' Addresses

   Dan Wing
   Cisco Systems, Inc.
   101 Cooper Street
   Santa Cruz, CA 95060  USA

   Phone: +1 408 457 5200
   Fax:   +1 408 457 5208
   EMail: dwing@cisco.com


   Larry Masinter
   Xerox Palo Alto Research Center
   3333 Coyote Hill Road
   Palo Alto, CA 94304  USA

   Fax:    +1 415 812 4333
   EMail:  masinter@parc.xerox.com
                  
