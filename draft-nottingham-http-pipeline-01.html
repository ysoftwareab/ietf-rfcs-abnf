<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Making HTTP Pipelining Usable on the Open Web</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Requirements">
<link href="#rfc.section.3" rel="Chapter" title="3 HTTP Pipelining Issues">
<link href="#rfc.section.4" rel="Chapter" title="4 Blacklisting Origin Servers">
<link href="#rfc.section.5" rel="Chapter" title="5 Discovering Faulty Proxies">
<link href="#rfc.section.6" rel="Chapter" title="6 Correlating Responses">
<link href="#rfc.section.7" rel="Chapter" title="7 Hinting Pipelinable Content">
<link href="#rfc.section.8" rel="Chapter" title="8 Indicating Blocking Responses">
<link href="#rfc.section.9" rel="Chapter" title="9 Handling Pipelining Problems">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Acknowledgements">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Frequently Asked Questions">
<link href="#rfc.appendix.Appendix%20C" rel="Chapter" title="Appendix C Changes">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Pipelining was added to HTTP/1.1 as a means of improving the performance of persistent connections in common cases. While it is deployed in some limited circumstances, it is not widely used by clients on the open Internet. This memo suggests some measures designed to make it more possible for clients to reliably and safely use HTTP pipelining in these situations." />
  <meta name="description" content="Pipelining was added to HTTP/1.1 as a means of improving the performance of persistent connections in common cases. While it is deployed in some limited circumstances, it is not widely used by clients on the open Internet. This memo suggests some measures designed to make it more possible for clients to reliably and safely use HTTP pipelining in these situations." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Nottingham</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">March 14, 2011</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Making HTTP Pipelining Usable on the Open Web<br />
  <span class="filename">draft-nottingham-http-pipeline-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Pipelining was added to HTTP/1.1 as a means of improving the performance of persistent connections in common cases. While it is deployed in some limited circumstances, it is not widely used by clients on the open Internet. This memo suggests some measures designed to make it more possible for clients to reliably and safely use HTTP pipelining in these situations.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Requirements</a>
</li>
<li>3.   <a href="#rfc.section.3">HTTP Pipelining Issues</a>
</li>
<li>4.   <a href="#rfc.section.4">Blacklisting Origin Servers</a>
</li>
<li>5.   <a href="#rfc.section.5">Discovering Faulty Proxies</a>
</li>
<li>6.   <a href="#rfc.section.6">Correlating Responses</a>
</li>
<li>7.   <a href="#rfc.section.7">Hinting Pipelinable Content</a>
</li>
<li>8.   <a href="#rfc.section.8">Indicating Blocking Responses</a>
</li>
<li>9.   <a href="#rfc.section.9">Handling Pipelining Problems</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Acknowledgements</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Frequently Asked Questions</a>
</li>
<li>Appendix C.   <a href="#rfc.appendix.Appendix%20C">Changes</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">HTTP/1.1 <a href="#RFC2616">[RFC2616]</a> added pipelining -- that is, the ability to have more than one outstanding request on a connection at a particular time -- to improve performance when many requests need to be made (e.g., when an HTML page references several images).</p>
<p id="rfc.section.1.p.2">Although not usable in all circumstances (POST and other non-idempotent requests cannot be pipelined), for the common case of Web browsing, pipelining seems at first like a broadly useful improvement -- especially since the number of TCP connections browsers and servers can use for a given interaction is limited, and especially where there is noticeable latency present.</p>
<p id="rfc.section.1.p.3">Indeed, in constrained applications of HTTP such as Subversion, pipelining has been shown to improve end-user perceived latency considerably.</p>
<p id="rfc.section.1.p.4">However, pipelining is not broadly used on the Web today; while most (but not all) servers and intermediaries support pipelining (to varying degrees), only one major Web browser uses it in its default configuration, and that implementation is reported to use a number of proprietary heuristics to determine when it is safe to pipeline.</p>
<p id="rfc.section.1.p.5">This memo characterises issues currently encountered in the use of HTTP pipelining, and suggests mechanisms that are designed to make its use more reliable and safe for browsers.</p>
<p id="rfc.section.1.p.6">Note that this memo does not suggest drastic changes to HTTP, nor does it require that intermediaries change to better support pipelining. Instead, it takes the position that removing the responsibility for making pipelining decisions from browsers, as well as reduce associated risks for browsers, we make it more likely that browsers will support it.</p>
<p id="rfc.section.1.p.7">This memo should be discussed on the ietf-http-wg@w3.org mailing list, although it is not a work item of the HTTPbis WG. Reviewers are encouraged to pay particular attention to items marked FEEDBACK.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Requirements</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> HTTP Pipelining Issues</h1>
<p id="rfc.section.3.p.1">Anecdotal evidence suggests there are a number of reasons why clients don't use HTTP pipelining by default. Briefly, they are: </p>

<ol>
<li>Balking Servers - server implementations can stall pipelined requests, or close their connection when the client attempts to pipeline. This is one of the most commonly cited problems.</li>
<li>Confused Servers - a few server implementations can respond to pipelined requests in the wrong order. Even fewer might corrupt the actual responses. Because this has security implications (consider multiple users behind such a proxy, or multiple tabs in a browser), this is very concerning.</li>
<li>Head-of-Line Blocking - Clients don't have enough information about what is useful to pipeline. A given response may take an inordinate amount of time to generate, and/or be large enough to block subsequent responses. Clients who pipeline may face worse performance if they stack requests behind such an expensive request.</li>
</ol>

<p> </p>
<p id="rfc.section.3.p.2">Note that here, "servers" can also include proxies and other intermediaries, including so-called "transparent" proxies (also known as intercepting proxies).</p>
<p id="rfc.section.3.p.3">The remainder of this memo proposes mechanisms that can be used to mitigate one or more of these problems; not all of them will survive discussion and implementation.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Blacklisting Origin Servers</h1>
<p id="rfc.section.4.p.1">To address balking and confused origin servers, a client SHOULD maintain a blacklist of origins that it does not attempt pipelining with.</p>
<p id="rfc.section.4.p.2">Such a blacklist MAY be populated by external information (e.g., a list of known-bad servers maintained by the browser vendor), and when pipelining has been detected to fail to the origin.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Discovering Faulty Proxies</h1>
<p id="rfc.section.5.p.1">When a balking or confused server is a proxy, pipelining won't work for any requests sent through it. Therefore, clients SHOULD test the network for such proxies periodically.</p>
<p id="rfc.section.5.p.2">This can be done by sending pipelined requests to a known server, and examining the responses for errors.</p>
<p id="rfc.section.5.p.3">For example, if the ExampleBrowser implementation wishes to probe for faulty proxies, it can send a series of requests to "http://browser.example.com/pipeline-test/" and subresources. If the bodies of the resulting responses deviate from those it expects in any way, it is reasonable to assume that a faulty proxy is present, and pipelining SHOULD NOT be used through it.</p>
<p id="rfc.section.5.p.4">RECOMMENDED measures in such tests include:</p>
<p></p>

<ul>
<li>Sending a non-trivial number of pipelined requests (e.g., 10)</li>
<li>Sending multiple pipelined requests in the same packet</li>
<li>Inserting request bodies with various sizes</li>
<li>Assuring that caching is disabled, so that requests are end-to-end</li>
<li>Sending a variety of responses types that includes 100 and 304 responses</li>
<li>Examining responses to assure that they all appear in the correct order</li>
<li>Examining received requests and responses to assure that they aren't unduly modified</li>
</ul>
<p id="rfc.section.5.p.6">These tests SHOULD be performed by clients (both user agent and proxy) upon startup, as well as periodically afterwards to assure that a new intercepting proxy hasn't been interposed. They MAY be performed after a pipelining problem is detected, to determine whether the issue is proxy- related.</p>
<p id="rfc.section.5.p.7">See <a href="https://github.com/mnot/pipeline-surveyor">https://github.com/mnot/pipeline-surveyor</a> for an example implementation.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Correlating Responses</h1>
<p id="rfc.section.6.p.1">HTTP relies on the context of the connection to associate a given request with its intended response. In HTTP/1.0, this was a reasonable assumption, since only one request could be outstanding at a given time, and each request had exactly one response.</p>
<p id="rfc.section.6.p.2">HTTP/1.1 made associating requests and responses in a given connection more complex (and therefore fault-prone). Not only does pipelining mean that multiple requests can be outstanding, but also the 1xx series of response status codes introduce the possibility of multiple response messages (syntactically) being associated with a single request.</p>
<p id="rfc.section.6.p.3">To improve the client's ability to correlate responses with their requests and identify confused origin and proxy servers (as well as serve other potential use cases), this memo introduces the "Assoc-Req" response header field.</p>
<div id="#rfc.figure.1"></div>
<pre>
Assoc-Req   = "Assoc-Req" ":" OWS Assoc-Req-v
Assoc-Req-v = Method SP absolute-URI
</pre>
<p id="rfc.section.6.p.4">The field-value of the Assoc-Req header field is the method and effective request URI of the request associated with the response that it appears in. The URI used MUST be generated using the algorithm for finding the Effective Request URI in <a href="#I-D.ietf-httpbis-p1-messaging">[I-D.ietf-httpbis-p1-messaging]</a>. The header field MUST NOT be generated by proxies.</p>
<p id="rfc.section.6.p.5">For example, given the following request over port 80:</p>
<div id="#rfc.figure.2"></div>
<pre>
GET /foo?it HTTP/1.1
Host: www.example.com
</pre>
<p id="rfc.section.6.p.6">the appropriate Assoc-Req header field would be:</p>
<div id="#rfc.figure.3"></div>
<pre>
Assoc-Req: GET http://www.example.com/foo?it
</pre>
<p id="rfc.section.6.p.7">Note that the Assoc-Req header field is not a perfectly reliable identifier for the request associated with a response; for example, it does not incorporate the selecting headers for content negotiation <a href="#I-D.ietf-httpbis-p6-cache">[I-D.ietf-httpbis-p6-cache]</a>, nor does it differentiate request bodies, when present. However, for the purposes of making pipelining more reliable, it is sufficient.</p>
<p id="rfc.section.6.p.8">A client wishing to use the Assoc-Req response header field to aid in identifying problems in pipelining can compare its values to those of the request that it believes it to be associated with (based upon HTTP's message parsing rules, defined in <a href="#I-D.ietf-httpbis-p1-messaging">[I-D.ietf-httpbis-p1-messaging]</a>). If either the method or the URI differ, it indicates that there may be a pipelining-related issue, and the origin server (identified by its (host, port) tuple) SHOULD be blacklisted.</p>
<p id="rfc.section.6.p.9">A client MAY choose to blacklist any origin server that does not send the Assoc-Req header.</p>
<p id="rfc.section.6.p.10">FEEDBACK: Omitting the URI scheme and authority (i.e., just making it the path and query components) would make the header easier to generate and avoid some false positives (e.g., when a "reverse proxy" or other URI rewriter is present), but may fail to identify cases where two requests are confused (consider requests for "http://example.com/style.css" and "https://foo.example.net/style.css").</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Hinting Pipelinable Content</h1>
<p id="rfc.section.7.p.1">It's necessary to assist clients in determining what requests are suitable for pipelining, so that the sole responsibility for deciding what and when to pipeline isn't theirs. This can be done through origin server hinting.</p>
<p id="rfc.section.7.p.2">Such hints indicates URLs that, when dereferenced, will likely not incur significant latency on the server in generating the response, nor significant latency on the network in transferring the response.</p>
<p id="rfc.section.7.p.3">What is "significant" is determined by the server. Clients will use these hints to determine what request(s) it is safe to pipeline something else after.</p>
<p id="rfc.section.7.p.4">For example, if "http://example.com/a" is hinted, a client can be more confident pipelining another request (e.g., to "http://example.com/b") on the same connection afterwards.</p>
<p id="rfc.section.7.p.5">There are several possible ways that content could be hinted, including: </p>

<ul>
<li>The "quick" link relation type can appear on individual HTML elements such as "img", "script" and "link" to indicate that the link they contain has low overhead.  </li>
<li>A similar link relation could also be used in the HTTP link header to indicate "quick" links within the response in a format-neutral way.</li>
<li>A server can indicate that all its resources are suitable for pipelining by returning a successful response status code (2xx) to requests for the path "/.well-known/pipeline". In the future, a format available at this location could give more fine-grained information.</li>
</ul>

<p> </p>
<p id="rfc.section.7.p.6">FEEDBACK: thoughts on the suitability of these hinting mechanisms is encouraged, so that the list can eventually be narrowed down.</p>
<p id="rfc.section.7.p.7">A user agent MAY have a policy of only pipelining to hinted resources.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Indicating Blocking Responses</h1>
<p id="rfc.section.8.p.1">An alternate way to avoid head-of-line blocking is for the origin server to aggressively indicate when a request would block.</p>
<p id="rfc.section.8.p.2">This can be done by using a new HTTP status code, 430 WOULD BLOCK.</p>
<p id="rfc.section.8.p.3">The meaning of "would block" is defined by the server; e.g., it may return this code when the response is known to be over a certain size, or when the code to generate the response is known to take a long time to execute.</p>
<p id="rfc.section.8.p.4">When a client (user agent or intermediary) receives a 430 WOULD BLOCK, it SHOULD resubmit the associated request on a new or idle connection.</p>
<p id="rfc.section.8.p.5">An origin server MUST NOT send a 430 WOULD BLOCK status code to clients that do not include a "PWB: 1" (mnemonic: Pipelining Would Block) request header. User Agents that support the status code SHOULD send this header, and intermediaries that are willing to handle its processing MAY append it to requests that do not already include it.</p>
<p id="rfc.section.8.p.6">A cache MUST NOT store a 430 WOULD BLOCK response, and origin servers SHOULD mark them as explicitly uncacheable (e.g., with Cache-Control: no-store).  </p>
<p id="rfc.section.8.p.7">FEEDBACK: This is a relatively new idea; thoughts? In some ways it's easier to deploy, but it does add a certain amount of latency to requests that block. Theoretically, a Location header could be added to redirect the client to a place where the generated response will be waiting (if the blocking is caused by server-side think time), but this may be impractical to implement.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Handling Pipelining Problems</h1>
<p id="rfc.section.9.p.1">Upon encountering an indication of pipelining problems with a particular response (e.g., an incorrect Assoc-Req field-value, a pipelined response that stalls), user agents SHOULD discard the response in question, all subsequent responses on the same connection, and close the connection. Unsatisfied requests can be resubmitted, without pipelining, and the implementation can choose not to use pipelining to the same server in the future (see "Blacklisting Origin Servers").</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Security Considerations</h1>
<p id="rfc.section.10.p.1">TBD</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> IANA Considerations</h1>
<p id="rfc.section.11.p.1">TBD</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-httpbis-p1-messaging">[I-D.ietf-httpbis-p1-messaging]</b></td>
<td class="top">
<a>Fielding, R</a>, <a>Gettys, J</a>, <a>Mogul, J</a>, <a>Nielsen, H</a>, <a>Masinter, L</a>, <a>Leach, P</a>, <a>Berners-Lee, T</a> and <a>J Reschke</a>, "<a href="http://tools.ietf.org/html/draft-ietf-httpbis-p1-messaging-12">HTTP/1.1, part 1: URIs, Connections, and Message Parsing</a>", Internet-Draft draft-ietf-httpbis-p1-messaging-12, October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-httpbis-p6-cache">[I-D.ietf-httpbis-p6-cache]</b></td>
<td class="top">
<a>Fielding, R</a>, <a>Gettys, J</a>, <a>Mogul, J</a>, <a>Nielsen, H</a>, <a>Masinter, L</a>, <a>Leach, P</a>, <a>Berners-Lee, T</a> and <a>J Reschke</a>, "<a href="http://tools.ietf.org/html/draft-ietf-httpbis-p6-cache-12">HTTP/1.1, part 6: Caching</a>", Internet-Draft draft-ietf-httpbis-p6-cache-12, October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Acknowledgements</h1>
<p id="rfc.section.Appendix A.p.1">Thanks to Ilya Grigorik, Anirban Kundu, Patrick McManus and Julian Reschke.  The author takes all responsibility for errors and omissions.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> Frequently Asked Questions</h1>
<p id="rfc.section.Appendix B.p.1">Isn't full multiplexing better?</p>
<p id="rfc.section.Appendix B.p.2">While "full" multiplexing is theoretically better, pipelining -- once usable -- is adequate for almost all common Web browsing cases.  Since the browser needs to download HTML first, it has an opportunity to receive hints about subsequent requests and pipeline them appropriately. Likewise, by far the most common case for multiplexing on the Web is when a large number of images and other page assets need to be fetched with GET; a perfect use of pipelining, provided that the client has enough information to avoid head-of-line blocking.</p>
<p id="rfc.section.Appendix B.p.3">Why not have the client generate a unique request identifier?</p>
<p id="rfc.section.Appendix B.p.4">While in some ways this would be easier than the approach that the Assoc-Req header takes, it would be more difficult to deploy, because existing caching proxies wouldn't be able to serve the correct identifier when using a cached response.</p>
<h1 id="rfc.appendix.Appendix C">
<a href="#rfc.appendix.Appendix%20C">Appendix C.</a> Changes</h1>
<p id="rfc.section.Appendix C.p.1">draft -00 to draft -01:</p>
<p></p>

<ul>
<li>Add guidelines for blacklisting</li>
<li>Remove advice on signature checking (for now)</li>
<li>Clarified problem statement</li>
<li>Rearranged</li>
<li>Added 430 WOULD BLOCK</li>
</ul>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mark Nottingham</span> 
	  <span class="n hidden">
		<span class="family-name">Nottingham</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a></span>

<span class="vcardline">URI: <a href="http://www.mnot.net/">http://www.mnot.net/</a></span>

  </address>
</div>

</body>
</html>