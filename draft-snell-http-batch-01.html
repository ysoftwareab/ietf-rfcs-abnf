<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>HTTP Multipart Batched Request Format</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="HTTP Multipart Batched Request Format">
<meta name="keywords" content="I-D, http, batch, mime, multipart">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Individual Submission</td><td class="header">J. Snell</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">IBM</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">June 12, 2009</td></tr>
<tr><td class="header">Expires: December 14, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />HTTP Multipart Batched Request Format<br />draft-snell-http-batch-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on December 14, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document specifies a format for packaging multiple, independent 
      HTTP requests into a single multipart payload.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#multipart-http">2.</a>&nbsp;
The Multipart/Http Content Type<br />
<a href="#anchor1">3.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.1.</a>&nbsp;
The 'Multipart/Batch' Content-Type<br />
<a href="#anchor3">4.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">5.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This specification defines a format for packaging multiple, independent
      HTTP requests into a single multipart MIME payload.  The intent is to 
      provide applications with a method of grouping sets of individual HTTP
      requests for processing as a unit. This approach is designed to work around a number of 
      limitations that currently exist in HTTP pipelining, such as the inability to pipeline 
      a mix of idempotent and non-idempotent requests.  In addition, it addresses the inability 
      of a server to determine the completeness and optimum order of processing for a logical 
      collection of requests before attempting to process any of the individual requests. 
      Note that batching HTTP requests using the mechanism defined here, is not intended 
      to replace pipelining.
</p>
<p>In this document, the key words "MUST", "MUST NOT", "REQUIRED", "SHALL", 
      "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" 
      are to be  interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="multipart-http"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
The Multipart/Http Content Type</h3>

<p>The multipart/http media type is a new subtype of MIME multipart
      message in which the body parts are either HTTP request or response 
      messages. A multipart/http message MUST NOT contain a mixture of both 
      request and response messages.
</p>
<p>In addition to the boundary parameter required for all Multipart
      message types, the multipart/http type has two additional optional 
      parameters: "msgtype" and "version".
</p>
<p>The "msgtype" parameter value specifies either "request" or "response" 
      and indicates the type of the enclosed messages.
</p>
<p>The "version" parameter value specifies the HTTP Version (e.g. "1.1") 
      of the enclosed messages. If not present, the version can be determined by 
      examining each individual request part. All of the enclosed messages MUST 
      be of the same HTTP Version.
</p>
<p>The following illustrates an example multipart/http message 
      containing two HTTP Request messages.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    POST /example/application HTTP/1.1
    Host: example.org
    Content-Length: 123832
    Content-Type: multipart/http;version=1.1;
      msgtype=request;boundary=batch
    Mime-Version: 1.0

    --batch
    Content-ID: &lt;df536860-34f9-11de-b418-0800200c9a66@example.org&gt;

    POST /example/application HTTP/1.1
    Host: example.org
    Authorization: Basic amFtZXM6c25lbGw=
    Content-Type: text/plain
    Content-Length: 3

    Foo
    --batch
    Content-ID: &lt;226e35d0-34fa-11de-b418-0800200c9a66@example.org&gt;

    PUT /example/application/resource HTTP/1.1
    Host: example.org
    Authorization: Basic amFtZXM6c25lbGw=
    Content-Type: image/jpg
    Content-Length: 123456

    {jpg image data}
    --batch
    Content-ID: &lt;22fe12d0-ef12-e1de-c456-0834212c9a88@example.org&gt;

    GET /example/application/resource2 HTTP/1.1
    Host: example.org
    Authorization: Basic amFtZXM6c25lbGw=
    --batch--
</pre></div>
<p>A multipart/http message containing HTTP request messages is called a
      Batch Request.  A multipart/http message containing HTTP response
      messages is called a Batch Response.
</p>
<p>A client application creates an Batch Request message with one or more 
      individual HTTP requests and transmits that to the server as the payload 
      of another HTTP request message as illustrated in Listing 1. 
      Each body part MUST specify a Content-ID header specifying a reference 
      identifier for the individual request message.
</p>
<p>The server receives the Batch Request and processes each
      body part in any order the server determines to be appropriate.
</p>
<p>Upon processing the Batch Request, the server will generate a Batch
      Response message containing one HTTP response message for every message
      in the request. Each part of Batch Response MUST contain a Content-ID header 
      specifying the value of the Content-ID of the matching request. Client 
      applications MUST NOT assume that the ordering of responses in 
      the Batch Response matches the ordering of requests in the Batch Request 
      and MUST use the Content-ID header values to correlate request and 
      response messages.
</p>
<p>A server need not wait until all batched requests have been processed
      to create and begin sending the Batch Response back to the client.
</p>
<p>The example below contains a Batch Response for the Batch Request in
      Listing 1.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    HTTP/1.1 200 OK
    Date: Wed, 29 Apr 2009 20:00:00 GMT
    Content-Length: 291
    Content-Type: multipart/http;version=1.1
      ;msgtype=request;boundary=batch
    Mime-Version: 1.0

    --batch
    Content-ID: &lt;226e35d0-34fa-11de-b418-0800200c9a66@example.org&gt;

    HTTP/1.1 415 Unsupported Media Type
    Date: Wed, 29 Apr 2009 20:00:00 GMT
    --batch
    Content-ID: &lt;22fe12d0-ef12-e1de-c456-0834212c9a88@example.org&gt;

    HTTP/1.1 401 Unauthorized
    Date: Wed, 29 Apr 2009 20:00:00 GMT
    --batch
    Content-ID: &lt;df536860-34f9-11de-b418-0800200c9a66@example.org&gt;

    HTTP/1.1 204 OK
    Date: Wed, 29 Apr 2009 20:00:00 GMT
    --batch--
</pre></div>
<p>A server MUST determine the status of an HTTP request containing a 
      Batch Request based solely on its ability to successfully process the 
      Batch Request as a whole and not on the status of each individual 
      contained message. For instance, if the server is capable of understanding 
      and processing the Batched Request, even if some or all of the contained requests 
      fail individually, the server SHOULD respond with a status of either 
      200 OK or 202 Accepted. The 201 Created, 204 No Content, 205 Reset 
      Content, and 206 Partial Content responses are not appropriate responses 
      for a successfully processed batch request.
</p>
<p>While it is possible for Batch Request and Batch Response messages to
      be transferred using Chunked Transfer Coding, the individual HTTP request 
      and response messages contained within MUST NOT use Chunked Transfer Coding.
</p>
<p>Batch Responses are not cacheable. Individual HTTP response messages
      contained within the Batch Response might be cacheable.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IANA Considerations</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
The 'Multipart/Batch' Content-Type</h3>

<p></p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
    Media Type Name: multipart
    Media Subtype Name: http
    Required Parameters:
      boundary: The standard MIME boundary parameter
    Optional Parameters:
      version: The HTTP-Version number of the enclosed messages
               (e.g., "1.1")
      msgtype: The message type -- "request" or "response"
    Encoding considerations:
      HTTP messages enclosed by this type are in "binary" format
    Security considerations: Depends on the batched content-type
    Published specification: This document
    Contact: James M Snell
             jasnell@us.ibm.com
             877-511-5082
</pre></div><p>

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>It is possible that a malicious client could attempt to bypass 
      security policies by batching requests that otherwise would have 
      been blocked by protective firewalls, proxies and server configurations. 
      Applications supporting batched requests must be prepared to deal with such 
      requests and should be implemented so that security policies are 
      properly enforced on batched requests.
</p>
<p>TODO: Discussion about how each batched request must be processed
      separately when it comes to applying security rules. Each has it's own
      authentication and authorization. A batched request must not inherit the
      authentication/authorization of the containing Multipart Batch Request
      or the other requests in the batch.  Just because a user is authorized
      to submit a batch of requests, that doesn't mean they are authorized to
      submit any of the individually batched requests.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>5.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">James M Snell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hanford, CA  93230</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jasnell@us.ibm.com">jasnell@us.ibm.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.ibm.com">http://www.ibm.com</a></td></tr>
</table>
</body></html>
