<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Path MTU Discovery Using Session Traversal Utilities for NAT (STUN)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Path MTU Discovery Using Session Traversal Utilities for NAT (STUN)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">M. Petit-Huguenin</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">(Unaffiliated)</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">March 09, 2009</td></tr>
<tr><td class="header">Expires: September 10, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Path MTU Discovery Using Session Traversal Utilities for NAT (STUN)<br />draft-petithuguenin-behave-stun-pmtud-03</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
				This document describes a Session Traversal Utilities for NAT (STUN) usage for discovering the path MTU between a client and a server.
			
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Probing Mechanisms<br />
<a href="#anchor4">4.</a>&nbsp;
Simple Probing Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Sending a Probe Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Receiving a Probe Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Receiving a Probe Response<br />
<a href="#anchor8">5.</a>&nbsp;
Complete Probing Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.1.</a>&nbsp;
Sending the Probe Indications and Report Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.2.</a>&nbsp;
Receiving an ICMP packet<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.3.</a>&nbsp;
Receiving a Probe Indication and Report Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.4.</a>&nbsp;
Receiving a Report Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.5.</a>&nbsp;
Using Checksum as Packet Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.6.</a>&nbsp;
Using Sequential Numbers as Packet Identifiers<br />
<a href="#mechanisms">6.</a>&nbsp;
Probe Support Discovery Mechanisms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.1.</a>&nbsp;
Implicit Mechanism<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.2.</a>&nbsp;
Probe Support Discovery with TURN<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.3.</a>&nbsp;
Probe Support Discovery with ICE<br />
<a href="#anchor18">7.</a>&nbsp;
New STUN Method<br />
<a href="#anchor19">8.</a>&nbsp;
New STUN Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">8.1.</a>&nbsp;
IDENTIFIERS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.2.</a>&nbsp;
PMTUD-SUPPORTED<br />
<a href="#anchor22">9.</a>&nbsp;
Security Considerations<br />
<a href="#anchor23">10.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor24">11.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#anchor27">Appendix&nbsp;A.</a>&nbsp;
Release notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">A.1.</a>&nbsp;
Modifications between -03 and -02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">A.2.</a>&nbsp;
Modifications between -02 and -01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">A.3.</a>&nbsp;
Modifications between -01 and -00<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
				<a class='info' href='#RFC4821'>The Packetization Layer Path MTU Discovery specification<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> [RFC4821] describes a method to discover the path MTU but does not describe a practical protocol to do so with UDP.
			
</p>
<p>
				This document only describe how probing mechanisms are implemented with STUN.
				The algorithm to find the path MTU is described in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a>.
			
</p>
<p>
				Two probing mechanisms are described, a simple probing mechanism and a more complete mechanism that can converge quicker.
			
</p>
<p>
				The simple probing mechanism is implemented by sending a Probe Request with a <a class='info' href='#I-D.ietf-behave-nat-behavior-discovery'>PADDING<span> (</span><span class='info'>MacDonald, D. and B. Lowekamp, &ldquo;NAT Behavior Discovery Using STUN,&rdquo; March&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;behave&#8209;nat&#8209;behavior&#8209;discovery] attribute and the DF bit set over UDP.
				A router on the path to the server can reject this request with an ICMP message or drop it.
				The client SHOULD cease retransmissions after 3 missing responses.
			
</p>
<p>
				The complete probing mechanism is implemented by sending one or more Probe Indication with a PADDING attribute and the DF bit set over UDP then a Report Request to the same server.
				A router on the path to the server can reject this indication with an ICMP message or drop it.
				The server keeps a time ordered list of identifiers of all packets received (including retransmitted packets) and sends this list back to the client in the Report Response.
				The client analyzes this list to find which packets were not received.
				Because UDP packets does not contain an identifier, the complete probing mechanism needs a way to identify each packet received.  As example, this document describes two different ways to identify a specific packet.
			
</p>
<p>
				In the first packet identifier mechanism, the server computes a checksum over each packet received and sends back to the sender the ordered list of checksums.
				The client compares this list to its own list of checksums.
			
</p>
<p>
				In the second packet identifier mechanism, the client adds a sequential number in front of each UDP packet sent.
				The server sends back the ordered list of sequential numbers received that the client compares to its own list
			
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
				The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
			
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Probing Mechanisms</h3>

<p>
				A client MUST NOT send a probe if it does not have knowledge that the server supports this specification.
				This is done by an external mechanism specific to each UDP protocol.
				<a class='info' href='#mechanisms'>Section&nbsp;6<span> (</span><span class='info'>Probe Support Discovery Mechanisms</span><span>)</span></a> describes some of this mechanisms.
			
</p>
<p>
				The probe mechanism is used to discover the path MTU in one direction only, from the client to the server.
			
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Simple Probing Mechanism</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Sending a Probe Request</h3>

<p>
					A client forms a Probe Request by following the rules in Section 7.1 of <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
					No authentication method is used.
					The client adds a <a class='info' href='#I-D.ietf-behave-nat-behavior-discovery'>PADDING<span> (</span><span class='info'>MacDonald, D. and B. Lowekamp, &ldquo;NAT Behavior Discovery Using STUN,&rdquo; March&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;behave&#8209;nat&#8209;behavior&#8209;discovery] attribute with a length that, when added to the IP and UDP headers and the other STUN components, is equal to the Selected Probe Size, as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.3.
					The client MUST add the FINGERPRINT attribute.
				
</p>
<p>
					Then the client sends the Probe Request to the server over UDP with the DF bit set.
					The client SHOULD stop retransmitting after 3 missing responses. 
				
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Receiving a Probe Request</h3>

<p>
					A server receiving a Probe Request MUST process it as specified in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
					The server MUST NOT challenge the client.
				
</p>
<p>
					The server then creates a Probe Response.
					The server MUST add the FINGERPRINT attribute.
					The server then sends the response to the client.
				
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Receiving a Probe Response</h3>

<p>
					A client receiving a Probe Response MUST process it as specified in  <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
					If a response is received this is interpreted as a Probe Success as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.6.1.
					If an ICMP packet "Fragmentation needed" is received then this is interpreted as a Probe Failure as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.6.2.
					If the Probe transactions fails in timeout, then this is interpreted as a Probe Inconclusive as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.6.4.
				
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Complete Probing Mechanism</h3>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Sending the Probe Indications and Report Request</h3>

<p>
					A client forms a Probe Indication by following the rules in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a> section 7.1.
					The client adds to the Probe Indication a PADDING attribute with a size that, when added to the IP and UDP headers and the other STUN components, is equal to the Selected Probe Size, as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.3.
					The client MUST add the FINGERPRINT attribute.
				
</p>
<p>
					Then the client sends the Probe Indication to the server over UDP with the DF bit set.
				
</p>
<p>
					Then the client forms a Report Request by following the rules in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a> section 7.1.  
					No authentication method is used.
					The client MUST add the FINGERPRINT attribute.
				
</p>
<p>
					Then the client waits half the RTO if it is known or 50 milliseconds after sending the Probe Indication and sends the Report Request to the server over UDP.
				
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Receiving an ICMP packet</h3>

<p>
					If an ICMP packet "Fragmentation needed" is received then this is interpreted as a Probe Failure as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> section 7.5.
				
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Receiving a Probe Indication and Report Request</h3>

<p>
					A server supporting this specification and knowing that the client also supports it will keep the identifiers of all packets received in a list ordered by receiving time.
					The same identifier can appear multiple times in the list because of retransmission.
					The maximum size of this list is calculated so that when the list is added to the Report Response, the total size of the packet does not exceed the unknown path MTU as defined in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a> section 7.1.
					Older identifiers are removed when new identifiers are added to a list already full.
				
</p>
<p>
					A server receiving a Report Request MUST process it as specified in <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
					The server MUST NOT challenge the client.
				
</p>
<p>
					The server creates a Report Response and adds an IDENTIFIERS attribute that contains the list of all identifiers received so far.
					The server MUST add the FINGERPRINT attribute.
					The server then sends the response to the client.
				
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Receiving a Report Response</h3>

<p>
					A client receiving a Report Response processes it as specified in  <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>.
					If the response IDENTIFIERS attribute contains the identifier of the Probe Indication, then this is interpreted as a Probe Success for this probe as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> Section 7.5.
					If the Probe Indication identifier cannot be found in the Report Response, this is interpreted as a Probe Failure as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> Section 7.5.
					If the Probe Indication identifier cannot be found in the Report Response but other packets identifier sent before or after the Probe Indication cannot also be found, this is interpreted as a Probe Inconclusive as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> Section 7.5.
					If the Report Transaction fails in timeout, this is interpreted as a Full-Stop Timeout as defined in <a class='info' href='#RFC4821'>[RFC4821]<span> (</span><span class='info'>Mathis, M. and J. Heffner, &ldquo;Packetization Layer Path MTU Discovery,&rdquo; March&nbsp;2007.</span><span>)</span></a> Section 3.
				
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Using Checksum as Packet Identifiers</h3>

<p>
					When using checksum as packet identifiers, the client calculate the checksum for each packet sent over UDP and keep this checksum in an ordered list.
					The server does the same thing and send back this list in the Report Response.
				
</p>
<p>
					It could have been possible to use the checksum generated in the UDP checksum for this, but this value is generally not accessible to applications.
					Also sometimes the checksum is not calculated or off-loaded to the network card.
				
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Using Sequential Numbers as Packet Identifiers</h3>

<p>
					When using sequential numbers, a small header similar to the TURN ChannelData header is added in front of all non-STUN packets.
					The sequential number is incremented for each packet sent.
					The server collects the sequence number of the packets sent.
				
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Channel Number        |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Sequence number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
/                       Application Data                        /
/                                                               /
|                                                               |
|                               +-------------------------------+
|                               |
+-------------------------------+
</pre></div>
<p>The Channel Number is always 0xFFFF.
</p>
<a name="mechanisms"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Probe Support Discovery Mechanisms</h3>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Implicit Mechanism</h3>

<p>
					An endpoint acting as a client for the STUN usage described in this specification MUST also act as a server for this STUN usage.
					This means that a server receiving a probe can assumes that it can acts as a client to discover the path MTU to the IP address and port from which it received the probe.
				
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Probe Support Discovery with TURN</h3>

<p>
					A TURN client supporting this STUN usage will add a PMTUD-SUPPORTED attribute to the Allocate Request sent to the TURN server.
					The TURN server can immediately start to send probes to the TURN client on reception of an Allocation Request with a PMTUD-SUPPORTED attribute.
					The TURN client will then use the Implicit Mechanism described above to send probes.
				
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Probe Support Discovery with ICE</h3>

<p>
					An <a class='info' href='#I-D.ietf-mmusic-ice'>ICE<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address  Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a> [I&#8209;D.ietf&#8209;mmusic&#8209;ice] client supporting this STUN usage will add a PMTUD-SUPPORTED attribute to the Binding Request sent during a connectivity check.
					The ICE server can immediately start to send probes to the ICE client on reception of a Binding Request with a PMTUD-SUPPORTED attributed.
					Local candidates receiving Binding Request with the PMTUD-SUPPORTED flag must not start PMTUD with the remote candidate if already done so.
					The ICE client will then use the Implicit Mechanism described above to send probes.
				
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
New STUN Method</h3>

<p>
				This specification defines the following new STUN methods:
			
</p>
<p>
				</p>
<blockquote class="text">
<p>0x801 : Probe
</p>
<p>0x802 : Report
</p>
</blockquote><p>
			
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
New STUN Attributes</h3>

<p>
				This specification defines the following new STUN attributes:
			
</p>
<p>
				</p>
<blockquote class="text">
<p>0x4001 : IDENTIFIERS
</p>
<p>0xC001 : PMTUD-SUPPORTED
</p>
</blockquote><p>
			
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
IDENTIFIERS</h3>

<p>
					The IDENTIFIERS attribute is used in Report Response.
					It contains a list of UDP packet identifiers.
				
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
PMTUD-SUPPORTED</h3>

<p>
					The PMTUD-SUPPORTED attribute is used in STUN usages and extensions to signal the support of this specification.
					This attribute has no content.
				
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>
				TBD
			
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>
				TBD
			
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>Thanks to Dan Wing and Eilon Yardeni for their comments, suggestions and questions that helped to improve this document.
</p>
<p>This document was written with the xml2rfc tool described in <a class='info' href='#RFC2629'>[RFC2629]<span> (</span><span class='info'>Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="ftp://ftp.isi.edu/in-notes/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4821">[RFC4821]</a></td>
<td class="author-text">Mathis, M. and J. Heffner, &ldquo;<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>,&rdquo; RFC&nbsp;4821, March&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4821.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="ftp://ftp.isi.edu/in-notes/rfc5389.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address  Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2629">[RFC2629]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999 (<a href="ftp://ftp.isi.edu/in-notes/rfc2629.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2629.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2629.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-nat-behavior-discovery">[I-D.ietf-behave-nat-behavior-discovery]</a></td>
<td class="author-text">MacDonald, D. and B. Lowekamp, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-nat-behavior-discovery-06.txt">NAT Behavior Discovery Using STUN</a>,&rdquo; draft-ietf-behave-nat-behavior-discovery-06 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-nat-behavior-discovery-06.txt">TXT</a>).</td></tr>
</table>

<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Release notes</h3>

<p>
				This section must be removed before publication as an RFC.
			
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Modifications between -03 and -02</h3>

<p>
					</p>
<ul class="text">
<li>Changed author address.
</li>
<li>Changed the IPR to trust200902.
</li>
</ul><p>
				
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Modifications between -02 and -01</h3>

<p>
					</p>
<ul class="text">
<li>Replaced the transactions identifiers by packet identifiers
</li>
<li>Defined checksum and sequential numbers as possible packet identifiers.
</li>
<li>Updated the reference to RFC 5389
</li>
<li>The FINGERPRINT attribute is now mandatory.
</li>
<li>Changed the delay between Probe indication and Report request to be RTO/2 or 50 milliseconds.
</li>
<li>Added ICMP packet processing.
</li>
<li>Added Full-Stop Timeout detection.
</li>
<li>Stated that Binding request with PMTUD-SUPPORTED does not start the PMTUD process if already started.
</li>
</ul><p>
				
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Modifications between -01 and -00</h3>

<p>
					</p>
<ul class="text">
<li>
							Removed the use of modified STUN transaction but shorten the retransmission for the simple probing mechanism.
						
</li>
<li>
							Added a complete probing mechanism.
						
</li>
<li>
							Removed the PADDING-RECEIVED attribute.
						
</li>
<li>
							Added release notes.
						
</li>
</ul><p>
				
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marc Petit-Huguenin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">(Unaffiliated)</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:petithug@acm.org">petithug@acm.org</a></td></tr>
</table>
</body></html>
