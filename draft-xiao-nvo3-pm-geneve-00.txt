



NVO3 Working Group                                                X. Min
Internet-Draft                                                 G. Mirsky
Intended status: Standards Track                               ZTE Corp.
Expires: May 5, 2020                                       S. Pallagatti
                                                                  VMware
                                                        November 2, 2019


                   Performance Measurement for Geneve
                      draft-xiao-nvo3-pm-geneve-00

Abstract

   This document describes the method to achieve Performance Measurement
   (PM) in point-to-point Generic Network Virtualization Encapsulation
   (Geneve) tunnels that form an overlay network.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on May 5, 2020.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Min, et al.                Expires May 5, 2020                  [Page 1]

Internet-Draft                PM for Geneve                November 2019


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   2
     2.1.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   2
     2.2.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   3.  PM Packet Transmission over Geneve Tunnel . . . . . . . . . .   3
     3.1.  PM Encapsulation With Inner Ethernet/IP/UDP Headers . . .   3
     3.2.  PM Encapsulation With Inner IP/UDP Headers  . . . . . . .   5
     3.3.  PM Encapsulation With Inner MPLS Header . . . . . . . . .   7
   4.  Reception of PM packet from Geneve Tunnel . . . . . . . . . .   9
     4.1.  Demultiplexing of the PM packet . . . . . . . . . . . . .   9
   5.  Security Considerations . . . . . . . . . . . . . . . . . . .  10
   6.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  10
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  10
   8.  Normative References  . . . . . . . . . . . . . . . . . . . .  10
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  11

1.  Introduction

   "Generic Network Virtualization Encapsulation" (Geneve)
   [I-D.ietf-nvo3-geneve] provides an encapsulation scheme that allows
   building an overlay network by decoupling the address space of the
   attached virtual hosts from that of the network.

   This document describes the use of Packet Loss and Delay Measurement
   for MPLS Networks [RFC6374], as well as Simple Two-way Active
   Measurement Protocol [I-D.ietf-ippm-stamp], to enable measuring the
   performance of the path between two Geneve tunnel endpoints.

   In this document, NVE (Network Virtualization Edge) represents a
   Geneve tunnel endpoint, TS (Tenant System) represents a physical or
   virtual device attached to a Geneve tunnel endpoint, and VAP (Virtual
   Access Point) represents the NVE side of the interface between the
   NVE and the TS.

2.  Conventions Used in This Document

2.1.  Terminology

   GAL: Generic Associated Channel Label

   G-ACh: Generic Associated Channel

   Geneve: Generic Network Virtualization Encapsulation

   MPLS: Multiprotocol Label Switching




Min, et al.                Expires May 5, 2020                  [Page 2]

Internet-Draft                PM for Geneve                November 2019


   NVE: Network Virtualization Edge

   PM: Performance Measurement

   STAMP: Simple Two-way Active Measurement Protocol

   TS: Tenant System

   VAP: Virtual Access Point

   VNI: Virtual Network Identifier

2.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  PM Packet Transmission over Geneve Tunnel

   Analogous to what's specified in Section 3 of
   [I-D.xiao-nvo3-bfd-geneve], this document considers three options of
   PM packet encapsulation in Geneve:

   o  with Ethernet and IP/UDP encapsulation;

   o  with IP/UDP encapsulation;

   o  with MPLS encapsulation.

3.1.  PM Encapsulation With Inner Ethernet/IP/UDP Headers

   If the Protocol Type field (as defined in Section 3.4 of
   [I-D.ietf-nvo3-geneve]) of data packets indicates that an inner
   Ethernet header immediately follows the Geneve header, i.e., the
   Protocol Type equals to 0x6558 (Ethernet frame), then PM packets are
   encapsulated in Geneve as described below.












Min, et al.                Expires May 5, 2020                  [Page 3]

Internet-Draft                PM for Geneve                November 2019


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Outer Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer UDP Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Geneve Header                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Inner Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Inner IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Inner UDP Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        STAMP Test Packet                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               FCS                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


        Figure 1: Geneve Encapsulation of PM Message With the Inner
                          Ethernet/IP/UDP Header

   The STAMP test packet MUST be carried inside the inner Ethernet frame
   of the Geneve packet, immediately after the inner IP/UDP headers.
   The inner Ethernet frame carrying the STAMP Test Packet has the
   following format:





Min, et al.                Expires May 5, 2020                  [Page 4]

Internet-Draft                PM for Geneve                November 2019


      The Ethernet header and IP header are encoded as specified in
      Section 4 of [I-D.ietf-bfd-vxlan].

      The destination UDP port MUST be set the well-known port 862 as
      defined in [I-D.ietf-ippm-stamp].

   The STAMP Test Packet SHOULD be unauthenticated STAMP Session-Sender
   test packet or unauthenticated STAMP Session-Reflector test packet.
   The STAMP Test Packet is encoded as specified in
   [I-D.ietf-ippm-stamp] and [I-D.ietf-ippm-stamp-option-tlv].

   If the PM packets are encapsulated in Geneve as described above, the
   values in the Geneve header are set as follows:


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Ver|  Opt Len  |O|C|    Rsvd.  |          Protocol Type        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |        Virtual Network Identifier (VNI)       |    Reserved   |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Variable Length Options                    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


                          Figure 2: Geneve Header

      Opt Len field MUST be set to 0 to indicate that the header does
      not include any variable-length options.

      O bit MUST be set to 1, which indicates this packet contains a
      control message.

      C bit MUST be set to 0.

      Protocol Type field MUST be set to 0x6558 (Ethernet frame).

3.2.  PM Encapsulation With Inner IP/UDP Headers

   If the Protocol Type field (as defined in Section 3.4 of
   [I-D.ietf-nvo3-geneve]) of data packets indicates that an inner IP
   header immediately follows the Geneve header, i.e., the Protocol Type
   equals to 0x0800 (IPv4) or 0x86DD (IPv6), then PM packets are
   encapsulated in Geneve as described below.






Min, et al.                Expires May 5, 2020                  [Page 5]

Internet-Draft                PM for Geneve                November 2019


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Outer Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer UDP Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Geneve Header                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Inner IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         Inner UDP Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        STAMP Test Packet                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               FCS                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


    Figure 3: Geneve Encapsulation of PM Message With the Inner IP/UDP
                                  Header

   A STAMP test packet MUST be carried inside the inner IP/UDP packet
   that immediately follows the Geneve header.  The values in the inner
   IP packet carrying the STAMP Test Packet are as follows:

      The IP header is encoded as specified in Section 3.2 of
      [I-D.xiao-nvo3-bfd-geneve].

      The destination UDP port MUST be set the well-known port 862 as
      defined in [I-D.ietf-ippm-stamp].




Min, et al.                Expires May 5, 2020                  [Page 6]

Internet-Draft                PM for Geneve                November 2019


   The STAMP Test Packet SHOULD be unauthenticated STAMP Session-Sender
   test packet or unauthenticated STAMP Session-Reflector test packet.
   The STAMP Test Packet is encoded as specified in
   [I-D.ietf-ippm-stamp] and [I-D.ietf-ippm-stamp-option-tlv].

   When the PM packets are encapsulated in Geneve in this way, the
   Geneve header follows the value set below.

      Opt Len field MUST be set to 0 to indicate there isn't any
      variable-length option.

      O bit MUST be set to 1, which indicates this packet contains a
      control message.

      C bit MUST be set to 0.

      Protocol Type field MUST be set to 0x0800 (IPv4) or 0x86DD (IPv6),
      depending on the address family of the inner IP packet.

3.3.  PM Encapsulation With Inner MPLS Header

   If the Protocol Type field (as defined in Section 3.4 of
   [I-D.ietf-nvo3-geneve]) of data packets indicates that an MPLS label
   stack immediately follows the Geneve header, i.e., the Protocol Type
   equals to 0x8847 (MPLS) or 0x8848 (MPLS with the upstream-assigned
   label), then PM packets are encapsulated in Geneve, as described
   below.
























Min, et al.                Expires May 5, 2020                  [Page 7]

Internet-Draft                PM for Geneve                November 2019


    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                      Outer Ethernet Header                    ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer IPvX Header                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                        Outer UDP Header                       ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Geneve Header                        ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                 MPLS Interface Context Label                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                            MPLS GAL                           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                           MPLS G-ACh                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Loss Measurement Message,                  |
   ~                  Delay Measurement Message, or                ~
   |             Combined Loss/Delay Measurement Message           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               FCS                             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+


   Figure 4: Geneve Encapsulation of PM Message With the Inner MPLS GAL/
                                   G-ACh

   The Loss Measurement Message, Delay Measurement Message, or Combined
   Loss/Delay Measurement Message MUST be carried inside the inner MPLS
   packet that immediately follows the Geneve header.  The values in the
   inner MPLS packet carrying the Loss Measurement Message, Delay
   Measurement Message, or Combined Loss/Delay Measurement Message are
   as follows:

      The MPLS Interface Context Label and the MPLS GAL (Generic
      Associated Channel Label) are encoded as specified in Section 3.3
      of [I-D.xiao-nvo3-bfd-geneve].





Min, et al.                Expires May 5, 2020                  [Page 8]

Internet-Draft                PM for Geneve                November 2019


      The MPLS G-ACh (Generic Associated Channel) is encoded as
      specified in [RFC5586], and the "Channel Type" field of MPLS G-ACh
      MUST be set to 0x000A, 0x000C or 0x000D requested by [RFC6374],
      respectively indicating "MPLS Direct Loss Measurement", "MPLS
      Delay Measurement" or "MPLS Direct Loss and Delay Measurement".

      The Loss Measurement Message, Delay Measurement Message, and
      Combined Loss/Delay Measurement Message are encoded as specified
      in Sections 3.1 through 3.3 of [RFC6374].

   When the PM packets are encapsulated in Geneve in this way, the
   Geneve header follows the value set below.

      Opt Len field MUST be set to 0 to indicate there isn't any
      variable-length option.

      O bit MUST be set to 1, which indicates this packet contains a
      control message.

      C bit MUST be set to 0.

      Protocol Type field MUST be set to 0x8847 (MPLS).

4.  Reception of PM packet from Geneve Tunnel

   Once a packet is received, NVE MUST validate the packet as described
   in [I-D.ietf-nvo3-geneve] and Section 4 of
   [I-D.xiao-nvo3-bfd-geneve].

4.1.  Demultiplexing of the PM packet

   Similar to BFD over Geneve, multiple PM sessions may be running
   between two NVEs, so there needs to be a mechanism for demultiplexing
   received PM packets to the proper session.

   If the PM packet is received with Session Identifier value equals to
   0, for different PM encapsulation, the procedure for demultiplexing
   the received PM packets is different, which would follow the
   procedure for a BFD packet with Your Discriminator equals to 0, as
   specified in Section 4.1 of [I-D.xiao-nvo3-bfd-geneve].

   If the PM packet is received with a non-zero Session Identifier, then
   PM session MUST be demultiplexed only with Session Identifier as the
   key.

   With respect to PM for Geneve, the use of the specific VNI would
   follow the principle as specified in Section 4.1 of
   [I-D.xiao-nvo3-bfd-geneve].



Min, et al.                Expires May 5, 2020                  [Page 9]

Internet-Draft                PM for Geneve                November 2019


5.  Security Considerations

   This document does not raise any additional security issues beyond
   those of the specifications referred to in the list of normative
   references.

6.  IANA Considerations

   This document has no IANA action requested.

7.  Acknowledgements

   TBA.

8.  Normative References

   [I-D.ietf-bfd-vxlan]
              Networks, J., Paragiri, S., Govindan, V., Mudigonda, M.,
              and G. Mirsky, "BFD for VXLAN", draft-ietf-bfd-vxlan-07
              (work in progress), May 2019.

   [I-D.ietf-ippm-stamp]
              Mirsky, G., Jun, G., Nydell, H., and R. Foote, "Simple
              Two-way Active Measurement Protocol", draft-ietf-ippm-
              stamp-09 (work in progress), October 2019.

   [I-D.ietf-ippm-stamp-option-tlv]
              Mirsky, G., Xiao, M., Nydell, H., Foote, R., Masputra, A.,
              and E. Ruffini, "Simple Two-way Active Measurement
              Protocol Optional Extensions", draft-ietf-ippm-stamp-
              option-tlv-02 (work in progress), October 2019.

   [I-D.ietf-nvo3-geneve]
              Gross, J., Ganga, I., and T. Sridhar, "Geneve: Generic
              Network Virtualization Encapsulation", draft-ietf-
              nvo3-geneve-14 (work in progress), September 2019.

   [I-D.xiao-nvo3-bfd-geneve]
              Xiao, M., Mirsky, G., and J. Networks, "BFD for Geneve",
              draft-xiao-nvo3-bfd-geneve-01 (work in progress), October
              2019.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.





Min, et al.                Expires May 5, 2020                 [Page 10]

Internet-Draft                PM for Geneve                November 2019


   [RFC5586]  Bocci, M., Ed., Vigoureux, M., Ed., and S. Bryant, Ed.,
              "MPLS Generic Associated Channel", RFC 5586,
              DOI 10.17487/RFC5586, June 2009,
              <https://www.rfc-editor.org/info/rfc5586>.

   [RFC6374]  Frost, D. and S. Bryant, "Packet Loss and Delay
              Measurement for MPLS Networks", RFC 6374,
              DOI 10.17487/RFC6374, September 2011,
              <https://www.rfc-editor.org/info/rfc6374>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

Authors' Addresses

   Xiao Min
   ZTE Corp.
   Nanjing
   China

   Phone: +86 25 88013062
   Email: xiao.min2@zte.com.cn


   Greg Mirsky
   ZTE Corp.
   USA

   Email: gregimirsky@gmail.com


   Santosh Pallagatti
   VMware

   Email: santosh.pallagatti@gmail.com















Min, et al.                Expires May 5, 2020                 [Page 11]
