Media-Stream   =  stream-info *(COMMA stream-info)
stream-info    =  discrete-type *(SEMI stream-params)
stream-params  =  address-param / port-param /
                          transport-param / id-param
address-param  =  "host" EQUAL (hostname / IPv4address
                          / IPv6reference)
port-param     =  "port" EQUAL port
id-param       =  "id" EQUAL token


Media-Middlebox      =  intermediary *(COMMA intermediary)
intermediary         =  stream-id *(SEMI intermediary-params)
stream-id            =  token
intermediary-params  =  address-param / port-param /
                                transport-param / lroute-param /
                                domain-param
lroute-param         =  "route" EQUAL route-protocols
route-protocols      =  "ip-in-ip" / "ip-loose" /
                                "media-specific"
domain-param         =  "domain" EQUAL host
v=0
o=alice 2890844526 2890844526 IN IP4 host.anywhere.com
s=
c=IN IP4 9.8.7.6
        UA 1                Proxy              router               UA 2
          |                   |                   |                   |
          |(1) INVITE         |                   |                   |
          |MS:audio 9.8.7.6:1288                  |                   |
          |------------------>|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |(2) 100            |                   |                   |
          |<------------------|                   |                   |
          |                   |                   |                   |
          |                   |(3) INVITE         |                   |
          |                   |MS:audio 9.8.7.6:1288                  |
          |                   |-------------------------------------->|
          |                   |                   |                   |
          |                   |(4) 200 OK         |                   |
          |                   |MS:audio 10.0.1.1:7788                 |
          |                   |<--------------------------------------|
          |(5) 200 OK         |                   |                   |
          |MS:audio 10.0.1.1:7788                 |                   |
          |MM:audio 1.2.3.4;ipinip                |                   |
          |<------------------|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |(6) ACK            |                   |                   |
          |------------------>|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |(7) ACK            |                   |
          |                   |-------------------------------------->|
          |                   |                   |                   |
          |(8) IPinIP         |                   |                   |
          |inner 10.0.1.1:7788|                   |                   |
          |-------------------------------------->|                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |(9) RTP            |
          |                   |                   |------------------>|
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |(10) RTP           |
          |                   |                   |<------------------|
          |                   |                   |                   |
          |                   |                   |                   |
          |(11) RTP           |                   |                   |
          |<--------------------------------------|                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |



t=0 0
m=audio 1288 RTP/AVP 0



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=audio 7788 RTP/AVP 0



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=audio 7788 RTP/AVP 0
v=0
o=alice 2890844526 2890844526 IN IP4 host.anywhere.com
s=
c=IN IP4 9.8.7.6
t=0 0
m=audio 1288 RTP/AVP 0
                                                                          
                                                                          
                                                                          
                                                                          
                                    ................................      
                                    .                              .      
                                    .                              .      
                                +--------+                         .      
                                |        |                         .      
                                | Proxy  |         net10           .      
                                |        |         Network         .      
                                |        |                         .      
                                +--------+                         .      
                                    .                              .      
                                    .                              .      
                                +--------+                         .      
                                |        |                         .      
                                |  NAT   |                         .      
                                |        |                         .      
                                |        |                         .      
                                +--------+                         .      
        +--------+                  .             +--------+       .      
        |        |                  .             |        |       .      
        |  UA    |                  .             |  UA    |       .      
        |   1    |                  .             |   2    |       .      
        |        |                  .             |        |       .      
        +--------+                  .foo.com      +--------+       .      
                                    ................................      
                                                                          



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=audio 7788 RTP/AVP 0



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=audio 7788 RTP/AVP 0



v=0
o=alice 2890844526 2890844526 IN IP4 host.anywhere.com
s=
c=IN IP4 9.8.7.6
t=0 0
m=message 5060 SIP
a=user:alice
        UA 1                Proxy                NAT                UA 2
          |(1) INVITE         |                   |                   |
          |MS:message 9.8.7.6 |                   |                   |
          |user=alice         |                   |                   |
          |------------------>|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |(2) 100            |                   |                   |
          |<------------------|                   |                   |
          |                   |(3) INVITE         |                   |
          |                   |MS:message 9.8.7.6 |                   |
          |                   |user=alice         |                   |
          |                   |-------------------------------------->|
          |                   |(4) 200 OK         |                   |
          |                   |MS:message 10.0.1.1|                   |
          |                   |user=bob           |                   |
          |(5) 200 OK         |<--------------------------------------|
          |MS:message 10.0.1.1|                   |                   |
          |user=bob           |                   |                   |
          |MM:1.2.3.4         |                   |                   |
          |<------------------|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |(6) ACK            |                   |                   |
          |------------------>|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |(7) ACK            |                   |
          |                   |-------------------------------------->|
          |                   |                   |                   |
          |(8) MESSAGE bob@10.0.1.1               |                   |
          |Route=1.2.3.4      |                   |                   |
          |------------------>|                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |(9) MESSAGE bob@10.0.1.1               |
          |                   |-------------------------------------->|
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |
          |                   |                   |                   |



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=message 5060 SIP
a=user:bob



v=0
o=bob 2890887s 2890686626 IN IP4 10.0.1.1
s=
c=IN IP4 10.0.1.1
t=0 0
m=message 5060 SIP
a=user:bob



