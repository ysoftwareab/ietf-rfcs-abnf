<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Private Access Tokens</title>
<meta content="Scott Hendrickson" name="author">
<meta content="Jana Iyengar" name="author">
<meta content="Tommy Pauly" name="author">
<meta content="Steven Valdez" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document defines a protocol for issuing and redeeming privacy-preserving
access tokens. These tokens can adhere to an issuance policy, allowing a
service to limit access according to the policy without tracking client identity. 
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-private-access-tokens-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.2.0
    six 1.16.0
-->
<link href="/tmp/draft-private-access-tokens-00-jfand7el.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Private Access Tokens</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hendrickson, et al.</td>
<td class="center">Expires 28 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-private-access-tokens-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-25" class="published">25 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-28">28 April 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Hendrickson</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">J. Iyengar</div>
<div class="org">Fastly</div>
</div>
<div class="author">
      <div class="author-name">T. Pauly</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">S. Valdez</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">C.A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Private Access Tokens</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines a protocol for issuing and redeeming privacy-preserving
access tokens. These tokens can adhere to an issuance policy, allowing a
service to limit access according to the policy without tracking client identity.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/tfpauly/privacy-proxy">https://github.com/tfpauly/privacy-proxy</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 28 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-motivation" class="xref">Motivation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.1">
                    <p id="section-toc.1-1.1.2.1.2.1.1" class="keepWithNext"><a href="#section-1.1.1" class="xref">1.1.1</a>.  <a href="#name-rate-limited-access" class="xref">Rate-limited Access</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.2">
                    <p id="section-toc.1-1.1.2.1.2.2.1" class="keepWithNext"><a href="#section-1.1.2" class="xref">1.1.2</a>.  <a href="#name-client-geo-location" class="xref">Client Geo-Location</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1.2.3">
                    <p id="section-toc.1-1.1.2.1.2.3.1" class="keepWithNext"><a href="#section-1.1.3" class="xref">1.1.3</a>.  <a href="#name-private-client-authenticati" class="xref">Private Client Authentication</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-architecture" class="xref">Architecture</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-properties-and-requirements" class="xref">Properties and Requirements</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="xref">1.4</a>.  <a href="#name-client-identity" class="xref">Client Identity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.5">
                <p id="section-toc.1-1.1.2.5.1"><a href="#section-1.5" class="xref">1.5</a>.  <a href="#name-user-interaction" class="xref">User Interaction</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-notation-and-terminology" class="xref">Notation and Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-configuration" class="xref">Configuration</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-token-challenge-and-redempt" class="xref">Token Challenge and Redemption Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-token-challenge" class="xref">Token Challenge</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-token-redemption" class="xref">Token Redemption</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-issuance-protocol" class="xref">Issuance Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-state-requirements" class="xref">State Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="xref">5.1.1</a>.  <a href="#name-client-state" class="xref">Client State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="xref">5.1.2</a>.  <a href="#name-mediator-state" class="xref">Mediator State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="xref">5.1.3</a>.  <a href="#name-issuer-state" class="xref">Issuer State</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-issuance-http-headers" class="xref">Issuance HTTP Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-client-to-mediator-request" class="xref">Client-to-Mediator Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-mediator-to-issuer-request" class="xref">Mediator-to-Issuer Request</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-issuer-to-mediator-response" class="xref">Issuer-to-Mediator Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-mediator-to-client-response" class="xref">Mediator-to-Client Response</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="xref">5.7</a>.  <a href="#name-encrypting-origin-names" class="xref">Encrypting Origin Names</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="xref">5.8</a>.  <a href="#name-non-interactive-schnorr-pro" class="xref">Non-Interactive Schnorr Proof of Knowledge</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-instantiating-uses-cases" class="xref">Instantiating Uses Cases</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-rate-limited-access-2" class="xref">Rate-limited Access</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-client-geo-location-2" class="xref">Client Geo-Location</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-private-client-authenticatio" class="xref">Private Client Authentication</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-client-identity-2" class="xref">Client Identity</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-denial-of-service" class="xref">Denial of Service</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-channel-security" class="xref">Channel Security</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-client-token-state-and-orig" class="xref">Client Token State and Origin Tracking</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-origin-verification" class="xref">Origin Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-client-identification-with-" class="xref">Client Identification with Unique Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="xref">8.4</a>.  <a href="#name-collusion-among-different-e" class="xref">Collusion Among Different Entities</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-deployment-considerations" class="xref">Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-origin-key-rollout" class="xref">Origin Key Rollout</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-authentication-scheme" class="xref">Authentication Scheme</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-http-headers" class="xref">HTTP Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-media-types" class="xref">Media Types</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3.2.1">
                    <p id="section-toc.1-1.10.2.3.2.1.1"><a href="#section-10.3.1" class="xref">10.3.1</a>.  <a href="#name-message-access-token-reques" class="xref">"message/access-token-request" media type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3.2.2">
                    <p id="section-toc.1-1.10.2.3.2.2.1"><a href="#section-10.3.2" class="xref">10.3.2</a>.  <a href="#name-message-access-token-respon" class="xref">"message/access-token-response" media type</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-related-work-privacy-pass" class="xref">Related Work: Privacy Pass</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Servers commonly use passive and persistent identifiers associated with clients,
such as IP addresses or device identifiers, for enforcing access and usage
policies. For example, a server might limit the amount of content an IP address
can access over a given time period (referred to as a "metered paywall"), or
a server might rate-limit access from an IP address to prevent fraud and
abuse. Servers also commonly use the client's IP address as a strong indicator
of the client's geographic location to limit access to services or content to a
specific geographic area (referred to as "geofencing").<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">However, passive and persistent client identifiers can be used by any entity
that has access to it without the client's express consent. A server can use a
client's IP address or its device identifier to track client activity. A
client's IP address, and therefore its location, is visible to all entities on
the path between the client and the server. These entities can trivially track a
client, its location, and servers that the client visits.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">A client that wishes to keep its IP address private can hide its IP address
using a proxy service or a VPN. However, doing so severely limits the client's
ability to access services and content, since servers might not be able to
enforce their policies without a stable and unique client identifier.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document describes an architecture for Private Access Tokens (PATs),
using RSA Blind Signatures as defined in
<span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>, as an explicit replacement for
these passive client identifiers. These tokens are privately issued to clients
upon request and then redeemed by servers in such a way that the issuance and
redemption events for a given token are unlinkable.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">At first glance, using PATs in lieu of passive identifiers for policy
enforcement suggests that some entity needs to know both the client's identity
and the server's policy, and such an entity would be trivially able to track a
client and its activities. However, with appropriate mediation and separation
between the parties involved in the issuance and the redemption protocols, it is
possible to eliminate this information concentration without any functional
regressions. This document describes such a protocol.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">The relationship of this work to Privacy Pass (<span>[<a href="#I-D.ietf-privacypass-protocol" class="xref">I-D.ietf-privacypass-protocol</a>]</span>)
is discussed in <a href="#privacy-pass" class="xref">Appendix A</a>.<a href="#section-1-6" class="pilcrow">¶</a></p>
<div id="motivation">
<section id="section-1.1">
        <h3 id="name-motivation">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
        </h3>
<p id="section-1.1-1">This section describes classes of use cases where an origin would traditionally
use a stable and unique client identifier for enforcing attribute-based
policy. Hiding these identifiers from origins would therefore require an
alternative for origins to continue enforcing their policies. Using the Privacy
Address Token architecture for addressing these use cases is described in
<a href="#examples" class="xref">Section 6</a>.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<div id="use-case-rate-limit">
<section id="section-1.1.1">
          <h4 id="name-rate-limited-access">
<a href="#section-1.1.1" class="section-number selfRef">1.1.1. </a><a href="#name-rate-limited-access" class="section-name selfRef">Rate-limited Access</a>
          </h4>
<p id="section-1.1.1-1">An origin provides rate-limited access to content to a client over a fixed
period of time. The origin does not need to know the client's identity, but
needs to know that a requesting client has not exceeded the maximum rate set by
the origin.<a href="#section-1.1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1.1-2">One example of this use case is a metered paywall, where an origin limits the
number of page requests to each unique user over a period of time before the
user is required to pay for access. The origin typically resets this state
periodically, say, once per month. For example, an origin may serve ten (major
content) requests in a month before a paywall is enacted. Origins may want to
differentiate quick refreshes from distinct accesses.<a href="#section-1.1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1.1-3">Another example of this use case is rate-limiting page accesses to a client to
help prevent fraud. Operations that are sensitive to fraud, such as account
creation on a website, often employ rate-limiting as a defense in depth
strategy. Captchas or additional verification can be required by these pages
when a client exceeds a set rate-limit.<a href="#section-1.1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1.1-4">Origins routinely use client IP addresses for this purpose.<a href="#section-1.1.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-case-geolocation">
<section id="section-1.1.2">
          <h4 id="name-client-geo-location">
<a href="#section-1.1.2" class="section-number selfRef">1.1.2. </a><a href="#name-client-geo-location" class="section-name selfRef">Client Geo-Location</a>
          </h4>
<p id="section-1.1.2-1">An origin provides access to or customizes content based on the geo-location of
the client. The origin does not need to know the client's identity, but needs to
know the geo-location, with some level of accuracy, for providing service.<a href="#section-1.1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.1.2-2">A specific example of this use case is "geo-fencing", where an origin restricts
the available content it can serve based on the client's geographical region.<a href="#section-1.1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.1.2-3">Origins almost exclusively use client IP addresses for this purpose.<a href="#section-1.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-case-authentication">
<section id="section-1.1.3">
          <h4 id="name-private-client-authenticati">
<a href="#section-1.1.3" class="section-number selfRef">1.1.3. </a><a href="#name-private-client-authenticati" class="section-name selfRef">Private Client Authentication</a>
          </h4>
<p id="section-1.1.3-1">An origin provides access to content for clients that have been authorized by a
delegated or known mediator. The origin does not need to know the client's
identity.<a href="#section-1.1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.1.3-2">A specific example of this use case is a federated service that authorizes users
for access to specific sites, such as a federated news service or a federated
video streaming service. The origin trusts the federator to authorize users and
needs proof that the federator authorized a particular user, but it does not
need the user's identity to provide access to content.<a href="#section-1.1.3-2" class="pilcrow">¶</a></p>
<p id="section-1.1.3-3">Origins could currently redirect clients to a federator for authentication, but
origins could then track the client's federator user ID or the client's IP
address across accesses.<a href="#section-1.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="architecture">
<section id="section-1.2">
        <h3 id="name-architecture">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-architecture" class="section-name selfRef">Architecture</a>
        </h3>
<p id="section-1.2-1">At a high level, the PAT architecture seeks to solve the following problem: in
the absence of a stable Client identifier, an Origin needs to verify the
identity of a connecting Client and enforce access policies for the incoming
Client. To accomplish this, the PAT architecture employs four functional
components:<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1.2-2">
<li id="section-1.2-2.1">Client: requests a PAT from an Issuer and presents it to a Origin for access
to the Origin's service.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.2">Mediator: authenticates a Client, using information such as its IP address,
an account name, or a device identifier. Anonymizes a Client to an Issuer and
relays information between an anonymized Client and an Issuer.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.3">Issuer: issues PATs to an anonymized Client on behalf of an
Origin. Anonymizes an Origin to a Mediator and enforces the Origin's policy.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-1.2-2.4">Origin: directs a Client to an Issuer with a challenge and enables access to
content or services to the Client upon verification of any PAT sent in
response by the Client.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-1.2-3">In the PAT architecture, these four components interact as follows.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">An Origin designates a trusted Issuer to issue tokens for it. The Origin then
redirects any incoming Clients to the Issuer for policy enforcement, expecting
the Client to return with a proof from the Issuer that the Origin's policy has
been enforced for this Client.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2-5">The Client employs a trusted Mediator through which it communicates with the
Issuer for this proof. The Mediator performs three important functions:<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-6.1">authenticate and associate the Client with a stable identifier;<a href="#section-1.2-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-6.2">maintain issuance state for the Client and relay it to the Issuer; and<a href="#section-1.2-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-6.3">anonymize the Client and mediate communication between the Client and the
Issuer.<a href="#section-1.2-6.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.2-7">When a Mediator-anonymized Client requests a token from an Issuer, the Issuer
enforces the Origin's policies based on the received Client issuance state and
Origin policy. Issuers know the Origin's policies and enforce them on behalf of the
Origin. An example policy is: "Limit 10 accesses per Client".  More examples and
their use cases are discussed in <a href="#examples" class="xref">Section 6</a>. The Issuer does not learn the
Client's true identity.<a href="#section-1.2-7" class="pilcrow">¶</a></p>
<p id="section-1.2-8">Finally, the Origin provides access to content or services to a Client upon
verifying a PAT presented by the Client. Verification of this
token serves as proof that the Client meets the Origin's policies as enforced by
the delegated Issuer with the help of a Mediator. The Origin can then provide
any services or content gated behind these policies to the Client.<a href="#section-1.2-8" class="pilcrow">¶</a></p>
<p id="section-1.2-9"><a href="#fig-overview" class="xref">Figure 1</a> shows the components of the PAT architecture described in this
document. Protocol details follow in <a href="#challenge-redemption" class="xref">Section 4</a> and <a href="#issuance" class="xref">Section 5</a>.<a href="#section-1.2-9" class="pilcrow">¶</a></p>
<span id="name-pat-architectural-component"></span><div id="fig-overview">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.2-10.1">
<pre>
 Client        Mediator          Issuer          Origin

    &lt;---------------------------------------- Challenge \
                                                        |
+--------------------------------------------\          |
| TokenRequest ---&gt;                          |          |
|             (validate)                     |          |
|             (attach state)                 |          |
|                    TokenRequest ---&gt;       |          |    PAT
|                                 (validate) |   PAT    | Challenge/
|                                 (evaluate) | Issuance |  Response
|                    &lt;--- TokenResponse      |   Flow   |   Flow
|             (evaluate)                     |          |
|             (update state)                 |          |
|   &lt;--- TokenResponse                       |          |
---------------------------------------------/          |
                                                        |
     Response -------------------------------------- &gt;  /
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-pat-architectural-component" class="selfRef">PAT Architectural Components</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="properties">
<section id="section-1.3">
        <h3 id="name-properties-and-requirements">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-properties-and-requirements" class="section-name selfRef">Properties and Requirements</a>
        </h3>
<p id="section-1.3-1">In this architecture, the Mediator, Issuer, and Origin each have partial
knowledge of the Client's identity and actions, and each entity only knows
enough to serve its function (see <a href="#terms" class="xref">Section 2</a> for more about the pieces of
information):<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-2.1">The Mediator knows the Client's identity and learns the Client's public key
(CLIENT_KEY), the Issuer being targeted (ISSUER_NAME), the period of time
for which the Issuer's policy is valid (ISSUER_POLICY_WINDOW), and the number
of tokens issued to a given Client for the claimed Origin in the given policy
window.  The Mediator does not know the identity of the Origin the Client is
trying to access (ORIGIN_ID), but knows a Client-anonymized identifier for
it (ANON_ORIGIN_ID).<a href="#section-1.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-2.2">The Issuer knows the Origin's secret (ORIGIN_SECRET) and policy about client
access, and learns the Origin's identity (ORIGIN_NAME) and the number of
previous tokens issued to the Client (as communicated by the Mediator) during
issuance. The Issuer does not learn the Client's identity.<a href="#section-1.3-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-2.3">The Origin knows the Issuer to which it will delegate an incoming Client
(ISSUER_NAME), and can verify that any tokens presented by the Client were
signed by the Issuer. The Origin does not learn which Mediator was used by a
Client for issuance.<a href="#section-1.3-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-3">Since an Issuer enforces policies on behalf of Origins, a Client is required to
reveal the Origin's identity to the delegated Issuer. It is a requirement of
this architecture that the Mediator not learn the Origin's identity so that,
despite knowing the Client's identity, a Mediator cannot track and concentrate
information about Client activity.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<p id="section-1.3-4">An Issuer expects a Mediator to verify its Clients' identities correctly, but an
Issuer cannot confirm a Mediator's efficacy or the Mediator-Client relationship
directly without learning the Client's identity. Similarly, an Origin does not
know the Mediator's identity, but ultimately relies on the Mediator to correctly
verify or authenticate a Client for the Origin's policies to be correctly
enforced. An Issuer therefore chooses to issue tokens to only known and
reputable Mediators; the Issuer can employ its own methods to determine the
reputation of a Mediator.<a href="#section-1.3-4" class="pilcrow">¶</a></p>
<p id="section-1.3-5">A Mediator is expected to employ a stable Client identifier, such as an IP
address, a device identifier, or an account at the Mediator, that can serve as a
reasonable proxy for a user with some creation and maintenance cost on the user.<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<p id="section-1.3-6">For the Issuance protocol, a Client is expected to create and maintain stable
and explicit secrets for time periods that are on the scale of Issuer policy
windows. Changing these secrets arbitrarily during a policy window can result in
token issuance failure for the rest of the policy window; see <a href="#client-state" class="xref">Section 5.1.1</a>
for more details. A Client can use a service offered by its Mediator or a
third-party to store these secrets, but it is a requirement of the PAT
architecture that the Mediator not be able to learn these secrets.<a href="#section-1.3-6" class="pilcrow">¶</a></p>
<p id="section-1.3-7">The privacy guarantees of the PAT architecture, specifically those around
separating the identity of the Client from the names of the Origins that it
accesses, are based on the expectation that there is not collusion between
the entities that know about Client identity and those that know about Origin
identity. Clients choose and share information with Mediators, and Origins
choose and share policy with Issuers; however, the Mediator is generally
expected to not be colluding with Issuers or Origins. If this occurs, it
can become possible for a Mediator to learn or infer which Origins a
Client is accessing, or for an Origin to learn or infer the Client
identity. For further discussion, see <a href="#collusion" class="xref">Section 8.4</a>.<a href="#section-1.3-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-identity">
<section id="section-1.4">
        <h3 id="name-client-identity">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-client-identity" class="section-name selfRef">Client Identity</a>
        </h3>
<p id="section-1.4-1">The PAT architecture does not enforce strong constraints around the definition
of a Client identity and allows it to be defined entirely by a Mediator. If a
user can create an arbitrary number of Client identities that are accepted by
one or more Mediators, a malicious user can easily abuse the system to
defeat the Issuer's ability to enforce per-Client policies.<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<p id="section-1.4-2">These multiple identities could be fake or true identities.<a href="#section-1.4-2" class="pilcrow">¶</a></p>
<p id="section-1.4-3">A Mediator alone is responsible for detecting and weeding out fake Client
identities in the PAT architecture. An Issuer relies on a Mediator's reputation;
as explained in <a href="#properties" class="xref">Section 1.3</a>, the correctness of the architecture hinges on
Issuers issuing tokens to only known and reputable Mediators.<a href="#section-1.4-3" class="pilcrow">¶</a></p>
<p id="section-1.4-4">Users have multiple true identities on the Internet however, and as a result, it
seems possible for a user to abuse the system without having to create
fake identities. For instance, a user could use multiple Mediators,
authenticating with each one using a different true identity.<a href="#section-1.4-4" class="pilcrow">¶</a></p>
<p id="section-1.4-5">The PAT architecture offers no panacea against this potential abuse.  We note
however that the usages of PATs will cause the ecosystem to evolve and offer
practical mitigations, such as:<a href="#section-1.4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.4-6.1">An Issuer can learn the properties of a Mediator - specifically, which stable
Client identifier is authenticated by the Mediator - to determine whether the
Mediator is acceptable for an Origin.<a href="#section-1.4-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.2">An Origin can choose an Issuer based on the types of Mediators accepted by the
Issuer, or the Origin can communicate its constraints to the designated
Issuer.<a href="#section-1.4-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.3">An Origin can direct a user to a specific Issuer based on client properties
that are visible. For instance, properties that are observable in the HTTP
User Agent string.<a href="#section-1.4-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.4-6.4">The number of true Mediator-authenticated identities for a user is expected to
be small, and therefore likely to be small enough to not matter for certain
use cases. For instance, when PATs are used to prevent fraud by rate-limiting
Clients (as described in <a href="#use-case-rate-limit" class="xref">Section 1.1.1</a>), an Origin might be tolerant
of the potential amplification caused by an attacking user's access to
multiple true identities with Issuer-trusted Mediators.<a href="#section-1.4-6.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="user-interaction">
<section id="section-1.5">
        <h3 id="name-user-interaction">
<a href="#section-1.5" class="section-number selfRef">1.5. </a><a href="#name-user-interaction" class="section-name selfRef">User Interaction</a>
        </h3>
<p id="section-1.5-1">When used in contexts like websites, origin servers that challenge clients for
Private Access Tokens need to consider how to optimize their interaction model
to ensure a good user experience.<a href="#section-1.5-1" class="pilcrow">¶</a></p>
<p id="section-1.5-2">Private Access Tokens are designed to be used without explicit user involvement.
Since tokens are only valid for a single origin and in response to a specific
challenge, there is no need for a user to manage a limited pool of tokens
across origins. The information that is available to an origin upon token
redemption is limited to the fact that this is a client that passed a
Mediator's checks and has not exceeded the per-origin limit defined by an
Issuer. Generally, if a user is willing to use Private Access Tokens with
a particular origin (or all origins), there is no need for per-challenge
user interaction. Note that the Issuance flow may separately involve user interaction if
the Mediator needs to authenticate the Client.<a href="#section-1.5-2" class="pilcrow">¶</a></p>
<p id="section-1.5-3">Since tokens are issued using a separate connection through a Mediator
to an Issuer, the process of issuance can add user-perceivable latency.
Origins SHOULD NOT block useful work on token authentication.
Instead, token authentication can be used in similar ways to CAPTCHA
validation today, but without the need for user interaction. If issuance
is taking a long time, a website could show an indicator that it is waiting,
or fall back to another method of user validation.<a href="#section-1.5-3" class="pilcrow">¶</a></p>
<p id="section-1.5-4">If an origin is requesting an unexpected number of tokens, such as requesting
token authentication more than once for a single website load, it can indicate
that the server is not functioning correctly, or is trying to attack or overload
the client or issuance servers. In such cases, the client SHOULD ignore
redundant token challengers, or else alert the user.<a href="#section-1.5-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terms">
<section id="section-2">
      <h2 id="name-notation-and-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-notation-and-terminology" class="section-name selfRef">Notation and Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Unless said otherwise, this document encodes protocol messages in TLS notation
from <span>[<a href="#TLS13" class="xref">TLS13</a>]</span>, Section 3.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This draft includes pseudocode that uses the functions and conventions defined
in <span>[<a href="#HPKE" class="xref">HPKE</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Encoding an integer to a sequence of bytes in network byte order is described
using the function "encode(n, v)", where "n" is the number of bytes and "v" is
the integer value. The function "len()" returns the length of a sequence of bytes.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The following terms are defined to refer to the different pieces of information
passed through the system:<a href="#section-2-5" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-6">
        <dt id="section-2-6.1">
ISSUER_NAME:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.2">
          <p id="section-2-6.2.1">The Issuer Name identifies which Issuer is able to provide tokens for a Client.
The Client sends the Issuer Name to the Mediator so the Mediator know where to
forward requests. Each Issuer is associated with a specific ISSUER_POLICY_WINDOW.<a href="#section-2-6.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.3">
ISSUER_POLICY_WINDOW:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.4">
          <p id="section-2-6.4.1">The period over which an Issuer will track access policy, defined in terms of
seconds and represented as a uint64. The state that the Mediator keeps for a Client
is specific to a policy window. The effective policy window for a specific Client
starts when the Client first sends a request associated with an Issuer.<a href="#section-2-6.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.5">
ORIGIN_TOKEN_KEY:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.6">
          <p id="section-2-6.6.1">The public key used when generating and verifying Private Access Tokens. Each
Origin Token Key is unique to a single Origin. The corresponding private key
is held by the Issuer.<a href="#section-2-6.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.7">
ISSUER_KEY:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.8">
          <p id="section-2-6.8.1">The public key used to encrypt values such as ORIGIN_NAME in requests from
Clients to the Issuer, so that Mediators cannot learn the ORIGIN_NAME value. Each
ISSUER_KEY is used across all requests on the Issuer, for different Origins.<a href="#section-2-6.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.9">
ORIGIN_NAME:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.10">
          <p id="section-2-6.10.1">The name of the Origin that requests and verifies Private Access Tokens.<a href="#section-2-6.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.11">
ANON_ORIGIN_ID:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.12">
          <p id="section-2-6.12.1">An identifier that is generated by the Client and marked on requests to the
Mediator, which represents a specific Origin anonymously. The Client generates
a stable ANON_ORIGIN_ID for each ORIGIN_NAME, to allow the Mediator to count
token access without learning the ORIGIN_NAME.<a href="#section-2-6.12.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.13">
CLIENT_KEY:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.14">
          <p id="section-2-6.14.1">A public key chosen by the Client and shared only with the Mediator.<a href="#section-2-6.14.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.15">
CLIENT_SECRET:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.16">
          <p id="section-2-6.16.1">The secret key used by the Client during token issuance, whose public key
(CLIENT_KEY) is shared with the Mediator.<a href="#section-2-6.16.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.17">
ORIGIN_SECRET:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.18">
          <p id="section-2-6.18.1">The secret key used by the Issuer during token issuance, whose public key is
not shared with anyone.<a href="#section-2-6.18.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-6.19">
ANON_ISSUER_ORIGIN_ID:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-6.20">
          <p id="section-2-6.20.1">An identifier that is generated by Issuer based on an ORIGIN_SECRET that is
per-Client and per-Origin. See <a href="#response-two" class="xref">Section 5.6</a> for details of derivation.<a href="#section-2-6.20.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="setup">
<section id="section-3">
      <h2 id="name-configuration">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
      </h2>
<p id="section-3-1">Issuers MUST provide three parameters for configuration:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">ISSUER_KEY: a <code>KeyConfig</code> as defined in <span>[<a href="#OHTTP" class="xref">OHTTP</a>]</span> to use when
encrypting the ORIGIN_NAME in issuance requests. This parameter uses resource media type
"application/ohttp-keys".<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.2">ISSUER_POLICY_WINDOW: a uint64 of seconds as defined in <a href="#terms" class="xref">Section 2</a>.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.3">ISSUER_REQUEST_URI: a Private Access Token request URL for generating access tokens.
For example, an Issuer URL might be https://issuer.example.net/access-token-request. This parameter
uses resource media type "text/plain".<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-3-3">These parameters can be obtained from an Issuer via a directory object, which is a JSON
object whose field names and values are raw values and URLs for the parameters.<a href="#section-3-3" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field Name</th>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-key</td>
            <td class="text-left" rowspan="1" colspan="1">ISSUER_KEY resource URL as a JSON string</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-policy-window</td>
            <td class="text-left" rowspan="1" colspan="1">ISSUER_POLICY_WINDOW as a JSON number</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-request-uri</td>
            <td class="text-left" rowspan="1" colspan="1">ISSUER_REQUEST_URI resource URL as a JSON string</td>
          </tr>
        </tbody>
      </table>
<p id="section-3-5">As an example, the Issuer's JSON directory could look like:<a href="#section-3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-6">
<pre>
 {
    "issuer-key": "https://issuer.example.net/key",
    "issuer-token-window": 86400,
    "issuer-request-uri": "https://issuer.example.net/access-token-request"
 }
 ~~~

Mediators MUST provide a single parameter for configuration, MEDIATOR_REQUEST_URI,
wich is Private Access Token request URL for proxying protocol messages to Issuers.
For example, a Mediator URL might be https://mediator.example.net/relay-access-token-request.
Similar to Issuers, Mediators make this parameter available by a directory object
with the following contents:

| Field Name           | Value                             |
|:---------------------|:----------------------------------|
| mediator-request-uri | MEDIATOR_REQUEST_URI resource URL |


As an example, the Mediator's JSON dictionary could look like:

</pre><a href="#section-3-6" class="pilcrow">¶</a>
</div>
<p id="section-3-7">{
    "mediator-request-uri": "https://mediator.example.net/relay-access-token-request."
 }
~~~<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">Issuer and Mediator directory resources have the media type "application/json"
and are located at the well-known location /.well-known/private-access-tokens-directory.<a href="#section-3-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="challenge-redemption">
<section id="section-4">
      <h2 id="name-token-challenge-and-redempt">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-challenge-and-redempt" class="section-name selfRef">Token Challenge and Redemption Protocol</a>
      </h2>
<p id="section-4-1">This section describes the interactive protocol for the token challenge
and redemption flow between a Client and an Origin.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Token redemption is performed using HTTP Authentication (<span>[<a href="#RFC7235" class="xref">RFC7235</a>]</span>), with
the scheme "PrivateAccessToken". Origins challenge Clients to present a unique,
single-use token from a specific Issuer. Once a Client has received a token
from that Issuer, it presents the token to the Origin.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Token redemption only requires Origins to verify token signatures computed
using the Blind Signature protocol from <span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>. Origins are not required
to implement the complete Blind Signature protocol. (In contrast, token issuance
requires Clients and Issuers to implement the Blind Signature protocol, as
described in <a href="#issuance" class="xref">Section 5</a>.)<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="challenge">
<section id="section-4.1">
        <h3 id="name-token-challenge">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-token-challenge" class="section-name selfRef">Token Challenge</a>
        </h3>
<p id="section-4.1-1">Origins send a token challenge to Clients in an "WWW-Authenticate" header with
the "PrivateAccessToken" scheme. This challenge includes a TokenChallenge message,
along with information about what keys to use when requesting a token from
the Issuer.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The TokenChallenge message has the following structure:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-3">
<pre>
struct {
    uint8_t version;
    opaque origin_name&lt;1..2^16-1&gt;;
    opaque issuer_name&lt;1..2^16-1&gt;;
    opaque redemption_nonce[32];
} TokenChallenge;
</pre><a href="#section-4.1-3" class="pilcrow">¶</a>
</div>
<p id="section-4.1-4">The structure fields are defined as follows:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-5.1">"version" is a 1-octet integer. This document defines version 1.<a href="#section-4.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.2">"origin_name" is a string containing the name of the Origin (ORIGIN_NAME).<a href="#section-4.1-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.3">"issuer_name" is a string containing the name of the Issuer (ISSUER_NAME).<a href="#section-4.1-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.4">"redemption_nonce" is a fresh 32-byte nonce generated for each redemption request.<a href="#section-4.1-5.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-6">When used in an authentication challenge, the "PrivateAccessToken" scheme uses the
following attributes:<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-7.1">"challenge", which contains a base64url-encoded <span>[<a href="#RFC4648" class="xref">RFC4648</a>]</span> TokenChallenge
value. This MUST be unique for every 401 HTTP response to prevent replay attacks.<a href="#section-4.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-7.2">"token-key", which contains a base64url encoding of the SubjectPublicKeyInfo object
for use with the RSA Blind Signature protocol (ORIGIN_TOKEN_KEY).<a href="#section-4.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-7.3">"issuer-key", which contains a base64url encoding of a <code>KeyConfig</code> as defined
in <span>[<a href="#OHTTP" class="xref">OHTTP</a>]</span> to use when encrypting the ORIGIN_NAME in issuance requests
(ISSUER_KEY).<a href="#section-4.1-7.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-7.4">"max-age", an optional attribute that consists of the number of seconds for which
the challenge will be accepted by the Origin.<a href="#section-4.1-7.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-8">Origins MAY also include the standard "realm" attribute, if desired.<a href="#section-4.1-8" class="pilcrow">¶</a></p>
<p id="section-4.1-9">As an example, the WWW-Authenticate header could look like this:<a href="#section-4.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-10">
<pre>
WWW-Authenticate: PrivateAccessToken challenge=abc..., token-key=123...,
issuer-key=456...
</pre><a href="#section-4.1-10" class="pilcrow">¶</a>
</div>
<p id="section-4.1-11">Upon receipt of this challenge, a Client uses the message and keys in the Issuance protocol
(see <a href="#issuance" class="xref">Section 5</a>). If the TokenChallenge has a version field the Client
does not recognize or support, it MUST NOT parse or respond to the challenge.
This document defines version 1, which indicates use of private tokens based on
RSA Blind Signatures <span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>, and determines the rest of the structure contents.<a href="#section-4.1-11" class="pilcrow">¶</a></p>
<p id="section-4.1-12">Note that it is possible for the WWW-Authenticate header to include multiple
challenges, in order to allow the Client to fetch a batch of multiple tokens
for future use.<a href="#section-4.1-12" class="pilcrow">¶</a></p>
<p id="section-4.1-13">For example, the WWW-Authenticate header could look like this:<a href="#section-4.1-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.1-14">
<pre>
WWW-Authenticate: PrivateAccessToken challenge=abc..., token-key=123...,
issuer-key=456..., PrivateAccessToken challenge=def..., token-key=234...,
issuer-key=567...
</pre><a href="#section-4.1-14" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="redemption">
<section id="section-4.2">
        <h3 id="name-token-redemption">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-token-redemption" class="section-name selfRef">Token Redemption</a>
        </h3>
<p id="section-4.2-1">The output of the issuance protocol is a token that corresponds to the Origin's challenge (see <a href="#challenge" class="xref">Section 4.1</a>).
A token is a structure that begins with a single byte that indicates a version, which
MUST match the version in the TokenChallenge structure.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-2">
<pre>
struct {
    uint8_t version;
    uint8_t token_key_id[32];
    uint8_t message[32];
    uint8_t signature[Nk];
} Token;
</pre><a href="#section-4.2-2" class="pilcrow">¶</a>
</div>
<p id="section-4.2-3">The structure fields are defined as follows:<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.2-4.1">"version" is a 1-octet integer. This document defines version 1.<a href="#section-4.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.2">"token_key_id" is a collision-resistant hash that identifies the ORIGIN_TOKEN_KEY
used to produce the signature. This is generated as SHA256(public_key), where
public_key is a DER-encoded SubjectPublicKeyInfo object carrying the public key.<a href="#section-4.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.3">"message" is a 32-octet message containing the hash of the original
TokenChallenge, SHA256(TokenChallenge). This message is signed by the signature,<a href="#section-4.2-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.2-4.4">"signature" is a Nk-octet RSA Blind Signature that covers the message. For
version 1, Nk is indicated by size of the Token structure and may be 256, 384,
or 512. These correspond to RSA 2048, 3072, and 4096 bit keys. Clients implementing
version 1 MUST support signature sizes with Nk of 512 and 256.<a href="#section-4.2-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.2-5">When used for client authorization, the "PrivateAccessToken" authentication
scheme defines one parameter, "token", which contains the base64url-encoded
Token struct. All unknown or unsupported parameters to "PrivateAccessToken"
authentication credentials MUST be ignored.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
<p id="section-4.2-6">Clients present this Token structure to Origins in a new HTTP request using
the Authorization header as follows:<a href="#section-4.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4.2-7">
<pre>
Authorization: PrivateAccessToken token=abc...
</pre><a href="#section-4.2-7" class="pilcrow">¶</a>
</div>
<p id="section-4.2-8">Origins verify the token signature using the corresponding policy verification
key from the Issuer, and validate that the message matches the hash of a
TokenChallenge it previously issued and is still valid, SHA256(TokenChallenge),
and that the version of the Token matches the version in the TokenChallenge.
The TokenChallenge MAY be bound to a specific HTTP session with Client, but
Origins can also accept tokens for valid challenges in new sessions.<a href="#section-4.2-8" class="pilcrow">¶</a></p>
<p id="section-4.2-9">If a Client's issuance request fails with a 401 error, as described in <a href="#request-two" class="xref">Section 5.4</a>,
the Client MUST react to the challenge as if it could not produce a valid Authorization
response.<a href="#section-4.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="issuance">
<section id="section-5">
      <h2 id="name-issuance-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-issuance-protocol" class="section-name selfRef">Issuance Protocol</a>
      </h2>
<p id="section-5-1">This section describes the Issuance protocol for a Client to request and receive
a token from an Issuer. Token issuance involves a Client, Mediator, and Issuer,
with the following steps:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">The Client sends a token request to the Mediator, encrypted using an Issuer-specific key<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.2">The Mediator validates the request and proxies the request to the Issuer<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.3">The Issuer decrypts the request and sends a response back to the Mediator<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-5-2.4">The Mediator verifies the response and proxies the response to the Client<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-5-3">The Issuance protocol has a number of underlying cryptographic dependencies for
operation:<a href="#section-5-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-4.1">
          <span>[<a href="#HPKE" class="xref">HPKE</a>]</span>, for encrypting information in transit between Client and Issuer across the Mediator.<a href="#section-5-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-4.2">RSA Blind Signatures <span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span>, for issuing and constructing Tokens as described in <a href="#redemption" class="xref">Section 4.2</a>.<a href="#section-5-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-4.3">Prime Order Groups (POGs), for computing stable mappings between (Client, Origin) pairs. This
document uses notation described in <span>[<a href="#VOPRF" class="xref">VOPRF</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-07#section-2.1" class="relref">Section 2.1</a></span>, and, in particular,
the functions RandomScalar(), Generator(), SerializeScalar(), SerializeElement(), and HashToScalar().<a href="#section-5-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-4.4">Non-Interactive proof-of-knowledge (POK), as described in <a href="#nizk-dl" class="xref">Section 5.8</a>, for verifying correctness of Client requests.<a href="#section-5-4.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-5">Clients and Issuers are required to implement all of these dependencies, whereas Mediators are required
to implement POG and POK support.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="state-requirements">
<section id="section-5.1">
        <h3 id="name-state-requirements">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-state-requirements" class="section-name selfRef">State Requirements</a>
        </h3>
<p id="section-5.1-1">The Issuance protocol requires each participating endpoint to maintain some
necessary state, as described in this section.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="client-state">
<section id="section-5.1.1">
          <h4 id="name-client-state">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-client-state" class="section-name selfRef">Client State</a>
          </h4>
<p id="section-5.1.1-1">A Client is required to have the following information, derived from a given TokenChallenge:<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.1">Origin name (ORIGIN_NAME), a URI referring to the Origin <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. This is
the value of TokenChallenge.origin_name.<a href="#section-5.1.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.1-2.2">Origin token public key (ORIGIN_TOKEN_KEY), a blind signature public key
corresponding to the Origin identified by TokenChallenge.origin_name.<a href="#section-5.1.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.1-2.3">Issuer public key (ISSUER_KEY), a public key used to encrypt requests
corresponding to the Issuer identified by TokenChallenge.issuer_name.<a href="#section-5.1.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-5.1.1-3">Clients maintain a stable CLIENT_ID that they use for all communication with
a specific Mediator. CLIENT_ID is a public key, where the corresponding private key
CLIENT_SECRET is known only to the client.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4">If the client loses this (CLIENT_ID, CLIENT_SECRET), they may generate a new tuple. The
mediator will enforce if a client is allowed to use this new CLIENT_ID. See <span class="contact-name">#mediator-state</span>
for details on this enforcement.<a href="#section-5.1.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1.1-5">Clients also need to be able to generate an ANON_ORIGIN_ID value that corresponds
to the ORIGIN_NAME, to send in requests to the Mediator.<a href="#section-5.1.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1.1-6">ANON_ORIGIN_ID MUST be a stable and unpredictable 32-byte value computed by the Client.
Clients MUST NOT change this value across token requests for the same ORIGIN_NAME. Doing
so will result in token issuance failure (specifically, when a Mediator rejects a request
upon detecting two ANON_ORIGIN_ID values that map to the same Origin).<a href="#section-5.1.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1.1-7">One possible mechanism for implementing this identifier is for the Client to store a mapping
between the ORIGIN_NAME and a randomly generated ANON_ORIGIN_ID for future requests. Alternatively,
the Client can compute a PRF keyed by a per-client secret (CLIENT_SECRET) over the ORIGIN_NAME,
e.g., ANON_ORIGIN_ID = HKDF(secret=CLIENT_SECRET, salt="", info=ORIGIN_NAME).<a href="#section-5.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mediator-state">
<section id="section-5.1.2">
          <h4 id="name-mediator-state">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-mediator-state" class="section-name selfRef">Mediator State</a>
          </h4>
<p id="section-5.1.2-1">A Mediator is required to maintain state for every authenticated Client. The mechanism
of identifying a Client is specific to each Mediator, and is not defined in this document.
As examples, the Mediator could use device-specific certificates or account authentication
to identify a Client.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">Mediators must enforce that Clients don't change their CLIENT_ID frequently, to ensure Clients can't
regularily evade the per-client policy as seen by the issuer. Mediators MUST NOT allow Clients to
change their CLIENT_ID more than once within a policy window, or in the subsequent policy window
after a previous CLIENT_ID change. Alternative schemes where the mediator stores the encrypted
(CLIENT_ID, CLIENT_SECRET) tuple on behalf of the client are possble but not described here.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3">Mediators are expected to know the ISSUER_POLICY_WINDOW for any ISSUER_NAME to which
they allow access. This information can be retrieved using the URIs defined in <a href="#setup" class="xref">Section 3</a>.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">For each Client-Issuer pair, a Mediator maintains a policy window
start and end time for each Issuer from which a Client requests a token.<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.2-5">For each tuple of (CLIENT_ID, ANON_ORIGIN_ID, policy window), the Mediator maintains the
following state:<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-6.1">A counter of successful tokens issued<a href="#section-5.1.2-6.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.2">Whether or not a previous request was rejected by the Issuer<a href="#section-5.1.2-6.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.1.2-6.3">The last received ANON_ISSUER_ORIGIN_ID value for this ANON_ORIGIN_ID, if any<a href="#section-5.1.2-6.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="issuer-state">
<section id="section-5.1.3">
          <h4 id="name-issuer-state">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-issuer-state" class="section-name selfRef">Issuer State</a>
          </h4>
<p id="section-5.1.3-1">Issuers maintain a stable ORIGIN_SECRET that they use in calculating values returned
to the Mediator for each origin. If this value changes, it will open up a possibility
for Clients to request extra tokens for an Origin without being limited, within a
policy window.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">Issuers are expected to have the private key that corresponds to ISSUER_KEY,
which allows them to decrypt the ORIGIN_NAME values in requests.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3-3">Issuers also need to know the set of valid ORIGIN_TOKEN_KEY public keys and corresponding
private key, for each ORIGIN_NAME that is served by the Issuer. Origins SHOULD update
their view of the ORIGIN_TOKEN_KEY regularly to ensure that Client requests do not fail
after ORIGIN_TOKEN_KEY rotation.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="issuance-http-headers">
<section id="section-5.2">
        <h3 id="name-issuance-http-headers">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-issuance-http-headers" class="section-name selfRef">Issuance HTTP Headers</a>
        </h3>
<p id="section-5.2-1">The Issuance protocol defines four new HTTP headers that are used in requests
and responses between Clients, Mediators, and Issuers (see <a href="#iana-headers" class="xref">Section 10.2</a>).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The "Sec-Token-Origin" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent both on Client-to-Mediator
requests (<a href="#request-one" class="xref">Section 5.3</a>) and on Issuer-to-Mediator responses (<a href="#response-one" class="xref">Section 5.5</a>).
Its ABNF is:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-3">
<pre>
    Sec-Token-Origin = sf-binary
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2-4">The "Sec-Token-Client" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Mediator
requests (<a href="#request-one" class="xref">Section 5.3</a>), and contains the bytes of CLIENT_KEY.
Its ABNF is:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-5">
<pre>
    Sec-Token-Client = sf-binary
</pre><a href="#section-5.2-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2-6">The "Sec-Token-Nonce" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Mediator
requests (<a href="#request-one" class="xref">Section 5.3</a>), and contains a per-request nonce value.
Its ABNF is:<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-7">
<pre>
    Sec-Token-Nonce = sf-binary
</pre><a href="#section-5.2-7" class="pilcrow">¶</a>
</div>
<p id="section-5.2-8">The "Sec-Token-Count" is an Item Structured Header <span>[<a href="#RFC8941" class="xref">RFC8941</a>]</span>. Its
value MUST be an Integer. This header is sent on Mediator-to-Issuer
requests (<a href="#request-one" class="xref">Section 5.3</a>), and contains the number of times a
Client has previously received a token for an Origin. Its ABNF is:<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-9">
<pre>
    Sec-Token-Count = sf-integer
</pre><a href="#section-5.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="request-one">
<section id="section-5.3">
        <h3 id="name-client-to-mediator-request">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-client-to-mediator-request" class="section-name selfRef">Client-to-Mediator Request</a>
        </h3>
<p id="section-5.3-1">The Client and Mediator MUST use a secure and Mediator-authenticated HTTPS
connection. They MAY use mutual authentication or mechanisms such as TLS
certificate pinning, to mitigate the risk of channel compromise; see
<a href="#sec-considerations" class="xref">Section 7</a> for additional about this channel.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">Issuance begins by Clients hashing the TokenChallenge to produce a token input
as message = SHA256(challenge), and then blinding message as follows:<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-3">
<pre>
blinded_req, blind_inv = rsabssa_blind(ORIGIN_TOKEN_KEY, message)
</pre><a href="#section-5.3-3" class="pilcrow">¶</a>
</div>
<p id="section-5.3-4">The Client MUST use a randomized variant of RSABSSA in producing this signature with
a salt length of at least 32 bytes.<a href="#section-5.3-4" class="pilcrow">¶</a></p>
<p id="section-5.3-5">The Client uses CLIENT_SECRET to generate proof of its request.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-6">
<pre>
blind = RandomScalar()
blind_key = blind * CLIENT_SECRET
blind_generator = blind * Generator()
key_proof = SchnorrProof(CLIENT_SECRET, blind_key, blind_generator)
</pre><a href="#section-5.3-6" class="pilcrow">¶</a>
</div>
<p id="section-5.3-7">The Client then transforms this proof into "mapping_nonce", "mapping_key", "mapping_generator",
and "mapping_proof".<a href="#section-5.3-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-8">
<pre>
mapping_nonce = SerializeScalar(blind)
mapping_key = SerializeElement(blind_key)
mapping_generator = SerializeElement(blind_generator)
mapping_proof = SerializeProof(key_proof)
</pre><a href="#section-5.3-8" class="pilcrow">¶</a>
</div>
<p id="section-5.3-9">The Client then constructs a Private Access Token request using mapping_key,
mapping_generator, mapping_proof, blinded_req, and origin information.<a href="#section-5.3-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-10">
<pre>
struct {
   uint8_t version;
   uint8_t mapping_generator[Ne];
   uint8_t mapping_key[Ne];
   uint8_t mapping_proof[Np];
   uint8_t token_key_id;
   uint8_t blinded_req[Nk];
   uint8_t name_key_id[32];
   uint8_t encrypted_origin_name&lt;1..2^16-1&gt;;
} AccessTokenRequest;
</pre><a href="#section-5.3-10" class="pilcrow">¶</a>
</div>
<p id="section-5.3-11">The structure fields are defined as follows:<a href="#section-5.3-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3-12.1">"version" is a 1-octet integer, which matches the version in the TokenChallenge.
This document defines version 1.<a href="#section-5.3-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-12.2">"mapping_generator", "mapping_key", and "mapping_proof" are computed as described above.<a href="#section-5.3-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-12.3">"token_key_id" is the least significant byte of the ORIGIN_TOKEN_KEY key ID, which is
generated as SHA256(public_key), where public_key is a DER-encoded SubjectPublicKeyInfo
object carrying ORIGIN_TOKEN_KEY.<a href="#section-5.3-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-12.4">"blinded_req" is the Nk-octet request defined above.<a href="#section-5.3-12.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-12.5">"name_key_id" is a collision-resistant hash that identifies the ISSUER_KEY public
key, generated as SHA256(KeyConfig).<a href="#section-5.3-12.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.3-12.6">"encrypted_origin_name" is an encrypted structure that contains ORIGIN_NAME,
calculated as described in <a href="#encrypt-origin" class="xref">Section 5.7</a>.<a href="#section-5.3-12.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.3-13">The Client then generates an HTTP POST request to send through the Mediator to
the Issuer, with the AccessTokenRequest as the body. The media type for this request
is "message/access-token-request". The Client includes the "Sec-Token-Origin" header,
whose value is ANON_ORIGIN_ID; the "Sec-Token-Client" header, whose value is CLIENT_KEY; and
the "Sec-Token-Nonce" header, whose value is mapping_nonce. The Client sends this request
to the Mediator's proxy URI. An example request is shown below, where Nk = 512.<a href="#section-5.3-13" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3-14">
<pre>
:method = POST
:scheme = https
:authority = issuer.net
:path = /access-token-request
accept = message/access-token-response
cache-control = no-cache, no-store
content-type = message/access-token-request
content-length = 512
sec-token-origin = ANON_ORIGIN_ID
sec-token-client = CLIENT_KEY
sec-token-nonce = mapping_nonce

&lt;Bytes containing the AccessTokenRequest&gt;
</pre><a href="#section-5.3-14" class="pilcrow">¶</a>
</div>
<p id="section-5.3-15">If the Mediator detects a version in the AccessTokenRequest that it does not recognize
or support, it MUST reject the request with an HTTP 400 error.<a href="#section-5.3-15" class="pilcrow">¶</a></p>
<p id="section-5.3-16">The Mediator also checks to validate that the name_key_id in the client's AccessTokenRequest
matches a known ISSUER_KEY public key for the Issuer. For example, the Mediator can
fetch this key using the API defined in <a href="#setup" class="xref">Section 3</a>. This check is done to help ensure that
the Client has not been given a unique key that could allow the Issuer to fingerprint or target
the Client. If the key does not match, the Mediator rejects the request with an HTTP
400 error. Note that Mediators need to be careful in cases of key rotation; see
<a href="#privacy-considerations" class="xref">Section 8</a>.<a href="#section-5.3-16" class="pilcrow">¶</a></p>
<p id="section-5.3-17">The Mediator finally checks to ensure that the AccessTokenRequest.mapping_proof is valid
for the given CLIENT_KEY; see <a href="#nizk-dl" class="xref">Section 5.8</a> for verification details. If the index is invalid,
the Mediator rejects the request with an HTTP 400 error.<a href="#section-5.3-17" class="pilcrow">¶</a></p>
<p id="section-5.3-18">If the Mediator accepts the request, it will look up the state stored for this Client.
It will look up the count of previously generate tokens for this Client using the same
ANON_ORIGIN_ID. See <a href="#mediator-state" class="xref">Section 5.1.2</a> for more details.<a href="#section-5.3-18" class="pilcrow">¶</a></p>
<p id="section-5.3-19">If the Mediator has stored state that a previous request for this ANON_ORIGIN_ID was
rejected by the Issuer in the current policy window, it SHOULD reject the request without
forwarding it to the Issuer.<a href="#section-5.3-19" class="pilcrow">¶</a></p>
<p id="section-5.3-20">If the Mediator detects this Client has changed their CLIENT_ID more frequently than allowed
as described in <span class="contact-name">#mediator-state</span>, it SHOULD reject the request without forwarding it to
the Issuer.<a href="#section-5.3-20" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request-two">
<section id="section-5.4">
        <h3 id="name-mediator-to-issuer-request">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-mediator-to-issuer-request" class="section-name selfRef">Mediator-to-Issuer Request</a>
        </h3>
<p id="section-5.4-1">The Mediator and the Issuer MUST use a secure and Issuer-authenticated HTTPS
connection. Also, Issuers MUST authenticate Mediators, either via mutual
TLS or another form of application-layer authentication. They MAY additionally use
mechanisms such as TLS certificate pinning, to mitigate the risk of channel
compromise; see <a href="#sec-considerations" class="xref">Section 7</a> for additional about this channel.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<p id="section-5.4-2">Before copying and forwarding the Client's AccessTokenRequest request to the Issuer,
the Mediator adds a header that includes the count of previous tokens as "Sec-Token-Count".
The Mediator MAY also add additional context information, but MUST NOT add information
that will uniquely identify a Client.<a href="#section-5.4-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4-3">
<pre>
:method = POST
:scheme = https
:authority = issuer.net
:path = /access-token-request
accept = message/access-token-response
cache-control = no-cache, no-store
content-type = message/access-token-request
content-length = 512
sec-token-count = 3

&lt;Bytes containing the AccessTokenRequest&gt;
</pre><a href="#section-5.4-3" class="pilcrow">¶</a>
</div>
<p id="section-5.4-4">Upon receipt of the forwarded request, the Issuer validates the following conditions:<a href="#section-5.4-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4-5.1">The "Sec-Token-Count" header is present<a href="#section-5.4-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.2">The AccessTokenRequest contains a supported version<a href="#section-5.4-5.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.3">For version 1, the AccessTokenRequest.name_key_id corresponds to the ID of the ISSUER_KEY held by the Issuer<a href="#section-5.4-5.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.4">For version 1, the AccessTokenRequest.encrypted_origin_name can be decrypted using the
Issuer's private key (the private key associated with ISSUER_KEY), and matches
an ORIGIN_NAME that is served by the Issuer<a href="#section-5.4-5.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.5">For version 1, the AccessTokenRequest.blinded_req is of the correct size<a href="#section-5.4-5.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.4-5.6">For version 1, the AccessTokenRequest.token_key_id corresponds to an ID of an ORIGIN_TOKEN_KEY
for the corresponding ORIGIN_NAME<a href="#section-5.4-5.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.4-6">If any of these conditions is not met, the Issuer MUST return an HTTP 400 error to the Mediator,
which will forward the error to the client.<a href="#section-5.4-6" class="pilcrow">¶</a></p>
<p id="section-5.4-7">If the request is valid, the Issuer then can use the value from "Sec-Token-Count" to determine if
the Client is allowed to receive a token for this Origin during the current policy window. If the
Issuer refuses to issue more tokens, it responds with an HTTP 429 (Too Many Requests) error to the
Mediator, which will forward the error to the client.<a href="#section-5.4-7" class="pilcrow">¶</a></p>
<p id="section-5.4-8">The Issuer determines the correct ORIGIN_TOKEN_KEY by using the decrypted ORIGIN_NAME value and
AccessTokenRequest.token_key_id. If there is no ORIGIN_TOKEN_KEY whose truncated key ID matches
AccessTokenRequest.token_key_id, the Issuer MUST return an HTTP 401 error to Mediator, which will
forward the error to the client. The Mediator learns that the client's view of the Origin key
was invalid in the process.<a href="#section-5.4-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="response-one">
<section id="section-5.5">
        <h3 id="name-issuer-to-mediator-response">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-issuer-to-mediator-response" class="section-name selfRef">Issuer-to-Mediator Response</a>
        </h3>
<p id="section-5.5-1">If the Issuer is willing to give a token to the Client, the Issuer verifies the token request
using "mapping_generator", "mapping_key", and "mapping_proof":<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-2">
<pre>
valid = SchnorrVerify(mapping_generator, mapping_key, mapping_proof)
</pre><a href="#section-5.5-2" class="pilcrow">¶</a>
</div>
<p id="section-5.5-3">If this fails, the Issuer rejects the request with a 400 error. Otherwise, the Issuer decrypts
AccessTokenRequest.encrypted_origin_name to discover "origin". If this fails, the Issuer
rejects the request with a 400 error. The Issuer then evaluates the mapping over the ORIGIN_SECRET
pertaining to the origin for this issuer:<a href="#section-5.5-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-4">
<pre>
mapping_input = DeserializeElement(AccessTokenRequest.mapping_key)
index = ORIGIN_SECRET * mapping_input
mapping_index = SerializeElement(index)
</pre><a href="#section-5.5-4" class="pilcrow">¶</a>
</div>
<p id="section-5.5-5">If DeserializeElement fails, or if AccessTokenRequest.mapping_key is the identity element, the Issuer
rejects the request with a 400 error.<a href="#section-5.5-5" class="pilcrow">¶</a></p>
<p id="section-5.5-6">The Issuer completes the issuance flow by computing a blinded response as follows:<a href="#section-5.5-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-7">
<pre>
blind_sig = rsabssa_blind_sign(skP, AccessTokenRequest.blinded_req)
</pre><a href="#section-5.5-7" class="pilcrow">¶</a>
</div>
<p id="section-5.5-8"><code>skP</code> is the private key corresponding to ORIGIN_TOKEN_KEY, known only to the Issuer.<a href="#section-5.5-8" class="pilcrow">¶</a></p>
<p id="section-5.5-9">The Issuer generates an HTTP response with status code 200 whose body consists of
blind_sig, with the content type set as "message/access-token-response" and the
mapping_tag set in the "Sec-Token-Origin" header.<a href="#section-5.5-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5-10">
<pre>
:status = 200
content-type = message/access-token-response
content-length = 512
sec-token-origin = mapping_index

&lt;Bytes containing the blind_sig&gt;
</pre><a href="#section-5.5-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="response-two">
<section id="section-5.6">
        <h3 id="name-mediator-to-client-response">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-mediator-to-client-response" class="section-name selfRef">Mediator-to-Client Response</a>
        </h3>
<p id="section-5.6-1">Upon receipt of a successful response from the Issuer, the Mediator extracts the
"Sec-Token-Origin" header, and uses the value to determine ANON_ISSUER_ORIGIN_ID.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.6-2">
<pre>
index = DeserializeElement(mapping_index)
nonce = DeserializeScalar(mapping_nonce)
ANON_ISSUER_ORIGIN_ID = (nonce^(-1)) * index
</pre><a href="#section-5.6-2" class="pilcrow">¶</a>
</div>
<p id="section-5.6-3">If the "Sec-Token-Origin" is missing, or if the same ANON_ISSUER_ORIGIN_ID was previously
received in a response for a different ANON_ORIGIN_ID within the same policy window,
the Mediator MUST drop the token and respond to the client with an HTTP 400 status.
If there is not an error, the ANON_ISSUER_ORIGIN_ID is stored alongside the state
for the ANON_ORIGIN_ID.<a href="#section-5.6-3" class="pilcrow">¶</a></p>
<p id="section-5.6-4">For all other cases, the Mediator forwards all HTTP responses unmodified to the Client
as the response to the original request for this issuance.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
<p id="section-5.6-5">When the Mediator detects successful token issuance, it MUST increment the counter
in its state for the number of tokens issued to the Client for the ANON_ORIGIN_ID.<a href="#section-5.6-5" class="pilcrow">¶</a></p>
<p id="section-5.6-6">Upon receipt, the Client handles the response and, if successful, processes the
body as follows:<a href="#section-5.6-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.6-7">
<pre>
sig = rsabssa_finalize(ORIGIN_TOKEN_KEY, nonce, blind_sig, blind_inv)
</pre><a href="#section-5.6-7" class="pilcrow">¶</a>
</div>
<p id="section-5.6-8">If this succeeds, the Client then constructs a Private Access Token as described in
<a href="#challenge" class="xref">Section 4.1</a> using the token input message and output sig.<a href="#section-5.6-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encrypt-origin">
<section id="section-5.7">
        <h3 id="name-encrypting-origin-names">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-encrypting-origin-names" class="section-name selfRef">Encrypting Origin Names</a>
        </h3>
<p id="section-5.7-1">Given a <code>KeyConfig</code> (ISSUER_KEY), Clients produce encrypted_origin_name and authenticate
all other contents of the AccessTokenRequest using the following values:<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.7-2.1">the key identifier from the configuration, keyID, with the corresponding KEM identified by kemID,
the public key from the configuration, pkI, and;<a href="#section-5.7-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.7-2.2">a selected combination of KDF, identified by kdfID, and AEAD, identified by aeadID.<a href="#section-5.7-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.7-3">Beyond the key configuration inputs, Clients also require the AccessTokenRequest inputs.
Together, these are used to encapsulate ORIGIN_NAME (<code>origin_name</code>) and produce
ENCRYPTED_ORIGIN_NAME (<code>encrypted_origin</code>) as follows:<a href="#section-5.7-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5.7-4">
<li id="section-5.7-4.1">Compute an <span>[<a href="#HPKE" class="xref">HPKE</a>]</span> context using pkI, yielding context and encapsulation key enc.<a href="#section-5.7-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-5.7-4.2">Construct associated data, aad, by concatenating the values of keyID, kemID, kdfID,
aeadID, and all other values of the AccessTokenRequest structure.<a href="#section-5.7-4.2" class="pilcrow">¶</a>
</li>
          <li id="section-5.7-4.3">Encrypt (seal) request with aad as associated data using context, yielding ciphertext ct.<a href="#section-5.7-4.3" class="pilcrow">¶</a>
</li>
          <li id="section-5.7-4.4">Concatenate the values of aad, enc, and ct, yielding an Encapsulated Request enc_request.<a href="#section-5.7-4.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-5.7-5">Note that enc is of fixed-length, so there is no ambiguity in parsing this structure.<a href="#section-5.7-5" class="pilcrow">¶</a></p>
<p id="section-5.7-6">In pseudocode, this procedure is as follows:<a href="#section-5.7-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.7-7">
<pre>
enc, context = SetupBaseS(pkI, "AccessTokenRequest")
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(1, version),
             encode(Ne, mapping_generator),
             encode(Ne, mapping_key),
             encode(Np, mapping_proof),
             encode(1, token_key_id),
             encode(Nk, blinded_req),
             encode(32, name_key_id))
ct = context.Seal(aad, origin_name)
encrypted_origin_name = concat(enc, ct)
</pre><a href="#section-5.7-7" class="pilcrow">¶</a>
</div>
<p id="section-5.7-8">Issuers reverse this procedure to recover ORIGIN_NAME by computing the AAD as described
above and decrypting encrypted_origin_name with their private key skI, the private key
corresponding to pkI. In pseudocode, this procedure is as follows:<a href="#section-5.7-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.7-9">
<pre>
enc, ct = parse(encrypted_origin_name)
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(1, version),
             encode(Ne, mapping_generator),
             encode(Ne, mapping_key),
             encode(Np, mapping_proof),
             encode(1, token_key_id),
             encode(Nk, blinded_req),
             encode(32, name_key_id))
enc, context = SetupBaseR(enc, skI, "AccessTokenRequest")
origin_name, error = context.Open(aad, ct)
</pre><a href="#section-5.7-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="nizk-dl">
<section id="section-5.8">
        <h3 id="name-non-interactive-schnorr-pro">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-non-interactive-schnorr-pro" class="section-name selfRef">Non-Interactive Schnorr Proof of Knowledge</a>
        </h3>
<p id="section-5.8-1">Each Issuance request requires evaluation and verification of a Schnorr proof-of-knowledge.
Given input secret "secret" and two elements, "base" and "target", generation of this
proof (u, c, z), denoted SchnorrProof(secret, base, target), works as follows:<a href="#section-5.8-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.8-2">
<pre>
r = RandomScalar()
u = r * base
c = HashToScalar(SerializeElement(base) ||
                 SerializeElement(target) ||
                 SerializeElement(mask),
                 dst = "PrivateAccessTokensProof")
z = r + (c * secret)
</pre><a href="#section-5.8-2" class="pilcrow">¶</a>
</div>
<p id="section-5.8-3">The proof is encoded by serializing (u, c, z) as follows:<a href="#section-5.8-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.8-4">
<pre>
struct {
   uint8_t u[Ne];
   uint8_t c[Ns];
   uint8_t z[Ns];
} Proof;
</pre><a href="#section-5.8-4" class="pilcrow">¶</a>
</div>
<p id="section-5.8-5">The size of this structure is Np = Ne + 2*Ns bytes.<a href="#section-5.8-5" class="pilcrow">¶</a></p>
<p id="section-5.8-6">Verification of a proof (u, c, z), denoted SchnorrVerify(base, target, proof),
works as follows:<a href="#section-5.8-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.8-7">
<pre>
c = HashToScalar(SerializeElement(base) ||
                 SerializeElement(target) ||
                 SerializeElement(mask),
                 dst = "PrivateAccessTokensProof")
expected_left = base * z
expected_right = u + (target * c)
</pre><a href="#section-5.8-7" class="pilcrow">¶</a>
</div>
<p id="section-5.8-8">The proof is considered valid if expected_left is the same as expected_right.<a href="#section-5.8-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="examples">
<section id="section-6">
      <h2 id="name-instantiating-uses-cases">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-instantiating-uses-cases" class="section-name selfRef">Instantiating Uses Cases</a>
      </h2>
<p id="section-6-1">This section describes various instantiations of this protocol to address use cases
described in <a href="#motivation" class="xref">Section 1.1</a>.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="implement-rate-limit">
<section id="section-6.1">
        <h3 id="name-rate-limited-access-2">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-rate-limited-access-2" class="section-name selfRef">Rate-limited Access</a>
        </h3>
<p id="section-6.1-1">To instantiate this case, the site acts as an Origin and registers a "bounded token" policy
with the Issuer. In this policy, the Issuer enforces a fixed number of tokens that it will
allow a Client to request for a single ORIGIN_NAME.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">Origins request tokens from Clients and, upon successful redemption, the Origin knows
the Client was able to request a token for the given ORIGIN_NAME within its budget.
Failure to present a token can be interpreted as a signal that the client's token
budget was exceeded.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Clients can redeem a token from a specific challenge up to the <code>max-age</code> in the challenge.
Servers can choose to issue many challenges in a single HTTP 401 response, providing the
client with many challenge nonces which can be used to redeem tokens over a longer period
of time.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implement-geolocation">
<section id="section-6.2">
        <h3 id="name-client-geo-location-2">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-client-geo-location-2" class="section-name selfRef">Client Geo-Location</a>
        </h3>
<p id="section-6.2-1">To instantiate this use case, the Issuer has an issuing key pair per geographic region, i.e.,
each region has a unique policy key. When verifying the key for the Client request, the Mediator
obtains the per-region key from the Issuer based on the Client's perceived location. During
issuance, the Mediator checks that this key matches that of the Client's request. If it matches,
the Mediator forwards the request to complete issuance. The number of key pairs is then the cross
product of the number of Origins that require per-region keys and the number of regions.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">During redemption, Clients present their geographic location to Origins in a "Sec-CH-Geohash"
header. Origins use this to obtain the appropriate policy verification key. Origins request
tokens from Clients and, upon successful redemption, the Origin knows the Client obtained a
token for the given ORIGIN_NAME in the specified region.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="implement-authentication">
<section id="section-6.3">
        <h3 id="name-private-client-authenticatio">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-private-client-authenticatio" class="section-name selfRef">Private Client Authentication</a>
        </h3>
<p id="section-6.3-1">To instantiate this case, the site acts as an Origin and registers an "unlimited token"
policy with the Issuer. In this policy, the Issuer does not enforce any limit on the number
of tokens a given user will obtain.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<p id="section-6.3-2">Origins request tokens from Clients and, upon successful redemption, the Origin knows
the Client was able to request a token for the given ORIGIN_NAME tuple. As a
result, the Origin knows this is an authentic client.<a href="#section-6.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-7">
      <h2 id="name-security-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">This section discusses security considerations for the protocol.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">[OPEN ISSUE: discuss trust model]<a href="#section-7-2" class="pilcrow">¶</a></p>
<div id="client-identity-1">
<section id="section-7.1">
        <h3 id="name-client-identity-2">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-client-identity-2" class="section-name selfRef">Client Identity</a>
        </h3>
<p id="section-7.1-1">The HTTPS connection between Client and Mediator is minimally Mediator-authenticated. Mediators
can also require Client authentication if they wish to restrict Private Access Token proxying
to trusted or otherwise authenticated Clients. Absent some form of Client authentication, Mediators
can use other per-Client information for the client identifier mapping, such as IP addresses.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="denial-of-service">
<section id="section-7.2">
        <h3 id="name-denial-of-service">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-denial-of-service" class="section-name selfRef">Denial of Service</a>
        </h3>
<p id="section-7.2-1">Requesting and verifying a Private Access Token is more expensive than checking an implicit
signal, such as an IP address, especially since malicious clients can generate garbage
Private Access Tokens and for Origins to work. However, similar DoS vectors already exist
for Origins, e.g., at the underlying TLS layer.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="channel-security">
<section id="section-7.3">
        <h3 id="name-channel-security">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-channel-security" class="section-name selfRef">Channel Security</a>
        </h3>
<p id="section-7.3-1">An attacker that can act as an intermediate between Mediator and Issuer
communication can influence or disrupt the ability for the Issuer to correctly
rate-limit token issuance.  All communication channels use server-authenticated
HTTPS. Some connections, e.g., between a Mediator and an Issuer, require
mutual authentication between both endpoints. Where appropriate, endpoints
MAY use further enhancements such as TLS certificate pinning to mitigate
the risk of channel compromise.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<p id="section-7.3-2">An attacker that can intermediate the channel between Client and Origin can
observe a TokenChallenge, and can view a Token being presented for authentication
to an Origin. Scoping the TokenChallenge nonce to the Client HTTP session prevents
Tokens being collected in one session and then presented to the Origin in another.
Note that an Origin cannot distinguish between a connection to a single Client and
a connection to an attacker intermediating multiple Clients. Thus, it is possible for
an attacker to collect and later present Tokens from multiple clients over the same
Origin session.<a href="#section-7.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-8">
      <h2 id="name-privacy-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<div id="client-token-state-and-origin-tracking">
<section id="section-8.1">
        <h3 id="name-client-token-state-and-orig">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-client-token-state-and-orig" class="section-name selfRef">Client Token State and Origin Tracking</a>
        </h3>
<p id="section-8.1-1">Origins SHOULD only generate token challenges based on client action, such as when a user
loads a website. Clients SHOULD ignore token challenges if an Origin tries to force the
client to present tokens multiple times without any new client-initiated action. Failure
to do so can allow malicious origins to track clients across contexts. Specifically, an
origin can abuse per-user token limits for tracking by assigning each new client a random
token count and observing whether or not the client can successfully redeem that many
tokens in a given context. If any token redemption fails, then the origin learns information
about how many tokens that client had previously been issued.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">By rejecting repeated or duplicative challenges within a single context, the origin only
learns a single bit of information: whether or not the client had any token quota left
in the given policy window.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="origin-verification">
<section id="section-8.2">
        <h3 id="name-origin-verification">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-origin-verification" class="section-name selfRef">Origin Verification</a>
        </h3>
<p id="section-8.2-1">Private Access Tokens are defined in terms of a Client authenticating to an Origin, where
the "origin" is used as defined in <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. In order to limit cross-origin correlation,
Clients MUST verify that the origin_name presented in the TokenChallenge structure (<a href="#challenge" class="xref">Section 4.1</a>)
matches the origin that is providing the HTTP authentication challenge, where the matching logic
is defined for same-origin policies in <span>[<a href="#RFC6454" class="xref">RFC6454</a>]</span>. Clients MAY further limit which
authentication challenges they are willing to respond to, for example by only accepting
challenges when the origin is a web site to which the user navigated.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-identification-with-unique-keys">
<section id="section-8.3">
        <h3 id="name-client-identification-with-">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-client-identification-with-" class="section-name selfRef">Client Identification with Unique Keys</a>
        </h3>
<p id="section-8.3-1">Client activity could be linked if an Origin and Issuer collude to have unique keys targeted
at specific Clients or sets of Clients.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
<p id="section-8.3-2">To mitigate the risk of a targeted ISSUER_KEY, the Mediator can observe and validate
the name_key_id presented by the Client to the Issuer. As described in <a href="#issuance" class="xref">Section 5</a>, Mediators
MUST validate that the name_key_id in the Client's AccessTokenRequest matches a known public key
for the Issuer. The Mediator needs to support key rotation, but ought to disallow very rapid key
changes, which could indicate that an Origin is colluding with an Issuer to try to rotate the key
for each new Client in order to link the client activity.<a href="#section-8.3-2" class="pilcrow">¶</a></p>
<p id="section-8.3-3">To mitigate the risk of a targeted ORIGIN_TOKEN_KEY, the protocol expects that an Issuer has only
a single valid public key for signing tokens at a time. The Client does not present the name_key_id
of the token public key to the Issuer, but instead expects the Issuer to infer the correct key based
on the information the Issuer knows, specifically the origin_name itself.<a href="#section-8.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collusion">
<section id="section-8.4">
        <h3 id="name-collusion-among-different-e">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-collusion-among-different-e" class="section-name selfRef">Collusion Among Different Entities</a>
        </h3>
<p id="section-8.4-1">Collusion among the different entities in the PAT architecture can result in
violation of the Client's privacy.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">Issuers and Mediators should be run by mutually distinct organizations to limit
information sharing. A single entity running an issuer and mediator for a single redemption
can view the origins being accessed by a given client. Running the issuer and mediator in
this 'single issuer/mediator' fashion reduces the privacy promises to those of the
<span>[<a href="#I-D.ietf-privacypass-protocol" class="xref">I-D.ietf-privacypass-protocol</a>]</span>; see <a href="#privacy-pass" class="xref">Appendix A</a> for more discussion. This may be
desirable for a redemption flow that is limited to specific issuers and mediators,
but should be avoided where hiding origins from the mediator is desirable.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<p id="section-8.4-3">If a Mediator and Origin are able to collude, they can correlate a client's identity and origin access patterns through timestamp correlation. The
timing of a request to an Origin and subsequent token issuance to a Mediator can reveal the Client
identity (as known to the Mediator) to the Origin, especially if repeated over multiple accesses.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deploy">
<section id="section-9">
      <h2 id="name-deployment-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-deployment-considerations" class="section-name selfRef">Deployment Considerations</a>
      </h2>
<div id="origin-key-rollout">
<section id="section-9.1">
        <h3 id="name-origin-key-rollout">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-origin-key-rollout" class="section-name selfRef">Origin Key Rollout</a>
        </h3>
<p id="section-9.1-1">Issuers SHOULD generate a new (ORIGIN_TOKEN_KEY, ORIGIN_SECRET) regularly, and
SHOULD maintain old and new secrets to allow for graceful updates. The RECOMMENDED
rotation interval is two times the length of the policy window for that
information. During generation, issuers must ensure the <code>token_key_id</code> (the 8-bit
prefix of SHA256(ORIGIN_TOKEN_KEY)) is different from all other <code>token_key_id</code>
values for that origin currently in rotation. One way to ensure this uniqueness
is via rejection sampling, where a new key is generated until its <code>token_key_id</code> is
unique among all currently in rotation for the origin.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="authentication-scheme">
<section id="section-10.1">
        <h3 id="name-authentication-scheme">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-authentication-scheme" class="section-name selfRef">Authentication Scheme</a>
        </h3>
<p id="section-10.1-1">This document registers the "PrivateAccessToken" authentication scheme in the "Hypertext
Transfer Protocol (HTTP) Authentication Scheme Registry" established by <span>[<a href="#RFC7235" class="xref">RFC7235</a>]</span>.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<p id="section-10.1-2">Authentication Scheme Name: PrivateAccessToken<a href="#section-10.1-2" class="pilcrow">¶</a></p>
<p id="section-10.1-3">Pointer to specification text: <a href="#challenge" class="xref">Section 4.1</a> of this document<a href="#section-10.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-headers">
<section id="section-10.2">
        <h3 id="name-http-headers">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-http-headers" class="section-name selfRef">HTTP Headers</a>
        </h3>
<p id="section-10.2-1">This document registers four new headers for use on the token issuance path
in the "Permanent Message Header Field Names" &lt;<span><a href="https://www.iana.org/assignments/message-headers">https://www.iana.org/assignments/message-headers</a></span>&gt;.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<span id="name-registered-http-header"></span><div id="iana-header-type-table">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-10.2-2.1">
<pre>
    +-------------------+----------+--------+---------------+
    | Header Field Name | Protocol | Status |   Reference   |
    +-------------------+----------+--------+---------------+
    | Sec-Token-Origin  |   http   |  std   | This document |
    +-------------------+----------+--------+---------------+
    | Sec-Token-Client  |   http   |  std   | This document |
    +-------------------+----------+--------+---------------+
    | Sec-Token-Nonce   |   http   |  std   | This document |
    +-------------------+----------+--------+---------------+
    | Sec-Token-Count   |   http   |  std   | This document |
    +-------------------+----------+--------+---------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-registered-http-header" class="selfRef">Registered HTTP Header</a>
          </figcaption></figure>
</div>
</section>
</div>
<div id="media-types">
<section id="section-10.3">
        <h3 id="name-media-types">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-media-types" class="section-name selfRef">Media Types</a>
        </h3>
<p id="section-10.3-1">This specification defines the following protocol messages, along with their
corresponding media types:<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-10.3-2.1">AccessTokenRequest <a href="#issuance" class="xref">Section 5</a>: "message/access-token-request"<a href="#section-10.3-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-10.3-2.2">AccessTokenResponse <a href="#issuance" class="xref">Section 5</a>: "message/access-token-response"<a href="#section-10.3-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-10.3-3">The definition for each media type is in the following subsections.<a href="#section-10.3-3" class="pilcrow">¶</a></p>
<div id="messageaccess-token-request-media-type">
<section id="section-10.3.1">
          <h4 id="name-message-access-token-reques">
<a href="#section-10.3.1" class="section-number selfRef">10.3.1. </a><a href="#name-message-access-token-reques" class="section-name selfRef">"message/access-token-request" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-10.3.1-1">
            <dt id="section-10.3.1-1.1">
Type name:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.2">
              <p id="section-10.3.1-1.2.1">message<a href="#section-10.3.1-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.3">
Subtype name:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.4">
              <p id="section-10.3.1-1.4.1">access-token-request<a href="#section-10.3.1-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.5">
Required parameters:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.6">
              <p id="section-10.3.1-1.6.1">N/A<a href="#section-10.3.1-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.7">
Optional parameters:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.8">
              <p id="section-10.3.1-1.8.1">None<a href="#section-10.3.1-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.9">
Encoding considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.10">
              <p id="section-10.3.1-1.10.1">only "8bit" or "binary" is permitted<a href="#section-10.3.1-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.11">
Security considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.12">
              <p id="section-10.3.1-1.12.1">see <a href="#issuance" class="xref">Section 5</a><a href="#section-10.3.1-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.13">
Interoperability considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.14">
              <p id="section-10.3.1-1.14.1">N/A<a href="#section-10.3.1-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.15">
Published specification:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.16">
              <p id="section-10.3.1-1.16.1">this specification<a href="#section-10.3.1-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.17">
Applications that use this media type:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.18">
              <p id="section-10.3.1-1.18.1">N/A<a href="#section-10.3.1-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.19">
Fragment identifier considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.20">
              <p id="section-10.3.1-1.20.1">N/A<a href="#section-10.3.1-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.21">
Additional information:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-10.3.1-1.22.1">
                <dt id="section-10.3.1-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.1-1.22.1.2">N/A<a href="#section-10.3.1-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.1-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.1-1.22.1.4">N/A<a href="#section-10.3.1-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.1-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.1-1.22.1.6">N/A<a href="#section-10.3.1-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.1-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.1-1.22.1.8">N/A<a href="#section-10.3.1-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.23">
Person and email address to contact for further information:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.24">
              <p id="section-10.3.1-1.24.1">see Authors' Addresses section<a href="#section-10.3.1-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.25">
Intended usage:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.26">
              <p id="section-10.3.1-1.26.1">COMMON<a href="#section-10.3.1-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.27">
Restrictions on usage:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.28">
              <p id="section-10.3.1-1.28.1">N/A<a href="#section-10.3.1-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.29">
Author:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.30">
              <p id="section-10.3.1-1.30.1">see Authors' Addresses section<a href="#section-10.3.1-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.1-1.31">
Change controller:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.1-1.32">
              <p id="section-10.3.1-1.32.1">IESG<a href="#section-10.3.1-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
<div id="messageaccess-token-response-media-type">
<section id="section-10.3.2">
          <h4 id="name-message-access-token-respon">
<a href="#section-10.3.2" class="section-number selfRef">10.3.2. </a><a href="#name-message-access-token-respon" class="section-name selfRef">"message/access-token-response" media type</a>
          </h4>
<span class="break"></span><dl class="dlParallel" id="section-10.3.2-1">
            <dt id="section-10.3.2-1.1">
Type name:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.2">
              <p id="section-10.3.2-1.2.1">message<a href="#section-10.3.2-1.2.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.3">
Subtype name:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.4">
              <p id="section-10.3.2-1.4.1">access-token-response<a href="#section-10.3.2-1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.5">
Required parameters:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.6">
              <p id="section-10.3.2-1.6.1">N/A<a href="#section-10.3.2-1.6.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.7">
Optional parameters:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.8">
              <p id="section-10.3.2-1.8.1">None<a href="#section-10.3.2-1.8.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.9">
Encoding considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.10">
              <p id="section-10.3.2-1.10.1">only "8bit" or "binary" is permitted<a href="#section-10.3.2-1.10.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.11">
Security considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.12">
              <p id="section-10.3.2-1.12.1">see <a href="#issuance" class="xref">Section 5</a><a href="#section-10.3.2-1.12.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.13">
Interoperability considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.14">
              <p id="section-10.3.2-1.14.1">N/A<a href="#section-10.3.2-1.14.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.15">
Published specification:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.16">
              <p id="section-10.3.2-1.16.1">this specification<a href="#section-10.3.2-1.16.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.17">
Applications that use this media type:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.18">
              <p id="section-10.3.2-1.18.1">N/A<a href="#section-10.3.2-1.18.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.19">
Fragment identifier considerations:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.20">
              <p id="section-10.3.2-1.20.1">N/A<a href="#section-10.3.2-1.20.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.21">
Additional information:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.22">
              <span class="break"></span><dl class="dlParallel" id="section-10.3.2-1.22.1">
                <dt id="section-10.3.2-1.22.1.1">Magic number(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.2-1.22.1.2">N/A<a href="#section-10.3.2-1.22.1.2" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.2-1.22.1.3">Deprecated alias names for this type:</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.2-1.22.1.4">N/A<a href="#section-10.3.2-1.22.1.4" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.2-1.22.1.5">File extension(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.2-1.22.1.6">N/A<a href="#section-10.3.2-1.22.1.6" class="pilcrow">¶</a>
</dd>
                <dd class="break"></dd>
<dt id="section-10.3.2-1.22.1.7">Macintosh file type code(s):</dt>
                <dd style="margin-left: 1.5em" id="section-10.3.2-1.22.1.8">N/A<a href="#section-10.3.2-1.22.1.8" class="pilcrow">¶</a>
</dd>
              <dd class="break"></dd>
</dl>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.23">
Person and email address to contact for further information:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.24">
              <p id="section-10.3.2-1.24.1">see Authors' Addresses section<a href="#section-10.3.2-1.24.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.25">
Intended usage:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.26">
              <p id="section-10.3.2-1.26.1">COMMON<a href="#section-10.3.2-1.26.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.27">
Restrictions on usage:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.28">
              <p id="section-10.3.2-1.28.1">N/A<a href="#section-10.3.2-1.28.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.29">
Author:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.30">
              <p id="section-10.3.2-1.30.1">see Authors' Addresses section<a href="#section-10.3.2-1.30.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
<dt id="section-10.3.2-1.31">
Change controller:  </dt>
            <dd style="margin-left: 1.5em" id="section-10.3.2-1.32">
              <p id="section-10.3.2-1.32.1">IESG<a href="#section-10.3.2-1.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="BLINDSIG">[BLINDSIG]</dt>
        <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Jacobs, F.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"RSA Blind Signatures"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-rsa-blind-signatures-02</span>, <time datetime="2021-08-02" class="refDate">2 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-02">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R. L.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hpke-12</span>, <time datetime="2021-09-02" class="refDate">2 September 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-12">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-hpke-12</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OHTTP">[OHTTP]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious HTTP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-thomson-http-oblivious-02</span>, <time datetime="2021-08-24" class="refDate">24 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-thomson-http-oblivious-02">https://datatracker.ietf.org/doc/html/draft-thomson-http-oblivious-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4648">[RFC4648]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span>, <span class="refTitle">"The Base16, Base32, and Base64 Data Encodings"</span>, <span class="seriesInfo">RFC 4648</span>, <span class="seriesInfo">DOI 10.17487/RFC4648</span>, <time datetime="2006-10" class="refDate">October 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4648">https://www.rfc-editor.org/rfc/rfc4648</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6454">[RFC6454]</dt>
        <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"The Web Origin Concept"</span>, <span class="seriesInfo">RFC 6454</span>, <span class="seriesInfo">DOI 10.17487/RFC6454</span>, <time datetime="2011-12" class="refDate">December 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6454">https://www.rfc-editor.org/rfc/rfc6454</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7235">[RFC7235]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span> and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Authentication"</span>, <span class="seriesInfo">RFC 7235</span>, <span class="seriesInfo">DOI 10.17487/RFC7235</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc7235">https://www.rfc-editor.org/rfc/rfc7235</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8941">[RFC8941]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P-H. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 8941</span>, <span class="seriesInfo">DOI 10.17487/RFC8941</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8941">https://www.rfc-editor.org/rfc/rfc8941</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS13">[TLS13]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="VOPRF">[VOPRF]</dt>
      <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Faz-Hernandez, A.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious Pseudorandom Functions (OPRFs) using Prime-Order Groups"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-voprf-07</span>, <time datetime="2021-07-06" class="refDate">6 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-07">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-voprf-07</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-privacypass-protocol">[I-D.ietf-privacypass-protocol]</dt>
      <dd>
<span class="refAuthor">Celi, S.</span>, <span class="refAuthor">Davidson, A.</span>, and <span class="refAuthor">A. Faz-Hernandez</span>, <span class="refTitle">"Privacy Pass Protocol Specification"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-protocol-01</span>, <time datetime="2021-02-22" class="refDate">22 February 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-01">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="privacy-pass">
<section id="appendix-A">
      <h2 id="name-related-work-privacy-pass">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-related-work-privacy-pass" class="section-name selfRef">Related Work: Privacy Pass</a>
      </h2>
<p id="appendix-A-1">Private Access Tokens has many similarities to the existing Privacy Pass protocol
(<span>[<a href="#I-D.ietf-privacypass-protocol" class="xref">I-D.ietf-privacypass-protocol</a>]</span>). Both protocols allow clients to redeem signed
tokens while not allowing linking between token issuance and token redemption.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<p id="appendix-A-2">There are several important differences between the protocols, however:<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A-3.1">Private Access Tokens uses per-origin tokens that support rate-limiting policies. Each
token can only be used with a specific origin in accordance with a policy defined for that
origin. This allows origins to implement metered paywalls or mechanisms that that limit the
actions a single client can perform. Per-origin tokens also ensure that one origin cannot
consume all of a client's tokens, so there is less need for clients to manage when they are
willing to present tokens to origins.<a href="#appendix-A-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-3.2">Private Access Tokens employ an online challenge (<a href="#challenge" class="xref">Section 4.1</a>) during token redemption.
This ensures that tokens cannot be harvested and stored for use later. This also removes
the need for preventing double spending or employing token expiry techniques, such as
frequent signer rotation or expiry-encoded public metadata.<a href="#appendix-A-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="appendix-A-3.3">Private Access Tokens use a publically verifiable signature
<span>[<a href="#BLINDSIG" class="xref">BLINDSIG</a>]</span> to optimize token
verification at the origin by avoiding a round trip to the issuer/mediator.<a href="#appendix-A-3.3" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Scott Hendrickson</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:scott@shendrickson.com" class="email">scott@shendrickson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jana Iyengar</span></div>
<div dir="auto" class="left"><span class="org">Fastly</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jri@fastly.com" class="email">jri@fastly.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tommy Pauly</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tpauly@apple.com" class="email">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steven Valdez</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:svaldez@chromium.org" class="email">svaldez@chromium.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
