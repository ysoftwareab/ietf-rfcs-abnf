<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Presence</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Presence">
<meta name="keywords" content="XMPP, Jabber, SIP, SIMPLE, IM, Instant Messaging, Presence">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Saint-Andre</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">XMPP Standards Foundation</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">A. Houri</td></tr>
<tr><td class="header">Expires: July 7, 2008</td><td class="header">IBM</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">J. Hildebrand</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Jabber, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 04, 2008</td></tr>
</table></td></tr></table>
<h1><br />Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Presence<br />draft-saintandre-sip-xmpp-presence-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 7, 2008.</p>

<h3>Abstract</h3>

<p>This document defines a bi-directional protocol mapping for the exchange of presence information between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP).
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#sub">2.</a>&nbsp;
Presence Subscriptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-over">2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-xmpp">2.2.</a>&nbsp;
XMPP to SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sub-sip">2.3.</a>&nbsp;
SIP to XMPP<br />
<a href="#pres">3.</a>&nbsp;
Presence Notifications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pres-over">3.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pres-xmpp">3.2.</a>&nbsp;
XMPP to SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pres-sip">3.3.</a>&nbsp;
SIP to XMPP<br />
<a href="#content">4.</a>&nbsp;
Content Types<br />
<a href="#sec">5.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In order to help ensure interworking between presence systems that conform to the requirements of <a class='info' href='#IMP-REQS'>RFC 2779<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a> [IMP&#8209;REQS], it is important to clearly define protocol mappings between such systems.  Within the IETF, work has proceeded on two presence technologies:
</p>
<p>
        </p>
<ul class="text">
<li>Various extensions to the Session Initiation Protocol (<a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>) for instant messaging, as developed within the SIP for Instant Messaging and Presence Leveraging Extensions (SIMPLE) Working Group; the relevant specification for presence is <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>
</li>
<li>The Extensible Messaging and Presence Protocol (XMPP), which consists of a formalization of the core XML streaming protocols developed originally by the Jabber open-source community; the relevant specifications are <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> for the XML streaming layer and <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> for basic presence and instant messaging extensions
</li>
</ul><p>
      
</p>
<p>One approach to helping ensure interworking between these protocols is to map each protocol to the abstract semantics described in <a class='info' href='#CPIM'>[CPIM]<span> (</span><span class='info'>Peterson, J., &ldquo;Common Profile for Instant Messaging (CPIM),&rdquo; August&nbsp;2004.</span><span>)</span></a>; that is the approach taken by <a class='info' href='#SIMPLE-CPIM'>[SIMPLE&#8209;CPIM]<span> (</span><span class='info'>Rosenberg, J. and B. Campbell, &ldquo;CPIM Mapping of SIMPLE Presence and Instant Messaging,&rdquo; June&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#XMPP-CPIM'>[XMPP&#8209;CPIM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM),&rdquo; October&nbsp;2004.</span><span>)</span></a>.  The approach taken in this document is to directly map semantics from one protocol to another (i.e., from SIP/SIMPLE to XMPP and vice-versa).
</p>
<p>The architectural assumptions underlying such direct mappings are provided in <a class='info' href='#SIP-XMPP'>[SIP&#8209;XMPP]<span> (</span><span class='info'>Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; January&nbsp;2008.</span><span>)</span></a>, including mapping of addresses and error condisions.  The mappings specified in this document cover basic presence functionality.  Mapping of more advanced functionality is out of scope for this document, but other documents in this "series" cover such topics.
</p>
<p>Note: The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#TERMS'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [TERMS].
</p>
<a name="sub"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Presence Subscriptions</h3>

<a name="sub-over"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Overview</h3>

<p>Both XMPP and presence-aware SIP systems enable entities (often but not necessarily human users) to subscribe to the presence of other entities.  XMPP presence subscriptions are specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  Presence subscriptions using a SIP event package for presence are specified in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>.
</p>
<p>As described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, XMPP presence subscriptions are managed using XMPP presence stanzas of type "subscribe", "subscribed", "unsubscribe", and "unsubscribed".  The main subscription states are "none" (neither the user nor the contact is subscribed to the other's presence information), "from" (the user has a subscription from the contact), "to" (the user has a subscription to the contact's presence information), and "both" (both user and contact are subscribed to each other's presence information).
</p>
<p>As described in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>, SIP presence subscriptions are managed through the use of SIP SUBSCRIBE events sent from a SIP user agent to an intended recipient who is most generally referenced by an Instant Message URI of the form &lt;pres:user@domain&gt; but who may be referenced by a SIP or SIPS URI of the form &lt;sip:user@domain&gt; or &lt;sips:user@domain&gt;.
</p>
<p>The subscription models underlying XMPP and SIP are quite different.  For instance, XMPP presence subscriptions are long-lived (indeed permanent if not explicitly cancelled), whereas SIP presence subscriptions are short-lived (the default time to live of a SIP presence subscription is 3600 seconds, as specified in Section 6.4 of <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>).  These differences are addressed below.
</p>
<a name="sub-xmpp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
XMPP to SIP</h3>

<a name="sub-xmpp-establish"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.1"></a><h3>2.2.1.&nbsp;
Establishing</h3>

<p>An XMPP user initiates a subscription by sending a subscription request to another entity (conventionally called a "contact"), which request the contact either accepts or declines.  If the contact accepts the request, the user will have a subscription to the contact's presence information until (1) the user unsubscribes or (2) the contact cancels the subscription.  The subscription request is encapsulated in a presence stanza of type "subscribe":
</p>
<p>Example: XMPP user subscribes to SIP contact:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='juliet@example.com'
|            to='romeo@example.net'
|            type='subscribe'/&gt;
</pre></div>
<p>Upon receiving such a stanza, the XMPP server to which Juliet has connected needs to determine the identity of the foreign domain, which it does by performing one or more <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookups.  For presence stanzas, the order of lookups recommended by <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> is to first try the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and to then try the "_pres" service as specified in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a>.  Here we assume that the first lookup will fail but that the second lookup will succeed and return a resolution "_pres._simple.example.net.", since we have already assumed that the example.net hostname is running a SIP presence service.
</p>
<p>Once the XMPP server has determined that the foreign domain is serviced by a SIMPLE server, it must determine how to proceed.  We here assume that the XMPP server contains or has available to it an XMPP-SIMPLE gateway.  The XMPP server would then deliver the presence stanza to the XMPP-SIMPLE gateway.
</p>
<p>The XMPP-SIMPLE gateway is then responsible for translating the XMPP subscription request into a SIP SUBSCRIBE request from the XMPP user to the SIP user:
</p>
<p>Example: XMPP user subscribes to SIP contact (SIP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  SUBSCRIBE sip:romeo@example.net SIP/2.0
|  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bKna998sk
|  From: &lt;sip:juliet@example.com&gt;;tag=ffd2
|  To: &lt;sip:romeo@example.net&gt;
|  Call-ID: l04th3s1p@example.com
|  Event: presence
|  Max-Forwards: 70
|  CSeq: 123 SUBSCRIBE
|  Contact: &lt;sip:sipgate.example.com;transport=tcp&gt;
|  Accept: application/pidf+xml
|  Expires: 3600
|  Content-Length: 0
</pre></div>
<p>The SIP user then SHOULD send a response indicating acceptance of the subscription request:
</p>
<p>Example: SIP accepts subscription request:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  SIP/2.0 200 OK
|  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:romeo@example.net&gt;;tag=ffd2
|  To: &lt;sip:juliet@example.com&gt;;tag=j89d
|  Call-ID: l04th3s1p@example.com
|  CSeq: 234 SUBSCRIBE
|  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
|  Expires: 3600
|  Content-Length: 0
</pre></div>
<p>In accordance with <a class='info' href='#SIP-EVENT'>[SIP&#8209;EVENT]<span> (</span><span class='info'>Roach, A., &ldquo;Session Initiation Protocol (SIP)-Specific Event Notification,&rdquo; June&nbsp;2002.</span><span>)</span></a>, the XMPP-SIMPLE gateway should consider the subscription state to be "neutral" until it receives a NOTIFY message.  Therefore the SIP user or SIP-XMPP gateway at the SIP user's domain SHOULD immediately send a NOTIFY message containing a "Subscription-State" header whose value contains the string "active" (see <a class='info' href='#pres'>Section&nbsp;3<span> (</span><span class='info'>Presence Notifications</span><span>)</span></a>).
</p>
<p>Example: SIP user sends presence notification:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  NOTIFY sip:192.0.2.1 SIP/2.0
|  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:romeo@example.net&gt;;tag=yt66
|  To: &lt;sip:juliet@example.com&gt;;tag=bi54
|  Call-ID: l04th3s1p@example.com
|  Event: presence
|  Subscription-State: active;expires=499
|  Max-Forwards: 70
|  CSeq: 8775 NOTIFY
|  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
|  Content-Type: application/pidf+xml
|  Content-Length: 193
|
|  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
|  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
|            entity='pres:romeo@example.net'&gt;
|    &lt;tuple id='orchard'&gt;
|      &lt;status&gt;
|        &lt;basic&gt;open&lt;/basic&gt;
|      &lt;/status&gt;
|    &lt;/tuple&gt;
|  &lt;/presence&gt;
</pre></div>
<p>Upon receiving the first NOTIFY with a subscription state of active, the XMPP-SIMPLE gateway MUST generate a presence stanza of type "subscribed":
</p>
<p>Example: XMPP user receives acknowledgement from SIP contact:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence to='romeo@example.net'
|            from='juliet@example.com'
|            type='subscribed'/&gt;
</pre></div>
<p>For information about handling of the NOTIFY message, see <a class='info' href='#pres'>Section&nbsp;3<span> (</span><span class='info'>Presence Notifications</span><span>)</span></a>.
</p>
<a name="sub-xmpp-refresh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.2"></a><h3>2.2.2.&nbsp;
Refreshing</h3>

<p>It is the responsibility of the XMPP-SIMPLE gateway to set the value of the "Expires" header and to periodically renew the subscription on the SIMPLE side of the gateway so that the subscription appears to be permanent to the XMPP user (e.g., the XMPP-SIMPLE gateway SHOULD send a new SUBSCRIBE request to the SIP user whenever the XMPP user sends initial presence to its XMPP server, i.e., upon initiating a presence session with the XMPP server).  See the <a class='info' href='#sec'>Security Considerations<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> of this document for important information and requirements regarding the security implications of this functionality.
</p>
<a name="sub-xmpp-cancel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2.3"></a><h3>2.2.3.&nbsp;
Cancelling</h3>

<p>At any time after subscribing, the XMPP user may unsubscribe from the contact's presence.  This is done by sending a presence stanza of type "unsubscribe":
</p>
<p>Example: XMPP user unsubscribes from SIP contact:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='juliet@example.com'
|            to='romeo@example.net'
|            type='unsubscribe'/&gt;
</pre></div>
<p>The XMPP-SIMPLE gateway is responsible for translating the unsubscribe command into a SIP SUBSCRIBE request with the "Expires" header set to a value of zero:
</p>
<p>Example: XMPP user unsubscribes from SIP contact (SIP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  SUBSCRIBE sip:romeo@example.net SIP/2.0
|  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:juliet@example.com&gt;;tag=j89d
|  To: &lt;sip:romeo@example.net&gt;;tag=xfg9
|  Call-ID: 1ckm32@example.com
|  Event: presence
|  Max-Forwards: 70
|  CSeq: 789 SUBSCRIBE
|  Contact: &lt;sip:x2s.example.com;transport=tcp&gt;
|  Accept: application/pidf+xml
|  Expires: 0
|  Content-Length: 0
</pre></div>
<p>Upon sending the transformed unsubscribe, the XMPP-SIMPLE gateway SHOULD a presence stanza of type "unsubscribed" to the XMPP user:
</p>
<p>Example: XMPP user receives unsubscribed notification:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence to='romeo@example.net'
|            from='juliet@example.com'
|            type='unsubscribed'/&gt;
</pre></div>
<a name="sub-sip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
SIP to XMPP</h3>

<a name="sub-sip-establish"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Establishing</h3>

<p>A SIP user initiates a subscription to a contact's presence information by sending a SIP SUBSCRIBE request to the contact.  The following is an example of such a request:
</p>
<p>Example: SIP user subscribes to XMPP contact:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  SUBSCRIBE sip:juliet@example.com SIP/2.0
|  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:romeo@example.net&gt;;tag=xfg9
|  To: &lt;sip:juliet@example.com&gt;;tag=ur93
|  Call-ID: 4wcm0n@example.net
|  Event: presence
|  Max-Forwards: 70
|  CSeq: 263 SUBSCRIBE
|  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
|  Accept: application/pidf+xml
|  Content-Length: 0
</pre></div>
<p>Upon receiving such a request, a SIMPLE-XMPP gateway is responsible for translating it into an XMPP subscription request from the SIP user to the XMPP user:
</p>
<p>Example: SIP user subscribes to XMPP contact (XMPP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='romeo@example.net'
|            to='juliet@example.com'
|            type='subscribe'/&gt;
</pre></div>
<p>Notice that the "Expires" header was not included in the SUBSCRIBE request; this means that the default value of 3600 (i.e., 3600 seconds = 1 hour) applies.
</p>
<a name="sub-sip-refresh"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.2"></a><h3>2.3.2.&nbsp;
Refreshing</h3>

<p>It is the responsibility of the SIMPLE-XMPP gateway to properly handle the difference between short-lived SIP presence subscriptions and long-lived XMPP presence subscriptions.  The gateway has two options when the SIP user's subscription expires:
</p>
<p></p>
<ul class="text">
<li>Cancel the subscription (i.e., treat it as temporary) and send an XMPP presence stanza of type "unsubscribe" to the XMPP contact; this honors the SIP semantic but will seem rather odd to the XMPP contact.
</li>
<li>Maintain the subscription (i.e., treat it as long-lived) and (1) send a SIP NOTIFY request to the SIP user containing a PIDF document specifying that the XMPP contact now has a basic status of "closed", including a Subscription-State of "terminated" and (2) send an XMPP presence stanza of type "unavailable" to the XMPP contact; this violates the letter of the SIP semantic but will seem more natural to the XMPP contact.
</li>
</ul>

<p>Which of these options the SIMPLE-XMPP gateway chooses is up to the implementation.
</p>
<p>If the implementation chooses the first option, the protocol generated would be as follows:
</p>
<p>Example: SIP subscription expires (treated as temporary by gateway):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='romeo@example.net'
|            to='juliet@example.com'
|            type='unsubscribe'/&gt;
</pre></div>
<p>If the implementation chooses the second option, the protocol generated would be as follows:
</p>
<p>Example: SIP subscription expires (treated as long-lived by gateway):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  NOTIFY sip:192.0.2.2 SIP/2.0
|  Via: SIP/2.0/TCP s2x.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:juliet@example.com&gt;;tag=ur93
|  To: &lt;sip:romeo@example.net&gt;;tag=pq72
|  Call-ID: j4s0h4vny@example.com
|  Event: presence
|  Subscription-State: terminated;reason=timeout
|  Max-Forwards: 70
|  CSeq: 232 NOTIFY
|  Contact: &lt;sip:sipgate.example.com;transport=tcp&gt;
|  Content-Type: application/pidf+xml
|  Content-Length: 194
|
|  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
|  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
|            entity='pres:juliet@example.com'&gt;
|    &lt;tuple id='balcony'&gt;
|      &lt;status&gt;
|        &lt;basic&gt;closed&lt;/basic&gt;
|      &lt;/status&gt;
|    &lt;/tuple&gt;
|  &lt;/presence&gt;
</pre></div>
<p>Example: SIP subscription expires (treated as long-lived by gateway):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='romeo@example.net'
|            to='juliet@example.com'
|            type='unavailable'/&gt;
</pre></div>
<a name="sub-sip-cancel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.3"></a><h3>2.3.3.&nbsp;
Cancelling</h3>

<p>At any time, the SIP user may cancel the subscription by sending a SUBSCRIBE message whose "Expires" header is set to a value of zero ("0"):
</p>
<p>Example: SIP user cancels subscription:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  SUBSCRIBE sip:192.0.2.1 SIP/2.0
|  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:romeo@example.net&gt;;tag=yt66
|  To: &lt;sip:juliet@example.com&gt;;tag=bi54
|  Call-ID: 1tsn1ce@example.net
|  Event: presence
|  Max-Forwards: 70
|  CSeq: 8775 SUBSCRIBE
|  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
|  Expires: 0
|  Content-Length: 0
</pre></div>
<p>As above, upon receiving such a request, a SIMPLE-XMPP gateway is responsible for doing one of the following:
</p>
<p></p>
<ul class="text">
<li>Cancel the subscription (i.e., treat it as temporary) and send an XMPP presence stanza of type "unsubscribe" to the XMPP contact.
</li>
<li>Maintain the subscription (i.e., treat it as long-lived) and (1) send a SIP NOTIFY request to the SIP user containing a PIDF document specifying that the XMPP contact now has a basic status of "closed", (2) send a SIP SUBSCRIBE request to the SIP user with an "Expires" header set to a value of "0" (zero) when it receives XMPP presence of type "unavailable" from the XMPP contact, and (3) send an XMPP presence stanza of type "unavailable" to the XMPP contact.
</li>
</ul>

<a name="pres"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Presence Notifications</h3>

<a name="pres-over"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overview</h3>

<p>Both XMPP and presence-aware SIP systems enable entities (often but not necessarily human users) to send presence notifications to other entities.  At a minimum, the term "presence" refers to information about an entity's availability for communication on a network (on/off), often supplemented by information that further specifies the entity's communications context (e.g., "do not disturb").  Some systems and protocols extend this notion even further and refer to any relatively ephemeral information about an entity as a kind of presence; categories of such "extended presence" include geographical location (e.g., GPS coordinates), user mood (e.g., grumpy), user activity (e.g., walking), and ambient environment (e.g., noisy).  In this document, we focus on the "least common denominator" of network availability only, although future documents may address broader notions of presence, including extended presence.
</p>
<p>Presence using XMPP presence stanzas of type "available" or "unavailable" is specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  SIP presence using a SIP event package for presence is specified in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>.
</p>
<p>As described in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, presence information about an entity is communicated by means of an XML &lt;presence/&gt; stanza sent over an XML stream.  In this document we will assume that such a presence stanza is sent from an XMPP client to an XMPP server over an XML stream negotiated between the client and the server, and that the client is controlled by a human user (again, this is a simplifying assumption introduced for explanatory purposes only).  In general, XMPP presence is sent by the user to the user's server and then broadcasted to all entities who are subscribed to the user's presence information.
</p>
<p>As described in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>, presence information about an entity is communicated by means of a SIP NOTIFY event sent from a SIP user agent to an intended recipient who is most generally referenced by an Instant Message URI of the form &lt;pres:user@domain&gt; but who may be referenced by a SIP or SIPS URI of the form &lt;sip:user@domain&gt; or &lt;sips:user@domain&gt;.  Here again we introduce the simplifying assumption that the user agent is controlled by a human user.
</p>
<a name="pres-xmpp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
XMPP to SIP</h3>

<p>When Juliet interacts with her XMPP client to modify her presence information (or when her client automatically updates her presence information, e.g. via an "auto-away" feature), her client generates an XMPP &lt;presence/&gt; stanza.  The syntax of the &lt;presence/&gt; stanza, including required and optional elements and attributes, is defined in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>.  The following is an example of such a stanza:
</p>
<p>Example: XMPP user sends presence notification:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='juliet@example.com/balcony'/&gt;
</pre></div>
<p>Upon receiving such a stanza, the XMPP server to which Juliet has connected broadcasts it to all subscribers who are authorized to receive presence notifications from Juliet (this is similar to the SIP NOTIFY method).  For each subscriber, broadcasting the presence notification involves either delivering it to a local recipient (if the hostname in the subscriber's address matches one of the hostnames serviced by the XMPP server) or attempting to route it to the foreign domain that services the hostname in the subscriber's address.  Naturally, in this document we assume that the hostname is a SIP presence service hosted by a separate server.  As specified in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>, the XMPP server needs to determine the identity of the foreign domain, which it does by performing one or more <a class='info' href='#SRV'>[SRV]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> lookups.  For presence stanzas, the order of lookups recommended by <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> is to first try the "_xmpp-server" service as specified in <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a> and to then try the "_pres" service as specified in <a class='info' href='#IMP-SRV'>[IMP&#8209;SRV]<span> (</span><span class='info'>Peterson, J., &ldquo;Address Resolution for Instant Messaging and Presence,&rdquo; August&nbsp;2004.</span><span>)</span></a>.  Here we assume that the first lookup will fail but that the second lookup will succeed and return a resolution "_pres._simple.example.net.", since we have already assumed that the example.net hostname is running a SIP presence service.  (Note: The XMPP server may have previously determined that the foreign domain is a SIMPLE server, e.g., when it sent a SIP SUBSCRIBE to the SIP user when Juliet sent initial presence to the XMPP server, in which case it would not need to perform the SRV lookups; the caching of such information is a matter of implementation and local service policy, and is therefore out of scope for this document.)
</p>
<p>Once the XMPP server has determined that the foreign domain is serviced by a SIMPLE server, it must determine how to proceed.  We here assume that the XMPP server contains or has available to it an XMPP-SIMPLE gateway.  The XMPP server would then deliver the presence stanza to the XMPP-SIMPLE gateway.
</p>
<p>The XMPP-SIMPLE gateway is then responsible for translating the XMPP presence stanza into a SIP NOTIFY request and included PIDF document from the XMPP user to the SIP user.
</p>
<p>Example: XMPP user sends presence notification (SIP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  NOTIFY sip:192.0.2.2 SIP/2.0
|  Via: SIP/2.0/TCP x2s.example.com;branch=z9hG4bKna998sk
|  From: &lt;sip:juliet@example.com&gt;;tag=gh19
|  To: &lt;sip:romeo@example.net&gt;;tag=yt66
|  Call-ID: j4s0h4vny@example.com
|  Event: presence
|  Subscription-State: active;expires=599
|  Max-Forwards: 70
|  CSeq: 157 NOTIFY
|  Contact: &lt;sip:sipgate.example.com;transport=tcp&gt;
|  Content-Type: application/pidf+xml
|  Content-Length: 192
|
|  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
|  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
|            entity='pres:juliet@example.com'&gt;
|    &lt;tuple id='balcony'&gt;
|      &lt;status&gt;
|        &lt;basic&gt;open&lt;/basic&gt;
|      &lt;/status&gt;
|    &lt;/tuple&gt;
|  &lt;/presence&gt;
</pre></div>
<p>The mapping of XMPP syntax elements to SIP syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 6: Presence syntax mapping from XMPP to SIP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +-----------------------------+---------------------------+
   |  XMPP Element or Attribute  |  SIP Header or PIDF Data  |
   +-----------------------------+---------------------------+
   |  &lt;presence/&gt; stanza         |  "Event: presence" [1]    |
   |  XMPP resource identifer    |  tuple 'id' attribute     |
   |  from                       |  From                     |
   |  id                         |  Call-ID                  |
   |  to                         |  To                       |
   |  type                       |  basic status [2][3]      |
   |  xml:lang                   |  Content-Language         |
   |  &lt;priority/&gt;                |  PIDF priority for tuple  |
   |  &lt;show/&gt;                    |  (no mapping)             |
   |  &lt;status/&gt;                  |  note [4]                 |
   +-----------------------------+---------------------------+
</pre></div>
<p>Note the following regarding these mappings:
</p>
<p></p>
<ol class="text">
<li>Only a presence stanza that lacks a 'type' attribute or whose 'type' attribute has a value of "unavailable" should be mapped by an XMPP-SIMPLE gateway to a SIP NOTIFY request, since those are the only presence stanzas that represent notifications.
</li>
<li>Because the lack of a 'type' attribute indicates that an XMPP entity is available for communications, the gateway SHOULD map that information to a PIDF &lt;basic/&gt; status of "open".  Because a 'type' attribute with a value of "unavailable" indicates that an XMPP entity is not available for communications, the gateway SHOULD map that information to a PIDF &lt;basic/&gt; status of "closed".
</li>
<li>When the XMPP-SIMPLE gateway receives XMPP presence of type "unavailable" from the XMPP contact, it SHOULD (1) send a SIP NOTIFY request to the SIP user containing a PIDF document specifying that the XMPP contact now has a basic status of "closed" and (2) send a SIP SUBSCRIBE request to the SIP user with an "Expires" header set to a value of "0" (zero).
</li>
<li>The character data of the XMPP &lt;status/&gt; element MAY be mapped to the character data of the PIDF &lt;note/&gt; element.
</li>
</ol>

<a name="pres-sip"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
SIP to XMPP</h3>

<p>When Romeo changes his presence, his SIP user agent generates a SIP NOTIFY request for any active subscriptions.  The syntax of the NOTIFY request is defined in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a>.  The following is an example of such a request:
</p>
<p>Example: SIP user sends presence notification:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  NOTIFY sip:192.0.2.1 SIP/2.0
|  Via: SIP/2.0/TCP simple.example.net;branch=z9hG4bKna998sk
|  From: &lt;sip:romeo@example.net&gt;;tag=yt66
|  To: &lt;sip:juliet@example.com&gt;;tag=bi54
|  Call-ID: j0sj4sv1m@example.net
|  Event: presence
|  Subscription-State: active;expires=499
|  Max-Forwards: 70
|  CSeq: 8775 NOTIFY
|  Contact: &lt;sip:simple.example.net;transport=tcp&gt;
|  Content-Type: application/pidf+xml
|  Content-Length: 193
|
|  &lt;?xml version='1.0' encoding='UTF-8'?&gt;
|  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
|            entity='pres:romeo@example.net'&gt;
|    &lt;tuple id='orchard'&gt;
|      &lt;status&gt;
|        &lt;basic&gt;open&lt;/basic&gt;
|      &lt;/status&gt;
|    &lt;/tuple&gt;
|  &lt;/presence&gt;
</pre></div>
<p>Upon receiving such a request, a SIMPLE-XMPP gateway is responsible for translating it into an XMPP presence stanza from the SIP user to the XMPP user:
</p>
<p>Example: SIP user sends presence notification (XMPP transformation):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
|  &lt;presence from='romeo@example.net'
|            to='juliet@example.com/balcony'
|            type='unavailable'/&gt;
</pre></div>
<p>The mapping of SIP syntax elements to XMPP syntax elements SHOULD be as shown in the following table.  (Mappings for elements not mentioned are undefined.)
</p>
<p>Table 7: Presence syntax mapping from SIP to XMPP
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +---------------------------+-----------------------------+
   |  SIP Header or PIDF Data  |  XMPP Element or Attribute  |
   +---------------------------+-----------------------------+
   |  basic status             |  type [1]                   |
   |  Content-Language         |  xml:lang                   |
   |  CSeq                     |  id (OPTIONAL)              |
   |  From                     |  from                       |
   |  priority for tuple       |  &lt;priority/&gt;                |
   |  To                       |  to                         |
   |  body of MESSAGE          |  &lt;body/&gt;                    |
   +---------------------------+-----------------------------+
</pre></div>
<p>Note the following regarding these mappings:
</p>
<p></p>
<ol class="text">
<li>A PIDF basic status of "open" SHOULD be mapped to no 'type' attribute, and a PIDF basic status of "closed" SHOULD be mapped to a 'type' attribute whose value is "unavailable".
</li>
</ol>

<a name="content"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Content Types</h3>

<p>SIP requests of type NOTIFY normally contain presence information encapsulated using the "application/pidf+xml" content type.  The recommended procedures for SIMPLE-to-XMPP gateways to use in handling these content types are as follows.
</p>
<p>The "application/pidf+xml' content type is specified in <a class='info' href='#PIDF'>[PIDF]<span> (</span><span class='info'>Sugano, H., Fujimoto, S., Klyne, G., Bateman, A., Carr, W., and J. Peterson, &ldquo;Presence Information Data Format (PIDF),&rdquo; August&nbsp;2004.</span><span>)</span></a>.  The Presence Information Data Format defines a common data format for presence protocols that conform to the Common Profile for Presence (<a class='info' href='#CPP'>[CPP]<span> (</span><span class='info'>Peterson, J., &ldquo;Common Profile for Presence (CPP),&rdquo; August&nbsp;2004.</span><span>)</span></a>), enabling presence information to be transferred across CPP-compliant protocol boundaries without modification, with attendant benefits for end-to-end encryption and performance.  Because the syntax for the "application/pidf+xml" content type is Extensible Markup Language (<a class='info' href='#XML'>[XML]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., and E. Maler, &ldquo;Extensible Markup Language (XML) 1.0 (2nd ed),&rdquo; October&nbsp;2000.</span><span>)</span></a>), it is straightforward to send PIDF data over the Extensible Messaging and Presence Protocol (<a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>), since XMPP is simply an XML streaming protocol.
</p>
<p>In addition to following the syntax mappings specified in <a class='info' href='#pres'>Section&nbsp;3<span> (</span><span class='info'>Presence Notifications</span><span>)</span></a>, a SIMPLE-to-XMPP gateway MAY encapsulate PIDF data within an "extended namespace" contained in an XMPP presence stanza.  The RECOMMENDED method is to include the PIDF &lt;presence/&gt; element as a child of the XMPP &lt;presence/&gt; stanza.  Although it may appear that this would be potentially confusing, the inclusion of the 'urn:ietf:params:xml:ns:pidf' namespace ensures that PIDF data is kept separate from XMPP presence data (in accordance with <a class='info' href='#XML-NAMES'>[XML&#8209;NAMES]<span> (</span><span class='info'>Bray, T., Hollander, D., and A. Layman, &ldquo;Namespaces in XML,&rdquo; January&nbsp;1999.</span><span>)</span></a>).  The following is a simple example of encapsulating PIDF data within an "extended namespace" in XMPP:
</p>
<p>A basic example of PIDF over XMPP:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;presence from='romeo@example.net/orchard' xml:lang='en'&gt;
  &lt;show&gt;dnd&lt;/show&gt;
  &lt;status&gt;Wooing Juliet&lt;/status&gt;
  &lt;presence xmlns='urn:ietf:params:xml:ns:pidf'
            entity='pres:romeo@example.net'&gt;
    &lt;tuple id='orchard'&gt;
      &lt;status&gt;
        &lt;basic&gt;open&lt;/basic&gt;
      &lt;/status&gt;
    &lt;/tuple&gt;
  &lt;/presence&gt;
&lt;/presence&gt;
</pre></div>
<a name="sec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>Detailed security considerations for presence protocols are given in <a class='info' href='#IMP-REQS'>[IMP&#8209;REQS]<span> (</span><span class='info'>Day, M., Aggarwal, S., and J. Vincent, &ldquo;Instant Messaging / Presence Protocol Requirements,&rdquo; February&nbsp;2000.</span><span>)</span></a>, for SIP-based presence in <a class='info' href='#SIP-PRES'>[SIP&#8209;PRES]<span> (</span><span class='info'>Rosenberg, J., &ldquo;A Presence Event Package for the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2004.</span><span>)</span></a> (see also <a class='info' href='#SIP'>[SIP]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>), and for XMPP-based presence in <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a> (see also <a class='info' href='#XMPP'>[XMPP]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Core,&rdquo; October&nbsp;2004.</span><span>)</span></a>).
</p>
<p>The mismatch between long-lived XMPP presence subscriptions and short-lived SIP presence subscriptions introduces the possibility of an amplification attack launched from the XMPP network against a SIP presence server.  To help prevent such an attack, access to an XMPP-SIMPLE gateway that is hosted on the XMPP network SHOULD be restricted to XMPP users associated with a single domain or trust realm (e.g., a gateway hosted at simple.example.com should allow only users within the example.com domain to access the gateway, not users within example.org, example.net, or any other domain); if a SIP presence server receives communications through an XMPP-SIMPLE gateway from users who are not associated with a domain that is so related to the hostname of the gateway, it MAY (based on local service provisioning) refuse to service such users or refuse to communicate with the gateway.  Furthermore, whenever an XMPP-SIMPLE gateway seeks to refresh an XMPP user's long-lived subscription to a SIP user's presence, it MUST first send an XMPP &lt;presence/&gt; stanza of type "probe" from the address of the gateway to the "bare JID" (user@domain.tld) of the XMPP user, to which the user's XMPP server MUST respond in accordance with <a class='info' href='#XMPP-IM'>[XMPP&#8209;IM]<span> (</span><span class='info'>Saint-Andre, P., &ldquo;Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence,&rdquo; October&nbsp;2004.</span><span>)</span></a>; however, the administrator of an XMPP-SIMPLE gateway MAY (based on local service provisioning) exempt "known good" XMPP servers from this check (e.g., the XMPP server associated with the XMPP-SIMPLE gateway as described above).
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IMP-SRV">[IMP-SRV]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3861">Address Resolution for Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3861, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="PIDF">[PIDF]</a></td>
<td class="author-text">Sugano, H., Fujimoto, S., Klyne, G., Bateman, A., Carr, W., and J. Peterson, &ldquo;<a href="http://tools.ietf.org/html/rfc3863">Presence Information Data Format (PIDF)</a>,&rdquo; RFC&nbsp;3863, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3863.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP">[SIP]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-EVENT">[SIP-EVENT]</a></td>
<td class="author-text">Roach, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3265">Session Initiation Protocol (SIP)-Specific Event Notification</a>,&rdquo; RFC&nbsp;3265, June&nbsp;2002 (<a href="ftp://ftp.isi.edu/in-notes/rfc3265.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-PRES">[SIP-PRES]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3856">A Presence Event Package for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3856, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3856.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIP-XMPP">[SIP-XMPP]</a></td>
<td class="author-text">Saint-Andre, P., Houri, A., and J. Hildebrand, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-00.txt">Interworking between the Session Initiation Protocol (SIP) and the Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; draft-saintandre-sip-xmpp-core-00 (work in progress), January&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-saintandre-sip-xmpp-core-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SRV">[SRV]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TERMS">[TERMS]</a></td>
<td class="author-text"><a href="mailto:-">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:jeanpa@microsoft.com">Paoli, J.</a>, <a href="mailto:cmsmcq@uic.edu">Sperberg-McQueen, C.</a>, and <a href="mailto:eve.maler@east.sun.com">E. Maler</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml">Extensible Markup Language (XML) 1.0 (2nd ed)</a>,&rdquo; W3C&nbsp;REC-xml, October&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML-NAMES">[XML-NAMES]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:dmh@corp.hp.com">Hollander, D.</a>, and <a href="mailto:andrewl@microsoft.com">A. Layman</a>, &ldquo;<a href="http://www.w3.org/TR/REC-xml-names">Namespaces in XML</a>,&rdquo; W3C&nbsp;REC-xml-names, January&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP">[XMPP]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3920">Extensible Messaging and Presence Protocol (XMPP): Core</a>,&rdquo; RFC&nbsp;3920, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3920.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-IM">[XMPP-IM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3921">Extensible Messaging and Presence Protocol (XMPP): Instant Messaging and Presence</a>,&rdquo; RFC&nbsp;3921, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3921.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CPIM">[CPIM]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3860">Common Profile for Instant Messaging (CPIM)</a>,&rdquo; RFC&nbsp;3860, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3860.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="CPP">[CPP]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3859">Common Profile for Presence (CPP)</a>,&rdquo; RFC&nbsp;3859, August&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3859.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IMP-REQS">[IMP-REQS]</a></td>
<td class="author-text"><a href="mailto:mday@alum.mit.edu">Day, M.</a>, <a href="mailto:sonuag@microsoft.com">Aggarwal, S.</a>, and <a href="mailto:jesse@intonet.com">J. Vincent</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2779">Instant Messaging / Presence Protocol Requirements</a>,&rdquo; RFC&nbsp;2779, February&nbsp;2000 (<a href="ftp://ftp.isi.edu/in-notes/rfc2779.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SIMPLE-CPIM">[SIMPLE-CPIM]</a></td>
<td class="author-text">Rosenberg, J. and B. Campbell, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-cpim-mapping-01.txt">CPIM Mapping of SIMPLE Presence and Instant Messaging</a>,&rdquo; draft-ietf-simple-cpim-mapping-01 (work in progress), June&nbsp;2002 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-simple-cpim-mapping-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XMPP-CPIM">[XMPP-CPIM]</a></td>
<td class="author-text">Saint-Andre, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3922">Mapping the Extensible Messaging and Presence Protocol (XMPP) to Common Presence and Instant Messaging (CPIM)</a>,&rdquo; RFC&nbsp;3922, October&nbsp;2004 (<a href="ftp://ftp.isi.edu/in-notes/rfc3922.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Peter Saint-Andre</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">XMPP Standards Foundation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 1641</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Denver, CO  80201</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stpeter@jabber.org">stpeter@jabber.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Avshalom Houri</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IBM</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Building 18/D, Kiryat Weizmann Science Park</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Rehovot  76123</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Israel</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:avshalom@il.ibm.com">avshalom@il.ibm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Joe Hildebrand</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jabber, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1899 Wynkoop Street, Suite 600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Denver, CO  80202</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jhildebrand@jabber.com">jhildebrand@jabber.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
