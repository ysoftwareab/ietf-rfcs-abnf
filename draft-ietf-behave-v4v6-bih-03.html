<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Dual Stack Hosts Using "Bump-in-the-Host" (BIH)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Acknowledgement of previous work">
<link href="#rfc.section.2" rel="Chapter" title="2 Components of the Bump-in-the-Host">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Function Mapper">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Protocol translator">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Extension Name Resolver">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Special exclusion sets for A and AAAA records">
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 DNSSEC support">
<link href="#rfc.section.2.3.3" rel="Chapter" title="2.3.3 Reverse DNS lookup">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Address Mapper">
<link href="#rfc.section.3" rel="Chapter" title="3 Behavior and network Examples">
<link href="#rfc.section.4" rel="Chapter" title="4 Considerations">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Socket API Conversion">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 ICMP Message Handling">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 IPv4 Address Pool and Mapping Table">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Multi-interface">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Multicast">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 DNS cache">
<link href="#rfc.section.5" rel="Chapter" title="5 Considerations due ALG requirements">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Changes since RFC2767 and RFC3338">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Implementation option for the ENR">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B API list intercepted by BIH">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Bump-In-the-Host (BIH) is a host-based IPv4 to IPv6 protocol translation mechanism that allows a class of IPv4-only applications that work through NATs to communicate with IPv6-only peers. The host on which applications are running may be connected to IPv6-only or dual-stack access networks.  BIH hides IPv6 and makes the IPv4-only applications think they are talking with IPv4 peers by local synthesis of IPv4 addresses.  " />
  <meta name="description" content="Bump-In-the-Host (BIH) is a host-based IPv4 to IPv6 protocol translation mechanism that allows a class of IPv4-only applications that work through NATs to communicate with IPv6-only peers. The host on which applications are running may be connected to IPv6-only or dual-stack access networks.  BIH hides IPv6 and makes the IPv4-only applications think they are talking with IPv4 peers by local synthesis of IPv4 addresses.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Behave WG</td>
<td class="right">B.Huang. Huang</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">H.Deng. Deng</td>
</tr>
<tr>
<td class="left">Obsoletes: 3338, 2767 (if approved)</td>
<td class="right">China Mobile</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">T.Savolainen. Savolainen</td>
</tr>
<tr>
<td class="left">Expires: September 12, 2011</td>
<td class="right">Nokia</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 11, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Dual Stack Hosts Using "Bump-in-the-Host" (BIH)<br />
  <span class="filename">draft-ietf-behave-v4v6-bih-03</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Bump-In-the-Host (BIH) is a host-based IPv4 to IPv6 protocol translation mechanism that allows a class of IPv4-only applications that work through NATs to communicate with IPv6-only peers. The host on which applications are running may be connected to IPv6-only or dual-stack access networks.  BIH hides IPv6 and makes the IPv4-only applications think they are talking with IPv4 peers by local synthesis of IPv4 addresses.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 12, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Acknowledgement of previous work</a>
</li>
<li>2.   <a href="#rfc.section.2">Components of the Bump-in-the-Host</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Function Mapper</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Protocol translator</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Extension Name Resolver</a>
</li>
<li>2.3.1.   <a href="#rfc.section.2.3.1">Special exclusion sets for A and AAAA records</a>
</li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">DNSSEC support</a>
</li>
<li>2.3.3.   <a href="#rfc.section.2.3.3">Reverse DNS lookup</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">Address Mapper</a>
</li>
<li>3.   <a href="#rfc.section.3">Behavior and network Examples</a>
</li>
<li>4.   <a href="#rfc.section.4">Considerations</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Socket API Conversion</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">ICMP Message Handling</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">IPv4 Address Pool and Mapping Table</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Multi-interface</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Multicast</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">DNS cache</a>
</li>
<li>5.   <a href="#rfc.section.5">Considerations due ALG requirements</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Changes since RFC2767 and RFC3338</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgments</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Implementation option for the ENR</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">API list intercepted by BIH</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This document describes Bump-in-the-Host (BIH), a successor and combination of the Bump-in-the-Stack (BIS)<a href="#RFC2767">[RFC2767]</a> and Bump-in-the-API (BIA) <a href="#RFC3338">[RFC3338]</a> technologies, which enable IPv4-only legacy applications to communicate with IPv6-only servers by synthesizing IPv4 addresses from AAAA records.  </p>
<p id="rfc.section.1.p.2">The supported class of applications includes those that use DNS for IP address resolution and that do not embed IP address literals in protocol payloads.  This essentially includes legacy client-server applications using the DNS that are agnostic to the IP address family used by the destination and that are able to do NAT traversal. The synthetic IPv4 addresses shown to applications are taken from the RFC1918 private address pool in order to ensure that possible NAT traversal techniques will be initiated.  </p>
<p id="rfc.section.1.p.3">IETF recommends using dual-stack or tunneling based solutions for IPv6 transition and specifically recommends against deployments utilizing double protocol translation. Use of BIH together with a NAT64 is NOT RECOMMENDED as a competing technology for tunneling based transition solutions.  </p>
<p id="rfc.section.1.p.4">BIH includes two major implementation options: a protocol translator between the IPv4 and the IPv6 stacks of a host, or an API translator between the IPv4 socket API module and the TCP/IP module.  Essentially, IPv4 is translated into IPv6 at the socket API layer or at the IP layer.  </p>
<p id="rfc.section.1.p.5">When BIH is implemented at the socket API layer, the translator intercepts IPv4 socket API function calls and invokes corresponding IPv6 socket API function calls to communicate with IPv6 hosts.  </p>
<p id="rfc.section.1.p.6">When BIH is implemented at the networking layer the IPv4 packets are intercepted and converted to IPv6 using the IP conversion mechanism defined in Stateless IP/ICMP Translation Algorithm (SIIT) <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>.  The protocol translation has the same benefits and drawbacks as SIIT.  </p>
<p id="rfc.section.1.p.7">The location of the BIH refers essentially to the location of the protocol translation function.  The location of DNS synthesis is orthogonal to the location of protocol translation, and may or may not happen at the same level. </p>
<p id="rfc.section.1.p.8">BIH can be used whenever an IPv4-only application needs to communicate with an IPv6-only server, independently of the address families supported by the access network. Hence the access network can be IPv6-only or dual-stack capable.  </p>
<p id="rfc.section.1.p.9">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a> .  </p>
<p id="rfc.section.1.p.10">This document uses terms defined in <a href="#RFC2460">[RFC2460]</a> , <a href="#RFC2893">[RFC2893]</a> , <a href="#RFC2767">[RFC2767]</a> and <a href="#RFC3338">[RFC3338]</a>.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Acknowledgement of previous work</h1>
<p id="rfc.section.1.1.p.1">This document is a direct update to and directly derivative from Kazuaki TSHUCHIYA, Hidemitsu HIGUCHI, and Yoshifumi ATARASHI's Bump-in-the-Stack <a href="#RFC2767">[RFC2767]</a> and from Seungyun Lee, Myung-Ki Shin, Yong-Jin Kim, Alain Durand, and Erik Nordmark's Bump-in-the-API <a href="#RFC3338">[RFC3338]</a>, which similarly provide a dual stack host means to communicate with other IPv6 hosts using existing IPv4 applications.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Components of the Bump-in-the-Host</h1>
<p id="rfc.section.2.p.1">Figure 1 shows the architecture of a host in which BIH is implemented as a socket API layer translator, i.e., as a "Bump-in-the-API".  </p>
<div id="#rfc.figure.1"></div>
<div id="#fig1"></div>
<pre>     
   
               +----------------------------------------------+
               | +------------------------------------------+ |
               | |                                          | |
               | |            IPv4 applications             | |
               | |                                          | |
               | +------------------------------------------+ |
               | +------------------------------------------+ |
               | |           Socket API (IPv4, IPv6)        | |
               | +------------------------------------------+ |
               | +-[ API translator]------------------------+ |
               | | +-----------+ +---------+ +------------+ | |
               | | | Ext. Name | | Address | | Function   | | |
               | | | Resolver  | | Mapper  | | Mapper     | | |
               | | +-----------+ +---------+ +------------+ | |
               | +------------------------------------------+ |
               | +--------------------+ +-------------------+ |
               | |                    | |                   | |
               | |    TCP(UDP)/IPv4   | |   TCP(UDP)/IPv6   | |
               | |                    | |                   | |
               | +--------------------+ +-------------------+ |
               +----------------------------------------------+
         </pre>
<p id="rfc.section.2.p.2">Figure 2 shows the architecture of a host in which BIH is implemented as a network layer translator, i.e., a "Bump-in-the-Stack".  </p>
<div id="#rfc.figure.2"></div>
<div id="#fig2"></div>
<pre>
   +------------------------------------------------------------+
   |  +------------------------------------------+              |
   |  |    IPv4 applications                     |              |
   |  |    Host's main DNS resolver              |              |
   |  +------------------------------------------+              |
   |  +------------------------------------------+              |  
   |  |    TCP/UDP                               |              |
   |  +------------------------------------------+              |
   |  +------------------------------------------+ +---------+  |
   |  |    IPv4                                  | |         |  |
   |  +------------------------------------------+ | Address |  |
   |  +------------------+ +---------------------+ | Mapper  |  |
   |  |    Protocol      | |   Extension Name    | |         |  |
   |  |    Translator    | |   Resolver          | |         |  |
   |  +------------------+ +---------------------+ |         |  |
   |  +------------------------------------------+ |         |  |
   |  |    IPv4 / IPv6                           | |         |  |
   |  +------------------------------------------+ +---------+  |
   +------------------------------------------------------------+
     </pre>
<p id="rfc.section.2.p.3">Dual stack hosts defined in RFC 2893 <a href="#RFC2893">[RFC2893]</a> need applications, TCP/IP modules and addresses for both IPv4 and IPv6. The proposed hosts in this document have an API or network-layer translator to allow existing IPv4 applications to communicate with IPv6-only peers.  The BIH architecture consists of an Extension Name Resolver, an Address Mapper, and depending on implementation either a Function Mapper or a Protocol Translator. It is worth noting that Extension Name Resolver's placement is orthogonal decision to placement of protocol translation. For example, the Extension Name Resolver may reside in the socket API while protocol translation takes place at the networking layer.  </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Function Mapper</h1>
<p id="rfc.section.2.1.p.1">The function mapper translates an IPv4 socket API function into an IPv6 socket API function.  </p>
<p id="rfc.section.2.1.p.2">When detecting IPv4 socket API function calls from IPv4 applications, the function mapper intercepts the function calls and invokes IPv6 socket API functions that correspond to the IPv4 socket API functions.  </p>
<p id="rfc.section.2.1.p.3">See Appendix B for a list of functions that MUST be intercepted by the function mapper.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Protocol translator</h1>
<p id="rfc.section.2.2.p.1">The protocol translator translates IPv4 into IPv6 and vice versa using the IP conversion mechanism defined in SIIT <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>. To avoid unnecessary fragmentation, host's IPv4 module should be configured with small enough MTU (IPv6 link MTU - 20 bytes).  </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> Extension Name Resolver</h1>
<p id="rfc.section.2.3.p.1">The Extension Name Resolver (ENR) returns a proper answer in response to the IPv4 application's name resolution request.  </p>
<p id="rfc.section.2.3.p.2">In the case of the socket API layer implementation option, when an IPv4 application tries to do a forward lookup to resolve names via the resolver library (e.g., gethostbyname()), BIH intercepts the function call and instead calls the IPv6 equivalent functions (e.g., getnameinfo()) that will resolve both A and AAAA records. This implementation option is name resolution protocol agnostic, and hence supports techniques such as "hosts-file", NetBIOS, mDNS, and essentially anything underlying operating system uses.  </p>
<p id="rfc.section.2.3.p.3">In the case of the network layer implementation option, the ENR intercepts the A query and creates an additional AAAA query with essentially the same content. The ENR will then collect replies to both A and AAAA queries and, depending on results, either return an A reply unmodified or synthesize a new A reply. The network layer implementation option will only be able to catch applications' name resolution requests that result in actual DNS queries, hence is more limited when compared to socket API layer implementation option.  </p>
<p id="rfc.section.2.3.p.4">In either implementation option, if only AAAA records are available for the queried name, the ENR asks the address mapper to assign a local IPv4 address corresponding to each IPv6 address. In the case of the API layer implementation option, the ENR will simply the make API (e.g. gethostbyname) return the synthetic address.  In the case of the network-layer implementation option, the ENR synthesizes an A record for the assigned IPv4 address, and delivers it up the stack.  </p>
<p id="rfc.section.2.3.p.5">If there is a real A record available, the ENR SHOULD NOT synthesize IPv4 addresses. By default an ENR implementation MUST NOT synthesize IPv4 addresses when real A records exist.  </p>
<p id="rfc.section.2.3.p.6">If the response contains a CNAME or a DNAME record, then the CNAME or DNAME chain is followed until the first terminating A or AAAA record is reached.  </p>
<div id="#rfc.figure.3"></div>
<div id="#Table 1"></div>
<pre>
     Application | Network  | ENR behavior
     query       | response |  
     ------------+----------+------------------------
        A        |   A      |  &lt;return real A record&gt;
        A        |   AAAA   |  &lt;synthesize A record&gt;
        A        |  A/AAAA  |  &lt;return real A record&gt;
     </pre>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> Special exclusion sets for A and AAAA records</h1>
<p id="rfc.section.2.3.1.p.1">An ENR implementation MAY by default exclude certain IPv4 and IPv6 addresses seen on received A and AAAA records. The addresses to be excluded by default SHOULD include martian addresses such as those that should not appear in the DNS or on the wire.  Additional addresses MAY be excluded based on possibly configurable local policies.  </p>
<h1 id="rfc.section.2.3.2">
<a href="#rfc.section.2.3.2">2.3.2.</a> DNSSEC support</h1>
<p id="rfc.section.2.3.2.p.1">When the ENR is implemented at the network layer, the A record synthesis can cause essentially the same issues as are described in <a href="#I-D.ietf-behave-dns64">[I-D.ietf-behave-dns64]</a> section 3. To avoid unwanted discarding of synthetic A records on the host's  main resolver, the host's main resolver MUST send DNS questions with the CD  "Checking Disabled" bit cleared. The ENR can support DNSSEC as any resolver on a host.  </p>
<p id="rfc.section.2.3.2.p.2">When the ENR is implemented at the socket API level, there are no problems with DNSSEC, as the ENR itself uses socket APIs for DNS resolution.</p>
<p id="rfc.section.2.3.2.p.3">DNSSEC can also be supported by configuring the (stub) resolver on a host to trust validations done by the ENR located at network layer or alternatively the validating resolver can implement ENR on itself.  </p>
<p id="rfc.section.2.3.2.p.4">In order to properly support DNSSEC, the ENR SHOULD be implemented at the socket API level. If the socket API level implementation is not possible, DNSSEC support SHOULD be provided by other means.  </p>
<h1 id="rfc.section.2.3.3">
<a href="#rfc.section.2.3.3">2.3.3.</a> Reverse DNS lookup</h1>
<p id="rfc.section.2.3.3.p.1">When an application initiates a reverse DNS query for a PTR record, to find a name for an IP address, the ENR MUST check whether the queried IP address can be found in the Address Mapper's mapping table and is a local IP address. If an entry is found and the queried address is locally generated, the ENR MUST initiate a corresponding reverse DNS query for the real IPv6 address. In the case application requested reverse lookup for an address not part of the local IPv4 address pool, e.g., a global address, the request MUST be forwarded unmodified to the network.  </p>
<p id="rfc.section.2.3.3.p.2">For example, when an application initiates a reverse DNS query for a synthesized locally valid IPv4 address, the ENR needs to intercept that query. The ENR asks the address mapper for the IPv6 address that corresponds to the IPv4 address. The ENR shall perform a reverse lookup procedure for the destination's IPv6 address and return the name received as a response to the application that  initiated the IPv4 query.  </p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> Address Mapper</h1>
<p id="rfc.section.2.4.p.1">The address mapper maintains a local IPv4 address pool. The pool consists of private IPv4 addresses as per section 4.3. Also, the address mapper maintains a table consisting of pairs of locally selected IPv4 addresses and destinations' IPv6 addresses.  </p>
<p id="rfc.section.2.4.p.2">When the extension name resolver, translator, or the function mapper requests the address mapper to assign an IPv4 address corresponding to an IPv6 address, the address mapper selects and returns an IPv4 address out of the local pool, and registers a new entry into the table.  The registration occurs in the following 3 cases: </p>
<p id="rfc.section.2.4.p.3">(1) When the extension name resolver gets only AAAA records for the target host name in the dual stack or IPv6-only network and there is no existing mapping entry for the IPv6 addresses.  One or more local IPv4 addresses will be returned to application and mappings for local IPv4 addresses to real IPv6 addresses are created.  </p>
<p id="rfc.section.2.4.p.4">(2) When the extension name resolver gets both A records and AAAA records, but the A records contain only excluded IPv4 addresses. Behavior will follow the case (1).  </p>
<p id="rfc.section.2.4.p.5">(3) When the function mapper gets a socket API function call triggered by a received IPv6 packet and there is no existing mapping entry for the IPv6 source address (for example, client sent UDP request to anycast address but response was received from unicast address).  </p>
<p id="rfc.section.2.4.p.6">Other possible combinations are outside of BIH and BIH is not involved in those.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Behavior and network Examples</h1>
<p id="rfc.section.3.p.1">Figure 4 illustrates a very basic network scenario. An IPv4-only application is running on a host attached to the IPv6-only Internet and is talking to an IPv6-only server. Communication is made possible by Bump-In-the-Host.</p>
<div id="#rfc.figure.4"></div>
<div id="#fig5"></div>
<pre>               
  +----+                                   +-------------+
  | H1 |----------- IPv6 Internet -------- | IPv6 server |
  +----+                                   +-------------+
  v4 only
  application
    </pre>
<p id="rfc.section.3.p.2">Figure 5 illustrates a possible network scenario where an IPv4-only application is running on a host attached to a dual-stack network, but the destination server is running on a private site that is numbered with public IPv6 addresses and private IPv4 addresses without port forwarding setup on the NAT44. The only means to contact the server is to use IPv6.</p>
<div id="#rfc.figure.5"></div>
<div id="#fig6"></div>
<pre>
  +----------------------+  +------------------------------+
  | Dual Stack Internet  |  | IPv4 Private site (Net 10)   |
  |                      |  |                              |
  |                      |  |                 +----------+ |
  |                      |  |                 |          | | 
  |  +----+           +---------+             |          | |
  |  | H1 |--------   |  NAT44  |-------------|  Server  | |
  |  +----+           +---------+             |          | |
  | v4 only              |  |                 +----------+ |
  | application          |  |                  Dual Stack  |
  |                      |  |                     10.1.1.1 |
  |                      |  |                 AAAA:2009::1 |
  |                      |  |                              |
  +----------------------+  +------------------------------+
    </pre>
<p id="rfc.section.3.p.3">Illustrations of host behavior in both implementation options are given here.  Figure 6 illustrates the setup where BIH is implemented as a bump in the API, and figure 7 illustrates the setup where BIH is implemented as a bump in the stack.  </p>
<div id="#rfc.figure.6"></div>
<div id="#fig7"></div>
<pre>   
"dual stack"                                                "host6"
IPv4    Socket |     [ API Translator ]    | TCP(UDP)/IP          Name
appli-  API    | ENR      Address  Function| (v6/v4)             Server
cation         |          Mapper   Mapper  |
 |        |        |        |        |         |              |       |
&lt;&lt;Resolve an IPv4 address for "host6".&gt;&gt;       |              |       |
 |        |        |        |        |         |              |       |
 |-------&gt;|-------&gt;|  Query of IPv4 address for host6.        |       |
 |        |        |        |        |         |              |       |
 |        |        |-------------------------------------------------&gt;|
 |        |        |  Query of 'A' records and 'AAAA' for host6       |
 |        |        |        |        |         |              |       |
 |        |        |&lt;-------------------------------------------------|
 |        |        |  Reply with the 'AAAA' record.           |       |
 |        |        |        |        |         |              |
 |        |        |&lt;&lt;The 'AAAA' record is resolved.&gt;&gt;        |
 |        |        |        |        |         |              |
 |        |        |+++++++&gt;|  Request one IPv4 address       |
 |        |        |        |  corresponding to the IPv6 address.
 |        |        |        |        |         |              |
 |        |        |        |&lt;&lt;Assign one IPv4 address.&gt;&gt;     |
 |        |        |        |        |         |              |
 |        |        |&lt;+++++++|  Reply with the IPv4 address.   |
 |        |        |        |        |         |              |
 |&lt;-------|&lt;-------| Reply with the IPv4 address              |
 |        |        |        |        |         |              |
 |        |        |        |        |         |              |
&lt;&lt;Call IPv4 Socket API function &gt;&gt;   |         |              |
 |        |        |        |        |         |              |
 |=======&gt;|=========================&gt;|An IPv4 Socket API function call
 |        |        |        |        |         |              |
 |        |        |        |&lt;+++++++|  Request IPv6 addresses|
 |        |        |        |        |  corresponding to the  |
 |        |        |        |        |  IPv4 addresses.       |
 |        |        |        |        |         |              |
 |        |        |        |+++++++&gt;| Reply with the IPv6 addresses.
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;Translate IPv4 into IPv6.&gt;&gt;
 |        |        |        |        |         |              |
 |  An IPv6 Socket API function call.|=======================&gt;|
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;IPv6 data received    |
 |        |        |        |        |  from network.&gt;&gt;       |
 |        |        |        |        |         |              |
 |  An IPv6 Socket API function call.|&lt;=======================|
 |        |        |        |        |         |              |
 |        |        |        |        |&lt;&lt;Translate IPv6 into IPv4.&gt;&gt;
 |        |        |        |        |         |              |
 |        |        |        |&lt;+++++++|  Request IPv4 addresses|
 |        |        |        |        |  corresponding to the  |
 |        |        |        |        |  IPv6 addresses.       |
 |        |        |        |        |         |              |
 |        |        |        |+++++++&gt;| Reply with the IPv4 addresses.
 |        |        |        |        |         |              |
 |&lt;=======|&lt;=========================|  An IPv4 Socket function call.
 |        |        |        |        |         |              |
    </pre>
<div id="#rfc.figure.7"></div>
<div id="#fig8"></div>
<pre>   
   "dual stack"                                         "host6"
IPv4 stub  TCP/    ENR     address  translator  IPv6
app  res.  IPv4            mapper       
  |   |    |       |         |       |           |         |
&lt;&lt;Resolve an IPv4 address for "host6".&gt;&gt;         |         |
  |--&gt;|    |       |         |       |           |         | 
  |   |-----------&gt;|  Query of 'A' records for "host6".    |  Name
  |   |    |       |         |       |           |         |  Server
  |   |    |       |-------------------------------------------&gt;|
  |   |    |       |  Query of 'A' records and 'AAAA' for "host6"
  |   |    |       |         |       |           |         |    |
  |   |    |       |&lt;-------------------------------------------|
  |   |    |       |  Reply only with 'AAAA' record.       |
  |   |    |       |         |       |           |         |
  |   |    |       |&lt;&lt;Only 'AAAA' record is resolved.&gt;&gt;    |
  |   |    |       |         |       |           |         |
  |   |    |       |--------&gt;|  Request one IPv4 address   |
  |   |    |       |         |  corresponding to each IPv6 address.
  |   |    |       |         |       |           |         |
  |   |    |       |         |&lt;&lt;Assign IPv4 addresses.&gt;&gt;   |
  |   |    |       |         |       |           |         |
  |   |    |       |&lt;--------|  Reply with the IPv4 address.
  |   |    |       |         |       |           |         |
  |   |    |       |&lt;&lt;Create 'A' record for the IPv4 address.&gt;&gt;
  |   |    |       |         |       |           |         |
  |   |&lt;-----------|  Reply with the 'A' record. |         |
  |   |    |       |         |       |           |         |
  |&lt;--|&lt;&lt;Reply with the IPv4 address |           |         |
  |   |    |       |         |       |           |         |
  &lt;&lt;Send an IPv4 packet to "host6".&gt;&gt;|           |         |
  |   |    |       |         |       |           |         |
  |=======&gt;|========================&gt;|  An IPv4 packet.    |
  |   |    |       |         |       |           |         |
  |   |    |       |         |&lt;------|  Request IPv6 addresses
  |   |    |       |         |       |  corresponding to the IPv4
  |   |    |       |         |       |  addresses.         |
  |   |    |       |         |       |           |         |
  |   |    |       |         |------&gt;|  Reply with the IPv6|
  |   |    |       |         |       |  addresses.         |
  |   |    |       |         |       |           |         |
  |   |    |       |         |       |&lt;&lt;Translate IPv4 into IPv6.&gt;&gt;
  |   |    |       |         |       |           |         |
  |   |    |       |An IPv6 packet.  |==========&gt;|========&gt;|
  |   |    |       |         |       |           |         |
  |   |    |       |         |   &lt;&lt;Reply with an IPv6 packet to.&gt;&gt;
  |   |    |       |         |       |           |         |
  |   |    |       |An IPv6 packet.  |&lt;==========|&lt;========|
  |   |    |       |         |       |           |         |
  |   |    |       |         |       |&lt;&lt;Translate IPv6 into IPv4.&gt;&gt;
  |   |    |       |         |       |           |         |
  |&lt;=======|=========================|  An IPv4 packet.    |
  |   |    |       |         |       |           |         |
    </pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Considerations</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Socket API Conversion</h1>
<p id="rfc.section.4.1.p.1">IPv4 socket API functions are translated into IPv6 socket API functions that are semantically as identical as possible and vice versa. See Appendix B for the API list intercepted by BIH. However, IPv4 socket API functions are not fully compatible with IPv6 since IPv4 supports features that are not present in IPv6, such as SO_BROADCAST.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> ICMP Message Handling</h1>
<p id="rfc.section.4.2.p.1">When an application needs ICMP messages values (e.g., Type, Code, etc.) sent from the network layer, ICMPv4 message values MAY be translated into ICMPv6 message values based on SIIT <a href="#I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</a>, and vice versa.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> IPv4 Address Pool and Mapping Table</h1>
<p id="rfc.section.4.3.p.1">The address pool consists of the private IPv4 addresses as per <a href="#RFC1918">[RFC1918]</a>.  This pool can be implemented at different granularities in the node, e.g., a single pool per node, or at some finer granularity such as per-user or per-process.  In the case of a large number of IPv4 applications communicating with a large number of IPv6 servers, the available address space may be exhausted if the granularity is not fine enough. This should be a rare event and chances will decrease as IPv6 support increases.  The possible problem can also mitigated with smart management techniques of the address pool.  For example, entries with the longest inactivity time can be cleared and IPv4 addresses reused for creating new entries.  </p>
<p id="rfc.section.4.3.p.2">The RFC1918 address space was chosen because generally legacy applications understand it as a private address space. A new dedicated address space would run a risk of not being understood by applications as private. 127/8 and 169.254/16 are rejected due to possible assumptions applications may make when seeing those.  </p>
<p id="rfc.section.4.3.p.3">The RFC1918 addresses have a risk of conflicting with other interfaces. The conflicts can be mitigated by using a least commonly used portion of the RFC1918 address space.  Addresses from 172.16/12 are thought to be less likely to conflict than addresses from 10/8 or 192.168/16 spaces, hence the RECOMMENDED IPv4 addresses are following (Editor's comment: this is first proposal, educated better guesses are welcome): </p>
<p id="rfc.section.4.3.p.4">Source addresses: 172.21.112.0/30. Source addresses have to be allocated because applications use getsockname() calls and in the BIS mode an IP address of the IPv4 interface has to be shown (e.g., by 'ifconfig'). More than one address is allocated to allow implementation flexibility, e.g., for cases where a host has multiple IPv6 interfaces. The source addresses are from different subnets than destination addresses to that ensure applications would not make on-link assumptions and would instead enable NAT traversal functions.  </p>
<p id="rfc.section.4.3.p.5">Primary destination addresses: 172.21.80.0/20. The address mapper will select destination addresses primarily out of this pool.  </p>
<p id="rfc.section.4.3.p.6">Secondary destination addresses: 10.170.160.0/20. The address mapper will select destination addresses out of this pool if the node has a dual-stack connection conflicting with primary destination addresses.  </p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Multi-interface</h1>
<p id="rfc.section.4.4.p.1">In the case of dual-stack destinations BIH MUST NOT do protocol translation from IPv4 to IPv6 when the host has any IPv4 interfaces, native or tunneled, available for use.  </p>
<p id="rfc.section.4.4.p.2">It is possible that an IPv4 interface is activated during BIH operation, for example if a node moves to a coverage area of an IPv4-enabled network.  In such an event, BIH MUST stop initiating protocol translation sessions for new connections and BIH MAY disconnect active sessions.  The choice of disconnection is left for implementations and it may depend on whether IPv4 address conflict occurs between addresses used by BIH and addresses used by the new IPv4 interface.  </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Multicast</h1>
<p id="rfc.section.4.5.p.1">Protocol translation for multicast is not supported.  </p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> DNS cache</h1>
<p id="rfc.section.4.6.p.1">When BIH shuts down, e.g., due to an IPv4 interface becoming available, BIH MUST flush the node's DNS cache of possible locally generated entries. This cache may be in the ENR itself, but also possibly host's caching stub resolver.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Considerations due ALG requirements</h1>
<p id="rfc.section.5.p.1">No ALG functionality is specified herein as ALG design is generally not encouraged for host-based translation and as BIH is intended for applications that do not include IP addresses in protocol payloads.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Security Considerations</h1>
<p id="rfc.section.6.p.1">The security considerations of BIH mostly relies on that of <a href="#I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a>.  </p>
<p id="rfc.section.6.p.2">In the socket-layer implementation approach, the differences are due to the address translation occurring at the API and not in the network layer.  That is, since the mechanism uses the API translator at the socket API layer, hosts can utilize the security of the network layer (e.g., IPsec) when they communicate with IPv6 hosts using IPv4 applications via the mechanism.  As such, there is no need for DNS ALG as in NAT-PT, so there is no interference with DNSSEC either.  </p>
<p id="rfc.section.6.p.3">In the network-layer implementation approach, IPv4-using IKE will not work.  This means IPv4-based IPsec/IKE using VPN solutions cannot work through BIH.  However, transport and application layer solutions such as TLS or SSL-VPN do work through BIH.  </p>
<p id="rfc.section.6.p.4">The use of address pooling may open a denial-of-service attack vulnerability.  So BIH should employ the same sort of protection techniques as NAT64 <a href="#I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</a> does.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Changes since RFC2767 and RFC3338</h1>
<p id="rfc.section.7.p.1">This document combines and obsoletes both <a href="#RFC2767">[RFC2767]</a> and <a href="#RFC3338">[RFC3338]</a>.  </p>
<p id="rfc.section.7.p.2">The changes in this document mainly reflect the following components: </p>

<ul class="empty">
<li>1. Supporting IPv6-only network connections </li>
<li>2. The IPv4 address pool uses private address instead of reserved IPv4 addresses (0.0.0.1 - 0.0.0.255)</li>
<li>3. Extending ENR and address mapper to operate differently </li>
<li>4. Adding an alternative way to implement the ENR </li>
<li>5. Standards track instead of experimental/informational</li>
<li>6. Supporting reverse (PTR) queries</li>
</ul>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Acknowledgments</h1>
<p id="rfc.section.8.p.1">The author thanks the discussion from Gang Chen, Dapeng Liu, Bo Zhou, Hong Liu, Tao Sun, Zhen Cao, Feng Cao et al. in the development of this document.</p>
<p id="rfc.section.8.p.2">The efforts of Suresh Krishnan, Mohamed Boucadair, Yiu L. Lee, James Woodyatt, Lorenzo Colitti, Qibo Niu, Pierrick Seite, Dean Cheng, Christian Vogt, Jan M. Melen, Ed Jankiewizh, Marnix Goossens, Ala Hamarsheh, Dan Wing, Magnus Westerlun and Julien Laganier in reviewing this document are gratefully acknowledged.</p>
<p id="rfc.section.8.p.3">Special acknowledgements go to Dave Thaler for his extensive review and support.</p>
<p id="rfc.section.8.p.4">The authors of RFC2767 acknowledged WIDE Project, Kazuhiko YAMAMOTO, Jun MURAI, Munechika SUMIKAWA, Ken WATANABE, and Takahisa MIYAMOTO. The authors of RFC3338 acknowledged implementation contributions by Wanjik Lee (wjlee@arang.miryang.ac.kr) and i2soft Corporation (www.i2soft.net).</p>
<p id="rfc.section.8.p.5">The authors of Bump-in-the-Wire (BIW) (draft-ietf-biw-00.txt, October 2006), P. Moster, L. Chin, and D. Green, are acknowledged. Some ideas and clarifications from BIW have been adapted to this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1918">[RFC1918]</b></td>
<td class="top">
<a href="mailto:yakov@cisco.com" title="Cisco systems">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com" title="Chrysler Corporation">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net" title="RIPE Network Coordination Centre">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net" title="RIPE Network Coordination Centre">Groot, G.</a> and <a href="mailto:lear@sgi.com" title="Silicon Graphics, Inc.">E. Lear</a>, "<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>", BCP 5, RFC 1918, February 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2767">[RFC2767]</b></td>
<td class="top">
<a href="mailto:tsuchi@ebina.hitachi.co.jp" title="Hitachi, Ltd.,  Enterprise Server Division">Tsuchiya, K.</a>, <a href="mailto:h-higuti@ebina.hitachi.co.jp" title="Hitachi, Ltd.,  Enterprise Server Division">HIGUCHI, H.</a> and <a href="mailto:atarashi@ebina.hitachi.co.jp" title="Hitachi, Ltd.,  Enterprise Server Division">Y. Atarashi</a>, "<a href="http://tools.ietf.org/html/rfc2767">Dual Stack Hosts using the "Bump-In-the-Stack" Technique (BIS)</a>", RFC 2767, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2893">[RFC2893]</b></td>
<td class="top">
<a>Gilligan, R.</a> and <a>E. Nordmark</a>, "<a href="http://tools.ietf.org/html/rfc2893">Transition Mechanisms for IPv6 Hosts and Routers</a>", RFC 2893, August 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3338">[RFC3338]</b></td>
<td class="top">
<a>Lee, S.</a>, <a>Shin, M-K.</a>, <a>Kim, Y-J.</a>, <a>Nordmark, E.</a> and <a>A. Durand</a>, "<a href="http://tools.ietf.org/html/rfc3338">Dual Stack Hosts Using "Bump-in-the-API" (BIA)</a>", RFC 3338, October 2002.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-v6v4-xlate">[I-D.ietf-behave-v6v4-xlate]</b></td>
<td class="top">
<a>Li, X</a>, <a>Bao, C</a> and <a>F Baker</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-v6v4-xlate-23">IP/ICMP Translation Algorithm</a>", Internet-Draft draft-ietf-behave-v6v4-xlate-23, September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-v6v4-xlate-stateful">[I-D.ietf-behave-v6v4-xlate-stateful]</b></td>
<td class="top">
<a>Bagnulo, M</a>, <a>Matthews, P</a> and <a>I Beijnum</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-v6v4-xlate-stateful-12">Stateful NAT64: Network Address and Protocol Translation from IPv6 Clients to IPv4 Servers</a>", Internet-Draft draft-ietf-behave-v6v4-xlate-stateful-12, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-behave-dns64">[I-D.ietf-behave-dns64]</b></td>
<td class="top">
<a>Bagnulo, M</a>, <a>Sullivan, A</a>, <a>Matthews, P</a> and <a>I Beijnum</a>, "<a href="http://tools.ietf.org/html/draft-ietf-behave-dns64-11">DNS64: DNS extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>", Internet-Draft draft-ietf-behave-dns64-11, October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC3493">[RFC3493]</b></td>
<td class="top">
<a>Gilligan, R.</a>, <a>Thomson, S.</a>, <a>Bound, J.</a>, <a>McCann, J.</a> and <a>W. Stevens</a>, "<a href="http://tools.ietf.org/html/rfc3493">Basic Socket Interface Extensions for IPv6</a>", RFC 3493, February 2003.</td>
</tr></tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Implementation option for the ENR</h1>
<p id="rfc.section.Appendix A.p.1">It is not necessary to implement the ENR at the kernel level, but it can be implemented instead at the user space by setting the host's default DNS server to point to 127.0.0.1. DNS queries would then always be sent to the ENR, which furthermore ensures that both A and AAAA queries are sent to the actual DNS server and A queries are always answered and required mappings created. </p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#app-additional" id="app-additional">API list intercepted by BIH</a>
</h1>
<p id="rfc.section.Appendix B.p.1">The following functions are the API list which SHOULD be intercepted by BIH module when implemented at socket layer. Please note that this list may not be fully exhaustive.  </p>
<p id="rfc.section.Appendix B.p.2">The functions that the application uses to pass addresses into the system are: </p>

<ul class="empty">
<li>bind()</li>
<li>connect()</li>
<li>sendmsg()</li>
<li>sendto()</li>
<li>gethostbyaddr()</li>
<li>getnameinfo()</li>
</ul>

<p> </p>
<p id="rfc.section.Appendix B.p.3">The functions that return an address from the system to an application are: </p>

<ul class="empty">
<li>accept()</li>
<li>recvfrom()</li>
<li>recvmsg()</li>
<li>getpeername()</li>
<li>getsockname()</li>
<li>gethostbyname()</li>
<li>getaddrinfo()</li>
</ul>

<p> </p>
<p id="rfc.section.Appendix B.p.4">The functions that are related to socket options are: </p>

<ul class="empty">
<li>getsocketopt()</li>
<li>setsocketopt()</li>
</ul>

<p> </p>
<p id="rfc.section.Appendix B.p.5">As well, raw sockets for IPv4 and IPv6 MAY be intercepted.</p>
<p id="rfc.section.Appendix B.p.6">Most of the socket functions require a pointer to the socket address structure as an argument.  Each IPv4 argument is mapped into corresponding an IPv6 argument, and vice versa.</p>
<p id="rfc.section.Appendix B.p.7">According to <a href="#RFC3493">[RFC3493]</a>, the following new IPv6 basic APIs and structures are required.</p>
<div id="#rfc.figure.8"></div>
<div id="#figappendix1"></div>
<pre>   
      IPv4                     new IPv6
      ------------------------------------------------
      AF_INET                  AF_INET6
      sockaddr_in              sockaddr_in6
      gethostbyname()          getaddrinfo()
      gethostbyaddr()          getnameinfo()
      inet_ntoa()/inet_addr()  inet_pton()/inet_ntop()
      INADDR_ANY               in6addr_any
    </pre>
<p id="rfc.section.Appendix B.p.8">BIH MAY intercept inet_ntoa() and inet_addr() and use the address mapper for those.  Doing that enables BIH to support literal IP addresses.</p>
<p id="rfc.section.Appendix B.p.9">The gethostbyname() and getaddrinfo() calls return a list of addresses.  When the name resolver function invokes getaddrinfo() and  getaddrinfo() returns multiple IP addresses, whether IPv4 or IPv6, they SHOULD all be represented in the addresses returned by gethostbyname().  Thus if getaddrinfo() returns multiple IPv6 addresses, this implies that multiple address mappings will be created; one for each IPv6 address.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bill Huang</span> 
	  <span class="n hidden">
		<span class="family-name">Huang</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>53A,Xibianmennei Ave., </span>
<span>Xuanwu District,</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bill.huang@chinamobile.com">bill.huang@chinamobile.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hui Deng</span> 
	  <span class="n hidden">
		<span class="family-name">Deng</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>53A,Xibianmennei Ave., </span>
<span>Xuanwu District,</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:denghui02@gmail.com">denghui02@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Teemu Savolainen</span> 
	  <span class="n hidden">
		<span class="family-name">Savolainen</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia</span>
	<span class="adr">
	  <span>Hermiankatu 12 D </span>
<span>FI-33720 TAMPERE</span>

	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:teemu.savolainen@nokia.com">teemu.savolainen@nokia.com</a></span>

  </address>
</div>

</body>
</html>