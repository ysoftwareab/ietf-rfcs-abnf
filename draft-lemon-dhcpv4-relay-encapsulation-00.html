<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Relay Agent Encapsulation for DHCPv4</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Relay Agent Encapsulation for DHCPv4">
<meta name="keywords" content="DHCPv4 Relay">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">dhc</td><td class="header">T. Lemon</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nominum, Inc.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">August 8, 2010</td></tr>
<tr><td class="header">Expires: February 9, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Relay Agent Encapsulation for DHCPv4<br />draft-lemon-dhcpv4-relay-encapsulation-00</h1>

<h3>Abstract</h3>

<p>This document describes a general mechanism whereby DHCP
      relay agents can encapsulate DHCP packets that they are
      forwarding in the direction of DHCP servers, and decapsulate
      packets that they they are forwarding toward DHCP clients, so
      that more than one relay agent can insert relay agent suboptions
      into the forwarding chain.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on February 9, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Terminology<br />
<a href="#anchor4">2.</a>&nbsp;
Protocol Summary<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.1.</a>&nbsp;
RELAYFORWARD Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.2.</a>&nbsp;
RELAYREPLY Message<br />
<a href="#anchor7">3.</a>&nbsp;
Encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.1.</a>&nbsp;
Relay Segment<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.2.</a>&nbsp;
Encapsulation Segment<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.1.</a>&nbsp;
Encapsulated relay message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.2.2.</a>&nbsp;
Encapsulated non-relay messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.3.</a>&nbsp;
Encapsulation Information suboption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.4.</a>&nbsp;
Encapsulating Agent Address suboption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.5.</a>&nbsp;
Gateway IP Address suboption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">3.6.</a>&nbsp;
Message Type Suboption<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">3.7.</a>&nbsp;
Relay Agent Information Suboption<br />
<a href="#anchor17">4.</a>&nbsp;
DHCP Relay Agent Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.1.</a>&nbsp;
Packet processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">4.1.1.</a>&nbsp;
Packets traveling toward DHCP servers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">4.1.2.</a>&nbsp;
Packets traveling toward DHCP clients<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">4.2.</a>&nbsp;
Constructing RELAYFORWARD messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.2.1.</a>&nbsp;
Encapsulating RELAYFORWARD messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">4.2.2.</a>&nbsp;
Encapsulating other messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">4.2.3.</a>&nbsp;
Constructing the relay segment<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">4.3.</a>&nbsp;
Decapsulating RELAYREPLY messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">4.3.1.</a>&nbsp;
Extracting and processing relay agent suboptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">4.3.2.</a>&nbsp;
Constructing the decapsulated message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">4.3.3.</a>&nbsp;
Transmitting the decapsulated message<br />
<a href="#anchor29">5.</a>&nbsp;
DHCP Server Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">5.1.</a>&nbsp;
Receiving RELAYFORWARD messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">5.1.1.</a>&nbsp;
Decapsulation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">5.1.2.</a>&nbsp;
Processing of decapsulated suboptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">5.2.</a>&nbsp;
Sending RELAYREPLY messages<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">5.2.1.</a>&nbsp;
Directing responses along the reply chain<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">5.2.2.</a>&nbsp;
Inner message<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">5.2.3.</a>&nbsp;
Iterating across the encapsulation layers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">5.2.4.</a>&nbsp;
Per-iteration processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">5.2.4.1.</a>&nbsp;
Processing for non-conforming relay agents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">5.2.4.2.</a>&nbsp;
Processing for conforming relay agents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">5.2.5.</a>&nbsp;
Transmission of RELAYREPLY messages<br />
<a href="#anchor41">6.</a>&nbsp;
DHCP Client Behavior<br />
<a href="#anchor42">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor43">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>In some networking environments, it is useful to be able to
      configure relay agents in a hierarchy, so that information from
      a relay agent close to the client can be combined with information
      from one or more relay agents closer to the server, particularly
      in cases where the relay agents may be in separate administrative
      domains.
</p>
<p>The current <a class='info' href='#RFC3046'>Relay Agent Information
      Option specification<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046] specifies that when a relay agent
      receives a packet containing an RAIO, it must not add an RAIO.
      This prevents chaining of RAIOs, and hence prohibits
      the hierarchical use case.
</p>
<p><a class='info' href='#RFC3315'>DHCP version 6<span> (</span><span class='info'>Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; July&nbsp;2003.</span><span>)</span></a> [RFC3315] provides a much
      cleaner technique for providing relay agent information
      suboptions to the DHCP server.  Rather than appending an option
      to the DHCP client's message, the relay agent encapsulates the
      DHCP client message in a new DHCP message which it sends to the
      DHCP server along with any options it chooses to add to provide
      information to the DHCP server.
</p>
<p>This document specifies a mechanism for providing the same
      functionality in DHCPv4.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
	document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>

<p>The following terms and acronyms are used in this document:
	</p>
<blockquote class="text"><dl>
<dt>DHCP</dt>
<dd>- Dynamic Host Configuration Protocol Version 4
	  <a class='info' href='#RFC2131'>[RFC2131]<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a>
</dd>
<dt>RAIO</dt>
<dd> - <a class='info' href='#RFC3046'>Relay Agent Information
	  Option<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046].   Also commonly referred to as "Option 82."
</dd>
<dt>RAIO suboption</dt>
<dd> - An DHCP suboption that has been
	  defined for encapsulation in the Relay Agent Information Option
</dd>
<dt>agent encapsulation</dt>
<dd> - Encapsulating DHCP
          packets that are being relayed from DHCP clients or relay agents
	  toward DHCP servers, according to the method described
          in this specification.
</dd>
<dt>decapsulate</dt>
<dd> - The act of de-encapsulating
          DHCP packets being relayed from DHCP servers or relay agents in
	  the direction of DHCP clients, according to this specification.
</dd>
<dt>relay message</dt>
<dd> - A RELAYFORWARD or RELAYREPLY
	  message.
</dd>
<dt>option buffer</dt>
<dd> - the portion of the DHCP
	  packet following the magic cookie in the 'vend' field of the
	  DHCP Packet.
</dd>
<dt>silently discard</dt>
<dd> - in many places in this
	  specification, the implementation is required to silently
	  discard erroneous messages.  What is meant by 'silently
	  discard' is that the implementation MUST NOT send any ICMP
	  message indicating that the delivery was in error.  It may
	  be desirable for the implementation to keep a count of
	  messages that have been discarded, either by message type or
	  by reason for discarding, or some combination.  Nothing in
	  this specification should be construed to forbid such data
	  collection.
</dd>
</dl></blockquote>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Protocol Summary</h3>

<p>This document specifies two new DHCP message types: the RELAYFORWARD
      message, and the RELAYREPLY message.   These messages are analogous
      to the Relay Forward and Relay Reply messages in <a class='info' href='#RFC3315'>DHCPv6<span> (</span><span class='info'>Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; July&nbsp;2003.</span><span>)</span></a> [RFC3315].
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
RELAYFORWARD Message</h3>

<p>Conforming relay agents encapsulate messages being sent toward
	DHCP servers in RELAYFORWARD messages.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
RELAYREPLY Message</h3>

<p>Conforming DHCP servers encapsulate messages being sent toward
	DHCP clients in RELAYREPLY messages.
</p>
<p>Conforming Relay agents, when receiving RELAYREPLY messages,
	decapsulate the message contained in the RELAYREPLY message and
	send it to the next relay.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Encoding</h3>

<p>Both RELAYFORWARD and RELAYREPLY messages have the same
      format, which is similar to the format of other DHCP messages.
      The BOOTP/DHCP header has the same format, because it must
      be possible for non-conforming relay agents to parse it.  The
      option buffer, however, contains two segments - the relay
      segment, and the encapsulation segment.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Relay Segment</h3>

<p>The relay segment consists of a DHCP Message Type suboption
	specifying either a RELAYFORWARD or RELAYREPLY message, an
	Encapsulation Information suboption, and any RAIO
	suboptions. These options, including the first two mentioned,
	may appear in any order within the relay segment.
</p>
<p>Option codes in the Relay Segment are RAIO option codes,
	not DHCP option codes.  Relay segments never contain pad
	options.  The length of the relay segment, excluding the magic
	cookie, is specified in the Encapsulation Information
	suboption.  End and Pad options MUST NOT appear within the
	relay segment.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Encapsulation Segment</h3>

<p>The encapsulation segment contains either an encapsulated
	relay message, or an encapsulated non-relay message.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Encapsulated relay message</h3>

<p>An encapsulated relay message option buffer has the same
	  format as the option buffer of a relay message option buffer
	  that is not encapsulated&mdash;a relay segment, followed by
	  an encapsulation segment.  An arbitrary number of encapsulations
	  can be done in this way, as long as there is room in the
	  packet.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Encapsulated non-relay messages</h3>

<p>An encapsulated non-relay message option buffer contains
	  all the options in the message that was encapsulated, with
	  the following exceptions:
	  </p>
<ul class="text">
<li>Any options following the first End option
	    are omitted (these options are assumed to be garbage; any
	    signature is assumed not to apply to them.
</li>
<li>Any Pad options present either at the end
	    of the option buffer, or prior to the first End packet,
	    that are followed only by other Pad options or a single
	    End option are omitted, and the number of Pad options
	    omitted is recorded in the Relay Encapsulation Information
	    suboption.
</li>
<li>If an End option is present at the end of the option
	    buffer being encapsulated, it is omitted, and the ep field
	    is set to 1.  If no End option is present, the ep field is
	    set to 0.  If more than one End option is present, only the
	    final End option is omitted.
</li>
</ul>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Encapsulation Information suboption</h3>

<p>The Encapsulation Information suboption is used by the relay
	to report the total length of the data being encapsulated, the
	amount of stripped padding, and whether or not an end option
	was stripped.  This is necessary in order to ensure that the
	original packet contents can be reconstructed when
	decapsulating, which in turn allows the server to check any
	<a class='info' href='#RFC3118'>signature<span> (</span><span class='info'>Droms, R. and W. Arbaugh, &ldquo;Authentication for DHCP Messages,&rdquo; June&nbsp;2001.</span><span>)</span></a> [RFC3118] that may be present.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----+----+----+----+----+----+----+----+----+
|code| len|  rslen  |  caplen |  padlen | ep |
+----+----+----+----+----+----+----+----+----+
</pre></div>
<p>The Encapsulation Information Suboption consists of six parts:
	</p>
<blockquote class="text"><dl>
<dt>code</dt>
<dd>The suboption code: a single byte with a
	  value value of TBD
</dd>
<dt>len</dt>
<dd>The suboption length: a single byte with a
	  value of 7.
</dd>
<dt>rslen</dt>
<dd>The length of the relay
	  segment: two byte in network byte order.
</dd>
<dt>caplen</dt>
<dd>The length of the encapsulation
	  segment: two byte in network byte order.
</dd>
<dt>padlen</dt>
<dd>The length of any padding that was
	  removed from the option buffer prior to encapsulation: two
	  bytes in network byte order.
</dd>
<dt>ep</dt>
<dd>If an End option was present in the option
	  buffer prior to encapsulation, this field is set to 1;
	  otherwise, it is set to 0.  This field is a single byte.
</dd>
</dl></blockquote><p>
	
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Encapsulating Agent Address suboption</h3>

<p>The Encapsulating Agent Address suboption indicates to the
	DHCP server or intermediate relay the IP address of the relay agent
	which did the encapsulation.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----+----+----+----+----+----+
|code| len|   relay ip addr   |
+----+----+----+----+----+----+
</pre></div>
<p>The Encapsulating Agent Address suboption consists of
	the following fields:
	</p>
<blockquote class="text"><dl>
<dt>code</dt>
<dd>The suboption code: a single byte with a
	  value value of TBD
</dd>
<dt>len</dt>
<dd>The suboption length: a single byte with a
	  value of 4.
</dd>
<dt>relay ip addr</dt>
<dd>The IP address of the relay agent.
</dd>
</dl></blockquote>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Gateway IP Address suboption</h3>

<p>The Gateway IP address suboption is used to specify an IP address
	to store in the giaddr of a decapsulated packet.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----+----+----+----+----+----+
|code| len|  gateway ip addr  |
+----+----+----+----+----+----+
</pre></div>
<p>The Gateway IP Address suboption consists of the following
	fields:
	</p>
<blockquote class="text"><dl>
<dt>code</dt>
<dd>The suboption code: a single byte with a
	  value value of TBD
</dd>
<dt>len</dt>
<dd>The suboption length: a single byte with a
	  value of 4.
</dd>
<dt>relay ip addr</dt>
<dd>The IP address to store in giaddr.
</dd>
</dl></blockquote>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Message Type Suboption</h3>

<p>Because options in the relay segment are encoded using
	<a class='info' href='#RFC3046'>RAIO suboption codes<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046], not <a class='info' href='#RFC2132'>DHCP option codes<span> (</span><span class='info'>Alexander, S. and R. Droms, &ldquo;DHCP Options and BOOTP Vendor Extensions,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2132], and because the
	Message Type option must appear in the relay segment, we
	define an RAIO suboption that is exactly the same as the DHCP
	Message Type option specified in <a class='info' href='#RFC2132'>section 9.6 of DHCP Options and BOOTP Vendor
	Extensions<span> (</span><span class='info'>Alexander, S. and R. Droms, &ldquo;DHCP Options and BOOTP Vendor Extensions,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2132].   This suboption has an option code of 53.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.7"></a><h3>3.7.&nbsp;
Relay Agent Information Suboption</h3>

<p>As with the Message Type suboption, it is possible that a
	non-conforming relay agent will append an RAIO to a
	RELAYFORWARD message.  In order for that to be parsed
	correctly, we must define an analog to the RAIO.  The Relay
	Agent Information suboption is treated as if it were an RAIO
	when unpacking a RELAYFORWARD message.  When constructing a
	RELAYREPLY message that will be handled by a non-conforming
	relay agent that included an RAIO, a Relay Agent Information
	suboption will be used exactly as if it were an RAIO.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----+----+----+----+----+...--+
|code| len|  suboptions...     |
+----+----+----+----+----+...--+
</pre></div>
<p>The Relay Agent Information suboption consists of the
	following fields:
	</p>
<blockquote class="text"><dl>
<dt>code</dt>
<dd>The suboption code: a single byte with a
	  value value of TBD
</dd>
<dt>len</dt>
<dd>The suboption length: a single byte
	  containing the length of the suboptions field.
</dd>
<dt>suboptions...</dt>
<dd>Zero or more Relay Agent
	  Information suboptions.
</dd>
</dl></blockquote>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
DHCP Relay Agent Behavior</h3>

<p>DHCP Relay agents implementing this specification MUST have a
      configuration parameter controlling relay encapsulation.  By
      default, relay encapsulation MUST be disabled.
</p>
<p>Relay agents with encapsulation disabled MUST NOT
      encapsulate.  Relay agents with encapsulation disabled MUST NOT
      decapsulate.  Relay agents that encapsulate MUST NOT encapsulate
      BOOTP messages (that is, messages that do not contain the DHCP
      Message Type option).
</p>
<p>In any case where a relay agent implementing this specification
      does not encapsulate or decapsulate, it MUST behave exactly as
      a relay agent would that did not implement this specification at
      all.
</p>
<p>DHCP relay agents that are configured with encapsulation
      enabled, but which have no agent-specific options to send to the
      DHCP server, MUST encapsulate.  Relay agents that are configured
      with encapsulation enabled MUST decapsulate.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Packet processing</h3>

<p>Relay agents implementing this specification may receive
	packets directed toward DHCP servers with a source port of 67
	(BOOTPS).  Therefore, the source port cannot be used to
	determine whether the packet is traveling toward a DHCP server
	or toward a DHCP client.
</p>
<p>In order to determine whether a message is traveling toward
	a DHCP client or toward a DHCP server, the relay agent must
	check the 'op' field of the DHCP message.  If the 'op' field
	is set to 1, the message is traveling toward a DHCP server.
	If the 'op' field is set to zero, the message is traveling
	toward a DHCP client.  At the time of the writing of this
	specification, no other value is meaningful in the 'op' field.
	Relay agents implementing this specification MUST NOT
	encapsulate or decapsulate messages with other values in the
	'op' field.  It is assumed that if meanings are defined for
	additional values, the document that specifies the meaning of
	those values will update this document; in the absence of such
	an update, the behavior specified here will remain in effect.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Packets traveling toward DHCP servers</h3>

<p>When a DHCP relay agent receives a RELAYREPLY message
	  that is traveling toward the DHCP server, the relay agent
	  MUST silently discard the message.
</p>
<p>When a DHCP relay agent that is configured to encapsulate
	  receives a DHCP message that is traveling toward the DHCP
	  server that is not a RELAYREPLY message, the relay agent
	  MUST encapsulate that packet into a RELAYFORWARD message and
	  sends it to the address or addresses to which it is
	  configured to forward messages intended for DHCP
	  servers.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Packets traveling toward DHCP clients</h3>

<p>When a DHCP relay agent receives a RELAYFORWARD message
	  that is traveling toward the DHCP client, the relay agent
	  MUST discard the message.
</p>
<p>When a DHCP relay agent that is configured to encapsulate
	  receives a RELAYREPLY message that is traveling toward the
	  DHCP client, the relay agent MUST decapsulate that message
	  and forward the decapsulated message toward the client.
</p>
<p>When a DHCP relay agent configured to encapsulate
	  receives any other message moving toward a DHCP client, it
	  MUST silently discard the message.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Constructing RELAYFORWARD messages</h3>

<p>The relay agent constructs the RELAYFORWARD message by
	copying the source message up to the end of the magic cookie
	in the option buffer of the message.  Following that, the
	relay agent constructs the relay segment, as described below.
	Following that, the relay agent copies 'caplen' octets from
	the option buffer of the source message, starting at the
	beginning of the first option that follows the magic cookie.
</p>
<p>The relay agent MUST NOT modify the 'giaddr' field, or any
	other field, of the constructed RELAYFORWARD message.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Encapsulating RELAYFORWARD messages</h3>

<p>When encapsulating RELAYFORWARD messages, the length of
	  the encapsulation segment is the sum of the 'rslen' and
	  'caplen' fields in the encapsulation segment of the
	  RELAYFOWARD message.  This will be the value stored in the
	  'caplen' field in the new encapsulation segment.  The
	  'padlen' and 'ep' fields are always set to zero when
	  encapsulating RELAYFORWARD messages.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Encapsulating other messages</h3>

<p>When encapsulating other messages, the length of the
	  encapsulation segment is determined by scanning forward
	  across the option buffer of the source message, beginning
	  with the first option in the option buffer, until an End
	  option is reached, or there are no more options in the
	  option buffer.  Any data following the End option is
	  discarded.
</p>
<p>While scanning, the relay agent maintains a flag which
	  indicates whether or not a pad option has been encountered.
	  The flag is initialized to false.  When a Pad option is
	  encountered, if the flag is false, it is set to true, and
	  the location of that Pad option is recorded.  If an option
	  that is neither a Pad option nor an End option is
	  encountered, the flag is set to false.  In any other case,
	  no action is taken with respect to either the flag or the
	  Pad location.
</p>
<p>When the end of the option buffer is reached, the value
	  of 'padlen' is computed as the difference, in octets,
	  between the location of the end of the option
	  segment&mdash;either the location of the first End option
	  encountered, or the first location after the
	  buffer&mdash;and the last location recorded for a Pad
	  option; if the pad flag is false, then 'padlen' is always
	  zero.
</p>
<p>If the pad flag is true, then 'caplen' is the difference
	  in octets between the last location recorded for a Pad
	  option and the location of the first option in the option
	  buffer.  If it is false, then 'caplen' is the difference in
	  octets between the location of the first End option
	  encountered in the option buffer and the first option in the
	  buffer.  If flag is false and no End option is present in
	  the option buffer, then 'caplen' is the length of the option
	  buffer, less four octets for the magic cookie.
</p>
<p>The 'ep' field is set to zero if no End option was
	  present in the option buffer; it is set to one if an End
	  option was present.
</p>
<p>Note that the <a class='info' href='#RFC3046'>RAIO
	  specification<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046] requires that if an End option is
	  present in the DHCP message to which the RAIO is to be
	  appended, the RAIO will instead be inserted immediately
	  prior to the End option.  This means that if a conforming
	  implementation encapsulates a packet containing an RAIO, it
	  will simply appear as an option in the encapsulation
	  segment.  When encapsulating, relay agents MUST NOT include
	  an RAIO if it follows an End option.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Constructing the relay segment</h3>

<p>The relay agent constructs the relay segment by including
	  any RAIO options it is configured to send.  The relay agent
	  MUST include a DHCP Message Type suboption, with the message
	  type set to 'RELAYFORWARD' (TBD).
</p>
<p>The relay agent SHOULD include a <a class='info' href='#I-D.ietf-dhc-relay-id-suboption'>Relay Agent ID
	  suboption<span> (</span><span class='info'>Stapp, M., &ldquo;The DHCPv4 Relay Agent Identifier Suboption,&rdquo; July&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;dhc&#8209;relay&#8209;id&#8209;suboption] to identify itself.
</p>
<p>If the relay agent is not a <a class='info' href='#I-D.ietf-dhc-l2ra'>layer two relay agent<span> (</span><span class='info'>Joshi, B. and P. Kurapati, &ldquo;Layer 2 Relay Agent Information,&rdquo; April&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;dhc&#8209;l2ra], it
	  MUST include an Encapsulation Forwarding Address suboption
	  containing a valid IP address that is reachable by the next
	  hop relay(s) or DHCP server(s) to which the relay agent is
	  configured to forward.
</p>
<p>The relay agent MUST include an Encapsulation Information
	  suboption.  The 'caplen' and 'padlen' fields of this
	  suboption are set to the values determined in the previous
	  section.  The 'rslen' field is set to the total length of
	  the options in the relay segment, including the
	  Encapsulation Information suboption.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Decapsulating RELAYREPLY messages</h3>

<p>There are five parts to the decapsulation process:
	</p>
<ul class="text">
<li>identifying the Encapsulation Information subption,
</li>
<li>using it to extract relay agent suboptions from the relay
	  segment of the RELAYREPLY message,
</li>
<li>processing those suboptionsm
</li>
<li>constructing the decapsulated message,
</li>
<li>forwarding the decapsulated message toward the DHCP client.
</li>
</ul>

<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Extracting and processing relay agent suboptions</h3>

<p>The relay agent first locates the Encapsulation
	  Information suboption in the option buffer of the RELAYREPLY
	  message.  Although this option always appears in the relay
	  segment of the RELAYREPLY message, the relay agent has no
	  way to differentiate the encapsulation segment and the relay
	  segment until it has located this option, so it simply scans
	  forward, option by option, in the option buffer until it
	  finds this option.
</p>
<p>If the relay agent fails to locate an Encapsulation
	  Information suboption, it MUST silently discard the
	  RELAYREPLY message.
</p>
<p>Once the relay agent has located the Encapsulation
	  Information suboption, it parses the portion of the
	  'options' field of the DHCP packet starting with the first
	  option following the magic cookie, up to the number of bytes
	  specified by the 'rslen' field of the Encapsulation
	  Information suboption.
</p>
<p>The suboptions parsed from the relay segment are
	  processed by the relay agent as specified in <a class='info' href='#RFC3046'>the Relay Agent Information Option
	  specification<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046], as well as in any documents that
	  define suboptions to the Relay Agent Information Option.  A
	  current list of DHCP Relay Agent suboptions and the
	  documents that define them can be located in the IANA
	  protocol registry for BOOTP and DHCP parameters, in the
	  section titled "DHCP Relay Agent Sub-Option Codes."
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Constructing the decapsulated message</h3>

<p>In order to decapsulate the RELAYREPLY message, the relay
	  agent constructs a new, decapsulated message by copying the
	  portion of the RELAYREPLY message up to and including the
	  magic cookie in the 'options' field of the message.   The
	  relay agent then copies the portion of the 'options' field
	  of the source message beginning after the relay segment, up to
	  'caplen' bytes, into the new message.   If the 'padlen' field
	  is nonzero, the relay agent appends that many Pad options to the
	  new message.   If the 'ep' field is nonzero, the relay agent
	  appends an 'End' option to the new message.
</p>
<p>If a Gateway IP Address suboption is present in the relay
	  segment, the relay agent MUST store the IP address contained
	  in that option in the 'giaddr' field of the new message.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Transmitting the decapsulated message</h3>

<p>The decapsulated message is forwarded to the IP address
	  specified in the Encapsulating Agent Address suboption, if
	  that suboption is present.  If that suboption is not
	  present, the message is forwarded to the DHCP client as if
	  it were on the local subnet, as specified in <a class='info' href='#RFC2131'>the DHCP protocol specification<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2131].
	  This suboption will not be present if the next hop is the
	  DHCP client, or if all remaining relay agents in the relay
	  chain are layer two relay agents.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
DHCP Server Behavior</h3>

<p>A DHCP server which receives a RELAYREPLY message MUST
      silently discard that message.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Receiving RELAYFORWARD messages</h3>

<p>DHCP servers that implement this specification MUST decapsulate
	RELAYFORWARD messages.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Decapsulation</h3>

<p>By design, this specification supports multiple layers of
	  encapsulation.  The DHCP server implementation therefore
	  MUST decapsulate each layer and retain the information in
	  that layer, organized so that the ordering of the
	  encapsulation is available both during packet processing,
	  and when constructing the reply.
</p>
<p>In addition, this specification allows for the
	  provisioning of a single non-conforming relay agent anywhere
	  in the forwarding chain, through the use of the Gateway IP
	  Address suboption.  DHCP servers implementing this
	  specification MUST record the Relay Agent Information option
	  contents as if they were a layer of encapsulation, in the
	  correct order, marked for special handling when constructing
	  the response.
</p>
<p>Aside from the necessity of handling an RAIO differently
	  than an encapsulation when constructing a RELAYREPLY
	  message, DHCP servers MUST NOT, by default, treat relay
	  suboptions received in an RAIO any differently than relay
	  suboptions received in an encapsulation.
</p>
<p>It is not the goal of this specification to define a
	  particular implementation strategy or data structure for
	  representing the encapsulation, so long as the ability to
	  process the options and suboptions as required below is
	  preserved.  Implementations MAY provide means for addressing
	  the contents of relay segments and of the inner
	  encapsulation segment in any convenient form, as long as it
	  conforms generally to the requirements of this document.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Processing of decapsulated suboptions</h3>

<p>This section specifies requirements for the processing of
	  decapsulated relay suboptions in the default case, where no
	  custom processing has been specified.  This should not be
	  construed to forbid implementations for providing mechanisms
	  for customizing the processing of these suboptions.
</p>
<p>This document does not specify special handling for DHCP
	  options.  Only the inner encapsulation&mdash;the
	  encapsulation of the original message sent from the client,
	  which is done by the first encapsulating relay&mdash;can
	  ever contain DHCP Options; hence, whatever normal mechanisms
	  a DHCP server provides for processing these options should
	  suffice.
</p>
<p>Some relay agent suboptions, such as the <a class='info' href='#RFC3527'>Relay Agent Subnet Selection
	  suboption<span> (</span><span class='info'>Kinnear, K., Stapp, M., Johnson, R., and J. Kumarasamy, &ldquo;Link Selection sub-option for the Relay Agent Information Option for DHCPv4,&rdquo; April&nbsp;2003.</span><span>)</span></a> [RFC3527], are intended to be processed by DHCP
	  servers.  Others, like the <a class='info' href='#RFC3046'>Circuit ID
	  and Remote ID<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046] suboptions, were not intended to be
	  processed by the DHCP server, but are often used by the DHCP
	  server for identification purposes.
</p>
<p>In cases where more than one relay agent sends the same
	  suboption, the DHCP server must either factor all such
	  suboptions into its processing, or choose one such suboption
	  and use that exclusively for processing.
</p>
<p>By default, DHCP servers MUST use the innermost suboption
	  (the one added by the relay agent closest to the DHCP
	  client) for every suboption that was sent by more than one
	  relay agent.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Sending RELAYREPLY messages</h3>

<p>When a DHCP server constructs a response to a DHCP client
	message that arrived encapsulated in a RELAYFORWARD message,
	the DHCP server MUST encapsulate the response in a RELAYREPLY
	message.  When multiple layers of RELAYFORWARD messages were
	received, the server MUST respond with an equivalently
	layering of RELAYREPLY messages.  When an RAIO was found, the
	DHCP server MUST return an RAIO at the same position in the
	encapsulation, if any.
</p>
<p>When a DHCP server constructs a response to a DHCP client
	message that did not arrive encapsulated in a RELAYFORWARD
	message, the DHCP server MUST NOT encapsulate the response in
	a RELAYREPLY message.
</p>
<p>In general, RELAYREPLY messages are constructed in the same
	way that RELAYFORWARD messages are constructed.  However,
	there are two key differences to consider in the construction
	of the relay segment of RELAYREPLY messages:
	</p>
<ul class="text">
<li>the use of the Encapsulating Agent Address
	  suboption
</li>
<li>the use of the Gateway IP Address suboption
</li>
</ul>

<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Directing responses along the reply chain</h3>

<p>Relay agents indicate their IP addresses to the DHCP
	  server using the Encapsulating Agent Address suboption.
	  DHCP servers indicate the IP address of the agent to which
	  to forward the response using the Encapsulating Agent
	  Address option.
</p>
<p>This means that in a RELAYFORWARD message, the
	  Encapsulating Agent Address option contains the address of
	  the relay agent that constructed the message.  In the
	  RELAYREPLY message, it contains a different address: the
	  address to which the message encapsulated in the RELAYREPLY
	  message should be sent.
</p>
<p>This is complicated by the fact that a layer two relay
	  agent or a non-conforming relay agent can appear at any
	  position in the relay chain.  In the case of a
	  non-conforming relay agent, we use giaddr instead of the
	  Encapsulating Agent Address suboption to indicate the IP
	  address to which the relay agent should forward the
	  response.
</p>
<p>In the case of a layer two relay agent, some
	  encapsulation layer inside of the layer two agent's layer
	  may contain the IP address of the next hop in the chain that
	  has an IP address.  If all the relay agents between the
	  layer two relay agent and the client are also layer two
	  relay agents, there will be no IP address to which to
	  forward the response.
</p>
<p>In either case, it is assumed that if there is no
	  downstream device with an IP address prior to the DHCP
	  client, normal packet transmission rules for reaching the
	  DHCP client are used, as specified in <a class='info' href='#RFC2131'>the DHCP protocol<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2131].
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Inner message</h3>

<p>When a DHCP server is constructing a response to a
	  RELAYFORWARD message, it starts with the DHCP message that
	  is to be delivered to a client&mdash;for example, a DHCPACK
	  message.  This message is constructed in the usual way,
	  except that giaddr is not set, even if it was set in the
	  RELAYFORWARD message.  This message becomes the outgoing
	  message.
</p>
<p>The DHCP server MUST NOT insert any Pad or End options
	  into the initial outgoing message.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Iterating across the encapsulation layers</h3>

<p>As it iterates across the layers of encapsulation, The
	  DHCP server tracks two values: a next-hop destination
	  address, and a next-hop gateway address.  Initially both
	  values are 0.0.0.0.  It also tracks a flag called
	  "appended RAIO" which starts out false.
</p>
<p>The DHCP server iterates across the recorded information
	  from the encapsulations it unpacked when it received the
	  RELAYFORWARD message, starting with the innermost
	  encapsulation, and proceeding toward the outermost, in
	  order.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
Per-iteration processing</h3>

<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4.1"></a><h3>5.2.4.1.&nbsp;
Processing for non-conforming relay agents</h3>

<p>If a particular layer was created by parsing an RAIO,
	    rather than by unpacking an encapsulation, then the server
	    packs an RAIO onto the end of the outgoing message.
	    Otherwise, the server encapsulates the outgoing message in
	    a RELAYREPLY message.
</p>
<p>If the server is packing an RAIO, the suboptions in the
	    RAIO are constructed as specified in <a class='info' href='#RFC3046'>the RAIO specification<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> [RFC3046] and any
	    suboption-specific documents that apply.  When the server
	    packs an RAIO, it MUST set the next-hop gateway IP address
	    value to the value of the next-hop destination IP address,
	    and set the value of the next-hop destination IP address
	    to the value of giaddr from the incoming RELAYFORWARD
	    message.
</p>
<p>When the server packs an RAIO, it appends it to the end
	    of the outgoing message, and sets the "appended RAIO" flag
	    to true.  If there are any further layers of
	    encapsulation, this outgoing message is used as the input
	    for the next layer of encapsulation.
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4.2"></a><h3>5.2.4.2.&nbsp;
Processing for conforming relay agents</h3>

<p>To encapsulate a layer, the server creates a new
	    message based on the outgoing message by first copying the
	    outgoing message, up to the magic number in the option
	    buffer, then inserting a relay segment, and then copying
	    the remainder of the option buffer into the encapsulation
	    segment.  The implementation is of course not required to
	    copy multiple times; it is specified this way here solely
	    for clarity.
</p>
<p>The server MUST NOT insert any Pad or End options
	    either in the relay segment or the encapsulation segment
	    of the new message.
</p>
<p>The server MUST copy every suboption that appeared in
	    the incoming relay segment into the outgoing relay
	    segment, except for the Message Type, Encapsulation
	    Information and Encapsulating Agent Address suboptions,
	    and except for relay agent suboptions whose specifications
	    require or permit other behavior for the server.  The
	    server SHOULD NOT preserve the order of options from the
	    incoming relay segment to the outgoing relay segment.
</p>
<p>The server MUST insert a Message Type suboption with a
	    message type of RELAYREPLY (TBD).
</p>
<p>If the "appended RAIO" flag is true, and the current
	    next-hop gateway address value is not 0.0.0.0, the server
	    MUST insert a Gateway IP Address suboption into the relay
	    segment.  The 'gateway ip addr' field MUST be set to the
	    current next-hop gateway address value.  The DHCP server
	    MUST then set the next-hop gateway address value to
	    0.0.0.0.
</p>
<p>If there was an Encapsulating Agent IP Address
	    suboption in the incoming relay segment for the current
	    layer, and the next-hop destination IP address value is
	    not 0.0.0.0, the DHCP server MUST insert an Encapsulating
	    Agent IP Address suboption into the relay segment, and it
	    MUST set the 'relay ip addr' field to the current next-hop
	    destination address.  The server MUST then set the value
	    of the next-hop destination address to 0.0.0.0.
</p>
<p>The DHCP server MUST insert an Encapsulation
	    Information suboption.  The 'rslen' field MUST be set to
	    the length of the relay segment.  The 'caplen' field MUST
	    be set to the length of the encapsulation segment.  The
	    'padlen' and 'ep' fields must be zero.
</p>
<p>Having completed an encapsulation layer, the new
	    message becomes the outgoing message.  The server sets the
	    "appended RAIO" flag to false.  If an additional layer of
	    encapsulation remains to be processed, the new outgoing
	    message will be used as input for the next iteration.
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
Transmission of RELAYREPLY messages</h3>

<p>This needs work.  I am not sure that all the giaddr
	  intricacies are accounted for.
</p>
<p>During iteration across the incoming encapsulations, the
	  DHCP server tracked two values: the next-hop IP address, and
	  the next-hop gateway address.  If the next-hop gateway
	  address value is not 0.0.0.0, and the "appended RAIO" flag
	  is true, the DHCP server MUST set the 'giaddr' field of the
	  outgoing message to that value.
</p>
<p>If the next-hop destination address is not 0.0.0.0, the
	  DHCP server MUST send the outgoing message to that address,
	  with a destination port of 67.  If the next-hop destination
	  address is 0.0.0.0, the DHCP server MUST transmit the packet
	  as specified in <a class='info' href='#RFC2131'>the DHCP
	  protocol"<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2131] for the case where the client is on the
	  local subnet.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
DHCP Client Behavior</h3>

<p>A DHCP client that receives either a RELAYFORWARD message or
      a RELAYREPLY message MUST silently discard that message.
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>Need to specify how encapsulations are signed.
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>We request that IANA assign three new suboption codes from
      the registry of DHCP Agent Sub-Option Codes maintained in
      http://www.iana.org/assignments/bootp-dhcp-parameters.  One each
      of these suboption codes will be assigned to the Encapsulation
      Information suboption, the Encapsulating Agent Address
      suboption, and the Gateway IP Address suboption.
</p>
<p>We request that IANA assign a new suboption code from the
      registry of DHCP Agent Sub-Option Codes maintained in
      http://www.iana.org/assignments/bootp-dhcp-parameters.  The
      value of this suboption code MUST be 53, so as to be compatible
      with the DHCP Message Type option.  This suboption code will be
      assigned to the DHCP Message Type suboption.
</p>
<p>We request that IANA assign a new suboption code from the
      registry of DHCP Agent Sub-Option Codes maintained in
      http://www.iana.org/assignments/bootp-dhcp-parameters.  The
      value of this suboption code MUST be 82, so as to be compatible
      with the Relay Agent Information option.  This suboption code will be
      assigned to the Relay Agent Information suboption.
</p>
<p>We request that IANA assign two new message type codes from
      the registry of DHCP Message Type 53 values maintained in
      http://www.iana.org/assignments/bootp-dhcp-parameters.  These
      two codes will be assigned to the RELAYFORWARD and
      RELAYREPLY message types.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dhc-relay-id-suboption">[I-D.ietf-dhc-relay-id-suboption]</a></td>
<td class="author-text">Stapp, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dhc-relay-id-suboption-07.txt">The DHCPv4 Relay Agent Identifier Suboption</a>,&rdquo; draft-ietf-dhc-relay-id-suboption-07 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dhc-relay-id-suboption-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2131">[RFC2131]</a></td>
<td class="author-text"><a href="mailto:droms@bucknell.edu">Droms, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>,&rdquo; RFC&nbsp;2131, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2131.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2131.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2131.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2132">[RFC2132]</a></td>
<td class="author-text"><a href="mailto:sca@engr.sgi.com">Alexander, S.</a> and <a href="mailto:droms@bucknell.edu">R. Droms</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2132">DHCP Options and BOOTP Vendor Extensions</a>,&rdquo; RFC&nbsp;2132, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2132.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2132.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2132.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3046">[RFC3046]</a></td>
<td class="author-text">Patrick, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3046">DHCP Relay Agent Information Option</a>,&rdquo; RFC&nbsp;3046, January&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3046.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3118">[RFC3118]</a></td>
<td class="author-text">Droms, R. and W. Arbaugh, &ldquo;<a href="http://tools.ietf.org/html/rfc3118">Authentication for DHCP Messages</a>,&rdquo; RFC&nbsp;3118, June&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3118.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3527">[RFC3527]</a></td>
<td class="author-text">Kinnear, K., Stapp, M., Johnson, R., and J. Kumarasamy, &ldquo;<a href="http://tools.ietf.org/html/rfc3527">Link Selection sub-option for the Relay Agent Information Option for DHCPv4</a>,&rdquo; RFC&nbsp;3527, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3527.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dhc-l2ra">[I-D.ietf-dhc-l2ra]</a></td>
<td class="author-text">Joshi, B. and P. Kurapati, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dhc-l2ra-04.txt">Layer 2 Relay Agent Information</a>,&rdquo; draft-ietf-dhc-l2ra-04 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dhc-l2ra-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3315">[RFC3315]</a></td>
<td class="author-text">Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>,&rdquo; RFC&nbsp;3315, July&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3315.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ted Lemon</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nominum, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2000 Seaport Blvd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redwood City, CA  94063</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650 381 6000</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mellon@nominum.com">mellon@nominum.com</a></td></tr>
</table>
</body></html>
