<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Cryptographic Message Syntax (CMS) Content Constraints Extension</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Cryptographic Message Syntax (CMS) Content Constraints Extension">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">R. Housley</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Vigil Security, LLC</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">S. Ashmore</td></tr>
<tr><td class="header">Expires: November 25, 2010</td><td class="header">National Security Agency</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">C. Wallace</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cygnacom Solutions</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">May 24, 2010</td></tr>
</table></td></tr></table>
<h1><br />Cryptographic Message Syntax (CMS) Content Constraints Extension<br />draft-housley-cms-content-constraints-extn-06</h1>

<h3>Abstract</h3>

<p>
        This document specifies the syntax and semantics for the
        Cryptographic Message Syntax (CMS) content constraints extension.  This extension is used to determine whether
        a public key is appropriate to
        use in the processing of a protected content.  In particular, the CMS
        content constraints extension is one part of the
        authorization decision; it is used when validating a digital
        signature on a CMS SignedData content or validating a message
        authentication code (MAC) on a CMS AuthenticatedData content or CMS
        AuthEnvelopedData content.  The signed or authenticated content type
        is identified by an ASN.1 object identifier, and this extension indicates the content types that the public key
        is authorized to validate.  If the authorization check is successful,
        the CMS content constraints extension also provides
        default values for absent attributes.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on November 25, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
CMS Data Structures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
CMS Content Constraints Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Attribute Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.4.</a>&nbsp;
Abstract Syntax Notation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">1.5.</a>&nbsp;
Terminology<br />
<a href="#anchor7">2.</a>&nbsp;
CMS Content Constraints Extension<br />
<a href="#anchor8">3.</a>&nbsp;
Certification Path Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.1.</a>&nbsp;
Inputs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.</a>&nbsp;
Initialization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.3.</a>&nbsp;
Basic Certificate Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.4.</a>&nbsp;
Preparation for Certificate i+1<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.5.</a>&nbsp;
Wrap-up procedure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.6.</a>&nbsp;
Outputs<br />
<a href="#anchor15">4.</a>&nbsp;
CMS Content Constraints Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.1.</a>&nbsp;
CMS Processing and CCC information collection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.1.1.</a>&nbsp;
Collection of signer or originator information<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">4.1.2.</a>&nbsp;
Collection of Attributes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">4.1.3.</a>&nbsp;
Leaf node classification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">4.2.</a>&nbsp;
Content Type and Constraint Checking<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.2.1.</a>&nbsp;
Inputs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">4.2.2.</a>&nbsp;
Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">4.2.3.</a>&nbsp;
Outputs<br />
<a href="#anchor25">5.</a>&nbsp;
Subordination Processing in TAMP<br />
<a href="#anchor26">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor27">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor28">8.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#anchor31">Appendix&nbsp;A.</a>&nbsp;
ASN.1 Modules<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">A.1.</a>&nbsp;
ASN.1 Module Using 1993 Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">A.2.</a>&nbsp;
ASN.1 Module Using 1988 Syntax<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        The Cryptographic Message Syntax (CMS) SignedData <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a> construct is used to sign many things,
        including cryptographic module firmware packages <a class='info' href='#RFC4108'>[RFC4108]<span> (</span><span class='info'>Housley, R., &ldquo;Using Cryptographic Message Syntax (CMS) to Protect Firmware Packages,&rdquo; August&nbsp;2005.</span><span>)</span></a> and certificate
        management messages <a class='info' href='#RFC5272'>[RFC5272]<span> (</span><span class='info'>Schaad, J. and M. Myers, &ldquo;Certificate Management over CMS (CMC),&rdquo; June&nbsp;2008.</span><span>)</span></a>.  Similarly, the CMS AuthenticatedData and
        CMS AuthEnvelopedData constructs provide authentication, which can be
        affiliated with an originator's static public key.  CMS Content Constraints (CCC) information is conveyed via an extension in a certificate
        or trust anchor object that contains the originator's or signer's public key.
      
</p>
<p>
        This document assumes a particular authorization model, where each
        originator is associated with one or more authorized content types.
        A CMS SignedData, AuthenticatedData, or AuthEnvelopedData will be
        considered valid only if the signature or message authentication code
        (MAC) verification process is successful and the originator is
        authorized for the encapsulated content type.  For example, one
        originator might be acceptable for verifying signatures on firmware
        packages, but that same originator may be unacceptable for verifying
        signatures on certificate management messages.  
      
</p>
<p>
        An originator's constraints are derived from the certification path
        used to validate the originator's public key.  Constraints are
        associated with trust anchors <a class='info' href='#TAF'>[TAF]<span> (</span><span class='info'>Housley, R., Wallace, C., and S. Ashmore, &ldquo;Trust Anchor Format,&rdquo; in progress.</span><span>)</span></a> and constraints are optionally included
        in public key certificates <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.  Using the CMS Content Constraints (CCC) extension, a trust anchor lists the
        content types for which it may be used.  A trust anchor may also
        include further constraints associated with each of the content types.
        Certificates in a certification path may contain a CCC extension that further constrains the authorization for subordinate certificates in the certification path.
      
</p>
<p>
        Delegation of authorizations is accomplished using the CCC certificate extension.  An entity may delegate none, some or all of its authorizations to another entity by issuing it a certificate with an appropriate CCC extension.  Absence of a CCC certificate extension in a certificate means that the subject is not authorized for any content type.  If the entity is an end entity, it may perform CCC delegation, i.e., though the use of proxy certificates.  However, usage of proxy certificates is not described in this specification.
      
</p>
<p>
        While processing the certification path, relying parties MUST ensure that authorizations of a subject of a certificate are constrained by the authorizations of the Issuer of that certificate.  In other words, when  a content signature or MAC is validated, checks MUST be performed to ensure that the encapsulated content type
        is within the permitted set for the trust anchor (TA) and each certificate in the path and that the constraints associated with
        the specific content type, if any, are satisfied by the TA and each certificate in the path.
      
</p>
<p>
        Additionally, this document provides subordination rules for processing CCC extensions within the Trust Anchor Management Protocol (TAMP) and relies on vocabulary from that document <a class='info' href='#TAMP'>[TAMP]<span> (</span><span class='info'>Housley, R., Wallace, C., and S. Ashmore, &ldquo;Trust Anchor Management Protocol (TAMP),&rdquo; in progress.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
CMS Data Structures</h3>

<p>
          CMS encapsulation can be used to compose structures of arbitrary
          breadth and depth.  This is achieved using a variety of content types that achieve different compositional goals.  A content type is an arbritrary structure that is identified using an object identifier.  This document defines two categories of content types: intermediate content types and leaf content types.  Intermediate content types are those designed specifically to encapsulate one or more additional content types with the addition of some service (such as a signature).  Leaf content types are those designed to carry specific information.  (Leaf content types may contain other content types.)  CCC is not used to constrain MIME encapsulated data, i.e., CCC processing stops when a MIME encapsulation layer is encountered.  SignedData <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a> and ContentCollection <a class='info' href='#RFC4073'>[RFC4073]<span> (</span><span class='info'>Housley, R., &ldquo;Protecting Multiple Contents with the Cryptographic Message Syntax (CMS),&rdquo; May&nbsp;2005.</span><span>)</span></a> are examples of intermediate content types.  FirmwarePkgData <a class='info' href='#RFC4108'>[RFC4108]<span> (</span><span class='info'>Housley, R., &ldquo;Using Cryptographic Message Syntax (CMS) to Protect Firmware Packages,&rdquo; August&nbsp;2005.</span><span>)</span></a> and TSTInfo <a class='info' href='#RFC3161'>[RFC3161]<span> (</span><span class='info'>Adams, C., Cain, P., Pinkas, D., and R. Zuccherato, &ldquo;Internet X.509 Public Key Infrastructure Time-Stamp Protocol (TSP),&rdquo; August&nbsp;2001.</span><span>)</span></a> are examples of leaf content types.  Protocol designers may provide an indication regarding the classification of content types within the protocol.  Four documents define the primary intermediate content types:
        
</p>
<p>
          RFC 5652 <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a>: Cryptographic Message Syntax (CMS)
        
</p>
<p>
          </p>
<blockquote class="text">
<p>- SignedData
</p>
<p>- EnvelopedData
</p>
<p>- EncryptedData
</p>
<p>- DigestedData
</p>
<p>- AuthenticatedData
</p>
</blockquote><p>
        
</p>
<p>
          RFC 5083 <a class='info' href='#RFC5083'>[RFC5083]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type,&rdquo; November&nbsp;2007.</span><span>)</span></a>: The Cryptographic Message Syntax (CMS)
          AuthEnvelopedData Content Type
        
</p>
<p>
          </p>
<blockquote class="text">
<p>
              - AuthEnvelopedData
            
</p>
</blockquote><p>
        
</p>
<p>
          RFC 4073 <a class='info' href='#RFC4073'>[RFC4073]<span> (</span><span class='info'>Housley, R., &ldquo;Protecting Multiple Contents with the Cryptographic Message Syntax (CMS),&rdquo; May&nbsp;2005.</span><span>)</span></a>: Protecting Multiple Contents with the
          Cryptographic Message Syntax (CMS)
        
</p>
<p>
          </p>
<blockquote class="text">
<p>
              - ContentCollection
            
</p>
<p>- ContentWithAttributes
</p>
</blockquote><p>
        
</p>
<p>
          RFC 3274 <a class='info' href='#RFC3274'>[RFC3274]<span> (</span><span class='info'>Gutmann, P., &ldquo;Compressed Data Content Type for Cryptographic Message Syntax (CMS),&rdquo; June&nbsp;2002.</span><span>)</span></a>: Compressed Data Content Type for
          Cryptographic Message Syntax (CMS)
        
</p>
<p>
          </p>
<blockquote class="text">
<p>
              - CompressedData
            
</p>
</blockquote><p>
        
</p>
<p>Some intermediate nodes can also function as leaf nodes in some situations.  EncryptedData, EnvelopedData and AuthEnvelopedData nodes will function as intermediate nodes for recipients that can decrypt the content and as encrypted leaf nodes for recipients who cannot decrypt the content.
</p>
<p>
          When using CMS, the outermost structure is always ContentInfo.
          ContentInfo consists of an object identifier and an associated
          content.  The object identifier describes the structure of the
          content.  Object identifiers are used throughout the CMS family of
          specifications to identify structures.
        
</p>
<p>
          Using the content types listed above, ignoring for the moment
          ContentCollection, encapsulation can be used to create structures of
          arbitrary depth.  Two examples based on <a class='info' href='#RFC4108'>[RFC4108]<span> (</span><span class='info'>Housley, R., &ldquo;Using Cryptographic Message Syntax (CMS) to Protect Firmware Packages,&rdquo; August&nbsp;2005.</span><span>)</span></a> are shown in Figure 1
          and Figure 2.
        
</p>
<p>
          When ContentCollection is used in conjunction with the other content
          types, tree-like structures can be defined, as shown in Figure 3.
        
</p>
<p>
          The examples in Figures 1, 2, and 3 can each be represented as a
          tree: the root node is the outermost ContentInfo, and the leaf nodes
          are the encapsulated contents.  The trees are shown in Figure 4.
        
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      +---------------------------------------------------------+
      | ContentInfo                                             |
      |                                                         |
      | +-----------------------------------------------------+ |
      | | SignedData                                          | |
      | |                                                     | |
      | | +-------------------------------------------------+ | |
      | | | FirmwarePackage                                 | | |
      | | |                                                 | | |
      | | |                                                 | | |
      | | +-------------------------------------------------+ | |
      | +-----------------------------------------------------+ |
      +---------------------------------------------------------+

             Figure 1.  Example of a Signed Firmware Package.



      +---------------------------------------------------------+
      | ContentInfo                                             |
      |                                                         |
      | +-----------------------------------------------------+ |
      | | SignedData                                          | |
      | |                                                     | |
      | | +-------------------------------------------------+ | |
      | | | EncryptedData                                   | | |
      | | |                                                 | | |
      | | | +---------------------------------------------+ | | |
      | | | | FirmwarePackage                             | | | |
      | | | |                                             | | | |
      | | | |                                             | | | |
      | | | +---------------------------------------------+ | | |
      | | +-------------------------------------------------+ | |
      | +-----------------------------------------------------+ |
      +---------------------------------------------------------+

      Figure 2.  Example of a Signed and Encrypted Firmware Package.

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      +---------------------------------------------------------+
      | ContentInfo                                             |
      |                                                         |
      | +-----------------------------------------------------+ |
      | | SignedData                                          | |
      | |                                                     | |
      | | +-------------------------------------------------+ | |
      | | | ContentCollection                               | | |
      | | |                                                 | | |
      | | | +----------------------+ +--------------------+ | | |
      | | | | SignedData           | | SignedData         | | | |
      | | | |                      | |                    | | | |
      | | | | +------------------+ | | +----------------+ | | | |
      | | | | | EncryptedData    | | | | Firmware       | | | | |
      | | | | |                  | | | | Package        | | | | |
      | | | | | +--------------+ | | | |                | | | | |
      | | | | | | Firmware     | | | | +----------------+ | | | |
      | | | | | | Package      | | | +--------------------+ | | |
      | | | | | |              | | |                        | | |
      | | | | | +--------------+ | |                        | | |
      | | | | +------------------+ |                        | | |
      | | | +----------------------+                        | | |
      | | +-------------------------------------------------+ | |
      | +-----------------------------------------------------+ |
      +---------------------------------------------------------+

      Figure 3.  Example of Two Firmware Packages in a Collection.

</pre></div><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      +---------------------------------------------------------+
      |                                                         |
      |     CMS PATH RESULTING            CMS PATH RESULTING    |
      |       FROM FIGURE 1.                FROM FIGURE 2.      |
      |                                                         |
      |       ContentInfo                   ContentInfo         |
      |           |                             |               |
      |           V                             V               |
      |       SignedData                    SignedData          |
      |           |                             |               |
      |           V                             V               |
      |       FirmwarePackage               EncryptedData       |
      |                                         |               |
      |                                         V               |
      |                                     FirmwarePackage     |
      |                                                         |
      |                                                         |
      |            CMS PATHS RESULTING FROM FIGURE 3.           |
      |                                                         |
      |                       ContentInfo                       |
      |                           |                             |
      |                           V                             |
      |                       SignedData                        |
      |                           |                             |
      |                           V                             |
      |                       ContentCollection                 |
      |                           |                             |
      |                +----------+--------------+              |
      |                |                         |              |
      |                V                         V              |
      |            SignedData                SignedData         |
      |                |                         |              |
      |                V                         V              |
      |            EncryptedData             FirmwarePackage    |
      |                |                                        |
      |                V                                        |
      |            FirmwarePackage                              |
      |                                                         |
      +---------------------------------------------------------+

                  Figure 4.  Example CMS Path Structures.

</pre></div>
<p>
          These examples do not illustrate all of the details of CMS
          structures; most CMS protecting content types, and some leaf-node content
          types, contain attributes.  Attributes from intermediate nodes can influence processing
          and handling of the CMS protecting content type or the encapsulated
          content type.  Attributes from leaf nodes may be checked independent of the CCC processing, but such processing is not addressed in this document.  Throughout this document, paths through the tree
          structure from a root node to a leaf node in a CMS-protected message
          are referred to as CMS paths.
        
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
CMS Content Constraints Model</h3>

<p>
          The CCC extension is used to restrict
          the types of content for which a particular public key can be used to
          verify a signature or MAC.  Trust in a public key is established by
          building and validating a certification path from a trust anchor to
          the subject public key.  Section 6 of <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> describes the
          algorithm for certification path validation, and the basic path
          validation algorithm is augmented, as described in Section 3 of
          this document, to include processing required to determine the CMS
          content constraints that have been delegated to the subject public
          key.  If the subject public key is explicitly trusted (the public key
          belongs to a trust anchor), then any CMS content constraints
          associated with the trust anchor are used directly.  If the subject
          public key is not explicitly trusted, then the CMS content
          constraints are determined by calculating the intersection of the CMS
          content constraints included in all the certificates in a valid
          certification path from the trust anchor to the subject public key, including those associated with the trust anchor.  
        
</p>
<p>
          CMS enables the use of multiple nested signatures or MACs.  Each
          signature or MAC can protect and associate attributes with an
          encapsulated data object.  The CMS content constraints extension is associated with a public key, and that public key is
          used to verify a signature or a MAC.
        
</p>
<p>
          The CMS content constraints mechanism can be used to place limits on the use of the subject public key used for authentication or signature verification for one or more specific content
          types.  Furthermore, within each permitted content type, a permitted set
          of values can be expressed for one or more specific attribute
          types.
        
</p>
<p>
          When a leaf content type is encapsulated by multiple intermediate authentication layers, the signer or originator closest to a leaf node must be authorized to serve as a source for the leaf content type; outer signers or originators need not be authorized to serve as a source, but must be authorized for the leaf content type.  All signers or originators must be authorized for the attributes that appear in a CMS path. 
        
</p>
<p>A signer or originator may be constrained to use a specific set of attribute values for some attribute types when producing a particular content type.  If a signer or originator is constrained for a particular attribute that does not appear in a protected content of the type for which the constraint is defined, the constraint serves as a default attribute, i.e., the payload should be processed as if an attribute equal to the constraint appeared in the protected content.  However, in some cases, the processing rules for a particular content type may disallow the usage of default values for some attribute types and require a signer to explicitly assert the attribute to satisfy the constraint.  Signer constraints are output for use in leaf node processing or other processing not addressed by this specification.
</p>
<p>Three models for processing attributes were considered:
</p>
<p>
          </p>
<ul class="text">
<li>Each signer or originator must be authorized for attributes it asserts
</li>
<li>Each signer or originator must be authorized for attributes it asserts and attributes contained in the content it authenticates
</li>
<li>Each signer or originator must be authorized for attributes it asserts, attributes contained in the content it authenticates and attribute contained in content that authenticates it, i.e., all signers or originators must be authorized for all attributes appearing in the CMS path.
</li>
</ul><p>
        
</p>
<p>The third model is used in this specification.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Attribute Processing</h3>

<p>This specification defines a mechanism for enforcing constraints on content types and attributes.  Where content types are straightforward to process because there is precisely one content type of interest for a given CMS path, attributes are more challenging.  Attributes can be asserted at many different points in a CMS path.  Some attributes may by their nature be applicable to a specific node of a CMS path, for example, a ContentType and MessageDigest attributes apply to a specific SignerInfo object.  Other attributes may apply to a less well-defined target, for example, a ContentCollection may appear as the payload within a ContentWithAttributes object.
</p>
<p>Since there is no automated means of determining what an arbitrary attribute applies to or how the attribute should be used, CCC processing simply collects attributes and makes them available for applications to use during leaf node processing.  Implementations SHOULD refrain from collecting attributes that are known to be inapplicable to leaf node processing, for example, ContentType and MessageDigest attributes.
</p>
<p>Some attributes contain multiple values.  Attribute constraints expressed in a CCC extension may contain multiple values.  Attributes expressed in a constraint that do not appear in a CMS path are returned as default attributes.  Default attributes may have multiple values.  Attributes are returned to an application via two output variables: cms_effective_attributes and cms_default_attributes.  Attribute may be absent, present with one value or present with multiple values in a CMS path and/or in CMS content constraints.  A summary of the resulting nine possible combinations is below.
</p>
<p>
        </p>
<blockquote class="text">
<p>Attribute absent in CMS path; absent in cms_constraints: no action.
</p>
<p>Attribute absent in CMS path; single value in cms_constraints: the value from cms_constraints is added to cms_default_attributes.
</p>
<p>Attribute absent in CMS path; multiple values in cms_constraints: the values from cms_constraints are added to cms_default_attributes.
</p>
<p>Attribute is present with a single value in CMS path; absent in cms_constraints: the value from CMS path is returned in cms_effective_attributes.
</p>
<p>Attribute is present with a single value in CMS path; single value in cms_constraints: the value from CMS path must match the value from cms_constraints.  If successful match, the value is returned in cms_effective_attribute.  If no match, constraints processing fails.
</p>
<p>Attribute is present with a single value in CMS path; multiple values in cms_constraints: the value from CMS path must match a value from cms_constraints.  If successful match, the value from the CMS path is returned in cms_effective_attribute.  If no match, constraints processing fails.
</p>
<p>Attribute is present with a multiple values in CMS path; absent in cms_constraints: the values from CMS path is returned in cms_effective_attributes.
</p>
<p>Attribute is present with a multiple values; single value in cms_constraints: the values from CMS path must match the value from cms_constraints (i.e., all values must be identical).  If successful match, the values from the CMS path are returned in cms_effective_attribute.  If no match, constraints processing fails.
</p>
<p>Attribute is present with a multiple values; multiple values in cms_constraints: each value from CMS path must match a value from cms_constraints.  If each comparison is successful, the values from the CMS path is returned in cms_effective_attribute.  If a comparison fails, constraints processing fails.
</p>
</blockquote><p>
        
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Abstract Syntax Notation</h3>

<p>
          All X.509 certificate <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> extensions are defined using ASN.1
          <a class='info' href='#X.680'>[X.680]<span> (</span><span class='info'>, &ldquo;ITU-T Recommendation X.680: Information Technology - Abstract Syntax Notation One,&rdquo; 2002.</span><span>)</span></a><a class='info' href='#X.690'>[X.690]<span> (</span><span class='info'>, &ldquo;ITU-T Recommendation X.690 Information Technology -     ASN.1 encoding rules: Specification of Basic Encoding     Rules (BER), Canonical Encoding Rules (CER) and     Distinguished Encoding Rules (DER),&rdquo; 2002.</span><span>)</span></a>.
        
</p>
<p>
          CMS content types <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a> are also defined using ASN.1.
        
</p>
<p>
          CMS uses the Attribute type.  The syntax of Attribute is compatible
          with X.501 [X.501].
        
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.5"></a><h3>1.5.&nbsp;
Terminology</h3>

<p>
          The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
          "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
          document are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
CMS Content Constraints Extension</h3>

<p>
        The CMS content constraints extension provides a
        mechanism to constrain authorization during delegation.  If the CMS
        content constraints extension is not present, then the
        subject of the trust anchor or certificate is not authorized for any content type, with an exception for apex trust anchors which are implicitly authorized for all content types.  A certificate issuer may use the CMS content
        constraints extension for one or more of the following purposes:
      
</p>
<p>
        </p>
<ul class="text">
<li>
            Limit the certificate subject to a subset of the
            content types for which the certificate issuer is authorized
          
</li>
<li>
            Add constraints to a previously
            unconstrained content type
          
</li>
<li>
            Add additional constraints to a
            previously constrained content type.
          
</li>
</ul><p>
      
</p>
<p>
        The CMS content constraints extension MAY be critical,
        and it MUST appear at most one time in a trust anchor or certificate.  The CMS
        content constraints extension is identified by the
        id-pe-cmsContentConstraints object identifier:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      id-pe-cmsContentConstraints OBJECT IDENTIFIER ::=
          { iso(1) identified-organization(3) dod(6) internet(1)
            security(5) mechanisms(5) pkix(7) pe(1) 18 }

</pre></div>
<p>The syntax for the CMS content constraints extension is:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


  CMSContentConstraints ::= SEQUENCE SIZE (1..MAX) OF
    ContentTypeConstraint

  ContentTypeGeneration ::= ENUMERATED {
      canSource,
      cannotSource  }

  ContentTypeConstraint ::= SEQUENCE {
    contentType           OBJECT IDENTIFIER,
    canSource             ContentTypeGeneration DEFAULT canSource,
    attrConstraints       AttrConstraintList OPTIONAL }

  AttrConstraintList ::= SEQUENCE SIZE (1..MAX) OF AttrConstraint

  AttrConstraint ::= SEQUENCE {
    attrType               AttributeType,
    attrValues             SET SIZE (1..MAX) OF AttributeValue }

  id-ct-anyContentType OBJECT IDENTIFIER ::= { iso(1) member-body(2)
         us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
         ct(1) 0 }

</pre></div>
<p>
        The CMSContentConstraints is a list of permitted
        content types and associated constraints.  A particular content type MUST NOT appear more than once in a CMSContentConstraints.
        When the extension is present, the certificate
        subject is being authorized by the certificate issuer to sign or
        authenticate the content types listed in the permitted list as long
        as the provided constraints, if any, are met.  The relying party MUST ensure that the certificate issuer is authorized to delegate the privileges.  When the extension is absent, the certificate subject is not authorized for any content type.
      
</p>
<p>The special id-ct-anyContentType value indicates the certificate subject is being authorized for any content type without any constraints.  Where id-ct-anyContentType appears alongside a specific content type, the specific content type is authoritative.  The id-ct-anyContentType object identifier can be used in trust anchors when the trust anchor is unconstrained.  Where id-ct-anyContentType is asserted in the contentType field, the canSource field MUST be equal to the canSource enumerated value and attrConstraints MUST BE absent, indicating the trust anchor can serve as a source for any content type without any constraints.
</p>
<p>
        The fields of the ContentTypeConstraint type have the following
        meanings:
      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>contentType</dt>
<dd>
            is an object identifier that specifies a
            permitted content type.  When the extension appears in an end
            entity certificate, it indicates that a content of this type
            can be verified using the public key in the certificate.  When
            the extension appears in a certification authority (CA) certificate, it indicates that a
            content of this type can be verified using the public key in
            the CA certificate or the public key in an appropriately authorized subordinate
            certificate.  For example, this field contains id-ct-firmwarePackage when the public key can be used to
            verify digital signatures on firmware packages defined in
            <a class='info' href='#RFC4108'>[RFC4108]<span> (</span><span class='info'>Housley, R., &ldquo;Using Cryptographic Message Syntax (CMS) to Protect Firmware Packages,&rdquo; August&nbsp;2005.</span><span>)</span></a>.  A particular content type MUST NOT appear more than once in the list.  Intermediate content types MUST NOT be included in the list of permitted content types.  Since the content type of intermediate nodes is not subject to CMS Constraint Processing, originators need not be authorized for intermediate node content types.  The intermediate content types are:
            
<blockquote class="text"><dl>
<dt></dt>
<dd>id-signedData,
</dd>
<dt></dt>
<dd>id-envelopedData,
</dd>
<dt></dt>
<dd>id-digestedData,
</dd>
<dt></dt>
<dd>id-encryptedData,
</dd>
<dt></dt>
<dd>id-ct-authEnvelopedData,
</dd>
<dt></dt>
<dd>id-ct-authData,
</dd>
<dt></dt>
<dd>id-ct-compressedData,
</dd>
<dt></dt>
<dd>id-ct-contentCollection
</dd>
<dt></dt>
<dd>id-ct-contentWithAttrs.
</dd>
</dl></blockquote>
          
</dd>
<dt>canSource</dt>
<dd>
            is an enumerated value.  If the canSource field is equal to canSource, then the subject can be the innermost authenticator of the specified content type.  For a subject to be authorized to source a content type, the issuer of the subject certificate MUST also be authorized to source the content type.
            Regardless of the flag value, a subject can sign or
            authenticate a content that is already authenticated (when
            SignedData, AuthenticatedData, or AuthEnvelopedData is already
            present).
          
</dd>
<dt>attrConstraints</dt>
<dd>
            is an optional field that contains constraints
            that are specific to the content type.  If the attrConstraints
            field is absent, the public key can be used to verify
            the specified content type without further checking.  If the
            attrConstraints field is present, then the public key
            can only be used to verify the specified content type if all of
            the constraints are satisfied.  A particular constraint type, i.e., attrValues structure for a particular attribute type, MUST NOT appear more than once in the attrConstraints for a specified content type.
            Constraints are checked by matching the values in the
            constraint against the corresponding attribute value(s) in the CMS path.
            Constraints processing fails if the attribute is present and the value is
            not one of the values provided in the constraint.  Constraint
            checking is described fully in section 4.
          
</dd>
<dt></dt>
<dd>
            The fields of the AttrConstraint type have the following meanings:
            
<blockquote class="text"><dl>
<dt>attrType</dt>
<dd>
                is an AttributeType, which is an object identifier
                that names an attribute.  For a content encapsulated in a CMS
                SignedData, AuthenticatedData, or AuthEnvelopedData to satisfy
                the constraint, if the attributes that are covered by the
                signature or MAC include an attribute of the same type, then the
                attribute value MUST be equal to one of the values supplied in the
                attrValues field.  Attributes that are not covered by the signature or MAC are not checked against constraints.  Attribute types that do not appear as an AttrConstraint are unconstrained, i.e., the signer or originator is free to assert any value.
              
</dd>
<dt>attrValues</dt>
<dd>
                is a set of AttributeValue.  The structure of each
                of the values in attrValues is determined by attrType.
                Constraint checking is described fully in section 4.
              
</dd>
</dl></blockquote>
          
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Certification Path Processing</h3>

<p>
When CMS content constraints are used for authorization, the
processing described in this section SHOULD be included in the
certification path validation.  The processing is presented as
an augmentation to the certification path validation algorithm described in
section 6 of <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>, as shown in the figure below.  Alternative implementations are allowed but
MUST yield the same results as described below.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CCC-related inputs
+ inhibitAnyContentType flag
+ absenceEqualsUnconstrained flag
+ Trust anchor CCC extension
+ Content type of interest (cms_content_type)
+ Attributes of interest (cms_effective_attributes)
                  |
                  |
   _______________V________________________
  |                                        |
  | CCC-aware Certification Path Processor |
  |________________________________________|
                  |
                  |
                  V
CCC-related outputs upon success
+ Applicable content type constraints (subject_constraints)
+ Constrained attributes not present in cms_effective_attributes
   (subject_default_attributes)
+ Content types not propagated to end entity (excluded_content_types)

      Figure 5.  Certification Path Processing Inputs and Outputs

</pre></div>
<p>
Certification path processing validates the binding between the
subject and subject public key.  If a valid certification path cannot
be found, then the corresponding CMS path MUST be rejected.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Inputs</h3>

<p>Two boolean values are provided as input: inhibitAnyContentType and absenceEqualsUnconstrained.
</p>
<p>The inhibitAnyContentType flag is used to govern processing of the special id-ct-anyContentType value.  When inhibitAnyContentType is true, id-ct-anyContentType is not considered to match a content type.  When inhibitAnyContentType is false, id-ct-anyContentType is consider to match any content type.
</p>
<p>The absenceEqualsUnconstrained flag is used to govern the meaning of CCC absence.  When absenceEqualsUnconstrained is true, a trust anchor without a CCC extension is considered to be unconstrained and a certificate without a CCC extension is considered to have the same CCC privileges as its issuer.  When absenceEqualsUnconstrained is false, a trust anchor or certificate without a CCC extension is not authorized for any content types.
</p>
<p>Neither of these flags has any bearing on an apex trust anchor, which is always unconstrained by definition.
</p>
<p>
  If a trust anchor used for path validation is authorized, then the trust anchor MAY include a CCC extension.  A trust anchor may be constrained or unconstrained.  If unconstrained, the trust anchor MUST either include a CMS Content Constraints extension containing the special id-ct-anyContentType value and inhibitAnyContentType is false or the trust anchor MUST have no CCC extension and absenceEqualsUnconstrained is set to true.  If the trust anchor does not contain a CMS Content Constraints structure and absenceEqualsUnconstrained is false, the CMS content constraints processing fails.  If the trust anchor contains a CCC extension with a single entry containing id-ct-anyContentType and inhibitAnyContentType is true, the CMS content constraints processing fails.

</p>
<p>The content type of the protected content being verified can be provided as input along with the set of attributes collected from the CMS path in order to determine if the certification path is valid for a given context.  Alternatively, the id-ct-anyContentType value can be provided as the content type input, along with an empty set of attributes, to determine the full set of constraints associated with a public key in the end entity certificate in the certification path being validated.
</p>
<p>
  Trust anchors may produce CMS-protected contents.  When validating messages originated by a trust anchor, certification path validation as described in section 6 of <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> is not necessary but constraints processing MUST still be performed for the trust anchor.  In such cases, the initialization and wrap-up steps described below can be performed to determine if the public key in the trust anchor is appropriate to use in the processing of a protected content.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Initialization</h3>

<p>Create an input variable named cms_content_type and set it equal to the content type provided as input.
</p>
<p>Create an input variable named cms_effective_attributes and set it equal to the set of attributes provided as input.  
</p>
<p>
  Create a state variable named working_permitted_content_types.  The initial value of
  working_permitted_content_types is the permitted content type list
  from the trust anchor, including any associated constraints.

</p>
<p>
  Create a state variable named excluded_content_types.  The initial value of
  excluded_content_types is empty.

</p>
<p>Create an state variable of type SEQUENCE OF AttrConstraint named subject_default_attributes and initialize it to empty.
</p>
<p>Create an state variable of type SEQUENCE OF ContentTypeConstraint named subject_constraints and initialize it to empty.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Basic Certificate Processing</h3>

<p>
    If the CCC extension is not present in the certificate, check the value of absenceEqualsUnconstrained.  If false, set working_permitted_content_types to empty.  If true, working_permitted_content_types is unchanged.  In either case, no further CCC processing is required for the certificate.
  
</p>
<p>
    If inhibitAnyContenType is true, discard any entries in the CCC extension with a content type value equal to id-ct-anyContentType.
  
</p>
<p>
  For each entry in the permitted content type list sequence in the CMS content constraints extension the following steps are performed:

</p>
<p>
  </p>
<blockquote class="text">
<p>- If the entry contains the special id-ct-anyContentType value, skip to the next entry.
</p>
<p>- If the entry contains a content type that is present in excluded_content_types, skip to the next entry.
</p>
<p>
      - If the entry includes a content type that is not present in working_permitted_content_types, determine if working_permitted_content_types contains an entry equal to the special id-ct-anyContentType value.  If no, no action is taken and working_permitted_content_types is unchanged.  If yes, add the entry to working_permitted_content_types.
    
</p>
<p>
      - If the entry includes a content type that is already present in working_permitted_content_types, then the constraints in the
      entry can further reduce the authorization by adding constraints to previously unconstrained attributes or by removing attribute values from
      the attrValues set of a constrained attribute.  The canSource flag is set to cannotSource unless it is canSource in the working_permitted_content_types entry and in the entry.  The processing actions to be performed for each constraint in the AttrConstraintList follow:
    
</p>
<p>
      </p>
<blockquote class="text">
<p>
          -- If the constraint includes an attribute type that is not present in
          the corresponding working_permitted_content_types entry,
          add the attribute type and the associated set of attribute values to working_permitted_content_types entry.
        
</p>
<p>
          -- If the constraint includes an attribute type that is already present in
          the corresponding working_permitted_content_types entry,
          then compute the intersection of the set of attribute
          values from the working_permitted_content_types entry and the
          constraint.  If the intersection contains at
          least one attribute value, then the set of attribute
          values in working_permitted_content_types entry is assigned the intersection.  If the
          intersection is empty, then the entry is removed from working_permitted_content_types and the content type from the entry is added to excluded_content_types.
        
</p>
</blockquote>
    

</blockquote><p>

</p>
<p>
  Remove each entry in working_permitted_content_types that includes a content type that is not present in the CMS content constraints extension.  For values other than id-ct-anyContentType, add the removed content type to excluded_content_types.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Preparation for Certificate i+1</h3>

<p>
  No additional action associated with the CMS content constraints
  extension is taken during this phase of certification
  path validation as described in section 6 of <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Wrap-up procedure</h3>

<p>If cms_content_type equals the special value anyContentType, the CCC processing portion of path validation succeeds.  Set subject_constraints equal to working_permitted_content_types.  If cms_content_type is not equal to the special value anyContentType, perform the following steps:
</p>
<p>
  </p>
<blockquote class="text">
<p>- If cms_content_type is present in excluded_content_types, the CCC processing portion of path validation fails.
</p>
<p>
      - If working_permitted_content_types is equal to the special value anyContentType, set
      subject_constraints equal to working_permitted_content_types; the CCC processing portion of path validation succeeds.
    
</p>
<p>
      - If cms_content_type does not equal the content type of an entry in
      working_permitted_content_types, constraints processing fails and
      path validation fails.
    
</p>
<p>
      - If cms_content_type equals the content type of an entry in
      working_permitted_content_types, add the entry from working_permitted_content_types to subject_constraints.  If the corresponding entry in working_permitted_content_types contains the special value anyContentType, set subject_constraints equal to cms_content_type; the CCC processing portion of path validation succeeds.
    
</p>
<p>
      - If the attrConstraints field of the corresponding entry in working_permitted_content_types is absent; the CCC processing portion of path validation succeeds.
    
</p>
<p>
      - If the attrConstraints field of the corresponding entry in working_permitted_content_types is present, then constraints MUST be checked.  For each attrType in the
      attrConstraints, the constraint is satisfied if either the
      attribute type is absent from cms_effective_attributes or each
      attribute value in the attrValues field of the corresponding entry in cms_effective_attributes is equal to one of the
      values for this attribute type in the attrConstraints field.
      If cms_effective_attributes does not contain an attribute of
      that type, then the entry from attrConstraints is added to the
      subject_default_attributes for use in processing the payload.
    
</p>
</blockquote><p>

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Outputs</h3>

<p>
  If certification path validation processing succeeds, return the
  value of the subject_constraints, subject_default_attributes and excluded_content_types variables.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
CMS Content Constraints Processing</h3>

<p>CMS contents constraints processing is performed on a per CMS path basis.  The processing consists of traditional CMS processing 
augmented by collection of information required to perform content type and constraint checking.  Content type and constraint checking
uses the collected information to build and validate a certification path to each public key used to authenticate nodes in the CMS path per
the certification path processing steps described above.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
CMS Processing and CCC information collection</h3>

<p>
Traditional CMS content processing is augmented by the following three steps to support enforcement of CMS content constraints:

</p>
<p>
</p>
<blockquote class="text">
<p>- Collection of Signer or Originator Keys
</p>
<p>- Collection of Attributes
</p>
<p>- Leaf node classification
</p>
</blockquote><p>

</p>
<p>
    CMS processing and CCC information collection takes a CMS path as input and returns a collection of public keys used to authenticate protected content,
    a collection of authenticated attributes and the leaf node, as shown in the figure below.
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Inputs
+ CMS path
          |
          |
 _________V___________________
|                             |
| CMS processing and CCC      |
|  information collection     |
|_____________________________|
          |
          |
          V
Outputs upon success
+ Leaf node
+ Public keys used to authenticate content (cms_public_keys)
+ Authenticated attributes (cms_effective_attributes)

      Figure 6.  CMS processing and CCC information collection

</pre></div>
<p>
    Processing is performed for each CMS path from the root node of a
    CMS-protected content to a leaf node, proceeding from the root node
    to the leaf node.  Each path is processed independently of the other
    paths.  Thus, it is possible that some leaf nodes in a content
    collection may be acceptable while other nodes are not acceptable.
    The processing described in this section applies to CMS paths that
    contain at least one SignedData, AuthEnvelopedData, or
    AuthenticatedData node.  Since countersignatures are defined as not having a content, CMS content constraints are not used with countersignatures.
  
</p>
<p>
Signer or originator public keys are collected when verifying signatures or message
authentication codes (MACs).  These keys will be used to determine the constraints of each signer or originator by building and validating a certification path to the public key.  Public key values, public key certificates or public key identifiers are accumulated in a state variable named cms_public_keys, which is either initialized to empty or to an application provided set of keys when processing begins.  The variable will be updated each time a SignedData, AuthEnvelopedData, or AuthenticatedData node is encountered in the CMS path.

</p>
<p>
All authenticated attributes appearing in a CMS path are collected, beginning with the
attributes protected by the outermost SignedData, AuthEnvelopedData, or
AuthenticatedData and proceeding to the leaf node.  During processing, attributes collected from the
nodes in the CMS path are maintained in a state variable named
cms_effective_attributes and default attributes derived from message
originator authorizations are collected in a state variable named
cms_default_attributes.  A default attribute value comes from a
constraint that does not correspond to an attribute contained in the
CMS path and may be used during payload processing in lieu of an explicitly included attribute.  This prevents an originator from avoiding a constraint through omission.  When processing begins,
cms_effective_attributes and cms_default_attributes are initialized
to empty.  Alternatively, cms_effective_attributes may be initialized
to an application-provided sequence of attributes.  The
cms_effective_attributes value will be updated each time an attribute
set is encountered in a SignedData, AuthEnvelopedData, 
AuthenticatedData or (authenticated) ContentWithAttributes node while processing a CMS path.

</p>
<p>
The output of content type and constraint checking always includes a set of
attributes collected from the various nodes in a CMS path.  When processing terminates at an encrypted node, the set of signer or originator public keys is also returned.  When processing terminates at a leaf node, a set of default attribute values is also returned along with a set of constraints that apply to the
CMS-protected content.

</p>
<p>
The output from CMS Content Constraints processing will depend on the type of the leaf node that terminates the CMS path.  Four different output variables are possible.  The conditions under which each is returned is described in the following sections.  The variables are:
</p>
<blockquote class="text"><dl>
<dt>cms_public_keys</dt>
<dd>is a list of public key values, public key certificates or public key identifiers.  Information maintained in cms_public_keys will be used to perform the certification path operations required to determine if a particular signer or originator is authorized to produce a specific object.
</dd>
<dt>cms_effective_attributes</dt>
<dd>
    contains the attributes collected from the nodes in a CMS path.  cms_effective_attributes is a SEQUENCE OF Attribute, which is the
    same as the AttrConstraintList structure except that it may have zero
    entries in the sequence.  An attribute can occur multiple times in the cms_effective_attribute set, potentially with different values.
  
</dd>
<dt>cms_default_attributes</dt>
<dd>
    contains default attributes derived from message signer or
    originator authorizations.  A default attribute value is taken from a constraint that does not correspond to an attribute contained in the CMS path.  cms_default_attributes is a SEQUENCE OF Attribute, which is the same as the AttrConstraintList structure except that it may have zero
    entries in the sequence.
  
</dd>
<dt>cms_constraints</dt>
<dd>
    contains the constraints associated with the message signer or
    originator for the content type of the leaf node.  cms_constraints is a SEQUENCE OF Attribute, which is the same as the AttrConstraintList structure except that it may have zero
    entries in the sequence.
  
</dd>
</dl></blockquote><p>

</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Collection of signer or originator information</h3>

<p>
  Signer or originator constraints are identified using the public keys to verify each SignedData, AuthEnvelopedData, or AuthenticatedData layer encountered in a CMS path.  The public key value, public key certificate or public key identifier of each signer or originator are collected in a state variable named cms_public_keys.  Constraints are determined by building and validating a certification path for each public key after the content type and attributes of the CMS-protected object have been identified.  If the CMS path has no SignedData, AuthEnvelopedData, or AuthenticatedData nodes, CCC processing succeeds and all output variables are set to empty.

</p>
<p>
    The signature or MAC generated by the originator MUST be verified.
    If signature or MAC verification fails, then the CMS path containing
    the signature or MAC MUST be rejected.  Signature and MAC
    verification procedures are defined in <a class='info' href='#RFC5652'>[RFC5652]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS),&rdquo; September&nbsp;2009.</span><span>)</span></a><a class='info' href='#RFC5083'>[RFC5083]<span> (</span><span class='info'>Housley, R., &ldquo;Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type,&rdquo; November&nbsp;2007.</span><span>)</span></a>.  The public key or public key certificate used to verify each signature or MAC in a CMS path is added to the cms_public_keys state variable for use in content type and constraint checking.  Additional checks may be performed during this step, such as timestamp verification <a class='info' href='#RFC3161'>[RFC3161]<span> (</span><span class='info'>Adams, C., Cain, P., Pinkas, D., and R. Zuccherato, &ldquo;Internet X.509 Public Key Infrastructure Time-Stamp Protocol (TSP),&rdquo; August&nbsp;2001.</span><span>)</span></a> and ESSCertId <a class='info' href='#RFC5035'>[RFC5035]<span> (</span><span class='info'>Schaad, J., &ldquo;Enhanced Security Services (ESS) Update: Adding CertID Algorithm Agility,&rdquo; August&nbsp;2007.</span><span>)</span></a> processing.
  
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1.1"></a><h3>4.1.1.1.&nbsp;
Handling multiple SignerInfo elements</h3>

<p>
      CMS content constraints MAY be applied to CMS-protected contents featuring multiple parallel signers, i.e., SignedData contents containing more than one SignerInfo.  When multiple SignerInfo elements are present, each may represent a distinct entity or each may represent the same entity via different keys or certificates, e.g., in the event of key rollover or when the entity has been issued certificates from multiple organizations.  For simplicity, signers represented by multiple SignerInfos within a single SignedData are not considered to be collaborating with regard to a particular content, unlike signers represented in distinct SignedData contents.  Thus, for the purposes of CCC processing, each SignerInfo is treated as if it were the only SignerInfo.  A content is considered valid if there is at least one valid CMS path employing one SignerInfo within each SignedData content.  Where collaboration is desired, usage of multiple SignedData contents is RECOMMENDED.
    
</p>
<p>
      Though not required by this specification, some applications may require successful processing of all or multiple SignerInfo elements within a single SignedData content.  There are number of potential ways of treating the evaluation process, including the following two possibilities:
    
</p>
<p>
      </p>
<blockquote class="text">
<p>- All signatures are meant to be collaborative:  In this case, the public keys associated with each SignerInfo are added to the cms_public_keys variable, the attributes from each SignerInfo are added to cms_effective_attributes variable and normal processing is performed.
</p>
<p>- All signatures are meant to be completely independent:  In this case, each of the SignerInfos is processed as if it were a fork in the CMS path construction process.  The application may require more than one CMS path to be valid in order to accept a content.
</p>
</blockquote><p>
    
</p>
<p>
      The exact processing will be a matter of application and local policy.  See <a class='info' href='#RFC5752'>[RFC5752]<span> (</span><span class='info'>Schaad, J. and S. Turner, &ldquo;Multiple Signatures in Cryptographic Message Syntax (CMS),&rdquo; December&nbsp;2009.</span><span>)</span></a> for an example of an attribute that requires processing multiple SignerInfo elements within a SignedData content.
    
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Collection of Attributes</h3>

<p>
  Attributes are collected from all authenticated nodes in a CMS path.  That is, attributes are not
  collected from content types that are unauthenticated, i.e., those that are not covered by a SignedData,
  AuthEnvelopedData, or AuthenticatedData layer.  Additionally, an
  application MAY specify a set of attributes that it has
  authenticated, perhaps from processing one or more content types that
  encapsulate a CMS-protected content.  Leaf node attributes MAY be
  checked independent of the CCC processing, but such processing is not addressed in this
  document.  Applications are free to perform further processing using all or some of the attributes returned from CCC processing.

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.3"></a><h3>4.1.3.&nbsp;
Leaf node classification</h3>

<p>
  The type of leaf node that terminates a CMS path determines the types of information that is returned and the type of processing that is performed.  There are two types of leaf nodes: encrypted leaf nodes and payload leaf nodes.

</p>
<p>
  A node in a CMS path is a leaf node if the content type of the node is not one of the following content types:

</p>
<p>
  </p>
<blockquote class="text">
<p>id-signedData (SignedData),
</p>
<p>id-digestedData (DigestedData),
</p>
<p>id-ct-authData (AuthenticatedData),
</p>
<p>id-ct-compressedData (CompressedData),
</p>
<p>id-ct-contentCollection (ContentCollection), and
</p>
<p>id-ct-contentWithAttrs (ContentWithAttributes).
</p>
</blockquote><p>

</p>
<p>
  A leaf node is an encrypted leaf node if the content type of the node is one of the following content types:

</p>
<p>
  </p>
<blockquote class="text">
<p>id-encryptedData (EncryptedData),
</p>
<p>id-envelopedData (EnvelopedData), and
</p>
<p>id-ct-authEnvelopedData (AuthEnvelopedData).
</p>
</blockquote><p>

</p>
<p>All other leaf nodes are payload leaf nodes, since no further CMS encapsulation can occur beyond that node.  However, specifications may define content types that provide protection similar to the CMS content types, may augment the lists of possible leaf and encrypted leaf nodes or may define some encrypted types as payload leaf nodes.
</p>
<p>
  When an encrypted leaf node is encountered, processing terminates and returns information that may be used as input when processing the decrypted contents.  Content type and constraints checking are only performed for payload leaf nodes.  When an encrypted leaf node terminates a CMS path, the attributes collected in cms_effective_attributes are returned along with the public key information collected in cms_public_keys.  When a payload leaf node terminates a CMS path, content type and constraint checking MUST be performed, as described in the next section.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Content Type and Constraint Checking</h3>

<p>Content type and constraint checking is performed when a payload leaf node is encountered.  This section does not apply to CMS paths that are terminated by an encrypted leaf node nor to 
  CMS paths that have no SignedData, AuthEnvelopedData, or AuthenticatedData nodes.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Inputs</h3>

<p>
    The inputs to content type and constraint checking are the values collected in cms_public_keys and cms_effective_attributes from a CMS path along with the payload leaf node that terminates the CMS path, as shown in the figure below.
  
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Inputs
+ leaf node
+ cms_public_keys
+ cms_effective_attributes
                 |
                 |
 ________________V_________________________________________
|                                                          |
| Content type and constraint checking                     |
|  (uses CCC-aware Certification Path Processor internally)|
|__________________________________________________________|
                 |
                 |
                 V
Outputs upon success
+ cms_constraints
+ cms_default_attributes
+ cms_effective_attributes

      Figure 7.  Content type and constraint checking

</pre></div>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Processing</h3>

<p>
    When a payload leaf node is encountered in a CMS path and a signed or
    authenticated content type is present in the CMS path, content type
    and constraint checking MUST be performed.  Content type and
    constraint checking need not be performed for CMS paths that do not
    contain at least one SignedData, AuthEnvelopedData, or
    AuthenticatedData content type.  The cms_effective_attributes and cms_public_keys variables are used to perform constraint checking.  Two additional state variables are used during the processing: cms_constraints and cms_default_attributes, both of which are initialized to empty.  The steps required to perform content type and constraint checking are below.
  
</p>
<p>For each public key in cms_public_keys, build and validate a certification path from a trust anchor to the public key, providing the content type of the payload leaf node and cms_effective_attributes as input.  Observe any limitations imposed by intermediate layers, e.g., where the ESSCertId attribute is used, the certificate identified by the attribute must serve as the target certificate here.
</p>
<p>
    </p>
<blockquote class="text">
<p>
        If path validation is successful, add the contents of subject_default_attributes to cms_default_attributes.  The subject_constraints variable returned from certification path validation will contain a single entry.  If the subject_constraints entry is equal to the special value anyContentType, content type and constraints checking succeeds.  If the subject_constraints entry is not equal to the special value anyContentType, for each entry in the attrConstraints field of the entry in subject_constraints,
        </p>
<blockquote class="text">
<p>If there is an entry in cms_constraints with the same attrType value, add the value from the attrValues entry to the entry in cms_constraints if that value does not already appear.
</p>
<p>
            If there is no entry in cms_constraints with the same attrType value, add a new entry to cms_constraints equal to the entry from the attrConstraints field.
          
</p>
</blockquote>
      

<p>If the value of canSource field of the entry in the subject_constraints variable for the public key used to verify the signature or MAC closest to the payload leaf node is set to cannotSource, constraints checking fails and the CMS path MUST be rejected.
</p>
</blockquote><p>
  
</p>
<p>If no valid certification path can be found, constraints checking fails and the CMS path MUST be rejected.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Outputs</h3>

<p>
    When a payload leaf node is encountered and content type and constraint
    checking succeeds, return cms_constraints, cms_default_attributes and
    cms_effective_attributes for use in leaf node payload processing.
  
</p>
<p>
    When an encrypted leaf node is encountered and constraint checking is not performed, return cms_public_keys and cms_effective_attributes for use in continued processing (as described in section 4.3.1).
  
</p>
<p>
    The cms_effective_attributes list may contain multiple instances of
    the same attribute type.  An instance of an attribute may contain multiple values.  Leaf node
    processing, which might take advantage of these effective attributes,
    needs to describe the proper handling of this situation.  Leaf node
    processing is described in other documents, and it is expected to be
    specific to a particular content type.
  
</p>
<p>
    The cms_default_attributes list may contain attributes with multiple
    values.  Payload processing, which might take advantage of these
    default attributes, needs to describe the proper handling of this
    situation.  Payload processing is described in other documents, and
    it is expected to be specific to a particular content type.
  
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Subordination Processing in TAMP</h3>

<p>
        TAMP <a class='info' href='#TAMP'>[TAMP]<span> (</span><span class='info'>Housley, R., Wallace, C., and S. Ashmore, &ldquo;Trust Anchor Management Protocol (TAMP),&rdquo; in progress.</span><span>)</span></a> does not define an authorization mechanism.  CCC can be used to authorize TAMP message signers and to delegate TAMP message signing authority.  TAMP requires trust anchors managed by a TAMP message signer to be subordinate to the signer.  This section describes subordination processing for CCC extensions of trust anchors contained in a TrustAnchorUpdate message where CCC is used to authorize TAMP messages.
      
</p>
<p>For a Trust Anchor Update message that is not signed with the apex trust anchor operational public key to be valid, the digital signature MUST be validated using a management trust anchor associated with the id-ct-TAMP-update content type, either directly or via an X.509 certification path originating with an authorized trust anchor.  The following subordination checks MUST also be performed as part of validation.
</p>
<p>
        Each Trust Anchor Update message contains one or more individual updates, each of which is used to add, modify or remove a trust anchor.  For each individual update the constraints of the TAMP message signer MUST be greater than or equal to the constraints of the trust anchor in the update.  The constraints of the TAMP message signer and the to-be-updated trust anchor are determined based on the applicable CMS Content Constraints. Specifically, the constraints of the TAMP message signer are determined as described in section 3 above passing the special value id-ct-anyContentType and an empty set of attributes as input; the constraints of the to-be-updated trust anchor are determined as described below.  If the constraints of a trust anchor in an update exceed the constraints of the signer, that update MUST be rejected.  Each update is considered and accepted or rejected individually without regard to other updates in the TAMP message. The constraints of the to-be-updated trust anchors are determined as follows:
      
</p>
<p>
        </p>
<ul class="text">
<li>If the to-be-updated trust anchor is the subject of an add operation, the constraints are read from the CMSContentConstraints extension of the corresponding trust anchor in the update.
</li>
<li>If the to-be-updated trust anchor is the subject of a remove operation, the trust anchor is located in the message recipient's trust anchor store using the public key included in the update.
</li>
<li>If the to-be-updated trust anchor is the subject of a change operation, the trust anchor has two distinct sets of constraints that MUST be checked.  The trust anchor's pre-change constraints are determined by locating the trust anchor in the message recipient's trust anchor store using the public key included in the update and reading the constraints from the CMSContentConstraints extension in the trust anchor.  The trust anchor's post-change constraints are read from the CMSContentConstraints extension of the corresponding TBSCertificateChangeInfo or the TrustAnchorChangeInfo in the update.  If the CMSContentConstraints extension is not present, then the trust anchor’s post-change constraints are equivalent to the trust anchor’s pre-change constraints.
</li>
</ul><p>
      
</p>
<p>The following steps can be used to determine if a Trust Anchor Update message signer is authorized to manage each to-be-updated trust anchor contained in a Trust Anchor Update message.
</p>
<p>
        </p>
<ul class="text">
<li>
            The TAMP message signer's CMS Content Constraints are determined as described in section 3 above passing the special value id-ct-anyContentType and an empty set of attributes as input.  The message signer MUST be authorized for the Trust Anchor Update message.  This can be confirmed using the steps described in section 4 above.
          
</li>
<li>
            The constraints of each to-be-updated trust anchor in the TAMP message MUST be checked against the message signer's constraints (represented in the message signer’s subject_constraints computed above) using the following steps.  For change operations, the following steps MUST be performed for the trust anchor's pre-change constraints and the trust anchor's post-change constraints.
            
<ul class="text">
<li>If the to-be-updated trust anchor is unconstrained, the message signer MUST also be unconstrained, i.e., the message signer’s subject_constraints MUST be set to the special value anyContentType.  If the to-be-updated trust anchor is unconstrained and the message signer is not, then the message signer is not authorized to manage the trust anchor and the update MUST be rejected.
</li>
<li>
                The message signer's authorization for each permitted content type MUST be checked using the state variables and procedures similar to those described in sections 3.2 and 3.3 above.  For each permitted content type in the to-be-updated trust anchor's constraints,
                
<ul class="text">
<li>Set cms_effective_attributes equal to the value of the attrConstraints field from the permitted content type.
</li>
<li>If the content type does not match an entry in the message signer’s subject_constraints, the message signer is not authorized to manage the trust anchor and the update MUST be rejected.  Note, the special value id-ct-anyContentType produces a match for all content types with the resulting matching entry containing the content type, canSource set to canSource and attrConstraints absent.
</li>
<li>If the content type matches an entry in the message signer’s subject_constraints, the canSource field of the entry is cannotSource and the canSource field in the to-be-updated trust anchor's privilege is canSource, the message signer is not authorized to manage the trust anchor and the update MUST be rejected.
</li>
<li>If the content type matches an entry in the message signer’s subject_constraints and the entry's attrConstraints field is present, then constraints MUST be checked.  For each attrType in the entry's attrConstraints, a corresponding attribute MUST be present in cms_effective_attributes containing values from the entry's attrConstraints.  If values appear in the corresponding attribute that are not in the entry's attrConstraints or if there is no corresponding attribute, the message signer is not authorized to manage the trust anchor and the update MUST be rejected.
</li>
</ul>
              
</li>
</ul>
          
</li>
</ul><p>
      
</p>
<p>Once these steps are completed, if the update has not been rejected, then the message signer is authorized to manage the to-be-updated trust anchor.
</p>
<p>Note that a management trust anchor that has only the id-ct-TAMP-update permitted content type is useful only for managing identity trust anchors.  It can sign a Trust Anchor Update message, but it cannot impact a management trust anchor that is associated with any other content type.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
  For any given certificate, multiple certification paths may exist,
  and each one can yield different results for CMS content constraints
  processing.  For example, default attributes can change when multiple certification paths exist as each path can potentially have different attribute requirements or default values.

</p>
<p>Compromise of a trust anchor private key permits unauthorized parties to generate signed messages that will be acceptable to all applications that use a trust anchor store containing the corresponding management trust anchor.  For example, if the trust anchor is authorized to sign firmware packages, then the unauthorized private key holder can generate firmware that may be successfully installed and used by applications that trust the management trust anchor.
</p>
<p>For implementations that support validation of TAMP messages using X.509 certificates, it is possible for the TAMP message signer to have more than one possible certification path that will authorize it to sign Trust Anchor Update messages, with each certification path resulting in different CMS Content Constraints.  The update is authorized if the processing below succeeds for any one certification path of the TAMP message signer.  The resulting subject_constraints variable is used to check each to-be-updated trust anchor contained in the update message.
</p>
<p>CMS does not provide a mechanism for indicating that an attribute applies to a particular content within a ContentCollection or a set CMS layers.  For sake of simplicity, this specification collects all attributes that appear in a CMS path.  These attributes are processed as part of CCC processing and are made available for use in processing leaf node contents.  This can result in collection of attributes that have no relationship with the leaf node contents.
</p>
<p>CMS does not provide a means for indicating what element within a CMS message an attribute applies to.  For example, a MessageDigest attribute included in a SignedData signedAttributes collection applies to a specific signature but a Firmware Package Identifier attribute appearing in the same list of attributes describes the encapsulated content.  As such, CCC treats all attributes as applying to the encapsulated content type.  Care should be taken to avoid provisioning trust anchors or certificates that include constraints on attribute types that are never used to describe a leaf content type, such as a MessageDigest attribute.
</p>
<p>
    The CMS Constraint Processing algorithm is designed to collect signer information for processing when all information for a CMS path is available.  In cases where the certification path discovered during SignedData layer processing is not acceptable, an alternative certification path may be discovered that is acceptable.  These alternatives may include an alternative signer certificate.  When the ESSCertId attribute is used, alternative signer certificates are not permitted.  The certificate referenced by ESSCertId must be used, possibly resulting in failure where alternative certificates would yield success.
  
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
There are no IANA considerations.  Please delete this section prior to RFC publication.

</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p>
        Thanks to Jim Schaad for thorough review and many suggestions.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="PKIXASN1">[PKIXASN1]</a></td>
<td class="author-text">Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for PKIX,&rdquo; in progress.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3274">[RFC3274]</a></td>
<td class="author-text">Gutmann, P., &ldquo;<a href="http://tools.ietf.org/html/rfc3274">Compressed Data Content Type for Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;3274, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3274.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4073">[RFC4073]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4073">Protecting Multiple Contents with the Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;4073, May&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4073.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5083">[RFC5083]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5083">Cryptographic Message Syntax (CMS) Authenticated-Enveloped-Data Content Type</a>,&rdquo; RFC&nbsp;5083, November&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5083.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5652">[RFC5652]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc5652">Cryptographic Message Syntax (CMS)</a>,&rdquo; RFC&nbsp;5652, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5652.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="SMIMEASN1">[SMIMEASN1]</a></td>
<td class="author-text">Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for SMIME,&rdquo; in progress.</td></tr>
<tr><td class="author-text" valign="top"><a name="X.208">[X.208]</a></td>
<td class="author-text">&ldquo;ITU-T Recommendation X.208 -
        Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</td></tr>
<tr><td class="author-text" valign="top"><a name="X.680">[X.680]</a></td>
<td class="author-text">&ldquo;ITU-T Recommendation X.680: Information Technology - Abstract Syntax Notation One,&rdquo; 2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="X.690">[X.690]</a></td>
<td class="author-text">&ldquo;ITU-T Recommendation X.690 Information Technology -
    ASN.1 encoding rules: Specification of Basic Encoding
    Rules (BER), Canonical Encoding Rules (CER) and
    Distinguished Encoding Rules (DER),&rdquo; 2002.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3161">[RFC3161]</a></td>
<td class="author-text">Adams, C., Cain, P., Pinkas, D., and R. Zuccherato, &ldquo;<a href="http://tools.ietf.org/html/rfc3161">Internet X.509 Public Key Infrastructure Time-Stamp Protocol (TSP)</a>,&rdquo; RFC&nbsp;3161, August&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3161.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4108">[RFC4108]</a></td>
<td class="author-text">Housley, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4108">Using Cryptographic Message Syntax (CMS) to Protect Firmware Packages</a>,&rdquo; RFC&nbsp;4108, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4108.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5035">[RFC5035]</a></td>
<td class="author-text">Schaad, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5035">Enhanced Security Services (ESS) Update: Adding CertID Algorithm Agility</a>,&rdquo; RFC&nbsp;5035, August&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5272">[RFC5272]</a></td>
<td class="author-text">Schaad, J. and M. Myers, &ldquo;<a href="http://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>,&rdquo; RFC&nbsp;5272, June&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5272.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5752">[RFC5752]</a></td>
<td class="author-text">Schaad, J. and S. Turner, &ldquo;Multiple Signatures in Cryptographic Message Syntax (CMS),&rdquo; December&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="TAF">[TAF]</a></td>
<td class="author-text">Housley, R., Wallace, C., and S. Ashmore, &ldquo;Trust Anchor Format,&rdquo; in progress.</td></tr>
<tr><td class="author-text" valign="top"><a name="TAMP">[TAMP]</a></td>
<td class="author-text">Housley, R., Wallace, C., and S. Ashmore, &ldquo;Trust Anchor Management Protocol (TAMP),&rdquo; in progress.</td></tr>
</table>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
ASN.1 Modules</h3>

<p>
Appendix A.1 provides the normative ASN.1 definitions for the structures described in this specification using ASN.1 as defined in <a class='info' href='#X.680'>[X.680]<span> (</span><span class='info'>, &ldquo;ITU-T Recommendation X.680: Information Technology - Abstract Syntax Notation One,&rdquo; 2002.</span><span>)</span></a>.  Appendix A.2 provides a module using ASN.1 as defined in <a class='info' href='#X.208'>[X.208]<span> (</span><span class='info'>, &ldquo;ITU-T Recommendation X.208 -         Specification of Abstract Syntax Notation One (ASN.1),&rdquo; 1988.</span><span>)</span></a>.  The module in A.2 removes usage of newer ASN.1 features that provide support for limiting the types of elements that may appear in certain SEQUENCE and SET constructions.  Otherwise, the modules are compatible in terms of encoded representation, i.e., the modules are bits-on-the-wire compatible aside from the limitations on SEQUENCE and SET constituents.  A.2 is included as a courtesy to developers using ASN.1 compilers that do not support current ASN.1.  A.1 references an ASN.1 module from <a class='info' href='#PKIXASN1'>[PKIXASN1]<span> (</span><span class='info'>Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for PKIX,&rdquo; in progress.</span><span>)</span></a> and <a class='info' href='#SMIMEASN1'>[SMIMEASN1]<span> (</span><span class='info'>Hoffman, P. and J. Schaad, &ldquo;New ASN.1 Modules for SMIME,&rdquo; in progress.</span><span>)</span></a>.

</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
ASN.1 Module Using 1993 Syntax</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CMSContentConstraintsCertExtn
{ iso(1) identified-organization(3) dod(6) internet(1) security(5)
mechanisms(5) pkix(7) id-mod(0) cmsContentConstr-93(42) }

DEFINITIONS IMPLICIT TAGS ::= BEGIN

IMPORTS
    EXTENSION, ATTRIBUTE
      FROM  -- from [PKIXASN1]
        PKIX-CommonTypes-2009
            {iso(1) identified-organization(3) dod(6) internet(1)
            security(5) mechanisms(5) pkix(7) id-mod(0)
            id-mod-pkixCommon-02(57)}

    CONTENT-TYPE, ContentSet, SignedAttributesSet, ContentType
    FROM  -- from [SMIMEASN1]
        CryptographicMessageSyntax-2009
            { iso(1) member-body(2) us(840) rsadsi(113549)
            pkcs(1) pkcs-9(9) smime(16) modules(0)
            id-mod-cms-2004-02(41) }
    ;

id-ct-anyContentType ContentType ::=
    { iso(1) member-body(2)
      us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
      ct(1) 0 }

ct-Any CONTENT-TYPE ::= {NULL IDENTIFIED BY id-ct-anyContentType }

--
--  Add this to CertExtensions in PKIX1Implicit-2009
--

ext-cmsContentConstraints EXTENSION ::= {
    SYNTAX         CMSContentConstraints
    IDENTIFIED BY  id-pe-cmsContentConstraints }

id-pe-cmsContentConstraints OBJECT IDENTIFIER ::=
    { iso(1) identified-organization(3) dod(6) internet(1)
      security(5) mechanisms(5) pkix(7) pe(1) 18 }

CMSContentConstraints ::= SEQUENCE SIZE (1..MAX) OF
                          ContentTypeConstraint

ContentTypeGeneration ::= ENUMERATED  {
    canSource,
    cannotSource}

ContentTypeConstraint ::= SEQUENCE {
    contentType           CONTENT-TYPE.&amp;id ({ContentSet|ct-Any,...}),
    canSource             ContentTypeGeneration DEFAULT canSource,
    attrConstraints       AttrConstraintList OPTIONAL }


Constraint { ATTRIBUTE:ConstraintList } ::= SEQUENCE {
    attrType           ATTRIBUTE.
            &amp;id({ConstraintList}),
    attrValues         SET SIZE (1..MAX) OF ATTRIBUTE.
            &amp;Type({ConstraintList}{@attrType})  }

SupportedConstraints ATTRIBUTE ::= {SignedAttributesSet, ... }

AttrConstraintList ::=
    SEQUENCE SIZE (1..MAX) OF Constraint {{ SupportedConstraints }}

END

</pre></div>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
ASN.1 Module Using 1988 Syntax</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

CMSContentConstraintsCertExtn-88
  { iso(1) identified-organization(3) dod(6) internet(1) security(5)
    mechanisms(5) pkix(7) id-mod(0) cmsContentConstr-88(41) }

DEFINITIONS IMPLICIT TAGS ::=
BEGIN

IMPORTS
    AttributeType, AttributeValue
      FROM PKIX1Explicit88 -- from [RFC5280]
        { iso(1) identified-organization(3) dod(6) internet(1)
          security(5) mechanisms(5) pkix(7) id-mod(0)
          id-pkix1-explicit(18) } ;

id-ct-anyContentType OBJECT IDENTIFIER ::=
    { iso(1) member-body(2)
      us(840) rsadsi(113549) pkcs(1) pkcs-9(9) smime(16)
      ct(1) 0}

-- Extension object identifier

id-pe-cmsContentConstraints OBJECT IDENTIFIER ::=
    { iso(1) identified-organization(3) dod(6) internet(1)
      security(5) mechanisms(5) pkix(7) pe(1) 18 }

-- CMS Content Constraints Extension

CMSContentConstraints ::= SEQUENCE SIZE (1..MAX) OF
                          ContentTypeConstraint

ContentTypeGeneration ::= ENUMERATED  {
    canSource,
    cannotSource}

ContentTypeConstraint ::= SEQUENCE {
    contentType           OBJECT IDENTIFIER,
    canSource             ContentTypeGeneration DEFAULT canSource,
    attrConstraints       AttrConstraintList OPTIONAL }

AttrConstraintList ::= SEQUENCE SIZE (1..MAX) OF AttrConstraint

AttrConstraint ::= SEQUENCE {
    attrType               AttributeType,
    attrValues             SET SIZE (1..MAX) OF AttributeValue }

END

</pre></div>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Russ Housley</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vigil Security, LLC</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">918 Spring Knoll Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Herndon, VA  20170</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:housley@vigilsec.com">housley@vigilsec.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sam Ashmore</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">National Security Agency</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 6751</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9800 Savage Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fort Meade, MD  20755</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:srashmo@radium.ncsc.mil">srashmo@radium.ncsc.mil</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Carl Wallace</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cygnacom Solutions</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 5200</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">7925 Jones Branch Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">McLean, VA  22102</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:cwallace@cygnacom.com">cwallace@cygnacom.com</a></td></tr>
</table>
</body></html>
