<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>A Usage of Resource Location and
   Discovery (RELOAD) for Public Switched Telephone Network (PSTN)
   Verification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="A Usage of Resource Location and
   Discovery (RELOAD) for Public Switched Telephone Network (PSTN)
   Verification">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">dispatch</td><td class="header">J. Rosenberg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">jdrosen.net</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">C. Jennings</td></tr>
<tr><td class="header">Expires:  September 9, 2010</td><td class="header">Cisco</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 08, 2010</td></tr>
</table></td></tr></table>
<h1><br />A Usage of Resource Location and
   Discovery (RELOAD) for Public Switched Telephone Network (PSTN)
   Verification<br />draft-rosenberg-dispatch-vipr-reload-usage-01</h1>

<h3>Abstract</h3>

<p>
	Verification Involving PSTN Reachability (ViPR) is a
     technique for inter-domain SIP federation. ViPR makes use of the
     RELOAD protocol to store unverified mappings from phone numbers
     to RELOAD nodes, with whom a validation process can be run. This
     document defines the usage of RELOAD for this purpose. 
	
</p>
<h3>Legal</h3>

<p>This documents and the information contained therein are provided on
     an "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
     OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
     THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS OR
     IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE
     INFORMATION THEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
     WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
ViPR Usage <br />
<a href="#anchor3">3.</a>&nbsp;
PeerID Shim<br />
<a href="#anchor4">4.</a>&nbsp;
Security Considerations<br />
<a href="#anchor5">5.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">6.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">6.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">6.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document relies heavily on the concepts and terminology defined
     in <a class='info' href='#I-D.rosenberg-dispatch-vipr-overview'>[I&#8209;D.rosenberg&#8209;dispatch&#8209;vipr&#8209;overview]<span> (</span><span class='info'>Rosenberg, J. and C. Jennings, &ldquo;Verification Involving PSTN          Reachability: Requirements and Architecture Overview,&rdquo; November&nbsp;2009.</span><span>)</span></a> and will
     not make sense if you have not read that document first. As it defines a
     usage for RELOAD<a class='info' href='#I-D.ietf-p2psip-base'>[I&#8209;D.ietf&#8209;p2psip&#8209;base]<span> (</span><span class='info'>Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;REsource LOcation And Discovery (RELOAD) Base Protocol,&rdquo; March&nbsp;2010.</span><span>)</span></a>, it assumes
     the reader is also familiar with that specification. The same DHT can
     also be used for a RELOAD SIP usage<a class='info' href='#I-D.ietf-p2psip-sip'>[I&#8209;D.ietf&#8209;p2psip&#8209;sip]<span> (</span><span class='info'>Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;A SIP Usage for RELOAD,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
ViPR Usage </h3>

<p>The ViPR usage defines details for how the DHT is used for ViPR
     operations. 
</p>
<p>The ViPR usage defines kind-id 0x00000001. This kind-id is a
     dictionary entry. Its resource ID is defined through a transformation
     which takes an E.164 based number, and computes a resourceID as the least
     significant 128 bits of the SHA1 hash of the following string:
     Cat(CHOICE(null, "COPY", "COPY2"), number) That is, the resource ID is the
     hash of a string which is the concatenation of the number, prefixed with
     nothing, or the words "COPY1" or "COPY2".
</p>
<p>For example, for number +17327662496:
</p>
<p>ResourceID= least128(SHA1("+17327662496"))
</p>
<p>or
</p>
<p>ResourceID = least128(SHA1("COPY1+7327662496"))
</p>
<p>or
</p>
<p>ResourceID = least128(SHA1("COPY2+7327662496"))
</p>
<p>The object stored at this resource ID is a dictionary entry, which
     uses data model 0x??. Object = {key,value} Here, the key is formed by
     taking the peerID of the storing node in hex format, without the "0x",
     appending a "+", followed by the VserviceID in hex format, without the
     "0x". For example, if a peer with peerID
</p>
<p>0x8h60f5gab753037g64ab6c53947fd532
</p>
<p>receives a Publish with a Vservice of
</p>
<p>0x7ggb6a7036478351
</p>
<p>The resulting key is:
</p>
<p>8h60f5gab753037g64ab6c53947fd532+7ggb6a7036478351
</p>
<p>Both parts of this key are important. Using the peerID of the node
     performing the store basically segments the keyspace of the dictionary
     so that no two peers every store using the same key. Indeed, the
     responsible node will verify the signature over the stored data and
     check the peerID against the value of the key, to make sure that a
     conflict does not take place. The usage of the Vservice allows for a
     single ViPR server to service multiple clusters, and to ensure that
     numbers published by one cluster (using one Vservice ID) do not clobber
     or step on numbers published by another cluster (using a different
     Vservice ID). The responsible node does not verify or check the
     VserviceID.
</p>
<p>When a node receives a Store operation for this usage, the data
     itself has a signature. The node responsible for storing the data must
     verify this signature; the certificate will always be included in the
     data and indicate which peerID is used. The responsible node must check
     that this peerID is included in the cert. If the signature verifies, the
     responsible node checks that the data model is a dictionary entry. The
     key must meet the format above. The responsible node must check that it
     is a 32 character sequence of numbers and letters a-f, followed by a +,
     followed by a 16 character sequence of numbers and letters a-f. If this
     checks, the key is split in half along the plus. The first 32 characters
     are considered a hex value and compared with the peerID used for the
     signature. If they match, it is good. Otherwise the Store is rejected.
     If they did match, next the responsible node checks the value. It must
     be a TLV as defined below, and must contain a peerID. The peerID must
     match that used for the signature. If they don't match, the Store is
     rejected. If they do match, the next step is a quota check.
</p>
<p>For each peer that the responsible node is storing data for, it must
     maintain a count of the number of unique dictionary entries being stored
     for that peerID. For each resourceID, each key constitutes a unique
     dictionary entry. So if a peer is storing 5 resource IDs, and at each of
     those 5, there are two keys whose first 32 bits correspond to a
     particular peerID, it means this node is currently storing 10 unique
     dictionary entries for that peerID.
</p>
<p>It takes the StorageQuota configuration parameter for this
     DHT, which measures the amount of numbers a particular node can
     store. That value is multiplied by nine (a 3x factor to account
     for the application-layer copies (COPY1 and COPY2), and another
     3x factor for replicas). Then, an addition 3x factor is added
     for rounding to make sure that the probability is low that a
     rejection occurs due to imperfect distribution of resourceIDs
     across the ring. (Open Issue: need to adjust this multiplier -
     basically birthday problem!) and then divided by the fraction of
     the hashspace owned by this ViPR server. If the result is less
     than one, it is rounded up to two. This is the max number of
     unique entries that can be stored for this storing peer ID. If
     the ViPR server is not yet storing this many entries for that
     peer ID, the store is allowed.
</p>
<p>The method for merging data after a partition follows the normal
     RELOAD rules around temporal ordering.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
PeerID Shim</h3>

<p>Because the ViPR implementation of RELOAD protocol makes use of the
     concept of multiple peerID on the same physical box, utilizing a single
     cert, the TLS handshakes alone are not sufficient to determine the
     entity on both sides of the TLS connection. As such, we will have a
     small "shim" type of protocol, which runs after TLS, but is not formally
     part of RELOAD.
</p>
<p>When a node initiates a TLS connection towards another node, after
     the TLS completes, it sends this message. The message contains the
     peerID associated with this connection. The recipient gets this, and
     sends back a similar message, containing its peerID. Both sides will
     verify that, the peerID sent by the other side, are amongst the peerIDs
     listed in the certificate. The connections are then stored in the
     connection tables, indexed by this peerID.
</p>
<p>Furthermore, if, after this exchange, a node determines that it
     already has a connection in its connection table with that peerID on the
     far side, the older connection is closed. This is actually a critical
     security function! Without this, a user could clone ViPR servers
     utilizing the same certs, and each one can join the network.
</p>
<p>Finally, once the exchange has taken place, the node compares the
     peerID from its peer with the current set of blacklisted peerID from the
     ACL that is distributed through the DHT. If the remote peerID appears on
     the list, the node closes the TCP/TLS connection immediately.
</p>
<p>The reason we are using a non-reload message for this, is that we
     need to be 100% sure that this never propagates. It is strictly over a
     single connection and should never be routed. Indeed, had we not had
     this idea of multiple peerID in a single cert, this would have
     effectively been accomplished through TLS. Alternatively, there is a TLS
     command for telling the other side who I expect them to be; however this
     is not implemented in older versions of OpenSSL, and so our shim forms
     an alternative to that which can be run on top of OpenSSL.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>TBD
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>TBD. Need to register items in IANA registries created by RELOAD.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-p2psip-base">[I-D.ietf-p2psip-base]</a></td>
<td class="author-text">Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-base-08.txt">REsource LOcation And Discovery (RELOAD) Base Protocol</a>,&rdquo; draft-ietf-p2psip-base-08 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-base-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.rosenberg-dispatch-vipr-overview">[I-D.rosenberg-dispatch-vipr-overview]</a></td>
<td class="author-text"><a href="mailto:jdrosen@jdrosen.net">Rosenberg, J.</a> and <a href="mailto:fluffy@cisco.com">C. Jennings</a>, &ldquo;Verification Involving PSTN
         Reachability: Requirements and Architecture Overview,&rdquo; November&nbsp;2009.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-p2psip-sip">[I-D.ietf-p2psip-sip]</a></td>
<td class="author-text">Jennings, C., Lowekamp, B., Rescorla, E., Baset, S., and H. Schulzrinne, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-sip-04.txt">A SIP Usage for RELOAD</a>,&rdquo; draft-ietf-p2psip-sip-04 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-p2psip-sip-04.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jonathan Rosenberg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">jdrosen.net</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Monmouth, NJ</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jdrosen@jdrosen.net">jdrosen@jdrosen.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.jdrosen.net">http://www.jdrosen.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cullen Jennings</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 421-9990</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fluffy@cisco.com">fluffy@cisco.com</a></td></tr>
</table>
</body></html>
