<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DHCPv4 lease query by Relay Agent Remote ID</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DHCPv4 lease query by Relay Agent Remote ID">
<meta name="keywords" content="DHCP">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DHC Working Group</td><td class="header">P. Kurapati</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Juniper Networks.</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc4388'>4388</a> (if&nbsp;approved)</td><td class="header">R. Desetti</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">B. Joshi</td></tr>
<tr><td class="header">Expires: June 6, 2011</td><td class="header">Infosys Technologies Ltd.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">December 3, 2010</td></tr>
</table></td></tr></table>
<h1><br />DHCPv4 lease query by Relay Agent Remote ID<br />draft-ietf-dhc-leasequery-by-remote-id-09.txt</h1>

<h3>Abstract</h3>

<p>
	Some Relay Agents extract lease information from the DHCP messages
   exchanged between the client and DHCP server. This lease information
   is used by relay agents for various purposes like antispoofing and
   prevention of flooding.  RFC 4388 defines a mechanism for relay
   agents to retrieve the lease information from the DHCP server 
   when this information is lost. The existing lease query mechanism is
   data driven, which means that a relay agent can initiate the
   lease query only when it starts receiving data from/to the clients.
   In certain scenarios, this model is not scalable. This document
   first looks at issues in existing mechanism and then proposes a new
   query type, query by Remote ID, to address these issues.


</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on June 6, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Motivation<br />
<a href="#anchor4">4.</a>&nbsp;
Protocol Details<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Sending the DHCPLEASEQUERY Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Responding to the DHCPLEASEQUERY Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Building a DHCPLEASEACTIVE or DHCPLEASEUNKNOWN message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.4.</a>&nbsp;
Determining the IP address to be used in response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.5.</a>&nbsp;
Sending a DHCPLEASEACTIVE or DHCPLEASEUNKNOWN Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">4.6.</a>&nbsp;
Receiving a  DHCPLEASEACTIVE or DHCPLEASEUNKNOWN Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">4.7.</a>&nbsp;
Receiving No Response to the DHCPLEASEQUERY Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">4.8.</a>&nbsp;
Lease Binding Data Storage Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.9.</a>&nbsp;
Using the DHCPLEASEQUERY Message with Multiple DHCP Servers<br />
<a href="#anchor14">5.</a>&nbsp;
RFC 4388 Considerations<br />
<a href="#anchor15">6.</a>&nbsp;
Security Considerations<br />
<a href="#anchor16">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor17">8.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative Reference<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative Reference<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
   DHCP relay agents snoop DHCP messages and append a relay agent
   information option before relaying them to the configured DHCP
   Server. In this process, some relay agents also glean the lease
   information sent by the server and maintain this locally. This
   information is used to prevent spoofing attempts from clients and
   also sometimes to install routing information. When a relay agent
   reboots, this information is lost. RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> has defined a
   mechanism to retrieve this lease information from the DHCP server.
   The existing query types defined by RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> are data-
   driven. When a client sends data upstream, the relay agent can query
   the server about the related lease information, based on the source
   MAC/IP address. These mechanisms do not scale well when there are
   thousands of clients connected to the relay agent. In the data
   driven model, lease query does not provide the full and consolidated
   active lease information associated with a given connection/circuit,
   which will result in inefficient anti-spoofing. The relay agent also
   has to contend with considerable resources for negative caching
   specially under spoofing attacks.


</p>
<p>
   We need a mechanism for a relay agent to retrieve the consolidated
   lease information for a given connection/circuit before upstream
   traffic is sent by the clients. 

</p><br /><hr class="insert" />
<a name="DSLAM as Relay Agent"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
           +--------+
           |  DHCP  |     +--------------+
           | Server |-...-|    DSLAM     |
           |        |     |  Relay Agent |
           +--------+     +--------------+
                             |        |
                         +------+   +------+
                         |Modem1|   |Modem2|
                         +------+   +------+
                            |        |    |
                         +-----+  +-----+ +-----+
                         |Node1|  |Node2| |Node3|
                         +-----+  +-----+ +-----+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
   For example, when a DSLAM (Digital Subscriber Line Access Multiplexer) acting
   as a Relay Agent is rebooted, it should query the server for the lease information 
   for all the connections/circuits. Also, as shown in the above figure, there
   could be multiple clients on one DSL circuit. The relay agent should
   get the lease information of all the clients connected to a DSL
   circuit. This is possible by introducing a new query type based on
   the Remote ID sub-option of the Relay Agent Information option. This
   document talks about the motivation for the new query type and the
   method to perform it.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<p>
   This document uses the following terms:

</p>
<ul class="text">
<li>
         "Access Concentrator"

</li>
</ul>
<p>
          An access concentrator is a router or switch at the broadband
          access provider's edge of a public broadband access network.
          This document assumes that the access concentrator includes
          the DHCP relay agent functionality.

</p>
<ul class="text">
<li>
        "DHCP client"

</li>
</ul>
<p>
          A DHCP client is an Internet node using DHCP to obtain
          configuration parameters such as a network address.

</p>
<ul class="text">
<li>
         "DHCP relay agent"

</li>
</ul>
<p>

          A DHCP relay agent is a third-party agent that transfers
          Bootstrap Protocol (BOOTP) and DHCP messages between clients
          and servers residing on different subnets, per RFC 951 <a class='info' href='#RFC951'>[RFC951]<span> (</span><span class='info'>Croft, B. and J. Gilmore, &ldquo;Bootstrap Protocol (BOOTP),&rdquo; September&nbsp;1985.</span><span>)</span></a>
	    and RFC 1542 <a class='info' href='#RFC1542'>[RFC1542]<span> (</span><span class='info'>Wimer, W., &ldquo;Clarifications and Extensions for the Bootstrap Protocol,&rdquo; October&nbsp;1993.</span><span>)</span></a>.

</p>
<ul class="text">
<li>
         "DHCP server"

</li>
</ul>
<p>

          A DHCP server is an Internet node that returns configuration
          parameters to DHCP clients.

</p>
<ul class="text">
<li>
	"Fast path"

</li>
</ul>
<p>
   Data transfer that happens through a Network Processor or an ASIC,
   which are programmed to forward the data at very high speeds.

</p>
<ul class="text">
<li>
	"Gleaning"

</li>
</ul>
<p>
     Gleaning is the extraction of location information from DHCP
     messages, as the messages are forwarded by the DHCP relay agent
     function.

</p>
<ul class="text">
<li>

        "Location information"

</li>
</ul>
<p>
          Location information is information needed by the access
          concentrator to forward traffic to a broadband-accessible
          node.  This information includes knowledge of the node's
          hardware address, the port or virtual circuit that leads to
          the node, and/or the hardware address of the intervening
          subscriber modem.

</p>
<ul class="text">
<li>
         "MAC address"

</li>
</ul>
<p>

          In the context of a DHCP packet, a MAC address consists of the
          following fields: hardware type "htype", hardware length
          "hlen", and client hardware address "chaddr".

</p>
<ul class="text">
<li>
	"Slow path"

</li>
</ul>
<p>
	Data transfer that happens through the control plane. This 
	has very limited buffers to store data and the speeds are very low 
	compared to the fast path data transfer.

</p>
<ul class="text">
<li>

         "Upstream"

</li>
</ul>
<p>
          Upstream is the direction from the broadband subscriber
          towards the access concentrator.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Motivation</h3>

<p>
   Consider an access concentrator (e.g., DSLAM) working also as
   a DHCP relay agent. A "Fast path" and a "slow path" generally exist
   in most networking boxes. Fast path processing is done in a network
   processor or an ASIC (Application Specific Integrated Circuit). Slow
   path processing is done in a normal processor. As much as possible,
   regular data forwarding should be done in the fast path. Slow path
   processing should be reduced as it may become a bottleneck.

</p>
<p>
   For an access concentrator having multiple access ports, multiple IP
   addresses may be assigned using DHCP to a single port and the number
   of clients on a port may be unknown. The access concentrator may
   also not know the network portions of the IP addresses that are
   assigned to its DHCP clients.

</p>
<p>
   The access concentrator gleans IP address or other information from
   DHCP negotiations for antispoofing and other purposes. The
   antispoofing itself is done in the fast path. The access
   concentrator keeps track of only one list of IP addresses: list of IP
   addresses that are assigned by the DHCP servers; upstream traffic
   from all other IP addresses is dropped.  If a client starts its data
   transfer after its DHCP negotiations have been gleaned by the access
   concentrator, no legitimate packets will be dropped because of
   antispoofing. In other words, antispoofing is effective (no
   legitimate packets are dropped and all spoofed packets are dropped)
   and efficient (antispoofing is done in the fast path). The intention
   is to achieve similar effective and efficient antispoofing in the
   lease query scenario also when an access concentrator loses its
   gleaned information (for example, because of a reboot).

</p>
<p>
   After a deep analysis, we found that the three existing query types
   supported by RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> do not provide effective and efficient
   antispoofing for the above scenario and a new mechanism is required.

</p>
<p>
The existing query types

</p>
<ul class="text">
<li>
      necessitate a data-driven approach: the lease queries can only be
      performed when the access concentrator receives data. This
      results in increased outage time for clients

</li>
<li>
      results in excessive negative caching, consuming a lot of resources
      under a spoofing attack

</li>
<li>
      results in antispoofing being done in the slow path instead of the
      fast path

</li>
</ul>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Protocol Details</h3>

<p> 
   This section talks about the protocol details for query by Remote ID.
   Most of the message handling is similar to RFC 4388 [RFC4388] and
   this section highlights only the differences. Readers are advised to
   go through RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> before going through this section for
   complete understanding of the protocol.

</p>
<p> When used in this document, the unqualified term "DHCPLEASEQUERY"
   indicates a lease query by Remote ID, unless otherwise specified.

</p>
<p>
   RFC 3046 <a class='info' href='#RFC3046'>[RFC3046]<span> (</span><span class='info'>Patrick, M., &ldquo;DHCP Relay Agent Information Option,&rdquo; January&nbsp;2001.</span><span>)</span></a> defines two sub-options for the Relay Agent
   Information option. Sub-option 1 corresponds to the Circuit ID that
   identifies the local circuit of the access concentrator. This sub-option is 
   unique to the relay agent. Sub-option 2 corresponds to the Remote ID that 
   identifies the remote node connected to the access concentrator. The Remote ID
   is globally unique in the network and is configured per circuit/connection 
   in the relay agent. 

</p>
<p>
   This document defines a new query type based on the Remote ID sub-option. 
   Suppose that the access concentrator (e.g., DSLAM) lost the lease information 
   when it was rebooted. When the access concentrator comes up, it initiates
   (for each connection/circuit) a DHCP lease query by Remote ID as defined in 
   this section. For this query, the requester supplies an option 82 that includes 
   only a Remote ID sub-option in the DHCPLEASEQUERY message. The Remote ID is 
   normally pre-provisioned in the access concentrator per circuit/connection
   and hence the same will remain available to the access concentrator after reboot.

</p>
<p>
   The DHCP server MUST reply with a DHCPLEASEACTIVE message if there is
   an active lease corresponding to the Remote ID that is present in the
   DHCPLEASEQUERY message. Otherwise, the server MUST reply with a
   DHCPLEASEUNKNOWN message. Servers that do not implement DHCP lease
   query based on Remote ID SHOULD simply not respond.


</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Sending the DHCPLEASEQUERY Message</h3>

<p>

   The lease query defined in this document will mostly be used by access concentrators, 
   but it may also be used by other authorized elements in the network. 
   The DHCPLEASEQUERY message uses the DHCP message format as described in RFC 2131 <a class='info' href='#RFC2131'>[RFC2131]<span> (</span><span class='info'>Droms, R., &ldquo;Dynamic Host Configuration Protocol,&rdquo; March&nbsp;1997.</span><span>)</span></a>, 
   and uses message number 10 in the DHCP Message Type option (option 53). The DHCPLEASEQUERY
   message has the following pertinent message contents:

</p>
<ul class="text">
<li>

      There MUST be a Relay Agent Information option (option 82) with
	only a Remote ID sub-option (sub-option 2) in the DHCPLEASEQUERY
	message.

</li>
<li>
      The Parameter Request List option <a class='info' href='#RFC2132'>[RFC2132]<span> (</span><span class='info'>Droms, R. and S. Alexander, &ldquo;DHCP Options and BOOTP Vendor Extensions,&rdquo; March&nbsp;1997.</span><span>)</span></a> MUST be 
      populated by the access concentrator with the Associated-IP option code.
      The giaddr field and other option codes listed in Parameter Request List 
      option are set as explained in section 6.2 of RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.


</li>
<li>
        The ciaddr field MUST be set to zero.

</li>
<li>
        The values of htype, hlen, and chaddr MUST be set to zero.

</li>
<li>
        The Client Identifier option (option 61) MUST NOT appear in the
        packet.

</li>
</ul>
<p>
   The DHCPLEASEQUERY message SHOULD be sent to a DHCP server that is
   known to possess authoritative information concerning the Remote ID.
   The DHCPLEASEQUERY message MAY be sent to more than one DHCP server,
   and in the absence of information concerning which DHCP server might
   possess authoritative information concerning the Remote ID, it SHOULD
   be sent to all DHCP servers configured for the associated relay agent
   (if any are known).

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Responding to the DHCPLEASEQUERY Message</h3>

<p>

   There are two possible responses to a DHCPLEASEQUERY message:

</p>
<ul class="text">
<li>
       DHCPLEASEUNKNOWN

</li>
</ul>
<p>
   The DHCPLEASEUNKNOWN message indicates that the client associated with
   the Remote ID suboption of the DHCPLEASEQUERY message is not
   allocated any lease or it is not managed by the server. 

</p>
<ul class="text">
<li>
       DHCPLEASEACTIVE

</li>
</ul>
<p>
   The DHCPLEASEACTIVE message indicates that the server not only knows
   the client specified in the DHCPLEASEQUERY message, but also knows
   that there is an active lease for that client.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Building a DHCPLEASEACTIVE or DHCPLEASEUNKNOWN message</h3>

<p>
   A DHCPLEASEACTIVE message is built by populating information
   pertaining to the client associated with the IP address specified in
   the ciaddr field. 

</p>
<p>
   In the case where more than one IP address has been involved in a
   DHCP message exchange with the client specified by the Remote ID,
   then the list of all those IP addresses MUST be returned in the
   Associated-IP option, whether or not that option was requested as
   part of the Parameter Request List option. This is intended for
   maintaining backwards compatibility with RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.

</p>
<p>
   All other options specified in the Parameter Request List <a class='info' href='#RFC2132'>[RFC2132]<span> (</span><span class='info'>Droms, R. and S. Alexander, &ldquo;DHCP Options and BOOTP Vendor Extensions,&rdquo; March&nbsp;1997.</span><span>)</span></a>
   are processed as mentioned in section 6.4.2 of RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.

</p>
<p>
   In a DHCPLEASEUNKNOWN response message, the DHCP server MUST echo the
   Option 82 received in the DHCPLEASEQUERY message. No other option
   is included in the message. 

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Determining the IP address to be used in response</h3>

<p>
   The IP address placed in the ciaddr field of a DHCPLEASEACTIVE
   message MUST be the IP address with the latest 
   client-last-transaction-time associated with the client described by the Remote
   ID specified in the DHCPLEASEQUERY message.

</p>
<p>
   If there is only a single IP address that fulfills this criteria,
   then it MUST be placed in the ciaddr field of the DHCPLEASEACTIVE
   message.

</p>
<p>
   In the case where more than one IP address has been accessed by the
   client specified by the Remote ID, then the DHCP server MUST return
   the IP address returned to the client in the most recent transaction
   with the client unless the DHCP server has been configured by the
   server administrator to use some other preference mechanism.


</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Sending a DHCPLEASEACTIVE or DHCPLEASEUNKNOWN Message</h3>

<p>
   The server unicasts the DHCPLEASEACTIVE or DHCPLEASEUNKNOWN message
   to the address specified in the giaddr field of the DHCPLEASEQUERY
   message.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Receiving a  DHCPLEASEACTIVE or DHCPLEASEUNKNOWN Message</h3>

<p>

   When a DHCPLEASEACTIVE message is received in response to the
   DHCPLEASEQUERY message, it means that there is currently an active
   lease associated with the Remote ID in the DHCP server.  The access
   concentrator SHOULD use the information in the htype, hlen, and
   chaddr fields of the DHCPLEASEACTIVE as well as the Relay Agent
   Information option included in the packet to refresh its location
   information for this IP address.  An access concentrator is likely to
   query by IP address for all the IP addresses specified in the
   Associated-IP option in the response, if any, at this point in time.


</p>
<p>
   When a DHCPLEASEUNKNOWN message is received by an access concentrator
   that had sent out a DHCPLEASEQUERY message, it means that the DHCP
   server does not have definitive information concerning the DHCP
   client specified in the Remote ID sub-option of the DHCPLEASEQUERY
   message.  The access concentrator MAY store this information for
   future use.  However, another DHCPLEASEQUERY message to the same DHCP
   server SHOULD NOT be attempted with the same Remote ID sub-option. 

</p>
<p>
   For lease query by Remote ID, the impact of negative caching is
   greatly reduced as the response leads to "definitive" information on
   all the nodes connected behind the connection.  Note that in case of
   the data-driven approach <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>, a node spoofing several IP
   addresses can lead to negative caching of greater magnitude.  Another
   important change that this draft brings is the removal of periodic
   lease queries generated from negative caching caused by
   DHCPLEASEUNKNOWN.  Since the information obtained through query by
   Remote ID is complete, there is no need of attempting lease query
   again for the same connection.   


</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Receiving No Response to the DHCPLEASEQUERY Message</h3>

<p>

   The condition of an access concentrator receiving no response to a
   DHCPLEASEQUERY message is handled in the same manner as
   suggested in RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.

</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Lease Binding Data Storage Requirements</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Implementation Note:
</pre></div>
<p>
	To generate replies for a lease query by Remote ID efficiently, a
   DHCP server should index the lease binding data structures using
   Remote ID.

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.9"></a><h3>4.9.&nbsp;
Using the DHCPLEASEQUERY Message with Multiple DHCP Servers</h3>

<p>

	This scenario is handled in the same way it is done in RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
RFC 4388 Considerations</h3>

<p>
   This document is compatible with RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> based
   implementations, which means that a client that supports this
   extension can work with a server not supporting this document,
   provided it uses RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> defined query types.  Also, a
   server supporting this document can work with a client not supporting
   this query type.  However, there are some changes that this document
   proposes with respect to RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>. Implementers extending
   RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> implementations to support this document should
   take note of the following points:

</p>
<ul class="text">
<li>
There may be cases where a query by IP address/MAC address/Client
      Identifier has an option 82 containing Remote ID.  In that case,
      the query will still be recognized as query by IP address/MAC
      address/Client Identifier as specified by RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.

</li>
<li>
Section 6.4 of RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> suggests that a DHCPLEASEUNKNOWN
      MUST NOT have any other option present.  But for a query by Remote
      ID, option 82 MUST be present in the reply.


</li>
</ul>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
This document inherits the security concerns present in the
original lease query protocol RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a> specifications.

</p>
<p>	
This specification introduces one additional issue, beyond those described in 
RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>. A query by remote-id will result in the server
replying with a consolidated lease binding information. Such a query, if done from an 
unauthorized source may lead to leak of lease binding information. It is critical to 
deploy authentication techniques mentioned in RFC 3118 <a class='info' href='#RFC3118'>[RFC3118]<span> (</span><span class='info'>Droms, R. and W. Arbaugh, &ldquo;Authentication for DHCP Messages,&rdquo; June&nbsp;2001.</span><span>)</span></a> to prevent
such unauthorized lease queries.

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
	This document does not introduce any new namespaces for the IANA to manage.

</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p>
Copious amounts of text in this document are derived from RFC 4388 <a class='info' href='#RFC4388'>[RFC4388]<span> (</span><span class='info'>Woundy, R. and K. Kinnear, &ldquo;Dynamic Host Configuration Protocol (DHCP) Leasequery,&rdquo; February&nbsp;2006.</span><span>)</span></a>.
Kim Kinnear, Damien Neil, Stephen Jacob, Ted Lemon, Ralph Droms and Alfred Hoenes provided 
valuable feedback on this document.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative Reference</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4388">[RFC4388]</a></td>
<td class="author-text">Woundy, R. and K. Kinnear, &ldquo;<a href="http://tools.ietf.org/html/rfc4388">Dynamic Host Configuration Protocol (DHCP) Leasequery</a>,&rdquo; RFC&nbsp;4388, February&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2131">[RFC2131]</a></td>
<td class="author-text">Droms, R., &ldquo;<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>,&rdquo; RFC&nbsp;2131, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2132">[RFC2132]</a></td>
<td class="author-text">Droms, R. and S. Alexander, &ldquo;<a href="http://tools.ietf.org/html/rfc2132">DHCP Options and BOOTP Vendor Extensions</a>,&rdquo; RFC&nbsp;2132, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3046">[RFC3046]</a></td>
<td class="author-text">Patrick, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3046">DHCP Relay Agent Information Option</a>,&rdquo; RFC&nbsp;3046, January&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3118">[RFC3118]</a></td>
<td class="author-text">Droms, R. and W. Arbaugh, &ldquo;<a href="http://tools.ietf.org/html/rfc3118">Authentication for DHCP Messages</a>,&rdquo; RFC&nbsp;3118, June&nbsp;2001.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative Reference</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC951">[RFC951]</a></td>
<td class="author-text">Croft, B. and J. Gilmore, &ldquo;<a href="http://tools.ietf.org/html/rfc951">Bootstrap Protocol (BOOTP)</a>,&rdquo; RFC&nbsp;951, September&nbsp;1985.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1542">[RFC1542]</a></td>
<td class="author-text">Wimer, W., &ldquo;<a href="http://tools.ietf.org/html/rfc1542">Clarifications and Extensions for the Bootstrap Protocol</a>,&rdquo; RFC&nbsp;1542, October&nbsp;1993.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pavan Kurapati</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Juniper Networks.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Embassy Prime Buildings, C.V.Raman Nagar</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bangalore  560 093</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">India</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kurapati@juniper.net">kurapati@juniper.net</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.juniper.net/">http://www.juniper.net/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">D.T.V Ramakrishna Rao</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Infosys Technologies Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">44 Electronics City, Hosur Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bangalore  560 100</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">India</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ramakrishnadtv@infosys.com">ramakrishnadtv@infosys.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.infosys.com/">http://www.infosys.com/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bharat Joshi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Infosys Technologies Ltd.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">44 Electronics City, Hosur Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bangalore  560 100</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">India</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:bharat_joshi@infosys.com">bharat_joshi@infosys.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.infosys.com/">http://www.infosys.com/</a></td></tr>
</table>
</body></html>
