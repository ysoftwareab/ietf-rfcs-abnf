<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Protocol for Access Node Control Mechanism in Broadband Networks</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Historical Note">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Requirements Language">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2  Broadband Access Aggregation">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 ATM-based Broadband Aggregation">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Ethernet-Based Broadband Aggregation">
<link href="#rfc.section.3" rel="Chapter" title="3 Access Node Control Protocol -- General Aspects">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Protocol Version">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 ANCP Transport">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Encoding of Text Fields">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Treatment of Reserved and Unused Fields">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 The ANCP Adjacency Protocol">
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 ANCP Adjacency Message Format">
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 ANCP Adjacency Procedures">
<link href="#rfc.section.3.5.2.1" rel="Chapter" title="3.5.2.1 Overview">
<link href="#rfc.section.3.5.2.2" rel="Chapter" title="3.5.2.2 Adjacency Protocol State Machine">
<link href="#rfc.section.3.5.2.2.1" rel="Chapter" title="3.5.2.2.1 State Tables">
<link href="#rfc.section.3.5.2.3" rel="Chapter" title="3.5.2.3 The Adjacency Protocol SYN Message">
<link href="#rfc.section.3.5.2.3.1" rel="Chapter" title="3.5.2.3.1 Action By the Sender">
<link href="#rfc.section.3.5.2.3.2" rel="Chapter" title="3.5.2.3.2 Action By the Receiver">
<link href="#rfc.section.3.5.2.4" rel="Chapter" title="3.5.2.4 The Adjacency Protocol SYNACK Message">
<link href="#rfc.section.3.5.2.4.1" rel="Chapter" title="3.5.2.4.1 Action By the Sender">
<link href="#rfc.section.3.5.2.4.2" rel="Chapter" title="3.5.2.4.2 Action By the Receiver">
<link href="#rfc.section.3.5.2.5" rel="Chapter" title="3.5.2.5 The Adjacency Protocol ACK Message">
<link href="#rfc.section.3.5.2.5.1" rel="Chapter" title="3.5.2.5.1 Actions By the Sender">
<link href="#rfc.section.3.5.2.5.2" rel="Chapter" title="3.5.2.5.2 Actions By the Receiver">
<link href="#rfc.section.3.5.2.6" rel="Chapter" title="3.5.2.6 The Adjacency Protocol RSTACK Message">
<link href="#rfc.section.3.5.2.6.1" rel="Chapter" title="3.5.2.6.1 Action By the Sender">
<link href="#rfc.section.3.5.2.6.2" rel="Chapter" title="3.5.2.6.2 Action By the Receiver">
<link href="#rfc.section.3.5.2.7" rel="Chapter" title="3.5.2.7 Loss of Contact or Synchronization">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 ANCP General Message Formats">
<link href="#rfc.section.3.6.1" rel="Chapter" title="3.6.1 The ANCP Message Header">
<link href="#rfc.section.3.6.1.1" rel="Chapter" title="3.6.1.1 Version Field (8 bits)">
<link href="#rfc.section.3.6.1.2" rel="Chapter" title="3.6.1.2 Message Type Field (8 bits)">
<link href="#rfc.section.3.6.1.3" rel="Chapter" title="3.6.1.3 Result Field (4 bits)">
<link href="#rfc.section.3.6.1.4" rel="Chapter" title="3.6.1.4 Result Code Field (12 bits)">
<link href="#rfc.section.3.6.1.5" rel="Chapter" title="3.6.1.5 Partition ID (8 bits)">
<link href="#rfc.section.3.6.1.6" rel="Chapter" title="3.6.1.6 Transaction ID (24 bits)">
<link href="#rfc.section.3.6.1.7" rel="Chapter" title="3.6.1.7 I flag and SubMessage Number (1 + 15 bits)">
<link href="#rfc.section.3.6.1.8" rel="Chapter" title="3.6.1.8 Length (16 bits)">
<link href="#rfc.section.3.6.2" rel="Chapter" title="3.6.2 The ANCP Message Body">
<link href="#rfc.section.3.7" rel="Chapter" title="3.7 General Principles for the Design of ANCP Messages">
<link href="#rfc.section.4" rel="Chapter" title="4 Generally Useful ANCP Messages and TLVs">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Provisioning Message">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Generic Response Message">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Target TLV">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4  Command TLV">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Status-Info TLV">
<link href="#rfc.section.5" rel="Chapter" title="5 Introduction To ANCP Capabilities For Digital Subscriber Lines (DSL)">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 DSL Access Line Identification">
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 Control Context (Informative)">
<link href="#rfc.section.5.1.2" rel="Chapter" title="5.1.2 TLVs For DSL Access Line Identification">
<link href="#rfc.section.5.1.2.1" rel="Chapter" title="5.1.2.1 Access-Loop-Circuit-ID TLV">
<link href="#rfc.section.5.1.2.2" rel="Chapter" title="5.1.2.2 Access-Loop-Remote-Id TLV">
<link href="#rfc.section.5.1.2.3" rel="Chapter" title="5.1.2.3 Access-Aggregation-Circuit-ID-Binary TLV">
<link href="#rfc.section.5.1.2.4" rel="Chapter" title="5.1.2.4 Access-Aggregation-Circuit-ID-ASCII TLV">
<link href="#rfc.section.6" rel="Chapter" title="6 ANCP Based DSL Topology Discovery">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Control Context (Informative)">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Protocol Requirements">
<link href="#rfc.section.6.2.1" rel="Chapter" title="6.2.1 Protocol Requirements On the AN Side">
<link href="#rfc.section.6.2.2" rel="Chapter" title="6.2.2 Protocol Requirements On the NAS Side">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 ANCP Port UP and Port DOWN Event Message Descriptions">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Procedures">
<link href="#rfc.section.6.4.1" rel="Chapter" title="6.4.1 Procedures On the AN Side">
<link href="#rfc.section.6.4.2" rel="Chapter" title="6.4.2 Procedures On the NAS Side">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 TLVs For DSL Line Attributes">
<link href="#rfc.section.6.5.1" rel="Chapter" title="6.5.1 DSL-Line-Attributes TLV">
<link href="#rfc.section.6.5.2" rel="Chapter" title="6.5.2 DSL-Type TLV">
<link href="#rfc.section.6.5.3" rel="Chapter" title="6.5.3 Actual-Net-Data-Rate-Upstream TLV">
<link href="#rfc.section.6.5.4" rel="Chapter" title="6.5.4 Actual-Net-Data-Rate-Downstream TLV">
<link href="#rfc.section.6.5.5" rel="Chapter" title="6.5.5 Minimum-Net-Data-Rate-Upstream TLV">
<link href="#rfc.section.6.5.6" rel="Chapter" title="6.5.6 Minimum-Net-Data-Rate-Downstream TLV">
<link href="#rfc.section.6.5.7" rel="Chapter" title="6.5.7 Attainable-Net-Data-Rate-Upstream TLV">
<link href="#rfc.section.6.5.8" rel="Chapter" title="6.5.8 Attainable-Net-Data-Rate-Downstream TLV">
<link href="#rfc.section.6.5.9" rel="Chapter" title="6.5.9 Maximum-Net-Data-Rate-Upstream TLV">
<link href="#rfc.section.6.5.10" rel="Chapter" title="6.5.10 Maximum-Net-Data-Rate-Downstream TLV">
<link href="#rfc.section.6.5.11" rel="Chapter" title="6.5.11 Minimum-Net-Low-Power-Data-Rate-Upstream TLV">
<link href="#rfc.section.6.5.12" rel="Chapter" title="6.5.12 Minimum-Net-Low-Power-Data-Rate-Downstream TLV">
<link href="#rfc.section.6.5.13" rel="Chapter" title="6.5.13 Maximum-Interleaving-Delay-Upstream TLV">
<link href="#rfc.section.6.5.14" rel="Chapter" title="6.5.14 Actual-Interleaving-Delay-Upstream TLV">
<link href="#rfc.section.6.5.15" rel="Chapter" title="6.5.15 Maximum-Interleaving-Delay-Downstream TLV">
<link href="#rfc.section.6.5.16" rel="Chapter" title="6.5.16 Actual-Interleaving-Delay-Downstream">
<link href="#rfc.section.6.5.17" rel="Chapter" title="6.5.17 DSL-Line-State TLV">
<link href="#rfc.section.6.5.18" rel="Chapter" title="6.5.18 Access-Loop-Encapsulation TLV">
<link href="#rfc.section.7" rel="Chapter" title="7 ANCP based DSL Line Configuration ">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Control Context (Informative)">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Protocol Requirements">
<link href="#rfc.section.7.2.1" rel="Chapter" title="7.2.1 Protocol Requirements On the NAS Side">
<link href="#rfc.section.7.2.2" rel="Chapter" title="7.2.2 Protocol Requirements On the AN Side">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 ANCP Port Management (Line Configuration) Message Format">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Procedures">
<link href="#rfc.section.7.4.1" rel="Chapter" title="7.4.1 Procedures On the NAS Side">
<link href="#rfc.section.7.4.2" rel="Chapter" title="7.4.2 Procedures On the AN Side">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 TLVs For DSL Line Configuration">
<link href="#rfc.section.7.5.1" rel="Chapter" title="7.5.1 Service-Profile-Name TLV">
<link href="#rfc.section.8" rel="Chapter" title="8 ANCP-Based DSL Remote Line Connectivity Testing">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Control Context (Informative)">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Protocol Requirements">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 Protocol Requirements On the NAS Side">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 Protocol Requirements On the AN Side">
<link href="#rfc.section.8.3" rel="Chapter" title="8.3 Port Management (OAM) Message Format">
<link href="#rfc.section.8.4" rel="Chapter" title="8.4 Procedures">
<link href="#rfc.section.8.4.1" rel="Chapter" title="8.4.1 NAS-Side Procedures">
<link href="#rfc.section.8.4.2" rel="Chapter" title="8.4.2 AN-Side Procedures">
<link href="#rfc.section.8.5" rel="Chapter" title="8.5 TLVs For the DSL Line Remote Connectivity Testing Capability">
<link href="#rfc.section.8.5.1" rel="Chapter" title="8.5.1 OAM-Loopback-Test-Parameters TLV">
<link href="#rfc.section.8.5.2" rel="Chapter" title="8.5.2 Opaque-Data TLV">
<link href="#rfc.section.8.5.3" rel="Chapter" title="8.5.3 OAM-Loopback-Test-Response-String TLV">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Summary">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 IANA Actions">
<link href="#rfc.section.9.2.1" rel="Chapter" title="9.2.1 ANCP Message Type Registry">
<link href="#rfc.section.9.2.2" rel="Chapter" title="9.2.2 ANCP Result Code Registry">
<link href="#rfc.section.9.2.3" rel="Chapter" title="9.2.3 ANCP Port Management Function Registry">
<link href="#rfc.section.9.2.4" rel="Chapter" title="9.2.4 ANCP Technology Type Registry">
<link href="#rfc.section.9.2.5" rel="Chapter" title="9.2.5 ANCP Command Code Registry">
<link href="#rfc.section.9.2.6" rel="Chapter" title="9.2.6 ANCP TLV Type Registry">
<link href="#rfc.section.9.2.7" rel="Chapter" title="9.2.7 ANCP Capability Type Registry">
<link href="#rfc.section.9.2.8" rel="Chapter" title="9.2.8 Joint GSMP / ANCP Version Registry">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the Access Node Control Protocol (ANCP).  ANCP operates between a Network Access Server (NAS) and an Access Node (e.g., a Digital Subscriber Line Access Multiplexer (DSLAM)) in a multi-service reference architecture in order to perform QoS-related, service-related and subscriber-related operations. Use cases for ANCP are documented in RFC 5851. As well as describing the base ANCP protocol, this document specifies capabilities for Digital Subscriber Line (DSL) topology discovery, line configuration, and remote line connectivity testing. The design of ANCP allows for protocol extensions in other documents if they are needed to support other use cases and other access technologies. " />
  <meta name="description" content="This document describes the Access Node Control Protocol (ANCP).  ANCP operates between a Network Access Server (NAS) and an Access Node (e.g., a Digital Subscriber Line Access Multiplexer (DSLAM)) in a multi-service reference architecture in order to perform QoS-related, service-related and subscriber-related operations. Use cases for ANCP are documented in RFC 5851. As well as describing the base ANCP protocol, this document specifies capabilities for Digital Subscriber Line (DSL) topology discovery, line configuration, and remote line connectivity testing. The design of ANCP allows for protocol extensions in other documents if they are needed to support other use cases and other access technologies. " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">S.  Wadhwa</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">J. Moisand</td>
</tr>
<tr>
<td class="left">Expires: October 21, 2011</td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T.  Haag</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Deutsche Telekom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">N. Voigt</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Nokia Siemens Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T. Taylor, Ed.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei Technologies</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">April 19, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Protocol for Access Node Control Mechanism in Broadband Networks<br />
  <span class="filename">draft-ietf-ancp-protocol-16</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the Access Node Control Protocol (ANCP).  ANCP operates between a Network Access Server (NAS) and an Access Node (e.g., a Digital Subscriber Line Access Multiplexer (DSLAM)) in a multi-service reference architecture in order to perform QoS-related, service-related and subscriber-related operations. Use cases for ANCP are documented in RFC 5851. As well as describing the base ANCP protocol, this document specifies capabilities for Digital Subscriber Line (DSL) topology discovery, line configuration, and remote line connectivity testing. The design of ANCP allows for protocol extensions in other documents if they are needed to support other use cases and other access technologies. </p>
<p>ANCP is based on GSMPv3 (RFC 3292), but with many modifications and extensions, to the point that the two protocols are not interoperable. </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 21, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Historical Note</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Requirements Language</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2"> Broadband Access Aggregation</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">ATM-based Broadband Aggregation</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Ethernet-Based Broadband Aggregation</a>
</li>
<li>3.   <a href="#rfc.section.3">Access Node Control Protocol -- General Aspects</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Protocol Version</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">ANCP Transport</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Encoding of Text Fields</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Treatment of Reserved and Unused Fields</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">The ANCP Adjacency Protocol</a>
</li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">ANCP Adjacency Message Format</a>
</li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">ANCP Adjacency Procedures</a>
</li>
<li>3.5.2.1.   <a href="#rfc.section.3.5.2.1">Overview</a>
</li>
<li>3.5.2.2.   <a href="#rfc.section.3.5.2.2">Adjacency Protocol State Machine</a>
</li>
<li>3.5.2.2.1.   <a href="#rfc.section.3.5.2.2.1">State Tables</a>
</li>
<li>3.5.2.3.   <a href="#rfc.section.3.5.2.3">The Adjacency Protocol SYN Message</a>
</li>
<li>3.5.2.3.1.   <a href="#rfc.section.3.5.2.3.1">Action By the Sender</a>
</li>
<li>3.5.2.3.2.   <a href="#rfc.section.3.5.2.3.2">Action By the Receiver</a>
</li>
<li>3.5.2.4.   <a href="#rfc.section.3.5.2.4">The Adjacency Protocol SYNACK Message</a>
</li>
<li>3.5.2.4.1.   <a href="#rfc.section.3.5.2.4.1">Action By the Sender</a>
</li>
<li>3.5.2.4.2.   <a href="#rfc.section.3.5.2.4.2">Action By the Receiver</a>
</li>
<li>3.5.2.5.   <a href="#rfc.section.3.5.2.5">The Adjacency Protocol ACK Message</a>
</li>
<li>3.5.2.5.1.   <a href="#rfc.section.3.5.2.5.1">Actions By the Sender</a>
</li>
<li>3.5.2.5.2.   <a href="#rfc.section.3.5.2.5.2">Actions By the Receiver</a>
</li>
<li>3.5.2.6.   <a href="#rfc.section.3.5.2.6">The Adjacency Protocol RSTACK Message</a>
</li>
<li>3.5.2.6.1.   <a href="#rfc.section.3.5.2.6.1">Action By the Sender</a>
</li>
<li>3.5.2.6.2.   <a href="#rfc.section.3.5.2.6.2">Action By the Receiver</a>
</li>
<li>3.5.2.7.   <a href="#rfc.section.3.5.2.7">Loss of Contact or Synchronization</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">ANCP General Message Formats</a>
</li>
<li>3.6.1.   <a href="#rfc.section.3.6.1">The ANCP Message Header</a>
</li>
<li>3.6.1.1.   <a href="#rfc.section.3.6.1.1">Version Field (8 bits)</a>
</li>
<li>3.6.1.2.   <a href="#rfc.section.3.6.1.2">Message Type Field (8 bits)</a>
</li>
<li>3.6.1.3.   <a href="#rfc.section.3.6.1.3">Result Field (4 bits)</a>
</li>
<li>3.6.1.4.   <a href="#rfc.section.3.6.1.4">Result Code Field (12 bits)</a>
</li>
<li>3.6.1.5.   <a href="#rfc.section.3.6.1.5">Partition ID (8 bits)</a>
</li>
<li>3.6.1.6.   <a href="#rfc.section.3.6.1.6">Transaction ID (24 bits)</a>
</li>
<li>3.6.1.7.   <a href="#rfc.section.3.6.1.7">I flag and SubMessage Number (1 + 15 bits)</a>
</li>
<li>3.6.1.8.   <a href="#rfc.section.3.6.1.8">Length (16 bits)</a>
</li>
<li>3.6.2.   <a href="#rfc.section.3.6.2">The ANCP Message Body</a>
</li>
<li>3.7.   <a href="#rfc.section.3.7">General Principles for the Design of ANCP Messages</a>
</li>
<li>4.   <a href="#rfc.section.4">Generally Useful ANCP Messages and TLVs</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Provisioning Message</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Generic Response Message</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Target TLV</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4"> Command TLV</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Status-Info TLV</a>
</li>
<li>5.   <a href="#rfc.section.5">Introduction To ANCP Capabilities For Digital Subscriber Lines (DSL)</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">DSL Access Line Identification</a>
</li>
<li>5.1.1.   <a href="#rfc.section.5.1.1">Control Context (Informative)</a>
</li>
<li>5.1.2.   <a href="#rfc.section.5.1.2">TLVs For DSL Access Line Identification</a>
</li>
<li>5.1.2.1.   <a href="#rfc.section.5.1.2.1">Access-Loop-Circuit-ID TLV</a>
</li>
<li>5.1.2.2.   <a href="#rfc.section.5.1.2.2">Access-Loop-Remote-Id TLV</a>
</li>
<li>5.1.2.3.   <a href="#rfc.section.5.1.2.3">Access-Aggregation-Circuit-ID-Binary TLV</a>
</li>
<li>5.1.2.4.   <a href="#rfc.section.5.1.2.4">Access-Aggregation-Circuit-ID-ASCII TLV</a>
</li>
<li>6.   <a href="#rfc.section.6">ANCP Based DSL Topology Discovery</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Control Context (Informative)</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Protocol Requirements</a>
</li>
<li>6.2.1.   <a href="#rfc.section.6.2.1">Protocol Requirements On the AN Side</a>
</li>
<li>6.2.2.   <a href="#rfc.section.6.2.2">Protocol Requirements On the NAS Side</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">ANCP Port UP and Port DOWN Event Message Descriptions</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Procedures</a>
</li>
<li>6.4.1.   <a href="#rfc.section.6.4.1">Procedures On the AN Side</a>
</li>
<li>6.4.2.   <a href="#rfc.section.6.4.2">Procedures On the NAS Side</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">TLVs For DSL Line Attributes</a>
</li>
<li>6.5.1.   <a href="#rfc.section.6.5.1">DSL-Line-Attributes TLV</a>
</li>
<li>6.5.2.   <a href="#rfc.section.6.5.2">DSL-Type TLV</a>
</li>
<li>6.5.3.   <a href="#rfc.section.6.5.3">Actual-Net-Data-Rate-Upstream TLV</a>
</li>
<li>6.5.4.   <a href="#rfc.section.6.5.4">Actual-Net-Data-Rate-Downstream TLV</a>
</li>
<li>6.5.5.   <a href="#rfc.section.6.5.5">Minimum-Net-Data-Rate-Upstream TLV</a>
</li>
<li>6.5.6.   <a href="#rfc.section.6.5.6">Minimum-Net-Data-Rate-Downstream TLV</a>
</li>
<li>6.5.7.   <a href="#rfc.section.6.5.7">Attainable-Net-Data-Rate-Upstream TLV</a>
</li>
<li>6.5.8.   <a href="#rfc.section.6.5.8">Attainable-Net-Data-Rate-Downstream TLV</a>
</li>
<li>6.5.9.   <a href="#rfc.section.6.5.9">Maximum-Net-Data-Rate-Upstream TLV</a>
</li>
<li>6.5.10.   <a href="#rfc.section.6.5.10">Maximum-Net-Data-Rate-Downstream TLV</a>
</li>
<li>6.5.11.   <a href="#rfc.section.6.5.11">Minimum-Net-Low-Power-Data-Rate-Upstream TLV</a>
</li>
<li>6.5.12.   <a href="#rfc.section.6.5.12">Minimum-Net-Low-Power-Data-Rate-Downstream TLV</a>
</li>
<li>6.5.13.   <a href="#rfc.section.6.5.13">Maximum-Interleaving-Delay-Upstream TLV</a>
</li>
<li>6.5.14.   <a href="#rfc.section.6.5.14">Actual-Interleaving-Delay-Upstream TLV</a>
</li>
<li>6.5.15.   <a href="#rfc.section.6.5.15">Maximum-Interleaving-Delay-Downstream TLV</a>
</li>
<li>6.5.16.   <a href="#rfc.section.6.5.16">Actual-Interleaving-Delay-Downstream</a>
</li>
<li>6.5.17.   <a href="#rfc.section.6.5.17">DSL-Line-State TLV</a>
</li>
<li>6.5.18.   <a href="#rfc.section.6.5.18">Access-Loop-Encapsulation TLV</a>
</li>
<li>7.   <a href="#rfc.section.7">ANCP based DSL Line Configuration </a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Control Context (Informative)</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">Protocol Requirements</a>
</li>
<li>7.2.1.   <a href="#rfc.section.7.2.1">Protocol Requirements On the NAS Side</a>
</li>
<li>7.2.2.   <a href="#rfc.section.7.2.2">Protocol Requirements On the AN Side</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">ANCP Port Management (Line Configuration) Message Format</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Procedures</a>
</li>
<li>7.4.1.   <a href="#rfc.section.7.4.1">Procedures On the NAS Side</a>
</li>
<li>7.4.2.   <a href="#rfc.section.7.4.2">Procedures On the AN Side</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">TLVs For DSL Line Configuration</a>
</li>
<li>7.5.1.   <a href="#rfc.section.7.5.1">Service-Profile-Name TLV</a>
</li>
<li>8.   <a href="#rfc.section.8">ANCP-Based DSL Remote Line Connectivity Testing</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Control Context (Informative)</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Protocol Requirements</a>
</li>
<li>8.2.1.   <a href="#rfc.section.8.2.1">Protocol Requirements On the NAS Side</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">Protocol Requirements On the AN Side</a>
</li>
<li>8.3.   <a href="#rfc.section.8.3">Port Management (OAM) Message Format</a>
</li>
<li>8.4.   <a href="#rfc.section.8.4">Procedures</a>
</li>
<li>8.4.1.   <a href="#rfc.section.8.4.1">NAS-Side Procedures</a>
</li>
<li>8.4.2.   <a href="#rfc.section.8.4.2">AN-Side Procedures</a>
</li>
<li>8.5.   <a href="#rfc.section.8.5">TLVs For the DSL Line Remote Connectivity Testing Capability</a>
</li>
<li>8.5.1.   <a href="#rfc.section.8.5.1">OAM-Loopback-Test-Parameters TLV</a>
</li>
<li>8.5.2.   <a href="#rfc.section.8.5.2">Opaque-Data TLV</a>
</li>
<li>8.5.3.   <a href="#rfc.section.8.5.3">OAM-Loopback-Test-Response-String TLV</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">Summary</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">IANA Actions</a>
</li>
<li>9.2.1.   <a href="#rfc.section.9.2.1">ANCP Message Type Registry</a>
</li>
<li>9.2.2.   <a href="#rfc.section.9.2.2">ANCP Result Code Registry</a>
</li>
<li>9.2.3.   <a href="#rfc.section.9.2.3">ANCP Port Management Function Registry</a>
</li>
<li>9.2.4.   <a href="#rfc.section.9.2.4">ANCP Technology Type Registry</a>
</li>
<li>9.2.5.   <a href="#rfc.section.9.2.5">ANCP Command Code Registry</a>
</li>
<li>9.2.6.   <a href="#rfc.section.9.2.6">ANCP TLV Type Registry</a>
</li>
<li>9.2.7.   <a href="#rfc.section.9.2.7">ANCP Capability Type Registry</a>
</li>
<li>9.2.8.   <a href="#rfc.section.9.2.8">Joint GSMP / ANCP Version Registry</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">Acknowledgements</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This draft defines a new protocol, the Access Node Control Protocol (ANCP), to realize a control plane between a service-oriented layer 3 edge device (the Network Access Server, NAS) and a layer 2 Access Node (e.g., Digital Subscriber Line Access Module, DSLAM) in order to perform operations related to quality of service (QoS), services, and subscriptions.  The requirements for ANCP and the context within which it operates are described in <a href="#RFC5851">[RFC5851]</a>.</p>
<p id="rfc.section.1.p.2">ANCP provides its services to control applications operating in the AN and NAS respectively. This relationship is shown in <a href="#fig_ancpArch">Figure 1</a>. Specification of the control applications is beyond the scope of this document, but informative partial descriptions are provided as necessary to give a context for the operation of the protocol.</p>
<div id="#rfc.figure.1"></div>
<div id="#fig_ancpArch"></div>
<pre>
       Access Node                            Network Access Server
  +--------------------+                     +--------------------+
  | +----------------+ |                     | +----------------+ |
  | |   AN Control   | |                     | |  NAS Control   | |
  | |  Application   | |                     | |  Application   | |
  | +----------------+ |                     | +----------------+ |
  | +----------------+ |                     | +----------------+ |
  | |   ANCP Agent   | |    ANCP Messages    | |   ANCP Agent   | |
  | |   (AN side)    |&lt;-----------------------&gt;|   (NAS side)   | |
  | +----------------+ |                     | +----------------+ |
  +--------------------+                     +--------------------+
      </pre>
<p id="rfc.section.1.p.3">At various points in this document, information flows between the control applications and ANCP are described. The purpose of such descriptions is to clarify the boundary between this specification and, for example, <a href="#TR-147">[TR-147]</a>. There is no intention to place limits on the degree to which the control application and the protocol implementation are integrated. </p>
<p id="rfc.section.1.p.4">This specification specifies ANCP transport over TCP/IP. TCP encapsulation for ANCP is as defined in <a href="#transport">Section 3.2</a>.</p>
<p id="rfc.section.1.p.5">The organization of this document is as follows: </p>

<ul>
<li>The next two sub-sections introduce some terminology that will be useful in understanding the rest of the document.</li>
<li>
<a href="#aggreg">Section 2</a> provides a description of the access networks within which ANCP will typically be deployed.</li>
<li>
<a href="#ANCPgeneral">Section 3</a> specifies generally applicable aspects of the ANCP protocol.</li>
<li>
<a href="#commonStuff">Section 4</a> specifies some messages and TLVs intended for use by multiple capabilities spanning multiple technologies.</li>
<li>
<a href="#DSLcapab">Section 5</a> and the three following sections describe and specify the ANCP implementation of three capabilities applicable to the control of DSL access technology: topology discovery, line configuration, and remote line connectivity testing.</li>
<li>
<a href="#IANA">Section 9</a> is the IANA Considerations section. This section defines a number of new ANCP-specific registries, as well as the joint GSMP/ANCP version registry mentioned below. </li>
<li>
<a href="#secur">Section 10</a> addresses security considerations relating to ANCP, beginning with the requirements stated in <a href="#RFC5713">[RFC5713]</a>.</li>
</ul>

<p> </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#history" id="history">Historical Note</a>
</h1>
<p id="rfc.section.1.1.p.1">Initial implementations of the protocol that became ANCP were based on GSMPv3 <a href="#RFC3292">[RFC3292]</a>. The ANCP charter required the Working Group to develop its protocol based on these implementations. In the end, ANCP introduced so many extensions and modifications to GSMPv3 that the two protocols are not interoperable. Nevertheless, although this specification has no normative dependencies on <a href="#RFC3292">[RFC3292]</a>, the mark of ANCP's origins can be seen in the various unused fields within the ANCP message header.</p>
<p id="rfc.section.1.1.p.2">Early in ANCP's development the decision was made to use the same TCP port and encapsulation as GSMPv3, and by the time ANCP was finished it was too late to reverse that decision because of existing implementations. As a result, it is necessary to have a way for an ANCP peer to quickly distinguish ANCP from GSMP during initial adjacency negotiations. This has been provided by a joint registry of GSMP and ANCP version numbers.  GSMP has version numbers 1 through 3. ANCP has the initial version number 50.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Requirements Language</h1>
<p id="rfc.section.1.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Terminology</h1>
<p id="rfc.section.1.3.p.1">This section repeats some definitions from <a href="#RFC5851">[RFC5851]</a>, but also adds definitions for terms used only in this document.  </p>

<dl>
<dt>Access Node (AN):</dt>
<dd style="margin-left: 8">
<a href="#RFC5851">[RFC5851]</a> Network device, usually located at a service provider central office or street cabinet that terminates access (local) loop connections from subscribers. In case the access loop is a Digital Subscriber Line (DSL), the Access Node provides DSL signal termination, and is referred to as a DSL Access Multiplexer (DSLAM).</dd>
<dt>Network Access Server (NAS):</dt>
<dd style="margin-left: 8">
<a href="#RFC5851">[RFC5851]</a> Network element which aggregates subscriber traffic from a number of Access Nodes. The NAS is an enforcement point for policy management and IP QoS in the access network. It is also referred to as a Broadband Network Gateway (BNG) or Broadband Remote Access Server (BRAS).</dd>
<dt>Home Gateway (HGW):</dt>
<dd style="margin-left: 8">Network element that connects subscriber devices to the Access Node and the access network. In the case of DSL, the Home Gateway is a DSL network termination that may operate either as a layer 2 bridge or as a layer 3 router. In the latter case, such a device is also referred to as a Routing Gateway (RG).</dd>
<dt>ANCP agent:</dt>
<dd style="margin-left: 8">A logical entity that implements the ANCP protocol in the Access Node (AN-side) or NAS (NAS-side).</dd>
<dt>Access Node control adjacency:</dt>
<dd style="margin-left: 8">(modified from <a href="#RFC5851">[RFC5851]</a>) the relationship between the AN-side ANCP agent and the NAS-side ANCP agent for the purpose of exchanging Access Node Control Protocol messages.  The adjacency may either be up or down, depending on the result of the Access Node Control adjacency protocol operation. </dd>
<dt>ANCP capability:</dt>
<dd style="margin-left: 8">A specific set of ANCP messages, message content, and procedures required to implement a specific use case or set of use cases. Some ANCP capabilities are applicable to just one access technology while others are technology independent. The capabilities applicable to a given ANCP adjacency are negotiated during adjacency startup.</dd>
<dt>Type-Length-Value (TLV):</dt>
<dd style="margin-left: 8">a data structure consisting of a sixteen-bit type field, a sixteen-bit length field, and a variable-length value field padded to the nearest 32-bit word boundary, as described in <a href="#ANCPmsgBody">Section 3.6.2</a>. The value field of a TLV can contain other TLVs. An IANA registry is maintained for values of the ANCP TLV Type field.</dd>
<dt>Net data rate:</dt>
<dd style="margin-left: 8">
<a href="#RFC5851">[RFC5851]</a> defined by ITU-T G.993.2 [G.993.2], Section 3.39, i.e., the portion of the total data rate that can be used to transmit user information (e.g., ATM cells or Ethernet frames). It excludes overhead that pertains to the physical transmission mechanism (e.g., trellis coding in the case of DSL).  It includes TPS-TC (Transport Protocol Specific - Transmission Convergence) encapsulation; this is zero for ATM encapsulation, and non-zero for 64/65 encapsulation. </dd>
<dt>Line rate:</dt>
<dd style="margin-left: 8">
<a href="#RFC5851">[RFC5851]</a> defined by ITU-T G.993.2.  It contains the complete overhead including Reed-Solomon and trellis coding. </dd>
<dt>DSL multi-pair bonding:</dt>
<dd style="margin-left: 8">method for bonding (or aggregating) multiple xDSL lines into a single bi-directional logical link, henceforth referred to in this draft as "DSL bonded circuit".  DSL "multi-pair" bonding allows an operator to combine the data rates on two or more copper pairs, and deliver the aggregate data rate to a single customer. ITU-T recommendations G.998.1 and G.998.2 respectively describe ATM and Ethernet based multi-pair bonding.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#aggreg" id="aggreg"> Broadband Access Aggregation</a>
</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> ATM-based Broadband Aggregation</h1>
<p id="rfc.section.2.1.p.1">The end to end DSL network consists of network service provider (NSP) and application service provider (ASP) networks, regional/access network, and customer premises network. <a href="#Fig.1">Figure 2</a> shows ATM broadband access network components.</p>
<p id="rfc.section.2.1.p.2">The regional/access network consists of the regional network, Network Access Server (NAS), and the access network as shown in <a href="#Fig.1">Figure 2</a>. Its primary function is to provide end-to-end transport between the customer premises and the NSP or ASP.</p>
<p id="rfc.section.2.1.p.3">The Access Node terminates the DSL signal. It may be in the form of a DSLAM in the central office, or a remote DSLAM, or a Remote Access Multiplexer (RAM). The Access Node is the first point in the network where traffic on multiple DSL lines will be aggregated onto a single network. </p>
<p id="rfc.section.2.1.p.4">The NAS performs multiple functions in the network. The NAS is the aggregation point for subscriber traffic. It provides aggregation capabilities (e.g. IP, PPP, ATM) between the Regional/Access Network and the NSP or ASP. These include traditional ATM-based offerings and newer, more native IP-based services. This includes support for Point-to-Point Protocol over ATM (PPPoA) and PPP over Ethernet (PPPoE), as well as direct IP services encapsulated over an appropriate layer 2 transport.</p>
<p id="rfc.section.2.1.p.5">Beyond aggregation, the NAS is also the enforcement point for policy management and IP QoS in the regional/access networks.  To allow IP QoS support over an existing non-IP-aware layer 2 access network without using multiple layer 2 QoS classes, a mechanism based on hierarchical scheduling is used. This mechanism, defined in <a href="#TR-059">[TR-059]</a>, preserves IP QoS over the ATM network between the NAS and the routing gateway (RG) at the edge of the subscriber network, by carefully controlling downstream traffic in the NAS, so that significant queuing and congestion does not occur further down the ATM network. This is achieved by using a diffserv-aware hierarchical scheduler in the NAS that will account for downstream trunk bandwidths and DSL synchronization rates.</p>
<p><a href="#RFC5851">[RFC5851]</a> provides detailed definitions of the functions of each network element in the broadband reference architecture.</p>
<div id="#rfc.figure.2"></div>
<div id="#Fig.1"></div>
<pre>
                              Access                   Customer 
                       &lt;--- Aggregation --&gt;  &lt;------- Premises -------&gt; 
                              Network                   Network
                   
                       +------------------+ +--------------------------+
   +---------+   +---+ | +-----+ +------+ | |+-----+ +---+ +---------+ |
NSP|         | +-|NAS|-| |ATM  |-|Access| --||DSL  |-|HGW|-|Subscriber||
---+ Regional| | +---+ | +-----+ | Node | | ||Modem| +---+ |Devices   ||
   |Broadband| | +---+ |         +------+ | |+-----+       +----------+|
ASP|Network  |-+-|NAS| +--------------|---+ +--------------------------+
---+         | | +---+                |     +--------------------------+
   |         | | +---+                |     |+-----+ +---+ +----------+|
   +---------+ +-|NAS|                +-----|| DSL |-|HGW|-|Subscriber||
                 +---+                      ||Modem| +---+ |Devices   ||
                                            |+-----+       +----------+|
                                            +--------------------------+
 HGW   : Home Gateway
 NAS   : Network Access Server
      </pre>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Ethernet-Based Broadband Aggregation</h1>
<p id="rfc.section.2.2.p.1">The Ethernet aggregation network architecture builds on the Ethernet bridging/switching concepts defined in IEEE 802. The Ethernet aggregation network provides traffic aggregation, class of service distinction, and customer separation and traceability.  VLAN tagging defined in IEEE 802.1Q and being enhanced by IEEE 802.1ad is used as standard virtualization mechanism in the Ethernet aggregation network. The aggregation devices are "provider edge bridges" defined in IEEE 802.ad.</p>
<p id="rfc.section.2.2.p.2">Stacked VLAN tags provide one possible way to create equivalent of "virtual paths" and "virtual circuits" in the aggregation network.  The "outer" vlan can be used to create a form of "virtual path" between a given DSLAM and a given NAS. "Inner" VLAN tags create a form of "virtual circuit" on a per DSL line basis. This is the 1:1 VLAN allocation model. An alternative model is to bridge sessions from multiple subscribers behind a DSLAM into a single VLAN in the aggregation network. This is the N:1 VLAN allocation model.  Section 1.6 of <a href="#TR-101">[TR-101]</a> provides brief definitions of these two models, while section 2.5.1 describes them in more detail. </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#ANCPgeneral" id="ANCPgeneral">Access Node Control Protocol -- General Aspects</a>
</h1>
<p id="rfc.section.3.p.1">This section specifies aspects of the Access Node Control Protocol (ANCP) that are generally applicable. </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#version" id="version">Protocol Version</a>
</h1>
<p id="rfc.section.3.1.p.1">ANCP messages contain an 8-bit protocol version field. For the protocol version specified in this document, the value of that field MUST be set to 50. </p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#transport" id="transport">ANCP Transport</a>
</h1>
<p id="rfc.section.3.2.p.1">This document specifies the use of TCP / IPSec+IKEv2 / IP for transport of ANCP messages. For further discussion of the use of IPSec + IKEv2 see <a href="#secur">Section 10</a>. The present section deals with the TCP aspects.  Other specifications may introduce additional transports in the future.</p>
<p></p>

<ul class="empty">
<li>In the case of ATM access, a separate PVC (control channel) capable of transporting IP MAY be configured between NAS and the AN for ANCP messages.</li>
<li>In the case of an Ethernet access/aggregation network, a typical practice is to send the Access Node Control Protocol messages over a dedicated Ethernet virtual LAN (VLAN) using a separate VLAN identifier (VLAN ID).</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.3">When transported over TCP, ANCP messages MUST use an encapsulation consisting of a four-byte header field prepended to the ANCP message as shown in <a href="#gsmp_tcp_frt">Figure 3</a>.</p>
<div id="#rfc.figure.3"></div>
<div id="#gsmp_tcp_frt"></div>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Identifier (0x880C)        |           Length              |
   |-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                         ANCP Message                          ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      </pre>
<p id="rfc.section.3.2.p.4">The fields of the encapsulating header are as follows: </p>

<dl>
<dt>Identifier (16 bits):</dt>
<dd style="margin-left: 8">This identifies a GSMP or ANCP message. It MUST be set to 0x880C. </dd>
<dt>Length (16 bits):</dt>
<dd style="margin-left: 8">Total length of the ANCP message in bytes, not including the 4-byte encapsulating header. </dd>
</dl>

<p> </p>
<p id="rfc.section.3.2.p.5">The Access Node MUST initiate the TCP session to the NAS, using destination port 6068.  </p>

<ul class="empty"><li>This is necessary to avoid static address provisioning on the NAS for all the ANs that are being served by the NAS. It is easier to configure a given AN with the single IP address of the NAS that serves the AN.</li></ul>

<p> </p>
<p id="rfc.section.3.2.p.6">The NAS MUST listen on port 6068 for incoming connections from the Access Nodes. </p>
<p id="rfc.section.3.2.p.7">In the event of an ANCP transport protocol failure, all pending ANCP messages destined to the disconnected recipient SHOULD be discarded until the transport connection is re-established. </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#textEnc" id="textEnc">Encoding of Text Fields</a>
</h1>
<p id="rfc.section.3.3.p.1">In ANCP, all text fields use UTF-8 encoding <a href="#RFC3629">[RFC3629]</a>.  Note that US ASCII characters have the same representation when coded as UTF-8 as they do when coded according to <a href="#US_ASCII">[US_ASCII]</a>. </p>
<p id="rfc.section.3.3.p.2">When extracting text fields from a message, the ANCP agent MUST NOT assume that the fields are zero-terminated.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#resvUnused" id="resvUnused">Treatment of Reserved and Unused Fields</a>
</h1>
<p id="rfc.section.3.4.p.1">ANCP messages contain a number of fields that are unused or reserved. Some fields are always unused (typically because they were inherited from GSMPv3 but are not useful in the ANCP context). Others are reserved in the current specification, but are provided for flexibility in future extensions to ANCP. Both reserved and unused fields MUST be set to zeroes by the sender and MUST be ignored by the receiver. </p>
<p id="rfc.section.3.4.p.2">Unused bits in a flag field are shown in figures as 'x'. The above requirement (sender set to zero, receiver ignore) applies to such unused bits.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> <a href="#adjacency" id="adjacency">The ANCP Adjacency Protocol</a>
</h1>
<p id="rfc.section.3.5.p.1">ANCP uses the adjacency protocol to synchronize the NAS and Access Nodes and maintain the ANCP session. After the TCP connection is established, adjacency protocol messages MUST be exchanged as specified in this section.  ANCP messages other than adjacency protocol messages MUST NOT be sent until the adjacency protocol has achieved synchronization.</p>
<h1 id="rfc.section.3.5.1">
<a href="#rfc.section.3.5.1">3.5.1.</a> <a href="#adjFmt" id="adjFmt">ANCP Adjacency Message Format</a>
</h1>
<p id="rfc.section.3.5.1.p.1">The ANCP adjacency message format is shown in <a href="#fig_adj_msg">Figure 4</a> below.</p>
<div id="#rfc.figure.4"></div>
<div id="#fig_adj_msg"></div>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Version   | Message Type  |     Timer     |M|     Code    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Sender Name                          |
   +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                               |                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
   |                         Receiver Name                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Sender Port                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                         Receiver Port                         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | PType | PFlag |               Sender Instance                 |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Partition ID  |              Receiver Instance                |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Reserved      | # of Caps     | Total Length                  |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                   Capability Fields                           ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        </pre>
<p id="rfc.section.3.5.1.p.2">The fields of the ANCP adjacency message are as follows: </p>

<dl>
<dt>Version (8 bits):</dt>
<dd style="margin-left: 8">ANCP version, which is subject to negotiation. This is the key parameter by means of which ANCP messages can be distinguished from GSMP messages received over the same port.</dd>
<dt>Message Type (8 bits):</dt>
<dd style="margin-left: 8">always has value 10 (adjacency protocol).</dd>
<dt>Timer (8 bits):</dt>
<dd style="margin-left: 8">The Timer field is used to negotiate the timer value used in the adjacency protocol with the peer.  The timer specifies the nominal time between periodic adjacency protocol messages.  It is a constant for the duration of an ANCP session. The timer field is specified in units of 100ms, with a default value of 250 (i.e., 25 seconds).</dd>
<dt>M-flag (one bit):</dt>
<dd style="margin-left: 8">used in the SYN message to prevent the NAS from synchronizing with another NAS, and the AN from synchronizing with another AN. In the SYN message, always set to 1 by the NAS, and to 0 by the AN. In other adjacency message types, always set to 0 by the sender and ignored by the receiver.</dd>
<dt>Code (7 bits):</dt>
<dd style="margin-left: 8">the adjacency protocol message type. It MUST have one of the following values: <ul class="empty">
<li>Code = 1: SYN;</li>
<li>Code = 2: SYNACK;</li>
<li>Code = 3: ACK;</li>
<li>Code = 4: RSTACK.</li>
</ul>
<p> </p>
</dd>
<dt>Sender Name (48 bits):</dt>
<dd style="margin-left: 8">For the SYN, SYNACK, and ACK messages, is the identifier of the entity sending the message.  The Sender Name is a 48-bit quantity that is unique within the operational context of the device.  A 48-bit IEEE 802 MAC address, if available, may be used for the Sender Name.  If the Ethernet encapsulation is used the Sender Name MUST be the Source Address from the MAC header.  For the RSTACK message, the Sender Name field is set to the value of the Receiver Name field from the incoming message that caused the RSTACK message to be generated. </dd>
<dt>Receiver Name (48 bits)</dt>
<dd style="margin-left: 8">for the SYN, SYNACK, and ACK messages, is the name of the entity that the sender of the message believes is at the far end of the link.  If the sender of the message does not know the name of the entity at the far end of the link, this field SHOULD be set to zero.  For the RSTACK message, the Receiver Name field is set to the value of the Sender Name field from the incoming message that caused the RSTACK message to be generated. </dd>
<dt>Sender Port (32 bits):</dt>
<dd style="margin-left: 8">For the SYN, SYNACK, and ACK messages, is the local port number of the link across which the message is being sent.  For the RSTACK message, the Sender Port field is set to the value of the Receiver Port field from the incoming message that caused the RSTACK message to be generated. </dd>
<dt>Receiver Port (32 bits):</dt>
<dd style="margin-left: 8">For the SYN, SYNACK, and ACK messages, is what the sender believes is the local port number for the link, allocated by the entity at the far end of the link.  If the sender of the message does not know the port number at the far end of the link, this field SHOULD be set to zero.  For the RSTACK message, the Receiver Port field is set to the value of the Sender Port field from the incoming message that caused the RSTACK message to be generated. </dd>
<dt>PType (4 bits):</dt>
<dd style="margin-left: 8">PType is used to specify if partitions are used and how the Partition ID is negotiated.  <ul class="empty">
<li>Type of partition being requested:</li>
<li>0 - no partition;</li>
<li>1 - fixed partition request;</li>
<li>2 - fixed partition assigned.</li>
</ul>
<p> </p>
</dd>
<dt>PFlag (4 bits):</dt>
<dd style="margin-left: 8">used to indicate the type of partition request.  <ul class="empty">
<li>1 - new adjacency;</li>
<li>2 - recovered adjacency.</li>
</ul>
<p> </p>
</dd>
<dt>Sender Instance (24 bits):</dt>
<dd style="margin-left: 8">For the SYN, SYNACK, and ACK messages, is the sender's instance number for the link to the peer.  It is used to detect when the link comes back up after going down or when the identity of the entity at the other end of the link changes.  The instance number is a 24-bit number that is guaranteed to be unique within the recent past and to change when the link or node comes back up after going down.  Zero is not a valid instance number.  For the RSTACK message, the Sender Instance field is set to the value of the Receiver Instance field from the incoming message that caused the RSTACK message to be generated.</dd>
<dt>Partition ID (8 bits):</dt>
<dd style="margin-left: 8">field used to associate the message with a specific partition of the AN.</dd>
<dt>Receiver Instance (24 bits):</dt>
<dd style="margin-left: 8">For the SYN, SYNACK, and ACK messages, is what the sender believes is the current instance number for the link, allocated by the entity at the far end of the link.  If the sender of the message does not know the current instance number at the far end of the link, this field SHOULD be set to zero.  For the RSTACK message, the Receiver Instance field is set to the value of the Sender Instance field from the incoming message that caused the RSTACK message to be generated.</dd>
<dt>Reserved (8 bits):</dt>
<dd style="margin-left: 8">reserved for use by a future version of this specification.</dd>
<dt># of Caps:</dt>
<dd style="margin-left: 8">indicates the number of capability fields that follow.</dd>
<dt>Total Length:</dt>
<dd style="margin-left: 8">indicates the total number of bytes occupied by the capability fields that follow.</dd>
<dt>Capability Fields:</dt>
<dd style="margin-left: 8">Each capability field indicates one ANCP capability supported by the sender of the adjacency message.  Negotiation of a common set of capabilities to be supported within the ANCP session is described below. The detailed format of a capability field is shown in <a href="#cap_fld">Figure 5</a> and described below.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.5"></div>
<div id="#cap_fld"></div>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     Capability Type           |   Capability Length           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                                                               ~
   ~                   Capability Data                             ~ 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        </pre>
<p id="rfc.section.3.5.1.p.3">The sub-fields of this structure are as follows: </p>

<dl>
<dt>Capability Type:</dt>
<dd style="margin-left: 8">indicates the specific capability supported. An IANA registry exists for values of this sub-field.  The values specified by this document are listed below.</dd>
<dt>Capability Length:</dt>
<dd style="margin-left: 8">the number of bytes of data contained in the Capability Data sub-field, excluding padding. If the definition of a particular capability includes no capability data, the value of the Capability Length sub-field is zero.</dd>
<dt>Capability Data:</dt>
<dd style="margin-left: 8">contains data associated with the capability as specified for that capability. If the definition of a particular capability includes no capability data, the Capability Data sub-field is absent (has zero length). Otherwise, the Capability Data sub-field MUST be padded with zeroes as required to terminate on a 4-byte word boundary. The possibility of specifying capability data provides the flexibility to advertise more than the mere presence or absence of a capability if needed. </dd>
</dl>

<p> </p>
<p id="rfc.section.3.5.1.p.4">The following capabilities are defined for ANCP as applied to DSL access: </p>

<ul>
<li>Capability Type : DSL Topology Discovery = 0x01 <dl>
<dt></dt>
<dd style="margin-left: 8">Access technology: DSL</dd>
<dt></dt>
<dd style="margin-left: 8">Length (in bytes) : 0</dd>
<dt></dt>
<dd style="margin-left: 8">Capability Data : NULL</dd>
</dl>
<p> For the detailed protocol specification of this capability see </p>
<a href="#topol">Section 6</a>. </li>
<li>Capability Type : DSL Line Configuration = 0x02 <dl>
<dt></dt>
<dd style="margin-left: 8">Access technology: DSL</dd>
<dt></dt>
<dd style="margin-left: 8">Length (in bytes) : 0</dd>
<dt></dt>
<dd style="margin-left: 8">Capability Data : NULL</dd>
</dl>
<p> For the detailed protocol specification of this capability see </p>
<a href="#lineConfig">Section 7</a>. </li>
<li>Capability Type : DSL Remote Line Connectivity Testing = 0x04 <dl>
<dt></dt>
<dd style="margin-left: 8">Access technology: DSL</dd>
<dt></dt>
<dd style="margin-left: 8">Length (in bytes) : 0</dd>
<dt></dt>
<dd style="margin-left: 8">Capability Data : NULL</dd>
</dl>
<p> For the detailed protocol specification of this capability see </p>
<a href="#oamCAP">Section 8</a>. </li>
</ul>

<p> </p>
<p id="rfc.section.3.5.1.p.5">In addition to the adjacency messages whose format is shown in <a href="#fig_adj_upd">Figure 6</a>, ANCP adjacency procedures use the Adjacency Update message (<a href="#fig_adj_upd">Figure 6</a>) to inform other NASs controlling the same AN partition when a particular NAS joins or loses an adjacency with that partition.</p>
<div id="#rfc.figure.6"></div>
<div id="#fig_adj_upd"></div>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Version    | Message Type  | Result|        Code           |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Partition ID  |            Transaction Identifier             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |I|      SubMessage Number      |           Length              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
        </pre>
<p id="rfc.section.3.5.1.p.6">The Adjacency Update message is identical to the general ANCP message header described in <a href="#ancpFormat">Section 3.6</a>, but the field settings are in part specific to the Adjacency Update message. The fields in this message are as follows: </p>

<dl>
<dt>Version (8 bits):</dt>
<dd style="margin-left: 8">the ANCP version negotiated and running in this adjacency.</dd>
<dt>Message Type (8 bits):</dt>
<dd style="margin-left: 8">always 85.</dd>
<dt>Result (4 bits):</dt>
<dd style="margin-left: 8">set to Ignore (0).</dd>
<dt>Code (12 bits):</dt>
<dd style="margin-left: 8">set to the total number of adjacencies currently established on this partition, from the point of view of the AN.</dd>
<dt>Partition ID (8 bits):</dt>
<dd style="margin-left: 8">the partition identifier of the partition for which this notification is being sent.</dd>
<dt>Transaction Identifier (24 bits):</dt>
<dd style="margin-left: 8">MUST be set to 0.</dd>
<dt>I (1 bit), SubMessage number (15 bits):</dt>
<dd style="margin-left: 8">set as described in <a href="#HDRIflagSubmsg">Section 3.6.1.7</a>.</dd>
<dt>Length (16 bits):</dt>
<dd style="margin-left: 8">set as described in <a href="#HDRLen">Section 3.6.1.8</a>.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.5.2">
<a href="#rfc.section.3.5.2">3.5.2.</a> <a href="#adjProc" id="adjProc">ANCP Adjacency Procedures</a>
</h1>
<h1 id="rfc.section.3.5.2.1">
<a href="#rfc.section.3.5.2.1">3.5.2.1.</a> <a href="#adjOver" id="adjOver">Overview</a>
</h1>
<p id="rfc.section.3.5.2.1.p.1">The ANCP adjacency protocol operates symmetrically between the NAS and the AN. In the absence of errors or race conditions, each peer sends a SYN message, receives a SYNACK message in acknowledgement, and completes the establishment of the adjacency by sending an ACK message. Through this exchange, each peer learns the values of the Name, Port, and Instance parameters identifying the other peer, and the two peers negotiate the values of the Version and Partition ID parameters and the set of capabilities that the adjacency will support.</p>
<p id="rfc.section.3.5.2.1.p.2">Once the adjacency has been established, its liveness is periodically tested. The peers engage in an ACK message exchange at a frequency determined by the negotiated value of the Timer field. </p>
<p id="rfc.section.3.5.2.1.p.3">If an inconsistency, loss of contact, or protocol violation is detected, the detecting peer can force a restart of the synchronization process by sending an RSTACK message to the other end.</p>
<p id="rfc.section.3.5.2.1.p.4">Once an adjacency has been established, if more than one NAS has established an adjacency to the same partition, then the AN sends an Adjacency Update message to each such NAS to let it know how many established adjacencies the partition currently supports. Similarly, if an adjacency is lost, the AN sends an Adjacency Update message to each of the remaining adjacent NASs to let them know about the change in status.  </p>
<h1 id="rfc.section.3.5.2.2">
<a href="#rfc.section.3.5.2.2">3.5.2.2.</a> <a href="#adjStatMach" id="adjStatMach">Adjacency Protocol State Machine</a>
</h1>
<p id="rfc.section.3.5.2.2.p.1">The adjacency protocol is described by the following rules and state tables. It begins with the sending of a SYN by each end as soon as the transport connection has been established. If at any point the operations A, B, C, or "Verify Adjacent State" defined below detect a mismatch, a log SHOULD be generated, identifying the fields concerned and the expected and received values for each.</p>
<p id="rfc.section.3.5.2.2.p.2">The rules and state tables use the following operations: </p>

<ul>
<li>The "Record Adjacency State" operation is defined in <a href="#SYNrcv">Section 3.5.2.3.2</a>.</li>
<li>The "Verify Adjacency State" operation consists of verifying that the contents of the incoming SYNACK message match the adjacency state values previously recorded.</li>
<li>The procedure "Reset the link" is defined as: <ol>
<li>Generate a new instance number for the link.</li>
<li>Delete the peer verifier (set to zero the values of Sender Instance, Sender Port, and Sender Name previously stored by the Record Adjacency State operation).</li>
<li>Send a SYN message(<a href="#SYNsnd">Section 3.5.2.3.1</a>).</li>
<li>Enter the SYNSENT state.</li>
</ol>
<p> </p>
</li>
<li>The state tables use the following Boolean terms and operators.  <ol style="list-style-type: lower-alpha">
<li>The Sender Instance in the incoming message matches the value stored from a previous message by the "Record Adjacency State" operation.</li>
<li>The Sender Instance, Sender Port, Sender Name and Partition ID fields in the incoming message match the values stored from a previous message by the "Record Adjacency State" operation.</li>
<li>The Receiver Instance, Receiver Port, Receiver Name and Partition ID fields in the incoming message match the values of the Sender Instance, Sender Port, Sender Name and Partition ID currently sent in outgoing SYN, SYNACK, and ACK messages, except that the NAS always accepts the Partition ID value presented to it in a SYN or SYNACK message.</li>
</ol>
<p> </p>
<ul class="empty">
<li>"&amp;&amp;" Represents the logical AND operation.</li>
<li>"||" Represents the logical OR operation.</li>
<li>"!" Represents the logical negation (NOT) operation.</li>
</ul>
<p> </p>
</li>
<li>A timer is required for the periodic generation of SYN, SYNACK, and ACK messages.  The value of the timer is negotiated in the Timer field.  The period of the timer is unspecified but a value of 25 seconds is suggested. Note that since ANCP uses a reliable transport protocol, the timer is unlikely to expire in any state other than ESTAB.  <br><br> There are two independent events: the timer expires, and a packet arrives.  The processing rules for these events are: <ul class="empty">
<li>Timer Expires:   Reset Timer <ul class="empty">
<li>If state = SYNSENT Send SYN</li>
<li>If state = SYNRCVD Send SYNACK</li>
<li>If state = ESTAB   Send ACK</li>
</ul>
<p> </p>
</li>
<li>Packet Arrives: <ul class="empty">
<li>If incoming message is an RSTACK: <ul class="empty">
<li>If (A &amp;&amp; C &amp;&amp; !SYNSENT) Reset the link</li>
<li>Else discard the message.</li>
</ul>
<p> </p>
</li>
<li>If incoming message is a SYN, SYNACK, or ACK: <ul class="empty"><li>Response defined by the following State Tables.</li></ul>
<p> </p>
</li>
<li>If incoming message is any other ANCP message and state != ESTAB: <ul class="empty">
<li>Discard incoming message.</li>
<li>If state = SYNSENT Send SYN (Note 1)</li>
<li>If state = SYNRCVD Send SYNACK (Note 1)</li>
</ul>
<p> </p>
</li>
</ul>
<p> Note 1: No more than two SYN or SYNACK messages should be sent within any time period of length defined by the timer.  </p>
</li>
</ul>
<p> </p>
</li>
<li>State synchronisation across a link is considered to be achieved when the protocol reaches the ESTAB state.  All ANCP messages, other than adjacency protocol messages, that are received before synchronisation is achieved will be discarded.</li>
</ul>

<p> </p>
<h1 id="rfc.section.3.5.2.2.1">
<a href="#rfc.section.3.5.2.2.1">3.5.2.2.1.</a> <a href="#adjStatTab" id="adjStatTab">State Tables</a>
</h1>
<div id="#rfc.figure.7"></div>
<pre>

 State: SYNSENT

+====================================================================+
|    Condition     |                Action               | New State |
+==================+=====================================+===========+
|   SYNACK &amp;&amp; C    |  Update Peer Verifier; Send ACK     |   ESTAB   |
+------------------+-------------------------------------+-----------+
|   SYNACK &amp;&amp; !C   |            Send RSTACK              |  SYNSENT  |
+------------------+-------------------------------------+-----------+
|       SYN        |  Update Peer Verifier; Send SYNACK  |  SYNRCVD  |
+------------------+-------------------------------------+-----------+
|       ACK        |            Send RSTACK              |  SYNSENT  |
+====================================================================+

            </pre>
<div id="#rfc.figure.8"></div>
<pre>

 State: SYNRCVD
 
+====================================================================+
|    Condition     |                Action               | New State |
+==================+=====================================+===========+
|   SYNACK &amp;&amp; C    |  Verify Adjacency State; Send ACK   |   ESTAB   |
+------------------+-------------------------------------+-----------+
|   SYNACK &amp;&amp; !C   |            Send RSTACK              |  SYNRCVD  |
+------------------+-------------------------------------+-----------+
|       SYN        | Record Adjacency State; Send SYNACK |  SYNRCVD  |
+------------------+-------------------------------------+-----------+
|  ACK &amp;&amp; B &amp;&amp; C   |              Send ACK               |   ESTAB   |
+------------------+-------------------------------------+-----------+
| ACK &amp;&amp; !(B &amp;&amp; C) |            Send RSTACK              |  SYNRCVD  |
+====================================================================+

            </pre>
<div id="#rfc.figure.9"></div>
<pre>

 State: ESTAB
 
+====================================================================+
|    Condition     |                Action               | New State |
+==================+=====================================+===========+
|  SYN || SYNACK   |           Send ACK (note 2)         |   ESTAB   |
+------------------+-------------------------------------+-----------+
|  ACK &amp;&amp; B &amp;&amp; C   |           Send ACK (note 3)         |   ESTAB   |
+------------------+-------------------------------------+-----------+
| ACK &amp;&amp; !(B &amp;&amp; C) |              Send RSTACK            |   ESTAB   |
+====================================================================+

            </pre>
<p id="rfc.section.3.5.2.2.1.p.1">Note 2: No more than two ACKs should be sent within any time period of length defined by the timer.  Thus, one ACK MUST be sent every time the timer expires.  In addition, one further ACK may be sent between timer expirations if the incoming message is a SYN or SYNACK.  This additional ACK allows the adjacency protocol to reach synchronisation more quickly.</p>
<p id="rfc.section.3.5.2.2.1.p.2">Note 3: No more than one ACK should be sent within any time period of length defined by the timer.</p>
<h1 id="rfc.section.3.5.2.3">
<a href="#rfc.section.3.5.2.3">3.5.2.3.</a> <a href="#adjSYN" id="adjSYN">The Adjacency Protocol SYN Message</a>
</h1>
<h1 id="rfc.section.3.5.2.3.1">
<a href="#rfc.section.3.5.2.3.1">3.5.2.3.1.</a> <a href="#SYNsnd" id="SYNsnd">Action By the Sender</a>
</h1>
<p id="rfc.section.3.5.2.3.1.p.1">The SYN message is sent in accordance with the state tables just described. The sender sets the individual fields as follows: </p>

<dl>
<dt>Version:</dt>
<dd style="margin-left: 8">SHOULD be set to the highest version of ANCP that the sender supports.</dd>
<dt>Message Type:</dt>
<dd style="margin-left: 8">MUST be set to 10.</dd>
<dt>Timer:</dt>
<dd style="margin-left: 8">SHOULD be set to the value configured in the AN or NAS sending the message. </dd>
<dt>M Flag</dt>
<dd style="margin-left: 8">MUST be set to 1 by the NAS, and 0 by the AN.</dd>
<dt>Code:</dt>
<dd style="margin-left: 8">MUST be set to 1 (SYN).</dd>
<dt>Sender Name</dt>
<dd style="margin-left: 8">set as described in <a href="#adjFmt">Section 3.5.1</a>.</dd>
<dt>Receiver Name:</dt>
<dd style="margin-left: 8">SHOULD be set to 0.</dd>
<dt>Sender Port</dt>
<dd style="margin-left: 8">set as described in <a href="#adjFmt">Section 3.5.1</a>.</dd>
<dt>Receiver Port:</dt>
<dd style="margin-left: 8">SHOULD be set to 0.</dd>
<dt>PType:</dt>
<dd style="margin-left: 8">set according to the following rules: <ul class="empty">
<li>Settings by the AN: <ul class="empty">
<li>0 - the AN does not support partitions;</li>
<li>2 - the value of Partition ID contained in this message is assigned to the current partition.</li>
</ul>
<p> </p>
</li>
<li>Settings by the NAS: <ul class="empty">
<li>0 - the NAS leaves the decision on partitioning to the AN (RECOMMENDED setting);</li>
<li>1 - the NAS requests that the AN use the value of Partition ID contained in this message for the current partition.  The NAS MUST be prepared to use whatever value it receives in a SYN or SYNACK message, even if this differs from the requested value.</li>
</ul>
<p> </p>
</li>
</ul>
<p> </p>
</dd>
<dt>PFlag:</dt>
<dd style="margin-left: 8">set to the mode of adjacency setup (new adjacency vs. recovered adjacency) requested by the sender.  Warning: setting PFlag=1 runs the risk of state mismatch because ANCP does not provide the means for the NAS to audit the current state of the AN.</dd>
<dt>Sender Instance:</dt>
<dd style="margin-left: 8">set as described in <a href="#adjFmt">Section 3.5.1</a>.</dd>
<dt>Partition ID:</dt>
<dd style="margin-left: 8">MUST be set to 0 if PType=0, otherwise set to the assigned or requested partition identifier value.</dd>
<dt>Receiver Instance:</dt>
<dd style="margin-left: 8">SHOULD be set to 0.</dd>
<dt># of Caps:</dt>
<dd style="margin-left: 8">MUST be set to the number of Capability fields that follow.</dd>
<dt>Total Length:</dt>
<dd style="margin-left: 8">MUST be set to the total number of bytes in the Capability fields that follow.</dd>
<dt>Capability Fields:</dt>
<dd style="margin-left: 8">one Capability field MUST be present for each ANCP capability for which the sender wishes to advertise support.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.5.2.3.2">
<a href="#rfc.section.3.5.2.3.2">3.5.2.3.2.</a> <a href="#SYNrcv" id="SYNrcv">Action By the Receiver</a>
</h1>
<p id="rfc.section.3.5.2.3.2.p.1">Upon receiving a validly-formed SYN message, the receiver first checks the value of the Version field. If this value is not within the range of ANCP versions that the receiver supports, the message MUST be silently ignored. Similarly, the message is silently ignored if the M-flag is 0 and the receiver is an AN, or if the M-flag is 1 and the receiver is a NAS. If these checks are passed and the receiver is in ESTAB state, it returns an ACK (as indicated by the ESTAB state table in <a href="#adjStatTab">Section 3.5.2.2.1</a>). The contents of the ACK MUST reflect the adjacency state as previously recorded by the receiver.</p>
<p id="rfc.section.3.5.2.3.2.p.2">Otherwise, the receiver MUST record the adjacency state as follows: </p>

<dl>
<dt>Version:</dt>
<dd style="margin-left: 8">the supported Version value received in the SYN message. This value MUST be used for all subsequent ANCP messages sent during the life of the adjacency.</dd>
<dt>Timer:</dt>
<dd style="margin-left: 8">the larger of the Timer value received in the SYN message and the value with which the receiver is configured.</dd>
<dt>Sender Name:</dt>
<dd style="margin-left: 8">the value of the Sender Name field in the SYN message just received.</dd>
<dt>Receiver Name:</dt>
<dd style="margin-left: 8">the value used by the receiver in the Sender Name field of SYN, SYNACK, and ACK messages it sends in this adjacency.</dd>
<dt>Sender Port:</dt>
<dd style="margin-left: 8">the value of the Sender Port field in the SYN message just received.</dd>
<dt>Receiver Port:</dt>
<dd style="margin-left: 8">the value used by the receiver in the Sender Port field of SYN, SYNACK, and ACK messages it sends in this adjacency.</dd>
<dt>Sender Instance:</dt>
<dd style="margin-left: 8">the value of the Sender Instance field in the SYN message just received.</dd>
<dt>PFlag:</dt>
<dd style="margin-left: 8">the lesser of the value determined by local policy and the value received in the SYN message. That is, preference is given to "0 - New adjacency" if there is a conflict.</dd>
<dt>Partition ID:</dt>
<dd style="margin-left: 8">if the SYN receiver is the AN, this is set to 0 if the AN does not support partitions, or to the non-zero value of the partition identifier it chooses to assign otherwise.  If the SYN receiver is the NAS, this is set to the value of the Partition ID field copied from the SYN.</dd>
<dt>Receiver Instance:</dt>
<dd style="margin-left: 8">the value used by the receiver in the Sender Instance field of SYN, SYNACK, and ACK messages it sends in this adjacency.</dd>
<dt>Capabilities:</dt>
<dd style="margin-left: 8">the set of ANCP capabilities that were offered in the SYN and are supported by the receiver.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.5.2.4">
<a href="#rfc.section.3.5.2.4">3.5.2.4.</a> <a href="#adjSYNACK" id="adjSYNACK">The Adjacency Protocol SYNACK Message</a>
</h1>
<h1 id="rfc.section.3.5.2.4.1">
<a href="#rfc.section.3.5.2.4.1">3.5.2.4.1.</a> <a href="#SYNACKsnd" id="SYNACKsnd">Action By the Sender</a>
</h1>
<p id="rfc.section.3.5.2.4.1.p.1">The SYNACK is sent in response to a successfully received SYN message, as indicated by the state tables. The Version, Timer, PFlag, and Partition ID fields MUST be populated with the values recorded as part of adjacency state. The # of Caps, Total Length, and Capability fields MUST also be populated in accordance with the Capabilities recorded as part of adjacency state. The remaining fields of the SYNACK message MUST be populated as follows: </p>

<dl>
<dt>Message Type:</dt>
<dd style="margin-left: 8">MUST be 10.</dd>
<dt>M-flag:</dt>
<dd style="margin-left: 8">MUST be set to 0.</dd>
<dt>Code:</dt>
<dd style="margin-left: 8">MUST be 2 (SYNACK).</dd>
<dt>PType:</dt>
<dd style="margin-left: 8">MUST be 0 if the Partition ID value is 0, or 2 if the Partition ID value is non-zero.</dd>
<dt>Sender Name:</dt>
<dd style="margin-left: 8">MUST be set to the Receiver Name value recorded as part of adjacency state.</dd>
<dt>Receiver Name:</dt>
<dd style="margin-left: 8">MUST be set to the Sender Name value recorded as part of adjacency state.</dd>
<dt>Sender Port:</dt>
<dd style="margin-left: 8">MUST be set to the Receiver Port value recorded as part of adjacency state.</dd>
<dt>Receiver Port:</dt>
<dd style="margin-left: 8">MUST be set to the Sender Port value recorded as part of adjacency state.</dd>
<dt>Sender Instance:</dt>
<dd style="margin-left: 8">MUST be set to the Receiver Instance value recorded as part of adjacency state.</dd>
<dt>Receiver Instance:</dt>
<dd style="margin-left: 8">MUST be set to the Sender Instance value recorded as part of adjacency state.</dd>
</dl>

<p> </p>
<p id="rfc.section.3.5.2.4.1.p.2">If the set of capabilities recorded in the adjacency state is empty, then after sending the SYNACK the sender MUST raise an alarm to management, halt the adjacency procedure, and tear down the TCP session if it is not being used by anothewr adjacency. The sender MAY also terminate the IPSec security association if no other adjacency is using it.</p>
<h1 id="rfc.section.3.5.2.4.2">
<a href="#rfc.section.3.5.2.4.2">3.5.2.4.2.</a> <a href="#SYNACKrcv" id="SYNACKrcv">Action By the Receiver</a>
</h1>
<p id="rfc.section.3.5.2.4.2.p.1">As indicated by the state tables, the receiver of a SYNACK first checks that the Receiver Name, Receiver Port, and Receiver Instance values match the Sender Name, Sender Port, and Sender Instance values it sent in SYN message that is being acknowledged. The AN also checks that the PType and Partition ID match. If any of these checks fail, the receiver sends an RSTACK as described in <a href="#RSTACKsnd">Section 3.5.2.6.1</a>.  </p>
<p id="rfc.section.3.5.2.4.2.p.2">The receiver next checks whether the set of capabilities provided in the SYNACK is empty. If so, the receiver MUST raise an alarm to management and halt the adjacency procedure.</p>
<p id="rfc.section.3.5.2.4.2.p.3">Assuming that the SYNACK passes these checks, two cases arise. The first possibility is that the receiver has already recorded adjacency state. This will occur if the SYNACK is received while the receiver is in SYNRCVD state. In this case, the Version, Timer, Sender Name, Sender Port, Sender Instance, PFlag, and capability-related fields in the SYNACK MUST match those recorded as part of adjacency state.  If a mismatch is detected, the receiver sends an RSTACK. This is the "Verify Adjacency State" procedure shown in the SYNRCVD state table.</p>
<p id="rfc.section.3.5.2.4.2.p.4">If, on the other hand, the SYNACK is received while the receiver is in SYNSENT state, the receiver MUST record session state as described in <a href="#SYNrcv">Section 3.5.2.3.2</a>.</p>
<p id="rfc.section.3.5.2.4.2.p.5">In either case, if the receiver is the NAS, it MUST accept the Partition ID value provided in the SYNACK, updating its recorded adjacency state if necessary.</p>
<h1 id="rfc.section.3.5.2.5">
<a href="#rfc.section.3.5.2.5">3.5.2.5.</a> <a href="#adjACK" id="adjACK">The Adjacency Protocol ACK Message</a>
</h1>
<h1 id="rfc.section.3.5.2.5.1">
<a href="#rfc.section.3.5.2.5.1">3.5.2.5.1.</a> <a href="#ACKsnd" id="ACKsnd">Actions By the Sender</a>
</h1>
<p id="rfc.section.3.5.2.5.1.p.1">As indicated by the state tables, the ACK message is sent in a number of different circumstances. The main-line usages are as a response to SYNACK, leading directly to the ESTAB state, and as a periodic test of liveness once the ESTAB state has been reached.</p>
<p id="rfc.section.3.5.2.5.1.p.2">The sender MUST populate the ACK from recorded adjacency state, exactly as described in <a href="#SYNACKsnd">Section 3.5.2.4.1</a>. The only difference is that Code MUST be set to 3 (ACK).</p>
<h1 id="rfc.section.3.5.2.5.2">
<a href="#rfc.section.3.5.2.5.2">3.5.2.5.2.</a> <a href="#ACKrcv" id="ACKrcv">Actions By the Receiver</a>
</h1>
<p id="rfc.section.3.5.2.5.2.p.1">The required actions by the receiver are specified by the state tables. In addition to the checks B and C, the receiver SHOULD verify that the remaining contents of the ACK match the recorded adjacency state at the receiver. If that check fails the receiver MUST send an RSTACK as described in <a href="#RSTACKsnd">Section 3.5.2.6.1</a>. </p>
<p id="rfc.section.3.5.2.5.2.p.2">Once the adjacency has been established, either peer can initiate the ACK exchange that tests for liveness. To meet the restrictions on ACK frequency laid down in the notes to the state tables, it is desirable that only one such exchange occur during any one interval.  Hence if a peer receives an ACK when in ESTAB state, it MUST reply to that ACK as directed by the state tables, but SHOULD NOT initiate another ACK exchange in the same interval. To meet this objective, the receiver MUST reset its timer when it receives an ACK while in ESTAB state.  </p>

<ul class="empty"><li>It is, of course, possible that two exchanges happen because of race conditions.</li></ul>

<p> </p>
<h1 id="rfc.section.3.5.2.6">
<a href="#rfc.section.3.5.2.6">3.5.2.6.</a> <a href="#adjRSTACK" id="adjRSTACK">The Adjacency Protocol RSTACK Message</a>
</h1>
<h1 id="rfc.section.3.5.2.6.1">
<a href="#rfc.section.3.5.2.6.1">3.5.2.6.1.</a> <a href="#RSTACKsnd" id="RSTACKsnd">Action By the Sender</a>
</h1>
<p id="rfc.section.3.5.2.6.1.p.1">The RSTACK is sent in response to various error conditions as indicated by the state tables. In general it leads to a restart of adjacency negotiations (although this takes a few steps when the original sender of the RSTACK is in ESTAB state).</p>
<p id="rfc.section.3.5.2.6.1.p.2">As indicated in <a href="#adjFmt">Section 3.5.1</a>, the Sender Name, Port, and Instance fields in the RSTACK MUST be copied from the Receiver, Name, Port, and Instance fields in the message that caused the RSTACK to be sent. Similarly, the Receiver identifier fields in the RSTACK MUST be copied from the corresponding Sender identifier fields in the message that triggered the RSTACK. </p>
<p id="rfc.section.3.5.2.6.1.p.3">If the sender has recorded adjacency state, the Version, Timer, PType, PFlag, Partition ID, and capability-related fields SHOULD be set based on the recorded adjacency state. Otherwise they SHOULD be the same as the sender would send in a SYN message. The Message Type MUST be 10, the M-flag MUST be 0, and Code MUST be 4 (RSTACK).</p>
<h1 id="rfc.section.3.5.2.6.2">
<a href="#rfc.section.3.5.2.6.2">3.5.2.6.2.</a> <a href="#RSTACKrcv" id="RSTACKrcv">Action By the Receiver</a>
</h1>
<p id="rfc.section.3.5.2.6.2.p.1">The receiver of an RSTACK MAY attempt to diagnose the problem which caused the RSTACK to be generated by comparing its own adjacency state with the contents of the RSTACK. However, the primary purpose of the RSTACK is to trigger action as prescribed by <a href="#adjStatMach">Section 3.5.2.2</a>. </p>
<h1 id="rfc.section.3.5.2.7">
<a href="#rfc.section.3.5.2.7">3.5.2.7.</a> <a href="#adjLoss" id="adjLoss">Loss of Contact or Synchronization</a>
</h1>
<p id="rfc.section.3.5.2.7.p.1">Subsequent to adjacency establishment, if the adjacency times out on either end, due to not receiving an adjacency message for a duration of (3 * Timer value), all the state received from the ANCP peer SHOULD be cleaned up, and the TCP connection SHOULD be closed if it is not being used by another adjacency. If it is closed, the NAS MUST continue to listen for new connection requests. The AN MUST try to re-establish the TCP connection and both sides MUST attempt to re-establish the adjacency once that connection has been reestablished.</p>
<p id="rfc.section.3.5.2.7.p.2">After initial synchronization, if at any time a mismatch in adjacency state is detected, the adjacency MUST be brought down (RSTACK MUST be generated by the device detecting the mismatch), and synchronization MUST be re-attempted.  </p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> <a href="#ancpFormat" id="ancpFormat">ANCP General Message Formats</a>
</h1>
<p id="rfc.section.3.6.p.1">This section describes the general format of ANCP messages other than the adjacency messages. See <a href="#fig_genFmt">Figure 10</a></p>
<div id="#rfc.figure.10"></div>
<div id="#fig_genFmt"></div>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Version    | Message Type  | Result|      Result Code      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   | Partition ID  |            Transaction Identifier             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |I|      SubMessage Number      |           Length              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   ~                          Message Payload                      ~
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      </pre>
<h1 id="rfc.section.3.6.1">
<a href="#rfc.section.3.6.1">3.6.1.</a> <a href="#ANCPmsgHdr" id="ANCPmsgHdr">The ANCP Message Header</a>
</h1>
<p id="rfc.section.3.6.1.p.1">A complete explanation of the ANCP general message header fields follows.</p>
<h1 id="rfc.section.3.6.1.1">
<a href="#rfc.section.3.6.1.1">3.6.1.1.</a> <a href="#HDRvers" id="HDRvers">Version Field (8 bits)</a>
</h1>
<p id="rfc.section.3.6.1.1.p.1">This field carries the version of the ANCP protocol that was agreed for the session during adjacency negotiation. </p>
<h1 id="rfc.section.3.6.1.2">
<a href="#rfc.section.3.6.1.2">3.6.1.2.</a> <a href="#HDRmsgtyp" id="HDRmsgtyp">Message Type Field (8 bits)</a>
</h1>
<p id="rfc.section.3.6.1.2.p.1">This field indicates the ANCP message type. Message type values are registered in an IANA registry.</p>
<h1 id="rfc.section.3.6.1.3">
<a href="#rfc.section.3.6.1.3">3.6.1.3.</a> <a href="#HDRresult" id="HDRresult">Result Field (4 bits)</a>
</h1>
<p id="rfc.section.3.6.1.3.p.1">In request messages, the Result field indicates the circumstances under which a response is required. ANCP specifies what Result value each request message type should have. In responses the Result field indicates either Success (0x3) or Failure (0x4) as the case may be.  </p>

<dl>
<dt>Ignore:</dt>
<dd style="margin-left: 8">Res = 0x0 &#8211; Treat this field as a "no operation" and follow the response procedures specified for the received message type. </dd>
<dt>Nack:</dt>
<dd style="margin-left: 8">Res = 0x1 &#8211; Result value indicating that a response is expected to the request only in cases of failure caused during the processing of the message contents or of the contained directive(s). </dd>
<dt>AckAll:</dt>
<dd style="margin-left: 8">Res = 0x2 &#8211; Result value indicating that a response to the message is requested in all cases. </dd>
<dt>Success:</dt>
<dd style="margin-left: 8">Res = 0x3 &#8211; Result value indicating that this is a response and that the request was executed successfully. The Result Code field for a successful result is typically 0, but MAY take on other values as specified for particular message types.</dd>
<dt>Failure:</dt>
<dd style="margin-left: 8">Res = 0x4 &#8211; Result value indicating that this is a response and that the request was not executed successfully. The receiver of the response SHOULD take further action as indicated by the Result Code value and any diagnostic data contained in a Status-Info TLV included in the response.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.6.1.4">
<a href="#rfc.section.3.6.1.4">3.6.1.4.</a> <a href="#HDRcode" id="HDRcode">Result Code Field (12 bits)</a>
</h1>
<p id="rfc.section.3.6.1.4.p.1">This field gives further information concerning the result in a response message. It is mostly used to pass an error code in a failure response but can also be used to give further information in a success response message or an event message.  In a request message, the Result Code field is not used and MUST be set to 0x0 (No error).</p>
<p id="rfc.section.3.6.1.4.p.2">A number of Result Code values are specified below. Specification of additional Result Code values in extensions or updates to this document MUST include the following information: </p>

<ul>
<li>Result Code value;</li>
<li>One-line description;</li>
<li>Where condition detected: (control application or ANCP agent);</li>
<li>Further description (if any);</li>
<li>Required additional information in the response message;</li>
<li>Target (control application or ANCP agent at the peer that sent the original request);</li>
<li>Action RECOMMENDED for the receiving ANCP agent</li>
</ul>

<p> </p>
<p id="rfc.section.3.6.1.4.p.3">In addition to any suggested action in the text which follows, a count of the number of times a given non-zero Result Code value was received SHOULD be provided for management. Where an action includes resending of a request, a given request SHOULD NOT be re-sent more than once.</p>
<p id="rfc.section.3.6.1.4.p.4">This document specifies the following Result Code values.  </p>

<dl>
<dt>Result Code value: 2</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Invalid request message</li>
<li>Where condition detected: ANCP agent</li>
<li>Further description: The request was a properly formed message which violates the protocol through its timing or direction of transmission. The most likely reason for this outcome in the field will be a race condition.</li>
<li>Required additional information in the response message: none, if the response message is of the same type as the request. As specified in <a href="#genResp">Section 4.2</a> if the response message is a Generic Response message.</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: The original request MAY be re-sent once only after a short delay. Inform the control application with appropriate identification of the failed transaction if the second attempt fails or no second attempt is made.</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 6 </dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: One or more of the specified ports are down</li>
<li>Where condition detected: control application</li>
<li>Further description (if any):  This Result Code value indicates a state mismatch between the NAS and AN control applications, possibly due to a race condition.</li>
<li>Required additional information in the response message: if the request identified multiple access lines or the response is a Generic Response message, then the response MUST contain a Status-Info TLV encapsulating TLV(s) containing the line identifier(s) of the access lines that are not operational.</li>
<li>Target: control application at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: indicate the error and forward the line identifier(s) to the control application.</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 19</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Out of resources</li>
<li>Where condition detected: ANCP protocol layer or control application</li>
<li>Further description: (e.g., memory exhausted, etc.). This Result Code value MUST be reported only by the AN, and indicates a condition that is probably unrelated to specific access lines (although it may be related to the specific request).</li>
<li>Required additional information in the response message: none, if the response message is of the same type as the request. As specified in <a href="#genResp">Section 4.2</a> if the response message is a Generic Response message.</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: If the NAS receives this Result Code value from multiple requests for the same AN in a short interval, it SHOULD reduce the rate at which it sends requests in proportion to the rate at which requests are failing with Result Code = 19. It MAY retry individual requests. If only a specific request is failing with Result Code = 19, the ANCP agent in the NAS MAY request the control application to decompose the request into simpler components if this is possible.</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 81</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Request message type not implemented</li>
<li>Where condition detected: ANCP agent</li>
<li>Further description: This could indicate a mismatch in protocol version or capability state. It is also possible that support of a specific message is optional within some ANCP capability.</li>
<li>Required additional information in the response message: none, if the response message is of the same type as the request. As specified in <a href="#genResp">Section 4.2</a> if the response message is a Generic Response message.</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: If the receiver of this Result Code value expects that support of the message type concerned is mandatory according to the capabilities negotiated for the session, it MAY re-send the message in case the message was corrupted in transit the first time. If that fails, and use of the message type cannot be avoided, the ANCP agent MAY reset the adjacency by sending an RSTACK adjacency message (<a href="#RSTACKsnd">Section 3.5.2.6.1</a>) where PType is set to 0 and Sender and Receiver Name, Port, and Instance are taken from recorded adjacency state. If a reset does not eliminate the problem, the receiving ANCP agent SHOULD raise an alarm to management and then cease to operate.  </li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 83</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Malformed message</li>
<li>Where condition detected: ANCP agent</li>
<li>Further description: This could be the result of corruption in transit, or an error in implementation at one end or the other.</li>
<li>Required additional information in the response message: none, if the response message is of the same type as the request. As specified in <a href="#genResp">Section 4.2</a> if the response message is a Generic Response message.</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: The request SHOULD be re-sent once to eliminate the possibility of in-transit corruption.</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 84</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Mandatory TLV missing</li>
<li>Where condition detected: ANCP agent</li>
<li>Further description: none.</li>
<li>Required additional information in the response message: the response message MUST contain a Status-Info message that encapsulates an instance of each missing mandatory TLV, where the length is set to zero and the value field is empty (i.e., only the four-byte TLV header is present).</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: resend the message with the missing TLV(s), if possible. Otherwise, report the error to the control application with an indication of the missing information required to construct the missing TLV(s).</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 85 </dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: Invalid TLV contents</li>
<li>Where condition detected: ANCP agent</li>
<li>Further description: the contents of one or more TLVs in the request do not match the specifications provided for the those TLVs.</li>
<li>Required additional information in the response message: the response MUST contain a Status-Info TLV encapsulating the erroneous TLVs copied from the original request.</li>
<li>Target: ANCP agent at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: correct the error and resend the request, if possible.  Otherwise, report the error to the control application with an indication of the erroneous information associated with the invalid TLV(s).</li>
</ul>
<p> </p>
</dd>
<dt>Result Code value: 1280</dt>
<dd style="margin-left: 8">
<ul>
<li>One-line description: One or more of the specified ports do not exist</li>
<li>Where condition detected: control application</li>
<li>Further description (if any): this may indicate a configuration mismatch between the AN and the NAS or AAA.</li>
<li>Required additional information in the response message: if the request identified multiple access lines or the response is a Generic Response message, then the response MUST contain a Status-Info TLV encapsulating TLV(s) containing the rejected line identifier(s).</li>
<li>Target: control application at the peer that sent the original request</li>
<li>Action RECOMMENDED for the receiving ANCP agent: indicate the error and forward the line identifiers to the control application.</li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.6.1.5">
<a href="#rfc.section.3.6.1.5">3.6.1.5.</a> <a href="#HDRPartID" id="HDRPartID">Partition ID (8 bits)</a>
</h1>
<p id="rfc.section.3.6.1.5.p.1">The Partition ID field MUST contain the value that was negotiated for Partition ID during the adjacency procedure as described above.  </p>
<h1 id="rfc.section.3.6.1.6">
<a href="#rfc.section.3.6.1.6">3.6.1.6.</a> <a href="#HDRTransID" id="HDRTransID">Transaction ID (24 bits)</a>
</h1>
<p id="rfc.section.3.6.1.6.p.1">The Transaction ID is set by the sender of a request message to associate a response message with the original request message. Unless otherwise specified for a given message type, the Transaction ID in request messages MUST be set to a value in the range (1, 2^24 &#8211; 1). When used in this manner, the Transaction ID sequencing MUST be maintained independently for each message type within each ANCP adjacency. Furthermore, it SHOULD be incremented by 1 for each new message of the given type, cycling back to 1 after running the full range. For event messages, the Transaction ID SHOULD be set to zero.</p>
<p id="rfc.section.3.6.1.6.p.2">Unless otherwise specified, the default behaviour for all ANCP responses is that the value of the Transaction ID MUST be copied from the corresponding request message. </p>
<h1 id="rfc.section.3.6.1.7">
<a href="#rfc.section.3.6.1.7">3.6.1.7.</a> <a href="#HDRIflagSubmsg" id="HDRIflagSubmsg">I flag and SubMessage Number (1 + 15 bits)</a>
</h1>
<p id="rfc.section.3.6.1.7.p.1">In GSMPv3 these provide a mechanism for message fragmentation.  Because ANCP uses TCP transport, this mechanism is unnecessary.  An ANCP agent MUST set the I Flag and subMessage Number fields to 1 to signify "no fragmentation". </p>
<h1 id="rfc.section.3.6.1.8">
<a href="#rfc.section.3.6.1.8">3.6.1.8.</a> <a href="#HDRLen" id="HDRLen">Length (16 bits)</a>
</h1>
<p id="rfc.section.3.6.1.8.p.1">This field MUST be set to the length of the ANCP message in bytes, including its header fields and message body but excluding the four-byte encapsulating header defined in <a href="#transport">Section 3.2</a>. </p>
<h1 id="rfc.section.3.6.2">
<a href="#rfc.section.3.6.2">3.6.2.</a> <a href="#ANCPmsgBody" id="ANCPmsgBody">The ANCP Message Body</a>
</h1>
<p id="rfc.section.3.6.2.p.1">The detailed contents of the message payload portion of a given ANCP message can vary with the capability in the context of which it is being used. However, the general format consists of zero or more fixed fields, followed by a variable amount of data in the form of Type-Length-Value (TLV) data structures. </p>
<p id="rfc.section.3.6.2.p.2">The general format of a TLV is shown in <a href="#tlv_gen">Figure 11</a>:</p>
<div id="#rfc.figure.11"></div>
<div id="#tlv_gen"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|     Type (IANA registered)    |          Length               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                                                               |
~                            Value                              ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      </pre>
<p id="rfc.section.3.6.2.p.3">The fields of a TLV are defined as follows: </p>

<dl>
<dt>Type (16 bits):</dt>
<dd style="margin-left: 8">The TLV Type is an unsigned value identifying the TLV type and nature of its contents. An IANA registry has been established for ANCP TLV Type codes.</dd>
<dt>Length (16 bits):</dt>
<dd style="margin-left: 8">The number of bytes of data in the Value field of the TLV, excluding any padding required to bring this TLV to a 4-byte word boundary (see "Value" below). If a TLV contains other TLVs, any padding in the contained TLVs MUST be included in the value of Length. Depending on the specification of the TLV, the value of Length can be zero, a constant for all instances of the TLV, or a varying quantity.</dd>
<dt>Value (variable):</dt>
<dd style="margin-left: 8">The actual data carried by the TLV, if any.  The value field in each TLV MUST be padded with zeroes as required to align with a 4-byte word boundary. The Value field of a TLV MAY include fixed fields and/or other TLVs.</dd>
</dl>

<p> </p>
<p id="rfc.section.3.6.2.p.4">Unless otherwise specified, TLVs MAY be added to a message in any order. If the recipient of a message does not understand a particular TLV, it MUST silently ignore it.</p>
<p id="rfc.section.3.6.2.p.5">A number of TLVs are specified in the remainder of this document.</p>
<h1 id="rfc.section.3.7">
<a href="#rfc.section.3.7">3.7.</a> <a href="#msgPrincip" id="msgPrincip">General Principles for the Design of ANCP Messages</a>
</h1>
<p id="rfc.section.3.7.p.1">ANCP allows for two messaging constructs to support request/response interaction: <a href="#oam_CapProc">Section 8.4</a>, the second by specifications in <a href="#topolCapProc">Section 6.4</a>. The purpose of this section is to provide more details about the second approach in order to allow the use of this messaging construct for the development of additional ANCP extensions.</p>

<ol style="list-style-type: lower-alpha">
<li>The same message type is used for both the request message and the response message. The Result and Result Code field settings are used to differentiate between request and response messages.</li>
<li>The request and response messages use two different message types.</li>
</ol>

<p> The first approach is illustrated by the protocol specifications in </p>
<p id="rfc.section.3.7.p.2">As <a href="#ancpFormat">Section 3.6</a> indicated, all ANCP messages other than adjacency messages share a common header format. When the response message type is different from that of the request, the specification of the request message will typically indicate that the Result field is set to Ignore (0x0) and provide procedures indicating explicitly when the receiver should generate a response and what message type it should use.</p>
<p id="rfc.section.3.7.p.3">The Transaction ID field is used to distinguish between multiple request messages of the same type and to associate a response message to a request. Specifications of ANCP messages for applications not requiring response correlation SHOULD indicate that the Transaction ID MUST be set to zero in requests. Applications that require response correlation SHOULD refer to the Transaction ID behaviour described in <a href="#ANCPmsgHdr">Section 3.6.1</a>.</p>
<p id="rfc.section.3.7.p.4">The specification for a response message SHOULD indicate in all cases that value of the Transaction Identifier MUST be set to that of the corresponding request message. This allows the requester to establish whether or not correlation is needed (by setting a non-zero or zero value for the Transaction ID). </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#commonStuff" id="commonStuff">Generally Useful ANCP Messages and TLVs</a>
</h1>
<p id="rfc.section.4.p.1">This section defines two messages and a number of TLVs that could be useful in multiple capabilities. In some cases the content is under-specified, with the intention that particular capabilities spell out the remaining details.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#provis" id="provis">Provisioning Message</a>
</h1>
<p id="rfc.section.4.1.p.1">The Provisioning message is sent by the NAS to the AN to provision information of global scope (i.e., not associated with specific access lines) on the AN. The Provisioning message has the format shown in <a href="#fig_provis">Figure 12</a>. Support of the Provisioning message is OPTIONAL unless the ANCP agent claims support for a capability that requires its use.</p>
<div id="#rfc.figure.12"></div>
<div id="#fig_provis"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           TCP/IP Encapsulating Header (Section 3.2)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                ANCP General Message Header                    |     
+                      (Section 3.6.1)                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                             TLVs                              ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
      </pre>
<p id="rfc.section.4.1.p.2">The message header field settings given below are REQUIRED in the Provisioning message. The remaining message header fields MUST be set as specified in <a href="#ANCPmsgHdr">Section 3.6.1</a>. Which TLVs to carry in the Provisioning message is specified as part of the specification of the capabilities that use that message. The Provisioning message MAY be used to carry data relating to more than one capability at once, assuming that the capabilities concerned can co-exist and have all been negotiated during adjacency establishment.  </p>

<dl>
<dt>Message Type:</dt>
<dd style="margin-left: 8">MUST be set to 93.</dd>
<dt>Result:</dt>
<dd style="margin-left: 8">MUST be set to 0x0 (Ignore).</dd>
<dt>Result Code:</dt>
<dd style="margin-left: 8">MUST be set to zero.</dd>
<dt>Transaction ID:</dt>
<dd style="margin-left: 8">MUST be populated with a non-zero value chosen in the manner described in <a href="#HDRTransID">Section 3.6.1.6</a>.</dd>
</dl>

<p> </p>
<p id="rfc.section.4.1.p.3">If the AN can process the message successfully and accept all the provisioning directives contained in it, the AN MUST NOT send any response.</p>
<p id="rfc.section.4.1.p.4">Unless otherwise specified for a particular capability, if the AN fails to process the message successfully it MUST send a Generic Response message (<a href="#genResp">Section 4.2</a>) indicating failure and providing appropriate diagnostic information.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#genResp" id="genResp">Generic Response Message</a>
</h1>
<p id="rfc.section.4.2.p.1">This section defines the Generic Response message. The Generic Response message MAY be specified as the appropriate response to a message defined in an extension to ANCP, instead of a more specific response message. As a general guideline, specification of the Generic Response message as a response is appropriate where no data needs to be returned to the peer other than a result (success or failure), plus, in the case of a failure, a code indicating the reason for failure and a limited amount of diagnostic data. Depending on the particular use case, the Generic Response message MAY be sent by either the NAS or the AN.</p>
<p id="rfc.section.4.2.p.2">Support of the Generic Response message, both as sender and as receiver, is REQUIRED for all ANCP agents, regardless of what capabilities they support.</p>
<p id="rfc.section.4.2.p.3">The AN or NAS MAY send a Generic Response message indicating a failure condition independently of a specific request before closing the adjacency as a consequence of that failure condition. In this case, the sender MUST set the Transaction ID field in the header and the Message Type field within the Status-Info TLV to zeroes. The receiver MAY record the information contained in the Status-Info TLV for management use.</p>
<p id="rfc.section.4.2.p.4">The format of the Generic Response message is shown in <a href="#response">Figure 13</a></p>
<div id="#rfc.figure.13"></div>
<div id="#response"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           TCP/IP Encapsulating Header (Section 3.2)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                ANCP General Message Header                    |     
+                      (Section 3.6.1)                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                Access line identifying TLV(s)                 |     
+                (copied from original request)                 +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Status-Info TLV                            |
~                     (Section 4.5)                             ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
      </pre>
<p>NOTE: TLVs MAY be in a different order from what is shown in this figure.</p>
<p id="rfc.section.4.2.p.5">This document specifies the following header fields. The remaining fields in the ANCP general message header MUST be set as specified in <a href="#ANCPmsgHdr">Section 3.6.1</a>.  </p>

<dl>
<dt>Message Type:</dt>
<dd style="margin-left: 8">MUST be set to 91.</dd>
<dt>Result:</dt>
<dd style="margin-left: 8">MUST be set to 0x3 (Success) or 0x4 (Failure).</dd>
<dt>Result Code:</dt>
<dd style="margin-left: 8">MUST be set to zero for success or an appropriate non-zero value for failure.</dd>
<dt>Transaction ID:</dt>
<dd style="margin-left: 8">MUST be copied from the message to which this message is a response.</dd>
</dl>

<p> </p>
<p id="rfc.section.4.2.p.6">If the original request applied to a specific access line or set of lines, the TLVs identifying the line(s) and possibly the user MUST be copied into the Generic Response message at the top level.</p>
<p id="rfc.section.4.2.p.7">The Status-Info TLV MAY be present in a success response, to provide a warning as defined for a specific request message type. It MUST be present in a failure response.  See <a href="#error">Section 4.5</a> for a detailed description of the Status-Info TLV. The actual contents will depend on the request message type this message is responding to and the value of the Result Code field.</p>
<p id="rfc.section.4.2.p.8">To prevent an infinite loop of error responses, if the Generic Response message is itself in error, the receiver MUST NOT generate an error response in return.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#target" id="target">Target TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x1000 to 0x1020 depending on the specific content.  Only 0x1000 has been assigned in this specification (see below). Support of any specific variant of the Target TLV is OPTIONAL unless the ANCP agent claims support for a capability that requires its use.</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The Target TLV (0x1000 - 0x1020) is intended to be a general means to represent different types of objects.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">Variable, depending on the specific object type.</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Target information as defined for each object type.  The Value field MAY consist of sub-TLVs.</dd>
</dl>

<p> </p>
<p id="rfc.section.4.3.p.2">TLV Type 0x1000 is assigned to a variant of the Target TLV representing a single access line and encapsulating one or more sub-TLVs identifying the target. <a href="#fig_ALCtgt">Figure 14</a> is an example illustrating the TLV format for a single port identified by an Access-Loop-Circuit-ID TLV (0x0001) (<a href="#ALCItlv">Section 5.1.2.1</a>). </p>
<div id="#rfc.figure.14"></div>
<div id="#fig_ALCtgt"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|    TLV Type = 0x1000          |Length = Circuit-ID Length + 4 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
| Access-Loop-Circuit-ID=0x0001 |       Circuit-ID Length       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                                                               |
~                    Access Loop Circuit ID                     ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      </pre>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#command" id="command"> Command TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0011</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The Command TLV (0x0011) is intended to be a general means of encapsulating one or more command directives in a TLV oriented message. The semantics of the command can be specified for each message type using it. I.e., the specification of each message type that can carry the Command TLV is expected to define the meaning of the content of the payload, although re-use of specifications is, of course, permissible when appropriate. Support of any specific variant of the Command TLV is OPTIONAL unless the ANCP agent claims support for a capability that requires its use.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">Variable, depending on the specific contents.</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Command information as defined for each message type. The field MAY include sub-TLVs. The contents of this TLV MUST be specified as one "command" or alternatively a sequence of one or more "commands", each beginning with a one-byte Command Code and possibly including other data following the Command Code. An IANA registry has been established for Command Code values. This document reserves the Command Code value 0 as an initial entry in the registry.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> <a href="#error" id="error">Status-Info TLV</a>
</h1>
<p><a href="#fig_StatInfo">Figure 15</a> illustrates the Status-Info TLV.  </p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">Status-Info</dd>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0106</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The Status-Info-TLV is intended to be a general container for warning or error diagnostics relating to commands and/or requests. It is a supplement to the Result Code field in the ANCP general header. The specifications for individual message types MAY indicate the use of this TLV as part of responses, particularly for failures. As mentioned above, the Generic Response message will usually include an instance of the Status-Info TLV.  Support of the Status-Info TLV, both as sender and as receiver, is REQUIRED for all ANCP agents, regardless of what capabilities they support.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">Variable, depending on the specific contents.</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">The following fixed fields. In addition, sub-TLVs MAY be appended to provide further diagnostic information.  <dl>
<dt>Reserved (8 bits):</dt>
<dd style="margin-left: 8">see <a href="#resvUnused">Section 3.4</a> for handling of reserved fields.</dd>
<dt>Msg Type (8 bits):</dt>
<dd style="margin-left: 8">Message Type of the request for which this TLV is providing diagnostics.</dd>
<dt>Result Message Length (16 bits):</dt>
<dd style="margin-left: 8">Number of bytes in the error message, excluding padding, but including the language tag and delimiter. This MAY be zero if no error message is provided.</dd>
<dt>Result Message:</dt>
<dd style="margin-left: 8">Human-readable string providing information about the warning or error condition. The initial characters of the string MUST be a language tag as described in <a href="#RFC5646">[RFC5646]</a>, terminated by a colon (":"). The actual text string follows the delimiter. The field is padded at the end with zeroes as necessary to extend it to a four-byte word boundary.</dd>
</dl>
<p> </p>
<a href="#HDRcode">Section 3.6.1.4</a> provides recommendations for what TLVs to add in the Status-Info TLV for particular values of the message header Result Code field.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.15"></div>
<div id="#fig_StatInfo"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|    TLV Type = 0x0106          |              Length           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|    Reserved   |  Msg Type     |      Error Message Length     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|        Error Message (padded to 4 byte boundary)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|           optional sub-TLVs...                                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      </pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#DSLcapab" id="DSLcapab">Introduction To ANCP Capabilities For Digital Subscriber Lines (DSL)</a>
</h1>
<p id="rfc.section.5.p.1">DSL is a widely deployed access technology for Broadband Access for Next Generation Networks. Specifications such as <a href="#TR-059">[TR-059]</a>, <a href="#TR-058">[TR-058]</a>, and <a href="#TR-092">[TR-092]</a> describe possible architectures for these access networks. The scope of these specifications includes the delivery of voice, video, and data services.</p>
<p id="rfc.section.5.p.2">The next three sections of this document specify basic ANCP capabilities for use specifically in controlling Access Nodes serving DSL access (Tech Type = 0x05). The same ANs could be serving other access technologies (e.g. Metro-Ethernet, Passive Optical Networking, WiMax), in which case the AN will also have to support the corresponding other-technology-specific capabilities. Those additional capabilities are outside the scope of the present document. </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#DSLLineID" id="DSLLineID">DSL Access Line Identification</a>
</h1>
<p id="rfc.section.5.1.p.1">Most ANCP messages involve actions relating to a specific access line.  Thus it is necessary to describe how access lines are identified within those messages. This section defines four TLVs for that purpose and provides an informative description of how they are used. </p>
<h1 id="rfc.section.5.1.1">
<a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#DSLLineIDCtl" id="DSLLineIDCtl">Control Context (Informative)</a>
</h1>
<p id="rfc.section.5.1.1.p.1">Three types of identification are described in <a href="#TR-101">[TR-101]</a> and provided for in the TLVs defined in this section: </p>

<ul>
<li>identification of an access line by its logical appearance on the user side of the Access Node;</li>
<li>identification of an access line by its logical appearance on the NAS side of the Access Node; and</li>
<li>identification down to the user or host level as a supplement to access line identification in one of the other two forms.</li>
</ul>

<p> </p>
<p id="rfc.section.5.1.1.p.2">All of these identifiers originate with the AN control application, during the process of DSL topology discovery. The control application chooses which identifiers to use and the values to place into them on a line-by-line basis, based on AN configuration and deployment considerations.</p>
<p id="rfc.section.5.1.1.p.3">Aside from its use in ANCP signalling, access line identification is also used in DHCP (<a href="#RFC2131">[RFC2131]</a>, <a href="#RFC3315">[RFC3315]</a>) transactions involving hosts served by DSL. Either the AN or the NAS can serve as a DHCP relay node. <a href="#TR-101">[TR-101]</a> requires the AN or NAS in this role to add access line identification in Option 82 (Information) (<a href="#RFC3046">[RFC3046]</a>, with its IPv6 equivalent in <a href="#RFC4649">[RFC4649]</a>) to each DHCP request it forwards to the DHCP server. It is desirable for efficiency that the identification used in this signalling should be the same as the identification used in ANCP messages.</p>
<p id="rfc.section.5.1.1.p.4">From the point of view of ANCP itself, the identifiers are opaque.  From the point of view of the AN control application, the syntax for the user-side access line identifier is the same as specified in Section 3.9.3 of <a href="#TR-101">[TR-101]</a> for DHCP Option 82. The syntax for the ASCII form of the NAS-side access line identifier will be similar.</p>
<p id="rfc.section.5.1.1.p.5">Access line identification by logical appearance on the user side of the Access Node will always identify a DSL loop uniquely.  Identification by the logical appearance on the NAS side of the Access Node is unique only if there is a one-to-one mapping between the appearances on the two sides and no identity-modifying aggregation between the AN and the NAS. In other cases, and in particular in the case of Ethernet aggregation using the N:1 VLAN model, the user-side access line identification is necessary, but the NAS-side identification is potentially useful information allowing the NAS to build up a picture of the aggregation network topology.</p>
<p id="rfc.section.5.1.1.p.6">Additional identification down to the user or host level is intended to supplement rather than replace either of the other two forms of identification.  </p>

<ul class="empty"><li>Sections 3.8 and 3.9 of <a href="#TR-101">[TR-101]</a> are contradictory on this point. It is assumed here that Section 3.9 is meant to be authoritative.</li></ul>

<p> The user-level identification takes the form of an administered string which again is opaque at the ANCP level.</p>
<p id="rfc.section.5.1.1.p.7">The NAS control application will use the identifying information it receives from the AN directly for some purposes. For examples, see the introductory part of Section 3.9 of <a href="#TR-101">[TR-101]</a>. For other purposes, the NAS will build a mapping between the unique access line identification provided by the AN, the additional identification of the user or host (where provided), and the IP interface on a particular host. For access lines with static IP address assignment that mapping could be configured instead.</p>
<h1 id="rfc.section.5.1.2">
<a href="#rfc.section.5.1.2">5.1.2.</a> <a href="#DSLLineIDTLV" id="DSLLineIDTLV">TLVs For DSL Access Line Identification</a>
</h1>
<p id="rfc.section.5.1.2.p.1">This section provides a normative specification of the TLVs that ANCP provides to carry the types of identification just described.  The Access-Loop-Circuit-ID TLV identifies an access line by its logical appearance on the user side of the Access Node. Two alternatives, the Access-Aggregation-Circuit-ID-ASCII TLV and the Access-Aggregation-Circuit-ID-Binary TLV, identify an access line by its logical appearance on the NAS side of the Access Node.  It is unlikely that a given AN uses both of these TLVs, either for the same line or for different lines, since they carry equivalent information. Finally, the Access-Loop-Remote-Id TLV contains an operator-configured string that uniquely identifies the user on the associated access line, as described in Sections 3.9.1 and 3.9.2 of <a href="#TR-101">[TR-101]</a>.</p>
<p id="rfc.section.5.1.2.p.2">ANCP agents conforming to this section MUST satisfy the following requirements: </p>

<ul>
<li>ANCP agents MUST be able to build and send the Access-Loop-Circuit-ID TLV, the Access-Loop-Remote-Id TLV, and either the Access-Aggregation-Circuit-ID-ASCII TLV or the Access-Aggregation-Circuit-ID-Binary TLV (implementation choice), when passed the associated information from the AN control application.</li>
<li>ANCP agents MUST be able to receive all four TLV types, extract the relevant information, and pass it to the control application.</li>
<li>If the Access-Loop-Remote-Id TLV is present in a message, it MUST be accompanied by an Access-Loop-Circuit-ID TLV and/or an Access-Aggregation-Circuit-ID-xxx TLV with two VLAN identifiers.  <ul class="empty"><li>The Access-Loop-Remote-Id TLV is not enough to identify an access line uniquely on its own. As indicated above, an Access-Aggregation-Circuit-ID-xxx TLV with two VLAN identifiers may or may not identify an access line uniquely, but this is up to the control application to decide.</li></ul>
<p> </p>
</li>
<li>If the Access-Aggregation-Circuit-ID-xxx TLV is present in a message with just one VLAN identifier, it MUST be accompanied by an Access-Loop-Circuit-ID TLV.</li>
</ul>

<p> </p>
<h1 id="rfc.section.5.1.2.1">
<a href="#rfc.section.5.1.2.1">5.1.2.1.</a> <a href="#ALCItlv" id="ALCItlv">Access-Loop-Circuit-ID TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0001</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">a locally administered human-readable string generated by or configured on the Access Node, identifying the corresponding access loop logical port on the user side of the Access Node.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">up to 63 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">ASCII string</dd>
</dl>

<p> </p>
<h1 id="rfc.section.5.1.2.2">
<a href="#rfc.section.5.1.2.2">5.1.2.2.</a> <a href="#ALRItlv" id="ALRItlv">Access-Loop-Remote-Id TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0002</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">an operator-configured string that uniquely identifies the user on the associated access line, as described in Sections 3.9.1 and 3.9.2 of <a href="#TR-101">[TR-101]</a>. </dd>
<dt>Length:</dt>
<dd style="margin-left: 8">up to 63 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">ASCII string</dd>
</dl>

<p> </p>
<h1 id="rfc.section.5.1.2.3">
<a href="#rfc.section.5.1.2.3">5.1.2.3.</a> <a href="#AACIBtlv" id="AACIBtlv">Access-Aggregation-Circuit-ID-Binary TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0006</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">This TLV identifies or partially identifies a specific access line by means of its logical circuit identifier on the NAS side of the Access Node.  <br><br> For Ethernet access aggregation, where a per-subscriber (stacked) VLAN can be applied (1:1 model as defined in <a href="#TR-101">[TR-101]</a>), the TLV contains two value fields. Each field carries a 12-bit VLAN identifier (which is part of the VLAN tag defined by IEEE 802.1Q).  The first field MUST carry the inner VLAN identifier, while the second field MUST carry the outer VLAN identifier.  <br><br> When the N:1 VLAN model is used, only one VLAN tag is available.  For the N:1 model, the Access-Aggregation-Circuit-ID-Binary TLV contains a single value field, which MUST carry the 12-bit VLAN identifier derived from the single available VLAN tag.  <br><br> In the case of an ATM aggregation network, where the DSLAM is directly connected to the NAS (without an intermediate ATM switch), the VPI and VCI on the DSLAM uplink correspond uniquely to the DSL line on the DSLAM. The Access-Aggregation-Circuit-ID-Binary TLV MAY be used to carry the VPI and VCI. The first value field of the TLV MUST carry the VCI, while the second value field MUST carry the VPI.  <br><br> Each identifier MUST be placed in the low-order bits of its respective 32-bit field, with the higher-order bits set to zero. The ordering of the bits of the identifer MUST be the same as when the identifier is transmitted on the wire to identify an Ethernet frame or ATM cell.  <br><br> The Access-Aggregation-Circuit-ID-Binary is illustrated in <a href="#fig_aAggCIdBin">Figure 16</a>.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 or 8 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">one or two 32-bit binary fields.</dd>
</dl>

<p> </p>
<div id="#rfc.figure.16"></div>
<div id="#fig_aAggCIdBin"></div>
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    TLV Type = 0x0006          |        Length = 4 or 8        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
  |  Single VLAN Identifier, inner VLAN identifier, or VCI        |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
  |                Outer VLAN identifier or VPI                   |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
          </pre>
<h1 id="rfc.section.5.1.2.4">
<a href="#rfc.section.5.1.2.4">5.1.2.4.</a> <a href="#AACIAtlv" id="AACIAtlv">Access-Aggregation-Circuit-ID-ASCII TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0003</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">This TLV transmits the ASCII equivalent of the Access-Aggregation-Circuit-ID-Binary TLV. As mentioned in the previous section, the AN control application will use a format similar to that specified in Section 3.9.3 of <a href="#TR-101">[TR-101]</a> for the format of the "circuit-id".  <br><br> As an extension to the present document, the Access Node could convey to the NAS the characteristics (e.g., bandwidth) of the uplink on the Access Node. This TLV or the binary equivalent defined above then serves the purpose of uniquely identifying the uplink whose characteristics are being defined. The present document does not specify the TLVs needed to convey the uplink characteristics. </dd>
<dt>Length:</dt>
<dd style="margin-left: 8">up to 63 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">ASCII string</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#topol" id="topol">ANCP Based DSL Topology Discovery</a>
</h1>
<p id="rfc.section.6.p.1">Section 3.1 of <a href="#RFC5851">[RFC5851]</a> describes the requirements for the DSL Topology Discovery capability.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#topolCtl" id="topolCtl">Control Context (Informative)</a>
</h1>
<p id="rfc.section.6.1.p.1">The AN control application in the DSLAM requests ANCP to send a DSL-specific Port Up message to the NAS under the following circumstances: </p>

<ul>
<li>when a new adjacency with the NAS is established, for each DSL loop that is synchronized at that time;</li>
<li>subsequent to that, whenever a DSL loop resynchronizes; and</li>
<li>whenever the AN control application wishes to signal that a line attribute has changed.</li>
</ul>

<p> </p>
<p id="rfc.section.6.1.p.2">The AN control application in the DSLAM requests ANCP to send a DSL-specific Port Down message to the NAS under the following circumstances: </p>

<ul>
<li>when a new adjacency with the NAS is established, for each DSL loop that is provisioned but not synchronized at that time;</li>
<li>whenever a DSL loop that is equipped in an AN but administratively disabled is signalled as "IDLE"; and</li>
<li>subsequent to that, whenever a DSL loop loses synchronization.</li>
</ul>

<p> </p>
<p id="rfc.section.6.1.p.3">The AN control application passes information to identify the DSL loop to ANCP to include in the Port Up or Port Down message, along with information relating to DSL loop attributes.</p>
<p id="rfc.section.6.1.p.4">In the case of bonded copper loops to the customer premise (as per DSL multi-pair bonding described by [G.988.1] and [G.988.2]), the AN control application requests that ANCP send DSL-specific Port Up and Port Down messages for the aggregate "DSL bonded circuit" (represented as a single logical port) as well as the individual DSL loops of which it is comprised. The information relating to DSL line attributes that is passed by the AN control application is aggregate information.</p>
<p id="rfc.section.6.1.p.5">ANCP generates the DSL-specific Port Up or Port Down message and transfers it to the NAS. ANCP on the NAS side passes an indication to the NAS control application that a DSL Port Up or Port Down message has been received along with the information contained in the message.</p>
<p id="rfc.section.6.1.p.6">The NAS control application updates its view of the DSL loop state, performs any required accounting operations, and uses any included line attributes to adjust the operation of its queueing/scheduling mechanisms as they apply to data passing to and from that DSL loop.</p>
<p><a href="#fig_discov">Figure 17</a> summarizes the interaction.</p>
<div id="#rfc.figure.17"></div>
<div id="#fig_discov"></div>
<pre>
        
1.   Home            Access                          NAS
    Gateway           Node
                   
          -----------&gt;     --------------------------&gt;
               DSL          Port Up (Event message)
              Signal        (default line parameters)
   
2.   Home            Access                          NAS
    Gateway           Node
                   
          -----------&gt;     --------------------------&gt;
               DSL           Port Up (Event message)
             Resynch        (updated line parameters)
             
3.   Home            Access                          NAS
    Gateway           Node
                   
          -----------&gt;     --------------------------&gt;
          Loss of          Port Down (Event message)
          DSL Signal       (selected line parameters)
    </pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#topProtReq" id="topProtReq">Protocol Requirements</a>
</h1>
<p id="rfc.section.6.2.p.1">The DSL topology discovery capability is assigned capability type 0x0001. No capability data is associated with this capability. </p>
<h1 id="rfc.section.6.2.1">
<a href="#rfc.section.6.2.1">6.2.1.</a> <a href="#topANReq" id="topANReq">Protocol Requirements On the AN Side</a>
</h1>
<p id="rfc.section.6.2.1.p.1">The AN-side ANCP agent MUST be able to create DSL-specific Port Up and Port Down messages according to the format specified in <a href="#topolCapMsg">Section 6.3</a>.</p>
<p id="rfc.section.6.2.1.p.2">The AN-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.6.2.1.p.3">The AN-side ANCP agent MUST follow the AN-side procedures associated with DSL-specific Port Up and Port Down messages as they are specified in <a href="#topolCapProc">Section 6.4</a>.</p>
<h1 id="rfc.section.6.2.2">
<a href="#rfc.section.6.2.2">6.2.2.</a> <a href="#topNASReq" id="topNASReq">Protocol Requirements On the NAS Side</a>
</h1>
<p id="rfc.section.6.2.2.p.1">The NAS-side ANCP agent MUST be able to receive and validate DSL-specific Port Up and Port Down messages according to the format specified in <a href="#topolCapMsg">Section 6.3</a>.</p>
<p id="rfc.section.6.2.2.p.2">The NAS-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.6.2.2.p.3">The NAS-side ANCP agent MUST follow the NAS-side procedures associated with DSL-specific Port Up and Port Down messages as they are specified in <a href="#topolCapProc">Section 6.4</a>.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#topolCapMsg" id="topolCapMsg">ANCP Port UP and Port DOWN Event Message Descriptions</a>
</h1>
<p id="rfc.section.6.3.p.1">The format of the ANCP Port UP and Port DOWN Event messages is shown in <a href="#port_up">Figure 18</a>.</p>
<div id="#rfc.figure.18"></div>
<div id="#port_up"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           TCP/IP Encapsulating Header (Section 3.2)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                ANCP General Message Header                    |     
+                      (Section 3.6.1)                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                         Port (unused)                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Port Session Number (unused)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Event Sequence Number (unused)                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+---                 Label (8 bytes, unused)                 ---+
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|x|x|x|x|x|x|x|x| Message Type  |   Tech Type   |  Reserved     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     # of TLVs                 | Extension Block length (bytes)|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                                                               |     
~                 Access line identifying TLV(s)                ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                DSL-Line-Attributes TLV                        |
~        (MANDATORY in Port Up, OPTIONAL in Port Down)          ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
      </pre>
<p>NOTE: TLVs MAY be in a different order from what is shown in this figure.</p>
<p id="rfc.section.6.3.p.2">See <a href="#ANCPmsgHdr">Section 3.6.1</a> for a description of the ANCP general message header. The Message Type field MUST be set to 80 for Port Up, 81 for Port Down.  The 12 bit Result Code field MUST be set to 0. The 4 bit Result field MUST be set to 0 (signifying Ignore).  The 24-bit Transaction Identifier field MUST be set to 0. Other fields in the general header MUST be set as described in <a href="#ancpFormat">Section 3.6</a>.</p>
<p id="rfc.section.6.3.p.3">The Port, Port Session Number, and Event Sequence Number fields (32 bits each) are not used by the DSL Topology Discovery capability.  The 64-bit Label field is also unused, and MUST be treated as an unused fixed 8-byte field. The handling of unused/reserved fields is described in <a href="#resvUnused">Section 3.4</a>. </p>
<p id="rfc.section.6.3.p.4">The remaining message fields belong to the "extension block", and are described as follows: </p>

<dl>
<dt>Extension Flags:</dt>
<dd style="margin-left: 8">The flag bits denoted by 'x' are currently unspecified and reserved. </dd>
<dt>Message Type:</dt>
<dd style="margin-left: 8">Message Type has the same value as in the general header (i.e., 80 or 81).</dd>
<dt>Tech Type:</dt>
<dd style="margin-left: 8">MUST be set to 0x05 (DSL).</dd>
<dt># of TLVs:</dt>
<dd style="margin-left: 8">the number of TLVs that follow, not counting TLVs encapsulated within other TLVs.</dd>
<dt>Extension Block Length:</dt>
<dd style="margin-left: 8">the total length of the TLVs carried in the extension block in bytes, including any padding within individual TLVs.</dd>
<dt>TLVs:</dt>
<dd style="margin-left: 8">one or more TLVs to identify a DSL line and zero or more TLVs to define its characteristics.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#topolCapProc" id="topolCapProc">Procedures</a>
</h1>
<h1 id="rfc.section.6.4.1">
<a href="#rfc.section.6.4.1">6.4.1.</a> <a href="#topANProc" id="topANProc">Procedures On the AN Side</a>
</h1>
<p id="rfc.section.6.4.1.p.1">The AN-side ANCP agent creates and transmits a DSL-specific Port Up or Port Down message when requested by the AN control application and presented with the information needed to build a valid message. It is RECOMMENDED that the Access Node use a dampening mechanism per DSL loop to control the rate at which state changes are communicated to the NAS.</p>
<p id="rfc.section.6.4.1.p.2">At the top level, the extension block within a DSL-specific Port Up or Port Down message MUST include TLVs from <a href="#DSLLineIDTLV">Section 5.1.2</a> to identify the DSL loop.</p>
<p id="rfc.section.6.4.1.p.3">TLVs presenting DSL line attributes (i.e., the TLVs specified in <a href="#DSLAttribTLV">Section 6.5</a>) MUST be encapsulated within the DSL-Line-Attributes TLV. When the DSL-Line-Attributes TLV is present in a message, it MUST contain at least one such TLV and will generally contain more than one. In the Port Up message, the DSL-Line-Attributes TLV MUST be present. In the Port Down message, the DSL-Line-Attributes TLV MAY be present.</p>
<h1 id="rfc.section.6.4.2">
<a href="#rfc.section.6.4.2">6.4.2.</a> <a href="#topNASProc" id="topNASProc">Procedures On the NAS Side</a>
</h1>
<p id="rfc.section.6.4.2.p.1">The NAS-side ANCP agent MUST be prepared to receive Port Up and Port Down messages for a given DSL loop or logical port at any time after negotiation of an adjacency has been completed.  It is possible for two Port Up messages in succession to be received for the same DSL loop without an intervening Port Down message, and vice versa.</p>
<p id="rfc.section.6.4.2.p.2">The NAS-side ANCP agent SHOULD validate each message against the specifications given in <a href="#topolCapMsg">Section 6.3</a> and the TLV specifications given in <a href="#DSLLineIDTLV">Section 5.1.2</a> and <a href="#DSLAttribTLV">Section 6.5</a>. If it finds an error it MAY generate a Generic Response message containing an appropriate Result Code value. If it does so, the message MUST contain copies of all of the identifier TLVs from <a href="#DSLLineIDTLV">Section 5.1.2</a> that were present in the Port Up or Port Down message. The message SHOULD also contain a Status-Info TLV which in turn contains other information appropriate to the message header Result Code value as described in <a href="#HDRcode">Section 3.6.1.4</a>.</p>
<p id="rfc.section.6.4.2.p.3">If the received message passes validation, the NAS-side ANCP agent extracts the information from the TLVs contained in the message and presents that information along with an indication of reported event type to the NAS control application. If validation of individual TLVs fails but the message as a whole can be processed, the NAS-side ANCP agent "may" pass the valid message contents to the NAS control application.</p>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> <a href="#DSLAttribTLV" id="DSLAttribTLV">TLVs For DSL Line Attributes</a>
</h1>
<p id="rfc.section.6.5.p.1">As specified above, the DSL-Line-Attributes TLV is inserted into the Port Up or Port Down message at the top level. The remaining TLVs defined below are encapsulated within the DSL-Line-Attributes TLV.</p>
<h1 id="rfc.section.6.5.1">
<a href="#rfc.section.6.5.1">6.5.1.</a> <a href="#DLAtlv" id="DLAtlv">DSL-Line-Attributes TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0004</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">This TLV encapsulates attribute values for a DSL line serving a subscriber.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">variable (up to 1024 bytes)</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">one or more encapsulated TLVs corresponding to DSL line attributes.  The DSL-Line-Attributes TLV MUST contain at least one TLV when it is present in a Port Up or Port Down message. The actual contents are determined by the AN control application.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.2">
<a href="#rfc.section.6.5.2">6.5.2.</a> <a href="#DTtlv" id="DTtlv">DSL-Type TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0091</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Indicates the type of transmission system in use.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">32 bit unsigned integer <ul class="empty">
<li>ADSL1 = 1</li>
<li>ADSL2 = 2</li>
<li>ADSL2+ = 3</li>
<li>VDSL1 = 4</li>
<li>VDSL2 = 5</li>
<li>SDSL = 6</li>
<li>OTHER = 0</li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.3">
<a href="#rfc.section.6.5.3">6.5.3.</a> <a href="#AcNDRUtlv" id="AcNDRUtlv">Actual-Net-Data-Rate-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0081</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Actual upstream net data rate on a DSL line.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.4">
<a href="#rfc.section.6.5.4">6.5.4.</a> <a href="#AcNDRDtlv" id="AcNDRDtlv">Actual-Net-Data-Rate-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0082</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Actual downstream net data rate on a DSL line.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.5">
<a href="#rfc.section.6.5.5">6.5.5.</a> <a href="#MNDRUtlv" id="MNDRUtlv">Minimum-Net-Data-Rate-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0083</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Minimum upstream net data rate desired by the operator.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.6">
<a href="#rfc.section.6.5.6">6.5.6.</a> <a href="#MNDRDtlv" id="MNDRDtlv">Minimum-Net-Data-Rate-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0084</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Minimum downstream net data rate desired by the operator.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.7">
<a href="#rfc.section.6.5.7">6.5.7.</a> <a href="#AtNDRUtlv" id="AtNDRUtlv">Attainable-Net-Data-Rate-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0085</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Maximum net upstream rate that can be attained on the DSL line.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.8">
<a href="#rfc.section.6.5.8">6.5.8.</a> <a href="#AtNDRDtlv" id="AtNDRDtlv">Attainable-Net-Data-Rate-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0086</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Maximum net downstream rate that can be attained on the DSL line.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.9">
<a href="#rfc.section.6.5.9">6.5.9.</a> <a href="#MxNDRUtlv" id="MxNDRUtlv">Maximum-Net-Data-Rate-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0087</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Maximum net upstream data rate desired by the operator.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.10">
<a href="#rfc.section.6.5.10">6.5.10.</a> <a href="#MxNDRDtlv" id="MxNDRDtlv">Maximum-Net-Data-Rate-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0088</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Maximum net downstream data rate desired by the operator.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.11">
<a href="#rfc.section.6.5.11">6.5.11.</a> <a href="#MNLPDRUtlv" id="MNLPDRUtlv">Minimum-Net-Low-Power-Data-Rate-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0089</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Minimum net upstream data rate desired by the operator in low power state. </dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.12">
<a href="#rfc.section.6.5.12">6.5.12.</a> <a href="#MNLPDRDtlv" id="MNLPDRDtlv">Minimum-Net-Low-Power-Data-Rate-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008A</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Minimum net downstream data rate desired by the operator in low power state. </dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Rate in Kbits/s as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.13">
<a href="#rfc.section.6.5.13">6.5.13.</a> <a href="#MIDUtlv" id="MIDUtlv">Maximum-Interleaving-Delay-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008B</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">maximum one way interleaving delay.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Time in ms as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.14">
<a href="#rfc.section.6.5.14">6.5.14.</a> <a href="#AIDUtlv" id="AIDUtlv">Actual-Interleaving-Delay-Upstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008C</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Value corresponding to the interleaver setting.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Time in ms as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.15">
<a href="#rfc.section.6.5.15">6.5.15.</a> <a href="#MIDDtlv" id="MIDDtlv">Maximum-Interleaving-Delay-Downstream TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008D</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">maximum one way interleaving delay.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Time in ms as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.16">
<a href="#rfc.section.6.5.16">6.5.16.</a> <a href="#AIDDtlv" id="AIDDtlv">Actual-Interleaving-Delay-Downstream</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008E</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Value corresponding to the interleaver setting.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Time in ms as a 32 bit unsigned integer</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.17">
<a href="#rfc.section.6.5.17">6.5.17.</a> <a href="#DSLLStlv" id="DSLLStlv">DSL-Line-State TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x008F</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The state of the DSL line.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">4 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">32 bit unsigned integer <ul class="empty">
<li>SHOWTIME = 1</li>
<li>IDLE = 2</li>
<li>SILENT = 3</li>
</ul>
<p> </p>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6.5.18">
<a href="#rfc.section.6.5.18">6.5.18.</a> <a href="#ALEtlv" id="ALEtlv">Access-Loop-Encapsulation TLV</a>
</h1>
<p><a href="#fig_ALEncaps">Figure 19</a>.  </p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0090</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The data link protocol and, optionally, the encapsulation overhead on the access loop. When this TLV is present, at least the data link protocol MUST be indicated. The encapsulation overhead MAY be indicated. The Access Node MAY choose to not convey the encapsulation on the access loop by specifying values of 0 (NA) for the two encapsulation fields.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">3 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">The three bytes (most to least significant) and valid set of values for each byte are defined as follows: <ul class="empty">
<li>Byte 1: Data Link <ul class="empty">
<li>ATM AAL5 = 0</li>
<li>ETHERNET = 1</li>
</ul>
<p> </p>
</li>
<li>Byte 2: Encapsulation 1 <ul class="empty">
<li>NA = 0</li>
<li>Untagged Ethernet = 1</li>
<li>Single-tagged Ethernet = 2</li>
<li>Double-tagged Ethernet = 3</li>
</ul>
<p> </p>
</li>
<li>Byte 3: Encapsulation 2 <ul class="empty">
<li>NA = 0</li>
<li>PPPoA LLC = 1</li>
<li>PPPoA NULL = 2</li>
<li>IPoA LLC = 3</li>
<li>IPoA NuLL = 4</li>
<li>Ethernet over AAL5 LLC with FCS = 5</li>
<li>Ethernet over AAL5 LLC without FCS = 6</li>
<li>Ethernet over AAL5 NULL with FCS = 7</li>
<li>Ethernet over AAL5 NULL without FCS = 8</li>
</ul>
<p> </p>
</li>
</ul>
<p> </p>
</dd>
</dl>

<p> The Access-Loop-Encapsulation TLV is illustrated in </p>
<div id="#rfc.figure.19"></div>
<div id="#fig_ALEncaps"></div>
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    TLV Type = 0x0090          |        Length = 3             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
  | Data link     |    Encaps 1   |    Encaps 2   | Padding (=0)  |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
        </pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#lineConfig" id="lineConfig">ANCP based DSL Line Configuration </a>
</h1>
<p id="rfc.section.7.p.1">The use case for ANCP-based DSL Line Configuration is described in Section 3.2 of <a href="#RFC5851">[RFC5851]</a>.</p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#line_cfg_msg_flow" id="line_cfg_msg_flow">Control Context (Informative)</a>
</h1>
<p id="rfc.section.7.1.p.1">Triggered by topology information reporting a new DSL line or triggered by a subsequent user session establishment (via PPP or DHCP), RADIUS/AAA sends service parameters to the NAS control application for configuration on the access line. The NAS control application passes the request on to the NAS-side agent, which sends the information to the AN by means of a Port Management (line configuration) message.  The AN-side agent passes this information up to the AN control application, which applies it to the line. <a href="#line_init_cfg">Figure 20</a> summarizes the interaction.</p>
<div id="#rfc.figure.20"></div>
<div id="#line_init_cfg"></div>
<pre>
  Home            Access               NAS             RADIUS/AAA
 Gateway           Node                             Policy Server
                   
       -----------&gt;     ---------------&gt;
           DSL          Port Up message)
          Signal       (line parameters)
          
       --------------------------------&gt;   --------------&gt;
               PPP/DHCP Session            Authentication &amp;
                                           authorization
                                         
                       &lt;----------------
                         Port Management message
                         (line configuration)
      </pre>
<p id="rfc.section.7.1.p.2">The NAS could update the line configuration as a result of a subscriber service change (e.g. triggered by the policy server).  <a href="#line_upd_cfg">Figure 21</a> summarizes the interaction.</p>
<div id="#rfc.figure.21"></div>
<div id="#line_upd_cfg"></div>
<pre>
User     Home            Access         NAS             
        Gateway           Node                             
 
             --------------------------&gt;
               PPP/DHCP Session
               
   -------------------------------------------------------&gt; Web portal,
               Service on demand                              OSS, etc.
                                                                 |
                                           &lt;--------------  RADIUS/AAA
                                             Change of     Policy Server
                                           authorization
                                           
                             &lt;------------
                              Port Management
                                  message
                              (new profile)
      </pre>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> <a href="#line_cfg_ProtReq" id="line_cfg_ProtReq">Protocol Requirements</a>
</h1>
<p id="rfc.section.7.2.p.1">The DSL line configuration capability is assigned capability type 0x0002. No capability data is associated with this capability.</p>
<h1 id="rfc.section.7.2.1">
<a href="#rfc.section.7.2.1">7.2.1.</a> <a href="#lcfgNASReq" id="lcfgNASReq">Protocol Requirements On the NAS Side</a>
</h1>
<p id="rfc.section.7.2.1.p.1">The NAS-side ANCP agent MUST be able to create DSL-specific Port Management (line configuration) messages according to the format specified in <a href="#line_cfg_CapMsg">Section 7.3</a>.</p>
<p id="rfc.section.7.2.1.p.2">The NAS-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.7.2.1.p.3">The NAS-side ANCP agent MUST follow the NAS-side procedures associated with DSL-specific Port Management (line configuration) messages as they are specified in <a href="#line_cfg_CapProc">Section 7.4</a>.</p>
<h1 id="rfc.section.7.2.2">
<a href="#rfc.section.7.2.2">7.2.2.</a> <a href="#lcfgANReq" id="lcfgANReq">Protocol Requirements On the AN Side</a>
</h1>
<p id="rfc.section.7.2.2.p.1">The AN-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.7.2.2.p.2">The AN-side ANCP agent MUST be able to receive and validate DSL-specific Port Management (line configuration) messages according to the format specified in <a href="#line_cfg_CapMsg">Section 7.3</a>.</p>
<p id="rfc.section.7.2.2.p.3">The AN-side ANCP agent MUST follow the AN-side procedures associated with DSL-specific Port Management (line configuration) messages as specified in <a href="#line_cfg_CapProc">Section 7.4</a>.</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> <a href="#line_cfg_CapMsg" id="line_cfg_CapMsg">ANCP Port Management (Line Configuration) Message Format</a>
</h1>
<p id="rfc.section.7.3.p.1">The ANCP Port Management message for DSL line configuration has the format shown in <a href="#Fig_line_cfg">Figure 22</a>.</p>
<div id="#rfc.figure.22"></div>
<div id="#Fig_line_cfg"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           TCP/IP Encapsulating Header (Section 3.2)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                ANCP General Message Header                    |     
+                      (Section 3.6.1)                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Port (unused)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Port Session Number (unused)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Event Sequence Number  (unused)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|x|x|x|x|x|x|x| Dur. (unused) |  Function=8   | X-Function=0  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Event Flags  (unused)       | Flow Control Flags  (unused)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|x|x|x|x|x|x|x|x| Message Type  |            Reserved           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     # of TLVs               | Extension Block length (bytes)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                                                               |     
~                 Access line identifying TLV(s)                ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                Line configuration TLV(s)                      ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
      </pre>
<p>NOTE: TLVs MAY be in a different order from what is shown in this figure.</p>
<p id="rfc.section.7.3.p.2">See <a href="#ancpFormat">Section 3.6</a> for a description of the ANCP general message header. The Message Type field MUST be set to 32.  The 12 bit Result Code field MUST be set to 0x0. The 4 bit Result field MUST be set to either 1 (NAck) or 2 (AckAll), as determined by policy on the NAS. The 24-bit Transaction Identifier field MUST be set to a positive value. Other fields in the general header MUST be set as described in <a href="#ancpFormat">Section 3.6</a>.</p>
<p id="rfc.section.7.3.p.3">The Port, Port Session Number, and Event Sequence Number fields are not used by the DSL Line Configuration capability. The handling of unused/reserved fields is described in <a href="#resvUnused">Section 3.4</a>. </p>
<p id="rfc.section.7.3.p.4">The remaining message fields are described as follows: </p>

<dl>
<dt>R Flag:</dt>
<dd style="margin-left: 8">not used by ANCP.</dd>
<dt>Additional Port Management flags:</dt>
<dd style="margin-left: 8">the flag bits marked 'x' following the R flag are not used by ANCP.</dd>
<dt>Duration:</dt>
<dd style="margin-left: 8">not used for DSL line configuration.</dd>
<dt>Function:</dt>
<dd style="margin-left: 8">action to be performed. For line configuration, Function MUST be set to 8 (Configure Connection Service Data). This action type requests the Access Node (i.e., DSLAM) to apply service configuration data contained in the line configuration TLVs to the DSL line designated by the access line identifying TLVs.</dd>
<dt>X-Function:</dt>
<dd style="margin-left: 8">qualifies the action set by Function. For DSL line configuration, this field MUST be set to 0.</dd>
<dt>Event Flags:</dt>
<dd style="margin-left: 8">not used by ANCP.</dd>
<dt>Flow Control Flags:</dt>
<dd style="margin-left: 8">not used by ANCP.</dd>
<dt>Extension Flags:</dt>
<dd style="margin-left: 8">the flag bits denoted by 'x' before the Message Type field are reserved for future use. </dd>
<dt>Message Type:</dt>
<dd style="margin-left: 8">Message Type has the same value as in the general header (i.e., 32).</dd>
<dt>Reserved (16 bits):</dt>
<dd style="margin-left: 8">reserved for future use.</dd>
<dt># of TLVs:</dt>
<dd style="margin-left: 8">the number of TLVs that follow, not counting TLVs encapsulated within other TLVs.</dd>
<dt>Extension Block Length:</dt>
<dd style="margin-left: 8">the total length of the TLVs carried in the extension block in bytes, including any padding within individual TLVs.</dd>
<dt>TLVs:</dt>
<dd style="margin-left: 8">two or more TLVs to identify a DSL line and configure its service data.</dd>
</dl>

<p> </p>
<p id="rfc.section.7.3.p.5">Other ANCP capabilities, either specific to DSL or technology-independent, MAY reuse the Port Management message for service configuration. If the settings of the fixed fields are compatible with the settings just described, the same Port Management message that is used for DSL line configuration MAY be used to carry TLVs relating to the other capabilities that apply to the same DSL loop. </p>
<p id="rfc.section.7.3.p.6">Use of the Port Management message for configuration MAY also be generalized to other access technologies, if the respective capabilities specify use of access line identifiers appropriate to those technologies in place of the identifiers defined in <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> <a href="#line_cfg_CapProc" id="line_cfg_CapProc">Procedures</a>
</h1>
<p id="rfc.section.7.4.p.1">Service configuration MAY be performed on an access line regardless of its current state.</p>
<h1 id="rfc.section.7.4.1">
<a href="#rfc.section.7.4.1">7.4.1.</a> <a href="#lcfgNASProc" id="lcfgNASProc">Procedures On the NAS Side</a>
</h1>
<p id="rfc.section.7.4.1.p.1">When requested by the NAS control application and presented with the necessary information to do so, the NAS-side agent MUST create and send a Port Management message with the fixed fields set as described in the previous section. The message MUST contain one or more TLVs to identify an access line according the requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.  The NAS MUST include one or more TLVs to configure line service parameters for that line. <a href="#line_cfg_TLVs">Section 7.5</a> currently identifies only one such TLV, Service-Profile-Name, but other TLVs MAY be added by extensions to ANCP. </p>
<h1 id="rfc.section.7.4.2">
<a href="#rfc.section.7.4.2">7.4.2.</a> <a href="#lcfgANProc" id="lcfgANProc">Procedures On the AN Side</a>
</h1>
<p id="rfc.section.7.4.2.p.1">The AN-side ANCP agent MUST be prepared to receive Port Management (line configuration) messages for a given DSL loop or logical port at any time after negotiation of an adjacency has been completed.</p>
<p id="rfc.section.7.4.2.p.2">The AN-side ANCP agent SHOULD validate each message against the specifications given in <a href="#line_cfg_CapMsg">Section 7.3</a> and the TLV specifications given in <a href="#DSLLineIDTLV">Section 5.1.2</a> and <a href="#line_cfg_TLVs">Section 7.5</a>.  If it finds an error it MUST return a Port Management response message which copies the Port Management request as it was received, but has the Result header field set to 0x04 (Failure) and the Result Code field set to the appropriate value. The AN-side agent MAY add a Status-Info TLV (<a href="#error">Section 4.5</a>) to provide further information on the error, particularly if this is recommended in <a href="#HDRcode">Section 3.6.1.4</a> for the given Result Code value. If it does so, the various length fields and the # of TLVs field within the message MUST be adjusted accordingly.</p>
<p id="rfc.section.7.4.2.p.3">If the received message passes validation, the AN-side ANCP agent "must" extract the information from the TLVs contained in the message and present that information to the AN control application. In addition, if the Result header field was set to 0x2 (AckAll) in the original request, the AN-side agent "must" indicate to the AN control application that a response is required. When the AN control application indicates that it has processed the request successfully, the AN-side agent MUST return a Port Management response message which duplicates the request except that the Result header field is set to 0x3 (Success). (The Result Code field, as in the original request, has value 0.) </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> <a href="#line_cfg_TLVs" id="line_cfg_TLVs">TLVs For DSL Line Configuration</a>
</h1>
<p id="rfc.section.7.5.p.1">Currently only the following TLV is specified for DSL line configuration.  More TLVs may be defined in a future version of this specification or in ANCP extensions for individual service attributes of a DSL line (e.g.  rates, interleaving delay, multicast channel entitlement access-list).</p>
<h1 id="rfc.section.7.5.1">
<a href="#rfc.section.7.5.1">7.5.1.</a> <a href="#SProfName" id="SProfName">Service-Profile-Name TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0005</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Reference to a pre-configured profile on the DSLAM that contains service specific data for the subscriber.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">up to 64 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">ASCII string containing the profile name (which the NAS learns from a policy server after a subscriber is authorized).</dd>
</dl>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#oamCAP" id="oamCAP">ANCP-Based DSL Remote Line Connectivity Testing</a>
</h1>
<p id="rfc.section.8.p.1">The use case and requirements for ANCP-Based DSL remote line connectivity testing are specified in Section 3.3 of <a href="#RFC5851">[RFC5851]</a></p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Control Context (Informative)</h1>
<p id="rfc.section.8.1.p.1">The NAS control application initiates a request for remote connectivity testing for a given access loop. The NAS control application can provide loop count and timeout test parameters and opaque data for its own use with the request. The loop count parameter indicates the number of test messages or cells to be used. The timeout parameter indicates the longest that the NAS control application will wait for a result.</p>
<p id="rfc.section.8.1.p.2">The request is passed in a Port Management (OAM) message. If the NAS control application has supplied test parameters, they are used, otherwise the AN control application uses default test parameters. If a loop count parameter provided by the NAS is outside the valid range, the AN does not execute the test, but returns a result indicating that the test has failed due to an invalid parameter. If the test takes longer than the timeout value (default or provided by the NAS) the AN control application can return a failure result indicating timeout or else can send no response.  The AN control application can provide a human-readable string describing the test results, for both failures and successes. If provided, this string is included in the response. Responses always include the opaque data, if any, provided by the NAS control application.</p>
<p><a href="#fig_oam">Figure 23</a> summarizes the interaction.</p>
<div id="#rfc.figure.23"></div>
<div id="#fig_oam"></div>
<pre>
+-------------+    +-----+       +-------+           +----------------+       
|Radius/AAA   |----|NAS  |-------| DSLAM |-----------|    CPE         |     
|Policy Server|    +-----+       +-------+           | (DSL Modem +   |     
+-------------+                                      |Routing Gateway)|       
                                                     +----------------+
                 Port Management Message 
                 (Remote Loopback          ATM loopback 
                  Trigger Request)         OR EFM Loopback
               1.  ----------------&gt;     2. ---------&gt;
                                            &lt;--------+
                    3. &lt;---------------                        
                    Port Management Message
               (Remote Loopback Test Response)
      </pre>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#oam_ProtReq" id="oam_ProtReq">Protocol Requirements</a>
</h1>
<p id="rfc.section.8.2.p.1">The DSL remote line connectivity testing capability is assigned capability type 0x0004. No capability data is associated with this capability.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> <a href="#oam_NASReq" id="oam_NASReq">Protocol Requirements On the NAS Side</a>
</h1>
<p id="rfc.section.8.2.1.p.1">The NAS-side ANCP agent MUST be able to create DSL-specific Port Management (OAM) messages according to the format specified in <a href="#oam_CapMsg">Section 8.3</a>.</p>
<p id="rfc.section.8.2.1.p.2">The NAS-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.8.2.1.p.3">The NAS-side ANCP agent MUST follow the NAS-side procedures associated with DSL-specific Port Management (OAM) messages as they are specified in <a href="#oam_CapProc">Section 8.4</a>.</p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> <a href="#oam-ANReq" id="oam-ANReq">Protocol Requirements On the AN Side</a>
</h1>
<p id="rfc.section.8.2.2.p.1">The AN-side ANCP agent MUST conform to the normative requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.</p>
<p id="rfc.section.8.2.2.p.2">The AN-side ANCP agent MUST be able to receive and validate DSL-specific Port Management (OAM) messages according to the format specified in <a href="#oam_CapMsg">Section 8.3</a>.</p>
<p id="rfc.section.8.2.2.p.3">The AN-side ANCP agent MUST follow the AN-side procedures associated with DSL-specific Port Management (OAM) messages as specified in <a href="#oam_CapProc">Section 8.4</a>.</p>
<h1 id="rfc.section.8.3">
<a href="#rfc.section.8.3">8.3.</a> <a href="#oam_CapMsg" id="oam_CapMsg">Port Management (OAM) Message Format</a>
</h1>
<p id="rfc.section.8.3.p.1">The Port Management message for DSL line testing has the same format as for DSL line configuration (see <a href="#line_cfg_CapMsg">Section 7.3</a>), with the following differences: <a href="#fig_PM_OAM">Figure 24</a>.  </p>

<ul>
<li>The Result field in the request SHOULD be set to AckAll (0x1), to allow the NAS to receive the information contained in a successful test response.</li>
<li>The Function field MUST be set to 9 (Remote Loopback). (The X-Function field continues to be 0.)</li>
<li>The appended TLVs in the extension value field include testing-related TLVs rather than subcriber service information.</li>
</ul>

<p> The Port Management (OAM) message is illustrated in </p>
<div id="#rfc.figure.24"></div>
<div id="#fig_PM_OAM"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           TCP/IP Encapsulating Header (Section 3.2)           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                ANCP General Message Header                    |     
+                      (Section 3.6.1)                          +
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        Port (unused)                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 Port Session Number (unused)                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               Event Sequence Number  (unused)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|R|x|x|x|x|x|x|x| Dur. (unused) |  Function=9   | X-Function=0  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Event Flags  (unused)       | Flow Control Flags  (unused)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|x|x|x|x|x|x|x|x| Message Type  |            Reserved           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     # of TLVs               | Extension Block length (bytes)  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
|                                                               |     
~                 Access line identifying TLV(s)                ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                   Testing-related TLVs                        ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
      </pre>
<p>NOTE: TLVs MAY be in a different order from what is shown in this figure.</p>
<h1 id="rfc.section.8.4">
<a href="#rfc.section.8.4">8.4.</a> <a href="#oam_CapProc" id="oam_CapProc">Procedures</a>
</h1>
<p id="rfc.section.8.4.p.1">From the point of view of ANCP, it is permissible to attempt line connectivity testing regardless of the state of the line. However, testing could fail in some states due to technology limitations.</p>
<h1 id="rfc.section.8.4.1">
<a href="#rfc.section.8.4.1">8.4.1.</a> <a href="#oam-NASproc" id="oam-NASproc">NAS-Side Procedures</a>
</h1>
<p id="rfc.section.8.4.1.p.1">When requested by the NAS control application and presented with the necessary information to do so, the NAS-side agent creates and sends a Port Management (OAM) request with the fixed fields set as described in the previous section. The message MUST contain one or more TLVs to identify an access line according the requirements of <a href="#DSLLineIDTLV">Section 5.1.2</a>.  The NAS MAY include the Opaque-Data TLV and/or the OAM-Loopback-Test-Parameters TLV (defined in <a href="#oam_TLVs">Section 8.5</a>) to configure the loopback test for that line. </p>
<h1 id="rfc.section.8.4.2">
<a href="#rfc.section.8.4.2">8.4.2.</a> <a href="#oam-ANProc" id="oam-ANProc">AN-Side Procedures</a>
</h1>
<p id="rfc.section.8.4.2.p.1">The AN-side ANCP agent SHOULD validate each message against the specifications given in <a href="#oam_CapMsg">Section 8.3</a> and the TLV specifications given in <a href="#DSLLineIDTLV">Section 5.1.2</a> and <a href="#oam_TLVs">Section 8.5</a>.  If it finds an error it MUST return a Port Management response message which copies the Port Management request as it was received, but has the Result header field set to 0x04 (Failure) and the Result Code field set to the appropriate value.  Result Code value 0x509 as described below MAY apply, as well as the other Result Code values documented in <a href="#HDRcode">Section 3.6.1.4</a>. Result Code value 0x509 SHOULD be used if the OAM-Loopback-Test-Parameters TLV is present with an invalid value of the Count field. The AN-side agent MAY add a Status-Info TLV (<a href="#error">Section 4.5</a>) to provide further information on the error, particularly if this is recommended in <a href="#HDRcode">Section 3.6.1.4</a> for the given Result Code value. If it does so, the various length fields and the # of TLVs field within the message MUST be adjusted accordingly.</p>
<p id="rfc.section.8.4.2.p.2">If the received message passes validation, the AN-side ANCP agent extracts the information from the TLVs contained in the message and presents that information to the AN control application. It MUST NOT generate an immediate response to the request, but MUST instead wait for the AN control application to indicate that the response should be sent.</p>
<p id="rfc.section.8.4.2.p.3">When requested by the AN control application and presented with the necessary information to do so, the AN-side agent creates and sends a Port Management (OAM) response to the original request. The Result field MUST be set to Success (0x3) or Failure (0x4), and the Result Code field SHOULD be set to one of the following values, as indicated by the AN control application.  </p>

<dl>
<dt>0x500:</dt>
<dd style="margin-left: 8">Specified access line does not exist.  See the documentation of Result Code 0x500 in <a href="#HDRcode">Section 3.6.1.4</a> for more information. The Result header field MUST be set to Failure (0x4).</dd>
<dt>0x501:</dt>
<dd style="margin-left: 8">Loopback test timed out. The Result header field MUST be set to Failure (0x4).</dd>
<dt>0x503:</dt>
<dd style="margin-left: 8">DSL line status showtime</dd>
<dt>0x504:</dt>
<dd style="margin-left: 8">DSL line status idle</dd>
<dt>0x505:</dt>
<dd style="margin-left: 8">DSL line status silent</dd>
<dt>0x506:</dt>
<dd style="margin-left: 8">DSL line status training</dd>
<dt>0x507:</dt>
<dd style="margin-left: 8">DSL line integrity error</dd>
<dt>0x508:</dt>
<dd style="margin-left: 8">DSLAM resource not available.  The Result header field MUST be set to Failure (0x04).</dd>
<dt>0x509:</dt>
<dd style="margin-left: 8">Invalid test parameter. The Result header field MUST be set to Failure (0x4). </dd>
</dl>

<p> All other fields of the request including the TLVs MUST be copied into the response unchanged, except that in a successful response the OAM-Loopback-Test-Parameters TLV MUST NOT appear. If the AN control application has provided the necessary information, the AN-side agent MUST also include an instance of the OAM-Loopback-Test-Response-String TLV in the response. </p>
<h1 id="rfc.section.8.5">
<a href="#rfc.section.8.5">8.5.</a> <a href="#oam_TLVs" id="oam_TLVs">TLVs For the DSL Line Remote Connectivity Testing Capability</a>
</h1>
<p id="rfc.section.8.5.p.1">The following TLVs have been defined for use with the DSL line testing capability.</p>
<h1 id="rfc.section.8.5.1">
<a href="#rfc.section.8.5.1">8.5.1.</a> <a href="#OAMLTPtlv" id="OAMLTPtlv">OAM-Loopback-Test-Parameters TLV</a>
</h1>
<p><a href="#fig_LTParams">Figure 25</a> </p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0007</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Parameters intended to override the default values for this loopback test.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">2 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">two unsigned 1 byte fields described below (listed in order of most to least significant).  <ul class="empty">
<li>Byte 1: Count. Number of loopback cells/messages that should be generated on the local loop as part of the loopback test. The Count value SHOULD be greater than 0 and less than or equal to 32. </li>
<li>Byte 2: Timeout. Upper bound on the time in seconds that the NAS will wait for a response from the DSLAM. The value 0 MAY be used to indicate that the DSLAM MUST use a locally determined value for the timeout.  </li>
</ul>
<p> </p>
</dd>
</dl>

<p> The OAM-Loopback-Test-Parameters TLV is illustrated in </p>
<div id="#rfc.figure.25"></div>
<div id="#fig_LTParams"></div>
<pre>
   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
  |    TLV Type = 0x0007          |        Length = 2             |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
  |   Count       |  Timeout      |         Padding (=0)          |
  +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
        </pre>
<h1 id="rfc.section.8.5.2">
<a href="#rfc.section.8.5.2">8.5.2.</a> <a href="#ODtlv" id="ODtlv">Opaque-Data TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0008</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">An 8 byte opaque field used by the NAS control application for its own purposes (e.g., response correlation.) The procedures in <a href="#oam-ANProc">Section 8.4.2</a> ensure that if it is present in the request it is copied unchanged to the response.</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">8 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">Two 32 bit unsigned integers.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.8.5.3">
<a href="#rfc.section.8.5.3">8.5.3.</a> <a href="#OAMLTRStlv" id="OAMLTRStlv">OAM-Loopback-Test-Response-String TLV</a>
</h1>
<p></p>

<dl>
<dt>Type:</dt>
<dd style="margin-left: 8">0x0009</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">Suitably formatted string containing useful details about the test that the NAS will display for the operator, exactly as received from the DSLAM (no manipulation or interpretation by the NAS).</dd>
<dt>Length:</dt>
<dd style="margin-left: 8">up to 128 bytes</dd>
<dt>Value:</dt>
<dd style="margin-left: 8">UTF-8 encoded string of text.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">IANA NOTE: please replace "RFCXXXX" with the number of this specification.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#IANAsummary" id="IANAsummary">Summary</a>
</h1>
<p id="rfc.section.9.1.p.1">This section requests the following IANA actions: </p>

<ul>
<li>establishment of the following new ANCP registries: <ul class="empty">
<li>ANCP Message Types;</li>
<li>ANCP Result Codes;</li>
<li>ANCP Port Management Functions; </li>
<li>ANCP Technology Types;</li>
<li>ANCP Command Codes;</li>
<li>ANCP TLV Types;</li>
<li>ANCP Capabilities.</li>
</ul>
<p> </p>
</li>
<li>establishment of a new joint GSMP/ANCP version registry;</li>
<li>addition of ANCP as another user of TCP port 6068 in the port number registry at http://www.iana.org/assignments/port-numbers. The current user is GSMP.</li>
</ul>

<p> All of these actions are described in detail below except for the port registration, for which the final point above should provide sufficient information.  </p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#IANAact" id="IANAact">IANA Actions</a>
</h1>
<h1 id="rfc.section.9.2.1">
<a href="#rfc.section.9.2.1">9.2.1.</a> <a href="#msgIANA" id="msgIANA">ANCP Message Type Registry</a>
</h1>
<p id="rfc.section.9.2.1.p.1">IANA is requested to create a new registry, Access Network Control Protocol (ANCP) Message Types. Additions to that registry are permitted by Standards Action, as defined by <a href="#RFC5226">[RFC5226]</a>. The values for Message Type MAY range from 0 to 255, but new Message Types SHOULD be assigned values sequentially from 90 onwards (noting that 91 and 93 are already assigned).  The initial contents of the ANCP Message Types registry are as follows:</p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Message Type</th>
<th class="left">Message Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">10</td>
<td class="left">Adjacency Protocol</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">32</td>
<td class="left">Port Management</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">80</td>
<td class="left">Port Up</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">81</td>
<td class="left">Port Down</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">85</td>
<td class="left">Adjacency Update</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">91</td>
<td class="left">Generic Response</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">93</td>
<td class="left">Provisioning</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.2">
<a href="#rfc.section.9.2.2">9.2.2.</a> <a href="#resIANA" id="resIANA">ANCP Result Code Registry</a>
</h1>
<p id="rfc.section.9.2.2.p.1">IANA is requested to create a new registry, Access Network Control Protocol (ANCP) Result Codes. The documentation of new Result Codes MUST include the following information: </p>

<ul>
<li>Result Code value TBD (as assigned by IANA);</li>
<li>One-line description;</li>
<li>Where condition detected: (control application or ANCP agent);</li>
<li>Further description (if any);</li>
<li>Required additional information in the response message;</li>
<li>Target (control application or ANCP agent at the peer that sent the original request);</li>
<li>Action RECOMMENDED for the receiving ANCP agent</li>
</ul>

<p> </p>
<p id="rfc.section.9.2.2.p.2">The values for Result Code are expressed in hexadecimal, and MAY range from 0x0 to 0xFFFFFF. The range 0x0 to 0xFFF is reserved for allocation by the criterion of IETF Review, as defined by <a href="#RFC5226">[RFC5226]</a>. IANA SHOULD allocate new Result Code values from this range sequentially beginning at 0x100. The range 0x1000 onwards SHALL be allocated by the criterion of Specification Required, as defined by <a href="#RFC5226">[RFC5226]</a>. IANA SHOULD allocate new Result Code values from this range sequentially beginning at 0x1000. The initial contents of the ANCP Message Types registry are as follows:</p>
<div id="#rfc.table.2"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Result Code</th>
<th class="left">One-line description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0x0</td>
<td class="left">No result</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x2</td>
<td class="left">Invalid request message</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x6</td>
<td class="left">One or more of the specified ports are down</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x13</td>
<td class="left">Out of resources</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x51</td>
<td class="left">Request message type not implemented</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x53</td>
<td class="left">Malformed message</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x54</td>
<td class="left">Mandatory TLV missing</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x55</td>
<td class="left">Invalid TLV contents</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x500</td>
<td class="left">One or more of the specified ports do not exist</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x501</td>
<td class="left">Loopback test timed out (0x501)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x502</td>
<td class="left">Reserved (0x502)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x503</td>
<td class="left">DSL line status showtime (0x503)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x504</td>
<td class="left">DSL line status idle (0x504)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x505</td>
<td class="left">DSL line status silent (0x505)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x506</td>
<td class="left">DSL line status training (0x506)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x507</td>
<td class="left">DSL line integrity error (0x507)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x508</td>
<td class="left">DSLAM resource not available (0x508)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x509</td>
<td class="left">Invalid test parameter (0x509)</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.3">
<a href="#rfc.section.9.2.3">9.2.3.</a> <a href="#funcIANA" id="funcIANA">ANCP Port Management Function Registry</a>
</h1>
<p id="rfc.section.9.2.3.p.1">IANA is requested to create a new Access Network Control Protocol (ANCP) Port Management Function registry, with the following initial entries.  Additions to this registry will be by Standards Action, as defined by <a href="#RFC5226">[RFC5226]</a>. Values may range from 0 to 255. IANA SHOULD assign values sequentially beginning with 1, taking account of the values already assigned below.  </p>

<ul class="empty"><li>NOTE: future extensions of ANCP may need to establish sub-registries of permitted X-Function values for specific values of Function.</li></ul>

<p> </p>
<div id="#rfc.table.3"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Function Value</th>
<th class="left">Function Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">Reserved</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">8</td>
<td class="left">Configure Connection Service Data</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">9</td>
<td class="left">Remote Loopback</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.4">
<a href="#rfc.section.9.2.4">9.2.4.</a> <a href="#techIANA" id="techIANA">ANCP Technology Type Registry</a>
</h1>
<p id="rfc.section.9.2.4.p.1">IANA is requested to create a new Access Network Control Protocol (ANCP) Technology Type registry, with additions by Expert Review, as defined by <a href="#RFC5226">[RFC5226]</a>. The Technology Type MUST designate a distinct access transport technology. Values may range from 0 to 255.  IANA SHOULD assign new values sequentially beginning at 2, taking into account of the values already assigned below. The initial entries are as follows:</p>
<div id="#rfc.table.4"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Tech Type Value</th>
<th class="left">Tech Type Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">Not technology dependent</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">1</td>
<td class="left">PON</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">5</td>
<td class="left">DSL</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">255</td>
<td class="left">Reserved</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.5">
<a href="#rfc.section.9.2.5">9.2.5.</a> <a href="#cmdIANA" id="cmdIANA">ANCP Command Code Registry</a>
</h1>
<p id="rfc.section.9.2.5.p.1">IANA is requested to create a new Access Network Control Protocol (ANCP) Command Code registry, with additions by  Standards Action, as defined by <a href="#RFC5226">[RFC5226]</a>. Values may range from 0 to 255.  IANA SHOULD assign new values sequentially beginning with 1. The initial entry is as follows:</p>
<div id="#rfc.table.5"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Command Code Value</th>
<th class="left">Command Code Directive Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody><tr>
<td class="left">0</td>
<td class="left">Reserved</td>
<td class="left">RFCXXXX</td>
</tr></tbody>
</table>
<h1 id="rfc.section.9.2.6">
<a href="#rfc.section.9.2.6">9.2.6.</a> <a href="#TLV_IANA" id="TLV_IANA">ANCP TLV Type Registry</a>
</h1>
<p id="rfc.section.9.2.6.p.1">IANA is requested to create a new Access Network Control Protocol (ANCP) TLV Type registry. Values are expressed in hexadecimal and may range from 0x0000 to 0xFFFF. Additions in the range 0x0000 to 0x1FFF are by IETF Review, as defined by <a href="#RFC5226">[RFC5226]</a>. IANA SHOULD assign new values in this range sequentially beginning at 0x100 and taking account of the assignments already made below. Additions in the range 0x2000 to 0xFFFF are by Specification Required, again as defined by <a href="#RFC5226">[RFC5226]</a>. IANA SHOULD assign new values in this range sequentially beginning at 0x2000. In both cases, the documentation of the TLV MUST provide: </p>

<ul>
<li>a TLV name following the convention used for the initial entries (capitalized words separated by hyphens);</li>
<li>a brief description of the intended use;</li>
<li>a precise description of the contents of each fixed field, including its length, type, and units (if applicable);</li>
<li>identification of any mandatory encapsulated TLVs;</li>
<li>an indication of whether optional TLVs may be encapsulated, with whatever information is available on their identity (could range from a general class of information to specific TLV names, depending on the nature of the TLV being defined.</li>
</ul>

<p> The initial entries are as follows:</p>
<div id="#rfc.table.6"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Type Code</th>
<th class="left">TLV Name</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0x0000</td>
<td class="left">Reserved</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0001</td>
<td class="left">Access-Loop-Circuit-ID</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0002</td>
<td class="left">Access-Loop-Remote-Id</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0003</td>
<td class="left">Access-Aggregation-Circuit-ID-ASCII</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0004</td>
<td class="left">DSL-Line-Attributes</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0005</td>
<td class="left">Service-Profile-Name</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0006</td>
<td class="left">Access-Aggregation-Circuit-ID-Binary</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0007</td>
<td class="left">OAM-Loopback-Test-Parameters</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0008</td>
<td class="left">Opaque-Data</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0009</td>
<td class="left">OAM-Loopback-Test-Response-String</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0011</td>
<td class="left">Command</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0081</td>
<td class="left">Actual-Net-Data-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0082</td>
<td class="left">Actual-Net-Data-Rate-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0083</td>
<td class="left">Minimum-Net-Data-Rate-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0084</td>
<td class="left">Minimum-Net-Data-Rate-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0085</td>
<td class="left">Attainable-Net-Data-Rate-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0086</td>
<td class="left">Attainable-Net-Data-Rate-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0087</td>
<td class="left">Maximum-Net-Data-Rate-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0088</td>
<td class="left">Maximum-Net-Data-Rate-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0089</td>
<td class="left">Minimum-Net-Low-Power-Data-Rate-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008A</td>
<td class="left">Minimum-Net-Low-Power-Data-Rate-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008B</td>
<td class="left">Maximum-Interleaving-Delay-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008C</td>
<td class="left">Actual-Interleaving-Delay-Upstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008D</td>
<td class="left">Maximum-Interleaving-Delay-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008E</td>
<td class="left">Actual-Interleaving-Delay-Downstream</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x008F</td>
<td class="left">DSL-Line-State</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0090</td>
<td class="left">Access-Loop-Encapsulation</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0091</td>
<td class="left">DSL-Type</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x0106</td>
<td class="left">Status-Info</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x1000</td>
<td class="left">Target (single access line variant)</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">0x1001 - 0x1020</td>
<td class="left">Reserved for Target variants</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.7">
<a href="#rfc.section.9.2.7">9.2.7.</a> <a href="#capIANA" id="capIANA">ANCP Capability Type Registry</a>
</h1>
<p id="rfc.section.9.2.7.p.1">IANA is requested to create a new Access Network Control Protocol (ANCP) Capability Type registry, with additions by Standards Action as defined by <a href="#RFC5226">[RFC5226]</a>. Values may range from 0 to 255.  IANA SHOULD assign values sequentially beginning at 5. The specification for a given capability MUST indicate the Technology Type value with which it is associated. The specification MUST further indicate whether the capability is associated with any capability data. Normally a capability is expected to be defined in the same document that specifies the implementation of that capability in protocol terms. The initial entries in the ANCP capability registry are as follows:</p>
<div id="#rfc.table.7"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Value</th>
<th class="left">Capability Type Name</th>
<th class="left">Technology Type</th>
<th class="left">Capability Data</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">Reserved</td>
<td class="left"></td>
<td class="left"></td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">1</td>
<td class="left">DSL Topology Discovery</td>
<td class="left">5</td>
<td class="left">No</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">DSL Line Configuration</td>
<td class="left">5</td>
<td class="left">No</td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">Reserved</td>
<td class="left"></td>
<td class="left"></td>
<td class="left">RFCXXXX</td>
</tr>
<tr>
<td class="left">4</td>
<td class="left">DSL Line Testing</td>
<td class="left">5</td>
<td class="left">None</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.9.2.8">
<a href="#rfc.section.9.2.8">9.2.8.</a> <a href="#versIANA" id="versIANA">Joint GSMP / ANCP Version Registry</a>
</h1>
<p id="rfc.section.9.2.8.p.1">IANA is requested to create a new joint GSMP / ANCP Version registry.  Additions to this registry are by Standards Action as defined by <a href="#RFC5226">[RFC5226]</a>. Values may range from 0 to 255. Values for the General Switch Management Protocol (GSMP) MUST be assigned sequentially beginning with 4 for the next version. Values for the Access Network Control Protocol (ANCP) MUST be assigned sequentially beginning with 50 for the present version. The initial entries are as follows:</p>
<div id="#rfc.table.8"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">Version</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">1</td>
<td class="left">GSMP Version 1</td>
<td class="left">RFC1987</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">GSMP Version 2</td>
<td class="left">RFC2297</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">GSMP Version 3</td>
<td class="left">RFC3292</td>
</tr>
<tr>
<td class="left">50</td>
<td class="left">ANCP Version 1</td>
<td class="left">RFCXXXX</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#secur" id="secur">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">Security of the ANCP protocol is discussed in <a href="#RFC5713">[RFC5713]</a>. A number of security requirements on ANCP are stated in Section 8 of that document. Those applicable to ANCP itself are copied to the present document: </p>

<ul>
<li>The protocol solution MUST offer authentication of the AN to the NAS.</li>
<li>The protocol solution MUST offer authentication of the NAS to the AN.</li>
<li>The protocol solution MUST allow authorization to take place at the NAS and the AN.</li>
<li>The protocol solution MUST offer replay protection.</li>
<li>The protocol solution MUST provide data-origin authentication.</li>
<li>The protocol solution MUST be robust against denial-of-service (DoS) attacks.  In this context, the protocol solution MUST consider a specific mechanism for the DoS that the user might create by sending many IGMP messages.</li>
<li>The protocol solution SHOULD offer confidentiality protection.</li>
<li>The protocol solution SHOULD ensure that operations in default configuration guarantees a low number of AN/NAS protocol interactions.</li>
</ul>

<p> </p>
<p id="rfc.section.10.p.2">Most of these requirements relate to secure transport of ANCP. Robustness against denial-of-service attacks partly depends on transport and partly on protocol design. Ensuring a low number of AN/NAS protocol interactions in default mode is purely a matter of protocol design.</p>
<p id="rfc.section.10.p.3">For secure transport, either the combination of IPsec with IKEv2 (references below) or the use of TLS <a href="#RFC5246">[RFC5246]</a> will meet the requirements listed above. However, the use of TLS has been rejected.  The deciding point is a detail of protocol design that was unavailable when <a href="#RFC5713">[RFC5713]</a> was written.  The ANCP adjacency is a major point of vulnerability for denial-of-service attacks. If the adjacency can be shut down, either the AN clears its state pending reestablishment of the adjacency, or the possibility of mismatches between the AN's and NAS's view of state on the AN is opened up. Two ways to cause an adjacency to be taken down are to modify messages so that the ANCP agents conclude that they are no longer synchronized, or to attack the underlying TCP session. TLS will protect message contents, but not the TCP connection. One has to use either IPsec or the TCP authentication option <a href="#RFC5925">[RFC5925]</a> for that. Hence the conclusion that ANCP MUST run over IPsec with IKEv2 for authentication and key management.</p>
<p id="rfc.section.10.p.4">In greater detail: the ANCP stack MUST include IPsec <a href="#RFC4301">[RFC4301]</a> running in transport mode, since the AN and NAS are the endpoints of the path. The Encapsulating Security Payload (ESP) <a href="#RFC4303">[RFC4303]</a> MUST be used, in order to satisfy the requirement for data confidentiality.  ESP MUST be configured for the combination of confidentiality, integrity, anti-replay capability. The traffic flow confidentiality service of ESP is unnecessary and, in fact, unworkable in the case of ANCP.</p>
<p id="rfc.section.10.p.5">IKEv2 <a href="#RFC5996">[RFC5996]</a> is also REQUIRED, to meet the requirements for mutual authentication and authorization. Since the NAS and AN MAY be in different trust domains, the use of certificates for mutual authentication could be the most practical approach. However, this is up to the operator(s) concerned. </p>
<p id="rfc.section.10.p.6">The AN MUST play the role of initiator of the IKEv2 conversation.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.11.p.1">The authors would like to thank everyone who provided comments or inputs to this document. Swami Subramanian was an early member of the authors' team. The ANCP Working Group is grateful to Roberta Maglione, who served as design team member and primary editor of this document for two years before stepping down. The authors acknowledge the inputs provided by Wojciech Dec, Peter Arberg, Josef Froehler, Derek Harkness, Kim Hyldgaard, Sandy Ng, Robert Peschi, and Michel Platnic, and the further comments provided by Mykyta Yevstifeyev, Brian Carter, Ben Campbell, Alexey Melnikov, Adrian Farrel, Robert Sparks, Peter St. Andre, Sean Turner, and Dan Romascanu. </p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3292">[RFC3292]</b></td>
<td class="top">
<a>Doria, A.</a>, <a>Hellstrand, F.</a>, <a>Sundell, K.</a> and <a>T. Worster</a>, "<a href="http://tools.ietf.org/html/rfc3292">General Switch Management Protocol (GSMP) V3</a>", RFC 3292, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3293">[RFC3293]</b></td>
<td class="top">
<a>Worster, T.</a>, <a>Doria, A.</a> and <a>J. Buerkle</a>, "<a href="http://tools.ietf.org/html/rfc3293">General Switch Management Protocol (GSMP) Packet Encapsulations for Asynchronous Transfer Mode (ATM), Ethernet and Transmission Control Protocol (TCP)</a>", RFC 3293, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3629">[RFC3629]</b></td>
<td class="top">
<a>Yergeau, F.</a>, "<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>", STD 63, RFC 3629, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4303">[RFC4303]</b></td>
<td class="top">
<a>Kent, S.</a>, "<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>", RFC 4303, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5646">[RFC5646]</b></td>
<td class="top">
<a>Phillips, A.</a> and <a>M. Davis</a>, "<a href="http://tools.ietf.org/html/rfc5646">Tags for Identifying Languages</a>", BCP 47, RFC 5646, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5996">[RFC5996]</b></td>
<td class="top">
<a>Kaufman, C.</a>, <a>Hoffman, P.</a>, <a>Nir, Y.</a> and <a>P. Eronen</a>, "<a href="http://tools.ietf.org/html/rfc5996">Internet Key Exchange Protocol Version 2 (IKEv2)</a>", RFC 5996, September 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2131">[RFC2131]</b></td>
<td class="top">
<a href="mailto:droms@bucknell.edu" title="Computer Science Department">Droms, R.</a>, "<a href="http://tools.ietf.org/html/rfc2131">Dynamic Host Configuration Protocol</a>", RFC 2131, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3046">[RFC3046]</b></td>
<td class="top">
<a>Patrick, M.</a>, "<a href="http://tools.ietf.org/html/rfc3046">DHCP Relay Agent Information Option</a>", RFC 3046, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4649">[RFC4649]</b></td>
<td class="top">
<a>Volz, B.</a>, "<a href="http://tools.ietf.org/html/rfc4649">Dynamic Host Configuration Protocol for IPv6 (DHCPv6) Relay Agent Remote-ID Option</a>", RFC 4649, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5713">[RFC5713]</b></td>
<td class="top">
<a>Moustafa, H.</a>, <a>Tschofenig, H.</a> and <a>S. De Cnodder</a>, "<a href="http://tools.ietf.org/html/rfc5713">Security Threats and Security Requirements for the Access Node Control Protocol (ANCP)</a>", RFC 5713, January 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5851">[RFC5851]</b></td>
<td class="top">
<a>Ooghe, S.</a>, <a>Voigt, N.</a>, <a>Platnic, M.</a>, <a>Haag, T.</a> and <a>S. Wadhwa</a>, "<a href="http://tools.ietf.org/html/rfc5851">Framework and Requirements for an Access Node Control Mechanism in Broadband Multi-Service Networks</a>", RFC 5851, May 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5925">[RFC5925]</b></td>
<td class="top">
<a>Touch, J.</a>, <a>Mankin, A.</a> and <a>R. Bonica</a>, "<a href="http://tools.ietf.org/html/rfc5925">The TCP Authentication Option</a>", RFC 5925, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="TR-059">[TR-059]</b></td>
<td class="top">
<a>Anschutz, T.</a>, "<a>DSL Forum TR-059, DSL Evolution - Architecture Requirements for the Support of QoS-Enabled IP Services</a>", September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="TR-058">[TR-058]</b></td>
<td class="top">
<a title="SBC">Elias, M.</a> and <a title="Alcatel">S. Ooghe</a>, "<a>DSL Forum TR-058, Multi-Service Architecture &amp; Framework Requirements</a>", September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="TR-092">[TR-092]</b></td>
<td class="top">
<a>DSL Forum (now the Broadband Forum)</a>, "<a>DSL Forum TR-092, Broadband Remote access server requirements document</a>", 2005.</td>
</tr>
<tr>
<td class="reference"><b id="TR-101">[TR-101]</b></td>
<td class="top">
<a title="DSL Forum (now the Broadband Forum)">Cohen et al, </a>, "<a>Architecture &amp; Transport: "Migration to Ethernet Based DSL Aggregation", DSL Forum TR-101</a>", 2005.</td>
</tr>
<tr>
<td class="reference"><b id="TR-147">[TR-147]</b></td>
<td class="top">
<a title="Broadband Forum">Voight et al, </a>, "<a>Layer 2 Control Mechanism For Broadband Multi-Service Architectures </a>", 2008.</td>
</tr>
<tr>
<td class="reference"><b id="G.988.1">[G.988.1]</b></td>
<td class="top">
<a>ITU-T recommendation G.998.1, ATM-based multi-pair bonding</a>", 2005.</td>, "</tr>
<tr>
<td class="reference"><b id="G.988.2">[G.988.2]</b></td>
<td class="top">
<a>ITU-T recommendation G.998.2, Ethernet-based multi-pair bonding,</a>", 2005.</td>, "</tr>
<tr>
<td class="reference"><b id="US_ASCII">[US_ASCII]</b></td>
<td class="top">
<a title="American National Standards Institute">, </a>, "<a>Coded Character Set - 7-bit American Standard Code for Information Interchange</a>", ANSI X.34, 1986.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sanjay Wadhwa </span> 
	  <span class="n hidden">
		<span class="family-name"> Wadhwa</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sanjay.wadhwa@alcatel-lucent.com">sanjay.wadhwa@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jerome Moisand</span> 
	  <span class="n hidden">
		<span class="family-name">Moisand</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks</span>
	<span class="adr">
	  <span>10 Technology Park Drive</span>

	  <span class="vcardline">
		<span class="locality">Westford</span>,  
		<span class="region">MA</span> 
		<span class="code">01886</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jmoisand@juniper.net">jmoisand@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Thomas Haag</span> 
	  <span class="n hidden">
		<span class="family-name"> Haag</span>
	  </span>
	</span>
	<span class="org vcardline">Deutsche Telekom</span>
	<span class="adr">
	  <span>Heinrich-Hertz-Strasse 3-7</span>

	  <span class="vcardline">
		<span class="locality">Darmstadt</span>,  
		<span class="region"></span>
		<span class="code">64295</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">Phone: +49 6151 628 2088</span>

<span class="vcardline">EMail: <a href="mailto:haagt@telekom.de">haagt@telekom.de</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Norbert Voigt</span> 
	  <span class="n hidden">
		<span class="family-name">Voigt</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Siemensallee 1</span>

	  <span class="vcardline">
		<span class="locality">Greifswald</span>,  
		<span class="region"></span>
		<span class="code">17489</span>
	  </span>
	  <span class="country-name vcardline">Germany</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:norbert.voigt@nsn.com">norbert.voigt@nsn.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tom Taylor</span> editor
	  <span class="n hidden">
		<span class="family-name">Taylor</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Ottawa</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:tom111.taylor@bell.net">tom111.taylor@bell.net</a></span>

  </address>
</div>

</body>
</html>