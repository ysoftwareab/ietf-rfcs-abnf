<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extending Internationalised Domain Names in Applications
	to Other Protocols (X-IDNA)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extending Internationalised Domain Names in Applications
	to Other Protocols (X-IDNA)">
<meta name="keywords" content="internationalisation">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">N. Teint</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">March 23, 2010</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: September 24, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Extending Internationalised Domain Names in Applications
	to Other Protocols (X-IDNA)<br />draft-teint-xidna-base-00</h1>

<h3>Abstract</h3>

<p>Prior to Internationalised Domain Names in Applications (IDNA), there has
been no standard method for domains, names, addresses and similar identifiers
to use characters outside the ASCII repertoire.  This still applies to many
identifiers that are no domain names, such as email addresses (local-part),
newsgroup names, etc.
</p>
<p>This document extends the mechanism defined in IDNA to other protocols and
their identifiers. As with IDNA, these identifiers may be drawn from a large
repertoire (Unicode) and are mapped to backward-compatible identifiers using
only ASCII characters.
</p>
<p>For valid domain names, X-IDNA produces the same encoding as IDNA, even when
these domain names are embedded in other addresses.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Rationale<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Requirements Language<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.4.</a>&nbsp;
IDNA 2008<br />
<a href="#anchor6">2.</a>&nbsp;
Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#labeldef">2.1.</a>&nbsp;
Addresses, Normalised Addresses and Labels<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.2.</a>&nbsp;
ACE Prefix<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#addressslots">2.3.</a>&nbsp;
Address slots<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.4.</a>&nbsp;
Characters<br />
<a href="#anchor9">3.</a>&nbsp;
Requirements and Applicability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.1.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.2.</a>&nbsp;
Applicability and X-IDNA Profiles<br />
<a href="#lookup">4.</a>&nbsp;
Address Conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-input">4.1.</a>&nbsp;
Address Input<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-tounicode">4.2.</a>&nbsp;
Conversion To Unicode<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-normalise">4.3.</a>&nbsp;
Address Normalisation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-nfc">4.4.</a>&nbsp;
Unicode Normalisation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-extract">4.5.</a>&nbsp;
Extraction of Labels and Delimiters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-alabel-input">4.6.</a>&nbsp;
A-Label Input<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-validation">4.7.</a>&nbsp;
Validation and Character List Testing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-punycode">4.8.</a>&nbsp;
Punycode Conversion<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#toascii-reassembly">4.9.</a>&nbsp;
Re-Assembly<br />
<a href="#registration">5.</a>&nbsp;
Address Validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#valid-label">5.1.</a>&nbsp;
Label Validation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.1.1.</a>&nbsp;
Hyphen Restrictions<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.1.2.</a>&nbsp;
Leading Combining Marks<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.1.3.</a>&nbsp;
Contextual Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.1.4.</a>&nbsp;
Labels Containing Characters Written Right to Left<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.1.5.</a>&nbsp;
Successful Punycode Encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.2.</a>&nbsp;
Other Syntax Restrictions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.3.</a>&nbsp;
Local Restrictions<br />
<a href="#Acknowledgements">6.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">8.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview</h3>

<p>X-IDNA works by extracting anything from the address that fits the syntax of
a valid domain name "label", i.e. strings that roughly match the "LDH" syntax
for "A-labels" and "U-labels".

<br />
These extracted, putative labels are then put through a conversion the
normative part of which is identical to the normative part of IDNA2008.
</p>
<p>The characters that do not form labels, the separators, are solely drawn
from the ASCII repertoire (potentially mapped from Unicode lookalikes) and thus
need no internationalisation.
</p>
<p>Special processing, called address normalisation, ensures that addresses
considered equivalent in a protocol that allows arbitrary "quoting" or
"escaping" produce the same "labels".
</p>
<p>X-IDNA Profiles state to which (part of) address specifications X-IDNA is
applied and what steps have to be taken for address normalisation.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Rationale</h3>

<p>Unlike other methods for address internationalisation (such as
allowing UTF-8), using X-IDNA, as IDNA, allows the graceful
introduction of internationalised addresses not only by avoiding
upgrades to existing infrastructure (such as DNS servers and mail
transport agents), but also by allowing some limited use of
internationalised addresses in applications by using the
ASCII-encoded representation of the labels containing non-ASCII
characters.  While such names are user-unfriendly to read and type,
and hence not optimal for user input, they can be used as a last
resort to allow rudimentary usage of internationalised addresses.
For example, they might be the best choice for display if it were
known that relevant fonts were not available on the user's
computer.
</p>
<p>For protocols that have been extended to allow Unicode addresses
to be used directly, X-IDNA also provides a way to "downgrade" the
addresses that does not require lookups in a database or
transmission of alternative ASCII addresses.
</p>
<p>When strings covered by one profile of X-IDNA end up in places
that are covered by a different profile, it does not matter whether
the labels are converted to a A-Labels first and then put into the
other string or vice-versa, provided that due care has been taken in
defining these profiles.
</p>
<p>The same is true for IDNA and X-IDNA as long as the domain name is
valid, i.e. as long as it consists entirely of LDH-Labels.  For
example, if a valid domain name is put into the local-part of an
email address, the conversion of the domain's U-Labels to A-Labels
will be identical in IDNA and X-IDNA.
</p>
<p>This property is best demonstrated by the examples in <a class='info' href='#I-D.teint-xidna-zonefile'>[I&#8209;D.teint&#8209;xidna&#8209;zonefile]<span> (</span><span class='info'>Teint, N., &ldquo;An X-IDNA Profile for DNS Zone Master Files,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document
are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
IDNA 2008</h3>

<p>As X-IDNA essentially piggy-backs on IDNA 2008, the reader ought to be
familiar with the following specifications: 
<a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>, 
<a class='info' href='#I-D.ietf-idnabis-protocol'>[I&#8209;D.ietf&#8209;idnabis&#8209;protocol]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names in Applications (IDNA): Protocol,&rdquo; January&nbsp;2010.</span><span>)</span></a>, 
<a class='info' href='#I-D.ietf-idnabis-mappings'>[I&#8209;D.ietf&#8209;idnabis&#8209;mappings]<span> (</span><span class='info'>Resnick, P. and P. Hoffman, &ldquo;Mapping Characters in IDNA,&rdquo; October&nbsp;2009.</span><span>)</span></a>, 
<a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>, 
<a class='info' href='#I-D.ietf-idnabis-bidi'>[I&#8209;D.ietf&#8209;idnabis&#8209;bidi]<span> (</span><span class='info'>Alvestrand, H. and C. Karp, &ldquo;Right-to-left scripts for IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a> and 
<a class='info' href='#I-D.ietf-idnabis-rationale'>[I&#8209;D.ietf&#8209;idnabis&#8209;rationale]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Background, Explanation, and Rationale,&rdquo; January&nbsp;2010.</span><span>)</span></a>
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Definitions</h3>

<a name="labeldef"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Addresses, Normalised Addresses and Labels</h3>

<p>An "address" is defined in this document to be a protocol element
used in addressing network ressources, such as domain names, names,
addresses and similar identifiers. An address is in a
protocol-dependent format.  An X-IDNA profile is required to specify
which protocol elements constitute an address and how to map
addresses  to normalised addresses.

<br />
For the purposes of this specification, the definition of
an address need not contain the complete "address field" defined in
the other protocol.

For example, a protocol that has strings consisting of
locally-assigned names, domain names and numeric addresses may
specify that the locally-assigned names are covered by X-IDNA
whereas the domain names are covered by IDNA and the numeric
addresses are not internationalised.  A different protocol that
allows address specifications containing both strings used for
ressource identification and free-form text intended for human
consumption may specify that X-IDNA applies to the the ressource
identification part of the address specification whereas the
human-readable text is covered by a different internationalisation
protocol.
</p>
<p>A "normalised address" is defined in this document to be an address that is
in a format suitable as input to the generic X-IDNA protocol defined in this
document. A normalised address consists of one or more labels, each separated
by one or more separators.  It is produced in the normalisation steps (see
<a class='info' href='#toascii-normalise'>Section&nbsp;4.3<span> (</span><span class='info'>Address Normalisation</span><span>)</span></a> to <a class='info' href='#toascii-nfc'>Section&nbsp;4.4<span> (</span><span class='info'>Unicode Normalisation</span><span>)</span></a>) of the
X-IDNA protocol defined in this document.

<br />
 For the purposes of this document, a normalised address
need not be suitable for equivalence comparision.
</p>
<p>A "label" is defined in this document to be a part of a normalised address
that does not contain a separator. It is produced in the label extraction step
(see <a class='info' href='#toascii-extract'>Section&nbsp;4.5<span> (</span><span class='info'>Extraction of Labels and Delimiters</span><span>)</span></a>) of the X-IDNA protocol defined in this
document.

<br />
This definition of "label" is a generalisation of that
found in <a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>: the term is applied to strings that are not
part of a domain name.
</p>
<p>The definition of "A-Label", "fake A-Label", "U-Label",
"LDH-Label", "R-LDH-Label" and "NR-LDH-Label" is taken from
<a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a> but applied to strings that are not part of a domain
name.
</p>
<p>A "separator" is a (base) character that appears between labels
and is passed through the X-IDNA process as-is.  Separators are also
extracted in the label extraction step (see <a class='info' href='#toascii-extract'>Section&nbsp;4.5<span> (</span><span class='info'>Extraction of Labels and Delimiters</span><span>)</span></a>)
of the X-IDNA protocol defined in this document.
</p>
<p>An "ASCII address" is an address that consists entirely of base
characters. It can contain A-Labels, fake A-Labels, R-LDH-Labels and
NR-LDH-Labels and separators.
</p>
<p>A "Unicode address" may consist of both base and extended characters.
It can contain A-Labels, fake A-Labels, R-LDH-Labels, NR-LDH-Labels,
U-Labels and separators.
</p>
<p>An "internationalised address" is either an ASCII address or a
Unicode address.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
ACE Prefix</h3>

<p>The "ACE prefix" is defined in this document to be a string of
ASCII characters "xn--" that appears at the beginning of every
A-Label. "ACE" stands for "ASCII-Compatible Encoding".
</p>
<a name="addressslots"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Address slots</h3>

<p>An "address slot" is defined in this document to be a protocol element or a
function argument or a return value (and so on) explicitly designated for
carrying an "address".

Examples of address name slots include the email address following in the
parameter to the SMTP MAIL or RCPT commands or the "From:" field of an email
message header; the newsgroup name appearing in Netnews; and the domain name in
the QNAME field of a DNS query.

A string that has the syntax of an address but that appears in general text is
not in a address slot.  For example, an email address appearing in the plain
text body of an email message is not occupying an address name slot.
</p>
<p>An "X-IDNA-aware address slot" is defined to be an address slot explicitly
designated for carrying an internationalised  address as defined in profiles
based on this document.

The designation may be static (for example, in the specification of the
protocol or interface) or dynamic (for example, as a result of negotiation in
an interactive session).
</p>
<p>An "X-IDNA-unaware address slot" is defined for this set of documents to be
any address slot that is not an X-IDNA-aware address slot.  Obviously, this
includes any address slot whose specification predates X-IDNA or a profile
defined for these types of addresses. For domain names, it includes any domain
name slot (as defined in <a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>, Section 2.3.2.6) that predates IDNA.
</p>
<p>These definitions are generalisations of the "domain name slots"
defined in <a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>, Section 2.3.2.6.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Characters</h3>

<p>A "base character" is a Unicode character in the range
U+0000..U+007F.  (These Unicode characters correspond to the "ASCII"
character set and are also known as "ASCII characters".)
</p>
<p>An "extended character" is a Unicode character that is not a base
character, i.e. a character in the range U+0080 up to the maximum
Unicode codepoint (U+10FFFF as of <a class='info' href='#Unicode'>[Unicode]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Standard, Version 5.2,&rdquo; December&nbsp;2009.</span><span>)</span></a>).
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Requirements and Applicability</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Requirements</h3>

<p>X-IDNA makes the following requirements:

</p>
<ol class="text">
<li>Whenever an address is put into an X-IDNA-unaware address slot (see <a class='info' href='#addressslots'>Section&nbsp;2.3<span> (</span><span class='info'>Address slots</span><span>)</span></a>), it MUST contain only base characters and follow the
syntax mandated by the specification defining the address type.
<br />
<br />

If the address type is case-sensitive, any A-Label within the address MUST be
converted to lowercase.
</li>
<li>A-Labels and U-Labels <a class='info' href='#labeldef'>Section&nbsp;2.1<span> (</span><span class='info'>Addresses, Normalised Addresses and Labels</span><span>)</span></a> within an address MUST be
compared using equivalent forms: either both A-Label forms or both U-Label
forms.  Because A-Labels and U-Labels can be transformed into each other
without loss of information, these comparisons are equivalent.

A pair of A-Labels MUST be compared as case-insensitive ASCII.  U-Labels MUST
be compared as-is, without case-folding or other intermediate steps.  Note that
it is not necessary to validate labels in order to compare them and that
successful comparison does not imply validity.  In many cases, not limited to
comparison, validation may be important for other reasons and SHOULD be
performed.

<br />
<br />

Separators and labels that are neither A-Labels nor U-Labels (e.g., fake
A-Labels and NR-LDH-Labels) MUST not match any A-Label or U-Label; other than
that, X-IDNA does not make requirements for these (e.g., NR-LDH-Labels may be
compared with or without case-folding, depending on the address slot type.)
</li>
<li>When addresses are not validated, they MUST conform to the requirements of
<a class='info' href='#lookup'>Section&nbsp;4<span> (</span><span class='info'>Address Conversion</span><span>)</span></a>. When addresses are validated, they MUST conform to the
requirements of <a class='info' href='#registration'>Section&nbsp;5<span> (</span><span class='info'>Address Validation</span><span>)</span></a>.

</li>
</ol><p>

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Applicability and X-IDNA Profiles</h3>

<p>The application of X-IDNA to any type of address depends on an additional
specification that provides the details.  These other specifications are
referred to as X-IDNA Profiles.
</p>
<p>Each definition of an X-IDNA Profile MUST include all of the following:

</p>
<ol class="text">
<li>The protocol or protocols to which X-IDNA is applied and the syntax elements
of these protocols that represent an X-IDNA-unaware address slot.
</li>
<li>The steps necessary to map any syntactically valid address to a normalised
address (as described in <a class='info' href='#toascii-normalise'>Section&nbsp;4.3<span> (</span><span class='info'>Address Normalisation</span><span>)</span></a>)
</li>
<li>The parts of the protocol that require checking the address for validity (as
described in <a class='info' href='#registration'>Section&nbsp;5<span> (</span><span class='info'>Address Validation</span><span>)</span></a>).
</li>
</ol><p>


</p>
<p>A specification MAY also include:

</p>
<ul class="text">
<li>Syntax extensions for X-IDNA-aware address slots.
</li>
<li>Methods for interoperation with other ways of address
internationalisation.
</li>
</ul><p>

</p>
<a name="lookup"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Address Conversion</h3>

<p>Before an Internationalised Address is put into a X-IDNA-unaware slot, it
MUST be converted to an ASCII Address using the following procedure.
</p>
<p>Although some validity checks are necessary to avoid serious problems with
the protocol, the tests are permissive and rely on the assumption that names
that can be successfully used are valid.  That assumption is, however, a weak
one because the presence of wild cards in the receiving system might cause a
string that has not been explicitly defined and validated to be successfully
used as an address.
</p>
<p>This procedure in a generalisation of the Domain Name Lookup Protocol
defined in <a class='info' href='#I-D.ietf-idnabis-protocol'>[I&#8209;D.ietf&#8209;idnabis&#8209;protocol]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names in Applications (IDNA): Protocol,&rdquo; January&nbsp;2010.</span><span>)</span></a>, Section 5.
</p>
<a name="toascii-input"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Address Input</h3>

<p>The user supplies a string in the local character set, for example by typing
it or clicking on, or copying and pasting, a resource identifier, e.g., a URI
(<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>) or IRI (<a class='info' href='#RFC3987'>[RFC3987]<span> (</span><span class='info'>Duerst, M. and M. Suignard, &ldquo;Internationalized Resource Identifiers (IRIs),&rdquo; January&nbsp;2005.</span><span>)</span></a>) from which the
address is extracted.  Alternately, some process not directly involving the
user may read the string from a file or obtain it in some other way.
</p>
<p>Processing in this step and that specified in 
<a class='info' href='#toascii-tounicode'>Section&nbsp;4.2<span> (</span><span class='info'>Conversion To Unicode</span><span>)</span></a>,
<a class='info' href='#toascii-normalise'>Section&nbsp;4.3<span> (</span><span class='info'>Address Normalisation</span><span>)</span></a> and
<a class='info' href='#toascii-nfc'>Section&nbsp;4.4<span> (</span><span class='info'>Unicode Normalisation</span><span>)</span></a>
 are local matters, to be accomplished prior
to actual invocation of X-IDNA.
</p>
<a name="toascii-tounicode"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Conversion To Unicode</h3>

<p>The string is converted from the local character set into Unicode, if it is
not already in Unicode.
</p>
<p>Depending on local needs, this conversion may involve mapping some
characters into other characters as well as coding conversions.  This section
defines a general algorithm that applications ought to implement in order to
produce Unicode code points that will be valid under the IDNA protocol.
</p>
<p>An application might implement the full mapping as described below, or can
choose a different mapping.  In fact, an application might want to implement a
full mapping that is substantially compatible with the original IDNA protocol
instead of the algorithm given here.
</p>
<p>The general algorithm that an application (or the input method provided by
an operating system) ought to use is relatively straightforward:

</p>
<ol class="text">
<li>Upper case characters are mapped to their lower case equivalents
by using the algorithm for mapping case in Unicode characters.
</li>
<li>Full-width and half-width characters (those defined with Decomposition Types
&lt;wide&gt; and &lt;narrow&gt;) are mapped to their decomposition mappings as
shown in the Unicode character database.
</li>
<li>The application can also choose to map  some or all of the
following separator characters to ASCII characters which are
roughly equivalent:


<ul class="text">
<li>mapped to U+0020 (SPACE):
<ul class="text">
<li>all characters having a canonical or compatibility
decomposition to U+0020
</li>
</ul>
</li>
<li>mapped to U+0022 (QUOTATION MARK):
<ul class="text">
<li>U+201C (LEFT DOUBLE QUOTATION MARK)
</li>
<li>U+201D (RIGHT DOUBLE QUOTATION MARK)
</li>
<li>U+201E (DOUBLE LOW-9 QUOTATION MARK)
</li>
<li>U+201F (DOUBLE HIGH-REVERSED-9 QUOTATION MARK)
</li>
<li>U+2033 (DOUBLE PRIME)
</li>
<li>U+301D (REVERSED DOUBLE PRIME QUOTATION MARK)
</li>
<li>U+301E (DOUBLE PRIME QUOTATION MARK)
</li>
<li>U+301F (LOW DOUBLE PRIME QUOTATION MARK)
</li>
</ul>
</li>
<li>mapped to U+0027 (APOSTROPHE):
<ul class="text">
<li>U+2018 (LEFT SINGLE QUOTATION MARK)
</li>
<li>U+2019 (RIGHT SINGLE QUOTATION MARK)
</li>
<li>U+201B (SINGLE HIGH-REVERSED-9 QUOTATION MARK)
</li>
<li>U+2032 (PRIME)
</li>
</ul>
</li>
<li>mapped to U+002C (COMMA):
<ul class="text">
<li>U+201A (SINGLE LOW-9 QUOTATION MARK)
</li>
<li>U+3001 (IDEOGRAPHIC COMMA)
</li>
</ul>
</li>
<li>mapped to U+002E (FULL STOP):
<ul class="text">
<li>U+3002 (IDEOGRAPHIC FULL STOP)
</li>
</ul>
</li>
<li>mapped to U+003C (LESS-THAN SIGN):
<ul class="text">
<li>U+2039 (SINGLE LEFT-POINTING ANGLE QUOTATION MARK)
</li>
</ul>
</li>
<li>mapped to U+003E (GREATER-THAN SIGN):
<ul class="text">
<li>U+203A (SINGLE RIGHT-POINTING ANGLE QUOTATION MARK)
</li>
</ul>
</li>
<li>mapped to U+007C (VERTICAL LINE):
<ul class="text">
<li>U+00A6 (BROKEN BAR)
</li>
</ul>
</li>
<li>mapped to U+007E (TILDE):
<ul class="text">
<li>U+301C (WAVE DASH)
</li>
</ul>
</li>
</ul>
</li>
</ol>

<p>Unicode Normalisation ought to be deferred until after the Address
Normalisation defined in the following section.
</p>
<a name="toascii-normalise"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Address Normalisation</h3>

<p>The string is then normalised as specified in the X-IDNA Profile applicable
for the type of address slot into which the string is intented to be put. This
step maps a syntactically valid address to a normalised address, from which
labels can be extracted.  It is defined by the X-IDNA Profile.
</p>
<p>The rules for normalisations defined by X-IDNA Profiles are:

</p>
<ul class="text">
<li>If the protocol to which the X-IDNA profile applies
considers two addresses as equivalent, the normalisation procedure MUST produce
strings that produces exactly the same labels in the following step, the label
extraction.  (However, the X-IDNA Profile may specify a normalisation that does
not produce output directly suitable for equivalence comparision.)
</li>
<li>The runs of label characters produced by the normalisation SHOULD
be as long as possible.  Especially, the normalisation SHOULD treat
extended characters as "unreserved", "text", etc. It SHOULD NOT
mechanically insert "quote" or "escape" characters between
characters that can be part of a label.

<br />
<br />
These two requirements are usually met if the
normalisation removes all optional separators ("quotes" or "escape"
characters), especially those appearing between characters that can be part of
a label.

<br />
<br />
For example, if a protocols allows all characters to be
"quoted" by preceeding it with an optional U+002F (SOLIDUS), this
character needs to be removed if it is followed by any letter, digit,
hyphen or extended character; if a protocol allows non-significant
DOUBLE QUOTEs (U+0034) anywhere in the string, these need to be removed
if they appear within a label; and so on.
</li>
<li>Extended characters SHOULD be either mapped to ASCII characters
or treated as belonging to the character class that needs no
"quoting" or "escaping" otherwise defined by the protocol.

<br />
<br />
This requires special care for extended
characters in implementations. Leagacy code may mechanically escape
or quote them because they have traditionally not been in the
category defined as "unreserved", "text", etc.

<br />
<br />
For example, an extended character may be
assigned to the character class "atext" defined in &RFC5322; for the
purposes of the normalisation.
</li>
</ul><p>

</p>
<p>An application MAY also choose to map invalid addresses to syntactically
valid addresses, for example by "escaping" or "quoting" problematic base
characters; or it MAY reject invalid addresses in this step.
</p>
<a name="toascii-nfc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Unicode Normalisation</h3>

<p>Depending on local needs, the string can then be mapped using
Unicode Normalization Form C (NFC).
</p>
<a name="toascii-extract"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Extraction of Labels and Delimiters</h3>

<p>The normalised address is then split into putative labels and separators.
The labels extracted in this step have not been checked for conformance, are
therefore referred to as "putative".
</p>
<p>The putative labels will start with a letter, digit or extended character,
which may be followed by a string that consists of zero or more letters,
digits, extended characters or the HYPHEN-MINUS, and ends in a letter, digit or
extended character.<br />

The delimiters will be base characters that are not digits or letters.
</p>
<p>The label extraction differs significantly from the procedure specified in
<a class='info' href='#I-D.ietf-idnabis-mappings'>[I&#8209;D.ietf&#8209;idnabis&#8209;mappings]<span> (</span><span class='info'>Resnick, P. and P. Hoffman, &ldquo;Mapping Characters in IDNA,&rdquo; October&nbsp;2009.</span><span>)</span></a> by adding a number of additional
separators in addition to U+002E (FULL STOP).
</p>
<p>The purpose of this procedure is to ensure that all labels are IDNA-valid
(as defined in <a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>) regardless of the range
of non-LDH characters allowed in the address.
</p>
<p>
</p>
<ul class="text">
<li>The following Unicode codepoints are always part of a label:

<ul class="text">
<li>U+0030 to U+0039 (DIGIT ZERO to DIGIT NINE)
</li>
<li>U+0041 to U+005A (LATIN CAPITAL LETTER A to LATIN CAPITAL LETTER Z)
</li>
<li>U+0061 to U+007A (LATIN SMALL LETTER A to LATIN SMALL LETTER Z)
</li>
<li>all above U+0080, inclusive
</li>
</ul>
That is, all ASCII digits and letters and all non-ASCII codepoints.

</li>
<li>The following Unicode codepoints are always separators:

<ul class="text">
<li>U+0000 to U+002C (&lt;control&gt; NULL to COMMA)
</li>
<li>U+002E to U+002F (FULL STOP to SOLIDUS)
</li>
<li>U+002A to U+0040 (COLON to COMMERCIAL AT)
</li>
<li>U+005B to U+0060 (LEFT SQUARE BRACKET to GRAVE ACCENT)
</li>
<li>U+007B to U+007F (LEFT CURLY BRACKET to &lt;control&gt;DELETE)
</li>
</ul>
That is, all ASCII codepoints except for the hyphen, digits and letters.

</li>
<li>The following Unicode codepoint is part of a label or a separator, depending
on context:

<ul class="text">
<li>U+002D (HYPHEN-MINUS)
</li>
</ul>

A sequence of one or more HYPHEN-MINUS characters is composed of separators exactly if the run

<ul class="text">
<li>appears at the beginning or end of the address, OR
</li>
<li>is preceeded or followed by a separator.
</li>
</ul>

That is, hyphens that would start or end a label (and thus violate the syntax
for LDH-Labels), are separators; other hyphens are part of a label.

</li>
</ul><p>

</p>
<a name="toascii-alabel-input"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
A-Label Input</h3>

<p>If a putative label extracted in the previous step appears to be an A-Label
(i.e., it starts in "xn--", interpreted case-insensitively and does not contain
extended characters), the application MAY attempt to convert it to a U-Label,
first ensuring that the A-Label is entirely in lower case (converting it to
lower case if necessary), and apply the tests of <a class='info' href='#toascii-validation'>Section&nbsp;4.7<span> (</span><span class='info'>Validation and Character List Testing</span><span>)</span></a> and the conversion of <a class='info' href='#toascii-punycode'>Section&nbsp;4.8<span> (</span><span class='info'>Punycode Conversion</span><span>)</span></a> to that form.  
</p>
<p>If the label is converted to Unicode (i.e., to U-Label form) using the
Punycode decoding algorithm, then the processing specified in those two
sections MUST be performed.
</p>
<p>If any of these steps fails or rejects the label (i.e., it's a fake
A-Label), the putative label MUST be used as-is.

</p>
<ul class="text">
<li>the original MUST be used if the X-IDNA profile allows R-LDH-Labels, and
</li>
<li>it MAY be rejected if the X-IDNA profile does not allow R-LDH-Labels.
</li>
</ul><p>

</p>
<p>If a label consists entirely of base characters, the following two steps
(<a class='info' href='#toascii-validation'>Section&nbsp;4.7<span> (</span><span class='info'>Validation and Character List Testing</span><span>)</span></a> and <a class='info' href='#toascii-punycode'>Section&nbsp;4.8<span> (</span><span class='info'>Punycode Conversion</span><span>)</span></a>)
are skipped for this label.
</p>
<a name="toascii-validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Validation and Character List Testing</h3>

<p>The putative labels extracted in the previous step are checked to verify
that all characters that appear in it are valid as input to X-IDNA processing.
As discussed above, this check is liberal in order to allow for compatibility
with future extensions.
</p>
<p>Putative labels with any of the following characteristics MUST be rejected
in this step:

</p>
<ul class="text">
<li>Labels that are not in NFC (<a class='info' href='#UAX15'>[UAX15]<span> (</span><span class='info'>Davis, M., Whistler, K., and M. Duerst, &ldquo;Unicode Normalization Forms, Revision 31,&rdquo; September&nbsp;2009.</span><span>)</span></a>)
</li>
<li>Labels containing "--" (two consecutive hyphens) in the third and
fourth character positions
</li>
<li>Labels whose first character is a combining mark (see Section 2.11 of <a class='info' href='#Unicode'>[Unicode]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Standard, Version 5.2,&rdquo; December&nbsp;2009.</span><span>)</span></a>)
</li>
<li>Labels containing prohibited code points, i.e., those that are
assigned to the "DISALLOWED" category of <a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>




</li>
<li>Labels containing code points that are identified in <a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a> as
"CONTEXTJ", i.e., requiring exceptional contextual rule processing on lookup,
but that do not conform to those rules.  Note that this implies that a rule
needs to be defined, not null: a character that requires a contextual rule but for
which the rule is null is treated in this step as having failed to conform to
the rule
</li>
<li>Labels containing code points that are identified in <a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a> as
"CONTEXTO", but for which no such rule appears in the table of rules.
Applications resolving DNS names or carrying out equivalent operations are not
required to test contextual rules for "CONTEXTO" characters, only to verify
that a rule is defined (although they MAY make such tests to provide better
protection or give better information to the user)
</li>
<li>Labels containing code points that are unassigned in the version of Unicode
being used by the application, i.e., in the "UNASSIGNED" category of
<a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>
<br />

This requirement means that the application needs to use a list of unassigned
characters that is matched to the version of Unicode that is being used for the
other requirements in this section.  It is not required that the application
know which version of Unicode is being used; that information might be part of
the operating environment in which the application is running.
</li>
</ul><p>

</p>
<p>In addition, the application SHOULD apply the following test:

</p>
<ul class="text">
<li>Verification that the string is compliant with the requirements
for right to left characters, specified in <a class='info' href='#I-D.ietf-idnabis-bidi'>[I&#8209;D.ietf&#8209;idnabis&#8209;bidi]<span> (</span><span class='info'>Alvestrand, H. and C. Karp, &ldquo;Right-to-left scripts for IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>.
</li>
</ul><p>

</p>
<p>This test may be omitted in special circumstances, such as when the lookup
application knows that the conditions are enforced elsewhere, because an
attempt to use such strings as an address will almost certainly lead to an
error except when wild cards are present on a receiving system.  However,
applying the test is likely to give an earlier detection and much better
information about the reason for a failure -- information that may be usefully
passed to the user when that is feasible -- than later failure alone.
</p>
<p>For all other strings, the lookup application MUST rely on the protocol
using the address to determine the validity of the address and the characters
they contain.  If they can successfully be used, they are presumed to be valid;
if they are not, their possible validity is not relevant.  While an application
may reasonably issue warnings about strings it believes may be problematic,
applications that decline to process a string that conforms to the rules above
(i.e., does not allow putting it into an address slot) are not in conformance
with this protocol.
</p>
<a name="toascii-punycode"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Punycode Conversion</h3>

<p>The string that has now been validated is converted to ACE form by applying
the Punycode algorithm to the string and then adding the ACE prefix.
</p>
<a name="toascii-reassembly"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.9"></a><h3>4.9.&nbsp;
Re-Assembly</h3>

<p>The A-Labels resulting from the conversion in <a class='info' href='#toascii-punycode'>Section&nbsp;4.8<span> (</span><span class='info'>Punycode Conversion</span><span>)</span></a> or supplied directly (see <a class='info' href='#toascii-alabel-input'>Section&nbsp;4.6<span> (</span><span class='info'>A-Label Input</span><span>)</span></a>) is combined with the delimiters (see <a class='info' href='#toascii-extract'>Section&nbsp;4.5<span> (</span><span class='info'>Extraction of Labels and Delimiters</span><span>)</span></a>), in the original order, to form an A-Adress.
</p>
<p>The ASCII Address can then be put into an X-IDNA-unaware address
slot and be used as a normal address.  The use of this address can
obviously either succees or fail (resulting in a lookup failure,
bounce message, etc.).
</p>
<a name="registration"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Address Validation</h3>

<p>Whenever an X-IDNA Profile mandates that the addresses be validated, the
following procedure MUST be followed.
</p>
<p>Addresses ought to be validated whenever an address is defined, registered,
etc.

An X-IDNA Profiles defines when and by whom addresses are validated.
</p>
<a name="valid-label"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Label Validation</h3>

<p>In order to validate individual labels embedded in the address, it is
normalised as specified in <a class='info' href='#toascii-normalise'>Section&nbsp;4.3<span> (</span><span class='info'>Address Normalisation</span><span>)</span></a> and then the
labels are extracted as specified in <a class='info' href='#toascii-extract'>Section&nbsp;4.5<span> (</span><span class='info'>Extraction of Labels and Delimiters</span><span>)</span></a>.
</p>
<p>The following validation steps apply to the extracted labels.

The labels (in the form of a Unicode string, i.e., a string that at least
superficially appears to be a U-label) are then examined, performing tests that
require examination of more than one character.  Character order is considered
to be the on-the-wire order, not the display order.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Hyphen Restrictions</h3>

<p>If the Unicode string contains non-base characters, it MUST NOT contain "--"
(two consecutive HYPHEN-MINUS characters) in the third and fourth character
positions.
</p>
<p>Note: The Unicode string will not start or end with a "-" (HYPHEN-MINUS) at this
point.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Leading Combining Marks</h3>

<p>The Unicode string MUST NOT begin with a combining mark or combining
character (see Section 2.11 of <a class='info' href='#Unicode'>[Unicode]<span> (</span><span class='info'>Unicode Consortium, &ldquo;Unicode Standard, Version 5.2,&rdquo; December&nbsp;2009.</span><span>)</span></a> for an exact
definition).
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
Contextual Rules</h3>

<p>The Unicode string MUST NOT contain any characters whose validity is
context-dependent, unless the validity is positively confirmed by a contextual
rule.  To check this, each code-point marked as CONTEXTJ or CONTEXTO in <a class='info' href='#I-D.ietf-idnabis-tables'>[I&#8209;D.ietf&#8209;idnabis&#8209;tables]<span> (</span><span class='info'>Faltstrom, P., &ldquo;The Unicode code points and IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a> MUST have a non-null rule.  If such a
code-point is missing a rule, it is invalid.  If the rule exists but the result
of applying the rule is negative or inconclusive, the proposed label is
invalid.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.4"></a><h3>5.1.4.&nbsp;
Labels Containing Characters Written Right to Left</h3>

<p>
   If the proposed label contains any characters that are written from
   right to left it MUST meet the BIDI criteria <a class='info' href='#I-D.ietf-idnabis-bidi'>[I&#8209;D.ietf&#8209;idnabis&#8209;bidi]<span> (</span><span class='info'>Alvestrand, H. and C. Karp, &ldquo;Right-to-left scripts for IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>

</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.5"></a><h3>5.1.5.&nbsp;
Successful Punycode Encoding</h3>

<p>The Unicode string MUST be convertible to ACE form using the Punycode
algorithm (<a class='info' href='#RFC3492'>[RFC3492]<span> (</span><span class='info'>Costello, A., &ldquo;Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>), i.e., it MUST NOT cause an overflow.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Other Syntax Restrictions</h3>

<p>In A-Address form, the address MUST conform to the syntax defined by the
X-IDNA-unaware specification for the address type.

This MAY include length restrictions, syntax restrictions regarding separators,
etc.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Local Restrictions</h3>

<p>In addition to the rules and tests above, there are many reasons why a
site, registry, or administrators could reject an address.
</p>
<p>The responsible entity is expected to establish or follow policies about
addresses they wish to define or register.  Policies are likely to be informed
by the local languages and the scripts that are used to write them and may
depend on many factors including what characters are in the label (for example,
an address may be rejected based on other addresses already registered).
</p>
<p>The same considerations as for IDNA registrations apply; see Section 3.2 of
<a class='info' href='#I-D.ietf-idnabis-rationale'>[I&#8209;D.ietf&#8209;idnabis&#8209;rationale]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Background, Explanation, and Rationale,&rdquo; January&nbsp;2010.</span><span>)</span></a>
for a discussion
   and recommendations about registry policies.

</p>
<p>While X-IDNA, unlike IDNA 2008, allows addresses that contain fake A-Labels
and R-LDH-Labels, responsible entities ought to avoid such addresses except
when backwards-compatibility requires them.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgements</h3>

<p>The larger part of this specifications was directly lifted from IDNA 2008,
and would not have been possible without the excellent work that went into
these specifications.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This memo includes no request to IANA.
</p>
<p>The definition of an X-IDNA Profiles ought to be coordinated with the entity
that controls the specification of the address slot type to which X-IDNA is
applied, instead.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>X-IDNA shares the Security Considerations for IDNA, which are described
in <a class='info' href='#I-D.ietf-idnabis-defs'>[I&#8209;D.ietf&#8209;idnabis&#8209;defs]<span> (</span><span class='info'>Klensin, J., &ldquo;Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework,&rdquo; January&nbsp;2010.</span><span>)</span></a>, except for the special issues
associated with right to left scripts and characters.  The latter are discussed
in <a class='info' href='#I-D.ietf-idnabis-bidi'>[I&#8209;D.ietf&#8209;idnabis&#8209;bidi]<span> (</span><span class='info'>Alvestrand, H. and C. Karp, &ldquo;Right-to-left scripts for IDNA,&rdquo; January&nbsp;2010.</span><span>)</span></a>.
</p>
<p>In addition, each X-IDNA Profile will require additional Security Considerations,
which MUST be discussed in the document defining the Profile.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-bidi">[I-D.ietf-idnabis-bidi]</a></td>
<td class="author-text">Alvestrand, H. and C. Karp, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-bidi-07.txt">Right-to-left scripts for IDNA</a>,&rdquo; draft-ietf-idnabis-bidi-07 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-bidi-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-defs">[I-D.ietf-idnabis-defs]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-defs-13.txt">Internationalized Domain Names for Applications (IDNA): Definitions and Document Framework</a>,&rdquo; draft-ietf-idnabis-defs-13 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-defs-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-mappings">[I-D.ietf-idnabis-mappings]</a></td>
<td class="author-text">Resnick, P. and P. Hoffman, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-mappings-05.txt">Mapping Characters in IDNA</a>,&rdquo; draft-ietf-idnabis-mappings-05 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-mappings-05.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-protocol">[I-D.ietf-idnabis-protocol]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-protocol-18.txt">Internationalized Domain Names in Applications (IDNA): Protocol</a>,&rdquo; draft-ietf-idnabis-protocol-18 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-protocol-18.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-rationale">[I-D.ietf-idnabis-rationale]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-rationale-17.txt">Internationalized Domain Names for Applications (IDNA): Background, Explanation, and Rationale</a>,&rdquo; draft-ietf-idnabis-rationale-17 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-rationale-17.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-idnabis-tables">[I-D.ietf-idnabis-tables]</a></td>
<td class="author-text">Faltstrom, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-tables-09.txt">The Unicode code points and IDNA</a>,&rdquo; draft-ietf-idnabis-tables-09 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-idnabis-tables-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3492">[RFC3492]</a></td>
<td class="author-text">Costello, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3492">Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3492, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3492.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UAX15">[UAX15]</a></td>
<td class="author-text">Davis, M., Whistler, K., and M. Duerst, &ldquo;<a href="http://unicode.org/reports/tr15/tr15-31.html">Unicode Normalization Forms, Revision 31</a>,&rdquo; UAX&nbsp;#15, September&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="Unicode">[Unicode]</a></td>
<td class="author-text">Unicode Consortium, &ldquo;<a href="http://www.unicode.org/versions/Unicode5.2.0/">Unicode Standard, Version 5.2</a>,&rdquo; December&nbsp;2009.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.teint-xidna-zonefile">[I-D.teint-xidna-zonefile]</a></td>
<td class="author-text">Teint, N., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-teint-xidna-zonefile-00.txt">An X-IDNA Profile for DNS Zone Master Files</a>,&rdquo; draft-teint-xidna-zonefile-00 (work in progress), March&nbsp;2010.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3987">[RFC3987]</a></td>
<td class="author-text">Duerst, M. and M. Suignard, &ldquo;<a href="http://tools.ietf.org/html/rfc3987">Internationalized Resource Identifiers (IRIs)</a>,&rdquo; RFC&nbsp;3987, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3987.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nick Teint</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nick.teint@googlemail.com">nick.teint@googlemail.com</a></td></tr>
</table>
</body></html>
