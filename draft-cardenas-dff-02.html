<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Depth-First Forwarding in Unreliable Networks</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Motivation">
<link href="#rfc.section.2" rel="Chapter" title="2 Notation and Terminology">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Notation">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Applicability Statement">
<link href="#rfc.section.4" rel="Chapter" title="4 Protocol Overview and Functioning">
<link href="#rfc.section.5" rel="Chapter" title="5 Data Structures">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Neighbor Set">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Routing Set">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Processed Set">
<link href="#rfc.section.6" rel="Chapter" title="6 Packet Format">
<link href="#rfc.section.7" rel="Chapter" title="7 Protocol Parameters and Constants">
<link href="#rfc.section.8" rel="Chapter" title="8 Data Packet Generation and Processing">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Data Packet Generation">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Data Packet Processing">
<link href="#rfc.section.9" rel="Chapter" title="9 Missed Link Layer Acknowledgment when Sending a Packet">
<link href="#rfc.section.10" rel="Chapter" title="10 Getting the Next Hop for a Packet">
<link href="#rfc.section.11" rel="Chapter" title="11 Poisoning">
<link href="#rfc.section.12" rel="Chapter" title="12 Proposed Values for Parameters and Constants">
<link href="#rfc.section.13" rel="Chapter" title="13 Security Considerations">
<link href="#rfc.section.14" rel="Chapter" title="14 IANA Considerations">
<link href="#rfc.section.15" rel="Chapter" title="15 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Examples">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Example 1: Normal Delivery">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Example 2: Forwarding with Link Failure">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 Example 3: Forwarding with Missed Link Layer Acknowledgment">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Example 4: Forwarding with a Loop">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes the Depth-First Forwarding (DFF) protocol for IPv6 networks based on the IEEE 802.15.4 link layer (6lowpan). The protocol is a mesh-under data forwarding mechanism that increases reliability of data delivery in cases where the next hop along the path to the destination, as determined by the underlying routing protocol, is not reachable. In that case, a node running DFF tries to forward the packet successively to all neighbors, and - if the packet makes no forward progress - returns it to the previous hop, similar to a "depth-first search" in graph theory.  " />
  <meta name="description" content="This document describes the Depth-First Forwarding (DFF) protocol for IPv6 networks based on the IEEE 802.15.4 link layer (6lowpan). The protocol is a mesh-under data forwarding mechanism that increases reliability of data delivery in cases where the next hop along the path to the destination, as determined by the underlying routing protocol, is not reachable. In that case, a node running DFF tries to forward the packet successively to all neighbors, and - if the packet makes no forward progress - returns it to the previous hop, similar to a "depth-first search" in graph theory.  " />
  <meta name="keywords" content="DFF" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">U.H. Herberg</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">A.C. Cardenas</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">Fujitsu Laboratories</td>
</tr>
<tr>
<td class="left">Expires: May 04, 2012</td>
<td class="right">S.C. Cespedes</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">U. Icesi/U. of Waterloo</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T.I. Iwao</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Fujitsu Limited</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">November 01, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Depth-First Forwarding in Unreliable Networks<br />
  <span class="filename">draft-cardenas-dff-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes the Depth-First Forwarding (DFF) protocol for IPv6 networks based on the IEEE 802.15.4 link layer (6lowpan). The protocol is a mesh-under data forwarding mechanism that increases reliability of data delivery in cases where the next hop along the path to the destination, as determined by the underlying routing protocol, is not reachable. In that case, a node running DFF tries to forward the packet successively to all neighbors, and - if the packet makes no forward progress - returns it to the previous hop, similar to a "depth-first search" in graph theory.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on May 04, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Motivation</a>
</li>
<li>2.   <a href="#rfc.section.2">Notation and Terminology</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Notation</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Applicability Statement</a>
</li>
<li>4.   <a href="#rfc.section.4">Protocol Overview and Functioning</a>
</li>
<li>5.   <a href="#rfc.section.5">Data Structures</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Neighbor Set</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Routing Set</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Processed Set</a>
</li>
<li>6.   <a href="#rfc.section.6">Packet Format</a>
</li>
<li>7.   <a href="#rfc.section.7">Protocol Parameters and Constants</a>
</li>
<li>8.   <a href="#rfc.section.8">Data Packet Generation and Processing</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Data Packet Generation</a>
</li>
<li>8.2.   <a href="#rfc.section.8.2">Data Packet Processing</a>
</li>
<li>9.   <a href="#rfc.section.9">Missed Link Layer Acknowledgment when Sending a Packet</a>
</li>
<li>10.   <a href="#rfc.section.10">Getting the Next Hop for a Packet</a>
</li>
<li>11.   <a href="#rfc.section.11">Poisoning</a>
</li>
<li>12.   <a href="#rfc.section.12">Proposed Values for Parameters and Constants</a>
</li>
<li>13.   <a href="#rfc.section.13">Security Considerations</a>
</li>
<li>14.   <a href="#rfc.section.14">IANA Considerations</a>
</li>
<li>15.   <a href="#rfc.section.15">Acknowledgements</a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Examples</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Example 1: Normal Delivery</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Example 2: Forwarding with Link Failure</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">Example 3: Forwarding with Missed Link Layer Acknowledgment</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Example 4: Forwarding with a Loop</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">This document describes the Depth-First Forwarding (DFF) protocol for IPv6 networks based on the IEEE 802.15.4 link layer, as specified in <a href="#RFC4944">[RFC4944]</a>. The protocol is a mesh-under data forwarding mechanism that increases reliability of data delivery in cases where the next hop along the path to the destination, as determined by the underlying routing protocol, is not reachable. In that case, a node running DFF tries to forward the packet successively to all neighbors, and - if the packet makes no forward progress - returns it to the previous hop, similar to a "depth-first search" in graph theory.</p>
<p id="rfc.section.1.p.2">As network topologies do not necessarily form a tree, loops can occur. Therefore, DFF contains a loop detection and avoidance mechanism.</p>
<p id="rfc.section.1.p.3">While rerouting the packet through alternative next hops, the routing table can be updated, and thus, DFF provides an optional local route repair mechanism.</p>
<p id="rfc.section.1.p.4">Any underlying mesh-under routing mechanism can be used with DFF, as long as such routing mechanism provides lists of bidirectional neighbors for each node. This specification assumes there is such a protocol in place and outlines the requirements for that protocol, as well as the interaction between the specified forwarding mechanism and the routing protocol.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Motivation</h1>
<p id="rfc.section.1.1.p.1">In networks with very dynamic topologies, even frequent exchanges of control messages between nodes for updating the routing tables cannot guarantee freshness of routes: packets may not be delivered to their destination because the topology has changed since the last routing protocol update.</p>
<p id="rfc.section.1.1.p.2">While more frequent routing protocol updates could mitigate that problem to a certain extent, more frequent routing protocol updates require network bandwidth (e.g. when flooding control messages through the network for route discovery). This is an issue in networks with very lossy links, where further control traffic exchange can worsen the network stability. Moreover, additional control traffic exchange (e.g. network-wide floods) drains energy from battery-driven nodes.</p>
<p id="rfc.section.1.1.p.3">The data-forwarding mechanism specified in this document allows forwarding data packets along alternate paths for increasing reliability of data delivery, using a depth-first search. The objective is to decrease the necessary control traffic overhead of the underlying routing protocol, and in the same time to increase delivery success rates. Optionally, the underlying routing protocol can be informed about the updated topology, and routes can then be repaired.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Notation and Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.  </p>
<p id="rfc.section.2.p.2">Additionally, this document uses the notation in <a href="#notation">Section 2.1</a> and the terminology in <a href="#terminology">Section 2.2</a>.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#notation" id="notation">Notation</a>
</h1>
<p id="rfc.section.2.1.p.1">The following notations are used in this document: </p>

<dl>
<dt>List</dt>
<dd style="margin-left: 8">- A list of elements is defined as [] for an empty list, [element] for a list with one element, and [element1, element2, ...] for a list with multiple elements.</dd>
<dt>Concatenation of lists:</dt>
<dd style="margin-left: 8">If L1 and L2 are lists, then L1@L2 is a new list with all elements of L2 concatenated to L1.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.2.p.1">All terms introduced in <a href="#RFC4944">[RFC4944]</a> are to be interpreted as described therein.</p>
<p id="rfc.section.2.2.p.2">Additionally, this document uses the following terminology: </p>

<dl>
<dt>Address</dt>
<dd style="margin-left: 8">- An address is either a 16-bit short or a EUI-64 link layer address, as specified in <a href="#RFC4944">[RFC4944]</a>.</dd>
<dt>Packet</dt>
<dd style="margin-left: 8">- An IPv6 packet encapsulated in a IEEE 802.15.4 frame, using the LoWPAN adaption layer as specified in <a href="#RFC4944">[RFC4944]</a>.</dd>
<dt>Originator Address</dt>
<dd style="margin-left: 8">- An address of a node that is included as source address in the packet header.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#applicability" id="applicability">Applicability Statement</a>
</h1>
<p id="rfc.section.3.p.1">This protocol: </p>

<ul>
<li>Is applicable for use in IEEE 802.15.4 based networks, using the frame format for transmission of IPv6 packets defined in <a href="#RFC4944">[RFC4944]</a>.</li>
<li>Assumes addresses used in the network are either 16-bit short or EUI-64 link layer address, as specified in <a href="#RFC4944">[RFC4944]</a>.</li>
<li>Operates as "mesh-under" forwarding protocol, i.e. on the link layer. While the proposed mechanism could also be used as "route-over", this is not specified in this document and thus out of scope.</li>
<li>Is designed to work in networks with lossy links or with a dynamic topology.</li>
<li>Relies on an underlying mesh-under routing protocol. This routing protocol MUST provide a list of bidirectional neighbors of a node, and MAY provide one more multiple paths to destinations in the network (i.e. store one or more next hop nodes for a destination with an associated routing cost).</li>
<li>Increases reliability of data delivery by trying alternative paths, using a "depth-first forwarding" approach.</li>
<li>Provides a loop detection mechanism, and an optional local route repair mechanism.</li>
<li>Is designed to work in a completely distributed manner, and does not depend on any central entity.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#overview" id="overview">Protocol Overview and Functioning</a>
</h1>
<p id="rfc.section.4.p.1">DFF is a mesh-under data forwarding mechanism responsible for detecting loops, choosing alternate next hops, and optionally updating the cost metrics in the routing tables to reflect information gathered by forwarding data packets. DFF operates on 6lowpan based networks (using the frame format and the transmission of IPv6 packets defined in <a href="#RFC4944">[RFC4944]</a>).</p>
<p id="rfc.section.4.p.2">DFF is intended to work in a network where nodes maintain a bidirectional neighbor table as candidates for a possible next hop of a packet, and a routing table with one or more candidate next hops for each final destination.</p>
<p id="rfc.section.4.p.3">DFF provides advantages in networks where the reliability of links is low and the link quality may change rapidly. It assumes that the control plane mechanism cannot guarantee up-to-date routing tables, nor necessarily the absence of loops. Therefore, whenever a data packet is forwarded, DFF stores a data packet identifier to detect loops, and uses alternate paths to reroute the packet to the destination, optionally updating routing tables if a loop is detected.</p>
<p id="rfc.section.4.p.4">DFF achieves this functionality by implementing a distributed depth-first search over the network graph. If the routing tables are up-to-date, the search only involves the default route (i.e. uses the shortest path as calculated by the underlying routing protocol). However, if the routing table is not up-to-date and forwarding of a data packet results in a loop, or if the link layer fails to successfully transmit the packet to the next hop, the data packet is sent to an alternate next hop neighbor. This alternate next hop is selected from the neighbor set of the underlying mesh-under routing protocol, using a descending order of priority which takes into account link metrics. DFF lists for each recently forwarded packet  which neighbors that packet has been sent to, allowing for trying to forward the packet to all candidates for the next hop.</p>
<p id="rfc.section.4.p.5">If none of the transmissions to the neighbors has succeeded, the packet is returned to the previous hop, indicated by setting a return (RET) flag, which is defined in a 6lowpan dispatch byte. The previous hop then continues to try other neighbors in turn, resulting in a depth-first search in the network.</p>
<p id="rfc.section.4.p.6">Whenever a packet has been sent to a neighbor and no link layer acknowledgment (ACK) has been received, the duplicate (DUP) flag is set in the packet header for the following transmissions. The rationale is that the packet may have been successfully received by the neighbor and only the ACK has been lost, resulting in duplicates of the packet in the network. The DUP flag tags such a possible duplicate.</p>
<p id="rfc.section.4.p.7">Whenever a node receives a packet that it has already forwarded, and which is not a duplicate (as indicated by the DUP flag), it will assume a loop and return the packet to the previous hop (with the RET flag set). Optionally, the link to the next hop to which the node has originally sent the packet may be "poisoned" (i.e. the link cost will be increased).</p>
<p id="rfc.section.4.p.8">DFF requires an underlying mechanism that minimally provides a list of bidirectional neighbors of a node. However, in order to avoid sending a packet to any random neighbor as next hop, and therefore possibly performing a network-wide depth-first search, it is recommended to implement DFF in combination with a routing protocol that provides multiple paths to a destination, in order to efficiently choose alternative next hops.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Data Structures</h1>
<p id="rfc.section.5.p.1">This section specifies optional and mandatory data structures of DFF. DFF itself is no routing protocol, but a data forwarding protocol. However, DFF relies on some information from the underlying routing protocol, in order to perform the depth-first search.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#neighbor_set" id="neighbor_set">Neighbor Set</a>
</h1>
<p id="rfc.section.5.1.p.1">DFF MUST have read access to a list of bidirectional neighbors, henceforth called "Neighbor Set", provided by the underlying routing protocol. The Neighbor Set MUST at least provide the addresses of the direct neighbors of the node, and MAY provide additional information representing the cost of sending a packet to each neighbor (e.g. using a link metric). If DFF has write access to the Neighbor Set, updating link costs ("poisoning") is supported.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#routing_set" id="routing_set">Routing Set</a>
</h1>
<p id="rfc.section.5.2.p.1">DFF MAY have read access to a list of destinations in the network with one or more possible next hops for reaching each destination, henceforth called "Routing Set", provided by the underlying routing protocol. If the routing protocol provides a Routing Set, it MUST at least provide the addresses of destinations and one or more possible next hops to reach that destination, and MAY provide additional information representing the cost of sending a packet to the destination (e.g. using a route metric). If DFF has write access to the Routing Set, updating route costs ("poisoning") is supported.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#processed_set" id="processed_set">Processed Set</a>
</h1>
<p id="rfc.section.5.3.p.1">Each node MUST maintain a Processed Set in order to support the loop detection functionality. The Processed Set lists sequence numbers of previously received packets, as well as a list of next hops to which the packet has been sent successively as part of the depth-first search mechanism. The set consists of Processed Tuples: </p>

<dl>
<dt></dt>
<dd style="margin-left: 8">(P_orig_address, P_seq_number, P_prev_hop, P_next_hop_neighbor_list, P_time)</dd>
</dl>

<p> where </p>

<dl>
<dt></dt>
<dd style="margin-left: 8">P_orig_address is is the originator address of the received message;</dd>
<dt></dt>
<dd style="margin-left: 8">P_seq_number is the sequence number of the received packet;</dd>
<dt></dt>
<dd style="margin-left: 8">P_prev_hop is the address of the previous hop  of the packet;</dd>
<dt></dt>
<dd style="margin-left: 8">P_next_hop_neighbor_list is a list of addresses of next hops to which the packet has been sent previously, as part of the depth-first search mechanism, as explained in <a href="#packet_processing">Section 8.2</a>;</dd>
<dt></dt>
<dd style="margin-left: 8">P_time specifies when this Tuple expires and MUST be removed.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#packet_format" id="packet_format">Packet Format</a>
</h1>
<p id="rfc.section.6.p.1">This document assumes that the data forwarding as well as the underlying routing protocol are based on the LoWPAN adaptation layer ("mesh-under"), and that data packets are conform with the packet format specified in <a href="#RFC4944">[RFC4944]</a>. In particular, <a href="#RFC4944">[RFC4944]</a> states that <a href="#RFC4944">[RFC4944]</a>, and MAY be preceded by a header that identifies the DFF data forwarding mechanism, which is defined in the following.</p>

<dl>
<dt></dt>
<dd style="margin-left: 8">Additional mesh routing capabilities, such as specifying the mesh routing protocol, source routing, and so on may be expressed by defining additional routing headers that precede the fragmentation or addressing header in the header stack.  </dd>
</dl>

<p> Hence, all data packets to be forwarded using DFF MUST be preceded by the standard mesh (L2) addressing header defined in </p>
<p id="rfc.section.6.p.2">After these two headers, any other LoWPAN header, e.g. hop-by-hop options, header compression or fragmentation, MAY also be added before the actual payload. (<a href="#mesh-header">Figure 1</a>) depicts the mesh header of a data frame to be forwarded with DFF.</p>
<div id="#rfc.figure.1"></div>
<div id="#mesh-header"></div>
<pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   Mesh type and header                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 1| Mesh Forw |D|R|x|         DID             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.6.p.3">Field definitions are as follows: </p>

<dl>
<dt>Mesh type and header</dt>
<dd style="margin-left: 8">- The mesh (L2) addressing header and its associated dispatch byte as defined in <a href="#RFC4944">[RFC4944]</a>.</dd>
<dt>Mesh Forw</dt>
<dd style="margin-left: 8">- A 6-bit identifier that allows for the use of different mesh forwarding mechanisms. As specified in <a href="#RFC4944">[RFC4944]</a>, additional mesh forwarding mechanisms should use the reserved dispatch byte values following LOWPAN_BCO; therefore, 0 1 MUST precede Mesh Forw. The value of Mesh Forw is LOWPAN_DFF.</dd>
<dt>Duplicate packet flag (D)</dt>
<dd style="margin-left: 8">- This flag is included in the DFF mesh header to indicate that the packet has been re-sent as a duplicate. The flag MUST be set to 1 by the node that re-sends the packet after detecting link-layer failure to deliver through the last attempted next-hop, as specified in <a href="#packet_processing">Section 8.2</a>. Once the flag is set to 1, it MUST not be modified by nodes forwarding the packet.</dd>
<dt>Return packet flag (R)</dt>
<dd style="margin-left: 8">- This flag is included in the DFF mesh header to indicate that the packet has been returned to the previous hop after failure to deliver to all the available next-hops. The flag MUST be set to 1 prior to forwarding the packet back to the previous hop and MUST be set to 0 prior to forwarding the packet to the selected next-hop, as specified in <a href="#packet_processing">Section 8.2</a>. This flag is modified in a hop-by-hop basis.</dd>
<dt>Reserved flag (x)</dt>
<dd style="margin-left: 8">- This bit is reserved for future flag definitions.</dd>
<dt>DID</dt>
<dd style="margin-left: 8">- This is the data packet identifier. It is a sequence number generated by the originator, unique on a node for each new generated packet. The originator address concatenated with the DID sequence number represent an identifier of previously seen data packets. </dd>
</dl>

<p> </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#parameters" id="parameters">Protocol Parameters and Constants</a>
</h1>
<p id="rfc.section.7.p.1">The parameters and constants used in this specification are described in this section.  </p>

<dl>
<dt>P_HOLD_TIME</dt>
<dd style="margin-left: 8">- is the time period after which a newly created Processed Tuple expires and MUST be deleted.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Data Packet Generation and Processing</h1>
<p id="rfc.section.8.p.1">The following sections describe the process of handling a new packet, generated on a node (<a href="#packet_generation">Section 8.1</a>), as well as forwarding a packet from another node (<a href="#packet_processing">Section 8.2</a>).</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#packet_generation" id="packet_generation">Data Packet Generation</a>
</h1>
<p id="rfc.section.8.1.p.1">Before a new packet (the "current packet") is transmitted on a node, the following steps MUST be performed: </p>

<ol>
<li>Add the mesh header to the current packet, as specified in <a href="#packet_format">Section 6</a>, with: <ul>
<li>Duplicate packet flag (D) := 0;</li>
<li>Return packet flag (R) := 0;</li>
<li>DID := a new sequence number of the packet.</li>
</ul>
<p> </p>
</li>
<li>Select the next hop (denoted "next_hop") for the current packet, as specified in <a href="#getnexthop">Section 10</a>.  </li>
<li>Add a Processed Tuple to the Processed Set with: <ul>
<li>P_orig_address := the originator address of this node;</li>
<li>P_seq_number := the sequence number of the current packet, as added in the header in Step 1;</li>
<li>P_prev_hop := the originator address of this node;</li>
<li>P_next_hop_neighbor_list := [next_hop];</li>
<li>P_time := current time + P_HOLD_TIME.</li>
</ul>
<p> </p>
</li>
<li>Forward the current packet to next_hop.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#packet_processing" id="packet_processing">Data Packet Processing</a>
</h1>
<p id="rfc.section.8.2.p.1">If a packet (the "current packet") is received on the node, then the following tasks MUST be performed: </p>

<ol>
<li>If the packet does not contain the DFF header, specified in <a href="#packet_format">Section 6</a>, select the next hop (denoted "next_hop") for the current packet, as specified in <a href="#getnexthop">Section 10</a>, and then forward it to next_hop. This allows for interoperability of nodes sending packets without DFF, by forwarding them without the specified depth-first forwarding mechanism.  </li>
<li>Otherwise, if no Processed Tuple (the "current tuple") exists in the Processed Set, with: <dl>
<dt>+</dt>
<dd style="margin-left: 8">P_orig_address = the originator address of the current packet, AND;</dd>
<dt>+</dt>
<dd style="margin-left: 8">P_seq_number = the sequence number of the current packet,</dd>
</dl>
<p> then: </p>
<dl>
<dt>4 .</dt>
<dd>add a Processed Tuple (the "current tuple") with: <ul>
<li>P_orig_address := the originator address of the current packet;</li>
<li>P_seq_number := the sequence number (DID) of the current packet;</li>
<li>P_prev_hop := address of the previous hop of the current packet;</li>
<li>P_next_hop_neighbor_list := 	[next_hop];</li>
<li>P_time := current time + P_HOLD_TIME.</li>
</ul>
<p> </p>
</dd>
<dt>5 .</dt>
<dd>Set RET to 0 in the packet DFF header.  </dd>
<dt>6 .</dt>
<dd>Select the next hop (denoted "next_hop") for the current packet, as specified in <a href="#getnexthop">Section 10</a>, and then forward the current packet to next_hop. If the transmission fails (determined by missing link layer acknowledgments), the procedures in <a href="#missed_ACK">Section 9</a> SHOULD be executed.  </dd>
</dl>
<p> </p>
</li>
<li>Otherwise, if a tuple exists: <ol>
<li>If the return flag of the current packet is not set (RET=0), set RET:=1 and return the packet to the previous hop of the packet (i.e. a loop has been detected, and the packet is returned).</li>
<li>Otherwise, if the return flag of the current packet is set (RET=1): <ol>
<li>Set RET:=0</li>
<li>Increase the route cost in the routing table entry for the packet destination with the next hop of the current packet, as defined in <a href="#poison">Section 11</a>.</li>
<li>Select the next hop (denoted "next_hop") for the current packet, as specified in <a href="#getnexthop">Section 10</a>.  </li>
<li>Modify the current tuple: <ul>
<li>P_next_hop_neighbor_list := 	P_next_hop_neighbor_list@[next_hop];</li>
<li>P_time := current time + P_HOLD_TIME.</li>
</ul>
<p> </p>
</li>
<li>If the selected next hop is equal to P_prev_hop of the current tuple (i.e. all neighbors have been unsuccessfully tried), set the RET flag (RET := 1), otherwise reset it (RET := 0).  </li>
<li>Forward the current packet to next_hop. If the transmission fails (determined by missing link layer acknowledgments), the procedures in <a href="#missed_ACK">Section 9</a> SHOULD be executed.  </li>
</ol>
<p> </p>
</li>
</ol>
<p> </p>
</li>
</ol>

<p> </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#missed_ACK" id="missed_ACK">Missed Link Layer Acknowledgment when Sending a Packet</a>
</h1>
<p id="rfc.section.9.p.1">If a packet (the "current packet") has been sent to the next hop, as specified in <a href="#packet_generation">Section 8.1</a> and <a href="#packet_processing">Section 8.2</a>, and no link layer acknowledgment has been received after several retries (as specified in <a href="#ieee802.15.4">[ieee802.15.4]</a>), then: </p>

<ol>
<li>Set the duplicate flag (DUP) of the DFF header of the current packet to 1.  </li>
<li>Select the next hop (denoted "next_hop") for the current packet, as specified in <a href="#getnexthop">Section 10</a>.  </li>
<li>Find the Processed Tuple (the "current tuple") in the Processed Set, with: <dl>
<dt>+</dt>
<dd style="margin-left: 8">P_orig_address = the originator address of the current packet, AND;</dd>
<dt>+</dt>
<dd style="margin-left: 8">P_seq_number = the sequence number of the current packet,</dd>
</dl>
<p> and modify the current tuple: </p>
<ul>
<li>P_next_hop_neighbor_list := 	P_next_hop_neighbor_list@[next_hop];</li>
<li>P_time := current time + P_HOLD_TIME.</li>
</ul>
<p> </p>
</li>
<li>If the selected next hop is equal to P_prev_hop of the current tuple, set the RET flag (RET := 1), otherwise reset it (RET := 0).  </li>
<li>Forward the current packet to next_hop.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#getnexthop" id="getnexthop">Getting the Next Hop for a Packet</a>
</h1>
<p id="rfc.section.10.p.1">Before a packet (the "current packet") is sent from a node towards the packet destination, a valid next hop along the path has to be selected. This section describes how to select the next hop (denoted "next_hop"). As a Processed Tuple was either existing when receiving the packet, or otherwise was created, it can be assumed the a Processed Tuple for that packet (the "current tuple") is available.  </p>
<p id="rfc.section.10.p.2">The next hop is chosen from the Neighbor Set in order of decreasing preference of the following conditions. This list is only a suggestion, any other order of priority MAY be used.  </p>

<ol>
<li>The neighbor is listed in the Routing Set as next hop for the destination of the current packet, with lower route costs having a higher priority, and the neighbor is not listed in P_next_hop_neighbor_list of the current tuple.</li>
<li>The neighbor is not listed in the Routing Set as any next hop destination of the current packet, and the neighbor is not listed in P_next_hop_neighbor_list of the current tuple.</li>
<li>The neighbor is the same as P_prev_hop of the current tuple; this case is only used for returning the packet to the previous hop, in which case the RET flag MUST be set to 1.</li>
</ol>

<p> </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#poison" id="poison">Poisoning</a>
</h1>
<p id="rfc.section.11.p.1">When a packet is returned (i.e. a packet with RET=1 is received by a node) or a link layer acknowledgment (ACK) has not been received for a forwarded packet, the cost for the route MAY be increased, so that future transmissions prefer other routes. For the case of a missing link layer ACK, in addition to increasing the route cost, the link cost to the neighbor may also be increased.  </p>
<p id="rfc.section.11.p.2">It is up to the implementation to decide by how much the route and link cost should be increased and out of scope of this document.</p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> <a href="#proposed_values" id="proposed_values">Proposed Values for Parameters and Constants</a>
</h1>
<p id="rfc.section.12.p.1">This section lists the parameters and constants used in the   specification of the protocol, and proposed values of each that MAY be used when a single value of each is used.  </p>

<ul><li>P_HOLD_TIME := 5 seconds</li></ul>

<p> </p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.13.p.1">The security of the underlying mesh routing protocol depends on the integrity, authentication, and confidentiality of the control messages. The security mechanisms for protecting the network can be provided by link-layer technologies. Further details are presented in the Security Considerations section of <a href="#RFC4944">[RFC4944]</a>.</p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.14.p.1">IANA is requested to allocate a value from the Dispatch Type Field registry for LOWPAN_DFF.  </p>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.15.p.1">Yuichi Igarashi (Hitachi), Kazuya Monden (Hitachi), Geoff Mulligan (IPSO), Hiroki Satoh (Hitachi), and Ganesh Venkatesh (UC San Diego) provided useful discussions which helped to improve this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4944">[RFC4944]</b></td>
<td class="top">
<a>Montenegro, G.</a>, <a>Kushalnagar, N.</a>, <a>Hui, J.</a> and <a>D. Culler</a>, "<a href="http://tools.ietf.org/html/rfc4944">Transmission of IPv6 Packets over IEEE 802.15.4 Networks</a>", RFC 4944, September 2007.</td>
</tr>
<tr>
<td class="reference"><b id="ieee802.15.4">[ieee802.15.4]</b></td>
<td class="top">
<a>Computer Society, IEEE</a>, "<a>IEEE Std. 802.15.4-2003</a>", October 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#Appendix1" id="Appendix1">Examples</a>
</h1>
<p id="rfc.section.Appendix A.p.1">In this section, some example network topologies are depicted, using the DFF mechanism for data forwarding. In these examples, it is assumed that the underlying routing protocol provides a list of neighbors of each node, and a routing table with one or more next hops to a destination, if the topology provides a path from the node to the destination.  </p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> <a href="#example1" id="example1">Example 1: Normal Delivery</a>
</h1>
<div id="#rfc.figure.2"></div>
<div id="#example1_fig"></div>
<pre>
                  +---+
              +---+ D +-----+
              |   +---+     |
      +---+   |             |
  +---+ B +---+             |
  |   +---+   |             |
+-+-+         |   +---+   +-+-+
| A |         +---+ E +---+ G +
+-+-+             +---+   +-+-+
  |   +---+                 |
  +---+ C +---+             |
      +---+   |             |
              |   +---+     |
              +---+ F +-----+
                  +---+
</pre>
<p><a href="#example1_fig">Figure 2</a> depicts a network topology with seven nodes A to G, with links between them as indicated by lines. It is assumed that node A sends a packet to G, through B and D, according to the underlying routing protocol.  <a href="#getnexthop">Section 10</a>, i.e. it will first select the next hop for node G as determined by the underlying routing protocol.  </p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> <a href="#example2" id="example2">Example 2: Forwarding with Link Failure</a>
</h1>
<div id="#rfc.figure.3"></div>
<div id="#example2_fig"></div>
<pre>
                  +---+
              XXX-+ D +-----+
              X   +---+     |
      +---+   X             |
  +---+ B +---+             |
  |   +---+   X             |
+-+-+         X   +---+   +-+-+
| A |         XXXX+ E +---+ G +
+-+-+             +---+   +-+-+
  |   +---+                 |
  +---+ C +---+             |
      +---+   |             |
              |   +---+     |
              +---+ F +-----+
                  +---+
</pre>
<p><a href="#example2_fig">Figure 3</a> depicts the same topology as the Example 1, but both links between B and D and between B and E are unavailable (e.g. because of wireless link characteristics).  <a href="#missed_ACK">Section 9</a>, by setting the DUP flag to 1, selecting E as new next hop, adding E to the list of next hops in the Processed Tuple, and then forwarding the packet to E.  </p>
<p id="rfc.section.Appendix A.2.p.2">As the link to E also fails, B will again follow the procedure in <a href="#missed_ACK">Section 9</a>. As all possible next hops (D and E) are listed in the Processed Tuple, B will set the RET flag in the packet and return it to A.  </p>
<p id="rfc.section.Appendix A.2.p.3">A determines that it already has a Processed Tuple for the returned packet, reset the RET flag of the packet and select a new next hop for the packet. As B is already in the list of next hops in the Processed Tuple, it will select C as next hop and forward the packet to it. C will then forward the packet to F, and F delivers the packet to its destination G.  </p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> <a href="#example3" id="example3">Example 3: Forwarding with Missed Link Layer Acknowledgment</a>
</h1>
<div id="#rfc.figure.4"></div>
<div id="#example3_fig"></div>
<pre>
                  +---+
              +---+ D +-----+
              |   +---+     |
      +---+   |             |
  +---+ B +---+             |
  |   +---+   |             |
+-+-+         |   +---+   +-+-+
| A |         +---+ E +---+ G +
+-+-+             +---+   +-+-+
  .   +---+                 |
  +...+ C +---+             |
      +---+   |             |
              |   +---+     |
              +---+ F +-----+
                  +---+
</pre>
<p><a href="#example3_fig">Figure 4</a> depicts the same topology as the Example 1, but the link layer acknowledgments from C to A are lost (e.g. because the link is uni-directional). It is assumed that A prefers a path to G through C and F.  </p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> <a href="#example4" id="example4">Example 4: Forwarding with a Loop</a>
</h1>
<div id="#rfc.figure.5"></div>
<div id="#example4_fig"></div>
<pre>
  +-----------------+
  |                 |
  |               +-+-+
  |           +---+ D +
  |           |   +---+
 \|/  +---+   |
  +---+ B +---+
  |   +---+   |
+-+-+         |   +---+   +-+-+
| A |         +---+ E +---+ G +
+-+-+             +---+   +-+-+
  |   +---+                 |
  +---+ C +---+             |
      +---+   |             |
              |   +---+     |
              +---+ F +-----+
                  +---+
</pre>
<p><a href="#example4_fig">Figure 5</a> depicts the same topology as the Example 1, but there is a loop from D to A, and A sends the packet through B and D.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ulrich Herberg</span> 
	  <span class="n hidden">
		<span class="family-name">Herberg</span>
	  </span>
	</span>
	<span class="org vcardline">Fujitsu Laboratories</span>
	<span class="adr">
	  <span>1240 E. Arques Avenue, M/S 345</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94085</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 408 530-4528</span>

<span class="vcardline">EMail: <a href="mailto:ulrich.herberg@us.fujitsu.com">ulrich.herberg@us.fujitsu.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Alvaro A. Cardenas</span> 
	  <span class="n hidden">
		<span class="family-name">Cardenas</span>
	  </span>
	</span>
	<span class="org vcardline">Fujitsu Laboratories</span>
	<span class="adr">
	  <span>1240 E. Arques Avenue, M/S 345</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94085</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1 408 530-4516</span>

<span class="vcardline">EMail: <a href="mailto:alvaro.cardenas-mora@us.fujitsu.com">alvaro.cardenas-mora@us.fujitsu.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sandra L. Cespedes</span> 
	  <span class="n hidden">
		<span class="family-name">Cespedes</span>
	  </span>
	</span>
	<span class="org vcardline">U. Icesi/U. of Waterloo</span>
	<span class="adr">
	  <span>Calle 18 No. 122-135 Pance</span>

	  <span class="vcardline">
		<span class="locality">Cali</span>,  
		<span class="region">Valle</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Colombia</span>
	</span>
	<span class="vcardline">Phone: +1 (519) 8884567 x37448</span>

<span class="vcardline">EMail: <a href="mailto:slcesped@bbcr.uwaterloo.ca">slcesped@bbcr.uwaterloo.ca</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Tadashige Iwao</span> 
	  <span class="n hidden">
		<span class="family-name">Iwao</span>
	  </span>
	</span>
	<span class="org vcardline">Fujitsu Limited</span>
	<span class="adr">
	  <span>Shiodome City Center, 5-2, Higashi-shimbashi 1-chome, Minato-ku</span>

	  <span class="vcardline">
		<span class="locality">Tokyo</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">JP</span>
	</span>
	<span class="vcardline">Phone: +81-44-754-3343</span>

<span class="vcardline">EMail: <a href="mailto:smartnetpro-iwao_std@ml.css.fujitsu.com">smartnetpro-iwao_std@ml.css.fujitsu.com</a></span>

  </address>
</div>

</body>
</html>