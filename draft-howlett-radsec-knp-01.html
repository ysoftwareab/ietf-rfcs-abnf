<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Key Negotiation Protocol for RadSec (KNP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Federation with RADIUS">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Federation with RadSec">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Requirements">
<link href="#rfc.section.1.4" rel="Chapter" title="1.4 Federating RADIUS">
<link href="#rfc.section.1.5" rel="Chapter" title="1.5 Introducing KMP">
<link href="#rfc.section.1.6" rel="Chapter" title="1.6 Trust Router">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions used in this document">
<link href="#rfc.section.3" rel="Chapter" title="3 The KNP Actors">
<link href="#rfc.section.4" rel="Chapter" title="4 Relationships With Other Protocols">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Relationship to GSS-API and EAP">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Relationship to AAA">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Relationship to HTTP Negotiate">
<link href="#rfc.section.5" rel="Chapter" title="5 Key Negotiation Protocol">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Invocation by RADIUS Client">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Discovery of the RADIUS Server and KNP Endpoint">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Trust Establishment">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 Client and Introducer">
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 Server and Introducer">
<link href="#rfc.section.5.3.3" rel="Chapter" title="5.3.3 Server to Client">
<link href="#rfc.section.5.3.4" rel="Chapter" title="5.3.4 Client to Server">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Keying">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 TLS Encryption Negotiation">
<link href="#rfc.section.6" rel="Chapter" title="6 Context and PSK Management">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="RadSec provides a means to secure the communication between a RADIUS client and server on the transport layer by using a TLS cipher-suite. This avoids the security weaknesses inherent in RADIUS' use of the MD5 algorithm.  " />
  <meta name="description" content="RadSec provides a means to secure the communication between a RADIUS client and server on the transport layer by using a TLS cipher-suite. This avoids the security weaknesses inherent in RADIUS' use of the MD5 algorithm.  " />
  <meta name="keywords" content="Internet-Draft, Federated Authentication, AAA, RADIUS, GSS-API, EAP" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">ABFAB</td>
<td class="right">J. Howlett</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">JANET(UK)</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">S. Hartman</td>
</tr>
<tr>
<td class="left">Expires: September 15, 2011</td>
<td class="right">Painless Security</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 14, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Key Negotiation Protocol for RadSec (KNP)<br />
  <span class="filename">draft-howlett-radsec-knp-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>RadSec provides a means to secure the communication between a RADIUS client and server on the transport layer by using a TLS cipher-suite. This avoids the security weaknesses inherent in RADIUS' use of the MD5 algorithm.  </p>
<p>The Key Negotiation Protocol for RadSec enables a RADIUS client and RADIUS server to derive a key that can be used with a TLS PSK ciphersuite and applied with a RadSec connection.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 15, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Federation with RADIUS</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Federation with RadSec</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Requirements</a>
</li>
<li>1.4.   <a href="#rfc.section.1.4">Federating RADIUS</a>
</li>
<li>1.5.   <a href="#rfc.section.1.5">Introducing KMP</a>
</li>
<li>1.6.   <a href="#rfc.section.1.6">Trust Router</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions used in this document</a>
</li>
<li>3.   <a href="#rfc.section.3">The KNP Actors</a>
</li>
<li>4.   <a href="#rfc.section.4">Relationships With Other Protocols</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Relationship to GSS-API and EAP</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Relationship to AAA</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Relationship to HTTP Negotiate</a>
</li>
<li>5.   <a href="#rfc.section.5">Key Negotiation Protocol</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Invocation by RADIUS Client</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Discovery of the RADIUS Server and KNP Endpoint</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Trust Establishment</a>
</li>
<li>5.3.1.   <a href="#rfc.section.5.3.1">Client and Introducer</a>
</li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">Server and Introducer</a>
</li>
<li>5.3.3.   <a href="#rfc.section.5.3.3">Server to Client</a>
</li>
<li>5.3.4.   <a href="#rfc.section.5.3.4">Client to Server</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Keying</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">TLS Encryption Negotiation</a>
</li>
<li>6.   <a href="#rfc.section.6">Context and PSK Management</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The ABFAB architecture <a href="#I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</a> provides an overview of how AAA protocols, such as RADIUS<a href="#RFC2865">[RFC2865]</a>, can be used to support application layer authentication. In this architecture, the AAA protocols are part of the 'federation substrate' that ultimately binds relying parties to identity providers. The ABFAB substrate provides the architectural roles: </p>

<ul>
<li>Deciding where to route messages addressed to a given Network Access Identifier (NAI)</li>
<li>Providing integrity protection and authentication so the relying party can trust the authenticity of messages from the identity provider</li>
<li>When multiple sets of business rules are possible, indicate which rules are being used</li>
<li>Provide appropriate technical validation of information exchanged through the federation.</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.2">Today, AAA protocols are already commonly employed for federation between different domains. These system generally exhibit many of these behaviours.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Federation with RADIUS</h1>
<p id="rfc.section.1.1.p.1">In a simple federated relationship, static configuration of RADIUS is used to achieve technical trust. The RADIUS proxy is configured with a static set of mappings from realm suffix to RADIUS server. There are statically configured shared secrets with each of these servers. Statically configured attribute release policies describe what attributes may be expressed by RADIUS servers outside of the local realm.  </p>
<p id="rfc.section.1.1.p.2">Another common deployment involves an organization running a network of RADIUS proxies.  These proxies are statically configured with routing, credentials and filtering information.  A RADIUS proxy network and this static configuration is sometimes known as a proxy fabric.  </p>
<p id="rfc.section.1.1.p.3">One disadvantage of a proxy fabric is that the intermediate proxies can see information exchanged between the RADIUS client (or the relying party in the ABFAB architecture) and terminal RADIUS server (or the identity provider in the ABFAB architecture). Sometimes this might be desirable: for example if an intermediate proxy is needed to validate some of this information. However, it does create a significant privacy exposure. </p>
<p id="rfc.section.1.1.p.4">Also, especially for the Extensible Authentication Protocol <a href="#RFC3748">[RFC3748]</a>, reducing the latency of a round trip can provide a significant performance advantage.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Federation with RadSec</h1>
<p id="rfc.section.1.2.p.1">TLS encryption for RADIUS (RadSec) <a href="#I-D.ietf-radext-radsec">[I-D.ietf-radext-radsec]</a> provides a means to secure the communication between a RADIUS and server on the transport layer by using a TLS <a href="#RFC5246">[RFC5246]</a> cipher-suite. This avoids the security weaknesses inherent in RADIUS' use of the MD5 algorithm and removes the requirement for a RADIUS client to be preconfigured with a shared secret to communicate with a particular RADIUS server. This can be a significant part of reducing the intermediaries in a RADIUS deployment.  </p>
<p id="rfc.section.1.2.p.2">RadSec mandates the use of one of the <a href="#RFC5246">[RFC5246]</a> ciphersuites and recommends the use of two other ciphersuites specified in that document. However any ciphersuite, including the TLS Pre-Shared Key (PSK) ciphersuites <a href="#RFC4279">[RFC4279]</a>, may be used providing that it supports encryption.  </p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Requirements</h1>
<p id="rfc.section.1.3.p.1">The KNP is motivated by the following requirements: </p>

<ul>
<li>Improve security while using a familiar credential technology. RADIUS uses shared secrets to establish trust between RADIUS clients and servers. For some AAA operational models it may be more convenient to continue using secrets rather than introduce a new credential technology (such as X.509 certificates) when transitioning to the use of TLS encryption.  </li>
<li>Agnosticism with respect to credential technology. In complex multi-domain federated AAA systems it may often be convenient not to impose any particular credential technology(s) or trust anchor(s) to establish trust between RADIUS peers. In other words, it may be desirable for RADIUS peers in different administrative domains to negotiate keys in the absence of any understanding of their respective credential technologies or trust anchors. This agnosticism may improve interoperability within, and facilitate the scaling of, large heterogeneous AAA environments where it may be difficult - for technical or administrative reasons - to impose support for a common (or even a small number of) technologies or trust anchors.  </li>
<li>Online trust management. Similarly, the use of a variety of different trust anchors and credential technologies may impede essential trust management functions such as timely revocation.  In complex federated AAA environments, it would be desirable to permit online trust management in a way that is independent of the underlying credential technology.  </li>
<li>Avoiding intermediaries. Reducing the number of intermediaries improves privacy and system robustness, and reduces end-to-end latencies.</li>
</ul>

<p> </p>
<h1 id="rfc.section.1.4">
<a href="#rfc.section.1.4">1.4.</a> Federating RADIUS</h1>
<p id="rfc.section.1.4.p.1">In order to provide a scalable substrate for federation, the AAA fabric needs to provide authentication and exchange of policy information between RADIUS clients and servers that cross organizational boundaries. That is, federated access management is required for RADIUS as an application.  </p>
<p id="rfc.section.1.4.p.2">As with other applications, the ABFAB technologies can be applied to provide federated access management. RADIUS clients act as clients and subjects. They have identities issued by the organization establishing the federation, which acts as an identity provider. The foreign RADIUS server acts as a relying party.  </p>
<p id="rfc.section.1.4.p.3">This specification defines a protocol that permits the ABFAB architecture to be used for federated access to RADIUS, providing the technical details for interactions between parties. In an environment where ABFAB is in use, this technology may provide significant advantages over other approaches such as a public-key infrastructure. In ABFAB, credentials are always managed between two parties. The subject and identity provider (in this case, the RADIUS client and federation) share a credential. The relying party and identity provider share a secure channel created by AAA credentials. Since only two parties need to interact with each credential, their requirements dictate the complexity of enrollment, revocation, policies, practices, and other credential management issues. Trust anchor management may be significantly simpler.</p>
<h1 id="rfc.section.1.5">
<a href="#rfc.section.1.5">1.5.</a> Introducing KMP</h1>
<p id="rfc.section.1.5.p.1">The Key Negotiation Protocol (KNP) provides two functions: </p>

<ol>
<li>It enables a RADIUS client and RADIUS server to derive a credential that can be used with a TLS PSK ciphersuite applied to a RadSec connection between these peers. This credential is obtained as a result of an EAP authentication between the RADIUS client, a trusted third-party EAP server known as the Introducer and the RADIUS server acting as an EAP pass-through authenticator.  </li>
<li>It enables a RADIUS client and RADIUS server to derive an EAP credential that the client may subsequently use to authenticate against that RADIUS server, now acting as Introducer, via a second RADIUS server acting as an EAP pass-through authenticator. This credential may be used to establish a TLS PSK (using the function described above); or to establish yet another credential with another RADIUS server.  </li>
</ol>

<p> </p>
<p id="rfc.section.1.5.p.2">In summary, the first function enables a RADIUS client and server to negotiate a key by means of a trusted third-party called the Introducer. The second function enables a RADIUS client to establish an Introducer which it might subsequently use the first facility against; or, in an iterative manner, repeat the second facility to establish yet another Introducer.  </p>
<p id="rfc.section.1.5.p.3">TODO: this document currently only documents the first of these functions. The second facility will be documented in a later revision.  </p>
<p id="rfc.section.1.5.p.4">The composition of these two facilities enables a RADIUS client to dynamically establish a trust relationship with a RADIUS server in the absence of any pre-existing relationship, providing that there exists a path between the RADIUS client and server via one or more intermediate Introducers.  </p>
<p id="rfc.section.1.5.p.5">Conceptually the role of an Introducer as a trust broker is not dissimilar to that of a conventional AAA proxy. The key difference is that the trust path between the RADIUS client and server need not bear any resemblance to the transit path taken by the AAA messages between the RADIUS client and server.  </p>
<h1 id="rfc.section.1.6">
<a href="#rfc.section.1.6">1.6.</a> Trust Router</h1>
<p id="rfc.section.1.6.p.1">Static configuration of routing information does not scale. Instead it would be desirable to have a protocol that dynamically assembles the necessary configuration information for RADIUS proxies.</p>
<p id="rfc.section.1.6.p.2">This protocol has a lot in common with a routing protocol. The protocol maintains a distributed database synchronized across a number of replicas. It's likely that multiple paths will be able to reach the same destination in some cases. Thus, some sort of shortest-path algorithm is required. The metric often will be more complex than simply length of path: business rules may prefer certain paths. Business rules may also filter out certain paths at various points.  </p>
<p id="rfc.section.1.6.p.3">We propose that as ABFAB deployment complexity increases, such a protocol will be required. Within a federation, local procedures, such as frequently updated static configuration could be used. However, to provide scalable inter-federation, a trust router  protocol is required to exchange the information necessary to establish technical trust in a dynamic manner. This document does not define a specific instantiation of a trust routing protocol. Instead, it focuses on a problem that results once a trust routing protocol exists. Efforts to design a proposal for a trust router protocol are ongoing but less mature than this proposal.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Conventions used in this document</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> The KNP Actors</h1>
<p id="rfc.section.3.p.1">The KNP does not require the RADIUS client and RADIUS server to share a trust relationship. Instead, it only requires that these parties share a trust relationship with a mutually trusted third party. In the KNP, this party is known as the "Introducer".  </p>
<p id="rfc.section.3.p.2">Figure 1 below depicts the trust relationships for a RADIUS client, RADIUS server and the Introducer before the KNP has been invoked.  </p>
<div id="#rfc.figure.1"></div>
<pre>
                                Introducer
                                    /\
                                   /  \
                                  /    \
                            RADIUS      RADIUS
                            Client      Server

                                Figure 1
            </pre>
<p id="rfc.section.3.p.3">Figure 2 below depicts the new trust relationship between the RADIUS client, RADIUS server and the Introducer after the KNP has been invoked.  </p>
<div id="#rfc.figure.2"></div>
<pre>
                                Introducer
                                    /\
                                   /  \
                                  /    \
                            RADIUS------RADIUS
                            Client      Server

                                Figure 2
            </pre>
<p id="rfc.section.3.p.4">Figure 3 below depicts the flow of RADIUS packets from the RADIUS client to the RADIUS server using the new trust relationship.  </p>
<div id="#rfc.figure.3"></div>
<pre>
                                Introducer



                            RADIUS ---&gt; RADIUS
                            Client      Server

                                Figure 3
            </pre>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Relationships With Other Protocols</h1>
<p id="rfc.section.4.p.1">The KNP builds on a variety of protocols. This section describes the relationship of KNP to these.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Relationship to GSS-API and EAP</h1>
<p id="rfc.section.4.1.p.1">The KNP builds on the GSS-API <a href="#RFC2743">[RFC2743]</a> framework, the GSS EAP mechanism <a href="#I-D.ietf-abfab-gss-eap">[I-D.ietf-abfab-gss-eap]</a> and EAP <a href="#RFC3748">[RFC3748]</a>. The RADIUS client, acting as the GSS initiator and EAP peer, establishes a GSS-API security context with the RADIUS server, acting as the GSS acceptor and EAP authenticator, by reference to an EAP server that acts as the Introducer.  </p>
<p id="rfc.section.4.1.p.2">The KNP enables all three parties - RADIUS client, RADIUS server and Introducer - to establish a common view of their mutual relationships as described by the names and keys that the KNP generates.  </p>
<p id="rfc.section.4.1.p.3">The RADIUS client must possess an EAP credential for the introducer, allowing mutual authentication of both parties when applied with an appropriate EAP method.  </p>
<p id="rfc.section.4.1.p.4">Figure 4 below depicts the relationships between these entities: </p>
<div id="#rfc.figure.4"></div>
<pre>
                                Introducer
                                    /\
                                   /  \
                                  /    \
                            RADIUS      RADIUS
                            Client      Server
                     (wielding EAP
                    credential for
                   the introducer)

                                Figure 4
                </pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Relationship to AAA</h1>
<p id="rfc.section.4.2.p.1">The RADIUS server uses an AAA protocol to forward the EAP transaction to the Introducer.  </p>
<p id="rfc.section.4.2.p.2">The RADIUS server must possess an AAA credential for the Introducer, allowing mutual authentication of both parties.  </p>
<p id="rfc.section.4.2.p.3">Figure 5 below depicts the relationships between these entities: </p>
<div id="#rfc.figure.5"></div>
<pre>
                               Introducer
                                    /\
                                   /  \
                                  /    \
                            RADIUS      RADIUS
                            Client      Server
                     (wielding EAP      (wielding AAA
                    credential for      credential for
                   the Introducer)      the Introducer)

                                Figure 5
                </pre>
<p id="rfc.section.4.2.p.4">The Introducer is always a single system entity: the EAP server. However, the AAA link between the RADIUS server and Introducer may not be direct, and instead may be composed of one or more proxies.  </p>
<p id="rfc.section.4.2.p.5">For the purposes of KNP, the RADIUS server and Introducer must have equivalent or greater trust in any intermediate proxies than they do with each other.  </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Relationship to HTTP Negotiate</h1>
<p id="rfc.section.4.3.p.1">The GSS EAP mechanism is transported using the HTTP Negotiate authentication scheme <a href="#RFC4559">[RFC4559]</a> between the RADIUS client and the RADIUS server's KNP endpoint.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Key Negotiation Protocol</h1>
<p id="rfc.section.5.p.1">This section describes the KNP.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Invocation by RADIUS Client</h1>
<p id="rfc.section.5.1.p.1">The KNP is invoked when the RADIUS client creates or receives (in the case that it is also a proxy) a RADIUS message which must be forwarded towards a RADIUS server but for which the RADIUS client lacks a PSK. For example: </p>
<p></p>

<ul>
<li>The RADIUS client may not have any local configuration for the RADIUS server.  </li>
<li>The RADIUS client may have a cached PSK for the RADIUS server and may have already attempted a RADIUS over TLS connection, but this has been refused by the RADIUS server; possibly because the RADIUS server has deleted the key.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Discovery of the RADIUS Server and KNP Endpoint</h1>
<p id="rfc.section.5.2.p.1">The RADIUS client first selects a RADIUS server. Implementations MUST support the use of Dynamic Peer Discovery <a href="#I-D.ietf-radext-dynamic-discovery">[I-D.ietf-radext-dynamic-discovery]</a>, but MAY use any selection algorithm.  </p>
<p id="rfc.section.5.2.p.2">Having selected a RADIUS server and obtained its network location, the RADIUS client MUST attempt to establish an HTTP <a href="#RFC2616">[RFC2616]</a> connection with the RADIUS server's KNP end-point.  </p>
<p id="rfc.section.5.2.p.3">This specification defines the SRV prefix "_knp._tcp". This MAY be used to describe the network location of the KNP endpoint. Implementations MUST support the use of this SRV RR. The label used for this record is the RADIUS server.  </p>
<p id="rfc.section.5.2.p.4">Example: </p>
<p id="rfc.section.5.2.p.5">_knp._tcp.radsec.example.com.  IN SRV 0 10 TODO knp.example.com.  </p>
<p id="rfc.section.5.2.p.6">TODO: obtain a port.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Trust Establishment</h1>
<p id="rfc.section.5.3.p.1">It is essential that all three actors - RADIUS Client, Server and Introducer - are able to validate each other's respective claims to their names. These are determined using different processes for each relationship, and are summarised in Figure 6 below.  </p>
<div id="#rfc.figure.6"></div>
<pre>
+===============+===============+==================+===============+
|    Subject    | Relying Party |     Process      | Evidence from |
+===============+===============+==================+===============+
| RADIUS Client |  Introducer   |     EAP GSS      |  EAP method   |
+---------------+---------------+  authentication  | w/ qualifying |
|  Introducer   | RADIUS Client | (section 6.3.1. )|Security Claims|
+===============+===============+==================+===============+
|  Introducer   | RADIUS Server |       AAA        |      AAA      |
+---------------+---------------+  authentication  |     shared    |
| RADIUS Server |  Introducer   | (section 6.3.2. )|     secret    |
+===============+===============+==================+===============+
|    RADIUS     |     RADIUS    | Channel bindings | Assertion by  |
|    Server     |     Client    | (section 6.3.3. )|  Introducer   |
+---------------+---------------+------------------+---------------+
|    RADIUS     |     RADIUS    | RADIUS attribute | Assertion by  |
|    Client     |     Server    | (section 6.3.4. )|  Introducer   |
+===============+===============+==================+===============+
                            Figure 6
                </pre>
<p id="rfc.section.5.3.p.2">The following sections describe how these processes are used by the KNP to establish trust between the actors and, in particular, how they determine their respective names.  </p>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#KNP_Trust_ClientAndIntroducer" id="KNP_Trust_ClientAndIntroducer">Client and Introducer</a>
</h1>
<p id="rfc.section.5.3.1.p.1">The RADIUS client invokes the GSS authentication handshake using the GSS EAP mechanism <a href="#I-D.ietf-abfab-gss-eap">[I-D.ietf-abfab-gss-eap]</a>  using an empty POST method. The RADIUS client, in its role as GSS initiator, MUST request mutual authentication from the GSS layer.  </p>
<p id="rfc.section.5.3.1.p.2">The RADIUS server, acting as an EAP authenticator as described in section 2.3 of <a href="#RFC3748">[RFC3748]</a>, MUST forward the EAP Request messages from the RADIUS client towards the Introducer over RADIUS; and also all EAP Responses received from the Introducer over RADIUS from the Introducer to the RADIUS client.  </p>
<p id="rfc.section.5.3.1.p.3">The RADIUS client and Introducer MUST negotiate an EAP method supporting the following EAP Security Claims: mutual authentication, integrity protection, replay protection, confidentiality, key derivation, dictionary attack resistance, session independence and channel binding.  </p>
<h1 id="rfc.section.5.3.2">
<a href="#rfc.section.5.3.2">5.3.2.</a> <a href="#KNP_Trust_ServerAndIntroducer" id="KNP_Trust_ServerAndIntroducer">Server and Introducer</a>
</h1>
<p id="rfc.section.5.3.2.p.1">The RADIUS Server and Introducer MUST each possess a shared secret to protect the RADIUS exchange described in section <a href="#KNP_Trust_ClientAndIntroducer">Section 5.3.1</a>. The shared secret MUST be established out-of-band prior to the invocation of the KNP; this is not within the scope of the KNP.  </p>
<h1 id="rfc.section.5.3.3">
<a href="#rfc.section.5.3.3">5.3.3.</a> <a href="#KNP_Trust_ServerToClient" id="KNP_Trust_ServerToClient">Server to Client</a>
</h1>
<p id="rfc.section.5.3.3.p.1">The RADIUS client and Introducer MUST use the EAP channel binding protocol <a href="#I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</a>. If the channel binding verification fails, the Introducer MUST reject the authentication.  </p>
<h1 id="rfc.section.5.3.4">
<a href="#rfc.section.5.3.4">5.3.4.</a> <a href="#KNP_Trust_ClientToServer" id="KNP_Trust_ClientToServer">Client to Server</a>
</h1>
<p id="rfc.section.5.3.4.p.1">If the Introducer successfully authenticates the RADIUS client, the Introducer MUST send the client's authenticated name to the RADIUS server using the X RADIUS Attribute. The RADIUS server MAY use this name to perform authorisation.  </p>
<p id="rfc.section.5.3.4.p.2">TODO: select an appropriate RADIUS attribute </p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Keying</h1>
<p id="rfc.section.5.4.p.1">The completion of the EAP method exchange results in the derivation of an EAP MSK known only to the client and server and Peer-Id(s) and Server-Id(s) identifying these respectively. The Introducer MUST replicate the keying material and Server-Id to the RADIUS server.  </p>
<p id="rfc.section.5.4.p.2">The RADIUS client and server, in possession of the EAP MSK, establish a GSS-API security context as described in section 6 of <a href="#I-D.ietf-abfab-gss-eap">[I-D.ietf-abfab-gss-eap]</a>.  </p>
<p id="rfc.section.5.4.p.3">The PSK identity and value shall be the output of GSS_Pseudo_random() <a href="#RFC4401">[RFC4401]</a> using the Pseudo-Random Function defined for the GSS EAP mechanism <a href="#I-D.ietf-abfab-gss-eap">[I-D.ietf-abfab-gss-eap]</a>.  </p>
<p id="rfc.section.5.4.p.4">For the PSK identity, the prf_in input string MUST be prepended with the string "tls-psk-identity"; desired_out_len MUST be set to 128 octets.  </p>
<p id="rfc.section.5.4.p.5">Note: this should use base64 representation </p>
<p id="rfc.section.5.4.p.6">Note: should we append an NAI realm to the PSK identity? </p>
<p id="rfc.section.5.4.p.7">For the PSK value, the prf_in input string MUST be prepended with the string "tls-psk-value"; desired_out_len MUST be set to 64 octets.  </p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> TLS Encryption Negotiation</h1>
<p id="rfc.section.5.5.p.1">Finally the RADIUS client invokes RadSec, requesting a PSK TLS ciphersuite. The RADIUS client MUST include its PSK identity in the ClientKeyExchange message.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Context and PSK Management</h1>
<p id="rfc.section.6.p.1">The RADIUS server and client MAY cache the GSS context until expiry of the GSS context. However, either party MAY delete a GSS context at any time up to expiry. When a GSS context is deleted, the corresponding PSK value MUST also be deleted. The PSK identity MAY be retained for auditing or other purposes.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p id="rfc.section.7.p.1">TODO </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">Note: register KNP TCP port and SRV RR label.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgements</h1>
<p id="rfc.section.9.p.1">TODO </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2743">[RFC2743]</b></td>
<td class="top">
<a href="mailto:jlinn@rsasecurity.com" title="RSA Laboratories">Linn, J.</a>, "<a href="http://tools.ietf.org/html/rfc2743">Generic Security Service Application Program Interface Version 2, Update 1</a>", RFC 2743, January 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2865">[RFC2865]</b></td>
<td class="top">
<a>Rigney, C.</a>, <a>Willens, S.</a>, <a>Rubens, A.</a> and <a>W. Simpson</a>, "<a href="http://tools.ietf.org/html/rfc2865">Remote Authentication Dial In User Service (RADIUS)</a>", RFC 2865, June 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4279">[RFC4279]</b></td>
<td class="top">
<a>Eronen, P.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/rfc4279">Pre-Shared Key Ciphersuites for Transport Layer Security (TLS)</a>", RFC 4279, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4401">[RFC4401]</b></td>
<td class="top">
<a>Williams, N.</a>, "<a href="http://tools.ietf.org/html/rfc4401">A Pseudo-Random Function (PRF) API Extension for the Generic Security Service Application Program Interface (GSS-API)</a>", RFC 4401, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4559">[RFC4559]</b></td>
<td class="top">
<a>Jaganathan, K.</a>, <a>Zhu, L.</a> and <a>J. Brezak</a>, "<a href="http://tools.ietf.org/html/rfc4559">SPNEGO-based Kerberos and NTLM HTTP Authentication in Microsoft Windows</a>", RFC 4559, June 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-abfab-gss-eap">[I-D.ietf-abfab-gss-eap]</b></td>
<td class="top">
<a>Hartman, S</a> and <a>J Howlett</a>, "<a href="http://tools.ietf.org/html/draft-ietf-abfab-gss-eap-04">A GSS-API Mechanism for the Extensible Authentication Protocol</a>", Internet-Draft draft-ietf-abfab-gss-eap-04, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-radext-radsec">[I-D.ietf-radext-radsec]</b></td>
<td class="top">
<a>Winter, S</a>, <a>McCauley, M</a>, <a>Venaas, S</a> and <a>K Wierenga</a>, "<a href="http://tools.ietf.org/html/draft-ietf-radext-radsec-09">TLS encryption for RADIUS</a>", Internet-Draft draft-ietf-radext-radsec-09, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-radext-dynamic-discovery">[I-D.ietf-radext-dynamic-discovery]</b></td>
<td class="top">
<a>Winter, S</a> and <a>M McCauley</a>, "<a href="http://tools.ietf.org/html/draft-ietf-radext-dynamic-discovery-03">NAI-based Dynamic Peer Discovery for RADIUS/TLS and RADIUS/DTLS</a>", Internet-Draft draft-ietf-radext-dynamic-discovery-03, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-emu-chbind">[I-D.ietf-emu-chbind]</b></td>
<td class="top">
<a>Hartman, S</a>, <a>Clancy, T</a> and <a>K Hoeper</a>, "<a href="http://tools.ietf.org/html/draft-ietf-emu-chbind-11">Channel Binding Support for EAP Methods</a>", Internet-Draft draft-ietf-emu-chbind-11, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="I-D.lear-abfab-arch">[I-D.lear-abfab-arch]</b></td>
<td class="top">
<a>Howlett, J</a>, <a>Hartman, S</a>, <a>Tschofenig, H</a> and <a>E Lear</a>, "<a href="http://tools.ietf.org/html/draft-lear-abfab-arch-02">Application Bridging for Federated Access Beyond Web (ABFAB) Architecture</a>", Internet-Draft draft-lear-abfab-arch-02, March 2011.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Josh Howlett</span> 
	  <span class="n hidden">
		<span class="family-name">Howlett</span>
	  </span>
	</span>
	<span class="org vcardline">JANET(UK)</span>
	<span class="adr">
	  <span>Lumen House, Library Avenue, Harwell</span>

	  <span class="vcardline">
		<span class="locality">Oxford</span>,  
		<span class="region"></span>
		<span class="code">OX11 0SG</span>
	  </span>
	  <span class="country-name vcardline">UK</span>
	</span>
	<span class="vcardline">Phone: +44 1235 822363</span>

<span class="vcardline">EMail: <a href="mailto:Josh.Howlett@ja.net">Josh.Howlett@ja.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sam Hartman</span> 
	  <span class="n hidden">
		<span class="family-name">Hartman</span>
	  </span>
	</span>
	<span class="org vcardline">Painless Security</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hartmans-ietf@mit.edu">hartmans-ietf@mit.edu</a></span>

  </address>
</div>

</body>
</html>