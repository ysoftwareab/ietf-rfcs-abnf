<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>OSCORE Implementation Guidance</title>
<meta content="Christian AmsÃ¼ss" name="author">
<meta content="
       Object Security for Constrained RESTful Environments (OSCORE)
is a means of end-to-end protection of short request/response exchanges for tiny devices,
typically transported using the Constrained Application Protocol (CoAP).
This document aims to assist implementers in
leveraging the optimizations catered for by the combination of CoAP and OSCORE,
and by generally providing experience from earlier implementations. 
    " name="description">
<meta content="xml2rfc 2.44.0" name="generator">
<meta content="draft-amsuess-lwig-oscore-00" name="ietf.draft">
<link href="/tmp/draft-amsuess-lwig-oscore-00-liqfw3hl.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Avoid wrapping of URLs in references */
@media screen {
  .references a {
    white-space: nowrap;
  }
}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">OSCORE Implementation Guidance</td>
<td class="right">April 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">AmsÃ¼ss</td>
<td class="center">Expires 31 October 2020</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">LWIG</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-amsuess-lwig-oscore-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-04-29" class="published">29 April 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2020-10-31">31 October 2020</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. AmsÃ¼ss</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">OSCORE Implementation Guidance</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">Object Security for Constrained RESTful Environments (OSCORE)
is a means of end-to-end protection of short request/response exchanges for tiny devices,
typically transported using the Constrained Application Protocol (CoAP).
This document aims to assist implementers in
leveraging the optimizations catered for by the combination of CoAP and OSCORE,
and by generally providing experience from earlier implementations.<a href="#section-abstract-1" class="pilcrow">Â¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">Â¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
  LWIG Working Group mailing list (lwig@ietf.org),
  which is archived at <a href="https://mailarchive.ietf.org/arch/browse/lwig/">https://mailarchive.ietf.org/arch/browse/lwig/</a>.<a href="#section-note.1-2" class="pilcrow">Â¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
  <a href="https://gitlab.com/chrysn/lwig-oscore/">https://gitlab.com/chrysn/lwig-oscore/</a>.<a href="#section-note.1-3" class="pilcrow">Â¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 31 October 2020.<a href="#section-boilerplate.1-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">Â¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">â²</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.Â Â <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.Â Â <a href="#name-context-ace-lake-oscore" class="xref">Context: ACE, LAKE, OSCORE</a><a href="#section-toc.1-1.2.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.Â Â <a href="#name-example-compositiions" class="xref">Example compositiions</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1.2.1">
                    <p id="section-toc.1-1.2.2.1.2.1.1" class="keepWithNext"><a href="#section-2.1.1" class="xref">2.1.1</a>.Â Â <a href="#name-plain-ace-oscore" class="xref">Plain ACE-OSCORE</a><a href="#section-toc.1-1.2.2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.2.2.1.2.2">
                    <p id="section-toc.1-1.2.2.1.2.2.1" class="keepWithNext"><a href="#section-2.1.2" class="xref">2.1.2</a>.Â Â <a href="#name-ace-with-opportunistic-lake" class="xref">ACE with opportunistic LAKE</a><a href="#section-toc.1-1.2.2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.Â Â <a href="#name-protocol-implementation" class="xref">Protocol Implementation</a><a href="#section-toc.1-1.3.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.Â Â <a href="#name-replay-freshness-and-safety" class="xref">Replay, freshness and safety</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.Â Â <a href="#name-background" class="xref">Background</a><a href="#section-toc.1-1.3.2.1.2.1.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.Â Â <a href="#name-optimization" class="xref">Optimization</a><a href="#section-toc.1-1.3.2.1.2.2.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.3">
                    <p id="section-toc.1-1.3.2.1.2.3.1"><a href="#section-3.1.3" class="xref">3.1.3</a>.Â Â <a href="#name-implementation" class="xref">Implementation</a><a href="#section-toc.1-1.3.2.1.2.3.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.3.2.1.2.4">
                    <p id="section-toc.1-1.3.2.1.2.4.1"><a href="#section-3.1.4" class="xref">3.1.4</a>.Â Â <a href="#name-consequences-for-replay-win" class="xref">Consequences for replay window recovery using Echo</a><a href="#section-toc.1-1.3.2.1.2.4.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.Â Â <a href="#name-key-ids" class="xref">Key IDs</a><a href="#section-toc.1-1.4.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.Â Â <a href="#name-hkdfs" class="xref">HKDFs</a><a href="#section-toc.1-1.5.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.Â Â <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.6.1" class="pilcrow">Â¶</a></p>
<ul class="toc ulEmpty">
<li class="toc ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.Â Â <a href="#name-assessment-of-idempotency" class="xref">Assessment of idempotency</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.Â Â <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.Â Â <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.8.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.9.1" class="pilcrow">Â¶</a></p>
</li>
<li class="toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.10.1" class="pilcrow">Â¶</a></p>
</li>
</ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">[ See abstract for now ]<a href="#section-1-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="context-ace-lake-oscore">
<section id="section-2">
      <h2 id="name-context-ace-lake-oscore">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-context-ace-lake-oscore" class="section-name selfRef">Context: ACE, LAKE, OSCORE</a>
      </h2>
<p id="section-2-1">[ Is this LWIG material? In W3C terminology, this would go into a "primer" document. ]<a href="#section-2-1" class="pilcrow">Â¶</a></p>
<p id="section-2-2">When OSCORE was specified,
other parts of the ecosystem in which it is commonly used were already planned,
but not to the extent to be fully referernced.
This section gives a bigger picture of how surrounding technologies can be combined,
with the caveat that some of them are still in development:<a href="#section-2-2" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.1">
          <p id="section-2-3.1.1">OSCORE (<span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span>):<a href="#section-2-3.1.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.1.2.1">needs a pre-provisioned key, key identifiers and some other details on two communication parties<a href="#section-2-3.1.2.1" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.1.2.2">needs to keep sequence numbers on both parties (therfore, the same setup can only be rolled out once, ever)<a href="#section-2-3.1.2.2" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.1.2.3">provides a secure communication channel between those parties<a href="#section-2-3.1.2.3" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.1.2.4">does not provide any form of Perfect-Forward Secrecy (PFS)<a href="#section-2-3.1.2.4" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.1.2.5">has optional provisions for using a secret more than once, with randomness from both parties (Appendix B.2)<a href="#section-2-3.1.2.5" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
<li id="section-2-3.2">
          <p id="section-2-3.2.1">ACE (<span>[<a href="#I-D.ietf-ace-oauth-authz" class="xref">I-D.ietf-ace-oauth-authz</a>]</span>):<a href="#section-2-3.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.2.2.1">needs pre-existing secure channels and pre-established trust between communication parties and an Authorization Server (AS)<a href="#section-2-3.2.2.1" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.2.2.2">provides tokens that encode some authorization on a Resource Serve (RS) to Clients (C)<a href="#section-2-3.2.2.2" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.2.2.3">can be started by unprotected resource access (which fails, indicating the AS to get a token from) or from pre-established audiences and scopes<a href="#section-2-3.2.2.3" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
<li id="section-2-3.3">
          <p id="section-2-3.3.1">OSCORE profile for ACE (<span>[<a href="#I-D.ietf-ace-oscore-profile" class="xref">I-D.ietf-ace-oscore-profile</a>]</span>):<a href="#section-2-3.3.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.3.2.1">needs an ACE token (obtained by the Client at an AS, valid for a particular Resource Server)<a href="#section-2-3.3.2.1" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.3.2.2">takes randomness from both C and RS<a href="#section-2-3.3.2.2" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.3.2.3">provides all the data to start OSCORE between C and RS<a href="#section-2-3.3.2.3" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.3.2.4">ensures to C that RS is the RS it asked a token for from AS<a href="#section-2-3.3.2.4" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.3.2.5">ensures to RS that C was authorized by the AS for whatever the scope of the token is<a href="#section-2-3.3.2.5" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
<li id="section-2-3.4">
          <p id="section-2-3.4.1">a LAKE (Lightweight Key Exchange), for example EDHOC (Ephemeral Diffie-Hellman Over COSE, <span>[<a href="#I-D.selander-lake-edhoc" class="xref">I-D.selander-lake-edhoc</a>]</span>):<a href="#section-2-3.4.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.4.2.1">needs any combination of credentials between two parties, not necessarily pre-shared (can be certificates, raw public keys, or pre-shared keys)<a href="#section-2-3.4.2.1" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.4.2.2">provides a shared set of keys and other details sufficient to start OSCORE between the parties<a href="#section-2-3.4.2.2" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.4.2.3">provides Perfect-Forward Secrecy (PFS)<a href="#section-2-3.4.2.3" class="pilcrow">Â¶</a>
</li>
<li id="section-2-3.4.2.4">ensures to both parties that the other party has provided the indicated credentials<a href="#section-2-3.4.2.4" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
<li id="section-2-3.5">
          <p id="section-2-3.5.1">BRSKI<a href="#section-2-3.5.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-2-3.5.2.1">[ TBD ]<a href="#section-2-3.5.2.1" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
</ul>
<p id="section-2-4">[ same could be done for Group OSCORE ]<a href="#section-2-4" class="pilcrow">Â¶</a></p>
<div id="example-compositiions">
<section id="section-2.1">
        <h3 id="name-example-compositiions">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-example-compositiions" class="section-name selfRef">Example compositiions</a>
        </h3>
<p id="section-2.1-1">[ While I'm reasonably sure what I'm writing in this document is correct,
the following is wild speculation in the hope that ACE and LAKE authors tell me better ]<a href="#section-2.1-1" class="pilcrow">Â¶</a></p>
<div id="plain-ace-oscore">
<section id="section-2.1.1">
          <h4 id="name-plain-ace-oscore">
<a href="#section-2.1.1" class="section-number selfRef">2.1.1. </a><a href="#name-plain-ace-oscore" class="section-name selfRef">Plain ACE-OSCORE</a>
          </h4>
<p id="section-2.1.1-1">A client tries to access a resource over unprotected CoAP,
but the server requires credentials (and thus a secure connection).<a href="#section-2.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-2.1.1-2">On the initial unprotected request, the server responds 4.01 Unauthorized,
and sends the client off to the AS with information from the payload.<a href="#section-2.1.1-2" class="pilcrow">Â¶</a></p>
<p id="section-2.1.1-3">The client, which needs to have a pre-established association with the AS
(or establishes one using yet unspecified mechanisms on the fly),
obtains a token from it,
posts it over the original unprotected CoAP transport to the server,
and from then on has an OSCORE context with the server,
over which it can request the resource successfully.<a href="#section-2.1.1-3" class="pilcrow">Â¶</a></p>
<p id="section-2.1.1-4">This is illustrated well in <span>[<a href="#I-D.ietf-ace-oscore-profile" class="xref">I-D.ietf-ace-oscore-profile</a>]</span> Figure 1.<a href="#section-2.1.1-4" class="pilcrow">Â¶</a></p>
<p id="section-2.1.1-5">This combination has the advantage of not requiring any asymmetric cryptography,
but has the original request data unprotected,
and the AS can decrypt communication between C and RS
if it intercepts their first exchanged messages.<a href="#section-2.1.1-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="ace-with-opportunistic-lake">
<section id="section-2.1.2">
          <h4 id="name-ace-with-opportunistic-lake">
<a href="#section-2.1.2" class="section-number selfRef">2.1.2. </a><a href="#name-ace-with-opportunistic-lake" class="section-name selfRef">ACE with opportunistic LAKE</a>
          </h4>
<p id="section-2.1.2-1">A client that tries to access a resource
but does not want to reveal the request details to passive eavesdroppers
can run an EDHOC with the origin server.
Nothing else being preconfigured,
it runs it on a raw public key,
and accepts any credentials from the server.
(If a set of root certificates of a public key infrastructure (PKI) is set,
it could require a certificate chain to the root certificates).<a href="#section-2.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-2.1.2-2">Inside that opportunistically encrypted channel,
the client sends a first request to the resource.
If the server, as in the ACE-OSCORE example, requires authorization,
it can still reject the request and send the client off to the AS
with the same response.<a href="#section-2.1.2-2" class="pilcrow">Â¶</a></p>
<p id="section-2.1.2-3">The client obtains a token from the AS as before,
but does not need to generate a new OSCORE context from it (and thus does not use the OSCORE profile for ACE).
Instead, it can post the token to the server in the existing EDHOC-created OSCORE context,
and thus upgrades the authorization set of that context.<a href="#section-2.1.2-3" class="pilcrow">Â¶</a></p>
<p id="section-2.1.2-4">This combination has the advantage of not sending any actual request unprotected,
but does not ensure to the client that the server has any association with the AS.<a href="#section-2.1.2-4" class="pilcrow">Â¶</a></p>
<p id="section-2.1.2-5">Alternatively, it can use ACE-OSCORE when obtaining the token
and when posting it to the RS over the EDHOC-created OSCORE context
to obtain a new OSCORE context.<a href="#section-2.1.2-5" class="pilcrow">Â¶</a></p>
<p id="section-2.1.2-6">This combination has similar properties to the plain ACE-OSCORE,
at the cost of an asymmetric cryptography step,
but protecting the original request from passive eavesdroppers.<a href="#section-2.1.2-6" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="protocol-implementation">
<section id="section-3">
      <h2 id="name-protocol-implementation">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-protocol-implementation" class="section-name selfRef">Protocol Implementation</a>
      </h2>
<div id="replay-freshness-and-safety">
<section id="section-3.1">
        <h3 id="name-replay-freshness-and-safety">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-replay-freshness-and-safety" class="section-name selfRef">Replay, freshness and safety</a>
        </h3>
<div id="background">
<section id="section-3.1.1">
          <h4 id="name-background">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-background" class="section-name selfRef">Background</a>
          </h4>
<p id="section-3.1.1-1"><span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> Section 7.4 says that the server "SHALL stop processing the message" if that fails,
[ and I'm in quite a pickle here because I'd like to tell implementers that they can partially ignore that ].<a href="#section-3.1.1-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1-2">In OSCORE, replay protection serves two distinct purposes:<a href="#section-3.1.1-2" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-3.1.1-3.1">To ensure that only one response is sent with no Partial IV present to any given request Partial IV on a context
- i.e., to curb nonce reuse.<a href="#section-3.1.1-3.1" class="pilcrow">Â¶</a>
</li>
<li id="section-3.1.1-3.2">To ensure that any action authorized by OSCORE protection on the request is only executed once.<a href="#section-3.1.1-3.2" class="pilcrow">Â¶</a>
</li>
</ul>
<p id="section-3.1.1-4">For the first purpose, that mandate is absolute:
processing any request a second time and responding with an absent Partial IV is a severe security violation.
It does not apply, however, if the server chooses to encode an own Partial IV in the response in step 3 of RFC8613 Section 8.3.<a href="#section-3.1.1-4" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1-5">The relevance of the second purpose depends on the request and the implememtation of the resource backing it.
If the request is safe (in the sense of <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span> Section 4.2.1, i.e. it is a GET or FETCH),
or at least idempotent (i.e. PUT, DELETE or iPATCH),
processing a replay of it has no side effect on the server,
and the only thing an attacking replaying party could learn from another response is the current content's length.<a href="#section-3.1.1-5" class="pilcrow">Â¶</a></p>
<p id="section-3.1.1-6">[ TBD: Talk about how this interacts with freshness. ]<a href="#section-3.1.1-6" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="optimization">
<section id="section-3.1.2">
          <h4 id="name-optimization">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-optimization" class="section-name selfRef">Optimization</a>
          </h4>
<p id="section-3.1.2-1">Combined, these open some space for legitimate processing of replays.
Opening up to such processing is beneficial to the server,
as it allows a common optimization to happen even on OSCORE messages:
<span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> Section 4.5 allows relaxation on message deduplication for idempotent requests,
to the point where some implementations of CoAP do not perform message deduplication at all
and demand of their applications to only implement idempotent behavior.<a href="#section-3.1.2-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2-2">On platforms that perform selective optimizations,
these optimizations can free up memory otherwised used for deduplication and retransmission,
provided the operation's idempotency is communicated to the OSCORE and CoAP implementation
(which would, in general, not be allowed to enact that optimization for the POST requests OSCORE requests appear as).<a href="#section-3.1.2-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2-3">On platforms that do not perform deduplication at all,
this enables the implementation of OSCORE in the first place.
(Otherwise, any lost response message results in an otherwise unactionable 4.01 Unauthorized error).<a href="#section-3.1.2-3" class="pilcrow">Â¶</a></p>
<p id="section-3.1.2-4">Intermediaries (proxies) have no justification for treating the POST requests they see most OSCORE request as as idempotent;
however [ and this can not really be called "moving on the fringe of the specification" because it's clearly exceeding it ],
clients of a very constrained proxy (which might not even be able to forward non-idempotent requests at all)
might still appreciate a presumed-idempotent forwarding of OSCORE messages over a 5.05 Proxying Not Supported.<a href="#section-3.1.2-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="implementation">
<section id="section-3.1.3">
          <h4 id="name-implementation">
<a href="#section-3.1.3" class="section-number selfRef">3.1.3. </a><a href="#name-implementation" class="section-name selfRef">Implementation</a>
          </h4>
<p id="section-3.1.3-1">Ensuring that only one response without a Partial IV is ever sent to a given request
is of utmost importance when implementing this optimization.<a href="#section-3.1.3-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.3-2">One way of doing this is to annotate the received nonce or partial IV with
a marker that indicates the usability as an elided response Partial IV.
That marker is originally unset when the Partial IV is extracted from the request,
and only ever gets set the very time that sequence number gets removed from the replay window.
The marker is removed from the data structure when it is used in the encryption of a message.
Care must be taken when a nonce / Partial IV is copied to only let the marker stay with one copy,
and to unset it on the other one.<a href="#section-3.1.3-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.3-3">Note that this aligns well with the typical other cases when responses use an own Partial IV:<a href="#section-3.1.3-3" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-3.1.3-4.1">In observations, the first response can be sent without a Partial IV.
Later notifications are built with AAD linked to the original request's Partial IV,
but that was copied over from the original request's Partial IV
and thus does not carry a marker any more.<a href="#section-3.1.3-4.1" class="pilcrow">Â¶</a>
</li>
<li id="section-3.1.3-4.2">In responses that serve to recover the replay window as in <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> Appendix B.1.2,
the replay window is invalid when the first response is generated,
thus there is no marker to respond without Partial IV.<a href="#section-3.1.3-4.2" class="pilcrow">Â¶</a>
</li>
</ul>
</section>
</div>
<div id="consequences-for-replay-window-recovery-using-echo">
<section id="section-3.1.4">
          <h4 id="name-consequences-for-replay-win">
<a href="#section-3.1.4" class="section-number selfRef">3.1.4. </a><a href="#name-consequences-for-replay-win" class="section-name selfRef">Consequences for replay window recovery using Echo</a>
          </h4>
<p id="section-3.1.4-1">[ This is maybe more corr-clar or even my own wishful thinking than actual implementation guidance. ]<a href="#section-3.1.4-1" class="pilcrow">Â¶</a></p>
<p id="section-3.1.4-2">For the first response to the replay window recovery of <span>[<a href="#RFC8613" class="xref">RFC8613</a>]</span> Appendix B.1.2,
applying the above considerations means that the server may not need to recover its replay window right away.<a href="#section-3.1.4-2" class="pilcrow">Â¶</a></p>
<p id="section-3.1.4-3">If the initial request that triggers the recovery process is idempotent
(for example, the typical initial GET to /.well-known/core),
the server can accept the request as possible duplicate,
and send a successful response righ away.<a href="#section-3.1.4-3" class="pilcrow">Â¶</a></p>
<p id="section-3.1.4-4">The response should still contain an Echo value (and the client should send the same Echo with the next request)
for the benefit of future non-idempotent operations
and to eventually allow the server to send shorter responses (without a Partial IV).<a href="#section-3.1.4-4" class="pilcrow">Â¶</a></p>
<p id="section-3.1.4-5">Only when a resource with freshness requirements is accessed,
the client needs to have included the Echo value in at latest that very response.
A 4.01 response (which incurs the additional round-trip) thus only needs to happen
if the first request that triggers recovery is not idempotent.<a href="#section-3.1.4-5" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="key-ids">
<section id="section-4">
      <h2 id="name-key-ids">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-key-ids" class="section-name selfRef">Key IDs</a>
      </h2>
<div class="artwork art-text alignLeft" id="section-4-1">
<pre>
The naming of Keys is a difficult matter,
it's not just one of your entropy games;
You may think at first I'm as mad as a hatter
When I tell you, a context needs space for its names.
</pre><a href="#section-4-1" class="pilcrow">Â¶</a>
</div>
<p id="section-4-2">[<a href="#section-4-2" class="pilcrow">Â¶</a></p>
<p id="section-4-3">TBD. Topics:<a href="#section-4-3" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4-4.1">KID contexts are not strictly hierarchically above KIDs, that is up to the KID: A device may have some KIDs that are KID-context namespaced and will (at least initially) need a KID context, and some that are B.2 and the KID context is more of a detail under the KID than a namespace above.<a href="#section-4-4.1" class="pilcrow">Â¶</a>
</li>
<li id="section-4-4.2">
          <p id="section-4-4.2.1">When ACE'ing with different ASs, or combining ACE with EDHOC, or any of that with preconfigured keys, consider namespacing (eg. dealing out a prefix-based group of KIDs to an AS)<a href="#section-4-4.2.1" class="pilcrow">Â¶</a></p>
<ul>
<li id="section-4-4.2.2.1">Generally recommend treating KIDs like URI paths - it's always up to the server?<a href="#section-4-4.2.2.1" class="pilcrow">Â¶</a>
</li>
</ul>
</li>
<li id="section-4-4.3">Eventually avoid ever having to try different contexts, show it can be done<a href="#section-4-4.3" class="pilcrow">Â¶</a>
</li>
</ul>
<p id="section-4-5">]<a href="#section-4-5" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="hkdfs">
<section id="section-5">
      <h2 id="name-hkdfs">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-hkdfs" class="section-name selfRef">HKDFs</a>
      </h2>
<p id="section-5-1">[ This is more of a corr-clar topic than a LWIG - still fits here? ]<a href="#section-5-1" class="pilcrow">Â¶</a></p>
<p id="section-5-2">[ TBD: Does it need to be HKDF? HMAC-based HKDF? What about other direct+HKDFs in COSE (<span>[<a href="#I-D.ietf-core-oscore-groupcomm" class="xref">I-D.ietf-core-oscore-groupcomm</a>]</span> may do some updates here)? ]<a href="#section-5-2" class="pilcrow">Â¶</a></p>
<p id="section-5-3">[ Why and how do direct+ KDFs of COSE apply at all? My current impression is: ]<a href="#section-5-3" class="pilcrow">Â¶</a></p>
<p id="section-5-4">When KDFs are referred to by identifier, they are usually identified with the <code>direct+HKDF-...</code> COSE Algorithms.
This makes sense as those algorithms specify a particular key derivation function, but also slightly misleading:
What is meant by that usage is not to actually apply the "Direct Key with KDF" algorthm of <span>[<a href="#RFC8152" class="xref">RFC8152</a>]</span>
([ what goes in as info there? ])
but to apply the OSCORE key derivation process (with <code>[id, id_context, aead_alg, type, L]</code> as info).<a href="#section-5-4" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-6">
      <h2 id="name-security-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<div id="assessment-of-idempotency">
<section id="section-6.1">
        <h3 id="name-assessment-of-idempotency">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-assessment-of-idempotency" class="section-name selfRef">Assessment of idempotency</a>
        </h3>
<p id="section-6.1-1">Getting all implications of processing an idempotent request without an indication of freshness is hard.
The topic has been discussed at length in the context of TLS and HTTP/2 zero-round-trip actions
[ but I couldn't be bothered to find precise references for that yet ].<a href="#section-6.1-1" class="pilcrow">Â¶</a></p>
<p id="section-6.1-2">[ Applications probably also need guidance as to what are the temporal aspects or idempotency
(a request that has the same effect when processed twice in the same second, and different ones if processed a day later - is it still idempotent then?),
and on the re-ordering of requests permitted by idempotency
("Just because you received confirmation does not mean it can't be reordered with a request you send later ... unless you put in a memory barrier?")
]<a href="#section-6.1-2" class="pilcrow">Â¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">This document has no IANA actions.<a href="#section-7-1" class="pilcrow">Â¶</a></p>
</section>
</div>
<section id="section-8">
      <h2 id="name-informative-references">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
      </h2>
<dl class="references">
<dt id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</dt>
<dd>
<span class="refAuthor">Seitz, L.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Wahlstroem, E.</span><span class="refAuthor">, Erdtman, S.</span><span class="refAuthor">, and H. Tschofenig</span>, <span class="refTitle">"Authentication and Authorization for Constrained Environments (ACE) using the OAuth 2.0 Framework (ACE-OAuth)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oauth-authz-33</span>, <time datetime="2020-02-06">6 February 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-33.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-oauth-authz-33.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ace-oscore-profile">[I-D.ietf-ace-oscore-profile]</dt>
<dd>
<span class="refAuthor">Palombini, F.</span><span class="refAuthor">, Seitz, L.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, and M. Gunnarsson</span>, <span class="refTitle">"OSCORE profile of the Authentication and Authorization for Constrained Environments Framework"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ace-oscore-profile-10</span>, <time datetime="2020-03-09">9 March 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ace-oscore-profile-10.txt">http://www.ietf.org/internet-drafts/draft-ietf-ace-oscore-profile-10.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-oscore-groupcomm">[I-D.ietf-core-oscore-groupcomm]</dt>
<dd>
<span class="refAuthor">Tiloca, M.</span><span class="refAuthor">, Selander, G.</span><span class="refAuthor">, Palombini, F.</span><span class="refAuthor">, and J. Park</span>, <span class="refTitle">"Group OSCORE - Secure Group Communication for CoAP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-oscore-groupcomm-08</span>, <time datetime="2020-04-06">6 April 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-oscore-groupcomm-08.txt">http://www.ietf.org/internet-drafts/draft-ietf-core-oscore-groupcomm-08.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.selander-lake-edhoc">[I-D.selander-lake-edhoc]</dt>
<dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, and F. Palombini</span>, <span class="refTitle">"Ephemeral Diffie-Hellman Over COSE (EDHOC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-selander-lake-edhoc-01</span>, <time datetime="2020-03-09">9 March 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-selander-lake-edhoc-01.txt">http://www.ietf.org/internet-drafts/draft-selander-lake-edhoc-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7231">[RFC7231]</dt>
<dd>
<span class="refAuthor">Fielding, R., Ed.</span><span class="refAuthor"> and J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content"</span>, <span class="seriesInfo">RFC 7231</span>, <span class="seriesInfo">DOI 10.17487/RFC7231</span>, <time datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
<dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8152">[RFC8152]</dt>
<dd>
<span class="refAuthor">Schaad, J.</span>, <span class="refTitle">"CBOR Object Signing and Encryption (COSE)"</span>, <span class="seriesInfo">RFC 8152</span>, <span class="seriesInfo">DOI 10.17487/RFC8152</span>, <time datetime="2017-07">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8152">https://www.rfc-editor.org/info/rfc8152</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8613">[RFC8613]</dt>
<dd>
<span class="refAuthor">Selander, G.</span><span class="refAuthor">, Mattsson, J.</span><span class="refAuthor">, Palombini, F.</span><span class="refAuthor">, and L. Seitz</span>, <span class="refTitle">"Object Security for Constrained RESTful Environments (OSCORE)"</span>, <span class="seriesInfo">RFC 8613</span>, <span class="seriesInfo">DOI 10.17487/RFC8613</span>, <time datetime="2019-07">July 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8613">https://www.rfc-editor.org/info/rfc8613</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">[ TBD put into text ]<a href="#section-appendix.a-1" class="pilcrow">Â¶</a></p>
<p id="section-appendix.a-2">OSCORE authors in general: discussion leading up to most of this during OSCORE dev'mt
FP: HKDF input<a href="#section-appendix.a-2" class="pilcrow">Â¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christian AmsÃ¼ss</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:christian@amsuess.com" class="email">christian@amsuess.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
