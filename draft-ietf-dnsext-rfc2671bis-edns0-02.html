<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Extension Mechanisms for DNS (EDNS0)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Extension Mechanisms for DNS (EDNS0)">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, edns0, dns">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DNSEXT Working Group</td><td class="header">M. Graff</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">P. Vixie</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2671'>2671</a> (if&nbsp;approved)</td><td class="header">Internet Systems Consortium</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">July 28, 2009</td></tr>
<tr><td class="header">Expires: January 29, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Extension Mechanisms for DNS (EDNS0)<br />draft-ietf-dnsext-rfc2671bis-edns0-02</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 29, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
The Domain Name System's wire protocol includes a number of fixed
fields whose range has been or soon will be exhausted and does not allow
requestors to advertise their capabilities to responders.
This document describes backward compatible mechanisms for allowing the
protocol to grow.

</p>
<p>
This document updates the EDNS0 specification based on 10 years of operational
experience.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">3.</a>&nbsp;
EDNS Support Requirement<br />
<a href="#anchor4">4.</a>&nbsp;
Affected Protocol Elements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Message Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Label Types<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
UDP Message Size<br />
<a href="#anchor8">5.</a>&nbsp;
Extended Label Types<br />
<a href="#anchor9">6.</a>&nbsp;
OPT pseudo-RR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.1.</a>&nbsp;
OPT Record Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.2.</a>&nbsp;
OPT Record Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.3.</a>&nbsp;
Requestor's Payload Size<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.4.</a>&nbsp;
Responder's Payload Size<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.5.</a>&nbsp;
Payload Size Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.6.</a>&nbsp;
Middleware Boxes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.7.</a>&nbsp;
Extended RCODE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.8.</a>&nbsp;
OPT Options Type Allocation Procedure<br />
<a href="#anchor18">7.</a>&nbsp;
Transport Considerations<br />
<a href="#anchor19">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor20">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor21">10.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
DNS <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> specifies a Message Format and within
such messages there are standard formats for encoding options, errors, and
name compression.
The maximum allowable size of a DNS Message is fixed.
Many of DNS's protocol limits are too small for uses which are or which are
desired to become common.
There is no way for implementations to advertise their capabilities.

</p>
<p>
Unextended agents will not know how to interpret the protocol
extensions detailed here.  In practice, these clients will be upgraded
when they have need of a new feature, and only new features will make
use of the extensions.  Extended agents must be prepared for behaviour
of unextended clients in the face of new protocol elements, and fall
back gracefully to unextended DNS.  <a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a> originally
proposed extensions to the basic DNS protocol to overcome these deficiencies.
This memo refines that specification and obsoletes <a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a>.

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Language</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this  document are to be
interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
EDNS Support Requirement</h3>

<p>EDNS support is manditory in a modern world.  DNSSEC requires EDNS
support, and many other featres are made possible only by EDNS support
to request or advertise them.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Affected Protocol Elements</h3>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Message Header</h3>

<p>
The DNS Message Header's
(see <a class='info' href='#RFC1035'>, section 4.1.1<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035])
second full 16-bit word is divided into a 4-bit OPCODE, a 4-bit RCODE, and a
number of 1-bit flags.
The original reserved Z bits have been allocated to various purposes, and
most of the RCODE values are now in use.
More flags and more possible RCODEs are needed.
The OPT pseudo-RR specified below contains subfields that carry a bit field
extension of the RCODE field and additional flag bits, respectively.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Label Types</h3>

<p>
The first two bits of a wire format domain label are used to denote the
type of the label.
<a class='info' href='#RFC1035'>,section 4.1.4<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035] allocates two of the four
possible types and reserves the other two.
More label types were proposed in <a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a> section 3.

</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
UDP Message Size</h3>

<p>
DNS Messages are limited to 512 octets in size when sent over UDP.
While the minimum maximum reassembly buffer size still allows a limit of
512 octets of UDP payload, most of the hosts now connected to the Internet
are able to reassemble larger datagrams.
Some mechanism must be created to allow requestors to advertise larger buffer
sizes to responders.  To this end, the OPT pseudo-RR specified below contains
a maximum payload size field.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Extended Label Types</h3>

<p>
The first octet in the on-the-wire representation of a DNS label
specifies the label type; the basic DNS specification <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>
dedicates the two most significant bits of that octet for this purpose.
</p>
<p>
This document reserves DNS label type 0b01 for use as an indication for
Extended Label Types.  A specific extended label type is selected by the
6 least significant bits of the first octet. Thus, Extended Label Types
are indicated by the values 64-127 (0b01xxxxxx) in the first octet of
the label.
</p>
<p>
This document does not describe any specific Extended Label Type.
</p>
<p>
In practice, Extended Label Types are difficult to use due to support
in clients and intermediate gateways.  Therefore, the registry of
Extended Label Types is requested to be closed.  They cause interoperability
problems and at present no defined label types are in use.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
OPT pseudo-RR</h3>

<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
OPT Record Behavior</h3>

<p>
One OPT pseudo-RR (RR type 41) MAY be added to the additional data section
of a request.  If present in requests, compliant responders which implement
EDNS MUST include an OPT record in non-truncated responses, and SHOULD
attempt to include them in all responses.
An OPT is called a pseudo-RR because it pertains to a particular transport
level message and not to any actual DNS data.
OPT RRs MUST NOT be cached, forwarded, or stored in or loaded from master
files.
The quantity of OPT pseudo-RRs per message MUST be either zero or one, but
not greater.

</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
OPT Record Format</h3>

<p>
An OPT RR has a fixed part and a variable set of options expressed as
{attribute, value} pairs.
The fixed part holds some DNS meta data and also a small collection of basic
extension elements which we expect to be so popular that it would be a waste
of wire space to encode them as {attribute, value}
pairs.

</p>
<p>The fixed part of an OPT RR is structured as follows:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left"><col align="left">
<tr><th align="left">Field Name</th><th align="left">Field Type</th><th align="left">Description</th></tr>
<tr>
<td align="left">NAME</td>
<td align="left">domain name</td>
<td align="left">empty (root domain)</td>
</tr>
<tr>
<td align="left">TYPE</td>
<td align="left">u_int16_t</td>
<td align="left">OPT</td>
</tr>
<tr>
<td align="left">CLASS</td>
<td align="left">u_int16_t</td>
<td align="left">requestor's UDP payload size</td>
</tr>
<tr>
<td align="left">TTL</td>
<td align="left">u_int32_t</td>
<td align="left">extended RCODE and flags</td>
</tr>
<tr>
<td align="left">RDLEN</td>
<td align="left">u_int16_t</td>
<td align="left">describes RDATA</td>
</tr>
<tr>
<td align="left">RDATA</td>
<td align="left">octet stream</td>
<td align="left">{attribute,value} pairs</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;OPT RR Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
The variable part of an OPT RR is encoded in its RDATA and is structured
as zero or more of the following:

</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>

              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |                          OPTION-CODE                          |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: |                         OPTION-LENGTH                         |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
4: |                                                               |
   /                          OPTION-DATA                          /
   /                                                               /
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div>
<p>
            </p>
<blockquote class="text"><dl>
<dt>OPTION-CODE</dt>
<dd>Assigned by Expert Review.
</dd>
<dt>OPTION-LENGTH</dt>
<dd>Size (in octets) of OPTION-DATA.
</dd>
<dt>OPTION-DATA</dt>
<dd>Varies per OPTION-CODE.
</dd>
</dl></blockquote><p>
          
</p>
<p>
Order of appearance of option tuples is never relevant. Any
option whose meaning is affected by other options is so affected no
matter which one comes first in the OPT RDATA.
</p>
<p>
Any OPTION-CODE values not understood by a responder or requestor
MUST be ignored.  Specifications of such options might wish to
include some kind of signalled acknowledgement.  For example, an option
specification might say that if a responder sees option XYZ, it SHOULD
include option XYZ in its response.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Requestor's Payload Size</h3>

<p>
The requestor's UDP payload size (which OPT stores in the RR CLASS
field) is the number of octets of the largest UDP payload that can be
reassembled and delivered in the requestor's network stack.
Note that path MTU, with or without fragmentation, may be smaller than this.
Values lower than 512 MUST be treated as equal to 512.

</p>
<p>
Note that a 512-octet UDP payload requires a 576-octet IP reassembly
buffer.  Choosing 1280 for IPv4 over Ethernet would be reasonable.
The consequence of choosing too large a value may be an ICMP message from an
intermediate gateway, or even a silent drop of the response message.
</p>
<p>
The requestor's maximum payload size can change over time, and
MUST therefore not be cached for use beyond the transaction in which it
is advertised.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Responder's Payload Size</h3>

<p>
The responder's maximum payload size can change over time, but can
be reasonably expected to remain constant between two sequential transactions;
for example, a meaningless QUERY to discover a responder's maximum UDP payload
size, followed immediately by an UPDATE which takes advantage of this size.
(This is considered preferrable to the outright use of TCP for oversized
requests, if there is any reason to suspect that the responder implements
EDNS, and if a request will not fit in the default 512 payload size limit.)

</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Payload Size Selection</h3>

<p>
Due to transaction overhead, it is unwise to advertise an architectural
limit as a maximum UDP payload size.  Just because your stack can reassemble
64KB datagrams, don't assume that you want to spend more than about 4KB of
state memory per ongoing transaction.

</p>
<p>
A requestor MAY choose to implement a fallback to smaller advertised sizes
to work around firewall or other network limitations.
A requestor SHOULD choose to use a fallback mechanism which begins with a large
size, such as 4096.  If that fails, a fallback around the 1220 byte range
SHOULD be tried, as it has a reasonable chance to fit within a single
Ethernet frame.  Failing that, a requestor MAY choose a 512 byte packet,
which with large answers may cause a TCP retry.

</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Middleware Boxes</h3>

<p>Middleware boxes MUST NOT limit DNS messages over UDP to 512 bytes.
</p>
<p>Middleware boxes which simply forward requests to a recursive resolver
MUST NOT modify the OPT record contents in either direction.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7"></a><h3>6.7.&nbsp;
Extended RCODE</h3>

<p>
The extended RCODE and flags (which OPT stores in the RR TTL field)
are structured as follows:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
              +0 (MSB)                            +1 (LSB)
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
0: |         EXTENDED-RCODE        |            VERSION            |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
2: | DO|                           Z                               |
   +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
</pre></div>
<p>
          </p>
<blockquote class="text"><dl>
<dt>EXTENDED-RCODE</dt>
<dd>
 Forms upper 8 bits of extended 12-bit RCODE.  Note that EXTENDED-RCODE value
"0" indicates that an unextended RCODE is in use (values "0" through "15").

</dd>
<dt>VERSION</dt>
<dd>
Indicates the implementation level of whoever sets it.  Full conformance with
this specification is indicated by version ``0.''  Requestors are encouraged
to set this to the lowest implemented level capable of expressing a
transaction, to minimize the responder and network load of discovering the
greatest common implementation level between requestor and responder.  A
requestor's version numbering strategy MAY ideally be a run time
configuration option.
<br />

If a responder does not implement the VERSION level of the request, then it
answers with RCODE=BADVERS.  All responses MUST be limited in format to the
VERSION level of the request, but the VERSION of each response SHOULD be the
highest implementation level of the responder.  In this way a requestor will
learn the implementation level of a responder as a side effect of every
response, including error responses and including RCODE=BADVERS.

</dd>
<dt>DO</dt>
<dd>
DNSSEC OK bit as defined by <a class='info' href='#RFC3225'>[RFC3225]<span> (</span><span class='info'>Conrad, D., &ldquo;Indicating Resolver Support of DNSSEC,&rdquo; December&nbsp;2001.</span><span>)</span></a>.

</dd>
<dt>Z</dt>
<dd>
Set to zero by senders and ignored by receivers, unless modified in a
subsequent specification.

</dd>
</dl></blockquote><p>
        
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.8"></a><h3>6.8.&nbsp;
OPT Options Type Allocation Procedure</h3>

<p>
Allocations assigned by expert review.  TBD

</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Transport Considerations</h3>

<p>
The presence of an OPT pseudo-RR in a request should be taken as an
indication that the requestor fully implements the given version of EDNS,
and can correctly understand any response that conforms to that
feature's specification.

</p>
<p>
Lack of presence of an OPT record in a request MUST be taken as an indication
that the requestor does not implement any part of this specification and that
the responder MUST NOT use any protocol extension described here in its
response.
</p>
<p>
Responders who do not implement these protocol extensions MUST respond
with FORMERR messages without any OPT record.

</p>
<p>
If there is a problem with processing the OPT record itself, such as an
option value that is badly formatted or includes out of range values, a
FORMERR MAY be retured.  If this occurs the response MUST include an OPT
record.  This MAY be used to distinguish between servers whcih do not
implement EDNS and format errors within EDNS.
</p>
<p>If EDNS is used in a request, and the response arrives with TC set
and with no EDNS OPT RR, a requestor SHOULD assume that truncation
prevented the OPT RR from being appended by the responder, and further,
that EDNS is not used in the response.  Correspondingly, an EDNS
responder who cannot fit all necessary elements (including an OPT RR)
into a response, SHOULD respond with a normal (unextended) DNS response,
possibly setting TC if the response will not fit in the unextended
response message's 512-octet size.

</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>
Requestor-side specification of the maximum buffer size may open a new DNS
denial of service attack if responders can be made to send messages which are
too large for intermediate gateways to forward, thus leading to potential ICMP
storms between gateways and responders.

</p>
<p>
Announcing very large UDP buffer sizes may result in dropping by firewalls.
This could cause retransmissions with no hope of success.
Some devices reject fragmented UDP packets.

</p>
<p>
Announcing too small UDP buffer sizes may result in fallback to TCP.
This is especially important with DNSSEC, where answers are much larger.

</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
The IANA has assigned RR type code 41 for OPT.
</p>
<p>
<a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a> specified a number of IANA sub-registries within
"DOMAIN NAME SYSTEM PARAMETERS:" "EDNS Extended Label Type",
"EDNS Option Codes", "EDNS Version Numbers", and "Domain System Response Code."
IANA is advised to re-parent these subregistries to this document.

</p>
<p>
RFC 2671 created an extended label type registry.
We request that this registry be closed.
</p>
<p>
This document assigns extended label type 0bxx111111 as "Reserved for future
extended label types."  We request that IANA record this assignment.
</p>
<p>This document assigns option code 65535 to "Reserved for future expansion."

</p>
<p>This document expands the RCODE space from 4 bits to 12 bits.  This will
allow IANA to assign more than the 16 distinct RCODE values allowed in
<a class='info' href='#RFC1035'>RFC 1035<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1035].

</p>
<p>
This document assigns EDNS Extended RCODE "16" to "BADVERS".
</p>
<p>IESG approval should be required to create new entries in the EDNS Extended
Label Type or EDNS Version Number registries, while any published RFC
(including Informational, Experimental, or BCP) should be grounds for
allocation of an EDNS Option Code.

</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>
Paul Mockapetris, Mark Andrews, Robert Elz, Don Lewis, Bob Halley, Donald
Eastlake, Rob Austein, Matt Crawford, Randy Bush, and Thomas Narten were each
instrumental in creating and refining this specification.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2671">[RFC2671]</a></td>
<td class="author-text"><a href="mailto:vixie@isc.org">Vixie, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2671">Extension Mechanisms for DNS (EDNS0)</a>,&rdquo; RFC&nbsp;2671, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2671.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3225">[RFC3225]</a></td>
<td class="author-text">Conrad, D., &ldquo;<a href="http://tools.ietf.org/html/rfc3225">Indicating Resolver Support of DNSSEC</a>,&rdquo; RFC&nbsp;3225, December&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3225.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michael Graff</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Systems Consortium</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">950 Charter Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redwood City, California  94063</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650.423.1304</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mgraff@isc.org">mgraff@isc.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Vixie</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Internet Systems Consortium</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">950 Charter Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redwood City, California  94063</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 650.423.1301</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:vixie@isc.org">vixie@isc.org</a></td></tr>
</table>
</body></html>
