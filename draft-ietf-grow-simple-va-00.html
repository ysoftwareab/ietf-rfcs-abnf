<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Simple Virtual Aggregation (S-VA)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Simple Virtual Aggregation (S-VA)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Francis</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">MPI-SWS</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">X. Xu</td></tr>
<tr><td class="header">Expires: September 2, 2010</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Ballani</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cornell U.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Raszuk</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cisco</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">L. Zhang</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 01, 2010</td></tr>
</table></td></tr></table>
<h1><br />Simple Virtual Aggregation (S-VA)<br />draft-ietf-grow-simple-va-00.txt</h1>

<h3>Abstract</h3>

<p> 
The continued growth in the Default Free Routing Table (DFRT)
stresses the global routing system in a number of ways.  One of the
most costly stresses is FIB size:  ISPs often must upgrade router hardware
simply because the FIB has run out of space, and router vendors must
design routers that have adequate FIB.
FIB suppression is an approach to relieving stress on the FIB by
NOT loading selected RIB entries into the FIB.
Simple Virtual Aggregation (S-VA) is a simple form of Virtual
Aggregation (VA) that allows any and all edge routers to shrink their
FIB requirements substantially and therefore increase their useful lifetime.
S-VA does not change FIB requirements for core routers.
S-VA is extremely easy to configure---considerably more so than the
various tricks done today to extend the life of edge routers. 
S-VA can be
deployed autonomously by an ISP (cooperation between ISPs is not required),
and can co-exist with legacy routers in the ISP.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 2, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#sec-intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scope">1.1.</a>&nbsp;
Scope of this Document<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor1">1.2.</a>&nbsp;
Requirements notation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.3.</a>&nbsp;
Terminology<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-temp">1.4.</a>&nbsp;
Temporary Sections<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-changed">1.4.1.</a>&nbsp;
Document revisions<br />
<a href="#basic-operation">2.</a>&nbsp;
Operation of S-VA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-tunnels">2.1.</a>&nbsp;
Tunnels<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-legacy">2.2.</a>&nbsp;
Legacy Routers<br />
<a href="#sec-iana">3.</a>&nbsp;
IANA Considerations<br />
<a href="#sec-consider">4.</a>&nbsp;
Security Considerations<br />
<a href="#sec-ack">5.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">6.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="sec-intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> 
ISPs today manage constant DFRT growth in a number of ways.
One way, of course, is for ISPs to upgrade their
router hardware before DFRT growth
outstrips the size of the FIB.  
This is too expensive for many ISPs.  They would prefer to extend
the lifetime of routers whose FIBs can no longer hold the full DFRT.

</p>
<p>
A common approach taken by lower-tier ISPs is to default route to their
providers.  Routes to customers and peer ISPs are maintained, but everything
else defaults to the provider.  This approach has several disadvantages.
First, packets to Internet destinations may take longer-than-necessary
AS paths.  
This problem can be mitigated through careful configuration of partial
defaults, but this can require substantial configuration overhead.
A second problem with defaulting to providers is that the ISP is no longer
able to provide the full DFRT to its customers.
Finally, provider defaults prevents the ISP from being able to detect
martian packets.  As a result, the ISP transmits packets that could
otherwise have been dropped over its expensive provider links.
Simple Virtual Aggregation (S-VA)
solves these problems because the full DFRT is used by core routers.

</p>
<p>
An alternative is for the ISP to maintain full routes in its core
routers, but to filter routes from edge routers that do not require
a full DFRT.
These edge routers can then default route to the core routers.
This is often possible with edge routers that interface to
customer networks.
The problem with this approach is that it cannot be used for all
edge routers.  For instance, it cannot be used for routers that
connect to transits.
It should also not be used for routers that connect to customers which
wish to receive the full DFRT.

</p>
<p>
This draft describes a very simple technique, called Simple
Virtual Aggregation (S-VA), that allows any and
all edge routers to have substantially reduced FIB requirements
even while still advertising and receiving the full DFRT over BGP.
The basic idea is as follows.
Core routers in the ISP maintain the full DFRT in the FIB and RIB.
Edge routers maintain the full DFRT in the RIB, but suppress certain
routes from the FIB.
Edge routers install a default route to core routers.
Label Switched Paths (LSP) are used to transmit packets from a
core router, through the edge router, to the Next Hop
remote Autonomous System Border Router (ASBR).
ASBRs strip the tunnel header (MPLS or IP) before
forwarding tunneled packets to the remote ASBR (in much
the same way MPLS Penultimate Hop Popping (PHP) strips the
LSP header before forwarding packets to the tunnel target).

</p>
<p>
S-VA requires no
changes to BGP and no changes to MPLS forwarding mechanisms in routers.
Configuration is extremely simple: S-VA must be enabled, and routers must
told whether they are FIB-suppressing routers or not.
Everything else is automatic.
ISPs can deploy FIB suppression autonomously and with no coordination with
neighbor ASes.

</p>
<a name="sec-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Scope of this Document</h3>

<p>
The scope of this document is limited to Intra-domain S-VA operation.
In other words, the case where a single ISP autonomously operates S-VA
internally without any coordination with neighboring ISPs.  

</p>
<p>
Note that this document assumes that the S-VA "domain"
(i.e. the unit of autonomy) is the AS (that is,
different ASes run S-VA independently and without coordination).
For the remainder of this document, the terms ISP, AS, and domain are
used interchangeably.

</p>
<p>
This document applies equally to IPv4 and IPv6.

</p>
<p>
S-VA may operate with a mix of upgraded routers and
legacy routers.
There are no topological restrictions placed on the mix of routers.
In order to avoid loops between upgraded and legacy routers, however,
legacy routers must be able to terminate tunnels.

</p>
<p>
Note that S-VA is a greatly simplified variant of "full VA"
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
With full VA, all routers (core or otherwise) can have reduced
FIBs.
However, full VA requires substantial new configuration and
operational complexity compared to S-VA.
Note that S-VA was formerly specified in 
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
It has been moved to this separate draft to simplify its
understanding.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Requirements notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
            "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
            and "OPTIONAL" in this document are to be interpreted as
	    described in 
	    <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Terminology</h3>

<p>
</p>
<blockquote class="text"><dl>
<dt>FIB-Installing Router (FIR):</dt>
<dd> 
	An S-VA router that does not suppress any routes, and advertises itself
	as a default route for 0/0.  Typically a core router or route
	reflector would be configured as an FIR.

</dd>
<dt>FIB-Suppressing Router (FSR):</dt>
<dd> 
	An S-VA router that installs a route to 0/0, and may
	suppress other routes.  Typically an edge router would be 
	configured as an FSR.

</dd>
<dt>Install and Suppress:</dt>
<dd> 
	The terms "install" and "suppress" are used to describe whether
	a RIB entry has been loaded or not loaded into the FIB.
	In other words, the phrase
	"install a route" means "install a route into the FIB", and the
	phrase "suppress a route" means "do not install a route into the
	FIB". 

</dd>
<dt>Legacy Router:</dt>
<dd> 
	A router that does not run S-VA, and has no knowledge of S-VA.

</dd>
<dt>Routing Information Base (RIB):</dt>
<dd> 
	The term RIB is used rather sloppily in this document to refer either
	to the loc-RIB (as used in <a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a>), or to the combined
	Adj-RIBs-In, the Loc-RIB, and the Adj-RIBs-Out.

</dd>
</dl></blockquote>

<a name="sec-temp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Temporary Sections</h3>

<p>
This section contains temporary information, and will be removed
in the final version.

</p>
<a name="sec-changed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4.1"></a><h3>1.4.1.&nbsp;
Document revisions</h3>

<p>
Note that S-VA was formerly specified in
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
No new functionality is specified in this draft.

</p>
<a name="basic-operation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Operation of S-VA</h3>

<p>
There are three types of routers in S-VA, FIB-Installing routers (FIR), 
FIB-Suppressing routers (FSR), and optionally legacy routers.
While any router can be an FIR or an FSR (there are no topology constraints),
the simplist form of deployment is for border routers to be configured
as edge routers, and for non-border routers (for instance the routers
used as route reflectors) to be configured as core routers.
S-VA, however, does not mandate this deployment per se.

</p>
<p>
FIRs must originate a BGP route to NLRI 0/0
<a class='info' href='#RFC4271'>[RFC4271]<span> (</span><span class='info'>Rekhter, Y., Li, T., and S. Hares, &ldquo;A Border Gateway Protocol 4 (BGP-4),&rdquo; January&nbsp;2006.</span><span>)</span></a>.
The ORIGIN is set to INCOMPLETE (value 2), the AS number of the
FIR's
AS is used in the AS_PATH, and the BGP NEXT_HOP is set to the router's
own address.
The ATOMIC_AGGREGATE and AGGREGATOR attributes are not included.
The FIR MUST attach a NO_EXPORT Communities Attribute 
<a class='info' href='#RFC1997'>[RFC1997]<span> (</span><span class='info'>Chandrasekeran, R., Traina, P., and T. Li, &ldquo;BGP Communities Attribute,&rdquo; August&nbsp;1996.</span><span>)</span></a> to the route.

</p>
<p>
FIRs must not FIB-suppress any routes.

</p>
<p>
FSRs must FIB-install a route to 0/0.
When transmitting a packet to a FIR (i.e. based on
a 0/0 FIB lookup), the packet must be tunneled.
This is to prevent loops that would otherwise occur when a packet
transits multiple FSRs on the way to the core, some of which
have FIB-installed the route for the destination, and others of
which have not.
FSRs may FIB-install any other routes.
They should install any routes for which their eBGP neighbor
is the NEXT_HOP.
There are a couple reasons for this, which can be illustrated in
the figure below.
This figure shows an autonomous system with a FIR FIR1
and an FSR FSR1.  FSR1 is an ASBR and is
connected to two remote ASBRs, EP1 and EP2.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     +------------------------------------------+
     |      Autonomous System                   |   +----+
     |                                          |   |EP1 |
     |                                      /---+---|    |
     |   To   ----\ +----+          +----+ /    |   +----+
     | Other       \|FIR1|----------|FSR1|/     |
     |Routers      /|    |          |    |\     |
     |        ----/ +----+          +----+ \    |   +----+
     |                                      \---+---|EP2 |
     |                                          |   |    |
     |                                          |   +----+
     +------------------------------------------+
</pre></div>
<p>
Suppose that FSR1 does not FIB-install routes for which EP1 and EP2 are
next hops.  In this case, when EP2 sends a packet to FSR1 for which
the next hop is EP1, FSR1 will first tunnel the packet to FIR1, which
will tunnel it right back to FSR1.  This trombone routing is avoided
if local ASBRs FIB-install routes where their neighbor remote ASBRs
are the BGP NEXT_HOP.

</p>
<p>
In addition, FSR1 cannot filter source addresses using strict unicast
Reverse Path Forwarding (uRPF) unless it FIB-installs the routes
learned from the remote ASBR.
Note, however, that FSRs cannot do loose uRPF.  Rather, this
must be done by FIRs. 

</p>
<p>
The above observations lead to the following rules:
FSRs that are ASBRs should FIB-install all routes
for which the neighbor is the BGP NEXT_HOP.
FSRs that are ASBRs must FIB-install any routes
that are used for uRPF.


</p>
<a name="sec-tunnels"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Tunnels</h3>

<p>
S-VA works with both MPLS and IP-in-IP tunnels.
There are potentially up to two tunnels required for a packet
to traverse an AS with S-VA.
The first tunnel is that from an FSR to a FIR
(for the 0/0 default).
This is called the default tunnel.
The second tunnel targets the remote
ASBR which is the BGP NEXT_HOP, although the tunnel header is
stripped by the local ASBR before transmitting to the remote ASBR.
This is the exit tunnel.
The start of the exit tunnel is an ingress local ASBR in the
case where the ingress local ASBR has FIB-installed the associated route.
Otherwise, the start of the exit tunnel is a FIR.

</p>
<p>
The target address of the default tunnel is always the
FIR.
If MPLS is used, the FIRs must initiate
LSPs to themselves using either the
Label Distribution Protocol (LDP) <a class='info' href='#RFC5036'>[RFC5036]<span> (</span><span class='info'>Andersson, L., Minei, I., and B. Thomas, &ldquo;LDP Specification,&rdquo; October&nbsp;2007.</span><span>)</span></a>.
RSVP-TE <a class='info' href='#RFC3209'>[RFC3209]<span> (</span><span class='info'>Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V., and G. Swallow, &ldquo;RSVP-TE: Extensions to RSVP for LSP Tunnels,&rdquo; December&nbsp;2001.</span><span>)</span></a> may also be used.

</p>
<p>
If IP-in-IP tunnels are used, then 
the BGP Encapsulation Extended Community (BGPencap-Attribute)
(<a class='info' href='#RFC5512'>[RFC5512]<span> (</span><span class='info'>Mohapatra, P. and E. Rosen, &ldquo;BGP Encapsulation SAFI and BGP Tunnel Encapsulation Attribute,&rdquo; April&nbsp;2009.</span><span>)</span></a>) is used to convey the ability
to accept tunnels at the target address (the BGP NEXT_HOP).

</p>
<p>
For the exit tunnels, again either MPLS or IP-in-IP can be used.
In the case of IP-in-IP, the inner label defined in
<a class='info' href='#RFC4023'>[RFC4023]<span> (</span><span class='info'>Worster, T., Rekhter, Y., and E. Rosen, &ldquo;Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE),&rdquo; March&nbsp;2005.</span><span>)</span></a> and signaled in BGP with 
<a class='info' href='#RFC3107'>[RFC3107]<span> (</span><span class='info'>Rekhter, Y. and E. Rosen, &ldquo;Carrying Label Information in BGP-4,&rdquo; May&nbsp;2001.</span><span>)</span></a> is used by the local ASBR to
identify the remote ASBR which is the BGP NEXT_HOP for the packet.
Specifically,
when a local ASBR, which can be either an FSR or a FIR,
advertises an eBGP-received route into iBGP, it
sets the BGP NEXT_HOP as itself.
It assigns a label to the route.
This label is used as the inner label in packets tunneled to the
local ASBR, and is used to
identify the remote ASBR from which the route was received.
When receiving a packet with this label, the local ASBR strips off
the label, and forwards the native packet to the remote ASBR indicated
by the label.

</p>
<p>
In the case of MPLS, the inner label may or may not be used.
If it is used, then an LSP is established to the IP address of
the local ASBR as described above for FIRs.
The BGP NEXT_HOP is set to be itself (the same address that serves
as the FEC in the LSP).
The inner label is established as described in the previous
paragraph for IP-in-IP tunnels, but with the encapsulation
defined in <a class='info' href='#RFC3032'>[RFC3032]<span> (</span><span class='info'>Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y., Farinacci, D., Li, T., and A. Conta, &ldquo;MPLS Label Stack Encoding,&rdquo; January&nbsp;2001.</span><span>)</span></a>.

</p>
<p>
If the inner label is not used, then the local ASBR must initiate
a Downstream Unsolicited LSP for each remote ASBR.
The FEC for the LSP is the remote ASBR address that is used
in the BGP NEXT_HOP field.
When a packet is received on one of these LSPs, the local ASBR
strips the MPLS header, and forwards the packet to the remote
ASBR indicated by the label.

</p>
<a name="sec-legacy"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Legacy Routers</h3>

<p>
S-VA may be operated with a mix of legacy and S-VA-upgraded routers.
The legacy routers, however, must be able to forward tunneled packets.
In the case of MPLS tunnels, this means that they must fully participate
in MPLS signaling.
If a legacy router is an ASBR, then it must also initiate tunnels
to itself and be able to detunnel packets (without the inner label).

</p>
<a name="sec-iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IANA Considerations</h3>

<p>
There are no IANA considerations.

</p>
<a name="sec-consider"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>
The authors are not aware of any new security considerations
due to S-VA.

</p>
<a name="sec-ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>
The concept for S-VA comes from Robert Raszuk.

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>6.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-grow-va">[I-D.ietf-grow-va]</a></td>
<td class="author-text">Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-grow-va-00.txt">FIB Suppression with Virtual Aggregation</a>,&rdquo; draft-ietf-grow-va-00 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-grow-va-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1997">[RFC1997]</a></td>
<td class="author-text"><a href="mailto:rchandra@cisco.com">Chandrasekeran, R.</a>, <a href="mailto:pst@cisco.com">Traina, P.</a>, and <a href="mailto:tli@skat.usc.edu">T. Li</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1997">BGP Communities Attribute</a>,&rdquo; RFC&nbsp;1997, August&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc1997.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3032">[RFC3032]</a></td>
<td class="author-text">Rosen, E., Tappan, D., Fedorkow, G., Rekhter, Y., Farinacci, D., Li, T., and A. Conta, &ldquo;<a href="http://tools.ietf.org/html/rfc3032">MPLS Label Stack Encoding</a>,&rdquo; RFC&nbsp;3032, January&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3032.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3107">[RFC3107]</a></td>
<td class="author-text">Rekhter, Y. and E. Rosen, &ldquo;<a href="http://tools.ietf.org/html/rfc3107">Carrying Label Information in BGP-4</a>,&rdquo; RFC&nbsp;3107, May&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3107.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3209">[RFC3209]</a></td>
<td class="author-text">Awduche, D., Berger, L., Gan, D., Li, T., Srinivasan, V., and G. Swallow, &ldquo;<a href="http://tools.ietf.org/html/rfc3209">RSVP-TE: Extensions to RSVP for LSP Tunnels</a>,&rdquo; RFC&nbsp;3209, December&nbsp;2001 (<a href="ftp://ftp.isi.edu/in-notes/rfc3209.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4023">[RFC4023]</a></td>
<td class="author-text">Worster, T., Rekhter, Y., and E. Rosen, &ldquo;<a href="http://tools.ietf.org/html/rfc4023">Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)</a>,&rdquo; RFC&nbsp;4023, March&nbsp;2005 (<a href="ftp://ftp.isi.edu/in-notes/rfc4023.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4271">[RFC4271]</a></td>
<td class="author-text">Rekhter, Y., Li, T., and S. Hares, &ldquo;<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>,&rdquo; RFC&nbsp;4271, January&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4271.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5036">[RFC5036]</a></td>
<td class="author-text">Andersson, L., Minei, I., and B. Thomas, &ldquo;<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>,&rdquo; RFC&nbsp;5036, October&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc5036.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5512">[RFC5512]</a></td>
<td class="author-text">Mohapatra, P. and E. Rosen, &ldquo;<a href="http://tools.ietf.org/html/rfc5512">BGP Encapsulation SAFI and BGP Tunnel Encapsulation Attribute</a>,&rdquo; RFC&nbsp;5512, April&nbsp;2009 (<a href="http://www.ietf.org/rfc/rfc5512.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Francis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Max Planck Institute for Software Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gottlieb-Daimler-Strasse</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kaiserslautern  67633</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 631 930 39600</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:francis@mpi-sws.org">francis@mpi-sws.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xiaohu Xu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">No.3 Xinxi Rd., Shang-Di Information Industry Base, Hai-Dian District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing, Beijing  100085</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10 82836073</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xuxh@huawei.com">xuxh@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitesh Ballani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cornell University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4130 Upson Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ithaca, NY  14853</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 607 279 6780</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hitesh@cs.cornell.edu">hitesh@cs.cornell.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Robert Raszuk</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">170 West Tasman Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95134</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:raszuk@cisco.com">raszuk@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lixia Zhang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3713 Boelter Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lixia@cs.ucla.edu">lixia@cs.ucla.edu</a></td></tr>
</table>
</body></html>
