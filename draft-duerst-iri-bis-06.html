<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Internationalized Resource Identifiers (IRIs)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Internationalized Resource Identifiers (IRIs)">
<meta name="keywords" content="IRI, Internationalized Resource Identifier, UTF-8, URI, URL, IDN, LEIRI">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">M. Duerst</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Aoyama Gakuin University</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfcRFC 3987'>RFC 3987</a></td><td class="header">M. Suignard</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">Unicode Consortium</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">L. Masinter</td></tr>
<tr><td class="header">Expires: January 14, 2010</td><td class="header">Adobe</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 13, 2009</td></tr>
</table></td></tr></table>
<h1><br />Internationalized Resource Identifiers (IRIs)<br />draft-duerst-iri-bis-06</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on January 14, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document defines a new protocol element, the Internationalized
Resource Identifier (IRI), as an extension of the Uniform Resource Identifier (URI).
An IRI is a sequence of characters from the Universal Character Set (Unicode/ISO 10646).
A mapping from IRIs to URIs is defined, which provides a means for IRIs to be used instead
of URIs, where appropriate, to identify resources.
</p>
<p>To accomodate widespread current practice, additional derivative protocol elements are defined, and current practice for resolving IRI-based hypertext references in HTML are outlined. 
</p>
<p>The approach of defining new protocol elements, rather than updating or extending the definition of URI, was chosen to allow independent orderly transitions as appropriate: other protocols and languages that use URIs and their processing may explicitly choose to allow IRIs or derivative forms.
</p>
<p> Guidelines are provided for the use and deployment of IRIs and related protocol elements when revising protocols, formats, and software components that currently deal only with URIs.
</p>
<p>[RFC Editor: Please remove this paragraph before publication.] This is a draft to update RFC 3987 and move towards IETF Draft Standard.
For an issues list/change log and additional information (including mailing list information), please see
http://www.w3.org/International/iri-edit. For discussion and comments on this draft, please use the public-iri@w3.org mailing list.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Overview and Motivation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#Applicability">1.2.</a>&nbsp;
Applicability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-Definitions">1.3.</a>&nbsp;
Definitions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-Notation">1.4.</a>&nbsp;
Notation<br />
<a href="#syntax">2.</a>&nbsp;
IRI Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Summary of IRI Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#abnf">2.2.</a>&nbsp;
ABNF for IRI References and IRIs<br />
<a href="#iriuri">3.</a>&nbsp;
Relationship between IRIs and URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mapping">3.1.</a>&nbsp;
Mapping of IRIs to URIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#URItoIRI">3.2.</a>&nbsp;
Converting URIs to IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.1.</a>&nbsp;
Examples<br />
<a href="#Bidi">4.</a>&nbsp;
Bidirectional IRIs for Right-to-Left Languages<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#visual">4.1.</a>&nbsp;
Logical Storage and Visual Presentation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bidi-structure">4.2.</a>&nbsp;
Bidi IRI Structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#bidiInput">4.3.</a>&nbsp;
Input of Bidi IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.4.</a>&nbsp;
Examples<br />
<a href="#equivalence">5.</a>&nbsp;
Normalization and Comparison<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.1.</a>&nbsp;
Equivalence<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">5.2.</a>&nbsp;
Preparation for Comparison<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ladder">5.3.</a>&nbsp;
Comparison Ladder<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#stringcomp">5.3.1.</a>&nbsp;
Simple String Comparison<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">5.3.2.</a>&nbsp;
Syntax-Based Normalization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#schemecomp">5.3.3.</a>&nbsp;
Scheme-Based Normalization<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.3.4.</a>&nbsp;
Protocol-Based Normalization<br />
<a href="#IRIuse">6.</a>&nbsp;
Use of IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#limitations">6.1.</a>&nbsp;
Limitations on UCS Characters Allowed in IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.2.</a>&nbsp;
Software Interfaces and Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.3.</a>&nbsp;
Format of URIs and IRIs in Documents and Protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#UTF8use">6.4.</a>&nbsp;
Use of UTF-8 for Encoding Original Characters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.5.</a>&nbsp;
Relative IRI References<br />
<a href="#LEIRIHREF">7.</a>&nbsp;
Legacy Extended IRIs (LEIRIs) and Hypertext References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#LEIRIspec">7.1.</a>&nbsp;
Legacy Extended IRI Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">7.2.</a>&nbsp;
Conversion of Legacy Extended IRIs to IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#notAllowed">7.3.</a>&nbsp;
Characters Allowed in Legacy Extended IRIs but not in IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#href">7.4.</a>&nbsp;
HyperText References<br />
<a href="#guidelines">8.</a>&nbsp;
URI/IRI Processing Guidelines (Informative)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">8.1.</a>&nbsp;
URI/IRI Software Interfaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">8.2.</a>&nbsp;
URI/IRI Entry<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">8.3.</a>&nbsp;
URI/IRI Transfer between Applications<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">8.4.</a>&nbsp;
URI/IRI Generation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#selection">8.5.</a>&nbsp;
URI/IRI Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#display">8.6.</a>&nbsp;
Display of URIs/IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.7.</a>&nbsp;
Interpretation of URIs and IRIs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">8.8.</a>&nbsp;
Upgrading Strategy<br />
<a href="#anchor23">9.</a>&nbsp;
IANA Considerations<br />
<a href="#security">10.</a>&nbsp;
Security Considerations<br />
<a href="#anchor24">11.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor25">12.</a>&nbsp;
Change Log<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">12.1.</a>&nbsp;
Changes from -05 to -06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">12.2.</a>&nbsp;
Changes from -04 to -05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">12.3.</a>&nbsp;
Changes from -03 to -04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">12.4.</a>&nbsp;
Changes from -02 to -03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">12.5.</a>&nbsp;
Changes from -01 to -02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">12.6.</a>&nbsp;
Changes from -00 to -01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">12.7.</a>&nbsp;
Changes from RFC 3987 to -00<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#anchor35">Appendix&nbsp;A.</a>&nbsp;
Design Alternatives<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">A.1.</a>&nbsp;
New Scheme(s)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">A.2.</a>&nbsp;
Character Encodings Other Than UTF-8<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">A.3.</a>&nbsp;
New Encoding Convention<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">A.4.</a>&nbsp;
Indicating Character Encodings in the URI/IRI<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Overview and Motivation</h3>

<p>A Uniform Resource Identifier (URI) is defined in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>
as a sequence of characters
chosen from a limited subset of the repertoire of US-ASCII <a class='info' href='#ASCII'>[ASCII]<span> (</span><span class='info'>American National Standards Institute, &ldquo;Coded Character Set -- 7-bit American Standard Code for Information Interchange,&rdquo; 1986.</span><span>)</span></a>
characters.
</p>
<p>The characters in URIs are frequently used for representing words of
natural languages.  This usage has many advantages: Such URIs are easier to
memorize, easier to interpret, easier to transcribe, easier to create,
and easier to guess. For most languages other than English, however,
the natural script uses characters other than A - Z. For many people,
handling Latin characters is as difficult as handling the characters
of other scripts is for those who use only the Latin alphabet. Many
languages with non-Latin scripts are transcribed with Latin
letters. These transcriptions are now often used in URIs, but they
introduce additional difficulties.
</p>
<p>The infrastructure for the appropriate handling of characters from
additional scripts is now widely deployed in operating system and
application software. Software that can handle a wide variety of
scripts and languages at the same time is increasingly common. Also,
increasing numbers of protocols and formats can carry a wide range of
characters.
</p>
<p>URIs are used both as a protocol element (for transmission and
processing by software) and also a presentation element (for
display and handling by people who read, interpret, coin, or
guess them. The transition between these roles is more
difficult and complex when dealing with the larger set of 
characters than allowed in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
 
</p>
<p>This document defines a new protocol element called
Internationalized Resource Identifier (IRI), extending the syntax of
URIs to a much wider repertoire of characters. It also defines
corresponding "internationalized" versions of other constructs from
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, such as URI references. The syntax of IRIs
is defined in <a class='info' href='#syntax'>Section&nbsp;2<span> (</span><span class='info'>IRI Syntax</span><span>)</span></a>, and the relationship between
IRIs and URIs in <a class='info' href='#iriuri'>Section&nbsp;3<span> (</span><span class='info'>Relationship between IRIs and URIs</span><span>)</span></a>.

</p>
<p>Using characters outside of A - Z in IRIs brings a number of
difficulties. <a class='info' href='#Bidi'>Section&nbsp;4<span> (</span><span class='info'>Bidirectional IRIs for Right-to-Left Languages</span><span>)</span></a> discusses the special case of
bidirectional IRIs using characters from scripts written
right-to-left.  <a class='info' href='#equivalence'>Section&nbsp;5<span> (</span><span class='info'>Normalization and Comparison</span><span>)</span></a> discusses various forms of
equivalence between IRIs. <a class='info' href='#IRIuse'>Section&nbsp;6<span> (</span><span class='info'>Use of IRIs</span><span>)</span></a> discusses the use of
IRIs in different situations. <a class='info' href='#LEIRIHREF'>Section&nbsp;7<span> (</span><span class='info'>Legacy Extended IRIs (LEIRIs) and Hypertext References</span><span>)</span></a> describes
extensions to the IRI syntax used in some XML languages <a class='info' href='#LEIRI'>[LEIRI]<span> (</span><span class='info'>Thompson, H., Tobin, R., and N. Walsh, &ldquo;Legacy extended IRIs for XML resource identification,&rdquo; .</span><span>)</span></a> and
the handling of IRIs in commonly deployed web browsers <a class='info' href='#HTML5'>[HTML5]<span> (</span><span class='info'>Hickson, I. and D. Hyatt, &ldquo;A vocabulary and associated APIs for HTML and XHTML,&rdquo; April&nbsp;2009.</span><span>)</span></a>. 
<a class='info' href='#guidelines'>Section&nbsp;8<span> (</span><span class='info'>URI/IRI Processing Guidelines (Informative)</span><span>)</span></a> gives additional informative guidelines. 
<a class='info' href='#security'>Section&nbsp;10<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> discusses security considerations.
</p>
<a name="Applicability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Applicability</h3>

<p>IRIs are designed to be compatible with recommendations for new URI
schemes <a class='info' href='#RFC2718'>[RFC2718]<span> (</span><span class='info'>Masinter, L., Alvestrand, H., Zigmond, D., and R. Petke, &ldquo;Guidelines for new URL Schemes,&rdquo; November&nbsp;1999.</span><span>)</span></a>. The compatibility is provided by specifying
a well-defined and deterministic mapping from the IRI character sequence to
the functionally equivalent URI character sequence. Practical use of IRIs
(or IRI references) in place of URIs (or URI references) depends on the
following conditions being met:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>
  A protocol or format element should be explicitly designated to be able to carry IRIs. The intent is not to
    introduce IRIs into contexts that are not defined to accept them.
    For example, XML schema <a class='info' href='#XMLSchema'>[XMLSchema]<span> (</span><span class='info'>Biron, P. and A. Malhotra, &ldquo;XML Schema Part 2: Datatypes,&rdquo; May&nbsp;2001.</span><span>)</span></a> has an explicit type "anyURI"
    that includes IRIs and IRI references. Therefore, IRIs and IRI references
    can be in attributes and elements of type "anyURI".
    On the other hand, in the HTTP protocol <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>, the Request URI is
    defined as a URI, which means that direct use of IRIs is not allowed
    in HTTP requests.
</dd>
<dt>b.</dt>
<dd>The protocol or format carrying the IRIs should have a
    mechanism to represent the wide range of characters used in IRIs, either
    natively or by some protocol- or format-specific escaping mechanism
    (for example, numeric character references in <a class='info' href='#XML1'>[XML1]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., Maler, E., and F. Yergeau, &ldquo;Extensible Markup Language (XML) 1.0 (Forth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>).
</dd>
<dt>c.</dt>
<dd>The URI corresponding to the IRI in question has to
    encode original characters into octets using UTF-8. For new URI schemes,
    this is recommended in <a class='info' href='#RFC2718'>[RFC2718]<span> (</span><span class='info'>Masinter, L., Alvestrand, H., Zigmond, D., and R. Petke, &ldquo;Guidelines for new URL Schemes,&rdquo; November&nbsp;1999.</span><span>)</span></a>. It can apply to a whole
    scheme (e.g., IMAP URLs <a class='info' href='#RFC2192'>[RFC2192]<span> (</span><span class='info'>Newman, C., &ldquo;IMAP URL Scheme,&rdquo; September&nbsp;1997.</span><span>)</span></a> and POP
    URLs <a class='info' href='#RFC2384'>[RFC2384]<span> (</span><span class='info'>Gellens, R., &ldquo;POP URL Scheme,&rdquo; August&nbsp;1998.</span><span>)</span></a>, or the URN syntax <a class='info' href='#RFC2141'>[RFC2141]<span> (</span><span class='info'>Moats, R., &ldquo;URN Syntax,&rdquo; May&nbsp;1997.</span><span>)</span></a>).
    It can apply to a specific part of a URI, such as the fragment identifier
    (e.g., <a class='info' href='#XPointer'>[XPointer]<span> (</span><span class='info'>Grosso, P., Maler, E., Marsh, J., and N. Walsh, &ldquo;XPointer Framework,&rdquo; March&nbsp;2003.</span><span>)</span></a>). It can apply to a specific URI or part(s)
    thereof. For details, please see <a class='info' href='#UTF8use'>Section&nbsp;6.4<span> (</span><span class='info'>Use of UTF-8 for Encoding Original Characters</span><span>)</span></a>.
</dd>
</dl></blockquote>

<a name="sec-Definitions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Definitions</h3>

<p>The following definitions are used in this document; they follow the
terms in <a class='info' href='#RFC2130'>[RFC2130]<span> (</span><span class='info'>Weider, C., Preston, C., Simonsen, K., Alvestrand, H., Atkinson, R., Crispin, M., and P. Svanberg, &ldquo;The Report of the IAB Character Set Workshop held 29 February - 1 March, 1996,&rdquo; April&nbsp;1997.</span><span>)</span></a>, <a class='info' href='#RFC2277'>[RFC2277]<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a>, and
<a class='info' href='#ISO10646'>[ISO10646]<span> (</span><span class='info'>International Organization for Standardization, &ldquo;ISO/IEC 10646:2003: Information Technology - Universal Multiple-Octet Coded Character Set (UCS),&rdquo; December&nbsp;2003.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>character:</dt>
<dd>A member of a set of elements used for the organization,
     control, or representation of data. For example, "LATIN CAPITAL LETTER A" names
     a character.
</dd>
<dt>octet:</dt>
<dd>An ordered sequence of eight bits considered as a unit.
</dd>
<dt>character repertoire:</dt>
<dd>A set of characters (in the mathematical sense).
</dd>
<dt>sequence of characters:</dt>
<dd>A sequence of characters (one after another).
</dd>
<dt>sequence of octets:</dt>
<dd>A sequence of octets (one after another).
</dd>
<dt>character encoding:</dt>
<dd>A method of representing a sequence of
     characters as a sequence of octets (maybe with variants). Also, a method of
     (unambiguously) converting a sequence of octets into a sequence of characters.
</dd>
<dt>charset:</dt>
<dd>The name of a parameter or attribute used
     to identify a character encoding.
</dd>
<dt>UCS:</dt>
<dd>Universal Character Set. The coded character set defined by
     ISO/IEC 10646 <a class='info' href='#ISO10646'>[ISO10646]<span> (</span><span class='info'>International Organization for Standardization, &ldquo;ISO/IEC 10646:2003: Information Technology - Universal Multiple-Octet Coded Character Set (UCS),&rdquo; December&nbsp;2003.</span><span>)</span></a> and
     the Unicode Standard <a class='info' href='#UNIV4'>[UNIV4]<span> (</span><span class='info'>The Unicode Consortium, &ldquo;The Unicode Standard, Version 5.1.0, defined by: The Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN 0-321-48091-0), as amended by Unicode 4.1.0 (http://www.unicode.org/versions/Unicode5.1.0/),&rdquo; April&nbsp;2008.</span><span>)</span></a>.
</dd>
<dt>IRI reference:</dt>
<dd>Denotes the common usage
     of an Internationalized Resource Identifier. An IRI reference may be absolute or relative.
     However, the "IRI" that results from such a reference only includes absolute IRIs;
     any relative IRI references are resolved to their absolute form.
     Note that in <a class='info' href='#RFC2396'>[RFC2396]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifiers (URI): Generic Syntax,&rdquo; August&nbsp;1998.</span><span>)</span></a> URIs did not include fragment identifiers,
     but in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> fragment identifiers are part of URIs.
</dd>
<dt>running text:</dt>
<dd>Human text (paragraphs, sentences, phrases)
     with syntax according to orthographic conventions of a natural language,
     as opposed to syntax defined for ease of processing by machines (e.g., markup,
     programming languages).
</dd>
<dt>protocol element:</dt>
<dd>Any portion of a message that affects
     processing of that message by the protocol in question.
</dd>
<dt>presentation element:</dt>
<dd>A presentation form corresponding to a
     protocol element; for example, using a wider range of characters.
</dd>
<dt>create (a URI or IRI):</dt>
<dd>With respect to URIs and IRIs, the
     term is used for the initial creation. This may be the
     initial creation of a resource with a certain identifier, or the initial
     exposition of a resource under a particular identifier.
</dd>
<dt>generate (a URI or IRI):</dt>
<dd>With respect to URIs and IRIs,
     the term  is used when the IRI is generated by derivation
     from other information.
</dd>
</dl></blockquote>

<a name="sec-Notation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.4"></a><h3>1.4.&nbsp;
Notation</h3>

<p>RFCs and Internet Drafts currently do not allow any characters outside
the US-ASCII repertoire. Therefore, this document uses various special
notations to denote such characters in examples.
</p>
<p>In text, characters outside US-ASCII are sometimes referenced by
using a prefix of 'U+', followed by four to six hexadecimal digits.
</p>
<p>To represent characters outside US-ASCII in examples, this document
uses two notations: 'XML Notation' and 'Bidi Notation'.
</p>
<p>XML Notation uses a leading '&amp;#x', a trailing ';', and the
hexadecimal number of the character in the UCS in between. For example,
&amp;#x44F; stands for CYRILLIC CAPITAL LETTER YA. In this notation, an
actual '&amp;' is denoted by '&amp;amp;'.
</p>
<p>Bidi Notation is used for bidirectional examples: Lower case
letters stand for Latin letters or other letters that are written left to right,
whereas upper case letters represent Arabic or Hebrew letters that are
written right to left.
</p>
<p>To denote actual octets in examples (as opposed to percent-encoded octets),
the two hex digits denoting the octet are enclosed in "&lt;" and "&gt;".
For example, the octet often denoted as 0xc9 is denoted here as &lt;c9&gt;.
</p>
<p> In this document, the key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
"OPTIONAL" are to be interpreted as described in
<a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
IRI Syntax</h3>

<p>This section defines the syntax of Internationalized Resource
Identifiers (IRIs).
</p>
<p>As with URIs, an IRI is defined as a sequence of characters, not as
a sequence of octets. This
definition accommodates the fact that IRIs may be written on paper or
read over the radio as well as stored or transmitted digitally.
The same IRI might be represented as different sequences of octets
in different protocols or documents if these protocols or documents
use different character encodings (and/or transfer encodings).
Using the same character encoding
as the containing protocol or document ensures that the characters in
the IRI can be handled (e.g., searched, converted, displayed) in the
same way as the rest of the protocol or document.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Summary of IRI Syntax</h3>

<p>IRIs are defined similarly to URIs in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>,
but the class of unreserved characters is extended by
adding the characters of the UCS (Universal Character Set,
<a class='info' href='#ISO10646'>[ISO10646]<span> (</span><span class='info'>International Organization for Standardization, &ldquo;ISO/IEC 10646:2003: Information Technology - Universal Multiple-Octet Coded Character Set (UCS),&rdquo; December&nbsp;2003.</span><span>)</span></a>) beyond U+007F, subject to the limitations given
in the syntax rules below and in <a class='info' href='#limitations'>Section&nbsp;6.1<span> (</span><span class='info'>Limitations on UCS Characters Allowed in IRIs</span><span>)</span></a>.
</p>
<p>Otherwise, the syntax and use of components and reserved characters is
the same as that in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>. All the operations defined in
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, such as the resolution of relative references, can be
applied to IRIs by IRI-processing software in exactly the same way as they are for URIs by URI-processing software.
</p>
<p>Characters outside the US-ASCII repertoire are not reserved and therefore
MUST NOT be used for syntactical
purposes, such as to delimit components in newly defined schemes. For
example, U+00A2, CENT SIGN, is not allowed as a delimiter in IRIs,
because it is in the 'iunreserved' category. This is similar to the fact that it is
not possible to use '-' as a delimiter in URIs, because it is in the
'unreserved' category.
</p>
<a name="abnf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
ABNF for IRI References and IRIs</h3>

<p>Although it might be possible to define IRI references and IRIs merely by
their transformation to URI references and URIs, they can also be
accepted and processed directly. Therefore, an ABNF definition for
IRI references (which are the most general concept and the start of the
grammar) and IRIs is given here. The syntax of this ABNF is described in
<a class='info' href='#STD68'>[STD68]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>. Character numbers are taken from the UCS,
without implying any actual binary encoding. Terminals in the ABNF
are characters, not bytes.
</p>
<p>The following grammar closely follows the URI grammar in
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, except that the range of unreserved characters
is expanded to include UCS characters, with the restriction that private
UCS characters can occur only in query parts. The
grammar is split into two parts: Rules that differ from <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>
because of the above-mentioned expansion, and rules that are the same
as those in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>. For rules that are different than those in
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, the names of the non-terminals have been
changed as follows. If the non-terminal contains 'URI', this has
been changed to 'IRI'. Otherwise, an 'i' has been prefixed.
</p>
<p>The following rules are different from those in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
IRI            = scheme ":" ihier-part [ "?" iquery ]
                 [ "#" ifragment ]

ihier-part     = "//" iauthority ipath-abempty
               / ipath-absolute
               / ipath-rootless
               / ipath-empty

IRI-reference  = IRI / irelative-ref

absolute-IRI   = scheme ":" ihier-part [ "?" iquery ]

irelative-ref  = irelative-part [ "?" iquery ] [ "#" ifragment ]

irelative-part = "//" iauthority ipath-abempty
               / ipath-absolute
               / ipath-noscheme
               / ipath-empty

iauthority     = [ iuserinfo "@" ] ihost [ ":" port ]
iuserinfo      = *( iunreserved / pct-encoded / sub-delims / ":" )
ihost          = IP-literal / IPv4address / ireg-name

ireg-name      = *( iunreserved / pct-encoded / sub-delims )

ipath          = ipath-abempty   ; begins with "/" or is empty
               / ipath-absolute  ; begins with "/" but not "//"
               / ipath-noscheme  ; begins with a non-colon segment
               / ipath-rootless  ; begins with a segment
               / ipath-empty     ; zero characters

ipath-abempty  = *( "/" isegment )
ipath-absolute = "/" [ isegment-nz *( "/" isegment ) ]
ipath-noscheme = isegment-nz-nc *( "/" isegment )
ipath-rootless = isegment-nz *( "/" isegment )
ipath-empty    = 0&lt;ipchar&gt;

isegment       = *ipchar
isegment-nz    = 1*ipchar
isegment-nz-nc = 1*( iunreserved / pct-encoded / sub-delims
                     / "@" )
               ; non-zero-length segment without any colon ":"

ipchar         = iunreserved / pct-encoded / sub-delims / ":"
               / "@"

iquery         = *( ipchar / iprivate / "/" / "?" )

ifragment      = *( ipchar / "/" / "?" )

iunreserved    = ALPHA / DIGIT / "-" / "." / "_" / "~" / ucschar

ucschar        = %xA0-D7FF / %xF900-FDCF / %xFDF0-FFEF
               / %x10000-1FFFD / %x20000-2FFFD / %x30000-3FFFD
               / %x40000-4FFFD / %x50000-5FFFD / %x60000-6FFFD
               / %x70000-7FFFD / %x80000-8FFFD / %x90000-9FFFD
               / %xA0000-AFFFD / %xB0000-BFFFD / %xC0000-CFFFD
               / %xD0000-DFFFD / %xE1000-EFFFD

iprivate       = %xE000-F8FF / %xE0000-E0FFF / %xF0000-FFFFD
               / %x100000-10FFFD
</pre></div>
<p>Some productions are ambiguous. The "first-match-wins" (a.k.a. "greedy")
algorithm applies. For details, see <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<p>The following rules are the same as those in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
scheme         = ALPHA *( ALPHA / DIGIT / "+" / "-" / "." )

port           = *DIGIT

IP-literal     = "[" ( IPv6address / IPvFuture  ) "]"

IPvFuture      = "v" 1*HEXDIG "." 1*( unreserved / sub-delims / ":" )

IPv6address    =                            6( h16 ":" ) ls32
               /                       "::" 5( h16 ":" ) ls32
               / [               h16 ] "::" 4( h16 ":" ) ls32
               / [ *1( h16 ":" ) h16 ] "::" 3( h16 ":" ) ls32
               / [ *2( h16 ":" ) h16 ] "::" 2( h16 ":" ) ls32
               / [ *3( h16 ":" ) h16 ] "::"    h16 ":"   ls32
               / [ *4( h16 ":" ) h16 ] "::"              ls32
               / [ *5( h16 ":" ) h16 ] "::"              h16
               / [ *6( h16 ":" ) h16 ] "::"

h16            = 1*4HEXDIG
ls32           = ( h16 ":" h16 ) / IPv4address

IPv4address    = dec-octet "." dec-octet "." dec-octet "." dec-octet

dec-octet      = DIGIT                 ; 0-9
               / %x31-39 DIGIT         ; 10-99
               / "1" 2DIGIT            ; 100-199
               / "2" %x30-34 DIGIT     ; 200-249
               / "25" %x30-35          ; 250-255

pct-encoded    = "%" HEXDIG HEXDIG

unreserved     = ALPHA / DIGIT / "-" / "." / "_" / "~"
reserved       = gen-delims / sub-delims
gen-delims     = ":" / "/" / "?" / "#" / "[" / "]" / "@"
sub-delims     = "!" / "$" / "&amp;" / "'" / "(" / ")"
               / "*" / "+" / "," / ";" / "="
</pre></div>
<p>This syntax does not support IPv6 scoped addressing zone identifiers.
</p>
<a name="iriuri"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Relationship between IRIs and URIs</h3>

<p>IRIs are meant to replace URIs in identifying resources within new versions of protocols,
formats, and software components that use a UCS-based character repertoire.
These protocols and components may never need to use URIs directly,
especially when the resource identifier is used simply for identification
purposes. However, when the resource identifier is used for resource retrieval,
it is in many cases necessary to determine the associated URI, because
retrieval mechanisms are only defined for URIs. 
When used to access a resource, the meaning of an IRI SHOULD be
the same as the meaning of the equivalent URI. This relationship
insures that the resources identified continue to be also available to URI-based
software. 

</p>
<p>This mapping has two purposes:
</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>Syntactical.</dt>
<dd>Many URI schemes and components define additional
     syntactical restrictions not captured in <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a>.
     Scheme-specific restrictions are applied to IRIs by converting
     IRIs to URIs and checking the URIs against the scheme-specific
     restrictions.
</dd>
<dt>Interpretational.</dt>
<dd>URIs are used to identify resources in various ways. 
     IRIs also identify resources; an IRI identifies the same resource 
as does URI that it maps to. In some contexts, it may actually not be 
  necessary to map the IRI to a URI to determine the resource it identifies (see <a class='info' href='#equivalence'>Section&nbsp;5<span> (</span><span class='info'>Normalization and Comparison</span><span>)</span></a>).
     However, when an IRI is used for resource retrieval, the resource that the IRI
     locates is the same as the one located by the URI obtained after
     converting the IRI according to the procedure defined below.
     For this reason, there is no separate definition of resolution for IRIs.
</dd>
</dl></blockquote>

<a name="mapping"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Mapping of IRIs to URIs</h3>

<p>This section defines how to map IRI-related protocol elements
to strings in the URI character set. This mapping is intended for
mapping  IRIs to URIs, IRI references and URI references, as
well as to components thereof (for example, fragment identifiers).
</p>
<p>Note that <a class='info' href='#LEIRIHREF'>Section&nbsp;7<span> (</span><span class='info'>Legacy Extended IRIs (LEIRIs) and Hypertext References</span><span>)</span></a> describes variants of this algorithm used in some applications for mappings related protocol elements.
</p>
<p>The mapping is defined through an algorithm: 
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Step 1.</dt>
<dd>Generate a UCS character sequence from
the original IRI format.
This step has the following three variants, depending on the form of the input:
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>
If the IRI is written on paper, read aloud, or
otherwise represented as a sequence of characters independent of any
character encoding,
represent the IRI as a sequence of characters from the UCS
normalized according to Normalization Form C (NFC, <a class='info' href='#UTR15'>[UTR15]<span> (</span><span class='info'>Davis, M. and M. Duerst, &ldquo;Unicode Normalization Forms,&rdquo; March&nbsp;2008.</span><span>)</span></a>).
</dd>
<dt>b.</dt>
<dd>
If the IRI is in some digital representation
(e.g., an octet stream) in some known non-Unicode character encoding,
convert the IRI to a sequence of characters from the UCS. The resulting sequence of characters SHOULD be 
normalized using NFC.
</dd>
<dt>c.</dt>
<dd>
If the IRI is in a Unicode-based character encoding (for example, UTF-8 or UTF-16),
do not normalize (see <a class='info' href='#normalization'>Section&nbsp;5.3.2.2<span> (</span><span class='info'>Character Normalization</span><span>)</span></a> for details). Apply the next steps directly to the encoded Unicode character sequence.
</dd>
</dl></blockquote>
</dd>
<dt>Step 2.</dt>
<dd>
   For each character which is in either 'ucschar' or 'iprivate', apply
   steps 2.1 through 2.3 below.

<blockquote class="text"><dl>
<dt>2.1.</dt>
<dd>Convert the character to a sequence of one or more octets
      using UTF-8 <a class='info' href='#RFC3629'>[RFC3629]<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a>.
</dd>
<dt>2.2.</dt>
<dd>Convert each octet to %HH, where HH is the hexadecimal
      notation of the octet value. Note that this is identical to the
      percent-encoding mechanism in Section 2.1 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
      To reduce variability, the hexadecimal notation SHOULD use uppercase letters.
</dd>
<dt>2.3.</dt>
<dd>Replace the original character with the resulting character
      sequence (i.e., a sequence of %HH triplets).
</dd>
</dl></blockquote>
</dd>
</dl></blockquote>

<p>The above mapping, when applied a valid IRI, produces a URI fully conforming to
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>. The mapping is also an identity transformation for URIs
and is idempotent; applying the mapping a second time will not change
anything. Every URI is by definition an IRI.
</p>
<p>Systems accepting IRIs MAY convert the ireg-name
component of an IRI as follows (before step 2 above) for schemes
known to use domain names in ireg-name, if the
scheme definition does not allow percent-encoding for ireg-name:
Replace the ireg-name part of the IRI by the part converted using
the ToASCII operation specified in Section 4.1 of <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>
on each dot-separated label, and by using U+002E (FULL STOP) as a label
separator, with the flag UseSTD3ASCIIRules set to TRUE, and with the flag
AllowUnassigned set to FALSE for creating IRIs and set to TRUE otherwise.
The ToASCII operation may fail, but this would mean that the IRI cannot
be resolved. This conversion SHOULD be used when the goal is to
maximize interoperability with legacy URI resolvers.
For example, the IRI<br />
"http://r&amp;#xE9;sum&amp;#xE9;.example.org"<br />
may be converted to<br />
"http://xn--rsum-bpad.example.org"<br />
instead of<br />
"http://r%C3%A9sum%C3%A9.example.org".
</p>
<p>An IRI with a scheme that is known to use domain names in ireg-name,
but where the scheme definition does not allow percent-encoding for ireg-name,
meets scheme-specific restrictions if either the straightforward
conversion or the conversion using the ToASCII operation on ireg-name
result in an URI that meets the scheme-specific restrictions.
</p>
<p>Such an IRI
resolves to the URI obtained after converting the IRI and uses the ToASCII operation on ireg-name. Implementations do not have  to
do this conversion as long as they produce the same result.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>The difference between variants b and c
in step 1 (using normalization with NFC, versus not using any normalization) accounts for the
fact that in many non-Unicode character encodings, some text
cannot be represented directly. For example, the word "Vietnam" is
natively written "Vi&amp;#x1EC7;t Nam" (containing a LATIN SMALL
LETTER E WITH CIRCUMFLEX AND DOT BELOW) in NFC, but a direct
transcoding from the windows-1258 character encoding leads to
"Vi&amp;#xEA;&amp;#x323;t Nam" (containing a LATIN SMALL LETTER E WITH CIRCUMFLEX
followed by a COMBINING DOT BELOW). Direct transcoding
of other 8-bit encodings of Vietnamese may lead to other
representations.
</dd>
<dt>Note:</dt>
<dd>The uniform treatment of the whole IRI in step 2 is important to make processing independent of URI scheme.
See <a class='info' href='#Gettys'>[Gettys]<span> (</span><span class='info'>Gettys, J., &ldquo;URI Model Consequences,&rdquo; .</span><span>)</span></a> for an in-depth discussion.
</dd>
<dt>Note:</dt>
<dd>In practice, whether the general mapping (steps 1 and 2) or the ToASCII operation of <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> is used for ireg-name will not be
noticed if mapping from IRI to URI and resolution is tightly
integrated (e.g., carried out in the same user agent). But conversion
using <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> may be able to better deal with
backwards compatibility issues in case mapping and resolution
are separated, as in the case of using an HTTP proxy.
</dd>
<dt>Note:</dt>
<dd>Internationalized Domain Names may be contained in parts
of an IRI other than the ireg-name part.
It is the responsibility of scheme-specific
implementations (if the Internationalized Domain Name is part of the
scheme syntax) or of server-side implementations (if the Internationalized
Domain Name is part of 'iquery') to apply the necessary conversions
at the appropriate point. Example: Trying to validate the Web page at
http://r&amp;#xE9;sum&amp;#xE9;.example.org would lead to an IRI of<br />

http://validator.w3.org/check?uri=http%3A%2F%2Fr&amp;#xE9;sum&amp;#xE9;.<br />
example.org,
which would convert to a URI of<br />

http://validator.w3.org/check?uri=http%3A%2F%2Fr%C3%A9sum%C3%A9.<br />
example.org.
The server side implementation would be responsible for making the necessary
conversions to be able to retrieve the Web page.
</dd>
</dl></blockquote>

<p>Systems accepting IRIs MAY also deal with the printable characters
in US-ASCII that are not allowed in URIs, namely "&lt;", "&gt;", '"', space,
"{", "}", "|", "\", "^", and "`", in step 2 above. If these characters are
found but are not converted, then the conversion SHOULD fail. Protocols and formats that have used earlier definitions of IRIs
including these characters MAY require percent-encoding of these characters
as a preprocessing step to extract the actual IRI from a given field.
This preprocessing MAY also be used by applications allowing the user
to enter an IRI.
Please note that the number sign ("#"), the percent sign ("%"), and the
square bracket characters ("[", "]")
are not part of the above list and MUST NOT be converted.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>In this process (in step 2.3), characters allowed in URI
references and existing percent-encoded sequences are not encoded further.
(This mapping is similar to, but different from, the encoding applied
when arbitrary content is included in some part of a URI.)
For example, an IRI of
"http://www.example.org/red%09ros&amp;#xE9;#red"
(in XML notation) is converted to
<br />
"http://www.example.org/red%09ros%C3%A9#red", not to
something like
<br />
"http%3A%2F%2Fwww.example.org%2Fred%2509ros%C3%A9%23red".
</dd>
<dt>Note:</dt>
<dd>Some older software transcoding to UTF-8 may produce
illegal output for some input, in particular for characters outside
the BMP (Basic Multilingual Plane). As an example, for the IRI with non-BMP characters (in XML Notation):
"http://example.com/&amp;#x10300;&amp;#x10301;&amp;#x10302";
<br />
which contains the first three letters of the Old Italic alphabet,
the correct conversion to a URI is
<br />
"http://example.com/%F0%90%8C%80%F0%90%8C%81%F0%90%8C%82"
</dd>
</dl></blockquote>

<a name="URItoIRI"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Converting URIs to IRIs</h3>

<p>In some situations, converting a URI into an
equivalent IRI may be desirable. This section gives a procedure for this conversion.
The conversion described in this section
will always result in an IRI that maps back to the URI used
as an input for the conversion (except for potential case differences
in percent-encoding and for potential percent-encoded unreserved characters).
However, the IRI resulting from this conversion
may not be exactly the same as the original IRI (if there ever was one).
</p>
<p>URI-to-IRI conversion removes percent-encodings, but not all
percent-encodings can be eliminated. There are several reasons for this:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>Some percent-encodings are necessary to distinguish
    percent-encoded and unencoded uses of reserved characters.
</dd>
<dt>2.</dt>
<dd>Some percent-encodings cannot be interpreted as sequences
    of UTF-8 octets.<br />

    (Note: The octet patterns of UTF-8 are highly regular.
    Therefore, there is a very high probability, but no guarantee,
    that percent-encodings that can be interpreted as sequences of UTF-8
    octets actually originated from UTF-8. For a detailed discussion,
    see <a class='info' href='#Duerst97'>[Duerst97]<span> (</span><span class='info'>Duerst, M., &ldquo;The Properties and Promises of UTF-8,&rdquo; September&nbsp;1997.</span><span>)</span></a>.)
</dd>
<dt>3.</dt>
<dd>The conversion may result in a character that is not
    appropriate in an IRI. See <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a>, <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>,
      and <a class='info' href='#limitations'>Section&nbsp;6.1<span> (</span><span class='info'>Limitations on UCS Characters Allowed in IRIs</span><span>)</span></a> for further details.
</dd>
</dl></blockquote>

<p>Conversion from a URI to an IRI is done by using the following steps
(or any other algorithm that produces the same result):

</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>Represent the URI as a sequence of octets in US-ASCII.
</dd>
<dt>2.</dt>
<dd>Convert all percent-encodings ("%" followed by two hexadecimal
      digits) to the corresponding octets, except those corresponding to "%", characters in "reserved",
      and characters in US-ASCII not allowed in URIs.
</dd>
<dt>3.</dt>
<dd>Re-percent-encode any octet produced in step 2 that is not part of a
      strictly legal UTF-8 octet sequence.
</dd>
<dt>4.</dt>
<dd>Re-percent-encode all octets produced in step 3 that in UTF-8 represent
      characters that are not appropriate according to <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a>,
      <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>, and <a class='info' href='#limitations'>Section&nbsp;6.1<span> (</span><span class='info'>Limitations on UCS Characters Allowed in IRIs</span><span>)</span></a>.
</dd>
<dt>5.</dt>
<dd>Interpret the resulting octet sequence as a sequence of characters
      encoded in UTF-8.
</dd>
</dl></blockquote><p>
This procedure will convert as many percent-encoded characters as
possible to characters in an IRI. Because there are some choices
when step 4 is applied (see <a class='info' href='#limitations'>Section&nbsp;6.1<span> (</span><span class='info'>Limitations on UCS Characters Allowed in IRIs</span><span>)</span></a>), results may vary.
</p>
<p>Conversions from URIs to IRIs MUST NOT use any character encoding other than
UTF-8 in steps 3 and 4, even if it might be possible to guess from the context
that another character encoding than UTF-8 was used in the URI.
For example, the URI "http://www.example.org/r%E9sum%E9.html" might with
some guessing be interpreted to contain two e-acute characters encoded as
iso-8859-1. It must not be converted to an IRI containing these e-acute
characters. Otherwise, in the future the IRI will be mapped to
"http://www.example.org/r%C3%A9sum%C3%A9.html", which is a different URI
from "http://www.example.org/r%E9sum%E9.html".
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Examples</h3>

<p>This section shows various examples of converting URIs to IRIs.
Each example shows the
result after each of the steps 1 through 5 is applied. XML Notation is
used for the final result.
Octets are  
            denoted by "&lt;" followed by two hexadecimal digits followed by "&gt;".
</p>
<p>The following example contains the sequence "%C3%BC", which is a strictly
legal UTF-8 sequence, and which is converted into the actual character
U+00FC, LATIN SMALL LETTER U WITH DIAERESIS (also known as u-umlaut).
</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>http://www.example.org/D%C3%BCrst
</dd>
<dt>2.</dt>
<dd>http://www.example.org/D&lt;c3&gt;&lt;bc&gt;rst
</dd>
<dt>3.</dt>
<dd>http://www.example.org/D&lt;c3&gt;&lt;bc&gt;rst
</dd>
<dt>4.</dt>
<dd>http://www.example.org/D&lt;c3&gt;&lt;bc&gt;rst
</dd>
<dt>5.</dt>
<dd>http://www.example.org/D&amp;#xFC;rst
</dd>
</dl></blockquote><p>

</p>
<p>The following example contains the sequence "%FC", which might represent U+00FC,
LATIN SMALL LETTER U WITH DIAERESIS, in the<br />
iso-8859-1 character encoding.
(It might represent other characters in other character encodings. For example, the octet
&lt;fc&gt; in iso-8859-5 represents U+045C, CYRILLIC SMALL LETTER KJE.)
Because &lt;fc&gt; is not part of a
strictly legal UTF-8 sequence, it is re-percent-encoded in step 3.</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>http://www.example.org/D%FCrst
</dd>
<dt>2.</dt>
<dd>http://www.example.org/D&lt;fc&gt;rst
</dd>
<dt>3.</dt>
<dd>http://www.example.org/D%FCrst
</dd>
<dt>4.</dt>
<dd>http://www.example.org/D%FCrst
</dd>
<dt>5.</dt>
<dd>http://www.example.org/D%FCrst
</dd>
</dl></blockquote><p>

</p>
<p>The following example contains "%e2%80%ae", which is the percent-encoded<br />
UTF-8
character encoding of U+202E, RIGHT-TO-LEFT OVERRIDE. <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>
forbids the direct use of this character in an IRI. Therefore, the
corresponding octets are re-percent-encoded in step 4. This example shows
that the case (upper- or lowercase) of letters used in percent-encodings may not be preserved.
The example also contains a punycode-encoded domain name label (xn--99zt52a),
which is not converted.
</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>http://xn--99zt52a.example.org/%e2%80%ae
</dd>
<dt>2.</dt>
<dd>http://xn--99zt52a.example.org/&lt;e2&gt;&lt;80&gt;&lt;ae&gt;
</dd>
<dt>3.</dt>
<dd>http://xn--99zt52a.example.org/&lt;e2&gt;&lt;80&gt;&lt;ae&gt;
</dd>
<dt>4.</dt>
<dd>http://xn--99zt52a.example.org/%E2%80%AE
</dd>
<dt>5.</dt>
<dd>http://xn--99zt52a.example.org/%E2%80%AE
</dd>
</dl></blockquote>

<p>Implementations with scheme-specific knowledge MAY convert
punycode-encoded domain name labels to the corresponding characters using the
ToUnicode procedure. Thus, for the example above, the label "xn--99zt52a" may
be converted to U+7D0D U+8C46 (Japanese Natto), leading to the overall
IRI of<br />
"http://&amp;#x7D0D;&amp;#x8C46;.example.org/%E2%80%AE".
</p>
<a name="Bidi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Bidirectional IRIs for Right-to-Left Languages</h3>

<p>Some UCS characters, such as those used in the Arabic and Hebrew
scripts, have an inherent right-to-left (rtl) writing direction. IRIs
containing these characters (called bidirectional IRIs or Bidi IRIs)
require additional attention because of the non-trivial relation
between logical representation (used for digital representation and for reading/spelling) and visual representation (used for
display/printing).
</p>
<p>Because of the complex interaction between the logical representation,
the visual representation, and the syntax of a Bidi IRI, a balance is
needed between various requirements.
The main requirements are</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>user-predictable conversion between visual and
    logical representation;
</dd>
<dt>2.</dt>
<dd>the ability to include a wide range of characters
    in various parts of the IRI; and
</dd>
<dt>3.</dt>
<dd>minor or no changes or restrictions for
      implementations.
</dd>
</dl></blockquote>

<a name="visual"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Logical Storage and Visual Presentation</h3>

<p>When stored or transmitted in digital representation,
bidirectional IRIs MUST be in full logical order and
MUST conform to the IRI syntax rules (which includes the rules
relevant to their scheme). This ensures that bidirectional
IRIs can be processed in the same way as other IRIs.
</p>
<p>Bidirectional IRIs MUST be rendered by using the
Unicode Bidirectional Algorithm <a class='info' href='#UNIV4'>[UNIV4]<span> (</span><span class='info'>The Unicode Consortium, &ldquo;The Unicode Standard, Version 5.1.0, defined by: The Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN 0-321-48091-0), as amended by Unicode 4.1.0 (http://www.unicode.org/versions/Unicode5.1.0/),&rdquo; April&nbsp;2008.</span><span>)</span></a>, <a class='info' href='#UNI9'>[UNI9]<span> (</span><span class='info'>Davis, M., &ldquo;The Bidirectional Algorithm,&rdquo; March&nbsp;2004.</span><span>)</span></a>.
Bidirectional IRIs MUST be rendered in the same way as they would
be if they were in a left-to-right embedding; i.e., as if
they were preceded by U+202A, LEFT-TO-RIGHT EMBEDDING (LRE),
and followed by U+202C, POP DIRECTIONAL FORMATTING (PDF).
Setting the embedding direction can also be done in a
higher-level protocol (e.g., the dir='ltr' attribute in HTML).
</p>
<p>There is no requirement to use the above embedding
if the display is still the same without the embedding. For
example, a bidirectional IRI in a text with left-to-right base
directionality (such as used for English or Cyrillic) that is
preceded and followed by whitespace and  strong left-to-right
characters does not need an embedding.
Also, a bidirectional relative IRI reference that only contains strong
right-to-left characters and weak characters and that starts and
ends with a strong right-to-left character and appears in a text with
right-to-left base directionality (such as used for Arabic or Hebrew)
and is preceded and followed by whitespace and strong characters
does not need an embedding.
</p>
<p>In some other cases, using U+200E, LEFT-TO-RIGHT MARK (LRM),
may be sufficient to force the correct display behavior.
However, the details of the Unicode Bidirectional algorithm are
not always easy to understand. Implementers are strongly advised
to err on the side of caution and to use embedding in all cases
where they are not completely sure that the display behavior
is unaffected without the embedding.
</p>
<p>The Unicode Bidirectional Algorithm (<a class='info' href='#UNI9'>[UNI9]<span> (</span><span class='info'>Davis, M., &ldquo;The Bidirectional Algorithm,&rdquo; March&nbsp;2004.</span><span>)</span></a>,
section 4.3) permits higher-level protocols to influence bidirectional
rendering. Such changes by higher-level protocols MUST NOT be used
if they change the rendering of IRIs.
</p>
<p>The bidirectional formatting characters that may be used before or
after the IRI to ensure correct display are not themselves part of the IRI.
IRIs MUST NOT contain bidirectional formatting characters (LRM,
RLM, LRE, RLE, LRO, RLO, and PDF). They affect the visual rendering
of the IRI but do not appear themselves. It would therefore
not be possible to input an IRI with such characters correctly.
</p>
<a name="bidi-structure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Bidi IRI Structure</h3>

<p>The Unicode Bidirectional Algorithm is designed mainly for running text.
To make sure that it does not affect the rendering of bidirectional IRIs
too much, some restrictions on bidirectional IRIs are necessary. These
restrictions are given in terms of delimiters (structural characters,
mostly punctuation such as "@", ".", ":", and<br />
"/") and components (usually
consisting mostly of letters and digits).
</p>
<p>The following syntax rules from <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a> correspond to components
for the purpose of Bidi behavior: iuserinfo, ireg-name, isegment, isegment-nz,
isegment-nz-nc, ireg-name, iquery, and ifragment.

</p>
<p>Specifications that define the syntax of any of the above components
MAY divide them further and define smaller parts to be components according
to this document. As an example, the restrictions of <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> on
bidirectional domain names correspond to treating each label of a domain
name as a component for schemes with ireg-name as a domain name.
Even where the components are not defined formally, it may be helpful to
think about some syntax in terms of components and to apply the relevant restrictions.
For example, for the usual name/value syntax in query parts, it is convenient to
treat each name and each value as a component. As another example, the
extensions in a resource name can be treated as separate components.
</p>
<p>For each component, the following restrictions apply:
</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>1.</dt>
<dd>A component SHOULD NOT use both right-to-left and left-to-right
characters.
</dd>
<dt>2.</dt>
<dd>A component using right-to-left characters SHOULD start and end 
with right-to-left characters.
</dd>
</dl></blockquote><p>

</p>
<p>The above restrictions are given as shoulds, rather than as musts.
For IRIs that are never presented visually, they are not relevant.
However, for IRIs in general, they are very important to ensure
consistent conversion between visual presentation and logical
representation, in both directions.

</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>In some components, the above restrictions may actually be
strictly enforced.
For example, <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> requires that these restrictions apply
to the labels of a host name for those schemes where ireg-name is a host name.
In some other components
(for example, path components) following these restrictions may not be too difficult.
For other components, such as parts of the query part, it may be very difficult
to enforce the restrictions because the values of query parameters may be
arbitrary character sequences.
</dd>
</dl></blockquote>

<p>If the above restrictions cannot be satisfied otherwise, the affected
component can always be mapped to URI notation as described in
<a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>. Please note that the whole component has
to be mapped (see also Example 9 below).

</p>
<a name="bidiInput"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Input of Bidi IRIs</h3>

<p>Bidi input methods MUST generate Bidi IRIs in logical
order while rendering them according to <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>.
During input, rendering SHOULD be updated after every new character is input to avoid end-user confusion.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Examples</h3>

<p>This section gives examples of bidirectional IRIs, in Bidi Notation.
It shows legal IRIs with the relationship between logical and
visual representation and explains how certain phenomena in
this relationship may look strange to somebody not familiar
with bidirectional behavior, but familiar to users of Arabic
and Hebrew. It also shows what happens if the
restrictions given in <a class='info' href='#bidi-structure'>Section&nbsp;4.2<span> (</span><span class='info'>Bidi IRI Structure</span><span>)</span></a> are not
followed. The examples below can be seen at <a class='info' href='#BidiEx'>[BidiEx]<span> (</span><span class='info'>, &ldquo;Examples of bidirectional IRIs,&rdquo; .</span><span>)</span></a>,
in Arabic, Hebrew, and Bidi Notation variants.
</p>
<p>To read the bidi text in the examples, read the visual
representation from left to right until you encounter a block of
rtl text. Read the rtl block (including slashes and other special
characters) from right to left, then continue at the next unread ltr 
character.
</p>
<p>Example 1: A single component with rtl
characters is inverted:
<br />
Logical representation: "http://ab.CDEFGH.ij/kl/mn/op.html"<br />
Visual representation: "http://ab.HGFEDC.ij/kl/mn/op.html"<br />

Components can be read one by one, and each component can be
read in its natural direction.
</p>
<p>Example 2: More than one consecutive component with rtl
characters is inverted as a whole:
<br />
Logical representation: "http://ab.CDE.FGH/ij/kl/mn/op.html"<br />
Visual representation: "http://ab.HGF.EDC/ij/kl/mn/op.html"<br />

A sequence of rtl components is read rtl, in the same way
as a sequence of rtl words is read rtl in a bidi text.
</p>
<p>Example 3: All components of an IRI (except for the scheme) are rtl.
All rtl components are inverted overall:
<br />
Logical representation: "http://AB.CD.EF/GH/IJ/KL?MN=OP;QR=ST#UV"<br />
Visual representation: "http://VU#TS=RQ;PO=NM?LK/JI/HG/FE.DC.BA"<br />

The whole IRI (except the scheme) is read rtl. Delimiters
between rtl components stay between the respective components;
delimiters between ltr and rtl components don't move.
</p>
<p>Example 4: Each of several sequences of rtl components is
inverted on its own:
<br />
Logical representation: "http://AB.CD.ef/gh/IJ/KL.html"<br />
Visual representation: "http://DC.BA.ef/gh/LK/JI.html"<br />

Each sequence of rtl components is read rtl, in the same way
as each sequence of rtl words in an ltr text is read rtl.
</p>
<p>Example 5: Example 2, applied to components of different
kinds:
<br />
Logical representation: "http://ab.cd.EF/GH/ij/kl.html"
<br />
Visual representation: "http://ab.cd.HG/FE/ij/kl.html"<br />

The inversion of the domain name label and the path component
may be unexpected, but it is consistent with other bidi behavior.
For reassurance that the domain component really is "ab.cd.EF",
it may be helpful to read aloud the visual representation following
the bidi algorithm. After "http://ab.cd." one reads the RTL block  
"E-F-slash-G-H", which corresponds to the logical representation.

</p>
<p>Example 6: Same as Example 5, with more rtl components:
<br />
Logical representation: "http://ab.CD.EF/GH/IJ/kl.html"<br />
Visual representation: "http://ab.JI/HG/FE.DC/kl.html"<br />

The inversion of the domain name labels and the path components
may be easier to identify because the delimiters also move.
</p>
<p>Example 7: A single rtl component includes digits:
<br />
Logical representation: "http://ab.CDE123FGH.ij/kl/mn/op.html"<br />
Visual representation: "http://ab.HGF123EDC.ij/kl/mn/op.html"<br />

Numbers are written ltr in all cases but are treated as
an additional embedding inside a run of rtl characters. This
is completely consistent with usual bidirectional text.
</p>
<p>Example 8 (not allowed): Numbers are at the start or end of an rtl component:<br />
Logical representation: "http://ab.cd.ef/GH1/2IJ/KL.html"<br />
Visual representation: "http://ab.cd.ef/LK/JI1/2HG.html"<br />

The sequence "1/2" is interpreted by the bidi algorithm
as a fraction, fragmenting the components and leading to
confusion. There are other characters that are interpreted
in a special way close to numbers; in particular, "+", "-",
"#", "$", "%", ",", ".", and ":".
</p>
<p>Example 9 (not allowed): The numbers in the previous
example are percent-encoded:
<br />
Logical representation:    "http://ab.cd.ef/GH%31/%32IJ/KL.html",<br />
Visual representation: "http://ab.cd.ef/LK/JI%32/%31HG.html"
</p>
<p>Example 10 (allowed but not recommended):
<br />
Logical representation: "http://ab.CDEFGH.123/kl/mn/op.html"<br />
Visual representation: "http://ab.123.HGFEDC/kl/mn/op.html"<br />

Components consisting
of only numbers are allowed (it would be rather difficult to prohibit
them), but these may interact with adjacent RTL components in ways that are
not easy to predict.
</p>
<p>Example 11 (allowed but not recommended):
<br />
Logical representation: "http://ab.CDEFGH.123ij/kl/mn/op.html"<br />
Visual representation: "http://ab.123.HGFEDCij/kl/mn/op.html"<br />

Components consisting of numbers and  left-to-right characters are 
   allowed, but these may interact with adjacent RTL components in ways 
   that are not easy to predict.
</p>
<a name="equivalence"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Normalization and Comparison</h3>

<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>Note: The structure and much of the material for this
  section is taken from section 6 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>; the
  differences are due to the specifics of IRIs.
</dd>
</dl></blockquote>

<p>One of the most common operations on IRIs is simple comparison: Determining
whether two IRIs are equivalent without using the IRIs or the mapped URIs to access
their respective resource(s). A comparison is performed whenever a response
cache is accessed, a browser checks its history to color a link, or an XML
parser processes tags within a namespace. Extensive normalization prior to
comparison of IRIs may be used by spiders and indexing engines to prune a
search space or reduce duplication of request actions and
response storage.
</p>
<p>IRI comparison is performed for some particular purpose. Protocols or implementations that compare IRIs for  different purposes will often be subject to differing
design trade-offs in regards to how much effort should be spent in
reducing aliased identifiers. This section describes various methods
that may be used to compare IRIs, the trade-offs between them, and the types
of applications that might use them.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Equivalence</h3>

<p>Because IRIs exist to identify resources, presumably they should be considered
equivalent when they identify the same resource. However, this definition of
equivalence is not of much practical use, as there is no
way for an implementation to compare two resources unless it has full knowledge or control of them. For this reason, determination of equivalence or difference of IRIs
is based on string comparison, perhaps augmented by reference to additional
rules provided by URI scheme definitions.
We use the terms "different" and
"equivalent" to describe the possible outcomes of such comparisons, but there
are many application-dependent versions of equivalence.
</p>
<p>Even though it is possible to determine that two IRIs are equivalent,
IRI comparison is not sufficient to determine whether two IRIs identify different
resources. For example, an owner of two different domain names
could decide to serve the same resource from both, resulting in two
different IRIs. Therefore, comparison methods are designed to minimize
false negatives while strictly avoiding false positives.
</p>
<p>In testing for equivalence, applications should not directly compare
relative references; the references should be converted to their respective
target IRIs before comparison. When IRIs are compared to select (or avoid) a network action, such as
retrieval of a representation, fragment components (if any)
should be excluded from the comparison.
</p>
<p>Applications using IRIs as identity tokens with no relationship to a
protocol MUST use the Simple String Comparison (see <a class='info' href='#stringcomp'>Section&nbsp;5.3.1<span> (</span><span class='info'>Simple String Comparison</span><span>)</span></a>).
All other applications MUST select one of the comparison practices from
the Comparison Ladder (see <a class='info' href='#ladder'>Section&nbsp;5.3<span> (</span><span class='info'>Comparison Ladder</span><span>)</span></a> or, after IRI-to-URI conversion,
select one of the comparison practices from the URI comparison
ladder in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>, section 6.2).
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Preparation for Comparison</h3>

<p>Any kind of  IRI comparison REQUIRES that all escapings or encodings in the protocol or format that carries an IRI are resolved. This is usually done when the protocol or format is parsed. Examples of such escapings or encodings are entities and numeric character references  in <a class='info' href='#HTML4'>[HTML4]<span> (</span><span class='info'>Raggett, D., Le Hors, A., and I. Jacobs, &ldquo;HTML 4.01 Specification,&rdquo; December&nbsp;1999.</span><span>)</span></a> and <a class='info' href='#XML1'>[XML1]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., Maler, E., and F. Yergeau, &ldquo;Extensible Markup Language (XML) 1.0 (Forth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>. As an example, "http://example.org/ros&amp;eacute;" (in HTML), "http://example.org/ros&amp;#233;" (in HTML or XML), and  <br />
"http://example.org/ros&amp;#xE9;" (in HTML or XML) are all resolved into what is denoted in this document (see <a class='info' href='#sec-Notation'>Section&nbsp;1.4<span> (</span><span class='info'>Notation</span><span>)</span></a>) as "http://example.org/ros&amp;#xE9;" (the "&amp;#xE9;" here standing for the actual e-acute character, to compensate for the fact that this document cannot contain non-ASCII characters).
</p>
<p>Similar considerations apply to encodings such as Transfer Codings in HTTP (see <a class='info' href='#RFC2616'>[RFC2616]<span> (</span><span class='info'>Fielding, R., Gettys, J., Mogul, J., Frystyk, H., Masinter, L., Leach, P., and T. Berners-Lee, &ldquo;Hypertext Transfer Protocol -- HTTP/1.1,&rdquo; June&nbsp;1999.</span><span>)</span></a>) and Content Transfer Encodings in MIME (<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>), although in these cases, the encoding is based not on characters but on octets, and additional care is required to make sure that characters, and not just arbitrary octets, are compared (see <a class='info' href='#stringcomp'>Section&nbsp;5.3.1<span> (</span><span class='info'>Simple String Comparison</span><span>)</span></a>).
</p>
<a name="ladder"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Comparison Ladder</h3>

<p>In practice, a variety of methods are used, to test
IRI equivalence. These methods fall into a range
distinguished by the amount of processing required
and the degree to which the probability of false
negatives is reduced. As noted above, false negatives
cannot be eliminated. In practice, their probability can
be reduced, but this reduction requires more processing
and is not cost-effective for all applications.
</p>
<p>If this range of comparison practices is considered
as a ladder, the following discussion will climb the ladder,
starting with practices that are cheap but have
a relatively higher chance of producing false negatives,
and proceeding to those that have higher computational
cost and lower risk of false negatives.
</p>
<a name="stringcomp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
Simple String Comparison</h3>

<p>If two IRIs, when considered as character strings,
are identical, then it is safe to conclude that they are equivalent.
This type of equivalence test has very low computational
cost and is in wide use in a variety of applications,
particularly in the domain of parsing. It is also used when a definitive
answer to the question of IRI equivalence is
needed that is independent of the scheme used and that
can be calculated quickly and without accessing a
network. An example of such a case is XML Namespaces (<a class='info' href='#XMLNamespace'>[XMLNamespace]<span> (</span><span class='info'>Bray, T., Hollander, D., Layman, A., and R. Tobin, &ldquo;Namespaces in XML (Second Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>).
</p>
<p>Testing strings for equivalence requires some basic precautions.
This procedure is often referred to as "bit-for-bit" or "byte-for-byte" comparison,
which is potentially misleading. Testing strings for equality is
normally based on pair comparison of the characters
that make up the strings, starting from the first and
proceeding until both strings are exhausted and all
characters are found to be equal, until a pair of characters
compares unequal, or until one of the strings is exhausted
before the other.
</p>
<p>This character comparison requires that each pair
of characters be put in comparable encoding form. For
example, should one IRI be stored in a byte array in
UTF-8 encoding form and the second in a UTF-16
encoding form, bit-for-bit comparisons applied naively
will produce errors. It is better to speak of equality on
a character-for-character rather than on a byte-for-byte or  bit-for-bit basis.
In practical terms, character-by-character comparisons should be done
codepoint by codepoint after conversion to a common character encoding form.
When comparing character by character, the comparison function MUST NOT map IRIs to
URIs, because such a mapping would create additional
spurious equivalences. It follows that an IRI SHOULD
NOT be modified when being transported if there is
any chance that this IRI might be used as an identifier.
</p>
<p>False negatives are caused by the production and
use of IRI aliases. Unnecessary aliases can be reduced,
regardless of the comparison method, by consistently
providing IRI references in an already normalized
form (i.e., a form identical to what would be produced
after normalization is applied, as described below).
Protocols and data formats often limit some
IRI comparisons to simple string comparison, based
on the theory that people and implementations will,
in their own best interest, be consistent in providing IRI
references, or at least be consistent enough to negate
any efficiency that might be obtained from further
normalization.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
Syntax-Based Normalization</h3>

<p>Implementations may use logic based on the definitions provided 
by this specification to reduce the probability of false negatives. This processing
is moderately higher in cost than character-for-character
string comparison. For example, an application using this approach
could reasonably consider the following two IRIs equivalent:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   example://a/b/c/%7Bfoo%7D/ros&amp;#xE9;
   eXAMPLE://a/./b/../b/%63/%7bfoo%7d/ros%C3%A9
</pre></div>
<p>Web user agents, such as browsers, typically apply this
type of IRI normalization when determining whether
a cached response is available. Syntax-based normalization
includes such techniques as case normalization,
character normalization, percent-encoding normalization,
and removal of dot-segments.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.1"></a><h3>5.3.2.1.&nbsp;
Case Normalization</h3>

<p>For all IRIs, the hexadecimal digits within a percent-encoding
triplet (e.g., "%3a" versus "%3A") are case-insensitive
and therefore should be normalized to use uppercase letters
for the digits A-F.
</p>
<p>When an IRI uses components of the generic syntax, the
component syntax equivalence rules always apply;
namely, that the scheme and US-ASCII only host are case insensitive
and therefore should be normalized to
lowercase. For example, the URI "HTTP://www.EXAMPLE.com/" is equivalent to
"http://www.example.com/". Case equivalence for non-ASCII characters in IRI components that are IDNs are discussed in <a class='info' href='#schemecomp'>Section&nbsp;5.3.3<span> (</span><span class='info'>Scheme-Based Normalization</span><span>)</span></a>.
The other generic syntax components are
assumed to be case sensitive unless specifically
defined otherwise by the scheme.
</p>
<p>Creating schemes that allow case-insensitive syntax
components containing non-ASCII characters should
be avoided. Case normalization of non-ASCII characters can be
culturally dependent and is always a complex
operation. The only exception concerns non-ASCII host
names for which the character normalization
includes a mapping step derived from case folding.
</p>
<a name="normalization"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.2"></a><h3>5.3.2.2.&nbsp;
Character Normalization</h3>

<p>The Unicode Standard <a class='info' href='#UNIV4'>[UNIV4]<span> (</span><span class='info'>The Unicode Consortium, &ldquo;The Unicode Standard, Version 5.1.0, defined by: The Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN 0-321-48091-0), as amended by Unicode 4.1.0 (http://www.unicode.org/versions/Unicode5.1.0/),&rdquo; April&nbsp;2008.</span><span>)</span></a> defines various equivalences
between sequences of characters for various
purposes. Unicode Standard Annex #15 <a class='info' href='#UTR15'>[UTR15]<span> (</span><span class='info'>Davis, M. and M. Duerst, &ldquo;Unicode Normalization Forms,&rdquo; March&nbsp;2008.</span><span>)</span></a> defines
various Normalization Forms for these
equivalences, in particular Normalization Form C
(NFC, Canonical Decomposition, followed by Canonical
Composition) and Normalization Form KC (NFKC,
Compatibility Decomposition, followed by Canonical
Composition).
</p>
<p>Equivalence of IRIs MUST rely on the assumption that
IRIs are appropriately pre-character-normalized
rather than apply character normalization when
comparing two IRIs. The exceptions are conversion from a non-digital form, and conversion from a non-UCS-based character encoding
to a UCS-based character encoding. In these cases, NFC or a normalizing transcoder
using NFC MUST be used for interoperability. To
avoid false negatives and problems with transcoding,
IRIs SHOULD be created by using NFC. Using NFKC
may avoid even more problems; for example, by choosing
half-width Latin letters instead of full-width ones, and
full-width instead of half-width Katakana.
</p>
<p>As an example, "http://www.example.org/r&amp;#xE9;sum&amp;#xE9;.html"
(in XML Notation) is in NFC. On the other
hand, "http://www.example.org/re&amp;#x301;sume&amp;#x301;.html"
is not in NFC.
</p>
<p>The former uses precombined e-acute
characters, and the latter uses "e" characters followed
by combining acute accents. Both usages are
defined as canonically equivalent in <a class='info' href='#UNIV4'>[UNIV4]<span> (</span><span class='info'>The Unicode Consortium, &ldquo;The Unicode Standard, Version 5.1.0, defined by: The Unicode Standard, Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN 0-321-48091-0), as amended by Unicode 4.1.0 (http://www.unicode.org/versions/Unicode5.1.0/),&rdquo; April&nbsp;2008.</span><span>)</span></a>.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Note:</dt>
<dd>
Because it is unknown how a particular sequence of characters
is being treated with respect to character
normalization, it would be inappropriate to allow third
parties to normalize an IRI arbitrarily. This does not
contradict the recommendation that when a resource is created,
its IRI should be as character normalized as
possible (i.e., NFC or even NFKC). This is similar to the uppercase/lowercase problems.   Some parts of a URI are case insensitive (domain name). For others, it is unclear whether they are case sensitive, case insensitive, or something in between (e.g.,  case sensitive, but with a multiple choice selection if the wrong case is used, instead of a direct negative result).  The best recipe is 
         

      that the creator use a reasonable capitalization and, when  
         

      transferring the URI, capitalization never be changed.
</dd>
</dl></blockquote>

<p>Various IRI schemes may allow the usage of
Internationalized Domain Names (IDN) <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> either in
the ireg-name part or elsewhere. Character Normalization also applies to IDNs, as discussed in <a class='info' href='#schemecomp'>Section&nbsp;5.3.3<span> (</span><span class='info'>Scheme-Based Normalization</span><span>)</span></a>.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.3"></a><h3>5.3.2.3.&nbsp;
Percent-Encoding Normalization</h3>

<p>The percent-encoding mechanism (Section 2.1 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>)
is a frequent source of variance among
otherwise identical IRIs. In addition to the case
normalization issue noted above, some IRI producers
percent-encode octets that do not require percent-encoding,
resulting in IRIs that are equivalent to their nonencoded
counterparts. These IRIs should be normalized by decoding
any percent-encoded octet  sequence that
corresponds to an unreserved character, as described
in section 2.3 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<p>For actual resolution, differences in percent-encoding
(except for the percent-encoding of reserved
characters) MUST always result in the same resource.
For example, "http://example.org/~user",
"http://example.org/%7euser", and "http://example.org/%7Euser",
must resolve to the same resource.
</p>
<p>If this kind of equivalence is to be tested, the
percent-encoding of both IRIs to be compared has to be
aligned; for example, by converting both IRIs to URIs
(see Section 3.1), eliminating escape differences in the
resulting URIs, and making sure that the case of the
hexadecimal characters in the percent-encoding is
always the same (preferably upper case). If the IRI
is to be passed to another application or used further in
some other way, its original form MUST be preserved.
The conversion described here should be performed
only for local comparison.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.4"></a><h3>5.3.2.4.&nbsp;
Path Segment Normalization</h3>

<p>The complete path segments "." and ".." are intended
only for use within relative references (Section 4.1 of
<a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>) and are removed as part
of the reference resolution process (Section 5.2 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>).
However, some implementations may incorrectly assume
that reference resolution is not necessary when
the reference is already an IRI, and thus fail to remove
dot-segments when they occur in non-relative paths.
IRI normalizers should remove dot-segments by applying
the remove_dot_segments algorithm to the path,
as described in Section 5.2.4 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<a name="schemecomp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3"></a><h3>5.3.3.&nbsp;
Scheme-Based Normalization</h3>

<p>The syntax and semantics of IRIs vary from scheme
to scheme, as described by the defining specification
for each scheme. Implementations may use scheme-specific
rules, at further processing cost, to reduce the
probability of false negatives. For example, because the
"http" scheme makes use of an authority component,
has a default port of "80", and defines an empty path
to be equivalent to "/", the following four IRIs are
equivalent:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   http://example.com
   http://example.com/
   http://example.com:/
   http://example.com:80/</pre></div>
<p>In general, an IRI that uses the generic syntax for
authority with an empty path should be normalized to a
path of "/". Likewise, an explicit ":port", for which the
port is empty or the default for the scheme, is equivalent to
one where the port and its ":" delimiter are elided
and thus should be removed by scheme-based
normalization. For example, the second IRI above is
the normal form for the "http" scheme.
</p>
<p>Another case where normalization varies by scheme
is in the handling of an empty authority component or
empty host subcomponent. For many scheme specifications,
an empty authority or host is considered an
error; for others, it is considered equivalent to "localhost"
or the end-user's host. When a scheme defines a
default for authority and an IRI reference to that default
is desired, the reference should be normalized to an
empty authority for the sake of uniformity, brevity,
and internationalization. If, however, either the userinfo or
port subcomponents are non-empty, then the host should
be given explicitly even if it matches the default.
</p>
<p>Normalization should not remove delimiters when their
associated component is empty unless it is licensed to do
so by the scheme specification. For example, the IRI
"http://example.com/?" cannot be assumed to be
equivalent to any of the examples above. Likewise, the
presence or absence of delimiters within a userinfo
subcomponent is usually significant to its interpretation.
The fragment component is not subject to any
scheme-based normalization; thus, two IRIs that differ
only by the suffix "#" are considered different
regardless of the scheme.
</p>
<p>Some IRI schemes may allow the usage of
Internationalized Domain Names (IDN) <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a> either in
their ireg-name part or elsewhere. When in use in IRIs,
those names SHOULD be validated by using the
ToASCII operation defined in <a class='info' href='#RFC3490'>[RFC3490]<span> (</span><span class='info'>Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;Internationalizing Domain Names in Applications (IDNA),&rdquo; March&nbsp;2003.</span><span>)</span></a>, with the flags
"UseSTD3ASCIIRules" and "AllowUnassigned". An
IRI containing an invalid IDN cannot successfully be resolved.
Validated IDN components of IRIs SHOULD
be character normalized by using the Nameprep process <a class='info' href='#RFC3491'>[RFC3491]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>;
however, for legibility purposes, they
SHOULD NOT be converted into ASCII Compatible Encoding (ACE).
</p>
<p>Scheme-based normalization may also consider IDN components and their conversions to punycode as equivalent. As an example, "http://r&amp;#xE9;sum&amp;#xE9;.example.org" may be considered equivalent to
"http://xn--rsum-bpad.example.org".
</p>
<p>Other scheme-specific normalizations are possible.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4"></a><h3>5.3.4.&nbsp;
Protocol-Based Normalization</h3>

<p>Substantial effort to reduce the
incidence of false negatives is often cost-effective for web spiders. Consequently, they implement even more aggressive techniques
in IRI comparison. For example, if they
observe that an IRI such as
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   http://example.com/data</pre></div>
<p>redirects to an IRI differing only in the trailing slash
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   http://example.com/data/</pre></div>
<p>they will likely regard the two as equivalent in the future.
This kind of technique is only appropriate when
equivalence is clearly indicated by both the result of
accessing the resources and the common conventions
of their scheme's dereference algorithm (in this case,
use of redirection by HTTP origin servers to avoid
problems with relative references).
</p>
<a name="IRIuse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Use of IRIs</h3>

<a name="limitations"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Limitations on UCS Characters Allowed in IRIs</h3>

<p>This section discusses limitations on characters and
character sequences usable for IRIs beyond those given in <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a>
and <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>. The considerations in this
section are relevant when IRIs are created  and when URIs
are converted to IRIs.
</p>
<p>
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>The repertoire of characters allowed
    in each IRI component is limited by the definition of that component.
    For example, the definition of the scheme component does not allow
    characters beyond US-ASCII.
    <br />

    (Note: In accordance with URI practice, generic IRI
    software cannot and should not check for such limitations.)
</dd>
<dt>b.</dt>
<dd>The UCS contains many areas of characters for which there are
    strong visual look-alikes. Because of the likelihood of
    transcription errors, these also should be avoided. This includes
    the full-width equivalents of Latin characters, half-width
    Katakana characters for Japanese, and many others. It also
    includes many look-alikes of "space", "delims", and "unwise",
    characters excluded in <a class='info' href='#RFC3491'>[RFC3491]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
</dd>
</dl></blockquote><p>

</p>
<p>Additional information is available from <a class='info' href='#UNIXML'>[UNIXML]<span> (</span><span class='info'>Duerst, M. and A. Freytag, &ldquo;Unicode in XML and other Markup Languages,&rdquo; June&nbsp;2003.</span><span>)</span></a>.
    <a class='info' href='#UNIXML'>[UNIXML]<span> (</span><span class='info'>Duerst, M. and A. Freytag, &ldquo;Unicode in XML and other Markup Languages,&rdquo; June&nbsp;2003.</span><span>)</span></a> is written in the context of running text rather
    than in that of identifiers. Nevertheless, it discusses many of the
    categories of characters not appropriate for IRIs.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Software Interfaces and Protocols</h3>

<p>Although an IRI is defined as a sequence of characters,
software interfaces for URIs typically function on sequences of
octets or other kinds of code units. Thus, software interfaces
and protocols MUST define which character encoding is used.
</p>
<p>Intermediate software interfaces between IRI-capable components and
URI-only components MUST map the IRIs per <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>,
when transferring from IRI-capable to URI-only components. This mapping SHOULD be applied as late as possible. It SHOULD NOT be
applied between components that are known to be able to handle IRIs.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Format of URIs and IRIs in Documents and Protocols</h3>

<p>Document formats that transport URIs may have to be upgraded to allow
the transport of IRIs. In cases where the document as a whole
has a native character encoding, IRIs MUST also be encoded in this
character encoding and converted accordingly by a parser or interpreter.
IRI characters not expressible in the native character encoding SHOULD
be escaped by using the escaping conventions of the document format
if such conventions are available. Alternatively, they MAY be percent-encoded
according to <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>. For example, in HTML or
XML, numeric character references SHOULD be used. If a document
as a whole has a native character encoding and that character encoding
is not UTF-8, then IRIs MUST NOT be placed into the document in the
UTF-8 character encoding.
</p>
<p>Note: Some formats already accommodate IRIs, although they use
different terminology. HTML 4.0 <a class='info' href='#HTML4'>[HTML4]<span> (</span><span class='info'>Raggett, D., Le Hors, A., and I. Jacobs, &ldquo;HTML 4.01 Specification,&rdquo; December&nbsp;1999.</span><span>)</span></a> defines the conversion from
IRIs to URIs as error-avoiding behavior. XML 1.0 <a class='info' href='#XML1'>[XML1]<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., Maler, E., and F. Yergeau, &ldquo;Extensible Markup Language (XML) 1.0 (Forth Edition),&rdquo; August&nbsp;2006.</span><span>)</span></a>, XLink
<a class='info' href='#XLink'>[XLink]<span> (</span><span class='info'>DeRose, S., Maler, E., and D. Orchard, &ldquo;XML Linking Language (XLink) Version 1.0,&rdquo; June&nbsp;2001.</span><span>)</span></a>, XML Schema <a class='info' href='#XMLSchema'>[XMLSchema]<span> (</span><span class='info'>Biron, P. and A. Malhotra, &ldquo;XML Schema Part 2: Datatypes,&rdquo; May&nbsp;2001.</span><span>)</span></a>, and specifications
based upon them allow IRIs. Also, it is expected that all relevant new W3C
formats and protocols will be required to handle IRIs <a class='info' href='#CharMod'>[CharMod]<span> (</span><span class='info'>Duerst, M., Yergeau, F., Ishida, R., Wolf, M., and T. Texin, &ldquo;Character Model for the World Wide Web: Resource Identifiers,&rdquo; November&nbsp;2004.</span><span>)</span></a>.
</p>
<a name="UTF8use"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Use of UTF-8 for Encoding Original Characters</h3>

<p>This section discusses details and gives examples
for point c) in <a class='info' href='#Applicability'>Section&nbsp;1.2<span> (</span><span class='info'>Applicability</span><span>)</span></a>. To be able to
use IRIs, the URI corresponding to the IRI in question has to
encode original characters into octets by using UTF-8.
This can be specified for all URIs of a URI scheme or can apply to individual
URIs for schemes that do not specify how to encode original characters.
It can apply to the whole URI, or only to some part. For background information
on encoding characters into URIs, see also Section 2.5 of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>.
</p>
<p>For new URI schemes, using UTF-8 is recommended in <a class='info' href='#RFC2718'>[RFC2718]<span> (</span><span class='info'>Masinter, L., Alvestrand, H., Zigmond, D., and R. Petke, &ldquo;Guidelines for new URL Schemes,&rdquo; November&nbsp;1999.</span><span>)</span></a>.
Examples where UTF-8 is already used are the URN syntax <a class='info' href='#RFC2141'>[RFC2141]<span> (</span><span class='info'>Moats, R., &ldquo;URN Syntax,&rdquo; May&nbsp;1997.</span><span>)</span></a>,
IMAP URLs <a class='info' href='#RFC2192'>[RFC2192]<span> (</span><span class='info'>Newman, C., &ldquo;IMAP URL Scheme,&rdquo; September&nbsp;1997.</span><span>)</span></a>, and POP URLs <a class='info' href='#RFC2384'>[RFC2384]<span> (</span><span class='info'>Gellens, R., &ldquo;POP URL Scheme,&rdquo; August&nbsp;1998.</span><span>)</span></a>.
On the other hand, because the HTTP URL scheme does not specify how to encode
original characters, only some HTTP URLs can have corresponding but different IRIs.
</p>
<p>For example, for a document with a URI of<br />
"http://www.example.org/r%C3%A9sum%C3%A9.html",
it is possible to construct a corresponding IRI (in XML notation,
see <a class='info' href='#sec-Notation'>Section&nbsp;1.4<span> (</span><span class='info'>Notation</span><span>)</span></a>):
"http://www.example.org/r&amp;#xE9;sum&amp;#xE9;.html" ("&amp;#xE9;" stands for the
e-acute character, and "%C3%A9" is the UTF-8 encoded and percent-encoded representation
of that character). On the other hand, for a document with
a URI of "http://www.example.org/r%E9sum%E9.html", the percent-encoding
octets cannot be converted to actual characters in an IRI,
as the percent-encoding is not based on UTF-8.
</p>
<p>This means that for most URI schemes, there is no need to upgrade their
scheme definition in order for them to work with IRIs.
The main case where
upgrading makes sense is when a scheme definition,
or a particular component of a scheme,
is strictly limited to the use of US-ASCII characters
with no provision to include  non-ASCII characters/octets via percent-encoding,
or if a scheme definition currently uses
highly scheme-specific provisions for the encoding of non-ASCII characters.
An example of this is the mailto: scheme <a class='info' href='#RFC2368'>[RFC2368]<span> (</span><span class='info'>Hoffman, P., Masinter, L., and J. Zawinski, &ldquo;The mailto URL scheme,&rdquo; July&nbsp;1998.</span><span>)</span></a>.
</p>
<p>This specification does not upgrade any scheme specifications in any
way; this has to be done separately. Also, note that there
is no such thing as an "IRI scheme"; all IRIs use URI schemes, and all
URI schemes can be used with IRIs, even though in some cases only
by using URIs directly as IRIs, without any conversion.
</p>
<p>URI schemes can impose restrictions on the syntax of 
scheme-specific URIs; i.e., URIs that are admissible under the 
generic URI syntax <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> may not be admissible due to 
narrower syntactic constraints imposed by a URI scheme 
specification. URI scheme definitions cannot broaden the 
syntactic restrictions of the generic URI syntax; otherwise, 
it would be possible to generate URIs that satisfied the 
scheme-specific syntactic constraints without satisfying the 
syntactic constraints of the generic URI syntax. However, 
additional syntactic constraints imposed by URI scheme 
specifications are applicable to IRI, as the 
corresponding URI resulting from the mapping defined in 
<a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a> MUST be a valid URI under the syntactic 
restrictions of generic URI syntax and any narrower 
restrictions imposed by the corresponding URI scheme 
specification.
</p>
<p>The requirement for the use of UTF-8 applies to all parts of a URI
(with the potential exception of the ireg-name part;
see <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>). However, it is possible that
the capability of IRIs to represent a wide range of characters directly
is used just in some parts of the IRI (or IRI reference). The other parts
of the IRI may only contain US-ASCII characters, or they may not be based
on UTF-8. They may be based on another character encoding, or they may
directly encode raw binary data (see also <a class='info' href='#RFC2397'>[RFC2397]<span> (</span><span class='info'>Masinter, L., &ldquo;The &quot;data&quot; URL scheme,&rdquo; August&nbsp;1998.</span><span>)</span></a>).
</p>
<p>For example, it is possible to have a URI reference of<br />
"http://www.example.org/r%E9sum%E9.xml#r%C3%A9sum%C3%A9",
where the document name is encoded in iso-8859-1 based on server
settings, but where the fragment identifier is encoded in UTF-8 according
to <a class='info' href='#XPointer'>[XPointer]<span> (</span><span class='info'>Grosso, P., Maler, E., Marsh, J., and N. Walsh, &ldquo;XPointer Framework,&rdquo; March&nbsp;2003.</span><span>)</span></a>. The IRI corresponding to the above
URI would be (in XML notation)<br />
"http://www.example.org/r%E9sum%E9.xml#r&amp;#xE9;sum&amp;#xE9;".
</p>
<p>Similar considerations apply to query parts. The functionality
of IRIs (namely, to be able to include non-ASCII characters) can
only be used if the query part is encoded in UTF-8.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Relative IRI References</h3>

<p>Processing of relative IRI references against a base is handled
straightforwardly; the algorithms of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> can
be applied directly, treating the characters additionally allowed
in IRI references in the same way that unreserved characters are in URI
references.
</p>
<a name="LEIRIHREF"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Legacy Extended IRIs (LEIRIs) and Hypertext References</h3>

<p>For historic reasons, some formats have allowed variants of IRIs that are somewhat less restricted in syntax. This section provides definitions and names (<a class='info' href='#LEIRI'>Legacy Extended IRI or LEIRI<span> (</span><span class='info'>Thompson, H., Tobin, R., and N. Walsh, &ldquo;Legacy extended IRIs for XML resource identification,&rdquo; .</span><span>)</span></a> [LEIRI], and <a class='info' href='#HTML5'>Hypertext Reference or HREF<span> (</span><span class='info'>Hickson, I. and D. Hyatt, &ldquo;A vocabulary and associated APIs for HTML and XHTML,&rdquo; April&nbsp;2009.</span><span>)</span></a> [HTML5]) for these variants, for easier reference. These variants have to be used with care; they require further processing before being fully interchangeable as IRIs. New protocols and formats SHOULD NOT use Legacy Extended IRIs or Hypertext References. Even where they are allowed, only IRIs fully conforming to the syntax definition in <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a> SHOULD be created, generated, and used. The provisions in this section also apply to Legacy Extended IRI references and other related forms.
</p>
<a name="LEIRIspec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Legacy Extended IRI Syntax</h3>

<p>The syntax of Legacy Extended IRIs is the same as that for IRIs, except that ucschar is redefined as follows:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   ucschar        = " " / "&lt;" / "&gt;" / '"' / "{" / "}" / "|"
                  / "\" / "^" / "`" / %x0-1F / %x7F-D7FF
                  / %xE000-FFFD / %x10000-10FFFF
</pre></div>
<p>The restriction on bidirectional formatting characters in <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a> is lifted. The iprivate production becomes redundant.
</p>
<p>Likewise, the syntax for Legacy Extended IRI references (LEIRI references) is the same as that for IRI references with the above redefinition of ucschar applied.
</p>
<p>Formats that use Legacy Extended IRIs or Legacy Extended IRI references MAY further restrict the characters allowed therein, either implicitly by the fact that the format as such does not allow some characters, or explicitly. An example of a character not allowed implicitly may be  the NUL character (U+0000). However, all the characters allowed in IRIs MUST still be allowed.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Conversion of Legacy Extended IRIs to IRIs</h3>

<p>To convert a Legacy Extended IRI (reference) to
 an IRI (reference), each character allowed in a Legacy Extended IRI (reference) but not allowed in an IRI (reference) (see <a class='info' href='#notAllowed'>Section&nbsp;7.3<span> (</span><span class='info'>Characters Allowed in Legacy Extended IRIs but not in IRIs</span><span>)</span></a>)  MUST be percent-encoded
 by applying steps 2.1 to 2.3 of <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>.
</p>
<a name="notAllowed"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Characters Allowed in Legacy Extended IRIs but not in IRIs</h3>

<p>This section provides a list of the groups of characters and code points that are allowed in Legacy Extedend IRIs, but are not allowed in IRIs or are allowed in IRIs only in the query part. For each group of characters, advice on the usage of these characters is also given, concentrating on the reasons for why not to use them.
</p>
<p></p>
<blockquote class="text">
<p>Space (U+0020): Some formats and applications use space as a delimiter, e.g. for items in a list. Appendix C of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> also mentions that white space may have to be added when displaying or printing long URIs; the same applies to long IRIs. This means that spaces can disappear, or can make the Legacy Extended IRI to be interpreted as two or more separate IRIs.
</p>
<p>Delimiters "&lt;" (U+003C), "&gt;" (U+003E), and '"' (U+0022): Appendix C of <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> suggests the use of double-quotes ("http://example.com/") and angle brackets
   (&lt;http://example.com/&gt;) as delimiters for URIs in plain text. These conventions are often used, and also apply to IRIs. Legacy Extended IRIs using these characters will be cut off at the wrong place.
</p>
<p>Unwise characters "\" (U+005C),
    "^" (U+005E), "`" (U+0060), "{" (U+007B), "|" (U+007C), and "}" (U+007D): These characters originally have been excluded from URIs because the respective codepoints are assigned to different graphic characters in some 7-bit or 8-bit encoding. Despite the move to Unicode, some of these characters are still occasionally displayed differently on some systems, e.g. U+005C as a Japanese Yen symbol. Also, the fact that these characters are not used in URIs or IRIs has encouraged their use outside URIs or IRIs in contexts that may include URIs or IRIs. In case a Legacy Extended IRI with such a character is used in such a context, the Legacy Extended IRI will be interpreted piecemeal.
</p>
<p>The controls (C0 controls, DEL, and C1 controls, #x0  - #x1F  #x7F - #x9F): There is no way to transmit these characters reliably except potentially in electronic form. Even when in electronic form, some software components might silently filter out some of these characters,       or may stop processing alltogether when encountering some of them. These characters may affect text display in subtle, unnoticable ways or in drastic, global, and irreversible ways depending on the hardware and software involved. The use of some of these characters may allow malicious users to manipulate the display of a Legacy Extended IRI and its context.
</p>
<p>Bidi formatting characters (U+200E, U+200F, U+202A-202E): These characters affect the display ordering of characters. Displayed Legacy Extended IRIs containing these characters cannot be converted back to electronic form (logical order) unambiguously. These characters may allow malicious users to manipulate the display of a Legacy Extended IRI and its context.
</p>
<p>Specials (U+FFF0-FFFD): These code points provide functionality beyond that useful in a Legacy Extended IRI, for example byte order identification, annotation, and replacements for unknown characters and objects. Their use and interpretation in a Legacy Extended IRI serves no purpose and may lead to confusing display variations.
</p>
<p>Private use code points (U+E000-F8FF, U+F0000-FFFFD, U+100000-10FFFD): Display and interpretation of these code points is by definition undefined without private agreement. Therefore, these code points are not suited for use on the Internet. They are not interoperable and may have
  unpredictable effects.
</p>
<p>Tags (U+E0000-E0FFF): These characters provide a way to language tag in Unicode plain text. They are not appropriate for Legacy Extended IRIs because language information in identifiers cannot reliably be input, transmitted (e.g. on a visual medium such as paper), or recognized.
</p>
<p>Non-characters (U+FDD0-FDEF, U+1FFFE-1FFFF, U+2FFFE-2FFFF, U+3FFFE-3FFFF, U+4FFFE-4FFFF, U+5FFFE-5FFFF, U+6FFFE-6FFFF, U+7FFFE-7FFFF, U+8FFFE-8FFFF, U+9FFFE-9FFFF, U+AFFFE-AFFFF, U+BFFFE-BFFFF, U+CFFFE-CFFFF, U+DFFFE-DFFFF, U+EFFFE-EFFFF, U+FFFFE-FFFFF, U+10FFFE-10FFFF): These code points are defined as non-characters. Applications may use some of them internally, but are not prepared to interchange them.
</p>
</blockquote>

<p>For reference, we here also list the code points and code units not even allowed in Legacy Extended IRIs:</p>
<blockquote class="text">
<p>Surrogate code units (D800-DFFF): These do not represent Unicode codepoints.
</p>
</blockquote>

<a name="href"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
HyperText References</h3>

<p>((NOTE: This section is intended to integrate the specification of browser behavior originally written in the public working draft of the HTML5 specification http://www.w3.org/TR/html5/infrastructure.html#parsing-urls into this document. This definition is an initial draft.))
</p>
<p>A construct named <a class='info' href='#href'>Hypertext Reference<span> (</span><span class='info'>HyperText References</span><span>)</span></a> (HRef, sometimes called a "web address") describes the extension of IRIs as actually deployed in popular web browsers, for use in both HTML and in a JavaScript scripting interface.

The interpretation of a HRef is given as a modification of the mapping from a string of octets into a useful &lt;URI-reference&gt;. The mapping is an extension of the mapping from IRI to URI. 

The differences are:


</p>
<ul class="text">
<li>There is an additional parameter to the conversion, a character set used for encoding of the query component.
</li>
<li>Leading and trailing spaces are removed.
</li>
<li>Additional characters are escaped because of HRef parsing.
</li>
</ul><p>

</p>
<p>The HRef-charset is determined by the context. If the context does not supply a HRef-charset, then the HRef-charset is UTF-8. For web browsers interpreting HTML, it is determined as follows:
    </p>
<blockquote class="text"><dl>
<dt>If the HRef came from a script (e.g. as an argument to a method)</dt>
<dd>The HRef-charset is the script's character.
       encoding.
</dd>
<dt>If the HRef came from a DOM node (e.g. from an element)</dt>
<dd>The node has a Document, and the HRef-charset is the Document's character encoding.
</dd>
<dt>If the HRef had a character encoding defined when the HRef was created or defined</dt>
<dd>The HRef-charset is as defined.
</dd>
</dl></blockquote><p>

</p>
<p>The following steps define the mapping from an HRef into an URI-reference.
</p>
<ol class="text">
<li>Strip leading and trailing instances of the space (U+0020) character.
</li>
<li>  Apply the algorithm in <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>, mapping the result to a string of characters in the URI repertoire. 
</li>
<li> If the result begins with either of:
      
<ul class="text">
<li>a string matching the &lt;scheme&gt; production,
       followed by "://"
</li>
<li>the string "//"
</li>
</ul>
      then percent-encode any left or right square brackets
       (U+005B, U+005D, "[" and "]")
       following the first occurrence of "/",
       "?", or
       "#" which follows the
       first occurrence of "//".
</li>
<li>Otherwise, percent-encode all left and right square brackets.
</li>
<li>Percent-encode all occurrences of U+0023 (Number sign, "#")
       after the first.
</li>
<li>Parse the result using the production for URI-reference in 
       <a class='info' href='#RFC3986'>RFC 3986<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a> [RFC3986].
</li>
<li>If the result doesn't match 
       &lt;URI-reference&gt; production
       then perform no further action.
      
        Otherwise, parsing was successful.
       Parsing the encoded URI is needed to accomodate
       two changes to the IRI to URI mapping.
</li>
<li>If there is a &lt;scheme&gt; component and a &lt;port&gt; component and the port given by the &lt;port&gt; component is the same as the default port defined for the protocol given by
	 the &lt;scheme&gt; component, then replace the &lt;hostport&gt; in the
         parsed result with the &lt;host&gt; component. (NOTE: Is this step necessary? Well-defined? Only used for HTTP?)
</li>
<li>If the HRef-charset is UTF-8, or if there is no query component, or if the query component contains no percent-encodings, no further processing is necessary. However, if the HRef-charset is not UTF-8 and there is a query component in the parsed results, then the query string is translated into the HRef-charset before percent-encoding. This can be accomplished as:
          
<ol class="text">
<li>Decode any hex-encoded components of the portion of the URI matching the &lt;query&gt; production (which will yield a UTF-8 encoded sequence of characters.)
</li>
<li>Decode the UTF-8 encoding to create a sequence of (abstract) characters.
</li>
<li>Encode the resulting character sequence into a sequence of octets
              as specified by the HRef-charset; any characters which cannot be expressed
              in HRef-charset should be replaced with an (ASCII) '?'. 
</li>
<li>Percent-encode the resulting set of octets.
</li>
</ol> 
        
</li>
</ol><p>

</p>
<a name="guidelines"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
URI/IRI Processing Guidelines (Informative)</h3>

<p>This informative section provides guidelines for supporting IRIs
in the same software components and operations that currently process
URIs: Software interfaces that handle URIs, software that allows users
to enter URIs, software that creates or generates URIs, software that displays
URIs, formats and protocols that transport URIs, and software that
interprets URIs. These may all require modification before
functioning properly with IRIs. The considerations in this section
also apply to URI references and IRI references.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
URI/IRI Software Interfaces</h3>

<p>Software interfaces that handle URIs, such as URI-handling APIs and
protocols transferring URIs, need interfaces and protocol elements
that are designed to carry IRIs.
</p>
<p>In case the current handling in an API or protocol is based on
US-ASCII, UTF-8 is recommended as the character encoding for IRIs,
as it is compatible with US-ASCII, is in accordance with the
recommendations of <a class='info' href='#RFC2277'>[RFC2277]<span> (</span><span class='info'>Alvestrand, H., &ldquo;IETF Policy on Character Sets and Languages,&rdquo; January&nbsp;1998.</span><span>)</span></a>, and makes converting to URIs easy. In any case, the API or protocol
definition must clearly define the character encoding to be used.
</p>
<p>The transfer from URI-only to IRI-capable components requires no
mapping, although the conversion described in <a class='info' href='#URItoIRI'>Section&nbsp;3.2<span> (</span><span class='info'>Converting URIs to IRIs</span><span>)</span></a> above may be
performed. It is preferable not to perform this inverse conversion
when there is a chance that this cannot be done correctly.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
URI/IRI Entry</h3>

<p>Some components allow users to enter URIs into the system
by typing or dictation, for example. This software must be updated to allow
for IRI entry.
</p>
<p>A person viewing a visual representation of an IRI (as a sequence of
glyphs, in some order, in some visual display) or hearing an IRI
will use an entry method for characters in the user's language to input
the IRI. Depending on the script and the input method used, this may
be a more or less complicated process.
</p>
<p>The process of IRI entry must ensure, as much as possible, that the
restrictions defined in <a class='info' href='#abnf'>Section&nbsp;2.2<span> (</span><span class='info'>ABNF for IRI References and IRIs</span><span>)</span></a> are met. This may be done by
choosing appropriate input methods or variants/settings thereof, by
appropriately converting the characters being input, by eliminating
characters that cannot be converted, and/or by issuing a warning or
error message to the user.
</p>
<p>As an example of variant settings, input method editors for East
Asian Languages usually allow the input of Latin letters and related
characters in full-width or half-width versions. For IRI input, the
input method editor should be set so that it produces half-width
Latin letters and punctuation and full-width Katakana.
</p>
<p>An input field primarily or solely used for the input of URIs/IRIs
may allow the user to view an IRI as it is  mapped to a URI.  Places
where the input of IRIs is frequent may provide the possibility for
viewing an IRI as mapped to a URI. This will help users when some
of the software they use does not yet accept IRIs.
</p>
<p>An IRI input component interfacing to components that handle URIs,
but not IRIs, must map the IRI to a URI before passing it to these
components.
</p>
<p>For the input of IRIs with right-to-left characters, please see
<a class='info' href='#bidiInput'>Section&nbsp;4.3<span> (</span><span class='info'>Input of Bidi IRIs</span><span>)</span></a>.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
URI/IRI Transfer between Applications</h3>

<p>Many applications, particularly mail user agents, try to detect
URIs appearing in plain text. For this, they use some heuristics based
on URI syntax. They then allow the user to click on such
URIs and retrieve the corresponding resource in an appropriate (usually
scheme-dependent) application.
</p>
<p>Such applications have to be upgraded to use the IRI syntax as a base for heuristics. In particular, a non-ASCII
character should not be taken as the indication of the end of an IRI.
Such applications also have to make sure that they correctly convert the
detected IRI from the character encoding of the document or application where
the IRI appears to the character encoding used by the system-wide IRI invocation
mechanism, or to a URI (according to <a class='info' href='#mapping'>Section&nbsp;3.1<span> (</span><span class='info'>Mapping of IRIs to URIs</span><span>)</span></a>) if
the system-wide invocation mechanism only accepts URIs.
</p>
<p>The clipboard is another frequently used way to transfer URIs and
IRIs from one application to another. On most platforms, the clipboard
is able to store and transfer text in many languages and scripts.
Correctly used, the clipboard transfers characters, not bytes,
which will do the right thing with IRIs.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
URI/IRI Generation</h3>

<p>Systems that offer resources through the Internet, where those
resources have logical names, sometimes automatically generate URIs
for the resources they offer. For example, some HTTP servers can
generate a directory listing for a file directory
and then respond to the generated URIs with the files.
</p>
<p>Many legacy character encodings are in use in various file systems.
Many currently deployed systems do not transform the local character
representation of the underlying system before generating URIs.
</p>
<p>For maximum interoperability, systems that generate resource
identifiers should make the appropriate transformations. For example,
if a file system contains a file named "r&amp;#xE9;sum&amp;#xE9;.html",
a server should expose this as "r%C3%A9sum%C3%A9.html" in a URI, which
allows use of "r&amp;#xE9;sum&amp;#xE9;.html" in an IRI,
even if  locally the file name is kept in a character
encoding other than UTF-8.

</p>
<p>This recommendation particularly applies to HTTP servers. For FTP
servers, similar considerations apply; see <a class='info' href='#RFC2640'>[RFC2640]<span> (</span><span class='info'>Curtin, B., &ldquo;Internationalization of the File Transfer Protocol,&rdquo; July&nbsp;1999.</span><span>)</span></a>.
</p>
<a name="selection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
URI/IRI Selection</h3>

<p>In some cases, resource owners and publishers have control over the
IRIs used to identify their resources. This control is mostly
executed by controlling the resource names, such as file names,
directly.
</p>
<p>In these cases, it is recommended to avoid choosing IRIs that are
easily confused. For example, for US-ASCII, the lower-case ell ("l") is
easily confused with the digit one ("1"), and the upper-case oh ("O") is
easily confused with the digit zero ("0"). Publishers should avoid
confusing users with "br0ken" or "1ame" identifiers.
</p>
<p>Outside the US-ASCII repertoire, there are many more opportunities for
confusion; a complete set of guidelines is too lengthy to include
here. As long as names are limited to characters from a single script,
native writers of a given script or language will know best when
ambiguities can appear, and how they can be avoided. What may look
ambiguous to a stranger may be completely obvious to the average
native user. On the other hand, in some cases, the UCS contains
variants for compatibility reasons; for example, for typographic purposes.
These should be avoided wherever possible. Although there may be exceptions,
newly created resource names should generally be in NFKC
<a class='info' href='#UTR15'>[UTR15]<span> (</span><span class='info'>Davis, M. and M. Duerst, &ldquo;Unicode Normalization Forms,&rdquo; March&nbsp;2008.</span><span>)</span></a> (which means that they are also in NFC).
</p>
<p>As an example, the UCS contains the "fi" ligature at U+FB01
for compatibility reasons.
Wherever possible, IRIs should use the two letters "f" and "i" rather
than the "fi" ligature. An example where the latter may be used is
in the query part of an IRI for an explicit search for a word written
containing the "fi" ligature.
</p>
<p>In certain cases, there is a chance that characters from different
scripts look the same. The best known example is the similarity of the Latin "A", the
Greek "Alpha", and the Cyrillic "A". To avoid such cases, only IRIs
should be created where all the characters in a single component are
used together in a given language. This usually means that all of these
characters will be from the same script, but there are languages that
mix characters from different scripts (such as Japanese).
This is similar to the heuristics used to distinguish between
letters and numbers in the examples above. Also, for Latin, Greek,
and Cyrillic, using lowercase letters results in fewer ambiguities
than using uppercase letters would.
</p>
<a name="display"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Display of URIs/IRIs</h3>

<p>
In situations where the rendering software is not expected to display
non-ASCII parts of the IRI correctly using the available layout and font
resources, these parts should be percent-encoded before being displayed.
</p>
<p>For display of Bidi IRIs, please see <a class='info' href='#visual'>Section&nbsp;4.1<span> (</span><span class='info'>Logical Storage and Visual Presentation</span><span>)</span></a>.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
Interpretation of URIs and IRIs</h3>

<p>Software that interprets IRIs as the names of local resources should
accept IRIs in multiple forms and convert and match them with the
appropriate local resource names.
</p>
<p>First, multiple representations include both IRIs in the native
character encoding of the protocol and also their URI counterparts.
</p>
<p>Second, it may include URIs constructed based on character
encodings other than UTF-8. These URIs may be produced by user agents that do
not conform to this specification and that use legacy character encodings to
convert non-ASCII characters to URIs. Whether this is necessary, and what
character encodings to cover, depends on a number of factors, such as
the legacy character encodings used locally and the distribution of
various versions of user agents. For example, software for Japanese
may accept URIs in Shift_JIS and/or EUC-JP in addition to UTF-8.
</p>
<p>Third, it may include additional mappings to be more user-friendly and
robust against transmission errors. These would be similar to how
some servers currently treat URIs as case insensitive or perform
additional matching to account for spelling errors. For characters
beyond the US-ASCII repertoire, this may, for example, include ignoring the
accents on received IRIs or resource names. Please
note that such mappings, including case mappings, are
language dependent.
</p>
<p>It can be difficult to identify a resource unambiguously if too
many mappings are taken into consideration. However, percent-encoded
and not percent-encoded parts of IRIs can always be clearly distinguished.
Also, the regularity of UTF-8 (see <a class='info' href='#Duerst97'>[Duerst97]<span> (</span><span class='info'>Duerst, M., &ldquo;The Properties and Promises of UTF-8,&rdquo; September&nbsp;1997.</span><span>)</span></a>) makes the
potential for collisions lower than it may seem at first.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.8"></a><h3>8.8.&nbsp;
Upgrading Strategy</h3>

<p>Where this recommendation places further constraints on software
for which many instances are already deployed, it is important to
introduce upgrades carefully and to be aware of the various
interdependencies.
</p>
<p>If IRIs cannot be interpreted correctly, they should not be created,
generated, or transported. This suggests that upgrading URI interpreting
software to accept IRIs should have highest priority.
</p>
<p>On the other hand, a single IRI is interpreted only by a single or
very few interpreters that are known in advance, although it may be
entered and transported very widely.
</p>
<p>Therefore, IRIs benefit most from a broad upgrade of software to be
able to enter and transport IRIs. However, before an
individual IRI is published, care should be taken to upgrade the corresponding
interpreting software in order to cover the forms expected to be
received by various versions of entry and transport software.
</p>
<p>The upgrade of generating software to generate IRIs instead of using a
local character encoding should happen only after the service is upgraded
to accept IRIs. Similarly, IRIs should only be generated when the service
accepts IRIs and the intervening infrastructure and protocol is known
to transport them safely.
</p>
<p>Software converting from URIs to IRIs for display should be upgraded
only after upgraded entry software has been widely deployed to the
population that will see the displayed result.
</p>
<p>Where there is
a free choice of character encodings, it is often possible to reduce the effort and dependencies for upgrading
to IRIs by using UTF-8 rather than another encoding. For example, when a
new file-based Web server is set up, using UTF-8 as the character encoding for file
names will make the transition to IRIs easier. Likewise, when a
new Web form is set up using UTF-8 as the character encoding of the form page, the
returned query URIs will use UTF-8 as the character encoding (unless the user,
for whatever reason, changes the character encoding) and will therefore be
compatible with IRIs.
</p>
<p>These recommendations, when taken together, will allow for the
extension from URIs to IRIs in order to handle characters other than
US-ASCII while minimizing interoperability problems. For considerations
regarding the upgrade of URI scheme definitions, see <a class='info' href='#UTF8use'>Section&nbsp;6.4<span> (</span><span class='info'>Use of UTF-8 for Encoding Original Characters</span><span>)</span></a>.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>Note to the RFC Editor: Please remove this section before publication.
</p>
<p>This document does not require any actions by IANA.
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>The security considerations discussed in <a class='info' href='#RFC3986'>[RFC3986]<span> (</span><span class='info'>Berners-Lee, T., Fielding, R., and L. Masinter, &ldquo;Uniform Resource Identifier (URI): Generic Syntax,&rdquo; January&nbsp;2005.</span><span>)</span></a>
also apply to IRIs. In addition, the following issues require
particular care for IRIs.
</p>
<p>Incorrect encoding or decoding can lead to security problems.
In particular, some UTF-8 decoders do not check against overlong
byte sequences. As an example, a "/" is encoded with the byte 0x2F
both in UTF-8 and in US-ASCII, but some UTF-8 decoders also wrongly
interpret the sequence 0xC0 0xAF as a "/". A sequence such as "%C0%AF.."
may pass some security tests and then be interpreted
as "/.." in a path if UTF-8 decoders are fault-tolerant, if conversion
and checking are not done in the right order, and/or if reserved
characters and unreserved characters are not clearly distinguished.
</p>
<p>There are various ways in which "spoofing" can occur with IRIs.
"Spoofing" means that somebody may add a resource name that looks the
same or similar to the user, but that points to a different resource.
The added resource may pretend to be the real resource by looking
very similar but may contain all kinds of changes that may be
difficult to spot and that can cause all kinds of problems.
Most spoofing possibilities for IRIs are extensions of those for URIs.
</p>
<p>Spoofing can occur for various reasons. First, a user's normalization expectations or actual normalization
when entering an IRI or  transcoding an IRI from a legacy character
encoding do not match the normalization used on the
server side. Conceptually, this is no different from the problems
surrounding the use of case-insensitive web servers. For example,
a popular web page with a mixed-case name ("http://big.example.com/PopularPage.html")
might be "spoofed" by someone who is able to create "http://big.example.com/popularpage.html".
However, the use of unnormalized character sequences, and of additional
mappings for user convenience, may increase the chance for spoofing.
Protocols and servers that allow the creation of resources with
names that are not normalized are particularly vulnerable to such
attacks. This is an inherent
security problem of the relevant protocol, server, or resource
and is not specific to IRIs, but it is mentioned here for completeness.
</p>
<p>Spoofing can occur in various IRI components, such as the
domain name part or a path part. For considerations specific
to the domain name part, see <a class='info' href='#RFC3491'>[RFC3491]<span> (</span><span class='info'>Hoffman, P. and M. Blanchet, &ldquo;Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN),&rdquo; March&nbsp;2003.</span><span>)</span></a>.
For the path part, administrators of sites that allow independent
users to create resources in the same sub area may have to be careful
to check for spoofing.
</p>
<p>Spoofing can occur because in the UCS many characters look very similar. Details are discussed in <a class='info' href='#selection'>Section&nbsp;8.5<span> (</span><span class='info'>URI/IRI Selection</span><span>)</span></a>.
Again, this is very similar to spoofing possibilities on US-ASCII,
e.g., using "br0ken" or "1ame" URIs.
</p>
<p>Spoofing can occur when URIs with percent-encodings based on various
character encodings are accepted to deal with older user agents. In some
cases, particularly for Latin-based resource names, this is usually easy to
detect because UTF-8-encoded names, when interpreted and viewed as
legacy character encodings, produce mostly garbage.
</p>
<p>When
concurrently used character encodings have a similar structure but there
are no characters that have exactly the same encoding, detection is more
difficult.
</p>
<p>Spoofing can occur with bidirectional IRIs, if the restrictions
in <a class='info' href='#bidi-structure'>Section&nbsp;4.2<span> (</span><span class='info'>Bidi IRI Structure</span><span>)</span></a> are not followed. The same visual
representation may be interpreted as different logical representations,
and vice versa. It is also very important that a correct Unicode bidirectional
implementation be used.
</p>
<p>The use of Legacy Extended IRIs introduces additional security issues.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>For contributions to this update, we would like to thank Ian Hickson, Michael Sperberg-McQueen, Dan Connolly, Norman Walsh, Richard Tobin, Henry S. Thomson, and the XML Core Working Group of the W3C.
</p>
<p>The discussion on the issue addressed here started a long time
ago. There was a thread in the HTML working
group in August 1995 (under the topic of "Globalizing URIs") and in the
www-international mailing list in July 1996 (under the topic of
"Internationalization and URLs"), and there were ad-hoc meetings at the Unicode
conferences in September 1995 and September 1997.
</p>
<p>For contributions to the previous version of this document, RFC 3987, many thanks go to Francois Yergeau, Matitiahu Allouche,
Roy Fielding, Tim Berners-Lee, Mark Davis,
M.T. Carrasco Benitez, James Clark, Tim Bray, Chris Wendt, Yaron Goland,
Andrea Vine, Misha Wolf, Leslie Daigle, Ted Hardie, Bill Fenner, Margaret Wasserman,
Russ Housley, Makoto MURATA, Steven Atkin,
Ryan Stansifer, Tex Texin, Graham Klyne, Bjoern Hoehrmann, Chris Lilley, Ian Jacobs,
Adam Costello, Dan Oscarson, Elliotte Rusty Harold, Mike J. Brown,
Roy Badami, Jonathan Rosenne, Asmus Freytag, Simon Josefsson, Carlos Viegas Damasio,
Chris Haynes, Walter Underwood, and many others.
</p>
<p>The definition of HyperText Reference was initially produced by Ian Hixson, and further edited by Dan Connolly and C. M. Spergerg-McQueen.
</p>
<p>This document is a product of the Internationalization Working
Group (I18N WG) of the World Wide Web Consortium (W3C).
Thanks to the members of the W3C
I18N Working Group and Interest Group for their contributions and their
work on <a class='info' href='#CharMod'>[CharMod]<span> (</span><span class='info'>Duerst, M., Yergeau, F., Ishida, R., Wolf, M., and T. Texin, &ldquo;Character Model for the World Wide Web: Resource Identifiers,&rdquo; November&nbsp;2004.</span><span>)</span></a>. Thanks also go
to the members of many other W3C Working Groups for adopting IRIs, and to
the members of the Montreal IAB Workshop on Internationalization and
Localization for their review.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Change Log</h3>

<p>Note to RFC Editor: Please completely remove this section before publication.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Changes from -05 to -06</h3>

<p></p>
<ul class="text">
<li>Add HyperText Reference, change abstract, acks and references for it
</li>
<li>Add Masinter back as another editor.
</li>
<li>Masinter integrates HRef material from HTML5 spec.
</li>
<li>Rewrite introduction sections to modernize.
</li>
</ul>

<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Changes from -04 to -05</h3>

<p></p>
<ul class="text">
<li>Updated references.
</li>
<li>Changed IPR text to pre5378Trust200902.
</li>
</ul>

<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Changes from -03 to -04</h3>

<p></p>
<ul class="text">
<li>Added explicit abbreviation for LEIRIs.
</li>
<li>Mentioned LEIRI references.
</li>
<li>Completed text in LEIRI section about tag characters and about specials.
</li>
</ul>

<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Changes from -02 to -03</h3>

<p></p>
<ul class="text">
<li>Updated some references.
</li>
<li>Updated Michel Suginard's coordinates.
</li>
</ul>

<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
Changes from -01 to -02</h3>

<p></p>
<ul class="text">
<li>Added tag range to iprivate (issue private-include-tags-115).
</li>
<li>Added Specials (U+FFF0-FFFD) to Legacy Extended IRIs.
</li>
</ul>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.6"></a><h3>12.6.&nbsp;
Changes from -00 to -01</h3>

<p></p>
<ul class="text">
<li>Changed from "IRIs with Spaces/Controls" to "Legacy Extended IRI" based on input from the W3C XML Core WG. Moved the relevant subsections to the back and promoted them to a section.
</li>
<li>Added some text re. Legacy Extended IRIs to the security section.
</li>
<li>Added a IANA Consideration Section.
</li>
<li>Added this Change Log Section.
</li>
<li>Added a section about "IRIs with Spaces/Controls" (converting from a Note in RFC 3987).
</li>
</ul>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.7"></a><h3>12.7.&nbsp;
Changes from RFC 3987 to -00</h3>

<p></p>
<blockquote class="text">
<p>Fixed errata (see http://www.rfc-editor.org/cgi-bin/errataSearch.pl?rfc=3987).
</p>
</blockquote>

<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="ASCII">[ASCII]</a></td>
<td class="author-text">American National Standards Institute, &ldquo;Coded Character Set -- 7-bit American Standard Code for Information
Interchange,&rdquo; ANSI&nbsp;X3.4, 1986.</td></tr>
<tr><td class="author-text" valign="top"><a name="ISO10646">[ISO10646]</a></td>
<td class="author-text">International Organization for Standardization, &ldquo;ISO/IEC 10646:2003: Information Technology -
Universal Multiple-Octet Coded Character Set (UCS),&rdquo; ISO&nbsp;Standard 10646, December&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3490">[RFC3490]</a></td>
<td class="author-text">Faltstrom, P., Hoffman, P., and A. Costello, &ldquo;<a href="http://tools.ietf.org/html/rfc3490">Internationalizing Domain Names in Applications (IDNA)</a>,&rdquo; RFC&nbsp;3490, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3490.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3491">[RFC3491]</a></td>
<td class="author-text">Hoffman, P. and M. Blanchet, &ldquo;<a href="http://tools.ietf.org/html/rfc3491">Nameprep: A Stringprep Profile for Internationalized Domain Names (IDN)</a>,&rdquo; RFC&nbsp;3491, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3491.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3629">[RFC3629]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3986">[RFC3986]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com">Fielding, R.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>,&rdquo; STD&nbsp;66, RFC&nbsp;3986, January&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3986.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3986.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3986.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="STD68">[STD68]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="UNI9">[UNI9]</a></td>
<td class="author-text">Davis, M., &ldquo;<a href="http://www.unicode.org/reports/tr9/tr9-13.html">The Bidirectional Algorithm</a>,&rdquo; Unicode Standard Annex&nbsp;#9, March&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="UNIV4">[UNIV4]</a></td>
<td class="author-text">The Unicode Consortium, &ldquo;The Unicode Standard, Version 5.1.0, defined by: The Unicode Standard,
Version 5.0 (Boston, MA, Addison-Wesley, 2007. ISBN 0-321-48091-0),
as amended by Unicode 4.1.0 (http://www.unicode.org/versions/Unicode5.1.0/),&rdquo; April&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="UTR15">[UTR15]</a></td>
<td class="author-text">Davis, M. and M. Duerst, &ldquo;<a href="http://www.unicode.org/unicode/reports/tr15/tr15-23.html">Unicode Normalization Forms</a>,&rdquo; Unicode Standard Annex&nbsp;#15, March&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="BidiEx">[BidiEx]</a></td>
<td class="author-text">&ldquo;<a href="http://www.w3.org/International/iri-edit/BidiExamples">Examples of bidirectional IRIs</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="CharMod">[CharMod]</a></td>
<td class="author-text">Duerst, M., Yergeau, F., Ishida, R., Wolf, M., and T. Texin, &ldquo;<a href="http://www.w3.org/TR/charmod-resid">Character Model for the World Wide Web: Resource Identifiers</a>,&rdquo; World Wide Web Consortium&nbsp;Candidate Recommendation, November&nbsp;2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="Duerst97">[Duerst97]</a></td>
<td class="author-text">Duerst, M., &ldquo;<a href="http://www.ifi.unizh.ch/mml/mduerst/papers/PDF/IUC11-UTF-8.pdf">The Properties and Promises of UTF-8</a>,&rdquo; Proc. 11th International Unicode Conference, San Jose&nbsp;, September&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="Gettys">[Gettys]</a></td>
<td class="author-text">Gettys, J., &ldquo;<a href="http://www.w3.org/DesignIssues/ModelConsequences">URI Model Consequences</a>.&rdquo;</td></tr>
<tr><td class="author-text" valign="top"><a name="HTML4">[HTML4]</a></td>
<td class="author-text">Raggett, D., Le Hors, A., and I. Jacobs, &ldquo;<a href="http://www.w3.org/TR/html401/appendix/notes.html#h-B.2">HTML 4.01 Specification</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, December&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="HTML5">[HTML5]</a></td>
<td class="author-text">Hickson, I. and D. Hyatt, &ldquo;<a href="http://www.w3.org/TR/2009/WD-html5-20090423/">A vocabulary and associated APIs for HTML and XHTML</a>,&rdquo; World Wide Web Consortium&nbsp;Working Draft, April&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="LEIRI">[LEIRI]</a></td>
<td class="author-text">Thompson, H., Tobin, R., and N. Walsh, &ldquo;<a href="http://www.w3.org/TR/leiri/">Legacy extended IRIs for XML resource identification</a>,&rdquo; World Wide Web Consortium&nbsp;Note.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2130">[RFC2130]</a></td>
<td class="author-text"><a href="mailto:cweider@microsoft.com">Weider, C.</a>, <a href="mailto:cecilia@well.com">Preston, C.</a>, <a href="mailto:Keld@dkuug.dk">Simonsen, K.</a>, <a href="mailto:Harald.T.Alvestrand@uninett.no">Alvestrand, H.</a>, <a href="mailto:rja@cisco.com">Atkinson, R.</a>, <a href="mailto:mrc@cac.washington.edu">Crispin, M.</a>, and <a href="mailto:psv@nada.kth.se">P. Svanberg</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2130">The Report of the IAB Character Set Workshop held 29 February - 1 March, 1996</a>,&rdquo; RFC&nbsp;2130, April&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2130.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2130.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2130.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2141">[RFC2141]</a></td>
<td class="author-text"><a href="mailto:jayhawk@ds.internic.net">Moats, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2141">URN Syntax</a>,&rdquo; RFC&nbsp;2141, May&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2141.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2141.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2141.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2192">[RFC2192]</a></td>
<td class="author-text"><a href="mailto:chris.newman@innosoft.com">Newman, C.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2192">IMAP URL Scheme</a>,&rdquo; RFC&nbsp;2192, September&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2192.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2192.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2192.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2277">[RFC2277]</a></td>
<td class="author-text"><a href="mailto:Harald.T.Alvestrand@uninett.no">Alvestrand, H.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2277">IETF Policy on Character Sets and Languages</a>,&rdquo; BCP&nbsp;18, RFC&nbsp;2277, January&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2277.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2277.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2277.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2368">[RFC2368]</a></td>
<td class="author-text"><a href="mailto:phoffman@imc.org">Hoffman, P.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, and <a href="mailto:jwz@netscape.com">J. Zawinski</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2368">The mailto URL scheme</a>,&rdquo; RFC&nbsp;2368, July&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2368.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2368.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2368.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2384">[RFC2384]</a></td>
<td class="author-text"><a href="mailto:Randy@Qualcomm.Com">Gellens, R.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2384">POP URL Scheme</a>,&rdquo; RFC&nbsp;2384, August&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2384.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2384.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2384.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2396">[RFC2396]</a></td>
<td class="author-text"><a href="mailto:timbl@w3.org">Berners-Lee, T.</a>, <a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, and <a href="mailto:masinter@parc.xerox.com">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2396">Uniform Resource Identifiers (URI): Generic Syntax</a>,&rdquo; RFC&nbsp;2396, August&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2396.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2396.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2396.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2397">[RFC2397]</a></td>
<td class="author-text"><a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2397">The &quot;data&quot; URL scheme</a>,&rdquo; RFC&nbsp;2397, August&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2397.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2397.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2397.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2616.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc2616.pdf">PDF</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2616.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2616.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2640">[RFC2640]</a></td>
<td class="author-text"><a href="mailto:curtinw@ftm.disa.mil">Curtin, B.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2640">Internationalization of the File Transfer Protocol</a>,&rdquo; RFC&nbsp;2640, July&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2640.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2718">[RFC2718]</a></td>
<td class="author-text"><a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:harald.alvestrand@maxware.no">Alvestrand, H.</a>, <a href="mailto:djz@corp.webtv.net">Zigmond, D.</a>, and <a href="mailto:rpetke@wcom.net">R. Petke</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2718">Guidelines for new URL Schemes</a>,&rdquo; RFC&nbsp;2718, November&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2718.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2718.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2718.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="UNIXML">[UNIXML]</a></td>
<td class="author-text">Duerst, M. and A. Freytag, &ldquo;<a href="http://www.w3.org/TR/unicode-xml/">Unicode in XML and other Markup Languages</a>,&rdquo; Unicode Technical Report&nbsp;#20, World Wide Web Consortium&nbsp;Note, June&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="XLink">[XLink]</a></td>
<td class="author-text">DeRose, S., Maler, E., and D. Orchard, &ldquo;<a href="http://www.w3.org/TR/xlink/#link-locators">XML Linking Language (XLink) Version 1.0</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, June&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="XML1">[XML1]</a></td>
<td class="author-text">Bray, T., Paoli, J., Sperberg-McQueen, C., Maler, E., and F. Yergeau, &ldquo;<a href="http://www.w3.org/TR/REC-xml">Extensible Markup Language (XML) 1.0 (Forth Edition)</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, August&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMLNamespace">[XMLNamespace]</a></td>
<td class="author-text">Bray, T., Hollander, D., Layman, A., and R. Tobin, &ldquo;<a href="http://www.w3.org/TR/REC-xml-names">Namespaces in XML (Second Edition)</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, August&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="XMLSchema">[XMLSchema]</a></td>
<td class="author-text">Biron, P. and A. Malhotra, &ldquo;<a href="http://www.w3.org/TR/xmlschema-2/#anyURI">XML Schema Part 2: Datatypes</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, May&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="XPointer">[XPointer]</a></td>
<td class="author-text">Grosso, P., Maler, E., Marsh, J., and N. Walsh, &ldquo;<a href="http://www.w3.org/TR/xptr-framework/#escaping">XPointer Framework</a>,&rdquo; World Wide Web Consortium&nbsp;Recommendation, March&nbsp;2003.</td></tr>
</table>

<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Design Alternatives</h3>

<p>This section shortly summarizes major design alternatives
and the reasons for why they were not chosen.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
New Scheme(s)</h3>

<p>Introducing new schemes (for example, httpi:, ftpi:,...) or a
new metascheme (e.g., i:, leading to URI/IRI prefixes such as
i:http:, i:ftp:,...) was proposed to make IRI-to-URI conversion
scheme dependent or to distinguish between percent-encodings
resulting from IRI-to-URI conversion and percent-encodings from
legacy character encodings.
</p>
<p>New schemes are not needed to distinguish URIs from true IRIs (i.e.,
  IRIs that contain non-ASCII characters). The benefit of being able
  to detect the origin of percent-encodings is marginal, as UTF-8
  can be detected with very high reliability. Deploying new schemes is
  extremely hard, so not requiring new schemes for IRIs makes
  deployment of IRIs vastly easier. Making conversion scheme dependent
  is highly inadvisable and would be encouraged by separate schemes for IRIs.
  Using a uniform convention for conversion from IRIs to URIs makes
  IRI implementation orthogonal to the introduction of actual new
  schemes.
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Character Encodings Other Than UTF-8</h3>

<p>At an early stage, UTF-7 was considered as an alternative to
UTF-8 when IRIs are converted to URIs. UTF-7 would not have needed
percent-encoding and  in most cases would have been shorter than
percent-encoded UTF-8.
</p>
<p>Using UTF-8 avoids a double layering and overloading of the use of
   the "+" character. UTF-8 is fully compatible with US-ASCII and has
   therefore been recommended by the IETF, and is being used widely.
</p>
<p>UTF-7 has never been used much and is now clearly being
   discouraged. Requiring implementations to convert from UTF-8
   to UTF-7 and back would be an additional implementation burden.
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
New Encoding Convention</h3>

<p>Instead of using the existing percent-encoding convention
of URIs, which is based on octets, the idea was to create a new
encoding convention; for example, to use "%u" to introduce
UCS code points.
</p>
<p>Using the existing octet-based percent-encoding mechanism
does not need an upgrade of the URI syntax and does not
need corresponding server upgrades.
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Indicating Character Encodings in the URI/IRI</h3>

<p>Some proposals suggested indicating the character encodings used
in an URI or IRI with some new syntactic convention in the URI itself,
similar to the "charset" parameter for e-mails and Web pages.
As an example, the label in square brackets in
"http://www.example.org/ros[iso-8859-1]&amp;#xE9;" indicated that
the following "&amp;#xE9;" had to be interpreted as iso-8859-1.
</p>
<p>If UTF-8 is used exclusively, an upgrade to the URI syntax is not needed.
It avoids potentially multiple labels that have to be copied correctly
in all cases, even on the side of a bus or on a napkin, leading to
usability problems (and being prohibitively annoying).
Exclusively using UTF-8 also reduces transcoding errors and confusion.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Martin Duerst (Note: Please write "Duerst" with u-umlaut wherever possible, for example as "D&amp;#252;rst" in XML and HTML.)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Aoyama Gakuin University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5-10-1 Fuchinobe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sagamihara, Kanagawa  229-8558</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 42 759 6329</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+81 42 759 6495</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mailto:duerst@it.aoyama.ac.jp">mailto:duerst@it.aoyama.ac.jp</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.sw.it.aoyama.ac.jp/D%C3%BCrst/ (Note: This is the percent-encoded form of an IRI.)">http://www.sw.it.aoyama.ac.jp/D%C3%BCrst/ (Note: This is the percent-encoded form of an IRI.)</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Michel Suignard</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Unicode Consortium</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 391476</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mountain View, CA  94039-1476</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">U.S.A.</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-650-693-3921</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mailto:michel@unicode.org">mailto:michel@unicode.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.suignard.com">http://www.suignard.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Larry Masinter</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adobe</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">345 Park Ave</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">San Jose, CA  95110</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">U.S.A.</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-408-536-3024</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mailto:masinter@adobe.com">mailto:masinter@adobe.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://larry.masinter.net">http://larry.masinter.net</a></td></tr>
</table>
</body></html>
