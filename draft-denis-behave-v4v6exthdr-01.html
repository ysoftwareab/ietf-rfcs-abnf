<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IPv6 destination header option for
      IPv4 translator mapping notification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IPv6 destination header option for
      IPv4 translator mapping notification">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Behavior Engineering for Hindrance</td><td class="header">R. Denis-Courmont</td></tr>
<tr><td class="header">Avoidance</td><td class="header">Nokia</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">March 09, 2009</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: September 10, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />IPv6 destination header option for
      IPv4 translator mapping notification<br />draft-denis-behave-v4v6exthdr-01</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p> This memo defines a new IPv6 Destination header option
        to convey the transport mapping information
        from an IPv4-IPv4 protocol translator
        to the IPv6 end of a protocol-translated packet flow.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#defs">2.</a>&nbsp;
Definitions<br />
<a href="#anchor2">3.</a>&nbsp;
IPv4-IPv6 Translation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Inserting the flow mapping option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.1.</a>&nbsp;
Usage with connection-oriented protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.1.2.</a>&nbsp;
Usage with other protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.2.</a>&nbsp;
Receiving the flow mapping option<br />
<a href="#anchor10">4.</a>&nbsp;
Option format<br />
<a href="#unsaf">5.</a>&nbsp;
UNSAF Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.1.</a>&nbsp;
Exit strategy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.2.</a>&nbsp;
Interactions with legacy NATs<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
<a href="#iana">7.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor13">8.</a>&nbsp;
API Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> To overcome the shortage of IPv4 addresses within the Internet,
        Network Address and Port Translators (NATs) have been widely deployed,
        such that multiple IPv4 nodes can share a single IPv4 address.
        However, that method is known to break certain application protocols,
        which need to know their own assigned external IP address
        and/or port number (i.e. the transport address).
        New solutions are now under consideration which would extend
        NAT mechanisms such that IPv6 nodes could access the IPv4 Internet.
      
</p>
<p> This memo proposes an in-band method for such a IPv6-IPv4 NAT
        to notify affected IPv6 applications of the IPv4 transport address
        associated with any of their active communication flows.
        A new option for the IPv6 Destination extension header,
        the Translated Flow Mapping option
        is hereby defined to carry this information.
      
</p>
<a name="defs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Definitions</h3>

<p> TBD.
      
</p>
<p> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
        this document are to be interpreted as described in
        <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IPv4-IPv6 Translation</h3>

<p> An IPv4-IPv6 NAT performs two separate functions:
        </p>
<ul class="text">
<li> It receives IPv4 packets on its IPv4 interface,
            translates them to IPv6.
            To that end, for each IPv4 packet,
            it crafts a new IPv6 header to replace the IPv4 header,
            may modify the inner transport protocol header.
            Then, it sends the resulting translated IPv6 packets
            through its IPv6 interface.
          
</li>
<li> Reciprocally, it translates IPv6 packets into IPv4 packets.
          
</li>
</ul><p>
        The details of IPv4-IPv6 translation
        are beyond the scope of this document,
        please refer to [whatever IETF ends up specifying for this] instead.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Inserting the flow mapping option</h3>

<p> When a translator receives an IPv4 packet,
          following certain conditions,
          it inserts an IPv6 Destination extension header
          containing a Translated Flow Mapping option
          (as defined in the next section).
        
</p>
<p> As a general rule, this option MUST NOT be inserted,
          if the resulting packet would exceed the known MTU
          to the IPv6 destination, or 1280 bytes if there is no known MTU.
        
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Usage with connection-oriented protocols</h3>

<p> For connection-oriented transport protocols,
            this option SHOULD be inserted is part of the protocol
            handshake, and SHOULD NOT be inserted otherwise.
          
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.1"></a><h3>3.1.1.1.&nbsp;
Datagram Congestion Control Protocol (DCCP)</h3>

<p> This option SHOULD be inserted within
              DCCP Sync, DCCP Sync/Ack and DCCP Listen packets.
              See <a class='info' href='#RFC4340'>[RFC4340]<span> (</span><span class='info'>Kohler, E., Handley, M., and S. Floyd, &ldquo;Datagram Congestion Control Protocol (DCCP),&rdquo; March&nbsp;2006.</span><span>)</span></a>
              and <a class='info' href='#I-D.ietf-dccp-simul-open'>[I&#8209;D.ietf&#8209;dccp&#8209;simul&#8209;open]<span> (</span><span class='info'>Fairhurst, G., &ldquo;DCCP Simultaneous-Open Technique to Facilitate NAT/Middlebox Traversal,&rdquo; May&nbsp;2009.</span><span>)</span></a>.
            
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.2"></a><h3>3.1.1.2.&nbsp;
Stream Control Transmission Protocol (SCTP)</h3>

<p> TBD.
            
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1.3"></a><h3>3.1.1.3.&nbsp;
Transmission Control Protocol (TCP)</h3>

<p> This option SHOULD be inserted within
              TCP SYN and TCP SYN/ACK packets.
              See <a class='info' href='#RFC0793'>[RFC0793]<span> (</span><span class='info'>Postel, J., &ldquo;Transmission Control Protocol,&rdquo; September&nbsp;1981.</span><span>)</span></a>.
            
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Usage with other protocols</h3>

<p> So long as a translated packet is small enough
            (with regards to the MTU rule above),
            and uses a non-connection-oriented (including UDP and UDP-Lite)
            or unknown transport protocol,
            the translator MAY insert the option.
            If it is known that the packet is one of the first
            10 (FIXME: is this OK?) packets translated
            in the same direction for the corresponding mapping,
            then the translator SHOULD insert the option.
          
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Receiving the flow mapping option</h3>

<p> Processing of the flow mapping option is optional.
          In fact, an IPv6 implementation that does not support the
          flow mapping option MUST ignore it, according to
          <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> (this is not a new requirement
          for IPv6 implementation).
        
</p>
<p> The content of the flow mapping option is merely informational.
          Hence, there are no particular requirements as regards its
          processing.
          An IPv6 stack that implements the flow mapping option MAY
          store and or forward the flow mapping informations, as it sees fit.
          For instance, it might forward the informations to the application
          (see below for an example API) if it requests them.
        
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Option format</h3>
<br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Option Type  | Option Length |          Mapped Port          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Mapped IPv4 Address                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Remote IPv4 Address                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Translated Flow Mapping option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The Translated Flow Mapping option format is defined as follow:
          </p>
<blockquote class="text"><dl>
<dt>Option Type:</dt>
<dd>
              XXX (TBD: IANA)
            
</dd>
<dt>Option Length:</dt>
<dd>
              10 (10 bytes worth of data)
            
</dd>
<dt>Mapped Port:</dt>
<dd>
              If the type of the first header that is not an IPv6
              extension header is DCCP, SCTP, TCP, UDP or UDP-Lite,
              the transport protocol mapped port number.
              This is the destination port number found in the original
              IPv4 packet that was translated into the IPv6 packet
              containing this option.
              Otherwise, this must be set to zero by sender,
              and ignored by receivers.
            
</dd>
<dt>Mapped IPv4 Address:</dt>
<dd>
              Destination IPv4 address,
              as found in the origin IPv4 packet before translation.
            
</dd>
<dt>Remote IPv4 Address:</dt>
<dd>
              Source IPv4 address,
              as found in the origin IPv4 packet before translation.
            
</dd>
</dl></blockquote><p>
        
</p>
<p>The Translated Flow Mapping option requires a 4n alignment
          (as defined per <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> section 4.2).
          In particular, if it is the only non-padding option
          in an IPv6 extension header,
          it will be preceded by two bytes of padding.
          That is normally achieved through a single PadN option
          with a zero-length payload.
        
</p>
<a name="unsaf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
UNSAF Considerations</h3>

<p> The Translated Flow Mapping option can be inserted by
        translators and received by IPv6 nodes.
      
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Exit strategy</h3>

<p> It is expected that any applicable translation mechanism
          will define its own UNSAF Considerations,
          at least as regards the translators.
          Those should be referred to when it comes to inserting
          the Flow Mapping option.
          In particular, such a specification shall narrow down
          the scope of the translation scheme, define an exit strategy
          and longer term solutions
          (e.g. complete translation-free native IPv6 networking).
          See <a class='info' href='#RFC3424'>[RFC3424]<span> (</span><span class='info'>Daigle, L. and IAB, &ldquo;IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation,&rdquo; November&nbsp;2002.</span><span>)</span></a> for further references.
        
</p>
<p> However, a dedicated exit strategy is required
          for the IPv6 nodes that would be capable of parsing
          the Translated Flow Mapping option.
        
</p>
<p> When applicable translator deployments are being phased out,
          parsing the option becomes increasingly irrelevant,
          as the option will be absent from any received packets.
          At that point, IPv6 implementations can stop recognizing and parsing
          the option.
          They can instead return an error to any IPv6 application
          that would still try to use of the Flow Mapping option.
          IPv6 applications MUST be prepared to deal with IPv6 implementations
          that do not support this specification.
        
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Interactions with legacy NATs</h3>

<p> Legacy NATs do not support this option.
          This situation can normally be detected
          by the absence of the Translated Flow Mapping option.
        
</p>
<p> Problems may occur if a translator that implements
          this specification is located behind a legacy NAT.
          In this case, the Translated Flow Mapping option may
          contain incorrect informations.
          This can most often be detected by verifying that
          the embedded IPv4 address is a globally unique one
          rather than a private one
          (as defined by <a class='info' href='#RFC1918'>[RFC1918]<span> (</span><span class='info'>Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G., and E. Lear, &ldquo;Address Allocation for Private Internets,&rdquo; February&nbsp;1996.</span><span>)</span></a>
           and <a class='info' href='#RFC3927'>[RFC3927]<span> (</span><span class='info'>Cheshire, S., Aboba, B., and E. Guttman, &ldquo;Dynamic Configuration of IPv4 Link-Local Addresses,&rdquo; May&nbsp;2005.</span><span>)</span></a>).
         
</p>
<p> However, any application using this extension SHOULD
           be prepared to fail gracefully if incorrect informations
           are received.
           Indeed,
           a legacy NAT could internally use public address space.
           Or the (non-legacy) translator could be deployed
           in a closed network using private IPv4 addresses,
           even in the absence of legacy NATs.
        
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p> By maliciously inserting or altering a Translated Flow Mapping
        option to an IPv6 packet, an attacker could cause manipulate IP
        and transport addressing informations to be received.
      
</p>
<p> This may specifically allow an IPv6 attacker to refer
        the victim recipient node to an arbitrary IPv4 third party.
        As usual, IP nodes should not make assumptions to lightly
        as regard the IP address information they get.
        This problem is very similar to that of an IPv6 node
        handling a source-spoofed IPv6 packet,
        and the same precautions applies.
        In particular, proper transport or application-layer
        congestion control mechanisms need to be used,
        to prevent a distributed denial-of-service attack.
        Also, in security-sensitive cases,
        adequate security protocols are needed,
        such as TLS or IPsec.
      
</p>
<p> The Translated Flow Mapping option can also cause
        a victim recipient to assume
        an incorrect arbitrary IPv4 self-referral address.
        TBD: Do we need to fix this? How?
      
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p> The Translated Flow Mapping option requires an IPv6 Option number.
      
</p>
<p>IPv6 Option Number <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
HEX         act  chg  rest
---         ---  ---  -----
 XX          00   0   XXXXX     Translated Flow Mapping
</pre></div><p>

        The first two bits indicate that the IPv6 node may skip
        over this option and continue processing the header
        if it doesn't recognize the option type,
        and the third bit indicates
        that the Option Data may not change en-route.
      
</p>
<p> This document should be listed as the reference document.
      
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
API Considerations</h3>

<p> This section is non-normative.
        It defines a potential API to retrieve the flow mapping
        information as an extension to the Advanced IPv6 socket API
        <a class='info' href='#RFC3542'>[RFC3542]<span> (</span><span class='info'>Stevens, W., Thomas, M., Nordmark, E., and T. Jinmei, &ldquo;Advanced Sockets Application Program Interface (API) for IPv6,&rdquo; May&nbsp;2003.</span><span>)</span></a>.
      
</p>
<p> The flow mapping informations shall be passed to applications
        using a structure defined in &lt;netinet/in.h&gt;, and containing
        at least the following fields:
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
struct in6_ipv4flowmapping {
  struct uint16_t i4fm6_mapped_port;
  struct in_addr  i4fm6_mapped_addr;
  struct in_addr  i4fm6_remote_addr;
};
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Flow mapping structure&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p> For datagram (type SOCK_DGRAM) and raw (type SOCK_RAW) sockets,
        a socket option can configure receiving the flow information
        as ancilliary data on a per-packet basis, using recvmsg.
        This socket option shall be set to 0 (off) by default.
        Setting it to 1 (on) shall enabled flow mapping infos reception.
        Setting it to -1 (default) shall disable it.
        When enabled, an ancilliary data with level IPPROTO_IPV6,
        type IPV6_IPV4FLOWMAPPING shall be returned to the application,
        if a Flow Mapping option was found in the received packet.
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
int on = 1;

setsockopt(fd, IPPROTO_IPV6, IPV6_RECVIPV4FLOWMAPPING,
           &amp;yes, sizeof(yes));
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Per-packet socket option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p> For a connected socket, a read-only socket option may be used
        to fetch the flow mapping information if known (i.e. if at least
        one packet with a Flow Mapping Option was received). If unknown,
        the returned structure shall contain all zeroes.
        <br /><hr class="insert" />
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
struct in6_ipv4flowmapping val;

getsockopt(fd, IPPROTO_IPV6, IPV6_IPV4FLOWMAPPING,
           &amp;val, sizeof(val));
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Connected socket option&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dccp-simul-open">[I-D.ietf-dccp-simul-open]</a></td>
<td class="author-text">Fairhurst, G., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dccp-simul-open-08.txt">DCCP Simultaneous-Open Technique to Facilitate NAT/Middlebox Traversal</a>,&rdquo; draft-ietf-dccp-simul-open-08 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dccp-simul-open-08.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0793">[RFC0793]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc793">Transmission Control Protocol</a>,&rdquo; STD&nbsp;7, RFC&nbsp;793, September&nbsp;1981 (<a href="http://www.rfc-editor.org/rfc/rfc793.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1918">[RFC1918]</a></td>
<td class="author-text"><a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net">Groot, G.</a>, and <a href="mailto:lear@sgi.com">E. Lear</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>,&rdquo; BCP&nbsp;5, RFC&nbsp;1918, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1918.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3424">[RFC3424]</a></td>
<td class="author-text">Daigle, L. and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc3424">IAB Considerations for UNilateral Self-Address Fixing (UNSAF) Across Network Address Translation</a>,&rdquo; RFC&nbsp;3424, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3424.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3927">[RFC3927]</a></td>
<td class="author-text">Cheshire, S., Aboba, B., and E. Guttman, &ldquo;<a href="http://tools.ietf.org/html/rfc3927">Dynamic Configuration of IPv4 Link-Local Addresses</a>,&rdquo; RFC&nbsp;3927, May&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3927.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4340">[RFC4340]</a></td>
<td class="author-text">Kohler, E., Handley, M., and S. Floyd, &ldquo;<a href="http://tools.ietf.org/html/rfc4340">Datagram Congestion Control Protocol (DCCP)</a>,&rdquo; RFC&nbsp;4340, March&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4340.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3542">[RFC3542]</a></td>
<td class="author-text">Stevens, W., Thomas, M., Nordmark, E., and T. Jinmei, &ldquo;<a href="http://tools.ietf.org/html/rfc3542">Advanced Sockets Application Program Interface (API) for IPv6</a>,&rdquo; RFC&nbsp;3542, May&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3542.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">R&eacute;mi Denis-Courmont</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 407</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NOKIA GROUP  00045</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FI</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 50 487 6315</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:remi.denis-courmont@nokia.com">remi.denis-courmont@nokia.com</a></td></tr>
</table>
</body></html>
