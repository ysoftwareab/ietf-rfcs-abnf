<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DNS SRV Resource Records for the WebSocket Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Client Usage">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 SRV Lookup">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Fallback Process">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 WebSocket Establishment Fails">
<link href="#rfc.section.4" rel="Chapter" title="4 Reusing TCP Connection">
<link href="#rfc.section.5" rel="Chapter" title="5 Examples">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Load Balancing">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Load Balancing and Redundancy">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Reusing TCP Connection">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="8 References">
<link href="#rfc.references.1" rel="Chapter" title="8.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="8.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Change Log (to be removed by RFC Editor prior to publication)">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Changes in -00">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies the usage of DNS SRV resource records by WebSocket clients when resolving a "ws:" or "wss:" Uniform Resource Identifier (URI). The DNS SRV mechanism confers load-balancing and failover features for WebSocket service providers." />
  <meta name="description" content="This document specifies the usage of DNS SRV resource records by WebSocket clients when resolving a "ws:" or "wss:" Uniform Resource Identifier (URI). The DNS SRV mechanism confers load-balancing and failover features for WebSocket service providers." />
  <meta name="keywords" content="WebSocket, DNS, SRV" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">I.B.C. Baz Castillo</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">XtraTelecom S.A.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">April 11, 2011</td>
</tr>
<tr>
<td class="left">Expires: October 13, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DNS SRV Resource Records for the WebSocket Protocol<br />
  <span class="filename">draft-ibc-websocket-dns-srv-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the usage of DNS SRV resource records by WebSocket clients when resolving a "ws:" or "wss:" Uniform Resource Identifier (URI). The DNS SRV mechanism confers load-balancing and failover features for WebSocket service providers.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on October 13, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Client Usage</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">SRV Lookup</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Fallback Process</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">WebSocket Establishment Fails</a>
</li>
<li>4.   <a href="#rfc.section.4">Reusing TCP Connection</a>
</li>
<li>5.   <a href="#rfc.section.5">Examples</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Load Balancing</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Load Balancing and Redundancy</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Reusing TCP Connection</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.references">References</a>
</li>
<li>8.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>8.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Change Log (to be removed by RFC Editor prior to publication)</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Changes in -00</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">DNS SRV <a href="#RFC2782">[RFC2782]</a> is widely implemented in realtime communication protocols as SIP <a href="#RFC3261">[RFC3261]</a> and XMPP <a href="#RFC6120">[RFC6120]</a>. In both cases clients perform a DNS SRV query to locate the transport, IP address and port of the server they want to contact. The administrator of the domain can configure its DNS SRV records in a way that they provide automatic load-balancing along with redundancy/failover capability.</p>
<p id="rfc.section.1.p.2">By introducing DNS SRV records into WebSocket protocol <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a>, WebSocket providers can, optionally, take same advantages and offer robust services without requiring expensive server-side solutions.</p>
<p id="rfc.section.1.p.3">This specification mandates the usage of DNS SRV queries by WebSocket clients when resolving a "ws:" or "wss:" URI, but still leaves the decision of using SRV records up to the service administrator.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#conventions" id="conventions">Conventions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#client_usage" id="client_usage">Client Usage</a>
</h1>
<p id="rfc.section.3.p.1">This specification mandates the implementation of DNS SRV mechanism in WebSocket clients (usually web browsers). DNS SRV lookup just applies when the host component of a WebSocket URI is a domain and the URI does not contain an explicit port. If this is not the case, the client MUST attemp the fallback process described in <a href="#fallback_process">Section 3.2</a>.</p>
<p id="rfc.section.3.p.2">To clarify it, a WebSocket URI like "ws://example.org/myservice" requires the client to perform SRV resolution while "ws://example.org:80/myservice" does not (as the port is explicitly present in the URI).</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#srv_lookup" id="srv_lookup">SRV Lookup</a>
</h1>
<p id="rfc.section.3.1.p.1">Given a WebSocket URI ("ws:" or "wss:") in which the host component is a domain and the port is not present, the WebSocket client MUST perform the following steps: </p>

<ol>
<li>If the scheme is "ws:", perform a DNS SRV query whose inputs are: <ul>
<li>Service: "ws"</li>
<li>Proto: "tcp"</li>
<li>Name: The host component of the URI</li>
</ul>
<p> The resulting query looks like "_ws._tcp.example.org".  </p>
</li>
<li>If the scheme is "wss:", perform a DNS SRV query whose inputs are: <ul>
<li>Service: "wss"</li>
<li>Proto: "tcp"</li>
<li>Name: The host component of the URI</li>
</ul>
<p> The resulting query looks like "_wss._tcp.example.org".  </p>
</li>
<li>If there is no SRV result, attempt the fallback process described in <a href="#fallback_process">Section 3.2</a> and omit next steps.</li>
<li>If there is SRV result, it will contain one or more combinations of a port and FDQN, each of which contains a priority and weight attributes as described in DNS SRV <a href="#RFC2782">[RFC2782]</a>.</li>
<li>Choose at least one of the returned FQDNs to resolve (following the rules in DNS SRV <a href="#RFC2782">[RFC2782]</a>) by performing DNS A or AAAA lookups on the FDQN. This will result in an IPv4 or IPv6 address.</li>
<li>The client uses the IP address(es) from the successfully resolved FDQN (with the corresponding port number returned by the SRV lookup) as the connection address for the WebSocket service.</li>
<li>If the WebSocket establishment fails (according to <a href="#websocket_establishment_fails">Section 3.3</a>) using that IP address but the A or AAAA lookups returned more than one IP address, then use the next resolved IP address for that FDQN as the connection address.</li>
<li>If the WebSocket establishment fails using all resolved IP addresses for a given FDQN, then repeat the process of resolution and connection for the next FQDN returned by the SRV lookup based on the priority and weight as defined in DNS SRV <a href="#RFC2782">[RFC2782]</a> until all the SRV record entries are tryed (in that case internally report the WebSocket establishment error).</li>
</ol>

<p> </p>
<p id="rfc.section.3.1.p.2">When the client constructs the WebSocket handshake HTTP request, the URI MUST be set as described in Section 3.2 of <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> regardless of the usage of SRV mechanism. This is, DNS SRV resolution over a "ws:" or "wss:" URI does not alter the usual construction of the WebSocket handshake request.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#fallback_process" id="fallback_process">Fallback Process</a>
</h1>
<p id="rfc.section.3.2.p.1">The fallback process SHOULD be a normal A or AAAA address record resolution to determine the IPv4 or IPv6 address of the URI host component (or URI host value without DNS resolution if it contains an IP address).</p>
<p id="rfc.section.3.2.p.2">The server connection port is obtained as stated in Section 3.1 of <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a>.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#websocket_establishment_fails" id="websocket_establishment_fails">WebSocket Establishment Fails</a>
</h1>
<p id="rfc.section.3.3.p.1">TODO: This section should be present in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> rather than here.</p>
<p id="rfc.section.3.3.p.2">A WebSocket establishment fails if one of the following cases occurs when contacting the server: </p>

<ul>
<li>TCP connection is not possible due to timeout or server side rejection.</li>
<li>The server does not return a valid HTTP response for the WebSocket handshake request within a specified ammount of time (TODO: specify such ammount).</li>
<li>The server replies a 500 or 503 HTTP error response for the WebSocket handshake meaning that it suffers of internal problems (i.e. congestion) and that it is not currently capable of handling the request.  <ul class="empty"><li>If HTTP response code other than 101 (success), 500 or 503 is returned by the server that MUST NOT be considered a WebSocket establishment failure. TODO: <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> should describe how to handle different HTTP response codes (as 401 or 302).</li></ul>
<p> </p>
</li>
</ul>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#reusing_tcp_connection" id="reusing_tcp_connection">Reusing TCP Connection</a>
</h1>
<p id="rfc.section.4.p.1">When using HTTP/1.1 <a href="#RFC2616">[RFC2616]</a> the client is able to mantain persistent connections with the server and reuse them for sending new HTTP requests. Reusing an existing connection (when available) for WebSocket communication is a desirable behavior which just can take place when both the HTTP server and WebSocket server are co-located in the same host and listen in the same IP address and port.</p>
<p id="rfc.section.4.p.2">This section defines how to reuse an existing connection after resolving the location of the WebSocket server using the DNS SRV mechanism specified in this document: </p>

<ol>
<li>The WebSocket client performs the steps in <a href="#client_usage">Section 3</a> and gets an ordered list of remote targets by following rules in DNS SRV <a href="#RFC2782">[RFC2782]</a>.</li>
<li>For each target the client selects to communicate with, it first checks whether there exists an established TCP connection with same target.</li>
<li>If so, the client MAY reuse the existing TCP connection for sending the WebSocket handshake request rather than openning a new one.</li>
</ol>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<p id="rfc.section.5.p.1">By properly configuring domain SRV records, the WebSocket service administrator can take advantage of load-balancing and redundanty capabilities inherent in DNS SRV <a href="#RFC2782">[RFC2782]</a>. Sections below show some usage cases.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> Load Balancing</h1>
<div id="#rfc.figure.1"></div>
<pre>
$ORIGIN example.org.
@         SOA   dns.example.org. root.example.org.
(2011040501 3600 3600 604800 86400)
NS        dns.example.org.
_ws._tcp  SRV   0 3 80 ws1.example.org.
_ws._tcp  SRV   0 1 90 ws2.example.org.

dns       A     1.1.1.100
ws1       A     1.1.1.1
ws2       A     1.1.1.2
            </pre>
<p id="rfc.section.5.1.p.1">Assuming there are two hosts providing the WebSocket service for the URI "ws://example.org/myservice", the first one listening into IP address 1.1.1.1 and port 80, and the second one listening into IP address 1.1.1.2 and port 90, the following zone file for a fictional example.org domain provides load-balancing for WebSocket service by dispatching the traffic over both servers as both have same SRV priority value (the first one will handle the 75% of the traffic due to its SRV weight value which is 3 times higher than the weight value for the second server): </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Load Balancing and Redundancy</h1>
<div id="#rfc.figure.2"></div>
<pre>
              
$ORIGIN example.org.
@         SOA   dns.example.org. root.example.org.
(2011040501 3600 3600 604800 86400)
NS        dns.example.org.
_ws._tcp  SRV   0 3 80 ws1.example.org.
_ws._tcp  SRV   0 1 90 ws2.example.org.
_ws._tcp  SRV   1 0 80 ws3.example.org.

dns       A     1.1.1.100
ws1       A     1.1.1.1
ws2       A     1.1.1.2
ws2       A     1.1.1.3
              
            </pre>
<p id="rfc.section.5.2.p.1">Same case as above but adding a third server for the case in which both initial servers are not accessible (i.e. both are down). The new server listens on IP 1.1.1.3 and port 80. Its lower SRV priority confers this server a backup status: </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Reusing TCP Connection</h1>
<div id="#rfc.figure.3"></div>
<pre>
              
$ORIGIN example.org.
@         SOA   dns.example.org. root.example.org.
(2011040501 3600 3600 604800 86400)
NS        dns.example.org.
_ws._tcp  SRV   0 1 80 www.example.org.
_ws._tcp  SRV   0 1 80 ws2.example.org.

dns       A     1.1.1.100
www       A     1.1.1.1
ws2       A     1.1.1.2
              
            </pre>
<p id="rfc.section.5.3.p.1">In this case "www.example.org" is used for both HTTP and WebSocket traffic, while a second server "ws2.example.com" is used for balancing the WebSocket traffic. It is expected that half of the clients would choose "www.example.org" target for the WebSocket communication (by following target selection rules in DNS SRV <a href="#RFC2782">[RFC2782]</a>) so they MAY reuse the existing TCP connection previously opened to retrieve HTTP data: </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security_considerations" id="security_considerations">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Any Internet protocol offering DNS SRV resource records for locating servers is sensitive to security issues described in <a href="#I-D.barnes-hard-problem">[I-D.barnes-hard-problem]</a>. Usage of DNS security extensions (DNSSEC) as described in <a href="#RFC4033">[RFC4033]</a> is recommended to mitigate the problem.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana_considerations" id="iana_considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">This specification registers two new SRV Service Labels: </p>

<dl>
<dt>ws:</dt>
<dd style="margin-left: 4">MUST be used when constructing a DNS SRV query to locate the WebSocket service address (for regular WebSocket connections).</dd>
<dt>wss:</dt>
<dd style="margin-left: 4">MUST be used when constructing a DNS SRV query to locate the WebSocket service address (for WebSocket connections tunneled over TLS <a href="#RFC5246">[RFC5246]</a>).</dd>
</dl>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">8.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">8.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2782">[RFC2782]</b></td>
<td class="top">
<a href="mailto:arnt@troll.no" title="Troll Tech">Gulbrandsen, A.</a>, <a title="Internet Software Consortium">Vixie, P.</a> and <a href="mailto:levone@microsoft.com" title="Microsoft Corporation">L. Esibov</a>, "<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>", RFC 2782, February 2000.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</b></td>
<td class="top">
<a>Fette, I</a>, "<a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-06">The WebSocket protocol</a>", Internet-Draft draft-ietf-hybi-thewebsocketprotocol-06, February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">8.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6120">[RFC6120]</b></td>
<td class="top">
<a>Saint-Andre, P.</a>, "<a href="http://tools.ietf.org/html/rfc6120">Extensible Messaging and Presence Protocol (XMPP): Core</a>", RFC 6120, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.barnes-hard-problem">[I-D.barnes-hard-problem]</b></td>
<td class="top">
<a>Barnes, R</a> and <a>P Saint-Andre</a>, "<a href="http://tools.ietf.org/html/draft-barnes-hard-problem-00">High Assurance Re-Direction (HARD) Problem Statement</a>", Internet-Draft draft-barnes-hard-problem-00, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4033">[RFC4033]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>", RFC 4033, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#changelog" id="changelog">Change Log (to be removed by RFC Editor prior to publication)</a>
</h1>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Changes in -00</h1>
<p></p>

<ul><li>Initial version.</li></ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Inaki Baz Castillo</span> 
	  <span class="n hidden">
		<span class="family-name">Baz Castillo</span>
	  </span>
	</span>
	<span class="org vcardline">XtraTelecom S.A.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Barakaldo</span>,  
		<span class="region">Basque Country</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ibc@aliax.net">ibc@aliax.net</a></span>

  </address>
</div>

</body>
</html>