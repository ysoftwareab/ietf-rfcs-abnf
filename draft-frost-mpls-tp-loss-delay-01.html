<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Packet Loss and Delay
    Measurement for the MPLS Transport Profile</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Packet Loss and Delay
    Measurement for the MPLS Transport Profile">
<meta name="keywords" content="MPLS, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">MPLS</td><td class="header">D. Frost, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Bryant, Ed.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">Expires: October 18, 2010</td><td class="header">April 16, 2010</td></tr>
</table></td></tr></table>
<h1><br />Packet Loss and Delay
    Measurement for the MPLS Transport Profile<br />draft-frost-mpls-tp-loss-delay-01</h1>

<h3>Abstract</h3>

<p>An essential Operations, Administration and Maintenance requirement
      of the MPLS Transport Profile (MPLS-TP) is the ability to monitor
      performance metrics for packet loss and one-way and two-way delay for
      MPLS-TP pseudowires, Label Switched Paths, and Sections. This document
      specifies protocol mechanisms to facilitate the efficient and accurate
      measurement of these performance metrics.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on October 18, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Review of Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.1.1.</a>&nbsp;
Requirements for Packet Loss Measurement<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.1.2.</a>&nbsp;
Requirements for Delay Measurement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">1.2.</a>&nbsp;
Terminology<br />
<a href="#anchor6">2.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.1.</a>&nbsp;
Implementation Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ov_loss">2.2.</a>&nbsp;
Packet Loss Measurement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ov_delay">2.3.</a>&nbsp;
Delay Measurement<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.3.1.</a>&nbsp;
Timestamp Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">2.4.</a>&nbsp;
Delay Variation Measurement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">2.5.</a>&nbsp;
Unidirectional Connections<br />
<a href="#anchor11">3.</a>&nbsp;
Packet Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pf_lm">3.1.</a>&nbsp;
Loss Measurement Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pf_dm">3.2.</a>&nbsp;
Delay Measurement Message Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pf_tsf">3.3.</a>&nbsp;
Timestamp Field Formats<br />
<a href="#anchor12">4.</a>&nbsp;
Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.1.</a>&nbsp;
Loss Measurement Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.1.1.</a>&nbsp;
Initiating a Loss Measurement Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.1.2.</a>&nbsp;
Transmitting a Loss Measurement Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">4.1.3.</a>&nbsp;
Receiving a Loss Measurement Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">4.1.4.</a>&nbsp;
Transmitting a Loss Measurement Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">4.1.5.</a>&nbsp;
Receiving a Loss Measurement Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">4.1.6.</a>&nbsp;
Scope of Packet Loss Counters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">4.1.7.</a>&nbsp;
Message Loss and Packet Misorder Conditions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">4.2.</a>&nbsp;
Delay Measurement Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">4.2.1.</a>&nbsp;
Transmitting a Delay Measurement Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">4.2.2.</a>&nbsp;
Receiving a Delay Measurement Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">4.2.3.</a>&nbsp;
Transmitting a Delay Measurement Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">4.2.4.</a>&nbsp;
Receiving a Delay Measurement Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#op_dm_tsfn">4.2.5.</a>&nbsp;
Timestamp Format Negotiation<br />
<a href="#anchor26">5.</a>&nbsp;
A Uni-format Implementation<br />
<a href="#con_con">6.</a>&nbsp;
Congestion Considerations<br />
<a href="#anchor27">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor28">8.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The MPLS Transport Profile (MPLS-TP) <a class='info' href='#I-D.ietf-mpls-tp-framework'>[I&#8209;D.ietf&#8209;mpls&#8209;tp&#8209;framework]<span> (</span><span class='info'>Bocci, M., Bryant, S., Frost, D., Levrau, L., and L. Berger, &ldquo;A Framework for MPLS in Transport Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a> comprises the set of protocol
      functions that meet the requirements <a class='info' href='#RFC5654'>[RFC5654]<span> (</span><span class='info'>Niven-Jenkins, B., Brungard, D., Betts, M., Sprecher, N., and S. Ueno, &ldquo;Requirements of an MPLS Transport Profile,&rdquo; September&nbsp;2009.</span><span>)</span></a> for
      the application of MPLS to the construction and operation of
      packet-switched transport networks.
</p>
<p>The document <a class='info' href='#I-D.ietf-mpls-tp-oam-requirements'>[I&#8209;D.ietf&#8209;mpls&#8209;tp&#8209;oam&#8209;requirements]<span> (</span><span class='info'>Vigoureux, M. and D. Ward, &ldquo;Requirements for OAM in MPLS Transport Networks,&rdquo; March&nbsp;2010.</span><span>)</span></a>
      specifies Operations, Administration and Maintenance (OAM)
      definitions and requirements for the measurement of packet loss and
      one-way and two-way delay for MPLS-TP pseudowires (PWs), Label
      Switched Paths (LSPs), and Sections. For convenience these
      definitions and requirements are summarized in the following
      subsections.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Review of Requirements</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1.1"></a><h3>1.1.1.&nbsp;
Requirements for Packet Loss Measurement</h3>

<p>The MPLS-TP OAM toolset must provide a function to enable the
          quantification of packet loss ratio over a PW, LSP or
          Section.
</p>
<p>The loss of a packet is defined in <a class='info' href='#RFC2680'>[RFC2680]<span> (</span><span class='info'>Almes, G., Kalidindi, S., and M. Zekauskas, &ldquo;A One-way Packet Loss Metric for IPPM,&rdquo; September&nbsp;1999.</span><span>)</span></a>
          (Section 2.4).  This definition is used here.
</p>
<p>Packet loss ratio is defined here to be the ratio of the
          number of user packets lost to the total number of user packets
          sent during a defined time interval.
</p>
<p>This function may either be performed pro-actively or
          on-demand.
</p>
<p>This function should be performed between End Points of PWs,
          LSPs and Sections.
</p>
<p>It should be possible to rely on user traffic to perform this
          function.
</p>
<p>The protocol solution(s) developed to perform this function
          must apply to point-to-point co-routed bidirectional LSPs,
          point-to-point associated bidirectional LSPs, point-to-point
          unidirectional LSPs and point-to-multipoint (unidirectional)
          LSPs.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1.2"></a><h3>1.1.2.&nbsp;
Requirements for Delay Measurement</h3>

<p>The MPLS-TP OAM toolset must provide a function to enable the
          quantification of the one-way, and if appropriate, the two-way,
          delay of a PW, LSP or Section.
</p>
<p></p>
<ul class="text">
<li>The one-way delay is defined in <a class='info' href='#RFC2679'>[RFC2679]<span> (</span><span class='info'>Almes, G., Kalidindi, S., and M. Zekauskas, &ldquo;A One-way Delay Metric for IPPM,&rdquo; September&nbsp;1999.</span><span>)</span></a>
            to be the time elapsed from the start of transmission of the
            first bit of a packet by an End Point until the reception of
            the last bit of that packet by the other End Point.
</li>
<li>The two-way delay is defined in <a class='info' href='#RFC2681'>[RFC2681]<span> (</span><span class='info'>Almes, G., Kalidindi, S., and M. Zekauskas, &ldquo;A Round-trip Delay Metric for IPPM,&rdquo; September&nbsp;1999.</span><span>)</span></a>
            to be the time elapsed from the start of transmission of the
            first bit of a packet by an End Point until the reception of
            the last bit of that packet by the same End Point.
</li>
</ul><p>
          
</p>
<p>Two-way delay may be quantified using data traffic loopback
          at the remote End Point of the PW, LSP or Section.
</p>
<p>Accurate quantification of one-way delay may require clock
          synchronization, the means for which are outside the scope of
          this document.
</p>
<p>This function should be performed on-demand and may be
          performed pro-actively.
</p>
<p>This function should be performed between End Points of PWs,
          LSPs and Sections.
</p>
<p>In addition to point-to-point co-routed bidirectional LSPs,
          the protocol solution(s) developed to perform this function must
          also apply to point-to-point associated bidirectional LSPs,
          point-to-point unidirectional LSPs and point-to-multipoint
          (unidirectional) LSPs, but only to enable the quantification of
          the one-way delay.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Terminology</h3>
<table class="headers" align="left" border="0" cellpadding="2" cellspacing="2">
<col align="left"><col align="left">
<tr><th align="left">Term</th><th align="left">Definition</th></tr>
<tr>
<td align="left">ACH</td>
<td align="left">Associated Channel Header</td>
</tr>
<tr>
<td align="left">DM</td>
<td align="left">Delay Measurement</td>
</tr>
<tr>
<td align="left">G-ACh</td>
<td align="left">Generic Associated Channel</td>
</tr>
<tr>
<td align="left">LM</td>
<td align="left">Loss Measurement</td>
</tr>
<tr>
<td align="left">LSP</td>
<td align="left">Label Switched Path</td>
</tr>
<tr>
<td align="left">LSR</td>
<td align="left">Label Switching Router</td>
</tr>
<tr>
<td align="left">MPLS-TP</td>
<td align="left">MPLS Transport Profile</td>
</tr>
<tr>
<td align="left">OAM</td>
<td align="left">Operations, Administration and Maintenance</td>
</tr>
<tr>
<td align="left">PW</td>
<td align="left">Pseudowire</td>
</tr>
</table>
<br clear="all" />

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview</h3>

<p>The basic procedures for measuring loss and delay over a
      bidirectional connection are conceptually simple. The following figure
      shows the reference scenario.
</p><br /><hr class="insert" />
<a name="ov_fig"></a>
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
          T1              T2
+-------+/     Query       \+-------+
|       | - - - - - - - - -&gt;|       |
|   A   |===================|   B   |
|       |&lt;- - - - - - - - - |       |
+-------+\     Response    /+-------+
          T4              T3
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The figure shows a bidirectional connection between two LSRs, A and
      B, and illustrates the temporal reference points T1-T4 associated with a
      measurement operation that takes place at A. The operation consists of A
      sending a query message to B, and B sending back a response. Each
      reference point indicates the point in time at which either the query or
      the response message is transmitted or received over the connection.
</p>
<p>In this situation, A can arrange to measure the packet loss over the
      connection in the forward and reverse directions by sending Loss
      Measurement (LM) query messages to B each of which contains the count of
      packets transmitted prior to time T1 over the connection to B (A_TxP).
      When the message reaches B, it appends two values and reflects the
      message back to A: the count of packets received prior to time T2 over
      the connection from A (B_RxP), and the count of packets transmitted
      prior to time T3 over the connection to A (B_TxP). When the response
      reaches A, it appends a fourth value, the count of packets received
      prior to time T4 over the connection from B (A_RxP).
</p>
<p>These four counter values enable A to compute the desired loss
      statistics. Because the transmit count at A and the receive count at B
      (and vice versa) may not be synchronized at the time of the first
      message, and to limit the effects of counter wrap, the loss is computed
      in the form of a delta between messages.
</p>
<p>To measure at A the delay over the connection to B, a Delay
      Measurement (DM) query message is sent from A to B containing a
      timestamp recording the instant at which it is transmitted,
      i.e.&nbsp;T1. When the message reaches B, a timestamp is added recording
      the instant at which it is received (T2). The message can now be
      reflected from B to A, with B adding its transmit timestamp (T3) and A
      adding its receive timestamp (T4). These four timestamps enable A to
      compute the one-way delay in each direction, as well as the two-way
      delay for the connection. The one-way delay computations require that
      the clocks of A and B be synchronized; mechanisms for clock
      synchronization are outside the scope of this document.
</p>
<p>In the case of a unidirectional connection (i.e.&nbsp;a
      unidirectional point-to-point or point-to-multipoint MPLS-TP LSP) rooted
      at A, the first half of each of the above procedures can be carried out
      to measure the forward one-way loss and delay associated with the LSP.
      At this point the measurement can either take place at the terminal
      node(s) of the connection rather than at A, or an out-of-band connection
      can be used, if available, to communicate the data back to A.
</p>
<p>LM and DM messages flow over the Generic Associated Channel (G-ACh)
      <a class='info' href='#RFC5586'>[RFC5586]<span> (</span><span class='info'>Bocci, M., Vigoureux, M., and S. Bryant, &ldquo;MPLS Generic Associated Channel,&rdquo; June&nbsp;2009.</span><span>)</span></a> of an MPLS-TP connection (pseudowire, LSP
      or Section).
</p>
<p><a class='info' href='#comment.N1'>[N1]<span> (</span><span class='info'>DF: The term &quot;connection&quot; is used in this document to mean an MPLS-TP PW, LSP, or Section. Either this or another term will be defined in the Framework for this purpose.</span><span>)</span></a><a name='N1'></a>
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Implementation Considerations</h3>

<p>The challenge in carrying out the above procedures lies with the
        implementation. For accurate loss measurement to occur, packets must
        not be sent between the time the transmit count for an outbound LM
        message is determined and the time the message is actually
        transmitted. Similarly, packets must not be received and processed
        between the time an LM message is received and the time the receive
        count for the message is determined. For accurate delay measurement,
        timestamps must be recorded in DM messages at a point in time as close
        as possible to when the message is actually transmitted or received
        over the connection.
</p>
<p>These accuracy requirements imply that a hardware-based forwarding
        implementation may require hardware support for the processing of LM
        and DM messages. An important consideration of the LM/DM protocol and
        message format is therefore support for efficient hardware
        processing.
</p>
<p>In situations where such accuracy is not required, or the necessary
        level of support is not available, an implementation MAY still
        generate and respond to LM and DM messages but SHOULD make its
        accuracy limitations clear to the user. In general the DM procedures
        described in this document remain viable under these conditions, but
        the procedures for LM may be inadequate. An alternate approach to LM
        in such situations is to assemble an approximate view of connection
        quality through sustained invasive generation of test messages
        alongside client traffic. Such alternative procedures are outside the
        scope of this document.
</p>
<a name="ov_loss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Packet Loss Measurement</h3>

<p>Suppose a bidirectional connection such as an MPLS-TP pseudowire,
        bidirectional LSP, or Section exists between the LSRs A and B. The
        objective is to measure at A the following two quantities associated
        with the connection: </p>
<blockquote class="text">
<p>A_TxLoss (transmit loss): the number of packets transmitted by
            A over the connection but not received at B;
</p>
<p>A_RxLoss (receive loss): the number of packets transmitted by B
            over the connection but not received at A.
</p>
</blockquote>

<p>This is accomplished by initiating a Loss Measurement (LM)
        operation at A, which consists of transmission of a sequence of LM
        query messages (LM[1], LM[2], ...) over the connection at a specified
        rate, such as one every 100 milliseconds. Each message LM[n] contains
        the following value: </p>
<blockquote class="text">
<p>A_TxP[n]: the total count of packets transmitted by A over the
            connection prior to the time this message is transmitted.
</p>
</blockquote>

<p>When such a message is received at B, the following value is
        recorded in the message: </p>
<blockquote class="text">
<p>B_RxP[n]: the total count of packets received by B over the
            connection at the time this message is received (excluding the
            message itself).
</p>
</blockquote>

<p>At this point, B inserts an appropriate response code into the
        message and transmits it back to A, recording within it the following
        value: </p>
<blockquote class="text">
<p>B_TxP[n]: the total count of packets transmitted by B over the
            connection prior to the time this response is transmitted.
</p>
</blockquote>

<p>When the message response is received back at A, the following
        value is recorded in the message: </p>
<blockquote class="text">
<p>A_RxP[n]: the total count of packets received by A over the
            connection at the time this response is received (excluding the
            message itself).
</p>
</blockquote>

<p>The transmit loss A_TxLoss[n-1,n] and receive loss A_RxLoss[n-1,n]
        within the measurement interval marked by the messages LM[n-1] and
        LM[n] are computed by A as follows:
</p>
<p>A_TxLoss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] - B_RxP[n-1])
        <br />
 A_RxLoss[n-1,n] = (B_TxP[n] - B_TxP[n-1]) - (A_RxP[n] -
        A_RxP[n-1])
</p>
<p>where the arithmetic is modulo the counter size.
</p>
<p>The derived values </p>
<blockquote class="text">
<p>A_TxLoss = A_TxLoss[1,2] + A_TxLoss[2,3] + ...
</p>
<p>A_RxLoss = A_RxLoss[1,2] + A_RxLoss[2,3] + ...
</p>
</blockquote><p> are updated each time a response to an LM message is
        received and processed, and represent the total transmit and receive
        loss over the connection since the LM operation was initiated.
</p>
<p>When computing the values A_TxLoss[n-1,n] and A_RxLoss[n-1,n] the
        possibility of counter wrap must be taken into account. Consider for
        example the values of the A_TxP counter at times n-1 and n. Clearly if
        A_TxP[n] is allowed to wrap to 0 and then beyond to a value equal to
        or greater than A_TxP[n-1], the computation of an unambiguous
        A_TxLoss[n-1,n] value will be impossible. Therefore the LM message
        rate MUST be sufficiently high, given the counter size and the speed
        and minimum packet size of the underlying connection, that this
        condition cannot arise. For example, a 32-bit counter for a 100 Gbps
        link with a minimum packet size of 64 bytes can wrap in 2^32 /
        (10^11/(64*8)) = ~22 seconds, which is therefore an upper bound on the
        LM message interval under such conditions.
</p>
<a name="ov_delay"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Delay Measurement</h3>

<p>Suppose a bidirectional connection such as an MPLS-TP pseudowire,
        bidirectional LSP, or Section exists between the LSRs A and B. The
        objective is to measure at A one or more of the following quantities
        associated with the connection: </p>
<ul class="text">
<li>The one-way delay associated with the forward (A to B)
            direction of the connection;
</li>
<li>The one-way delay associated with the reverse (B to A)
            direction of the connection;
</li>
<li>The two-way delay (A to B to A) associated with the
            connection.
</li>
</ul>

<p>Of course, if the first two quantities are known then the third is
        immediate, being just their sum. Measurement of the one-way delay
        quantities, however, requires that the clocks of A and B be
        synchronized, whereas the two-way delay can be measured directly even
        when this is not the case (provided A and B have stable clocks).
</p>
<p>The measurement is accomplished by sending a Delay Measurement (DM)
        query message over the connection to B which contains the following
        timestamp: </p>
<blockquote class="text">
<p>T1: the time the DM query message is transmitted from A.
</p>
</blockquote>

<p>When the message arrives at B, the following timestamp is recorded
        in the message: </p>
<blockquote class="text">
<p>T2: the time the DM query message is received at B.
</p>
</blockquote>

<p>At this point B inserts an appropriate response code into the
        message and transmits it back to A, recording within it the following
        timestamp: </p>
<blockquote class="text">
<p>T3: the time the DM response message is transmitted from B.
</p>
</blockquote>

<p>When the message arrives back at A, the following timestamp is
        recorded in the message: </p>
<blockquote class="text">
<p>T4: the time the DM response message is received back at A.
</p>
</blockquote>

<p>At this point, A can compute the two-way delay associated with the
        connection as </p>
<blockquote class="text">
<p>two-way delay = (T4 - T1) - (T3 - T2).
</p>
</blockquote>

<p>If the clocks of A and B are known at A to be synchronized, then
        all three delay values can be computed at A as </p>
<blockquote class="text">
<p>forward one-way delay = T2 - T1
</p>
<p>reverse one-way delay = T4 - T3
</p>
<p>two-way delay = forward delay + reverse delay.
</p>
</blockquote>

<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3.1"></a><h3>2.3.1.&nbsp;
Timestamp Format</h3>

<p>There are at least two significant timestamp formats in common
          use: the timestamp format of the Internet standard Network Time
          Protocol (NTP), described in <a class='info' href='#RFC1305'>[RFC1305]<span> (</span><span class='info'>Mills, D., &ldquo;Network Time Protocol (Version 3) Specification, Implementation,&rdquo; March&nbsp;1992.</span><span>)</span></a> and
          <a class='info' href='#RFC2030'>[RFC2030]<span> (</span><span class='info'>Mills, D., &ldquo;Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI,&rdquo; October&nbsp;1996.</span><span>)</span></a>, and the timestamp format used in the
          IEEE 1588 Precision Time Protocol (PTP) <a class='info' href='#IEEE1588'>[IEEE1588]<span> (</span><span class='info'>IEEE, &ldquo;1588-2008 IEEE Standard for a Precision Clock Synchronization           Protocol for Networked Measurement and Control Systems,&rdquo; March&nbsp;2008.</span><span>)</span></a>.
</p>
<p><a class='info' href='#comment.N2'>[N2]<span> (</span><span class='info'>DF: There are actually two PTP timestamp formats: the 1588v1 format consists of a 32-bit seconds field and a 32-bit nanoseconds field; in 1588v2 the seconds field was extended to 48 bits.</span><span>)</span></a><a name='N2'></a>
</p>
<p>The NTP format has the advantages of wide use and long deployment
          in the Internet, and was specifically designed to make the
          computation of timestamp differences as simple and efficient as
          possible. On the other hand, there is also now a significant
          deployment of equipment designed to support the PTP format.
</p>
<p>The approach taken in this document is therefore to include in DM
          messages fields which identify the timestamp formats used by the two
          devices involved in a DM operation. This implies that an LSR
          attempting to carry out a DM operation may be faced with the problem
          of computing with and possibly reconciling different timestamp
          formats. Support for multiple timestamp formats is OPTIONAL. An
          implementation SHOULD, however, make clear which timestamp formats
          it supports and the extent of its support for computation with and
          reconciliation of different formats for purposes of delay
          measurement.
</p>
<p>In accordance with Internet standards for network time, the NTP
          timestamp format is the default format used in DM messages. This
          format MUST be supported.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Delay Variation Measurement</h3>

<p>Packet Delay Variation <a class='info' href='#RFC3393'>[RFC3393]<span> (</span><span class='info'>Demichelis, C. and P. Chimento, &ldquo;IP Packet Delay Variation Metric for IP Performance Metrics (IPPM),&rdquo; November&nbsp;2002.</span><span>)</span></a> is another
        performance metric important in some applications. The PDV of a pair
        of packets within a stream of packets is defined for a selected pair
        of packets in the stream going from measurement point MP1 to
        measurement point MP2. The PDV is the difference between the one-way
        delay of the selected packets.
</p>
<p>A PDV measurement can therefore be derived from successive delay
        measurements obtained through the procedures in <a class='info' href='#ov_delay'>Section&nbsp;2.3<span> (</span><span class='info'>Delay Measurement</span><span>)</span></a>. An important point regarding PDV
        measurement, however, is that it can be carried out based on one-way
        delay measurements even when the clocks of the two systems involved in
        those measurements are not synchronized.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Unidirectional Connections</h3>

<p>In the case that the connection from A to (B1, ..., Bk) is
        unidirectional, i.e.&nbsp;is a unidirectional LSP, LM and DM
        measurements can be carried out at B1, ..., Bk instead of at A.
</p>
<p>For LM this is accomplished by initiating an LM operation at A and
        carrying out the same procedures as for bidirectional connections,
        except that no responses from B1, ..., Bk to A are generated. Instead,
        each terminal node B uses the A_TxP and B_RxP values in the LM
        messages it receives to compute the receive loss associated with the
        connection in essentially the same way as described previously,
        i.e.
</p>
<p>B_RxLoss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] -
        B_RxP[n-1])
</p>
<p>For DM, of course, only the forward one-way delay can be measured
        and the clock synchronization requirement applies.
</p>
<p>Alternatively, if an out-of-band connection from a terminal node B
        back to A is available, the LM and DM message responses can be
        communicated to A via this connection so that the measurements can be
        carried out at A.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Packet Format</h3>

<p>Loss Measurement and Delay Measurement messages flow over the Generic
      Associated Channel (G-ACh) <a class='info' href='#RFC5586'>[RFC5586]<span> (</span><span class='info'>Bocci, M., Vigoureux, M., and S. Bryant, &ldquo;MPLS Generic Associated Channel,&rdquo; June&nbsp;2009.</span><span>)</span></a> of an MPLS-TP
      connection (pseudowire, LSP or Section).
</p>
<p><a class='info' href='#comment.N3'>[N3]<span> (</span><span class='info'>DF: The question of ACH TLV usage and the manner of supporting metadata such as authentication keys and node identifiers is deliberately omitted. These issues will be addressed in a future version of the document.</span><span>)</span></a><a name='N3'></a>
</p>
<a name="pf_lm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Loss Measurement Message Format</h3>

<p>The format of a Loss Measurement message, beginning with the
        Associated Channel Header (ACH), is as follows:
</p><br /><hr class="insert" />
<a name="pf_lm_f"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0 0 0 1|Version|   Reserved    |  0xHH (MPLS-TP Loss)          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Flags |  Control Code |          Reserved             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Querier Context                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 1                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 4                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Loss Measurement Message Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p style='text-align: left'>The meanings of the fields following the ACH are
          summarized in the following table.
</p><table class="headers" align="left" border="0" cellpadding="2" cellspacing="2">
<col align="left" width="30%"><col align="left">
<tr><th align="left">Field</th><th align="left">Meaning</th></tr>
<tr>
<td align="left">Version</td>
<td align="left">Protocol version</td>
</tr>
<tr>
<td align="left">Flags</td>
<td align="left">Message control flags</td>
</tr>
<tr>
<td align="left">Control Code</td>
<td align="left">Code identifying the query or response type</td>
</tr>
<tr>
<td align="left">Reserved</td>
<td align="left">Reserved for future specification</td>
</tr>
<tr>
<td align="left">Querier Context</td>
<td align="left">Set arbitrarily by the querier</td>
</tr>
<tr>
<td align="left">Counter 1-4</td>
<td align="left">64-bit packet counter values in network byte order</td>
</tr>
</table>
<br clear="all" />

<p>The possible values for these fields are as follows.
</p>
<p>Version: Currently set to 0.
</p>
<p>Flags: Each bit represents a message control flag. The flags,
        listed in left-to-right (most- to least-significant-bit) order, are:
        </p>
<blockquote class="text">
<p>Q/R: Set to 0 for a Query and 1 for a Response.
</p>
<p>Remaining bits: Reserved for future specification and set to
            0.
</p>
</blockquote>

<p>Control Code: Set as follows according to whether the message is a
        Query or a Response as identified by the Q/R flag. </p>
<blockquote class="text">
<p>For a Query: </p>
<blockquote class="text">
<p>0x0: Query (in-band response requested). Indicates that
                this query has been sent over a bidirectional connection and
                the response is expected over the same connection.
</p>
<p>0x1: Query (out-of-band response requested). Indicates that
                the response should be sent via an out-of-band channel.
</p>
<p>0x2: Query (no response requested). Indicates that no
                response to the query should be sent.
</p>
</blockquote>

<p>For a Response: </p>
<blockquote class="text">
<p>0x1: Success. Indicates that the operation was
                successful.
</p>
<p>0x8: Notification - Data Format Invalid. Indicates that the
                query was processed but the format of the data fields in this
                response may be inconsistent. Consequently these data fields
                MUST NOT be used for measurement.
</p>
<p>0x10: Error - Unspecified Error. Indicates that the
                operation failed for an unspecified reason.
</p>
<p>0x11: Error - Unsupported Version. Indicates that the
                operation failed because the protocol version supplied in the
                query message is not supported.
</p>
<p>0x12: Error - Unsupported Control Code. Indicates that the
                operation failed because the Control Code requested an
                operation that is not available for this connection.
</p>
<p>0x13: Error - Authentication Failure. Indicates that the
                operation failed because the authentication data supplied in
                the query was missing or incorrect.
</p>
<p>0x14: Error - Invalid Source Node Identifier. Indicates
                that the operation failed because the Source Node Identifier
                supplied in the query is not expected.
</p>
<p>0x15: Error - Invalid Destination Node Identifier.
                Indicates that the operation failed because the Destination
                Node Identifier supplied in the query is not the identifier of
                this node.
</p>
<p>0x16: Error - Connection Mismatch. Indicates that the
                operation failed because the connection identifier supplied in
                the query did not match the connection over which the query
                was received.
</p>
<p>0x17: Error - Query Rate Exceeded. Indicates that the
                operation failed because the rate of query messages exceeded
                the configured threshold.
</p>
<p>0x18: Error - Administrative Block. Indicates that the
                operation failed because it has been administratively
                disallowed.
</p>
<p>0x19: Error - Temporary Resource Exhaustion. Indicates that
                the operation failed because node resources were not
                available.
</p>
</blockquote>

</blockquote>

<p>Reserved: Currently set to 0.
</p>
<p>Querier Context: Set arbitrarily in a query and copied in the
        response.
</p>
<p>Counter 1-4: Referring to <a class='info' href='#ov_loss'>Section&nbsp;2.2<span> (</span><span class='info'>Packet Loss Measurement</span><span>)</span></a>, when a
        query is sent from A, Counter 1 is set to A_TxP and the other counter
        fields are set to 0. When the query is received at B, Counter 2 is set
        to B_RxP. At this point, B copies Counter 1 to Counter 3 and Counter 2
        to Counter 4, and re-initializes Counter 1 and Counter 2 to 0. When B
        transmits the response, Counter 1 is set to B_TxP. When the response
        is received at A, Counter 2 is set to A_RxP. All counter values MUST
        be in network byte order.
</p>
<a name="pf_dm"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Delay Measurement Message Format</h3>

<p>The format of a Delay Measurement message, beginning with the
        Associated Channel Header (ACH), is as follows:
</p><br /><hr class="insert" />
<a name="pf_dm_f"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |0 0 0 1|Version|   Reserved    |  0xHH (MPLS-TP Delay)         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Flags |  Control Code |  QTF  |  RTF  | RPTF  | Resv  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                         Querier Context                       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                           Timestamp 1                         |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    |                           Timestamp 4                         |
    |                                                               |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ~                             Padding                           ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Delay Measurement Message Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p style='text-align: left'>The meanings of the fields following the ACH are
          summarized in the following table.
</p><table class="headers" align="left" border="0" cellpadding="2" cellspacing="2">
<col align="left" width="30%"><col align="left">
<tr><th align="left">Field</th><th align="left">Meaning</th></tr>
<tr>
<td align="left">Version</td>
<td align="left">Protocol version</td>
</tr>
<tr>
<td align="left">Flags</td>
<td align="left">Message control flags</td>
</tr>
<tr>
<td align="left">Control Code</td>
<td align="left">Code identifying the query or response type</td>
</tr>
<tr>
<td align="left">QTF</td>
<td align="left">Querier timestamp format</td>
</tr>
<tr>
<td align="left">RTF</td>
<td align="left">Responder timestamp format</td>
</tr>
<tr>
<td align="left">RPTF</td>
<td align="left">Responder's preferred timestamp format</td>
</tr>
<tr>
<td align="left">Resv (Reserved)</td>
<td align="left">Reserved for future specification</td>
</tr>
<tr>
<td align="left">Querier Context</td>
<td align="left">Set arbitrarily by the querier</td>
</tr>
<tr>
<td align="left">Timestamp 1-4</td>
<td align="left">128-bit timestamp values</td>
</tr>
<tr>
<td align="left">Padding</td>
<td align="left">Optional padding</td>
</tr>
</table>
<br clear="all" />

<p>The possible values for these fields are as follows.
</p>
<p>Version: Currently set to 0.
</p>
<p>Flags: As specified in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>.
</p>
<p>Control Code: As specified in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>.
</p>
<p>Querier Timestamp Format: The format of the timestamp values
        written by the querier, as specified in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a>.
</p>
<p>Responder Timestamp Format: The format of the timestamp values
        written by the responder, as specified in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a>.
</p>
<p>Responder's Preferred Timestamp Format: The timestamp format
        preferred by the responder, as specified in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a>.
</p>
<p>Resv (Reserved): Currently set to 0.
</p>
<p>Querier Context: Set arbitrarily in a query and copied in the
        response.
</p>
<p>Timestamp 1-4: Referring to <a class='info' href='#ov_delay'>Section&nbsp;2.3<span> (</span><span class='info'>Delay Measurement</span><span>)</span></a>, when a
        query is sent from A, Timestamp 1 is set to T1 and the other timestamp
        fields are set to 0. When the query is received at B, Timestamp 2 is
        set to T2. At this point, B copies Timestamp 1 to Timestamp 3 and
        Timestamp 2 to Timestamp 4, and re-initializes Timestamp 1 and
        Timestamp 2 to 0. When B transmits the response, Timestamp 1 is set to
        T3. When the response is received at A, Timestamp 2 is set to T4. The
        actual formats of the timestamp fields written by A and B are
        indicated by the Querier Timestamp Format and Responder Timestamp
        Format fields respectively.
</p>
<p>Padding: One or more octets of padding may optionally follow the
        Timestamp 4 field in a query, in order to allow for delay measurement
        based on packets of a particular size. The values of the pad octets,
        if present, are arbitrary, and if any are present they will be copied
        in the response.
</p>
<p>The next version of this document will describe a mechanism to
        allow the querier to specify whether the responder should include
        padding in the response.
</p>
<a name="pf_tsf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Timestamp Field Formats</h3>

<p>The following timestamp format field values are specified in this
        document: </p>
<blockquote class="text">
<p>0x0: Network Time Protocol version 4 timestamp format <a class='info' href='#RFC2030'>[RFC2030]<span> (</span><span class='info'>Mills, D., &ldquo;Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI,&rdquo; October&nbsp;1996.</span><span>)</span></a>. This format consists of a 32-bit seconds
            field followed by a 32-bit fractional seconds field, so that it
            can be regarded as a fixed-point 64-bit quantity.
</p>
<p>0x2: IEEE 1588-2008 Precision Time Protocol timestamp format
            <a class='info' href='#IEEE1588'>[IEEE1588]<span> (</span><span class='info'>IEEE, &ldquo;1588-2008 IEEE Standard for a Precision Clock Synchronization           Protocol for Networked Measurement and Control Systems,&rdquo; March&nbsp;2008.</span><span>)</span></a>. This format consists of a 48-bit
            seconds field followed by a 32-bit nanoseconds field.
</p>
</blockquote>

<p>In accordance with Internet standards for network time, the NTP
        timestamp format is the default format used in Delay Measurement
        messages. This format MUST be supported. Support for other timestamp
        formats is OPTIONAL.
</p>
<p>Timestamp formats of n &lt; 128 bits in size SHALL be encoded in
        the 128-bit timestamp fields specified in this document using the n
        high-order bits of the field. The remaining 128 - n low-order bits in
        the field SHOULD be set to 0 and MUST be ignored when reading the
        field.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Operation</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Loss Measurement Procedures</h3>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Initiating a Loss Measurement Operation</h3>

<p>An LM operation for a particular MPLS-TP connection consists of
          sending a sequence (LM[1], LM[2], ...) of LM query messages over the
          connection at a specific rate and processing the responses received,
          if any. As described in <a class='info' href='#ov_loss'>Section&nbsp;2.2<span> (</span><span class='info'>Packet Loss Measurement</span><span>)</span></a>, the packet
          loss associated with the connection during the operation is computed
          as a delta between successive messages; these deltas can be
          accumulated to obtain a running total of the packet loss for the
          connection. The query message transmission rate MUST be sufficiently
          high, given the 64-bit LM message counter size and the speed and
          minimum packet size of the underlying connection, that the ambiguity
          condition noted in <a class='info' href='#ov_loss'>Section&nbsp;2.2<span> (</span><span class='info'>Packet Loss Measurement</span><span>)</span></a> cannot arise.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Transmitting a Loss Measurement Query</h3>

<p>When transmitting an LM Query over an MPLS-TP connection, the
          Version and Reserved fields MUST be set to 0. The Q/R flag MUST be
          set to 0 and the remaining flag bits MUST be set to 0.
</p>
<p>The Control Code field MUST be set to one of the values for Query
          messages listed in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>; if the connection
          is unidirectional, this field MUST NOT be set to 0x0 (Query: in-band
          response requested).
</p>
<p>The Querier Context field can be set arbitrarily.
</p>
<p>The Counter 1 field SHOULD be set to the total count of packets
          transmitted over the connection prior to this LM Query. The
          remaining Counter fields MUST be set to 0.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.3"></a><h3>4.1.3.&nbsp;
Receiving a Loss Measurement Query</h3>

<p>Upon receipt of an LM Query message, the Counter 2 field SHOULD
          be set to the total count of packets received over the connection
          prior to this LM Query.
</p>
<p>At this point the LM Query message must be inspected. If the
          Control Code field is set to 0x2 (no response requested), an LM
          Response message MUST NOT be transmitted. If the Control Code field
          is set to 0x0 (in-band response requested) or 0x1 (out-of-band
          response requested), then an in-band or out-of-band response,
          respectively, SHOULD be transmitted unless this has been prevented
          by an administrative, security or congestion control mechanism.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.4"></a><h3>4.1.4.&nbsp;
Transmitting a Loss Measurement Response</h3>

<p>When constructing a Response to an LM Query, the Version and
          Reserved fields MUST be set to 0. The Q/R flag MUST be set to 1 and
          the remaining flag bits MUST be set to 0.
</p>
<p>The Querier Context field MUST be copied from the LM Query. The
          Counter 1 and Counter 2 fields from the LM Query MUST be copied to
          the Counter 3 and Counter 4 fields, respectively, of the LM
          Response.
</p>
<p>The Control Code field MUST be set to one of the values for
          Response messages listed in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>. The value
          0x10 (Unspecified Error) SHOULD NOT be used if one of the other more
          specific error codes is applicable.
</p>
<p>If the response is transmitted in-band, the Counter 1 field
          SHOULD be set to the total count of packets transmitted over the
          connection prior to this LM Response. If the response is transmitted
          out-of-band, the Counter 1 field MUST be set to 0. In either case,
          the Counter 2 field MUST be set to 0.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.5"></a><h3>4.1.5.&nbsp;
Receiving a Loss Measurement Response</h3>

<p>Upon in-band receipt of an LM Response message, the Counter 2
          field SHOULD be set to the total count of packets received over the
          connection prior to this LM Response.
</p>
<p>Upon out-of-band receipt of an LM Response message, the Counter 1
          and Counter 2 fields MUST NOT be used for purposes of loss
          measurement.
</p>
<p>If the Control Code in an LM Response is anything other than 0x1
          (Success), the counter values in the response MUST NOT be used for
          purposes of loss measurement. When the Control Code indicates an
          error condition, the LM operation SHOULD be suspended and an
          appropriate notification to the user generated. If a temporary error
          condition is indicated, the LM operation MAY be restarted
          automatically.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.6"></a><h3>4.1.6.&nbsp;
Scope of Packet Loss Counters</h3>

<p>By default the packet counts appearing in LM messages on a
          connection MUST include packets transmitted and received over the
          Generic Associated Channel (G-ACh) associated with the connection.
          An implementation MAY provide the means to change the scope of the
          LM counters to exclude some or all G-ACh messages. Care must be
          taken in this case to ensure that the scopes of the counters at both
          ends of a connection agree.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.7"></a><h3>4.1.7.&nbsp;
Message Loss and Packet Misorder Conditions</h3>

<p>Because an LM operation consists of a message sequence with state
          maintained from one message to the next, LM is subject to the
          effects of lost messages and misordered packets in a way that DM is
          not. Because this state exists only on the querier, the handling of
          these conditions is, strictly speaking, a local matter. This
          section, however, presents RECOMMENDED procedures for handling such
          conditions.
</p>
<p>The first kind of anomaly that may occur is that one or more LM
          messages may be lost in transit. The effect of such loss is that
          when an LM Response is next received at the querier, an unambiguous
          interpretation of the counter values it contains may be impossible,
          for the reasons described at the end of <a class='info' href='#ov_loss'>Section&nbsp;2.2<span> (</span><span class='info'>Packet Loss Measurement</span><span>)</span></a>. Whether this is so depends on the number
          of messages lost and the other variables mentioned in that section,
          such as the LM message rate and the connection parameters.
</p>
<p>Another possibility is that LM messages are misordered in
          transit, so that for instance the response to LM[n] is received
          prior to the response to LM[n-1]. A typical implementation will
          discard the late response to LM[n-1], so that the effect is the same
          as the case of a lost message.
</p>
<p>Finally, LM is subject to the possibility that data packets are
          misordered relative to LM messages. This condition can result, for
          example, in a transmit count of 100 and a corresponding receive
          count of 101. The effect here is that the A_TxLoss[n-1,n] value (for
          example) for a given measurement interval will appear to be
          extremely (if not impossibly) large. The other case, where an LM
          message arrives earlier than some of the packets, simply results in
          those packets being counted as lost, which is usually what is
          desired.
</p>
<p>Perhaps the simplest way to detect and handle the case of lost or
          out-of-order LM messages is to incorporate a sequence number in each
          message. Such a sequence number can be inserted within the bounds of
          the Querier Context field provided for implementation-specific use.
          An implementation adopting this approach can now take the following
          actions:
</p>
<p><a class='info' href='#comment.N4'>[N4]<span> (</span><span class='info'>DF: Text to be added here about handling the above conditions with sequence numbers and thresholds.</span><span>)</span></a><a name='N4'></a>
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Delay Measurement Procedures</h3>

<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Transmitting a Delay Measurement Query</h3>

<p>When transmitting a DM Query over an MPLS-TP connection, the
          Version and Reserved fields MUST be set to 0. The Q/R flag MUST be
          set to 0 and the remaining flag bits MUST be set to 0.
</p>
<p>The Control Code field MUST be set to one of the values for Query
          messages listed in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>; if the connection
          is unidirectional, this field MUST NOT be set to 0x0 (Query: in-band
          response requested).
</p>
<p>The Querier Context field can be set arbitrarily.
</p>
<p>The Querier Timestamp Format field MUST be set to the timestamp
          format used by the querier when writing timestamp fields in this
          message; the possible values for this field are listed in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a>. The Responder Timestamp Format and
          Responder's Preferred Timestamp Format fields MUST be set to 0.
</p>
<p>The Timestamp 1 field SHOULD be set to the time at which this DM
          Query is transmitted, in the format indicated by the Querier
          Timestamp Format field. The other timestamp fields MUST be set to
          0.
</p>
<p>One or more pad octets with arbitrary values MAY follow the
          Timestamp 4 field.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Receiving a Delay Measurement Query</h3>

<p>Upon receipt of a DM Query message, the Timestamp 2 field SHOULD
          be set to the time at which this DM Query is received.
</p>
<p>At this point the DM Query message must be inspected. If the
          Control Code field is set to 0x2 (no response requested), a DM
          Response message MUST NOT be transmitted. If the Control Code field
          is set to 0x0 (in-band response requested) or 0x1 (out-of-band
          response requested), then an in-band or out-of-band response,
          respectively, SHOULD be transmitted unless this has been prevented
          by an administrative, security or congestion control mechanism.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Transmitting a Delay Measurement Response</h3>

<p>When constructing a Response to a DM Query, the Version and
          Reserved fields MUST be set to 0. The Q/R flag MUST be set to 1 and
          the remaining flag bits MUST be set to 0.
</p>
<p>The Querier Context and Querier Timestamp Format (QTF) fields
          MUST be copied from the DM Query. The Timestamp 1 and Timestamp 2
          fields from the DM Query MUST be copied to the Timestamp 3 and
          Timestamp 4 fields, respectively, of the DM Response.
</p>
<p>The Responder Timestamp Format (RTF) field MUST be set to the
          timestamp format used by the responder when writing timestamp fields
          in this message, i.e.&nbsp;Timestamp 4 and (if applicable) Timestamp
          1; the possible values for this field are listed in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a>. Furthermore, the RTF field MUST be set
          equal either to the QTF or the RPTF field. See <a class='info' href='#op_dm_tsfn'>Section&nbsp;4.2.5<span> (</span><span class='info'>Timestamp Format Negotiation</span><span>)</span></a> for guidelines on selection of the value
          for this field.
</p>
<p>The Responder's Preferred Timestamp Format (RPTF) field MUST be
          set to one of the values listed in <a class='info' href='#pf_tsf'>Section&nbsp;3.3<span> (</span><span class='info'>Timestamp Field Formats</span><span>)</span></a> and
          SHOULD be set to indicate the timestamp format with which the
          responder can provide the best accuracy for purposes of delay
          measurement.
</p>
<p>The Control Code field MUST be set to one of the values for
          Response messages listed in <a class='info' href='#pf_lm'>Section&nbsp;3.1<span> (</span><span class='info'>Loss Measurement Message Format</span><span>)</span></a>. The value
          0x10 (Unspecified Error) SHOULD NOT be used if one of the other more
          specific error codes is applicable.
</p>
<p>If the response is transmitted in-band, the Timestamp 1 field
          SHOULD be set to the time at which this DM Response is transmitted.
          If the response is transmitted out-of-band, the Timestamp 1 field
          MUST be set to 0. In either case, the Timestamp 2 field MUST be set
          to 0.
</p>
<p>If the response is transmitted in-band and the Control Code in
          the message is 0x1 (Success), then the Timestamp 1 and Timestamp 4
          fields MUST have the same format, which will be the format indicated
          in the Responder Timestamp Format field.
</p>
<p>Padding SHALL be included in the response if, and only if,
          padding was present in the DM Query, in which case the response
          padding MUST be identical to the query padding.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.4"></a><h3>4.2.4.&nbsp;
Receiving a Delay Measurement Response</h3>

<p>Upon in-band receipt of a DM Response message, the Timestamp 2
          field SHOULD be set to the time at which this DM Response is
          received.
</p>
<p>Upon out-of-band receipt of a DM Response message, the Timestamp
          1 and Timestamp 2 fields MUST NOT be used for purposes of delay
          measurement.
</p>
<p>If the Control Code in a DM Response is anything other than 0x1
          (Success), the timestamp values in the response MUST NOT be used for
          purposes of delay measurement. When the Control Code indicates an
          error condition, an appropriate notification to the user SHOULD be
          generated.
</p>
<a name="op_dm_tsfn"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.5"></a><h3>4.2.5.&nbsp;
Timestamp Format Negotiation</h3>

<p>In case either the querier or the responder in a DM transaction
          is capable of supporting multiple timestamp formats, it is desirable
          to determine the optimal format for purposes of delay measurement on
          a particular connection. The procedures for making this
          determination SHALL be as follows.
</p>
<p>Upon sending an initial DM Query over a connection, the querier
          sets the Querier Timestamp Format (QTF) field to its preferred
          timestamp format.
</p>
<p>Upon receiving any DM Query message, the responder determines
          whether it is capable of writing timestamps in the format specified
          by the QTF field. If so, the Responder Timestamp Format (RTF) field
          is set equal to the QTF field. If not, the RTF field is set equal to
          the Responder's Preferred Timestamp Format (RPTF) field.
</p>
<p>The process of changing from one timestamp format to another at
          the responder may result in the Timestamp 1 and Timestamp 4 fields
          in an in-band DM Response having different formats. If this is the
          case, the Control Code in the response MUST NOT be set to 0x1
          (Success). Unless an error condition has occurred, the Control Code
          MUST be set to 0x2 (Notification - Data Format Invalid).
</p>
<p>Upon receiving a DM Response, the querier knows from the RTF
          field in the message whether the responder is capable of supporting
          its preferred timestamp format: if it is, the RTF will be equal to
          the QTF. The querier also knows the responder's preferred timestamp
          format from the RPTF field. The querier can then decide whether to
          retain its current QTF or to change it and repeat the negotiation
          procedures.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
A Uni-format Implementation</h3>

<p>Editor's note. This text on the execution of the protocol on simple
      hardware need further thought and will be updated in the next version of
      this document.
</p>
<p>A simple implementation of this protocol that only understands one
      time format MAY discard all Query messages with a QTF type that it does
      not support. Similarly a simple implementation may discard all Response
      messages with an RTF type that it does not support. Sunch an
      implementation would only successfully execute a delay measurement if
      both the query and response systems were configured to use identical
      formats.
</p>
<a name="con_con"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Congestion Considerations</h3>

<p>An MPLS-TP network may be traffic-engineered in such a way that the
      bandwidth required both for client traffic and for control, management
      and OAM traffic is always available. The following congestion
      considerations therefore apply only when this is not the case.
</p>
<p>The proactive generation of Loss Measurement and Delay Measurement
      messages for purposes of monitoring the performance of an MPLS-TP
      connection naturally results in a degree of additional load placed on
      both the network and the terminal nodes of the connection. When
      configuring such monitoring, operators should be mindful of the overhead
      involved and should choose transmit rates that do not stress network
      resources unduly; such choices must be informed by the deployment
      context. In case of slower links or lower-speed devices, for example,
      lower Loss Measurement message rates can be chosen, up to the limits
      noted at the end of <a class='info' href='#ov_loss'>Section&nbsp;2.2<span> (</span><span class='info'>Packet Loss Measurement</span><span>)</span></a>.
</p>
<p>In general, lower measurement message rates place less load on the
      network at the expense of reduced granularity. For delay measurement
      this reduced granularity translates to a greater possibility that the
      delay associated with a connection temporarily exceeds the expected
      threshold without detection. For loss measurement, it translates to a
      larger gap in loss information in case of exceptional circumstances such
      as lost LM messages or misordered packets.
</p>
<p>When carrying out a sustained measurement operation such as an LM
      operation or continuous pro-active DM operation, the querier SHOULD take
      note of the number of lost measurement messages (queries for which a
      response is never received) and set a corresponding Measurement Message
      Loss Threshold. If this threshold is exceeded, the measurement operation
      SHOULD be suspended so as not to exacerbate the possible congestion
      condition. This suspension SHOULD be accompanied by an appropriate
      notification to the user so that the condition can be investigated and
      corrected.
</p>
<p>From the receiver perspective, the main consideration is the
      possibility of receiving an excessive quantity of measurement messages.
      An implementation SHOULD employ a mechanism such as rate-limiting to
      guard against the effects of this case. Authentication procedures can
      also be used to ensure that only queries from authorized devices are
      processed.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>There are two main types of security considerations associated with
      the exchange of performance monitoring messages such as those described
      in this document: the possibility of a malicious or misconfigured device
      generating an excessive quantity of messages, causing service
      impairment; and the possibility of an unauthorized device learning the
      data contained in or implied by such messages.
</p>
<p>The first consideration is discussed in <a class='info' href='#con_con'>Section&nbsp;6<span> (</span><span class='info'>Congestion Considerations</span><span>)</span></a>. If reception of performance-related data by
      unauthorized devices is an operational concern, message authentication
      procedures such as those described in [xref] should be used to ensure
      that only queries from authorized devices are processed.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>A future version of this document will detail IANA considerations
      for: </p>
<ul class="text">
<li>ACH Channel Types for LM and DM messages
</li>
<li>Timestamp format registry
</li>
<li>LM and DM Control Codes
</li>
</ul>

<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mpls-tp-oam-requirements">[I-D.ietf-mpls-tp-oam-requirements]</a></td>
<td class="author-text">Vigoureux, M. and D. Ward, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mpls-tp-oam-requirements-06.txt">Requirements for OAM in MPLS Transport Networks</a>,&rdquo; draft-ietf-mpls-tp-oam-requirements-06 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mpls-tp-oam-requirements-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5586">[RFC5586]</a></td>
<td class="author-text">Bocci, M., Vigoureux, M., and S. Bryant, &ldquo;<a href="http://tools.ietf.org/html/rfc5586">MPLS Generic Associated Channel</a>,&rdquo; RFC&nbsp;5586, June&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5586.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5654">[RFC5654]</a></td>
<td class="author-text">Niven-Jenkins, B., Brungard, D., Betts, M., Sprecher, N., and S. Ueno, &ldquo;<a href="http://tools.ietf.org/html/rfc5654">Requirements of an MPLS Transport Profile</a>,&rdquo; RFC&nbsp;5654, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5654.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mpls-tp-framework">[I-D.ietf-mpls-tp-framework]</a></td>
<td class="author-text">Bocci, M., Bryant, S., Frost, D., Levrau, L., and L. Berger, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mpls-tp-framework-11.txt">A Framework for MPLS in Transport Networks</a>,&rdquo; draft-ietf-mpls-tp-framework-11 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mpls-tp-framework-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="IEEE1588">[IEEE1588]</a></td>
<td class="author-text">IEEE, &ldquo;1588-2008 IEEE Standard for a Precision Clock Synchronization
          Protocol for Networked Measurement and Control Systems,&rdquo; March&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1305">[RFC1305]</a></td>
<td class="author-text"><a href="mailto:mills@udel.edu">Mills, D.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1305">Network Time Protocol (Version 3) Specification, Implementation</a>,&rdquo; RFC&nbsp;1305, March&nbsp;1992 (<a href="http://www.rfc-editor.org/rfc/rfc1305.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc1305.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2030">[RFC2030]</a></td>
<td class="author-text">Mills, D., &ldquo;<a href="http://tools.ietf.org/html/rfc2030">Simple Network Time Protocol (SNTP) Version 4 for IPv4, IPv6 and OSI</a>,&rdquo; RFC&nbsp;2030, October&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2030.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2679">[RFC2679]</a></td>
<td class="author-text"><a href="mailto:almes@advanced.org">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org">Kalidindi, S.</a>, and <a href="mailto:matt@advanced.org">M. Zekauskas</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2679">A One-way Delay Metric for IPPM</a>,&rdquo; RFC&nbsp;2679, September&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2679.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2680">[RFC2680]</a></td>
<td class="author-text"><a href="mailto:almes@advanced.org">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org">Kalidindi, S.</a>, and <a href="mailto:matt@advanced.org">M. Zekauskas</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2680">A One-way Packet Loss Metric for IPPM</a>,&rdquo; RFC&nbsp;2680, September&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2680.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2681">[RFC2681]</a></td>
<td class="author-text"><a href="mailto:almes@advanced.org">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org">Kalidindi, S.</a>, and <a href="mailto:matt@advanced.org">M. Zekauskas</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2681">A Round-trip Delay Metric for IPPM</a>,&rdquo; RFC&nbsp;2681, September&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2681.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3393">[RFC3393]</a></td>
<td class="author-text">Demichelis, C. and P. Chimento, &ldquo;<a href="http://tools.ietf.org/html/rfc3393">IP Packet Delay Variation Metric for IP Performance Metrics (IPPM)</a>,&rdquo; RFC&nbsp;3393, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3393.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dan Frost (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:danfrost@cisco.com">danfrost@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stewart Bryant (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stbryant@cisco.com">stbryant@cisco.com</a></td></tr>
</table>
</body></html>
