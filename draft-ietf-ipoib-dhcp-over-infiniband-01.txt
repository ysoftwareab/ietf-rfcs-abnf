







INTERNET DRAFT                                                    Vivek Kashyap
<draft-ietf-ipoib-dhcp-over-infiniband-01.txt>                    IBM
Expiration Date: October 2002                                     April 2002


                        DHCP over InfiniBand

Status of this memo

        This document is an Internet-Draft and is in full conformance
        with all provisions of Section 10 of RFC 2026.

        Internet-Drafts are working documents of the Internet
        Engineering Task Force (IETF), its areas, and its working
        groups. Note that other groups may also distribute working
        documents as Internet- Drafts.

        Internet-Drafts are draft documents valid for a maximum of six
        months and may be updated, replaced, or obsoleted by other
        documents at any time. It is inappropriate to use
        Internet-Drafts as Reference material or to cite them other
        than as ``work in progress''.

        The list of current Internet-Drafts can be accessed at
        http://www.ietf.org/ietf/1id-abstracts.txt

        The list of Internet-Draft Shadow Directories can be accessed
        at http://www.ietf.org/shadow.html

        This memo provides information for the Internet community.
        This memo does not specify an Internet standard of any kind.
        Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2001).  All Rights Reserved.

Abstract

        An InfiniBand network uses a link-layer addressing scheme that
        is 20-bytes long. This is larger than the 16-bytes reserved for
        the hardware address in DHCP/BOOTP message. The above
        inequality imposes restrictions on the use of the DHCP message
        fields when used over an IP over InfiniBand(IPoIB) network.
        This document describes the use of DHCP message fields when
        implementing DHCP over IPoIB.




Kashyap                                                         [Page 1]





INTERNET-DRAFT            DHCP over InfiniBand                April 2002


1. Introduction

        The Dynamic Host Configuration Protocol(DHCP) provides a
        framework for passing configuration information to hosts on a
        TCP/IP network [RFC2131]. DHCP is based on the Bootstrap
        Protocol (BOOTP) [RFC951] adding the capability of automatic
        allocation of reusable network addresses and additional
        configuration options [RFC2131,RFC2132].

        The DHCP server receives a broadcast request from the DHCP
        client. The DHCP server uses the client interface's
        hardware-address to unicast a reply back when the client
        doesn't yet have an IP address assigned to it. The 'chaddr'
        field in the DHCP message carries the client's hardware
        address.

        The 'chaddr' field is 16-bytes in length. The IPoIB link-layer
        address is 20-bytes in length. Therefore the IPoIB link-layer
        address will not fit in the 'chaddr' field making it
        impossible for the DHCP server to unicast a reply back to the
        client.

        To ensure interoperability the usage of the fields and the
        method for DHCP interaction must be clarified. This document
        describes the IPoIB specific usage of some fields of DHCP. See
        [RFC2131] for the mechanism of DHCP and the explanations of
        each field.

        The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
        NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and
        "OPTIONAL" in this document are to be interpreted as described
        in RFC 2119 [RFC2119].

2. The DHCP over IPoIB mechanism

        As noted above, because of the link-layer address length being
        larger than the 'chaddr' field length the link-layer address
        is unavailable to the DHCP server. Therefore, a DHCP client
        MUST request that the server sends a broadcast reply by
        setting the BROADCAST flag when IPoIB ARP is not possible i.e.
        in situations where the client does not know its IP address.

        RFC1542 notes that the use of a broadcast reply is discouraged
        but in the case of IPoIB this is a necessity. There is no
        option but to broadcast back to the client since it is not
        possible to reply the client's unicast address. To
        desynchronise broadcasts at subnet startup, the RFC2131
        suggests that a client wait a random time (1 to 10 seconds)



Kashyap                                                         [Page 2]





INTERNET-DRAFT            DHCP over InfiniBand                April 2002


        before initiating server discovery. The same timeout will
        equally spread out the DHCP server broadcast responses
        generated due to the use of the use of the BROADCAST bit.

        The client hardware address, 'chaddr', is unique in the subnet
        and hence can be used to identify the client interface. But in
        the absence of a unique chaddr the client-identifier must be
        used.

        The DHCP protocol states that the 'client identifier' option
        may be used as the unique identifying value for the client.
        This value must be unique within the subnet the client is a
        member of.

        The client identifier option includes a type and identifier
        pair. The identifier included in the client-identifier option
        may consist of a hardware address or any other unique value
        such as the DNS name of the client. When a hardware address is
        used, the type field should be one of the ARP hardware types
        listed in [ARPPARAM]. A type of 0 (zero) should be used when
        the included identifier is other than a hardware address.
        [RFC2132]

        The client-identifier itself SHOULD not be interpreted by the
        server. [RFC2132]

2.1 IPoIB specific usage of DHCP message fields

        A DHCP client, when working over an IPoIB interface, MUST
        follow the following rules:

        'htype' (hardware address type) MUST be 32 [ARPPARAM]

        'hlen' (hardware address length) MUST be 0.

        The 'chaddr' (client hardware address) field MUST be zeroed.
        The server and the relay agent MUST ignore 'chaddr' on
        receipt.

        The 'client identifier' option MUST be used in DHCP messages.
        'client identifier' option MAY consist of any data.










Kashyap                                                         [Page 3]





INTERNET-DRAFT            DHCP over InfiniBand                April 2002



        IPoIB clients SHOULD use the following format for the
        client-identifier option:

    Code  Len   Type  Client-Identifier
   +-----+-----+-----+-----+-----+-----+-----+-------------------....----+
   |  61 | 21  |  32 |Interface-id (4 bytes) |   GID (16 bytes)          |
   +-----+-----+-----+-----+-----+-----+-----+-------------------....----+

        Every IPoIB interface is associated with an identifier
        referred to as the GID [IPoIB_ARCH]. The GID is unique in the
        InfiniBand fabric. An invariant GID is formed by appending the
        port's EUI-64 identifier to the InfiniBand subnet prefix.

        The GID is associated with a particular hardware port. The GID
        and a QPN define an IPoIB interface at the port. Therefore an
        implementation may associate multiple IPoIB interfaces on the
        same port. It is up to the implementation to ensure a unique
        client-identifier when multiple IPoIB interfaces are defined
        over the same port and same GID. A unique, invariant
        'interface-id' value be included in addition to the GID to
        achieve this.

        Note: a port may be associated with multiple GIDs. Therefore,
        multiple IPoIB interfaces may exist on the same port while
        using a different GID from among the GIDs associated with the
        port.

        A unique interface-id may be formed by including the QPN
        associated with the relevant IPoIB interface if the
        implementation is designed to keep this association constant
        across boots. A timestamp or some other value unique to the
        implementation may also be used for the same purpose.

        If there is only one IPoIB interface associated with a
        particular GID, then use of the GID with the 'interface-id'
        zeroed is sufficient. By default, an implementation zeroes out
        the interface-id field in the client identifier described
        above.

        This document does not preclude the use of other 'client
        identifier' type, such as fully qualified domain name(FQDN) or
        the EUI-64 value associated with the interface.

2.2 Use of the BROADCAST flag

        A DHCP client on IPoIB SHOULD set a BROADCAST flag in
        DHCPDISCOVER and DHCPREQUEST messages (and set 'ciaddr' to



Kashyap                                                         [Page 4]





INTERNET-DRAFT            DHCP over InfiniBand                April 2002


        zero) to ensure that the server (or the relay agent)
        broadcasts its reply to the client.

        Note: As described in [RFC2131], 'ciaddr' MUST be filled in
        with client's IP address during BOUND, RENEWING or REBINDING
        state, therefore, the BROADCAST flag MUST NOT be set. In these
        cases, the DHCP server unicasts DHCPACK message to the address
        in 'ciaddr'. The link address will be resolved by IPoIB ARP.

3. Security Considerations

        DHCP currently provides no authentication or security
        mechanisms. Potential exposures to attack are discussed
        in section 7 of the DHCP protocol specification [RFC2131].

        A malicious client can falsify the client-identifier,
        thus masquerading as another client.

4. Acknowledgement

        This document borrows extensively from [RFC 2855]. Roy Larsen
        pointed out the length discrepancy between the IPoIB link
        address and DHCP's chaddr field.

References

        [RFC2119]       Key words for use in RFCs to Indicate Requirement Levels
                        S, Bradner

        [RFC2131]       Dynamic Host Configuration Protocol, R. Droms

        [RFC2132]       DHCP Options and BOOTP Vendor Extensions,
                        S. Alexander, R. Droms

        [RFC951]        Bootstrap Protocol, B. Croft, J. Gilmore

        [RFC1542]       Clarifications and Extensions for the Bootstrap Protocol
                        W. Wimer

        [ARPPARAM]      http://www.iana.org/numbers.html

        [RFC2855]       DHCP for IEEE 1394, K. Fujisawa

        [IPoIB_ARCH]    draft-ietf-ipoib-architecture-01.txt, V. Kashyap

        [IPoIB_ENCAP]   draft-ietf-ipoib-ip-over-infiniband-00.txt,
                        V. Kashyap, H.K. Jerry Chu




Kashyap                                                         [Page 5]





INTERNET-DRAFT            DHCP over InfiniBand                April 2002


Author's Address

   Vivek Kashyap

   IBM
   15450, SW Koll Parkway
   Beaverton
   OR 97006

   Phone: +1 503 578 3422
   EMail: vivk@us.ibm.com

Full Copyright Statement

   Copyright (C) The Internet Society (2000).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.












Kashyap                                                         [Page 6]


