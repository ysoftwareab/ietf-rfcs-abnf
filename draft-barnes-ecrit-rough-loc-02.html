<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Using Imprecise Location for
    Emergency Context Resolution</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Using Imprecise Location for
    Emergency Context Resolution">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">R. Barnes</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">M. Lepinski</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">BBN Technologies</td></tr>
<tr><td class="header">Expires: August 28, 2009</td><td class="header">February 24, 2009</td></tr>
</table></td></tr></table>
<h1><br />Using Imprecise Location for
    Emergency Context Resolution<br />draft-barnes-ecrit-rough-loc-02.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 28, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>Emergency calling works best when precise location is available for
      emergency call routing. However, there are situations in which a
      location provider is unable or unwilling to provide precise location,
      yet still wishes to enable subscribers to make emergency calls. This
      document describes the level of location accuracy that providers must
      provide to enable emergency call routing. In addition, we descibe how
      emergency services and non-emergency services can be invoked by an
      endpoint that does not have access to its precise location.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#term-section">2.</a>&nbsp;
Terminology<br />
<a href="#det-section">3.</a>&nbsp;
Determining sufficient location precision<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#filter-use-section">3.1.</a>&nbsp;
Location filtering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.2.</a>&nbsp;
Constructing location filters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.2.1.</a>&nbsp;
Geodetic service boundaries<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.2.</a>&nbsp;
Civic service boundaries<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.3.</a>&nbsp;
Maintaining location filters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.4.</a>&nbsp;
Applying location filters<br />
<a href="#lbs-section">4.</a>&nbsp;
Requesting emergency and non-emergency services<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.1.</a>&nbsp;
Emergency calling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.2.</a>&nbsp;
Non-emergency services<br />
<a href="#Acknowledgements">5.</a>&nbsp;
Acknowledgements<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">7.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Information about the location of an emergency caller is a critical
      input to the process of emergency call establshment. Endpoint
      location is used to determine which Public Safety Answering Point (PSAP)
      should be the destination of the call. (The entire emergency calling
      process is described in detail in <a class='info' href='#I.D-ietf-ecrit-framework'>[I.D&#8209;ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; September&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#I.D-ietf-ecrit-phonebcp'>[I.D&#8209;ietf&#8209;ecrit&#8209;phonebcp]<span> (</span><span class='info'>Rosen, B. and J. Polk, &ldquo;Best Current Practice for Communications Services in support           of Emergency Calling,&rdquo; September&nbsp;2007.</span><span>)</span></a>.) This process is most likely
      to work properly when the endpoint is provided with the most accurate
      precise information available about its location. Using location
      information with maximal precision and accuracy minimizes the chance
      that a call will be mis-routed. And when that location is provided to
      the endpoint, the endpoint is able to verify that the location is
      correct (to the extent of the endpoint's knowledge of its own location)
      prior to an emergency call, and is able to perform emergency call
      routing functions on its own, providing redundancy for network-provided
      functions.
</p>
<p>However, there may be situations in which it is not feasible for
      endpoints to be provided with maximally precise and accurate location.
      These cases may arise when computing precise location is an expensive or
      time-consuming operation (e.g., in the case of wireless triangulation),
      and location is needed quickly (as is often the case in emergency
      situations). Or they may arise because the policy of the location
      provider does not allow precise location to be provided to the endpoint
      (e.g. due to privacy considerations). While it is undesirable to use
      imprecise location for emergency call routing, the possibility that
      precise location may not be available to the calling device must be
      accomodated in order to make emergency calling possible in the largest
      possible set of circumstances.
</p>
<p>This document is concerned imprecise location only in the context of
      routing emergency calls, i.e., for determining the correct PSAP to
      receive a given call (e.g., via a LoST query <a class='info' href='#I.D-ietf-ecrit-lost'>[I.D&#8209;ietf&#8209;ecrit&#8209;lost]<span> (</span><span class='info'>Hardie, T., Newton, A., Schulzrinne, H., and H. Tschofenig, &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a>).  (More generally, the provided location information will be needed to route the call to an entity that is authorized to request precise location, e.g., an Emergency Services Routing Proxy.)
      
</p>
<p>Location information may also be
      used in the emergency calling framework to direct the dispatch of
      emergency responders. This usage is treated separately from call routing
      for purposes of this document, and this document does not place
      requirements on the location provided for dispatch (although it should
      obviously be as precise as possible). The only provision for dispatch in
      this document is a recommendation that the location provider supply
      endpoints with a URI that can be used by a PSAP or other emergency
      authority to obtain a different location for use in dispatch, hopefully
      more precise than the one used for routing.
</p>
<p>This document describes the use of imprecise location information in
      the emergency call routing system. <a class='info' href='#det-section'>Section&nbsp;3<span> (</span><span class='info'>Determining sufficient location precision</span><span>)</span></a>
      describes how location providers can determine the precision necessary
      to support emergency call routing, and how they can use this information to optimize location delivery. <a class='info' href='#lbs-section'>Section&nbsp;4<span> (</span><span class='info'>Requesting emergency and non-emergency services</span><span>)</span></a>
      describes how emergency calls are placed in such an environment, and how
      non-emergency services can be invoked when precise location is not
      available to the endpoint by value.
</p>
<a name="term-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement           Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>We consider in this document patterns of interaction as described in
      <a class='info' href='#I.D-ietf-ecrit-framework'>[I.D&#8209;ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; September&nbsp;2007.</span><span>)</span></a>. The two main parties of
      interest are endpoints and location providers. Endpoints are hosts
      connected to the Internet that originate emergency calls in the
      emergency calling architecture, while location providers are entities
      that supply location information that is used for emergency calling. In
      addition, we will discuss how these parties interact with the LoST
      mapping infrastructure <a class='info' href='#I.D-ietf-ecrit-mapping-arch'>[I.D&#8209;ietf&#8209;ecrit&#8209;mapping&#8209;arch]<span> (</span><span class='info'>Schulzrinne, H., &ldquo;Location-to-URI Mapping Architecture and Framework,&rdquo; September&nbsp;2007.</span><span>)</span></a>, and with emergency and
      non-emergency location-based service providers.
</p>
<p>For convenience, we say that location information (either in LoST queries or in service boundaries) is provided "in geodetic form" if it is provided in the "geodetic-2d" location profile, and "in civic form" if it is provided in the "civic" profile.
</p>
<a name="det-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Determining sufficient location precision</h3>

<p>A location provider wishing to provide location information usable
      for emergency call routing requires a mechanism for determining when a
      description of location (e.g., a polygon) is precise enough to be used
      for emergency call routing. This mechanism might be used to decide when
      to terminate a positioning mechanism that converges over time, or to
      choose a polygon larger than the known location of the endpoint (in
      order to obscure the known location of the endpoint), while preserving
      the utility of the location for emergency call routing.
</p>
<p>There are two base requirements for a location to be usable for
      emergency call routing: </p>
<ol class="text">
<li>The location SHOULD be sufficiently precise that a LoST request
          with the location and any service URN will return a unique URI
          mapping value. This may not be possible in all cases, e.g., because
          of overlapping service boundaries (leading to areas that do not have
          a unique mapping) or positioning limitations (leading to
          insufficient precision).
</li>
<li>When the location of the endpoint is known by the provider to
          greater precision than is being provided, the provided location MUST
          return the same mappings from LoST (for all service URNs) as the
          known location.
</li>
<li>When the location of the endpoint is known by the provider to
          greater precision than is being provided, the provided location MUST  
          contain the precise location (as a geographic subset).
</li>
</ol><p>In this section, we describe how to use a "location filter" to
      determine whether a given location is usable for emergency call routing,
      and how to construct and maintain such a filter.
</p>
<a name="filter-use-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Location filtering</h3>

<p>With each service-to-URI mapping, a LoST query provides a service
        boundary that represents the set of locations in which that mapping is
        valid. A consequence of this is that given a set of service boundaries
        for difference services (say, one mapping "urn:service:sos.fire" to
        "sip:fire@example.com" and one mapping "urn:service:sos.police" to
        "sip:police@example.com"), the intersection of those service
        boundaries is the region in which two mappings are valid
        ("urn:service:sos.fire" maps to "sip:fire@example.com" and
        "urn:service:sos.police" maps to "sip:police@example.com"). Outside
        that area, one or more of the mappings is invalid. Said differently,
        any region contained in an intersection uniquely determines mappings
        for the services used in the intersection, and any two locations
        within the same intersection are equivalent for the purpose of LoST
        mapping (i.e., emergency call routing).
</p>
<p>A location filter is thus a set of regions (optionally, each region
        may be assigned a list of LoST mappings), as illustrated in <a class='info' href='#filter-fig'>Figure&nbsp;1<span> (</span><span class='info'>Generating a filter from service boundaries</span><span>)</span></a>. Each
        region is the intersection of the service boundaries for all services
        available within the region, and the lists represent the mappings that
        are valid within that region. A filter is used to determine whether a
        location is useable for emergency call routing in the following
        way:</p>
<ol class="text">
<li>The location SHOULD be contained in exactly one of the regions
            in the filter. This guarantees that LoST mappings are unique.
</li>
<li>When the precise location of the endpoint is known, the provided
            location MUST be contained in the same region(s) of the filter as
            the known location. This guarantees that LoST queries with the
            provided location return the same results as those done with the
            known location.
</li>
<li>When the precise location of the endpoint is known, the provided 
            location MUST contain the precise location (as a geographic subset).
</li>
</ol><p>When the regions are bound to lists of URN-URI mappings, the
        resulting filter can also be used as a cache for LoST mappings; the
        LoST mappings for a location are the mappings bound to the
        region(s) containing it. 
</p><br /><hr class="insert" />
<a name="filter-fig"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
               Service boundaries for individual services

             urn:service:sos.police    urn:service:sos.fire

                  +-------+                +-------+
                  | A     |                | C     |
                  |       +---+            |   +---+---+
                  |       |   |            |   |       |
                  +---+---+   |            +---+       |
                      |     B |                |     D |
                      +-------+                +-------+

                        |                        |
                        |                        |
                        +-----------+------------+
                                    |
                                    V

                            +-------+
                            | A,C   |
                            |   +---+
                            |   | +---+
                            +---+ |A,D| +---+
                                  +---+ |   |
                                    +---+   |
                                    |   B,D |
                                    +-------+

                     Resulting Location Filter Regions
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Generating a filter from service boundaries&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>When the location of the endpoint is known to more precision than
        the location provided to the endpoint, although any location meeting
        the two criteria above is equivalent to the known location for
        purposes of LoST, the provided location MUST contain the known
        location in order to avoid errors if the location is used for other
        purposes in the course of an emergency (e.g., if the location is
        provided to first responders for dispatch). This guarantee also allows
        the endpoint to do some course verification that the provided location
        is correct (in order to prevent very gross errors in routing).
        Thus, any location that (1) contains the known location and (2)
        is contained in the same filter region as the known location is
        allowable.  Locations that also are contained in only one filter region
        are preferred.  Adding randomness to the provided locations may have
        privacy benefits in some cases, as discussed in the security
        considerations below.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Constructing location filters</h3>

<p>For simplicity, we assume that the entity performing filtering will
        only be using the filter to test locations contained within a
        particular geographic "coverage area".  (In principle, this coverage area
        could be the entire world, but assuming a more limited coverage area allows
        for a filter to be built more quickly) Given a coverage area and the ability 
        to act as a LoST client, a location service provider can autonomously compute a
        location filter using the following algorithm:
</p>
<p>First, the server must obtain mappings and service boundaries for all services and for all
        points within the coverage area.  For each emergency service URN, the server goes through the following process to build a service map: First, the server queries LoST for the complete coverage map for the desired service.  This can be done with a LoST &lt;findService&gt; query of the following form:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        &lt;?xml version="1.0" encoding="UTF-8"?&gt;
        &lt;findService
             xmlns="urn:ietf:params:xml:ns:lost1"
             serviceBoundary="value"&gt;
          &lt;location&gt;
            &lt;!-- Coverage Area --&gt;
          &lt;/location&gt;
          &lt;service&gt;
            &lt;!-- Service URN --&gt;
          &lt;/service&gt;
        &lt;/findService&gt;

</pre></div>
<p>If LoST returns a set of mappings whose service boundaries cover the coverage area (i.e., if LoST is configured to return all possible matches for the queried location), then the process termintes here.  The coverage map for this service is the set of returned service boundaries.
        
</p>
<p>If service boundaries in the LoST response to the above query do not cover the location provider's coverage area, then the location server must perform further queries.  The location included in each query is the difference between the coverage area and the current coverage map, that is, the coverage area with all currently-known service boundaries removed.  The server repeats this process (query, then remove service boundaries from the query location, then query again) until either (1) the coverage area is covered by the collected service boundaries or (2) LoST returns a &lt;notFound&gt; error.
        
</p>
<p>After the location server has performed this procedure for each service, it will have a set of LoST mappings for each service, for every point in its coverage region where that service is offered.
</p>
<p>The regions in the location filter are computed separately for service boundaries provided in civic form and in geodetic form.  If all service boundaries are provided in one form (e.g., if all boundaries are provided in geodetic form, even if some are also provided in civic form), the server MAY perform the algorithm for that form.  If both algorithms are being performed, and some mappings provide both civic and geodetic service boundaries, the server MUST input those mappings to both the civic and geodetic computations.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
Geodetic service boundaries</h3>

<p>The regions in the location filter are computed from these mappings by iterating over URI
        tuples: For each service URN, let uris(urn) be the set of PSAP URIs
        for that service URN (collected from the mappings). The set of URI
        tuples is then the cartesian product of these sets; if the set of
        servuce URNs is {urn1,...,urnN}, then the set of URI tuples is
        uris(urn1) x ... x uris(urnN). The server computes the regions in the
        filter by iterating through the set of URI tuples, either by
        constructing the set of URI tuples and directly iterating, or by using
        nested iteration through all the sets uris(urn).
</p>
<p>For each URI tuple, the server MUST compute the intersection of the
        service boundaries for the URIs in the tuple. This becomes an entry in
        the location filter: The stored region is the intersection of the
        service boundaries, and the corresponding mapping table is the list of
        (URN, URI) pairs, where the URIs are the URIs from the tuple and the
        URNs are the services used to obtain them from LoST. (Empty filter regions, corresponding to URIs in a tuple with disjoint service boundaries, can of course be discarded.)
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
Civic service boundaries</h3>

<p>As in the case of geodetic location, regions of a civic address filter are computed based on URI-tuples.  For tuples where all mappings have the same service boundary, that service boundary MUST be used as the filter region for that type.  For all other cases (i.e., tuples with different civic locations), the regions of the filter must be computed as the intersections of the locations according to an algorithm that is determined by local addressing standards.
</p>
<p>Note that the resulting filter regions MUST still cover the location server's coverage area.  In particular, the server MUST NOT use a specific  address a filter region: Such an address would not include many points in the service region (i.e., it would not meet the third rules from both lists of rules above).  
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Maintaining location filters</h3>

<p>As the LoST mappings that underlie the filter change, the filter
        will need to be updated. The entity maintaining the filter MUST obtain
        a new mapping for a region when an existing mapping expires. The
        service boundary from the new mapping is compared to the service
        boundary from the old mapping: If they are the same, then the filter
        need not be updated. If they differ, then regions in the filter that
        intersect either the old service boundary or the new service
        boundary will need to be recomputed. Note that since this operation
        only requires the server to determine if two service boundaries are
        identical, the server need only store a hash of the old boundary (to
        which it can compare a hash of the new boundary).
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Applying location filters</h3>

<p>
      	After constructing a location filter, a location server can use it to optimize how it delivers location.  When the location server is using a positioning algorithm that grows more accurate with time, the filter tells it how long to run the algorithm.  Namely, the algorithm can be terminated when the estimated location is within one of the regions in the filter.
      	
</p>
<p>
      	When the location provider knows the precise location of the caller, a location filter can also be used as a "location cache".  That is, the location provider can simply look up which of the filter regions contains the caller's precise location and return that region as the caller's location (or some subset that contains the precise location). 
      	
</p>
<p>
      	This allows an additional optimization in some cases: If the location server knows that the caller's precise location will be within the same region for a period of time, it can instruct the client not to re-query in that time.  For instance, if the server is delivering location over HELD, then it can use the HTTP cache-control headers (e.g., Expires).  However, the location server MUST NOT instruct the client to wait for longer than the current filter is valid; the expiry time of the location MUST be before the earliest expiry of a LoST mapping used in the filter.
      	
</p>
<a name="lbs-section"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requesting emergency and non-emergency services</h3>

<p>When a location provider wishes to deliver endpoints location information that
      is below its maximum available precision while still supporting emergency
      calling, it MUST provide to the endpoint both a location (by value) that
      is sufficient for emergency call routing (see above) and a location
      reference (i.e., a URI) that can subsequently be used by authorized
      parties to obtain more precise information about the location of the
      endpoint. The endpoint then can then use both the location value and the
      location reference to request location-based services (LBS) as described
      below.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Emergency calling</h3>

<p>The procedure for placing an emergency call is indentical to that
        described in <a class='info' href='#I.D-ietf-ecrit-framework'>[I.D&#8209;ietf&#8209;ecrit&#8209;framework]<span> (</span><span class='info'>Rosen, B., Schulzrinne, H., Polk, J., and A. Newton, &ldquo;Framework for Emergency Calling using Internet           Multimedia,&rdquo; September&nbsp;2007.</span><span>)</span></a>. In
        particular, the endpoint requirements in Sections 8 and 9 of <a class='info' href='#I.D-ietf-ecrit-phonebcp'>[I.D&#8209;ietf&#8209;ecrit&#8209;phonebcp]<span> (</span><span class='info'>Rosen, B. and J. Polk, &ldquo;Best Current Practice for Communications Services in support           of Emergency Calling,&rdquo; September&nbsp;2007.</span><span>)</span></a> still apply to an endpoint
        that receives imprecise location.
</p>
<p>In addition, an endpoint that receives
        location both by value and by reference from its location provider
        MUST include both the location value and the location reference in the
        SIP INVITE message that initiates an emergency call, as specified in
        <a class='info' href='#I.D-ietf-sip-location-conveyance'>[I.D&#8209;ietf&#8209;sip&#8209;location&#8209;conveyance]<span> (</span><span class='info'>Polk, J. and B. Rosen, &ldquo;Location Conveyance for the Session Initiation           Protocol,&rdquo; July&nbsp;2007.</span><span>)</span></a>. When the
        endpoint supports LoST, it SHOULD use the location value to obtain a
        PSAP URI for LoST queries (as opposed to attempting to dereference the
        location reference).  Note that the caller would also have to add the "used-for-routing"
        parameter to the geolocation header that points to the location value
        as inserted into the INVITE message. Note that this process crucially
        relies on the location value having sufficient precision for routing
        emergency calls (see <a class='info' href='#det-section'>Section&nbsp;3<span> (</span><span class='info'>Determining sufficient location precision</span><span>)</span></a> for techniques
        to ensure the location value is suitable for emergency call
        routing).
</p>
<p>When a PSAP receives a SIP INVITE that contains both a location
        value and a location reference, if the value is too imprecise for use
        in dispatch then the PSAP SHOULD dereference the LbyR to obtain more
        precise information. In turn, the location provided by the location
        provider MUST allow access by all PSAPs whose service boundaries
        overlap with the region served by the location provider. This means
        that either the provider must supply a reference that can be
        dereferenced by any party, or else the provider must establish
        explicit authentication and authorization relationships with all PSAPs
        in its service area.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Non-emergency services</h3>

<p>Non-emergency LBSs will generally require more precise information
        than is required for emergency call routing. Therefore, when
        requesting a non-emergency LBS, the endpoint SHOULD include the
        location reference provided by its location provider, and MAY
        additionally provide the location value. If the provided location
        value is not sufficiently precise to deliver the requested service, then
        the LBS provider should then dereference the location value to request
        location information of sufficient precision from the location
        provider. If the dereference fails, then the request for service may
        fail as well.
</p>
<p>Note that when the location reference provided by the location
        provider is access-controled, this dereference may require a
        pre-existing authentication and authorization agreement between the
        LBS provider and the location provider. In such a case, the endpoint
        may not know whether a given non-emergency service is authorized to
        obtain the endpoint's precise location using the location reference.
        The endpoint is always capable of requesting services without knowing
        whether they are authorized; in this way, the endpoint can discover
        authorized services by trial and error. In order to simplify this
        process, a location provider may supply the endpoint with references
        to authorized service providers, although there is currently no
        standard protocol for this transaction.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>This document generalizes the concept of "rough location" that was
      originally discussed in the context of the location hiding problem. This
      concept was put forward by Henning Schulzrinne and Andy Newton, among
      many others, in a long-running ECRIT discussion. 
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>The use of rough location to support emergency calling enables a location
      provider to provide low-precision location with low assurance (e.g., of requestor identity)
      and high-precision location with higher assurance.  The fact that lower-precision location
      has lower value -- to location providers and LBS providers as a commercial asset, and to targets as 
      private information -- this trade-off allows a location provider to avoid the cost of protecting 
      location with high-assurance access controls when this location has low value. 
</p>
<p>However, in order to support emergency services, this expense cannot be avoided entirely.
      Because PSAPs require high-precision location for emergency response planning, a location provider
      that normally provides rough location MUST provide a location URI that a PSAP can use to obtain
      high-precision location.  This constraint means that the provided URI MUST have either no
      access control at all or a policy that allows access by appropriate PSAPs (and other emergency
      response systems, e.g., ESRPs).  That is, if such a location URI is access controlled, then the
      location provider MUST be able to authenticate requests from PSAPs.
</p>
<p>One reason for an LIS to provide location information below its
      maximum precision is to protect the privacy of the target. Some location
      provisioning protocols do not enable the location provider to obtain
      strong assurance of the identity of the location recipient; in
      particular, the location provider may be unable to verify that the
      recipient is the target of the location being provided. Therefore, there
      is a risk that a sufisticated attacker might be able to spoof the
      identifier (e.g. IP address) used by the location provider to identify
      the target, and obtain the target's location in this way. One way to
      mitigate this risk is to provide only imprecise location information to
      the end-point (without authentication), and to provide precise
      information only to trusted entities that can authenticate themselves to
      the location provider. Additionally, in some deployment scenarios,
      location providers have concerns about the comprimise of endpoint
      devices. Providing only imprecise location to the endpoint, prevents
      malware on a comprised device from obtaining the precise location of the
      target.
</p>
<p>As described in <a class='info' href='#filter-use-section'>Section&nbsp;3.1<span> (</span><span class='info'>Location filtering</span><span>)</span></a> above, the
      location provider choosing to provide a less precise location than a
      known location has a significant amount of choice in deciding which
      location to provide: Any location that contains the known location and
      is in the same filter region will do. When the provider is reducing
      precision for privacy purposes, there is a signficant benefit to
      choosing a random location meeting these criteria. If a watcher is
      interested in whether or not the endpoint is moving, an imprecise
      location may still reveal that fact if it is constant when the endpoint
      is at rest. If the provided location is randomized each time it is
      provided, then the watcher is unable to obtain even this level of
      information.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I.D-ietf-ecrit-framework">[I.D-ietf-ecrit-framework]</a></td>
<td class="author-text">Rosen, B., <a href="mailto:">Schulzrinne, H.</a>, <a href="mailto:">Polk, J.</a>, and <a href="mailto:">A. Newton</a>, &ldquo;Framework for Emergency Calling using Internet
          Multimedia,&rdquo; September&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="I.D-ietf-ecrit-lost">[I.D-ietf-ecrit-lost]</a></td>
<td class="author-text">Hardie, T., <a href="mailto:">Newton, A.</a>, <a href="mailto:">Schulzrinne, H.</a>, and <a href="mailto:">H. Tschofenig</a>, &ldquo;LoST: A Location-to-Service Translation Protocol,&rdquo; September&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="I.D-ietf-ecrit-phonebcp">[I.D-ietf-ecrit-phonebcp]</a></td>
<td class="author-text">Rosen, B. and <a href="mailto:">J. Polk</a>, &ldquo;Best Current Practice for Communications Services in support
          of Emergency Calling,&rdquo; September&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="I.D-ietf-sip-location-conveyance">[I.D-ietf-sip-location-conveyance]</a></td>
<td class="author-text">Polk, J. and <a href="mailto:">B. Rosen</a>, &ldquo;Location Conveyance for the Session Initiation
          Protocol,&rdquo; July&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text">Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement
          Levels,&rdquo; March&nbsp;1997.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I.D-ietf-ecrit-mapping-arch">[I.D-ietf-ecrit-mapping-arch]</a></td>
<td class="author-text">Schulzrinne, H., &ldquo;Location-to-URI Mapping Architecture and Framework,&rdquo; September&nbsp;2007.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Richard Barnes</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BBN Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9861 Broken Land Pkwy, Suite 400</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Columbia, MD  21046</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 410 290 6169</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rbarnes@bbn.com">rbarnes@bbn.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Matt Lepinski</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BBN Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">10 Moulton St</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cambridge, MA  02138</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 617 873 5939</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:mlepinski@bbn.com">mlepinski@bbn.com</a></td></tr>
</table>
</body></html>
