<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Metering and marking behaviour of
    PCN-nodes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Metering and marking behaviour of
    PCN-nodes">
<meta name="keywords" content="Sample, Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">PCN Working Group</td><td class="header">Philip. Eardley (Editor)</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">BT</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">May 08, 2009</td></tr>
<tr><td class="header">Expires: November 9, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Metering and marking behaviour of
    PCN-nodes<br />draft-ietf-pcn-marking-behaviour-03</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on November 9, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>The objective of Pre-Congestion Notification (PCN) is to protect the
      quality of service (QoS) of inelastic flows within a Diffserv domain, in
      a simple, scalable and robust fashion. This document specifies the two
      metering and marking behaviours of PCN-nodes. Threshold-metering and
      -marking marks all PCN-packets if the PCN traffic rate is greater than a
      configured rate ("PCN-threshold-rate"). Excess-traffic-metering and
      -marking marks a proportion of PCN-packets, such that the amount marked
      equals the traffic rate in excess of a configured rate
      ("PCN-excess-rate"). The level of marking allows PCN-boundary-nodes to
      make decisions about whether to admit or terminate PCN-flows.
</p>
<h3>Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Terminology<br />
<a href="#anchor3">2.</a>&nbsp;
Specified PCN-metering and -marking behaviours<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Behaviour aggregate classification function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
Dropping function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.3.</a>&nbsp;
Threshold-meter function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.4.</a>&nbsp;
Excess-traffic-meter function<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">2.5.</a>&nbsp;
Marking function<br />
<a href="#IANA">3.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">4.</a>&nbsp;
Security Considerations<br />
<a href="#Acknowledgements">5.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor9">6.</a>&nbsp;
Changes (to be removed by RFC Editor)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.1.</a>&nbsp;
Changes to -03 from -02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.2.</a>&nbsp;
Changes to -02 from -01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.3.</a>&nbsp;
Changes to -01 from -00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.4.</a>&nbsp;
Changes to -00<br />
<a href="#rfc.references1">7.</a>&nbsp;
Informative References<br />
<a href="#anchor15">Appendix&nbsp;A.</a>&nbsp;
Example algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">A.1.</a>&nbsp;
Threshold-metering and -marking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">A.2.</a>&nbsp;
Excess-traffic-metering and -marking<br />
<a href="#anchor18">Appendix&nbsp;B.</a>&nbsp;
Implementation notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">B.1.</a>&nbsp;
Competing-non-PCN-traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">B.2.</a>&nbsp;
Scope<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">B.3.</a>&nbsp;
Behaviour aggregate classification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">B.4.</a>&nbsp;
Dropping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">B.5.</a>&nbsp;
Threshold-metering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">B.6.</a>&nbsp;
Excess-traffic-metering<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">B.7.</a>&nbsp;
Marking<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The objective of Pre-Congestion Notification (PCN) is to protect the
      quality of service (QoS) of inelastic flows within a Diffserv domain, in
      a simple, scalable and robust fashion. Two mechanisms are used:
      admission control, to decide whether to admit or block a new flow
      request, and (in abnormal circumstances) flow termination to decide
      whether to terminate some of the existing flows. To achieve this, the
      overall rate of PCN traffic is metered on every link in the domain, and
      PCN packets are appropriately marked when certain configured rates are
      exceeded. These configured rates are below the rate of the link thus
      providing notification to boundary nodes about overloads before any
      congestion occurs (hence "pre-congestion notification"). The level of
      marking allows boundary nodes to make decisions about whether to admit
      or terminate.
</p>
<p>This document standardises the two metering and marking behaviours of
      PCN-nodes. Their aim is to enable PCN-nodes to give an "early warning"
      of potential congestion before there is any significant build-up of
      PCN-packets in their queues. In summary, their objectives are:
</p>
<p></p>
<ul class="text">
<li>threshold-metering and -marking: its objective is to mark all
          PCN-packets (with a "threshold-mark") whenever the rate of
          PCN-packets is greater than its configured rate
          ("PCN-threshold-rate");
</li>
<li>excess traffic marking: whenever the rate of PCN-packets is
          greater than its configured rate ("PCN-excess-rate"), its objective
          is to mark PCN-packets (with an "excess-traffic-mark") at a rate
          equal to the difference between the bit rate of PCN-packets and the
          PCN-excess-rate.
</li>
</ul>

<p><a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a> defines a broadly RED-like default
      congestion marking behaviour, but allows alternatives to be defined;
      this document defines such an alternative.
</p>
<p>Section 2 below specifies the functions involved, which in outline
      (see Figure 1) are:
</p>
<p></p>
<ul class="text">
<li>Behaviour aggregate (BA) classification: decide whether an
          incoming packet is a PCN-packet or not.
</li>
<li>Dropping (optional): drop packets if the link is overloaded.
</li>
<li>Threshold-meter: determine whether the rate of PCN-packets is
          greater than its configured PCN-threshold-rate. The meter operates
          on all PCN-packets on the link, and not on individual flows.
</li>
<li>Excess-traffic-meter: measure by how much the rate of PCN-packets
          is greater than its configured PCN-excess-rate. The meter operates
          on all PCN-packets on the link, and not on individual flows.
</li>
<li>PCN-mark: actually mark the PCN-packets, if the meter functions
          indicate to do so.
</li>
</ul>

<p>
</p>
<p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                       +---------+   Result
                                    +-&gt;|Threshold|-------+
                                    |  |  Meter  |       |
                                    |  +---------+       V
         +----------+   +- - - - -+  |                +------+
         |   BA     |   |         |  |                |      |    Marked
Packet =&gt;|Classifier|==&gt;| Dropper |==?===============&gt;|Marker|==&gt; Packet
Stream   |          |   |         |  |                |      |    Stream
         +----------+   +- - - - -+  |                +------+
                                    |  +---------+       ^
                                    |  | Excess  |       |
                                    +-&gt;| Traffic |-------+
                                       |  Meter  |   Result
                                       +---------+
</pre></div>
<p>Figure 1: Schematic of functions for PCN-metering and
          -marking
</p>

<p>Appendix A gives an example of algorithms that fulfil the
      specification of Section 2, and Appendix B provides some explanations of
      and comments on Section 2. Both the Appendices are informative.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Terminology</h3>

<p>In addition to the terminology defined in <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a> and <a class='info' href='#RFC2474'>[RFC2474]<span> (</span><span class='info'>Nichols, K., Blake, S., Baker, F., and D. Black, &ldquo;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers,&rdquo; December&nbsp;1998.</span><span>)</span></a>, the following terms are defined:
</p>
<p></p>
<ul class="text">
<li>Competing-non-PCN-packet: a non PCN-packet that shares a link
            with PCN-packets and competes with them for its forwarding
            bandwidth. Competing-non-PCN-packets MUST NOT be PCN-marked (ie
            only PCN-packets can be PCN-marked). Note: In general it is not
            advised to have any competing-non-PCN-traffic.
</li>
<li>Metered-packet: a packet that is metered by the metering
            functions specified in Sections 2.3 and 2.4. A PCN-packet MUST be
            treated as a metered-packet (with the minor exception noted below
            in Section 2.4). A competing-non-PCN-packet MAY be treated as a
            metered-packet.
</li>
</ul>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Specified PCN-metering and -marking behaviours</h3>

<p>This section specifies the two PCN-metering and -marking behaviours.
      The descriptions are functional and are not intended to restrict the
      implementation. The informative Appendices supplement this section.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Behaviour aggregate classification function</h3>

<p>A PCN-node MUST classify a packet as a PCN-packet if the value of
        its DSCP and ECN fields correspond to a PCN-enabled codepoint, as
        defined in the encoding scheme applicable to the PCN-domain. Otherwise
        the packet MUST NOT be classified as a PCN-packet.
</p>
<p>A PCN-node MUST classify a packet as a competing-non-PCN-packet if
        it is not a PCN-packet and it competes with PCN-packets for its
        forwarding bandwidth on a link.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Dropping function</h3>

<p>Note: if the PCN-node's queue overflows then naturally packets are
        dropped. This section describes additional action.
</p>
<p>On all links in the PCN-domain, dropping MAY be done by:
</p>
<p></p>
<ul class="text">
<li>metering all metered-packets to determine if the rate of
            metered-traffic is greater than its scheduling rate (ie determine
            if any packets are out-of-profile).
</li>
<li>if the rate of metered-traffic is too high, then drop
            metered-packets.
</li>
</ul><p>If the PCN-node drops PCN-packets then:</p>
<ul class="text">
<li>PCN-packets that arrive at the PCN-node already
            excess-traffic-marked SHOULD be preferentially dropped;
</li>
<li>the PCN-node's excess-traffic-meter SHOULD NOT meter the
            PCN-packets that it drops.
</li>
</ul>

<p>
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
Threshold-meter function</h3>

<p>A PCN-node MUST implement a threshold-meter that has behaviour
        functionally equivalent to the following.
</p>
<p>The meter acts like a token bucket, which is sized in bits and has
        a configured bit rate, termed PCN-threshold-rate. The amount of tokens
        in the token bucket is termed Ttm. Tokens are added at the
        PCN-threshold-rate, to a maximum value BStm. Tokens are removed equal
        to the size in bits of the metered-packet, to a minimum Ttm=0.
        (Explanation of abbreviations: T is short for Tokens, BS for bucket
        size, and tm for threshold-meter.)
</p>
<p>The token bucket has a configured intermediate depth, termed
        threshold. If Ttm &lt; threshold, then the meter indicates to the
        marking function that the packet is to be threshold-marked; otherwise
        it does not.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Excess-traffic-meter function</h3>

<p>A PCN-packet SHOULD NOT be metered (by this excess-traffic-meter
        function) in the following two cases:
</p>
<p></p>
<ul class="text">
<li>If the packet is already excess-traffic-marked on arrival at
            the PCN-node;
</li>
<li>If this PCN-node drops the packet.
</li>
</ul>

<p>Otherwise the PCN-packet MUST be treated as a metered-packet, that
        is it is metered by the excess-traffic-meter.
</p>
<p>A PCN-node MUST implement an excess-traffic-meter that has
        behaviour functionally equivalent to the following.
</p>
<p>The meter acts like a token bucket, which is sized in bits and has
        a configured bit rate, termed PCN-excess-rate. The amount of tokens in
        the token bucket is termed Tetm. Tokens are added at the
        PCN-excess-rate, to a maximum value BSetm. Tokens are removed equal to
        the size in bits of the metered-packet, to a minimum Tetm=0. If the
        token bucket is empty (Tetm = 0), then the meter indicates to the
        marking function that the packet is to be excess-traffic-marked.
        (Explanation of abbreviations: T is short for Tokens, BS for bucket
        size, and etm for excess-traffic-meter.)
</p>
<p>In addition to the above, if the token bucket is within an MTU of
        being empty, then the meter SHOULD indicate to the marking function
        that the packet is to be excess-traffic-marked; MTU means the maximum
        size of PCN-packets on the link ("packet size independent
        marking").
</p>
<p>Otherwise the meter MUST NOT indicate marking.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Marking function</h3>

<p>A PCN-packet MUST be marked to reflect the metering results by
        setting its encoding state appropriately, as specified by the specific
        encoding scheme that applies in the PCN-domain. A consistent choice of
        encoding scheme MUST be made throughout a PCN-domain.
</p>
<p>A PCN-node MUST NOT:
</p>
<p></p>
<ul class="text">
<li>PCN-mark a packet that is not a PCN-packet;
</li>
<li>change a non PCN-packet into a PCN-packet;
</li>
<li>change a PCN-packet into a non PCN-packet.
</li>
</ul>

<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
IANA Considerations</h3>

<p>This document makes no request of IANA.
</p>
<p>Note to RFC Editor: this section may be removed on publication as an
      RFC.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Security Considerations</h3>

<p>Security considerations are discussed in detail in <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a>.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Acknowledgements</h3>

<p>This document is the result of extensive collaboration within the PCN
      WG. Amongst the most active contributors to the development of the ideas
      specified in this document have been Jozef Babiarz, Bob Briscoe, Kwok-Ho
      Chan, Anna Charny, Philip Eardley, Georgios Karagannis, Michael Menth,
      Toby Moncaster, Daisuke Satoh, and Joy Zhang. Appendix A is based on
      text from Michael Menth.
</p>
<p>This document is a development of <a class='info' href='#I-D.briscoe-tsvwg-cl-phb'>[I&#8209;D.briscoe&#8209;tsvwg&#8209;cl&#8209;phb]<span> (</span><span class='info'>Briscoe, B., &ldquo;Pre-Congestion Notification marking,&rdquo; October&nbsp;2006.</span><span>)</span></a>. Its authors are therefore
      contributors to this document: Bob Briscoe, Philip Eardley, Dave
      Songhurst, Francois Le Faucheur, Anna Charny, Vassilis Liatsos, Jozef
      Babiarz, Kwok-Ho Chan, Stephen Dudley, Georgios Karagiannis, Attila
      Bader, Lars Westberg.
</p>
<p>Thanks to those who've made comments on this draft: Michael Menth,
      Joe Babiarz, Fred Baker, Bob Briscoe, Ken Carlberg, Anna Charny,
      Ruediger Geib, Wei Gengyu, Fortune Huang, Christian Hublet, Ingemar
      Johansson, Georgios Karagiannis, Toby Moncaster, Dimitri Papadimitriou,
      Daisuke Satoh. Michael Menth, Joe Babiarz, Anna Charny reviewed a
      preliminary version of the prior individual internet draft.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Changes (to be removed by RFC Editor)</h3>

<p>
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Changes to -03 from -02</h3>

<p>Updates to take account of last call comments as follows:
</p>
<p></p>
<ul class="text">
<li>renamed from "marking" to "metering and marking" (throughout) -
            the former was intended as shorthand for the latter, but this was
            found confusing
</li>
<li>added 'common capsule' summary of PCN to Introduction and
            removed extraneous material
</li>
<li>replaced the term 'traffic conditioning' by 'dropping'
            (throughout) - since the former has a wider meaning than just
            dropping.
</li>
<li>discussion of the case with baseline encoding where there are
            two PCN states - this is now done just once - in Section B.2.
</li>
<li>added in Section B.5 "The PCN-threshold-rate is configured at
            less than the rate allocated to the PCN-traffic class" and in B.6
            "The PCN-excess-rate is configured at less than (or possibly equal
            to) the rate allocated to the PCN-traffic class".
</li>
<li>configuring the PCN-excess-rate at greater than (or possibly
            equal to) the PCN-threshold-rate - this is now in one place, as
            advice is B5 &amp; B6.
</li>
<li>SB.1: "voice-admit" corrected with references to I-D
            ietf-tsvwg-admitted-realtime-dscp and RFC5127.
</li>
<li>"CL/SM edge behaviour" altered to the less obscure "controlled
            load edge behaviour" and a reference added.
</li>
<li>S2.3, 2.4 &amp; Appendix A: altered some of the abbreviations,
            for better consistency with approach of RFC2698. eg
            TBthreshold.fill =&gt; Ttm.
</li>
<li>the ACKs section improved
</li>
<li>other minor corrections and clarifications
</li>
</ul>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Changes to -02 from -01</h3>

<p>Updates as follows:
</p>
<p></p>
<ul class="text">
<li>added notes (end of S1.1 &amp; 2.5) to clarify what
            "excess-traffic-marked" means when there is only one encoding for
            PCN-marking
</li>
<li>added explanations for in Section B.4 and B.6 about why various
            things are SHOULD or SHOULD NOT rather than MUST or MUST NOT.
</li>
<li>Deleted a couple of paragraphs about encoding states, as they
            are relevant to encoding documents rather than this document.
</li>
</ul>

<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Changes to -01 from -00</h3>

<p>Updates as follows:
</p>
<p></p>
<ul class="text">
<li>corrected the term 'not PCN-marked' to 'not-marked'
            (throughout)
</li>
<li>re-phrased the definition of competing-non-PCN-packets
</li>
<li>corrected the definition of metered-packet
</li>
<li>delete most of Section 2.5 (marking function). The material
            deleted belongs as part of <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a>; other encoding
            schemes would need to include similar material.
</li>
<li>deleted Appendix C (it was only a temporary archive of material
            concerning per domain behaviour and PCN-boundary-node
            operation)
</li>
<li>clarifications throughout
</li>
<li>made all references Informative
</li>
</ul>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Changes to -00</h3>

<p>First version of WG draft, derived from
        draft-eardley-pcn-marking-behaviour-01, with the following
        changes:
</p>
<p></p>
<ul class="text">
<li>Removed material concerning per domain behaviour and
            PCN-boundary-node operation (temporarily archived to Appendix
            C)
</li>
<li>Removed mention of downgrading as an option for per-hop traffic
            conditioning. In fact, downgrading is no longer allowed because S
            2.6 now says "A PCN-node MUST NOT ...change a PCN-packet into a
            non PCN-packet".
</li>
<li>Traffic conditioning is now a MAY. Since in general flow
            termination (not traffic conditioning) is PCN's method for
            handling problems of too much traffic.
</li>
<li>Metered-packets: competing-non-PCN-packets now MAY be metered.
            Since it is recommended that the operator doesn't allow any
            competing-non-PCN-traffic, and (if there is) there are potentially
            other ways of coping.
</li>
<li>No changes (outside traffic conditioning &amp; metering of
            competing-non-PCN-traffic) to the Normative sections of the
            draft.
</li>
<li>Appendix B.1 added about competing-non-PCN-traffic. Recommended
            that there is no such traffic, but guidance given if there is.
</li>
</ul>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.briscoe-tsvwg-byte-pkt-mark">[I-D.briscoe-tsvwg-byte-pkt-mark]</a></td>
<td class="author-text">Briscoe, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-byte-pkt-mark-02.txt">Byte and Packet Congestion Notification</a>,&rdquo; draft-briscoe-tsvwg-byte-pkt-mark-02 (work in progress), February&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-byte-pkt-mark-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.briscoe-tsvwg-cl-architecture">[I-D.briscoe-tsvwg-cl-architecture]</a></td>
<td class="author-text">Briscoe, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-architecture-04.txt">An edge-to-edge Deployment Model for Pre-Congestion Notification: Admission  Control over a DiffServ Region</a>,&rdquo; draft-briscoe-tsvwg-cl-architecture-04 (work in progress), October&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-architecture-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.briscoe-tsvwg-cl-phb">[I-D.briscoe-tsvwg-cl-phb]</a></td>
<td class="author-text">Briscoe, B., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-phb-03.txt">Pre-Congestion Notification marking</a>,&rdquo; draft-briscoe-tsvwg-cl-phb-03 (work in progress), October&nbsp;2006 (<a href="http://www.ietf.org/internet-drafts/draft-briscoe-tsvwg-cl-phb-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.charny-pcn-comparison">[I-D.charny-pcn-comparison]</a></td>
<td class="author-text">Charny, A., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-charny-pcn-comparison-00.txt">Comparison of Proposed PCN Approaches</a>,&rdquo; draft-charny-pcn-comparison-00 (work in progress), November&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-charny-pcn-comparison-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-architecture">[I-D.ietf-pcn-architecture]</a></td>
<td class="author-text">Eardley, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-architecture-11.txt">Pre-Congestion Notification (PCN) Architecture</a>,&rdquo; draft-ietf-pcn-architecture-11 (work in progress), April&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-architecture-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-baseline-encoding">[I-D.ietf-pcn-baseline-encoding]</a></td>
<td class="author-text">Moncaster, T., Briscoe, B., and M. Menth, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-baseline-encoding-07.txt">Baseline Encoding and Transport of Pre-Congestion Information</a>,&rdquo; draft-ietf-pcn-baseline-encoding-07 (work in progress), September&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-baseline-encoding-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-admitted-realtime-dscp">[I-D.ietf-tsvwg-admitted-realtime-dscp]</a></td>
<td class="author-text">Baker, F., Polk, J., and M. Dolly, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-admitted-realtime-dscp-07.txt">DSCP for Capacity-Admitted Traffic</a>,&rdquo; draft-ietf-tsvwg-admitted-realtime-dscp-07 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-admitted-realtime-dscp-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.taylor-pcn-cl-edge-behaviour">[I-D.taylor-pcn-cl-edge-behaviour]</a></td>
<td class="author-text">Charny, A., Huang, F., Menth, M., and T. Taylor, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-taylor-pcn-cl-edge-behaviour-00.txt">PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation</a>,&rdquo; draft-taylor-pcn-cl-edge-behaviour-00 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-taylor-pcn-cl-edge-behaviour-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Menth">[Menth]</a></td>
<td class="author-text">&ldquo;<a href="http://www3.informatik.uni-wuerzburg.de/staff/menth/Publications/Menth08-PCN-Overview.pdf">Menth</a>,&rdquo; 2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2474">[RFC2474]</a></td>
<td class="author-text"><a href="mailto:kmn@cisco.com">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:fred@cisco.com">Baker, F.</a>, and <a href="mailto:black_david@emc.com">D. Black</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>,&rdquo; RFC&nbsp;2474, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2474.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2474.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2474.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2475">[RFC2475]</a></td>
<td class="author-text"><a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:black_david@emc.com">Black, D.</a>, <a href="mailto:mark.carlson@sun.com">Carlson, M.</a>, <a href="mailto:elwynd@nortel.co.uk">Davies, E.</a>, <a href="mailto:zhwang@bell-labs.com">Wang, Z.</a>, and <a href="mailto:wweiss@lucent.com">W. Weiss</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2475">An Architecture for Differentiated Services</a>,&rdquo; RFC&nbsp;2475, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2475.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2475.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2475.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3168">[RFC3168]</a></td>
<td class="author-text">Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>,&rdquo; RFC&nbsp;3168, September&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5127">[RFC5127]</a></td>
<td class="author-text">Chan, K., Babiarz, J., and F. Baker, &ldquo;<a href="http://tools.ietf.org/html/rfc5127">Aggregation of DiffServ Service Classes</a>,&rdquo; RFC&nbsp;5127, February&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5127.txt">TXT</a>).</td></tr>
</table>

<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Example algorithms</h3>

<p>Note: This Appendix is informative, not normative. It is an example
      of algorithms that implement Section 2 and is based on <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a> and <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>.
</p>
<p>There is no attempt to optimise the algorithms. It implements the
      metering and marking functions together. It is assumed that three
      encoding states are available (one for threshold-marked, one for
      excess-traffic-marked and one for not PCN-marked). It is assumed that
      all metered-packets are PCN-packets and that the link is never
      overloaded.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Threshold-metering and -marking</h3>

<p>A token bucket with the following parameters:</p>
<ul class="text">
<li>PCN-threshold-rate: token rate of token bucket
            (bits/second)
</li>
<li>BStm: depth of token bucket (bits)
</li>
<li>threshold: marking threshold of token bucket (bits)
</li>
<li>lastUpdate: time the token bucket was last updated
            (seconds)
</li>
<li>Ttm: amount of tokens in token bucket (bits)
</li>
</ul>

<p>A PCN-packet has the following parameters:</p>
<ul class="text">
<li>packet_size: the size of the PCN-packet (bits)
</li>
<li>packet_mark: the PCN encoding state of the packet
</li>
</ul>

<p>In addition there are the parameters:</p>
<ul class="text">
<li>now: the current time (seconds)
</li>
</ul>

<p>The following steps are performed when a PCN-packet arrives on a
        link:
</p>
<p></p>
<ul class="text">
<li>Ttm = min(BStm, Ttm + (now - lastUpdate) * PCN-threshold-rate);
            // add tokens to token bucket
</li>
<li>Ttm = max(0, Ttm - packet_size); // remove tokens from token
            bucket
</li>
<li>if ((Ttm &lt; threshold) AND (packet_mark !=
            excess-traffic-marked)) then packet_mark = threshold-marked; // do
            threshold marking, but don't re-mark packets that are already
            excess-traffic-marked
</li>
<li>lastUpdate = now
</li>
</ul>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Excess-traffic-metering and -marking</h3>

<p>A token bucket with the following parameters:</p>
<ul class="text">
<li>TBexcess.PCN-excess-rate: token rate of token bucket
            (bits/second)
</li>
<li>BSetm: depth of TB in token bucket (bits)
</li>
<li>TBexcess.lastUpdate: time the token bucket was last updated
            (seconds)
</li>
<li>Tetm: amount of tokens in token bucket (bits)
</li>
</ul>

<p>A PCN-packet has the following parameters:</p>
<ul class="text">
<li>packet_size: the size of the PCN-packet (bits)
</li>
<li>packet_mark: the PCN encoding state of the packet
</li>
</ul>

<p>In addition there are the parameters:</p>
<ul class="text">
<li>now: the current time (seconds)
</li>
<li>MTU: the maximum transfer unit of the link (or the known
            maximum size of PCN-packets on the link) (bits)
</li>
</ul>

<p>The following steps are performed when a PCN-packet arrives on a
        link:
</p>
<p></p>
<ul class="text">
<li>Tetm = min(BSetm, Tetm + (now - TBexcess.lastUpdate) *
            TBexcess.PCN-excess-rate); // add tokens to token bucket
</li>
<li>if (packet_mark != excess-traffic-marked) then Tetm = max(0,
            Tetm - packet_size); // remove tokens from token bucket, but do
            not meter packets that are already excess-traffic-marked
</li>
<li>if (Tetm &lt; MTU) then packet_mark = excess-traffic-marked; //
            do (packet size independent) excess traffic marking
</li>
<li>lastUpdate = now
</li>
</ul>

<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Implementation notes</h3>

<p>Note: This Appendix is informative, not normative. It comments on
      Section 2.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Competing-non-PCN-traffic</h3>

<p>In general it is not advised to have any competing-non-PCN-traffic,
        essentially because the unpredictable amount of
        competing-non-PCN-traffic makes the PCN mechanisms less accurate and
        so reduces PCN's ability to protect the QoS of admitted PCN-flows
        <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a>. But if there is
        competing-non-PCN-traffic, then there needs to be:
</p>
<p></p>
<ol class="text">
<li>a mechanism to limit it, for example:
<ul class="text">
<li>limit the rate at which competing-non-PCN-traffic can be
                forwarded on each link in the PCN-domain. One method for
                achieving this is to queue competing-non-PCN-packets
                separately from PCN-packets, and to limit the scheduling rate
                of the former. Another method is to drop
                competing-non-PCN-packets in excess of some rate.
</li>
<li>police competing-non-PCN-traffic at the PCN-ingress-nodes.
                For example, as in the Diffserv architecture - although its
                static traffic conditioning agreements risk a focused overload
                of traffic from several PCN-ingress-nodes on one link.
</li>
<li>it is known by design that the level of
                competing-non-PCN-traffic is always very small - perhaps it
                consists of operator control messages only.
</li>
</ul>
</li>
<li>In general PCN's mechanisms should take account of
            competing-non-PCN-traffic, in order to improve the accuracy of the
            decision about whether to admit (or terminate) a PCN-flow. For
            example:
<ul class="text">
<li>competing-non-PCN-traffic contributes to the PCN meters (ie
                competing-non-PCN-packets are treated as metered-packets).
</li>
<li>each PCN-node reduces, on its links, the PCN-threshold-rate
                and PCN-excess-rate, in order to allow 'headroom' for the
                competing-non-PCN-traffic; also limit the maximum forwarding
                rate of competing-non-PCN-traffic to be less than the
                'headroom'. In this case competing-non-PCN-packets are not
                treated as metered-packets.
</li>
</ul>
</li>
</ol><p>It is left up to the operator to decide on appropriate
        action. Dropping is discussed further in Section B.4.
</p>
<p>One specific example of competing-non-PCN-traffic occurs if the
        PCN-compatible Diffserv codepoint is one of those that <a class='info' href='#I-D.ietf-tsvwg-admitted-realtime-dscp'>[I&#8209;D.ietf&#8209;tsvwg&#8209;admitted&#8209;realtime&#8209;dscp]<span> (</span><span class='info'>Baker, F., Polk, J., and M. Dolly, &ldquo;DSCP for Capacity-Admitted Traffic,&rdquo; March&nbsp;2010.</span><span>)</span></a>) defines as
        suitable for use with admission control, and there is such non
        PCN-traffic in the PCN-domain. A similar example could occur for
        Diffserv codepoints of the Real-Time Treatment Aggregate <a class='info' href='#RFC5127'>[RFC5127]<span> (</span><span class='info'>Chan, K., Babiarz, J., and F. Baker, &ldquo;Aggregation of DiffServ Service Classes,&rdquo; February&nbsp;2008.</span><span>)</span></a>). In such cases PCN-traffic and
        competing-non-PCN-traffic are distinguished by different values of the
        ECN field <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a>.
</p>
<p>Another example would occur if there is more than one
        PCN-compatible Diffserv codepoint in a PCN-domain. For instance,
        suppose there are two PCN-BAs treated at different priorities. Then as
        far as the lower priority PCN-BA is concerned, the higher priority
        PCN-traffic needs to be treated as competing-non-PCN-traffic.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Scope</h3>

<p>It may be known, eg by the design of the network topology, that
        some links can never be pre-congested (even in unusual circumstances,
        eg after the failure of some links). There is then no need to deploy
        PCN behaviour on those links.
</p>
<p>The meters can be implemented on the ingoing or outgoing interface
        of a PCN-node. It may be that existing hardware can support only one
        meter per ingoing interface and one per outgoing interface. Then for
        instance threshold-metering could be run on all the ingoing interfaces
        and excess-traffic-metering on all the outgoing interfaces; note that
        the same choice must be made for all the links in a PCN-domain to
        ensure that the two metering behaviours are applied exactly once for
        all the links.
</p>
<p>The baseline encoding <a class='info' href='#I-D.ietf-pcn-baseline-encoding'>[I&#8209;D.ietf&#8209;pcn&#8209;baseline&#8209;encoding]<span> (</span><span class='info'>Moncaster, T., Briscoe, B., and M. Menth, &ldquo;Baseline Encoding and Transport of Pre-Congestion Information,&rdquo; September&nbsp;2009.</span><span>)</span></a> specifies only two
        encoding states (PCN-marked and not-marked). In this case,
        "excess-traffic-marked" means a packet that is PCN-marked as a result
        of the excess-traffic-meter function, and "threshold-marked" means a
        packet that is PCN-marked as a result of the threshold-meter function.
        As far as terminology is concerned, this interpretation is consistent
        with that defined in <a class='info' href='#I-D.ietf-pcn-architecture'>[I&#8209;D.ietf&#8209;pcn&#8209;architecture]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; April&nbsp;2009.</span><span>)</span></a>.
        Note that a deployment needs to make a consistent choice throughout
        the PCN-domain whether PCN-marked is interpreted as
        excess-traffic-marked or threshold-marked.
</p>
<p>Note that even if there are only two encoding states, it is still
        required that both the meters are implemented, in order to ease
        compatibility between equipment, and to remove a configuration option
        and associated complexity. Hardware with limited availability of token
        buckets could be configured to run only one of the meters, but it must
        be possible to enable either meter. Although in the scenario with two
        encoding states indications from one of the meters are ignored by the
        marking function, they may be logged or acted upon in some other way,
        for example by the management system or an explicit signalling
        protocol; such considerations are out of scope of this document.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Behaviour aggregate classification</h3>

<p>Configuration of PCN-nodes will define what values of the DSCP and
        ECN fields indicate a PCN-packet in a particular PCN-domain.
</p>
<p>Configuration will also define what values of the DSCP and ECN
        fields indicate a competing-non-PCN-packet in a particular
        PCN-domain.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Dropping</h3>

<p>The objective of the dropping function is to minimise the queueing
        delay suffered by metered-traffic at a PCN-node, since PCN-traffic
        (and perhaps competing-non-PCN-traffic) is expected to be inelastic
        traffic generated by real time applications. In practice it would be
        defined as exceeding a specific traffic profile, typically based on a
        token bucket.
</p>
<p>If there is no competing-non-PCN-traffic, then it is not expected
        that the dropping function is needed, since PCN's flow admission and
        termination mechanisms limit the amount of PCN-traffic. Even so, it
        still might be implemented as a back stop against misconfiguration of
        the PCN-domain, for instance.
</p>
<p>If there is competing-non-PCN-traffic, then the details of the
        dropping function will depend on how the router's implementation
        handles the two sorts of traffic (the discussion here is based on that
        in <a class='info' href='#I-D.ietf-tsvwg-admitted-realtime-dscp'>[I&#8209;D.ietf&#8209;tsvwg&#8209;admitted&#8209;realtime&#8209;dscp]<span> (</span><span class='info'>Baker, F., Polk, J., and M. Dolly, &ldquo;DSCP for Capacity-Admitted Traffic,&rdquo; March&nbsp;2010.</span><span>)</span></a>):
</p>
<p></p>
<ul class="text">
<li>a common queue for PCN-traffic and competing-non-PCN-traffic,
            and a traffic conditioner for the competing-non-PCN-traffic;
            or
</li>
<li>separate queues. In this case the amount of
            competing-non-PCN-traffic can be limited by limiting the rate at
            which the scheduler (for the competing-non-PCN-traffic) forwards
            packets.
</li>
</ul>

<p>Note that only dropping of packets is allowed. Downgrading of
        packets to a lower priority BA is not allowed (see B.7), since it
        would lead to packet mis-ordering. Shaping ("the process of delaying
        packets" <a class='info' href='#RFC2475'>[RFC2475]<span> (</span><span class='info'>Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z., and W. Weiss, &ldquo;An Architecture for Differentiated Services,&rdquo; December&nbsp;1998.</span><span>)</span></a>) is not suitable if the
        traffic comes from real time applications.
</p>
<p>In general it is reasonable for competing-non-PCN-traffic to get
        harsher treatment than PCN-traffic (ie competing-non-PCN-packets are
        preferentially dropped), because PCN's flow admission and termination
        mechanisms are stronger than the mechanisms that are likely to be
        applied to the competing-non-PCN-traffic. The PCN mechanisms also mean
        that a dropper should not be needed for the PCN-traffic.
</p>
<p>Preferential dropping of excess-traffic-marked packets: Section 2.3
        specifies: "If the PCN-node drops PCN-packets then ... PCN-packets
        that arrive at the PCN-node already excess-traffic-marked SHOULD be
        preferentially dropped". In brief, the reason is that, with the
        "controlled load" edge behaviour <a class='info' href='#I-D.taylor-pcn-cl-edge-behaviour'>[I&#8209;D.taylor&#8209;pcn&#8209;cl&#8209;edge&#8209;behaviour]<span> (</span><span class='info'>Charny, A., Huang, F., Menth, M., and T. Taylor, &ldquo;PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation,&rdquo; March&nbsp;2009.</span><span>)</span></a> this avoids
        over-termination in the event of multiple bottlenecks in the
        PCN-domain <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a>. A fuller
        explanation is as follows. The optimal dropping behaviour depends on
        the particular edge behaviour <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. A single
        dropping behaviour is defined, as it is simpler to standardise,
        implement and operate. The standardised dropping behaviour is at least
        adequate for all edge behaviours (and good for some), whereas others
        are not (for example with tail dropping far too much traffic may be
        terminated with the "controlled load" edge behaviour, in the event of
        multiple bottlenecks in the PCN-domain <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a>). The dropping behaviour is
        defined as a &lsquo;SHOULD&rsquo;, rather than a &lsquo;MUST&rsquo;,
        in recognition that other dropping behaviour may be preferred in
        particular circumstances, for example: (1) with the "marked flow"
        termination edge behaviour, preferential dropping of unmarked packets
        may be better <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>; (2) tail dropping may make
        PCN marking behaviour easier to implement on current routers.
</p>
<p>Exactly what "preferentially dropped" means is left to the
        implementation. It is also left to the implementation what to do if
        there are no excess-traffic-marked PCN-packets available at a
        particular instant.
</p>
<p>Section 2.2 also specifies: "the PCN-node's excess-traffic-meter
        SHOULD NOT meter the PCN-packets that it drops." This avoids
        over-termination <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. Effectively it means
        that the dropping function (if present) should be done before the
        meter functions - which is natural.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.5"></a><h3>B.5.&nbsp;
Threshold-metering</h3>

<p>The description is in terms of a &lsquo;token bucket with
        threshold&rsquo; (which <a class='info' href='#I-D.briscoe-tsvwg-cl-architecture'>[I&#8209;D.briscoe&#8209;tsvwg&#8209;cl&#8209;architecture]<span> (</span><span class='info'>Briscoe, B., &ldquo;An edge-to-edge Deployment Model for Pre-Congestion Notification: Admission  Control over a DiffServ Region,&rdquo; October&nbsp;2006.</span><span>)</span></a> views as a virtual
        queue). However the description is not intended to standardise
        implementation.
</p>
<p>The PCN-threshold-rate is configured at less than the rate
        allocated to the PCN-traffic class. Also, the PCN-threshold-rate is
        less than, or possibly equal to, the PCN-excess-rate.
</p>
<p>Section 2.3 defines: "If Ttm &lt; threshold, then the meter
        indicates to the marking function that the packet is to be
        threshold-marked; otherwise it does not." Note that a PCN-packet is
        marked without explicit additional bias for the packet's size.
</p>
<p>The behaviour must be functionally equivalent to the description in
        Section 2.3. "Functionally equivalent" means the observable 'black
        box' behaviour is the same or very similar, for example if either
        precisely the same set of packets is marked, or if the set is shifted
        by one packet. It is intended to allow implementation freedom over
        matters such as:</p>
<ul class="text">
<li>whether tokens are added to the token bucket at regular time
            intervals or only when a packet is processed.
</li>
<li>whether the new token bucket depth is calculated before or
            after it is decided whether to mark the packet. The effect of this
            is simply to shift the sequence of marks by one packet.
</li>
<li>when the token bucket is very nearly empty and a packet arrives
            larger than Ttm, then the precise change in Ttm is up to the
            implementation. For instance:
<ul class="text">
<li>set Ttm = 0 and indicate threshold-mark to the Marking
                function.
</li>
<li>check whether Ttm &lt; threshold and if it is then indicate
                threshold-mark to the Marking function; then set Ttm = 0.
</li>
<li>leave Ttm unaltered and indicate threshold-mark to the
                Marking function.
</li>
</ul>
</li>
</ul>
<ul class="text">
<li><p>similarly, when the token bucket is very nearly full and a
            packet arrives larger than (BStm - Ttm), then the precise change
            in Ttm is up to the implementation.
</li>
<li>Note that all packets, even if already marked, are metered by
            the threshold-meter function (unlike the excess-traffic-meter
            function), because all packets should contribute to the decision
            whether there is room for a new flow.
</li>
</ul>
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.6"></a><h3>B.6.&nbsp;
Excess-traffic-metering</h3>

<p>The description is in terms of a token bucket, however the
        implementation is not standardised.
</p>
<p>The PCN-excess-rate is configured at less than (or possibly equal
        to) the rate allocated to the PCN-traffic class. Also, the
        PCN-excess-rate is greater than, or possibly equal to, the
        PCN-threshold-rate.
</p>
<p>As in Section B.3, "functionally equivalent" allows some
        implementation flexibility when the token bucket is very nearly empty
        or very nearly full.
</p>
<p>Section 2.4 specifies: "A packet SHOULD NOT be metered (by this
        excess traffic meter function) ... If the packet is already
        excess-traffic-marked on arrival at the PCN-node". This avoids
        over-termination (with some edge behaviours) in the event that the
        PCN-traffic passes through multiple bottlenecks in the PCN-domain
        <a class='info' href='#I-D.charny-pcn-comparison'>[I&#8209;D.charny&#8209;pcn&#8209;comparison]<span> (</span><span class='info'>Charny, A., &ldquo;Comparison of Proposed PCN Approaches,&rdquo; November&nbsp;2007.</span><span>)</span></a>. Note that an
        implementation could determine whether the packet is already
        excess-traffic-marked as an integral part of its BA classification
        function. The behaviour is defined as a &lsquo;SHOULD NOT&rsquo;,
        rather than a &lsquo;MUST NOT&rsquo;, because it may be slightly
        harder to implement than a metering function that is blind to previous
        packet markings.
</p>
<p>Section 2.4 specifies: "A packet SHOULD NOT be metered (by this
        excess traffic meter function) ... If this PCN-node drops the packet."
        This avoids over-termination <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. (A similar
        statement could also be made for the threshold meter function, but is
        irrelevant, as a link that is overloaded will already be substantially
        pre-congested and hence threshold-marking all packets.) It seems
        natural to perform the dropping function before the metering
        functions, although for some equipment it may be harder to implement;
        hence the behaviour is defined as a &lsquo;SHOULD NOT&rsquo;, rather
        than a &lsquo;MUST NOT&rsquo;.
</p>
<p>Packet size independent marking is specified as a SHOULD in Section
        2.4 ( "if the token bucket is within an MTU of being empty, then the
        meter SHOULD indicate to the Marking function that the packet is to be
        excess-traffic-marked; MTU means the maximum size of PCN-packets on
        the link".) Without it, large packets are more likely to be
        excess-traffic-marked than small packets and this means that, with
        some edge behaviours, flows with large packets are more likely to be
        terminated than flows with small packets <a class='info' href='#I-D.briscoe-tsvwg-byte-pkt-mark'>[I&#8209;D.briscoe&#8209;tsvwg&#8209;byte&#8209;pkt&#8209;mark]<span> (</span><span class='info'>Briscoe, B., &ldquo;Byte and Packet Congestion Notification,&rdquo; February&nbsp;2008.</span><span>)</span></a> <a class='info' href='#Menth'>[Menth]<span> (</span><span class='info'>, &ldquo;Menth,&rdquo; 2008.</span><span>)</span></a>. The behaviour is a &lsquo;SHOULD&rsquo;,
        rather than a &lsquo;MUST&rsquo;, because packet size independent
        marking may be slightly harder for some equipment to implement, and
        the impact of not doing it is undesirable but moderate (sufficient
        traffic is terminated, but flows with large packets are more likely to
        be terminated).
</p>
<p>Note that BSetm is independent of BStm; Tetm is independent of Ttm
        (except in that a packet changes both); and the two configured rates
        (PCN-excess-rate and PCN-threshold-rate) are independent (except that
        PCN-excess-rate &gt;= PCN-threshold-rate).
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.7"></a><h3>B.7.&nbsp;
Marking</h3>

<p>Section 2.5 defines: "A PCN-node MUST NOT ...change a PCN-packet
        into a non PCN-packet". This means that a PCN-node is not allowed to
        downgrade a PCN-packet into a lower priority Diffserv BA (eg it is not
        allowed as an alternative to dropping, Section 2.2).
</p>
<p>Section 2.5 defines: "A PCN-node MUST NOT ...PCN-mark a packet that
        is not a PCN-packet". This means that in the scenario where
        competing-non-PCN-packets are treated as metered-packets, a meter may
        indicate a packet is to be PCN-marked, but the marking function knows
        it cannot be marked. It is left open to the implementation exactly
        what to do in this case; one simple possibility is to mark the next
        PCN-packet. Note that unless the PCN-packets are a large fraction of
        all the metered-packets then the PCN mechanisms may not work well.
</p>
<p>Although the metering functions are described separately from the
        marking function, they can be implemented in an integrated
        fashion.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Philip Eardley </td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">BT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adastral Park, Martlesham Heath</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ipswich  IP5 3RE</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UK</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:philip.eardley@bt.com">philip.eardley@bt.com</a></td></tr>
</table>
</body></html>
