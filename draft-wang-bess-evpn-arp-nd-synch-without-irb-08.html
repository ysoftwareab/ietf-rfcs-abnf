<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>ARP/ND Synching And IP Aliasing without IRB</title>
<meta content="Yubao Wang" name="author">
<meta content="Zheng(Sandy) Zhang" name="author">
<meta content="
       This draft discusses serveral signalling modes of EVPN Signalled L3VPNs.
 EVPN Signalled L3VPNs are used to improve L3VPNs for some new use cases.
   Then it discusses which style of RT-5 routes can be selected for these new use cases, 
   and why they are selected. 
       
    " name="description">
<meta content="xml2rfc 3.9.1" name="generator">
<meta content="EVPN, L3 EVI, Service Interface, ESI, Multiple VLAN, VLAN-bundle, Risk" name="keyword">
<meta content="draft-wang-bess-evpn-arp-nd-synch-without-irb-08" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.9.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.1
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 57.4.0
    six 1.16.0
-->
<link href="/tmp/draft-wang-bess-evpn-arp-nd-synch-without-irb-08-pot5ig3b.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">IP-Aliasing-no-IRB</td>
<td class="right">September 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Wang &amp; Zhang</td>
<td class="center">Expires 5 March 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS WG</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-09-01" class="published">1 September 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-03-05">5 March 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Wang</div>
<div class="org">ZTE Corporation</div>
</div>
<div class="author">
      <div class="author-name">Z. Zhang</div>
<div class="org">ZTE Corporation</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">ARP/ND Synching And IP Aliasing without IRB</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This draft discusses serveral signalling modes of EVPN Signalled L3VPNs.
 EVPN Signalled L3VPNs are used to improve L3VPNs for some new use cases.
   Then it discusses which style of RT-5 routes can be selected for these new use cases, 
   and why they are selected.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 5 March 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology-and-acronyms" class="xref">Terminology and Acronyms</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-service-interfaces-of-l3-ev" class="xref">Service Interfaces of L3 EVIs</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-ip-discovery-mode" class="xref">IP Discovery Mode</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-adjacencies-discovery" class="xref">Adjacencies Discovery</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-spreadable-mode-faraway-mod" class="xref">Spreadable Mode (Faraway Mode)</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-non-spreadable-mode-nearby-" class="xref">Non-Spreadable Mode (Nearby Mode)</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-ce-prefixes-auto-discovery-" class="xref">CE-Prefixes Auto-Discovery Modes</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-distributed-a-d-mode" class="xref">Distributed A-D Mode</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-centerlized-a-d-mode" class="xref">Centerlized A-D Mode</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-styles-of-rt-5-route" class="xref">Styles of RT-5 Route</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-l-style-no-overlay-index" class="xref">L-Style: no Overlay Index</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-rt-5l-advertisement-in-dist" class="xref">RT-5L Advertisement in Distributed A-D Mode</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-rt-5l-advertisement-in-cent" class="xref">RT-5L Advertisement in Centerlized A-D Mode</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-g-style-gw-ip-as-overlay-in" class="xref">G-Style: GW-IP as Overlay Index</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.2.2.1">
                    <p id="section-toc.1-1.4.2.2.2.1.1"><a href="#section-4.2.1" class="xref">4.2.1</a>.  <a href="#name-rt-5g-advertisement-in-dist" class="xref">RT-5G Advertisement in Distributed A-D Mode</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.2.2.2">
                    <p id="section-toc.1-1.4.2.2.2.2.1"><a href="#section-4.2.2" class="xref">4.2.2</a>.  <a href="#name-rt-5g-advertisement-in-cent" class="xref">RT-5G Advertisement in Centerlized A-D Mode</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-e-style-esi-as-overlay-inde" class="xref">E-Style: ESI as Overlay Index</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.3.2.1">
                    <p id="section-toc.1-1.4.2.3.2.1.1"><a href="#section-4.3.1" class="xref">4.3.1</a>.  <a href="#name-rt-5e-in-bump-in-the-wire-u" class="xref">RT-5E in Bump-in-the-wire use case</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.3.2.2">
                    <p id="section-toc.1-1.4.2.3.2.2.1"><a href="#section-4.3.2" class="xref">4.3.2</a>.  <a href="#name-rt-5e-advertisement-on-dist" class="xref">RT-5E Advertisement on Distributed L3 GW</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.3.2.3">
                    <p id="section-toc.1-1.4.2.3.2.3.1"><a href="#section-4.3.3" class="xref">4.3.3</a>.  <a href="#name-rt-5e-advertisement-in-cent" class="xref">RT-5E Advertisement in Centerlized A-D mode</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-m-style-mac-as-overlay-inde" class="xref">M-Style: MAC as Overlay Index</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-centerlized-rt-5g-advertise" class="xref">Centerlized RT-5G Advertisement for Distributed L3 Forwarding</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-ce-side-configurations" class="xref">CE-side Configurations</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-why-centerlized-a-d-mode-is" class="xref">Why Centerlized A-D mode is used</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-basic-control-plane-procedu" class="xref">Basic Control Plane Procedures</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="xref">5.3.1</a>.  <a href="#name-centerlized-ce-bgp" class="xref">Centerlized CE-BGP</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="xref">5.3.2</a>.  <a href="#name-rt-2e-advertisement-from-pe" class="xref">RT-2E Advertisement from PE1/PE2 to DGW1</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.3.2.3">
                    <p id="section-toc.1-1.5.2.3.2.3.1"><a href="#section-5.3.3" class="xref">5.3.3</a>.  <a href="#name-rt-5g-advertisement-from-dg" class="xref">RT-5G Advertisement from DGW1 to PE1/PE2</a></p>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.3.2.4">
                    <p id="section-toc.1-1.5.2.3.2.4.1"><a href="#section-5.3.4" class="xref">5.3.4</a>.  <a href="#name-rt-2e-advertisement-between" class="xref">RT-2E Advertisement between PE1 and PE2</a></p>
</li>
                </ul>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-mass-withdraw-by-ead-es-rou" class="xref">Mass-Withdraw by EAD/ES Route</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="xref">5.5</a>.  <a href="#name-if-mutiple-vlan-based-servi" class="xref">If Mutiple VLAN-based Service Inerface is Used</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="xref">5.6</a>.  <a href="#name-if-vlan-bundle-service-inte" class="xref">If VLAN-bundle Service Interface is Used</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.7">
                <p id="section-toc.1-1.5.2.7.1"><a href="#section-5.7" class="xref">5.7</a>.  <a href="#name-on-the-failure-of-pe3-node" class="xref">On the Failure of PE3 Node</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.5.2.8">
                <p id="section-toc.1-1.5.2.8.1"><a href="#section-5.8" class="xref">5.8</a>.  <a href="#name-for-common-ce-prefixes-behi" class="xref">For Common CE-prefixes behind R1 and R2</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-load-balancing-of-unicast-p" class="xref">Load Balancing of Unicast Packets</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-ip-aliasing-using-gw-ip" class="xref">IP Aliasing using GW-IP</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-ip-aliasing-using-esi" class="xref">IP Aliasing using ESI</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-explanation-for-physical-li" class="xref">Explanation for Physical Links of the Use-cases</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-failure-detections-for-p12-" class="xref">Failure Detections for P1.2 (or P2.1)</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-protection-approaches-for-n" class="xref">Protection Approaches for N1 (or N2)</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.2.2.1">
                    <p id="section-toc.1-1.10.2.2.2.1.1"><a href="#appendix-A.2.1" class="xref">A.2.1</a>.  <a href="#name-ccc-approaches" class="xref">CCC-Approaches</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.2.2.1.2.1">
                        <p id="section-toc.1-1.10.2.2.2.1.2.1.1"><a href="#appendix-A.2.1.1" class="xref">A.2.1.1</a>.  <a href="#name-ccc-active-active-protectio" class="xref">CCC Active-Active Protection</a></p>
</li>
                      <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.2.2.1.2.2">
                        <p id="section-toc.1-1.10.2.2.2.1.2.2.1"><a href="#appendix-A.2.1.2" class="xref">A.2.1.2</a>.  <a href="#name-ccc-active-standby-protecti" class="xref">CCC Active-Standby Protection</a></p>
</li>
                    </ul>
</li>
                  <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.10.2.2.2.2">
                    <p id="section-toc.1-1.10.2.2.2.2.1"><a href="#appendix-A.2.2" class="xref">A.2.2</a>.  <a href="#name-vsi-approaches" class="xref">VSI-Approaches</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-different-understandings-on" class="xref">Different Understandings on Resolve GW-IP to RT-5</a></p>
<ul class="ulEmpty ulBare toc compact">
<li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#appendix-B.1" class="xref">B.1</a>.  <a href="#name-section-32-of-i-dietf-bess-" class="xref">Section 3.2 of I-D.ietf-bess-evpn-prefix-advertisement</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#appendix-B.2" class="xref">B.2</a>.  <a href="#name-how-to-interpret-above-para" class="xref">How to Interpret Above Paragraphs</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11.2.3">
                <p id="section-toc.1-1.11.2.3.1"><a href="#appendix-B.3" class="xref">B.3</a>.  <a href="#name-special-pes" class="xref">Special PEs</a></p>
</li>
              <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.11.2.4">
                <p id="section-toc.1-1.11.2.4.1"><a href="#appendix-B.4" class="xref">B.4</a>.  <a href="#name-gw-ip-or-a-new-tlv" class="xref">GW-IP or a new TLV</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty ulBare toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Introduce">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This draft discusses serveral signalling modes of EVPN Signalled L3VPNs. they are:<a href="#section-1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-2.1">
          <p id="section-1-2.1.1">Adjacencies Discovery modes: spreadable mode and non-spreadable mode.<a href="#section-1-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-2.2">
          <p id="section-1-2.2.1">CE-Prefix Auto-discovery modes: Centerlized mode and Distributed mode.<a href="#section-1-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-1-2.3">
          <p id="section-1-2.3.1">Styles of RT-5 routes: RT-5L (L-Sytle), RT-5G (G-Style), RT-5E (E-Style), RT-5M (M-Style).<a href="#section-1-2.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-1-3">These signalling modes can help to improve L3VPNs for some new use cases.
   Then we will discuss which style of RT-5 routes will be selected for each new use case, 
   and why it is selected for that new use case.<a href="#section-1-3" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-terminology-and-acronyms">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology-and-acronyms" class="section-name selfRef">Terminology and Acronyms</a>
        </h3>
<p id="section-1.1-1">
  Most of the acronyms and terms used in this documents comes from <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>,
     <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> and <span>[<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> except for the following:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-2">
          <dt id="section-1.1-2.1">* VRF AC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.2">
            <p style="margin-left: 2.0em" id="section-1.1-2.2.1">An Attachment Circuit (AC) that attaches a CE to an IP-VRF but is
   not an IRB interface.<a href="#section-1.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.3">* VRF Interface -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.4">
            <p style="margin-left: 2.0em" id="section-1.1-2.4.1"> An IRB interface or a VRF-AC or an IRC interface. Note that a VRF interface will be bound to the routing space of an IP-VRF.<a href="#section-1.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.5">* L3 EVI -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.6">
            <p style="margin-left: 2.0em" id="section-1.1-2.6.1"> An EVPN instance spanning the Provider Edge (PE) devices
   participating in that EVPN which contains VRF ACs and maybe
   contains IRB interfaces or IRC interfaces.<a href="#section-1.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.7">* IP-AD/EVI -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.8">
            <p style="margin-left: 2.0em" id="section-1.1-2.8.1"> Ethernet Auto-Discovery route per EVI, and the EVI here is an IP-VRF. 
   Note that the Ethernet Tag ID of an IP-AD/EVI route may be not zero.<a href="#section-1.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.9">* IP-AD/ES -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.10">
            <p style="margin-left: 2.0em" id="section-1.1-2.10.1">Ethernet Auto-Discovery route per ES, and the EVI for one of its route targets is an IP-VRF.<a href="#section-1.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.11">* RMAC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.12">
            <p style="margin-left: 2.0em" id="section-1.1-2.12.1">Router's MAC, which is signaled in the Router's MAC extended community.<a href="#section-1.1-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.13">* ESI Overlay Index -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.14">
            <p style="margin-left: 2.0em" id="section-1.1-2.14.1">ESI as overlay index.<a href="#section-1.1-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.15">* ET-ID -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.16">
            <p style="margin-left: 2.0em" id="section-1.1-2.16.1">Ethernet Tag ID, it is also called ETI for short in this document.<a href="#section-1.1-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.17">* RT-2R -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.18">
            <p style="margin-left: 2.0em" id="section-1.1-2.18.1">When a MAC/IP Advertisement Route whose ESI is not zero is used for IP-VRF forwarding, it is called as a RT-2R in this draft.
   When it is used for MAC-VRF forwarding, it is not called as a RT-2R in this draft.<a href="#section-1.1-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.19">* RT-5E -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.20">
            <p style="margin-left: 2.0em" id="section-1.1-2.20.1">An EVPN Prefix Advertisement Route with a non-reserved ESI as its overlay index (the E-style RT-5) .<a href="#section-1.1-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.21">* IRC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.22">
            <p style="margin-left: 2.0em" id="section-1.1-2.22.1">Integrated Routing and Cross-connecting, thus a IRC interface is the virtual interface connecting an IP-VRF and an EVPN VPWS.<a href="#section-1.1-2.22.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.23">* CE-BGP -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.24">
            <p style="margin-left: 2.0em" id="section-1.1-2.24.1">The BGP session between PE and CE. Note that CE-BGP route doesn't have a RD or Route-Target.<a href="#section-1.1-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.25">* CE-Prefix -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.26">
            <p style="margin-left: 2.0em" id="section-1.1-2.26.1">An IP Prefixes behind a CE is called as that CE's CE-Prefix.<a href="#section-1.1-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.27">* RT-5G -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.28">
            <p style="margin-left: 2.0em" id="section-1.1-2.28.1">An EVPN Prefix Advertisement Route with a zero ESI and a non-zero GW-IP (the G-style RT-5).<a href="#section-1.1-2.28.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.29">* RT-5L -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.30">
            <p style="margin-left: 2.0em" id="section-1.1-2.30.1">An EVPN Prefix Advertisement Route with both zero ESI and zero GW-IP, but a non-zero EVPN Label (the L-style RT-5).<a href="#section-1.1-2.30.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.31">* RT-5M -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.32">
            <p style="margin-left: 2.0em" id="section-1.1-2.32.1">An EVPN Prefix Advertisement Route with zero ESI, zero GW-IP and zero EVPN Label, but a non-zero Router's MAC (the M-style RT-5).<a href="#section-1.1-2.32.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.33">* EVC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.34">
            <p style="margin-left: 2.0em" id="section-1.1-2.34.1">Ethernet Virtual Connection, which is typically constructed per &lt;Port, VLAN&gt; basis.<a href="#section-1.1-2.34.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.35">* Internal Remote PE:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.36">
   When PEx is called as an EVPN route ERy's internal remote PE,
   that is saying that, PEx is on the ES which is identified by ERy's ESI field.
   When ERy's SOI is not zero, that is aslo saying that PEx has been attached to 
   the ethernet tag which is identified by the &lt;ESI, SOI&gt;.<a href="#section-1.1-2.36" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.37">* External Remote PE:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.38">
   When PEx is called as an EVPN route ERy's external remote PE,
   that is saying that, PEx is not on the ES which is identified by ERy's ESI field.
   When ERy's SOI is not zero, PEx may aslo be a PE which has not been attached to 
   the ethernet tag which is identified by the &lt;ESI, SOI&gt;.<a href="#section-1.1-2.38" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.39">* CE-Prefix:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.40">
   When an IP prefix can be reached through CEx from PEy, 
   that IP prefix is called as PEy's CE-prefix behind CEx in this draft.
   PEy's CE-prefix behind CEx is also called as PEy's CE-prefix for short in this draft.<a href="#section-1.1-2.40" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.41">* Common CE-Prefix:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.42">
   When an CE-Prefix can be reached through either CEy or CEz from PEy,
   in this draft, it is called as a common CE-Prefix of CEy and CEz,from the viewpoint of PEy.<a href="#section-1.1-2.42" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.43">* Exclusive CE-Prefix:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.44">
   When an CE-Prefix of PEy can be reached through CEy, 
   and it can't be reached through other CEs of PEy,
   it is called as an exlusive CE-Prefix of CEy, from the viewpoint of PEy.<a href="#section-1.1-2.44" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.45">* SNGW:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.46">
   Sub-Net-specific Gate Way IP address, 
   the SNGW of a subnet is an IP address which is used 
   by the hosts of that subnet to be the nexthop 
   of the default route of these host.<a href="#section-1.1-2.46" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.47">* Intermediate subnet:  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.48">
   The subnet that connects a PE and a CE of a L3 EVI.<a href="#section-1.1-2.48" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.49">* Intermediate SNGW :  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.50">
   The SNGW of a intermediate subnet. 
   It will be the IP address of a IRC interface in this draft.<a href="#section-1.1-2.50" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.51">* Intermediate nexthop :  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.52">
   The CE's IP address in the intermediate subnet.<a href="#section-1.1-2.52" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.53">* Overlay nexthop :  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.54">
   The CE-Prefix's nexthop IP address which is in the address-space of the L3 EVI.<a href="#section-1.1-2.54" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.55">* Original Overlay nexthop :  </dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.56">
   The overlay nexthop which is advertised by the CE through a PE-CE route protocol.<a href="#section-1.1-2.56" class="pilcrow">¶</a>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.57">* L3EVI-Specific EADR -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.58">
            <p style="margin-left: 2.0em" id="section-1.1-2.58.1">When the &lt;ESI, L3EVI&gt; uses L3EVI-Specific Ethernet Auto-discovery mode,
   the only Ethernet A-D per EVI route (which will be &lt;ESI, ET-ID=0&gt;) of that &lt;ESI, L3EVI&gt; is called as a L3EVI-Specific EADR in this draft.<a href="#section-1.1-2.58.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.59">* ACI-Specific EADR -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.60">
            <p style="margin-left: 2.0em" id="section-1.1-2.60.1">When the &lt;ESI, SOI&gt; uses ACI-Specific Ethernet Auto-discovery mode,
   the Ethernet A-D per EVI routes of that &lt;ESI, SOI&gt; are called as ACI-Specific EADRs in this draft.<a href="#section-1.1-2.60.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</section>
</div>
<div id="sect-problem-req">
<section id="section-2">
      <h2 id="name-service-interfaces-of-l3-ev">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-service-interfaces-of-l3-ev" class="section-name selfRef">Service Interfaces of L3 EVIs</a>
      </h2>
<p id="section-2-1">Service interface describes how an ES is attached to a L3EVI.
 <span>[<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> discussed the following service interfaces:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="compact">
<li class="compact" id="section-2-2.1">
          <p id="section-2-2.1.1">Mono VLAN-based Service Interface.<a href="#section-2-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="compact" id="section-2-2.2">
          <p id="section-2-2.2.1">Multiple VLAN-based Service Interface.<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="compact" id="section-2-2.3">
          <p id="section-2-2.3.1">Separated Risk VLAN-bundle Service Interface.<a href="#section-2-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="compact" id="section-2-2.4">
          <p id="section-2-2.4.1">Shared Risk VLAN-bundle Service Interface.<a href="#section-2-2.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="compact" id="section-2-2.5">
          <p id="section-2-2.5.1">IRC Service Interface.<a href="#section-2-2.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-3">Different service interface will require different control-plane procedures,
   then this draft discusses the behavior of RT5 routes advertisement per each service interface,
   especially when they are RT5 routes with ESI as overlay index or GW-IP as overlay index.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Note that an ES may be attached to different L3EVIs via different VLANs,
 and mutiple ESes can be attached to the same L3EVI Instance.
 So service interface is ESI-specific and EVI-specific. 
 When ES1 is of VLAN-bundle Service Interface to EVI1,
 it may be of Mono VLAN-based Service Interface for EVI2.
 Thus service interfaces of L3EVIs are &lt;ESI, EVI&gt;-specific in this draft.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-IP-discovery">
<section id="section-3">
      <h2 id="name-ip-discovery-mode">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-ip-discovery-mode" class="section-name selfRef">IP Discovery Mode</a>
      </h2>
<p id="section-3-1">IP discovery in L3EVIs include ARP/ND Adjacencies discovery and CE-prefixes discovery.
 The adjacencies discovery is done distributively by each VRF-AC using ARP/ND.
 But the CE-prefixes can be discovered by two ways.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="sect-ARP-Synch">
<section id="section-3.1">
        <h3 id="name-adjacencies-discovery">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-adjacencies-discovery" class="section-name selfRef">Adjacencies Discovery</a>
        </h3>
<div id="sect-ARP-ND-faraway">
<section id="section-3.1.1">
          <h4 id="name-spreadable-mode-faraway-mod">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-spreadable-mode-faraway-mod" class="section-name selfRef">Spreadable Mode (Faraway Mode)</a>
          </h4>
<p id="section-3.1.1-1">In Spreadable Mode, an adjacent MAC/IP can be imported into IP-VRF by both external remote PEs and internal remote PEs.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">In this mode, the RT-2 route of the MAC/IP is used to 
 synchronize adjacency information (&lt;MAC, IP&gt; mapping) to internal remote PEs.
 and it is also used to advertise host route to external remote PEs.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1.1-3">When CEs are hosts, this mode will make the amount of EVPN routes increase greatly.<a href="#section-3.1.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1.1-4">The spreadable mode is also called as Faraway Mode because that
 the external remote PEs of the MAC/IP entries can imported the RT-2 routes of these MAC/IP entries into IP-VRF.<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1.1-5">The spreadable mode can be used to 
 avoid making a detour when there is a straightforward path. 
 This mode is typically used in EVPN IRB scenarios, 
 where different hosts of the same BD may be reached through different ESes.
 Another example of spreadable mode can be found in <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-2.1.2" class="relref">Section 2.1.2</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>,
 where the CEs are a few routers.<a href="#section-3.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-ARP-ND-nearby">
<section id="section-3.1.2">
          <h4 id="name-non-spreadable-mode-nearby-">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-non-spreadable-mode-nearby-" class="section-name selfRef">Non-Spreadable Mode (Nearby Mode)</a>
          </h4>
<p id="section-3.1.2-1">In Spreadable Mode, an adjacent MAC/IP can only be imported into IP-VRF by internal remote PEs.
 In other words, the MAC/IP can not be imported into IP-VRF by the external remote PEs of it.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">In this mode, the RT-2 route of the MAC/IP is just used to synchronize adjacency information (&lt;MAC, IP&gt; mapping) to internal remote PEs.<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
<p id="section-3.1.2-3">In non-spreadable mode, it should be insured that 
 only the internal remote PEs of the MAC/IP entry 
 can imported the RT-2 route of the MAC/IP entry into IP-VRF.
 Thus that RT-2 route should carry EVI-RT and ES-Import RT only,
 and that's why non-spreadable mode is also called as nearby mode.<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
<p id="section-3.1.2-4">An example of non-spreadable mode can be found 
 in <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-2.1.1" class="relref">Section 2.1.1</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>,
 where the CEs are lots of hosts, 
 and all CEs can be reached through the same VPWS service instance.<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-CE-Prefix-AD">
<section id="section-3.2">
        <h3 id="name-ce-prefixes-auto-discovery-">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-ce-prefixes-auto-discovery-" class="section-name selfRef">CE-Prefixes Auto-Discovery Modes</a>
        </h3>
<p id="section-3.2-1">There are two ways to discover the IP prefixes behind a CE (that's why these prefixes are called CE-prefixes for short),
    they are distributed AD-Mode and centerlized AD-mode.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<div id="sect-CEIP-AD-Distributed">
<section id="section-3.2.1">
          <h4 id="name-distributed-a-d-mode">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-distributed-a-d-mode" class="section-name selfRef">Distributed A-D Mode</a>
          </h4>
<p id="section-3.2.1-1">The CE-Prefixes inside a DC are discovered by each NVE separately. Then these NVEs advertise their CE-prefixes to DC Gateways and other NVEs of that DC.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2">Note that the external-prefixes (which are received from other DCs) will be discovered by DC gateways even in distributed AD-mode.
    Distributed A-D mode and Centerlized A-D mode just talks about how CE-prefixes inside the DC will be discovered.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-CEIP-AD-Centerlized">
<section id="section-3.2.2">
          <h4 id="name-centerlized-a-d-mode">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-centerlized-a-d-mode" class="section-name selfRef">Centerlized A-D Mode</a>
          </h4>
<p id="section-3.2.2-1">The CE-Prefixes (behind each NVE) are discovered by the same group of DC Gateways. Then these DC Gateways advertise these CE-prefixes to NVEs.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2.2-2">No matter what the A-D mode is, 
    the distributed forwarding behavior should be expected in this draft.
    That is, the communication between two subnets behind two NVEs inside the same DC 
    should not be required to pass through the DC Gateway.<a href="#section-3.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sect-RT5-Styles">
<section id="section-4">
      <h2 id="name-styles-of-rt-5-route">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-styles-of-rt-5-route" class="section-name selfRef">Styles of RT-5 Route</a>
      </h2>
<p id="section-4-1"> When a RT-5 route is used to forward a data packet, 
 the label/VNI/SID of that data packet's EVPN header 
 may be obtained relying on four different fields of that RT-5.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">In other words, we can say that RT-5 routes can be classified into four styles,
 which are called L-style, G-style, E-style, M-style respectively.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">These styles have different usages and they are suitable for different secenarios.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="sect-RT5L">
<section id="section-4.1">
        <h3 id="name-l-style-no-overlay-index">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-l-style-no-overlay-index" class="section-name selfRef">L-Style: no Overlay Index</a>
        </h3>
<p id="section-4.1-1">When a L-style RT-5 is used to forward a data packet, 
 the label/VNI/SID of that data packet's EVPN header is obtained 
 from the RT-5's own MPLS Label (that's why it is called L-Style) field (of its NLRI),
 and the forwarding path is determined by its own underlay next-hop (BGP next hop).<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">A L-style RT-5 route is also called as a RT-5L in this draft.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Note that the ESI and GW IP fields are both zero at the same time, otherwise it will be considered to be another style.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div id="sect-RT5L-Distributed">
<section id="section-4.1.1">
          <h4 id="name-rt-5l-advertisement-in-dist">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-rt-5l-advertisement-in-dist" class="section-name selfRef">RT-5L Advertisement in Distributed A-D Mode</a>
          </h4>
<p id="section-4.1.1-1">
 When N1/N2 establish CE-BGP sessions with both PE1 and PE2, 
 it is enough for PE1/PE2 to advertise RT-5L routes to DGW1.
 There is no need for RT-5G or RT-5E advertisement on PE1/PE2 in that usecase.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1.1-2">
 Note that when N1/N2 establish CE-BGP sessions with both PE1 and PE2, 
 the downlink VRF-interface addresses on PE1 
 and PE2 may be different IP addresses of the same subnet.
 Otherwise we may use loopback interfaces to establish the CE-BGP sessions.<a href="#section-4.1.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT5L-Centerlized">
<section id="section-4.1.2">
          <h4 id="name-rt-5l-advertisement-in-cent">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-rt-5l-advertisement-in-cent" class="section-name selfRef">RT-5L Advertisement in Centerlized A-D Mode</a>
          </h4>
<p id="section-4.1.2-1">When a PE advertises RT-5Ls just for its own direct subnets, 
 it can be used in both distributed A-D mode and centerlized A-D mode.
    When a PE advertises RT-5Ls for CE-prefixes, 
 it can not be used in centerlized A-D mode,
    otherwise the data forwarding will be centerlized too. 
 When a PE (which is a DC Gateway) advertises RT-5Ls 
 for external-prefixes (which are received from other DCs or non-EVPN neighbors),
 it can be used in either centerlized A-D mode or distributed A-D mode.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-RT5G">
<section id="section-4.2">
        <h3 id="name-g-style-gw-ip-as-overlay-in">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-g-style-gw-ip-as-overlay-in" class="section-name selfRef">G-Style: GW-IP as Overlay Index</a>
        </h3>
<p id="section-4.2-1">When a G-style RT-5 is used to forward a data packet, 
 the label/VNI/SID of that data packet's EVPN header is obtained 
 using another EVPN route whose IP field (of its NLRI) 
 matches this RT-5 route's own GW-IP (that's why it is called G-Style) field (of its NLRI),
 and the forwarding path is determined by that EVPN route.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">A G-style RT-5 route is also called as a RT-5G in this draft.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">RT-5G can be used wether the CE-prefex AD-mode 
 is centerlized mode or distributed mode.
 and RT-5G can be used wether the Service Interface 
 is Mono VLAN-based mode or Mutiple VLAN-based mode.
 It can be a uniform approach to advertise CE-prefixes 
 no matter what the EVPN mode is.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">Note that the ESI field of a RT-5G route MUST be zero as per <span>[<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<div id="sect-Distributed-RT5G">
<section id="section-4.2.1">
          <h4 id="name-rt-5g-advertisement-in-dist">
<a href="#section-4.2.1" class="section-number selfRef">4.2.1. </a><a href="#name-rt-5g-advertisement-in-dist" class="section-name selfRef">RT-5G Advertisement in Distributed A-D Mode</a>
          </h4>
<p id="section-4.2.1-1">It follows <span>[<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span> section 2.3.2 and section 6.2.
 Note that these procedures can be used in every L3EVI Service Interface, not just in IRC Service Interface.<a href="#section-4.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-Centerlized-RT5G">
<section id="section-4.2.2">
          <h4 id="name-rt-5g-advertisement-in-cent">
<a href="#section-4.2.2" class="section-number selfRef">4.2.2. </a><a href="#name-rt-5g-advertisement-in-cent" class="section-name selfRef">RT-5G Advertisement in Centerlized A-D Mode</a>
          </h4>
<p id="section-4.2.2-1">When a PE (which may be a DC gateway) learns that 
 CE-prefix prefix1's overlay next hop is IP1,
    then the PE advertise a RT-5G for prefix1, 
 the GW-IP of that RT-5G is set to IP1.<a href="#section-4.2.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2.2-2">An example of RT-5G advertisement in centeralized A-D mode can be found in <a href="#sect-RT5G-CenterAD" class="xref">Section 5</a>;<a href="#section-4.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-RT5E">
<section id="section-4.3">
        <h3 id="name-e-style-esi-as-overlay-inde">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-e-style-esi-as-overlay-inde" class="section-name selfRef">E-Style: ESI as Overlay Index</a>
        </h3>
<p id="section-4.3-1">When a E-style RT-5 is used to forward a data packet, 
 the label/VNI/SID of that data packet's EVPN header is obtained 
 from another RT-1 route whose ESI and Ethernet Tag ID 
 matches this RT-5 route's ESI (that's why it is called L-Style) and 
 Supplementary Overlay Index (<span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-3.3" class="relref">Section 3.3</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> 
 and <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.3.3" class="relref">Section 6.3.3</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>),
 and the forwarding path is determined by that RT-1 route.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">A E-style RT-5 route is also called as a RT-5E in this draft.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">RT-5E can only be used when the CE-prefex AD-mode is distributed mode.
 RT-5E can be used in Mono VLAN-based Service Interface.
 But when RT-5E is used in Multiple VLAN-based Service interface or Separated Risk VLAN-bundle service interface,
 the ACI-specific ethernet auto-discovery per <span>[<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> should be followed.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">Note that the GW-IP field of a RT-5E route MUST be zero as per <span>[<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<div id="sect-RT5E-BumpWire">
<section id="section-4.3.1">
          <h4 id="name-rt-5e-in-bump-in-the-wire-u">
<a href="#section-4.3.1" class="section-number selfRef">4.3.1. </a><a href="#name-rt-5e-in-bump-in-the-wire-u" class="section-name selfRef">RT-5E in Bump-in-the-wire use case</a>
          </h4>
<p id="section-4.3.1-1">The RT-5 route that specifies an ESI as overlay index is first defined 
 in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11#section-4.3" class="relref">Section 4.3</a> of [<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>,
 where the Bump-in-the-wire use case (the former RT-5E usage) is also defined there.<a href="#section-4.3.1-1" class="pilcrow">¶</a></p>
<p id="section-4.3.1-2">Then it is discussed in Section <a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-2.4" class="relref">2.4</a> and <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-3.6.4" class="relref">Section 3.6.4</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.
 The RT-5E routes (the latter RT-5E usage) of  <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-arp-nd-synch-without-irb-02#section-6" class="relref">Section 6</a> of revision-02 [<a href="#I-D.wang-bess-evpn-arp-nd-synch-without-irb-02" class="xref">I-D.wang-bess-evpn-arp-nd-synch-without-irb-02</a>]</span>
 and <span><a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-02#section-1.3" class="relref">Section 1.3</a> of [<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> are different from 
 these RT-5E routes of Bump-in-the-wire use case in the following factors:<a href="#section-4.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3.1-3.1">
              <p id="section-4.3.1-3.1.1">Source MAC - The ethernet header can not be absent in the former usage even if the data plane is MPLS.
       The source MAC MUST be set to the MAC address 
   of the IRB interface of BD-10 in Bump-in-the-wire usecase.
       But in the latter usage the ethernet header can be absent if the data plane is MPLS.<a href="#section-4.3.1-3.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-3.2">
              <p id="section-4.3.1-3.2.1">Recursive Resolution - The recursive resolution of the former usage are done in the context of a BD,
       But the recursive resolution of the latter usage are done in the context of a IP-VRF.<a href="#section-4.3.1-3.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-3.3">
              <p id="section-4.3.1-3.3.1">EVPN label - The EVPN label of the corresponding RT-1 per EVI route of the former usage is a MPLS label which identifies a BD,
       But the EVPN label of the corresponding RT-1 per EVI route of the latter usage is a MPLS label which identifies an IP-VRF.<a href="#section-4.3.1-3.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-4.3.1-3.4">
              <p id="section-4.3.1-3.4.1">ESI - The ESI of the former usage is attached to a BD,
       But ESIs of the latter usage are attached to IP-VRFs.<a href="#section-4.3.1-3.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-4.3.1-4">The Bump-in-the-wire use case is a special form of EVPN IRB use case,
 that's why it is different from the non-IRB use cases.<a href="#section-4.3.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.1">
<section id="section-4.3.2">
          <h4 id="name-rt-5e-advertisement-on-dist">
<a href="#section-4.3.2" class="section-number selfRef">4.3.2. </a><a href="#name-rt-5e-advertisement-on-dist" class="section-name selfRef">RT-5E Advertisement on Distributed L3 GW</a>
          </h4>
<p id="section-4.3.2-1">
    Given that PE1/PE2 (see <a href="#Fig-Center-RT5G" class="xref">Figure 1</a>) can install a synced ARP entry 
 to its proper VRF-interface benefitting from the RT-2 route of <a href="#sect-ARP-Synch" class="xref">Section 3.1</a>. 
 So it is not necessary for PE1/PE2 to advertise per-host IP prefixes to remote PEs (e.g. PE3) by RT-2 routes.
 It is recommended that PE1/PE2 advertise an RT-5E route per subnet to PE3 instead.
 The ESI of these RT-5E routes can be set to the ESI of the corresponding VRF interface. 
 If the VRF interface fails, these subnets will achieve more faster convergency on PE3 by the withdraw of the corresponding IP-AD/EVI route.<a href="#section-4.3.2-1" class="pilcrow">¶</a></p>
<p id="section-4.3.2-2">
 Note that N1/N2 may be a host or a router, when it is a router, 
 those subnets (which are advertised by RT-5E routes) will be the CE-prefixes behind it.
 When N1 and N2 are hosts, those subnets will be 
 the intermediate subnets (the subnet of N1/N2's own IP address).<a href="#section-4.3.2-2" class="pilcrow">¶</a></p>
<p id="section-4.3.2-3">When RT-5E routes are used to advertise direct-subnets, 
 the details can be found in <a href="#sect-RT5E-Centerlized" class="xref">Section 4.3.3</a>.
 When RT-5E routes are used to advertise CE-prefixes, 
 there are two approaches,
 the details can be found in <span><a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-02#section-1.3" class="relref">Section 1.3</a> of [<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> 
 and <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.3" class="relref">Section 6.3</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>.<a href="#section-4.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT5E-Centerlized">
<section id="section-4.3.3">
          <h4 id="name-rt-5e-advertisement-in-cent">
<a href="#section-4.3.3" class="section-number selfRef">4.3.3. </a><a href="#name-rt-5e-advertisement-in-cent" class="section-name selfRef">RT-5E Advertisement in Centerlized A-D mode</a>
          </h4>
<p id="section-4.3.3-1">When the CE-prefixes are discovered by centerlized auto-discovery approaches,
 the RT-5E can be used to advertise the direct-subnets of NVE1/NVE2,
 but these RT-5E routes are not used to advertise the CE-Prefixes.<a href="#section-4.3.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3.3-2">When the direct-subnets are advertised by RT-5E routes,
 when the main-interface of the corresponding ESI fails,
 mass-withdraw procedures can be triggered for these prefiexes.
 This is the advantage of advertising direct-subnets through RT-5E routes instead of RT-5L routes.<a href="#section-4.3.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3.3-3">Note that the example of the mass-withdraw use-case of RT-5E routes can be found in <a href="#sect-Mass-Withdraw" class="xref">Section 5.4</a>.
 and it can be used in Dstributed A-D mode too.<a href="#section-4.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-RT5M">
<section id="section-4.4">
        <h3 id="name-m-style-mac-as-overlay-inde">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-m-style-mac-as-overlay-inde" class="section-name selfRef">M-Style: MAC as Overlay Index</a>
        </h3>
<p id="section-4.4-1">When a M-style RT-5 is used to forward a data packet, 
 the label/VNI/SID of that data packet's EVPN header is obtained using another RT-2 route whose MAC field (of its NLRI) matches this RT-5 route's own RMAC,
 and the forwarding path is determined by that RT-2 route.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">A M-style RT-5 route is also called as a RT-5M in this draft.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">RT-5M is used in Interfaceful IP-VRF-to-IP-VRF mode and Bump-in-the-wire use case as per <span>[<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>.<a href="#section-4.4-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-RT5G-CenterAD">
<section id="section-5">
      <h2 id="name-centerlized-rt-5g-advertise">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-centerlized-rt-5g-advertise" class="section-name selfRef">Centerlized RT-5G Advertisement for Distributed L3 Forwarding</a>
      </h2>
<p id="section-5-1">
 When N1/N2/N3 is a router, it is called R1/R2/R3 in the following figure.
 Note that <a href="#Fig-PhyLinks" class="xref">Figure 6</a> only illustrates the physical ethernet links, 
 but <a href="#Fig-Center-RT5G" class="xref">Figure 1</a> illustrates the logical L3 adjacencies between PE and CE as the following.  
 We assume that ESI21 are attched to L3EVI VPNx of <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-1.1.2" class="relref">Section 1.1.2</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<span id="name-centerlized-rt-5g-advertisem"></span><div id="Fig-Center-RT5G">
<figure id="figure-1">
        <div class="artwork art-text alignLeft" id="section-5-2.1">
<pre>
                   PE1
                  +----------+
                  | +------+ | ------&gt;
 R1               | |      | | RT-1
+-------+         | | VPNx | | ESI21
|       |  P1.1   | |      | | ETI1
| ...................(10.9)| |
| .     |  ESI21  | +------+ |                          DGW1
| .     |    +    +----------+                    +-------------+
| .     |    |       ^                &lt;---------- |             |
| .     |    |       | RT-2            RT-5G      | +---------+ |
|(10.2) |    |       | 10.2            CE-Prefix1 | |  VPNx   | |
| .     |    |       | ESI21           GW-IP=10.2 | |         |....R3
| .     |    |       |                            | |(3.3.3.3)| |
| .     |    +    +----------+ ------&gt;            | +---------+ |
| .     |  ESI21  | +------+ | RT-2R              |   ^         |
| ...................(10.9)| | 10.2               |   |         |
|       |  P2.1   | |      | | ESI21              +---|---------+
+-------+         | | VPNx | |                        |
    |             | |      | | ------&gt;                | CE-BGP
    |             | +------+ | RT-1                   | Prefix1
    |             +----------+ ESI21                  | NH=10.2
    |              PE2         ETI1                   |
    |                   CE-BGP                        |
    +---------------------&gt;---------------------------+

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-centerlized-rt-5g-advertisem" class="selfRef">Centerlized RT-5G Advertisement</a>
        </figcaption></figure>
</div>
<p id="section-5-3">
 If R1 prefers to establish a single CE-BGP session, 
 it can establish the CE-BGP session with DC GW (e.g. PE3 of <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-1.1.2" class="relref">Section 1.1.2</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>) instead.
    This CE-BGP session can be called the centerlized CE-BGP session.
 But when we use centerlized CE-BGP session, we should use RT-5G route instead.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">
 Note that we just use centerlized CE-BGP session to discover CE-prefixes, 
 but we still expect a distributed Layer 3 forwarding framework.<a href="#section-5-4" class="pilcrow">¶</a></p>
<div id="sect-C-RT5G-temp2">
<section id="section-5.1">
        <h3 id="name-ce-side-configurations">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-ce-side-configurations" class="section-name selfRef">CE-side Configurations</a>
        </h3>
<p id="section-5.1-1">Let us assume that <a href="#Sect-appendix-AA-CCC-Approache" class="xref">CCC Active-Active Protection</a> are used inside PNEC1,
 that's to say, when R1 send packets to 10.9,
 these packets will be load-balanced between PE1 and PE2.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-C-RT5G-temp1">
<section id="section-5.2">
        <h3 id="name-why-centerlized-a-d-mode-is">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-why-centerlized-a-d-mode-is" class="section-name selfRef">Why Centerlized A-D mode is used</a>
        </h3>
<p id="section-5.2-1">Because of the factors discussed in <a href="#sect-C-RT5G-temp2" class="xref">Section 5.1</a>, 
 perhaps the CE-BGP session can be established between 10.2 and 10.9.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">There may be other reasons that prevent the routing protocols to be established between 10.2 and 10.9.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-C-RT5G-Basic-CP">
<section id="section-5.3">
        <h3 id="name-basic-control-plane-procedu">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-basic-control-plane-procedu" class="section-name selfRef">Basic Control Plane Procedures</a>
        </h3>
<div id="sect-6.2.1">
<section id="section-5.3.1">
          <h4 id="name-centerlized-ce-bgp">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-centerlized-ce-bgp" class="section-name selfRef">Centerlized CE-BGP</a>
          </h4>
<p id="section-5.3.1-1">
    The CE-BGP session between R1 and DGW1 (when PE3 is a DC GW, it is called DGW1) is established between 10.2 and 3.3.3.3.
    The IP address 10.2 is called the uplink interface address of R1 in this document.
    The IP address 3.3.3.3 is called the centerlized loopback address of VPNx in this document. 
 The IP address 10.9 is called the downlink VRF-interface address of PE1/PE2 in this document.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2">
 R1 advertises a BGP route for a prefix (say "Prefix1") behind it to DGW1 via that CE-BGP session.
 The nexthop for Prefix1 is R1's uplink interface address (say 10.2).<a href="#section-5.3.1-2" class="pilcrow">¶</a></p>
<p id="section-5.3.1-3">
 Note that the data packets from R1 to the centerlized loopback address may be routed following the default route on R1.
 Thus DGW1 don't need to use the CE-BGP session to advertise prefixes of VPNx to R1.<a href="#section-5.3.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.2.2">
<section id="section-5.3.2">
          <h4 id="name-rt-2e-advertisement-from-pe">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-rt-2e-advertisement-from-pe" class="section-name selfRef">RT-2E Advertisement from PE1/PE2 to DGW1</a>
          </h4>
<p id="section-5.3.2-1">
    When PE1 learns the ARP entry of 10.2, it advertises a RT-2R route to DGW1.
 The ESI value of the RT-2R route is ESI21, which is the ESI of PE1's downlink VRF-interface for R1.
 The RT-2R route is constructed following <a href="#sect-ARP-Synch" class="xref">Section 3.1</a>. 
 This is a mono VLAN-based service interface, thus the ETI1 (Ethernet Tag ID 1) of that RT-2R route can be 0.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">
 Note that in <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, when the ESI is single-active, 
 the MAC forwarding only use the label and the BGP nexthop of the RT-2R route 
 as long as they are valid for forwarding status.
 But in RT-5E routes we assume that the ESI is always preferred even if the ESI is single-active. 
 This is follows <span>[<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span> section 3.2 Table 1.<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT5G-on-DGW">
<section id="section-5.3.3">
          <h4 id="name-rt-5g-advertisement-from-dg">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-rt-5g-advertisement-from-dg" class="section-name selfRef">RT-5G Advertisement from DGW1 to PE1/PE2</a>
          </h4>
<p id="section-5.3.3-1">
    When DGW1 receives the prefix1 from the CE-BGP session. 
 The nexthop for Prefix1 is 10.2.
 So DGW1 advertises a RT-5G route to PE1/PE2 for Prefix1.
 The GW-IP value of the RT-5G route for Prefix1 is 10.2.<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3.3-2">
 Note that DGW1 can load-balance packets for Prefix1 via the IP-AD/EVI routes (of ESI21) from PE1/PE2.
 Because ESI21 (which is advertised along with RT-2R of 10.2) is the ESI for Prefix1's GW-IP.<a href="#section-5.3.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3.3-3">
 Note that the centerlized loopback address is advertised to PE1/PE2 by DGW1 via RT-5L route.
 The nexthop of the RT-5L route is DGW1.
 The label of the RT-5L route is VPNx's label on DGW1.
 The RMAC of the RT-5L route is DGW1's MAC when the encapsulation is VXLAN.<a href="#section-5.3.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.2.4">
<section id="section-5.3.4">
          <h4 id="name-rt-2e-advertisement-between">
<a href="#section-5.3.4" class="section-number selfRef">5.3.4. </a><a href="#name-rt-2e-advertisement-between" class="section-name selfRef">RT-2E Advertisement between PE1 and PE2</a>
          </h4>
<p id="section-5.3.4-1">
 The RT-2R routes advertisement between PE1 and PE2 is used to sync their ARP entries to each other in order to avoid ARP missing.
 The ESI Value of these two RT-2R routes is ESI21.<a href="#section-5.3.4-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-Mass-Withdraw">
<section id="section-5.4">
        <h3 id="name-mass-withdraw-by-ead-es-rou">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-mass-withdraw-by-ead-es-rou" class="section-name selfRef">Mass-Withdraw by EAD/ES Route</a>
        </h3>
<p id="section-5.4-1">In the figure of <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-1.1.2" class="relref">Section 1.1.2</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>, there are two L3EVIs, VPNx and VPNy.
 We just take VPNx for example in <a href="#sect-C-RT5G-Basic-CP" class="xref">Section 5.3</a>, now we consider these two L3EVIs together.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<span id="name-mono-vlan-based-s-i-use-cas"></span><div id="Fig-UseCase-MassWithdraw">
<figure id="figure-2">
          <div class="artwork art-text alignLeft" id="section-5.4-2.1">
<pre>
                                    +-----------------------+
 PNEC1                      PE1     |                       |
+-------------+          +----------+--------+              |
|             |          |  __(20.9)__(VPNy) | Withdraw     |
| Prefix1  "  |   P1     | /                 | IP-AD/ES     |
|  /       #===========X==&lt;                  | ----X---&gt;    | DGW1
| R1_______"  |  ESI21   | \__      __       |         +----+----+
|    10.2  "  |    +     |    (10.9)  (VPNx) |         |         |
|          "  |    |     +-----------+-------+         |(3.3.3.3)|
|          "  |    |                 |                 |    |    |
| Prefix2  "  |    |                 |                 |  (VPNx)---+N3
|  /       "  |    |        PE2      |                 |         |
| R2_______"  |    |     +-----------+-------+         |  (VPNy)---+N5
|    20.2  "  |    +     |  __(20.9)__(VPNy) |         |         |
|          "  |  ESI21   | /                 |         +----+----+
|          #==============&lt;                  |              |
|          "  |   P2     | \__      __       |              |
|             |          |    (10.9)  (VPNx) |              |
+-------------+          +----------+--------+              |
                                    |                       |
                                    +-----------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-mono-vlan-based-s-i-use-cas" class="selfRef">Mono VLAN-based S-I Use Case</a>
          </figcaption></figure>
</div>
<p id="section-5.4-3">
 When the physical interface of the downlink VRF-interface (P1) on PE1 fails (illustrated by the 'X' on P1),
 PE1 will withdraw the IP-AD/ES route of ESI21, 
 so DGW1 will re-route 10.2 for VPNx's CE-prefiex1. 
 and re-route 20.2 for VPNy's CE-prefix2 at the same time.
 Then data packets for CE-Prefix1 and CE-Prefix2 will be sent to PE2 instead.<a href="#section-5.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-C-RT5G-MultiVBase">
<section id="section-5.5">
        <h3 id="name-if-mutiple-vlan-based-servi">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-if-mutiple-vlan-based-servi" class="section-name selfRef">If Mutiple VLAN-based Service Inerface is Used</a>
        </h3>
<p id="section-5.5-1">Now we assume that ESI21 are attached to L3EVI VPN1 according to <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-1.1.3" class="relref">Section 1.1.3</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.
 And we assume that <a href="#Sect-appendix-AA-CCC-Approache" class="xref">CCC Active-Active Protection</a> are used inside PNEC1.<a href="#section-5.5-1" class="pilcrow">¶</a></p>
<span id="name-mutiple-vlan-based-s-i-use-"></span><div id="Fig-UseCase-MutiVBase">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-5.5-2.1">
<pre>
                                 +--------------------------+
 PNEC1                      PE1  |                          |
+-------------+          +-------+------+                   | DGW1'
|             |          | X__(20.9)    | ----X----&gt;   +----+----+
|          "  |   P1     | /        \   | Withdraw     |         |
|          #==============&lt;      (VPN1) | IP-AD/EVI    |  (VPN1)---+N6
| R1_______"  |  ESI21   | \__      /   | ET-ID=2      |         |
|    10.2  "  |    +     |    (10.9)    |              +----+----+
|          "  |    |     +--------+-----+                   |
|          "  |    |              |                         |
|          "  |    |              |                         | DGW1
|          "  |    |        PE2   |                    +----+----+
| R2_______"  |    |     +--------+-----+              |         |
|    20.2  "  |    +     |  __(20.9)    |              |(3.3.3.3)|
|          "  |  ESI21   | /        \   | Withdraw     |    |    |
|          #==============&lt;      (VPN1) | IP-AD/EVI    |  (VPN1)---+N3
|          "  |   P2     | \__      /   | ET-ID=1      |         |
|             |          | X  (10.9)    | ----X----&gt;   +----+----+
+-------------+          +-------+------+                   |
                                 |                          |
                                 +--------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-mutiple-vlan-based-s-i-use-" class="selfRef">Mutiple VLAN-based S-I Use Case</a>
          </figcaption></figure>
</div>
<p id="section-5.5-3">When physical port P3 (see <a href="#Fig-PhyLinks" class="xref">Figure 6</a>, which illustrates the physical links of <a href="#Fig-UseCase-MutiVBase" class="xref">Figure 3</a>) fails, 
 the CFM session of P2.1 (10.9 of PE2) goes down (illustrated by the 'X' inside PE2), 
 while the CFM session of P2.2 (20.9 of PE2) continues to be UP.
 thus only the IP-AD/EVI route (whose ET-ID=1) of P2.1 should be withdrawn by PE2. 
 the IP-AD/EVI route (where ET-ID=2) of P2.2 and the IP-AD/ES route should not be withdrawn by PE2.<a href="#section-5.5-3" class="pilcrow">¶</a></p>
<p id="section-5.5-4">Note that if the ET-IDs of these two IP-AD/EVI routes are the same,
 when P2.1 fails, DGW1 will continue to load-balance traffics whose DA=20.2 to PE2,
 because that there is still another IP-AD/EVI route (of VPN1) whose ESI and ET-ID are the same.
 That's why ACI-specifice Ethernet auto-discovery mode <span>[<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> should be followed in this case.<a href="#section-5.5-4" class="pilcrow">¶</a></p>
<p id="section-5.5-5">
 Note that we assume that the ARP entry for 10.2 will be learnt on PE1 only, and 20.2 will be learnt on PE2 only.
 Note that the two downlink VRF-interfaces P2.1 (to R1) and P2.2 (to R2) on PE2 are sub-interfaces of the same physical interface P2.
    So they have the same ESI. ESI21 are attached to L3EVI VPN1 using multiple VLAN-based service interface,
 thus the mass-withdraw procedures of <a href="#sect-Mass-Withdraw" class="xref">Section 5.4</a> can be used in this case too.<a href="#section-5.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-C-RT5G-bundle">
<section id="section-5.6">
        <h3 id="name-if-vlan-bundle-service-inte">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-if-vlan-bundle-service-inte" class="section-name selfRef">If VLAN-bundle Service Interface is Used</a>
        </h3>
<p id="section-5.6-1">If R1 and R2 can share the same gateway IP address, 
 P2.1 and P2.2 can be aggregated into the same subinterface (where the shared gateway IP is configured to).
 Although they are aggregated, this can't change the fact that they don't share the same risks.
 When that physical interface P3 (see <a href="#Fig-PhyLinks" class="xref">Figure 6</a>)  fails, one of them will fail, while the other will continue to work well.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">Thus different (in ET-ID) IP-AD/EVI routes for P2.1 and P2.2 should be advertised separately.
 That's why <span>[<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> should be followed in this case.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-6.2.8">
<section id="section-5.7">
        <h3 id="name-on-the-failure-of-pe3-node">
<a href="#section-5.7" class="section-number selfRef">5.7. </a><a href="#name-on-the-failure-of-pe3-node" class="section-name selfRef">On the Failure of PE3 Node</a>
        </h3>
<p id="section-5.7-1">
 Take the <a href="#Fig-UseCase-MutiVBase" class="xref">Figure 3</a> for example, on the failure of DGW1, PE1/PE2 should delay the deletion of the RT-5G route from DGW1.
 DGW1 can use a new BGP attribute to indicate the delayed-deletion requirement to PE1/PE2.
 Otherwise the L3 traffic between R1 and R2 will be interrupted.
 Fortunately, DGW1 will typically have a redundant node (DGW1' in <a href="#Fig-UseCase-MutiVBase" class="xref">Figure 3</a>), 
 and DGW1' can be used to take DGW1's place when DGW1 fails.<a href="#section-5.7-1" class="pilcrow">¶</a></p>
<p id="section-5.7-2">
 Note that from the viewpoint of R1 and R2, the total of PE1, PE2, DGW1, DGW1' and the underlay network between them is regarded as the following VNF:<a href="#section-5.7-2" class="pilcrow">¶</a></p>
<span id="name-evpn-instance-as-a-vnf"></span><div id="Fig-EVI-as-VNF">
<figure id="figure-4">
          <div class="artwork art-text alignLeft" id="section-5.7-3.1">
<pre>
+---------------------------------+
|                                 |
|    +----------------------+     |
|    |  MPU1 (DGW1)         |     |
|    +----------------------+     |
|                                 |
|    +----------------------+     |
|    |  MPU2 (DGW1')        |     |
|    +----------------------+     |
|                                 |
|    +----------------------+     |
|    |  LPU1 (PE1)          |----------------R1
|    +----------------------+     |
|                                 |
|    +----------------------+     |
|    |  LPU2 (PE2)          |----------------R2
|    +----------------------+     |
|                                 |
+---------------------------------+</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-evpn-instance-as-a-vnf" class="selfRef">EVPN Instance as a VNF</a>
          </figcaption></figure>
</div>
<p id="section-5.7-4">
 R1 and R2 connect to the LPUs of the VNF. and the data packets between R1 and R2 just pass through the LPUs, not through the MPUs.
 But R1/R2 establish the BGP session with the MPUs, not the LPUs. 
 When the MPU1(or actually DGW1) fails, the LPUs(or actually PE1/PE2) will keep the forwarding state unchanged untill the MPU1 or MPU2 comes up.
 So the delayed deletion on PE1/PE2 for DGW1's sake is apprehensible for the same reason.<a href="#section-5.7-4" class="pilcrow">¶</a></p>
<p id="section-5.7-5">Note that for the north-bound traffics, the DC GWs also plays a LPU role of this VNF.<a href="#section-5.7-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-C-RT5G-loopback-NH">
<section id="section-5.8">
        <h3 id="name-for-common-ce-prefixes-behi">
<a href="#section-5.8" class="section-number selfRef">5.8. </a><a href="#name-for-common-ce-prefixes-behi" class="section-name selfRef">For Common CE-prefixes behind R1 and R2</a>
        </h3>
<p id="section-5.8-1">We can assume that there is a common prefix (say Prefix3) behind both R1 and R2, 
 That's saying that DGW1 can reach Prefix3 through either R1 or R2.
 When R1 advertise Prefix3 to DGW1 over that CE-BGP session,
 10.2 may not be the best choice for Prefix3's BGP next hop.<a href="#section-5.8-1" class="pilcrow">¶</a></p>
<span id="name-ip-aliasing-of-common-ce-pr"></span><div id="Fig-Comon-CE-Prefixes">
<figure id="figure-5">
          <div class="artwork art-text alignLeft" id="section-5.8-2.1">
<pre>
      EVPN Instance as a VNF
+---------------------------------+
|                                 |
|    +----------------------+     |
|    |  MPU1 (DGW1)         |&lt;---------&lt;-----+
|    +----------------------+     |          |
|                                 |          ^
|    +----------------------+     |          | CE-BGP
|    |  MPU2 (DGW1')        |     |          | Prefix3
|    +----------------------+     |          | NH=7.7.7.7
|                                 |          |
|    +----------------------+     |     10.2 |
|    |  LPU1 (PE1)          |---------------[R1(7.7.7.7)]---+
|    +----------------------+     |                         |
|                                 |                       Prefix3
|    +----------------------+     |     20.2                |
|    |  LPU2 (PE2)          |---------------[R2(7.7.7.7)]---+
|    +----------------------+     |
|                                 |
+---------------------------------+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-ip-aliasing-of-common-ce-pr" class="selfRef">IP Aliasing of Common CE-Prefixes</a>
          </figcaption></figure>
</div>
<p id="section-5.8-3">In such case, we can configure a common anycast loopback address (say 7.7.7.7) on R1 and R2.
 Then, when R1 advertise Prefix3 to DGW1, R1 choose 7.7.7.7 to be the BGP next-hop of the advertisement.
 Thus the RT-5G of Prefix3 from DGW1 will be advertised along with GW-IP=7.7.7.7.<a href="#section-5.8-3" class="pilcrow">¶</a></p>
<p id="section-5.8-4">In addition to the common prefixes behind R1 and R2,
 there will be exclusive prefixes particular to R1 or R2,
 and maybe R1/R2 can't distinguish the common prefixes from the exclusive prefixes,
    so R1/R2 just advertise all prefixes behind it to PEs by CE-BGP using the common nexthop (e.g. 10.2).
   then the PEs can not distinguish the common prefixes from the exclusive prefixes either.
 Thus RT-5E routes can not be used even if distributed CE-prefix auto-discovery mode is used,
 because that PE1/PE2 can't advertise different ESIs for the common prefixes and the exclusive prefixes.<a href="#section-5.8-4" class="pilcrow">¶</a></p>
<p id="section-5.8-5">The ECMP-Merging approaches of Section <a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.2.1" class="relref">6.2.1</a> and <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.2.2" class="relref">Section 6.2.2</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span> 
 can also be used in such cases in order to simplify the required recursive resolution.<a href="#section-5.8-5" class="pilcrow">¶</a></p>
<p id="section-5.8-6">If one of the PEs can't resolve the GW-IP (e.g. 7.7.7.7) 
 of a RT-5G route to another RT-5 route (e.g. the RT-5L route of 7.7.7.7),
 DGW1 can proxy the recursive resolution for other PEs.
 When 7.7.7.7 can be resolved to two RT-2 routes of 10.2 and 20.2,
 DGW1 can advertise the RT-5G route of the CE-prefix along with GW-IP=10.2 or GW-IP=20.2.
 Further, DGW1 may advertise two RT-5G routes for that CE-prefix,
 10.2 is the GW-IP of one of them, 20.2 is the GW-IP of the other.<a href="#section-5.8-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-7">
<section id="section-6">
      <h2 id="name-load-balancing-of-unicast-p">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-load-balancing-of-unicast-p" class="section-name selfRef">Load Balancing of Unicast Packets</a>
      </h2>
<div id="sect-LB-GWIP">
<section id="section-6.1">
        <h3 id="name-ip-aliasing-using-gw-ip">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-ip-aliasing-using-gw-ip" class="section-name selfRef">IP Aliasing using GW-IP</a>
        </h3>
<p id="section-6.1-1">When a RT-5G's GW-IP can be resolved to an ECMP-list of RT-5L (e.g. <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.2.1" class="relref">Section 6.2.1</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>) routes,
 we can say that the IP aliasing is implemented using GW-IP.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">
 Note that when the encapsulation is VXLAN, in this case, PE3 will encapsulate the RMAC per each path of that ECMP-list.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-LB-L3ESI">
<section id="section-6.2">
        <h3 id="name-ip-aliasing-using-esi">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-ip-aliasing-using-esi" class="section-name selfRef">IP Aliasing using ESI</a>
        </h3>
<p id="section-6.2-1">When a RT-5G's GW-IP can only be resolved to a single RT-2R (e.g. <a href="#sect-RT5G-on-DGW" class="xref">Section 5.3.3</a>, where the RT-5G is a local-discovered RT-5G) route,
 but the &lt;ESI,SOI&gt; of that RT-2R route can be resolved to an ECMP-list of RT-1 routes,
 we can say that the IP aliasing is implemented using ESI.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">
    It is similar to <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> except for a few notable
    exceptions as explained in the following.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlNewline" id="section-6.2-3">
          <dt id="section-6.2-3.1">o How to encapsulate Destination MAC ?</dt>
          <dd style="margin-left: 1.0em" id="section-6.2-3.2">
            <span class="break"></span><dl class="dlParallel" id="section-6.2-3.2.1">
              <dt id="section-6.2-3.2.1.1">* The IP-AD/EVI routes don't have their own RMAC -</dt>
              <dd style="margin-left: 1.0em" id="section-6.2-3.2.1.2">
                <p id="section-6.2-3.2.1.2.1">Note that when the encapsulation is VXLAN, 
   PE3 will encapsulate the RMAC of the RT-2R route for corresponding GW-IP address.
   And the RMAC of PE1 MUST have the same value with the RMAC of PE2. 
   This can be achieved by configuration.<a href="#section-6.2-3.2.1.2.1" class="pilcrow">¶</a></p>
</dd>
              <dd class="break"></dd>
<dt id="section-6.2-3.2.1.3">* The IP-AD/EVI routes have their own RMAC -</dt>
              <dd style="margin-left: 1.0em" id="section-6.2-3.2.1.4">
                <p id="section-6.2-3.2.1.4.1">Note that when the encapsulation is VXLAN, 
   PE3 will encapsulate the RMAC of an IP-AD/EVI route in that ECMP-list.
   When an IP packet is encapsulated with a VNI label according to an IP-AD/EVI route, 
   the packet SHOULD be encapsulated with a Destination-MAC 
   according to the RMAC of that IP-AD/EVI route, 
   if and only if the IP-AD/EVI route have a RMAC of its own.<a href="#section-6.2-3.2.1.4.1" class="pilcrow">¶</a></p>
</dd>
            <dd class="break"></dd>
</dl>
</dd>
          <dd class="break"></dd>
<dt id="section-6.2-3.3">o How to select the IP-AD/EVI routes?</dt>
          <dd style="margin-left: 1.0em" id="section-6.2-3.4">
            <p id="section-6.2-3.4.1">When selecting corresponding IP-AD/EVI routes for a RT-5E route,
 the procedures discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span> should be followed.<a href="#section-6.2-3.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="sect-IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">no IANA Considerations.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">TBD.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.wang-bess-evpn-ether-tag-id-usage">[I-D.wang-bess-evpn-ether-tag-id-usage]</dt>
        <dd>
<span class="refAuthor">Wang, Y.</span>, <span class="refTitle">"Ethernet Tag ID Usage Update for Ethernet A-D per EVI Route"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wang-bess-evpn-ether-tag-id-usage-03</span>, <time datetime="2021-08-26" class="refDate">26 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03">https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.sajassi-bess-evpn-ip-aliasing">[I-D.sajassi-bess-evpn-ip-aliasing]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Badoni, G.</span>, <span class="refAuthor">Warade, P.</span>, <span class="refAuthor">Pasupula, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"EVPN Support for L3 Fast Convergence and Aliasing/Backup Path"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sajassi-bess-evpn-ip-aliasing-02</span>, <time datetime="2021-06-08" class="refDate">8 June 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-02">https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-prefix-advertisement">[I-D.ietf-bess-evpn-prefix-advertisement]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"IP Prefix Advertisement in EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-prefix-advertisement-11</span>, <time datetime="2018-05-18" class="refDate">18 May 2018</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11">https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-evpn-inter-subnet-forwarding">[I-D.ietf-bess-evpn-inter-subnet-forwarding]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Integrated Routing and Bridging in EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-inter-subnet-forwarding-15</span>, <time datetime="2021-07-26" class="refDate">26 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-inter-subnet-forwarding-15">https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-inter-subnet-forwarding-15</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8679">[RFC8679]</dt>
        <dd>
<span class="refAuthor">Shen, Y.</span>, <span class="refAuthor">Jeganathan, M.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Gredler, H.</span>, <span class="refAuthor">Michel, C.</span>, and <span class="refAuthor">H. Chen</span>, <span class="refTitle">"MPLS Egress Protection Framework"</span>, <span class="seriesInfo">RFC 8679</span>, <span class="seriesInfo">DOI 10.17487/RFC8679</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8679">https://www.rfc-editor.org/info/rfc8679</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wz-bess-evpn-vpws-as-vrf-ac">[I-D.wz-bess-evpn-vpws-as-vrf-ac]</dt>
        <dd>
<span class="refAuthor">Wang, Y.</span> and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"EVPN VPWS as VRF Attachment Circuit"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wz-bess-evpn-vpws-as-vrf-ac-02</span>, <time datetime="2021-08-28" class="refDate">28 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02">https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.sajassi-bess-evpn-ac-aware-bundling">[I-D.sajassi-bess-evpn-ac-aware-bundling]</dt>
      <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Brissette, P.</span>, <span class="refAuthor">Mishra, M. P.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">J. Drake</span>, <span class="refTitle">"AC-Aware Bundling Service Interface in EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sajassi-bess-evpn-ac-aware-bundling-04</span>, <time datetime="2021-07-11" class="refDate">11 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ac-aware-bundling-04">https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ac-aware-bundling-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-idr-tunnel-encaps">[I-D.ietf-idr-tunnel-encaps]</dt>
        <dd>
<span class="refAuthor">Patel, K.</span>, <span class="refAuthor">Velde, G.</span>, <span class="refAuthor">Sangli, S.</span>, and <span class="refAuthor">J. Scudder</span>, <span class="refTitle">"The BGP Tunnel Encapsulation Attribute"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-idr-tunnel-encaps-22</span>, <time datetime="2021-01-07" class="refDate">7 January 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-idr-tunnel-encaps-22">https://datatracker.ietf.org/doc/html/draft-ietf-idr-tunnel-encaps-22</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wang-bess-evpn-arp-nd-synch-without-irb-02">[I-D.wang-bess-evpn-arp-nd-synch-without-irb-02]</dt>
      <dd>
<span class="refAuthor">Wang, Y.</span> and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"ARP/ND Synching And IP Aliasing without IRB"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wang-bess-evpn-arp-nd-synch-without-irb-02</span>, <time datetime="2019-11-28" class="refDate">28 November 2019</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-arp-nd-synch-without-irb-02">https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-arp-nd-synch-without-irb-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="Sect-appendix-PL-Explain">
<section id="appendix-A">
      <h2 id="name-explanation-for-physical-li">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-explanation-for-physical-li" class="section-name selfRef">Explanation for Physical Links of the Use-cases</a>
      </h2>
<span id="name-physical-links-illustrated"></span><div id="Fig-PhyLinks">
<figure id="figure-6">
        <div class="artwork art-text alignCenter" id="appendix-A-1.1">
<pre>
                                    +------------------+
                          PE1       | P6               |
            L2NE1        +----------+---------+        |
         +----------+    |  __(P1.1)__(VPNx)  |        |
+---+ P4 |          | P1 | /            \     |        |
|N1 |-----O==------=======&lt;             (NIz) |     P6 |    PE3
+---+    |   \    / |    | \__      __  /     |   +----+-------+
         |    |  |  |    |    (P1.2)  (VPNy)  |   |            |
         +----|P3|--+    +-----------+--------+   |      (VPNx)--+N3
              |  |                   |            |      /     |
         P3.1 |  | P3.2              | P7         | (NIz)--------+N4
              |  |        PE2        |            |      \     |
         +----|P3|--+    +-----------+--------+   |      (VPNy)--+N5
         |     \/   |    |  __(P2.2)__(VPNy)  |   |            |
+---+    |     /\   |    | /            \     |   +----+-------+
|N2 |-----O====--=========&lt;            (NIz)  |     P8 |
+---+ P5 |          | P2 | \__      __  /     |        |
         +----------+    |    (P2.1)  (VPNx)  |        |
            L2NE2        +----------+---------+        |
                                    | P8               |
                                    +------------------+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-physical-links-illustrated" class="selfRef">Physical Links Illustrated</a>
        </figcaption></figure>
</div>
<p id="appendix-A-2">There are three PEs, two L2NEs (Layer 2 Network Elements) and five L3NEs (Layer 3 Network Elements) in abobe network.
 The PEs are PE1, PE2 and PE3. The L2NEs are L2NE1 and L2NE2. The L3NEs are N1/N2/N3/N4/N5. 
 They are all illustrated in <a href="#Fig-PhyLinks" class="xref">Figure 6</a>.<a href="#appendix-A-2" class="pilcrow">¶</a></p>
<p id="appendix-A-3">There are 9 physical links among these 10 physical devices as illustrated in <a href="#Fig-PhyLinks" class="xref">Figure 6</a>. 
 These physical links are called as PLi (i=1,2...8).
 The two physical ports of the same physical link PLi are both called as Pi (i=1,2...8).<a href="#appendix-A-3" class="pilcrow">¶</a></p>
<p id="appendix-A-4">As illustrated in <a href="#Fig-PhyLinks" class="xref">Figure 6</a>, some of these physical ports may have subinterfaces.
 When a subinterface's VLAN ID is j and it is physical port Pi's subinterface, that subinterface is called as Pi.j.
 For example, P1.2 is a subinterface of physical port P1 and its VLAN ID is 2.<a href="#appendix-A-4" class="pilcrow">¶</a></p>
<p id="appendix-A-5">There are three NIs (Network Instances) among PE1, PE2 and PE3. They are VPNx, VPNy and NIz.
 Two subinterfaces are attached to VPNx, they are P1.1 and P2.1.
 Other two subinterfaces are attached to VPNy, they are P1.2 and P2.2.
 N3 is also attched to VPNx, while N5 is also attached to VPNy.<a href="#appendix-A-5" class="pilcrow">¶</a></p>
<p id="appendix-A-6">There are two EVCs (Ethernet Virtual Connections) between L2NE1 and L2NE2, they are EVC1 and EVC2.
 The L2NE1's EVC1 instance (which is illustrated as the "O" on L2NE1) have three member interfaces, they are P4, P1.1 and P3.1, where P3.1 and P1.1 are of the same protection-group.
 The L2NE2's EVC1 instance have two member interfaces, they are P3.1 and P2.1.
 The L2NE2's EVC2 instance (which is illustrated as the "O" on L2NE2) have three member interfaces, they are P5, P2.2 and P3.2, where P3.1 and P1.1 are of the same protection-group.
 The L2NE1's EVC2 instance have two member interfaces, they are P3.2 and P1.2.
 The L2NE2's EVC1 instance and L2NE1's EVC2 instance are both CCC (Circuit Cross Connection) local connections.<a href="#appendix-A-6" class="pilcrow">¶</a></p>
<p id="appendix-A-7">VPNx and VPNy are associated to NIz on each PE.<a href="#appendix-A-7" class="pilcrow">¶</a></p>
<div id="Sect-appendix-PLs-Detect">
<section id="appendix-A.1">
        <h3 id="name-failure-detections-for-p12-">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-failure-detections-for-p12-" class="section-name selfRef">Failure Detections for P1.2 (or P2.1)</a>
        </h3>
<p id="appendix-A.1-1">There is a CFM session CFM1 between P1.2 of PE1 and L2NE2's P3.2, when physical port P3 fails, the CFM session CFM1 will go down. 
 There is a CFM session CFM2 between P2.1 of PE2 and L2NE1's P3.1, when physical port P3 fails, the CFM session CFM2 will go down.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Sect-appendix-PLs-Protect">
<section id="appendix-A.2">
        <h3 id="name-protection-approaches-for-n">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-protection-approaches-for-n" class="section-name selfRef">Protection Approaches for N1 (or N2)</a>
        </h3>
<div id="Sect-appendix-CCC-Approaches">
<section id="appendix-A.2.1">
          <h4 id="name-ccc-approaches">
<a href="#appendix-A.2.1" class="section-number selfRef">A.2.1. </a><a href="#name-ccc-approaches" class="section-name selfRef">CCC-Approaches</a>
          </h4>
<p id="appendix-A.2.1-1"> The L2NE1's EVC1 instance and L2NE2's EVC2 instance are both CCC local connections too.
 In L2NE1's EVC1 instance, P1.1 and P3.1 are of the same protection-group PG1.
 In L2NE2's EVC2 instance, P2.2 and P3.2 are of the same protection-group PG2.
 In PG1, both P1.1 and P3.1 will receive data packets.
 In PG2, both P2.2 and P3.2 will receive data packets.<a href="#appendix-A.2.1-1" class="pilcrow">¶</a></p>
<div id="Sect-appendix-AA-CCC-Approache">
<section id="appendix-A.2.1.1">
            <h5 id="name-ccc-active-active-protectio">
<a href="#appendix-A.2.1.1" class="section-number selfRef">A.2.1.1. </a><a href="#name-ccc-active-active-protectio" class="section-name selfRef">CCC Active-Active Protection</a>
            </h5>
<p id="appendix-A.2.1.1-1">L2NE1 (or L2NE2) will load-balance N1's (N2's) data packets between P1.1 and P3.1 (or P2.2 and P3.2).<a href="#appendix-A.2.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Sect-appendix-AS-CCC-Approache">
<section id="appendix-A.2.1.2">
            <h5 id="name-ccc-active-standby-protecti">
<a href="#appendix-A.2.1.2" class="section-number selfRef">A.2.1.2. </a><a href="#name-ccc-active-standby-protecti" class="section-name selfRef">CCC Active-Standby Protection</a>
            </h5>
<p id="appendix-A.2.1.2-1">In PG1, P1.1 is the active path, P3.1 is the backup path.
 In PG2, P2.2 is the active path, P3.2 is the backup path.<a href="#appendix-A.2.1.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2.1.2-2">That's saying that L2NE1 (or L2NE2) will not send N1's (or N2's) data packets over P3.1 (or P3.2), 
 unless P1.1 (or P2.2) or P1 (or P2) has been in failure before that data forwarding.<a href="#appendix-A.2.1.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Sect-appendix-VSI-Approaches">
<section id="appendix-A.2.2">
          <h4 id="name-vsi-approaches">
<a href="#appendix-A.2.2" class="section-number selfRef">A.2.2. </a><a href="#name-vsi-approaches" class="section-name selfRef">VSI-Approaches</a>
          </h4>
<p id="appendix-A.2.2-1"> L2NE1's EVC2 instance and L2NE2's EVC1 instance are both VSI instances in this case.
 P1.1, P3.1, P2.2 and P3.2 are all individual ACs in these VSIs.<a href="#appendix-A.2.2-1" class="pilcrow">¶</a></p>
<p id="appendix-A.2.2-2">Note that L2NE2's EVC1 instance and L2NE1's EVC2 instance are still both CCC local connections in this case,
 and there is no PG1 or PG2 in this case, and there are no PWs in this case.<a href="#appendix-A.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="Sect-appendix-RT5G-Argument">
<section id="appendix-B">
      <h2 id="name-different-understandings-on">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-different-understandings-on" class="section-name selfRef">Different Understandings on Resolve GW-IP to RT-5</a>
      </h2>
<div id="Sect-appendix-text-box">
<section id="appendix-B.1">
        <h3 id="name-section-32-of-i-dietf-bess-">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-section-32-of-i-dietf-bess-" class="section-name selfRef">Section 3.2 of I-D.ietf-bess-evpn-prefix-advertisement</a>
        </h3>
<p id="appendix-B.1-1">The following bullets in <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>:<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="appendix-B.1-2">
<pre>
   "RT-5 routes support recursive lookup resolution through the use of
   Overlay Indexes as follows:

   o ... It is important to note that recursive
     resolution of the Overlay Index applies upon installation into an
     IP-VRF, and not upon BGP propagation (for instance, on an ASBR).

   ...

   o In order to enable the recursive lookup resolution at the ingress
     NVE, an NVE that is a possible egress NVE for a given Overlay Index
     must originate a route advertising itself as the BGP next hop on
     the path to the system denoted by the Overlay Index. For instance:

     . ...
     . If the RT-5 specifies an ESI as the Overlay Index, recursive
       resolution can only be done if the NVE has received and installed
       an RT-1 (Auto-Discovery per-EVI) route specifying that ESI.
     . If the RT-5 specifies a GW IP address as the Overlay Index,
       recursive resolution can only be done if the NVE has received and
       installed an RT-2 (MAC/IP route) specifying that IP address in
       the IP address field of its NLRI.
     . ...

     Note that the RT-1 or RT-2 routes needed for the recursive
     resolution may arrive before or after the given RT-5 route.

   o ..."
</pre><a href="#appendix-B.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Sect-appendix-GWIP-to-RT5">
<section id="appendix-B.2">
        <h3 id="name-how-to-interpret-above-para">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-how-to-interpret-above-para" class="section-name selfRef">How to Interpret Above Paragraphs</a>
        </h3>
<p id="appendix-B.2-1">We should note that above section can be interpreted that it was written based on the following principles:<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-2.1">
            <p id="appendix-B.2-2.1.1">The following paragraph (say Praragraph 1) sepecifies how the recursive lookup resolution will be done:<a href="#appendix-B.2-2.1.1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="appendix-B.2-2.1.2">"In order to enable the recursive lookup resolution at the ingress
     NVE, an NVE that is a possible egress NVE for a given Overlay Index
     must originate a route advertising itself as the BGP next hop on
     the path to the system denoted by the Overlay Index. For instance:"<a href="#appendix-B.2-2.1.2" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.2">
            <p id="appendix-B.2-2.2.1"> The examples that is constrained by the phrase "For instance:" described some use-cases that followed above paragraph, 
with the understanding that new use-cases were possible in the future with new documents, 
as long as the rules of above Paragraph 1 were respected.<a href="#appendix-B.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="Sect-appendix-GWIP-Special-PE">
<section id="appendix-B.3">
        <h3 id="name-special-pes">
<a href="#appendix-B.3" class="section-number selfRef">B.3. </a><a href="#name-special-pes" class="section-name selfRef">Special PEs</a>
        </h3>
<p id="appendix-B.3-1">If there are devices that have interpreted above Paragraph 2 as the following:<a href="#appendix-B.3-1" class="pilcrow">¶</a></p>
<p style="margin-left: 1.5em" id="appendix-B.3-2">"if the recursive resolution can't find out a RT-2 for that RT-5's GW-IP, that RT-5 should not be installed."<a href="#appendix-B.3-2" class="pilcrow">¶</a></p>
<p id="appendix-B.3-3">Such behavior of that PE might not be considered as according to <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>.
   It is just not included in <span>[<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>.<a href="#appendix-B.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="appendix-B.4">
        <h3 id="name-gw-ip-or-a-new-tlv">
<a href="#appendix-B.4" class="section-number selfRef">B.4. </a><a href="#name-gw-ip-or-a-new-tlv" class="section-name selfRef">GW-IP or a new TLV</a>
        </h3>
<p id="appendix-B.4-1">No matter how to understand <span><a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-prefix-advertisement-11#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.ietf-bess-evpn-prefix-advertisement" class="xref">I-D.ietf-bess-evpn-prefix-advertisement</a>]</span>,
   now we can assume that the function of the GW-IP field is replaced with 
   a new TLV (e.g. the IP-mapping SOI extended community, similar to what have been done in <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.3" class="relref">Section 6.3</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>),
   then we can compare these two implementations and see whether a new TLV will bring us some benefits or not.<a href="#appendix-B.4-1" class="pilcrow">¶</a></p>
<p id="appendix-B.4-2">Now assume that the <a href="#Fig-Comon-CE-Prefixes" class="xref">Figure 5</a> of this draft 
   is changed to distributed CE-prefixes auto-discovery 
   mode (which is similar to <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.3" class="relref">Section 6.3</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>).
   The comparisons are illustrated as the following:<a href="#appendix-B.4-2" class="pilcrow">¶</a></p>
<span id="name-gw-ip-vs-ip-mapping-soi"></span><div id="Table-GWIP-vs-new-TLV">
<table class="left" id="table-1">
          <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-gw-ip-vs-ip-mapping-soi" class="selfRef">GW-IP vs IP-mapping SOI</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">No.</th>
              <th class="text-left" rowspan="1" colspan="1">Compared Points</th>
              <th class="text-left" rowspan="1" colspan="1">GW-IP</th>
              <th class="text-left" rowspan="1" colspan="1">New TLV</th>
              <th class="text-left" rowspan="1" colspan="1">RT-5E</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">1</td>
              <td class="text-left" rowspan="1" colspan="1">Can non-upgraded RRs accept it?</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">2</td>
              <td class="text-left" rowspan="1" colspan="1">Can non-upgraded DGWs* install it?</td>
              <td class="text-left" rowspan="1" colspan="1">maybe</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">3</td>
              <td class="text-left" rowspan="1" colspan="1">Should PE1/PE2 be upgraded?</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
              <td class="text-left" rowspan="1" colspan="1">yes</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">4</td>
              <td class="text-left" rowspan="1" colspan="1">Will it confuse non-upgraded RRs?</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">5</td>
              <td class="text-left" rowspan="1" colspan="1">Will it confuse non-upgraded DGWs?</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
              <td class="text-left" rowspan="1" colspan="1">no</td>
              <td class="text-left" rowspan="1" colspan="1">maybe**</td>
            </tr>
          </tbody>
        </table>
</div>
<p style="margin-left: 2.0em" id="appendix-B.4-4">Notes:<a href="#appendix-B.4-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="appendix-B.4-5">
          <dt id="appendix-B.4-5.1">* </dt>
          <dd style="margin-left: 2.0em" id="appendix-B.4-5.2">
            <p id="appendix-B.4-5.2.1">We also can take the Figure 4 of <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.3" class="relref">Section 6.3</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span> for example,
   in such case, its PE3 may be a DGW.<a href="#appendix-B.4-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="appendix-B.4-5.3">** </dt>
          <dd style="margin-left: 2.0em" id="appendix-B.4-5.4">
            <p id="appendix-B.4-5.4.1">If the RT-5E routes of the original Bump-in-the-wire usecase are advertised along with
       the route-target of the IP-VRF (thus no RTs of the BD-10),
    when DGW1 receives a RT-5E route and there is a SBD IRB in the IP-VRF instance,
    it may select RT-1 per EVI routes for the RT-5E route in the context of that SBD.
    This is discussed in section <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#section-3.6.4" class="relref">Section 3.6.4</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.<a href="#appendix-B.4-5.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="appendix-B.4-6">We can found in above table that a new TLV will be no better than the original GW-IP field.<a href="#appendix-B.4-6" class="pilcrow">¶</a></p>
<p id="appendix-B.4-7">Note that when PEs can not distinguish the common prefixes from the exclusive prefixes,
 only CE-BGP nexthop based Overlay Index can be used 
 for IP aliasing (independent CE-BGP sessions and RT-5L routes can also be used 
 as per <span><a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02#section-6.1" class="relref">Section 6.1</a> of [<a href="#I-D.wz-bess-evpn-vpws-as-vrf-ac" class="xref">I-D.wz-bess-evpn-vpws-as-vrf-ac</a>]</span>, but this is not IP aliasing), 
 because that the PEs can't advertise different ESIs for the common prefixes and the exclusive prefixes.<a href="#appendix-B.4-7" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yubao Wang</span></div>
<div dir="auto" class="left"><span class="org">ZTE Corporation</span></div>
<div dir="auto" class="left"><span class="street-address">No.68 of Zijinghua Road, Yuhuatai Distinct</span></div>
<div dir="auto" class="left"><span class="locality">Nanjing</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wang.yubao2@zte.com.cn" class="email">wang.yubao2@zte.com.cn</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Zheng(Sandy) Zhang</span></div>
<div dir="auto" class="left"><span class="org">ZTE Corporation</span></div>
<div dir="auto" class="left"><span class="street-address">No. 50 Software Ave, Yuhuatai Distinct<br>Nanjing<br>China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:zhang.zheng@zte.com.cn" class="email">zhang.zheng@zte.com.cn</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
