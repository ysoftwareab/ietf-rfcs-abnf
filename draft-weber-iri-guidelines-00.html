<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Guidelines for Implementers of Internationalized Resource Identifiers (IRIs)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Sources">
<link href="#rfc.section.4" rel="Chapter" title="4 Pre-processing Arbitrary Unicode Strings">
<link href="#rfc.section.5" rel="Chapter" title="5 Parsing Unicode Strings into IRI Components">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Identify the scheme">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Identify the authority">
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Identify the userinfo">
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 Identify the host">
<link href="#rfc.section.5.2.3" rel="Chapter" title="5.2.3 Identify the port">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Identify the path">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Identify the query">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Identify the fragment">
<link href="#rfc.section.6" rel="Chapter" title="6 Scheme-Specific Processing">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 http ">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 javascript ">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 mailto ">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 file ">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 ftp ">
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 data ">
<link href="#rfc.section.7" rel="Chapter" title="7 IRI Canonicalization">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 Producing a valid URI from an IRI">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Informative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Normative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Some members of the implementation community have expressed confusion about the rules and algorithms for processing Internationalized Resource Identifiers (IRIs). This document aims to clarify these matters and improve interoperability around IRI processing by summarizing the steps required to prepare and parse arbitrary Unicode strings as Internationalized Resource Identifiers.  Further goals of this document are to define limited scheme-specific rules around IRI processing and to define the steps required for producing the canonical form of an IRI." />
  <meta name="description" content="Some members of the implementation community have expressed confusion about the rules and algorithms for processing Internationalized Resource Identifiers (IRIs). This document aims to clarify these matters and improve interoperability around IRI processing by summarizing the steps required to prepare and parse arbitrary Unicode strings as Internationalized Resource Identifiers.  Further goals of this document are to define limited scheme-specific rules around IRI processing and to define the steps required for producing the canonical form of an IRI." />
  <meta name="keywords" content="Internet-Draft, Uniform Resource Identifiers, Internationalized Resource Identifiers, internationalization" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">C. Weber</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Casaba Security</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">July 04, 2011</td>
</tr>
<tr>
<td class="left">Expires: January 05, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Guidelines for Implementers of Internationalized Resource Identifiers (IRIs)<br />
  <span class="filename">draft-weber-iri-guidelines-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Some members of the implementation community have expressed confusion about the rules and algorithms for processing Internationalized Resource Identifiers (IRIs). This document aims to clarify these matters and improve interoperability around IRI processing by summarizing the steps required to prepare and parse arbitrary Unicode strings as Internationalized Resource Identifiers.  Further goals of this document are to define limited scheme-specific rules around IRI processing and to define the steps required for producing the canonical form of an IRI.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 05, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Sources</a>
</li>
<li>4.   <a href="#rfc.section.4">Pre-processing Arbitrary Unicode Strings</a>
</li>
<li>5.   <a href="#rfc.section.5">Parsing Unicode Strings into IRI Components</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Identify the scheme</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Identify the authority</a>
</li>
<li>5.2.1.   <a href="#rfc.section.5.2.1">Identify the userinfo</a>
</li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">Identify the host</a>
</li>
<li>5.2.3.   <a href="#rfc.section.5.2.3">Identify the port</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Identify the path</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Identify the query</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Identify the fragment</a>
</li>
<li>6.   <a href="#rfc.section.6">Scheme-Specific Processing</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">http </a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">javascript </a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">mailto </a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">file </a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">ftp </a>
</li>
<li>6.6.   <a href="#rfc.section.6.6">data </a>
</li>
<li>7.   <a href="#rfc.section.7">IRI Canonicalization</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">Producing a valid URI from an IRI</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgements</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Informative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Normative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Internationalized Resource Identifiers (IRIs) extend the Uniform Resource Identifier (URI) specification [RFC3986] by opening up various components such as the authority, path, query, and fragment to the character space available in Unicode/ISO 10646.  Arbitrary Unicode strings may be prepared and parsed into IRI sub-components which map directly to the same URI sub-components.</p>
<p id="rfc.section.1.p.2">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">This section defines the terminology used in this document.</p>
<p id="rfc.section.2.p.2">reference-string <br> The original and unprocessed input string being considered as an IRI reference.  </p>
<p id="rfc.section.2.p.3">pre-processed-reference-string <br> The reference-string that has been through the pre-processing steps.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#sources" id="sources">Sources</a>
</h1>
<p id="rfc.section.3.p.1">This document makes reference to the following sources of information about the parsing of IRIs:</p>
<p></p>

<dl>
<dt>1:</dt>
<dd style="margin-left: 8">Internationalized Resource Identifiers (IRIs) as specified in http://tools.ietf.org/html/draft-ietf-iri-3987bis-05 <a href="#1">[1]</a>
</dd>
<dt>2:</dt>
<dd style="margin-left: 8">Parsing URLs for Fun and Profit, http://tools.ietf.org/html/draft-abarth-url-01 <a href="#2">[2]</a>
</dd>
<dt>3:</dt>
<dd style="margin-left: 8">HTML Living Standard: URLs, http://www.whatwg.org/specs/web-apps/current-work/multipage/urls.html#urls <a href="#3">[3]</a>
</dd>
<dt>4:</dt>
<dd style="margin-left: 8">Change proposal for ISSUE-56, http://lists.w3.org/Archives/Public/public-html/2010Jul/0036.html <a href="#4">[4]</a>
</dd>
<dt>5:</dt>
<dd style="margin-left: 8">URIs, URLs, and URNs: Clarifications and Recommendations 1.0, http://www.w3.org/TR/uri-clarification/ <a href="#5">[5]</a>
</dd>
<dt>6:</dt>
<dd style="margin-left: 8">HTML CHANGE PROPOSAL; change definition of URL to normative reference to IRIBIS, http://lists.w3.org/Archives/Public/public-html/2010Feb/0882.html <a href="#6">[6]</a>
</dd>
<dt>7:</dt>
<dd style="margin-left: 8">BIDI URL Display, https://docs.google.com/document/d/1c8-svx7og0qBUfGBobw7LYfOcNeDVPYbNVMNpSqYCFo/edit?hl=en <a href="#7">[7]</a>
</dd>
</dl>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#pre-process" id="pre-process">Pre-processing Arbitrary Unicode Strings</a>
</h1>
<p id="rfc.section.4.p.1">This section describes the pre-processing steps required to prepare an arbitrary Unicode reference-string for later parsing into IRI sub-components.</p>
<p></p>

<ol>
<li>Remove leading and trailing instances of whitespace (U+0020), CR (U+000A), LF (U+000D), and TAB (U+0009) characters from the string.  <br> Reference: Section 7.2 of <a href="#1">[1]</a> for details.  </li>
<li>If more than one reference is allowed, split the string into substrings on blocks of contiguous whitespace.  Each of one of these substrings is an independent reference-string and will be processed individually.  If more than one reference is not allowed, either remove blocks of contiguous whitespace or replace them with a single percent-encoded U+0020 SPACE, written as "%20", depending on what is required for the current context.  <br> Reference: Mentioned in <a href="#4">[4]</a>.  </li>
<li>If the current string is not already in the UTF-8 encoding, transcode the string to the UTF-8 encoding.  <br> Reference: Section 3.1 of <a href="#1">[1]</a>.  <br> TODO SHOULD transcode to UTF-8, MAY transcode to another Unicode encoding such as UTF-16? </li>
<li>Replace each entity references with its corresponding character.</li>
<li>Normalize the Unicode-encoded string using Unicode Normalization Form C <a href="#8">[8]</a>.  <br> Reference: Section 3.1 of <a href="#1">[1]</a>.  </li>
</ol>

<p> </p>
<p id="rfc.section.4.p.3">This is the pre-processed-reference-string ready for parsing.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#parsing" id="parsing">Parsing Unicode Strings into IRI Components</a>
</h1>
<p id="rfc.section.5.p.1">With an arbitrary IRI string that has been through pre-processing, referred to as the "pre-processed-reference-string", this section describes the subsequent process of parsing the string into its five major IRI sub-components using rules defined by 3896 (using an algorithm equivalent to RFC3986 Appendix B) but with updated ABNF of 3987.  These rules are summarized here.  <br> Reference: Section 3.2 of <a href="#1">[1]</a>.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#scheme" id="scheme">Identify the scheme</a>
</h1>
<p id="rfc.section.5.1.p.1">If the current string does not contain a ":" U+003A then the string does not contain a scheme and the pre-processed-reference-string may be handled as a relative reference.  </p>
<p></p>

<ul>
<li>Continue to "Identify the path"</li>
<li>Abort further scheme processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.1.p.3">If the first character of the string is not an ALPHA then this is not a valid scheme and the pre-processed-reference-string may be handled as a relative reference.</p>
<p></p>

<ul>
<li>Continue to "Identify the path"</li>
<li>Abort further scheme processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.1.p.5">Consume all characters up to but not including the first occurrence of ":" U+003A.  If the consumed substring contains any characters other than ( ALPHA / DIGIT / "+" / "-" / "." ) then it is not a valid scheme and the pre-processed-reference-string may be handled as a relative reference.</p>
<p></p>

<ul>
<li>Continue to "Identify the path"</li>
<li>Abort further scheme processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.1.p.7">The consumed substring at this point is the scheme.  Skip over the ":" U+003A character.  Continue parsing the remaining string as an authority part.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#authority" id="authority">Identify the authority</a>
</h1>
<p id="rfc.section.5.2.p.1">The URI authority component may contain userinfo, a host, and a port.  If the current string does not begin with the two characters "//" U+002F U+002F then the string is not an authority and may be handled as a path sub-component.  </p>
<p></p>

<ul>
<li>Continue to "Identify the path"</li>
<li>Abort further authority processing</li>
</ul>

<p> </p>
<p><br> Consume up to the first occurrence of any one of the authority's terminating characters "/" U+002F, "?" U+003F, "#" U+0023, or the end of the string.  This is the authority, also known as the iauthority under IRI RFC3987.  Continue further parsing of the authority to identify the userinfo, host, and port parts.  </p>
<h1 id="rfc.section.5.2.1">
<a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#userinfo" id="userinfo">Identify the userinfo</a>
</h1>
<p id="rfc.section.5.2.1.p.1">The userinfo may come in the form of a username and password rendered as "user:password".  The userinfo part may be parsed according to the rules of RFC3986 Section 3.2.1 with the updated ABNF for iuserinfo in RFC3987. </p>
<p id="rfc.section.5.2.1.p.2">If the authority does not contain a "@" U+0040 then the string does not contain a userinfo part and the authority may be parsed for a host and port part.  </p>
<p></p>

<ul>
<li>Continue to "Identify the host"</li>
<li>Abort further userinfo processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.1.p.4">From the beginning of the authority, consume each character up to but not including the first occurrence of "@" U+0040.  This is the userinfo.</p>
<p id="rfc.section.5.2.1.p.5">Split the userinfo on the first occurrence of ":" U+003A if it exists.  The part before the ":" is the username and the part after is the password.  The ":" being split on is not included in either result.</p>
<p id="rfc.section.5.2.1.p.6">If a ":" U+003A does not exist in the userinfo, then the userinfo may be treated as a username.</p>
<p id="rfc.section.5.2.1.p.7">Skip over the first occurrence of "@" U+0040 following the userinfo, and continue parsing the remaining authority to identify the host.</p>
<h1 id="rfc.section.5.2.2">
<a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#host" id="host">Identify the host</a>
</h1>
<p id="rfc.section.5.2.2.p.1">The host part of authority may contain an IP-literal, IPv4address, or a reg-name according to the ABNF rules of RFC3986 updated to support Unicode characters in the ireg-name as described in RFC3987.  Consume all characters up to but not including the last ":" U+003A character or the end of authority.  </p>
<p id="rfc.section.5.2.2.p.2">If this substring is determined to be an IP-literal or IPv4address, then the consumed characters are the host. </p>
<p></p>

<ul>
<li>If the authority did contain a ":" then continue parsing the remaining authority including the ":" character according to the "Identify the port" section</li>
<li>Abort further host processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.2.p.4">Else the substring is determined to be an ireg-name according to the ABNF naming convention from RFC3987. This is the host.  </p>
<p></p>

<ul>
<li>If the authority did contain a ":" then the remaining authority including the ":" character will be processed according to the "Identify the port".</li>
<li>Continue processing the host</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.2.p.6">The host SHOULD be processed according to the rules of IDNA2008, but MAY be processed according to UTS46 or IDNA2003.  If the host is in DNS Internet dot-notaion then it's labels SHOULD be converted to punycode.  This is the host.  <br> TODO: Error handling.  Mention leaving the host name in pure Unicode form for intranet/local name scenarios that don't use DNS, e.g. WINS? </p>
<h1 id="rfc.section.5.2.3">
<a href="#rfc.section.5.2.3">5.2.3.</a> <a href="#port" id="port">Identify the port</a>
</h1>
<p id="rfc.section.5.2.3.p.1">Further processing SHOULD skip the first occurrence of ":" U+003A and consume the remaining characters.  If these characters are not *DIGIT then the port is invalid.</p>
<p></p>

<ul>
<li>Continue to "Identify the path"</li>
<li>Abort further scheme processing</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.3.p.3">Else this is the port.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#path" id="path">Identify the path</a>
</h1>
<p id="rfc.section.5.3.p.1">Consume the remaining pre-processed-reference-string up to but not including the first occurrence of a terminating character "?" U+003F, "#" U+0023, or the end of the string.</p>
<p id="rfc.section.5.3.p.2">Percent-encode all characters present from the ucschar list.</p>
<p id="rfc.section.5.3.p.3">If the path contains any characters not allowed by the ABNF of RFC3987 Section 2.2 or Section 7.2 then replace those characters with their percent-encoding. </p>
<p id="rfc.section.5.3.p.4">This is the path.</p>
<p id="rfc.section.5.3.p.5">If the terminating character was "?" then process the remaining string including the leading "?" according to "Identify the query".</p>
<p id="rfc.section.5.3.p.6">If the terminating character was "#" then process the remaining string including the leading "#" according to "Identify the fragment".</p>
<p id="rfc.section.5.3.p.7">TODO: Handling of special characters "/" and "\".</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> <a href="#query" id="query">Identify the query</a>
</h1>
<p id="rfc.section.5.4.p.1">Consume the remaining string starting with the leading "?" and up to but not including the first occurrence of "#" or the end of the string.</p>
<p id="rfc.section.5.4.p.2">Percent-encode all characters present from the ucschar list.</p>
<p id="rfc.section.5.4.p.3">If the path contains any characters not allowed by the ABNF of RFC3987 Section 2.2 or the lists in Section 7.2 then replace those characters with their percent-encoding. </p>
<p id="rfc.section.5.4.p.4">This is the query component.</p>
<p id="rfc.section.5.4.p.5">If the terminating character was "#" then process the remaining string including the leading "#" according to "Identify the fragment".</p>
<p id="rfc.section.5.4.p.6">TODO: Handling of special characters "&amp;", "?", "=", and "/"</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> <a href="#fragment" id="fragment">Identify the fragment</a>
</h1>
<p id="rfc.section.5.5.p.1">Consume the remaining string starting with the leading "#" and to the end of the string.  </p>
<p id="rfc.section.5.5.p.2">Percent-encode all characters present from the ucschar list.</p>
<p id="rfc.section.5.5.p.3">This is the fragment.</p>
<p id="rfc.section.5.5.p.4">TODO: Handling of special characters "?" and "/"</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#scheme-specific" id="scheme-specific">Scheme-Specific Processing</a>
</h1>
<p id="rfc.section.6.p.1">TODO Apply limited scheme-specific rules.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#http-specific" id="http-specific">http </a>
</h1>
<p id="rfc.section.6.1.p.1">(NOTE: Taken directly from RFC3987) For compatibility with existing deployed HTTP infrastructure, the following special case applies for schemes "http" and "https" and IRIs whose origin has a document charset other than one which is UCS-based (e.g., UTF-8 or UTF-16).  In such a case, the "query" component of an IRI is mapped into a URI by using the document charset rather than UTF-8 as the binary representation before pct-encoding.  This mapping is not applied for any other scheme or component.  <br> Reference: Section 3.5 of <a href="#1">[1]</a>.  <br> </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#javascript-specific" id="javascript-specific">javascript </a>
</h1>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#mailto-specific" id="mailto-specific">mailto </a>
</h1>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> <a href="#file-specific" id="file-specific">file </a>
</h1>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> <a href="#ftp-specific" id="ftp-specific">ftp </a>
</h1>
<h1 id="rfc.section.6.6">
<a href="#rfc.section.6.6">6.6.</a> <a href="#data-specific" id="data-specific">data </a>
</h1>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#canonicalization" id="canonicalization">IRI Canonicalization</a>
</h1>
<p id="rfc.section.7.p.1">To follow.</p>
<p id="rfc.section.7.p.2">[NOTE: Call out Special Case here or earlier? The U+005C should be either percent-encoded or converted to U+002F.  Of course, folks who want to name such files will want to use the escaped form of \ in order for their site to work in other browsers.  </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#uri" id="uri">Producing a valid URI from an IRI</a>
</h1>
<p id="rfc.section.7.1.p.1">Percent-encode IRI components (this is done for the sake of interoperability).  For each character which is not allowed anywhere in a valid URI, apply the following steps.  <br> Reference: Section 3.5 of <a href="#1">[1]</a>.  </p>

<ul>
<li>Action: Convert to UTF-8, i.e., convert the character to a sequence of one or more octets using UTF-8 [RFC3629].  <br> [TODO: Necessary after above?) </li>
<li>Action: Percent-encode, i.e., convert each octet of this sequence to %HH, where HH is the hexadecimal notation of the octet value.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">To follow.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This document has no actions for the IANA.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#acks" id="acks">Acknowledgements</a>
</h1>
<p id="rfc.section.10.p.1">Thanks to Adam Barth, Martin Duerst, and Julian Reschke for their feedback.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="1">[1]</b></td>
<td class="top">
<a>Duerst, M</a>, <a>Suignard, M</a> and <a>L Masinter</a>, "<a href="http://tools.ietf.org/html/draft-ietf-iri-3987bis-05">Internationalized Resource Identifiers (IRIs)</a>", Internet-Draft draft-ietf-iri-3987bis-05, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="2">[2]</b></td>
<td class="top">
<a>Barth, A</a>, "<a href="http://tools.ietf.org/html/draft-abarth-url-01">How Browsers Process URLs</a>", Internet-Draft draft-abarth-url-01, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="3">[3]</b></td>
<td class="top">
<a title="Google">Hickson, I.</a>, "<a>HTML Living Standard: URLs</a>", WHATWG ?, 2011.</td>
</tr>
<tr>
<td class="reference"><b id="4">[4]</b></td>
<td class="top">
<a>Fielding, R.</a>, "<a>Change proposal for ISSUE-56</a>", July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="5">[5]</b></td>
<td class="top">
<a>W3C</a>, "<a>URIs, URLs, and URNs: Clarifications and Recommendations 1.0</a>", W3C Note 21 September 2001, September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="6">[6]</b></td>
<td class="top">
<a>Masinter, L.</a>, "<a>HTML CHANGE PROPOSAL; change definition of URL to normative reference to IRIBIS</a>", February 2010.</td>
</tr>
<tr>
<td class="reference"><b id="7">[7]</b></td>
<td class="top">
<a title="Google">Davis, M.</a>, "<a>Revision of UBA for improved display of URL/IRIs</a>", May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="8">[8]</b></td>
<td class="top">
<a>Davis, M.</a> and <a title="Google">M. Duerst</a>, "<a>URLs</a>", April 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a>Berners-Lee, T</a>, <a>Fielding, R</a> and <a>L Masinter</a>, "<a>Uniform Resource Identifier (URI)</a>", Internet-Standard rfc3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3629">[RFC3629]</b></td>
<td class="top">
<a>Yergeau, F</a>, "<a>UTF-8, a transformation format of ISO 10646</a>", Internet-Standard rfc3629, November 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Chris Weber</span> 
	  <span class="n hidden">
		<span class="family-name">Weber</span>
	  </span>
	</span>
	<span class="org vcardline">Casaba Security</span>
	<span class="adr">
	  <span>16625 Redmond Wa, Suite M348</span>

	  <span class="vcardline">
		<span class="locality">Redmond</span>,  
		<span class="region">WA</span> 
		<span class="code">98052</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:chris@lookout.net">chris@lookout.net</a></span>

  </address>
</div>

</body>
</html>