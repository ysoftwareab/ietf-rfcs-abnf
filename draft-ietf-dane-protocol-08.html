<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Using Secure DNS to Associate Certificates with Domain Names For TLS</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Certificate Associations">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Securing Certificate Associations">
<link href="#rfc.section.1.3" rel="Chapter" title="1.3 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 The TLSA Resource Record">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 TLSA RDATA Wire Format">
<link href="#rfc.section.2.1.1" rel="Chapter" title="2.1.1 The Certificate Type Field">
<link href="#rfc.section.2.1.2" rel="Chapter" title="2.1.2 The Reference Type Field">
<link href="#rfc.section.2.1.3" rel="Chapter" title="2.1.3 The Certificate for Association Field">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 TLSA RR Presentation Format">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 TLSA RR Examples">
<link href="#rfc.section.3" rel="Chapter" title="3 Domain Names for TLS Certificate Associations">
<link href="#rfc.section.4" rel="Chapter" title="4 Semantics and Features of TLSA Certificate Types">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 End Entity Certificate">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Certification Authority Certificate">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Certificate Public Key">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Use of TLS Certificate Associations in TLS">
<link href="#rfc.section.5" rel="Chapter" title="5 TLSA and DANE Use Cases and Requirements">
<link href="#rfc.section.6" rel="Chapter" title="6 Mandatory-to-Implement Algorithms">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 TLSA RRtype">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 TLSA Certificate Types">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 TLSA Hash Types">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="TLS and DTLS use PKIX certificates for authenticating the server. Users want their applications to verify that the certificate provided by the TLS server is in fact associated with the domain name they expect. TLSA provides bindings of keys to domains that are asserted not by external entities, but by the entities that operate the DNS. This document describes how to use secure DNS to associate the TLS server's certificate with the intended domain name." />
  <meta name="description" content="TLS and DTLS use PKIX certificates for authenticating the server. Users want their applications to verify that the certificate provided by the TLS server is in fact associated with the domain name they expect. TLSA provides bindings of keys to domains that are asserted not by external entities, but by the entities that operate the DNS. This document describes how to use secure DNS to associate the TLS server's certificate with the intended domain name." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">P. Hoffman</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">VPN Consortium</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">J. Schlyter</td>
</tr>
<tr>
<td class="left">Expires: January 02, 2012</td>
<td class="right">Kirei AB</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 01, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Using Secure DNS to Associate Certificates with Domain Names For TLS<br />
  <span class="filename">draft-ietf-dane-protocol-08</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>TLS and DTLS use PKIX certificates for authenticating the server. Users want their applications to verify that the certificate provided by the TLS server is in fact associated with the domain name they expect. TLSA provides bindings of keys to domains that are asserted not by external entities, but by the entities that operate the DNS. This document describes how to use secure DNS to associate the TLS server's certificate with the intended domain name.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 02, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Certificate Associations</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Securing Certificate Associations</a>
</li>
<li>1.3.   <a href="#rfc.section.1.3">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">The TLSA Resource Record</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">TLSA RDATA Wire Format</a>
</li>
<li>2.1.1.   <a href="#rfc.section.2.1.1">The Certificate Type Field</a>
</li>
<li>2.1.2.   <a href="#rfc.section.2.1.2">The Reference Type Field</a>
</li>
<li>2.1.3.   <a href="#rfc.section.2.1.3">The Certificate for Association Field</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">TLSA RR Presentation Format</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">TLSA RR Examples</a>
</li>
<li>3.   <a href="#rfc.section.3">Domain Names for TLS Certificate Associations</a>
</li>
<li>4.   <a href="#rfc.section.4">Semantics and Features of TLSA Certificate Types</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">End Entity Certificate</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Certification Authority Certificate</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Certificate Public Key</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Use of TLS Certificate Associations in TLS</a>
</li>
<li>5.   <a href="#rfc.section.5">TLSA and DANE Use Cases and Requirements</a>
</li>
<li>6.   <a href="#rfc.section.6">Mandatory-to-Implement Algorithms</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">TLSA RRtype</a>
</li>
<li>7.2.   <a href="#rfc.section.7.2">TLSA Certificate Types</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">TLSA Hash Types</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li>10.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The first response from the server in TLS may contain a certificate. In order for the TLS client to authenticate that it is talking to the expected TLS server, the client must validate that this certificate is associated with the domain name used by the client to get to the server. Currently, the client must extract the domain name from the certificate, must trust a trust anchor upon which the server's certificate is rooted, and must successfully validate the certificate.</p>
<p id="rfc.section.1.p.2">Some people want a different way to authenticate the association of the server's certificate with the intended domain name without trusting an external certificate authority (CA). Given that the DNS administrator for a domain name is authorized to give identifying information about the zone, it makes sense to allow that administrator to also make an authoritative binding between the domain name and a certificate that might be used by a host at that domain name. The easiest way to do this is to use the DNS.</p>
<p id="rfc.section.1.p.3">There are many use cases for such functionality. <a href="#DANEUSECASES">[DANEUSECASES]</a> lists the ones that the protocol in this document is meant to apply to. <a href="#DANEUSECASES">[DANEUSECASES]</a> also lists many requirements, most of which the protocol in this document is believed to meet.  Section 5 covers the applicability of this document to the use cases in detail.</p>
<p id="rfc.section.1.p.4">This document applies to both TLS <a href="#RFC5246">[RFC5246]</a> and DTLS <a href="#RFC4347bis">[RFC4347bis]</a>. In order to make the document more readable, it mostly only talks about "TLS", but in all cases, it means "TLS or DTLS". This document only relates to securely associating certificates for TLS and DTLS with host names; other security protocols and other forms of identification of TLS servers (such as IP addresses) are handled in other documents. For example, keys for IPsec are covered in <a href="#RFC4025">[RFC4025]</a> and keys for SSH are covered in <a href="#RFC4255">[RFC4255]</a>.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Certificate Associations</h1>
<p id="rfc.section.1.1.p.1">In this document, a certificate association is based on a cryptographic hash of a certificate (sometimes called a "fingerprint"), a public key, or on the certificate itself. For a fingerprint, a hash is taken of the binary, DER-encoded certificate or public key, and that hash is the certificate association; the type of hash function used can be chosen by the DNS administrator. When using the certificate itself in the certificate association, the entire certificate in the normal format is used. This document only applies to PKIX <a href="#RFC5280">[RFC5280]</a> certificates, not certificates of other formats.  It also applies to public keys that are extracted from PKIX certificates, not just full certificates.</p>
<p id="rfc.section.1.1.p.2">Certificate associations are made between a certificate or public key and a domain name. Server software that is running TLS that is found at that domain name would use a certificate that has a certificate association given in the DNS, as described in this document. A DNS query can return multiple certificate associations, such as in the case of different server software on a single host using different certificates, or in the case that a server is changing from one certificate to another.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Securing Certificate Associations</h1>
<p id="rfc.section.1.2.p.1">This document defines a secure method to associate the certificate that is obtained from the TLS server with a domain name using DNS; the DNS information may need to be be protected by DNSSEC.  Because the certificate association was retrieved based on a DNS query, the domain name in the query is by definition associated with the certificate.</p>
<p id="rfc.section.1.2.p.2">DNSSEC, which is defined in RFCs 4033, 4034, and 4035 (<a href="#RFC4033">[RFC4033]</a>, <a href="#RFC4034">[RFC4034]</a>, and <a href="#RFC4035">[RFC4035]</a>), uses cryptographic keys and digital signatures to provide authentication of DNS data. Information retrieved from the DNS and that is validated using DNSSEC is thereby proved to be the authoritative data. The DNSSEC signature MUST be validated on all responses that use DNSSEC in order to assure the proof of origin of the data.</p>
<p id="rfc.section.1.2.p.3">This document only relates to securely getting the DNS information for the certificate association using DNSSEC; other secure DNS mechanisms are out of scope.</p>
<h1 id="rfc.section.1.3">
<a href="#rfc.section.1.3">1.3.</a> Terminology</h1>
<p id="rfc.section.1.3.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.1.3.p.2">A note on terminology: Some people have said that this protocol is a form of "certificate exclusion". This is true, but only in the sense that a DNS reply that contains the certificate types defined here inherently excludes every other possible certificate in the universe (other than those found with a pre-image attack against one of those two). The certificate type defined here is better thought of as "enumeration" of a small number of certificate associations, not "exclusion" of a near-infinite number of other certificates.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> The TLSA Resource Record</h1>
<p id="rfc.section.2.p.1">The TLSA DNS resource record (RR) is used to associate a certificate with the domain name where the record is found. The semantics of how the TLSA RR is interpreted are given later in this document.</p>
<p id="rfc.section.2.p.2">The type value for the TLSA RR type is TBD.</p>
<p id="rfc.section.2.p.3">The TLSA RR is class independent.</p>
<p id="rfc.section.2.p.4">The TLSA RR has no special TTL requirements.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> TLSA RDATA Wire Format</h1>
<div id="#rfc.figure.1"></div>
<pre>
                     1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2 2 3 3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Cert type   |   Ref type    |                               /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               /
/                                                               /
/                    Certificate for association                /
/                                                               /
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.2.1.p.1">The RDATA for a TLSA RR consists of a one octet certificate type field, a one octet reference type field and the certificate for association field.  </p>
<h1 id="rfc.section.2.1.1">
<a href="#rfc.section.2.1.1">2.1.1.</a> The Certificate Type Field</h1>
<p id="rfc.section.2.1.1.p.1">A one-octet value, called "certificate type", specifying the provided association that will be used to match the target certificate. This will be an IANA registry in order to make it easier to add additional certificate types in the future. The types defined in this document are: </p>

<ul class="empty">
<li>1 -- A PKIX certificate that identifies an end entity</li>
<li>2 -- A PKIX certification authority's certificate</li>
<li>3 -- A public key expressed as a PKIX SubjectPublicKeyInfo structure</li>
</ul>

<p> All three types are structured using the RFC 5280 formatting rules and use the DER encoding.</p>
<p id="rfc.section.2.1.1.p.2">The three certificate types defined in this document explicitly only apply to PKIX-formatted certificates. If TLS allows other formats later, or if extensions to this protocol are made that accept other formats for certificates, those certificates will need their own certificate types.</p>
<h1 id="rfc.section.2.1.2">
<a href="#rfc.section.2.1.2">2.1.2.</a> The Reference Type Field</h1>
<p id="rfc.section.2.1.2.p.1">A one-octet value, called "reference type", specifying how the certificate association is presented. This value is defined in a new IANA registry. The types defined in this document are: </p>

<ul class="empty">
<li>0 -- Full certificate</li>
<li>1 -- SHA-256 hash of the certificate</li>
<li>2 -- SHA-512 hash of the certificate</li>
</ul>

<p> Using the same hash algorithm as is used in the signature in the certificate will make it more likely that the TLS client will understand this TLSA data.</p>
<h1 id="rfc.section.2.1.3">
<a href="#rfc.section.2.1.3">2.1.3.</a> The Certificate for Association Field</h1>
<p id="rfc.section.2.1.3.p.1">The "certificate for association". This is the bytes containing the full certificate, SubjectPublicKeyInfo or the hash of the associated certificate or SubjectPublicKeyInfo. For certificate types 1 and 2, this is the certificate or the hash of the certificate itself, not of the TLS ASN.1Cert object.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> TLSA RR Presentation Format</h1>
<p id="rfc.section.2.2.p.1">The presentation format of the RDATA portion is as follows: </p>

<ul>
<li>The certificate type field MUST be represented as an unsigned decimal integer.</li>
<li>The reference type field MUST be represented as an unsigned decimal integer.</li>
<li>The certificate for association field MUST be represented as a string of hexadecimal characters. Whitespace is allowed within the string of hexadecimal characters.</li>
</ul>

<p> </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> TLSA RR Examples</h1>
<div id="#rfc.figure.2"></div>
<pre>
_443._tcp.www.example.com. IN TLSA (
   1 1 5c1502a6549c423be0a0aa9d9a16904de5ef0f5c98
       c735fcca79f09230aa7141 )
</pre>
<p id="rfc.section.2.3.p.1">An example of a SHA-256 hash (type 1) of an end entity certificate (type 1) would be: </p>
<div id="#rfc.figure.3"></div>
<pre>
_443._tcp.www.example.com. IN TLSA (
   2 0 308202c5308201ada00302010202090... )
</pre>
<p id="rfc.section.2.3.p.2">An example of an unhashed CA certificate (type 2) would be: </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Domain Names for TLS Certificate Associations</h1>
<p id="rfc.section.3.p.1">TLSA resource records are stored at a prefixed DNS domain name. The prefix is prepared in the following manner: </p>

<ol>
<li>The decimal representation of the port number on which a TLS-based service is assumed to exist is prepended with an underscore character ("_") to become the left-most label in the prepared domain name. This number has no leading zeros.</li>
<li>The protocol name of the transport on which a TLS-based service is assumed to exist is prepended with an underscore character ("_") to become the second left-most label in the prepared domain name. The transport names defined for this protocol are "tcp", "udp" and "sctp".</li>
<li>The domain name is appended to the result of step 2 to complete the prepared domain name.</li>
</ol>
<p id="rfc.section.3.p.2">For example, to request a TLSA resource record for an HTTP server running TLS on port 443 at "www.example.com", you would use "_443._tcp.www.example.com" in the request. To request a TLSA resource record for an SMTP server running the STARTTLS protocol on port 25 at "mail.example.com", you would use "_25._tcp.mail.example.com".</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Semantics and Features of TLSA Certificate Types</h1>
<p id="rfc.section.4.p.1">The three certificate types have very different semantics, but also have features common to all three types.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> End Entity Certificate</h1>
<p id="rfc.section.4.1.p.1">Certificate type 1 (a certificate that identifies an end entity) is matched against the first certificate offered by the TLS server. The certificate for association is used only for exact matching, not for chained validation. With reference type 0, the certificate association is valid if the certificate in the TLSA data matches to the first certificate offered by TLS. With reference types other than 0, the certificate association is valid if the hash of the first certificate offered by the TLS server matches the value from the TLSA data.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Certification Authority Certificate</h1>
<p id="rfc.section.4.2.p.1">Certificate type 2 (certification authority's certificate) can be used in one of two ways. With reference type 0, the certificate in the TLSA resource record is used in chaining from the end entity given in TLS. The certificate association is valid if the first certificate in the certificate bundle can be validly chained to the trust anchor from the TLSA data. With reference types other than 0, if the hash of any certificate past the first in the certificate bundle from TLS matches the trust anchor from the TLSA data, and the chain in the certificate bundle is valid up to that TLSA trust anchor, then the certificate association is valid. Alternately, if the first certificate offered chains to an existing trust anchor in the TLS client's trust anchor repository, and the hash of that trust anchor matches the value from the TLSA data, then the certificate association is valid.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Certificate Public Key</h1>
<p id="rfc.section.4.3.p.1">Certificate type 3 (public key expressed as a PKIX SubjectPublicKeyInfo structure) is used to assert that the public key will appear in one of the certificates received from the server. A server might choose this type for many reasons, including (but not limited to): </p>

<ul>
<li>the trust anchor to which TLS server's certificate chains might change without the trust anchor's public key changing</li>
<li>the TLS server is using a self-signed certificate that is not marked as a CA certificate</li>
</ul>

<p> A TLS client conforming to this protocol that receives a public key in a type 3 certificate for association must be able to extract the SubjectPublicKeyInfo from each of the certificates presented to it by the TLS server. It then does a bit-for-bit comparison between the certificate for association and the SubjectPublicKeyInfos in the certificates; if it does not find a match, the client aborts the TLS handshake.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Use of TLS Certificate Associations in TLS</h1>
<p id="rfc.section.4.4.p.1">A TLS client conforming to this protocol receiving a certificate for association of type 1 MUST compare it for equality, using the specified reference type, with the end entity certificate received in TLS. A TLS client conforming to this protocol receiving a certificate for association of type 2 MUST treat it as a trust anchor for that domain name. A TLS client conforming to this protocol receiving a certificate for association of type 3 MUST find a matching SubjectPublicKeyInfo structure in one of the certificates offered by the TLS server.</p>
<p id="rfc.section.4.4.p.2">The end entity certificate from TLS, regardless of whether it was matched with a TLSA type 1 certificate or chained to a TLSA type 2 CA certificate, might have at least one identifier in the subject or subjectAltName field of the matched certificates that matches the expected identifier for the TLS server. Some specifications for applications that run under TLS, such as <a href="#RFC2818">[RFC2818]</a> for HTTP, require the server's certificate to have a domain name that matches the host name expected by the client. Further, the TLS session that is to be set up MUST be for the specific port number and transport name that was given in the TLSA query. The matching or chaining MUST be done within the life of the TTL on the TLSA record.</p>
<p id="rfc.section.4.4.p.3">In order to use one or more TLS certificate associations described in this document obtained from the DNS, an application MUST assure that the certificates were obtained using DNS protected by DNSSEC. TLSA records must only be trusted if they were obtained from a trusted source. This could be a localhost DNS resolver answer with the AD bit set, an inline validating resolver library primed with the proper trust anchors, or obtained from a remote nameserver to which one has a secured channel of communication.</p>
<p id="rfc.section.4.4.p.4">If a certificate association contains a reference type that is not understood by the TLS client, that certificate association MUST be marked as unusable.</p>
<p id="rfc.section.4.4.p.5">An application that requests TLS certificate associations using the method described in this document obtains zero or more usable certificate associations. If the application receives zero usable certificate associations, it processes TLS in the normal fashion.</p>
<p id="rfc.section.4.4.p.6">If a match between one of the certificate association(s) and the server's end entity certificate in TLS is found, the TLS client continues the TLS handshake. If no match between the usable certificate association(s) and the server's end entity certificate in TLS is found, the TLS client MUST abort the handshake with an "access_denied" error.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> TLSA and DANE Use Cases and Requirements</h1>
<p id="rfc.section.5.p.1">The different types of certificates for association defined in TLSA are matched with various sections of <a href="#DANEUSECASES">[DANEUSECASES]</a>. [[ IMPORTANT NOTICE, DANGER OF MOVING PARTS: this draft of the protocol is based on the -02 version of [DANEUSECASES]. As that document changes in the WG and IETF Last Call, this protocol might change as well. ]]</p>
<p id="rfc.section.5.p.2">The three use cases from section 3 of <a href="#DANEUSECASES">[DANEUSECASES]</a> are covered in this protocol as follows:</p>
<p></p>

<dl>
<dt>3.1 CA Constraints</dt>
<dd style="margin-left: 8">-- Implemented using certificate type 2.  A hashed association is recommended for well-known certification authorities.</dd>
<dt>3.2 Certificate Constraints</dt>
<dd style="margin-left: 8">-- Implemented using certificate type 1.</dd>
<dt>3.3 Domain-Issued Certificates</dt>
<dd style="margin-left: 8">-- Implemented using certificate type 1 combined with any reference type, or by using certificate type 2 together with a full certificate association.</dd>
</dl>
<p id="rfc.section.5.p.4">The requirements from section 4 of <a href="#DANEUSECASES">[DANEUSECASES]</a> are covered in this protocol as follows (note that some of these might be excessively glib):</p>
<p></p>

<dl>
<dt>Multiple Ports</dt>
<dd style="margin-left: 8">-- Covered in the TLSA request syntax.</dd>
<dt>No Downgrade</dt>
<dd style="margin-left: 8">-- Covered by DNSSEC itself.</dd>
<dt>Encapsulation</dt>
<dd style="margin-left: 8">-- Covered in the TLSA response semantics.</dd>
<dt>Predictability</dt>
<dd style="margin-left: 8">-- Covered by this spec.</dd>
<dt>Opportunistic Security</dt>
<dd style="margin-left: 8">-- Covered in the TLSA request syntax.</dd>
<dt>Combination</dt>
<dd style="margin-left: 8">-- Covered in the TLSA response semantics.</dd>
<dt>Roll-over</dt>
<dd style="margin-left: 8">-- Covered by the TTLs on the TLSA records.</dd>
<dt>Simple Key Management</dt>
<dd style="margin-left: 8">-- Implemented using Certificate Type 3.</dd>
<dt>Minimal Dependencies</dt>
<dd style="margin-left: 8">-- Covered in the TLSA response semantics.</dd>
<dt>Minimal Options</dt>
<dd style="margin-left: 8">-- Covered in the TLSA response semantics.</dd>
<dt>Wild Cards</dt>
<dd style="margin-left: 8">-- Covered in the TLSA request syntax.</dd>
<dt>Redirection</dt>
<dd style="margin-left: 8">-- Covered in the TLSA request syntax.</dd>
</dl>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Mandatory-to-Implement Algorithms</h1>
<p id="rfc.section.6.p.1">DNS systems conforming to this specification MUST be able to create TLSA records containing certificate types 1 and 2. DNS systems conforming to this specification MUST be able to create TLSA records using reference type 0 (no hash used) and reference type 1 (SHA-256), and SHOULD be able to create TLSA records using reference type 2 (SHA-512).</p>
<p id="rfc.section.6.p.2">TLS clients conforming to this specification MUST be able to correctly interpret TLSA records containing certificate types 1, 2 and 3. TLS clients conforming to this specification MUST be able to compare a certificate for association with a certificate from TLS using reference type 0 (no hash used) and reference type 1 (SHA-256), and SHOULD be able to make such comparisons with reference type 2 (SHA-512).</p>
<p id="rfc.section.6.p.3">At the time this is written, it is expected that there will be a new family of hash algorithms called SHA-3 within the next few years. It is expected that some of the SHA-3 algorithms will be mandatory and/or recommended for TLSA records after the algorithms are fully defined. At that time, this specification will be updated.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> TLSA RRtype</h1>
<p id="rfc.section.7.1.p.1">This document uses a new DNS RR type, TLSA, whose value is TBD. A separate request for the RR type will be submitted to the expert reviewer, and future versions of this document will have that value instead of TBD.</p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> TLSA Certificate Types</h1>
<div id="#rfc.figure.4"></div>
<pre>
Value    Short description                       Reference
----------------------------------------------------------
0        Reserved                                [This]
1        Certificate to identify an end entity   [This]
2        CA's certificate                        [This]
3        Public key as SubjectPublicKeyInfo      [This]
4-254    Unassigned
255      Private use
</pre>
<p id="rfc.section.7.2.p.1">This document creates a new registry, "Certificate Types for TLSA Resource Records". The registry policy is "RFC Required". The initial entries in the registry are: </p>
<p id="rfc.section.7.2.p.2">Applications to the registry can request specific values that have yet to be assigned.</p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> TLSA Hash Types</h1>
<div id="#rfc.figure.5"></div>
<pre>
Value    Short description    Reference      
---------------------------------------------
0        No hash used         [This]
1        SHA-256              NIST FIPS 180-3
2        SHA-512              NIST FIPS 180-3
3-254    Unassigned
255      Private use
</pre>
<p id="rfc.section.7.3.p.1">This document creates a new registry, "Hash Types for TLSA Resource Records". The registry policy is "Specification Required". The initial entries in the registry are: </p>
<p id="rfc.section.7.3.p.2">Applications to the registry can request specific values that have yet to be assigned.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">The security of the protocols described in this document relies on the security of DNSSEC as used by the client requesting A/AAAA and TLSA records.</p>
<p id="rfc.section.8.p.2">A DNS administrator who goes rogue and changes both the A/AAAA and TLSA records for a domain name can cause the user to go to an unauthorized server that will appear authorized, unless the client performs certificate validation and rejects the certificate. That administrator could probably get a certificate issued anyway, so this is not an additional threat.</p>
<p id="rfc.section.8.p.3">If the authentication mechanism for adding or changing TLSA data in a zone is weaker than the authentication mechanism for changing the A/AAAA records, a man-in-the-middle who can redirect traffic to their site may be able to impersonate the attacked host in TLS if they can use the weaker authentication mechanism. A better design for authenticating DNS would be to have the same level of authentication used for all DNS additions and changes for a particular host.</p>
<p id="rfc.section.8.p.4">SSL proxies can sometimes act as a man-in-the-middle for TLS clients. In these scenarios, the clients add a new trust anchor whose private key is kept on the SSL proxy; the proxy intercepts TLS requests, creates a new TLS session with the intended host, and sets up a TLS session with the client using a certificate that chains to the trust anchor installed in the client by the proxy. In such environments, the TLSA protocol will prevent the SSL proxy from functioning as expected because the TLS client will get a certificate association from the DNS that will not match the certificate that the SSL proxy uses with the client. The client, seeing the proxy's new certificate for the supposed destination will not set up a TLS session. Thus, such proxies might choose to aggressively block TLSA requests and/or responses.</p>
<p id="rfc.section.8.p.5">Client treatment of any information included in the trust anchor is a matter of local policy. This specification does not mandate that such information be inspected or validated by the domain name administrator.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgements</h1>
<p id="rfc.section.9.p.1">Many of the ideas in this document have been discussed over many years.  More recently, the ideas have been discussed by the authors and others in a more focused fashion. In particular, some of the ideas here originated with Paul Vixie, Dan Kaminsky, Jeff Hodges, Phill Hallam-Baker, Simon Josefsson, Warren Kumari, Adam Langley, Ben Laurie, Ilari Liusvaara, Scott Schmit, and Ondrej Sury.</p>
<p id="rfc.section.9.p.2">This document has also been greatly helped by many active participants of the DANE Working Group.</p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4347bis">[RFC4347bis]</b></td>
<td class="top">
<a>Rescorla, E.</a> and <a>N. Modadugu</a>, "<a href="http://tools.ietf.org/html/draft-ietf-tls-rfc4347-bis">Datagram Transport Layer Security version 1.2</a>", Internet-Draft draft-ietf-tls-rfc4347-bis, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="DANEUSECASES">[DANEUSECASES]</b></td>
<td class="top">
<a>Barnes, R.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dane-use-cases">Use Cases and Requirements for DNS-based Authentication of Named Entities (DANE)</a>", Internet-Draft draft-ietf-dane-use-cases, 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4033">[RFC4033]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>", RFC 4033, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4034">[RFC4034]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4034">Resource Records for the DNS Security Extensions</a>", RFC 4034, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4035">[RFC4035]</b></td>
<td class="top">
<a>Arends, R.</a>, <a>Austein, R.</a>, <a>Larson, M.</a>, <a>Massey, D.</a> and <a>S. Rose</a>, "<a href="http://tools.ietf.org/html/rfc4035">Protocol Modifications for the DNS Security Extensions</a>", RFC 4035, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5280">[RFC5280]</b></td>
<td class="top">
<a>Cooper, D.</a>, <a>Santesson, S.</a>, <a>Farrell, S.</a>, <a>Boeyen, S.</a>, <a>Housley, R.</a> and <a>W. Polk</a>, "<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>", RFC 5280, May 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2818">[RFC2818]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4025">[RFC4025]</b></td>
<td class="top">
<a>Richardson, M.</a>, "<a href="http://tools.ietf.org/html/rfc4025">A Method for Storing IPsec Keying Material in DNS</a>", RFC 4025, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4255">[RFC4255]</b></td>
<td class="top">
<a>Schlyter, J.</a> and <a>W. Griffin</a>, "<a href="http://tools.ietf.org/html/rfc4255">Using DNS to Securely Publish Secure Shell (SSH) Key Fingerprints</a>", RFC 4255, January 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Hoffman</span> 
	  <span class="n hidden">
		<span class="family-name">Hoffman</span>
	  </span>
	</span>
	<span class="org vcardline">VPN Consortium</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:paul.hoffman@vpnc.org">paul.hoffman@vpnc.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jakob Schlyter</span> 
	  <span class="n hidden">
		<span class="family-name">Schlyter</span>
	  </span>
	</span>
	<span class="org vcardline">Kirei AB</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jakob@kirei.se">jakob@kirei.se</a></span>

  </address>
</div>

</body>
</html>