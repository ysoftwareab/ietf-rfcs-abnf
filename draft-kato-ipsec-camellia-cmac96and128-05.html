<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Camellia-CMAC-96 and Camellia-CMAC-PRF-128 Algorithms and Its Use with IPsec</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Camellia-CMAC-96 and Camellia-CMAC-PRF-128 Algorithms and Its Use with IPsec">
<meta name="keywords" content="Internet-Draft, Request for Comments, IPsec, Camellia, Block Cipher, PRF, MAC">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">A. Kato</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Kanno</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">NTT Software Corporation</td></tr>
<tr><td class="header">Expires: June 24, 2010</td><td class="header">M. Kanda</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">NTT</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">T. Iwata</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nagoya University</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">December 21, 2009</td></tr>
</table></td></tr></table>
<h1><br />The Camellia-CMAC-96 and Camellia-CMAC-PRF-128 Algorithms and Its Use with IPsec<br />draft-kato-ipsec-camellia-cmac96and128-05</h1>

<h3>Abstract</h3>

<p>
   This memo specifies two new algorithms for IPsec. One is
   the usage of Cipher-based Message Authentication Code (CMAC) 
   with the Camellia block cipher as an authentication mechanism 
   in the IPsec Encapsulating Security Payload and Authentication Header protocols.
   This algorithm is called Camellia-CMAC-96. 
   The other algorithm is a pseudo-random function (PRF) based on CMAC with 
   the Camellia block 
   cipher for the Internet Key Exchange, version 2.
   This algorithm is called Camellia-CMAC-PRF-128.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on June 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Definitions<br />
<a href="#anchor2">3.</a>&nbsp;
Camellia-CMAC<br />
<a href="#anchor3">4.</a>&nbsp;
Camellia-CMAC-96<br />
<a href="#anchor4">5.</a>&nbsp;
Camellia-CMAC-PRF-128<br />
<a href="#anchor5">6.</a>&nbsp;
Test Cases<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">6.1.</a>&nbsp;
Camellia-CMAC-96<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.2.</a>&nbsp;
Camellia-CMAC-PRF-128<br />
<a href="#anchor8">7.</a>&nbsp;
Security Considerations<br />
<a href="#anchor9">8.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor10">9.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
   The NIST specification <a class='info' href='#CMAC'>[1]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a> for the CMAC (Cipher-based Message
   Authentication Code) mode of operation for a block cipher describes a
   method to use the Advanced Encryption Standard (AES) as a Message
   Authentication Code (MAC) that has a 128-bit output length.

</p>
<p>
   The Camellia block cipher has the same external interface as the AES.
   This memo specifies two new algorithms for IPsec that replace AES by
   Camellia in already specified applications of CMAC for IPsec <a class='info' href='#RFC4494'>[8]<span> (</span><span class='info'>Song, JH., Poovendran, R., and J. Lee, &ldquo;The AES-CMAC-96 Algorithm and Its Use with IPsec,&rdquo; June&nbsp;2006.</span><span>)</span></a>
   and <a class='info' href='#RFC3615'>[9]<span> (</span><span class='info'>Gustin, J. and A. Goyens, &ldquo;A Uniform Resource Name (URN) Namespace for SWIFT Financial Messaging,&rdquo; September&nbsp;2003.</span><span>)</span></a>. 
   One is the usage of CMAC mode with Camellia <a class='info' href='#RFC3713'>[2]<span> (</span><span class='info'>Matsui, M., Nakajima, J., and S. Moriai, &ldquo;A Description of the Camellia Encryption Algorithm,&rdquo; April&nbsp;2004.</span><span>)</span></a> as the
   underlying block cipher as an authentication mechanism in the IPsec
   Encapsulating Security Payload (ESP) <a class='info' href='#RFC4303'>[5]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>
   and Authentication Header (AH) <a class='info' href='#RFC4302'>[4]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a> protocols.
   This algorithm is called Camellia-CMAC-96.
   The 128-bit CMAC output is also useful as a long-lived Pseudo-Random
   Function (PRF).  Thus, the other algorithm is a PRF based on CMAC
   with the Camellia block cipher for version 2 of the Internet Key
   Exchange (IKEv2) <a class='info' href='#I-D.ietf-ipsecme-ikev2bis'>[6]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol: IKEv2,&rdquo; April&nbsp;2010.</span><span>)</span></a> that supports
   fixed and variable key sizes for
   the Key Derivation Function (KDF) and authentication, respectively.
   This algorithm is called Camellia-CMAC-PRF-128.

</p>
<p>
   The Camellia algorithm and its properties are described in <a class='info' href='#RFC3713'>[2]<span> (</span><span class='info'>Matsui, M., Nakajima, J., and S. Moriai, &ldquo;A Description of the Camellia Encryption Algorithm,&rdquo; April&nbsp;2004.</span><span>)</span></a>.
   This document does not cover implementation details of CMAC.  Those
   details can be found in <a class='info' href='#CMAC'>[1]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a>.
   For further information on IKE, AH and ESP, refer to <a class='info' href='#RFC4301'>[3]<span> (</span><span class='info'>Kent, S. and K. Seo, &ldquo;Security Architecture for the Internet Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#RFC4302'>[4]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a>,
   <a class='info' href='#RFC4303'>[5]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>, and <a class='info' href='#I-D.ietf-ipsecme-ikev2bis'>[6]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol: IKEv2,&rdquo; April&nbsp;2010.</span><span>)</span></a>.

</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Definitions</h3>

<blockquote class="text"><dl>
<dt>CBC</dt>
<dd>
 
  Cipher Block Chaining mode of operation for a block cipher,
  providing a block cipher for arbitrary message sizes.

</dd>
<dt>MAC</dt>
<dd>
 
  Message Authentication Code.
  A bit string of a fixed length, computed by the MAC
  generation algorithm, that is used to establish the
  authority and, hence, the integrity of a message.

</dd>
<dt>CMAC</dt>
<dd>
 
  A MAC algorithm based on a symmetric key block cipher in CBC
  mode, as specified in <a class='info' href='#CMAC'>[1]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a>.

</dd>
<dt>Key (K)</dt>
<dd>
 
  128-bit (16-octet) key for the Camellia block cipher.
  Denoted by K.

</dd>
<dt>Variable-length Key (VK)</dt>
<dd>
 
  Variable-length key for Camellia-CMAC-PRF-128, denoted by VK.

</dd>
<dt>Message (M)</dt>
<dd>
 
  Message to be authenticated. Denoted by M.

</dd>
<dt>Length (len)</dt>
<dd>
 
  The length of message M in octets.
  Denoted by len.
  The minimum value is 0. The maximum value is not
  specified in this document.

</dd>
<dt>VKlen</dt>
<dd>
 
  The length of VK in octets.

</dd>
<dt>truncate(T,l)</dt>
<dd>
 
  Truncate T (MAC) in most-significant-bit-first
  (MSB-first) order to a length of l octets.

</dd>
<dt>T</dt>
<dd>
 
  The output of Camellia-CMAC.

</dd>
<dt>Camellia-CMAC</dt>
<dd>
 
  CMAC generation function based on the Camellia block cipher
  with 128-bit key. 

</dd>
<dt>Camellia-CMAC-96</dt>
<dd>
 
  IPsec AH and ESP MAC generation function based on
  Camellia-CMAC, which truncates the 128-bit CMAC output to its 96
  most-significant bits.

</dd>
<dt>Camellia-CMAC-PRF-128</dt>
<dd>
 
   IPsec AH and ESP PRF based on Camellia-CMAC, which removes the 128-bit key
   length restriction.

</dd>
<dt>SKEYSEED</dt>
<dd>
 
   Seed of shared key calculated from the nonces exchanged during the IKE_SA_INIT
   exchange and the Diffie-Hellman shared secret in the IKEv2 specification 
   <a class='info' href='#I-D.ietf-ipsecme-ikev2bis'>[6]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol: IKEv2,&rdquo; April&nbsp;2010.</span><span>)</span></a>.

</dd>
</dl></blockquote>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Camellia-CMAC</h3>

<p>
   The National Institute of Standards and Technology (NIST) has
   specified the Cipher-based Message Authentication Code
   (CMAC) <a class='info' href='#CMAC'>[1]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a>. CMAC is a keyed hash function that is based on a
   symmetric key block cipher, such as the Advanced Encryption Standard
   <a class='info' href='#FIPS.197.2001'>[10]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Advanced Encryption Standard (AES),&rdquo; November&nbsp;2001.</span><span>)</span></a>. The CMAC algorithm provides a framework for inserting 
   various block cipher algorithms. 

</p>
<p>
   Camellia-CMAC uses the Camellia block cipher <a class='info' href='#RFC3713'>[2]<span> (</span><span class='info'>Matsui, M., Nakajima, J., and S. Moriai, &ldquo;A Description of the Camellia Encryption Algorithm,&rdquo; April&nbsp;2004.</span><span>)</span></a> as a
   building block in CMAC <a class='info' href='#CMAC'>[1]<span> (</span><span class='info'>National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; May&nbsp;2005.</span><span>)</span></a>. 
   To generate a MAC, Camellia-CMAC(K, M, len) takes a secret key 'K', a
   message of variable length 'M', and the length of the message in octets 'len'
   as inputs and returns a fixed-length bit string.

</p>
<p>
   In this specification, Camellia-CMAC is always used with 128-bit length key.

</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Camellia-CMAC-96</h3>

<p>
   For IPsec message authentication in AH and ESP, Camellia-CMAC is used
   in its truncated form denoted as Camellia-CMAC-96 -- Camellia-CMAC
   with its output truncated to 96 bits.  Its output is a 96-bit MAC
   that meets the default authenticator length as specified in <a class='info' href='#RFC4302'>[4]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
   The result of truncation is taken in MSB-first order.

</p>
<p>
   <a class='info' href='#CAM-CMAC96'>Figure&nbsp;1<span> (</span><span class='info'>Algorithm Camellia-CMAC-96</span><span>)</span></a> describes Camellia-CMAC-96 algorithm:

</p>
<p>
   In step 1, Camellia-CMAC with key K is applied to the message M of
   length len octets.

</p>
<p>
   In step 2, the output of step 1 is truncated to its first 12 octets,
   and the result (TT) is returned.

</p><br /><hr class="insert" />
<a name="CAM-CMAC96"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   +                    Algorithm Camellia-CMAC-96                     +
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   +                                                                   +
   +   Input    : K (128-bit Key)                                      +
   +            : M    (message to be authenticated)                   +
   +            : len  (length of message in octets)                   +
   +   Output   : Truncated T  (truncated output to length 12 octets)  +
   +                                                                   +
   +-------------------------------------------------------------------+
   +                                                                   +
   +   Step 1.  T  := Camellia-CMAC (K,M,len);                         +
   +   Step 2.  TT := truncate (T, 12);                                +
   +            return TT;                                             +
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Algorithm Camellia-CMAC-96&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Camellia-CMAC-PRF-128</h3>

<p>
   The Camellia-CMAC-PRF-128 algorithm is identical to Camellia-CMAC
   except that the 128-bit key length restriction is removed.

</p>
<p>
   IKEv2 <a class='info' href='#I-D.ietf-ipsecme-ikev2bis'>[6]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol: IKEv2,&rdquo; April&nbsp;2010.</span><span>)</span></a> uses PRFs for
   multiple purposes, most notably for
   generating keying material and authentication of the IKE_SA.

</p>
<p>
   When using Camellia-CMAC-PRF-128 as the PRF described in <a class='info' href='#I-D.ietf-ipsecme-ikev2bis'>[6]<span> (</span><span class='info'>Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;Internet Key Exchange Protocol: IKEv2,&rdquo; April&nbsp;2010.</span><span>)</span></a>,
   Camellia-CMAC-PRF-128 is considered to admit a variable key length in
   all places, and the amount of keying material generated when new keys
   are generated is 128 bits (i.e., preferred key length when generating
   keying material of SK_d, SK_pi, and SK_pr is 128 bits).

</p>
<p>
   When generating SKEYSEED the full of Ni and Nr are used as key for the PRF.

</p><br /><hr class="insert" />
<a name="CMAC-PRF"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   +                        Camellia-CMAC-PRF-128                      +
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
   +                                                                   +
   + Input  : VK (Variable-length key)                                 +
   +        : M (Message, i.e., the input data of the PRF)             +
   +        : VKlen (length of VK in octets)                           +
   +        : len (length of M in octets)                              +
   + Output : PRV (128-bit Pseudo-Random Variable)                     +
   +                                                                   +
   +-------------------------------------------------------------------+
   + Variable: K (128-bit key for Camellia-CMAC)                       +
   +                                                                   +
   + Step 1.   If VKlen is equal to 16                                 +
   + Step 1a.  then                                                    +
   +               K := VK;                                            +
   + Step 1b.  else                                                    +
   +               K := Camellia-CMAC(0^128, VK, VKlen);               +
   + Step 2.   PRV := Camellia-CMAC(K, M, len);                        +
   +           return PRV;                                             +
   +                                                                   +
   +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Algorithm Camellia-CMAC-PRF-128&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
In step 1, the 128-bit key, K, for Camellia-CMAC is derived as follows:

</p>
<blockquote class="text"><dl>
<dt>o</dt>
<dd>
  If the key VK is exactly 128 bits, then we use it as-is (step 1a).
 
</dd>
<dt>o</dt>
<dd>
  If it is longer or shorter than 128 bits, then we derive the key K
  by applying the Camellia-CMAC algorithm using the 128-bit all-zero
  string as the key and VK as the input message (step 1b).
 
</dd>
</dl></blockquote>
<p>
   In step 2, we apply the Camellia-CMAC algorithm using K as the key and M
   as the input message. 
   The output of this algorithm is returned.

</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Test Cases</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Camellia-CMAC-96</h3>

<p>
   This section contains four test cases, which can be used to confirm
   that an implementation has correctly implemented Camellia-CMAC-96.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

 ----------------
 K                2b7e1516 28aed2a6 abf71588 09cf4f3c

 Mlen = 0
 M                &lt;empty string&gt;
 T                ba925782 aaa1f5d9 a00f8964

 ----------------
 K                2b7e1516 28aed2a6 abf71588 09cf4f3c

 Mlen = 16
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
 T                6d962854 a3b9fda5 6d7d45a9

 ----------------
 K                2b7e1516 28aed2a6 abf71588 09cf4f3c

 Mlen = 40
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411
 T                5c18d119 ccd67661 44ac1866

 ----------------
 K                2b7e1516 28aed2a6 abf71588 09cf4f3c

 Mlen = 64
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411 e5fbc119 1a0a52ef
                  f69f2445 df4f9b17 ad2b417b e66c3710
 T                c2699a6e ba55ce9d 939a8a4e
</pre></div>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Camellia-CMAC-PRF-128</h3>

<p>
   This section contains twelve test cases, which can be used to confirm
   that an implementation has correctly implemented Camellia-CMAC-PRF-128. 
   The first four test cases use 128 bit VK; the next four test
   cases use 192 bit VK; and the last four test cases use 256 bit VK.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
VKlen = 16
 ----------------
 VK               2b7e1516 28aed2a6 abf71588 09cf4f3c


 Mlen = 0
 M                &lt;empty string&gt;
 T                ba925782 aaa1f5d9 a00f8964 8094fc71

 ----------------
 VK               2b7e1516 28aed2a6 abf71588 09cf4f3c


 Mlen = 16
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
 T                6d962854 a3b9fda5 6d7d45a9 5ee17993

 ----------------
 VK               2b7e1516 28aed2a6 abf71588 09cf4f3c


 Mlen = 40
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411
 T                5c18d119 ccd67661 44ac1866 131d9f22

 ----------------
 VK               2b7e1516 28aed2a6 abf71588 09cf4f3c


 Mlen = 64
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411 e5fbc119 1a0a52ef
                  f69f2445 df4f9b17 ad2b417b e66c3710
 T                c2699a6e ba55ce9d 939a8a4e 19466ee9

 ------------------------------------------------------------
 VKlen = 24
 ----------------
 VK               8e73b0f7 da0e6452 c810f32b 809079e5
                  62f8ead2 522c6b7b

 K                abddaa68 e8b9f0af 2fb4db53 41cf1d91

 Mlen = 0
 M                &lt;empty string&gt;
 T                f4739892 c70bd23e 891f66c0 5fefbf27

 ----------------
 VK               8e73b0f7 da0e6452 c810f32b 809079e5
                  62f8ead2 522c6b7b

 K                abddaa68 e8b9f0af 2fb4db53 41cf1d91

 Mlen = 16
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
 T                60a33814 53babaed 1a11dfd3 d24c1410

 ----------------
 VK               8e73b0f7 da0e6452 c810f32b 809079e5
                  62f8ead2 522c6b7b

 K                abddaa68 e8b9f0af 2fb4db53 41cf1d91

 Mlen = 40
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411
 T                42b9d47f 4f58bc29 85b6f82c 23b121cb

 ----------------
 VK               8e73b0f7 da0e6452 c810f32b 809079e5
                  62f8ead2 522c6b7b

 K                abddaa68 e8b9f0af 2fb4db53 41cf1d91

 Mlen = 64
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411 e5fbc119 1a0a52ef
                  f69f2445 df4f9b17 ad2b417b e66c3710
 T                d078729f dcae9abc ff1ea4d6 18ed4501

 ------------------------------------------------------------
 VKlen = 32
 ----------------
 VK               603deb10 15ca71be 2b73aef0 857d7781
                  1f352c07 3b6108d7 2d9810a3 0914dff4

 K                b5aeeae9 2c23bed7 167af194 2e831597

 Mlen = 0
 M                &lt;empty string&gt;
 T                c96d7d40 d4aaab78 ac906b91 c82bd690

 ----------------
 VK               603deb10 15ca71be 2b73aef0 857d7781
                  1f352c07 3b6108d7 2d9810a3 0914dff4

 K                b5aeeae9 2c23bed7 167af194 2e831597

 Mlen = 16
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
 T                104de4b9 0da6baf1 fa73945b e614f032

 ----------------
 VK               603deb10 15ca71be 2b73aef0 857d7781
                  1f352c07 3b6108d7 2d9810a3 0914dff4

 K                b5aeeae9 2c23bed7 167af194 2e831597

 Mlen = 40
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411
 T                2d3684e9 1cb1b303 a7db8648 f25ee16c

 ----------------
 VK               603deb10 15ca71be 2b73aef0 857d7781
                  1f352c07 3b6108d7 2d9810a3 0914dff4

 K                b5aeeae9 2c23bed7 167af194 2e831597

 Mlen = 64
 M                6bc1bee2 2e409f96 e93d7e11 7393172a
                  ae2d8a57 1e03ac9c 9eb76fac 45af8e51
                  30c81c46 a35ce411 e5fbc119 1a0a52ef
                  f69f2445 df4f9b17 ad2b417b e66c3710
 T                d6b0f1b7 dda2b62a eca6d51d da63fdda

</pre></div>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
   The security provided by Camellia-CMAC-96 and Camellia-CMAC-PRF-128
   is built on the strong cryptographic algorithm Camellia and CMAC.
   At the time of this writing, there are no known
   practical cryptographic attacks against Camellia or CMAC.
</p>
<p>
   However, as is true with any
   cryptographic algorithm, part of its strength lies in the secret key,
   K, and the correctness of the implementation in all of the
   participating systems. 
   If the secret key is compromised or inappropriately shared,
   it guarantees neither authentication nor
   message integrity at all.
   The secret key shall be generated in a
   way that meets the pseudo randomness requirement of RFC 4086
   <a class='info' href='#RFC4086'>[7]<span> (</span><span class='info'>Eastlake, D., Schiller, J., and S. Crocker, &ldquo;Randomness Requirements for Security,&rdquo; June&nbsp;2005.</span><span>)</span></a> and should be kept safe. 
   If and only if Camellia-CMAC-96 and Camellia-CMAC-PRF-128 are used
   properly it provides the authentication and integrity that meet the
   best current practice of message authentication.

</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>
   The IANA has allocated value &lt;TBD1&gt; for IKEv2 Transform Type 3 (Integrity
   Algorithm) to the AUTH_CAMELLIA_CMAC_96 algorithm, and has allocated a value of 
   &lt;TBD2&gt; for IKEv2 Transform Type 2 (Pseudo-Random Function) to the 
   PRF_CAMELLIA128_CMAC algorithm.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Acknowledgements</h3>

<p>
  We thank Tim Polk and Tero Kivinen for their initial review of this document.
  Special thanks to Alfred Hoenes for several very detailed reviews and suggestions.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="CMAC">[1]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;Recommendation for Block Cipher Modes of Operation:The CMAC Mode for Authentication,&rdquo; Special Publication&nbsp;800-38B, May&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3713">[2]</a></td>
<td class="author-text">Matsui, M., Nakajima, J., and S. Moriai, &ldquo;<a href="http://tools.ietf.org/html/rfc3713">A Description of the Camellia Encryption Algorithm</a>,&rdquo; RFC&nbsp;3713, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3713.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4301">[3]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4301.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[4]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4302.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[5]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipsecme-ikev2bis">[6]</a></td>
<td class="author-text">Kaufman, C., Hoffman, P., Nir, Y., and P. Eronen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipsecme-ikev2bis-10.txt">Internet Key Exchange Protocol: IKEv2</a>,&rdquo; draft-ietf-ipsecme-ikev2bis-10 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipsecme-ikev2bis-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4086">[7]</a></td>
<td class="author-text">Eastlake, D., Schiller, J., and S. Crocker, &ldquo;<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>,&rdquo; BCP&nbsp;106, RFC&nbsp;4086, June&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4086.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4494">[8]</a></td>
<td class="author-text">Song, JH., Poovendran, R., and J. Lee, &ldquo;<a href="http://tools.ietf.org/html/rfc4494">The AES-CMAC-96 Algorithm and Its Use with IPsec</a>,&rdquo; RFC&nbsp;4494, June&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4494.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3615">[9]</a></td>
<td class="author-text">Gustin, J. and A. Goyens, &ldquo;<a href="http://tools.ietf.org/html/rfc3615">A Uniform Resource Name (URN) Namespace for SWIFT Financial Messaging</a>,&rdquo; RFC&nbsp;3615, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3615.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="FIPS.197.2001">[10]</a></td>
<td class="author-text">National Institute of Standards and Technology, &ldquo;<a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">Advanced Encryption Standard (AES)</a>,&rdquo; FIPS&nbsp;PUB 197, November&nbsp;2001.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Akihiro Kato</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Software Corporation</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-45-212-9803</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+81-45-212-9800</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kato.akihiro@po.ntts.co.jp">kato.akihiro@po.ntts.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Satoru Kanno</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Software Corporation</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-45-212-9803</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+81-45-212-9800</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kanno.satoru@po.ntts.co.jp">kanno.satoru@po.ntts.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Masayuki Kanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81-422-59-3456</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+81-422-59-4015</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kanda.masayuki@lab.ntt.co.jp">kanda.masayuki@lab.ntt.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tetsu Iwata</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nagoya University</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:iwata@cse.nagoya-u.ac.jp">iwata@cse.nagoya-u.ac.jp</a></td></tr>
</table>
</body></html>
