<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Packet Loss and Delay Measurement for MPLS Networks</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Applicability and Scope">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Overview">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Basic Bidirectional Measurement">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Packet Loss Measurement">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Throughput Measurement">
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Delay Measurement">
<link href="#rfc.section.2.5" rel="Chapter" title="2.5 Delay Variation Measurement">
<link href="#rfc.section.2.6" rel="Chapter" title="2.6 Unidirectional Measurement">
<link href="#rfc.section.2.7" rel="Chapter" title="2.7 Dyadic Measurement">
<link href="#rfc.section.2.8" rel="Chapter" title="2.8 Loopback Measurement">
<link href="#rfc.section.2.9" rel="Chapter" title="2.9 Measurement Considerations">
<link href="#rfc.section.2.9.1" rel="Chapter" title="2.9.1 Types of Channels">
<link href="#rfc.section.2.9.2" rel="Chapter" title="2.9.2 Quality of Service">
<link href="#rfc.section.2.9.3" rel="Chapter" title="2.9.3 Measurement Point Location">
<link href="#rfc.section.2.9.4" rel="Chapter" title="2.9.4 Equal Cost Multipath">
<link href="#rfc.section.2.9.5" rel="Chapter" title="2.9.5 Intermediate Nodes">
<link href="#rfc.section.2.9.6" rel="Chapter" title="2.9.6 Different Transmit and Receive Interfaces">
<link href="#rfc.section.2.9.7" rel="Chapter" title="2.9.7 External Post-Processing">
<link href="#rfc.section.2.9.8" rel="Chapter" title="2.9.8 Loss Measurement Modes">
<link href="#rfc.section.2.9.9" rel="Chapter" title="2.9.9 Loss Measurement Scope">
<link href="#rfc.section.2.9.10" rel="Chapter" title="2.9.10 Delay Measurement Accuracy">
<link href="#rfc.section.2.9.11" rel="Chapter" title="2.9.11 Delay Measurement Timestamp Format">
<link href="#rfc.section.3" rel="Chapter" title="3 Message Formats">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Loss Measurement Message Format">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Delay Measurement Message Format">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Combined Loss/Delay Measurement Message Format">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Timestamp Field Formats">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 TLV Objects">
<link href="#rfc.section.3.5.1" rel="Chapter" title="3.5.1 Padding">
<link href="#rfc.section.3.5.2" rel="Chapter" title="3.5.2 Addressing">
<link href="#rfc.section.3.5.3" rel="Chapter" title="3.5.3 Loopback Request">
<link href="#rfc.section.3.5.4" rel="Chapter" title="3.5.4 Session Query Interval">
<link href="#rfc.section.4" rel="Chapter" title="4 Operation">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Operational Overview">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Loss Measurement Procedures">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Initiating a Loss Measurement Operation">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 Transmitting a Loss Measurement Query">
<link href="#rfc.section.4.2.3" rel="Chapter" title="4.2.3 Receiving a Loss Measurement Query">
<link href="#rfc.section.4.2.4" rel="Chapter" title="4.2.4 Transmitting a Loss Measurement Response">
<link href="#rfc.section.4.2.5" rel="Chapter" title="4.2.5 Receiving a Loss Measurement Response">
<link href="#rfc.section.4.2.6" rel="Chapter" title="4.2.6 Loss Calculation">
<link href="#rfc.section.4.2.7" rel="Chapter" title="4.2.7 Quality of Service">
<link href="#rfc.section.4.2.8" rel="Chapter" title="4.2.8 G-ACh Packets">
<link href="#rfc.section.4.2.9" rel="Chapter" title="4.2.9 Test Messages">
<link href="#rfc.section.4.2.10" rel="Chapter" title="4.2.10 Message Loss and Packet Misorder Conditions">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Delay Measurement Procedures">
<link href="#rfc.section.4.3.1" rel="Chapter" title="4.3.1 Transmitting a Delay Measurement Query">
<link href="#rfc.section.4.3.2" rel="Chapter" title="4.3.2 Receiving a Delay Measurement Query">
<link href="#rfc.section.4.3.3" rel="Chapter" title="4.3.3 Transmitting a Delay Measurement Response">
<link href="#rfc.section.4.3.4" rel="Chapter" title="4.3.4 Receiving a Delay Measurement Response">
<link href="#rfc.section.4.3.5" rel="Chapter" title="4.3.5 Timestamp Format Negotiation">
<link href="#rfc.section.4.3.5.1" rel="Chapter" title="4.3.5.1 Single-Format Procedures">
<link href="#rfc.section.4.3.6" rel="Chapter" title="4.3.6 Quality of Service">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Combined Loss/Delay Measurement Procedures">
<link href="#rfc.section.5" rel="Chapter" title="5 Implementation Disclosure Requirements">
<link href="#rfc.section.6" rel="Chapter" title="6 Congestion Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Manageability Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Allocation of PW Associated Channel Types">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 Creation of Measurement Timestamp Type Registry">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 Creation of MPLS Loss/Delay Measurement Control Code Registry">
<link href="#rfc.section.9.4" rel="Chapter" title="9.4 Creation of MPLS Loss/Delay Measurement TLV Object Registry">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Default Timestamp Format Rationale">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="Many service provider service level agreements (SLAs) depend on the ability to measure and monitor performance metrics for packet loss and one-way and two-way delay, as well as related metrics such as delay variation and channel throughput.  This measurement capability also provides operators with greater visibility into the performance characteristics of their networks, thereby facilitating planning, troubleshooting, and evaluation.  This document specifies protocol mechanisms to enable the efficient and accurate measurement of these performance metrics in MPLS networks." />
  <meta name="description" content="Many service provider service level agreements (SLAs) depend on the ability to measure and monitor performance metrics for packet loss and one-way and two-way delay, as well as related metrics such as delay variation and channel throughput.  This measurement capability also provides operators with greater visibility into the performance characteristics of their networks, thereby facilitating planning, troubleshooting, and evaluation.  This document specifies protocol mechanisms to enable the efficient and accurate measurement of these performance metrics in MPLS networks." />
  <meta name="keywords" content="MPLS, Internet-Draft" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">MPLS</td>
<td class="right">D. Frost</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S. Bryant</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left">Expires: January 20, 2012</td>
<td class="right">July 19, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Packet Loss and Delay Measurement for MPLS Networks<br />
  <span class="filename">draft-ietf-mpls-loss-delay-04</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>Many service provider service level agreements (SLAs) depend on the ability to measure and monitor performance metrics for packet loss and one-way and two-way delay, as well as related metrics such as delay variation and channel throughput.  This measurement capability also provides operators with greater visibility into the performance characteristics of their networks, thereby facilitating planning, troubleshooting, and evaluation.  This document specifies protocol mechanisms to enable the efficient and accurate measurement of these performance metrics in MPLS networks.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 20, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Applicability and Scope</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">Overview</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Basic Bidirectional Measurement</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Packet Loss Measurement</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Throughput Measurement</a>
</li>
<li>2.4.   <a href="#rfc.section.2.4">Delay Measurement</a>
</li>
<li>2.5.   <a href="#rfc.section.2.5">Delay Variation Measurement</a>
</li>
<li>2.6.   <a href="#rfc.section.2.6">Unidirectional Measurement</a>
</li>
<li>2.7.   <a href="#rfc.section.2.7">Dyadic Measurement</a>
</li>
<li>2.8.   <a href="#rfc.section.2.8">Loopback Measurement</a>
</li>
<li>2.9.   <a href="#rfc.section.2.9">Measurement Considerations</a>
</li>
<li>2.9.1.   <a href="#rfc.section.2.9.1">Types of Channels</a>
</li>
<li>2.9.2.   <a href="#rfc.section.2.9.2">Quality of Service</a>
</li>
<li>2.9.3.   <a href="#rfc.section.2.9.3">Measurement Point Location</a>
</li>
<li>2.9.4.   <a href="#rfc.section.2.9.4">Equal Cost Multipath</a>
</li>
<li>2.9.5.   <a href="#rfc.section.2.9.5">Intermediate Nodes</a>
</li>
<li>2.9.6.   <a href="#rfc.section.2.9.6">Different Transmit and Receive Interfaces</a>
</li>
<li>2.9.7.   <a href="#rfc.section.2.9.7">External Post-Processing</a>
</li>
<li>2.9.8.   <a href="#rfc.section.2.9.8">Loss Measurement Modes</a>
</li>
<li>2.9.9.   <a href="#rfc.section.2.9.9">Loss Measurement Scope</a>
</li>
<li>2.9.10.   <a href="#rfc.section.2.9.10">Delay Measurement Accuracy</a>
</li>
<li>2.9.11.   <a href="#rfc.section.2.9.11">Delay Measurement Timestamp Format</a>
</li>
<li>3.   <a href="#rfc.section.3">Message Formats</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Loss Measurement Message Format</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Delay Measurement Message Format</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Combined Loss/Delay Measurement Message Format</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Timestamp Field Formats</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">TLV Objects</a>
</li>
<li>3.5.1.   <a href="#rfc.section.3.5.1">Padding</a>
</li>
<li>3.5.2.   <a href="#rfc.section.3.5.2">Addressing</a>
</li>
<li>3.5.3.   <a href="#rfc.section.3.5.3">Loopback Request</a>
</li>
<li>3.5.4.   <a href="#rfc.section.3.5.4">Session Query Interval</a>
</li>
<li>4.   <a href="#rfc.section.4">Operation</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Operational Overview</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Loss Measurement Procedures</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Initiating a Loss Measurement Operation</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">Transmitting a Loss Measurement Query</a>
</li>
<li>4.2.3.   <a href="#rfc.section.4.2.3">Receiving a Loss Measurement Query</a>
</li>
<li>4.2.4.   <a href="#rfc.section.4.2.4">Transmitting a Loss Measurement Response</a>
</li>
<li>4.2.5.   <a href="#rfc.section.4.2.5">Receiving a Loss Measurement Response</a>
</li>
<li>4.2.6.   <a href="#rfc.section.4.2.6">Loss Calculation</a>
</li>
<li>4.2.7.   <a href="#rfc.section.4.2.7">Quality of Service</a>
</li>
<li>4.2.8.   <a href="#rfc.section.4.2.8">G-ACh Packets</a>
</li>
<li>4.2.9.   <a href="#rfc.section.4.2.9">Test Messages</a>
</li>
<li>4.2.10.   <a href="#rfc.section.4.2.10">Message Loss and Packet Misorder Conditions</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Delay Measurement Procedures</a>
</li>
<li>4.3.1.   <a href="#rfc.section.4.3.1">Transmitting a Delay Measurement Query</a>
</li>
<li>4.3.2.   <a href="#rfc.section.4.3.2">Receiving a Delay Measurement Query</a>
</li>
<li>4.3.3.   <a href="#rfc.section.4.3.3">Transmitting a Delay Measurement Response</a>
</li>
<li>4.3.4.   <a href="#rfc.section.4.3.4">Receiving a Delay Measurement Response</a>
</li>
<li>4.3.5.   <a href="#rfc.section.4.3.5">Timestamp Format Negotiation</a>
</li>
<li>4.3.5.1.   <a href="#rfc.section.4.3.5.1">Single-Format Procedures</a>
</li>
<li>4.3.6.   <a href="#rfc.section.4.3.6">Quality of Service</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Combined Loss/Delay Measurement Procedures</a>
</li>
<li>5.   <a href="#rfc.section.5">Implementation Disclosure Requirements</a>
</li>
<li>6.   <a href="#rfc.section.6">Congestion Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Manageability Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">Allocation of PW Associated Channel Types</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">Creation of Measurement Timestamp Type Registry</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">Creation of MPLS Loss/Delay Measurement Control Code Registry</a>
</li>
<li>9.4.   <a href="#rfc.section.9.4">Creation of MPLS Loss/Delay Measurement TLV Object Registry</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgments</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Default Timestamp Format Rationale</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Many service provider service level agreements (SLAs) depend on the ability to measure and monitor performance metrics for packet loss and one-way and two-way delay, as well as related metrics such as delay variation and channel throughput.  This measurement capability also provides operators with greater visibility into the performance characteristics of their networks, thereby facilitating planning, troubleshooting, and evaluation.  This document specifies protocol mechanisms to enable the efficient and accurate measurement of these performance metrics in MPLS networks.</p>
<p id="rfc.section.1.p.2">This document specifies two closely-related protocols, one for packet loss measurement (LM) and one for packet delay measurement (DM).  These protocols have the following characteristics and capabilities: </p>

<ul>
<li>The LM and DM protocols are intended to be simple and to support efficient hardware processing.</li>
<li>The LM and DM protocols operate over the MPLS Generic Associated Channel (G-ACh) <a href="#RFC5586">[RFC5586]</a> and support measurement of loss, delay, and related metrics over Label Switched Paths (LSPs), pseudowires, and MPLS sections (links).</li>
<li>The LM and DM protocols are applicable to the LSPs, pseudowires, and sections of networks based on the MPLS Transport Profile (MPLS-TP), because the MPLS-TP is based on a standard MPLS data plane.  The MPLS-TP is defined and described in <a href="#RFC5921">[RFC5921]</a>, and MPLS-TP LSPs, pseudowires, and sections are discussed in detail in <a href="#RFC5960">[RFC5960]</a>.  A profile describing the minimal functional subset of the LM and DM protocols in the MPLS-TP context is provided in <a href="#I-D.ietf-mpls-tp-loss-delay-profile">[I-D.ietf-mpls-tp-loss-delay-profile]</a>.</li>
<li>The LM and DM protocols can be used both for continuous/proactive and selective/on-demand measurement.</li>
<li>The LM and DM protocols use a simple query/response model for bidirectional measurement that allows a single node - the querier - to measure the loss or delay in both directions.</li>
<li>The LM and DM protocols use query messages for unidirectional loss and delay measurement.  The measurement can either be carried out at the downstream node(s) or at the querier if an out-of-band return path is available.</li>
<li>The LM and DM protocols do not require that the transmit and receive interfaces be the same when performing bidirectional measurement.</li>
<li>The DM protocol is stateless.</li>
<li>The LM protocol is "almost" stateless: loss is computed as a delta between successive messages, and thus the data associated with the last message received must be retained.</li>
<li>The LM protocol can perform two distinct kinds of loss measurement: it can measure the loss of specially generated test messages in order to infer the approximate data-plane loss level (inferred measurement); or it can directly measure data-plane packet loss (direct measurement).  Direct measurement provides perfect loss accounting, but may require specialized hardware support and is only applicable to some LSP types.  Inferred measurement provides only approximate loss accounting but is generally applicable.  <br><br> The direct LM method is also known as "frame-based" in the context of Ethernet transport networks <a href="#Y.1731">[Y.1731]</a>.  Inferred LM is a generalization of the "synthetic" measurement approach currently in development for Ethernet networks, in the sense that it allows test messages to be decoupled from measurement messages.  </li>
<li>The LM protocol supports measurement in terms of both packet counts and octet counts.</li>
<li>The LM protocol supports both 32-bit and 64-bit counters.</li>
<li>The LM protocol can be used to measure channel throughput as well as packet loss.</li>
<li>The DM protocol supports multiple timestamp formats, and provides a simple means for the two endpoints of a bidirectional connection to agree on a preferred format.  This procedure reduces to a triviality for implementations supporting only a single timestamp format.</li>
<li>The DM protocol supports varying the measurement message size in order to measure delays associated with different packet sizes.</li>
</ul>

<p> </p>
<p id="rfc.section.1.p.3">The One-Way Active Measurement Protocol (OWAMP) <a href="#RFC4656">[RFC4656]</a> and Two-Way Active Measurement Protocol (TWAMP) <a href="#RFC5357">[RFC5357]</a> provide capabilities for the measurement of various performance metrics in IP networks.  These protocols are not streamlined for hardware processing and rely on IP and TCP, as well as elements of the Network Time Protocol (NTP), which may not be available or optimized in some network environments; they also lack support for IEEE 1588 timestamps and direct-mode LM, which in some environments may be required.  The protocols defined in this document thus are similar in some respects to, but also differ from, these IP-based protocols.</p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Applicability and Scope</h1>
<p id="rfc.section.1.1.p.1">This document specifies measurement procedures and protocol messages that are intended to be applicable in a wide variety of circumstances, and amenable to implementation by a wide range of hardware- and software-based measurement systems.  As such, it does not attempt to mandate measurement quality levels or analyze specific end-user applications.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Terminology</h1>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Term</th>
<th class="left">Definition</th>
</tr></thead>
<tbody>
<tr>
<td class="left">ACH</td>
<td class="left">Associated Channel Header</td>
</tr>
<tr>
<td class="left">DM</td>
<td class="left">Delay Measurement</td>
</tr>
<tr>
<td class="left">ECMP</td>
<td class="left">Equal Cost Multipath</td>
</tr>
<tr>
<td class="left">G-ACh</td>
<td class="left">Generic Associated Channel</td>
</tr>
<tr>
<td class="left">LM</td>
<td class="left">Loss Measurement</td>
</tr>
<tr>
<td class="left">LSE</td>
<td class="left">Label Stack Entry</td>
</tr>
<tr>
<td class="left">LSP</td>
<td class="left">Label Switched Path</td>
</tr>
<tr>
<td class="left">NTP</td>
<td class="left">Network Time Protocol</td>
</tr>
<tr>
<td class="left">OAM</td>
<td class="left">Operations, Administration, and Maintenance</td>
</tr>
<tr>
<td class="left">PTP</td>
<td class="left">Precision Time Protocol</td>
</tr>
<tr>
<td class="left">TC</td>
<td class="left">Traffic Class</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#ov" id="ov">Overview</a>
</h1>
<p id="rfc.section.2.p.1">This section begins with a summary of the basic methods used for the bidirectional measurement of packet loss and delay.  These measurement methods are then described in detail.  Finally a list of practical considerations are discussed that may come into play to inform or modify these simple procedures.  This section is limited to theoretical discussion; for protocol specifics the reader is referred to <a href="#pf">Section 3</a> and <a href="#op">Section 4</a>.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Basic Bidirectional Measurement</h1>
<p id="rfc.section.2.1.p.1">The following figure shows the reference scenario.</p>
<div id="#rfc.figure.1"></div>
<div id="#ov_fig"></div>
<pre>
          T1              T2
+-------+/     Query       \+-------+
|       | - - - - - - - - -&gt;|       |
|   A   |===================|   B   |
|       |&lt;- - - - - - - - - |       |
+-------+\     Response    /+-------+
          T4              T3
          </pre>
<p id="rfc.section.2.1.p.2">The figure shows a bidirectional channel between two nodes, A and B, and illustrates the temporal reference points T1-T4 associated with a measurement operation that takes place at A. The operation consists of A sending a query message to B, and B sending back a response. Each reference point indicates the point in time at which either the query or the response message is transmitted or received over the channel.</p>
<p id="rfc.section.2.1.p.3">In this situation, A can arrange to measure the packet loss over the channel in the forward and reverse directions by sending Loss Measurement (LM) query messages to B each of which contains the count of packets transmitted prior to time T1 over the channel to B (A_TxP).  When the message reaches B, it appends two values and reflects the message back to A: the count of packets received prior to time T2 over the channel from A (B_RxP), and the count of packets transmitted prior to time T3 over the channel to A (B_TxP). When the response reaches A, it appends a fourth value, the count of packets received prior to time T4 over the channel from B (A_RxP).</p>
<p id="rfc.section.2.1.p.4">These four counter values enable A to compute the desired loss statistics. Because the transmit count at A and the receive count at B (and vice versa) may not be synchronized at the time of the first message, and to limit the effects of counter wrap, the loss is computed in the form of a delta between messages.</p>
<p id="rfc.section.2.1.p.5">To measure at A the delay over the channel to B, a Delay Measurement (DM) query message is sent from A to B containing a timestamp recording the instant at which it is transmitted, i.e.&#160;T1. When the message reaches B, a timestamp is added recording the instant at which it is received (T2). The message can now be reflected from B to A, with B adding its transmit timestamp (T3) and A adding its receive timestamp (T4). These four timestamps enable A to compute the one-way delay in each direction, as well as the two-way delay for the channel. The one-way delay computations require that the clocks of A and B be synchronized; mechanisms for clock synchronization are outside the scope of this document.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#ov_loss" id="ov_loss">Packet Loss Measurement</a>
</h1>
<p id="rfc.section.2.2.p.1">Suppose a bidirectional channel exists between the nodes A and B. The objective is to measure at A the following two quantities associated with the channel: </p>

<ul class="empty">
<li>A_TxLoss (transmit loss): the number of packets transmitted by A over the channel but not received at B;</li>
<li>A_RxLoss (receive loss): the number of packets transmitted by B over the channel but not received at A.</li>
</ul>
<p id="rfc.section.2.2.p.2">This is accomplished by initiating a Loss Measurement (LM) operation at A, which consists of transmission of a sequence of LM query messages (LM[1], LM[2], ...) over the channel at a specified rate, such as one every 100 milliseconds. Each message LM[n] contains the following value: </p>

<ul class="empty"><li>A_TxP[n]: the total count of packets transmitted by A over the channel prior to the time this message is transmitted.</li></ul>
<p id="rfc.section.2.2.p.3">When such a message is received at B, the following value is recorded in the message: </p>

<ul class="empty"><li>B_RxP[n]: the total count of packets received by B over the channel at the time this message is received (excluding the message itself).</li></ul>
<p id="rfc.section.2.2.p.4">At this point, B transmits the message back to A, recording within it the following value: </p>

<ul class="empty"><li>B_TxP[n]: the total count of packets transmitted by B over the channel prior to the time this response is transmitted.</li></ul>
<p id="rfc.section.2.2.p.5">When the message response is received back at A, the following value is recorded in the message: </p>

<ul class="empty"><li>A_RxP[n]: the total count of packets received by A over the channel at the time this response is received (excluding the message itself).</li></ul>
<p id="rfc.section.2.2.p.6">The transmit loss A_TxLoss[n-1,n] and receive loss A_RxLoss[n-1,n] within the measurement interval marked by the messages LM[n-1] and LM[n] are computed by A as follows:</p>
<p id="rfc.section.2.2.p.7">A_TxLoss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] - B_RxP[n-1]) <br> A_RxLoss[n-1,n] = (B_TxP[n] - B_TxP[n-1]) - (A_RxP[n] - A_RxP[n-1])</p>
<p id="rfc.section.2.2.p.8">where the arithmetic is modulo the counter size.</p>
<p id="rfc.section.2.2.p.9">(Strictly speaking, it is not necessary that the fourth count, A_RxP[n], actually be written in the message, but this is convenient for some implementations and useful if the message is to be forwarded on to an external measurement system.)</p>
<p id="rfc.section.2.2.p.10">The derived values </p>

<ul class="empty">
<li>A_TxLoss = A_TxLoss[1,2] + A_TxLoss[2,3] + ...</li>
<li>A_RxLoss = A_RxLoss[1,2] + A_RxLoss[2,3] + ...</li>
</ul>

<p> are updated each time a response to an LM message is received and processed, and represent the total transmit and receive loss over the channel since the LM operation was initiated.</p>
<p id="rfc.section.2.2.p.11">When computing the values A_TxLoss[n-1,n] and A_RxLoss[n-1,n] the possibility of counter wrap must be taken into account. Consider for example the values of the A_TxP counter at sequence numbers n-1 and n. Clearly if A_TxP[n] is allowed to wrap to 0 and then beyond to a value equal to or greater than A_TxP[n-1], the computation of an unambiguous A_TxLoss[n-1,n] value will be impossible. Therefore the LM message rate MUST be sufficiently high, given the counter size and the speed and minimum packet size of the underlying channel, that this condition cannot arise. For example, a 32-bit counter for a 100 Gbps link with a minimum packet size of 64 bytes can wrap in 2^32 / (10^11/(64*8)) = ~22 seconds, which is therefore an upper bound on the LM message interval under such conditions.  This bound will be referred to as the MaxLMInterval of the channel.  It is clear that the MaxLMInterval will be a more restrictive constraint in the case of direct LM and for smaller counter sizes.</p>
<p id="rfc.section.2.2.p.12">The loss measurement approach described in this section has the characteristic of being stateless at B and "almost" stateless at A.  Specifically, A must retain the data associated with the last LM response received, in order to use it to compute loss when the next response arrives.  This data MAY be discarded, and MUST NOT be used as a basis for measurement, if MaxLMInterval elapses before the next response arrives, because in this case an unambiguous measurement cannot be made.</p>
<p id="rfc.section.2.2.p.13">The foregoing discussion has assumed the counted objects are packets, but this need not be the case.  In particular, octets may be counted instead.  This will, of course, reduce the MaxLMInterval accordingly.</p>
<p id="rfc.section.2.2.p.14">In addition to absolute aggregate loss counts, the individual loss counts yield additional metrics such as the average loss rate over any multiple of the measurement interval.  An accurate loss rate can be determined over time even in the presence of anomalies affecting individual measurements, such as those due to packet misordering (<a href="#lm_anom">Section 4.2.10</a>).</p>
<p id="rfc.section.2.2.p.15">Note that an approach for conducting packet loss measurement in IP networks is documented in <a href="#RFC2680">[RFC2680]</a>.  This approach differs from the one described here, for example by requiring clock synchronization between the measurement points and lacking support for direct-mode LM.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> Throughput Measurement</h1>
<p id="rfc.section.2.3.p.1">If LM query messages contain a timestamp recording their time of transmission, this data can be combined with the packet or octet counts to yield measurements of the throughput offered and delivered over the channel during the interval in terms of the counted units.</p>
<p id="rfc.section.2.3.p.2">For a bidirectional channel, for example, given any two LM response messages (separated in time by not more than the MaxLMInterval), the difference between the counter values tells the querier the number of units successfully transmitted and received in the interval between the timestamps.  Absolute offered throughput is the number of data units transmitted and absolute delivered throughput is the number of data units received.  Throughput rate is the number of data units sent or received per unit time.</p>
<p id="rfc.section.2.3.p.3">Just as for loss measurement, the interval counts can be accumulated to arrive at the absolute throughput of the channel since the start of the measurement operation, or used to derive related metrics such as the throughput rate.  This procedure also enables out-of-service throughput testing when combined with a simple packet generator.</p>
<h1 id="rfc.section.2.4">
<a href="#rfc.section.2.4">2.4.</a> <a href="#ov_delay" id="ov_delay">Delay Measurement</a>
</h1>
<p id="rfc.section.2.4.p.1">Suppose a bidirectional channel exists between the nodes A and B. The objective is to measure at A one or more of the following quantities associated with the channel: </p>

<ul>
<li>The one-way delay associated with the forward (A to B) direction of the channel;</li>
<li>The one-way delay associated with the reverse (B to A) direction of the channel;</li>
<li>The two-way delay (A to B to A) associated with the channel.</li>
</ul>
<p id="rfc.section.2.4.p.2">The one-way delay metric for packet networks is described in <a href="#RFC2679">[RFC2679]</a>.  In the case of two-way delay, there are actually two possible metrics of interest.  The "two-way channel delay" is the sum of the one-way delays in each direction and reflects the delay of the channel itself, irrespective of processing delays within the remote endpoint B.  The "round-trip delay" is described in <a href="#RFC2681">[RFC2681]</a> and includes in addition any delay associated with remote endpoint processing.</p>
<p id="rfc.section.2.4.p.3">Measurement of the one-way delay quantities requires that the clocks of A and B be synchronized, whereas the two-way delay metrics can be measured directly even when this is not the case (provided A and B have stable clocks).</p>
<p id="rfc.section.2.4.p.4">A measurement is accomplished by sending a Delay Measurement (DM) query message over the channel to B which contains the following timestamp: </p>

<ul class="empty"><li>T1: the time the DM query message is transmitted from A.</li></ul>
<p id="rfc.section.2.4.p.5">When the message arrives at B, the following timestamp is recorded in the message: </p>

<ul class="empty"><li>T2: the time the DM query message is received at B.</li></ul>
<p id="rfc.section.2.4.p.6">At this point B transmits the message back to A, recording within it the following timestamp: </p>

<ul class="empty"><li>T3: the time the DM response message is transmitted from B.</li></ul>
<p id="rfc.section.2.4.p.7">When the message arrives back at A, the following timestamp is recorded in the message: </p>

<ul class="empty"><li>T4: the time the DM response message is received back at A.</li></ul>
<p id="rfc.section.2.4.p.8">(Strictly speaking, it is not necessary that the fourth timestamp, T4, actually be written in the message, but this is convenient for some implementations and useful if the message is to be forwarded on to an external measurement system.)</p>
<p id="rfc.section.2.4.p.9">At this point, A can compute the two-way channel delay associated with the channel as </p>

<ul class="empty"><li>two-way channel delay = (T4 - T1) - (T3 - T2)</li></ul>

<p> and the round-trip delay as </p>

<ul class="empty"><li>round-trip delay = T4 - T1.</li></ul>

<p> </p>
<p id="rfc.section.2.4.p.10">If the clocks of A and B are known at A to be synchronized, then both one-way delay values, as well as the two-way channel delay, can be computed at A as </p>

<ul class="empty">
<li>forward one-way delay = T2 - T1</li>
<li>reverse one-way delay = T4 - T3</li>
<li>two-way channel delay = forward delay + reverse delay.</li>
</ul>

<p> Note that this formula for the two-way channel delay reduces to the one previously given, and clock synchronization is not required to compute this metric.  </p>
<h1 id="rfc.section.2.5">
<a href="#rfc.section.2.5">2.5.</a> Delay Variation Measurement</h1>
<p id="rfc.section.2.5.p.1">Inter-Packet Delay Variation (IPDV) and Packet Delay Variation (PDV) <a href="#RFC5481">[RFC5481]</a> are performance metrics derived from one-way delay measurement and are important in some applications.  IPDV represents the difference between the one-way delays of successive packets in a stream.  PDV, given a measurement test interval, represents the difference between the one-way delay of a packet in the interval and that of the packet in the interval with the minimum delay.</p>
<p id="rfc.section.2.5.p.2">IPDV and PDV measurements can therefore be derived from delay measurements obtained through the procedures in <a href="#ov_delay">Section 2.4</a>. An important point regarding delay variation measurement, however, is that it can be carried out based on one-way delay measurements even when the clocks of the two systems involved in those measurements are not synchronized with one another.</p>
<h1 id="rfc.section.2.6">
<a href="#rfc.section.2.6">2.6.</a> Unidirectional Measurement</h1>
<p id="rfc.section.2.6.p.1">In the case that the channel from A to (B1, ..., Bk) (where B2, ..., Bk refer to the point-to-multipoint case) is unidirectional, i.e.&#160;is a unidirectional LSP, LM and DM measurements can be carried out at B1, ..., Bk instead of at A.</p>
<p id="rfc.section.2.6.p.2">For LM this is accomplished by initiating an LM operation at A and carrying out the same procedures as for bidirectional channels, except that no responses from B1, ..., Bk to A are generated. Instead, each terminal node B uses the A_TxP and B_RxP values in the LM messages it receives to compute the receive loss associated with the channel in essentially the same way as described previously, i.e.</p>
<p id="rfc.section.2.6.p.3">B_RxLoss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (B_RxP[n] - B_RxP[n-1])</p>
<p id="rfc.section.2.6.p.4">For DM, of course, only the forward one-way delay can be measured and the clock synchronization requirement applies.</p>
<p id="rfc.section.2.6.p.5">Alternatively, if an out-of-band channel from a terminal node B back to A is available, the LM and DM message responses can be communicated to A via this channel so that the measurements can be carried out at A.</p>
<h1 id="rfc.section.2.7">
<a href="#rfc.section.2.7">2.7.</a> Dyadic Measurement</h1>
<p id="rfc.section.2.7.p.1">The basic procedures for bidirectional measurement assume that the measurement process is conducted by and for the querier node A.  It is possible instead, with only minor variation of these procedures, to conduct a dyadic or "dual-ended" measurement process in which both nodes A and B perform loss or delay measurement based on the same message flow.  This is achieved by stipulating that A copy the third and fourth counter or timestamp values from a response message into the third and fourth slots of the next query, which are otherwise unused, thereby providing B with equivalent information to that learned by A.</p>
<p id="rfc.section.2.7.p.2">The dyadic procedure has the advantage of halving the number of messages required for both A and B to perform a given kind of measurement, but comes at the expense of each node's ability to control its own measurement process independently, and introduces additional operational complexity into the measurement protocols.  The quantity of measurement traffic is also expected to be low relative to that of user traffic, particularly when 64-bit counters are used for LM.  Consequently this document does not specify a dyadic operational mode.  It is however still possible, and may be useful, for A to perform the extra copy, thereby providing additional information to B even when its participation in the measurement process is passive.</p>
<h1 id="rfc.section.2.8">
<a href="#rfc.section.2.8">2.8.</a> <a href="#loop" id="loop">Loopback Measurement</a>
</h1>
<p id="rfc.section.2.8.p.1">Some bidirectional channels may be placed into a loopback state such that messages are looped back to the sender without modification.  In this situation, LM and DM procedures can be used to carry out measurements associated with the circular path.  This is done by generating "queries" with the Response flag set to 1.</p>
<p id="rfc.section.2.8.p.2">For LM, the loss computation in this case is:</p>
<p id="rfc.section.2.8.p.3">A_Loss[n-1,n] = (A_TxP[n] - A_TxP[n-1]) - (A_RxP[n] - A_RxP[n-1])</p>
<p id="rfc.section.2.8.p.4">For DM, the round-trip delay is computed.  In this case, however, the remote endpoint processing time component reflects only the time required to loop the message from channel input to channel output.</p>
<h1 id="rfc.section.2.9">
<a href="#rfc.section.2.9">2.9.</a> Measurement Considerations</h1>
<p id="rfc.section.2.9.p.1">A number of additional considerations apply in practice to the measurement methods summarized above.</p>
<h1 id="rfc.section.2.9.1">
<a href="#rfc.section.2.9.1">2.9.1.</a> Types of Channels</h1>
<p id="rfc.section.2.9.1.p.1">There are several types of channels in MPLS networks over which loss and delay measurement may be conducted.  The channel type may restrict the kinds of measurement that can be performed.  In all cases, LM and DM messages flow over the MPLS Generic Associated Channel (G-ACh), which is described in detail in <a href="#RFC5586">[RFC5586]</a>.</p>
<p id="rfc.section.2.9.1.p.2">Broadly, a channel in an MPLS network may be either a link, a Label Switched Path (LSP) <a href="#RFC3031">[RFC3031]</a>, or a pseudowire <a href="#RFC3985">[RFC3985]</a>.  Links are bidirectional and are also referred to as MPLS sections; see <a href="#RFC5586">[RFC5586]</a> and <a href="#RFC5960">[RFC5960]</a>.  Pseudowires are bidirectional.  Label Switched Paths may be either unidirectional or bidirectional.</p>
<p id="rfc.section.2.9.1.p.3">The LM and DM protocols discussed in this document are initiated from a single node, the querier.  A query message may be received either by a single node or by multiple nodes, depending on the nature of the channel.  In the latter case these protocols provide point-to-multipoint measurement capabilities.</p>
<h1 id="rfc.section.2.9.2">
<a href="#rfc.section.2.9.2">2.9.2.</a> Quality of Service</h1>
<p id="rfc.section.2.9.2.p.1">Quality of Service (QoS) capabilities, in the form of the Differentiated Services architecture, apply to MPLS as specified in <a href="#RFC3270">[RFC3270]</a> and <a href="#RFC5462">[RFC5462]</a>.  Different classes of traffic are distinguished by the three-bit Traffic Class (TC) field of an MPLS Label Stack Entry (LSE).  Delay measurement therefore applies on a per-traffic-class basis, and the TC values of LSEs above the G-ACh Label (GAL) that precedes a DM message are significant.  Packet loss can be measured with respect either to the channel as a whole or to a specific traffic class.</p>
<h1 id="rfc.section.2.9.3">
<a href="#rfc.section.2.9.3">2.9.3.</a> Measurement Point Location</h1>
<p id="rfc.section.2.9.3.p.1">The location of the measurement points for loss and delay within the sending and receiving nodes is implementation-dependent but directly affects the nature of the measurements.  For example, a sending implementation may or may not consider a packet to be "lost", for LM purposes, that was discarded prior to transmission for queuing-related reasons; conversely, a receiving implementation may or may not consider a packet to be "lost", for LM purposes, if it was physically received but discarded during receive-path processing.  The location of delay measurement points similarly determines what, precisely, is being measured.  The principal consideration here is that the behavior of an implementation in these respects MUST be made clear to the user.</p>
<h1 id="rfc.section.2.9.4">
<a href="#rfc.section.2.9.4">2.9.4.</a> Equal Cost Multipath</h1>
<p id="rfc.section.2.9.4.p.1">Equal Cost Multipath (ECMP) is the behavior of distributing packets across multiple alternate paths toward a destination.  The use of ECMP in MPLS networks is described in BCP 128 <a href="#RFC4928">[RFC4928]</a>.  The typical result of ECMP being performed on an LSP which is subject to delay measurement will be that only the delay of one of the available paths is and can be measured.</p>
<p id="rfc.section.2.9.4.p.2">The effects of ECMP on loss measurement will depend on the LM mode.  In the case of direct LM, the measurement will account for any packets lost between the sender and the receiver, regardless of how many paths exist between them.  However, the presence of ECMP increases the likelihood of misordering both of LM messages relative to data packets, and of the LM messages themselves.  Such misorderings tend to create unmeasurable intervals and thus degrade the accuracy of loss measurement.  The effects of ECMP are similar for inferred LM, with the additional caveat that, unless the test packets are specially constructed so as to probe all available paths, the loss characteristics of one or more of the alternate paths cannot be accounted for.</p>
<h1 id="rfc.section.2.9.5">
<a href="#rfc.section.2.9.5">2.9.5.</a> Intermediate Nodes</h1>
<p id="rfc.section.2.9.5.p.1">In the case of an LSP, it may be desirable to measure the loss or delay to or from an intermediate node as well as between LSP endpoints.  This can be done in principle by setting the Time to Live (TTL) field in the outer LSE appropriately when targeting a measurement message to an intermediate node.  This procedure may fail, however, if hardware-assisted measurement is in use, because the processing of the packet by the intermediate node occurs only as the result of TTL expiry, and the handling of TTL expiry may occur at a later processing stage in the implementation than the hardware-assisted measurement function.  Often the motivation for conducting measurements to intermediate nodes is an attempt to localize a problem that has been detected on the LSP.  In this case, if intermediate nodes are not capable of performing hardware-assisted measurement, a less accurate - but usually sufficient - software-based measurement can be conducted instead.</p>
<h1 id="rfc.section.2.9.6">
<a href="#rfc.section.2.9.6">2.9.6.</a> Different Transmit and Receive Interfaces</h1>
<p id="rfc.section.2.9.6.p.1">The overview of the bidirectional measurement process presented in <a href="#ov">Section 2</a> is also applicable when the transmit and receive interfaces at A or B differ from one another.  Some additional considerations, however, do apply in this case: </p>

<ul>
<li>If different clocks are associated with transmit and receive processing, these clocks must be synchronized in order to compute the two-way delay.</li>
<li>The DM protocol specified in this document requires that the timestamp formats used by the interfaces that receive a DM query and transmit a DM response agree.</li>
<li>The LM protocol specified in this document supports both 32-bit and 64-bit counter sizes, but the use of 32-bit counters at any of the up to four interfaces involved in an LM operation will result in 32-bit LM calculations for both directions of the channel.</li>
</ul>

<p> </p>
<h1 id="rfc.section.2.9.7">
<a href="#rfc.section.2.9.7">2.9.7.</a> <a href="#extpp" id="extpp">External Post-Processing</a>
</h1>
<p id="rfc.section.2.9.7.p.1">In some circumstances it may be desirable to carry out the final measurement computation at an external post-processing device dedicated to the purpose.  This can be achieved in supporting implementations by, for example, configuring the querier, in the case of a bidirectional measurement session, to forward each response it receives to the post-processor via any convenient protocol.  The unidirectional case can be handled similarly through configuration of the receiver, or by including an instruction in query messages for the receiver to respond out-of-band to the appropriate return address.</p>
<p id="rfc.section.2.9.7.p.2">Post-processing devices may have the ability to store measurement data for an extended period and to generate a variety of useful statistics from them.  External post-processing also allows the measurement process to be completely stateless at the querier and responder.</p>
<h1 id="rfc.section.2.9.8">
<a href="#rfc.section.2.9.8">2.9.8.</a> <a href="#lm_modes" id="lm_modes">Loss Measurement Modes</a>
</h1>
<p id="rfc.section.2.9.8.p.1">The summary of loss measurement at the beginning of <a href="#ov">Section 2</a> above made reference to the "count of packets" transmitted and received over a channel.  If the counted packets are the packets flowing over the channel in the data plane, the loss measurement is said to operate in "direct mode".  If, on the other hand, the counted packets are selected control packets from which the approximate loss characteristics of the channel are being inferred, the loss measurement is said to operate in "inferred mode".</p>
<p id="rfc.section.2.9.8.p.2">Direct LM has the advantage of being able to provide perfect loss accounting when it is available.  There are, however, several constraints associated with direct LM.</p>
<p id="rfc.section.2.9.8.p.3">For accurate direct LM to occur, packets must not be sent between the time the transmit count for an outbound LM message is determined and the time the message is actually transmitted.  Similarly, packets must not be received and processed between the time an LM message is received and the time the receive count for the message is determined.  If these "synchronization conditions" do not hold, the LM message counters will not reflect the true state of the data plane, with the result that, for example, the receive count of B may be greater than the transmit count of A, and attempts to compute loss by taking the difference will yield an invalid result.  This requirement for synchronization between LM message counters and the data plane may require special support from hardware-based forwarding implementations.</p>
<p id="rfc.section.2.9.8.p.4">A limitation of direct LM is that it may be difficult or impossible to apply in cases where the channel is an LSP and the LSP label at the receiver is either nonexistent or fails to identify a unique sending node.  The first case happens when Penultimate Hop Popping (PHP) is used on the LSP, and the second case generally holds for LSPs based on the Label Distribution Protocol (LDP) <a href="#RFC5036">[RFC5036]</a> as opposed to, for example, those based on Traffic Engineering extensions to the Resource Reservation Protocol (RSVP-TE) <a href="#RFC3209">[RFC3209]</a>.  These conditions may make it infeasible for the receiver to identify the data-plane packets associated with a particular source and LSP in order to count them, or to infer the source and LSP context associated with an LM message.  Direct LM is also vulnerable to disruption in the event that the ingress or egress interface associated with an LSP changes during the LSP's lifetime.</p>
<p id="rfc.section.2.9.8.p.5">Inferred LM works in the same manner as direct LM except that the counted packets are special control packets, called test messages, generated by the sender.  Test messages may be either packets explicitly constructed and used for LM or packets with a different primary purpose, such as those associated with a Bidirectional Forwarding Detection (BFD) <a href="#RFC5884">[RFC5884]</a> session.</p>
<p id="rfc.section.2.9.8.p.6">The synchronization conditions discussed above for direct LM also apply to inferred LM, the only difference being that the required synchronization is now between the LM counters and the test message generation process.  Protocol and application designers MUST take these synchronization requirements into account when developing tools for inferred LM, and make their behavior in this regard clear to the user.</p>
<p id="rfc.section.2.9.8.p.7">Inferred LM provides only an approximate view of the loss level associated with a channel, but is typically applicable even in cases where direct LM is not.</p>
<h1 id="rfc.section.2.9.9">
<a href="#rfc.section.2.9.9">2.9.9.</a> <a href="#lm_scope" id="lm_scope">Loss Measurement Scope</a>
</h1>
<p id="rfc.section.2.9.9.p.1">In the case of direct LM, where data-plane packets are counted, there are different possibilities for which kinds of packets are included in the count and which are excluded.  The set of packets counted for LM is called the loss measurement scope.  As noted above, one factor affecting the LM scope is whether all data packets are counted or only those belonging to a particular traffic class.  Another is whether various "auxiliary" flows associated with a data channel are counted, such as packets flowing over the G-ACh.  Implementations MUST make their supported LM scopes clear to the user, and care must be taken to ensure that the scopes of the channel endpoints agree.</p>
<h1 id="rfc.section.2.9.10">
<a href="#rfc.section.2.9.10">2.9.10.</a> Delay Measurement Accuracy</h1>
<p id="rfc.section.2.9.10.p.1">The delay measurement procedures described in this document are designed to facilitate hardware-assisted measurement and to function in the same way whether or not such hardware assistance is used.  The measurement accuracy will be determined by how closely the transmit and receive timestamps correspond to actual packet departure and arrival times.</p>
<p id="rfc.section.2.9.10.p.2">As noted in <a href="#ov_delay">Section 2.4</a>, measurement of one-way delay requires clock synchronization between the devices involved, while two-way delay measurement does not involve direct comparison between non-local timestamps and thus has no synchronization requirement.  The measurement accuracy will be limited by the quality of the local clock and, in the case of one-way delay measurement, by the quality of the synchonization.</p>
<h1 id="rfc.section.2.9.11">
<a href="#rfc.section.2.9.11">2.9.11.</a> Delay Measurement Timestamp Format</h1>
<p id="rfc.section.2.9.11.p.1">There are two significant timestamp formats in common use: the timestamp format of the Network Time Protocol (NTP), described in <a href="#RFC5905">[RFC5905]</a>, and the timestamp format used in the IEEE 1588 Precision Time Protocol (PTP) <a href="#IEEE1588">[IEEE1588]</a>.</p>
<p id="rfc.section.2.9.11.p.2">The NTP format has the advantages of wide use and long deployment in the Internet, and was specifically designed to make the computation of timestamp differences as simple and efficient as possible. On the other hand, there is also now a significant deployment of equipment designed to support the PTP format.</p>
<p id="rfc.section.2.9.11.p.3">The approach taken in this document is therefore to include in DM messages fields which identify the timestamp formats used by the two devices involved in a DM operation. This implies that a node attempting to carry out a DM operation may be faced with the problem of computing with and possibly reconciling different timestamp formats.  To ensure interoperability it is necessary that support of at least one timestamp format is mandatory.  This specification requires the support of the IEEE 1588 PTP format.  Timestamp format support requirements are discussed in detail in <a href="#pf_tsf">Section 3.4</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#pf" id="pf">Message Formats</a>
</h1>
<p id="rfc.section.3.p.1">Loss Measurement and Delay Measurement messages flow over the MPLS Generic Associated Channel (G-ACh) <a href="#RFC5586">[RFC5586]</a>.  Thus, a packet containing an LM or DM message contains an MPLS label stack, with the G-ACh Label (GAL) at the bottom of the stack.  The GAL is followed by an Associated Channel Header (ACH) which identifies the message type, and the message body follows the ACH.</p>
<p id="rfc.section.3.p.2">This document defines the following ACH Channel Types: </p>

<ul class="empty"><li>MPLS Direct Packet Loss Measurement (DLM) <br> MPLS Inferred Packet Loss Measurement (ILM) <br> MPLS Packet Delay Measurement (DM) <br> MPLS Direct Packet Loss and Delay Measurement (DLM+DM) <br> MPLS Inferred Packet Loss and Delay Measurement (ILM+DM)</li></ul>

<p> </p>
<p id="rfc.section.3.p.3">The message formats for direct and inferred LM are identical.  The formats of the DLM+DM and ILM+DM messages are also identical.</p>
<p id="rfc.section.3.p.4">For these channel types, the ACH SHALL NOT be followed by the ACH TLV Header defined in <a href="#RFC5586">[RFC5586]</a>.</p>
<p id="rfc.section.3.p.5">The fixed-format portion of a message MAY be followed by a block of Type-Length-Value (TLV) fields.  The TLV block provides an extensible way of attaching subsidiary information to LM and DM messages.  Several such TLV fields are defined below.</p>
<p id="rfc.section.3.p.6">All integer values for fields defined in this document SHALL be encoded in network byte order.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#pf_lm" id="pf_lm">Loss Measurement Message Format</a>
</h1>
<p id="rfc.section.3.1.p.1">The format of a Loss Measurement message, which follows the Associated Channel Header (ACH), is as follows:</p>
<div id="#rfc.figure.2"></div>
<div id="#pf_lm_f"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Flags |  Control Code |        Message Length         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | DFlags|  OTF  |                   Reserved                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Session Identifier          |    DS     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Origin Timestamp                       |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 1                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 4                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ~                           TLV Block                           ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.3.1.p.2">Reserved fields MUST be set to 0 and ignored upon receipt.  The possible values for the remaining fields are as follows.</p>
<div id="#rfc.table.2"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Field</th>
<th class="left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Version</td>
<td class="left">Protocol version</td>
</tr>
<tr>
<td class="left">Flags</td>
<td class="left">Message control flags</td>
</tr>
<tr>
<td class="left">Control Code</td>
<td class="left">Code identifying the query or response type</td>
</tr>
<tr>
<td class="left">Message Length</td>
<td class="left">Total length of this message in bytes</td>
</tr>
<tr>
<td class="left">Data Format Flags (DFlags)</td>
<td class="left">Flags specifying the format of message data</td>
</tr>
<tr>
<td class="left">Origin Timestamp Format (OTF)</td>
<td class="left">Format of the Origin Timestamp field</td>
</tr>
<tr>
<td class="left">Reserved</td>
<td class="left">Reserved for future specification</td>
</tr>
<tr>
<td class="left">Session Identifier</td>
<td class="left">Set arbitrarily by the querier</td>
</tr>
<tr>
<td class="left">Differentiated Services (DS) Field</td>
<td class="left">Differentiated Services Code Point (DSCP) being measured</td>
</tr>
<tr>
<td class="left"></td>
<td class="left"></td>
</tr>
<tr>
<td class="left">Origin Timestamp</td>
<td class="left">64-bit field for query message transmission timestamp</td>
</tr>
<tr>
<td class="left">Counter 1-4</td>
<td class="left">64-bit fields for LM counter values</td>
</tr>
<tr>
<td class="left">TLV Block</td>
<td class="left">Optional block of Type-Length-Value fields</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.1.p.3">The possible values for these fields are as follows.</p>
<p id="rfc.section.3.1.p.4">Version: Currently set to 0.</p>
<p id="rfc.section.3.1.p.5">Flags: The format of the Flags field is shown below.</p>
<div id="#rfc.figure.3"></div>
<pre>
                            +-+-+-+-+
                            |R|T|0|0|
                            +-+-+-+-+
          </pre>
<p id="rfc.section.3.1.p.6">The meanings of the flag bits are: </p>

<ul class="empty">
<li>R: Query/Response indicator.  Set to 0 for a Query and 1 for a Response.</li>
<li>T: Traffic-class-specific measurement indicator.  Set to 1 when the measurement operation is scoped to packets of a particular traffic class (DSCP value), and 0 otherwise.  When set to 1, the DS field of the message indicates the measured traffic class.</li>
<li>0: Set to 0.</li>
</ul>
<p id="rfc.section.3.1.p.7">Control Code: Set as follows according to whether the message is a Query or a Response as identified by the R flag. </p>

<ul class="empty">
<li>For a Query: <ul class="empty">
<li>0x0: In-band Response Requested. Indicates that this query has been sent over a bidirectional channel and the response is expected over the same channel.</li>
<li>0x1: Out-of-band Response Requested. Indicates that the response should be sent via an out-of-band channel.</li>
<li>0x2: No Response Requested. Indicates that no response to the query should be sent.  This mode can be used, for example, if all nodes involved are being controlled by a Network Management System.</li>
</ul>
</li>
<li>For a Response: <ul class="empty">
<li>Codes 0x0-0xF are reserved for non-error responses.  Error response codes imply that the response does not contain valid measurement data.</li>
<li>0x1: Success. Indicates that the operation was successful.</li>
<li>0x2: Notification - Data Format Invalid. Indicates that the query was processed but the format of the data fields in this response may be inconsistent. Consequently these data fields MUST NOT be used for measurement.</li>
<li>0x3: Notification - Initialization In Progress.  Indicates that the query was processed but this response does not contain valid measurement data because the responder's initialization process has not completed.</li>
<li>0x4: Notification - Data Reset Occurred.  Indicates that the query was processed but a reset has recently occurred which may render the data in this response inconsistent relative to earlier responses.</li>
<li>0x5: Notification - Resource Temporarily Unavailable.  Indicates that the query was processed but resources were unavailable to complete the requested measurement, and that consequently this response does not contain valid measurement data.</li>
<li>0x10: Error - Unspecified Error. Indicates that the operation failed for an unspecified reason.</li>
<li>0x11: Error - Unsupported Version. Indicates that the operation failed because the protocol version supplied in the query message is not supported.</li>
<li>0x12: Error - Unsupported Control Code. Indicates that the operation failed because the Control Code requested an operation that is not available for this channel.</li>
<li>0x13: Error - Unsupported Data Format.  Indicates that the operation failed because the data format specified in the query is not supported.</li>
<li>0x14: Error - Authentication Failure. Indicates that the operation failed because the authentication data supplied in the query was missing or incorrect.</li>
<li>0x15: Error - Invalid Destination Node Identifier.  Indicates that the operation failed because the Destination Node Identifier supplied in the query is not an identifier of this node.</li>
<li>0x16: Error - Connection Mismatch. Indicates that the operation failed because the channel identifier supplied in the query did not match the channel over which the query was received.</li>
<li>0x17: Error - Unsupported Mandatory TLV Object.  Indicates that the operation failed because a TLV Object received in the query and marked as mandatory is not supported.</li>
<li>0x18: Error - Unsupported Query Interval. Indicates that the operation failed because the query message rate exceeded the configured threshold.</li>
<li>0x19: Error - Administrative Block. Indicates that the operation failed because it has been administratively disallowed.</li>
<li>0x1A: Error - Resource Unavailable. Indicates that the operation failed because node resources were not available.</li>
<li>0x1B: Error - Resource Released. Indicates that the operation failed because node resources for this measurement session were administratively released.</li>
<li>0x1C: Error - Invalid Message.  Indicates that the operation failed because the received query message was malformed.</li>
<li>0x1D: Error - Protocol Error.  Indicates that the operation failed because a protocol error was found in the received query message.</li>
</ul>
</li>
</ul>
<p id="rfc.section.3.1.p.8">Message Length: Set to the total length of this message in bytes, including the Version, Flags, Control Code, and Message Length fields.</p>
<p id="rfc.section.3.1.p.9">DFlags: The format of the DFlags field is shown below.</p>
<div id="#rfc.figure.4"></div>
<pre>
                            +-+-+-+-+
                            |X|B|0|0|
                            +-+-+-+-+
          </pre>
<p id="rfc.section.3.1.p.10">The meanings of the DFlags bits are: </p>

<ul class="empty">
<li>X: Extended counter format indicator.  Indicates the use of extended (64-bit) counter values.  Initialized to 1 upon creation (and prior to transmission) of an LM Query and copied from an LM Query to an LM response.  Set to 0 when the LM message is transmitted or received over an interface that writes 32-bit counter values.</li>
<li>B: Octet (byte) count.  When set to 1, indicates that the Counter 1-4 fields represent octet counts.  The octet count applies to all packets within the LM scope (Section 2.9.9), and the octet count of a packet sent or received over a channel includes the total length of that packet (but excludes headers, labels or framing of the channel itself).  When set to 0, indicates that the Counter 1-4 fields represent packet counts.</li>
<li>0: Set to 0.</li>
</ul>
<p id="rfc.section.3.1.p.11">Origin Timestamp Format: The format of the Origin Timestamp field, as specified in <a href="#pf_tsf">Section 3.4</a>.</p>
<p id="rfc.section.3.1.p.12">Session Identifier: Set arbitrarily in a query and copied in the response, if any.  This field uniquely identifies a measurement operation (also called a session) that consists of a sequence of messages.  All messages in the sequence have the same Session Identifier.</p>
<p id="rfc.section.3.1.p.13">DS: When the T flag is set to 1, this field is set to the DSCP value <a href="#RFC3260">[RFC3260]</a> that corresponds to the traffic class being measured.  For MPLS, where the traffic class of a channel is identified by the three-bit Traffic Class in the channel's LSE <a href="#RFC5462">[RFC5462]</a>, this field SHOULD be set to the Class Selector Codepoint <a href="#RFC2474">[RFC2474]</a> that corresponds to that Traffic Class.  When the T flag is set to 0, the value of this field is arbitrary, and the field can be considered part of the Session Identifier.</p>
<p id="rfc.section.3.1.p.14">Origin Timestamp: Timestamp recording the transmit time of the query message.</p>
<p id="rfc.section.3.1.p.15">Counter 1-4: Referring to <a href="#ov_loss">Section 2.2</a>, when a query is sent from A, Counter 1 is set to A_TxP and the other counter fields are set to 0. When the query is received at B, Counter 2 is set to B_RxP. At this point, B copies Counter 1 to Counter 3 and Counter 2 to Counter 4, and re-initializes Counter 1 and Counter 2 to 0. When B transmits the response, Counter 1 is set to B_TxP. When the response is received at A, Counter 2 is set to A_RxP.</p>
<p id="rfc.section.3.1.p.16">The mapping of counter types such as A_TxP to the counter fields 1-4 is designed to ensure that transmit counter values are always written at the same fixed offset in the packet, and likewise for receive counters.  This property may be important for hardware processing.</p>
<p id="rfc.section.3.1.p.17">When a 32-bit counter value is written to one of the counter fields, that value SHALL be written to the low-order 32 bits of the field; the high-order 32 bits of the field MUST, in this case, be set to 0.</p>
<p id="rfc.section.3.1.p.18">TLV Block: Zero or more TLV fields.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#pf_dm" id="pf_dm">Delay Measurement Message Format</a>
</h1>
<p id="rfc.section.3.2.p.1">The format of a Delay Measurement message, which follows the Associated Channel Header (ACH), is as follows:</p>
<div id="#rfc.figure.5"></div>
<div id="#pf_dm_f"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Flags |  Control Code |        Message Length         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  QTF  |  RTF  | RPTF  |              Reserved                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Session Identifier          |    DS     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Timestamp 1                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Timestamp 4                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ~                           TLV Block                           ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<div id="#rfc.table.3"></div>
<p>The meanings of the fields are summarized in the following table.</p>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Field</th>
<th class="left">Meaning</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Version</td>
<td class="left">Protocol version</td>
</tr>
<tr>
<td class="left">Flags</td>
<td class="left">Message control flags</td>
</tr>
<tr>
<td class="left">Control Code</td>
<td class="left">Code identifying the query or response type</td>
</tr>
<tr>
<td class="left">Message Length</td>
<td class="left">Total length of this message in bytes</td>
</tr>
<tr>
<td class="left">QTF</td>
<td class="left">Querier timestamp format</td>
</tr>
<tr>
<td class="left">RTF</td>
<td class="left">Responder timestamp format</td>
</tr>
<tr>
<td class="left">RPTF</td>
<td class="left">Responder's preferred timestamp format</td>
</tr>
<tr>
<td class="left">Reserved</td>
<td class="left">Reserved for future specification</td>
</tr>
<tr>
<td class="left">Session Identifier</td>
<td class="left">Set arbitrarily by the querier</td>
</tr>
<tr>
<td class="left">Differentiated Services (DS) Field</td>
<td class="left">Differentiated Services Code Point (DSCP) being measured</td>
</tr>
<tr>
<td class="left"></td>
<td class="left"></td>
</tr>
<tr>
<td class="left">Timestamp 1-4</td>
<td class="left">64-bit timestamp values</td>
</tr>
<tr>
<td class="left">TLV Block</td>
<td class="left">Optional block of Type-Length-Value fields</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.2.p.2">Reserved fields MUST be set to 0 and ignored upon receipt.  The possible values for the remaining fields are as follows.</p>
<p id="rfc.section.3.2.p.3">Version: Currently set to 0.</p>
<p id="rfc.section.3.2.p.4">Flags: As specified in <a href="#pf_lm">Section 3.1</a>.  The T flag in a DM message is set to 1.</p>
<p id="rfc.section.3.2.p.5">Control Code: As specified in <a href="#pf_lm">Section 3.1</a>.</p>
<p id="rfc.section.3.2.p.6">Message Length: Set to the total length of this message in bytes, including the Version, Flags, Control Code, and Message Length fields.</p>
<p id="rfc.section.3.2.p.7">Querier Timestamp Format: The format of the timestamp values written by the querier, as specified in <a href="#pf_tsf">Section 3.4</a>.</p>
<p id="rfc.section.3.2.p.8">Responder Timestamp Format: The format of the timestamp values written by the responder, as specified in <a href="#pf_tsf">Section 3.4</a>.</p>
<p id="rfc.section.3.2.p.9">Responder's Preferred Timestamp Format: The timestamp format preferred by the responder, as specified in <a href="#pf_tsf">Section 3.4</a>.</p>
<p id="rfc.section.3.2.p.10">Session Identifier: As specified in <a href="#pf_lm">Section 3.1</a>.</p>
<p id="rfc.section.3.2.p.11">DS: As specified in <a href="#pf_lm">Section 3.1</a>.</p>
<p id="rfc.section.3.2.p.12">Timestamp 1-4: Referring to <a href="#ov_delay">Section 2.4</a>, when a query is sent from A, Timestamp 1 is set to T1 and the other timestamp fields are set to 0. When the query is received at B, Timestamp 2 is set to T2. At this point, B copies Timestamp 1 to Timestamp 3 and Timestamp 2 to Timestamp 4, and re-initializes Timestamp 1 and Timestamp 2 to 0. When B transmits the response, Timestamp 1 is set to T3. When the response is received at A, Timestamp 2 is set to T4. The actual formats of the timestamp fields written by A and B are indicated by the Querier Timestamp Format and Responder Timestamp Format fields respectively.</p>
<p id="rfc.section.3.2.p.13">The mapping of timestamps to the timestamp fields 1-4 is designed to ensure that transmit timestamps are always written at the same fixed offset in the packet, and likewise for receive timestamps.  This property is important for hardware processing.</p>
<p id="rfc.section.3.2.p.14">TLV Block: Zero or more TLV fields.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> <a href="#pf_lmdm" id="pf_lmdm">Combined Loss/Delay Measurement Message Format</a>
</h1>
<p id="rfc.section.3.3.p.1">The format of a combined Loss and Delay Measurement message, which follows the Associated Channel Header (ACH), is as follows:</p>
<div id="#rfc.figure.6"></div>
<div id="#pf_lmdm_f"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Flags |  Control Code |        Message Length         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | DFlags|  QTF  |  RTF  | RPTF  |           Reserved            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                       Session Identifier          |    DS     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Timestamp 1                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Timestamp 4                         |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 1                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    .                                                               .
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Counter 4                           |
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ~                           TLV Block                           ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.3.3.p.2">The fields of this message have the same meanings as the corresponding fields in the LM and DM message formats, except that the roles of the OTF and Origin Timestamp fields for LM are here played by the QTF and Timestamp 1 fields, respectively.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> <a href="#pf_tsf" id="pf_tsf">Timestamp Field Formats</a>
</h1>
<p id="rfc.section.3.4.p.1">The following timestamp format field values are specified in this document: </p>

<ul class="empty">
<li>0: Null timestamp format.  This value is a placeholder indicating that the timestamp field does not contain a meaningful timestamp.</li>
<li>1: Sequence number.  This value indicates that the timestamp field is to be viewed as a simple 64-bit sequence number.  This provides a simple solution for applications that do not require a real absolute timestamp, but only an indication of message ordering; an example is LM exception detection.</li>
<li>2: Network Time Protocol version 4 64-bit timestamp format <a href="#RFC5905">[RFC5905]</a>. This format consists of a 32-bit seconds field followed by a 32-bit fractional seconds field, so that it can be regarded as a fixed-point 64-bit quantity.</li>
<li>3: Low-order 64 bits of the IEEE 1588-2008 (1588v2) Precision Time Protocol timestamp format <a href="#IEEE1588">[IEEE1588]</a>.  This truncated format consists of a 32-bit seconds field followed by a 32-bit nanoseconds field, and is the same as the IEEE 1588v1 timestamp format.</li>
</ul>
<p id="rfc.section.3.4.p.2">Timestamp formats of n &lt; 64 bits in size SHALL be encoded in the 64-bit timestamp fields specified in this document using the n high-order bits of the field. The remaining 64 - n low-order bits in the field SHOULD be set to 0 and MUST be ignored when reading the field.</p>
<p id="rfc.section.3.4.p.3">To ensure that it is possible to find an interoperable mode between implementations it is necessary to select one timestamp format as the default.  The timestamp format chosen as the default is the truncated IEEE 1588 PTP format (format code 3 in the list above); this format MUST be supported.  The rationale for this choice is discussed in <a href="#ts_rationale">Appendix Appendix A</a>.  Implementations SHOULD also be capable of reading timestamps written in NTPv4 64-bit format and reconciling them internally with PTP timestamps for measurement purposes.  Support for other timestamp formats is OPTIONAL.</p>
<p id="rfc.section.3.4.p.4">The implementation MUST make clear which timestamp formats it supports and the extent of its support for computation with and reconciliation of different formats for measurement purposes.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> TLV Objects</h1>
<p id="rfc.section.3.5.p.1">The TLV Block in LM and DM messages consists of zero or more objects with the following format:</p>
<div id="#rfc.figure.7"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |    Length     |        Value                  ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.3.5.p.2">The Type and Length fields are each 8 bits long, and the Length field indicates the size in bytes of the Value field, which can therefore be up to 255 bytes long.</p>
<p id="rfc.section.3.5.p.3">The Type space is divided into Mandatory and Optional subspaces:</p>
<div id="#rfc.table.4"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Type Range</th>
<th class="left">Semantics</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0-127</td>
<td class="left">Mandatory</td>
</tr>
<tr>
<td class="left">128-255</td>
<td class="left">Optional</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.5.p.4">Upon receipt of a query message including an unrecognized mandatory TLV object, the recipient MUST respond with an Unsupported Mandatory TLV Object error code.</p>
<div id="#rfc.table.5"></div>
<p>The types defined are as follows:</p>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Type</th>
<th class="left">Definition</th>
</tr></thead>
<tbody>
<tr>
<td class="left">Mandatory</td>
<td class="left"></td>
</tr>
<tr>
<td class="left">0</td>
<td class="left">Padding - copy in response</td>
</tr>
<tr>
<td class="left">1</td>
<td class="left">Return Address</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">Session Query Interval</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">Loopback Request</td>
</tr>
<tr>
<td class="left">4-126</td>
<td class="left">Unallocated</td>
</tr>
<tr>
<td class="left">127</td>
<td class="left">Experimental use</td>
</tr>
<tr>
<td class="left"></td>
<td class="left"></td>
</tr>
<tr>
<td class="left">Optional</td>
<td class="left"></td>
</tr>
<tr>
<td class="left">128</td>
<td class="left">Padding - do not copy in response</td>
</tr>
<tr>
<td class="left">129</td>
<td class="left">Destination Address</td>
</tr>
<tr>
<td class="left">130</td>
<td class="left">Source Address</td>
</tr>
<tr>
<td class="left">131-254</td>
<td class="left">Unallocated</td>
</tr>
<tr>
<td class="left">255</td>
<td class="left">Experimental use</td>
</tr>
</tbody>
</table>
<h1 id="rfc.section.3.5.1">
<a href="#rfc.section.3.5.1">3.5.1.</a> Padding</h1>
<p id="rfc.section.3.5.1.p.1">The two padding objects permit the augmentation of packet size; this is mainly useful for delay measurement.  The type of padding indicates whether the padding supplied by the querier is to be copied to, or omitted from, the response.  Asymmetrical padding may be useful when responses are delivered out-of-band or when different maximum transmission unit sizes apply to the two components of a bidirectional channel.</p>
<p id="rfc.section.3.5.1.p.2">More than one padding object MAY be present, in which case they MUST be contiguous.  The Value field of a padding object is arbitrary.</p>
<h1 id="rfc.section.3.5.2">
<a href="#rfc.section.3.5.2">3.5.2.</a> Addressing</h1>
<p id="rfc.section.3.5.2.p.1">The addressing objects have the following format:</p>
<div id="#rfc.figure.8"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |    Length     |        Address Family         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    ~                           Address                             ~
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.3.5.2.p.2">The Address Family field indicates the type of the address, and SHALL be set to one of the assigned values in the IANA Address Family Numbers registry.</p>
<p id="rfc.section.3.5.2.p.3">The Source and Destination address objects indicate the addresses of the sender and the intended recipient of the message, respectively.  The Source Address of a query message SHOULD be used as the destination for an out-of-band response unless some other out-of-band response mechanism has been configured, and unless a Return Address object is present, in which case the Return Address specifies the target of the response.  The Return Address object MUST NOT appear in a response.</p>
<h1 id="rfc.section.3.5.3">
<a href="#rfc.section.3.5.3">3.5.3.</a> Loopback Request</h1>
<p id="rfc.section.3.5.3.p.1">The Loopback Request object, when included in a query, indicates a request that the query message be returned to the sender unmodified.  This object has a Length of 0.</p>
<p id="rfc.section.3.5.3.p.2">Upon receiving the reflected query message back from the responder, the querier MUST NOT retransmit the message.  Information that uniquely identifies the original query source, such as a Source Address object, can be included to enable the querier to differentiate one of its own loopback queries from a loopback query initiated by the far end.</p>
<p id="rfc.section.3.5.3.p.3">This object may be useful, for example, when the querier is interested only in the round-trip delay metric.  In this case no support for delay measurement is required at the responder at all, other than the ability to recognize a DM query that includes this object and return it unmodified.</p>
<h1 id="rfc.section.3.5.4">
<a href="#rfc.section.3.5.4">3.5.4.</a> <a href="#sqi" id="sqi">Session Query Interval</a>
</h1>
<p id="rfc.section.3.5.4.p.1">The Value field of the Session Query Interval object is a 32-bit unsigned integer that specifies a time interval in milliseconds:</p>
<div id="#rfc.figure.9"></div>
<pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |    Length     |            Session Query      &gt;
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    &lt;        Interval (ms)          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.3.5.4.p.2">This time interval indicates the interval between successive query messages in a specific measurement session.  The purpose of the Session Query Interval (SQI) object is to enable the querier and responder of a measurement session to agree on a query rate.  The procedures for handling this object SHALL be as follows: </p>

<ol>
<li>The querier notifies the responder that it wishes to be informed of the responder's minimum query interval for this session by including the SQI object in its query messages, with a Value of 0.</li>
<li>When the responder receives a query that includes an SQI object with a Value of 0, the responder includes an SQI object in the response with the Value set to the minimum query interval it supports for this session.</li>
<li>When the querier receives a response that includes an SQI object, it selects a query interval for the session that is greater than or equal to the Value specified in the SQI object and adjusts its query transmission rate accordingly, including in each subsequent query an SQI object with a Value equal to the selected query interval.  Once a response to one of these subsequent queries has been received, the querier infers that the responder has been apprised of the selected query interval and MAY then stop including the SQI object in queries associated with this session.</li>
</ol>

<p> Similar procedures allow the query rate to be changed during the course of the session by either the querier or the responder.  For example, to inform the querier of a change in the minimum supported query interval, the responder begins including a corresponding SQI object in its responses, and the querier adjusts its query rate if necessary and includes a corresponding SQI object in its queries until a response is received.</p>
<p id="rfc.section.3.5.4.p.3">Shorter query intervals (i.e. higher query rates) provide finer measurement granularity at the expense of additional load on measurement endpoints and the network; see <a href="#con_con">Section 6</a> for further discussion.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#op" id="op">Operation</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Operational Overview</h1>
<p id="rfc.section.4.1.p.1">A loss or delay measurement operation, also called a session, is controlled by the querier and consists of a sequence of query messages associated with a particular channel and a common set of measurement parameters.  If the session parameters include a response request, then the receiving node or nodes will (under normal conditions) generate a response message for each query message received, and these responses are also considered part of the session.  All query and response messages in a session carry a common session identifier.</p>
<p id="rfc.section.4.1.p.2">Measurement sessions are initiated at the discretion of the network operator and are terminated either at the operator's request or as the result of an error condition.  A session may be as brief as a single message exchange, for example when a DM query is used by the operator to "ping" a remote node, or may extend throughout the lifetime of the channel.</p>
<p id="rfc.section.4.1.p.3">When a session is initiated for which responses are requested, the querier SHOULD initialize a timer, called the SessionResponseTimeout, that indicates how long the querier will wait for a response before abandoning the session and notifying the user that a timeout has occurred.  This timer persists for the lifetime of the session and is reset each time a response message for the session is received.</p>
<p id="rfc.section.4.1.p.4">When a query message is received that requests a response, a variety of exceptional conditions may arise that prevent the responder from generating a response that contains valid measurement data.  Such conditions fall broadly into two classes: transient exceptions from which recovery is possible, and fatal exceptions that require termination of the session.  When an exception arises, the responder SHOULD generate a response with an appropriate Notification or Error control code according as the exception is, respectively, transient or fatal.  When the querier receives an Error response, the session MUST be terminated and the user informed.</p>
<p id="rfc.section.4.1.p.5">A common example of a transient exception occurs when a new session is initiated and the responder requires a period of time to become ready before it can begin providing useful responses.  The response control code corresponding to this situation is Notification - Initialization In Progress.  Typical examples of fatal exceptions are cases where the querier has requested a type of measurement that the responder does not support, or where a query message is malformed.</p>
<p id="rfc.section.4.1.p.6">When initiating a session the querier SHOULD employ the Session Query Interval mechanism (<a href="#sqi">Section 3.5.4</a>) to establish a mutually agreeable query rate with the responder.  Responders SHOULD employ rate-limiting mechanisms to guard against the possibility of receiving an excessive quantity of query messages.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Loss Measurement Procedures</h1>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> Initiating a Loss Measurement Operation</h1>
<p id="rfc.section.4.2.1.p.1">An LM operation for a particular channel consists of sending a sequence (LM[1], LM[2], ...) of LM query messages over the channel at a specific rate and processing the responses received, if any. As described in <a href="#ov_loss">Section 2.2</a>, the packet loss associated with the channel during the operation is computed as a delta between successive messages; these deltas can be accumulated to obtain a running total of the packet loss for the channel, or used to derive related metrics such as the average loss rate.</p>
<p id="rfc.section.4.2.1.p.2">The query message transmission rate MUST be sufficiently high, given the LM message counter size (which can be either 32 or 64 bits) and the speed and minimum packet size of the underlying channel, that the ambiguity condition noted in <a href="#ov_loss">Section 2.2</a> cannot arise.  The implementation SHOULD assume, in evaluating this rate, that the counter size is 32 bits unless explicitly configured otherwise, or unless (in the case of a bidirectional channel) all local and remote interfaces involved in the LM operation are known to be 64-bit-capable, which can be inferred from the value of the X flag in an LM response.</p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> Transmitting a Loss Measurement Query</h1>
<p id="rfc.section.4.2.2.p.1">When transmitting an LM Query, the Version field MUST be set to 0. The R flag MUST be set to 0.  The T flag SHALL be set to 1 if, and only if, the measurement is specific to a particular traffic class, in which case the DS field SHALL identify that traffic class.</p>
<p id="rfc.section.4.2.2.p.2">The X flag MUST be set to 1 if the transmitting interface writes 64-bit LM counters, and otherwise MUST be set to 0 to indicate that 32-bit counters are written.  The B flag SHALL be set to 1 to indicate that the counter fields contain octet counts, or to 0 to indicate packet counts.</p>
<p id="rfc.section.4.2.2.p.3">The Control Code field MUST be set to one of the values for Query messages listed in <a href="#pf_lm">Section 3.1</a>; if the channel is unidirectional, this field MUST NOT be set to 0x0 (Query: in-band response requested).</p>
<p id="rfc.section.4.2.2.p.4">The Session Identifier field can be set arbitrarily.</p>
<p id="rfc.section.4.2.2.p.5">The Origin Timestamp field SHALL be set to the time at which this message is transmitted, and the Origin Timestamp Format field MUST be set to indicate its format, according to <a href="#pf_tsf">Section 3.4</a>.</p>
<p id="rfc.section.4.2.2.p.6">The Counter 1 field SHOULD be set to the total count of units (packets or octets, according to the B flag) transmitted over the channel prior to this LM Query, or to 0 if this is the beginning of a measurement session for which counter data is not yet available.  The Counter 2 field MUST be set to 0.  If a response was previously received in this measurement session, the Counter 1 and Counter 2 fields of the most recent such response MAY be copied to the Counter 3 and Counter 4 fields, respectively, of this query; otherwise, the Counter 3 and Counter 4 fields MUST be set to 0.</p>
<h1 id="rfc.section.4.2.3">
<a href="#rfc.section.4.2.3">4.2.3.</a> Receiving a Loss Measurement Query</h1>
<p id="rfc.section.4.2.3.p.1">Upon receipt of an LM Query message, the Counter 2 field SHOULD be set to the total count of units (packets or octets, according to the B flag) received over the channel prior to this LM Query.  If the receiving interface writes 32-bit LM counters, the X flag MUST be set to 0.</p>
<p id="rfc.section.4.2.3.p.2">At this point the LM Query message must be inspected. If the Control Code field is set to 0x2 (no response requested), an LM Response message MUST NOT be transmitted. If the Control Code field is set to 0x0 (in-band response requested) or 0x1 (out-of-band response requested), then an in-band or out-of-band response, respectively, SHOULD be transmitted unless this has been prevented by an administrative, security or congestion control mechanism.</p>
<p id="rfc.section.4.2.3.p.3">In the case of a fatal exception that prevents the requested measurement from being made, the error SHOULD be reported, either via a response if one was requested or else as a notification to the user.</p>
<h1 id="rfc.section.4.2.4">
<a href="#rfc.section.4.2.4">4.2.4.</a> Transmitting a Loss Measurement Response</h1>
<p id="rfc.section.4.2.4.p.1">When constructing a Response to an LM Query, the Version field MUST be set to 0. The R flag MUST be set to 1.  The value of the T flag MUST be copied from the LM Query.</p>
<p id="rfc.section.4.2.4.p.2">The X flag MUST be set to 0 if the transmitting interface writes 32-bit LM counters; otherwise its value MUST be copied from the LM Query.  The B flag MUST be copied from the LM Query.</p>
<p id="rfc.section.4.2.4.p.3">The Session Identifier, Origin Timestamp, and Origin Timestamp Format fields MUST be copied from the LM Query. The Counter 1 and Counter 2 fields from the LM Query MUST be copied to the Counter 3 and Counter 4 fields, respectively, of the LM Response.</p>
<p id="rfc.section.4.2.4.p.4">The Control Code field MUST be set to one of the values for Response messages listed in <a href="#pf_lm">Section 3.1</a>. The value 0x10 (Unspecified Error) SHOULD NOT be used if one of the other more specific error codes is applicable.</p>
<p id="rfc.section.4.2.4.p.5">If the response is transmitted in-band, the Counter 1 field SHOULD be set to the total count of units transmitted over the channel prior to this LM Response. If the response is transmitted out-of-band, the Counter 1 field MUST be set to 0. In either case, the Counter 2 field MUST be set to 0.</p>
<h1 id="rfc.section.4.2.5">
<a href="#rfc.section.4.2.5">4.2.5.</a> Receiving a Loss Measurement Response</h1>
<p id="rfc.section.4.2.5.p.1">Upon in-band receipt of an LM Response message, the Counter 2 field is set to the total count of units received over the channel prior to this LM Response. If the receiving interface writes 32-bit LM counters, the X flag is set to 0.  (Since the life of the LM message in the network has ended at this point, it is up to the receiver whether these final modifications are made to the packet.  If the message is to be forwarded on for external post-processing (<a href="#extpp">Section 2.9.7</a>) then these modifications MUST be made.)</p>
<p id="rfc.section.4.2.5.p.2">Upon out-of-band receipt of an LM Response message, the Counter 1 and Counter 2 fields MUST NOT be used for purposes of loss measurement.</p>
<p id="rfc.section.4.2.5.p.3">If the Control Code in an LM Response is anything other than 0x1 (Success), the counter values in the response MUST NOT be used for purposes of loss measurement. If the Control Code indicates an error condition, or if the response message is invalid, the LM operation MUST be terminated and an appropriate notification to the user generated.</p>
<h1 id="rfc.section.4.2.6">
<a href="#rfc.section.4.2.6">4.2.6.</a> Loss Calculation</h1>
<p id="rfc.section.4.2.6.p.1">Calculation of packet loss is carried out according to the procedures in <a href="#ov_loss">Section 2.2</a>. The X flag in an LM message informs the device performing the calculation whether to perform 32-bit or 64-bit arithmetic.  If the flag value is equal to 1, all interfaces involved in the LM operation have written 64-bit counter values, and 64-bit arithmetic can be used.  If the flag value is equal to 0, at least one interface involved in the operation has written a 32-bit counter value, and 32-bit arithmetic is carried out using the low-order 32 bits of each counter value.</p>
<p id="rfc.section.4.2.6.p.2">Note that the semantics of the X flag allow all devices to interoperate regardless of their counter size support.  Thus, an implementation MUST NOT generate an error response based on the value of this flag.</p>
<h1 id="rfc.section.4.2.7">
<a href="#rfc.section.4.2.7">4.2.7.</a> Quality of Service</h1>
<p id="rfc.section.4.2.7.p.1">The TC field of the LSE corresponding to the channel (e.g. LSP) being measured SHOULD be set to a traffic class equal to or better than the best TC within the measurement scope to minimize the chance of out-of-order conditions.</p>
<h1 id="rfc.section.4.2.8">
<a href="#rfc.section.4.2.8">4.2.8.</a> <a href="#lm_gach" id="lm_gach">G-ACh Packets</a>
</h1>
<p id="rfc.section.4.2.8.p.1">By default, direct LM MUST exclude packets transmitted and received over the Generic Associated Channel (G-ACh).  An implementation MAY provide the means to alter the direct LM scope to include some or all G-ACh messages.  Care must be taken when altering the LM scope to ensure that both endpoints are in agreement.</p>
<h1 id="rfc.section.4.2.9">
<a href="#rfc.section.4.2.9">4.2.9.</a> Test Messages</h1>
<p id="rfc.section.4.2.9.p.1">In the case of inferred LM, the packets counted for LM consist of test messages generated for this purpose, or of some other class of packets deemed to provide a good proxy for data packets flowing over the channel.  The specification of test protocols and proxy packets is outside the scope of this document, but some guidelines are discussed below.</p>
<p id="rfc.section.4.2.9.p.2">An identifier common to both the test or proxy messages and the LM messages may be required to make correlation possible.  The combined value of the Session Identifier and DS fields SHOULD be used for this purpose when possible.  That is, test messages in this case will include a 32-bit field which can carry the value of the combined Session Identifier + DS field present in LM messages.  When TC-specific LM is conducted, the DS field of the LSE in the label stack of a test message corresponding to the channel (e.g. LSP) over which the message is sent MUST correspond to the DS value in the associated LM messages.</p>
<p id="rfc.section.4.2.9.p.3">A separate test message protocol SHOULD include a timeout value in its messages that informs the responder when to discard any state associated with a specific test.</p>
<h1 id="rfc.section.4.2.10">
<a href="#rfc.section.4.2.10">4.2.10.</a> <a href="#lm_anom" id="lm_anom">Message Loss and Packet Misorder Conditions</a>
</h1>
<p id="rfc.section.4.2.10.p.1">Because an LM operation consists of a message sequence with state maintained from one message to the next, LM is subject to the effects of lost messages and misordered packets in a way that DM is not. Because this state exists only on the querier, the handling of these conditions is, strictly speaking, a local matter. This section, however, presents recommended procedures for handling such conditions.  Note that in the absence of ECMP, packet misordering within a traffic class is a relatively rare event.</p>
<p id="rfc.section.4.2.10.p.2">The first kind of anomaly that may occur is that one or more LM messages may be lost in transit. The effect of such loss is that when an LM Response is next received at the querier, an unambiguous interpretation of the counter values it contains may be impossible, for the reasons described at the end of <a href="#ov_loss">Section 2.2</a>. Whether this is so depends on the number of messages lost and the other variables mentioned in that section, such as the LM message rate and the channel parameters.</p>
<p id="rfc.section.4.2.10.p.3">Another possibility is that LM messages are misordered in transit, so that for instance the response to LM[n] is received prior to the response to LM[n-1]. A typical implementation will discard the late response to LM[n-1], so that the effect is the same as the case of a lost message.</p>
<p id="rfc.section.4.2.10.p.4">Finally, LM is subject to the possibility that data packets are misordered relative to LM messages. This condition can result, for example, in a transmit count of 100 and a corresponding receive count of 101. The effect here is that the A_TxLoss[n-1,n] value (for example) for a given measurement interval will appear to be extremely (if not impossibly) large. The other case, where an LM message arrives earlier than some of the packets, simply results in those packets being counted as lost.</p>
<p id="rfc.section.4.2.10.p.5">An implementation SHOULD identify a threshold value that indicates the upper bound of lost packets measured in a single computation beyond which the interval is considered unmeasurable.  This is called the MaxLMIntervalLoss threshold.  It is clear that this threshold should be no higher than the maximum number of packets (or bytes) the channel is capable of transmitting over the interval, but it may be lower.  Upon encountering an unmeasurable interval, the LM state (i.e. data values from the last LM message received) SHOULD be discarded.</p>
<p id="rfc.section.4.2.10.p.6">With regard to lost LM messages, the MaxLMInterval (see <a href="#ov_loss">Section 2.2</a>) indicates the maximum amount of time that can elapse before the LM state is discarded.  If some messages are lost, but a message is subsequently received within MaxLMInterval, its timestamp or sequence number will quantify the loss, and it MAY still be used for measurement, although the measurement interval will in this case be longer than usual.</p>
<p id="rfc.section.4.2.10.p.7">If an LM message is received that has a timestamp less than or equal to the timestamp of the last LM message received, this indicates that an exception has occurred, and the current interval SHOULD be considered unmeasurable unless the implementation has some other way of handling this condition.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Delay Measurement Procedures</h1>
<h1 id="rfc.section.4.3.1">
<a href="#rfc.section.4.3.1">4.3.1.</a> Transmitting a Delay Measurement Query</h1>
<p id="rfc.section.4.3.1.p.1">When transmitting a DM Query, the Version and Reserved fields MUST be set to 0. The R flag MUST be set to 0, the T flag MUST be set to 1, and the remaining flag bits MUST be set to 0.</p>
<p id="rfc.section.4.3.1.p.2">The Control Code field MUST be set to one of the values for Query messages listed in <a href="#pf_lm">Section 3.1</a>; if the channel is unidirectional, this field MUST NOT be set to 0x0 (Query: in-band response requested).</p>
<p id="rfc.section.4.3.1.p.3">The Querier Timestamp Format field MUST be set to the timestamp format used by the querier when writing timestamp fields in this message; the possible values for this field are listed in <a href="#pf_tsf">Section 3.4</a>. The Responder Timestamp Format and Responder's Preferred Timestamp Format fields MUST be set to 0.</p>
<p id="rfc.section.4.3.1.p.4">The Session Identifier field can be set arbitrarily.  The DS field MUST be set to the traffic class being measured.</p>
<p id="rfc.section.4.3.1.p.5">The Timestamp 1 field SHOULD be set to the time at which this DM Query is transmitted, in the format indicated by the Querier Timestamp Format field.  The Timestamp 2 field MUST be set to 0.  If a response was previously received in this measurement session, the Timestamp 1 and Timestamp 2 fields of the most recent such response MAY be copied to the Timestamp 3 and Timestamp 4 fields, respectively, of this query; otherwise, the Timestamp 3 and Timestamp 4 fields MUST be set to 0.</p>
<h1 id="rfc.section.4.3.2">
<a href="#rfc.section.4.3.2">4.3.2.</a> Receiving a Delay Measurement Query</h1>
<p id="rfc.section.4.3.2.p.1">Upon receipt of a DM Query message, the Timestamp 2 field SHOULD be set to the time at which this DM Query is received.</p>
<p id="rfc.section.4.3.2.p.2">At this point the DM Query message must be inspected. If the Control Code field is set to 0x2 (no response requested), a DM Response message MUST NOT be transmitted. If the Control Code field is set to 0x0 (in-band response requested) or 0x1 (out-of-band response requested), then an in-band or out-of-band response, respectively, SHOULD be transmitted unless this has been prevented by an administrative, security or congestion control mechanism.</p>
<p id="rfc.section.4.3.2.p.3">In the case of a fatal exception that prevents the requested measurement from being made, the error SHOULD be reported, either via a response if one was requested or else as a notification to the user.</p>
<h1 id="rfc.section.4.3.3">
<a href="#rfc.section.4.3.3">4.3.3.</a> Transmitting a Delay Measurement Response</h1>
<p id="rfc.section.4.3.3.p.1">When constructing a Response to a DM Query, the Version and Reserved fields MUST be set to 0. The R flag MUST be set to 1, the T flag MUST be set to 1, and the remaining flag bits MUST be set to 0.</p>
<p id="rfc.section.4.3.3.p.2">The Session Identifier and Querier Timestamp Format (QTF) fields MUST be copied from the DM Query. The Timestamp 1 and Timestamp 2 fields from the DM Query MUST be copied to the Timestamp 3 and Timestamp 4 fields, respectively, of the DM Response.</p>
<p id="rfc.section.4.3.3.p.3">The Responder Timestamp Format (RTF) field MUST be set to the timestamp format used by the responder when writing timestamp fields in this message, i.e.&#160;Timestamp 4 and (if applicable) Timestamp 1; the possible values for this field are listed in <a href="#pf_tsf">Section 3.4</a>. Furthermore, the RTF field MUST be set equal either to the QTF or the RPTF field. See <a href="#op_dm_tsfn">Section 4.3.5</a> for guidelines on selection of the value for this field.</p>
<p id="rfc.section.4.3.3.p.4">The Responder's Preferred Timestamp Format (RPTF) field MUST be set to one of the values listed in <a href="#pf_tsf">Section 3.4</a> and SHOULD be set to indicate the timestamp format with which the responder can provide the best accuracy for purposes of delay measurement.</p>
<p id="rfc.section.4.3.3.p.5">The Control Code field MUST be set to one of the values for Response messages listed in <a href="#pf_lm">Section 3.1</a>. The value 0x10 (Unspecified Error) SHOULD NOT be used if one of the other more specific error codes is applicable.</p>
<p id="rfc.section.4.3.3.p.6">If the response is transmitted in-band, the Timestamp 1 field SHOULD be set to the time at which this DM Response is transmitted.  If the response is transmitted out-of-band, the Timestamp 1 field MUST be set to 0. In either case, the Timestamp 2 field MUST be set to 0.</p>
<p id="rfc.section.4.3.3.p.7">If the response is transmitted in-band and the Control Code in the message is 0x1 (Success), then the Timestamp 1 and Timestamp 4 fields MUST have the same format, which will be the format indicated in the Responder Timestamp Format field.</p>
<h1 id="rfc.section.4.3.4">
<a href="#rfc.section.4.3.4">4.3.4.</a> Receiving a Delay Measurement Response</h1>
<p id="rfc.section.4.3.4.p.1">Upon in-band receipt of a DM Response message, the Timestamp 2 field is set to the time at which this DM Response is received.  (Since the life of the DM message in the network has ended at this point, it is up to the receiver whether this final modification is made to the packet.  If the message is to be forwarded on for external post-processing (<a href="#extpp">Section 2.9.7</a>) then these modifications MUST be made.)</p>
<p id="rfc.section.4.3.4.p.2">Upon out-of-band receipt of a DM Response message, the Timestamp 1 and Timestamp 2 fields MUST NOT be used for purposes of delay measurement.</p>
<p id="rfc.section.4.3.4.p.3">If the Control Code in a DM Response is anything other than 0x1 (Success), the timestamp values in the response MUST NOT be used for purposes of delay measurement.  If the Control Code indicates an error condition, or if the response message is invalid, the DM operation MUST be terminated and an appropriate notification to the user generated.</p>
<h1 id="rfc.section.4.3.5">
<a href="#rfc.section.4.3.5">4.3.5.</a> <a href="#op_dm_tsfn" id="op_dm_tsfn">Timestamp Format Negotiation</a>
</h1>
<p id="rfc.section.4.3.5.p.1">In case either the querier or the responder in a DM transaction is capable of supporting multiple timestamp formats, it is desirable to determine the optimal format for purposes of delay measurement on a particular channel. The procedures for making this determination SHALL be as follows.</p>
<p id="rfc.section.4.3.5.p.2">Upon sending an initial DM Query over a channel, the querier sets the Querier Timestamp Format (QTF) field to its preferred timestamp format.</p>
<p id="rfc.section.4.3.5.p.3">Upon receiving any DM Query message, the responder determines whether it is capable of writing timestamps in the format specified by the QTF field. If so, the Responder Timestamp Format (RTF) field is set equal to the QTF field. If not, the RTF field is set equal to the Responder's Preferred Timestamp Format (RPTF) field.</p>
<p id="rfc.section.4.3.5.p.4">The process of changing from one timestamp format to another at the responder may result in the Timestamp 1 and Timestamp 4 fields in an in-band DM Response having different formats. If this is the case, the Control Code in the response MUST NOT be set to 0x1 (Success). Unless an error condition has occurred, the Control Code MUST be set to 0x2 (Notification - Data Format Invalid).</p>
<p id="rfc.section.4.3.5.p.5">Upon receiving a DM Response, the querier knows from the RTF field in the message whether the responder is capable of supporting its preferred timestamp format: if it is, the RTF will be equal to the QTF. The querier also knows the responder's preferred timestamp format from the RPTF field. The querier can then decide whether to retain its current QTF or to change it and repeat the negotiation procedures.</p>
<h1 id="rfc.section.4.3.5.1">
<a href="#rfc.section.4.3.5.1">4.3.5.1.</a> Single-Format Procedures</h1>
<p id="rfc.section.4.3.5.1.p.1">When an implementation supports only one timestamp format, the procedures above reduce to the following simple behavior: </p>

<ul>
<li>All DM Queries are transmitted with the same QTF;</li>
<li>All DM Responses are transmitted with the same RTF, and the RPTF is always set equal to the RTF;</li>
<li>All DM Responses received with RTF not equal to QTF are discarded;</li>
<li>On a unidirectional channel, all DM Queries received with QTF not equal to the supported format are discarded.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.3.6">
<a href="#rfc.section.4.3.6">4.3.6.</a> Quality of Service</h1>
<p id="rfc.section.4.3.6.p.1">The TC field of the LSE corresponding to the channel (e.g. LSP) being measured MUST be set to the value that corresponds to the DS field in the DM message.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> Combined Loss/Delay Measurement Procedures</h1>
<p id="rfc.section.4.4.p.1">The combined LM/DM message defined in <a href="#pf_lmdm">Section 3.3</a> allows loss and delay measurement to be carried out simultaneously.  This message SHOULD be treated as an LM message which happens to carry additional timestamp data, with the timestamp fields processed as per delay measurement procedures.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Implementation Disclosure Requirements</h1>
<p id="rfc.section.5.p.1">This section summarizes the requirements placed on implementations for capabilities disclosure.  The purpose of these requirements is to ensure that end users have a clear understanding of implementation capabilities and characteristics that have a direct impact on how loss and delay measurement mechanisms function in specific situations.  Implementations are REQUIRED to state: </p>

<ul>
<li>METRICS: Which of the following metrics are supported: packet loss, packet throughput, octet loss, octet throughput, average loss rate, one-way delay, round-trip delay, two-way channel delay, packet delay variation.</li>
<li>MP-LOCATION: The location of loss and delay measurement points with respect to other stages of packet processing, such as queuing.</li>
<li>CHANNEL-TYPES: The types of channels for which LM and DM are supported, including LSP types, pseudowires, and sections (links).</li>
<li>QUERY-RATE: The minimum supported query intervals for LM and DM sessions, both in the querier and responder roles.</li>
<li>LOOP: Whether loopback measurement (<a href="#loop">Section 2.8</a>) is supported.</li>
<li>LM-TYPES: Whether direct or inferred LM is supported, and for the latter, which test protocols or proxy message types are supported.</li>
<li>LM-COUNTERS: Whether 64-bit counters are supported.</li>
<li>LM-ACCURACY: The expected measurement accuracy levels for the supported forms of LM, and the expected impact of exception conditions such as lost and misordered messages.</li>
<li>LM-SYNC: The implementation's behavior in regard to the synchronization conditions discussed in <a href="#lm_modes">Section 2.9.8</a>.</li>
<li>LM-SCOPE: The supported LM scopes (<a href="#lm_scope">Section 2.9.9</a> and <a href="#lm_gach">Section 4.2.8</a>).</li>
<li>DM-ACCURACY: The expected measurement accuracy levels for the supported forms of DM.</li>
<li>DM-TS-FORMATS: The supported timestamp formats and the extent of support for computation with and reconciliation of different formats.</li>
</ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#con_con" id="con_con">Congestion Considerations</a>
</h1>
<p id="rfc.section.6.p.1">An MPLS network may be traffic-engineered in such a way that the bandwidth required both for client traffic and for control, management and OAM traffic is always available. The following congestion considerations therefore apply only when this is not the case.</p>
<p id="rfc.section.6.p.2">The proactive generation of Loss Measurement and Delay Measurement messages for purposes of monitoring the performance of an MPLS channel naturally results in a degree of additional load placed on both the network and the terminal nodes of the channel. When configuring such monitoring, operators should be mindful of the overhead involved and should choose transmit rates that do not stress network resources unduly; such choices must be informed by the deployment context. In case of slower links or lower-speed devices, for example, lower Loss Measurement message rates can be chosen, up to the limits noted at the end of <a href="#ov_loss">Section 2.2</a>.</p>
<p id="rfc.section.6.p.3">In general, lower measurement message rates place less load on the network at the expense of reduced granularity. For delay measurement this reduced granularity translates to a greater possibility that the delay associated with a channel temporarily exceeds the expected threshold without detection. For loss measurement, it translates to a larger gap in loss information in case of exceptional circumstances such as lost LM messages or misordered packets.</p>
<p id="rfc.section.6.p.4">When carrying out a sustained measurement operation such as an LM operation or continuous pro-active DM operation, the querier SHOULD take note of the number of lost measurement messages (queries for which a response is never received) and set a corresponding Measurement Message Loss Threshold. If this threshold is exceeded, the measurement operation SHOULD be suspended so as not to exacerbate the possible congestion condition. This suspension SHOULD be accompanied by an appropriate notification to the user so that the condition can be investigated and corrected.</p>
<p id="rfc.section.6.p.5">From the receiver perspective, the main consideration is the possibility of receiving an excessive quantity of measurement messages.  An implementation SHOULD employ a mechanism such as rate-limiting to guard against the effects of this case.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Manageability Considerations</h1>
<p id="rfc.section.7.p.1">The measurement protocols described in this document are intended to serve as infrastructure to support a wide range of higher-level monitoring and diagnostic applications, from simple command-line diagnostic tools to comprehensive network performance monitoring and analysis packages.  The specific mechanisms and considerations for protocol configuration, initialization and reporting thus depend on the nature of the application.</p>
<p id="rfc.section.7.p.2">In the case of on-demand diagnostics, the diagnostic application may provide parameters such as the measurement type, the channel, the query rate, and the test duration when initiating the diagnostic; results and exception conditions are then reported directly to the application.  The system may discard the statistics accumulated during the test after the results have been reported, or retain them to provide a historical measurement record.</p>
<p id="rfc.section.7.p.3">Alternatively, measurement configuration may be supplied as part of the channel configuration itself in order to support continuous monitoring of the channel's performance characteristics.  In this case the configuration will typically include quality thresholds depending on the service-level agreement, the crossing of which will trigger warnings or alarms, and result reporting and exception notification will be integrated into the system-wide network management and reporting framework.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">This document describes procedures for the measurement of performance metrics over a pre-existing MPLS path (a pseudowire, LSP, or section).  As such it assumes that a node involved in a measurement operation has previously verified the integrity of the path and the identity of the far end using existing MPLS mechanisms such as Bidirectional Forwarding Detection (BFD) <a href="#RFC5884">[RFC5884]</a>; tools, techniques, and considerations for securing MPLS paths are discussed in detail in <a href="#RFC5920">[RFC5920]</a>.</p>
<p id="rfc.section.8.p.2">When such mechanisms are not available, and where security of the measurement operation is a concern, reception of Generic Associated Channel messages with the Channel Types specified in this document SHOULD be disabled.  Implementations MUST provide the ability to disable these protocols on a per-Channel-Type basis.</p>
<p id="rfc.section.8.p.3">Even when the identity of the far end has been verified, the measurement protocols remain vulnerable to injection and man-in-the-middle attacks.  The impact of such an attack would be to compromise the quality of performance measurements on the affected path.  An attacker positioned to disrupt these measurements is, however, capable of causing much greater damage by disrupting far more critical elements of the network such as the network control plane or user traffic flows.  A disruption of the measurement protocols would at worst interfere with the monitoring of the performance aspects of the service level agreement associated with the path; the existence of such a disruption would imply that a much more serious breach of basic path integrity had already occurred.</p>
<p id="rfc.section.8.p.4">Such attacks can be mitigated if desired by performing basic validation and sanity checks, at the querier, of the counter or timestamp fields in received measurement response messages.  The minimal state associated with these protocols also limits the extent of measurement disruption that can be caused by a corrupt or invalid message to a single query/response cycle.</p>
<p id="rfc.section.8.p.5">Cryptographic mechanisms capable of signing or encrypting the contents of the measurement packets without degrading the measurement performance are not currently available.  In light of the preceding discussion, the absence of such cryptographic mechanisms does not raise significant security issues.</p>
<p id="rfc.section.8.p.6">Users concerned with the security of out-of-band responses over IP networks SHOULD employ suitable security mechanisms such as IPsec <a href="#RFC4301">[RFC4301]</a> to protect the integrity of the return path.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">This document makes the following requests of IANA: </p>

<ul>
<li>Allocation of Channel Types in the PW Associated Channel Type registry</li>
<li>Creation of a Measurement Timestamp Type registry</li>
<li>Creation of an MPLS Loss/Delay Measurement Control Code registry</li>
<li>Creation of an MPLS Loss/Delay Measurement Type-Length-Value (TLV) Object registry</li>
</ul>

<p> </p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> Allocation of PW Associated Channel Types</h1>
<p id="rfc.section.9.1.p.1">As per the IANA considerations in <a href="#RFC5586">[RFC5586]</a>, IANA is requested to allocate the following Channel Types in the PW Associated Channel Type registry:</p>
<div id="#rfc.table.6"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Value</th>
<th class="left">Description</th>
<th class="left">TLV Follows</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">TBD</td>
<td class="left">MPLS Direct Packet Loss Measurement (DLM)</td>
<td class="left">No</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">TBD</td>
<td class="left">MPLS Inferred Packet Loss Measurement (ILM)</td>
<td class="left">No</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">TBD</td>
<td class="left">MPLS Packet Delay Measurement (DM)</td>
<td class="left">No</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">TBD</td>
<td class="left">MPLS Direct Packet Loss and Delay Measurement (DLM+DM)</td>
<td class="left">No</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">TBD</td>
<td class="left">MPLS Inferred Packet Loss and Delay Measurement (ILM+DM)</td>
<td class="left">No</td>
<td class="left">(this draft)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.9.1.p.2">The values marked TBD are to be allocated by IANA as appropriate.</p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> Creation of Measurement Timestamp Type Registry</h1>
<p id="rfc.section.9.2.p.1">IANA is requested to create a new Measurement Timestamp Type registry, with format and initial allocations as follows:</p>
<div id="#rfc.table.7"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Type</th>
<th class="left">Description</th>
<th class="left">Size in bits</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">Null Timestamp</td>
<td class="left">64</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">1</td>
<td class="left">Sequence Number</td>
<td class="left">64</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">Network Time Protocol version 4 64-bit Timestamp</td>
<td class="left">64</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">Truncated IEEE 1588v2 PTP Timestamp</td>
<td class="left">64</td>
<td class="left">(this draft)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.9.2.p.2">The range of the Type field is 0-15.</p>
<p id="rfc.section.9.2.p.3">The allocation policy for this registry is IETF Review.</p>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> Creation of MPLS Loss/Delay Measurement Control Code Registry</h1>
<p id="rfc.section.9.3.p.1">IANA is requested to create a new MPLS Loss/Delay Measurement Control Code registry.  This registry is divided into two separate parts, one for Query Codes and the other for Response Codes, with formats and initial allocations as follows:</p>
<div id="#rfc.table.8"></div>
<p>Query Codes</p>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Code</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0x0</td>
<td class="left">In-band Response Requested</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1</td>
<td class="left">Out-of-band Response Requested</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x2</td>
<td class="left">No Response Requested</td>
<td class="left">(this draft)</td>
</tr>
</tbody>
</table>
<div id="#rfc.table.9"></div>
<p>Response Codes</p>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Code</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0x0</td>
<td class="left">Reserved</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1</td>
<td class="left">Success</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x2</td>
<td class="left">Data Format Invalid</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x3</td>
<td class="left">Initialization In Progress</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x4</td>
<td class="left">Data Reset Occurred</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x5</td>
<td class="left">Resource Temporarily Unavailable</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x10</td>
<td class="left">Unspecified Error</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x11</td>
<td class="left">Unsupported Version</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x12</td>
<td class="left">Unsupported Control Code</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x13</td>
<td class="left">Unsupported Data Format</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x14</td>
<td class="left">Authentication Failure</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x15</td>
<td class="left">Invalid Destination Node Identifier</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x16</td>
<td class="left">Connection Mismatch</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x17</td>
<td class="left">Unsupported Mandatory TLV Object</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x18</td>
<td class="left">Unsupported Query Interval</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x19</td>
<td class="left">Administrative Block</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1A</td>
<td class="left">Resource Unavailable</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1B</td>
<td class="left">Resource Released</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1C</td>
<td class="left">Invalid Message</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">0x1D</td>
<td class="left">Protocol Error</td>
<td class="left">(this draft)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.9.3.p.2">IANA is also requested to indicate that the values 0x0 - 0xF in the Response Code section are reserved for non-error response codes.</p>
<p id="rfc.section.9.3.p.3">The range of the Code field is 0 - 255.</p>
<p id="rfc.section.9.3.p.4">The allocation policy for this registry is IETF Review.</p>
<h1 id="rfc.section.9.4">
<a href="#rfc.section.9.4">9.4.</a> Creation of MPLS Loss/Delay Measurement TLV Object Registry</h1>
<p id="rfc.section.9.4.p.1">IANA is requested to create a new MPLS Loss/Delay Measurement TLV Object registry, with format and initial allocations as follows:</p>
<div id="#rfc.table.10"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<thead><tr>
<th class="left">Type</th>
<th class="left">Description</th>
<th class="left">Reference</th>
</tr></thead>
<tbody>
<tr>
<td class="left">0</td>
<td class="left">Padding - copy in response</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">1</td>
<td class="left">Return Address</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">2</td>
<td class="left">Session Query Interval</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">3</td>
<td class="left">Loopback Request</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">127</td>
<td class="left">Experimental use</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">128</td>
<td class="left">Padding - do not copy in response</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">129</td>
<td class="left">Destination Address</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">130</td>
<td class="left">Source Address</td>
<td class="left">(this draft)</td>
</tr>
<tr>
<td class="left">255</td>
<td class="left">Experimental use</td>
<td class="left">(this draft)</td>
</tr>
</tbody>
</table>
<p id="rfc.section.9.4.p.2">IANA is also requested to indicate that Types 0-127 are classified as Mandatory, and that Types 128-255 are classified as Optional.</p>
<p id="rfc.section.9.4.p.3">The range of the Type field is 0 - 255.</p>
<p id="rfc.section.9.4.p.4">The allocation policy for this registry is IETF Review.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgments</h1>
<p id="rfc.section.10.p.1">The authors wish to thank the many participants of the MPLS working group who provided detailed review and feedback on this document.  The authors offer special thanks to Alexander Vainshtein, Loa Andersson, and Hiroyuki Takagi for many helpful thoughts and discussions, to Linda Dunbar for the idea of using LM messages for throughput measurement, and to Ben Niven-Jenkins, Marc Lasserre, and Ben Mack-Crane for their valuable comments.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a href="mailto:kmn@cisco.com" title="Cisco Systems">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com" title="Torrent Networking Technologies">Blake, S.</a>, <a href="mailto:fred@cisco.com" title="Cisco Systems">Baker, F.</a> and <a href="mailto:black_david@emc.com" title="EMC Corporation">D.L. Black</a>, "<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="http://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3270">[RFC3270]</b></td>
<td class="top">
<a>Le Faucheur, F.</a>, <a>Wu, L.</a>, <a>Davie, B.</a>, <a>Davari, S.</a>, <a>Vaananen, P.</a>, <a>Krishnan, R.</a>, <a>Cheval, P.</a> and <a>J. Heinanen</a>, "<a href="http://tools.ietf.org/html/rfc3270">Multi-Protocol Label Switching (MPLS) Support of Differentiated Services</a>", RFC 3270, May 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5462">[RFC5462]</b></td>
<td class="top">
<a>Andersson, L.</a> and <a>R. Asati</a>, "<a href="http://tools.ietf.org/html/rfc5462">Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field</a>", RFC 5462, February 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5586">[RFC5586]</b></td>
<td class="top">
<a>Bocci, M.</a>, <a>Vigoureux, M.</a> and <a>S. Bryant</a>, "<a href="http://tools.ietf.org/html/rfc5586">MPLS Generic Associated Channel</a>", RFC 5586, June 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5905">[RFC5905]</b></td>
<td class="top">
<a>Mills, D.</a>, <a>Martin, J.</a>, <a>Burbank, J.</a> and <a>W. Kasch</a>, "<a href="http://tools.ietf.org/html/rfc5905">Network Time Protocol Version 4: Protocol and Algorithms Specification</a>", RFC 5905, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE1588">[IEEE1588]</b></td>
<td class="top">
<a title="IEEE">IEEE, </a>, "<a>1588-2008 IEEE Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems</a>", March 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-mpls-tp-loss-delay-profile">[I-D.ietf-mpls-tp-loss-delay-profile]</b></td>
<td class="top">
<a>Frost, D</a> and <a>S Bryant</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mpls-tp-loss-delay-profile-04">A Packet Loss and Delay Measurement Profile for MPLS-based Transport Networks</a>", Internet-Draft draft-ietf-mpls-tp-loss-delay-profile-04, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2679">[RFC2679]</b></td>
<td class="top">
<a href="mailto:almes@advanced.org" title="Advanced Network &amp; Services, Inc.">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org" title="Advanced Network &amp; Services, Inc.">Kalidindi, S.</a> and <a href="mailto:matt@advanced.org" title="Advanced Network &amp; Services, Inc.">M. Zekauskas</a>, "<a href="http://tools.ietf.org/html/rfc2679">A One-way Delay Metric for IPPM</a>", RFC 2679, September 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2680">[RFC2680]</b></td>
<td class="top">
<a href="mailto:almes@advanced.org" title="Advanced Network &amp; Services, Inc.">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org" title="Advanced Network &amp; Services, Inc.">Kalidindi, S.</a> and <a href="mailto:matt@advanced.org" title="Advanced Network &amp; Services, Inc.">M. Zekauskas</a>, "<a href="http://tools.ietf.org/html/rfc2680">A One-way Packet Loss Metric for IPPM</a>", RFC 2680, September 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2681">[RFC2681]</b></td>
<td class="top">
<a href="mailto:almes@advanced.org" title="Advanced Network &amp; Services, Inc.">Almes, G.</a>, <a href="mailto:kalidindi@advanced.org" title="Advanced Network &amp; Services, Inc.">Kalidindi, S.</a> and <a href="mailto:matt@advanced.org" title="Advanced Network &amp; Services, Inc.">M. Zekauskas</a>, "<a href="http://tools.ietf.org/html/rfc2681">A Round-trip Delay Metric for IPPM</a>", RFC 2681, September 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3209">[RFC3209]</b></td>
<td class="top">
<a>Awduche, D.</a>, <a>Berger, L.</a>, <a>Gan, D.</a>, <a>Li, T.</a>, <a>Srinivasan, V.</a> and <a>G. Swallow</a>, "<a href="http://tools.ietf.org/html/rfc3209">RSVP-TE: Extensions to RSVP for LSP Tunnels</a>", RFC 3209, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3260">[RFC3260]</b></td>
<td class="top">
<a>Grossman, D.</a>, "<a href="http://tools.ietf.org/html/rfc3260">New Terminology and Clarifications for Diffserv</a>", RFC 3260, April 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3985">[RFC3985]</b></td>
<td class="top">
<a>Bryant, S.</a> and <a>P. Pate</a>, "<a href="http://tools.ietf.org/html/rfc3985">Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture</a>", RFC 3985, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4656">[RFC4656]</b></td>
<td class="top">
<a>Shalunov, S.</a>, <a>Teitelbaum, B.</a>, <a>Karp, A.</a>, <a>Boote, J.</a> and <a>M. Zekauskas</a>, "<a href="http://tools.ietf.org/html/rfc4656">A One-way Active Measurement Protocol (OWAMP)</a>", RFC 4656, September 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4928">[RFC4928]</b></td>
<td class="top">
<a>Swallow, G.</a>, <a>Bryant, S.</a> and <a>L. Andersson</a>, "<a href="http://tools.ietf.org/html/rfc4928">Avoiding Equal Cost Multipath Treatment in MPLS Networks</a>", BCP 128, RFC 4928, June 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5036">[RFC5036]</b></td>
<td class="top">
<a>Andersson, L.</a>, <a>Minei, I.</a> and <a>B. Thomas</a>, "<a href="http://tools.ietf.org/html/rfc5036">LDP Specification</a>", RFC 5036, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5357">[RFC5357]</b></td>
<td class="top">
<a>Hedayat, K.</a>, <a>Krzanowski, R.</a>, <a>Morton, A.</a>, <a>Yum, K.</a> and <a>J. Babiarz</a>, "<a href="http://tools.ietf.org/html/rfc5357">A Two-Way Active Measurement Protocol (TWAMP)</a>", RFC 5357, October 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5481">[RFC5481]</b></td>
<td class="top">
<a>Morton, A.</a> and <a>B. Claise</a>, "<a href="http://tools.ietf.org/html/rfc5481">Packet Delay Variation Applicability Statement</a>", RFC 5481, March 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5884">[RFC5884]</b></td>
<td class="top">
<a>Aggarwal, R.</a>, <a>Kompella, K.</a>, <a>Nadeau, T.</a> and <a>G. Swallow</a>, "<a href="http://tools.ietf.org/html/rfc5884">Bidirectional Forwarding Detection (BFD) for MPLS Label Switched Paths (LSPs)</a>", RFC 5884, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5920">[RFC5920]</b></td>
<td class="top">
<a>Fang, L.</a>, "<a href="http://tools.ietf.org/html/rfc5920">Security Framework for MPLS and GMPLS Networks</a>", RFC 5920, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5921">[RFC5921]</b></td>
<td class="top">
<a>Bocci, M.</a>, <a>Bryant, S.</a>, <a>Frost, D.</a>, <a>Levrau, L.</a> and <a>L. Berger</a>, "<a href="http://tools.ietf.org/html/rfc5921">A Framework for MPLS in Transport Networks</a>", RFC 5921, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5960">[RFC5960]</b></td>
<td class="top">
<a>Frost, D.</a>, <a>Bryant, S.</a> and <a>M. Bocci</a>, "<a href="http://tools.ietf.org/html/rfc5960">MPLS Transport Profile Data Plane Architecture</a>", RFC 5960, August 2010.</td>
</tr>
<tr>
<td class="reference"><b id="Y.1731">[Y.1731]</b></td>
<td class="top">
<a title="ITU-T Recommendation Y.1731">ITU-T Recommendation Y.1731, </a>, "<a>OAM Functions and Mechanisms for Ethernet based Networks</a>", February 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#ts_rationale" id="ts_rationale">Default Timestamp Format Rationale</a>
</h1>
<p id="rfc.section.Appendix A.p.1">This document initially proposed the Network Time Protocol (NTP) timestamp format as the mandatory default, as this is the normal default timestamp in IETF protocols and thus would seem the "natural" choice.  However a number of considerations have led instead to the specification of the truncated IEEE 1588 Precision Time Protocol (PTP) timestamp as the default.  NTP has not gained traction in industry as the protocol of choice for high quality timing infrastructure, whilst IEEE 1588 PTP has become the de facto time transfer protocol in networks which are specially engineered to provide high accuracy time distribution service.  The PTP timestamp format is also the ITU-T format of choice for packet transport networks, which may rely on MPLS protocols.  Applications such as one-way delay measurement need the best time service available, and converting between the NTP and PTP timestamp formats is not a trivial transformation, particularly when it is required that this be done in real time without loss of accuracy.</p>
<p id="rfc.section.Appendix A.p.2">The truncated IEEE 1588 PTP format specified in this document is considered to provide a more than adequate wrap time and greater time resolution than it is expected will be needed for the operational lifetime of this protocol. By truncating the timestamp at both the high and low order bits, the protocol achieves a worthwhile reduction in system resources.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dan Frost</span> 
	  <span class="n hidden">
		<span class="family-name">Frost</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:danfrost@cisco.com">danfrost@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Stewart Bryant</span> 
	  <span class="n hidden">
		<span class="family-name">Bryant</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:stbryant@cisco.com">stbryant@cisco.com</a></span>

  </address>
</div>

</body>
</html>