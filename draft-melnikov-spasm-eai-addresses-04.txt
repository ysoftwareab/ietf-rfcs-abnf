



Network Working Group                                   A. Melnikov, Ed.
Internet-Draft                                                 Isode Ltd
Intended status: Standards Track                          W. Chuang, Ed.
Expires: January 20, 2017                                   Google, Inc.
                                                           July 19, 2016


        Internationalized Email Addresses in X.509 certificates
                 draft-melnikov-spasm-eai-addresses-04

Abstract

   This document defines a new name form for inclusion in the otherName
   field of an X.509 Subject Alternative Name extension that allows a
   certificate subject to be associated with an Internationalized Email
   Address.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on January 20, 2017.

Copyright Notice

   Copyright (c) 2016 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.



Melnikov & Chuang       Expires January 20, 2017                [Page 1]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions Used in This Document . . . . . . . . . . . . . .   2
   3.  Name Definitions  . . . . . . . . . . . . . . . . . . . . . .   2
   4.  Matching of Internationalized Email Addresses in X.509
       certificates  . . . . . . . . . . . . . . . . . . . . . . . .   3
   5.  Name constraints in path validation . . . . . . . . . . . . .   4
   6.  Resource Considerations . . . . . . . . . . . . . . . . . . .   5
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   5
   8.  Security Considerations . . . . . . . . . . . . . . . . . . .   6
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   6
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .   6
     9.2.  Informative References  . . . . . . . . . . . . . . . . .   7
   Appendix A.  Acknowledgements . . . . . . . . . . . . . . . . . .   7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   7

1.  Introduction

   [RFC5280] defines rfc822Name subjectAltName choice for representing
   [RFC5322] email addresses.  This form is restricted to a subset of
   US-ASCII characters and thus can't be used to represent
   Internationalized Email addresses [RFC6531].

2.  Conventions Used in This Document

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

   The formal syntax use the Augmented Backus-Naur Form (ABNF) [RFC5234]
   notation.

3.  Name Definitions

   This section defines the smtputf8Name name as a form of otherName
   from the GeneralName structure in SubjectAltName defined in
   [RFC5280].

   id-on-smtputf8Name OBJECT IDENTIFIER ::= { id-on XXX }

   smtputf8Name ::= UTF8String (SIZE (1..MAX))

   When the subjectAltName extension contains an Internationalized Email
   address, the address MUST be stored in the smtputf8Name name form of
   otherName.  The format of smtputf8Name is defined as the ABNF rule
   smtputf8Mailbox.  smtputf8Mailbox is a modified version of the
   Internationalized Mailbox which is defined in Section 3.3 of



Melnikov & Chuang       Expires January 20, 2017                [Page 2]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


   [RFC6531] which is itself derived from SMTP Mailbox from
   Section 4.1.2 of [RFC5321].  [RFC6531] defines the following ABNF
   rules for Mailbox whose parts are modified for internationalization:
   <Local-part>, <Dot-string>, <Quoted-string>, <QcontentSMTP>,
   <Domain>, and <Atom>.  In particular <Local-part> was updated to also
   support UTF8-non-ascii.  UTF8-non-ascii is described by Section 3.1
   of [RFC6532].  Also sub-domain is extended to support U-label, as
   defined in [RFC5890]

   This document further refines Internationalized [RFC6531] Mailbox
   ABNF rules and calls this smtputf8Mailbox.  In smtputf8Mailbox, sub-
   domain that encode non-ascii characters SHALL use U-label Unicode
   native character labels and MUST NOT use A-label [RFC5890].  This
   restriction prevents having to determine which label encoding A- or
   U-label is present in the Domain.  As per Section 2.3.2.1 of
   [RFC5890], U-label use UTF-8 [RFC3629] with Normalization Form C and
   other properties specified there.  In smtputf8Mailbox, sub-domain
   that encode solely ASCII character labels SHALL use NR-LDH
   restrictions as specified by section 2.3.1 of [RFC5890].  Note that a
   smtputf8Mailbox has no phrase (such as a common name) before it, has
   no comment (text surrounded in parentheses) after it, and is not
   surrounded by "<" and ">".

   In the context of building name constraint as needed by [RFC5280],
   the smtputf8Mailbox rules are modified to allow partial productions
   to allow for additional forms required by Section 5.  Name
   constraints may specify a complete email address, host name, or
   domain.  This means that the local-part may be missing, and domain
   partially specified.

4.  Matching of Internationalized Email Addresses in X.509 certificates

   In equivalence comparison with smtputf8Name, there may be some setup
   work to enable the comparison i.e. processing of the smtputf8Name
   content or the email address that is being compared against.  The
   process for setup for comparing with smtputf8Name is split into
   domain steps and local-part steps.  The comparison form for local-
   part always is UTF-8.  The comparison form for domain depends on
   context.  While some contexts such as certificate path validation in
   [RFC5280] specify transforming to A-label, this document RECOMMENDS
   transforming to UTF-8 U-label even in place of those other
   specifications.  As more implementations natively support U-label
   domain, requiring U-label reduces conversions required, which then
   reduces likelihood of errors caused by bugs in implementation.

   Comparison of two smtputf8Name can be straightforward.  No setup work
   is needed and it can be an octet for octet comparison.  For other
   email address forms such as Internationalized email address or



Melnikov & Chuang       Expires January 20, 2017                [Page 3]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


   rfc822Name, the comparison requires additional setup to convert the
   format for comparison.  Domain setup is particularly important for
   forms that may contain A- or U-label such as International email
   address, or A-label only forms such as rfc822Name.  This document
   specifies the process to transform the domain to U-label.  (To
   convert the domain to A-label, follow the process process specified
   in section 7.5 and 7.2 in [RFC5280]) The first step is to detect
   A-label by using section 5.1 of [RFC5891].  Next if necessary,
   transform the A-label to U-label Unicode as specified in section 5.2
   of [RFC5891].  Finally if necessary convert the Unicode to UTF-8 as
   specified in section 3 of [RFC3629].  In setup for smtputf8Mailbox,
   the email address local-part MUST be converted to UTF-8 if it is not
   already.  The <Local-part> part of an Internationalized email address
   is already in UTF-8.  For the rfc822Name local-part is IA5String
   (ASCII), and conversion to UTF-8 is trivial since ASCII octets maps
   to UTF-8 without change.  Once the setup is completed, comparison is
   an octet for octet comparison.

5.  Name constraints in path validation

   This section defines use of smtputf8Name name for name constraints.
   The format for smtputf8Name in name constraints is identical to the
   use in subjectAltName as specified in Section 3 with the extension as
   noted there for partial productions.

   Constraint comparison on complete email address with smtputf8Name
   name uses the matching procedure defined by Section 4.  As with
   rfc822Name name constraints as specified in Section 4.2.1.10 of
   [RFC5280], smtputf8Name name can specify a particular mailbox, all
   addresses at a host, or all mailboxes in a domain by specifying the
   complete email address, a host name, or a domain.

   Name constraint comparisons in the context [RFC5280] is specified
   with smtputf8Name name are only done on the subjectAltName
   smtputf8Name name, and says nothing more about constaints on other
   email address forms such as rfc822Name.  Consequently it may be
   necessary to include other name constraints such as rfc822Name in
   addition to smtputf8Name to constrain all potential email addresses.
   For example a domain with both ascii and non-ascii local-part email
   addresses may require both rfc822Name and smtputf8Name name
   constraints.  This can be illustrated in the following Figure 1 which
   shows a name constraint set in the intermediate CA certificate, which
   then applies to the children entity certificates.  Note that a
   constraint on rfc822Name does not apply to smtputf8Name and vice
   versa.






Melnikov & Chuang       Expires January 20, 2017                [Page 4]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


   +-------------------------------------------------+
   | Root CA Cert                                    |
   +-------------------------------------------------+
                         |
                         v
   +-------------------------------------------------+
   | Intermediate CA Cert                            |
   |   Name Constraint Extension                     |
   |     Permitted                                   |
   |       rfc822Name: allowed.com                   |
   |       smtputf8Name: allowed.com                 |
   |       rfc822Name: ignored.com                   |
   +-------------------------------------------------+
                         |   |
                         v   |
   +-------------------------------------------------+
   | Entity Cert (w/explicitly permitted subjects)   |
   |   SubjectAltName Extension                      |
   |     rfc822Name: student@allowed.com             |
   |     smtputf8Name: \u8001\u5E2B@allowed.com      |
   +-------------------------------------------------+
                             |
                             v
   +-------------------------------------------------+
   | Entity Cert (w/permitted subject b/c undefined) |
   |   SubjectAltName Extension                      |
   |     smtputf8Name: \u4E0D\u5C0D@ignored.com      |
   +-------------------------------------------------+

                                 Figure 1

6.  Resource Considerations

   For email addresses whose local-part is ASCII it may be more
   reasonable to continue using rfc822Name instead of smtputf8Name.  Use
   of smtputf8Name incurs higher byte representation overhead due to
   encoding with otherName and the additional OID needed.  This document
   RECOMMENDS using smtputf8Name when local-part contains non-ASCII
   characters, and otherwise rfc822Name.

7.  IANA Considerations

   [[CREF1: Just need a new OID.]]








Melnikov & Chuang       Expires January 20, 2017                [Page 5]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


8.  Security Considerations

   Use for smtputf8Name for certificate subjectAltName will incur many
   of the same security considerations of Section 8 in [RFC5280] but
   further complicated by permitting non-ASCII characters in the email
   address local-part.  As mentioned in Section 4.4 of [RFC5890] and in
   Section 4 of [RFC6532]  Unicode introduces the risk for visually
   similar characters which can be exploited to deceive the recipient.
   The former document references some means to mitigate against these
   attacks.

9.  References

9.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC3629]  Yergeau, F., "UTF-8, a transformation format of ISO
              10646", STD 63, RFC 3629, DOI 10.17487/RFC3629, November
              2003, <http://www.rfc-editor.org/info/rfc3629>.

   [RFC5234]  Crocker, D., Ed. and P. Overell, "Augmented BNF for Syntax
              Specifications: ABNF", STD 68, RFC 5234,
              DOI 10.17487/RFC5234, January 2008,
              <http://www.rfc-editor.org/info/rfc5234>.

   [RFC5280]  Cooper, D., Santesson, S., Farrell, S., Boeyen, S.,
              Housley, R., and W. Polk, "Internet X.509 Public Key
              Infrastructure Certificate and Certificate Revocation List
              (CRL) Profile", RFC 5280, DOI 10.17487/RFC5280, May 2008,
              <http://www.rfc-editor.org/info/rfc5280>.

   [RFC5321]  Klensin, J., "Simple Mail Transfer Protocol", RFC 5321,
              DOI 10.17487/RFC5321, October 2008,
              <http://www.rfc-editor.org/info/rfc5321>.

   [RFC5890]  Klensin, J., "Internationalized Domain Names for
              Applications (IDNA): Definitions and Document Framework",
              RFC 5890, DOI 10.17487/RFC5890, August 2010,
              <http://www.rfc-editor.org/info/rfc5890>.

   [RFC5891]  Klensin, J., "Internationalized Domain Names in
              Applications (IDNA): Protocol", RFC 5891,
              DOI 10.17487/RFC5891, August 2010,
              <http://www.rfc-editor.org/info/rfc5891>.



Melnikov & Chuang       Expires January 20, 2017                [Page 6]

Internet-Draft  I18N Mail Addresses in X.509 certificates      July 2016


   [RFC6531]  Yao, J. and W. Mao, "SMTP Extension for Internationalized
              Email", RFC 6531, DOI 10.17487/RFC6531, February 2012,
              <http://www.rfc-editor.org/info/rfc6531>.

   [RFC6532]  Yang, A., Steele, S., and N. Freed, "Internationalized
              Email Headers", RFC 6532, DOI 10.17487/RFC6532, February
              2012, <http://www.rfc-editor.org/info/rfc6532>.

9.2.  Informative References

   [RFC5322]  Resnick, P., Ed., "Internet Message Format", RFC 5322,
              DOI 10.17487/RFC5322, October 2008,
              <http://www.rfc-editor.org/info/rfc5322>.

Appendix A.  Acknowledgements

   Thank you to Magnus Nystrom for motivating this document.  Thanks to
   Nicolas Lidzborski, Laetitia Baudoin, Ryan Sleevi and Sean Leonard
   for their early feedback.  Also thanks to John Klensin for his
   valuable input on internationalization, Unicode and ABNF formatting.

Authors' Addresses

   Alexey Melnikov (editor)
   Isode Ltd
   14 Castle Mews
   Hampton, Middlesex  TW12 2NP
   UK

   Email: Alexey.Melnikov@isode.com


   Weihaw Chuang (editor)
   Google, Inc.
   1600 Amphitheatre Parkway
   Mountain View, CA  94043
   US

   Email: weihaw@google.com












Melnikov & Chuang       Expires January 20, 2017                [Page 7]
