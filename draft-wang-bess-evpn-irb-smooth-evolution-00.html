<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Smooth Evolution of Existing EVPN IRB Network</title>
<meta content="Yubao Wang" name="author">
<meta content="
       EVPN IRB has been deployed following  's early draft for a long time. 
 This draft discusses how can these existing deployments smoothly evolved into an IP-aliasing ( ) enhanced EVPN symmetric IRB scenario,
 especially when two of an IP-VRF's BDs (whose IRB interfaces are attached to the same IP-VRF) have been attched to a common ES before that network evolution.
 In such case, when these two BDs are evolved into IP-aliasing enhanced EVPN symmetric IRB as per  
 or distributed Bump-in-the-wire as per  ,
 the IP A-D per EVI routes of these two BDs may conflict with each other in the context of the IP-VRF instance.
       
    " name="description">
<meta content="xml2rfc 3.11.1" name="generator">
<meta content="EVPN, Ethernet Tag, ET-ID, ESI, IP aliasing, symmetric IRB, evolution, Bump-in-the-wire" name="keyword">
<meta content="draft-wang-bess-evpn-irb-smooth-evolution-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.11.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.4
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 59.1.1
    six 1.16.0
-->
<link href="/tmp/draft-wang-bess-evpn-irb-smooth-evolution-00-jw2dqido.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EVPN IRB Evolution</td>
<td class="right">November 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Wang</td>
<td class="center">Expires 24 May 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS WG</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-11-20" class="published">20 November 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-05-24">24 May 2022</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Wang</div>
<div class="org">ZTE Corporation</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Smooth Evolution of Existing EVPN IRB Network</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">EVPN IRB has been deployed following <span>[<a href="#RFC9135" class="xref">RFC9135</a>]</span>'s early draft for a long time. 
 This draft discusses how can these existing deployments smoothly evolved into an IP-aliasing (<span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>) enhanced EVPN symmetric IRB scenario,
 especially when two of an IP-VRF's BDs (whose IRB interfaces are attached to the same IP-VRF) have been attched to a common ES before that network evolution.
 In such case, when these two BDs are evolved into IP-aliasing enhanced EVPN symmetric IRB as per <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>
 or distributed Bump-in-the-wire as per <span>[<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>,
 the IP A-D per EVI routes of these two BDs may conflict with each other in the context of the IP-VRF instance.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 24 May 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-terminology-and-acronyms" class="xref">Terminology and Acronyms</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-problem-statement" class="xref">Problem Statement</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-muti-irb-use-case-vs-mono-i" class="xref">Muti-IRB Use Case vs Mono-IRB Use Case</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-problem-with-ip-aliasing-en" class="xref">Problem with IP-aliasing-enabled Multi-IRB Use Case</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-when-ip-aliasing-is-enabled" class="xref">When IP-aliasing is enabled for a multi-IRB Use Case</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-when-an-ip-aliasing-enabled" class="xref">When an IP-aliasing-enabled mono-IRB evolves into multi-IRB</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-when-distributed-bump-in-th" class="xref">When distributed Bump-in-the-wire is enabled for a multi-IRB use case</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-solutions" class="xref">Solutions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-determining-the-aliasing-pa" class="xref">Determining the Aliasing Pathes for RT-2R</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-aci-specific-overlay-index-" class="xref">ACI-specific Overlay Index Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-arp-nd-synching-and-ip-alia" class="xref">ARP/ND Synching and IP Aliasing</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-constructing-mac-ip-adverti" class="xref">Constructing MAC/IP Advertisement Route</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.2">
                    <p id="section-toc.1-1.3.2.3.2.2.1"><a href="#section-3.3.2" class="xref">3.3.2</a>.  <a href="#name-constructing-ip-a-d-per-evi" class="xref">Constructing IP A-D per EVI Route</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-secenario-specific-procedur" class="xref">Secenario-Specific Procedures</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.1">
                    <p id="section-toc.1-1.3.2.4.2.1.1"><a href="#section-3.4.1" class="xref">3.4.1</a>.  <a href="#name-evpn-irb-specific-procedure" class="xref">EVPN-IRB Specific Procedures</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4.2.2">
                    <p id="section-toc.1-1.3.2.4.2.2.1"><a href="#section-3.4.2" class="xref">3.4.2</a>.  <a href="#name-bump-in-the-wire-specific-p" class="xref">Bump-in-the-wire Specific Procedures</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Introduce">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">In <span><a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-03#section-3.1" class="relref">Section 3.1</a> of [<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>, 
 the IP A-D per EVI routes are defined in order to provide the IP aliasing capabilities for EVPN symmetric IRB.
 In <a href="#sect-multi-irb-usecase" class="xref">Section 2.1</a> we discussed the multi-IRB use case 
 and why the original IP A-D per EVI routes can not be used 
 when we want the overlay network of that use case 
 to be smoothly evoluted to an IP-aliasing-enhanced EVPN symmetric IRB network.
 Then we discussed how the smooth evolution can be provided using the SOI-specific ethernet auto-discovery mode of <span>[<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
   This draft improves the network evolution of a style of overlay network with EVPN IRB deployments, 
   where two BDs behind different IRB interfaces of the same IP-VRF have been attched to a common ES before that network evolution.
   This style of EVPN IRB use case are called as multi-IRB use case in this draft.
   That overlay network is a existing symmetric EVPN IRB service. 
   Before the evolution, it will be a normal symmetric EVPN IRB per <span>[<a href="#RFC9135" class="xref">RFC9135</a>]</span>,
   But after the evolution, it should be assigned with the IP aliasing capabilities as per <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.
   But the IP A-D per EVI route of <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> can't satisfy the network management requirements of smooth resolution.
   This draft discribes a smooth evolution mechanism using the SOI-specific ethernet auto-discovery mode of <span>[<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-terminology-and-acronyms">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-terminology-and-acronyms" class="section-name selfRef">Terminology and Acronyms</a>
        </h3>
<p id="section-1.1-1">
  Most of the acronyms and terms used in this documents comes from <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, <span>[<a href="#I-D.wang-bess-evpn-arp-nd-synch-without-irb" class="xref">I-D.wang-bess-evpn-arp-nd-synch-without-irb</a>]</span>
   and <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> except for the following:<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-1.1-2">
          <dt id="section-1.1-2.1">* VRF AC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.2">
            <p style="margin-left: 2.0em" id="section-1.1-2.2.1">An Attachment Circuit (AC) that attaches a CE to an IP-VRF but is
   not an IRB interface.<a href="#section-1.1-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.3">* VRF Interface -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.4">
            <p style="margin-left: 2.0em" id="section-1.1-2.4.1"> An IRB interface or a VRF-AC or an IRC interface. Note that a VRF interface will be bound to the routing space of an IP-VRF.<a href="#section-1.1-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.5">* L3 EVI -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.6">
            <p style="margin-left: 2.0em" id="section-1.1-2.6.1"> An EVPN instance spanning the Provider Edge (PE) devices
   participating in that EVPN which contains VRF ACs and maybe
   contains IRB interfaces or IRC interfaces.<a href="#section-1.1-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.7">* Ethernet A-D per EVI -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.8">
            <p style="margin-left: 2.0em" id="section-1.1-2.8.1"> An Ethernet Auto-Discovery route per EVI whose EVI is an MAC-VRF
   as per <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span> and <span>[<a href="#RFC9135" class="xref">RFC9135</a>]</span>. 
   The route-targets of an Ethernet A-D per EVI route are determined by the MAC-VRF for which they are advertised.<a href="#section-1.1-2.8.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.9">* IP A-D per EVI -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.10">
            <p style="margin-left: 2.0em" id="section-1.1-2.10.1"> An ethernet Auto-Discovery route per EVI whose EVI is an IP-VRF. 
   Note that the Ethernet Tag ID of an IP A-D per EVI route MUST be zero as per <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.<a href="#section-1.1-2.10.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.11">* IP A-D per ES -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.12">
            <p style="margin-left: 2.0em" id="section-1.1-2.12.1">Ethernet Auto-Discovery route per ES, and the EVI for one of its route targets is an IP-VRF.<a href="#section-1.1-2.12.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.13">* RMAC -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.14">
            <p style="margin-left: 2.0em" id="section-1.1-2.14.1">Router's MAC, which is signaled in the Router's MAC extended community.<a href="#section-1.1-2.14.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.15">* ESI Overlay Index -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.16">
            <p style="margin-left: 2.0em" id="section-1.1-2.16.1">ESI as overlay index.<a href="#section-1.1-2.16.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.17">* ET-ID -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.18">
            <p style="margin-left: 2.0em" id="section-1.1-2.18.1">Ethernet Tag ID, it is also called ETI for short in this document.<a href="#section-1.1-2.18.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.19">* RT-2R -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.20">
            <p style="margin-left: 2.0em" id="section-1.1-2.20.1">When a MAC/IP Advertisement Route whose ESI is not zero is used for IP-VRF forwarding, it is called as a RT-2R in this draft.
   When it is used for MAC-VRF forwarding, it is not called as a RT-2R in this draft.<a href="#section-1.1-2.20.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.21">* ETI-Agnostic BD -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.22">
            <p style="margin-left: 2.0em" id="section-1.1-2.22.1">A Broadcast Domain (BD) whose data packets can be received along with any Ethernet Tag ID (ETI).
   Note that a broadcast domain of an L2 EVI of VLAN-aware bundle service interface is a good example of an ETI-Specific BD.<a href="#section-1.1-2.22.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.23">* ETI-Specific BD -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.24">
            <p style="margin-left: 2.0em" id="section-1.1-2.24.1">A Broadcast Domain (BD) whose data packets are expected to be received along with a normalized Ethernet Tag ID (ETI).
   Note that a broadcast domain of an L2 EVI of VLAN-bundle or VLAN-based service interface is a good example of an ETI-Agnostic BD.<a href="#section-1.1-2.24.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.25">* BDI-Specific EADR -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.26">
            <p style="margin-left: 2.0em" id="section-1.1-2.26.1">When the &lt;ESI, BD&gt; uses BDI-Specific Ethernet Auto-discovery mode,
   the only Ethernet A-D per EVI route of that &lt;ESI, BD&gt; is called as a BDI-Specific EADR in this draft.
   When the AC-type is N:1 mapping,
     and only a single Ethernet A-D per EVI route is advertised for that
     &lt;ESI, BD&gt;, we say that the &lt;ESI, BD&gt; uses BDI-Specific Ethernet
     Auto-discovery mode, and that Ethernet A-D per EVI route is called
     as a BDI-Specific EADR (Ethernet A-D per EVI Route) in this draft.<a href="#section-1.1-2.26.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-1.1-2.27">* SOI-Specific EADR -</dt>
          <dd style="margin-left: 1.0em" id="section-1.1-2.28">
            <p style="margin-left: 2.0em" id="section-1.1-2.28.1">When the &lt;ESI, BD&gt; uses SOI-specific ethernet auto-discovery mode,
   the Ethernet A-D per EVI routes of that &lt;ESI, BD&gt; are called as SOI-Specific EADRs in this draft. 
     When the AC-type is N:1 mapping,
     and individual Ethernet A-D per EVI routes are advertised per each
     VLAN of that &lt;ESI, BD&gt;, we say that the &lt;ESI, BD&gt; uses SOI-Specific
     Ethernet Auto-discovery mode, and each of such Ethernet A-D per EVI
     route is called as a SOI-Specific EADR (Ethernet A-D per EVI Route)
     in this draft.<a href="#section-1.1-2.28.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</section>
</div>
<div id="sect-problem-req">
<section id="section-2">
      <h2 id="name-problem-statement">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-problem-statement" class="section-name selfRef">Problem Statement</a>
      </h2>
<div id="sect-multi-irb-usecase">
<section id="section-2.1">
        <h3 id="name-muti-irb-use-case-vs-mono-i">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-muti-irb-use-case-vs-mono-i" class="section-name selfRef">Muti-IRB Use Case vs Mono-IRB Use Case</a>
        </h3>
<p id="section-2.1-1">The detailed explanation of this network's physical links 
   are described in <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#appendix-A" class="relref">Appendix A</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.
   But the network's EVCs (Ethernet Virtual Connections, which are typically established per &lt;Port, VLAN&gt; basis)
   is illustrated in the following sections per each Service Interface.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">The BD-10 here is the VPNx of <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#appendix-A" class="relref">Appendix A</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>, 
   and the BD-20 is the VPNy of <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03#appendix-A" class="relref">Appendix A</a> of [<a href="#I-D.wang-bess-evpn-ether-tag-id-usage" class="xref">I-D.wang-bess-evpn-ether-tag-id-usage</a>]</span>.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<span id="name-ethernet-a-d-per-evi-of-mul"></span><div id="Fig-Multi-IRB">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-3.1">
<pre>
  PNEC1                         PE1
+------------+           +----------------+ EAD_PE1_20
|            |           |  __(BD-20)     | ------------&gt;
| H4      "  |        P1 | /      \ IRB21 |
| |       #================   (IP-VRF)    +-----------------+
| N1______"  |   ESI21   | \__    / IRB11 |                 |
|    10.2 "  |     +     |    (BD-10)     |                 |  PE3
|         "  |     |     +----------------+             +---+----+
|         "  |     |                                    |        |
|         "  |     |                                    |(IP-VRF)+-+H3
|         "  |     |            PE2                     |        |
| N2______"  |     |     +----------------+ EAD_PE2_10  +---+----+
|    20.2 "  |     +     |  __(BD-10)     | ------------&gt;   |
|         "  |   ESI21   | /      \ IRB12 |                 |
|         #================   (IP-VRF)    +-----------------+
|         "  |        P2 | \__    / IRB22 |
|            |           |    (BD-20)     |
+------------+           +----------------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-ethernet-a-d-per-evi-of-mul" class="selfRef">Ethernet A-D per EVI of Multi-IRB</a>
          </figcaption></figure>
</div>
<p id="section-2.1-4">
   BD-10 and BD-20 are both BDs (broadcast domains) whose IRB interfaces are attached to the same IP-VRF.
   The anycast IP address of IRB11 and IRB12 is 10.9, and the anycast IP address of IRB21 and IRB22 is 20.9.
   BD-10 and BD-20 are integrated into the same IP-VRF by IRB11, IRB12, IRB21 and IRB22.
   As a result of that, N1, IRB11 and IRB12 are of subnet SN1, 
   and N2, IRB21 and IRB22 are of subnet SN2.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2.1-5">
          <dt id="section-2.1-5.1">Multi-IRB Use Case -</dt>
          <dd style="margin-left: 1.0em" id="section-2.1-5.2">
            <p style="margin-left: 2.0em" id="section-2.1-5.2.1">Above network are called as a multi-IRB use case for &lt;ESI21,that IP-VRF&gt; in this draft.
 Because two IRB interfaces of ES21's BDs (which are both attached to ESI21) have been attched to a common IP-VRF.<a href="#section-2.1-5.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-2.1-5.3">Mono-IRB Use Case -</dt>
          <dd style="margin-left: 1.0em" id="section-2.1-5.4">
            <p style="margin-left: 2.0em" id="section-2.1-5.4.1">Now imagine that the BD-20 of above network has not been deployed, 
 so there is only one of ESI21's BDs in the IP-VRF's context.
 In such case, we can say that this is a mono-IRB use case for &lt;ESI21,that IP-VRF&gt;.<a href="#section-2.1-5.4.1" class="pilcrow">¶</a></p>
<p style="margin-left: 2.0em" id="section-2.1-5.4.2">Note that when an IP-aliasing-enabled mono-IRB use case for &lt;ESI21,that IP-VRF&gt; 
 is evolved into a multi-IRB use case for &lt;ESI21,that IP-VRF&gt;,
 there may be some issues to be deal with. 
 that's why<a href="#section-2.1-5.4.2" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-2.1-6">Note that IRB11 and IRB12 are IRB interfaces of BD-10 where BD-10 is a Broadcast Domain of VLAN-based Service Interface.
   IRB21 and IRB22 are IRB interfaces of BD-20 where BD-20 is also a Broadcast Domain of VLAN-based Service Interface.<a href="#section-2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT1-Confliction">
<section id="section-2.2">
        <h3 id="name-problem-with-ip-aliasing-en">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-problem-with-ip-aliasing-en" class="section-name selfRef">Problem with IP-aliasing-enabled Multi-IRB Use Case</a>
        </h3>
<div id="sect-RT1-Confliction-a">
<section id="section-2.2.1">
          <h4 id="name-when-ip-aliasing-is-enabled">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-when-ip-aliasing-is-enabled" class="section-name selfRef">When IP-aliasing is enabled for a multi-IRB Use Case</a>
          </h4>
<span id="name-ip-aliasing-enabled-multi-i"></span><div id="Fig-Multi-IRB-IP-aliasing">
<figure id="figure-2">
            <div class="alignLeft art-text artwork" id="section-2.2.1-1.1">
<pre>
  PNEC1                         PE1
+------------+           +----------------+ IPAD_PE1_20
|            |           |  __(BD-20)     | ------------&gt;
| H4      "  |        P1 | /      \ IRB21 |
| |       #================   (IP-VRF)    +-----------------+
| N1______"  |   ESI21   | \__    / IRB11 |                 |
|    10.2 "  |     +     |    (BD-10)     |                 |  PE3
|         "  |     |     +----------------+             +---+----+
|         "  |     |                                    |        |
|         "  |     |                                    |(IP-VRF)+-+H3
|         "  |     |            PE2                     |        |
| N2______"  |     |     +----------------+ IPAD_PE2_10 +---+----+
|    20.2 "  |     +     |  __(BD-10)     | ------------&gt;   |
|         "  |   ESI21   | /      \ IRB12 |                 |
|         #================   (IP-VRF)    +-----------------+
|         "  |        P2 | \__    / IRB22 |
|            |           |    (BD-20)     |
+------------+           +----------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-ip-aliasing-enabled-multi-i" class="selfRef">IP-aliasing Enabled Multi-IRB Use Case</a>
            </figcaption></figure>
</div>
<p id="section-2.2.1-2">As an existing network, the attachment circuits are not configured with any virtual ESes. 
   Now this network want to be enhanced with IP-aliasing features of <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1-3">According to <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>, 
 the IP A-D per EVI routes R1_110, R1_120, R1_210, R1_220 for P1.1, P1.2, P2.1 and P2.2 will all have zero Ethernet Tag IDs.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">When PE3 receives R1_110 and R1_120, it will pick up only one of them to be installed to the data plane.
   We assume that the R1_120 is picked out.
   When PE3 receives R1_210 and R1_220, it will pick up only one of them to be installed to the data plane.
   We assume that the R1_220 is picked out.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
<p id="section-2.2.1-5">Although PE1 will advertise a RT-2 Route R2_N1 (whose ESI is ESI21, IP is 10.2) to PE3,
   When H3 send data packet DP_H3_N1 to N1 after P1.1 fails, 
   PE3 may still send DP_H3_N1 to PE1 because that PE3 will load-balance traffics just fllowing R1_120 and R1_220.
   That's a problem that will cause packet-drop or traffic-bypassing.<a href="#section-2.2.1-5" class="pilcrow">¶</a></p>
<p id="section-2.2.1-6">The solution for this problem is decribed in <a href="#sect-IRB-specific" class="xref">Section 3.4.1</a>.<a href="#section-2.2.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT1-Confliction-b">
<section id="section-2.2.2">
          <h4 id="name-when-an-ip-aliasing-enabled">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-when-an-ip-aliasing-enabled" class="section-name selfRef">When an IP-aliasing-enabled mono-IRB evolves into multi-IRB</a>
          </h4>
<p id="section-2.2.2-1">Before IP-aliasing is enabled, it is safe for a mono-IRB use case to evolve into a multi-IRB use case.
   But after IP-aliasing is enabled, it may be dangerous for a mono-IRB use case to evolve into a multi-IRB use case,
   if not all L2 ACs are configured as separated virtual ESIs before that evolution.
   Because the RT-1 per EVI confliction which is described in the above section.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">When it is still a mono-IRB use case, 
   there is no motivation for it to be deployed with 
   all its L2 ACs being previously configured as separated vESIs.
   Because that virtual ESIs are not so efficient in the following aspects:<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.2.2-3.1">Increased RT-4 routes.<a href="#section-2.2.2-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.2-3.2">Mass-withdraw capability is disabled.<a href="#section-2.2.2-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.2-3.3">Service Carving is complicated<a href="#section-2.2.2-3.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.2.2-3.4">ES management and configuration are complicated.<a href="#section-2.2.2-3.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.2.2-4">Because of these reasons, per-AC virtual ESIs is not widely used in normal mono-IRB use case or normal multi-IRB use case as per <span><a href="https://rfc-editor.org/rfc/rfc9135#section-5" class="relref">Section 5</a> of [<a href="#RFC9135" class="xref">RFC9135</a>]</span>.<a href="#section-2.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-RT1-Confliction-c">
<section id="section-2.2.3">
          <h4 id="name-when-distributed-bump-in-th">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-when-distributed-bump-in-th" class="section-name selfRef">When distributed Bump-in-the-wire is enabled for a multi-IRB use case</a>
          </h4>
<p id="section-2.2.3-1">When distributed Bump-in-the-wire is enabled for a multi-IRB use case, 
   the similar problem will occur with that multi-IRB use case.
   This is discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-distributed-bump-in-the-wire-01#section-2.2" class="relref">Section 2.2</a> of [<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sect-Solution">
<section id="section-3">
      <h2 id="name-solutions">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-solutions" class="section-name selfRef">Solutions</a>
      </h2>
<p id="section-3-1">Note that the PEs follow <span>[<a href="#I-D.wang-bess-evpn-arp-nd-synch-without-irb" class="xref">I-D.wang-bess-evpn-arp-nd-synch-without-irb</a>]</span> to
   achieve the ESI load balance except for the following explicit discription.<a href="#section-3-1" class="pilcrow">¶</a></p>
<div id="sect-5">
<section id="section-3.1">
        <h3 id="name-determining-the-aliasing-pa">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-determining-the-aliasing-pa" class="section-name selfRef">Determining the Aliasing Pathes for RT-2R</a>
        </h3>
<p id="section-3.1-1">When PE3 forward a data packet DP_2021 according to
   an RT-2R route RT2R_2021 whose SOI extended community is not absent,
   If the SOI of RT2R_2021 is a non-reserved ET-ID,
   DP_2021 should not be forwarded according to an ethernet A-D per EVI route IPAD_2021, 
   unless the ET-ID of IPAD_2021 are the same as the SOI of RT2R_2021, 
   and the ESI of IPAD_2021 are the same as the ESI of RT2R_2021.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">
   Note that in <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> the IP A-D per EVI route carries a "Router's MAC" extended community
   in case the RMAC is not the same among different PEs.
   In these cases, the inner destination MAC of the corresponding data packets from PE3 to PE1/PE2 must use the RMAC in IP A-D per EVI route instead, 
   even if there is a RMAC in RT-2R route.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3">When selecting corresponding IP A-D per EVI routes for a RT-2R route,
 the SOI Extended Community (if it exists) of the RT-2R route MUST be used.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-3.1-4">
          <dt id="section-3.1-4.1">* Using SOI to select SOI-Specific EADRs -</dt>
          <dd style="margin-left: 1.0em" id="section-3.1-4.2">
            <p id="section-3.1-4.2.1">In this case, the IP A-D per EVI routes corresponding to that RT-2R route 
    should be selected in the context of the IP-VRF.<a href="#section-3.1-4.2.1" class="pilcrow">¶</a></p>
<p id="section-3.1-4.2.2">There may be multiple Ethernet A-D per EVI routes which all can match the RT-2R's ESI.
    In such case, The Ethernet A-D per EVI routes whose ET-ID are the same as the RT-2R's SOI should be selected.<a href="#section-3.1-4.2.2" class="pilcrow">¶</a></p>
<p id="section-3.1-4.2.3">Note that when the RT-2R's SOI is Y, the ET-IDs of the selected Ethernet A-D per EVI routes (of that RT-2R) should be all Y.<a href="#section-3.1-4.2.3" class="pilcrow">¶</a></p>
<p id="section-3.1-4.2.4">Note that when the RT-2R's ET-ID is not 0, and an SOI is advertised along with the RT-2R,
    the IP A-D per EVI routes of that RT-2R should be selected according to the &lt;ESI,SOI&gt;,
    not according to the &lt;ESI, ET-ID=0&gt;.<a href="#section-3.1-4.2.4" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
<p id="section-3.1-5">Note that In EVPN IRB use case, the non-zero ET-ID of a RT-2R (when it is used in IP-VRF context) 
 is not used to select the corresponding IP A-D per EVI 
 routes (whose ET-ID will always be zero according to <span><a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-03#section-2.1" class="relref">Section 2.1</a> of [<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>) of that RT-2R route.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-SOI-EC">
<section id="section-3.2">
        <h3 id="name-aci-specific-overlay-index-">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-aci-specific-overlay-index-" class="section-name selfRef">ACI-specific Overlay Index Extended Community</a>
        </h3>
<p id="section-3.2-1">A new EVPN BGP Extended Community called Supplementary Overlay Index is
   introduced <span>[<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.  
   This new extended community is used together with ACI-specific ethernet auto-discovery specified in <span>[<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">In this draft it is used to make a deployed multi-IRB to be smoothly evoluted to ip-aliasing features.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-2">
<section id="section-3.3">
        <h3 id="name-arp-nd-synching-and-ip-alia">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-arp-nd-synching-and-ip-alia" class="section-name selfRef">ARP/ND Synching and IP Aliasing</a>
        </h3>
<div id="sect-2.1">
<section id="section-3.3.1">
          <h4 id="name-constructing-mac-ip-adverti">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-constructing-mac-ip-adverti" class="section-name selfRef">Constructing MAC/IP Advertisement Route</a>
          </h4>
<p id="section-3.3.1-1">
   This draft introduces a new usage/construction of MAC/IP
   Advertisement route to enable Aliasing for IP addresses in symmetric EVPN IRB use-cases.  The usage/construction of this route remains similar
   to that described in <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> with a few notable exceptions as below.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.1-2.1">
   The Ethernet Tag ID should be set to 0 according to <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.<a href="#section-3.3.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.3.1-2.2">
              <p id="section-3.3.1-2.2.1">The value of SOI Extended Communinty should be set to the SOI of the L2 AC over which the ARP entry of the RT-2R is learnt.<a href="#section-3.3.1-2.2.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.2.2">Note that when the SOI Extended Communinty is carried along with a RT-2R route, the &lt;ESI, SOI&gt; will be used to select IP A-D per EVI routes by PE3,
 and the selected IP A-D per EVI routes are used to determine the aliasing pathes of this RT-2 route.
 But if the SOI Extended Communinty is absent, 
 the aliasing pathes of this RT-2R route will be determined by &lt;ESI, ET-ID=0&gt; as per <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.<a href="#section-3.3.1-2.2.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-2.3">
              <p id="section-3.3.1-2.3.1">In EVPN IRB, The ESI SHOULD be set to the ESI of the L2 AC from which
   the ARP entry is snooped as per <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span>.<a href="#section-3.3.1-2.3.1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2.3.2">
   Note that on PE3, the &lt;ESI,SOI&gt; is only used to load
   balance traffics.<a href="#section-3.3.1-2.3.2" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-3.3.1-2.4">
   The RMAC Extended Community attribute SHOULD be carried in VXLAN EVPN.
   This follows <span>[<a href="#RFC9135" class="xref">RFC9135</a>]</span>.<a href="#section-3.3.1-2.4" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="sect-2.2">
<section id="section-3.3.2">
          <h4 id="name-constructing-ip-a-d-per-evi">
<a href="#section-3.3.2" class="section-number selfRef">3.3.2. </a><a href="#name-constructing-ip-a-d-per-evi" class="section-name selfRef">Constructing IP A-D per EVI Route</a>
          </h4>
<p id="section-3.3.2-1">
   The usage/construction of this route is similar to the IP A-D per EVI route
   described in <span>[<a href="#I-D.sajassi-bess-evpn-ip-aliasing" class="xref">I-D.sajassi-bess-evpn-ip-aliasing</a>]</span> with a few notable
   exceptions as below.<a href="#section-3.3.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.3.2-2.1">
   The Ethernet Tag ID (ET-ID) should be set to the SOI of the L2 AC for which it is advertised.<a href="#section-3.3.2-2.1" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.3.2-3">Note that the normal Ethernet A-D per EVI routes for BDs are not influenced. 
   And the SOI Extended Community will be advertised along with the RT-2R routes which are learnt over that L2 AC.<a href="#section-3.3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="sect-Secenes-Specific">
<section id="section-3.4">
        <h3 id="name-secenario-specific-procedur">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-secenario-specific-procedur" class="section-name selfRef">Secenario-Specific Procedures</a>
        </h3>
<div id="sect-IRB-specific">
<section id="section-3.4.1">
          <h4 id="name-evpn-irb-specific-procedure">
<a href="#section-3.4.1" class="section-number selfRef">3.4.1. </a><a href="#name-evpn-irb-specific-procedure" class="section-name selfRef">EVPN-IRB Specific Procedures</a>
          </h4>
<p id="section-3.4.1-1">PE1 may advertise two Ethernet A-D per EVI routes for subinterface P1.1, 
 one (say R1_110b) is for BD-10 (which is of VLAN-based service interface), the other (that R1_110) is for IP-VRF.
 The Ethernet Tag ID of R1_110b is zero per <span>[<a href="#RFC7432" class="xref">RFC7432</a>]</span>, 
 but the Ethernet Tag ID of R1_110 is set to the VLANs of P1.1 according to this draft.<a href="#section-3.4.1-1" class="pilcrow">¶</a></p>
<p id="section-3.4.1-2">When PE1 advertise a RT-2R Route for a host (10.0.0.2) behind BD-10, 
 the Ethernet Tag ID of that RT-2R Route is determined 
 by the out-interface (P1.1) of the MAC of that host's ARP entry.
 If the MAC is learnt from an ETI-specific BD, 
 the ET-ID of the RT-2R route should be set to the BD-ID is that ETI-Specific BD.
 But the ET-ID of the RT-2R route is not used to select the corresponding IP A-D per EVI routes.<a href="#section-3.4.1-2" class="pilcrow">¶</a></p>
<p id="section-3.4.1-3">Note that R1_110b will not be imported into the IP-VRF.<a href="#section-3.4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-BumpWire-specific">
<section id="section-3.4.2">
          <h4 id="name-bump-in-the-wire-specific-p">
<a href="#section-3.4.2" class="section-number selfRef">3.4.2. </a><a href="#name-bump-in-the-wire-specific-p" class="section-name selfRef">Bump-in-the-wire Specific Procedures</a>
          </h4>
<p id="section-3.4.2-1">It is discussed in <span><a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-distributed-bump-in-the-wire-01#section-3.2" class="relref">Section 3.2</a> of [<a href="#I-D.wang-bess-evpn-distributed-bump-in-the-wire" class="xref">I-D.wang-bess-evpn-distributed-bump-in-the-wire</a>]</span>.<a href="#section-3.4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="sect-IANA">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-4-1">TBD.<a href="#section-4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sect-security">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">TBD.<a href="#section-5-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-6">
      <h2 id="name-references">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-6.1">
        <h3 id="name-normative-references">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.sajassi-bess-evpn-ip-aliasing">[I-D.sajassi-bess-evpn-ip-aliasing]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Badoni, G.</span>, <span class="refAuthor">Warade, P.</span>, <span class="refAuthor">Pasupula, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"EVPN Support for L3 Fast Convergence and Aliasing/Backup Path"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sajassi-bess-evpn-ip-aliasing-03</span>, <time datetime="2021-10-25" class="refDate">25 October 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-03">https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ip-aliasing-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wang-bess-evpn-distributed-bump-in-the-wire">[I-D.wang-bess-evpn-distributed-bump-in-the-wire]</dt>
        <dd>
<span class="refAuthor">Wang, Y.</span> and <span class="refAuthor">Q. Niu</span>, <span class="refTitle">"Distributed Bump-in-the-wire Use Case"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wang-bess-evpn-distributed-bump-in-the-wire-01</span>, <time datetime="2021-10-24" class="refDate">24 October 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-distributed-bump-in-the-wire-01">https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-distributed-bump-in-the-wire-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8365">[RFC8365]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Drake, J., Ed.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Shekhar, R.</span>, <span class="refAuthor">Uttaro, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 8365</span>, <span class="seriesInfo">DOI 10.17487/RFC8365</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8365">https://www.rfc-editor.org/info/rfc8365</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9135">[RFC9135]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Salam, S.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"Integrated Routing and Bridging in Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 9135</span>, <span class="seriesInfo">DOI 10.17487/RFC9135</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9135">https://www.rfc-editor.org/info/rfc9135</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC9136">[RFC9136]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Henderickx, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Lin, W.</span>, and <span class="refAuthor">A. Sajassi</span>, <span class="refTitle">"IP Prefix Advertisement in Ethernet VPN (EVPN)"</span>, <span class="seriesInfo">RFC 9136</span>, <span class="seriesInfo">DOI 10.17487/RFC9136</span>, <time datetime="2021-10" class="refDate">October 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc9136">https://www.rfc-editor.org/info/rfc9136</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-6.2">
        <h3 id="name-informative-references">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-bess-evpn-modes-interop">[I-D.ietf-bess-evpn-modes-interop]</dt>
        <dd>
<span class="refAuthor">Krattiger, L.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">J. E. Drake</span>, <span class="refTitle">"EVPN Interoperability Modes"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-modes-interop-00</span>, <time datetime="2021-05-31" class="refDate">31 May 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-modes-interop-00">https://datatracker.ietf.org/doc/html/draft-ietf-bess-evpn-modes-interop-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-bess-srv6-services">[I-D.ietf-bess-srv6-services]</dt>
        <dd>
<span class="refAuthor">Dawra, G.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Talaulikar, K.</span>, <span class="refAuthor">Raszuk, R.</span>, <span class="refAuthor">Decraene, B.</span>, <span class="refAuthor">Zhuang, S.</span>, and <span class="refAuthor">J. Rabadan</span>, <span class="refTitle">"SRv6 BGP based Overlay Services"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-srv6-services-08</span>, <time datetime="2021-11-10" class="refDate">10 November 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-bess-srv6-services-08">https://datatracker.ietf.org/doc/html/draft-ietf-bess-srv6-services-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.sajassi-bess-evpn-ac-aware-bundling">[I-D.sajassi-bess-evpn-ac-aware-bundling]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Brissette, P.</span>, <span class="refAuthor">Mishra, M.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">J. Drake</span>, <span class="refTitle">"AC-Aware Bundling Service Interface in EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-sajassi-bess-evpn-ac-aware-bundling-04</span>, <time datetime="2021-07-11" class="refDate">11 July 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ac-aware-bundling-04">https://datatracker.ietf.org/doc/html/draft-sajassi-bess-evpn-ac-aware-bundling-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wang-bess-evpn-arp-nd-synch-without-irb">[I-D.wang-bess-evpn-arp-nd-synch-without-irb]</dt>
        <dd>
<span class="refAuthor">Wang, Y.</span> and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"ARP/ND Synching And IP Aliasing without IRB"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wang-bess-evpn-arp-nd-synch-without-irb-08</span>, <time datetime="2021-09-01" class="refDate">1 September 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-arp-nd-synch-without-irb-08">https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-arp-nd-synch-without-irb-08</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wang-bess-evpn-ether-tag-id-usage">[I-D.wang-bess-evpn-ether-tag-id-usage]</dt>
        <dd>
<span class="refAuthor">Wang, Y.</span>, <span class="refTitle">"Ethernet Tag ID Usage Update for Ethernet A-D per EVI Route"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wang-bess-evpn-ether-tag-id-usage-03</span>, <time datetime="2021-08-26" class="refDate">26 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03">https://datatracker.ietf.org/doc/html/draft-wang-bess-evpn-ether-tag-id-usage-03</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.wz-bess-evpn-vpws-as-vrf-ac">[I-D.wz-bess-evpn-vpws-as-vrf-ac]</dt>
      <dd>
<span class="refAuthor">Wang, Y.</span> and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"EVPN VPWS as VRF Attachment Circuit"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-wz-bess-evpn-vpws-as-vrf-ac-02</span>, <time datetime="2021-08-28" class="refDate">28 August 2021</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02">https://datatracker.ietf.org/doc/html/draft-wz-bess-evpn-vpws-as-vrf-ac-02</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yubao Wang</span></div>
<div dir="auto" class="left"><span class="org">ZTE Corporation</span></div>
<div dir="auto" class="left"><span class="street-address">No.68 of Zijinghua Road, Yuhuatai Distinct</span></div>
<div dir="auto" class="left"><span class="locality">Nanjing</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wang.yubao2@zte.com.cn" class="email">wang.yubao2@zte.com.cn</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
