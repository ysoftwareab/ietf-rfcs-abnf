<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>RBridges: Operations, Administration, and Maintenance (OAM) Support </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Acronyms">
<link href="#rfc.section.3" rel="Chapter" title="3 TRILL OAM Message">
<link href="#rfc.section.4" rel="Chapter" title="4 RBridge Tools">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Application RBridge Tools">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Hop Count Traceroute">
<link href="#rfc.section.4.1.1.1" rel="Chapter" title="4.1.1.1 Multi-Destination Targets">
<link href="#rfc.section.4.1.1.2" rel="Chapter" title="4.1.1.2 Hop Count Traceroute Example">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 RBridge Ping">
<link href="#rfc.section.4.1.2.1" rel="Chapter" title="4.1.2.1 Ping Example">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Error Reporting">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Hop Count Zero Error">
<link href="#rfc.section.4.2.2" rel="Chapter" title="4.2.2 MTU Error">
<link href="#rfc.section.5" rel="Chapter" title="5 TRILL OAM Message Format">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 Protocol Code Values">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Protocol Codes Formats">
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 Protocol Application Codes Formats">
<link href="#rfc.section.5.2.1.1" rel="Chapter" title="5.2.1.1 Echo Request">
<link href="#rfc.section.5.2.1.2" rel="Chapter" title="5.2.1.2 Echo Reply">
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 Error Notification Format">
<link href="#rfc.section.5.2.2.1" rel="Chapter" title="5.2.2.1 Error Specifiers">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Type, Length, Value (TLV) Encodings">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 TLV Types">
<link href="#rfc.section.5.3.1.1" rel="Chapter" title="5.3.1.1 Next Hop Nickname">
<link href="#rfc.section.5.3.1.2" rel="Chapter" title="5.3.1.2 Incoming Port ID">
<link href="#rfc.section.5.3.1.3" rel="Chapter" title="5.3.1.3 Outgoing Port ID">
<link href="#rfc.section.5.3.1.4" rel="Chapter" title="5.3.1.4 Outgoing Port MTU">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgments">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Revision History">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Changes from -00 to -01">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The IETF has standardized RBridges, devices that implement the TRILL protocol, a solution for transparent shortest-path frame routing in multi-hop networks with arbitrary topologies, using a link-state routing protocol technology and encapsulation with a hop-count. As RBridges are deployed in real-world situations, operators will need tools for debugging problems that arise. This document specifies a set of RBridge features for operations, administration, and maintenance purposes in RBridge campuses. The features specified in this document include tools for traceroute, ping, and error reporting.  " />
  <meta name="description" content="The IETF has standardized RBridges, devices that implement the TRILL protocol, a solution for transparent shortest-path frame routing in multi-hop networks with arbitrary topologies, using a link-state routing protocol technology and encapsulation with a hop-count. As RBridges are deployed in real-world situations, operators will need tools for debugging problems that arise. This document specifies a set of RBridge features for operations, administration, and maintenance purposes in RBridge campuses. The features specified in this document include tools for traceroute, ping, and error reporting.  " />
  <meta name="keywords" content="TRILL, RBridges, OAM, Traceroute, Ping, Bridging, Routing, Operations, Administration, Maintenance" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">TRILL Working Group</td>
<td class="right">D.M.B. Bond</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">UNH-IOL</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">V.M. Manral</td>
</tr>
<tr>
<td class="left">Expires: September 12, 2011</td>
<td class="right">IP Infusion Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">March 11, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">RBridges: Operations, Administration, and Maintenance (OAM) Support <br />
  <span class="filename">draft-bond-trill-rbridge-oam-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The IETF has standardized RBridges, devices that implement the TRILL protocol, a solution for transparent shortest-path frame routing in multi-hop networks with arbitrary topologies, using a link-state routing protocol technology and encapsulation with a hop-count. As RBridges are deployed in real-world situations, operators will need tools for debugging problems that arise. This document specifies a set of RBridge features for operations, administration, and maintenance purposes in RBridge campuses. The features specified in this document include tools for traceroute, ping, and error reporting.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 12, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Acronyms</a>
</li>
<li>3.   <a href="#rfc.section.3">TRILL OAM Message</a>
</li>
<li>4.   <a href="#rfc.section.4">RBridge Tools</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Application RBridge Tools</a>
</li>
<li>4.1.1.   <a href="#rfc.section.4.1.1">Hop Count Traceroute</a>
</li>
<li>4.1.1.1.   <a href="#rfc.section.4.1.1.1">Multi-Destination Targets</a>
</li>
<li>4.1.1.2.   <a href="#rfc.section.4.1.1.2">Hop Count Traceroute Example</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">RBridge Ping</a>
</li>
<li>4.1.2.1.   <a href="#rfc.section.4.1.2.1">Ping Example</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Error Reporting</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Hop Count Zero Error</a>
</li>
<li>4.2.2.   <a href="#rfc.section.4.2.2">MTU Error</a>
</li>
<li>5.   <a href="#rfc.section.5">TRILL OAM Message Format</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">Protocol Code Values</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Protocol Codes Formats</a>
</li>
<li>5.2.1.   <a href="#rfc.section.5.2.1">Protocol Application Codes Formats</a>
</li>
<li>5.2.1.1.   <a href="#rfc.section.5.2.1.1">Echo Request</a>
</li>
<li>5.2.1.2.   <a href="#rfc.section.5.2.1.2">Echo Reply</a>
</li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">Error Notification Format</a>
</li>
<li>5.2.2.1.   <a href="#rfc.section.5.2.2.1">Error Specifiers</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Type, Length, Value (TLV) Encodings</a>
</li>
<li>5.3.1.   <a href="#rfc.section.5.3.1">TLV Types</a>
</li>
<li>5.3.1.1.   <a href="#rfc.section.5.3.1.1">Next Hop Nickname</a>
</li>
<li>5.3.1.2.   <a href="#rfc.section.5.3.1.2">Incoming Port ID</a>
</li>
<li>5.3.1.3.   <a href="#rfc.section.5.3.1.3">Outgoing Port ID</a>
</li>
<li>5.3.1.4.   <a href="#rfc.section.5.3.1.4">Outgoing Port MTU</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgments</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Revision History</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Changes from -00 to -01</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The IETF has standardized RBridges, devices that implement the TRILL protocol, a solution for transparent shortest-path frame routing in multi-hop networks with arbitrary topologies, using a link-state routing protocol technology and encapsulation with a hop-count (<a href="#I-D.ietf-trill-rbridge-protocol">RFCtrill</a> <cite title="NONE">[I-D.ietf-trill-rbridge-protocol]</cite>).  As RBridges are deployed, operators will face problems that require tools for troubleshooting of connectivity issues in the network. TRILL uses IS-IS for the control plane. IS-IS has a link-state database which contains the information of all links in the TRILL domain and IS-IS has a routing table. This information can be used for trouble shooting purposes. Simply being able to view the link-state database and routing table is insufficient for the requirements of operations, administration, and maintenance (OAM).  </p>
<p id="rfc.section.1.p.2">In addition, RBridges should support SNMP, as described in <a href="#I-D.ietf-trill-rbridge-protocol">RFCtrill</a> <cite title="NONE">[I-D.ietf-trill-rbridge-protocol]</cite> and <a href="#I-D.ietf-trill-rbridge-mib">RBridgeMIB</a> <cite title="NONE">[I-D.ietf-trill-rbridge-mib]</cite>. SNMP, the routing table, and the link-state database are insufficient as the only OAM tools because while the control plane within an RBridge campus may be functioning successfully the data plane may not be. This motivates the need for OAM tools that allow an operator to test the data plane. Protocols such as IP, MPLS, and IEEE 802.1 have features enabling an operator to exercise the data plane (<a href="#RFC4443">RFC 4443</a> <cite title="NONE">[RFC4443]</cite>, <a href="#RFC0792">RFC 0792</a> <cite title="NONE">[RFC0792]</cite>, <a href="#IEEE.802-1ag">IEEE 802.1ag</a> <cite title="NONE">[IEEE.802-1ag]</cite>). There is a need for a similar set of tools in TRILL.  </p>
<p id="rfc.section.1.p.3">Likewise, there is a need for error reporting capabilities inside an RBridge campus. For instance, if a TRILL Inner.VLAN tag has an illegal value there should be a way for devices to report this error. This would allow administrators of an RBridge campus to quickly locate a problem device in the network. This document specifies a set of RBridge features for operations, administration, and maintenance purposes in RBridge campuses along with a frame format. The features specified in this document include tools for traceroute, ping, and error reporting. <a href="#trill_oam_message">Section 3</a> of this document specifies the general usage of a defined message format. <a href="#tools">Section 4</a> specifies some additional applications of the message format. <a href="#trill_oam_message_format">Section 5</a> specifies the format of the messages on the wire.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#acronyms" id="acronyms">Acronyms</a>
</h1>
<p></p>

<ul>
<li>BPDU - Bridge PDU</li>
<li>CHbH - Critical Hop-by-Hop</li>
<li>CItE - Critical Ingress-to-Egress</li>
<li>DA - Destination Address</li>
<li>DR - Designated Router</li>
<li>DRB - Designated RBridge</li>
<li>ES - End Station</li>
<li>ESa - End Station A</li>
<li>ESb - End Station B</li>
<li>ECMP - Equal-Cost Multi-Path</li>
<li>ESADI - End Station Address Distribution Instance</li>
<li>FCS - Frame Check Sequence</li>
<li>ID - Identification</li>
<li>IEEE  - Institute of Electrical and Electronics Engineers</li>
<li>IETF - Internet Engineering Task Force</li>
<li>IP - Internet Protocol</li>
<li>IS-IS - Intermediate System to Intermediate System</li>
<li>MAC - Media Access Control</li>
<li>MPLS - Multiprotocol Label Switching</li>
<li>MTU - Maximum Transmission Unit</li>
<li>OAM - Operations, Administration, and Maintenance</li>
<li>P2P - Point-to-point</li>
<li>PDU - Protocol Data Unit</li>
<li>RBridge - Routing Bridge</li>
<li>SA - Source Address</li>
<li>SNMP - Simple Network Management Protocol</li>
<li>TLV - Type, Length, Value</li>
<li>TRILL - TRansparent Interconnection of Lots of Links</li>
<li>VLAN - Virtual Local Area Network</li>
</ul>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#trill_oam_message" id="trill_oam_message">TRILL OAM Message</a>
</h1>
<p id="rfc.section.3.p.1">To facilitate message passing as needed by the OAM requirements, the TRILL OAM Channel (<a href="#I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</a>) is utilized. The TRILL Header extended flag MAY be set if so desired.  </p>
<p id="rfc.section.3.p.2">There are two types of TRILL OAM messages defined in this document carried within the TRILL OAM Channel: application and error notification. Frames with an error notification MUST NOT be generated in response to frames with an error notification.  Implementations SHOULD rate limit the origination of error notifications. Whereas unknown unicast frames are sent as multi-destination messages, sending unknown unicast frames with an error can lead to an amplification attack. As such special care and rate limiting are necessary for error notifications.  </p>
<p id="rfc.section.3.p.3">The specification of rate limiting is beyond the scope of this document.  An RBridge SHOULD maintain counters for each type of error generated.  </p>
<p id="rfc.section.3.p.4">Error notification messages contain the error-causing frame or the initial part thereof after its OAM message. The following are two figures showing application and error notification message structure. <a href="#trill_oam_message_format">Section 5</a> goes into the details of these formats.  </p>
<div id="#rfc.figure.1"></div>
<div id="#application_frame"></div>
<pre>
            
+----------------------------+
|     Outer Link Header      |
+----------------------------+
|        TRILL Header        |
+----------------------------+
|     Inner Link Header      |
+----------------------------+
|  TRILL OAM Channel Header  |
+----------------------------+
| OAM Protocol Spec. Payload |
+----------------------------+
            
        </pre>
<p>Application Frame </p>
<div id="#rfc.figure.2"></div>
<div id="#errror_frame"></div>
<pre>
            
+---------------------------------------+
|           Outer Link Header           |
+---------------------------------------+
|              TRILL Header             |
+---------------------------------------+
|           Inner Link Header           |
+---------------------------------------+
|       TRILL OAM Channel Header        |
+---------------------------------------+
|     OAM Protocol Specific Payload     |
+---------------------------------------+
|      Offending Frame TRILL Header     |
+---------------------------------------+
|   Offending Frame Inner Link Header   |
+---------------------------------------+
|         Offending Frame Payload       |
+---------------------------------------+
            
        </pre>
<p>Error Notification Frame </p>
<p id="rfc.section.3.p.5">Frames with the TRILL OAM message generated in response to another TRILL data frame MUST have fields set as follows unless otherwise specified: </p>
<div id="#rfc.table.1"></div>
<div id="#frame_field_values"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Frame Field Values</caption>
<thead><tr>
<th class="center">Frame Type</th>
<th class="center">Field</th>
<th class="left">Value</th>
</tr></thead>
<tbody>
<tr>
<td class="center"></td>
<td class="center"></td>
<td class="left"></td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Inner.MacSA</td>
<td class="left">If the Inner.MacDA of the received frame is one of the MAC addresses of the RBridge generating the frame, the value MUST be that MAC address. Otherwise, it MUST be one of the RBridge's MAC addresses.</td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Inner.MacDA</td>
<td class="left">The value SHOULD be All-OAM-RBridges . The Inner.MacDA MAY be other values as specified in subsequent sections.  </td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Inner.VLAN ID</td>
<td class="left">The value MUST be one of the VLANs the egress RBridge advertises connectivity on. If the frame is generated in response to another frame it MUST be copied from the received frame.</td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Ingress RBridge nickname</td>
<td class="left">If the egress RBridge nickname of the received frame is a nickname of the RBridge generating the frame, then the value MUST be that nickname. Otherwise, it MUST be one of the RBridge's nicknames.</td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Egress RBridge nickname</td>
<td class="left">The value MUST be the ingress RBridge nickname of the received frame. If the ingress RBridge nickname received is unknown or reserved the frame MUST be generated on the port the frame was received on with an Outer.MacDA and egress RBridge nickname of the RBridge that transmitted the invalid frame.</td>
</tr>
<tr>
<td class="center">Error</td>
<td class="center">Offending Encapsulated Frame</td>
<td class="left">The value MUST be N bytes of the frame which had the error where N is the minimum of the frame size and the number of bytes that would bring the resulting error frame up to 1470 bytes. This MUST include the TRILL header and MUST NOT include the link-layer header.</td>
</tr>
<tr>
<td class="center">Error</td>
<td class="center">M Bit</td>
<td class="left">The value MUST be zero.</td>
</tr>
<tr>
<td class="center">Application or Error</td>
<td class="center">Inner.Priority</td>
<td class="left">The value SHOULD be one less than the priority of the received frame, but not less than the lowest priority. Defaults to zero for sent frames.</td>
</tr>
</tbody>
</table>
<p id="rfc.section.3.p.6">RBridge campuses do not, in general, guarantee lossless transport of frames so a frame containing a TRILL OAM Message, possibly generated in response to some other frame, might be lost.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#tools" id="tools">RBridge Tools</a>
</h1>
<p id="rfc.section.4.p.1">This section specifies a number of RBridge OAM tools. For classification purposes they are divided into two sections, applications and error tools.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#app" id="app">Application RBridge Tools</a>
</h1>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#hop_count_traceroute" id="hop_count_traceroute">Hop Count Traceroute</a>
</h1>
<p id="rfc.section.4.1.1.p.1">The ability to trace the path the data takes through the network is an invaluable debugging tool. RBridge traceroute provides this functionality through use of the TRILL OAM message (See <a href="#trill_oam_message">Section 3</a>). In a hop-count traceroute, the originating RBridge starts by transmitting one TRILL data frame with a TRILL OAM message. This message contains a protocol code of an echo request. (See <a href="#echo_request">Section 5.2.1.1</a>) The ingress RBridge MUST be the RBridge originating the frame.  </p>
<p id="rfc.section.4.1.1.p.2">When a traceroute is initiated, it is either targeting a known unicast target or a multi-destination target as specified by the operator. If the hop-count traceroute is for a known unicast target, the egress RBridge is the destination RBridge to which connectivity will be checked and the M bit MUST be zero. Otherwise, if the hop-count traceroute is for a multi-destination target, the egress RBridge is the distribution tree nickname for the traceroute. Multi-destination targets are handled the same as known unicast targets but require a small amount of additional logic as specified in <a href="#hop_count_traceroute_multi_dest_targets">Section 4.1.1.1</a>.  </p>
<p id="rfc.section.4.1.1.p.3">The first echo request frame transmitted MUST have a hop-count of one. The RBridge will continue transmitting these echo requests, incrementing the hop-count by one each time until a hop-count error notification is received from the destination. Each of these requests in turn will generate a hop-count error notification until the egress RBridge is reached. If a transit RBridge decrements the hop-count by more than one it may transmit multiple hop-count error notifications.</p>
<p id="rfc.section.4.1.1.p.4">The purpose of the traceroute is to confirm connectivity of the data plane, and therefore options such as a flow ID or a security option MAY be included. If an RBridge supports equal-cost multi-pathing (ECMP) or load balancing, the RBridge SHOULD allow operators to specify which flow the traceroute is assigned to. There is no need for all RBridges to use the same assignment method. Being able to specify the flow allows operators to test the path taken by data through the data plane. The purpose of the frame is to mimic a data frame that follows the same path through the data plane that a 'real' data frame would.  </p>
<p id="rfc.section.4.1.1.p.5">The echo request MAY have an arbitrary 32-bit unsigned integer sequence number to assist in matching reply messages to the request. This is important for the hop-count traceroute since replies may return to the ingress RBridge in a different order then their matching requests were sent.  </p>
<p id="rfc.section.4.1.1.p.6">The Inner.VLAN, Inner.MacSA, and Inner.MacDA SHOULD default to the values specified in <a href="#frame_field_values">Table 1</a>.  RBridges SHOULD provide an option to change these values to assign the TRILL data frame to a flow.  </p>
<p id="rfc.section.4.1.1.p.7">The replying RBridge MUST include its 16-bit port ID from the port on which the hop-count error generating frame was received in the incoming port field of the reply. It MUST also include its 16-bit port ID from the port on which the frame would be forwarded if the frame did not have a hop-count error. A port ID of 0xFFFF indicates the frame was consumed by the RBridge itself. Finally the reply MUST include the 16-bit nickname of the next hop RBridge the frame would have been sent to if there were no error. If the request is a multi-destination frame, this field MUST be set to the nickname of the RBridge the frame was received from. This is the previous hop RBridge. This is to facilitate knowledge of a more precise path through the campus as seen in <a href="#RFC5837">RFC 5837</a> <cite title="NONE">[RFC5837]</cite>.  </p>
<p id="rfc.section.4.1.1.p.8">The advantage of this traceroute method is the transit RBridges do not have to do any special processing of the frames until a hop-count error is detected, a condition they are required to detect by the TRILL base protocol. The disadvantage is the request-orginating RBridge needs to transmit as many frames as there are hops between itself and the destination RBridge.  </p>
<p id="rfc.section.4.1.1.p.9">The end stations are not involved in this process. RBridge traceroutes are from RBridge to RBridge. While the frames sent may emulate data sent from ESa to ESb, the end stations are not, in fact, involved.  </p>
<h1 id="rfc.section.4.1.1.1">
<a href="#rfc.section.4.1.1.1">4.1.1.1.</a> <a href="#hop_count_traceroute_multi_dest_targets" id="hop_count_traceroute_multi_dest_targets">Multi-Destination Targets</a>
</h1>
<p id="rfc.section.4.1.1.1.p.1">For multi-destination targets at each branch in the tree the tagged frame will be replicated causing each RBridge in the tree, possibly pruned by VLAN and/or multicast group, to send a response to the echo request. If all RBridges in the possibly pruned distribution tree support the echo request message, then the ingressing RBridge will receive an echo reply from each of them. This is in contrast to a known unicast tagged frame where only the RBridges along the path from ingress to egress transmit the error notification. The ingressing RBridge can compile all of these replies, using the parent pointers located in the nexthop nickname field, into an output of the tree the traffic traversed. In the case that a non-valid distribution tree nickname is specified the traceroute frames SHOULD still be generated. The traceroute application MUST report any errors received, such as an invalid distribution tree nickname, caused by the hop-count traceroute frames. RBridges receiving a multicast destination echo request MUST NOT transmit an echo reply if the multi-destination bit is set. Echo requests that are not used with the hop-count traceroute come from the ping tool, and pings are not valid to multi-destination traffic. In a hop-count traceroute devices will already be transmitting a hop-count error notification and so there is no reason to transmit a double set of replies. A multi-destination hop-count traceroute does not stop when an echo reply is received. It stops when the transmitted hopcount reaches 0x3F.</p>
<h1 id="rfc.section.4.1.1.2">
<a href="#rfc.section.4.1.1.2">4.1.1.2.</a> <a href="#hop_count_traceroute_example" id="hop_count_traceroute_example">Hop Count Traceroute Example</a>
</h1>
<p><a href="#hop_count_traceroute_example_topology">Figure 3</a> contains a campus with three RBridges. Consider a hop-count traceroute from RB0 to RB2.  </p>
<div id="#rfc.figure.3"></div>
<div id="#hop_count_traceroute_example_topology"></div>
<pre>
                  
+-----+  +-------+   +-------+   +-------+  +-----+
| ESa +--+  RB0  +---+  RB1  +---+  RB2  +--+ ESb |
+-----+  |ingress|   |transit|   |egress |  +-----+
         +-------+   +-------+   +-------+  
         
 Time       RB0         RB1         RB2 
  .         (1)-------&gt;  |           |
  .          | &lt;------- (2)          |
  .         (3)-------&gt; (3) -------&gt; |
  .          | &lt;------- (4) &lt;-------(4)
            
              </pre>
<p>Hop Count Traceroute Example Topology </p>
<p id="rfc.section.4.1.1.2.p.2">In this diagram RB0 transmits frame (1) destined to RB2. This frame contains the echo request message and a hop-count of 0. When RB1 receives this frame it drops it and transmits a hop-count-exceeded message, (2), to RB0. RB0 then transmits a frame, (3), with a hop-count of 1. RB1 decrements this hop-count by 1 to 0 and forwards it to RB2. RB2 drops frame (3) and transmits a hop-count-exceeded message, (4), to RB0. The traceroute is now complete.  </p>
<p id="rfc.section.4.1.1.2.p.3">Below are some select fields for the frames: </p>
<div id="#rfc.table.2"></div>
<div id="#hop_count_traceroute_example_frames"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Hop Count Traceroute Example Frames</caption>
<thead><tr>
<th class="center">Frame #</th>
<th class="center">Ingress RBridge</th>
<th class="center">Egress RBridge</th>
<th class="center">TRILL OAM Protocol</th>
<th class="center">Sequence Number</th>
<th class="center">Hop Count</th>
</tr></thead>
<tbody>
<tr>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
</tr>
<tr>
<td class="center">(1) </td>
<td class="center">RB0</td>
<td class="center">RB2</td>
<td class="center">Echo Request</td>
<td class="center">1</td>
<td class="center">1</td>
</tr>
<tr>
<td class="center">(2)</td>
<td class="center">RB1</td>
<td class="center">RB0</td>
<td class="center">Hop Count Error</td>
<td class="center">1</td>
<td class="center">N/A</td>
</tr>
<tr>
<td class="center">(3) @ RB1</td>
<td class="center">RB0</td>
<td class="center">RB2</td>
<td class="center">Echo Request</td>
<td class="center">2</td>
<td class="center">2</td>
</tr>
<tr>
<td class="center">(3) @ RB2</td>
<td class="center">RB0</td>
<td class="center">RB2</td>
<td class="center">Echo Request</td>
<td class="center">2</td>
<td class="center">1</td>
</tr>
<tr>
<td class="center">(4) @ RB1</td>
<td class="center">RB2</td>
<td class="center">RB0</td>
<td class="center">Hop Count Error</td>
<td class="center">2</td>
<td class="center">N/A</td>
</tr>
<tr>
<td class="center">(4) @ RB0</td>
<td class="center">RB2</td>
<td class="center">RB0</td>
<td class="center">Hop Count Error</td>
<td class="center">2</td>
<td class="center">N/A</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.1.2.p.4">For example, if the nicknames for RB0, RB1, and RB2 are 0x0001, 0x0002, and 0x0003 respectively, the console output from such a trace might be: </p>
<div id="#rfc.table.3"></div>
<div id="#hop_count_traceroute_example_output"></div>
<p>Hop Count Tracing</p>
<table cellpadding="3" cellspacing="0" class="tt full left">
<caption>Hop Count Traceroute Example Output</caption>
<thead><tr>
<th class="center">RBridge</th>
<th class="center">Incoming Port Id</th>
<th class="center">Outgoing Port Id</th>
<th class="center">RBridge Nexthop Nickname</th>
</tr></thead>
<tbody>
<tr>
<td class="center">0x0001</td>
<td class="center">0xFFFF</td>
<td class="center">0x0001</td>
<td class="center">0x0002</td>
</tr>
<tr>
<td class="center">0x0002</td>
<td class="center">0x0000</td>
<td class="center">0x0001</td>
<td class="center">0x0003</td>
</tr>
<tr>
<td class="center">0x0003</td>
<td class="center">0x0000</td>
<td class="center">0xFFFF</td>
<td class="center">0x0000</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.1.2.p.5">In this example, the first line of output is generated from local information, no hop-count frames are sent to generate it.</p>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> <a href="#ping" id="ping">RBridge Ping</a>
</h1>
<p id="rfc.section.4.1.2.p.1">Ping is a tool for verifying RBridge connectivity. As with an RBridge traceroute, the ping-originating RBridge transmits one or more TRILL data frames with a TRILL OAM message.  This message contains the code of an echo request (See <a href="#echo_request">Section 5.2.1.1</a>). The ingress RBridge MUST be the RBridge-originating frame.  The egress RBridge is the destination RBridge to which connectivity will be checked.  The M bit MUST be zero.  </p>
<p id="rfc.section.4.1.2.p.2">As with RBridge traceroute, options such as a flow ID or a security option MAY be included.  If an RBridge supports equal-cost multi-pathing (ECMP) or load balancing, the RBridge SHOULD allow operators to specify which flow the ping is assigned to.  There is no need for all RBridges to use the same assignment method. This ping traffic, once again, will mimic real traffic through the network, like traceroute traffic as previously specified in <a href="#hop_count_traceroute">Section 4.1.1</a>.  </p>
<p id="rfc.section.4.1.2.p.3">The echo request MAY have an arbitrary 32-bit unsigned integer sequence number to assist in matching reply messages to the request. In most circumstances, a single echo request is needed to complete the ping but it might be desirable for a single RBridge to ping multiple egress RBridges, or trace differing flows simultaneously.  Assigning differing sequence numbers to each frame aids in matching which trace the reply belongs to.</p>
<p id="rfc.section.4.1.2.p.4">The Inner.VLAN, Inner.MacSA, and Inner.MacDA SHOULD default to the values specified in <a href="#frame_field_values">Table 1</a>. RBridges SHOULD provide the ability to change these values as to assign the TRILL data frame to a flow.  The payload of the frame is arbitrary and MAY contain any value.  This value can have an influence on which flow the frame is assigned to.  </p>
<p id="rfc.section.4.1.2.p.5">RBridges implementing ping MAY issue a reply in response to this request.  See <a href="#security">Section 8</a> for reasons on some RBridges are allowed to choose not to respond to a request. If an RBridge chooses to respond to the request, the reply MUST consist of one TRILL data frame per request with an OAM message containing the protocol code of an echo reply.  The echo reply MUST have the same sequence number as the request being matched.  </p>
<p id="rfc.section.4.1.2.p.6">For the echo reply the ingress RBridge field MUST be the reply-originating RBridge's nickname.  The egress RBridge MUST be the request-originating RBridge's nickname.  The Inner.VLAN, Inner.MacSA, and Inner.MacDA SHOULD default to the values specified in <a href="#frame_field_values">Table 1</a>. The Outer.VLAN ID MUST be preserved. The M bit MUST be zero.  </p>
<p id="rfc.section.4.1.2.p.7">The reply-originating RBridge MUST include its 16-bit port ID from the port on which the request was received in the incoming port field of the reply.  It MUST also include its 16-bit port ID from the port on which the frame is forwarded.  A port ID of 0xFFFF indicates the frame was consumed by the RBridge itself. The nickname field in the generated frame MUST be set to all zeros on transmission and ignored on reception. </p>
<p id="rfc.section.4.1.2.p.8">The Internal Hop Count field of the reply MUST be set to zero. The ping functionality does not use the Internal Hop Count field of the reply. (See <a href="#echo_reply">Section 5.2.1.2</a>) </p>
<p id="rfc.section.4.1.2.p.9">The reply frame need not follow the same path though the campus.  The reply messages are not meant to test the data plane.  </p>
<p id="rfc.section.4.1.2.p.10">End stations are not involved in this the ping process.  RBridge pings are from RBridge to RBridge.  While the frames sent may emulate data sent from ESa to ESb, the end stations are not, in fact, involved.</p>
<p id="rfc.section.4.1.2.p.11">The transmitting RBridge MUST wait for a reply frame until a time-out occurs.  At that time, the RBridge MUST assume the frame was lost, and this MUST be indicated to the operator.  The length of this time-out is not specified in this document.</p>
<h1 id="rfc.section.4.1.2.1">
<a href="#rfc.section.4.1.2.1">4.1.2.1.</a> <a href="#ping_example" id="ping_example">Ping Example</a>
</h1>
<p><a href="#ping_example_topology">Figure 4</a> contains a campus with three RBridges. Consider a ping from RB0 to RB2.  </p>
<div id="#rfc.figure.4"></div>
<div id="#ping_example_topology"></div>
<pre>
                  
+-----+  +-------+   +-------+   +-------+  +-----+
| ESa +--+  RB0  +---+  RB1  +---+  RB2  +--+ ESb |
+-----+  |ingress|   |transit|   |egress |  +-----+
         +-------+   +-------+   +-------+  
         
 Time       RB0         RB1         RB2 
  .         (1)-------&gt; (1) -------&gt; |
  .          | &lt;------- (2) &lt;-------(2)
            
              </pre>
<p>Ping Example Topology </p>
<p id="rfc.section.4.1.2.1.p.2">In this diagram RB0 transmits frame (1) destined to RB2. This frame contains the echo request message. When RB1 receives this frame it forwards it to RB2. When RB2 receives this frame it transmits and echo reply frame (2) destined to RB0. RB1 receives this frame and forwards it to RB0.  </p>
<p id="rfc.section.4.1.2.1.p.3">Below are some select fields for the frames: </p>
<div id="#rfc.table.4"></div>
<div id="#ping_example_frames"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>Ping Example Frames</caption>
<thead><tr>
<th class="center">Frame #</th>
<th class="center">Ingress RBridge</th>
<th class="center">Egress RBridge</th>
<th class="center">TRILL OAM Protocol</th>
<th class="center">Sequence Number</th>
</tr></thead>
<tbody>
<tr>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
<td class="center"></td>
</tr>
<tr>
<td class="center">(1) </td>
<td class="center">RB0</td>
<td class="center">RB2</td>
<td class="center">Echo Request</td>
<td class="center">1</td>
</tr>
<tr>
<td class="center">(2) </td>
<td class="center">RB2</td>
<td class="center">RB0</td>
<td class="center">Echo Reply</td>
<td class="center">1</td>
</tr>
</tbody>
</table>
<p id="rfc.section.4.1.2.1.p.4">For example, if the nicknames for RB0, RB1, and RB2 are 0x0001, 0x0002, and 0x0003 respectively, the console output from such a ping might be: </p>
<div id="#rfc.table.5"></div>
<div id="#ping_example_output"></div>
<table cellpadding="3" cellspacing="0" class="tt full left">
<caption>Ping Example Output</caption>
<thead><tr><th class="left">Pinging</th></tr></thead>
<tbody>
<tr><td class="left">... from 0x0001 to 0x0003... 0x0003 is alive</td></tr>
<tr><td class="left">... from 0x0001 to 0x0003... 0x0003 is alive</td></tr>
<tr><td class="left">... from 0x0001 to 0x0003... 0x0003 is alive</td></tr>
</tbody>
</table>
<p id="rfc.section.4.1.2.1.p.5">In this example, the ping was repeated three times with the sequence number being changed each time.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#error_reporting" id="error_reporting">Error Reporting</a>
</h1>
<p id="rfc.section.4.2.p.1">Errors can occur through the reception of TRILL data frames. For this purpose, the error notification format is specified. These are generated due to various events as specified subsequently. When a TRILL data frame is received with an error, an error notification frame MAY be generated. See <a href="#security">Section 8</a> for reasons on some RBridges are allowed to choose not to respond to a request. The generated reply MUST contain the error notification. The sub-code MUST contain a code specifying the error encountered. The valid values are specified in <a href="#error_specifiers">Section 5.2.2.1</a>. Two of these sub-codes contain TLVs with additional information. The error notification also contains a 3 bit error type field which describes the error.  </p>
<p id="rfc.section.4.2.p.2">This frame has a TRILL header and it contains, as its payload, the frame received with the error. If the size of the received frame would cause the generated frame to exceed 1470 bytes, the payload MUST be truncated to the 1470 bytes. The payload MUST include the TRILL header of the received frame and MUST NOT include the link-layer header. The generated reply MUST contain the error notification message specific to the error.  </p>
<p id="rfc.section.4.2.p.3">When the original ingress RBridge receives the error frame, at a minimum, the RBridge SHOULD update a counter specifying the number of error frames received for the causing error. The encapsulated frame MUST NOT be decapsulated and transmitted. The RBridge SHOULD also keep a set of counters for errors reported by other RBridges.</p>
<p id="rfc.section.4.2.p.4">The two sub-codes that contain TLVs with additional information are described below. All other sub-codes specified in this document do not contain TLVs.</p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#hop_count_zero_error_spec" id="hop_count_zero_error_spec">Hop Count Zero Error</a>
</h1>
<p id="rfc.section.4.2.1.p.1">When a TRILL data frame is received with a hop-count of zero, an error notification frame MAY be generated. The generated reply MUST contain the hop-count zero error sub-code. If the received frame has the echo request message, the hop-count zero error notification MUST have a sequence number matching the echo request. Otherwise, the sequence number MUST be set to zero. The incoming port ID MUST be the port ID the received frame arrived on. The outgoing port ID MUST be the port ID of the port the received frame would have been forwarded onto if the hop-count was not zero. Finally, the error notification MUST include the 16-bit nickname of the next hop RBridge the frame would have been sent to. If the request is a multi-destination frame, this field MUST be set to all zeros on transmission and ignored on reception. If the RBridge transmitting the request is the egress RBridge, this field MUST be set to 0x0000.</p>
<h1 id="rfc.section.4.2.2">
<a href="#rfc.section.4.2.2">4.2.2.</a> <a href="#mtu_error_spec" id="mtu_error_spec">MTU Error</a>
</h1>
<p id="rfc.section.4.2.2.p.1">When a TRILL data frame is received with a payload that would exceed the MTU of the port the frame would otherwise be forwarded to, an error notification frame MAY be generated. The generated reply MUST contain the MTU error sub-code. The outgoing port MTU field MUST have the MTU of the port the frame would have otherwise been transmitted on. The incoming port ID MUST be the port ID the received frame arrived on. The outgoing port ID MUST be the port ID of the port the received frame would have been forwarded onto if the frame size was not too large. Finally, the error notification message MUST include the 16-bit nickname of the next hop RBridge the frame would have been sent to. If this is a multi-destination frame this field MUST be set to all zeros on transmission and ignored on reception. If the RBridge transmitting the request is the egress RBridge, this field MUST be set to 0x0000.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#trill_oam_message_format" id="trill_oam_message_format">TRILL OAM Message Format</a>
</h1>
<p id="rfc.section.5.p.1">This section specifies the format of the TRILL OAM message on the wire beyond the ethertype as encoded in the OAM Channel </p>
<div id="#rfc.figure.5"></div>
<div id="#trill_oam_message_common_format"></div>
<pre>
            
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  Version  |         TRILL OAM Protocol        |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|SL|MH|           Flags             |    ERR    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                   Sequence                    |
|                    Number                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
        </pre>
<p>TRILL OAM Message Common Initial Part </p>
<p id="rfc.section.5.p.2">The message fields and flags are as follows: </p>

<ul>
<li>Version, TRILL OAM Protocol, SL, MH, Flags, and ERR: The usage is specified in <a href="#I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</a>. The SL bit SHOULD be 0. The MH bit MUST be 1. The version must be 0. ERR MUST be all zeros. The TRILL OAM Protocol is further specified by the tool type.  </li>
<li>Sequence Number: This field is used to sequence frames for certain tools. Not all tools utilize the sequence number field.</li>
</ul>

<p> </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#protocol_code_values" id="protocol_code_values">Protocol Code Values</a>
</h1>
<p id="rfc.section.5.1.p.1">The protocol code values which specify the tool type are: </p>

<ul>
<li>0x004 (Suggested): Echo Request, See <a href="#echo_request">Section 5.2.1.1</a> </li>
<li>0x005 (Suggested): Echo Reply, See <a href="#echo_reply">Section 5.2.1.2</a> </li>
<li>0x006 (Suggested): Error Notification, See <a href="#error_notification">Section 5.2.2</a> </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#protocol_codes_format" id="protocol_codes_format">Protocol Codes Formats</a>
</h1>
<h1 id="rfc.section.5.2.1">
<a href="#rfc.section.5.2.1">5.2.1.</a> <a href="#application_codes" id="application_codes">Protocol Application Codes Formats</a>
</h1>
<h1 id="rfc.section.5.2.1.1">
<a href="#rfc.section.5.2.1.1">5.2.1.1.</a> <a href="#echo_request" id="echo_request">Echo Request</a>
</h1>
<div id="#rfc.figure.6"></div>
<div id="#echo_request_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  Version  |         TRILL OAM Protocol        |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|SL|MH|           Flags             |    ERR    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                   Sequence                    |
|                    Number                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Echo Request </p>
<p id="rfc.section.5.2.1.1.p.1">This message is used by ingress RBridges to request an echo reply from the egress RBridge. Further uses are specified in <a href="#hop_count_traceroute">Section 4.1.1</a> and <a href="#ping">Section 4.1.2</a> </p>

<ul>
<li>Version, TRILL OAM Protocol, SL, MH, Flags, and ERR: The usage is specified in <a href="#I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</a>. The SL bit SHOULD be 0. The MH bit MUST be 1. The version must be 0. ERR MUST be all zeros. TRILL OAM Protocol MUST be 0x004 (Suggested).  </li>
<li>Sequence Number: An arbitrary 32-bit unsigned integer used to aid in matching reply messages to echo requests. MAY be zero.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2.1.2">
<a href="#rfc.section.5.2.1.2">5.2.1.2.</a> <a href="#echo_reply" id="echo_reply">Echo Reply</a>
</h1>
<div id="#rfc.figure.7"></div>
<div id="#echo_reply_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  Version  |         TRILL OAM Protocol        |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|SL|MH|           Flags             |    ERR    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                   Sequence                    |
|                    Number                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|             Reserved           | I. Hop Count |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
.                                               .
.                     TLVs                      .
.                                               .
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Echo Reply Format </p>
<p id="rfc.section.5.2.1.2.p.1">This message is used by egress RBridges to reply to an echo request from the ingress RBridge. Further uses are specified in <a href="#hop_count_traceroute">Section 4.1.1</a> and <a href="#ping">Section 4.1.2</a>.  </p>

<ul>
<li>Version, TRILL OAM Protocol, SL, MH, Flags, and ERR: The usage is specified in <a href="#I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</a>. The SL bit SHOULD be 0. The MH bit MUST be 1. The version must be 0. ERR MUST be all zeros.  TRILL OAM Protocol MUST be 0x005 (Suggested).  </li>
<li>Reserved: A reserved field. Set to zero on transmission and ignored on reception.  </li>
<li>Internal Hop Count: If the request being replied to was an echo request, this value MUST be zero on transmission and ignored on reception. If the request being replied to was a respond request, this value is a copy of the TRILL Hop Count value in the request. The reserved and internal hop-count fields combined occupy the subcode field of the TRILL OAM message.</li>
<li>Sequence Number: A 32-bit unsigned integer used to aid in matching reply messages to echo requests. This MUST match the request being replied to.  </li>
<li>TLVs: A set of type, length, value encoded fields as specified in <a href="#tlvs">Section 5.3</a>. The next hop nickname, outgoing port ID, and incoming port ID TLVs are required.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2.2">
<a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#error_notification" id="error_notification">Error Notification Format</a>
</h1>
<div id="#rfc.figure.8"></div>
<div id="#error_format"></div>
<pre>
                
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|  Version  |         TRILL OAM Protocol        |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|SL|MH|           Flags             |    ERR    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                   Sequence                    |
|                    Number                     |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
| Err. T.|                 Subcode              |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
.                                               .
.                     TLVs                      .
.                                               .
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
            </pre>
<p>Error Format </p>
<p id="rfc.section.5.2.2.p.1">This message is used by  RBridges to signal that an error has occured.  </p>

<ul>
<li>Version, TRILL OAM Protocol, SL, MH, Flags, and ERR: The usage is specified in <a href="#I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</a>. The SL bit SHOULD be 0. The MH bit MUST be 1. The version must be 0. ERR MUST be all zeros. TRILL OAM Protocol MUST be 0x006 (Suggested).  </li>
<li>Sequence Number: For all sub-codes except for the hop count error this field is unused. It is set to zero on transmission and ignored on reception. For the hop count error this is a 32-bit unsigned integer used to aid in matching reply messages to echo requests requests. If the frame whose hop-count dropped to zero contains the echo request message (See <a href="#echo_request">Section 5.2.1.1</a>), this MUST match the sequence number echo request found in that message. If this is not in reply to a request, then the sequence number MUST be set to zero.  </li>
<li>Error Type: MUST be a specifier of the error type describing the error. The values are: 0 (Permanent Error), 1 (Transient Error), 2 (Warning), 3 (Comment). Values 4 through 7 are available for allocation by IETF Review.  </li>
<li>Subcode: MUST be a specifier of the error discovered in the frame. The valid values are specified in <a href="#error_specifiers">Section 5.2.2.1</a> </li>
<li>TLVs: A set of type, length, value encoded fields as specified in <a href="#tlvs">Section 5.3</a>. For next hop errors the next hop nickname, outgoing port ID, and incoming port ID TLVs MUST be present. For MTU errors the outgoing port MTU, next hop nickname, outgoing port ID, and incoming port ID TLVs MUST be present. For all other errors the TLVs are not used and the length of this section is set to zero.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.5.2.2.1">
<a href="#rfc.section.5.2.2.1">5.2.2.1.</a> <a href="#error_specifiers" id="error_specifiers">Error Specifiers</a>
</h1>
<p id="rfc.section.5.2.2.1.p.1">The sub-code values fall into three categories: errors, warnings, and comments. All sub-codes represent something out of the ordinary that has gone wrong, but certain ones are more important than others. Sub-codes that are classified as errors are the most severe with warning sub-codes being slightly less severe. These are enabled by default. Sub-codes classified as comments are minor and are disabled by default. They may be useful for operators debugging a network. All error generations are optional and therefore MAY be generated or not generated depending on security and implementation constraints.</p>
<p id="rfc.section.5.2.2.1.p.2">The error specifiers sub-code values are: </p>
<p id="rfc.section.5.2.2.1.p.3">Sub-codes </p>
<p></p>

<ul>
<li>0: Unknown Error: Indicates an error has occurred.</li>
<li>1: Corrupt Frame: Frame received with invalid FCS or that was not an 8-bit multiple in length. It could be impossible for a device to signal this if the low-level port hardware hides this from the software.</li>
<li>2: Invalid Outer.MacDA: Indicates the MAC Address is a multicast address and the M bit is zero, the MAC Address is not a multicast address and the M bit is one, or the M bit is zero and the frame carried is an ESADI frame.</li>
<li>3: Illegal Outer.VLAN: Indicates the Outer.VLAN ID is 0xFFF.</li>
<li>4: Invalid Outer.VLAN: Indicates the Outer.VLAN ID was not the designated VLAN ID.</li>
<li>5: Unknown TRILL Version: Indicates the TRILL Version is unknown.</li>
<li>6: Op-Length Exceeds Frame Length: Indicates the Op-Length says the options field extends beyond the end of the received frame length.</li>
<li>8: Unknown Egress RBridge: Indicates the Egress RBridge in a received frame is unknown.</li>
<li>9: Unknown Ingress RBridge: Indicates the Ingress RBridge in a received frame is unknown.</li>
<li>10: Unsupported Critical Hop-by-hop Option: Indicates an unsupported critical hop-by-hop option was received.</li>
<li>11: Unsupported Critical Ingress-to-Egress Option: Indicates an unsupported critical ingress-to-egress option was received.</li>
<li>12-84: Available for allocation by IETF Review</li>
<li>85: Reserved for Private Experimentation</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.2.1.p.5">Warning Sub-codes</p>
<p></p>

<ul>
<li>86: Illegal Inner.VLAN: Indicates the Inner.VLAN ID is 0xFFF.</li>
<li>87: Inner/Outer VLAN Priority Mismatch: Indicates the priority values in the inner and outer VLANs do not match.</li>
<li>88: P2P Hello on TRILL Hello Link: Indicates a P2P Hello was received on a TRILL Hello Link.</li>
<li>89: TRILL Hello on P2P Hello Link: Indicates a TRILL Hello was received on a P2P Hello Link.</li>
<li>90: No Adjacency: Indicates a TRILL data frame was sent from an RBridge the receiving RBridge is not adjacent to. </li>
<li>91: Encapsulated BPDU/VRP Frame: A TRILL Frame containing a BPDU or VRP frame was received. </li>
<li>92: Invalid Mutability Flag: Indicates the mutability flag was set on a received CHbH Option. </li>
<li>93: Invalid TLV Option Length: Indicates the option length field of a TLV option was between 121 and 127. </li>
<li>94: Options Ordering Error: Indicates the TLV options are ordered incorrectly. </li>
<li>95: Additional Flag TLV Zero: Indicates a problem in the additional Flag TLV. </li>
<li>96: Configured Nickname Collision: Indicates an RBridge was detected in the campus with the same nickname (Configured or not).</li>
<li>97: Multiple DRBs detected.</li>
<li>98: Multiple appointed forwarders detected.</li>
<li>99-169: Available for allocation by IETF Review</li>
<li>170: Reserved for Private Experimentation</li>
</ul>

<p> </p>
<p id="rfc.section.5.2.2.1.p.7">Comment Sub-codes</p>
<p></p>

<ul>
<li>171: Inner.VLAN C-Bit Set: Indicates the C-Bit in the Inner.VLAN is set.</li>
<li>172: Unknown Inner.MacDA: Indicates the Inner.MacDA is unknown. This may occur if devices are configured to explicitly register end stations and an unknown Inner.MacDA occurs in a unicast TRILL data frame. This also only applies at egress and could indicate that the Inner.MacDA was a learned address that has timed out.</li>
<li>173: Unknown Inner.MacSA: Indicates the Inner.MacSA is unknown. This may occur if devices are configured to explicitly register end stations and an unknown Inner.MacSA occurs in a TRILL data frame. </li>
<li>174: Outer.VLAN C-Bit Set: Indicates the C-Bit in the Outer.VLAN is set for an Ethernet frame.</li>
<li>175: Invalid Reserved Bits: Indicates the reserved bits are non-zero in a received frame.</li>
<li>176: Invalid Nickname: Indicates a nickname in the reserved space of 0xFFC0 to 0xFFFF was received that is not implemented at the receiving RBridge.</li>
<li>177: Unsupported Non-Critical Hop-by-hop Option: Indicates an unsupported non-critical hop-by-hop option was received. While sending a non-critical option to an unsupported device is not an error, this could be used to support identification of devices needing an upgrade.</li>
<li>178: Unsupported Non-Critical Ingress-to-Egress Option: Indicates an unsupported non-critical ingress-to-egress option was received. While sending a non-critical option to an unsupported device is not an error, this could be used to support identification of devices needing an upgrade.</li>
<li>179: Performance Exceeded: Indicates a frame was discarded due to performance problems such as a buffer overflow. </li>
<li>180: Insufficient Hop Count: Indicates a frame was received with a hop-count that was insufficient to reach the destination.</li>
<li>181-254: Available for allocation by IETF Review</li>
<li>255: Reserved for Private Experimentation</li>
</ul>

<p> </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> <a href="#tlvs" id="tlvs">Type, Length, Value (TLV) Encodings</a>
</h1>
<p id="rfc.section.5.3.p.1">To facilitate future interoperable expansion of the data carried in OAM sub-messages some sub-messages use a TLV encoding. These TLV sections consist of a list of type, length, value encoded data where the type signals to the RBridge how to interpret the value, and the length tells the RBridge the length of the value in bytes. The type and length are both 8 bit fields. A length of zero indicates the value is a UTF-8 string with a NULL ('\0') terminating byte. Preceeding the list of TLVs is a 16 bit total length field which specifies the total length of all the length fields in octet units.</p>
<div id="#rfc.figure.9"></div>
<div id="#tlvs_format"></div>
<pre>
              
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|                  Total Length                 |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
.                                               .
.                   TLV List                    .
.                                               .
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
          </pre>
<p>TLVs Format </p>
<p id="rfc.section.5.3.p.2">Each TLV in the TLV List appears on the wire as such:</p>
<div id="#rfc.figure.10"></div>
<div id="#tlv_format"></div>
<pre>
              
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|         Type          |          Length       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
.                                               .
.                    Value                      .
.                                               .
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
          </pre>
<p>TLV Format </p>
<p id="rfc.section.5.3.p.3">The type values are: </p>

<ul>
<li>0: Next Hop Nickname, See <a href="#next_hop_nickname">Section 5.3.1.1</a> </li>
<li>1: Outgoing Port ID, See <a href="#outgoing_port_id">Section 5.3.1.3</a> </li>
<li>2: Incoming Port ID, See <a href="#incoming_port_id">Section 5.3.1.2</a> </li>
<li>3: Outgoing Port MTU, See <a href="#outgoing_port_mtu">Section 5.3.1.4</a> </li>
<li>4-253: Available for allocation by IETF Review</li>
<li>254: Reserved for Private Use</li>
<li>255: Reserved</li>
</ul>

<p> </p>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#tlv_types" id="tlv_types">TLV Types</a>
</h1>
<h1 id="rfc.section.5.3.1.1">
<a href="#rfc.section.5.3.1.1">5.3.1.1.</a> <a href="#next_hop_nickname" id="next_hop_nickname">Next Hop Nickname</a>
</h1>
<div id="#rfc.figure.11"></div>
<div id="#next_hop_nickname_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|     Type = 0x01       |      Length = 0x02    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|              Next Hop Nickname                |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Next Hop Nickname Format </p>
<p id="rfc.section.5.3.1.1.p.1">For traceroutes targeting known unicast destinations, hop-count errors, and MTU errors, this TLV MUST be the 16-bit nickname of the next hop RBridge the frame is being or would have been sent to. If the RBridge transmitting the TLV is the egress RBridge this field MUST be set to 0x0000. For traceroutes targeting multi-destination destinations, e.g. with the TRILL M bit high, this field contains the nickname of the RBridge the frame being responded to is from. For pings, this field MUST be set to all zeros on transmission and ignored on reception. For multi-destination hop-count errors this field contains the nickname of the RBridge the frame with the exceeded hop-count was sent from. For multi-destination MTU error traffic, this field MUST be set to all zeros on transmission and ignored on reception.  </p>
<h1 id="rfc.section.5.3.1.2">
<a href="#rfc.section.5.3.1.2">5.3.1.2.</a> <a href="#incoming_port_id" id="incoming_port_id">Incoming Port ID</a>
</h1>
<div id="#rfc.figure.12"></div>
<div id="#incoming_port_id_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|     Type = 0x02       |      Length = 0x02    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|               Incoming Port ID                |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Incoming Port ID Format </p>
<p id="rfc.section.5.3.1.2.p.1">This TLV MUST be set to the Port ID found in 'The Special VLANs and Flags sub-TLV' for the port the request being replied to was received on. ( <a href="#I-D.ietf-isis-trill">[I-D.ietf-isis-trill]</a>) </p>
<h1 id="rfc.section.5.3.1.3">
<a href="#rfc.section.5.3.1.3">5.3.1.3.</a> <a href="#outgoing_port_id" id="outgoing_port_id">Outgoing Port ID</a>
</h1>
<div id="#rfc.figure.13"></div>
<div id="#outgoing_port_id_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|     Type = 0x03       |      Length = 0x02    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|               Outgoing Port ID                |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Outgoing Port ID Format </p>
<p id="rfc.section.5.3.1.3.p.1">This TLV MUST be set to the Port ID found in 'The Special VLANs and Flags sub-TLV' for the port the frame is being forwarded on to (or would have been for an echo request/hop-count error). ( <a href="#I-D.ietf-isis-trill">[I-D.ietf-isis-trill]</a>) If the request was consumed by the replying RBridge, the port ID MUST be 0xFFFF.  </p>
<h1 id="rfc.section.5.3.1.4">
<a href="#rfc.section.5.3.1.4">5.3.1.4.</a> <a href="#outgoing_port_mtu" id="outgoing_port_mtu">Outgoing Port MTU</a>
</h1>
<div id="#rfc.figure.14"></div>
<div id="#outgoing_port_mtu_format"></div>
<pre>
                  
| 0  1  2  3  4  5  6  7| 8| 9|     10-15       |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|     Type = 0x04       |      Length = 0x02    |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
|               Outgoing Port MTU               |
+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
            
              </pre>
<p>Outgoing Port MTU Format </p>
<p id="rfc.section.5.3.1.4.p.1">This TLV MUST be the MTU of the outgoing port specified in the outgoing port ID TLV.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.6.p.1">Many people have contributed to this work, including the following, in alphabetic order: Sam Aldrin, Dinesh Dutt, Donald E. Eastlake 3rd, Anoop Ghanwani, Jeff Laird, and Marc Sklar </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">IANA is request to create a new subregistry within the TRILL Parameter registry for "TRILL OAM Message Error Sub-Message Error Specifiers". This subregistry that is initially populated as specified in <a href="#error_specifiers">Section 5.2.2.1</a>.  Additional values are allocated by IETF Review <a href="#RFC5226">[RFC5226]</a>.  </p>
<p id="rfc.section.7.p.2">IANA is requested to create a new subregistry within the TRILL Parameter registry for "TRILL Error Reporting Protocol TLV Types" with initial values as listed in Section 5.3. Additional values are allocated by IETF Review <a href="#RFC5226">[RFC5226]</a>.  </p>
<p id="rfc.section.7.p.3">This draft also requires action to reserve the TRILL OAM Control Channel protocol codes.IANA is requested to allocate the TRILL OAM Channel protocol codes for  as listed in <a href="#protocol_code_values">Section 5.1</a>.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.8.p.1">The nature of the TRILL OAM Message lends itself to security concerns. By providing information about the topology of a network, attackers can gain greater knowledge of a network in order to exploit the network. Passive attacks such as reading frames with an OAM message could be used to gain such knowledge or active attacks where an attacker mimics an RBridge can be used to probe the network. Authentication, data integrity, protection against replay attacks, and confidentiality for TRILL OAM frames may be provided using a to-be-specified TRILL Security Option. Using such a security option would mitigate both the passive and active attacks.  </p>
<p id="rfc.section.8.p.2">For instance, data origin authentication could be provided in the future using a security options in the TRILL Header by verifying a hash using shared keys or a mechanism like SEND with CGA. To prevent replay attacks rate limiting, sequence numbers as well as some nonce based mechanism could be provided. Confidentiality for TRILL OAM frames could be provided based on some future security option extension which encypts TRILL frames.  </p>
<p id="rfc.section.8.p.3">In a network where one does not wish to configure a security option, the threat of attackers is still present. For this reason, generation of any TRILL OAM Message frames is optional and SHOULD be configurable by an operator on a per RBridge basis. An RBridge MAY have this configurable on a per port basis. For instance, an operator SHOULD be able to disable hop-count traceroute reply messages or error notification message generation per port.  </p>
<p id="rfc.section.8.p.4">Another security threat is denial of service through use of OAM messages. For this reason, RBridges MUST rate limit the generation of OAM message frames. For multi-destination frames, the frames MAY be discarded silently to prevent any denial of service atacks in case of an errored packet such as an 'options not recognized' error notification.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-trill-rbridge-protocol">[I-D.ietf-trill-rbridge-protocol]</b></td>
<td class="top">
<a>3rd, D</a>, <a>Dutt, D</a>, <a>Gai, S</a>, <a>Ghanwani, A</a> and <a>R Perlman</a>, "<a href="http://tools.ietf.org/html/draft-ietf-trill-rbridge-protocol-16">Rbridges: Base Protocol Specification</a>", Internet-Draft draft-ietf-trill-rbridge-protocol-16, March 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-isis-trill">[I-D.ietf-isis-trill]</b></td>
<td class="top">
<a>3rd, D</a>, <a>Banerjee, A</a>, <a>Dutt, D</a>, <a>Perlman, R</a> and <a>A Ghanwani</a>, "<a href="http://tools.ietf.org/html/draft-ietf-isis-trill-05">TRILL Use of IS-IS</a>", Internet-Draft draft-ietf-isis-trill-05, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.eastlake-trill-rbridge-channel">[I-D.eastlake-trill-rbridge-channel]</b></td>
<td class="top">
<a>3rd, D</a>, <a>Manral, V</a>, <a>Ward, D</a>, <a>Yizhou, L</a> and <a>S Aldrin</a>, "<a href="http://tools.ietf.org/html/draft-eastlake-trill-rbridge-channel-00">RBridges: OAM Channel Support in TRILL</a>", Internet-Draft draft-eastlake-trill-rbridge-channel-00, March 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="IEEE.802-1ag">[IEEE.802-1ag]</b></td>
<td class="top">
<a>Institute of Electrical and Electronics Engineers</a>, "<a>IEEE Stadard for Local and metropolitian area networks / Virtual Bridged Local Area Networks / Connectivity Fault Management</a>", IEEE Standard 802.1Q, December 2007.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-trill-rbridge-mib">[I-D.ietf-trill-rbridge-mib]</b></td>
<td class="top">
<a>Rijhsinghani, A</a> and <a>K Zebrose</a>, "<a href="http://tools.ietf.org/html/draft-ietf-trill-rbridge-mib-02">Definitions of Managed Objects for RBridges</a>", Internet-Draft draft-ietf-trill-rbridge-mib-02, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC0792">[RFC0792]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc792">Internet Control Message Protocol</a>", STD 5, RFC 792, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4443">[RFC4443]</b></td>
<td class="top">
<a>Conta, A.</a>, <a>Deering, S.</a> and <a>M. Gupta</a>, "<a href="http://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>", RFC 4443, March 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5226">[RFC5226]</b></td>
<td class="top">
<a>Narten, T.</a> and <a>H. Alvestrand</a>, "<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>", BCP 26, RFC 5226, May 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5837">[RFC5837]</b></td>
<td class="top">
<a>Atlas, A.</a>, <a>Bonica, R.</a>, <a>Pignataro, C.</a>, <a>Shen, N.</a> and <a>JR. Rivers</a>, "<a href="http://tools.ietf.org/html/rfc5837">Extending ICMP for Interface and Next-Hop Identification</a>", RFC 5837, April 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#revhis" id="revhis">Revision History</a>
</h1>
<p id="rfc.section.Appendix A.p.1">RFC Editor: Please delete this appendix before publication.</p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> <a href="#revhis0001" id="revhis0001">Changes from -00 to -01</a>
</h1>
<p></p>

<ul class="empty">
<li>Reworked the document to use the OAM Channel rather than an OAM option.  </li>
<li>Changed the frame formats to work within the OAM Channel.  </li>
<li>Numerous minor typo corrections and wording clarifications.  </li>
<li>Removed the route-respond traceroute.  </li>
<li>Combined all the error notifications into one OAM Channel.  </li>
</ul>

<p> </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">David Michael Bond</span> 
	  <span class="n hidden">
		<span class="family-name">Bond</span>
	  </span>
	</span>
	<span class="org vcardline">University of New Hampshire InterOperability Laboratory</span>
	<span class="adr">
	  <span>121 Technology Drive Suite #2</span>

	  <span class="vcardline">
		<span class="locality">Durham</span>,  
		<span class="region">New Hampshire</span> 
		<span class="code">03824</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: +1-603-339-7575</span>

<span class="vcardline">EMail: <a href="mailto:david.bond@iol.unh.edu">david.bond@iol.unh.edu</a></span>

<span class="vcardline">URI: <a href="http://mokon.net">http://mokon.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Vishwas Manral</span> 
	  <span class="n hidden">
		<span class="family-name">Manral</span>
	  </span>
	</span>
	<span class="org vcardline">IP Infusion Inc.</span>
	<span class="adr">
	  <span>1188 E. Arques Ave.</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vishwas@ipinfusion.com">vishwas@ipinfusion.com</a></span>

  </address>
</div>

</body>
</html>