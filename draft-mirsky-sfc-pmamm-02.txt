



SFC  Working Group                                             G. Mirsky
Internet-Draft                                                 ZTE Corp.
Intended status: Standards Track                             G. Fioccola
Expires: March 16, 2018                                   Telecom Italia
                                                              T. Mizrahi
                                                                 Marvell
                                                      September 12, 2017


 Performance Measurement (PM) with Alternate Marking Method in Service
                     Function Chaining (SFC) Domain
                       draft-mirsky-sfc-pmamm-02

Abstract

   This document describes how the alternate marking method be used as
   the passive performance measurement method in a Service Function
   Chaining (SFC) domain.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on March 16, 2018.

Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of



Mirsky, et al.           Expires March 16, 2018                 [Page 1]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Conventions used in this document . . . . . . . . . . . . . .   2
     2.1.  Terminology . . . . . . . . . . . . . . . . . . . . . . .   2
     2.2.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   3.  Mark Field in NSH Base Header . . . . . . . . . . . . . . . .   3
   4.  Theory of Operation . . . . . . . . . . . . . . . . . . . . .   4
     4.1.  Single Mark Enabled Measurement . . . . . . . . . . . . .   4
     4.2.  Double Mark Enabled Measurement . . . . . . . . . . . . .   5
     4.3.  Residence Time Measurement with the Alternate Marking
           Method  . . . . . . . . . . . . . . . . . . . . . . . . .   6
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   6
     5.1.  Mark Field in NSH Base Header . . . . . . . . . . . . . .   6
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   7.  Acknowledgement . . . . . . . . . . . . . . . . . . . . . . .   7
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   7
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .   7
     8.2.  Informative References  . . . . . . . . . . . . . . . . .   7
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   8

1.  Introduction

   [RFC7665] introduced architecture of a Service Function Chain (SFC)
   in the network and defined its components as classifier, Service
   Function Forwarder (SFF), and Service Function (SF).
   [I-D.ietf-ippm-alt-mark] describes passive performance measurement
   method, which can be used to measure packet loss, latency and jitter
   on live traffic.  Because this method is based on marking consecutive
   batches of packets the method often referred as Alternate Marking
   Method (AMM).

   This document defines how the alternate marking method can be used to
   measure packet loss and delay metrics of a service flow over e2e or
   any segment of the SFC.

2.  Conventions used in this document

2.1.  Terminology

   MM: Marking Method

   OAM: Operations, Administration and Maintenance

   SFC: Service Function Chain



Mirsky, et al.           Expires March 16, 2018                 [Page 2]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   SF: Service Function

   SFF: Service Function Forwarder

   SFP: Service Function Path

   NSH: Network Service Header

2.2.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Mark Field in NSH Base Header

   [I-D.ietf-sfc-nsh] defines format of the Network Service Header
   (NSH).

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |Ver|O|R|    TTL    |   Length  | M |R|R|MD Type|     Proto     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                         Figure 1: NSH Base format

   This document defines two bit long field, referred as Mark field (M
   in Figure 1, as part of NSH Base and designated for the alternate
   marking performance measurement method [I-D.ietf-ippm-alt-mark].  The
   Mark field MUST NOT be used in defining forwarding and/or quality of
   service treatment of a SFC packet.  The Mark field MUST be used only
   for the performance measurement of data traffic in SFC layer.
   Because setting of the field to any value does not affect forwarding
   and/or quality of service treatment of a packet, the alternate
   marking method in SFC layer can be viewed as true example of passive
   performance measurement method.

   The Figure 2 displays format of the Mark field.










Mirsky, et al.           Expires March 16, 2018                 [Page 3]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


    0
    0   1
   +-+-+-+-+
   | L | D |
   +-+-+-+-+

                        Figure 2: Mark field format

   where:

   o  L- Loss flag;

   o  D - Delay flag.

4.  Theory of Operation

   The marking method can be successfully used in the SFC.  Without
   limiting any generality consider SFC presented in Figure 3.  Any
   combination of markings, Loss and/or Delay, can be applied to a
   service flow by any component of the SFC at either ingress or egress
   point to perform node, link, segment or end-to-end measurement to
   detect performance degradation defect and localize it efficiently.


                   +---+  +---+   +---+  +---+   +---+  +---+
                   |SF1|  |SF2|   |SF3|  |SF4|   |SF5|  |SF6|
                   +---+  +---+   +---+  +---+   +---+  +---+
                      \   /          \  /           \  /
      +----------+   +----+         +----+         +----+
      |Classifier|---|SFF1|---------|SFF2|---------|SFF3|
      +----------+   +----+         +----+         +----+


                           Figure 3: SFC network

   Using the marking method a component of the SFC creates distinct sub-
   flows in the particular service traffic over SFC.  Each sub-flow
   consists of consecutive blocks that are unambiguously recognizable by
   a monitoring point at any component of the SFC and can be measured to
   calculate packet loss and/or packet delay metrics.

4.1.  Single Mark Enabled Measurement

   As explained in the [I-D.ietf-ippm-alt-mark], marking can be applied
   to delineate blocks of packets based either on equal number of
   packets in a block or based on equal time interval.  The latter
   method offers better control as it allows better account for
   capabilities of downstream nodes to report statistics related to



Mirsky, et al.           Expires March 16, 2018                 [Page 4]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   batches of packets and, at the same time, time resolution that
   affects defect detection interval.

   If the Single Mark measurement used, then the Delay flag Figure 2
   MUST be set to zero on transmit and ignored on reception by
   monitoring point.

   The Loss flag is used to create alternate flows to measure the packet
   loss by switching value of the Loss flag every N-th packet or at
   certain time intervals.  Delay metrics MAY be calculated with the
   alternate flow using any of the following methods:

   o  First/Last Packet Delay calculation: whenever the marking, i.e.
      value of Loss flag, changes a component of the SFC can store the
      timestamp of the first/last packet of the block.  The timestamp
      can be compared with the timestamp of the packet that arrived in
      the same order through a monitoring point at downstream component
      of the SFC to compute packet delay.  Because timestamps collected
      based on order of arrival this method is sensitive to packet loss
      and re-ordering of packets

   o  Average Packet Delay calculation: an average delay is calculated
      by considering the average arrival time of the packets within a
      single block.  A component of the SFC may collect timestamps for
      each packet received within a single block.  Average of the
      timestamp is the sum of all the timestamps divided by the total
      number of packets received.  Then difference between averages
      calculated at two monitoring points is the average packet delay on
      that segment.  This method is robust to out of order packets and
      also to packet loss (only a small error is introduced).  This
      method only provides single metric for the duration of the block
      and it doesn't give the minimum and maximum delay values.  This
      limitation could be overcome by reducing the duration of the block
      by means of an highly optimized implementation of the method.

4.2.  Double Mark Enabled Measurement

   Double Mark method allows measurement of minimum and maximum delays
   for the monitored flow but it requires more nodal and network
   resources.  If the Double Mark method used, then the Loss flag MUST
   be used to create the alternate flow, i.e. mark larger batches of
   packets.  The Delay flag MUST be used to mark single packets to
   measure delay jitter.

   The first marking (Loss flag alternation) is needed for packet loss
   and also for average delay measurement.  The second marking (Delay
   flag is put to one) creates a new set of marked packets that are
   fully identified over the SFC, so that a component can store the



Mirsky, et al.           Expires March 16, 2018                 [Page 5]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   timestamps of these packets; these timestamps can be compared with
   the timestamps of the same packets on another component of the SFC to
   compute packet delay values for each packet.  The number of
   measurements can be easily increased by changing the frequency of the
   second marking.  But the frequency of the second marking must be not
   too high in order to avoid out of order issues.  This method is
   useful to have not only the average delay but also the minimum and
   maximum delay values and, in wider terms, to know more about the
   statistic distribution of delay values.

4.3.  Residence Time Measurement with the Alternate Marking Method

   Residence time is the variable part of the propagation delay that a
   packet experiences traversing a network, e.g.  SFC.  Residence Time
   over an SFC is the sum of the nodal residence times, i.e. periods
   that the packet spent in each of SFFs that compose the SFC.  The
   nodal residence time in SFC itself is the sum of sub-nodal residence
   times that the packet spent in each of SFs that are part of the given
   SFC and are mapped to the SFF.  The residence time and deviation of
   the residence time metrics may include any combination of minimum,
   maximum, values over measurement period, as well as mean, median,
   percentile.  These metrics may be used to evaluate performance of the
   SFC and its elements before and during its operation.

   Use of the specially marked packets simplifies residence time
   measurement and correlation of the measured metrics over the SFC end-
   to-end.  For example, the alternate marking method may be used as
   described in Section 4.2 to identify packets in the data flow to be
   used to measure the residence time.  The nodal and sub-nodal
   residence time metrics can be locally calculated and then collected
   using either in-band or out-band OAM mechanisms.

5.  IANA Considerations

5.1.  Mark Field in NSH Base Header

   This document requests IANA to allocate Mark field as two bits-long
   field from NSH Base Header Reserved Bits [I-D.ietf-sfc-nsh].

   This document requests IANA to register values of the Mark field of
   NSH as the following:










Mirsky, et al.           Expires March 16, 2018                 [Page 6]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   +--------------+---------+--------------------------+---------------+
   | Bit Position | Marking | Description              | Reference     |
   +--------------+---------+--------------------------+---------------+
   |      0       |    S    | Single Mark Measurement  | This document |
   |      1       |    D    | Double Mark Measurement  | This document |
   +--------------+---------+--------------------------+---------------+

                      Table 1: Mark field of SFC NSH

6.  Security Considerations

   This document lists the OAM requirement for SFC domain and does not
   raise any security concerns or issues in addition to ones common to
   networking and SFC.

7.  Acknowledgement

   TBD

8.  References

8.1.  Normative References

   [I-D.ietf-sfc-nsh]
              Quinn, P., Elzur, U., and C. Pignataro, "Network Service
              Header (NSH)", draft-ietf-sfc-nsh-20 (work in progress),
              September 2017.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

8.2.  Informative References

   [I-D.ietf-ippm-alt-mark]
              Fioccola, G., Capello, A., Cociglio, M., Castaldelli, L.,
              Chen, M., Zheng, L., Mirsky, G., and T. Mizrahi,
              "Alternate Marking method for passive and hybrid
              performance monitoring", draft-ietf-ippm-alt-mark-10 (work
              in progress), September 2017.






Mirsky, et al.           Expires March 16, 2018                 [Page 7]

Internet-Draft   PM with Alternate Marking Method in SFC  September 2017


   [RFC7665]  Halpern, J., Ed. and C. Pignataro, Ed., "Service Function
              Chaining (SFC) Architecture", RFC 7665,
              DOI 10.17487/RFC7665, October 2015,
              <https://www.rfc-editor.org/info/rfc7665>.

Authors' Addresses

   Greg Mirsky
   ZTE Corp.

   Email: gregimirsky@gmail.com


   Giuseppe Fioccola
   Telecom Italia

   Email: giuseppe.fioccola@telecomitalia.it


   Tal Mizrahi
   Marvell
   6 Hamada St.
   Yokneam
   Israel

   Email: talmi@marvell.com

























Mirsky, et al.           Expires March 16, 2018                 [Page 8]
