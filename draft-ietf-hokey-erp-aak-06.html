<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>EAP Re-authentication Protocol Extensions for Authenticated Anticipatory Keying (ERP/AAK)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Standards Language">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Acronyms">
<link href="#rfc.section.3" rel="Chapter" title="3 ERP/AAK Overview">
<link href="#rfc.section.4" rel="Chapter" title="4 ERP/AAK Key Hierarchy">
<link href="#rfc.section.5" rel="Chapter" title="5 Packet and TLV Extension">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 EAP-Initiate/Re-auth-Start Packet Extension">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 EAP-Initiate/Re-auth Packet Extension">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 EAP-Finish/Re-auth extension">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 TV and TLV Attributes">
<link href="#rfc.section.6" rel="Chapter" title="6 Lower Layer Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 AAA Transport Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Security Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Acknowledgement">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods.  " />
  <meta name="description" content="The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">Z. Cao</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">H. Deng</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">China Mobile</td>
</tr>
<tr>
<td class="left">Expires: April 23, 2012</td>
<td class="right">Y. Wang</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Q. Wu</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei Technologies Co., Ltd.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">G. Zorn, Ed.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Network Zen</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 21, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">EAP Re-authentication Protocol Extensions for Authenticated Anticipatory Keying (ERP/AAK)<br />
  <span class="filename">draft-ietf-hokey-erp-aak-06</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The Extensible Authentication Protocol (EAP) is a generic framework supporting multiple types of authentication methods.  <br><br> The EAP Re-authentication Protocol (ERP) specifies extensions to EAP and the EAP keying hierarchy to support an EAP method-independent protocol for efficient re-authentication between the peer and an EAP re-authentication server through any authenticator.  <br><br> Authenticated Anticipatory Keying (AAK) is a method by which cryptographic keying material may be established upon one or more candidate attachment points (CAPs) prior to handover.  AAK uses the AAA infrastructure for key transport.  <br><br> This document specifies the extensions necessary to enable AAK support in ERP.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 23, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Standards Language</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Acronyms</a>
</li>
<li>3.   <a href="#rfc.section.3">ERP/AAK Overview</a>
</li>
<li>4.   <a href="#rfc.section.4">ERP/AAK Key Hierarchy</a>
</li>
<li>5.   <a href="#rfc.section.5">Packet and TLV Extension</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">EAP-Initiate/Re-auth-Start Packet Extension</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">EAP-Initiate/Re-auth Packet Extension</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">EAP-Finish/Re-auth extension</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">TV and TLV Attributes</a>
</li>
<li>6.   <a href="#rfc.section.6">Lower Layer Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">AAA Transport Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Security Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Acknowledgement</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The Extensible Authentication Protocol (EAP) <a href="#RFC3748">[RFC3748]</a> is a generic framework supporting multiple types of authentication methods.  In systems where EAP is used for authentication, it is desirable to not repeat the entire EAP exchange with another authenticator.  The EAP Re-authentication Protocol (ERP) <a href="#RFC5296">[RFC5296]</a> specifies extensions to EAP and the EAP keying hierarchy to support an EAP method-independent protocol for efficient re-authentication between the peer and an EAP re-authentication server through any authenticator.  The re-authentication server may be in the home network or in the local network to which the peer is connecting.  <br><br> Authenticated Anticipatory Keying (AAK) <a href="#RFC5836">[RFC5836]</a> is a method by which cryptographic keying materials may be established prior to handover upon one or more candidate attachment points (CAPs).  AAK utilizes the AAA infrastructure for key transport.  <br><br> This document specifies the extensions necessary to enable AAK support in ERP.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Standards Language</h1>
<p id="rfc.section.2.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Acronyms</h1>
<p id="rfc.section.2.2.p.1">The following acronyms are used in this document; see the references for more details.  </p>

<dl>
<dt>AAA</dt>
<dd style="margin-left: 4">Authentication, Authorization and Accounting <a href="#RFC3588">[RFC3588]</a> </dd>
<dt>CAP</dt>
<dd style="margin-left: 4">Candidate Attachment Point <a href="#RFC5836">[RFC5836]</a> </dd>
<dt>EA</dt>
<dd style="margin-left: 4">Abbreviation for "ERP/AAK"; used in figures </dd>
<dt>MH</dt>
<dd style="margin-left: 4">Mobile Host </dd>
<dt>SAP</dt>
<dd style="margin-left: 4">Serving Attachment Point <a href="#RFC5836">[RFC5836]</a> </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> ERP/AAK Overview</h1>
<div id="#rfc.figure.1"></div>
<div id="#fig_1"></div>
<pre>     
+------+         +-----+        +-----+          +-----------+
| Peer |         | SAP |        | CAP |          | EA Server |
+--+---+         +--+--+        +--+--+          +-----+-----+
   |                |              |                   |
1. | [EAP-Initiate/ |              |                   |
   | Re-auth-start  |              |                   |
   | (E-flag)       |              |                   |
   |&lt;---------------|              |                   |
   |                |              |                   |
2. | EAP-Initiate/  |              |                   |
   | Re-auth        |              |                   |
   | (E-flag)       |              |                   |
   |---------------&gt;|              |                   |
3. |                | AAA(EAP-Initiate/Re-auth(E-flag))| 
   |                |---------------------------------&gt;|
   |                |              |         +---------+---------+
   |                |              |         | CA authorized &amp;   |
4. |                |              |         | authenticated;    |
   |                |              |         | EA keying         |
   |                |              |         | materials derived |
   |                |              |         +---------+---------+
5. |                |              |                   |
   |                |              |     AAA(pMSK)     |
   |                |              |&lt;-----------------&gt;|
   |                |              |                   |
6. |                | AAA (EAP-Finish/Re-auth(E-flag)) |
   |                |&lt;---------------------------------|
7. | EAP-Finish/    |              |                   |
   | Re-auth(E-flag)|              |                   |
   |&lt;---------------|              |                   |
   |                |              |                   |
</pre>
<p id="rfc.section.3.p.1">ERP/AAK is intended to allow the establishment of cryptographic keying materials on a single Candidate Attachment Points prior to the arrival of the MH at the Candidate Access Network (CAN).  <br><br> It is assumed that the peer has previously completed full EAP authentication and the peer or SAP knows the identities of neighboring attachment points.  <a href="#fig_1">Figure 1</a> shows the general protocol exchange by which the keying material is established on the CAP. This document only discusses the case of distributing the key to a single CAP.  <br><br> The SAP may send the identity of a candidate attachment point to the peer in the EAP-Initiate/Re-auth-Start message.  If the EAP-Initiate/Re-auth-Start packet is not supported by the peer, it is silently discarded.  <br><br> The peer sends an early-authentication request message (EAP-Initiate/Re-auth with the &#8216;E&#8217; flag set) containing the keyName-NAI, the CAP-Identifier, rIK and sequence number. The realm in the keyName-NAI field is used to locate the peer&#8217;s ERP/AAK server. The CAP-Identifier is used to identify the CAP. The rIK is used to protect the message. The sequence number is used for replay protection.  <br><br> The SAP encapsulates the early-authentication message into a AAA message and sends it to the peer&#8217;s ERP/AAK server in the realm indicated in the keyName-NAI field.  <br><br> Upon receiving the message, the ERP/AAK server first checks its integrity and freshness, then verifies the identity of the peer by checking the username portion of the KeyName-NAI.  Next, the server authenticates and authorizes the CAP specified in the CAP-Identifier TLV.  If any of the checks fail, the server sends an early-authentication finish message (EAP-Finish/Re-auth with E-flag set) with the Result flag set to '1'.  <br><br> The ERP/AAK server transports the pMSK to the authenticated and authorized CAP via AAA as described in <a href="#AAA">Section 7</a>.  <br><br> Finally, the ERP/AAK server sends the early-authentication finish message (EAP-Finish/Re-auth with E-flag set) containing the identity of the authorized CAP to the peer via the SAP.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> ERP/AAK Key Hierarchy</h1>
<div id="#rfc.figure.2"></div>
<div id="#KH1"></div>
<pre>
    DSRK    EMSK
     |       |
 +---+---+---+---+
 |       |       |
pRK     rRK     ...
</pre>
<div id="#rfc.figure.3"></div>
<div id="#KH2"></div>
<pre>
         pRK
          |
 +--------+--------+
 |        |        |
pIK     pMSK      ...
</pre>
<p id="rfc.section.4.p.1">As an optimization of ERP, ERP/AAK uses a key hierarchy similar to that of ERP.  The EMSK is used to derive the ERP/AAK pre-established Root Key (pRK).  Similarly, the ERP/AAK pre-established Integrity Key (pIK) and the pre-established Master Session Key (pMSK) are derived from the pRK.  The pMSK is established for the CAP when the peer early authenticates to the network.  The pIK is established for the peer to re-authenticate the network after handover.  The hierarchy relationship is illustrated in <a href="#KH1">Figure 2</a>, below.  <a href="#I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</a>.  If the peer has previously been authenticated by means of ERP or ERP/AAK, the DSRK SHOULD be directly re-used.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Packet and TLV Extension</h1>
<p id="rfc.section.5.p.1">This section describes the packet and TLV extensions for the ERP/AAK exchange.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> EAP-Initiate/Re-auth-Start Packet Extension</h1>
<p><a href="#StartPacket">Figure 4</a> shows the changed parameters contained in the EAP-Initiate/Re-auth-Start packet defined in <a href="#RFC5296">RFC 5296</a> <cite title="NONE">[RFC5296]</cite>.  </p>
<div id="#rfc.figure.4"></div>
<div id="#StartPacket"></div>
<pre>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |E| Reserved    |     1 or more TVs or TLVs     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.5.1.p.2">Flags</p>
<p id="rfc.section.5.1.p.3">&#8216;E&#8217; &#8211; The E flag is used to indicate early-authentication.</p>
<p id="rfc.section.5.1.p.4">Reserved: MUST be set to 0.</p>
<p id="rfc.section.5.1.p.5">TVs and TLVs</p>
<p id="rfc.section.5.1.p.6">CAP-Identifier: Carried in a TLV payload. The format is identical to that of a DiameterIdentity <a href="#RFC3588">[RFC3588]</a>.  It is used by the SAP to advertise the identity of the CAP to the peer.  Exactly one CAP-Identifier TLV MAY be included in the EAP-Initiate/Re-auth-Start packet if the SAP has performed CAP discovery.  </p>
<p id="rfc.section.5.1.p.7">If the EAP-Initiate/Re-auth-Start packet is not supported by the peer, it is discarded silently.  </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#EIRaPE" id="EIRaPE">EAP-Initiate/Re-auth Packet Extension</a>
</h1>
<p><a href="#ReauthPacket">Figure 5</a> illustrates the changed parameters contained in the EAP-Initiate/Re-auth packet defined in <a href="#RFC5296">RFC 5296</a> <cite title="NONE">[RFC5296]</cite>.  </p>
<div id="#rfc.figure.5"></div>
<div id="#ReauthPacket"></div>
<pre>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|x|L|E|Resved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite  |         Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.5.2.p.2">Flags</p>
<p id="rfc.section.5.2.p.3">'x' &#8211; The x flag is reserved. It MUST be set to 0.</p>
<p id="rfc.section.5.2.p.4">'E&#8217; &#8211; The E flag is used to indicate early-authentication.</p>
<p id="rfc.section.5.2.p.5">The rest of the 4 bits (Resved) MUST be set to 0 and ignored on reception.</p>
<p id="rfc.section.5.2.p.6">SEQ</p>
<p id="rfc.section.5.2.p.7">A 16-bit sequence number is used for replay protection.</p>
<p id="rfc.section.5.2.p.8">TVs and TLVs</p>
<p id="rfc.section.5.2.p.9">keyName-NAI: As defined in <a href="#RFC5296">RFC 5296</a> <cite title="NONE">[RFC5296]</cite>, this is carried in a TLV payload. The Type is 1.  The NAI is variable in length, not exceeding 253 octets.  The username part of the NAI is the EMSKname used to identify the peer.  The realm part of the NAI is the peer&#8217;s home domain name or the domain to which the peer is currently attached.  Exactly one keyName-NAI attribute SHALL be present in an EAP-Initiate/Re-auth packet.  </p>
<p id="rfc.section.5.2.p.10">CAP-Identifier: Carried in a TLV payload.  It is used to indicate the FQDN of a CAP.  </p>
<p id="rfc.section.5.2.p.11">Sequence number: Carried in a TV payload. The Type is TBD (less than 128). It is used in the derivation of the pMSK for each CAP.  Each CAP-Identifier in the packet MUST be associated with a unique sequence number.  </p>
<p id="rfc.section.5.2.p.12">Cryptosuite</p>
<p id="rfc.section.5.2.p.13">This field indicates the integrity algorithm used for ERP/AAK. Key lengths and output lengths are either indicated or obvious from the cryptosuite name. We specify some cryptosuites below: </p>

<dl>
<dt>0</dt>
<dd style="margin-left: 8">RESERVED</dd>
<dt>1</dt>
<dd style="margin-left: 8">HMAC-SHA256-64</dd>
<dt>2</dt>
<dd style="margin-left: 8">HMAC-SHA256-128</dd>
<dt>3</dt>
<dd style="margin-left: 8">HMAC-SHA256-256</dd>
</dl>

<p> </p>
<p id="rfc.section.5.2.p.14">HMAC-SHA256-128 is mandatory to implement and should be enabled in the default configuration.  </p>
<p id="rfc.section.5.2.p.15">Authentication Tag</p>
<p id="rfc.section.5.2.p.16">This field contains the integrity checksum over the ERP/AAK packet, excluding the authentication tag field itself. The length of the field is indicated by the Cryptosuite.  </p>
<p id="rfc.section.5.2.p.17">If the EAP-Initiate/Re-auth packet is not supported by the SAP, it is discarded silently.  </p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> EAP-Finish/Re-auth extension</h1>
<div id="#rfc.figure.6"></div>
<div id="#FinishPacket"></div>
<pre>   
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Code      |  Identifier   |            Length             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     Type      |R|x|L|E|Resved |             SEQ               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                 1 or more TVs or TLVs                         ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Cryptosuite  |         Authentication Tag                     ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p><a href="#FinishPacket">Figure 6</a> shows the changed parameters contained in the EAP-Finish/Re-auth packet defined in <a href="#RFC5296">[RFC5296]</a>.  </p>
<p id="rfc.section.5.3.p.2">Flags</p>
<p id="rfc.section.5.3.p.3">'x' &#8211; The x flag is reserved. It MUST be set to 0.</p>
<p id="rfc.section.5.3.p.4">&#8216;E&#8217; &#8211; The E flag is used to indicate early-authentication.</p>
<p id="rfc.section.5.3.p.5">The rest of the 4 bits (Resved) MUST be set to 0 and ignored on reception.</p>
<p id="rfc.section.5.3.p.6">SEQ</p>
<p id="rfc.section.5.3.p.7">A 16-bit sequence number is used for replay protection.</p>
<p id="rfc.section.5.3.p.8">TVs and TLVs</p>
<p id="rfc.section.5.3.p.9">keyName-NAI: As defined in <a href="#RFC5296">RFC 5296</a> <cite title="NONE">[RFC5296]</cite>, this is carried in a TLV payload. The Type is 1. The NAI is variable in length, not exceeding 253 octets. The realm part of the NAI is the home domain name. Exactly one keyName-NAI attribute SHALL be present in an EAP-Finish/Re-auth packet.  </p>
<div id="#rfc.figure.7"></div>
<pre>
ERP/AAK-Key ::= 
     { sub-TLV: CAP-Identifier }
     { sub-TLV: pMSK-lifetime }
     { sub-TLV: pRK-lifetime }
     { sub-TLV: Cryptosuites }
</pre>
<p id="rfc.section.5.3.p.10">ERP/AAK-Key: Carried in a TLV payload for the key container. The type is TBD.  Exactly one ERP/AAK-key SHALL be present in an EAP-Finish/Re-auth packet.  </p>

<dl>
<dt>CAP-Identifier</dt>
<dd style="margin-left: 8">
<br> Carried in a sub-TLV payload.  It is used to indicate the identifier of the candidate authenticator. There exactly one instance of the CAP-Identifier TLV MUST be present in the ERP/AAK-Key TLV.  </dd>
<dt>pMSK-lifetime</dt>
<dd style="margin-left: 8">
<br> Carried in a sub-TLV payload. The Type is TBD. The value field is a 32-bit field and contains the lifetime of the pMSK in seconds. If the 'L' flag is set, the pMSK Lifetime attribute SHOULD be present.  </dd>
<dt>pRK-lifetime</dt>
<dd style="margin-left: 8">
<br> Carried in a sub-TLV payload. The Type is TBD. The value field is a 32-bit field and contains the lifetime of the pRK in seconds. If the 'L' flag is set, the pRK Lifetime attribute SHOULD be present.  </dd>
<dt>List of Cryptosuites</dt>
<dd style="margin-left: 8">
<br> Carried in a sub-TLV payload. The Type is 5 <a href="#RFC5296">[RFC5296]</a>.  The value field contains a list of cryptosuites, each 1 octet in length.  The allowed cryptosuite values are as specified in <a href="#EIRaPE">Section 5.2</a>, above.  The server SHOULD include this attribute if the cryptosuite used in the EAP-Initiate/Re-auth message was not acceptable and the message is being rejected. The server MAY include this attribute in other cases. The server MAY use this attribute to signal to the peer about its cryptographic algorithm capabilities.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.3.p.11">Cryptosuite </p>
<p id="rfc.section.5.3.p.12">This field indicates the integrity algorithm and PRF used for ERP/AAK.  Key lengths and output lengths are either indicated or obvious from the cryptosuite name.  </p>
<p id="rfc.section.5.3.p.13">Authentication Tag</p>
<p id="rfc.section.5.3.p.14">This field contains the integrity checksum over the ERP/AAK packet, excluding the authentication tag field itself. The length of the field is indicated by the Cryptosuite.  </p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> TV and TLV Attributes</h1>
<p id="rfc.section.5.4.p.1">With the exception of the rRK Lifetime and rMSK Lifetime TV payloads, the attributes specified in <a href="#RFC5296">Section 5.3.4 of </a> <cite title="NONE">[RFC5296]</cite> also apply to this document. In this document, new attributes which may be present in the EAP-Initiate and EAP-Finish messages are defined as below: </p>

<ul>
<li>Sequence number: This is a TV payload. The type is TBD.</li>
<li>ERP/AAK-Key: This is a TLV payload. The type is TBD.</li>
<li>pRK Lifetime: This is a TV payload. The type is TBD.  </li>
<li>pMSK Lifetime: This is a TV payload. The type is TBD.  </li>
<li>List of Cryptosuites: This is a TLV payload. The type is TBD.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Lower Layer Considerations</h1>
<p id="rfc.section.6.p.1">Similar to ERP, some lower layer specifications may need to be revised to support ERP/AAK; refer to of <a href="#RFC5296">Section 6</a> <cite title="NONE">[RFC5296]</cite> for additional guidance.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#AAA" id="AAA">AAA Transport Considerations</a>
</h1>
<p id="rfc.section.7.p.1">AAA transport of ERP/AAK messages is the same as AAA transport of the ERP message <a href="#RFC5296">[RFC5296]</a>. In addition, the document requires AAA transport of the ERP/AAK keying materials delivered by the ERP/AAK server to the CAP.  Hence, a new Diameter ERP/AAK application message should be specified to transport the keying materials.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Security Considerations</h1>
<p id="rfc.section.8.p.1">This section provides an analysis of the protocol in accordance with the AAA key management requirements specified in RFC 4962 <a href="#RFC4962">[RFC4962]</a>.  </p>
<p></p>

<ul>
<li>Cryptographic algorithm independence: ERP-AAK satisfies this requirement.  The algorithm chosen by the peer is indicated in the EAP-Initiate/Re-auth message.  If the chosen algorithm is unacceptable, the EAP server returns an EAP- Finish/Re-auth message with Failure indication.  </li>
<li>Strong, fresh session keys: ERP-AAK results in the derivation of strong, fresh keys that are unique for the given CAP.  An pMSK is always derived on-demand when the peer requires a key with a new CAP.  The derivation ensures that the compromise of one pMSK does not result in the compromise of a different pMSK at any time.  </li>
<li>Limit key scope: The scope of all the keys derived by ERP-AAK is well defined.  The pRK is used to derive the pIK and pMSK for the CAP.  Different sequence numbers for each CAP MUST be used to derive a unique pMSK.  </li>
<li>Replay detection mechanism: For replay protection of ERP-AAK messages, a sequence number associated with the pMSK is used.  </li>
<li>Authenticate all parties: The EAP Re-auth Protocol provides mutual authentication of the peer and the server. The peer and SAP are authenticated via ERP.  The CAP is authenticated and trusted by the SAP.  </li>
<li>Peer and authenticator authorization: The peer and authenticator demonstrate possession of the same key material without disclosing it, as part of the lower layer secure authentication protocol.  </li>
<li>Keying material confidentiality: The peer and the server derive the keys independently using parameters known to each entity.  </li>
<li>Uniquely named keys: All keys produced within the ERP context can be referred to uniquely as specified in this document.  </li>
<li>Prevent the domino effect: Different sequence numbers for each CAP MUST be used to derive the unique pMSK.  So the compromise of one pMSK does not hurt any other CAP.  </li>
<li>Bind key to its context: the pMSK are bound to the context in which the sequence numbers are transmitted.  </li>
<li>Confidentiality of identity: this is the same as with the ERP protocol <a href="#RFC5296">[RFC5296]</a>.  </li>
<li>Authorization restriction: All the keys derived are limited in lifetime by that of the parent key or by server policy.  Any domain-specific keys are further restricted to be used only in the domain for which the keys are derived.   Any other restrictions of session keys may be imposed by the specific lower layer and are out of scope for this specification.  </li>
</ul>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">IANA is requested to assign four TLV type values from the registry of EAP Initiate and Finish Attributes maintained at http://www.iana.org/assignments/eap-numbers/eap-numbers.xml.  <br> New TLV types: </p>

<ul>
<li>Sequence number</li>
<li>ERP/AAK-Key</li>
<li>pRK Lifetime</li>
<li>pMSK Lifetime</li>
</ul>

<p> </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Acknowledgement</h1>
<p id="rfc.section.10.p.1">In writing this document, we have received reviews from many experts in the IETF, including Tom Taylor, Tena Zou, Tim Polk, Tan Zhang and Semyon Mizikovsky.  We apologize if we miss some of those who have helped us.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5296">[RFC5296]</b></td>
<td class="top">
<a>Narayanan, V.</a> and <a>L. Dondeti</a>, "<a href="http://tools.ietf.org/html/rfc5296">EAP Extensions for EAP Re-authentication Protocol (ERP)</a>", RFC 5296, August 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5836">[RFC5836]</b></td>
<td class="top">
<a>Ohba, Y.</a>, <a>Wu, Q.</a> and <a>G. Zorn</a>, "<a href="http://tools.ietf.org/html/rfc5836">Extensible Authentication Protocol (EAP) Early Authentication Problem Statement</a>", RFC 5836, April 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-dime-local-keytran">[I-D.ietf-dime-local-keytran]</b></td>
<td class="top">
<a>Zorn, G</a>, <a>Wu, W</a> and <a>V Cakulev</a>, "<a href="http://tools.ietf.org/html/draft-ietf-dime-local-keytran-14">Diameter Attribute-Value Pairs for Cryptographic Key Transport</a>", Internet-Draft draft-ietf-dime-local-keytran-14, August 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3588">[RFC3588]</b></td>
<td class="top">
<a>Calhoun, P.</a>, <a>Loughney, J.</a>, <a>Guttman, E.</a>, <a>Zorn, G.</a> and <a>J. Arkko</a>, "<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>", RFC 3588, September 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3748">[RFC3748]</b></td>
<td class="top">
<a>Aboba, B.</a>, <a>Blunk, L.</a>, <a>Vollbrecht, J.</a>, <a>Carlson, J.</a> and <a>H. Levkowetz</a>, "<a href="http://tools.ietf.org/html/rfc3748">Extensible Authentication Protocol (EAP)</a>", RFC 3748, June 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4962">[RFC4962]</b></td>
<td class="top">
<a>Housley, R.</a> and <a>B. Aboba</a>, "<a href="http://tools.ietf.org/html/rfc4962">Guidance for Authentication, Authorization, and Accounting (AAA) Key Management</a>", BCP 132, RFC 4962, July 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Zhen Cao</span> 
	  <span class="n hidden">
		<span class="family-name">Cao</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>53A Xibianmennei Ave., Xuanwu District</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region">Beijing</span> 
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:zehn.cao@gmail.com">zehn.cao@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Hui Deng</span> 
	  <span class="n hidden">
		<span class="family-name">Deng</span>
	  </span>
	</span>
	<span class="org vcardline">China Mobile</span>
	<span class="adr">
	  <span>53A Xibianmennei Ave., Xuanwu District</span>

	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region">Beijing</span> 
		<span class="code">100053</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:denghui02@gmail.com">denghui02@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yungui Wang</span> 
	  <span class="n hidden">
		<span class="family-name">Wang</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd.</span>
	<span class="adr">
	  <span>Floor 10, HuiHong Mansion, No.91 BaiXia Rd.</span>

	  <span class="vcardline">
		<span class="locality">Nanjing</span>,  
		<span class="region">Jiangsu</span> 
		<span class="code">210001</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">Phone: +86 25 84565893</span>

<span class="vcardline">EMail: <a href="mailto:w52006@huawei.com">w52006@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Qin Wu</span> 
	  <span class="n hidden">
		<span class="family-name">Wu</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd.</span>
	<span class="adr">
	  <span>Floor 12, HuiHong Mansion, No.91 BaiXia Rd.</span>

	  <span class="vcardline">
		<span class="locality">Nanjing</span>,  
		<span class="region">Jiangsu</span> 
		<span class="code">210001</span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">Phone: +86 25 84565892</span>

<span class="vcardline">EMail: <a href="mailto:bill.wu@huawei.com">bill.wu@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Glen Zorn</span> editor
	  <span class="n hidden">
		<span class="family-name">Zorn</span>
	  </span>
	</span>
	<span class="org vcardline">Network Zen</span>
	<span class="adr">
	  <span>227/358 Thanon Sanphawut</span>

	  <span class="vcardline">
		<span class="locality">Bang Na</span>,  
		<span class="region">Bangkok</span> 
		<span class="code">10260</span>
	  </span>
	  <span class="country-name vcardline">Thailand</span>
	</span>
	<span class="vcardline">Phone: +66 (0) 87-040-4617</span>

<span class="vcardline">EMail: <a href="mailto:glenzorn@gmail.com">glenzorn@gmail.com</a></span>

  </address>
</div>

</body>
</html>