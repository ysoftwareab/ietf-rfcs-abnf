D = AES-CMAC(K, <zero>)
D = dbl(D) xor AES-CMAC(K, Si)
T = Sn xorend D
T = dbl(D) xor pad(Sn)
SALT=leftmost(X,96)

n=rightmost(X,32)

SALT=leftmost(X,64)

n=rightmost(X,64)

K1 = leftmost(K, len(K)/2)
K2 = rightmost(K, len(K)/2)
V = S2V(K1, AD1, ..., ADn, P)
Q = V bitand (1^64 || 0^1 || 1^31 || 0^1 || 1^31)
m = (len(P) + 127)/128

Xi = AES(K2, Q+i)
X = leftmost(X0 || ... || Xm-1, len(P))
C = P xor X

V = leftmost(Z, 128)
C = rightmost(Z, len(Z)-128)
K1 = leftmost(K, len(K)/2)
K2 = rightmost(K, len(K)/2)
Q = V bitand (1^64 || 0^1 || 1^31 || 0^1 || 1^31)

m = (len(C) + 127)/128
Xi = AES(K2, Q+i)
X = leftmost(X0 || ... || Xm-1, len(C))
P = C xor X
T = S2V(K1, AD1, ..., ADn, P)

