



SPRING Working Group                                               Z. Li
Internet-Draft                                                     C. Li
Intended status: Standards Track                     Huawei Technologies
Expires: October 22, 2021                                 April 20, 2021


              Extensions for SRv6 traversing IPv4 network
                 draft-li-spring-srv6-traverse-ipv4-00

Abstract

   As the development of cloud computing, increasing services have been
   migrated from enterprise sites to clouds, so the connections between
   sites and clouds are critical for enterprises.

   SRv6 provides a sourcing routing mechanism to connect the enterprise
   sites and clouds by programming the end-to-end path at the ingress
   node.  In this scenario, the SRv6 packets may traverse multiple
   network domains and some of them may not be SRv6-capable.

   In order to support SRv6 end-to-end path programming, this document
   proposes the mechanism of SRv6 traversing IPv4 network.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on October 22, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (https://trustee.ietf.org/license-info) in effect on the date of



Li & Li                 Expires October 22, 2021                [Page 1]

Internet-Draft            SRv6 traversing IPv4                April 2021


   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   3
     2.1.  Requirements Language . . . . . . . . . . . . . . . . . .   3
   3.  IPv4 Path Programming in SRv6 . . . . . . . . . . . . . . . .   3
     3.1.  End.B4  . . . . . . . . . . . . . . . . . . . . . . . . .   3
     3.2.  End.4 . . . . . . . . . . . . . . . . . . . . . . . . . .   4
       3.2.1.  IPv4 Tunnel Information Encapsulation . . . . . . . .   5
       3.2.2.  IPv4 Tunnel Information in SRH TLV  . . . . . . . . .   6
   4.  Illustration  . . . . . . . . . . . . . . . . . . . . . . . .   6
   5.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   7
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   7
   7.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   8
   8.  References  . . . . . . . . . . . . . . . . . . . . . . . . .   8
     8.1.  Normative References  . . . . . . . . . . . . . . . . . .   8
     8.2.  Informative References  . . . . . . . . . . . . . . . . .   8
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   9

1.  Introduction

   When segment routing (SR) [RFC8402] is deployed on the IPv6 data
   plane, it is called SRv6 [RFC8754].  For support of SR, a new routing
   header called Segment Routing Header (SRH), which contains a list of
   SIDs and other information, has been defined in [RFC8754].

   When deploying SRv6, the SRv6 network may need to interwork with
   exiting networks, such as MPLS netwoks and IPv4 networks.

   With the development of cloud computing, increasing services have
   been migrated from enterprises to cloud data centers.  Compared with
   interconnections between branches and headquarters, new connections
   between enterprise sites to cloud data centers and inter-cloud are
   added, which bring new requirements and challenges for existing
   networks.  [I-D.li-rtgwg-ipv6-based-con] describes the requirements
   and candidate technologies in IPv6-based Cloud-oriented Networking
   (CON).  In IPv6-based CON, SRv6 can be used to connect enterprise
   sites and clouds.  In this scenario, an SRv6 packet may be forwarded
   traversing IPv4 domains.





Li & Li                 Expires October 22, 2021                [Page 2]

Internet-Draft            SRv6 traversing IPv4                April 2021


   The Tunnel Segment is defined in [I-D.li-spring-tunnel-segment] to
   associate a tunnel to a segment in SRv6 and SR-MPLS, therefore, its
   dataplane is IPv6 or MPLS.  The document defines the a new types of
   tunnel segment to associate an IPv4 tunnel to an SRv6 SID for
   supporting end-to-end path programming traversing IPv4 domains.
   Furthermore, this document also defines the mechanism of encoding the
   IPv4 tunnel information in the SRH at the source node to provide
   better source routing programming.

2.  Terminology

   This document makes use of the terms defined in [RFC8986], and the
   reader is assumed to be familiar with that terminology.

2.1.  Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in BCP
   14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  IPv4 Path Programming in SRv6

   This document defines the following mechanisms for SRv6 traversing
   IPv4 networks.

3.1.  End.B4

   This document defines a new End.B4 (End bound to an IPv4 tunnel)
   behavior for an SRv6 SID bound to an IPv4 tunnel.

   End.B4 SID MUST NOT be the last SID in the segment list.  When the
   node receives a packet with End.B4 SID, the packet is steered into
   the bound IPv4 tunnel.

   When node N receives a packet whose IPv6 DA is S and S is a local
   End.B4 SID, the line S15 - S16 from the End processing [RFC8986] is
   replaced by the following:

      S15.   Encapsulates the SRv6 packet with a new IPv4 tunnel
             encapsulation bound to the End.B4 SID S.
      S16.   Submit the packet to the IPv4 module for transmission

      S17. }






Li & Li                 Expires October 22, 2021                [Page 3]

Internet-Draft            SRv6 traversing IPv4                April 2021


3.2.  End.4

   Another option is to carry the IPv4 tunnel information in the SRH.
   The IPv4 tunnel information can be encoded in another 128-bit value
   following the SID or SRH TLVs.

   In this revision, this section defines an End.4 (End function with
   IPv4 tunnel instantiation) behavior for an SRv6 SID to indicate a
   128-bit IPv4 tunnel information is encoded following the SID.

   An End.4 SID MUST be encoded preceding the IPv4 tunnel information
   encapsulation, thus it can not be the last SID in the SID list.  In
   addition, the IPv6 address is needed to be updated by the next SRv6
   SID, therefore the IPv4 tunnel information encapsulation MUST NOT be
   the last SID as well.

   The SRv6 path of crossing IPv4 domain is called IPv4 sub-path.  An
   IPv4 sub-path is encoded by an END.4 SID and the following IPv4
   tunnel information encapsulation as shown in the following figure.

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        IPv4 tunnel info                       |
       |                                                               |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                        SRv6 End.4 SID                         |
       |                                                               |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
              Figure 1. IPv4 Tunnel Sub-path Encoding in SRH


   When encoding the end-to-end forwarding path, the ingress encodes the
   End.4 SID and related IPv4 tunnel info into the SID list, the
   encoding of IPv4 tunnel information is shown in section 3.2.1.

   When a node processes an End.4 SID, it encapsulates the SRv6 packet
   with an IPv4 tunnel header using the information carried by the IPv4
   tunnel information, decreases the SL accordingly and then sends the
   packet by looking up the IPv4 destination address in the IPv4 header.

   When node N receives a packet whose IPv6 DA is S and S is a local
   End.B4 SID, the line S02 from the End processing [RFC8986] is
   replaced by the following:



Li & Li                 Expires October 22, 2021                [Page 4]

Internet-Draft            SRv6 traversing IPv4                April 2021


      S02.   If (Segments Left == 0 or 1)

   The lines S13-S16 are replaced by the following pseudo code.

      S13.   Decrement SL by 2
      S14.   Update IPv6 DA with Segment List[Segments Left]
      S15.   Encapsulates the SRv6 packet with a new IPv4 tunnel
                  by using the IPv4 tunnel information
      S16.   Submit the packet to the IPv4 module for transmission
      S17. }


3.2.1.  IPv4 Tunnel Information Encapsulation

   An IPv4 Tunnel Information Encapsulation contains 128 bits IPv4
   tunnel related information.  The format is shown below.

        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |               Tunnel Parameters                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       IPv4 Src Address                        |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       IPv4 Dest Address                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       Tunnel Parameters                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                       Figure 1. IPv4 Tunnel Information


3.2.1.1.  IPv4 Tunnel Information Encoding

   The IPv4 tunnel information includes tunnel type, source IPv4
   address, destination IPv4 address and tunnel parameters.  Different
   types of IPv4 tunnels have specific parameters:

   o  IPv4 UDP tunnel: the tunnel parameters includes source port and
      destination port.

   o  IPv4 VXLAN tunnel: the tunnel parameters includes source port,
      destination port and VN ID.

   The detailed encapsulation formats for different types of IPv4 tunnel
   is out of scope of the document.





Li & Li                 Expires October 22, 2021                [Page 5]

Internet-Draft            SRv6 traversing IPv4                April 2021


3.2.2.  IPv4 Tunnel Information in SRH TLV

   The IPv4 tunnel information MAY be carried in SRH TLV as well.

   A TLV Carrying (TC) Flavor is defined to indicate the SID related
   information is carried within the SRH TLV.

   Therefore, an End.4(TC) SID indicates to read the IPv4 tunnel
   information in the SRH TLV.

   A mechanism of specifying which SRH TLV to be processed by which SID
   in the SID list is defined in
   [I-D.li-spring-srh-tlv-processing-programming], and it can be used
   for indicating the node to processing IPv4 tunnel information in SRH
   TLV.  More details will be described in the future.

4.  Illustration

   For easy understanding, this section illustrates how to use End.4 SID
   for SRv6 traversing IPv4 networks.

   Assuming that

   o  A::1:200 is the End.4 SID for traversing an IPv4 domain.

   o  192.168.0.1 is the source address of the IPv4 tunnel.

   o  192.168.0.2 is the destination address of the IPv4 tunnel.

   The programmed SRv6 path is shown in Figure 3:





















Li & Li                 Expires October 22, 2021                [Page 6]

Internet-Draft            SRv6 traversing IPv4                April 2021


        0                   1                   2                   3
        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                               ...                             |
       |                                                               |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       | Type  |                Tunnel Parameters                      |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                          192.168.0.1                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                          192.168.0.2                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                       Tunnel Parameters                       |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                         A::1:200 (End.4)                      |
       |                                                               |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                             ...                               |
       |                                                               |
       |                                                               |
       |                                                               |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                Figure 3. Illustration of using End.4 SID


   When the node processes the End.4 SID A::1:200, it encapsulates a new
   IPv4 header for the SRv6 packet, setting source IPv4 address as
   192.168.0.1, and destination address as 192.168.0.2, and parameters
   accordingly.  Also, the inner IPv6 DA is updated by the next SID
   following the IPv4 tunnel information.  The node looks up the IPv4
   destination address and forward the packet.

5.  IANA Considerations

   TBD

6.  Security Considerations

   TBD







Li & Li                 Expires October 22, 2021                [Page 7]

Internet-Draft            SRv6 traversing IPv4                April 2021


7.  Acknowledgements

8.  References

8.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/info/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/info/rfc8174>.

   [RFC8754]  Filsfils, C., Ed., Dukes, D., Ed., Previdi, S., Leddy, J.,
              Matsushima, S., and D. Voyer, "IPv6 Segment Routing Header
              (SRH)", RFC 8754, DOI 10.17487/RFC8754, March 2020,
              <https://www.rfc-editor.org/info/rfc8754>.

   [RFC8402]  Filsfils, C., Ed., Previdi, S., Ed., Ginsberg, L.,
              Decraene, B., Litkowski, S., and R. Shakir, "Segment
              Routing Architecture", RFC 8402, DOI 10.17487/RFC8402,
              July 2018, <https://www.rfc-editor.org/info/rfc8402>.

   [RFC8986]  Filsfils, C., Ed., Camarillo, P., Ed., Leddy, J., Voyer,
              D., Matsushima, S., and Z. Li, "Segment Routing over IPv6
              (SRv6) Network Programming", RFC 8986,
              DOI 10.17487/RFC8986, February 2021,
              <https://www.rfc-editor.org/info/rfc8986>.

8.2.  Informative References

   [I-D.li-spring-srh-tlv-processing-programming]
              Li, C., Xia, Y., Dhody, D., and Z. Li, "SRH TLV Processing
              Programming", draft-li-spring-srh-tlv-processing-
              programming-00 (work in progress), December 2020.

   [I-D.li-rtgwg-ipv6-based-con]
              (editor), C. L., Li, Z., and H. Yang, "IPv6-based Cloud-
              Oriented Networking (CON)", draft-li-rtgwg-ipv6-based-
              con-01 (work in progress), March 2021.

   [I-D.li-spring-tunnel-segment]
              Li, Z. and N. Wu, "Tunnel Segment in Segment Routing",
              draft-li-spring-tunnel-segment-01 (work in progress),
              March 2016.




Li & Li                 Expires October 22, 2021                [Page 8]

Internet-Draft            SRv6 traversing IPv4                April 2021


Authors' Addresses

   Zhenbin Li
   Huawei Technologies
   Huawei Campus, No. 156 Beiqing Rd.
   Beijing  100095
   China

   Email: lizhenbin@huawei.com


   Cheng Li
   Huawei Technologies
   Huawei Campus, No. 156 Beiqing Rd.
   Beijing  100095
   China

   Email: c.l@huawei.com

































Li & Li                 Expires October 22, 2021                [Page 9]
