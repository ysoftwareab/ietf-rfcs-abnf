IPAddress      = IPv4Address / IPv6Address
IPv4Address    = 1*3DIGIT 3("." 1*3DIGIT)
IPv6Address    = hexseq | hexseq "::" [ hexseq ] | "::" [ hexseq ]
hexseq         = 1*4HEXDIG *( ":" 1*4HEXDIG )

Port           = 1*5DIGIT           ; TCP/UDP port
NOSP           = 1*5DIGIT       ; Number Of Subsequent Ports
PP             = "ANY" / "EVEN" / "ODD"
                                          ; Port parity to keep
RID            = 1*DIGIT            ; Request ID number
OWNER          = 1*5DIGIT           ; Owner of Rule or Group

GID            = 1*5DIGIT            ; Group Identifier
PID            = 1*5DIGIT            ; Policy Rule Identifier

PT             = "IP4" / "IP6" / "UDP4" / "UDP6" /
                       / "TCP4" / "TCP6" ; protocol type
MA             = 1*4096VCHAR
                    ; Middlebox authentication, limited to 4096 Bytes
AA             = 1*4096VCHAR
                    ; Agent authentication, limited to 4096 Bytes
MC             = 1*4096VCHAR
                    ; Middlebox challenge, limited to 4096 Bytes
AC             = 1*4096VCHAR
                    ; Agent challenge, limited to 4096 Bytes
EM             = "NONE"              ; No encryption supported

Message        = 1*512VCHAR          ; A text message
LT             = 1*DIGIT             ; lifetime in seconds
ADR            = IPAddress WSP Port  ; addresses
ADR0           = ADR                 ; internal addresses
ADR1           = ADR                 ; inside addresses
ADR2           = ADR                 ; outside addresses
ADR3           = ADR                 ; external addresses

TOPOLOGY       = "INBOUND" / "OUTBOUND" / "BI"
                                          ; direction of communication
ACTION         = "ENABLE" / "RESERVED"
                                          ; for PS reply
GLIST          = 1*(GID WSP)         ; for GS reply
PLIST          = 1*(PID WSP)         ; for PS reply

Version        = "SIMCO/2.0"

CAP      = MAX_LT WSP BOX_TYPE WSP IPWC WSP PWC
                WSP INT_IP WSP EXT_IP
                WSP PERSIST WSP TRANSACTIONS CRLF
MAX_LT   = 1*DIGIT         ; maximal lifetime granted by the server
BOX_TYPE =  "NAT" / "FW" / "NATFW" / "NAPT" / "NAPTFW"
BOX_TYPE =/ "NAT-PT" / "NAT-PTFW" ; types of the middle box
IPWC     = "YES" / "NO"     ; IP address wildcard supported
PWC      = "YES" / "NO"     ; Port number wildcard supported
INT_IP   = "IP" / "IPv4" / "IPv6" ;
EXT_IP   = "IP" / "IPv4" / "IPv6" ;
PERSIST  = "YES" / "NO"           ; Persistent Rules
TRANSACTION = ["GE" WSP] ["GLC" WSP] ["GL" WSP] ["GS" WSP]
TRANSACTION =/ ["PRR" WSP] ["PLC" WSP] ["PS" WSP]
               ;list of supported optional transactions


request =  "SE"   WSP RID WSP VERSION WSP MC WSP AA
                       WSP EM CRLF
                ; Session Establishment
request =/ "ST"   WSP RID CRLF
                ; Session Termination

request =/ "GLC"  WSP RID WSP GID WSP LT CRLF
                ; Group Lifetime Change
request =/ "GL"   WSP RID CRLF
                ; Group List
request =/ "GS"   WSP RID WSP GID CRLF
                ; Group Status

request =/ "PRR"  WSP RID WSP GID WSP PT WSP NOSP
                       WSP PP WSP LT CRLF
                ; Policy Rule Reservation
request =/ "PER"  WSP RID WSP GID WSP PID WSP PT
                       WSP NOSP WSP PP WSP TOPOLOGY
                       WSP ADR0 WSP ADR3 WSP LT CRLF
                ; Policy Rule Enable
request =/ "RLC"  WSP RID WSP PID WSP LT CRLF
                ; Policy Lifetime Change
request =/ "PRS"   WSP RID WSP PID CRLF
                ; Policy Rule Status


Reply =  "410" WSP RID CRLF       ; syntax Error
Reply =/ "411" WSP RID CRLF       ; unknown or illegal request
Reply =/ "412" WSP RID CRLF       ; Request not supported
Reply =/ "510" WSP Message CRLF   ; illegal message

Reply =/ "220" WSP RID CRLF       ; session closed
Reply =/ "221" WSP RID WSP MA WSP AC CRLF
                                       ; need further auth.
Reply =/ "222" WSP RID WSP CAP CRLF
                                       ; OK with capabilities
Reply =/ "420" WSP RID CRLF       : protocol version mismatch
Reply =/ "421" WSP RID CRLF       ; authentication failed
Reply =/ "422" WSP RID CRLF       ; no authorization
Reply =/ "423" WSP RID CRLF       ; encryption method not supported
Reply =/ "424" WSP RID CRLF       ; no resources available
Reply =/ "520" WSP Message CRLF
              ; asynchronous session termination (AST)

Reply =/ "232" WSP RID WSP LT CRLF
               ; OK for policy group lifetime change
Reply =/ "233" WSP RID CRLF       ; policy group deleted
Reply =/ "234" WSP RID WSP GLIST CRLF
                                       ; GL reply
Reply =/ "235" WSP RID WSP GOWNER WSP LT WSP PLIST CRLF
                                       ; GS reply
Reply =/ "430" WSP RID CRLF       ; transaction not supported
Reply =/ "431" WSP RID CRLF       ; not authorized for transaction
Reply =/ "432" WSP RID CRLF       ; no resources available
Reply =/ "433" WSP RID CRLF       ; not authorized for GLC
Reply =/ "434" WSP RID CRLF       ; unknown or illegal GID
Reply =/ "435" WSP RID CRLF       ; no GLC for default group
Reply =/ "436" WSP RID CRLF       ; lifetime can't be extended
Reply =/ "437" WSP RID CRLF       ; not authorized for GL

Reply =/ "240" WSP RID WSP GID WSP PID WSP ADR1 WSP ADR2 WSP LT
Reply =/ "241" WSP RID WSP GID WSP PID WSP ADR1 WSP ADR2 WSP LT
Reply =/ "242" WSP RID WSP LT CRLF
              ; RLC request successful, policy lifetime changed
Reply =/ "243" WSP RID CRLF
              ; RLC request successful, policy has been deleted
Reply =/ "244" WSP RID WSP OWNER WSP GID WSP ACTION WSP PT
                    WSP NOSP WSP WAY WSP ADR0 WSP ADR3 WSP ADR1
                    WSP ADR2 WSP LT CRLF
Reply =/ "440" WSP RID CRLF       ; transaction not supported
Reply =/ "441" WSP RID CLRF       ; not authorized for transaction
Reply =/ "442" WSP RID CRLF       ; no resources available
Reply =/ "443" WSP RID CRLF       ; GID/PID pair doesn't match
Reply =/ "444" WSP RID CRLF       ; unknown of illegal PID
Reply =/ "445" WSP RID CRLF       ; no ADR1 reservation supported
Reply =/ "446" WSP RID CRLF       ; no ADR2 reservation supported
Reply =/ "447" WSP RID CRLF       ; not authorized for this policy
Reply =/ "448" WSP RID CLRF       ; not authorized for this group
Reply =/ "449" WSP RID CRLF       ; protocol type doesn't match
Reply =/ "450" WSP RID CRLF       ; conflict with existing rule
Reply =/ "451" WSP RID CRLF
              ; not authorized to change lifetime
Reply =/ "452" WSP RID CRLF       ; lifetime can't be extended
Reply =/ "453" WSP RID CRLF       ; illegal IP Address
Reply =/ "454" WSP RID CRLF       ; protocol Type not supported
Reply =/ "455" WSP RID CRLF       ; illegal port number
Reply =/ "456" WSP RID CRLF       ; illegal NOSP
Reply =/ "457" WSP RID CRLF       ; already enable PID
Reply =/ "458" WSP RID CRLF       ; parity doesn't match
Reply =/ "540" WSP PID CRLF
              ; asynchronous policy rule deletion (APD)


mc = middlebox challenge
aa=OK)/ |   |  | SE/42x          v
lt = lifetime               RLC(lt>0)/242
                                        RLC/44x 45x


                Figure 2: Policy rule state machine


