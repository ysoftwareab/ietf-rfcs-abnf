<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Proposal for Auto-Configuration in Virtual Aggregation</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Proposal for Auto-Configuration in Virtual Aggregation">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">P. Francis</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">MPI-SWS</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">X. Xu</td></tr>
<tr><td class="header">Expires: April 22, 2010</td><td class="header">Huawei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Ballani</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Cornell U.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">D. Jen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">R. Raszuk</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Self</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">L. Zhang</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">UCLA</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 19, 2009</td></tr>
</table></td></tr></table>
<h1><br />Proposal for Auto-Configuration in Virtual Aggregation<br />draft-ietf-grow-va-auto-00.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 22, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p> 
Virtual Aggregation as specified in
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>
requires a certain amount of configuration, namely
virtual prefixes (VP), a VP list, type of tunnel,
and popular prefixes.
This draft proposes optional approaches to auto-configuration of
popular prefixes and the VP list, and discusses the pros and
cons of each.
If these proposals are accepted, they will be incorporated into
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements notation<br />
<a href="#sec-syntax">2.</a>&nbsp;
Syntax for the tags<br />
<a href="#sec-popular">3.</a>&nbsp;
Config of Popular Prefixes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-op-should">3.1.</a>&nbsp;
Operation of the should-install tag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-op-send">3.1.1.</a>&nbsp;
Sending the should-install tag<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-op-receive">3.1.2.</a>&nbsp;
Receiving the should-install tag<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-should-discuss">3.2.</a>&nbsp;
Discussion<br />
<a href="#sec-config-vp">4.</a>&nbsp;
Config of the VP list<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-vp-tag">4.1.</a>&nbsp;
VP-route tag<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-can-install-tag">4.2.</a>&nbsp;
Can suppress tag<br />
<a href="#sec-iana">5.</a>&nbsp;
IANA Considerations<br />
<a href="#sec-consider">6.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Virtual Aggregation as specified in
<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>
requires a certain amount of configuration, namely:

<p></p>
<ol class="text">
<li>
Each Aggregation Point Router (APR) must be configured with the VPs
for which it is an APR.

</li>
<li>
Every router must be configured with the VP list (a list of all VPs).
This allows the router to know which prefixes can and cannot be
FIB-suppressed.

</li>
<li>
Every router should be configured with a list of prefixes that
should be FIB-installed (for instance because they have large
traffic volumes).

</li>
<li>
Every router should be configured as to the tunnel type.

</li>
</ol>



<p>
Of these four items, the first and last cannot be automated.
Both, however, represent a relatively small amount of configuration.
The second and third are more significant, and this draft
proposes mechanisms for partially or fully automating them.
If any of these proposals are accepted, they will be incorporated
into the main VA draft.
In any event, they would be considered as optional.
The manually configured VP-list would still be mandatory, though
an ISP could choose not to use it if one of the options described
here is available.
(<a class='info' href='#I-D.ietf-grow-va'>[I&#8209;D.ietf&#8209;grow&#8209;va]<span> (</span><span class='info'>Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;FIB Suppression with Virtual Aggregation,&rdquo; May&nbsp;2009.</span><span>)</span></a>).

</p>
<p>
All of the approaches described in this draft involve tagging
routes with a standard extended communities attribute.
There are three such tags, the "should-install" tag, the
"VP-route" tag, and the "can-suppress" tag.
The should-install tag is for the purpose of automating the
configuration of popular prefixes that are popular by virtue
of having high traffic volume.
The VP-route and can-suppress tags represent two alternatives
for the VP-list.
Note that usage of the should-install tag (popular prefixes config)
is completely
orthogonal with usage of either the VP-route or can-suppress tag
(replacement for VP-list config).

</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
            "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
            and "OPTIONAL" in this document are to be interpreted as
	    described in 
	    <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<a name="sec-syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Syntax for the tags</h3>

<p>
All three tags can be conveyed with an Extended
Communities Attribute
<a class='info' href='#RFC4360'>[RFC4360]<span> (</span><span class='info'>Sangli, S., Tappan, D., and Y. Rekhter, &ldquo;BGP Extended Communities Attribute,&rdquo; February&nbsp;2006.</span><span>)</span></a> to be assigned by IANA.
For all three tags, the Transitive Bit
MUST be set to value 1 (the community is non-
transitive across ASes).

</p>
<a name="sec-popular"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Config of Popular Prefixes</h3>

<p>
Broadly speaking, a Popular Prefix is any prefix that does not have
to be FIB-installed, but should never-the-less be FIB-installed.
For instance:

<p></p>
<blockquote class="text"><dl>
<dt></dt>
<dd>
Prefixes for customer networks should be installed (so that traffic
to customers does not incur the extra delay associated with the
detour through an APR).
Since customer routes are in any event tagged with a community
attribute for routing policy reasons, the decision to FIB-install
them is entirely local and requires no standardization.

</dd>
<dt></dt>
<dd>
If an ASBR chooses its external peer as a next-hop for a given
prefix, then it should FIB-install that prefix.

</dd>
</dl></blockquote>



<p>
Prefixes to which there is a large volume of traffic should
also be FIB-installed.  This is to reduce the additional load
the results from the extra hop(s) that packets must take on
the APR detour.  
Installing these prefixes is not trivial.  The volume
of traffic must be measured, the high-volume prefixes identified,
and routers configured to FIB-install these prefixes.
Furthermore, the router where the prefix must be FIB-installed is
typically different from where the high-volume is measured.
Normally, the highest volume for any given prefix will be seen
at the egress routers for that prefix.  However, the ingress
router is where FIB installation should take place.

</p>
<p>
The proposal is to identify high-volume prefixes at ASBRs and RRs
(routers that forward iBGP updates), and to tag routes to these
prefixes with
a community attribute that effectively means "should FIB-install".
How to identify high-volume prefixes is a local matter, but one
way would be by examining netflow records from the router.
In principle, however, a router could internally detect high-volume
prefixes.
Identification of high-volume prefixes need only be done for either:

<p></p>
<ol class="text">
<li>
Outgoing traffic on ASBRs peering with non-customer
networks (peers or transits).

</li>
<li>
Route Reflectors, probably limited to traffic that is routed towards
the edge.

</li>
</ol>



<p>
Either way, the set of routers where this identification must take place
is limited.

</p>
<a name="sec-op-should"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Operation of the should-install tag</h3>

<a name="sec-op-send"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Sending the should-install tag</h3>

<p>
For routers implementing this optional feature,
it must be possible to configure a router to attach the community
attribute (the "should-install
tag") to routes for a given prefix.
In practice, this may be automatically done by the system that receives
and analyzes netflow records, or it may be done manually by a network
administrator.
Once configured as such, the router must attach the should-install
tag to BGP updates containing the prefix.
The update may be 
generated immediately after the configuration takes place,
or it may be put off until the next time the update is normally transmitted.

</p>
<p>
If the configuration is removed, the router must not attach the
should-install tag to subsequent updates containing the prefix.
An update without the should-install tag may be 
generated immediately after the configuration is removed,
or it may be put off until the next time the update is normally transmitted.

</p>
<a name="sec-op-receive"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Receiving the should-install tag</h3>

<p>
If the best-path route to a given prefix
(that doesn't otherwise have to be FIB-installed),
has the should-install
tag, then the router locally decides whether or not to
FIB-install the prefix.  If there is no room in the FIB for a new prefix,
the router may choose to remove an existing FIB entry (for instance,
the oldest entry) to make room for the new entry.

</p>
<a name="sec-should-discuss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Discussion</h3>

<p>
The time-frame over which should-install tags are attached and
removed should be quite long, at least hours if not days.
Evidence shows that high-volume prefixes tend to stay high-volume
on average over long periods of times (days or even weeks)
<a class='info' href='#nsdi09'>[nsdi09]<span> (</span><span class='info'>Ballani, H., Francis, P., Cao, T., and J. Wang, &ldquo;Making Routers Last Longer with ViAggre,&rdquo; April&nbsp;2009.</span><span>)</span></a>.

</p>
<p>
There are a number of limited
scenarios whereby a should-install tag is
not successfully conveyed to all routers in an AS.
This does not result in non-delivery of packets, only
inefficiencies.

</p>
<p>
Consider the case where an AS is using Route Reflectors (RRs), and
is using ASBRs to transmit should-install tags.
Imagine two ASBRs, BR1 and BR2, that advertise routes to some prefix
P.
Further, both BR1 and BR2 are clients of the same RR.
Assume that there is high-volume to prefix P at BR1 but not at BR2.
As a result, BR1 attaches the should-install tag and BR2 does not.
If the RR for any reason prefers the route via BR2 over BR1, then
it the should-install tag will not be passed on by the RR.
(Although note that a likely outcome of this is that BR2 will start
to see high volumes of traffic to P, and eventually will set the
should-install tag.)

</p>
<p>
Next consider the same topology as above (BR1 and BR2 both clients
of the same RR), but now assume that it is the RR that is
used to transmit should-install tags.
Assume that the RR detects high-volume to prefix P and attaches
the should-install tag for routes to P.
Assume that both BR1 and BR2 choose their respective external peers
as the next hop to P, and of course advertise this next hop to
the RR.
The RR selects and advertises a best path, say via BR1.  
When the RR advertises this best path to BR2, BR2 ignores it
and so does not FIB-install the route.
The end result here is that packets detour through an APR and
then are tunneled back to the ASBR.
(Though as mentioned earlier in this section, prefixes where the
next hop is an external peer should
be FIB-installed as a matter of local policy.)

</p>
<a name="sec-config-vp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Config of the VP list</h3>

<p>
As the current VA specification stands,
routers have to know which prefixes they must FIB-install and
and which they need not FIB-install.  The VP-list tells them this:  they must
FIB-install routes to VPs, and they need not FIB-install routes
to prefixes that fall within VPs for which they are not an APR.
The same VP-list must be installed in every router
(though it is not a problem that they differ for brief periods during
modification of the VP-list).
Configuration of the VP-list is not nearly as hard as configuration
of popular prefixes, but it is nevert-the-less a significant
task that we'd just as soon do without.

</p>
<p>
There are two basic approaches to automating this configuration.
One is to have APRs tag the routes to VPs that they originate, 
and let routers effectively reconstruct
the VP-list from these tags.
This approach has the advantage that no configuration what-so-ever
is required to solve the problem.

</p>
<p>
The other is to have ASBRs 
tag the routes that need not be installed.
This can be done by configuring a list of one or more "VP-ranges" 
in the ASBRs.
This is simpler than the current configured VP-list approach in
two regards.  First, fewer routers need to be configured (only
ASBRs interfacing with peer and provider (non-customer) networks.
Second, the VP-range is simpler than the VP-list.  In most cases,
once an ISP is past its initial VA roll-out phase, it would consist
of a single 0/0 entry.

</p>
<p>
These two approaches are discussed in the following sections.

</p>
<a name="sec-vp-tag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
VP-route tag</h3>

<p>
Routers that receive a route with the communities attribute indicating
the VP-route tag must FIB-install the associated prefix (VP).
They may FIB-suppress any sub-prefixes that fall within the VP.

</p>
<p>
Prefixes that do not fall within any known VP must be FIB-installed.
During BGP initialization (i.e. before the End-of-RIB marker is
received <a class='info' href='#RFC4724'>[RFC4724]<span> (</span><span class='info'>Sangli, S., Chen, E., Fernando, R., Scudder, J., and Y. Rekhter, &ldquo;Graceful Restart Mechanism for BGP,&rdquo; January&nbsp;2007.</span><span>)</span></a>), however,
the full set of VPs is not yet known.
Therefore, what routers do with prefixes that do not fall within any known
VP during initialization is a local matter.

</p>
<p>
There are two basic strategies, install by default and suppress
by default.  Each has pros and cons, though the latter is generally
prefered.
With install by default, some prefixes will be installed only to be
removed later (when the parent VP is learned).
This can actually ultimately
slow down convergence, since it takes time to modify the FIB.
Also, this could result in the FIB filling up with entries.

</p>
<p>
The problem with suppress by default is that entries that ultimately
will be installed are not immediately installed.  Instead, they are
installed only after the End-of-RIB marker.
This approach, however, does avoid the pitfalls of install by default, 
and ultimately could converge faster because FIB churn
is avoided.
There are also several mitigating factors that should make suppress
by default work well in practice.
First, if the router uses Graceful Restart
<a class='info' href='#RFC4724'>[RFC4724]<span> (</span><span class='info'>Sangli, S., Chen, E., Fernando, R., Scudder, J., and Y. Rekhter, &ldquo;Graceful Restart Mechanism for BGP,&rdquo; January&nbsp;2007.</span><span>)</span></a>,
then in any event forwarding can continue to take place even when the
BGP session is restarted.
Second, the router can have a policy whereby prefixes with a
should-install tag are automatically installed.
In this way, high-volume prefixes are installed and so most traffic
will in fact be forwarded by the End-of-RIB.
Finally, if the router has a policy that customer prefixes are
always installed, then flows between customers are also correctly
forwarded by the End-of-RIB.

</p>
<p>
Another issue with the VP-route tag is what to do if all APRs for
a given VP stop operating (i.e. crash) and so all VP routes are
withdrawn.
Strictly speaking, the router would immediately start installing
the sub-prefixes within that VP.
This could lead to the FIB filling up.
Also, if the APR is thrashing (going up and down), then all routers in the
AS could end up repeatedly adding and removing the same set of
prefixes.

</p>
<p>
How to deal with this is a local matter.
There are two questions the router must answer:

<p></p>
<ol class="text">
<li>
How should hysteresis be applied to the (implicit) VP list to avoid FIB churn?

</li>
<li>
How are FIB entries prioritized in the case where the FIB is full?

</li>
</ol>



<p>
Regarding VP list hysteresis, perhaps the simplest thing to do is to
use standard route flap damping on the VP routes
<a class='info' href='#RFC2439'>[RFC2439]<span> (</span><span class='info'>Villamizar, C., Chandra, R., and R. Govindan, &ldquo;BGP Route Flap Damping,&rdquo; November&nbsp;1998.</span><span>)</span></a>.
Alternatively, the router could simply not install sub-prefixes for
a recently known VP for some period of time (minutes) after which the
VP route was withdrawn, or only install sub-prefixes slowly (to minimize
the impact of churn).

</p>
<p>
Regarding FIB entry prioritization, routers must in any event install
VP routes and sub-prefixes within the VPs for which the router is an APR.
If the FIB does not have room for at least these entries, then VA has
simply been configured incorrectly in the AS, and the administrator must
fix this.
Beyond these necessary FIB entries, prioritization is a local matter.
A reasonable prioritization, however,
is the following:  1) customer routes, 2) routes with should-install tag,
3) routes for sub-prefixes of recently withdrawn VPs, 4) other.

</p>
<a name="sec-can-install-tag"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Can suppress tag</h3>

<p>
With this approach, some set of ASBRs are configured
with a "VP range".
This is the ranges of IP address that are covered by all VPs.
In a mature deployment of VA, the range would amount to all IP
addresses, in which case the VP range is simply 0/0.
Early in VA deployment, when an ISP is still in the testing 
or roll-out phase, the VP range would consist of multiple entries.
At a minimum, the set of ASBRs so configured are those with peers
in peer or transit ASes.
If the AS has a policy that customer routes are always FIB-installed,
then it is not necessary to configure routers that connect to customer
ASes.

</p>
<p>
VP-range configured ASBRs must
tag any route whose prefix falls within the VP range
with a "can-suppress" tag, with the following exceptions:

<p></p>
<ol class="text">
<li>
Routers must never tag a VP route with can-suppress.

</li>
<li>
If the ISP has a policy of FIB-installing customer routes, then routes
received from customers should not be tagged with can-suppress.

</li>
</ol>



<p>
A router receiving a route with a can-suppress tag first determines
if it must FIB-install the prefix.
It would have to do this for instance
if the prefix falls within a VP for which it is an APR.
If the router does not have to install the prefix, then it may
suppress the prefix at its own discretion.

</p>
<p>
When the can-suppress approach is used, then routers must FIB-install
any prefixes not tagged as can-suppress.
The primary reason for this is so that VP routes are always installed.

</p>
<p>
Note that in the case where all VP routes for a given VP are withdrawn,
routers would not be able to FIB-install the (now unreachable) sub-prefixes.
This is because, with the can-suppress approach, routers do not actually
know which routes are VPs.

</p>
<a name="sec-iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
IANA must assign type values for the Extended Communities Attributes
that convey the tags.

</p>
<a name="sec-consider"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
As of this writing, there are no known new security threats 
introduced by this draft.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-grow-va">[I-D.ietf-grow-va]</a></td>
<td class="author-text">Francis, P., Xu, X., Ballani, H., Jen, D., Raszuk, R., and L. Zhang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-grow-va-00.txt">FIB Suppression with Virtual Aggregation</a>,&rdquo; draft-ietf-grow-va-00 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-grow-va-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1997">[RFC1997]</a></td>
<td class="author-text"><a href="mailto:rchandra@cisco.com">Chandrasekeran, R.</a>, <a href="mailto:pst@cisco.com">Traina, P.</a>, and <a href="mailto:tli@skat.usc.edu">T. Li</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1997">BGP Communities Attribute</a>,&rdquo; RFC&nbsp;1997, August&nbsp;1996 (<a href="ftp://ftp.isi.edu/in-notes/rfc1997.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4360">[RFC4360]</a></td>
<td class="author-text">Sangli, S., Tappan, D., and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4360">BGP Extended Communities Attribute</a>,&rdquo; RFC&nbsp;4360, February&nbsp;2006 (<a href="ftp://ftp.isi.edu/in-notes/rfc4360.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4724">[RFC4724]</a></td>
<td class="author-text">Sangli, S., Chen, E., Fernando, R., Scudder, J., and Y. Rekhter, &ldquo;<a href="http://tools.ietf.org/html/rfc4724">Graceful Restart Mechanism for BGP</a>,&rdquo; RFC&nbsp;4724, January&nbsp;2007 (<a href="ftp://ftp.isi.edu/in-notes/rfc4724.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2439">[RFC2439]</a></td>
<td class="author-text"><a href="mailto:curtis@ans.net">Villamizar, C.</a>, <a href="mailto:rchandra@cisco.com">Chandra, R.</a>, and <a href="mailto:govindan@isi.edu">R. Govindan</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2439">BGP Route Flap Damping</a>,&rdquo; RFC&nbsp;2439, November&nbsp;1998 (<a href="ftp://ftp.isi.edu/in-notes/rfc2439.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2439.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2439.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="nsdi09">[nsdi09]</a></td>
<td class="author-text">Ballani, H., Francis, P., Cao, T., and J. Wang, &ldquo;Making Routers Last Longer with ViAggre,&rdquo; ACM Usenix NSDI 2009&nbsp;http://www.usenix.org/events/nsdi09/tech/full_papers/ballani/ballani.pdf, April&nbsp;2009.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Paul Francis</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Max Planck Institute for Software Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gottlieb-Daimler-Strasse</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kaiserslautern  67633</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+49 631 930 39600</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:francis@mpi-sws.org">francis@mpi-sws.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Xiaohu Xu</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">No.3 Xinxi Rd., Shang-Di Information Industry Base, Hai-Dian District</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Beijing, Beijing  100085</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R.China</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+86 10 82836073</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:xuxh@huawei.com">xuxh@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitesh Ballani</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cornell University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4130 Upson Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ithaca, NY  14853</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 607 279 6780</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hitesh@cs.cornell.edu">hitesh@cs.cornell.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dan Jen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4805 Boelter Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jenster@cs.ucla.edu">jenster@cs.ucla.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Robert Raszuk</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Self</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:robert@raszuk.net">robert@raszuk.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lixia Zhang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UCLA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3713 Boelter Hall</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Los Angeles, CA  90095</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text"></td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lixia@cs.ucla.edu">lixia@cs.ucla.edu</a></td></tr>
</table>
</body></html>
