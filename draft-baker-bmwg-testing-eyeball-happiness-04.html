<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Testing Eyeball Happiness</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Measuring Eyeball Happiness">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Happy Eyeballs test bed configuration">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Happy Eyeballs test procedure">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Happy Eyeballs metrics">
<link href="#rfc.section.2.3.1" rel="Chapter" title="2.3.1 Metric: Session Setup Interval">
<link href="#rfc.section.2.3.2" rel="Chapter" title="2.3.2 Metric: Maximum Session Setup Interval">
<link href="#rfc.section.2.3.3" rel="Chapter" title="2.3.3 Metric: Minimum Session Setup Interval">
<link href="#rfc.section.2.3.4" rel="Chapter" title="2.3.4 Descriptive Metric: Attempt pattern">
<link href="#rfc.section.3" rel="Chapter" title="3 IANA Considerations">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Acknowledgements">
<link href="#rfc.section.6" rel="Chapter" title="6 Change Log">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The amount of time it takes to establish a session using common transport APIs in dual stack networks and networks with filtering such as proposed in BCP 38 is a barrier to IPv6 deployment. This note describes a test that can be used to determine whether an application can reliably establish sessions quickly in a complex environment such as dual stack (IPv4+IPv6) deployment or IPv6 deployment with multiple prefixes and upstream ingress filtering. This test is not a test of a specific algorithm, but of the external behavior of the system as a black box. Any algorithm that has the intended external behavior will be accepted by it." />
  <meta name="description" content="The amount of time it takes to establish a session using common transport APIs in dual stack networks and networks with filtering such as proposed in BCP 38 is a barrier to IPv6 deployment. This note describes a test that can be used to determine whether an application can reliably establish sessions quickly in a complex environment such as dual stack (IPv4+IPv6) deployment or IPv6 deployment with multiple prefixes and upstream ingress filtering. This test is not a test of a specific algorithm, but of the external behavior of the system as a black box. Any algorithm that has the intended external behavior will be accepted by it." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Benchmarking Methodology</td>
<td class="right">F.J. Baker</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">February 14, 2011</td>
</tr>
<tr>
<td class="left">Expires: August 18, 2011</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Testing Eyeball Happiness<br />
  <span class="filename">draft-baker-bmwg-testing-eyeball-happiness-04</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The amount of time it takes to establish a session using common transport APIs in dual stack networks and networks with filtering such as proposed in BCP 38 is a barrier to IPv6 deployment. This note describes a test that can be used to determine whether an application can reliably establish sessions quickly in a complex environment such as dual stack (IPv4+IPv6) deployment or IPv6 deployment with multiple prefixes and upstream ingress filtering. This test is not a test of a specific algorithm, but of the external behavior of the system as a black box. Any algorithm that has the intended external behavior will be accepted by it.</p>
<h1><a>Requirements</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 18, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Measuring Eyeball Happiness</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Happy Eyeballs test bed configuration</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Happy Eyeballs test procedure</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">Happy Eyeballs metrics</a>
</li>
<li>2.3.1.   <a href="#rfc.section.2.3.1">Metric: Session Setup Interval</a>
</li>
<li>2.3.2.   <a href="#rfc.section.2.3.2">Metric: Maximum Session Setup Interval</a>
</li>
<li>2.3.3.   <a href="#rfc.section.2.3.3">Metric: Minimum Session Setup Interval</a>
</li>
<li>2.3.4.   <a href="#rfc.section.2.3.4">Descriptive Metric: Attempt pattern</a>
</li>
<li>3.   <a href="#rfc.section.3">IANA Considerations</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Acknowledgements</a>
</li>
<li>6.   <a href="#rfc.section.6">Change Log</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The <a href="#I-D.wing-v6ops-happy-eyeballs-ipv6">Happy Eyeballs</a> <cite title="NONE">[I-D.wing-v6ops-happy-eyeballs-ipv6]</cite> specification notes an issue in deployed multi-prefix IPv6-only and dual stack networks, and proposes a correction. <a href="#RFC5461">[RFC5461]</a> similarly looks at TCP's response to so-called "soft errors" (ICMP host and network unreachable messages), pointing out an issue and a set of possible solutions.</p>
<p id="rfc.section.1.p.2">In a dual stack network (i.e., one that contains both <a href="#RFC0791">IPv4</a> <cite title="NONE">[RFC0791]</cite> and <a href="#RFC2460">IPv6</a> <cite title="NONE">[RFC2460]</cite> prefixes and routes), or in an IPv6-only network that uses multiple prefixes allocated by upstream providers that implement <a href="#RFC2827">BCP 38 Ingress Filtering</a> <cite title="NONE">[RFC2827]</cite>, the fact that two hosts that need to communicate have addresses using the same architecture does not imply that the network has usable routes connecting them, or that those addresses are useful to the applications in question. In addition, the process of establishing a session using the <a href="#RFC3493">Sockets API</a> <cite title="NONE">[RFC3493]</cite> is generally described in terms of obtaining a list of possible addresses for a peer (which will normally include both IPv4 and IPv6 addresses) using getaddrinfo() and trying them in sequence until one succeeds or all have failed. This naive algorithm, if implemented as described, has the side-effect of making the worst case delay in establishing a session far longer than human patience normally allows.</p>
<p id="rfc.section.1.p.3">This has the effect of discouraging users from enabling IPv6 in their equipment, or content providers from offering AAAA records for their services.</p>
<p id="rfc.section.1.p.4">This note describes a test to determine how quickly an application can reliably open sessions in a complex environment, such as dual stack (IPv4+IPv6) deployment or IPv6 deployment with multiple prefixes and upstream ingress filtering. This is not a test of a specific algorithm, but a measurement of the external behavior of the application and its host system as a black box. The "happy eyeballs" question is this: how long does it take an application to open a session with a server or peer, under best case and worst case conditions?</p>
<p id="rfc.section.1.p.5">The methods defined here make the assumption that the initial communication set-up of many applications can be summarized by the measuring the DNS query/response and transport layer handshaking, because no application-layer communication takes place without these steps.</p>
<p id="rfc.section.1.p.6">The methods and metrics defined in this note are ideally suited for Laboratory operation, as this affords the greatest degree of control to modify configurations quickly and produce consistent results.</p>
<p id="rfc.section.1.p.7">However, if the device under test is operated as a single user with limited query and stream generation, then there's no concern about overloading production network devices with a single "set of eyeballs".  Therefore, these procedures and metrics MAY be applicable to production network application, as long as the injected traffic represents a single user's typical traffic load, and the testers adhere to the precautions of the relevant network with respect to re-configuration of devices in production.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#test" id="test">Measuring Eyeball Happiness</a>
</h1>
<p id="rfc.section.2.p.1">This measurement determines the amount of time it takes an application to establish a session with a peer in the presence of at least one IPv4 and multiple IPv6 prefixes and a variety of network behaviors. ISPs are reporting that a host (MacOSX, Windows, Linux, FreeBSD, etc) that has more than one address (an IPv4 and an IPv6 address, two global IPv6 addresses, etc) may serially try addresses, allowing each TCP setup to expire, taking several seconds for each attempt. There have been reports of lengthy session setup times - in various application and OS combinations anywhere from multi-second to half an hour - as a result. The amount of time necessary to establish communication between two entities should be approximately the same regardless of the type of address chosen or the viability of routing in the specific network; users will expect this time to be consistent with their current experience (else, happiness is at risk).</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#testbed" id="testbed">Happy Eyeballs test bed configuration</a>
</h1>
<p id="rfc.section.2.1.p.1">The configuration of equipment and applications is as shown in <a href="#test1">Figure 1</a>.</p>
<div id="#rfc.figure.1"></div>
<div id="#test1"></div>
<pre>
+--------+ |                      |198.51.100.0/24
|Protocol| |192.0.2.0/24          |2001:DB8:0:2::/64
|Analyzer+-+2001:DB8:1:0::/64     |2001:DB8:1:4::/64
+--------+ |2001:DB8:0:1::/64     |2001:DB8:2:4::/64
           |                      |
   +-----+ |                      | +-----+
   |Alice+-+                      +-+ Bob |
   +-----+ | +-------+  +-------+ | +-----+
           +-+Router1|  |Router2+-+
   +-----+ | +-----+-+  +-+-----+ |
   | DNS +-+       |      |       |
   +-----+ |      -+------+-      |
           |    203.0.113.0/24    |
           |    2001:DB8:0:3::/64 |
</pre>
<p id="rfc.section.2.1.p.2">Alice is the unit being measured, the computer running the process that will establish a session with Bob for the application in question. DNS is represented in the diagram as a separate system, as is the protocol analyzer that will watch Alice's traffic. This is not absolutely necessary; If one computer can run tcpdump and a DNS server process - and for that matter subsume the routers - that is acceptable. The units are separated in the test for purposes of clarity.</p>
<p id="rfc.section.2.1.p.3">On each test run, configuration is performed in Router 1 to permit only one route to work. There are various ways this can be accomplished, including but not limited to installing</p>

<ul>
<li>a filter that drops datagrams to Bob resulting in an ICMP "administratively prohibited",</li>
<li>a filter that silently drops datagrams to Bob,</li>
<li>a null route or removing the route to one of Bob's prefixes, resulting in an ICMP "destination unreachable", and</li>
<li>a middleware program that responds with a TCP RST.</li>
<li>Path MTU issues</li>
</ul>
<p id="rfc.section.2.1.p.4">The <a href="#RFC1191">Path MTU Discovery</a> <cite title="NONE">[RFC1191]</cite><a href="#RFC1981">[RFC1981]</a> matter requires some explanation. With IPv6, and with IPv4 when "Do Not Fragment" is set, a router with a message too large for an interface discards it and replies with an ICMPv4 "Destination Unreachable: Datagram Too Big" or ICMPv6 "Packet Too Big". If this packet is lost, the source doesn't know what size to fragment to and has no indication that fragmentation is required. A configuration for this scenario would set the MTU on 203.0.113.0/24 or 2001:DB8:0:3::/64 to the smallest allowed by the address family (576 or 1280) and disable generation of the indicated ICMP message. Note that <a href="#RFC4821">[RFC4821]</a> is intended to address these issues.</p>
<p id="rfc.section.2.1.p.5">The tester should try different methods to determine whether differences in this configuration make a difference in the test. For example, one might find that the application under test responds differently to a TCP RST than to a silent packet loss. Each of these scenarios should be tested; if doing so is too difficult, the most important is the silent packet loss case, as it is the worst case.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#procedure" id="procedure">Happy Eyeballs test procedure</a>
</h1>
<p id="rfc.section.2.2.p.1">Consider a network as described in <a href="#testbed">Section 2.1</a>.  Alice and Bob each have a set of one or more IPv4 and two or more IPv6 addresses. Bob's are in DNS, where Alice can find them; Alice's and others may be there as well, but are not relevant to the test. Routers 1 and 2 are configured to route the relevant prefixes. Different measurement trials revise an access list or null route in Router 1 that would prevent traffic Alice-&gt;Bob using each of Bob's addresses. If Bob has a total of N addresses, we run the measurement at least N times, permitting exactly one of the addresses to enjoy end to end communication each time. If the DNS service randomizes the order of the addresses, this may not result in a test requiring establishment of a connection to all of the addresses; in this case, the test will have to be run repeatedly until in at least one instance a TCP SYN or its equivalent is seen for each relevant address. The tester should either flush the resolver cache between iterations, to force repeated DNS resolution, or should wait for at least the DNS RR TTL on each resource record. In the latter case, the tester should also observe DNS re-resolving; if not, the application is not correctly using DNS.</p>
<p id="rfc.section.2.2.p.2">This specification assumes common LAN technology with no competing traffic and nominal propagation delays, so that they are not a factor in the measurement.</p>
<p id="rfc.section.2.2.p.3">The objective is to measure the amount of time required to establish a session. This includes the time from Alice's initial DNS request through one or more attempts to establish a session to the session being established, as seen in the LAN trace. The simplest way to measure this will be to put a traffic analyzer on Alice's point of attachment and capture the messages exchanged by Alice.</p>
<div id="#rfc.figure.2"></div>
<div id="#tcpflow"></div>
<pre>
 DNS Server                   Alice                    Bob
     |                          |                       |
 1.  |&lt;--www.example.com A------|                       |
 2.  |&lt;--www.example.com AAAA---|                       |
 3.  |---198.51.100.1----------&gt;|                       |
 4.  |---2001:DB8:0:2::1-------&gt;|                       |
 5.  |                          |                       |
 6.  |                          |--TCP SYN, IPv6---&gt;X   |&lt;***********
 7.  |                          |--TCP SYN, IPv6---&gt;X   |     |
 8.  |                          |--TCP SYN, IPv6---&gt;X   | TCP 3wHS
 9.  |                          |                       |   Time
10.  |                          |--TCP SYN, IPv4-------&gt;|(any family)
11.  |                          |&lt;-TCP SYN+ACK, IPv4----|     |
12.  |                          |--TCP ACK, IPv4-------&gt;|&lt;***********
</pre>
<p id="rfc.section.2.2.p.4">In a TCP-based application (<a href="#tcpflow">Figure 2</a>), that would be from the DNS request on line 1 through the first completion of a TCP three-way handshake, the transmission on line 12.</p>
<div id="#rfc.figure.3"></div>
<div id="#udpflow"></div>
<pre>
DNS Server                   Alice                    Bob
     |                          |                       |
 1.  |&lt;--www.example.com A------|                       |
 2.  |&lt;--www.example.com AAAA---|                       |
 3.  |---198.51.100.1----------&gt;|                       |
 4.  |---2001:DB8:0:2::1-------&gt;|                       |
 5.  |                          |                       |
 6.  |                          |--UDP Request, IPv6--&gt;X|&lt;---------
 7.  |                          |--UDP Request, IPv6--&gt;X|  first
 8.  |                          |--UDP Request, IPv6--&gt;X|  request/
 9.  |                          |                       |  response
10.  |                          |--UDP Request, IPv4---&gt;|  success
11.  |                          |&lt;-UDP Response, IPv4---|&lt;---------
</pre>
<p id="rfc.section.2.2.p.5">In a UDP-based application (<a href="#udpflow">Figure 3</a>), that would be from the DNS request (line 1) through one or more UDP Requests (lines 6-10) until a UDP Response is seen (line 11).</p>
<p id="rfc.section.2.2.p.6">When using other transports, the methodology will have to be specified in context; it should measure the same event.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#metrics" id="metrics">Happy Eyeballs metrics</a>
</h1>
<p id="rfc.section.2.3.p.1">The measurements taken are the duration of the interval from the initial DNS request until the session is seen to have been established, as described in <a href="#procedure">Section 2.2</a>. We are interested in the shortest and longest durations (which will most likely be those that send one SYN and succeed and those that send a SYN to each possible address before succeeding in one of the attempts), and the pattern of attempts sent to different addresses.  The pattern may be to simply send an attempt every &lt;time interval&gt;, or may be more complex; as a result, this is in part descriptive.</p>
<p id="rfc.section.2.3.p.2">ALL measurement events on the sending and receiving of messages SHALL be observed at the "Alice" attachment point and time stamps SHOULD be applied upon reception of the last bit of the IP information field. Use of a alternate timing reference SHALL be noted.</p>
<h1 id="rfc.section.2.3.1">
<a href="#rfc.section.2.3.1">2.3.1.</a> <a href="#session-metric" id="session-metric">Metric: Session Setup Interval</a>
</h1>
<p></p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">Session Setup Interval</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The session setup interval MUST be the time beginning with the first DNS query sent (observed at Alice's attachment), and ending with successful transport connection establishment (as indicated in line 12 of <a href="#tcpflow">Figure 2</a>, and line 11 of <a href="#udpflow">Figure 3</a>). This interval is defined as the session setup interval.</dd>
<dt></dt>
<dd style="margin-left: 8">This test will be run several times, once for each possible combination of destination address (configured on Bob) and failure mode (configured on Router 1).</dd>
<dt>Methodology:</dt>
<dd style="margin-left: 8">In the LAN analyzer trace, note the times of the initial DNS request and the confirmation that the session is open as described in <a href="#procedure">Section 2.2</a>. If the session is not successfully opened, possibly due to Alice aborting the attempt, the Session Setup Interval is considered to be infinite.</dd>
<dt>Units:</dt>
<dd style="margin-left: 8">Session setup time is measured in milliseconds.</dd>
<dt>Measurement Point(s):</dt>
<dd style="margin-left: 8">The measurement point is at Alice's LAN interface, both sending and receiving, observed using a program such as tcpdump running on Alice or an external analyzer.</dd>
<dt>Timing:</dt>
<dd style="margin-left: 8">The measurement program or external analyzer MUST run for a duration sufficient to capture the entire message flow as described in <a href="#procedure">Section 2.2</a>. Measurement precision MUST be sufficient to maintain no more than 0.1 ms error over a 60 second interval. 1 ppm precision would suffice.</dd>
</dl>
<h1 id="rfc.section.2.3.2">
<a href="#rfc.section.2.3.2">2.3.2.</a> <a href="#Max-metric" id="Max-metric">Metric: Maximum Session Setup Interval</a>
</h1>
<p></p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">Maximum Session Setup Interval</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The maximum session setup interval is the longest period of time observed for the establishment of a session as described in <a href="#session-metric">Section 2.3.1</a>.</dd>
<dt>Methodology:</dt>
<dd style="margin-left: 8">see Session Setup Interval.</dd>
<dt>Units:</dt>
<dd style="margin-left: 8">Session setup time is measured in milliseconds.</dd>
<dt>Measurement Point(s):</dt>
<dd style="margin-left: 8">see Session Setup Interval.</dd>
<dt>Timing:</dt>
<dd style="margin-left: 8">The measurement program or external analyzer MUST run for a duration sufficient to capture the entire message flow as described in <a href="#procedure">Section 2.2</a>. Measurement precision MUST be sufficient to maintain no more than 0.1 ms error over a 60 second interval. 1 ppm precision would suffice.</dd>
</dl>
<h1 id="rfc.section.2.3.3">
<a href="#rfc.section.2.3.3">2.3.3.</a> <a href="#Min-metric" id="Min-metric">Metric: Minimum Session Setup Interval</a>
</h1>
<p></p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">Minimum Session Setup Interval</dd>
<dt>Description:</dt>
<dd style="margin-left: 8">The minimum session setup interval is the shortest period of time observed for the establishment of a session.</dd>
<dt>Methodology:</dt>
<dd style="margin-left: 8">see Session Setup Interval.</dd>
<dt>Units:</dt>
<dd style="margin-left: 8">Session setup time is measured in milliseconds.</dd>
<dt>Measurement Point(s):</dt>
<dd style="margin-left: 8">see Session Setup Interval.</dd>
<dt>Timing:</dt>
<dd style="margin-left: 8">The measurement program or external analyzer MUST run for a duration sufficient to capture the entire message flow as described in <a href="#procedure">Section 2.2</a>. Measurement precision MUST be sufficient to maintain no more than 0.1 ms error over a 60 second interval. 1 ppm precision would suffice.</dd>
</dl>
<h1 id="rfc.section.2.3.4">
<a href="#rfc.section.2.3.4">2.3.4.</a> <a href="#Variation-metric" id="Variation-metric">Descriptive Metric: Attempt pattern</a>
</h1>
<p></p>

<dl>
<dt>Name:</dt>
<dd style="margin-left: 8">Attempt pattern</dd>
<dt>Description: </dt>
<dd style="margin-left: 8">The Attempt Pattern is a description of the observed pattern of attempts to establish the session. In simple cases, it may be something like "Initial TCP SYNs to a new address were observed every &lt;so many&gt; milliseconds"; in more complex cases, it might be something like "Initial TCP SYNs in IPv6 were observed every &lt;so many&gt; milliseconds, and other TCP SYNs using IPv4 were observed every &lt;so many&gt; milliseconds, but the two sequences were independent." It may also comment on retransmission patterns if observed.</dd>
<dt>Methodology:</dt>
<dd style="margin-left: 8">The traffic trace is analyzed to determine the pattern of initiation.</dd>
<dt>Units:</dt>
<dd style="margin-left: 8">milliseconds.</dd>
<dt>Measurement Point(s):</dt>
<dd style="margin-left: 8">The measurement point is at Alice's LAN interface, observed using a program such as tcpdump running on Alice or an external analyzer.</dd>
<dt>Timing:</dt>
<dd style="margin-left: 8">The measurement program or external analyzer MUST run for a duration sufficient to capture the entire message flow as described in <a href="#procedure">Section 2.2</a>. Measurement precision MUST be sufficient to maintain no more than 0.1 ms error over a 60 second interval. 1 ppm precision would suffice.</dd>
</dl>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.3.p.1">This memo asks the IANA for no new parameters.</p>
<p id="rfc.section.3.p.2">Note to RFC Editor: This section will have served its purpose if it correctly tells IANA that no new assignments or registries are required, or if those assignments or registries are created during the RFC publication process. From the author's perspective, it may therefore be removed upon publication as an RFC at the RFC Editor's discretion.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">This note doesn't address security-related issues.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.5.p.1">This note was discussed with Dan Wing, Andrew Yourtchenko, and Fernando Gont. In the Benchmark Methodology Working Group, Al Morton, David Newman, Sarah Banks, and Tore Anderson made comments.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#log" id="log">Change Log</a>
</h1>
<p></p>

<dl>
<dt>-00:</dt>
<dd style="margin-left: 8">Initial version - November, 2010</dd>
<dt>-01:</dt>
<dd style="margin-left: 8">Rewritten per suggestions by Al Morton, David Newman, and Sarah Banks.</dd>
<dt>-02:</dt>
<dd style="margin-left: 8">Clean-up per working group comments.</dd>
<dt>-03:</dt>
<dd style="margin-left: 8">Updated per Al Morton's and Tore Anderson's comments.</dd>
</dl>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.wing-v6ops-happy-eyeballs-ipv6">[I-D.wing-v6ops-happy-eyeballs-ipv6]</b></td>
<td class="top">
<a>Wing, D</a> and <a>A Yourtchenko</a>, "<a href="http://tools.ietf.org/html/draft-wing-v6ops-happy-eyeballs-ipv6-01">Happy Eyeballs: Trending Towards Success with Dual-Stack Hosts</a>", Internet-Draft draft-wing-v6ops-happy-eyeballs-ipv6-01, October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC0791">[RFC0791]</b></td>
<td class="top">
<a title="University of Southern California (USC)/Information Sciences Institute">Postel, J.</a>, "<a href="http://tools.ietf.org/html/rfc791">Internet Protocol</a>", STD 5, RFC 791, September 1981.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1191">[RFC1191]</b></td>
<td class="top">
<a href="mailto:mogul@decwrl.dec.com" title="Digital Equipment Corporation (DEC) , Western Research Laboratory">Mogul, J.</a> and <a href="mailto:deering@xerox.com" title="Xerox Palo Alto Research Center">S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc1191">Path MTU discovery</a>", RFC 1191, November 1990.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1981">[RFC1981]</b></td>
<td class="top">
<a href="mailto:mccann@zk3.dec.com" title="Digital Equipment Corporation">McCann, J.</a>, <a href="mailto:deering@parc.xerox.com" title="Xerox Palo Alto Research Center">Deering, S.</a> and <a href="mailto:mogul@pa.dec.com" title="Digital Equipment Corporation, Western Research Laboratory">J. Mogul</a>, "<a href="http://tools.ietf.org/html/rfc1981">Path MTU Discovery for IP version 6</a>", RFC 1981, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2827">[RFC2827]</b></td>
<td class="top">
<a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3493">[RFC3493]</b></td>
<td class="top">
<a>Gilligan, R.</a>, <a>Thomson, S.</a>, <a>Bound, J.</a>, <a>McCann, J.</a> and <a>W. Stevens</a>, "<a href="http://tools.ietf.org/html/rfc3493">Basic Socket Interface Extensions for IPv6</a>", RFC 3493, February 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4821">[RFC4821]</b></td>
<td class="top">
<a>Mathis, M.</a> and <a>J. Heffner</a>, "<a href="http://tools.ietf.org/html/rfc4821">Packetization Layer Path MTU Discovery</a>", RFC 4821, March 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5461">[RFC5461]</b></td>
<td class="top">
<a>Gont, F.</a>, "<a href="http://tools.ietf.org/html/rfc5461">TCP's Reaction to Soft Errors</a>", RFC 5461, February 2009.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Fred Baker</span> 
	  <span class="n hidden">
		<span class="family-name">Baker</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Santa Barbara</span>,  
		<span class="region">California</span> 
		<span class="code">93117</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:fred@cisco.com">fred@cisco.com</a></span>

  </address>
</div>

</body>
</html>