<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Weighted Multi-Path Procedures for EVPN Multi-Homing</title>
<meta content="Neeraj Malhotra" name="author">
<meta content="Ali Sajassi" name="author">
<meta content="Jorge Rabadan" name="author">
<meta content="John Drake" name="author">
<meta content="Avinash Lingala" name="author">
<meta content="Samir Thoria" name="author">
<meta content="
       
      EVPN enables all-active multi-homing for a CE device connected to two or more PEs via a LAG, such that bridged and routed traffic from remote PEs to hosts attached to the Ethernet Segment can be equally load balanced (it uses Equal Cost Multi Path) across the multi-homing PEs. EVPN also enables multi-homing for IP subnets advertised in IP Prefix routes, so that routed traffic from remote PEs to those IP subnets can be load balanced.  This document defines extensions to EVPN procedures to optimally handle unequal access bandwidth distribution across a set of multi-homing PEs in order to:
       
       
         
        provide greater flexibility, with respect to adding or removing individual multi-homed PE-CE links.
         
         
        handle multi-homed PE-CE link failures that can result in unequal PE-CE access bandwidth across a set of multi-homing PEs.
         
       
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="draft-ietf-bess-evpn-unequal-lb-15" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.2.0
    six 1.16.0
-->
<link href="/tmp/draft-ietf-bess-evpn-unequal-lb-15-w8xznv_y.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">EVPN Weighted Multi-Pathing</td>
<td class="right">November 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Malhotra, et al.</td>
<td class="center">Expires 21 May 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">BESS WorkGroup</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-bess-evpn-unequal-lb-15</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-11-17" class="published">17 November 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-05-21">21 May 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">N. Malhotra, <span class="editor">Ed.</span>
</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">A. Sajassi</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">J. Rabadan</div>
<div class="org">Nokia</div>
</div>
<div class="author">
      <div class="author-name">J. Drake</div>
<div class="org">Juniper</div>
</div>
<div class="author">
      <div class="author-name">A. Lingala</div>
<div class="org">ATT</div>
</div>
<div class="author">
      <div class="author-name">S. Thoria</div>
<div class="org">Cisco Systems</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Weighted Multi-Path Procedures for EVPN Multi-Homing</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
      EVPN enables all-active multi-homing for a CE device connected to two or more PEs via a LAG, such that bridged and routed traffic from remote PEs to hosts attached to the Ethernet Segment can be equally load balanced (it uses Equal Cost Multi Path) across the multi-homing PEs. EVPN also enables multi-homing for IP subnets advertised in IP Prefix routes, so that routed traffic from remote PEs to those IP subnets can be load balanced.  This document defines extensions to EVPN procedures to optimally handle unequal access bandwidth distribution across a set of multi-homing PEs in order to:<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-abstract-2.1">
        provide greater flexibility, with respect to adding or removing individual multi-homed PE-CE links.<a href="#section-abstract-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-abstract-2.2">
        handle multi-homed PE-CE link failures that can result in unequal PE-CE access bandwidth across a set of multi-homing PEs.<a href="#section-abstract-2.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 21 May 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-requirements-language-and-t" class="xref">Requirements Language and Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-pe-ce-link-provisioning" class="xref">PE-CE Link Provisioning</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-pe-ce-link-failures" class="xref">PE-CE Link Failures</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-design-requirement" class="xref">Design Requirement</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-solution-overview" class="xref">Solution Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-evpn-link-bandwidth-extende" class="xref">EVPN Link Bandwidth Extended Community</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-encoding-and-usage-of-evpn-" class="xref">Encoding and Usage of EVPN Link Bandwidth Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-note-on-bgp-link-bandwidth-" class="xref">Note on BGP Link Bandwidth Extended Community</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-weighted-unicast-traffic-lo" class="xref">Weighted Unicast Traffic Load-balancing to an Ethernet Segment</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-egress-pe-behavior" class="xref">Egress PE Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-ingress-pe-behavior" class="xref">Ingress PE Behavior</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-weighted-bum-traffic-load-s" class="xref">Weighted BUM Traffic Load-Sharing across an Ethernet Segment</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-the-bw-capability-in-the-df" class="xref">The BW Capability in the DF Election Extended Community</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-bw-capability-and-default-d" class="xref">BW Capability and Default DF Election algorithm</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-bw-capability-and-hrw-df-el" class="xref">BW Capability and HRW DF Election algorithm (Type 1 and 4)</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.1">
                    <p id="section-toc.1-1.6.2.3.2.1.1"><a href="#section-6.3.1" class="xref">6.3.1</a>.  <a href="#name-bw-increment" class="xref">BW Increment</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3.2.2">
                    <p id="section-toc.1-1.6.2.3.2.2.1"><a href="#section-6.3.2" class="xref">6.3.2</a>.  <a href="#name-hrw-hash-computations-with-" class="xref">HRW Hash Computations with BW Increment</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-bw-capability-and-preferenc" class="xref">BW Capability and Preference DF Election algorithm</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-cost-benefit-tradeoff-on-li" class="xref">Cost-Benefit Tradeoff on Link Failures</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-real-time-available-bandwid" class="xref">Real-time Available Bandwidth</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-weighted-load-balancing-to-" class="xref">Weighted Load-balancing to Multi-homed Subnets</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-weighted-load-balancing-wit" class="xref">Weighted Load-balancing without EVPN aliasing</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-evpn-irb-multi-homing-with-" class="xref">EVPN-IRB Multi-homing With Non-EVPN routing</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-operational-considerations" class="xref">Operational Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="xref">16</a>. <a href="#name-contributors" class="xref">Contributors</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-17" class="xref">17</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.1">
                <p id="section-toc.1-1.17.2.1.1"><a href="#section-17.1" class="xref">17.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17.2.2">
                <p id="section-toc.1-1.17.2.2.1"><a href="#section-17.2" class="xref">17.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.18">
            <p id="section-toc.1-1.18.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Req">
<section id="section-1">
      <h2 id="name-requirements-language-and-t">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-requirements-language-and-t" class="section-name selfRef">Requirements Language and Terminology</a>
      </h2>
<p id="section-1-1">The key words "MUST", "MUST NOT",
          "REQUIRED", "SHALL",
          "SHALL NOT", "SHOULD",
          "SHOULD NOT", "RECOMMENDED",
          "MAY", and "OPTIONAL" in this document
          are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span>.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
          "Local PE" in the context of an Ethernet Segment refers to a provider edge switch OR router that physically hosts the Ethernet Segment.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
          "Remote PE" in the context of an Ethernet Segment refers to a provider edge switch OR router in an EVPN overlay, whose overlay reachability to the Ethernet Segment is via the Local PE.<a href="#section-1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-4.1">BW: BandWidth<a href="#section-1-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.2">LAG: Link Aggregation Group<a href="#section-1-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.3">ES:  Ethernet Segment<a href="#section-1-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.4">ESI:  Ethernet Segment ID<a href="#section-1-4.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.5">vES: Virtual Ethernet Segment<a href="#section-1-4.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.6">EVI: Ethernet virtual Instance, this is a mac-vrf.<a href="#section-1-4.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.7">Path-List: A forwarding object used to load-balance routed or bridged traffic across multiple forwarding paths.<a href="#section-1-4.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.8">Access Bandwidth: Bandwidth of PE-CE links in an Ethernet Segment<a href="#section-1-4.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.9">Egress PE: In the context of an Ethernet Segment or a route, this is the PE that advertises a locally attached Ethernet Segment RT-1, or a locally attached host or prefix route (RT-2, RT-5).<a href="#section-1-4.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.10">Ingress PE: In the context of an Ethernet Segment or a route, this is the receiving PE that learns remote Ethernet Segment RT-1 and/or host and prefix routes (RT-2, RT-5) from the Egress PE<a href="#section-1-4.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.11">IMET: Inclusive Multicast Route<a href="#section-1-4.11" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.12">DF: Designated Forwarder<a href="#section-1-4.12" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.13">BDF: Backup Designated Forwarder<a href="#section-1-4.13" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-4.14">DCI: Data Center Interconnect Router<a href="#section-1-4.14" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="Intro">
<section id="section-2">
      <h2 id="name-introduction">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-2-1">
        In an EVPN-IRB based network overlay, with a CE multi-homed via a EVPN all-active multi-homing, bridged and routed traffic from ingress PEs can be equally load balanced (ECMPed) across the multi-homing egress PEs:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">
            ECMP Load-balancing for bridged unicast traffic is enabled via aliasing and mass-withdraw procedures detailed in RFC 7432.<a href="#section-2-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.2">
            ECMP Load-balancing for routed unicast traffic is enabled via existing L3 ECMP mechanisms.<a href="#section-2-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.3">
            Load-sharing of bridged BUM traffic on local ports is enabled via EVPN DF election procedure detailed in RFC 7432<a href="#section-2-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-2-3">
        All of the above load balancing and DF election procedures implicitly assume equal bandwidth distribution between the CE and the set of egress PEs. Essentially, with this assumption of equal "access" bandwidth distribution across all egress PEs, ALL remote traffic is equally load balanced across the egress PEs. This assumption of equal access bandwidth distribution can be restrictive with respect to adding / removing links in a multi-homed LAG interface and may also be easily broken on individual link failures. A solution to handle unequal access bandwidth distribution across a set of egress PEs is proposed in this document. Primary motivation behind this proposal is to enable greater flexibility with respect to adding / removing member PE-CE links, as needed and to optimally handle PE-CE link failures.<a href="#section-2-3" class="pilcrow">¶</a></p>
<div id="PE-CE">
<section id="section-2.1">
        <h3 id="name-pe-ce-link-provisioning">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-pe-ce-link-provisioning" class="section-name selfRef">PE-CE Link Provisioning</a>
        </h3>
<div id="pece_prov_example">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-2.1-1.1">
<pre>
                      +------------------------+
                      | Underlay Network Fabric|
                      +------------------------+

                          +-----+   +-----+
                          | PE1 |   | PE2 |
                          +-----+   +-----+
                             \         /
                              \  ES-1 /
                               \     /
                               +\---/+
                               | \ / |
                               +--+--+
                                  |
                                 CE1
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a></figcaption></figure>
</div>
<p id="section-2.1-2">
          Consider CE1 that is dual-homed to egress PE1 and egress PE2 via EVPN all-active multi-homing with single member links of equal bandwidth to each PE (aka, equal access bandwidth distribution across PE1 and PE2). If the provider wants to increase link bandwidth to CE1, it must add a link to both PE1 and PE2 in order to maintain equal access bandwidth distribution and inter-work with EVPN ECMP load balancing. In other words, for a dual-homed CE, total number of CE links must be provisioned in multiples of 2 (2, 4, 6, and so on). For a triple-homed CE, number of CE links must be provisioned in multiples of three (3, 6, 9, and so on). To generalize, for a CE that is multi-homed to "n" PEs, number of PE-CE physical links provisioned must be an integral multiple of "n". This is restrictive in case of dual-homing and very quickly becomes prohibitive in case of multi-homing.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.1-3">
          Instead, a provider may wish to increase PE-CE bandwidth OR number of links in any link increments. As an example, for CE1 dual-homed to egress PE1 and egress PE2 in all-active mode, provider may wish to add a third link to only PE1 to increase total bandwidth for this CE by 50%, rather than being required to increase access bandwidth by 100% by adding a link to each of the two PEs. While existing EVPN based all-active load balancing procedures do not necessarily preclude such asymmetric access bandwidth distribution among the PEs providing redundancy, it may result in unexpected traffic loss due to congestion in the access interface towards CE. This traffic loss is due to the fact that PE1 and PE2 will continue to be treated as equal cost paths at remote PEs, and as a result may attract approximately equal amount of CE1 destined traffic, even when PE2 only has half the bandwidth to CE1 as PE1. This may lead to congestion and traffic loss on the PE2-CE1 link. If bandwidth distribution to CE1 across PE1 and PE2 is 2:1, traffic from remote hosts must also be load balanced across PE1 and PE2 in 2:1 manner.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="PE-CE-Link-Failures">
<section id="section-2.2">
        <h3 id="name-pe-ce-link-failures">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-pe-ce-link-failures" class="section-name selfRef">PE-CE Link Failures</a>
        </h3>
<p id="section-2.2-1">
          More importantly, unequal PE-CE bandwidth distribution described above may occur during regular operation following a link failure, even when PE-CE links were provisioned to provide equal bandwidth distribution across multi-homing PEs.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div id="pece_link_failure">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-2.2-2.1">
<pre>
                        +------------------------+
                        | Underlay Network Fabric|
                        +------------------------+

                            +-----+   +-----+
                            | PE1 |   | PE2 |
                            +-----+   +-----+
                              \\         //
                               \\  ES-1 //
                                \\     /X
                                +\\---//+
                                | \\ // |
                                +---+---+
                                    |
                                   CE1
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a></figcaption></figure>
</div>
<p id="section-2.2-3">
          Consider a CE1 that is multi-homed to egress PE1 and egress PE2 via a LAG with two member links to each PE. On a PE2-CE1 physical link failure, LAG represented by an Ethernet Segment ES-1 on PE2 stays up, however, its bandwidth is cut in half. With existing ECMP procedures, both PE1 and PE2 may continue to attract equal amount of traffic from remote PEs, even when PE1 has double the bandwidth to CE1. If bandwidth distribution to CE1 across PE1 and PE2 is 2:1, traffic from remote hosts must also be load balanced across PE1 and PE2 in 2:1 manner to avoid unexpected congestion and traffic loss on PE2-CE1 links within the LAG. As an alternative, min-link on LAGs is sometimes used to bring down the LAG interface on member link failures. This however results in loss of available bandwidth in the network, and is not ideal.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Design-Requirement">
<section id="section-2.3">
        <h3 id="name-design-requirement">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-design-requirement" class="section-name selfRef">Design Requirement</a>
        </h3>
<div id="design_requirement">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-2.3-1.1">
<pre>
                           +-----------------------+
                           |Underlay Network Fabric|
                           +-----------------------+

                 +-----+   +-----+           +-----+   +-----+
                 | PE1 |   | PE2 |   .....   | PEx |   | PEn |
                 +-----+   +-----+           +-----+   +-----+
                    \       \                 //        //
                     \ L1    \ L2            // Lx     // Ln
                      \       \             //        //
                     +-\-------\-----------//--------//-+
                     |  \       \  ES-1   //        //  |
                     +----------------------------------+
                                      |
                                      CE
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a></figcaption></figure>
</div>
<p id="section-2.3-2">
          To generalize, if total link bandwidth to a CE is distributed across "n" egress PEs, with Lx being the total bandwidth to PEx across all links, traffic from ingress PEs to this CE must be load balanced unequally across egress PE set [PE1, PE2, ....., PEn] such that, fraction of total unicast and BUM flows destined for CE that are serviced by egress PEx is:<a href="#section-2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.3-3">
          Lx / [L1+L2+.....+Ln]<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">
          Figure 3 illustrates a scenario where egress PE1..PEn are attached to a multi-homed Ethernet Segment, however this document generalizes this requirement so that the unequal load balancing can be applied to PEs attached to a vES or to a multi-homed subnet advertised by EVPN IP Prefix routes.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
<p id="section-2.3-5">
          The solution proposed below includes extensions to EVPN procedures to achieve the above. Following assumption apply to procedure described in this document:<a href="#section-2.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.3-6.1">
            For procedures related to bridged unicast and BUM traffic, EVPN all active multi-homing is assumed.<a href="#section-2.3-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-2.3-6.2">
            Procedures related to bridged unicast and BUM traffic are applicable to both aliasing and non-alaising mode as defined in [RFC7432].<a href="#section-2.3-6.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="Solution-Overview">
<section id="section-3">
      <h2 id="name-solution-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-solution-overview" class="section-name selfRef">Solution Overview</a>
      </h2>
<p id="section-3-1">
        In order to achieve weighted load balancing to an ES or vES for overlay unicast traffic, Ethernet A-D per ES route (EVPN Route Type 1) is leveraged to signal the Ethernet Segment weight to ingress PEs.  Using Ethernet A-D per ES route to signal the Ethernet Segment weight provides a mechanism that reacts to changes in access bandwidth or number of access links in a service and host independent manner.  Ingress PEs computing the MAC path-lists based on global and aliasing Ethernet A-D routes now have the ability to setup weighted load balancing path-lists based on the ES access bandwidth or number of links received from each egress PE that the ES is multi-homed to.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
        In order to achieve weighted load balancing of overlay BUM traffic, EVPN ES route (Route Type 4) is leveraged to signal the ES weight to egress PEs within an ES's redundancy group to influence per-service DF election.  Egress PEs in an ES redundancy group now have the ability to do service carving in proportion to each egress PE's relative ES weight.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">
        Unequal load balancing to multi-homed subnets is achieved by signaling the weight along with the IP Prefix routes advertised for the subnet.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">
        Procedures to accomplish this are described in greater detail next.<a href="#section-3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Link-Bandwidth-Extended-Community">
<section id="section-4">
      <h2 id="name-evpn-link-bandwidth-extende">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-evpn-link-bandwidth-extende" class="section-name selfRef">EVPN Link Bandwidth Extended Community</a>
      </h2>
<p id="section-4-1">
        A new EVPN Link Bandwidth extended community is defined for the solution specified in this document:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
            This extended community is defined of type 0x06 (EVPN).<a href="#section-4-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.2">
            IANA is requested to assign a sub-type value of 0x10 for the EVPN Link bandwidth extended community, of type 0x06 (EVPN).<a href="#section-4-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-2.3">
            EVPN Link Bandwidth extended community is defined as transitive.<a href="#section-4-2.3" class="pilcrow">¶</a>
</li>
      </ul>
<div id="Link-Bandwidth-Extended-Community-Usage">
<section id="section-4.1">
        <h3 id="name-encoding-and-usage-of-evpn-">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-encoding-and-usage-of-evpn-" class="section-name selfRef">Encoding and Usage of EVPN Link Bandwidth Extended Community</a>
        </h3>
<p id="section-4.1-1">
          EVPN Link Bandwidth Extended Community value field is used to carry total bandwidth of egress PE's all physical links in an ethernet segment, expressed in Mbits/sec (MegabitsPerSecond) represented as an unsigned integer. Note however that the load balancing algorithm defined in this document uses ratio of Link Bandwidths. Hence, the operator may choose a different unit or use the community as a generalized weight that may be set to link count, locally configured weight, or a value computed based on something other than link bandwidth. In such case, the operator MUST ensure consistent usage of the unit across all egress PEs in an ethernet segment. This may involve multiple routing domains/Autonomous Systems.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">
          In order to facilitate this, as well as avoid interop issues because of provisioning error, one octet in the extended community's six octet 'value' field is used to explicitly signal if the weight encoded in the remaining five octets is link bandwidth expressed in Mbps or a generalized weight value. This results in the following encoding for EVPN link bandwidth extended community:<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<div id="e_c_format">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-4.1-3.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |    Sub-Type   |  Value-Units  |               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+               +
|                          Value-Weight                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a></figcaption></figure>
</div>
<p id="section-4.1-4">
          Value-Units is encoded as:<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-5.1">
              0x00: weight expressed using default units of Mbps<a href="#section-4.1-5.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-5.2">
              0x01: generalized weight expressed in something other than Mbps<a href="#section-4.1-5.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.1-6"> 
          Generalized weight units are intentionally left arbritrary to allow for flexibility in its usage for different applications without having to define new encoding for each non-default application. Implementations SHOULD support the default units of Mbps, while support of non-default generalized weight is considered optional.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<p id="section-4.1-7">
        Additionally, following considerations apply to handling of this extended community at the ingress PE:<a href="#section-4.1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-8.1">
          An ingress PE MUST check for consistent 'Value-Units' received in the EVPN link bandwidth exteneded community from each egress PE in an Ethernet Segment. In case of any inconsistency in 'Value-Units' across egress PEs in an Ethernet Segment, this EVPN Link Bandwidth extended community is to be ignored.<a href="#section-4.1-8.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.1-8.2">
          An ingress PE MUST ensure that each route contains only a single instance of this extended community sub-type. In case of more than one instance, this EVPN Link Bandwidth extended community is to be ignored.<a href="#section-4.1-8.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="BGP-Link-Bandwidth-Extended-Community">
<section id="section-4.2">
        <h3 id="name-note-on-bgp-link-bandwidth-">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-note-on-bgp-link-bandwidth-" class="section-name selfRef">Note on BGP Link Bandwidth Extended Community</a>
        </h3>
<p id="section-4.2-1">
          Link bandwidth extended community described in [BGP-LINK-BW] for layer 3 VPNs was considered for re-use here. This Link bandwidth extended community is however defined in [BGP-LINK-BW] as optional non-transitive. Since it is not possible to change deployed behavior of extended community defined in [BGP-LINK-BW], it was decided to define a new one. In inter-AS scenarios, link-bandwidth needs to be signaled to eBGP neighbors. When signaled across AS boundary, this extended community can be used to achieve optimal load-balancing towards egress PEs in a different AS. This is applicable both when next-hop is changed or unchanged across AS boundaries.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Weighted-Unicast-Traffic-Load-balancing">
<section id="section-5">
      <h2 id="name-weighted-unicast-traffic-lo">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-weighted-unicast-traffic-lo" class="section-name selfRef">Weighted Unicast Traffic Load-balancing to an Ethernet Segment</a>
      </h2>
<div id="Egress-PE-Behavior">
<section id="section-5.1">
        <h3 id="name-egress-pe-behavior">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-egress-pe-behavior" class="section-name selfRef">Egress PE Behavior</a>
        </h3>
<p id="section-5.1-1">
          A PE that is part of an Ethernet Segment's redundancy group SHOULD advertise an additional "EVPN link bandwidth" extended community with Ethernet A-D per ES route (EVPN Route Type 1), that carries total bandwidth of PE's physical links in an Ethernet Segment or a generalized weight. New EVPN link bandwidth extended community defined in this document is used for this purpose.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">
          EVPN link bandwidth extended community SHOULD NOT be attached to per-EVI RT-1 or to EVPN RT-2.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Ingress-E-Behavior">
<section id="section-5.2">
        <h3 id="name-ingress-pe-behavior">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-ingress-pe-behavior" class="section-name selfRef">Ingress PE Behavior</a>
        </h3>
<p id="section-5.2-1">
          An ingress PE MUST ensure that the EVPN link bandwidth extended community is recevied from all the egress PEs in an Ethernet Segment and check for consistent 'Value-Units' received from each egress PE in an Ethernet Segment. In case of missing EVPN Link Bandwidth extended community OR inconsistent 'Value-Units' from any of the egress PEs in an Ethernet Segment, this EVPN Link Bandwidth extended community is to be ignored by the ingress PE and ingress PE is to follow regular ECMP forwarding to that Ethernet Segment.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">
          Once consistency of 'Value-Units' is validated, ingress PE SHOULD use the 'Value-Weight' received from each egress PE to compute a relative (normalized) weight for each egress PE, per ES, and then use this relative weight to compute a weighted path-list to be used for load balancing, as opposed to using an ECMP path-list for load balancing across the egress PE paths. Egress PE Weight and resulting weighted path-list computation at ingress PEs is a local matter. An example computation algorithm is shown below to illustrate the idea:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">
          if,<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">
          L(x,y) : link bandwidth advertised by egress PE-x for ES-y<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">
          W(x,y) : normalized weight assigned to egress PE-x for ES-y<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6">
          H(y)   : Highest Common Factor (HCF) of [L(1,y), L(2,y), ....., L(n,y)]<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">
          then, the normalized weight assigned to egress PE-x for ES-y may be computed as follows:<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<p id="section-5.2-8">
          W(x,y) = L(x,y) / H(y)<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<p id="section-5.2-9">
          For a MAC+IP route (EVPN Route Type 2) received with ES-y, ingress PE may compute MAC and IP forwarding path-list weighted by the above normalized weights.<a href="#section-5.2-9" class="pilcrow">¶</a></p>
<p id="section-5.2-10">
          As an example, for a CE multi-homed to PE-1, PE-2, PE-3 via 2, 1, and 1 GE physical links respectively, as part of a LAG represented by ES-10:<a href="#section-5.2-10" class="pilcrow">¶</a></p>
<p id="section-5.2-11">
          L(1, 10) = 2000 Mbps<a href="#section-5.2-11" class="pilcrow">¶</a></p>
<p id="section-5.2-12">
          L(2, 10) = 1000 Mbps<a href="#section-5.2-12" class="pilcrow">¶</a></p>
<p id="section-5.2-13">
          L(3, 10) = 1000 Mbps<a href="#section-5.2-13" class="pilcrow">¶</a></p>
<p id="section-5.2-14">
          H(10) = 1000<a href="#section-5.2-14" class="pilcrow">¶</a></p>
<p id="section-5.2-15">
          Normalized weights assigned to each egress PE for ES-10 are as follows:<a href="#section-5.2-15" class="pilcrow">¶</a></p>
<p id="section-5.2-16">
          W(1, 10) = 2000 / 1000 = 2.<a href="#section-5.2-16" class="pilcrow">¶</a></p>
<p id="section-5.2-17">
          W(2, 10) = 1000 / 1000 = 1.<a href="#section-5.2-17" class="pilcrow">¶</a></p>
<p id="section-5.2-18">
          W(3, 10) = 1000 / 1000 = 1.<a href="#section-5.2-18" class="pilcrow">¶</a></p>
<p id="section-5.2-19">
          For a remote MAC+IP host route received with ES-10, forwarding load balancing path-list may now be computed as: [PE-1, PE-1, PE-2, PE-3] instead of [PE-1, PE-2, PE-3]. This now results in load balancing of all traffic destined for ES-10 across the three egress PEs in proportion to ES-10 bandwidth at each egress PE.<a href="#section-5.2-19" class="pilcrow">¶</a></p>
<p id="section-5.2-20">
          Weighted path-list computation must only be done for an ES if EVPN link bandwidth extended community is received from all of the egress PE's advertising reachability to that ES via Ethernet A-D per ES Route Type 1. In an unlikely event that EVPN link bandwidth extended community is not received from one or more egress PEs, forwarding path-list should be computed using regular ECMP semantics. Note that a default weight cannot be assumed for an egress PE that does not advertise its link bandwidth as the weight to be used in path-list computation is relative.<a href="#section-5.2-20" class="pilcrow">¶</a></p>
<p id="section-5.2-21">
          If per-ES RT-1 is not advertised or withdrawn from any of the egress PE(s), as per [RFC7432], egress PE is removed from the forwarding path-list for that [EVI, ES]. Hence, the weighted path-list MUST be re-computed.<a href="#section-5.2-21" class="pilcrow">¶</a></p>
<p id="section-5.2-22">
          In an unlikely scenario that per-[ES, EVI] RT-1 is not advertised from any of the egress PE(s), as per [RFC7432], egress PE is not included in the forwarding path-list for that [EVI, ES]. Hence, the weighted path-list for the [EVI, ES] MUST be computed based only on the weights received from egress PEs that advertised the per-[ES, EVI] RT-1.<a href="#section-5.2-22" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="Weighted-BUM-Traffic-Load-Sharing">
<section id="section-6">
      <h2 id="name-weighted-bum-traffic-load-s">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-weighted-bum-traffic-load-s" class="section-name selfRef">Weighted BUM Traffic Load-Sharing across an Ethernet Segment</a>
      </h2>
<p id="section-6-1">
        Optionally, load sharing of per-service DF role, weighted by individual egress PE's link-bandwidth share within a multi-homed ES may also be achieved.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">
        In order to do that, a new DF Election Capability [RFC8584] called "BW" (Bandwidth Weighted DF Election) is defined. BW MAY be used along with some DF Election Types, as described in the following sections.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="BW-Capability">
<section id="section-6.1">
        <h3 id="name-the-bw-capability-in-the-df">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-the-bw-capability-in-the-df" class="section-name selfRef">The BW Capability in the DF Election Extended Community</a>
        </h3>
<p id="section-6.1-1">
          [RFC8584] defines a new extended community for PEs within a redundancy group to signal and agree on uniform DF Election Type and Capabilities for each ES. This document requests IANA to allocate a bit in the "DF Election capabilities" registry setup by [RFC8584]:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">
          Bit 4: BW (Bandwidth Weighted DF Election)<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">
          ES routes advertised with the BW bit set will indicate the desire of the advertising egress PE to consider the link-bandwidth in the DF Election algorithm defined by the value in the "DF Type".<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">
          As per [RFC8584], all the egress PEs in the ES MUST advertise the same Capabilities and DF Type, otherwise the PEs will fall back to Default [RFC7432] DF Election procedure.<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5">
          The BW Capability MAY be advertised with the following DF Types:<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-6.1">
              Type 0: Default DF Election algorithm, as in [RFC7432]<a href="#section-6.1-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.2">
              Type 1: HRW algorithm, as in [RFC8584]<a href="#section-6.1-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.3">
              Type 2: Preference algorithm, as in [EVPN-DF-PREF]<a href="#section-6.1-6.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.1-6.4">
              Type 4: HRW per-multicast flow DF Election, as in [EVPN-PER-MCAST-FLOW-DF]<a href="#section-6.1-6.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.1-7">
          The following sections describe how the DF Election procedures are modified for the above DF Types when the BW Capability is used.<a href="#section-6.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="BW-Capability-def">
<section id="section-6.2">
        <h3 id="name-bw-capability-and-default-d">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-bw-capability-and-default-d" class="section-name selfRef">BW Capability and Default DF Election algorithm</a>
        </h3>
<p id="section-6.2-1">
          When all the PEs in the Ethernet Segment (ES) agree to use the BW Capability with DF Type 0, the Default DF Election procedure as defined in [RFC7432] is modified as follows:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2-2.1">
              Each PE advertises a "EVPN Link Bandwidth" extended community along with the ES route to signal the PE-CE link bandwidth (LBW) for the ES.<a href="#section-6.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.2">
              A receiving egress PE MUST use the ES link bandwidth extended community received from each egress PE to compute a relative weight for each egress PE in an Ethernet Segment.<a href="#section-6.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.2-2.3">
              The DF Election procedure MUST now use this weighted list of egress PEs to compute the per-VLAN Designated Forwarder, such that the DF role is distributed in proportion to this normalized weight. As a result, a single PE may have multiple ordinals in the DF candidate PE list and 'N' used in (V mod N) operation as defined in [RFC7432] is modified to be total number of ordinals instead of being total number of egress PEs in an Ethernet Segment.<a href="#section-6.2-2.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-6.2-3">
          Considering the same example as in Section 5.2, the candidate PE list for DF election is:<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<p id="section-6.2-4">
          [PE-1, PE-1, PE-2, PE-3].<a href="#section-6.2-4" class="pilcrow">¶</a></p>
<p id="section-6.2-5">
          The DF for a given VLAN-a on ES-10 is now computed as (VLAN-a % 4). This would result in the DF role being distributed across PE1, PE2, and PE3 in portion to each PE's normalized weight for ES-10.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="BW-Capability-hrw">
<section id="section-6.3">
        <h3 id="name-bw-capability-and-hrw-df-el">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-bw-capability-and-hrw-df-el" class="section-name selfRef">BW Capability and HRW DF Election algorithm (Type 1 and 4)</a>
        </h3>
<p id="section-6.3-1">
          [RFC8584] introduces Highest Random Weight (HRW) algorithm (DF Type 1) for DF election in order to solve potential DF election skew depending on Ethernet tag space distribution. [EVPN-PER-MCAST-FLOW-DF] further extends HRW algorithm for per-multicast flow based hash computations (DF Type 4). This section describes extensions to HRW Algorithm for EVPN DF Election specified in [RFC8584] and in [EVPN-PER-MCAST-FLOW-DF] in order to achieve DF election distribution that is weighted by link bandwidth.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<div id="BW-increment">
<section id="section-6.3.1">
          <h4 id="name-bw-increment">
<a href="#section-6.3.1" class="section-number selfRef">6.3.1. </a><a href="#name-bw-increment" class="section-name selfRef">BW Increment</a>
          </h4>
<p id="section-6.3.1-1">
          A new variable called "bandwidth increment" is computed for each [PE, ES] advertising the ES link bandwidth extended community as follows:<a href="#section-6.3.1-1" class="pilcrow">¶</a></p>
<p id="section-6.3.1-2">
          In the context of an ES,<a href="#section-6.3.1-2" class="pilcrow">¶</a></p>
<p id="section-6.3.1-3">
          L(i) = Link bandwidth advertised by PE(i) for this ES<a href="#section-6.3.1-3" class="pilcrow">¶</a></p>
<p id="section-6.3.1-4">
          L(min) = lowest link bandwidth advertised across all PEs for this ES<a href="#section-6.3.1-4" class="pilcrow">¶</a></p>
<p id="section-6.3.1-5">
          Bandwidth increment, "b(i)" for a given PE(i) advertising a link bandwidth of L(i) is defined as an integer value computed as:<a href="#section-6.3.1-5" class="pilcrow">¶</a></p>
<p id="section-6.3.1-6">
          b(i) = L(i) / L(min)<a href="#section-6.3.1-6" class="pilcrow">¶</a></p>
<p id="section-6.3.1-7">
          As an example,<a href="#section-6.3.1-7" class="pilcrow">¶</a></p>
<p id="section-6.3.1-8">
          with PE(1) = 10, PE(2) = 10, PE(3) = 20<a href="#section-6.3.1-8" class="pilcrow">¶</a></p>
<p id="section-6.3.1-9">
          bandwidth increment for each PE would be computed as:<a href="#section-6.3.1-9" class="pilcrow">¶</a></p>
<p id="section-6.3.1-10">
          b(1) = 1, b(2) = 1, b(3) = 2<a href="#section-6.3.1-10" class="pilcrow">¶</a></p>
<p id="section-6.3.1-11">
          with PE(1) = 10, PE(2) = 10, PE(3) = 10<a href="#section-6.3.1-11" class="pilcrow">¶</a></p>
<p id="section-6.3.1-12">
          bandwidth increment for each PE would be computed as:<a href="#section-6.3.1-12" class="pilcrow">¶</a></p>
<p id="section-6.3.1-13">
          b(1) = 1, b(2) = 1, b(3) = 1<a href="#section-6.3.1-13" class="pilcrow">¶</a></p>
<p id="section-6.3.1-14">
          Note that the bandwidth increment must always be an integer, including, in an unlikely scenario of a PE's link bandwidth not being an exact multiple of L(min). If it computes to a non-integer value (including as a result of link failure), it MUST be rounded down to an integer.<a href="#section-6.3.1-14" class="pilcrow">¶</a></p>
</section>
</div>
<div id="BW-hash">
<section id="section-6.3.2">
          <h4 id="name-hrw-hash-computations-with-">
<a href="#section-6.3.2" class="section-number selfRef">6.3.2. </a><a href="#name-hrw-hash-computations-with-" class="section-name selfRef">HRW Hash Computations with BW Increment</a>
          </h4>
<p id="section-6.3.2-1">
          HRW algorithm as described in [RFC8584] and in [EVPN-PER-MCAST-FLOW-DF] computes a random hash value for each PE(i), where, (0 &lt; i &lt;= N), PE(i) is the PE at ordinal i, and Address(i) is the IP address of PE(i).<a href="#section-6.3.2-1" class="pilcrow">¶</a></p>
<p id="section-6.3.2-2">
          For 'N' PEs sharing an Ethernet segment, this results in 'N' candidate hash computations. The PE that has the highest hash value is selected as the DF.<a href="#section-6.3.2-2" class="pilcrow">¶</a></p>
<p id="section-6.3.2-3">
          We refer to this hash value as "affinity" in this document. Hash or affinity computation for each PE(i) is extended to be computed one per bandwidth increment associated with PE(i) instead of a single affinity computation per PE(i).<a href="#section-6.3.2-3" class="pilcrow">¶</a></p>
<p id="section-6.3.2-4">
          PE(i) with b(i) = j, results in j affinity computations:<a href="#section-6.3.2-4" class="pilcrow">¶</a></p>
<p id="section-6.3.2-5">
          affinity(i, x), where 1 &lt; x &lt;= j<a href="#section-6.3.2-5" class="pilcrow">¶</a></p>
<p id="section-6.3.2-6">
          This essentially results in number of candidate HRW hash computations for each PE that is directly proportional to that PE's relative bandwidth within an ES and hence gives PE(i) a probability of being DF in proportion to it's relative bandwidth within an ES.<a href="#section-6.3.2-6" class="pilcrow">¶</a></p>
<p id="section-6.3.2-7">
          As an example, consider an ES that is multi-homed to two PEs, PE1 and PE2, with equal bandwidth distribution across PE1 and PE2. This would result in a total of two candidate hash computations:<a href="#section-6.3.2-7" class="pilcrow">¶</a></p>
<p id="section-6.3.2-8">
          affinity(PE1, 1)<a href="#section-6.3.2-8" class="pilcrow">¶</a></p>
<p id="section-6.3.2-9">
          affinity(PE2, 1)<a href="#section-6.3.2-9" class="pilcrow">¶</a></p>
<p id="section-6.3.2-10">
          Now, consider a scenario with PE1's link bandwidth as 2x that of PE2. This would result in a total of three candidate hash computations to be used for DF election:<a href="#section-6.3.2-10" class="pilcrow">¶</a></p>
<p id="section-6.3.2-11">
          affinity(PE1, 1)<a href="#section-6.3.2-11" class="pilcrow">¶</a></p>
<p id="section-6.3.2-12">
          affinity(PE1, 2)<a href="#section-6.3.2-12" class="pilcrow">¶</a></p>
<p id="section-6.3.2-13">
          affinity(PE2, 1)<a href="#section-6.3.2-13" class="pilcrow">¶</a></p>
<p id="section-6.3.2-14">
          which would give PE1 2/3 probability of getting elected as a DF, in proportion to its relative bandwidth in the ES.<a href="#section-6.3.2-14" class="pilcrow">¶</a></p>
<p id="section-6.3.2-15">
          Depending on the chosen HRW hash function, affinity function MUST be extended to include bandwidth increment in the computation.<a href="#section-6.3.2-15" class="pilcrow">¶</a></p>
<p id="section-6.3.2-16">
          For e.g.,<a href="#section-6.3.2-16" class="pilcrow">¶</a></p>
<p id="section-6.3.2-17">
          affinity function specified in [EVPN-PER-MCAST-FLOW-DF] MAY be extended as follows to incorporate bandwidth increment j:<a href="#section-6.3.2-17" class="pilcrow">¶</a></p>
<p id="section-6.3.2-18">
          affinity(S,G,V, ESI, Address(i,j)) = (1103515245.((1103515245.Address(i).j + 12345) XOR D(S,G,V,ESI))+12345) (mod 2^31)<a href="#section-6.3.2-18" class="pilcrow">¶</a></p>
<p id="section-6.3.2-19">
          affinity or random function specified in [RFC8584] MAY be extended as follows to incorporate bandwidth increment j:<a href="#section-6.3.2-19" class="pilcrow">¶</a></p>
<p id="section-6.3.2-20">
          affinity(v, Es, Address(i,j)) = (1103515245((1103515245.Address(i).j + 12345) XOR D(v,Es))+12345)(mod 2^31)<a href="#section-6.3.2-20" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="bw-capab-pref-df">
<section id="section-6.4">
        <h3 id="name-bw-capability-and-preferenc">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-bw-capability-and-preferenc" class="section-name selfRef">BW Capability and Preference DF Election algorithm</a>
        </h3>
<p id="section-6.4-1">
        This section applies to ES'es where all the PEs in the ES agree use the BW Capability with DF Type 2. The BW Capability modifies the Preference DF Election procedure [EVPN-DF-PREF], by adding the LBW value as a tie-breaker as follows:<a href="#section-6.4-1" class="pilcrow">¶</a></p>
<p id="section-6.4-2">
        Section 4.1, bullet (f) in [EVPN-DF-PREF] now considers the LBW value:<a href="#section-6.4-2" class="pilcrow">¶</a></p>
<p id="section-6.4-3">
          f) In case of equal Preference in two or more PEs in the ES, the tie-breakers will be the DP bit, the LBW value and the lowest IP PE in that order. For instance:<a href="#section-6.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.4-4.1">
            If vES1 parameters were [Pref=500,DP=0,LBW=1000] in PE1 and [Pref=500,DP=1, LBW=2000] in PE2, PE2 would be elected due to the DP bit.<a href="#section-6.4-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-4.2">
            If vES1 parameters were [Pref=500,DP=0,LBW=1000] in PE1 and [Pref=500,DP=0, LBW=2000] in PE2, PE2 would be elected due to a higher LBW, even if PE1's IP address is lower.<a href="#section-6.4-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-6.4-4.3">
            The LBW exchanged value has no impact on the Non-Revertive option described in [EVPN-DF-PREF].<a href="#section-6.4-4.3" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="cost-benefit">
<section id="section-7">
      <h2 id="name-cost-benefit-tradeoff-on-li">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-cost-benefit-tradeoff-on-li" class="section-name selfRef">Cost-Benefit Tradeoff on Link Failures</a>
      </h2>
<p id="section-7-1">
        While incorporating link bandwidth into the DF election process provides optimal BUM traffic distribution across the ES links, it also implies that DF elections are re-adjusted on link failures or bandwidth changes. If the operator does not wish to have this level of churn in their DF election, then they should not advertise the BW capability. Not advertising BW capability may result in less than optimal BUM traffic distribution while still retaining the ability to allow an ingress PE to do weighted ECMP for its unicast traffic to a set of egress PEs.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rt-avail-bw">
<section id="section-8">
      <h2 id="name-real-time-available-bandwid">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-real-time-available-bandwid" class="section-name selfRef">Real-time Available Bandwidth</a>
      </h2>
<p id="section-8-1"> 
      PE-CE link bandwidth availability may sometimes vary in real-time disproportionately across PE-CE links within a multi-homed ES due to various factors such as flow based hashing combined with fat flows and unbalanced hashing. Reacting to real-time available bandwidth is at this time outside the scope of this document.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rt-5">
<section id="section-9">
      <h2 id="name-weighted-load-balancing-to-">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-weighted-load-balancing-to-" class="section-name selfRef">Weighted Load-balancing to Multi-homed Subnets</a>
      </h2>
<p id="section-9-1"> 
      EVPN Link bandwidth extended community may also be used to achieve unequal load-balancing of prefix routed traffic by including this extended community in EVPN Route Type 5. When included in EVPN RT-5, its value is to be interpreted as egress PE's relative weight for the prefix included in this RT-5. Ingress PE will then compute the forwarding path-list for the prefix route using weighted paths received from each egress PE.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-aliasing">
<section id="section-10">
      <h2 id="name-weighted-load-balancing-wit">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-weighted-load-balancing-wit" class="section-name selfRef">Weighted Load-balancing without EVPN aliasing</a>
      </h2>
<p id="section-10-1"> 
      [RFC7432] defines per-[ES, EVI] RT-1 based EVPN aliasing procedure as an optional propcedure. In an unlikely scenario where an EVPN implementation does not support EVPN aliasing procedures, MAC forwarding path-list at the ingress PE is computed based on per-ES RT-1 and RT-2 routes received from egress PEs, instead of per-ES RT-1 and per-[ES, EVI] RT-1 from egress PEs. In such a case, only the weights received via per-ES RT-1 from the egress PEs included in the MAC path-list are to be considered for weighted path-list computation.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="non-evpn">
<section id="section-11">
      <h2 id="name-evpn-irb-multi-homing-with-">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-evpn-irb-multi-homing-with-" class="section-name selfRef">EVPN-IRB Multi-homing With Non-EVPN routing</a>
      </h2>
<p id="section-11-1">
      EVPN-LAG based multi-homing on an IRB gateway may also be deployed together with non-EVPN routing, such as global routing or an L3VPN routing control plane. Key property that differentiates this set of use cases from EVPN IRB use cases discussed earlier is that EVPN control plane is used only to enable LAG interface based multi-homing and NOT as an overlay VPN control plane. Applicability of weighted ECMP procedures proposed in this document to these set of use cases is an area of further consideration beyond the scope of this document.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Oper">
<section id="section-12">
      <h2 id="name-operational-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-operational-considerations" class="section-name selfRef">Operational Considerations</a>
      </h2>
<p id="section-12-1">
        None<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-13">
      <h2 id="name-security-considerations">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-13-1">
        This document raises no new security issues for EVPN.<a href="#section-13-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-14">
      <h2 id="name-iana-considerations">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-14-1">
          [RFC8584] defines a new extended community for PEs within a redundancy group to signal and agree on uniform DF Election Type and Capabilities for each ES. This document requests IANA to allocate a bit in the "DF Election capabilities" registry setup by [RFC8584]:<a href="#section-14-1" class="pilcrow">¶</a></p>
<p id="section-14-2">
          Bit 4: BW (Bandwidth Weighted DF Election)<a href="#section-14-2" class="pilcrow">¶</a></p>
<p id="section-14-3">
          A new EVPN Link Bandwidth extended community is defined to signal local ES link bandwidth to ingress PEs. This extended community is defined of type 0x06 (EVPN). IANA is requested to assign a sub-type value of 0x10 for the EVPN Link bandwidth extended community, of type 0x06 (EVPN). EVPN Link Bandwidth extended community is defined as transitive.<a href="#section-14-3" class="pilcrow">¶</a></p>
<p id="section-14-4">
          IANA is requested to set up a registry called "Value-Units" for the 1-octet field in the EVPN Link Bandwidth Extended Community. New registrations will be made through the "RFC Required" procedure defined in [RFC8126]. The following initial values in that registry exist:<a href="#section-14-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-14-5">
<pre>
Value       Name                             Reference
----        ----------------                 -------------
0           Weight in units of Mbps          This document
1           Generalized Weight               This document
2-255       Unassigned
</pre><a href="#section-14-5" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Acknowledgements">
<section id="section-15">
      <h2 id="name-acknowledgements">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-15-1">
      Authors would like to thank Satya Mohanty for valuable review and inputs with respect to HRW and weighted HRW algorithm refinements proposed in this document. Authors would also like to thank Bruno Decraene and Sergey Fomin for valuable review and comments.<a href="#section-15-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Contributors">
<section id="section-16">
      <h2 id="name-contributors">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-contributors" class="section-name selfRef">Contributors</a>
      </h2>
<div class="alignLeft art-text artwork" id="section-16-1">
<pre>
Satya Ranjan Mohanty
Cisco Systems
US
Email: satyamoh@cisco.com</pre><a href="#section-16-1" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-17">
      <h2 id="name-references">
<a href="#section-17" class="section-number selfRef">17. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-17.1">
        <h3 id="name-normative-references">
<a href="#section-17.1" class="section-number selfRef">17.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="EVPN-DF-PREF">[EVPN-DF-PREF]</dt>
        <dd>
<span class="refAuthor">Rabadan, J.</span>, <span class="refAuthor">Sathappan, S.</span>, <span class="refAuthor">Przygienda, T.</span>, <span class="refAuthor">Lin, W.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Mohanty, S.</span>, <span class="refTitle">"Preference-based EVPN DF Election"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-pref-df-06</span>, <time datetime="2020-06-19" class="refDate">19 June 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-pref-df-06.txt">https://tools.ietf.org/html/draft-ietf-bess-evpn-pref-df-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EVPN-PER-MCAST-FLOW-DF">[EVPN-PER-MCAST-FLOW-DF]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">mishra, m.</span>, <span class="refAuthor">Thoria, S.</span>, <span class="refAuthor">Rabadan, J.</span>, and <span class="refAuthor">J. Drake</span>, <span class="refTitle">"Per multicast flow Designated Forwarder Election for EVPN"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-per-mcast-flow-df-election-04</span>, <time datetime="2020-08-31" class="refDate">31 August 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-bess-evpn-per-mcast-flow-df-election-04.txt">http://www.ietf.org/internet-drafts/draft-ietf-bess-evpn-per-mcast-flow-df-election-04.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="EVPN-VIRTUAL-ES">[EVPN-VIRTUAL-ES]</dt>
        <dd>
<span class="refAuthor">Sajassi, A.</span>, <span class="refAuthor">Brissette, P.</span>, <span class="refAuthor">Schell, R.</span>, <span class="refAuthor">Drake, J.</span>, <span class="refAuthor">Rabadan, J.</span>, <span class="refTitle">"EVPN Virtual Ethernet Segment"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-bess-evpn-virtual-eth-segment-06</span>, <time datetime="2020-03-09" class="refDate">9 March 2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-bess-evpn-virtual-eth-segment-06.txt">https://tools.ietf.org/html/draft-ietf-bess-evpn-virtual-eth-segment-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7432">[RFC7432]</dt>
        <dd>
<span class="refAuthor">Sajassi, A., Ed.</span>, <span class="refAuthor">Aggarwal, R.</span>, <span class="refAuthor">Bitar, N.</span>, <span class="refAuthor">Isaac, A.</span>, <span class="refAuthor">Uttaro, J.</span>, <span class="refAuthor">Drake, J.</span>, and <span class="refAuthor">W. Henderickx</span>, <span class="refTitle">"BGP MPLS-Based Ethernet VPN"</span>, <span class="seriesInfo">RFC 7432</span>, <span class="seriesInfo">DOI 10.17487/RFC7432</span>, <time datetime="2015-02" class="refDate">February 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7432">https://www.rfc-editor.org/info/rfc7432</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7814">[RFC7814]</dt>
        <dd>
<span class="refAuthor">Xu, X.</span>, <span class="refAuthor">Jacquenet, C.</span>, <span class="refAuthor">Raszuk, R.</span>, <span class="refAuthor">Boyes, T.</span>, and <span class="refAuthor">B. Fee</span>, <span class="refTitle">"Virtual Subnet: A BGP/MPLS IP VPN-Based Subnet Extension Solution"</span>, <span class="seriesInfo">RFC 7814</span>, <span class="seriesInfo">DOI 10.17487/RFC7814</span>, <time datetime="2016-03" class="refDate">March 2016</time>, <span>&lt;<a href="https://tools.ietf.org/html/rfc7814">https://tools.ietf.org/html/rfc7814</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8584">[RFC8584]</dt>
      <dd>
<span class="refAuthor">Rabadan, J., Ed.</span>, <span class="refAuthor">Mohanty, R.</span>, <span class="refAuthor">Sajassi, N.</span>, <span class="refAuthor">Drake, A.</span>, <span class="refAuthor">Nagaraj, K.</span>, and <span class="refAuthor">S. Sathappan</span>, <span class="refTitle">"Framework for Ethernet VPN Designated Forwarder Election Extensibility"</span>, <span class="seriesInfo">RFC 8584</span>, <span class="seriesInfo">DOI 10.17487/RFC8584</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8584">https://www.rfc-editor.org/info/rfc8584</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-17.2">
        <h3 id="name-informative-references">
<a href="#section-17.2" class="section-number selfRef">17.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="BGP-LINK-BW">[BGP-LINK-BW]</dt>
      <dd>
<span class="refAuthor">Mohapatra, P.</span> and <span class="refAuthor">R. Fernando</span>, <span class="refTitle">"BGP Link Bandwidth Extended Community"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-idr-link-bandwidth-07</span>, <time datetime="2019-03" class="refDate">March 2019</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-idr-link-bandwidth-07.txt">https://tools.ietf.org/html/draft-ietf-idr-link-bandwidth-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Neeraj Malhotra (<span class="role">editor</span>)</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">170 W. Tasman Drive</span></div>
<div dir="auto" class="left">
<span class="locality">San Jose</span>, <span class="region">CA</span> <span class="postal-code">95134</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:nmalhotr@cisco.com" class="email">nmalhotr@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Ali Sajassi</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">170 W. Tasman Drive</span></div>
<div dir="auto" class="left">
<span class="locality">San Jose</span>, <span class="region">CA</span> <span class="postal-code">95134</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sajassi@cisco.com" class="email">sajassi@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jorge Rabadan</span></div>
<div dir="auto" class="left"><span class="org">Nokia</span></div>
<div dir="auto" class="left"><span class="street-address">777 E. Middlefield Road</span></div>
<div dir="auto" class="left">
<span class="locality">Mountain View</span>, <span class="region">CA</span> <span class="postal-code">94043</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jorge.rabadan@nokia.com" class="email">jorge.rabadan@nokia.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">John Drake</span></div>
<div dir="auto" class="left"><span class="org">Juniper</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jdrake@juniper.net" class="email">jdrake@juniper.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Avinash Lingala</span></div>
<div dir="auto" class="left"><span class="org">ATT</span></div>
<div dir="auto" class="left"><span class="street-address">200 S. Laurel Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Middletown</span>, <span class="region">CA</span> <span class="postal-code">07748</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ar977m@att.com" class="email">ar977m@att.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Samir Thoria</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div dir="auto" class="left"><span class="street-address">170 W. Tasman Drive</span></div>
<div dir="auto" class="left">
<span class="locality">San Jose</span>, <span class="region">CA</span> <span class="postal-code">95134</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sthoria@cisco.com" class="email">sthoria@cisco.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
