<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>QUIC-based UDP Transport for Secure Shell (SSH)</title>
<meta content="denis bider" name="author">
<meta content="
       The Secure Shell protocol (SSH)   is widely used for purposes including secure remote administration, file transfer using SFTP and SCP, and encrypted tunneling of TCP connections. Because it is based on TCP, SSH suffers similar problems as motivate the HTTP protocol to transition its transport to UDP-based QUIC  . These include: unauthenticated network intermediaries can trivially disconnect SSH sessions; SSH connections are lost when mobile clients change IP addresses; performance limitations in OS-based TCP stacks; any many round-trips to establish the connection. This memo specifies SSH key exchange over UDP and leverages QUIC to provide a UDP-based transport. 
    " name="description">
<meta content="xml2rfc 2.46.0" name="generator">
<meta content="SSH" name="keyword">
<meta content="QUIC" name="keyword">
<meta content="Secure Shell" name="keyword">
<meta content="draft-bider-ssh-quic-01" name="ietf.draft">
<link href="/tmp/draft-bider-ssh-quic-01-j6nr4w3w.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code {
  background-color: #f9f9f9;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">SSH/QUIC</td>
<td class="right">July 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">bider</td>
<td class="center">Expires 8 January 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Internet Engineering Task Force</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-bider-ssh-quic-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-07-07" class="published">7 July 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-01-08">8 January 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">d. bider</div>
<div class="org">Bitvise Limited</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">QUIC-based UDP Transport for Secure Shell (SSH)</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">The Secure Shell protocol (SSH) <span>[<a href="#RFC4251" class="xref">RFC4251</a>]</span> is widely used for purposes including secure remote administration, file transfer using SFTP and SCP, and encrypted tunneling of TCP connections. Because it is based on TCP, SSH suffers similar problems as motivate the HTTP protocol to transition its transport to UDP-based QUIC <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>. These include: unauthenticated network intermediaries can trivially disconnect SSH sessions; SSH connections are lost when mobile clients change IP addresses; performance limitations in OS-based TCP stacks; any many round-trips to establish the connection. This memo specifies SSH key exchange over UDP and leverages QUIC to provide a UDP-based transport.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 January 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-requirements-terminology" class="xref">Requirements Terminology</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-ssh-quic-key-exchange" class="xref">SSH/QUIC key exchange</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-distinguishing-ssh-key-exch" class="xref">Distinguishing SSH key exchange from QUIC datagrams</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-wire-encoding" class="xref">Wire Encoding</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-packet-limits" class="xref">Packet Limits</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-required-tls-cipher-suites" class="xref">Required TLS Cipher Suites</a><a href="#section-toc.1-1.2.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.5">
                <p id="section-toc.1-1.2.2.5.1"><a href="#section-2.5" class="xref">2.5</a>.  <a href="#name-random-elements" class="xref">Random Elements</a><a href="#section-toc.1-1.2.2.5.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.6">
                <p id="section-toc.1-1.2.2.6.1"><a href="#section-2.6" class="xref">2.6</a>.  <a href="#name-errors-in-key-exchange" class="xref">Errors in Key Exchange</a><a href="#section-toc.1-1.2.2.6.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.6.2.1">
                    <p id="section-toc.1-1.2.2.6.2.1.1"><a href="#section-2.6.1" class="xref">2.6.1</a>.  <a href="#name-disc-reason-extension-pair" class="xref">"disc-reason" Extension Pair</a><a href="#section-toc.1-1.2.2.6.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.6.2.2">
                    <p id="section-toc.1-1.2.2.6.2.2.1"><a href="#section-2.6.2" class="xref">2.6.2</a>.  <a href="#name-err-desc-extension-pair" class="xref">"err-desc" Extension Pair</a><a href="#section-toc.1-1.2.2.6.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.7">
                <p id="section-toc.1-1.2.2.7.1"><a href="#section-2.7" class="xref">2.7</a>.  <a href="#name-ssh_quic_init" class="xref">SSH_QUIC_INIT</a><a href="#section-toc.1-1.2.2.7.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.7.2.1">
                    <p id="section-toc.1-1.2.2.7.2.1.1"><a href="#section-2.7.1" class="xref">2.7.1</a>.  <a href="#name-extensibility" class="xref">Extensibility</a><a href="#section-toc.1-1.2.2.7.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.8">
                <p id="section-toc.1-1.2.2.8.1"><a href="#section-2.8" class="xref">2.8</a>.  <a href="#name-ssh_quic_reply" class="xref">SSH_QUIC_REPLY</a><a href="#section-toc.1-1.2.2.8.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.8.2.1">
                    <p id="section-toc.1-1.2.2.8.2.1.1"><a href="#section-2.8.1" class="xref">2.8.1</a>.  <a href="#name-error-reply" class="xref">Error Reply</a><a href="#section-toc.1-1.2.2.8.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.8.2.2">
                    <p id="section-toc.1-1.2.2.8.2.2.1"><a href="#section-2.8.2" class="xref">2.8.2</a>.  <a href="#name-extensibility-2" class="xref">Extensibility</a><a href="#section-toc.1-1.2.2.8.2.2.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.2.2.9">
                <p id="section-toc.1-1.2.2.9.1"><a href="#section-2.9" class="xref">2.9</a>.  <a href="#name-ssh_quic_cancel" class="xref">SSH_QUIC_CANCEL</a><a href="#section-toc.1-1.2.2.9.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.2.2.9.2.1">
                    <p id="section-toc.1-1.2.2.9.2.1.1"><a href="#section-2.9.1" class="xref">2.9.1</a>.  <a href="#name-extensibility-3" class="xref">Extensibility</a><a href="#section-toc.1-1.2.2.9.2.1.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-key-exchange-methods" class="xref">Key Exchange Methods</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-required-key-exchange-metho" class="xref">Required Key Exchange Methods</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-example-curve25519-sha256" class="xref">Example: "curve25519-sha256"</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-ssh_msg_ext_info-and-the-ss" class="xref">SSH_MSG_EXT_INFO and the SSH Version String</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-ssh-version-extension" class="xref">"ssh-version" Extension</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-quic-session-setup" class="xref">QUIC Session Setup</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-shared-secrets" class="xref">Shared Secrets</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-ssh-quic-packet-format" class="xref">SSH/QUIC Packet Format</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="compact toc ulEmpty">
<li class="compact toc ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="compact toc ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-appendix-generating-random-" class="xref">Appendix: Generating Random Lengths</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="compact toc ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="intro">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">THIS DOCUMENT IS AN EARLY VERSION AND IS A WORK IN PROGRESS.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">NON-LATEST DRAFT VERSIONS MUST BE DISREGARDED.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">IMPLEMENTATION AT THIS STAGE IS EXPERIMENTAL.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">CONTACT THE AUTHOR IF YOU INTEND TO IMPLEMENT.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This memo specifies SSH key exchange over UDP, and then leverages QUIC to provide a UDP-based transport for SSH. QUIC's use of the TLS handshake is replaced with a 1-RTT SSH/QUIC key exchange. The SSH Authentication Protocol <span>[<a href="#RFC4252" class="xref">RFC4252</a>]</span> and the SSH Connection Protocol <span>[<a href="#RFC4254" class="xref">RFC4254</a>]</span> are then conducted over UDP stream 0 in the same way as they would be over TCP.<a href="#section-1-5" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-requirements-terminology">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-requirements-terminology" class="section-name selfRef">Requirements Terminology</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="ssh-quic-kex">
<section id="section-2">
      <h2 id="name-ssh-quic-key-exchange">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-ssh-quic-key-exchange" class="section-name selfRef">SSH/QUIC key exchange</a>
      </h2>
<div id="distinguish">
<section id="section-2.1">
        <h3 id="name-distinguishing-ssh-key-exch">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-distinguishing-ssh-key-exch" class="section-name selfRef">Distinguishing SSH key exchange from QUIC datagrams</a>
        </h3>
<p id="section-2.1-1">UDP datagrams which form the SSH/QUIC key exchange are sent between the same client and server IP addresses and ports as QUIC datagrams. It is therefore necessary for clients and servers to distinguish SSH key exchange datagrams from QUIC datagrams.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.1-2">A distinction is allowed by that SSH/QUIC only requires the sending of QUIC Short Header Packets. Therefore, all UDP datagrams where the first byte has its high bit set can be handled as part of an SSH/QUIC key exchange.<a href="#section-2.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="wire">
<section id="section-2.2">
        <h3 id="name-wire-encoding">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-wire-encoding" class="section-name selfRef">Wire Encoding</a>
        </h3>
<p id="section-2.2-1">This memo uses wire encoding types "byte", "uint32", "mpint" and "string" with meanings as described in <span>[<a href="#RFC4251" class="xref">RFC4251</a>]</span>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">This memo defines a new wire encoding type "short-str", encoded as follows:<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-2.2-3.1">
<pre>
  byte        n = short-str-len (valid values: 0..255)
  byte[n]     short-str-value
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a></figcaption></figure>
</section>
</div>
<div id="limits">
<section id="section-2.3">
        <h3 id="name-packet-limits">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-packet-limits" class="section-name selfRef">Packet Limits</a>
        </h3>
<p id="section-2.3-1">Clients and servers MUST accept SSH_QUIC_INIT, SSH_QUIC_REPLY and SSH_QUIC_CANCEL packets of sizes at least up to 32768 bytes. This corresponds to minimum SSH packet limits which implementations must support as per <span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>, Section 6.1.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="required-ciphers">
<section id="section-2.4">
        <h3 id="name-required-tls-cipher-suites">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-required-tls-cipher-suites" class="section-name selfRef">Required TLS Cipher Suites</a>
        </h3>
<p id="section-2.4-1">Clients and servers are REQUIRED to implement the TLS cipher suites TLS_AES_128_GCM_SHA256 and TLS_AES_256_GCM_SHA384 <span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>. Other cipher suites are optional.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">Clients and servers MAY permit the user to disable a required cipher suite. However, required suites MUST be enabled by default.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="random-elements">
<section id="section-2.5">
        <h3 id="name-random-elements">
<a href="#section-2.5" class="section-number selfRef">2.5. </a><a href="#name-random-elements" class="section-name selfRef">Random Elements</a>
        </h3>
<p id="section-2.5-1">Unlike SSH over TCP, the packets SSH_QUIC_INIT and SSH_QUIC_REPLY do not provide a "cookie" field for random data. Instead, clients and servers MUST insert random data using the Extensibility mechanisms.<a href="#section-2.5-1" class="pilcrow">¶</a></p>
<p id="section-2.5-2">At the very minimum, clients and servers MUST insert at least 16 Random Bytes or at least one Random Name, as described in <a href="#extensibility-init" class="xref">Section 2.7.1</a> and <a href="#extensibility-reply" class="xref">Section 2.8.2</a>. If at all possible, the random data MUST come from a cryptographically strong random source. Implementations that are unable to meet this requirement MUST still insert the minimum amount of random data, as unpredictably as they are able. Compromising on this requirement reduces the security of any sessions created on the basis of such SSH_QUIC_INIT and SSH_QUIC_REPLY.<a href="#section-2.5-2" class="pilcrow">¶</a></p>
<p id="section-2.5-3">Lengths of Random Names and Random Bytes SHOULD be chosen at random such that lengths in the shorter end of the range are significantly more probable, but long lengths are still selected. See <a href="#appendix-gen-len" class="xref">Appendix A</a>.<a href="#section-2.5-3" class="pilcrow">¶</a></p>
<div id="random-bytes">
<section id="section-2.5.1">
          <h4 id="name-random-bytes">
<a href="#name-random-bytes" class="section-name selfRef">Random Bytes</a>
          </h4>
<p id="section-2.5.1-1">Random Bytes are generated with values 0..255, in a range of lengths as specified for the particular usage context.<a href="#section-2.5.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="random-name">
<section id="section-2.5.2">
          <h4 id="name-random-name">
<a href="#name-random-name" class="section-name selfRef">Random Name</a>
          </h4>
<p id="section-2.5.2-1">A Random Name is generated in one of two forms: Assigned Form or Private Form. One of the two forms is randomly chosen so that Assigned Form, which is shorter, is more likely. The maximum length of a Random Name is 64 bytes.<a href="#section-2.5.2-1" class="pilcrow">¶</a></p>
<div id="random-name-assigned">
<section id="section-2.5.2.1">
            <h5 id="name-assigned-form">
<a href="#name-assigned-form" class="section-name selfRef">Assigned Form</a>
            </h5>
<p id="section-2.5.2.1-1">A Random Name in Assigned Form is generated as a string of random characters with ASCII values 33..126 (inclusive), except @ and the comma (","). Other characters MUST NOT be included. To avoid collisions as effectively as a random UUID, a Random Name in Assigned Form MUST contain at least 20 random characters if the complete character set is used. A Random Name in Assigned Form MUST then be of length 20..64 bytes.<a href="#section-2.5.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.5.2.1-2">Implementations MAY remove up to 7 characters from the character set -- reducing it to 85..91 characters -- without increasing the minimum length. If the character set is further reduced to 69..84 characters, implementations MUST generate at least 21 random characters instead.<a href="#section-2.5.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.5.2.1-3">Example Random Names in Assigned Form:<a href="#section-2.5.2.1-3" class="pilcrow">¶</a></p>
<figure id="figure-2">
              <div class="artwork art-text alignLeft" id="section-2.5.2.1-4.1">
<pre>
   d`kbi&gt;AGrj~r{3lo_Q4r
   wNT)=/8C&lt;(DB1|tr:&gt;1f[xq&gt;9bG
   u7^dE'\EE_}N}^"J5syI?/8jIxup#s7BM:]&gt;{IT_p3Z~&lt;KLa]bIW643XYh07jqZu
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a></figcaption></figure>
</section>
</div>
<div id="random-name-private">
<section id="section-2.5.2.2">
            <h5 id="name-private-form">
<a href="#name-private-form" class="section-name selfRef">Private Form</a>
            </h5>
<p id="section-2.5.2.2-1">Implementations MAY generate a Random Name in Private Form by first generating a Random Name in Assigned Form, then appending a domain name suffix which the implementer controls. A Random Name generated this way MUST NOT exceed 64 bytes. Example Random Names in Private Form:<a href="#section-2.5.2.2-1" class="pilcrow">¶</a></p>
<figure id="figure-3">
              <div class="artwork art-text alignLeft" id="section-2.5.2.2-2.1">
<pre>
(qKR8W%&amp;zJu;$RQkWa[b@bitvise.com
BDPhhC_vI?+8$e_CGty-&gt;wJDYIBX.4zzQ$@denisbider.com
?`z4bb/}&lt;/P[pRJ=SvcCV&lt;k0eUPDIHid#e1giY&gt;&amp;Wuf6O7CE?cA`$j"@bider.us
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a></figcaption></figure>
<p id="section-2.5.2.2-3">Alternately, implementations MAY generate a Random Name in Anonymous Form with the format "(local)@(domain).example.com". In this case, both "(local)" and "(domain)" are replaced by random ASCII characters from the set A..Z, a..z, and 0..9. This is to ensure that the suffix has valid domain name syntax.<a href="#section-2.5.2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.5.2.2-4">To avoid collisions as effectively as a random UUID, a Random Name in Anonymous Form MUST contain at least 22 random characters. A Random Name in Anonymous Form MUST then be of length 35..64 bytes.<a href="#section-2.5.2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="kex-errors">
<section id="section-2.6">
        <h3 id="name-errors-in-key-exchange">
<a href="#section-2.6" class="section-number selfRef">2.6. </a><a href="#name-errors-in-key-exchange" class="section-name selfRef">Errors in Key Exchange</a>
        </h3>
<p id="section-2.6-1">To assist users, clients and servers SHOULD report key exchange errors as follows:<a href="#section-2.6-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.6-2">
          <li id="section-2.6-2.1">If a server cannot send a successful SSH_QUIC_REPLY, it SHOULD send an Error Reply. See <a href="#error-reply" class="xref">Section 2.8.1</a>.<a href="#section-2.6-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-2.6-2.2">If a client receives an invalid SSH_QUIC_REPLY, it SHOULD send an SSH_QUIC_CANCEL. See <a href="#ssh-quic-cancel" class="xref">Section 2.9</a>.<a href="#section-2.6-2.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.6-3">Both packet types use the following extension pairs.<a href="#section-2.6-3" class="pilcrow">¶</a></p>
<div id="disc-reason">
<section id="section-2.6.1">
          <h4 id="name-disc-reason-extension-pair">
<a href="#section-2.6.1" class="section-number selfRef">2.6.1. </a><a href="#name-disc-reason-extension-pair" class="section-name selfRef">"disc-reason" Extension Pair</a>
          </h4>
<p id="section-2.6.1-1">"ext-pair-name" contains "disc-reason".<a href="#section-2.6.1-1" class="pilcrow">¶</a></p>
<p id="section-2.6.1-2">"ext-pair-data" encodes a uint32 with the SSH disconnect reason code. Reason codes are defined in the table "Disconnect Messages Reason Codes and Descriptions" in the IANA registry "Secure Shell (SSH) Protocol Parameters" <span>[<a href="#IANA-SSH" class="xref">IANA-SSH</a>]</span>.<a href="#section-2.6.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="err-desc">
<section id="section-2.6.2">
          <h4 id="name-err-desc-extension-pair">
<a href="#section-2.6.2" class="section-number selfRef">2.6.2. </a><a href="#name-err-desc-extension-pair" class="section-name selfRef">"err-desc" Extension Pair</a>
          </h4>
<p id="section-2.6.2-1">"ext-pair-name" contains "err-desc".<a href="#section-2.6.2-1" class="pilcrow">¶</a></p>
<p id="section-2.6.2-2">"ext-pair-data" encodes a human-readable error description in any language intended to be relevant to the user, encoded as UTF-8.<a href="#section-2.6.2-2" class="pilcrow">¶</a></p>
<p id="section-2.6.2-3">Receivers that process error descriptions MUST validate that the description is valid UTF-8. If a description is long, receivers SHOULD truncate it to a reasonable length depending on the processing context. For example, a debug log file can record a full 32 kB error description, while a production log file SHOULD truncate it to a much shorter length.<a href="#section-2.6.2-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ssh-quic-init">
<section id="section-2.7">
        <h3 id="name-ssh_quic_init">
<a href="#section-2.7" class="section-number selfRef">2.7. </a><a href="#name-ssh_quic_init" class="section-name selfRef">SSH_QUIC_INIT</a>
        </h3>
<p id="section-2.7-1">A client begins an SSH/QUIC session by sending one or more copies of SSH_QUIC_INIT. If multiple copies are sent, copies intended for the same connection MUST be identical. A reasonable strategy is to send one copy every 50 - 500 ms until the client receives a valid SSH_QUIC_REPLY or times out. A server MUST remember recently received SSH_QUIC_INIT packets and send identical SSH_QUIC_REPLY responses. If different SSH_QUIC_INIT packets are received from the same client IP address, the server MUST assume they are intended to begin separate connections, even if they specify the same "client-connection-id". A server MAY implement throttling of incoming connections, by IP address or otherwise, where excessive SSH_QUIC_INIT packets are disregarded. Once a server receives QUIC data confirming that a client has processed an SSH_QUIC_REPLY, the server MUST disregard any further identical copies of the same SSH_QUIC_INIT, at least until the SSH/QUIC session started by such an SSH_QUIC_INIT ends.<a href="#section-2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.7-2">The SSH_QUIC_INIT packet is a UDP datagram with the following layout:<a href="#section-2.7-2" class="pilcrow">¶</a></p>
<figure id="figure-4">
          <div class="artwork art-text alignLeft" id="section-2.7-3.1">
<pre>
  byte        SSH_QUIC_INIT = 0x80     (see Extensibility)
  short-str   client-connection-id     (MAY be empty)

  byte        v = nr-quic-versions     (MUST NOT be zero)
  uint32[v]   client-quic-versions

  string      client-sig-algs          (MUST NOT be empty)

  byte f = nr-trusted-fingerprints     (MAY be zero)
  the following 1 field repeated f times:
     short-str   trusted-fingerprint   (MUST NOT be empty)

  byte k = nr-client-kex-algs          (MUST NOT be zero)
  the following 2 fields repeated k times:
     short-str   client-kex-alg-name   (MUST NOT be empty)
     string      client-kex-alg-data   (MUST NOT be empty)

  byte c = nr-cipher-suites            (MUST NOT be zero)
  the following 1 field repeated c times:
     short-str   quic-tls-cipher-suite

  byte e = nr-ext-pairs                (see Extensibility)
  the following 2 fields repeated e times:
     short-str   ext-pair-name         (MUST NOT be empty)
     string      ext-pair-data         (MAY be empty)

  byte[0..] padding: all 0xFF to minimal packet size 1400
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a></figcaption></figure>
<p id="section-2.7-4">SSH_QUIC_INIT does not include an SSH version string. Instead, clients MUST use SSH_MSG_EXT_INFO for this purpose. See <a href="#ext-info" class="xref">Section 4</a>.<a href="#section-2.7-4" class="pilcrow">¶</a></p>
<p id="section-2.7-5">SSH_QUIC_INIT does not include a "cookie" field for random data. Clients MUST insert random data using Extensibility mechanisms. See <a href="#extensibility-init" class="xref">Section 2.7.1</a> and <a href="#random-elements" class="xref">Section 2.5</a>.<a href="#section-2.7-5" class="pilcrow">¶</a></p>
<p id="section-2.7-6">The field "client-connection-id" contains a QUIC Connection ID of length 0..20 bytes. The server will use this as the QUIC Destination Connection ID in QUIC packets sent to the client. Clients are not required to use a Connection ID if they are using other means of routing connections.<a href="#section-2.7-6" class="pilcrow">¶</a></p>
<p id="section-2.7-7">The fields "client-quic-versions" enumerate QUIC protocol versions supported by the client. The client MUST send at least one version. The client MUST send supported versions in the order it prefers the server to use them.<a href="#section-2.7-7" class="pilcrow">¶</a></p>
<p id="section-2.7-8">The field "client-sig-algs" MUST contain at least one signature algorithm supported by the client for server authentication. These are the same algorithms as used in SSH_MSG_KEXINIT (<span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>, Section 7.1) in the field "server_host_key_algorithms". The client MUST send signature algorithms in the order it prefers the server to use them.<a href="#section-2.7-8" class="pilcrow">¶</a></p>
<p id="section-2.7-9">There MAY be zero or more "trusted-fingerprint" fields. Each "trusted-fingerprint" contains a binary fingerprint of a host key that is trusted for this connection by the client. The fingerprint algorithm is left unspecified. The server SHOULD try to match the fingerprint using all algorithms it supports which produce the provided fingerprint size. The current recommended fingerprint algorithm is SHA-256, with fingerprint size 32 bytes. Servers MUST tolerate the presence of unrecognized fingerprints of any size. The client MUST send trusted host key fingerprints in the order it prefers the server to use them.<a href="#section-2.7-9" class="pilcrow">¶</a></p>
<p id="section-2.7-10">The packet MUST include at least one SSH key exchange algorithm, encoded as a pair of "client-kex-alg-name" and "client-kex-alg-data" fields. The field "client-kex-alg-name" MUST specify a key exchange method which would be valid in the field "kex_algorithms" in SSH_MSG_KEXINIT under <span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>, Section 7.1. In addition, the key exchange method MUST meet criteria in <a href="#kex-algs" class="xref">Section 3</a>.<a href="#section-2.7-10" class="pilcrow">¶</a></p>
<p id="section-2.7-11">If the client wishes to simply advertise its support for a particular key exchange algorithm, but does not prefer to use it in this connection, it MAY enumerate the algorithm with empty "client-kex-alg-data". Otherwise, if the client wishes to allow the algorithm to be used, it MUST include non-empty "client-kex-alg-data". In this case, "client-kex-alg-data" contains the client's portion of key exchange inputs as specified in <a href="#kex-algs" class="xref">Section 3</a>. The client MAY send multiple key exchange algorithms with filled-out "client-kex-alg-data". The client MUST send these algorithms in the order it prefers the server to use them.<a href="#section-2.7-11" class="pilcrow">¶</a></p>
<p id="section-2.7-12">There MUST be at least one "quic-tls-cipher-suite" field. Each of these specifies a TLS cipher suite (<span>[<a href="#RFC8446" class="xref">RFC8446</a>]</span>, Appendix B.4) which is supported by the client, and which can be used with a version of QUIC (<span>[<a href="#QUIC" class="xref">QUIC</a>]</span>, <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>) supported by the client. The client MUST enumerate supported cipher suites in the order it prefers the server to use them.<a href="#section-2.7-12" class="pilcrow">¶</a></p>
<p id="section-2.7-13">The client MAY send any number of extensions, encoded as a pair of "ext-pair-name" and "ext-pair-data" fields. This memo defines no extensions, but see <a href="#extensibility-init" class="xref">Section 2.7.1</a>.<a href="#section-2.7-13" class="pilcrow">¶</a></p>
<p id="section-2.7-14">The "padding" field contains all 0xFF bytes to ensure SSH_QUIC_INIT is at least 1400 bytes in length. Servers MUST ignore SSH_QUIC_INIT packets with a UDP datagram size less than 1400 bytes. This is REQUIRED to prevent abuse of SSH_QUIC_INIT for Amplified Reflection DDoS. If the size of SSH_QUIC_INIT is already 1400 bytes or larger, the padding MAY be omitted.<a href="#section-2.7-14" class="pilcrow">¶</a></p>
<div id="extensibility-init">
<section id="section-2.7.1">
          <h4 id="name-extensibility">
<a href="#section-2.7.1" class="section-number selfRef">2.7.1. </a><a href="#name-extensibility" class="section-name selfRef">Extensibility</a>
          </h4>
<p id="section-2.7.1-1">Implementations MUST allow room for future extensibility of SSH_QUIC_INIT in the following manners:<a href="#section-2.7.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.7.1-2">
            <li id="section-2.7.1-2.1">By using a different packet type in the first byte -- this is, a value other than 0x80 used by SSH_QUIC_INIT. Servers MUST NOT penalize clients for sending unknown packet types unless there is another reason to penalize the client, such as a blocked IP address or the sheer volume of datagrams.<a href="#section-2.7.1-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-2.2">By including algorithms in "client-sig-algs" which are unknown to or not supported by the server. Servers MUST tolerate the presence of such algorithms.<a href="#section-2.7.1-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-2.3">By including fingerprints in "trusted-fingerprints" that use algorithms or lengths that are unknown to or not supported by the server. Servers MUST tolerate the presence of such fingerprints.<a href="#section-2.7.1-2.3" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-2.4">By including SSH key exchange algorithms which are unknown to or not supported by the server, with algorithm data in a format that's unknown to or not supported by the server. Servers MUST tolerate the presence of such algorithms and their data.<a href="#section-2.7.1-2.4" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-2.5">By including QUIC TLS cipher suites which are unknown to or not supported by the server. Servers MUST tolerate the presence of such cipher suites.<a href="#section-2.7.1-2.5" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-2.6">By including extensions which are unknown to or not supported by the server, with extension data in a format that's unknown to or not supported by the server. Servers MUST tolerate the presence of such extensions and their data.<a href="#section-2.7.1-2.6" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-2.7.1-3">Experience shows that any extensibility which is not actively exercised is lost due to implementations that lock down expectations incorrectly. Therefore, all clients MUST do at least one of the following, in each SSH_QUIC_INIT packet, at random:<a href="#section-2.7.1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.7.1-4">
            <li id="section-2.7.1-4.1">In the field "client-sig-algs", include in a random position at least one Random Name (<a href="#random-elements" class="xref">Section 2.5</a>).<a href="#section-2.7.1-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-4.2">In the fields "client-quic-versions", include in a random position a version number of the form 0x0A?A?A?A, where ? indicates a random nibble. See <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>, section "Versions". Note the difference from the random version pattern in the server's SSH_QUIC_REPLY. Due to the minimal amount of entropy provided by this rule, this MUST NOT be the only insertion of randomness made in a packet.<a href="#section-2.7.1-4.2" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-4.3">Include in a random position at least one host key fingerprint consisting of 16..255 Random Bytes (<a href="#random-elements" class="xref">Section 2.5</a>).<a href="#section-2.7.1-4.3" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-4.4">Include in a random position at least one SSH key exchange algorithm where the field "client-kex-alg-name" contains a Random Name, and the field "client-kex-alg-data" contains 0..1000 Random Bytes.<a href="#section-2.7.1-4.4" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-4.5">In the fields "quic-tls-cipher-suite", include in a random position at least one entry consisting of 16..255 Random Bytes.<a href="#section-2.7.1-4.5" class="pilcrow">¶</a>
</li>
            <li id="section-2.7.1-4.6">In extension pairs, include in a random position at least one extension where the field "ext-pair-name" contains a Random Name, and the field "ext-pair-value" contains 0..1000 Random Bytes.<a href="#section-2.7.1-4.6" class="pilcrow">¶</a>
</li>
          </ol>
</section>
</div>
</section>
</div>
<div id="ssh-quic-reply">
<section id="section-2.8">
        <h3 id="name-ssh_quic_reply">
<a href="#section-2.8" class="section-number selfRef">2.8. </a><a href="#name-ssh_quic_reply" class="section-name selfRef">SSH_QUIC_REPLY</a>
        </h3>
<p id="section-2.8-1">Implementations MUST take care to prevent abuse of the SSH/QUIC key exchange for Amplified Reflection DDoS attacks. This means:<a href="#section-2.8-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.8-2">
          <li id="section-2.8-2.1">A server MUST NOT send more than one SSH_QUIC_REPLY in response to any individual SSH_QUIC_INIT.<a href="#section-2.8-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-2.8-2.2">A server MUST NOT respond to any SSH_QUIC_INIT smaller than 1400 bytes.<a href="#section-2.8-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-2.8-2.3">Before sending an SSH_QUIC_REPLY, the server MUST verify that the reply is shorter than the SSH_QUIC_INIT packet to which it is replying. If this is not the case, the server MUST send an Error Reply (<a href="#error-reply" class="xref">Section 2.8.1</a>). Such an Error Reply MUST be shorter than the SSH_QUIC_INIT packet.<a href="#section-2.8-2.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-2.8-3">The SSH_QUIC_REPLY packet is a UDP datagram with the following layout:<a href="#section-2.8-3" class="pilcrow">¶</a></p>
<figure id="figure-5">
          <div class="artwork art-text alignLeft" id="section-2.8-4.1">
<pre>
  byte        SSH_QUIC_REPLY = 0x81
  short-str   server-connection-id   (Non-empty except on error)

  byte        v = nr-quic-versions   (MUST NOT be zero)
  uint32[v]   server-quic-versions

  string      server-sig-algs        (MUST NOT be empty)
  string      server-kex-algs        (MUST NOT be empty)

  byte c = nr-cipher-suites          (MUST NOT be zero)
  the following 1 field repeated c times:
     short-str   quic-tls-cipher-suite

  byte e = nr-ext-pairs              (see Extensibility)
  the following 2 fields repeated e times:
     short-str   ext-pair-name       (MUST NOT be empty)
     string      ext-pair-data       (MAY be empty)

  string      server-kex-alg-data    (Non-empty except on error)
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a></figcaption></figure>
<p id="section-2.8-5">SSH_QUIC_REPLY does not include an SSH version string. Instead, servers MUST use SSH_MSG_EXT_INFO for this purpose. See <a href="#ext-info" class="xref">Section 4</a>.<a href="#section-2.8-5" class="pilcrow">¶</a></p>
<p id="section-2.8-6">SSH_QUIC_REPLY does not include a "cookie" field for random data. Servers MUST insert random data using Extensibility mechanisms. See <a href="#extensibility-reply" class="xref">Section 2.8.2</a> and <a href="#random-elements" class="xref">Section 2.5</a>.<a href="#section-2.8-6" class="pilcrow">¶</a></p>
<p id="section-2.8-7">The field "server-connection-id" contains a QUIC Connection ID of length 0..20 bytes. The client will use this as the QUIC Destination Connection ID in QUIC packets sent to the server.<a href="#section-2.8-7" class="pilcrow">¶</a></p>
<p id="section-2.8-8">The fields "server-quic-versions" enumerate QUIC protocol versions supported by the server. The server MUST send at least one version. The QUIC version used for the connection is the first version enumerated in "client-quic-versions" which is also present in "server-quic-versions". If there is no such version, see <a href="#error-reply" class="xref">Section 2.8.1</a>.<a href="#section-2.8-8" class="pilcrow">¶</a></p>
<p id="section-2.8-9">The field "server-sig-algs" MUST contain at least one signature algorithm supported by the server. These are the same algorithms as used in SSH_MSG_KEXINIT (<span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>, Section 7.1) in the field "server_host_key_algorithms". The server MUST use a host key it possesses that (1) matches any fingerprint enumerated in the "trusted-fingerprint" fields in SSH_QUIC_INIT, regardless of fingerprint position; and (2) can be used with the earliest possible signature algorithm enumerated in "client-sig-algs". If there is no such host key, the server MUST use any host key that can be used with the earliest possible signature algorithm enumerated in "client-sig-algs". If there is no such host key either, see <a href="#error-reply" class="xref">Section 2.8.1</a>.<a href="#section-2.8-9" class="pilcrow">¶</a></p>
<p id="section-2.8-10">...<a href="#section-2.8-10" class="pilcrow">¶</a></p>
<p id="section-2.8-11">...<a href="#section-2.8-11" class="pilcrow">¶</a></p>
<p id="section-2.8-12">...<a href="#section-2.8-12" class="pilcrow">¶</a></p>
<p id="section-2.8-13">...<a href="#section-2.8-13" class="pilcrow">¶</a></p>
<p id="section-2.8-14">...<a href="#section-2.8-14" class="pilcrow">¶</a></p>
<p id="section-2.8-15">...<a href="#section-2.8-15" class="pilcrow">¶</a></p>
<p id="section-2.8-16">...<a href="#section-2.8-16" class="pilcrow">¶</a></p>
<p id="section-2.8-17">The server MAY send any number of extensions, encoded as a pair of "ext-pair-name" and "ext-pair-data" fields. This memo defines no extensions, but see <a href="#extensibility-reply" class="xref">Section 2.8.2</a>.<a href="#section-2.8-17" class="pilcrow">¶</a></p>
<div id="error-reply">
<section id="section-2.8.1">
          <h4 id="name-error-reply">
<a href="#section-2.8.1" class="section-number selfRef">2.8.1. </a><a href="#name-error-reply" class="section-name selfRef">Error Reply</a>
          </h4>
<p id="section-2.8.1-1">If a server encounters an error which is appropriate to communicate to the client, the server MAY send an "Error Reply" version of SSH_QUIC_REPLY. Such a reply is created as follows:<a href="#section-2.8.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8.1-2.1">The server includes and populates all fields of SSH_QUIC_REPLY as it would normally, except that the fields "server-connection-id" and "server-kex-alg-data" MUST remain empty.<a href="#section-2.8.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.8.1-2.2">In the extension pair fields, a "disc-reason" Extension Pair MUST be included. An "err-desc" Extension Pair MAY also be included. See <a href="#kex-errors" class="xref">Section 2.6</a>.<a href="#section-2.8.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.8.1-2.3">Extensibility considerations in <a href="#extensibility-reply" class="xref">Section 2.8.2</a> also apply to an Error Reply.<a href="#section-2.8.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.8.1-3">If the server does not support any of the QUIC protocol versions enumerated by the client, the server SHOULD send an Error Reply with the disconnect reason code SSH_DISCONNECT_PROTOCOL_VERSION_NOT_SUPPORTED.<a href="#section-2.8.1-3" class="pilcrow">¶</a></p>
<p id="section-2.8.1-4">In the following circumstances, the server SHOULD send an Error Reply with the disconnect reason code SSH_DISCONNECT_KEY_EXCHANGE_FAILED:<a href="#section-2.8.1-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.8.1-5.1">If the server could have sent a successful SSH_QUIC_REPLY, but it would have been larger than the client's SSH_QUIC_INIT.<a href="#section-2.8.1-5.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.8.1-5.2">If the server possesses no server host key that can be used with a signature algorithm enumerated in the client's SSH_QUIC_INIT.<a href="#section-2.8.1-5.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.8.1-5.3">If the server supports no key exchange algorithms matching the ones for which the client sent "client-kex-alg-data" in its SSH_QUIC_INPUT.<a href="#section-2.8.1-5.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.8.1-5.4">If the server supports no TLS cipher suites enumerated in the client's SSH_QUIC_INIT.<a href="#section-2.8.1-5.4" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-2.8.1-6">Besides "disc-reason", an "err-desc" extension pair SHOULD be included to describe the specific error.<a href="#section-2.8.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="extensibility-reply">
<section id="section-2.8.2">
          <h4 id="name-extensibility-2">
<a href="#section-2.8.2" class="section-number selfRef">2.8.2. </a><a href="#name-extensibility-2" class="section-name selfRef">Extensibility</a>
          </h4>
<p id="section-2.8.2-1">Implementations MUST allow room for future extensibility of SSH_QUIC_REPLY in the following manners:<a href="#section-2.8.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.8.2-2">
            <li id="section-2.8.2-2.1">By including algorithms in "server-sig-algs" which are unknown to or not supported by the client. Clients MUST tolerate the presence of such algorithms.<a href="#section-2.8.2-2.1" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-2.2">By including SSH key exchange algorithms which are unknown to or not supported by the server, with algorithm data in a format that's unknown to or not supported by the server. Servers MUST tolerate the presence of such algorithms and their data.<a href="#section-2.8.2-2.2" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-2.3">By including QUIC TLS cipher suites which are unknown to or not supported by the client. Clients MUST tolerate the presence of such cipher suites.<a href="#section-2.8.2-2.3" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-2.4">By including extensions which are unknown to or not supported by the client, with extension data in a format that's unknown to or not supported by the client. Clients MUST tolerate the presence of such extensions and their data.<a href="#section-2.8.2-2.4" class="pilcrow">¶</a>
</li>
          </ol>
<p id="section-2.8.2-3">Experience shows that any extensibility which is not actively exercised is lost due to implementations that lock down expectations incorrectly. Therefore, all servers MUST do at least one of the following, in each SSH_QUIC_REPLY packet, at random:<a href="#section-2.8.2-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-2.8.2-4">
            <li id="section-2.8.2-4.1">In the fields "server-quic-versions", include in a random position a version number of the form 0xFA?A?A?A, where ? indicates a random nibble. See <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>, section "Versions". Note the difference from the random version pattern in the client's SSH_QUIC_INIT. Due to the minimal amount of entropy provided by this rule, this MUST NOT be the only insertion of randomness made in a packet.<a href="#section-2.8.2-4.1" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-4.2">In the field "server-sig-algs", include in a random position one Random Name (<a href="#random-elements" class="xref">Section 2.5</a>).<a href="#section-2.8.2-4.2" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-4.3">In the field "server-kex-algs", include in a random position one Random Name (<a href="#random-elements" class="xref">Section 2.5</a>).<a href="#section-2.8.2-4.3" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-4.4">In the fields "quic-tls-cipher-suite", include in a random position one entry consisting of 16..100 Random Bytes.<a href="#section-2.8.2-4.4" class="pilcrow">¶</a>
</li>
            <li id="section-2.8.2-4.5">In extension pairs, include in a random position one extension pair where the field "ext-pair-name" contains a Random Name, and the field "ext-pair-value" contains 0..100 Random Bytes.<a href="#section-2.8.2-4.5" class="pilcrow">¶</a>
</li>
          </ol>
</section>
</div>
</section>
</div>
<div id="ssh-quic-cancel">
<section id="section-2.9">
        <h3 id="name-ssh_quic_cancel">
<a href="#section-2.9" class="section-number selfRef">2.9. </a><a href="#name-ssh_quic_cancel" class="section-name selfRef">SSH_QUIC_CANCEL</a>
        </h3>
<p id="section-2.9-1">If a client cannot process the server's successful SSH_QUIC_REPLY, the client SHOULD report the error to the server using SSH_QUIC_CANCEL.<a href="#section-2.9-1" class="pilcrow">¶</a></p>
<p id="section-2.9-2">A client MUST NOT send an SSH_QUIC_CANCEL in response to an SSH_QUIC_REPLY which is itself an Error Reply. A client MUST assume that such a connection was already canceled by the server.<a href="#section-2.9-2" class="pilcrow">¶</a></p>
<p id="section-2.9-3">The SSH_QUIC_CANCEL packet is a UDP datagram with the following layout:<a href="#section-2.9-3" class="pilcrow">¶</a></p>
<figure id="figure-6">
          <div class="artwork art-text alignLeft" id="section-2.9-4.1">
<pre>
  byte        SSH_QUIC_CANCEL = 0x82
  short-str   server-connection-id

  byte e = nr-ext-pairs             (see Extensibility)
  the following 2 fields repeated e times:
     short-str   ext-pair-name      (MUST NOT be empty)
     string      ext-pair-data      (MAY be empty)
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a></figcaption></figure>
<p id="section-2.9-5">The "server-connection-id" field MUST equal the "server-connection-id" field in the server's SSH_QUIC_REPLY.<a href="#section-2.9-5" class="pilcrow">¶</a></p>
<p id="section-2.9-6">In the extension pair fields, a "disc-reason" Extension Pair MUST be included. An "err-desc" Extension Pair MAY also be included. See <a href="#kex-errors" class="xref">Section 2.6</a>.<a href="#section-2.9-6" class="pilcrow">¶</a></p>
<div id="extensibility-cancel">
<section id="section-2.9.1">
          <h4 id="name-extensibility-3">
<a href="#section-2.9.1" class="section-number selfRef">2.9.1. </a><a href="#name-extensibility-3" class="section-name selfRef">Extensibility</a>
          </h4>
<p id="section-2.9.1-1">Extensibility considerations also apply to SSH_QUIC_CANCEL:<a href="#section-2.9.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.9.1-2.1">Clients MAY include extensions which are unknown to or not supported by the server, with extension data in a format that's unknown to or not supported by the server.<a href="#section-2.9.1-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.9.1-2.2">Servers MUST tolerate the presence of such extensions and their data.<a href="#section-2.9.1-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-2.9.1-2.3">Clients SHOULD include, in a random position, at least one extension pair where the field "ext-pair-name" contains a Random Name, and the field "ext-pair-value" contains 0..300 Random Bytes.<a href="#section-2.9.1-2.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="kex-algs">
<section id="section-3">
      <h2 id="name-key-exchange-methods">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-key-exchange-methods" class="section-name selfRef">Key Exchange Methods</a>
      </h2>
<p id="section-3-1">Clients and servers MAY use any key exchange method which is defined for SSH over TCP, whether it is assigned or private, as long as it meets all of the following criteria:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
        <li id="section-3-2.1">The algorithm requires exactly one message from the client to the server, for example SSH_MSG_KEX_ECDH_INIT. We call this message KEXMSG_CLIENT.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.2">The algorithm requires exactly one reply from the server to the client, for example SSH_MSG_KEX_ECDH_REPLY. We call this message KEXMSG_SERVER.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.3">The algorithm specifies a hash function HASH, for example SHA-256, SHA-384, or SHA-512.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.4">The algorithm specifies calculation of an exchange hash H by applying HASH to a concatenation of encoded fields.<a href="#section-3-2.4" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.5">The algorithm uses a server host key to sign H.<a href="#section-3-2.5" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.6">The algorithm includes the server's public host key, and the signature of H, in its KEXMSG_SERVER message to the client.<a href="#section-3-2.6" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.7">The algorithm produces a shared secret K, represented as a signed multi-precision integer.<a href="#section-3-2.7" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-3-3">Any such algorithm is modified for use in SSH over QUIC as follows:<a href="#section-3-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-4">
        <li id="section-3-4.1">The field "client-kex-alg-data" in SSH_QUIC_INIT encodes the same fields, in the same order, as KEXMSG_CLIENT, except that the leading byte for the SSH packet type is replaced with 0xFA.<a href="#section-3-4.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-4.2">The field "server-kex-alg-data" in SSH_QUIC_REPLY encodes the same fields, in the same order, as KEXMSG_SERVER, except that the leading byte for the SSH packet type is replaced with 0xFB.<a href="#section-3-4.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-4.3">The calculation of H specified by the algorithm is not performed. Instead, H is calculated by applying the hash function HASH to a concatenation of the following:<a href="#section-3-4.3" class="pilcrow">¶</a>
</li>
      </ol>
<figure id="figure-7">
        <div class="artwork art-text alignLeft" id="section-3-5.1">
<pre>
  string   Content of SSH_QUIC_INIT
  string   Content of SSH_QUIC_REPLY, excluding "server-kex-alg-data"
  The fields of "server-kex-alg-data", excluding signature
  mpint    K
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a></figcaption></figure>
<p id="section-3-6">When a field is excluded as above, the entire encoding of the field is omitted: both the encoding of the content and the encoding of the length.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">When SSH packet type bytes are replaced with 0xFA and 0xFB instead of being removed, this is to ensure that at least two fields remain in the encoded content. If this were not the case, there would be situations where an outer string (the field "client-kex-alg-data") contains a single inner string (from KEXMSG_CLIENT). This is prone to confusion by implementers who could then incorrectly encode a single string only.<a href="#section-3-7" class="pilcrow">¶</a></p>
<div id="required-kex">
<section id="section-3.1">
        <h3 id="name-required-key-exchange-metho">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-required-key-exchange-metho" class="section-name selfRef">Required Key Exchange Methods</a>
        </h3>
<p id="section-3.1-1">Clients and servers are REQUIRED to implement the key exchange method "curve25519-sha256" <span>[<a href="#RFC8731" class="xref">RFC8731</a>]</span>. All other key exchange methods are optional.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Clients and servers MAY permit the user to disable a required key exchange method. However, required methods MUST be enabled by default.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="example-curve25519">
<section id="section-3.2">
        <h3 id="name-example-curve25519-sha256">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-example-curve25519-sha256" class="section-name selfRef">Example: "curve25519-sha256"</a>
        </h3>
<p id="section-3.2-1">As an example, when using the SSH key exchange method "curve25519-sha256", the SSH_QUIC_INIT field "client-kex-alg-data" is derived from SSH_MSG_KEX_ECDH_INIT (<span>[<a href="#RFC5656" class="xref">RFC5656</a>]</span>, Section 4) and contains the following:<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<figure id="figure-8">
          <div class="artwork art-text alignLeft" id="section-3.2-2.1">
<pre>
  byte     0xFA
  string   Q_C, client's ephemeral public key octet string
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a></figcaption></figure>
<p id="section-3.2-3">The SSH_QUIC_REPLY field "server-kex-alg-data" is derived from SSH_MSG_KEX_ECDH_REPLY and contains the following:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<figure id="figure-9">
          <div class="artwork art-text alignLeft" id="section-3.2-4.1">
<pre>
  byte     0xFB
  string   K_S, server's public host key
  string   Q_S, server's ephemeral public key octet string
  string   the signature on the exchange hash
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a></figcaption></figure>
<p id="section-3.2-5">The shared secret K is calculated as in <span>[<a href="#RFC8731" class="xref">RFC8731</a>]</span>. Then the exchange hash H is calculated by applying SHA-256 to a concatenation of the following:<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<figure id="figure-10">
          <div class="artwork art-text alignLeft" id="section-3.2-6.1">
<pre>
  string   Content of SSH_QUIC_INIT
  string   Content of SSH_QUIC_REPLY, except "server-kex-alg-data"
  byte     0xFB
  string   K_S, server's public host key
  string   Q_S, server's ephemeral public key octet string
  mpint    K
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a></figcaption></figure>
<p id="section-3.2-7">This allows the server to generate the signature and include it in the "server-kex-alg-data" field sent to the client.<a href="#section-3.2-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="ext-info">
<section id="section-4">
      <h2 id="name-ssh_msg_ext_info-and-the-ss">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-ssh_msg_ext_info-and-the-ss" class="section-name selfRef">SSH_MSG_EXT_INFO and the SSH Version String</a>
      </h2>
<p id="section-4-1">A common user complaint to SSH application authors is that SSH over TCP sends the application version in plain text. The application version cannot be omitted, otherwise implementations cannot support a number of behaviors which other software versions implement incorrectly.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">A prominent example is the order of arguments in the SFTP request SSH_FXP_SYMLINK. To send a request that will have the expected effect, the client MUST consult the server's version string to know whether the server uses the standard order of fields, or a reverse order used by OpenSSH.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">SSH over QUIC removes the version string from the SSH key exchange. Instead, all clients and servers are REQUIRED to send and accept SSH_MSG_EXT_INFO <span>[<a href="#RFC8308" class="xref">RFC8308</a>]</span>, and to include the "ssh-version" extension (below).<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">Clients MUST send SSH_MSG_EXT_INFO as the very first SSH packet over QUIC. The client MUST include the "ssh-version" extension in this SSH_MSG_EXT_INFO.<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">Servers MUST send SSH_MSG_EXT_INFO either:<a href="#section-4-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4-6">
        <li id="section-4-6.1">as the very first SSH packet over QUIC, and/or<a href="#section-4-6.1" class="pilcrow">¶</a>
</li>
        <li id="section-4-6.2">immediately preceding the server's SSH_MSG_USERAUTH_SUCCESS.<a href="#section-4-6.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-4-7">A server MUST include the "ssh-version" extension in at least one of its SSH_MSG_EXT_INFO. If the server sends SSH_MSG_EXT_INFO at both opportunities, it MAY omit "ssh-version" at the first opportunity, but only if it will send it in the second opportunity. The second SSH_MSG_EXT_INFO sent by the server MAY change a previously sent "ssh-version" extension value to include more specific detail. For example, the server MAY include a more accurate server version. The client MUST use the "ssh-version" value which was most recently received from the server.<a href="#section-4-7" class="pilcrow">¶</a></p>
<div id="ssh-version">
<section id="section-4.1">
        <h3 id="name-ssh-version-extension">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-ssh-version-extension" class="section-name selfRef">"ssh-version" Extension</a>
        </h3>
<p id="section-4.1-1">The "ssh-version" extension is encoded in SSH_MSG_EXT_INFO as follows:<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<figure id="figure-11">
          <div class="artwork art-text alignLeft" id="section-4.1-2.1">
<pre>
  string "ssh-version"
  string ssh-version-string
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a></figcaption></figure>
<p id="section-4.1-3">The extension value, "ssh-version-string", contains the same SSH version string as sent at the start of SSH over TCP (<span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>, Section 4.2). Examples:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<figure id="figure-12">
          <div class="artwork art-text alignLeft" id="section-4.1-4.1">
<pre>
  SSH-2.0-Product_1.2
  SSH-2.0-0.12 Library: Application 1.23.00
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a></figcaption></figure>
</section>
</div>
</section>
</div>
<div id="quic-setup">
<section id="section-5">
      <h2 id="name-quic-session-setup">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-quic-session-setup" class="section-name selfRef">QUIC Session Setup</a>
      </h2>
<p id="section-5-1">When the server has sent its SSH_QUIC_REPLY, and when the client has received it, they each initialize the QUIC session <span>[<a href="#QUIC" class="xref">QUIC</a>]</span> <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span> as follows:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-2.1">The QUIC protocol version is set to the first version advertised in the client's SSH_QUIC_INIT which is also present in the server's SSH_QUIC_REPLY.<a href="#section-5-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.2">Session state is set as if a TLS handshake had just completed.<a href="#section-5-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.3">The TLS cipher suite is set to the first TLS cipher suite advertised in SSH_QUIC_INIT which is also present in SSH_QUIC_REPLY.<a href="#section-5-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.4">The QUIC Key Phase bit is set to 0.<a href="#section-5-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-5-2.5">The shared secrets that would have been obtained from the TLS handshake are instead generated from the SSH key exchange (<a href="#shared-secrets" class="xref">Section 5.1</a>).<a href="#section-5-2.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-5-3">Clients and servers MUST immediately begin to use QUIC Short Header Packets. Implementations MUST NOT send QUIC Long Header Packets, since they could be confused with the SSH/QUIC key exchange.<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="shared-secrets">
<section id="section-5.1">
        <h3 id="name-shared-secrets">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-shared-secrets" class="section-name selfRef">Shared Secrets</a>
        </h3>
<p id="section-5.1-1">QUIC-TLS <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span> uses a client secret and a server secret from which it generates an AEAD key, an IV, and a header protection key for each sending direction.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">An SSH key exchange produces a shared secret K, represented as an SSH multi-precision integer, and an exchange digest H, represented as binary data <span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>. An SSH key exchange is parameterized with a hash function we call HASH. Note that HASH can be a different hash function, producing a different hash length, than the hash function used by the negotiated TLS cipher suite.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">To compute the initial QUIC client and server secrets, the client and server encode the following binary data, which we call "secret_data":<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<figure id="figure-13">
          <div class="artwork art-text alignLeft" id="section-5.1-4.1">
<pre>
  mpint    K
  string   H
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a></figcaption></figure>
<p id="section-5.1-5">The client and server secrets are then calculated as follows:<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<figure id="figure-14">
          <div class="artwork art-text alignLeft" id="section-5.1-6.1">
<pre>
  client_secret = HMAC-HASH("ssh/quic client", secret_data)
  server_secret = HMAC-HASH("ssh/quic server", secret_data)
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a></figcaption></figure>
<p id="section-5.1-7">The HMAC construct is as specified in <span>[<a href="#RFC2104" class="xref">RFC2104</a>]</span>, instantiated using the SSH key exchange hash function, HASH.<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<p id="section-5.1-8">QUIC keys and IVs are derived from these secrets using the regular QUIC-TLS key derivation process <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>. Keys generated from these secrets are considered 1-RTT keys.<a href="#section-5.1-8" class="pilcrow">¶</a></p>
<p id="section-5.1-9">Clients and servers MUST implement QUIC key updates using the regular QUIC-TLS key update process <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>, respecting the QUIC-TLS minimum key update frequencies.<a href="#section-5.1-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="packet-format">
<section id="section-6">
      <h2 id="name-ssh-quic-packet-format">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-ssh-quic-packet-format" class="section-name selfRef">SSH/QUIC Packet Format</a>
      </h2>
<p id="section-6-1">All SSH/QUIC packets are sent on QUIC stream 0. No other QUIC streams are used in SSH over QUIC.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Each side serializes its SSH packets for sending over QUIC as follows:<a href="#section-6-2" class="pilcrow">¶</a></p>
<figure id="figure-15">
        <div class="artwork art-text alignLeft" id="section-6-3.1">
<pre>
  uint32    n = payload-len
  byte[n]   payload
</pre>
</div>
<figcaption><a href="#figure-15" class="selfRef">Figure 15</a></figcaption></figure>
<p id="section-6-4">Since security is provided by QUIC-TLS <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>, MAC and random padding are omitted at this stage.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">In SSH/QUIC, compression algorithms negotiated in the initial SSH key exchange are ignored. Such compression does NOT take effect.<a href="#section-6-5" class="pilcrow">¶</a></p>
<p id="section-6-6">Compression MAY be negotiated using the "delay-compression" extension in <span>[<a href="#RFC8308" class="xref">RFC8308</a>]</span>. If "delay-compression" is negotiated, and conditions to enable compression are met, then the "payload" field is compressed.<a href="#section-6-6" class="pilcrow">¶</a></p>
<p id="section-6-7">Otherwise, the "payload" field contains the same packet information as the "payload" field in the Binary Packet Protocol defined in <span>[<a href="#RFC4253" class="xref">RFC4253</a>]</span>.<a href="#section-6-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1">This document requests no changes to IANA registries.<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">Clients and servers MUST insert into SSH_QUIC_INIT and SSH_QUIC_REPLY at least the minimum amount of cryptographically random data as specified in the section Random Elements. Compromising on this requirement reduces the security of any session created on the basis of such an SSH_QUIC_INIT or SSH_QUIC_REPLY.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J.</span><span class="refAuthor"> and M. Thomson</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-transport-29">https://tools.ietf.org/html/draft-ietf-quic-transport-29</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-TLS">[QUIC-TLS]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span><span class="refAuthor"> and S. Turner</span>, <span class="refTitle">"Using TLS to Secure QUIC"</span>, <time datetime="2020" class="refDate">2020</time>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-tls-29">https://tools.ietf.org/html/draft-ietf-quic-tls-29</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2104">[RFC2104]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span><span class="refAuthor">, Bellare, M.</span><span class="refAuthor">, and R. Canetti</span>, <span class="refTitle">"HMAC: Keyed-Hashing for Message Authentication"</span>, <span class="seriesInfo">RFC 2104</span>, <span class="seriesInfo">DOI 10.17487/RFC2104</span>, <time datetime="1997-02" class="refDate">February 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2104">https://www.rfc-editor.org/info/rfc2104</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4251">[RFC4251]</dt>
        <dd>
<span class="refAuthor">Ylonen, T.</span><span class="refAuthor"> and C. Lonvick, Ed.</span>, <span class="refTitle">"The Secure Shell (SSH) Protocol Architecture"</span>, <span class="seriesInfo">RFC 4251</span>, <span class="seriesInfo">DOI 10.17487/RFC4251</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4251">https://www.rfc-editor.org/info/rfc4251</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4253">[RFC4253]</dt>
        <dd>
<span class="refAuthor">Ylonen, T.</span><span class="refAuthor"> and C. Lonvick, Ed.</span>, <span class="refTitle">"The Secure Shell (SSH) Transport Layer Protocol"</span>, <span class="seriesInfo">RFC 4253</span>, <span class="seriesInfo">DOI 10.17487/RFC4253</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4253">https://www.rfc-editor.org/info/rfc4253</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5656">[RFC5656]</dt>
        <dd>
<span class="refAuthor">Stebila, D.</span><span class="refAuthor"> and J. Green</span>, <span class="refTitle">"Elliptic Curve Algorithm Integration in the Secure Shell Transport Layer"</span>, <span class="seriesInfo">RFC 5656</span>, <span class="seriesInfo">DOI 10.17487/RFC5656</span>, <time datetime="2009-12" class="refDate">December 2009</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5656">https://www.rfc-editor.org/info/rfc5656</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8308">[RFC8308]</dt>
        <dd>
<span class="refAuthor">Bider, D.</span>, <span class="refTitle">"Extension Negotiation in the Secure Shell (SSH) Protocol"</span>, <span class="seriesInfo">RFC 8308</span>, <span class="seriesInfo">DOI 10.17487/RFC8308</span>, <time datetime="2018-03" class="refDate">March 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8308">https://www.rfc-editor.org/info/rfc8308</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8446">[RFC8446]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8446">https://www.rfc-editor.org/info/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8731">[RFC8731]</dt>
      <dd>
<span class="refAuthor">Adamantiadis, A.</span><span class="refAuthor">, Josefsson, S.</span><span class="refAuthor">, and M. Baushke</span>, <span class="refTitle">"Secure Shell (SSH) Key Exchange Method Using Curve25519 and Curve448"</span>, <span class="seriesInfo">RFC 8731</span>, <span class="seriesInfo">DOI 10.17487/RFC8731</span>, <time datetime="2020-02" class="refDate">February 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8731">https://www.rfc-editor.org/info/rfc8731</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="IANA-SSH">[IANA-SSH]</dt>
        <dd>
<span class="refAuthor">IANA</span>, <span class="refTitle">"Secure Shell (SSH) Protocol Parameters"</span>, <span></span>, <span>&lt;<a href="https://www.iana.org/assignments/ssh-parameters/">https://www.iana.org/assignments/ssh-parameters/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4250">[RFC4250]</dt>
        <dd>
<span class="refAuthor">Lehtinen, S.</span><span class="refAuthor"> and C. Lonvick, Ed.</span>, <span class="refTitle">"The Secure Shell (SSH) Protocol Assigned Numbers"</span>, <span class="seriesInfo">RFC 4250</span>, <span class="seriesInfo">DOI 10.17487/RFC4250</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4250">https://www.rfc-editor.org/info/rfc4250</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4252">[RFC4252]</dt>
        <dd>
<span class="refAuthor">Ylonen, T.</span><span class="refAuthor"> and C. Lonvick, Ed.</span>, <span class="refTitle">"The Secure Shell (SSH) Authentication Protocol"</span>, <span class="seriesInfo">RFC 4252</span>, <span class="seriesInfo">DOI 10.17487/RFC4252</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4252">https://www.rfc-editor.org/info/rfc4252</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4254">[RFC4254]</dt>
      <dd>
<span class="refAuthor">Ylonen, T.</span><span class="refAuthor"> and C. Lonvick, Ed.</span>, <span class="refTitle">"The Secure Shell (SSH) Connection Protocol"</span>, <span class="seriesInfo">RFC 4254</span>, <span class="seriesInfo">DOI 10.17487/RFC4254</span>, <time datetime="2006-01" class="refDate">January 2006</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4254">https://www.rfc-editor.org/info/rfc4254</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="appendix-gen-len">
<section id="section-appendix.a">
      <h2 id="name-appendix-generating-random-">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-appendix-generating-random-" class="section-name selfRef">Appendix: Generating Random Lengths</a>
      </h2>
<p id="section-appendix.a-1">The SSH/QUIC extensibility mechanism calls for generating random lengths such that values in the shorter end of the range are significantly more probable, but long lengths are still selected. The following C example shows a simple two-step process to prefer shorter lengths:<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<figure id="figure-16">
        <div class="artwork art-text alignLeft" id="section-appendix.a-2.1">
<pre>
    int RandomIntBetweenZeroAnd(int maxValueInclusive);

    int RandomLen_PreferShort(int minLen, int maxLen)
    {
        int const SPAN_THRESHOLD = 7;
        int lenSpan = maxLen - minLen;

        if (lenSpan &lt;= 0)
            return minLen;

        if (lenSpan &gt; SPAN_THRESHOLD)
            if (0 != RandomIntBetweenZeroAnd(3))
                return minLen + RandomIntBetweenZeroAnd(SPAN_THRESHOLD);

        return minLen + RandomIntBetweenZeroAnd(lenSpan);
    }
</pre>
</div>
<figcaption><a href="#figure-16" class="selfRef">Figure 16</a></figcaption></figure>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">denis bider</span></div>
<div dir="auto" class="left"><span class="org">Bitvise Limited</span></div>
<div dir="auto" class="left"><span class="street-address">4105 Lombardy Ct</span></div>
<div dir="auto" class="left">
<span class="locality">Colleyville</span>, <span class="region">TX</span> <span class="postal-code">76034</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ietf-draft@denisbider.com" class="email">ietf-draft@denisbider.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
