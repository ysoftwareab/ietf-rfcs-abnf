<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Email Filtering: Regular Expression Extension</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Email Filtering: Regular Expression Extension">
<meta name="keywords" content="RFC, Request for Comments, Sieve, I-D, Internet-Draft, Regex">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Sieve Working Group</td><td class="header">K. Murchison</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Carnegie Mellon University</td></tr>
<tr><td class="header">Expires: September 24, 2010</td><td class="header">N. Freed</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Oracle Corporation</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 23, 2010</td></tr>
</table></td></tr></table>
<h1><br />Sieve Email Filtering: Regular Expression Extension<br />draft-ietf-sieve-regex-01.txt</h1>

<h3>Abstract</h3>

<p>
This document describes the "regex" extension to the Sieve email filtering
language. In some cases, it is desirable to have a string matching mechanism
which is more powerful than a simple exact match, a substring match or
a glob-style wildcard match.  The regular expression matching
mechanism defined in this draft provides users with much more powerful
string matching capabilities.

</p>
<h3>Change History (to be removed prior to publication as an RFC)</h3>

<p>
Changes from draft-murchison-sieve-regex-08:
</p>
<ul class="text">
<li>Updated to XML source.
</li>
<li>Documented interaction with variables.
</li>
</ul>

<p>
Changes from draft-ietf-sieve-regex-00:
</p>
<ul class="text">
<li>Various cleanup and updates.
</li>
<li>Added trial text specifying comparator interactions.
</li>
</ul>

<h3>Open Issues (to be removed prior to publication as an RFC)</h3>

<p></p>
<ul class="text">
<li>The major open issue with this draft is what to do, if anything, about
localization/internationalization.  Are <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a>
collating sequences and character equivalents sufficient?  Should we
reference the Unicode technical specification?  Should we punt and publish
the document as experimental?

</li>
<li>
Is the current approach to comparator integration the right one to use?

</li>
<li>Should we allow shorthands such as \\b (word boundary) and \\w (word
character)? 

</li>
<li>Should we allow backreferences (useful for matching double words,
etc.)?

</li>
</ul>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>

<a name="intro"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Sieve <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> is a language for filtering email
messages at or around the time of final delivery.  It is designed to be
implementable on either a mail client or mail server.

</p>
<p>
The Sieve base specification defines so-called match types for tests:
is, contains, and matches. An "is" test requires an exact match, a "contains"
test provides a substring match, and "matches" provides glob-style
wildcards. This document describes an extension to the Sieve language
that provides a new match type for regular expression comparisons.

</p>
<a name="conventions"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<p>
The terms used to describe the various components of the Sieve
language are taken from Section 1.1 of <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="capa"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Capability Identifier</h3>

<p>
The capability string associated with the extension defined in this
document is "regex".

</p>
<a name="matchtype"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Regex Match Type</h3>

<p>
When the regex extension is available,
commands that support matching may take the optional tagged argument 
":regex" to specify that a regular expression match should be
performed.  The ":regex" match type is subject to the same rules and
restrictions as the standard match types defined in
<a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>.

</p>
<p>The "MATCH-TYPE" syntax element defined
in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> is augmented here as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
MATCH-TYPE  =/  ":regex"
</pre></div>
<a name="anchor1"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Interaction with Sieve comparators</h3>

<p>
In order to provide for matches between character sets and case
insensitivity, Sieve uses the comparators defined in the Internet
Application Protocol Collation Registry <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
The comparator used by a given test is specified by the :comparator
argument.

</p>
<p>
The interaction between collators and the match types defined in the
Sieve base specification is straightforward. Howeer, the nature of regular
expressions does not lend itself to this usage for the :regex match type.

</p>
<p>
A component of the definition of many collators is a normalization
operation. For example, the "i;octet" comparator employs an identity
normalization; whereas the "i;ascii-casema" normalizes all lower case ASCII
characters to upper case.

</p>
<p>
The :regex match type only uses the normalization component of the associated
comparator. This normalization operation is applied to the key-list argument to
the test; the result of that normalization becomes the target of the regular
expression comparison. The comparator has no effect on the regular expression
pattern or the underlying comparison operation.

</p>
<p>
It is an error to specify a comparator that has no associated normalization
operation in conjunction with a :regex match type.

</p>
<a name="anchor2"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
Regular expression comparisions</h3>

<p>
Implementations MUST support extended regular expressions (EREs) as
defined by <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a>.  Any regular expression
not defined by <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a>, as well as <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a> basic regular expressions, word boundaries
and backreferences are not supported by this
extension. Implementations SHOULD reject regular expressions that are
unsupported by this specification as a syntax error.

</p>
<p>
The following tables provide a brief summary of the regular expressions
that MUST be supported.  This table is presented here only
as a guideline.  <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a> should be used as
the definitive reference.

</p><br /><hr class="insert" />
<a name="regex_single"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Expression</th><th align="left">Pattern</th></tr>
<tr>
<td align="center">.</td>
<td align="left">Match any single character except newline.</td>
</tr>
<tr>
<td align="center">[ ]</td>
<td align="left">Bracket expression.  Match any one of the enclosed characters.  A
hypen (-) indicates a range of consecutive characters.</td>
</tr>
<tr>
<td align="center">[^ ]</td>
<td align="left">Negated bracket expression.  Match any one character NOT in the
enclosed list.  A hypen (-) indicates a range of consecutive
characters.</td>
</tr>
<tr>
<td align="center">\\</td>
<td align="left">Escape the following special character (match the literal
character).  Undefined for other characters.  NOTE: Unlike <a class='info' href='#IEEE.1003-2.1992'>[IEEE.1003&#8209;2.1992]<span> (</span><span class='info'>Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; 1992.</span><span>)</span></a>, 
a double-backslash is required as per section 2.4.2 of <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1: Items to match a single character&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="regex_bracket"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Expression</th><th align="left">Pattern</th></tr>
<tr>
<td align="center">[: :]</td>
<td align="left">Character class (alnum, alpha, blank, cntrl, digit, graph, lower,
print, punct, space, upper, xdigit).</td>
</tr>
<tr>
<td align="center">[= =]</td>
<td align="left">Character equivalents.</td>
</tr>
<tr>
<td align="center">[. .]</td>
<td align="left">Collating sequence.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 2: Items to be used within a bracket expression
(localization)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="regex_quantifer"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Expression</th><th align="left">Pattern</th></tr>
<tr>
<td align="center">?</td>
<td align="left">Match zero or one instances.</td>
</tr>
<tr>
<td align="center">*</td>
<td align="left">Match zero or more instances.</td>
</tr>
<tr>
<td align="center">+</td>
<td align="left">Match one or more instances.</td>
</tr>
<tr>
<td align="center">{n,m}</td>
<td align="left">Match any number of instances between n and m (inclusive).  {n}
matches exactly n instances.  {n,} matches n or more instances.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 3: Quantifiers - Items to count the preceding regular
expression&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="regex_anchor"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Expression</th><th align="left">Pattern</th></tr>
<tr>
<td align="center">^</td>
<td align="left">Match the beginning of the line or string.</td>
</tr>
<tr>
<td align="center">$</td>
<td align="left">Match the end of the line or string.</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 4: Anchoring - Items to match positions&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="regex_other"></a>
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left">
<tr><th align="center">Expression</th><th align="left">Pattern</th></tr>
<tr>
<td align="center">|</td>
<td align="left">Alternation.  Match either of the separated regular
expressions.</td>
</tr>
<tr>
<td align="center">( )</td>
<td align="left">Group the enclosed regular expression(s).</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 5: Other constructs&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="interaction"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
Interaction with Sieve Variables</h3>

<p>This extension is compatible with, and may be used in conjunction
with the Sieve Variables extension <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="matchvar"></a><br /><hr />
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Match variables</h3>

<p>
A sieve interpreter which supports both "regex" and "variables",
MUST set "match variables" (as defined by <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
section 3.2) whenever the ":regex" match type is used.  The list of match
variables will contain the strings corresponding to the group operators in
the regular expression.  The groups are ordered by the position of the
opening parenthesis, from left to right.  Note that in regular
expressions, expansions match as much as possible (greedy
matching).

</p>
<p>Example:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require ["fileinto", "regex", "variables"];

if header :regex "List-ID" "&lt;(.*)@" {
    fileinto "lists.${1}"; stop;
}

# Imagine the header
# Subject: [acme-users] [fwd] version 1.0 is out
if header :regex "Subject" "^[(.*)] (.*)$" {
    # ${1} will hold "acme-users] [fwd"
    stop;
}
</pre></div>
<a name="setmod"></a><br /><hr />
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Set modifier :quoteregex</h3>

<p>A sieve interpreter which supports both "regex" and "variables",
 MUST support the optional tagged argument ":quoteregex" for use with
 the "set" action.  The ":quoteregex" modifier is subject to the same
 rules and restrictions as the standard modifiers defined in <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> section 4.
</p>
<p>For convenience, the "MODIFIER" syntax element defined
in <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> is augmented here as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
MODIFIER  =/  ":quoteregex"
</pre></div>
<p>This modifier adds the necessary quoting to ensure that the
expanded text will only match a literal occurrence if used as a
parameter to :regex.  Every character with special meaning (".", "*",
"?", etc.) is prefixed with "\" in the expansion.  This modifier has a
precedence value of 20 when used with other modifiers.
</p>
<a name="examples"></a><br /><hr />
<a name="rfc.section.8"></a><h3>8.&nbsp;
Examples</h3>

<p>Example:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require "regex";

# Try to catch unsolicited email.
if anyof (
  # if a message is not to me (with optional +detail),
  not address :regex ["to", "cc", "bcc"]
    "me(\\\\+.*)?@company\\\\.com",

  # or the subject is all uppercase (no lowercase)
  header :regex :comparator "i;octet" "subject"
    "^[^[:lower:]]+$" ) {

  discard;    # junk it
}
</pre></div>
<a name="iana"></a><br /><hr />
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>The following template specifies the IANA registration of the
   "regex" Sieve extension specified in this document:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
To: iana@iana.org
Subject: Registration of new Sieve extension


Capability name: regex
Capability keyword: regex
Capability arguments: N/A
Standards Track/IESG-approved experimental RFC number: this RFC
Person and email address to contact for further information:
    Kenneth Murchison
    E-Mail: murch@andrew.cmu.edu

This information should be added to the list of Sieve extensions
given on http://www.iana.org/assignments/sieve-extensions.
</pre></div>
<a name="anchor3"></a><br /><hr />
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
General Sieve security considerations are discussed in <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
All of the issues described there also apply to regular expression matching.

</p>
<p>
It is easy to construct problematic regular expressions that are computationally
infeasible to evaluate. Execution of a Sieve that employs a potentially problematic
regular expression, such as "(.*)*", may cause problems ranging from
degradation of performance to and outright denial of service. Moreover,
determining the computationl complexity associated
with evaluating a given regular expression is in general an intractable problem.

</p>
<p>
For this reason, all implementations MUST take appropriate steps to limit the
impact of runaway regular expression evaluation. Implementations MAY restrict
the regular expressions users are allowed to specify. Implementations that do
not impose such restrictions SHOULD provide a means to abort evaluation of
tests using the :regex match type if the operation is taking too long.

</p>
<a name="rfc.references1"></a><br /><hr />
<h3>11.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="IEEE.1003-2.1992">[IEEE.1003-2.1992]</a></td>
<td class="author-text">Institute of Electrical and Electronics Engineers, &ldquo;Information Technology - Portable Operating System Interface (POSIX) - Part 2: Shell and Utilities (Vol. 1),&rdquo; IEEE&nbsp;Standard 1003.2, 1992.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5229">[RFC5229]</a></td>
<td class="author-text">Homme, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5229">Sieve Email Filtering: Variables Extension</a>,&rdquo; RFC&nbsp;5229, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5229.txt">TXT</a>).</td></tr>
</table>

<a name="anchor5"></a><br /><hr />
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgments</h3>

<p>Most of the text documenting the interaction with Sieve variables
was taken from an early draft of Kjetil Homme's Sieve variables
specification.
</p>
<p>Thanks to Tim Showalter, Alexey Melnikov, Tony Hansen, Phil Pennock,
and Jutta Degener for their help with this document.
</p>
<a name="rfc.authors"></a><br /><hr />
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kenneth Murchison</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Carnegie Mellon University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5000 Forbes Avenue</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cyert Hall 285</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pittsburgh, PA  15213</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 412 268 2638</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:murch@andrew.cmu.edu">murch@andrew.cmu.edu</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ned Freed</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Oracle Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">800 Royal Oaks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Monrovia, CA  91016-6347</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 909 457 4293</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ned.freed@mrochek.com">ned.freed@mrochek.com</a></td></tr>
</table>
</body></html>
