<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Multipath Extension for QUIC</title>
<meta content="Yanmei Liu" name="author">
<meta content="Yunfei Ma" name="author">
<meta content="Christian Huitema" name="author">
<meta content="Qing An" name="author">
<meta content="Zhenyu Li" name="author">
<meta content="
       This document specifies multipath extension for the QUIC protocol to enable the
simultaneous usage of multiple paths for a single connection.
The extension is compliant with the single-path QUIC design.
The design principle is to support multipath by adding limited extension to  . 
    " name="description">
<meta content="xml2rfc 3.4.0" name="generator">
<meta content="draft-liu-multipath-quic-00" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.4.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.6.1
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.3.1
    requests 2.25.0
    setuptools 40.6.2
    six 1.15.0
-->
<link href="/tmp/draft-liu-multipath-quic-00-p6ahk0js.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">multipath-quic</td>
<td class="right">December 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Liu, et al.</td>
<td class="center">Expires 14 June 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">QUIC</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-liu-multipath-quic-00</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-12-11" class="published">11 December 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-06-14">14 June 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">Y. Liu</div>
<div class="org">Alibaba Inc.</div>
</div>
<div class="author">
      <div class="author-name">Y. Ma</div>
<div class="org">Alibaba Inc.</div>
</div>
<div class="author">
      <div class="author-name">C. Huitema</div>
<div class="org">Private Octopus Inc.</div>
</div>
<div class="author">
      <div class="author-name">Q. An</div>
<div class="org">Alibaba Inc.</div>
</div>
<div class="author">
      <div class="author-name">Z. Li</div>
<div class="org">ICT-CAS</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Multipath Extension for QUIC</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies multipath extension for the QUIC protocol to enable the
simultaneous usage of multiple paths for a single connection.
The extension is compliant with the single-path QUIC design.
The design principle is to support multipath by adding limited extension to <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <span><a href="https://github.com/yfmascgy/Multipath-QUIC-IETF-Draft">https://github.com/yfmascgy/Multipath-QUIC-IETF-Draft</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 14 June 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-conventions-and-definitions" class="xref">Conventions and Definitions</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-enable-multipath-quic-hands" class="xref">Enable Multipath QUIC - Handshake</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-path-management" class="xref">Path Management</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-path-identifier-and-connect" class="xref">Path Identifier and Connection ID</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-path-packet-number-spaces" class="xref">Path Packet Number Spaces</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-path-initiation" class="xref">Path Initiation</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-path-state-management" class="xref">Path State Management</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-path-close" class="xref">Path Close</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.4.2.5.2.1">
                    <p id="section-toc.1-1.4.2.5.2.1.1"><a href="#section-4.5.1" class="xref">4.5.1</a>.  <a href="#name-use-path_status-frame-to-cl" class="xref">Use PATH_STATUS frame to close a path</a><a href="#section-toc.1-1.4.2.5.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.5.2.2">
                    <p id="section-toc.1-1.4.2.5.2.2.1"><a href="#section-4.5.2" class="xref">4.5.2</a>.  <a href="#name-use-retire_connection_id-fr" class="xref">Use RETIRE_CONNECTION_ID frame to close a path</a><a href="#section-toc.1-1.4.2.5.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.5.2.3">
                    <p id="section-toc.1-1.4.2.5.2.3.1"><a href="#section-4.5.3" class="xref">4.5.3</a>.  <a href="#name-idle-timeout" class="xref">Idle timeout</a><a href="#section-toc.1-1.4.2.5.2.3.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-using-tls-to-secure-quic-mu" class="xref">Using TLS to Secure QUIC Multipath</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-packet-protection-for-quic-" class="xref">Packet protection for QUIC Multipath</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-key-update-for-quic-multipa" class="xref">Key Update for QUIC Multipath</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-using-multipath-quic-with-l" class="xref">Using Multipath QUIC with load balancers</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-packet-scheduling" class="xref">Packet scheduling</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-basic-scheduling" class="xref">Basic Scheduling</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-scheduling-with-qoe-feedbac" class="xref">Scheduling with QoE Feedback</a><a href="#section-toc.1-1.7.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="xref">7.3</a>.  <a href="#name-per-stream-policy" class="xref">Per-stream Policy</a><a href="#section-toc.1-1.7.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-congestion-control-and-loss" class="xref">Congestion control and loss detection</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-congestion-control" class="xref">Congestion control</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="xref">8.2</a>.  <a href="#name-packet-number-space-and-ack" class="xref">Packet number space and acknowledgements</a><a href="#section-toc.1-1.8.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="xref">8.3</a>.  <a href="#name-flow-control" class="xref">Flow control</a><a href="#section-toc.1-1.8.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-new-frames" class="xref">New frames</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-path_status-frame" class="xref">PATH_STATUS frame</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-mp_ack-frame" class="xref">MP_ACK frame</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="xref">9.3</a>.  <a href="#name-qoe_control_signals-frame" class="xref">QOE_CONTROL_SIGNALS frame</a><a href="#section-toc.1-1.9.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="xref">9.4</a>.  <a href="#name-mp_add_address-frame" class="xref">MP_ADD_ADDRESS frame</a><a href="#section-toc.1-1.9.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="xref">9.5</a>.  <a href="#name-mp_remove_address-frame" class="xref">MP_REMOVE_ADDRESS frame</a><a href="#section-toc.1-1.9.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-changelog" class="xref">Changelog</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-appendixa-scenarios-related" class="xref">Appendix.A Scenarios related to migration</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-appendixb-considerations-on" class="xref">Appendix.B Considerations on RTT estimate and loss detection</a><a href="#section-toc.1-1.14.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-appendixc-difference-from-p" class="xref">Appendix.C Difference from past proposals</a><a href="#section-toc.1-1.15.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="xref">16</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.16.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="xref">16.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.16.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-16.2" class="xref">16.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.16.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.17.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">In this document, we propose an extension to the current QUIC design to enable
the simultaneous usage of multiple paths for a single connection.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This proposal is based on several basic design points:<a href="#section-1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-3.1">Re-use as much as possible mechanisms of QUIC-v1, which has supported connection migration and
path validation.<a href="#section-1-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-3.2">To avoid the risk of packets being dropped by middleboxes (which may only support QUIC-v1), use
the same packet header formats as QUIC V1.<a href="#section-1-3.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-3.3">Endpoints need a Path Identifier for each different path which is used to track states of packets.
As we want to keep the packet header formats unchanged <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>, Connection IDs (and the
sequence number of Connection IDs) would be a good choice of Path Identifier.<a href="#section-1-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-3.4">For the convenience of packet loss detection and recovery, endpoints use a different packet number
space for each Path Identifier.<a href="#section-1-3.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-3.5">Congestion Control, RTT measurements and PMTU discovery should be per-path (following <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>)<a href="#section-1-3.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-4">This document is organized as follows. It first provides definitions of multipath quic in
<a href="#multipath-definition" class="xref">Section 2</a>. It then specifies how to enable multipath quic during handshake in <a href="#enable-multipath" class="xref">Section 3</a>,
and path management in <a href="#multipath-transport" class="xref">Section 4</a>. It discusses packet scheduling in <a href="#packet-scheduling" class="xref">Section 7</a>,
and congestion control in <a href="#congestion-control-recovery" class="xref">Section 8</a>.  The new frames are defined in <a href="#multipath-frames" class="xref">Section 9</a>.<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multipath-definition">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
"RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted
as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all
capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">We assume that the reader is familiar with the terminology used in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.
In addition, we define the following terms:<a href="#section-2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-3.1">Path Identifier: An identifier that is used to identify a path in a QUIC connection at an endpoint.
It is defined as the sequence number of the destination Connection ID used for sending packets on that particular path.<a href="#section-2-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-3.2">Each node maintains a list of "Received Packets" for each of the CID that it provided to the peer,
which is used for acknowledging packets received with that CID.<a href="#section-2-3.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="enable-multipath">
<section id="section-3">
      <h2 id="name-enable-multipath-quic-hands">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-enable-multipath-quic-hands" class="section-name selfRef">Enable Multipath QUIC - Handshake</a>
      </h2>
<p id="section-3-1">This extension defines a new transport parameter, used to negotiate the use of the multipath extension
during the connection handshake, as specified in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>. The new transport parameter is
defined as follow:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-2.1">name: enable_multipath (0x40)<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-2.2">value: 0 (default) for disabled, 1 for enabled<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-3">If the peer does not carry the enable_multipath(0x40) transport parameter, which means the peer does NOT
support multipath, endpoint MUST fallback to <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> with single path and MUST NOT send any MP
frames in the following packets, also MUST NOT use the multipath specific AEAD algorithm defined in <a href="#multipath-aead" class="xref">Section 5.1</a>.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">Notice that transport parameter "active_connection_id_limit" <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> limits the number of usable
Connection IDs, and also limits the number of concurrent paths.<a href="#section-3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multipath-transport">
<section id="section-4">
      <h2 id="name-path-management">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-path-management" class="section-name selfRef">Path Management</a>
      </h2>
<p id="section-4-1">After endpoints have negotiated in handshake flow that both endpoints enable multipath feature,
endpoints can start using multiple paths.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">This proposal add one frame for path management:<a href="#section-4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-3.1">PATH_STATUS frame for the receiver side to claim the path state and preference<a href="#section-4-3.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-4">All the new MP frames are sent in 1-RTT packets <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-4-4" class="pilcrow">¶</a></p>
<div id="path-identifier-and-connection-id">
<section id="section-4.1">
        <h3 id="name-path-identifier-and-connect">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-path-identifier-and-connect" class="section-name selfRef">Path Identifier and Connection ID</a>
        </h3>
<p id="section-4.1-1">Endpoints need a Path Identifier for each different path which is used to track states of packets.
Endpoints use Connection IDs in 1-RTT packet header as Path Identifier in each directions, and use
the sequence number of Connection IDs in MP frames to identify the path referred.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">Following <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>, Each endpoint uses NEW_CONNECTION_ID frames to claim usable connections IDs
for itself. Before an endpoint add a new path, it SHOULD check whether there is at least one unused
available Connection ID for each side.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">Endpoints can find which path a received packet belongs to according to the Destination Connection ID of
the 1-RTT packet. Endpoints can find the context of a path by its' Connection ID or the Sequence number
of Connection ID.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-packet-number-spaces">
<section id="section-4.2">
        <h3 id="name-path-packet-number-spaces">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-path-packet-number-spaces" class="section-name selfRef">Path Packet Number Spaces</a>
        </h3>
<p id="section-4.2-1">For the convenience of packet loss detection and recovery, endpoints use a different packet number space
for each Path Identifier (Connection ID).
MP_ACK frame includes the sequence number of the Destination Connection ID
of the acknowledged packets as the Path Identifier.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-initiation">
<section id="section-4.3">
        <h3 id="name-path-initiation">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-path-initiation" class="section-name selfRef">Path Initiation</a>
        </h3>
<p id="section-4.3-1"><a href="#fig-example-new-path" class="xref">Figure 1</a> illustrates an example of new path establishment.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<span id="name-example-of-new-path-establi"></span><div id="fig-example-new-path">
<figure id="figure-1">
          <div class="artwork art-text alignLeft" id="section-4.3-2.1">
<pre>
   Client                                                  Server

   (Exchanges start on default path)
   1-RTT[]: NEW_CONNECTION_ID[C1, Seq=1] --&gt;
                         &lt;-- 1-RTT[]: NEW_CONNECTION_ID[S1, Seq=1]
                         &lt;-- 1-RTT[]: NEW_CONNECTION_ID[S2, Seq=2]
   ...
   (starts new path)
   1-RTT[0]: DCID=S2, PATH_CHALLENGE[X] --&gt;
                     Checks AEAD using nonce(CID sequence 2, PN 0)
       &lt;-- 1-RTT[0]: DCID=C1, PATH_RESPONSE[X], PATH_CHALLENGE[Y],
                                                MP_ACK[Seq=1,PN=0]
   Checks AEAD using nonce(CID sequence 1, PN 0)
   1-RTT[1]: DCID=S2, PATH_RESPONSE[Y],
             MP_ACK[Seq=1, PN=0], ... --&gt;

</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-example-of-new-path-establi" class="selfRef">Example of new path establishment</a>
          </figcaption></figure>
</div>
<p id="section-4.3-3">As shown in <a href="#fig-example-new-path" class="xref">Figure 1</a>, client provides one unused available Connection ID (C1 with sequence number 1),
and server provides two available Connection IDs (S1 with sequence number 1, and S2 with sequence number 2).
When client wants to start a new path, it checks whether there is unused available Connection IDs for each side,
and choose an available Connection ID S2 as the Destination Connection ID in the new path.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">Endpoints need to exchange unused available Connection IDs with the NEW_CONNECTION_ID frame before an endpoint
starts a new path. For example, if the goal is to maintain 2 paths, each endpoint should provide at least 3 CID to its peer:
2 in use, and one spare. If the client has used all the allocated CID, it is supposed to retire those that are
not used anymore, and the server is supposed to provide replacements, as specified in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">If the transport parameter "active_connection_id_limit" is negotiated as N, and the server has provided N Connection IDs
and the client has started N paths, the limit is reached. If the client wants to start a new path, it has to retire
one of the established paths.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">Path validation uses the PATH_CHALLENGE and PATH_RESPONSE frame defined in
QUIC-Transport <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-state-management">
<section id="section-4.4">
        <h3 id="name-path-state-management">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-path-state-management" class="section-name selfRef">Path State Management</a>
        </h3>
<p id="section-4.4-1">An endpoint uses PATH_STATUS frames to inform that the peer should send packets in the preference expressed
by these frames. An endpoint uses the sequence number of the CID used by the peer for PATH_STATUS frames
(describing the sender's path identifier).<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">In the example <a href="#fig-example-new-path" class="xref">Figure 1</a>, if the client wants to send a PATH_STATUS frame to tell the server
that it prefers the path with CID sequence number 1 (of the server's side), the client should use the identifier
of the server (sequence 1) in PATH_STATUS frame.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
<p id="section-4.4-3">PATH_STATUS frame describes 4 kinds of path states:<a href="#section-4.4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-4.1">Abandon a path, and release the corresponding resource.<a href="#section-4.4-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.2">Mark a path as "available", i.e., allow the peer to use its own logic to split traffic among available paths.<a href="#section-4.4-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.3">Mark a path as "standby", i.e., suggest that no traffic should be sent on that path if another path is available.<a href="#section-4.4-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-4.4-4.4">Mark the priority of a path, i.e, path 1 is weight 8, path 2 is weight 2, suggest that path 1 has higher priority
than path 2, and peer should try to send more data in path 1.<a href="#section-4.4-4.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-4.4-5">PATH_STATUS frame can be sent via a different path, instead of the path identified by the Path Identifier field.<a href="#section-4.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="path-close">
<section id="section-4.5">
        <h3 id="name-path-close">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-path-close" class="section-name selfRef">Path Close</a>
        </h3>
<p id="section-4.5-1">An endpoint that want to delete a path SHOULD NOT rely on implicit signals like idle time or packet losses,
but instead SHOULD use explicit signals like retiring Connection ID or asking to abandon path.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
<div id="use-pathstatus-frame-to-close-a-path">
<section id="section-4.5.1">
          <h4 id="name-use-path_status-frame-to-cl">
<a href="#section-4.5.1" class="section-number selfRef">4.5.1. </a><a href="#name-use-path_status-frame-to-cl" class="section-name selfRef">Use PATH_STATUS frame to close a path</a>
          </h4>
<p id="section-4.5.1-1">Both client and server can close a path, by sending PATH_STATUS frame which abandons the path with
a corresponding Path Identifier. Once a path is marked as "abandon", it means that the resources
related to the path can be released.<a href="#section-4.5.1-1" class="pilcrow">¶</a></p>
<p id="section-4.5.1-2"><a href="#fig-example-path-close" class="xref">Figure 2</a> illustrates an example of path closing. In the case, the path identifier
used by the server is CID C1, sequence number of CID is 1; the path identifier used by the client is
CID S2, sequence number of CID is 2. (For the convience of distinguishing the CID sequence number and
PATH_STATUS sequence number, we call the "PATH_STATUS sequence number" as "PSSN")<a href="#section-4.5.1-2" class="pilcrow">¶</a></p>
<span id="name-example-of-closing-a-path"></span><div id="fig-example-path-close">
<figure id="figure-2">
            <div class="artwork art-text alignLeft" id="section-4.5.1-3.1">
<pre>
   Client                                                    Server

   (client tells server to abandon a path)
   1-RTT[X]: PATH_STATUS[id=1, PSSN1, status=abandon, pri.=0] -&gt;
                            (server tells client to abandon a path)
      &lt;- 1-RTT[Y]: PATH_STATUS[id=2, PSSN2, status=abandon, pri.=0],
                                                 MP_ACK[Seq=1, PN=X]
   (client abandons the path that it is using)
   1-RTT[X+1]: RETIRE_CONNECTION_ID[2], MP_ACK[Seq=2, PN=Y] -&gt;
                         (server abandons the path that it is using)
       &lt;- 1-RTT[Y+1]: RETIRE_CONNECTION_ID[1], MP_ACK[Seq=1, PN=X+1]

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-example-of-closing-a-path" class="selfRef">Example of closing a path</a>
            </figcaption></figure>
</div>
<p id="section-4.5.1-4">In scenarios such as client detects the network environment change (client's 4G/Wi-Fi is turned off,
Wi-Fi signal is fading to a threshold), or endpoints detect that the quality of RTT or loss rate is
becoming worse, client or server can terminate a path immediately.<a href="#section-4.5.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="use-retireconnectionid-frame-to-close-a-path">
<section id="section-4.5.2">
          <h4 id="name-use-retire_connection_id-fr">
<a href="#section-4.5.2" class="section-number selfRef">4.5.2. </a><a href="#name-use-retire_connection_id-fr" class="section-name selfRef">Use RETIRE_CONNECTION_ID frame to close a path</a>
          </h4>
<p id="section-4.5.2-1">A sender can close a path by retiring the associated Connection ID. The RETIRE_CONNECTION_ID frame
can be sent on any path.<a href="#section-4.5.2-1" class="pilcrow">¶</a></p>
<p id="section-4.5.2-2">Receiving a RETIRE_CONNECTION_ID frame causes the endpoint to discard the resources associated with
that connection ID.  If the connection ID was used by the peer to identify a path from the peer to
this endpoint, the resources include the list of received packets used to send acknowledgements.
There is no reason for the endpoint to send a PATH_STATUS(abandon) for that path, since the peer has
already abandoned it. An endpoint SHOULD only send RETIRE_CONNECTION_ID to the peer if all packets
sent with that CID are either acknowledged or considered lost.<a href="#section-4.5.2-2" class="pilcrow">¶</a></p>
<p id="section-4.5.2-3">This has no direct effect on reverse paths from this endpoint to the peer. If the peer wants to direct
the endpoint to abandon such paths, it should send PATH_STATUS(abandon) frames for the relevant paths.<a href="#section-4.5.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="idle-timeout">
<section id="section-4.5.3">
          <h4 id="name-idle-timeout">
<a href="#section-4.5.3" class="section-number selfRef">4.5.3. </a><a href="#name-idle-timeout" class="section-name selfRef">Idle timeout</a>
          </h4>
<p id="section-4.5.3-1"><span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> allows for closing of connections if they stay idle for too long.
The connection idle timeout in multipath QUIC is defined as "no packet received on any path for the
duration of the idle timeout". It means that if all paths remain idle for the idle timeout, the connection
is implicitly closed.<a href="#section-4.5.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="multipath-tls">
<section id="section-5">
      <h2 id="name-using-tls-to-secure-quic-mu">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-using-tls-to-secure-quic-mu" class="section-name selfRef">Using TLS to Secure QUIC Multipath</a>
      </h2>
<p id="section-5-1">In order to facilitate loss detection and recovery when sending data over multiple paths,
this specification defines how packets sent over multiple paths use different
packet number spaces. This requires changes in the way AEAD is applied for packet
protection, as explained in <a href="#multipath-aead" class="xref">Section 5.1</a>, and tighter constrainst for key
updates, as explained in <a href="#multipath-key-update" class="xref">Section 5.2</a>.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="multipath-aead">
<section id="section-5.1">
        <h3 id="name-packet-protection-for-quic-">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-packet-protection-for-quic-" class="section-name selfRef">Packet protection for QUIC Multipath</a>
        </h3>
<p id="section-5.1-1">Packet protection for QUIC V1 is specified is section 5 of <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>. The general principles
of packet protection are not changed for QUIC Multipath. No changes are needed for setting
packet protection keys, initial secrets, header protection, use of 0-RTT keys, receiving
out-of-order protected packets, receiving protected packets,
or retry packet integrity. However, the use of multiple
number spaces for 1-RTT packets requires changes in AEAD usage.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">Section 5.3 of <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span> specifies AEAD usage, and in particular the use of a
nonce, N, formed by combining the packet protection IV with the packet number. QUIC
multipath uses multiple packet number spaces, and thus the packet number alone would
not guarantee the uniqueness of the nonce. In order to guarantee this uniqueness, we
construct the nonce N by combining the packet protection IV with the packet number
and with the identifier of the path, which for 1-RTT packets is the Sequence Number of
the Destination Connection ID present in the packet header, as defined in Section 5.1.1
of <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>, or zero if the Connection ID is zero-length. Section 19 of
<span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> encode this Connection ID Sequence Number as a A variable-length integer,
allowing values up to 2^62-1; for QUIC multipath, we require that these values be no
larger than 2^32 -1.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">For QUIC multipath, the construction of the nonce starts with the construction of a 96 bit
path-and-packet-number, composed of the 32 bit Connection ID Sequence Number in byte order,
two zero bits, and the 62 bits of the reconstructed QUIC packet number in network byte order.
If the IV is larger than 96 bits, path-and-packet-number is left-padded with zeros to the
size of the IV. The exclusive OR of the padded packet number and the IV forms the AEAD nonce.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">For example, assuming the IV value is <code>6b26114b9cba2b63a9e8dd4f</code>, the connection ID sequence
number is <code>3</code>, and the packet number is <code>aead</code>, the nonce will be set to
<code>6b2611489cba2b63a9a873e2</code>.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multipath-key-update">
<section id="section-5.2">
        <h3 id="name-key-update-for-quic-multipa">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-key-update-for-quic-multipa" class="section-name selfRef">Key Update for QUIC Multipath</a>
        </h3>
<p id="section-5.2-1">The Key Phase bit update process for QUIC V1 is specified in Section 6 of <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>. The general principles of key update are not changed for Multipath QUIC. Following QUIC V1, the Key Phase bit is used to indicate which packet protection keys are used to protect the packet. The Key Phase bit is toggled to signal each subsequent key update. Because of network delays, packets protected with the older key might arrive later than the packets protected with the new key. Therefore, the endpoint needs to retain old packet keys to allow these delayed packets to be processed and it must distinguish between the new key and the old key. In QUIC V1, this is done using packet numbers so that the rule is made simple: Use the
older key if packet number is lower than any packet number frome the current key phase.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">In QUIC multipath, some care is needed in the initiating Key Update process. Because different paths use different packet number spaces but share a single key, when a key update is initiated on one path, packets sent to the other path needs to know when transition is complete. Otherwise, it is possible that the other paths send packets with the old keys, but skip sending any packets in the current key phase and directly jump to sending packet in the next key phase. When that happens, as the endpoint can only retain two sets of packet protection keys with the 1-bit Key Phase bit, the other paths cannot distinguish which key should be used to decode received packets, which results in a key rotation synchronization problem.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">To address such a synchronization issue, in QUIC multipath, if key update is initilized on one path, the sender should send at least one packet with the new key on all active paths. Regarding the responding to Key Update process, the endpoint MUST NOT initiate a subsequent key update until a packet with the current key has been acknowledged on each path.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">Following the Section 5.4. of <span>[<a href="#QUIC-TLS" class="xref">QUIC-TLS</a>]</span>, the Key Phase bit is protected, so sending multiple packets with Key Phase bit flipping at the same time should not cause linkability issue.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="multipath-quic-lb-support">
<section id="section-6">
      <h2 id="name-using-multipath-quic-with-l">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-using-multipath-quic-with-l" class="section-name selfRef">Using Multipath QUIC with load balancers</a>
      </h2>
<p id="section-6-1">This specification follows the Connection ID negotiation defined in <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span>. For
stateless or low-state load balancers supporting Multipath QUIC, implementations SHOULD use
the specification of Connection ID generation and Load balancer routing defined in <span>[<a href="#QUIC-LB" class="xref">QUIC-LB</a>]</span>,
guarantee that packets with Connection IDs belonging to the same connection, can be routed to
same server.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="packet-scheduling">
<section id="section-7">
      <h2 id="name-packet-scheduling">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-packet-scheduling" class="section-name selfRef">Packet scheduling</a>
      </h2>
<div id="basic-scheduling">
<section id="section-7.1">
        <h3 id="name-basic-scheduling">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-basic-scheduling" class="section-name selfRef">Basic Scheduling</a>
        </h3>
<p id="section-7.1-1">For an outgoing packet, the packet scheduler decides which path the packet shall be
transmitted. A basic static scheduling strategy consists of four major components:<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1-2">
<li id="section-7.1-2.1">Path state: A scheduler may want to decide which path shall be activated to transmit
data. For instance, a scheduler can choose to use only one of the two paths and completely ignore
the other one. A scheduler marks the selected paths to be in the "available" state and the un-selected
ones in the "standby" state.<a href="#section-7.1-2.1" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-2.2">Path priority: Due to the fact that costs of transmitting data over different paths are
not always equal. For example, the energy (battery) cost over a 5G path and a wifi path
are very different.
In another example, transmissions over a wifi path and a cellular path may incur different
charges per packet. Note
that a user's preference may change over time. For instance, certain mobile carriers offer unlimited
free data for a particular streaming app. Therefore, the path priority should be made available
in the scheduler.<a href="#section-7.1-2.2" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-2.3">Path selection algorithm: A selection algorithm splits packets across different paths
and determines the order of paths to be selected. The selection algorithm takes congestion controller
states as inputs, such as smoothed RTTs (sRTTs), estimated bandwidths (eBWs) and congestion window sizes (CWNDs)
as well as application-defined information such as path priorities and path states. The outputs
of the algorithm is an ordered list of paths to put a packet on. To name a few, some of the commonly
used algorithms are:
- Round-Robin: There is no priority. it selects paths one by one in order to transmit data.
- Lowest-RTT: It first chooses the path with the lowest RTT and feeds packets to it until that
  path's congestion window is full. Then it chooses the path with the second lowest RTT.
- Highest-Sending-Rate: It first chooses the path with the highest bandwidth and feeds packets
  to it until that path's congestion window is full. Then it chooses path with the
  second largest bandwidth.<a href="#section-7.1-2.3" class="pilcrow">¶</a>
</li>
          <li id="section-7.1-2.4">Packet redundancy: One major challenge in multi-path transmission is that a packet loss
on the slow path might block the overall transmission when packets are split across
fast-changing paths. As the path selection algorithm takes inputs from congestion
controllers on predictions of the network which may not be accurate enough for
fast-changing wireless channels, such an imprecise estimation could lead to network overuse/underuse.
A solution to this problem is to implement packet redundancy strategy. A redundancy strategy can be
applied to only ACK packets(partial redundancy) or all data packets (full redundancy).
It is up to the application to determine whether, when, and on which packets to activate redundancy.<a href="#section-7.1-2.4" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-7.1-3">The path state and path priority are managed by PATH_STATUS frame. The path selection algorithm and packet
redundancy are application related and should be controlled by the applicaiton.<a href="#section-7.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="scheduling-with-qoe-feedback">
<section id="section-7.2">
        <h3 id="name-scheduling-with-qoe-feedbac">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-scheduling-with-qoe-feedbac" class="section-name selfRef">Scheduling with QoE Feedback</a>
        </h3>
<p id="section-7.2-1">Applications may have completely different QoE requirements---the interactive applications are delay
sensitive, while the video streaming applications are more throughput sensitive. There is thus a trend
of cross-layer design that takes applications' demands into account when managing paths or scheduling packets.
The QoE feedback is used to fully support application-awareness in multipath scheduling and is carried in the
QOE_CONTROL_SIGNALS frames <a href="#fig-qoe-control-signals-format" class="xref">Figure 6</a>. The QOE_CONTROL_SIGNALS frames can include general
application-level information that is needed by the schedulers. The frequency of such feedback should be controlled
to limit the amount of extra packets. The QoE control signal allows a synchronization of viewpoints between two endhosts.
It is up to the application to determine the interpretation of QoE control signals.<a href="#section-7.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="per-stream-policy">
<section id="section-7.3">
        <h3 id="name-per-stream-policy">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-per-stream-policy" class="section-name selfRef">Per-stream Policy</a>
        </h3>
<p id="section-7.3-1">As QUIC supports stream multiplexing, streams are allowed to associate stream priorities to express applications
intent. For instance, objects in a web page may be dependent on others and thus have different
priorities multipath quic scheduler. A stream priority-aware packet scheduling algorithm will
improve the performance notably.<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<span id="name-stream-priority"></span><div id="fig-stream-prio">
<figure id="figure-3">
          <div class="artwork art-text alignLeft" id="section-7.3-2.1">
<pre>
    High priority  /\  +---------+
                   ||  |         |
                   ||  +---------+
                   ||  +---------+
                   ||  |         |
                   ||  +---------+
                   ||     ...          User-defined stream priority
                   ||  +---------+
    Low priority   ||  |         |
                   ||  +---------+
    -----------------------------------------------------------
    High priority  /\  +---------+
                   ||  |         |
                   ||  +---------+
                   ||  +---------+
                   ||  |         |
                   ||  +---------+
                   ||     ...          Default stream priority
                   ||  +---------+
    Low priority   ||  |         |
                   ||  +---------+

</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-stream-priority" class="selfRef">Stream priority</a>
          </figcaption></figure>
</div>
<p id="section-7.3-3">The priority management scheme composes two separated priority ranges. The user-defined priority range
includes those streams that the applications explicitly designate priorities, while the default priority
range includes the streams with no priorities set by the applications. Only when the streams in the
user-defined ranges have no data to send, the streams in the default priority range can send.
In the same range, one can use the weighted-round robin for scheduling---the higher-priority streams
get more quota for data to send in each round. One can also dynamically set/change the priorities of the
streams in the default priority ranges to enable short stream first if needed.<a href="#section-7.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="congestion-control-recovery">
<section id="section-8">
      <h2 id="name-congestion-control-and-loss">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-congestion-control-and-loss" class="section-name selfRef">Congestion control and loss detection</a>
      </h2>
<div id="congestion-control">
<section id="section-8.1">
        <h3 id="name-congestion-control">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-congestion-control" class="section-name selfRef">Congestion control</a>
        </h3>
<p id="section-8.1-1">Implementations MAY support coupled congestion controllers such as LIA <span>[<a href="#MPTCP-LIA" class="xref">MPTCP-LIA</a>]</span>, OLIA <span>[<a href="#MPTCP-OLIA" class="xref">MPTCP-OLIA</a>]</span>,
and etc., or support decoupled congestion controllers in environments using disjoint network paths.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
<p id="section-8.1-2">In decoupled congestion control, each path runs its own congestion controller without
interacting with the congestion controllers of other paths. That is to say, in the
aspect of congestion control, a path behaves exactly the same as a normal QUIC connection
over the same network path.<a href="#section-8.1-2" class="pilcrow">¶</a></p>
<p id="section-8.1-3">Each path MAY choose congestion control algorithm independently.<a href="#section-8.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="packet-number-space-and-acknowledgements">
<section id="section-8.2">
        <h3 id="name-packet-number-space-and-ack">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-packet-number-space-and-ack" class="section-name selfRef">Packet number space and acknowledgements</a>
        </h3>
<p id="section-8.2-1">Each path has it's own packet number space for transmitting 1-RTT packets.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
<p id="section-8.2-2">ACK frame <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> MUST be returned via the same path on which
the corresponding packets were sent.<a href="#section-8.2-2" class="pilcrow">¶</a></p>
<p id="section-8.2-3">MP_ACK frame can be returned via either a different path, or the same path identified by the Path Identifier,
 based on different strategies of sending MP_ACK frames.<a href="#section-8.2-3" class="pilcrow">¶</a></p>
<p id="section-8.2-4">Note: Only MP_ACK frame returned via the same path can be used to calculate RTT(round trip time).<a href="#section-8.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="flow-control">
<section id="section-8.3">
        <h3 id="name-flow-control">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-flow-control" class="section-name selfRef">Flow control</a>
        </h3>
<p id="section-8.3-1">TBD.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="multipath-frames">
<section id="section-9">
      <h2 id="name-new-frames">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-new-frames" class="section-name selfRef">New frames</a>
      </h2>
<p id="section-9-1">All the new frames MUST be sent in 1-RTT packet, and MUST NOT use other encryption levels.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">If an endpoint receives MP frames from packets of other encryption levels, it MAY return
MP_PROTOCOL_VIOLATION as a connection error and close the connection.<a href="#section-9-2" class="pilcrow">¶</a></p>
<div id="pathstatus-frame">
<section id="section-9.1">
        <h3 id="name-path_status-frame">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-path_status-frame" class="section-name selfRef">PATH_STATUS frame</a>
        </h3>
<p id="section-9.1-1">PATH_STATUS Frame are used by endpoints to inform the peer of the current status of one path, and the peer
should send packets according to the preference expressed in these frames. Endpoint use the sequence number of the
CID used by the peer for PATH_STATUS frames (describing the sender's path identifier).
PATH_STATUS frames are formatted as shown in <a href="#fig-path-status-format" class="xref">Figure 4</a>.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<span id="name-path_status-frame-format"></span><div id="fig-path-status-format">
<figure id="figure-4">
          <div class="artwork art-text alignLeft" id="section-9.1-2.1">
<pre>
  PATH_STATUS Frame {
    Type (i) = 0x2a,
    Path Identifier (i),
    Path Status sequence number (i),
    Path Status (i),
    Path Priority (i),
  }
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-path_status-frame-format" class="selfRef">PATH_STATUS Frame Format</a>
          </figcaption></figure>
</div>
<p id="section-9.1-3">PATH_STATUS Frames contain the following fields:<a href="#section-9.1-3" class="pilcrow">¶</a></p>
<p id="section-9.1-4">Path Identifier: A variable-length integer specifying the path identifier.<a href="#section-9.1-4" class="pilcrow">¶</a></p>
<p id="section-9.1-5">Path Status sequence number: A variable-length integer specifying the sequence number assigned for this PATH_STATUS frame.
There is a different path status sequence number space for each path.<a href="#section-9.1-5" class="pilcrow">¶</a></p>
<p id="section-9.1-6">Available values of Path Status field are:<a href="#section-9.1-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.1-7.1">0: Abandon<a href="#section-9.1-7.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.1-7.2">1: Standby<a href="#section-9.1-7.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-9.1-7.3">2: Available<a href="#section-9.1-7.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-9.1-8">If the value of Path Status field is 2-available, the receiver side can use the Path Priority field to
express the priority weight of a path for the peer.<a href="#section-9.1-8" class="pilcrow">¶</a></p>
<p id="section-9.1-9">Frames may be received out of order. A peer MUST ignore an incoming PATH_STATUS frame if it previously
received another PATH_STATUS frame for the same Path Identifier with a sequence number equal to or
higher than the sequence number of the incoming frame.<a href="#section-9.1-9" class="pilcrow">¶</a></p>
<p id="section-9.1-10">PATH_STATUS frames SHOULD be acknowledged. If a packet containing a PATH_STATUS frame is considered lost,
the peer should only repeat it if it was the last status sent for that path -- as indicated by the sequence number.<a href="#section-9.1-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mpack-frame">
<section id="section-9.2">
        <h3 id="name-mp_ack-frame">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-mp_ack-frame" class="section-name selfRef">MP_ACK frame</a>
        </h3>
<p id="section-9.2-1">MP_ACK frame allows for acknowledgements on different paths.
MP_ACK frame is formatted by adding a Path Identifier field to <span>[<a href="#QUIC-TRANSPORT" class="xref">QUIC-TRANSPORT</a>]</span> ACK frame.
MP_ACK frame is formatted as shown in <a href="#fig-mp-ack-format" class="xref">Figure 5</a>.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
<span id="name-mp_ack-frame-format"></span><div id="fig-mp-ack-format">
<figure id="figure-5">
          <div class="artwork art-text alignLeft" id="section-9.2-2.1">
<pre>
  MP_ACK Frame {
    Type (i) = 0x22..0x23,
    Path Identifier (i),
    Largest Acknowledged (i),
    ACK Delay (i),
    ACK Range Count (i),
    First ACK Range (i),
    ACK Range (..) ...,
    [ECN Counts (..)],
  }
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-mp_ack-frame-format" class="selfRef">MP_ACK Frame Format</a>
          </figcaption></figure>
</div>
<p id="section-9.2-3">Type(i) = 0x22 , with no ECN Counts
Type(i) = 0x23 , with ECN Counts<a href="#section-9.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="qoecontrolsignals-frame">
<section id="section-9.3">
        <h3 id="name-qoe_control_signals-frame">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-qoe_control_signals-frame" class="section-name selfRef">QOE_CONTROL_SIGNALS frame</a>
        </h3>
<p id="section-9.3-1">QOE_CONTROL_SIGNALS frame is used to carry quality of experience (QoE) information. A typical use of such
information is to provide feedback to help application-aware scheduling. Note that different applications
may have very different needs, the interpretation of the QoE control signal can be up to the users.
QOE_CONTROL_SIGNALS frames are formatted as shown in <a href="#fig-qoe-control-signals-format" class="xref">Figure 6</a>.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<span id="name-qoe_control_signals-frame-f"></span><div id="fig-qoe-control-signals-format">
<figure id="figure-6">
          <div class="artwork art-text alignLeft" id="section-9.3-2.1">
<pre>
  QOE_CONTROL_SIGNALS Frame {
    Type (i) = 0x24,
    Path Identifier (i),
    QoE Control Signals Length(8),
    QoE Control Signals (..)
  }
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-qoe_control_signals-frame-f" class="selfRef">QOE_CONTROL_SIGNALS Frame Format</a>
          </figcaption></figure>
</div>
<p id="section-9.3-3">QOE_CONTROL_SIGNALS frames may be received out of order, peers SHOULD pass them to the application as they arrive.
Although QOE_CONTROL_SIGNALS frames are not retransmitted upon loss detection, they are ack-eliciting <span>[<a href="#QUIC-RECOVERY" class="xref">QUIC-RECOVERY</a>]</span>.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mpaddaddress-frame">
<section id="section-9.4">
        <h3 id="name-mp_add_address-frame">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-mp_add_address-frame" class="section-name selfRef">MP_ADD_ADDRESS frame</a>
        </h3>
<p id="section-9.4-1">TBD.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="mpremoveaddress-frame">
<section id="section-9.5">
        <h3 id="name-mp_remove_address-frame">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-mp_remove_address-frame" class="section-name selfRef">MP_REMOVE_ADDRESS frame</a>
        </h3>
<p id="section-9.5-1">TBD.<a href="#section-9.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-considerations">
<section id="section-10">
      <h2 id="name-security-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-10-1">TBD.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-11-1">This document makes no request of IANA.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="changelog">
<section id="section-12">
      <h2 id="name-changelog">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-changelog" class="section-name selfRef">Changelog</a>
    </h2>
</section>
</div>
<div id="appendixa-scenarios-related-to-migration">
<section id="section-13">
      <h2 id="name-appendixa-scenarios-related">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-appendixa-scenarios-related" class="section-name selfRef">Appendix.A Scenarios related to migration</a>
      </h2>
<p id="section-13-1">In QUIC V1, there are four scenarios related to migration: CID renewal, NAT Rebinding, controlled migration,
and migration to server preferred address. It would be useful to explain exactly how these four scenarios are
supported or changed with Multipath QUIC. For V1, these scenarios are described as follow:<a href="#section-13-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-13-2.1">CID Renewal happens when the client starts using a new CID for 1-RTT packet, while still using the same four-tuple.
This is typically done for privacy, for example after a long period of silence. The expected result is that the server
will also use a new CID for its next packets. In that scenario, RTT and congestion control parameters remain the same
before and after migration.<a href="#section-13-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-13-2.2">NAT Rebinding happens when a NAT on the path changes its mappings. The server receives packets that bear the same
CID as previously, but arrive on a different four tuple. The complication is that this could be an attack in which
the attacker captures a packet from the client and resends it from a different address. The server is expected to
perform continuity tests for both the old and the new path, typically using a different CID for the new path.
If the continuity test on the new path succeeds before the old path, the server migrates to the new path, otherwise
it continues using the old path and ignores the new path.<a href="#section-13-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-13-2.3">Controlled migration happens when a client tests a new path. The server receives packets that bear a new CID and
arrive on a new four tuple. The server responds to the path challenge, perform its own continuity test on the new path.
If the client sends non-path-validation packets on the new path, the server switches to sending on the new path and
discards the old path.<a href="#section-13-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-13-2.4">Preferred address migration happens when the server sends the preferred address TP during the exchange. The client
performs a controlled migration to the new path, and if that is successful discards the old path.<a href="#section-13-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-13-3">We could sum up these scenarios in the following table:<a href="#section-13-3" class="pilcrow">¶</a></p>
<span id="name-scenarios-related-to-migrat"></span><div id="tab-related-scenarios">
<table class="center" id="table-1">
        <caption>
<a href="#table-1" class="selfRef">Table 1</a>:
<a href="#name-scenarios-related-to-migrat" class="selfRef">Scenarios related to migration</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">CID</th>
            <th class="text-left" rowspan="1" colspan="1">4-tuple</th>
            <th class="text-left" rowspan="1" colspan="1">preferred address</th>
            <th class="text-left" rowspan="1" colspan="1">result</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Old</td>
            <td class="text-left" rowspan="1" colspan="1">Old</td>
            <td class="text-left" rowspan="1" colspan="1">-</td>
            <td class="text-left" rowspan="1" colspan="1">Not a migration.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Old</td>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">-</td>
            <td class="text-left" rowspan="1" colspan="1">NAT Rebinding.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">Old</td>
            <td class="text-left" rowspan="1" colspan="1">-</td>
            <td class="text-left" rowspan="1" colspan="1">CID Renewal.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">matches PFA</td>
            <td class="text-left" rowspan="1" colspan="1">Migration to Preferred Address.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">New</td>
            <td class="text-left" rowspan="1" colspan="1">other</td>
            <td class="text-left" rowspan="1" colspan="1">Controlled Migration.</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-13-5">The expectation in those scenarios is:<a href="#section-13-5" class="pilcrow">¶</a></p>
<span id="name-expectation-in-scenarios-re"></span><div id="tab-scenarios-expectation">
<table class="center" id="table-2">
        <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-expectation-in-scenarios-re" class="selfRef">Expectation in scenarios related to migration</a>
        </caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Scenario</th>
            <th class="text-left" rowspan="1" colspan="1">Expectation</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Not a migration</td>
            <td class="text-left" rowspan="1" colspan="1">Continue using existing path</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">NAT Rebinding</td>
            <td class="text-left" rowspan="1" colspan="1">After validation, use new path and discard previous path.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">CID Renewal</td>
            <td class="text-left" rowspan="1" colspan="1">Create new path with new CIDs, discard old path. Reuse RTT and CC parameter.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Controlled Migration</td>
            <td class="text-left" rowspan="1" colspan="1">Create new path with new CIDs. Server creates a new path,ready to use both paths. Client may later discard old path.</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">Migration to Preferred Address</td>
            <td class="text-left" rowspan="1" colspan="1">Same as Controlled Migration, but the client is expected to abandon the old path</td>
          </tr>
        </tbody>
      </table>
</div>
<p id="section-13-7">In multipath quic, client / server create a new path and abandon the old path to do exactly the same thing as connection
migration in the previous scenarios.<a href="#section-13-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="appendixb-considerations-on-rtt-estimate-and-loss-detection">
<section id="section-14">
      <h2 id="name-appendixb-considerations-on">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-appendixb-considerations-on" class="section-name selfRef">Appendix.B Considerations on RTT estimate and loss detection</a>
      </h2>
<p id="section-14-1">QUIC implementations use RTT estimates in many ways:<a href="#section-14-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14-2.1">For loss detection, RTT estimates are used to evaluate how long to wait for an acknowledgement
before a packet is declared lost.<a href="#section-14-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-14-2.2">Several congestion control algorithm (e.g. LEDBAT, VEGAS, HYSTART) use variations of the RTT above
the minimum value to detect the beginning of congestion.<a href="#section-14-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-14-2.3">BBR uses the minimal RTT to compute the minimal size of the congestion window for a target data rate.<a href="#section-14-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-14-2.4">ACK delays are often set as a fraction of the RTT.<a href="#section-14-2.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-14-3">In a multipath environment, the RTT can be estimated each time a new packet is acknolwedged. However,
the observed RTT will vary not only based on the state of the send path, but also based on the choice
of the return path used for acknowledgements. Each RTT measurement will the sum of the one-way delay
on the send path and the one-way delay on the return path. This has a number of implications for the
different ways of using the RTT presented above:<a href="#section-14-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-14-4.1">If the goal is to detect possible losses, it is probably sufficient to consider all RTT measurements
for a given path. Classic formulas like adding smoothed RTT and a number of deviations aim at estimating
a reasonable upper bound of the acknowledgement delays. Statistics on observed acknowledgement delays
will provide a valid estimate, regardless of the selection of the return path by the peer.<a href="#section-14-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-14-4.2">If the goal is to detect the onset of collision and tune a congestion algorithm, the variations of delays
due to the choices of return paths will be a source of errors. Implementations will need to pick a strategy,
such as for example only considering acknowledgements received through the "fastest" return path, or maybe
those received through the matching four tuple for the sending path. An alternative would be to use time stamps
to directly estimate variations of the one way delays. <span>[<a href="#QUIC-Timestamp" class="xref">QUIC-Timestamp</a>]</span> provides good support for such
one-way-delay compuation.<a href="#section-14-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-14-4.3">If BBR is in use and ACKs are returned on different paths, it may cause an ambiguity issue with the
computation of bandwidth and delay product (BDP). In BBR, BDP is used to limit the number of inflight packets.
One may choose to use the smallest RTT measured to compute BDP. However, if the majority of ACKs are returned
from a high-latency path, the cwnd = cwnd_gain * bandwidth * min_rtt may be lower than what is needed to achieve
good performance. One possible solution is to always transmit a new packet and its ACK on the same path.<a href="#section-14-4.3" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="appendixc-difference-from-past-proposals">
<section id="section-15">
      <h2 id="name-appendixc-difference-from-p">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-appendixc-difference-from-p" class="section-name selfRef">Appendix.C Difference from past proposals</a>
      </h2>
<p id="section-15-1">This proposal differs from past proposals <span>[<a href="#I-D.deconinck-quic-multipath" class="xref">I-D.deconinck-quic-multipath</a>]</span> in two
fundamental perspectives:<a href="#section-15-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-15-2.1">The multi-path QUIC is built on top of the concept of the bidirectional paths,
which readily fits into the nature of both cellular and wifi links that cover the majority
of multi-path applications in QUIC while keeping the design simple and easy to implement.
In doing so, we are able to re-use most of the current QUIC transport design with the sole
addition of six new frames.<a href="#section-15-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-15-2.2">The multi-path QUIC design enables feedback-based dynamic scheduling strategy. As the major
goal of multi-path QUIC is to enhance performance in mobile applications, where the sender
and receiver may have different viewpoints about the fast-changing wireless connectivity,
especially in high-mobility scenarios, the proposed design allows the sender and receiver
to synchronize their viewpoints via message exchange in ACK packet in order to
maximize performance.<a href="#section-15-2.2" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<section id="section-16">
      <h2 id="name-references">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-16.1">
        <h3 id="name-normative-references">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="QUIC-LB">[QUIC-LB]</dt>
        <dd>
<span class="refAuthor">Duke, M., Ed.</span><span class="refAuthor"> and N. Banks, Ed.</span>, <span class="refTitle">"QUIC-LB: Generating Routable QUIC Connection IDs"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-load-balancers</span>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-load-balancers">https://tools.ietf.org/html/draft-ietf-quic-load-balancers</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-RECOVERY">[QUIC-RECOVERY]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span><span class="refAuthor"> and I. Swett, Ed.</span>, <span class="refTitle">"QUIC Loss Detection and Congestion Control"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-recovery</span>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-recovery">https://tools.ietf.org/html/draft-ietf-quic-recovery</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-TLS">[QUIC-TLS]</dt>
        <dd>
<span class="refAuthor">Thomson, M., Ed.</span><span class="refAuthor"> and S. Turner, Ed.</span>, <span class="refTitle">"Using TLS to Secure QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-tls</span>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-tls">https://tools.ietf.org/html/draft-ietf-quic-tls</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-TRANSPORT">[QUIC-TRANSPORT]</dt>
        <dd>
<span class="refAuthor">Iyengar, J., Ed.</span><span class="refAuthor"> and M. Thomson, Ed.</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-transport</span>, <span>&lt;<a href="https://tools.ietf.org/html/draft-ietf-quic-transport">https://tools.ietf.org/html/draft-ietf-quic-transport</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-16.2">
        <h3 id="name-informative-references">
<a href="#section-16.2" class="section-number selfRef">16.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.deconinck-quic-multipath">[I-D.deconinck-quic-multipath]</dt>
        <dd>
<span class="refAuthor">Coninck, Q.</span><span class="refAuthor"> and O. Bonaventure</span>, <span class="refTitle">"Multipath Extensions for QUIC (MP-QUIC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-deconinck-quic-multipath-06</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-deconinck-quic-multipath-06.txt">http://www.ietf.org/internet-drafts/draft-deconinck-quic-multipath-06.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MPTCP-LIA">[MPTCP-LIA]</dt>
        <dd>
<span class="refAuthor">Raiciu, C.</span><span class="refAuthor">, Handly, M.</span><span class="refAuthor">, and D. Wischik</span>, <span class="refTitle">"Coupled Congestion Control for Multipath Transport Protocols"</span>, <time datetime="2011-10" class="refDate">October 2011</time>, <span>&lt;<a href="https://tools.ietf.org/html/rfc6356">https://tools.ietf.org/html/rfc6356</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="MPTCP-OLIA">[MPTCP-OLIA]</dt>
        <dd>
<span class="refAuthor">Khalili, R.</span><span class="refAuthor">, Gast, N.</span><span class="refAuthor">, and J. Boudec</span>, <span class="refTitle">"Opportunistic Linked-Increases Congestion Control Algorithm for MPTCP"</span>, <time datetime="2014-07" class="refDate">July 2014</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-khalili-mptcp-congestion-control-05">https://datatracker.ietf.org/doc/html/draft-khalili-mptcp-congestion-control-05</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC-Timestamp">[QUIC-Timestamp]</dt>
      <dd>
<span class="refAuthor">Huitema, C.</span>, <span class="refTitle">"Quic Timestamps For Measuring One-Way Delays"</span>, <time datetime="2020-08" class="refDate">August 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-huitema-quic-ts/">https://datatracker.ietf.org/doc/draft-huitema-quic-ts/</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="section-appendix.a">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yanmei Liu</span></div>
<div dir="auto" class="left"><span class="org">Alibaba Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:miaoji.lym@alibaba-inc.com" class="email">miaoji.lym@alibaba-inc.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yunfei Ma</span></div>
<div dir="auto" class="left"><span class="org">Alibaba Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yunfei.ma@alibaba-inc.com" class="email">yunfei.ma@alibaba-inc.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christian Huitema</span></div>
<div dir="auto" class="left"><span class="org">Private Octopus Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:huitema@huitema.net" class="email">huitema@huitema.net</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Qing An</span></div>
<div dir="auto" class="left"><span class="org">Alibaba Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:anqing.aq@alibaba-inc.com" class="email">anqing.aq@alibaba-inc.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Zhenyu Li</span></div>
<div dir="auto" class="left"><span class="org">ICT-CAS</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:zyli@ict.ac.cn" class="email">zyli@ict.ac.cn</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
