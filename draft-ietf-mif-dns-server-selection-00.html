<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Improved DNS Server Selection for Multi-Homed Nodes</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Improved DNS Server Selection for Multi-Homed Nodes">
<meta name="keywords" content="DNS, interface, FQDN, selection">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Internet Engineering Task Force</td><td class="header">T. Savolainen</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nokia</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">J. Kato</td></tr>
<tr><td class="header">Expires: July 18, 2011</td><td class="header">NTT</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">January 14, 2011</td></tr>
</table></td></tr></table>
<h1><br />Improved DNS Server Selection for Multi-Homed Nodes<br />draft-ietf-mif-dns-server-selection-00</h1>

<h3>Abstract</h3>

<p>A multi-homed node can be connected to multiple networks that may utilize different
      DNS namespaces. The node often receives DNS server configuration information
      from all connected networks. Some of the DNS servers may have information
      about namespaces other servers do not have. When the 
      multi-homed node needs to utilize DNS, it has to choose which of the servers to 
      contact to. This document describes a policy based method for helping on selection of DNS 
      server for both forward and reverse DNS lookup procedures with help of DNS 
      suffix and IPv6 prefix information received via DHCPv6.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 18, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Requirements Language<br />
<a href="#anchor3">2.</a>&nbsp;
Problem description for local namespaces with multi-homed nodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.1.</a>&nbsp;
Fully qualified domain names with limited scopes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.2.</a>&nbsp;
Network interface specific IP addresses<br />
<a href="#anchor6">3.</a>&nbsp;
Improved DNS server selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.1.</a>&nbsp;
Procedure for prioritizing DNS servers and handling responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.2.</a>&nbsp;
DNS server selection option<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.3.</a>&nbsp;
Coexistence with RFC3646<br />
<a href="#anchor10">4.</a>&nbsp;
Example of a node behavior<br />
<a href="#anchor11">5.</a>&nbsp;
Scalability considerations<br />
<a href="#anchor12">6.</a>&nbsp;
Considerations for network administrators<br />
<a href="#Acknowledgements">7.</a>&nbsp;
Acknowledgements<br />
<a href="#IANA">8.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">9.</a>&nbsp;
Security Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#app-additional">Appendix&nbsp;A.</a>&nbsp;
Best Current Practice for DNS server selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">A.1.</a>&nbsp;
Sending queries out on multiple interfaces in parallel<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">A.2.</a>&nbsp;
Search list option for DNS forward lookup decisions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">A.3.</a>&nbsp;
More specific routes for reverse lookup decision<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">A.4.</a>&nbsp;
Longest matching prefix for reverse lookup decision<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>A multi-homed node faces several problems over single-homed node as is described 
	in <a class='info' href='#I-D.ietf-mif-problem-statement'>[I&#8209;D.ietf&#8209;mif&#8209;problem&#8209;statement]<span> (</span><span class='info'>Blanchet, M. and P. Seite, &ldquo;Multiple Interfaces and Provisioning Domains Problem Statement,&rdquo; October&nbsp;2010.</span><span>)</span></a>. 
	This document studies in detail the problems local namespaces may cause for multi-homed nodes in 
        the IPv4 and IPv6 domains and provides a solution. The node may be implemented as a host, or as a router
        such as Consumer Premises Equipment.
</p>
<p>When multiple namespaces are visible for a node, some DNS servers have information other servers do not have.
        Because of that, a multi-homed node cannot assume every DNS server is able to provide
        any piece of information, but instead the node must be able to ask right server for the 
        information it needs.
</p>
<p>An example of an application that benefits from multi-homing is a web
        browser that commonly accesses many different destinations and should be able
	to dynamically communicate over different network interfaces. 
</p>
<p>However, as the IPv4 is being phased out and often uses NATs to achieve similar functions, this document 
        describes a solution only for the IPv6 domain.
</p>
<p>In deployments where multiple namespaces are present, selection of the correct destination
	and source addresses for the actual IP connection is usually crucial as well, as the resolved
	destination's IP address may be only usable on the network interface over which it was
	resolved on. Hence solution described in this document is assumed to be often used in
        combination of tools delivering source and destination address selection policies.
</p>
<p>Node multihoming in general may introduce new attack vectors. This document
        includes security considerations that will help against possible 
        new attack vectors and also to some existing attack vectors.
</p>
<p>The Appendix A describes best current practices possible with tools preceding this 
        document and on networks not supporting this specification. As it is possible to 
        solve the problem with less efficient and less explicit manners, this document can be considered
        as an optimization. However, in some environments this optimization is considered essential.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Requirements Language</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Problem description for local namespaces with multi-homed nodes</h3>

<p>This chapter describes two host multi-homing related local namespace scenarios for which 
	the procedure described in chapter 3 provides a solution. Essentially the same challenges may be faced 
        by Consumer Premises Equipment as is described in <a class='info' href='#I-D.troan-multihoming-without-nat66'>[I&#8209;D.troan&#8209;multihoming&#8209;without&#8209;nat66]<span> (</span><span class='info'>Troan, O., Miles, D., Matsushima, S., Okimoto, T., and D. Wing, &ldquo;IPv6 Multihoming without Network Address Translation,&rdquo; July&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Fully qualified domain names with limited scopes</h3>

<p>A multi-homed host may be connecting to one or more networks that are using 
          local namespaces. As an example, the host may have simultaneously 
	  open a wireless LAN (WLAN) connection to public Internet, cellular connection 
	  to an operator network, and a virtual private network (VPN) connection to a corporate 
	  network. When an application initiates a connection establishment to an FQDN, the host needs to be 
	  able to choose the right network interface for making a successful DNS query. This is 
	  illustrated in the figure 1. An FQDN for a public name can be resolved with any DNS server
          of any network interface, but for an FQDN of corporation's or operator's service's local name 
          the host would need to be able to correctly select the right network interface for the DNS resolution, 
	  i.e. do interface selection already before destination's IP address is known.
</p><br /><hr class="insert" />
<a name="xml_fig1"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +---------------+
                         | DNS server w/ |    |   Corporate
+------+                 | public +      |----|   Intranet
|      |                 | corporation's |    |
|      |===== VPN =======| local names   |    |
|      |                 +---------------+  +----+
| MIF  |                                    | FW |
| host |                                    +----+
|      |                 +---------------+    |
|      |----- WLAN ------| DNS server w/ |----|   Public
|      |                 | public names  |    |   Internet
|      |                 +---------------+  +----+
|      |                                    | FW |
|      |                 +---------------+  +----+
|      |---- cellular ---| DNS server w/ |    |
+------+                 | public +      |    |   Operator
                         | operator's    |----|   Intranet
                         | local names   |    |
                         +---------------+
</pre></div>
<p style='text-align: center'>Split DNS and locally scoped names illustrated
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Network interface specific IP addresses</h3>

<p>In the second problem an FQDN as such is valid and resolvable via different network interfaces, 
	  but to different and not necessarily globally reachable IP addresses, as is illustrated in the figure 2. This is 
	  a problem when a host is single-homed, but for multi-homed host this results in 
	  additional challenges: the host's source and destination address selection mechanism
          must ensure the destination's IP address is only used in combination with source 
	  IP addresses of the network interface the name was resolved on.
</p><br /><hr class="insert" />
<a name="xml_fig2"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +--------------------|      |
+------+   IPv6          | DNS server A       |------| IPv6
|      |-- interface 1 --| saying Peer is     |      |
|      |                 | at: 2001:0db8:0::1 |      |
| MIF  |                 +--------------------+   +------+
| host |                                          | Peer |
|      |                 +--------------------+   +------+
|      |   IPv6          | DNS server B       |      |
|      |-- interface 2 --| saying Peer is     |      |
+------+                 | at: 2001:0db8:1::1 |------| IPv6
                         +--------------------+      |

</pre></div>
<p style='text-align: center'>Split DSN and different IP addresses
	     for an FQDN on interfaces 1 and 2.
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Similar situation can happen when IPv6 protocol translation is used in combination
          with AAAA record synthesis proceduce <a class='info' href='#I-D.ietf-behave-dns64'>[I&#8209;D.ietf&#8209;behave&#8209;dns64]<span> (</span><span class='info'>Bagnulo, M., Sullivan, A., Matthews, P., and I. Beijnum, &ldquo;DNS64: DNS extensions for Network Address Translation from IPv6 Clients to IPv4 Servers,&rdquo; October&nbsp;2010.</span><span>)</span></a>. 
          A synthesised AAAA record is guaranteed to be valid only on a network interface
          it was synthesized on. Figure 3 illustrates a scenario where the peer's IPv4 address
          is synthesized into different IPv6 addresses by DNS servers A and B. The same problem can happen
          in the IPv4 domain as well if A record synthesis is done, for example as 
          described in <a class='info' href='#RFC2767'>Bump-In-the-Stack<span> (</span><span class='info'>Tsuchiya, K., HIGUCHI, H., and Y. Atarashi, &ldquo;Dual Stack Hosts using the &quot;Bump-In-the-Stack&quot; Technique (BIS),&rdquo; February&nbsp;2000.</span><span>)</span></a> [RFC2767].
</p>
<p>For a related problem for dual-stack hosts in a network with DNS64, where
             IPv4 should be prioritized over synthesized IPv6, please see
             <a class='info' href='#I-D.wing-behave-dns64-config'>[I&#8209;D.wing&#8209;behave&#8209;dns64&#8209;config]<span> (</span><span class='info'>Wing, D., &ldquo;DNS64 Resolvers and Dual-Stack Hosts,&rdquo; February&nbsp;2010.</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="xml_fig_AAAA"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                         +-------------------|    +-------+
+------+   IPv6          | DNS server A      |----| NAT64 |
|      |-- interface 1 --| saying Peer is    |    +-------+
|      |                 | at: A_Pref96:IPv4 |       |
| MIF  |                 +-------------------+       |   +------+
| host |                                        IPv4 +---| Peer |
|      |                 +-------------------+       |   +------+
|      |   IPv6          | DNS server B      |       |
|      |-- interface 2 --| saying Peer is    |    +-------+
+------+                 | at: B_Pref96:IPv4 |----| NAT64 |
                         +-------------------+    +-------+

</pre></div>
<p style='text-align: center'>AAAA synthesis results in interface specific
                       IPv6 addresses.
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>A more complex scenario is an FQDN, which in addition to resolving into
	  network interface specific IP addresses, identifies on different network interfaces
	  completely different peer entities with potentially different set of service offering. In even more
          complex scenario, an FQDN identifies unique peer entity, but one that provides different 
          services on its different network interfaces. The solution described in this document is not able to tackle
          these higher layer issues. In fact, some of the problems may be solvable only by user intervention.
</p>
<p>A thing worth noting is that interface specific IP addresses can cause problems also
	  for a single-homed host, if the host retains its DNS cache during movement from one 
	  network interface to another. After the interface change a host could have both positive
          and negative DNS cache entries invalid for the new network interface. Because 
          of this the cached DNS information 
	  should be considered network interface local instead of node global.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Improved DNS server selection</h3>

<p>This chapter describes a procedure a (stub / proxy) resolver may utilize for improved DNS server 
           selection in face of multiple namespaces and multiple simultaneously active network interfaces.
        
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Procedure for prioritizing DNS servers and handling responses</h3>

<p>The resolver SHALL dynamically build for each DNS query a priority list of DNS servers it 
	  will contact to. To prioritize DNS servers in safe and optimal way, a node SHOULD ask 
          with DHCPv6 which DNS servers of each network interface are most likely able to successfully serve
          forward lookup requests matching to specific DNS suffixes or reverse (PTR record) lookup
          requests matching to specific IPv6 prefixes.
          
</p>
<p>A resolver lacking more explicit information shall assume that all information is 
          available from any DNS server of any network interface. The DNS servers learnt by other DNS server
          address configuration methods MUST be handled as medium priority default servers.
          
</p>
<p>When a resource record is to be resolved, the resolver SHOULD give highest precedence to
	  the DNS servers explicitly known to serve matching suffixes or prefixes. However,
          the resolver MUST take into account different trust levels
          of pieces of DNS server selection information the resolver has received from node's network interfaces. The resolver
          MUST generally prefer more trusted DNS servers and less trusted DNS server MAY be of highest 
          priority only if trusted interfaces specifically configure DNS servers with low priority. The 
          non-exhaustive list on table 1 illustrates how the different trust levels of received DNS server selection 
          information MUST influence the DNS server selection logic. 
          
</p><br /><hr class="insert" />
<a name="Table 1"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   Information from       | Information from       | Resulting DNS
   from more trusted      | less trusted           | server priority
   interface A            | interface B            | selection
--------------------------+------------------------+--------------------
1. Medium priority        | Medium priority        | Default:  A, then B
   default                | default                |
--------------------------+------------------------+--------------------
2. Medium priority        | High priority default  | Default:  A, then B
   default                | High priority specific | Specific: A, then B
--------------------------+------------------------+--------------------
3. Low priority default   | Medium priority        | Default:  B, then A
                          | default                |
--------------------------+------------------------+--------------------
4. Low priority default   | Medium priority        | Default:  B, then A
   High priority specific | default                | Specific: A, then B
--------------------------+------------------------+--------------------
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: DNS server selection in case of different trust levels&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The resolver SHOULD avoid sending queries to different interfaces in parallel as that may waste
          resources, sometimes significantly, and would also unnecessary reveal information about ongoing communications.
          Independently of whether DNS queries are sent in series or parallel, replies for DNS queries MUST be waited until
          acceptable positive reply is received, all replies are received, or time out occurs. 
          Specifically, the resolver MUST NOT proceed with a positive reply from less trusted server that cannot be 
          validated with DNSSEC if the DNS query sent to more trusted server is still pending. 
          (DISCUSS: What about those DNS servers that instead of negative answer always return positive reply with an
          IP address of some captive portal?)
          
</p>
<p>For the scenario where an FQDN maps to same service but different IP addresses on different 
	  network interfaces, the source address selection algorithm must be able to pick a source address 
	  from the network interface that was used for DNS resolution.
          
</p>
<p>When local namespace are present a negative reply from a DNS server implies only that 	
   	  the particular DNS server was not able to serve the query. However, it is not probable that
          the secondary DNS servers on the same network interface, on a same administrative domain, would be able to serve either. 
          Therefore, the next DNS server resolver contacts SHOULD be from another network interface.
          
</p>
<p>Resolver SHOULD use DNSSEC to validate all received DNS replies. In the case DNSSEC validation fails the resolver MUST resend
          the query to the next preferred DNS server.
          
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
DNS server selection option</h3>

<p>A DHCPv6 option described below is used to inform resolvers which DNS server should be contacted 
               when initiating forward or reverse DNS lookup procedures.
</p><br /><hr class="insert" />
<a name="xml_figDHCPv6new"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  OPTION_DNS_SERVER_SELECT     |         option-len            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|            DNS-recursive-name-server (IPv6 address)           |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|prf| Reserved  |                                               |
+-+-+-+-+-+-+-+-+          DNS suffixes and prefixes            |
|                          (variable length)                    |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

option-code:   OPTION_DNS_SERVER_SELECT (TBD)

option-len:    Lenght of the option in octets

DNS-recursive-name-server: An IPv6 address of a DNS server

prf:           DNS server preference:

                   01 High
                   00 Medium
                   11 Low
                   10 Reserved - MUST NOT be sent

               The preference is used when selecting between
               equally trusted DNS servers.

               (Editor's note: this field is under consideration
                - really needed or not?)

Reserved:      Flags reserved for the future. MUST be set to
               zero.

DNS suffixes and prefixes:  The list of DNS suffixes for forward DNS
               lookup and prefixes for reverse DNS lookup the DNS server
               has special knowledge about. Field MUST be encoded as
               specified in section "Representation and use of
               domain names" of [RFC3315].
               Additionally, special suffix of "." is used to indicate
               capability to resolve global names. Lack of "."
               suffix on the list indicates DNS server has only local
               information. Prefixes for reverse mapping are encoded as
               defined for ip6.arpa [RFC3152].
</pre></div>
<p style='text-align: center'>DHCPv6 option for explicit DNS suffix configuration
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>A node SHOULD include an OPTION_ORO option in DHCPv6 request with the
               OPTION_DNS_SERVER_SELECT option code to inform the DHCPv6 server about the support for
               the improved DNS server selection logic. DHCPv6 server receiving this information MAY then choose 
               to provision DNS server addresses only with OPTION_DNS_SERVER_SELECT.
            
</p>
<p>The OPTION_DNS_SERVER_SELECT contains one or more DNS suffixes the related DNS server has particular
               knowledge of (i.e. local namespaces). The option can occur multiple times in a single DHCPv6 message, 
               if multiple DNS servers are to be configured.
            
</p>
<p>A resolver SHOULD prioritize between equally trusted DNS servers with help of the preference field. The resolver
               MUST NOT prioritize less trusted DNS servers higher than trusted, even in the case of less trusted
               server would apprently have additional information. In case all other things being equal the resolver shall
               make the prioritization decision based on its internal preferences.
</p>
<p>IPv6 prefixes should cover all the DNS suffixes configured in this option. Prefixes should be as 
               long as possible to avoid collision with information received on other option 
               instances or with options received from DHCPv6 servers of other network interfaces. Overlapping 
               IPv6 prefixes are interpreted so that the resolver can use any or all of the
               DNS servers for queries mathing the prefixes. 
</p>
<p>As the DNS options of <a class='info' href='#RFC3646'>[RFC3646]<span> (</span><span class='info'>Droms, R., &ldquo;DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; December&nbsp;2003.</span><span>)</span></a>, the OPTION_DNS_SERVER_SELECT option 
               MUST NOT appear in any other than the following messages: Solicit, Advertise, Request, Renew, 
               Rebind, Information-Request, and Reply.
</p>
<p>The node SHOULD create a host specific route for the DNS server address. The route must point
               to the interface DNS server address was learned on. This is required to ensure DNS queries are
               sent out via the right interface. 
</p>
<p>In the case of a DNS server replying negatively to a question having matching suffix, it will
               be for implementation to decide whether to consider that as a final response, or whether to ask
               also from other DNS servers. The implementation decision may be based, for example, on deployment or trust 
               models. 
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Coexistence with RFC3646</h3>

<p>The OPTION_DNS_SERVER_SELECT is designed to coexist with OPTION_DNS_SERVERS defined
              in <a class='info' href='#RFC3646'>[RFC3646]<span> (</span><span class='info'>Droms, R., &ldquo;DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6),&rdquo; December&nbsp;2003.</span><span>)</span></a>. The DNS servers configured via OPTION_DNS_SERVERS MUST BE considered
              as default name servers with medium preference. When both options are received from the same 
              network interface and the OPTION_DNS_SERVER_SELECT contains default DNS server address, 
              the resolver SHOULD make decision which one to prefer based on preferences. If
              OPTION_DNS_SERVER_SELECT defines medium preference then DNS server selection decision
              is implementation specific. All default servers are assumed to be able to resolve queries for 
              global names.
           
</p>
<p>If both OPTION_DNS_SERVERS and OPTION_DNS_SERVER_SELECT contain the same DNS server(s) IPv6 address(es), 
              only one instance of each DNS servers' IPv6 addresses shall be added to the DNS server list. 
           
</p>
<p>If a node had indicated support for OPTION_DNS_SERVER_SELECT in DHCPv6 request, the DHCPv6 server 
              may choose to omit sending of OPTION_DNS_SERVERS. This enables offloading use case where
              network administrator wishes to only advertise low priority default DNS servers.
           
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Example of a node behavior</h3>

<p>Figure 5 illustrates node behavior when it initializes two network interfaces for parallel usage and 
               learns DNS suffix and prefix information from DHCPv6 servers.
</p><br /><hr class="insert" />
<a name="xml_fig5"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 Application	Node      DHCPv6 server   DHCPv6 server
                          on interface 1  on interface 2
     |             |                |
     |         +-----------+        |
(1)  |         | open      |        |
     |         | interface |        |
     |         +-----------+        |
     |             |                |
(2)  |             |---option REQ--&gt;|
     |             |&lt;--option RESP--|
     |             |                |
     |         +-----------+        |
(3)  |         | store     |        |
     |         | suffixes  |        |
     |         +-----------+        |
     |             |                |
     |         +-----------+        |
(4)  |         | open      |        |
     |         | interface |        |
     |         +-----------+        |
     |             |                |                |
(5)  |             |---option REQ-------------------&gt;|
     |             |&lt;--option RESP-------------------|
     |             |                |                |
     |         +----------+         |                |
(6)  |         | store    |         |                |
     |         | suffixes |         |                |
     |         +----------+         |                |
     |             |                |                |
</pre></div>
<p style='text-align: center'>Illustration of learning DNS suffixes
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Flow explanations:
</p>
<p></p>
<ol class="text">
<li>A node opens its first network interface
</li>
<li>The node obtains DNS suffix and IPv6 prefix information for the new interface 1 from DHCPv6 server
</li>
<li>The node stores the learned DNS suffixes and IPv6 prefixes for later use
</li>
<li>The node opens its seconds network interface 2
</li>
<li>The node obtains DNS suffix, say 'example.com', and IPv6 prefix
                  information, say '8.b.d.0.1.0.0.2.ip6.arpa' for the new interface 2 from DHCPv6 server
</li>
<li>The node stores the learned DNS suffixes and prefixes for later use
</li>
</ol>

<p>Figure 6 below illustrates how a resolver uses the learned suffix information. 
               Prefix information use for reverse lookups is not illustrated, but that would go as the figure 6 example.
</p><br /><hr class="insert" />
<a name="xml_fig6"></a>

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 Application     Node     DHCPv6 server     DHCPv6 server
                          on interface 1    on interface 2
     |             |                |                |
(1)  |--Name REQ--&gt;|                |                |
     |             |                |                |
     |      +----------------+      |                |
(2)  |      | DNS server     |      |                |
     |      | prioritization |      |                |
     |      +----------------+      |                |
     |             |                |                |
(3)  |             |------------DNS resolution------&gt;|
     |             |&lt;--------------------------------|
     |             |                |                |
(4)  |&lt;--Name resp-|                |                |
     |             |                |                |
</pre></div>
<p style='text-align: center'>Example on choosing interface based on DNS suffix
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Flow explanations:
</p>
<p></p>
<ol class="text">
<li>An application makes a request for resolving an FQDN, e.g. 'private.example.com'
</li>
<li>A node creates list of DNS servers to contact to and uses configured DNS server information and stored DNS suffix information on priorization decisions.
</li>
<li>The node has chosen interface 2, as from DHCPv6 it was learned earlier that the 
	      interface 2 has DNS suffix 'example.com'. The node then resolves the requested name 
	      using interface 2's DNS server to an IPv6 address
</li>
<li>The node replies to application with the resolved IPv6 address
</li>
</ol>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Scalability considerations</h3>

<p>The size limitations of DHCPv6 messages limit the number of suffixes and prefixes that can be carried
      in a configuration option. Including the suffixes and prefixes in a DHCPv6 option is best suited for deployments
      where relatively few carefully selected suffixes and prefixes are adequate. 
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Considerations for network administrators</h3>

<p>Network administrators deploying private namespaces should assist advanced hosts in the DNS server selection
      by providing information described in this memo for nodes. To ensure nodes' source and destination IP address selection also works 
      correctly, network administrators should also deploy related technologies for that purpose.
</p>
<p>The solution described herein is best for selecting a DNS server having knowledge of some namespaces. The solution is not 
      able to make the right decision in a scenario where same name points to different services on different network interfaces. 
      Network administrators are recommended to avoid overloading of namespaces in such manner.
</p>
<p>To mitigate against attacks against local namespaces, administrators utilizing this tool should deploy DNSSEC for their zone.
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>The author would like to thank following people for their valuable feedback and improvement ideas: 
      Mark Andrews, Jari Arkko, Marcelo Bagnulo, Stuart Cheshire, Lars Eggert, Tomohiro Fujisaki, Peter Koch, Suresh Krishnan, 
      Edward Lewis, Kurtis Lindqvist, Arifumi Matsumoto, Erik Nordmark, Steve Padgett, Fabien Rapin, Dave Thaler, Margaret Wasserman, Dan Wing, 
      and Dec Wojciech. Ted Lemon and Julien Laganier receive special thanks for their contributions to security considerations.
</p>
<p>This document was prepared using xml2rfc template and the related web-tool.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
IANA Considerations</h3>

<p>This memo includes a new DHCPv6 option that requires allocation of a new code point.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>It is possible that attackers might try to utilize OPTION_DNS_SERVER_SELECT
         option to redirect some or all DNS queries sent by a resolver
         to undesired destinations. The purpose of an attack might be denial-of-service,
         preparation for man-in-the-middle attack, or something akin.
      
</p>
<p>Attackers might try to lure specific traffic by advertising DNS suffixes 
         and prefixes from very small to very large scope or simply by trying to place attacker's 
         DNS server as the highest priority default server.
      
</p>
<p>The main countermeasure against these attacks is to systematically prioritize more trusted DNS 
         servers higher than less trusted ones. Additionally, resolvers should implement DNSSEC 
         to be able to validate DNS responses received via any of its interfaces.
      
</p>
<p>Decision on trust levels of network interfaces depends very much on deployment scenario and 
         types of network interfaces. For example, unmanaged WLAN may be considered less trustworthy
         than managed cellular or VPN connections.
      
</p>
<p>A node MAY also choose, or be configured, to obtain DNS server selection rules only from selected trusted 
         interfaces, in which case it would be in the hands of administrators of these trusted
         interfaces whether or not to allow redirection, offloading, of DNS queries to untrusted
         interfaces (case 4 of table 1).
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3152">[RFC3152]</a></td>
<td class="author-text">Bush, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3152">Delegation of IP6.ARPA</a>,&rdquo; BCP&nbsp;49, RFC&nbsp;3152, August&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3152.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3315">[RFC3315]</a></td>
<td class="author-text">Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C., and M. Carney, &ldquo;<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>,&rdquo; RFC&nbsp;3315, July&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3315.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-behave-dns64">[I-D.ietf-behave-dns64]</a></td>
<td class="author-text">Bagnulo, M., Sullivan, A., Matthews, P., and I. Beijnum, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-dns64-11.txt">DNS64: DNS extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>,&rdquo; draft-ietf-behave-dns64-11 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-behave-dns64-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mif-problem-statement">[I-D.ietf-mif-problem-statement]</a></td>
<td class="author-text">Blanchet, M. and P. Seite, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mif-problem-statement-09.txt">Multiple Interfaces and Provisioning Domains Problem Statement</a>,&rdquo; draft-ietf-mif-problem-statement-09 (work in progress), October&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mif-problem-statement-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.troan-multihoming-without-nat66">[I-D.troan-multihoming-without-nat66]</a></td>
<td class="author-text">Troan, O., Miles, D., Matsushima, S., Okimoto, T., and D. Wing, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-troan-multihoming-without-nat66-01.txt">IPv6 Multihoming without Network Address Translation</a>,&rdquo; draft-troan-multihoming-without-nat66-01 (work in progress), July&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-troan-multihoming-without-nat66-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wing-behave-dns64-config">[I-D.wing-behave-dns64-config]</a></td>
<td class="author-text">Wing, D., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wing-behave-dns64-config-02.txt">DNS64 Resolvers and Dual-Stack Hosts</a>,&rdquo; draft-wing-behave-dns64-config-02 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-wing-behave-dns64-config-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2767">[RFC2767]</a></td>
<td class="author-text"><a href="mailto:tsuchi@ebina.hitachi.co.jp">Tsuchiya, K.</a>, <a href="mailto:h-higuti@ebina.hitachi.co.jp">HIGUCHI, H.</a>, and <a href="mailto:atarashi@ebina.hitachi.co.jp">Y. Atarashi</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2767">Dual Stack Hosts using the "Bump-In-the-Stack" Technique (BIS)</a>,&rdquo; RFC&nbsp;2767, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2767.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3397">[RFC3397]</a></td>
<td class="author-text">Aboba, B. and S. Cheshire, &ldquo;<a href="http://tools.ietf.org/html/rfc3397">Dynamic Host Configuration Protocol (DHCP) Domain Search Option</a>,&rdquo; RFC&nbsp;3397, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3397.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3646">[RFC3646]</a></td>
<td class="author-text">Droms, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3646">DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>,&rdquo; RFC&nbsp;3646, December&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3646.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4191">[RFC4191]</a></td>
<td class="author-text">Draves, R. and D. Thaler, &ldquo;<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>,&rdquo; RFC&nbsp;4191, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4191.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4193">[RFC4193]</a></td>
<td class="author-text">Hinden, R. and B. Haberman, &ldquo;<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>,&rdquo; RFC&nbsp;4193, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4193.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5006">[RFC5006]</a></td>
<td class="author-text">Jeong, J., Park, S., Beloeil, L., and S. Madanapalli, &ldquo;<a href="http://tools.ietf.org/html/rfc5006">IPv6 Router Advertisement Option for DNS Configuration</a>,&rdquo; RFC&nbsp;5006, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5006.txt">TXT</a>).</td></tr>
</table>

<a name="app-additional"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Best Current Practice for DNS server selection</h3>

<p>On some split-DNS deployments explicit policies for DNS server selection are not available. This  
         section describes ways for hosts to mitigate the problem by sending wide-spread queries and 
         by utilizing possibly existing indirect information elements as hints.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Sending queries out on multiple interfaces in parallel</h3>

<p>A possible current practice is to send DNS queries out of multiple interfaces 
            and pick up the best out of the received responses. A host SHOULD implement DNSSEC
            in order to be able to reject responses that cannot be validated. Selection
            between legitimate answers is implementation specific, but positive replies should
            be preferred.
</p>
<p>A downside of this approach is increased consumption of resources. Namely power
            consumption if an interface, e.g. wireless, has to be brought up just for the 
            DNS query that could have been resolved also via cheaper interface. Also load
            on DNS servers is increased. However, local caching of results mitigates these
            problems, and a node might also learn interfaces that seem to be able to provide
            more responses than other and prefer those - without forgetting fallback required 
            for cases when node is connected to more than one network using local namespaces.
</p>
<p>Another downside is revealing to all DNS servers the names a host is connecting to.
            For example, a DNS server of public hotspot could learn all the private names host
            is trying to connect on other interfaces. 
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Search list option for DNS forward lookup decisions</h3>

<p>A host can learn the special DNS suffixes of attached network interfaces from DHCP search 
  	    list options; DHCPv4 Domain Search Option number 119 [RFC3397] and DHCPv6 Domain 
            Search List Option number 24 [RFC3646]. The host behavior is very similar as is
            illustrated in the example at section 3.3. While these DHCP options are not intented to be
            used in DNS server selection, they may be used by the host for smart DNS server prioritization 
            purposes in order to increase likelyhood of fast and successful DNS query.
</p>
<p>Overloading of existing DNS search list options is not without problems: 
            resolvers would obviously use the DNS suffixes learned from search lists also for name 
            resolution purposes. This may not be a problem in deployments where DNS search 
            list options contain few DNS suffixes like 'example.com, private.example.com', but 
            can become a problem if many suffixes are configured.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
More specific routes for reverse lookup decision</h3>

<p><a class='info' href='#RFC4191'>[RFC4191]<span> (</span><span class='info'>Draves, R. and D. Thaler, &ldquo;Default Router Preferences and More-Specific Routes,&rdquo; November&nbsp;2005.</span><span>)</span></a> defines how more specific routes can be provisioned for hosts.
               This information is not intented to be used in DNS server selection, but nevertheless a host 
               can use this information as a hint about which interface would be best to try first for reverse
               lookup procedures. A DNS server configured via the same interface as more specific routes is 
               likely more capable to answer reverse lookup questions than DNS server of an another interface.
               The likelyhood of success is possibly higher if DNS server address is received in the same RA
               <a class='info' href='#RFC5006'>[RFC5006]<span> (</span><span class='info'>Jeong, J., Park, S., Beloeil, L., and S. Madanapalli, &ldquo;IPv6 Router Advertisement Option for DNS Configuration,&rdquo; September&nbsp;2007.</span><span>)</span></a> as the more specific route information.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Longest matching prefix for reverse lookup decision</h3>

<p>A host may utilize the longest matching prefix approach when deciding which DNS server to contact
               for reverse lookup purposes. Namely, the host may send a DNS query to a DNS server learned over an 
               interface having longest matching prefix to the address being queried. This approach can help in cases
               where ULA <a class='info' href='#RFC4193'>[RFC4193]<span> (</span><span class='info'>Hinden, R. and B. Haberman, &ldquo;Unique Local IPv6 Unicast Addresses,&rdquo; October&nbsp;2005.</span><span>)</span></a> addresses are used and when the queried address belongs
               to a host or server within the same network (for example intranet).
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Teemu Savolainen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hermiankatu 12 D</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TAMPERE,   FI-33720</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FINLAND</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:teemu.savolainen@nokia.com">teemu.savolainen@nokia.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jun-ya Kato</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">9-11, Midori-Cho 3-Chome Musashino-Shi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">TOKYO,   180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JAPAN</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:kato@syce.net">kato@syce.net</a></td></tr>
</table>
</body></html>
