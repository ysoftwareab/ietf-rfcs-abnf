<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>IPv6 Flow Label Specification</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 IPv6 Flow Label Specification">
<link href="#rfc.section.3" rel="Chapter" title="3 Flow Labeling Requirements in the Stateless Scenario">
<link href="#rfc.section.4" rel="Chapter" title="4 Flow State Establishment Requirements">
<link href="#rfc.section.5" rel="Chapter" title="5 Essential correction to RFC 2205">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Covert Channel Risk">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Theft and Denial of Service">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 IPsec and Tunneling Interactions">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Security Filtering Interactions">
<link href="#rfc.section.7" rel="Chapter" title="7 Differences from RFC 3697">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.section.10" rel="Chapter" title="10 Change log [RFC Editor: Please remove]">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Example 20-bit Hash Function">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies the IPv6 Flow Label field and the minimum requirements for IPv6 nodes labeling flows, IPv6 nodes forwarding labeled packets, and flow state establishment methods.  Even when mentioned as examples of possible uses of the flow labeling, more detailed requirements for specific use cases are out of scope for this document.  " />
  <meta name="description" content="This document specifies the IPv6 Flow Label field and the minimum requirements for IPv6 nodes labeling flows, IPv6 nodes forwarding labeled packets, and flow state establishment methods.  Even when mentioned as examples of possible uses of the flow labeling, more detailed requirements for specific use cases are out of scope for this document.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">6MAN</td>
<td class="right">S. Amante</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Level 3</td>
</tr>
<tr>
<td class="left">Updates: 2205, 2460 (if approved)</td>
<td class="right">B. E. Carpenter</td>
</tr>
<tr>
<td class="left">Obsoletes: 3697 (if approved)</td>
<td class="right">Univ. of Auckland</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">S.J. Jiang</td>
</tr>
<tr>
<td class="left">Expires: January 30, 2012</td>
<td class="right">Huawei Technologies Co., Ltd</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Rajahalme</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Nokia Siemens Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 29, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">IPv6 Flow Label Specification<br />
  <span class="filename">draft-ietf-6man-flow-3697bis-07</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies the IPv6 Flow Label field and the minimum requirements for IPv6 nodes labeling flows, IPv6 nodes forwarding labeled packets, and flow state establishment methods.  Even when mentioned as examples of possible uses of the flow labeling, more detailed requirements for specific use cases are out of scope for this document.  </p>
<p>The usage of the Flow Label field enables efficient IPv6 flow classification based only on IPv6 main header fields in fixed positions.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 30, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>
<p>This document may contain material from IETF Documents or IETF Contributions published or made publicly available before November 10, 2008.  The person(s) controlling the copyright in some of this material may not have granted the IETF Trust the right to allow modifications of such material outside the IETF Standards Process. Without obtaining an adequate license from the person(s) controlling the copyright in such materials, this document may not be modified outside the IETF Standards Process, and derivative works of it may not be created outside the IETF Standards Process, except to format it for publication as an RFC or to translate it into languages other than English.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">IPv6 Flow Label Specification</a>
</li>
<li>3.   <a href="#rfc.section.3">Flow Labeling Requirements in the Stateless Scenario</a>
</li>
<li>4.   <a href="#rfc.section.4">Flow State Establishment Requirements</a>
</li>
<li>5.   <a href="#rfc.section.5">Essential correction to RFC 2205</a>
</li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Covert Channel Risk</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Theft and Denial of Service</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">IPsec and Tunneling Interactions</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Security Filtering Interactions</a>
</li>
<li>7.   <a href="#rfc.section.7">Differences from RFC 3697</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.section.10">Change log [RFC Editor: Please remove]</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Example 20-bit Hash Function</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">From the viewpoint of the network layer, a flow is a sequence of packets sent from a particular source to a particular unicast, anycast, or multicast destination that a node desires to label as a flow.  From an upper layer viewpoint, a flow could consist of all packets in one direction of a specific transport connection or media stream.  However, a flow is not necessarily 1:1 mapped to a transport connection. </p>
<p id="rfc.section.1.p.2">Traditionally, flow classifiers have been based on the 5-tuple of the source and destination addresses, ports, and the transport protocol type.  However, some of these fields may be unavailable due to either fragmentation or encryption, or locating them past a chain of IPv6 extension headers may be inefficient.  Additionally, if classifiers depend only on IP layer headers, later introduction of alternative transport layer protocols will be easier. </p>
<p id="rfc.section.1.p.3">The usage of the 3-tuple of the Flow Label and the Source and Destination Address fields enables efficient IPv6 flow classification, where only IPv6 main header fields in fixed positions are used. </p>
<p id="rfc.section.1.p.4">The flow label could be used in both stateless and stateful scenarios.  A stateless scenario is one where any node that processes the flow label in any way does not need to store any information about a flow before or after a packet has been processed. A stateful scenario is one where a node that processes the flow label value needs to store information about the flow, including the flow label value. A stateful scenario might also require a signaling mechanism to inform downstream nodes that the flow label is being used in a certain way and to establish flow state in the network.  For example, RSVP <a href="#RFC2205">[RFC2205]</a> and GIST <a href="#RFC5971">[RFC5971]</a> can signal flow label values.</p>
<p id="rfc.section.1.p.5">The flow label can be used most simply in stateless scenarios.  This specification concentrates on the stateless model and how it can be used as a default mechanism. Details of stateful models, signaling, specific flow state establishment methods and their related service models are out of scope for this specification. The basic requirement for stateful models is set forth in <a href="#estreq">Section 4</a>.  </p>
<p id="rfc.section.1.p.6">The minimum level of IPv6 flow support consists of labeling the flows. A specific goal is to enable and encourage the use of the flow label for various forms of stateless load distribution, especially across Equal Cost Multi-Path (EMCP) and/or Link Aggregation Group (LAG) paths.  ECMP and LAG are methods to bond together multiple physical links used to procure the required capacity necessary to carry an offered load greater than the bandwidth of an individual physical link.  Further details are in a separate document <a href="#I-D.ietf-6man-flow-ecmp">[I-D.ietf-6man-flow-ecmp]</a>.  IPv6 source nodes SHOULD be able to label known flows (e.g., TCP connections, application streams), even if the node itself does not require any flow-specific treatment.  Node requirements for stateless flow labeling are given in <a href="#labreq">Section 3</a>. </p>
<p id="rfc.section.1.p.7">This document replaces <a href="#RFC3697">[RFC3697]</a> and Section 6 and Appendix A of <a href="#RFC2460">[RFC2460]</a>.  A rationale for the changes made is documented in <a href="#I-D.ietf-6man-flow-update">[I-D.ietf-6man-flow-update]</a>.  The present document also includes a correction to <a href="#RFC2205">[RFC2205]</a> concerning the flow label.</p>
<p id="rfc.section.1.p.8">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#spec" id="spec">IPv6 Flow Label Specification</a>
</h1>
<p id="rfc.section.2.p.1">The 20-bit Flow Label field in the IPv6 header <a href="#RFC2460">[RFC2460]</a> is used by a node to label packets of a flow.  A Flow Label of zero is used to indicate packets that have not been labeled.  Packet classifiers can use the triplet of Flow Label, Source Address, and Destination Address fields to identify which flow a particular packet belongs to.  Packets are processed in a flow-specific manner by nodes that are able to do so in a stateless manner, or that have been set up with flow-specific state.  The nature of the specific treatment and the methods for flow state establishment are out of scope for this specification. </p>
<p id="rfc.section.2.p.2">Flow label values should be chosen such that their bits exhibit a high degree of variability, making them suitable for use as part of the input to a hash function used in a load distribution scheme.  At the same time, third parties should be unlikely to be able to guess the next value that a source of flow labels will choose. </p>
<p id="rfc.section.2.p.3">In statistics, a discrete uniform distribution is defined as a probability distribution in which each value in a given range of equally spaced values (such as a sequence of integers) is equally likely to be chosen as the next value. The values in such a distribution exhibit both variability and unguessability. Thus, as specified below in <a href="#labreq">Section 3</a>, an approximation to a discrete uniform distribution is preferable as the source of flow label values. Intentionally, there are no precise mathematical requirements placed on the distribution or the method used to achieve such a distribution.</p>
<p id="rfc.section.2.p.4">Once set to a non-zero value, the Flow Label is expected to be delivered unchanged to the destination node(s). A forwarding node MUST either leave a non-zero flow label value unchanged, or change it only for compelling operational security reasons as described in <a href="#covert">Section 6.1</a>. </p>
<p id="rfc.section.2.p.5">There is no way to verify whether a flow label has been modified en route or whether it belongs to a uniform distribution.  Therefore, no Internet-wide mechanism can depend mathematically on unmodified and uniformly distributed flow labels; they have a "best effort" quality.  Implementers should be aware that the flow label is an unprotected field that could have been accidentally or intentionally changed en route (see <a href="#security">Section 6</a>).  This leads to the following formal rule:</p>
<p></p>

<ul><li>Forwarding nodes such as routers and load distributors MUST NOT depend only on Flow Label values being uniformly distributed. In any usage such as a hash key for load distribution, the Flow Label bits MUST be combined at least with bits from other sources within the packet, so as to produce a constant hash value for each flow and a suitable distribution of hash values across flows. Typically the other fields used will be some or all components of the usual 5-tuple. In this way, load distribution will still occur even if the Flow Label values are poorly distributed. </li></ul>
<p id="rfc.section.2.p.7">Although uniformly distributed flow label values are recommended below, and will always be helpful for load distribution, it is unsafe to assume their presence in the general case, and the use case needs to work even if the flow label value is zero. </p>
<p id="rfc.section.2.p.8">As a general practice, packet flows should not be reordered, and the use of the Flow Label field does not affect this.  In particular, a Flow label value of zero does not imply that reordering is acceptable. </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#labreq" id="labreq">Flow Labeling Requirements in the Stateless Scenario</a>
</h1>
<p id="rfc.section.3.p.1">This section defines the minimum requirements for methods of setting the flow label value within the stateless scenario of flow label usage. </p>
<p id="rfc.section.3.p.2">To enable Flow Label based classification, source nodes SHOULD assign each unrelated transport connection and application data stream to a new flow. A typical definition of a flow for this purpose is any set of packets carrying the same 5-tuple {dest addr, source addr, protocol, dest port, source port}.  It should be noted that a source node always has convenient and efficient access to this 5-tuple, which is not always the case for nodes that subsequently forward the packet.  </p>
<p id="rfc.section.3.p.3">It is desirable that flow label values should be uniformly distributed to assist load distribution. It is therefore RECOMMENDED that source hosts support the flow label by setting the flow label field for all packets of a given flow to the same value chosen from an approximation to a discrete uniform distribution.  Both stateful and stateless methods of assigning a value could be used, but it is outside the scope of this specification to mandate an algorithm.  The algorithm SHOULD ensure that the resulting flow label values are unique with high probability.  However, if two simultaneous flows are by chance assigned the same flow label value, and have the same source and destination addresses, it simply means that they will receive the same treatment throughout the network.  As long as this is a low probability event, it will not significantly affect load distribution. </p>
<p id="rfc.section.3.p.4">A possible stateless algorithm is to use a suitable 20 bit hash of values from the IP packet's 5-tuple.  A simple example hash function is described in <a href="#Appendix1">Appendix Appendix A</a>.  </p>
<p id="rfc.section.3.p.5">An alternative approach is to use a pseudo-random number generator to assign a flow label value for a given transport session; such a method will require minimal local state to be kept at the source node, by recording the flow label associated with each transport socket. </p>
<p id="rfc.section.3.p.6">Viewed externally, either of these approaches will produce values that appear to be uniformly distributed and pseudo-random. </p>
<p id="rfc.section.3.p.7">An implementation in which flow labels are assigned sequentially is NOT RECOMMENDED, as it would then be simple for on-path observers to guess the next value. </p>
<p id="rfc.section.3.p.8">A source node which does not otherwise set the flow label MUST set its value to zero. </p>
<p id="rfc.section.3.p.9">A node that forwards a flow whose flow label value in arriving packets is zero MAY change the flow label value. In that case, it is RECOMMENDED that the forwarding node sets the flow label field for a flow to a uniformly distributed value as just described for source nodes. </p>
<p></p>

<ul>
<li>The same considerations apply as to source hosts setting the flow label; in particular, the preferred case is that a flow is defined by the 5-tuple. However, there are cases in which the complete 5-tuple for all packets is not readily available to a forwarding node, in particular for fragmented packets. In such cases a flow can be defined by fewer IPv6 header fields, typically using only the 2-tuple {dest addr, source addr}. There are alternative approaches that implementers could choose, such as: <ul>
<li>A forwarding node might use the 5-tuple to define a flow whenever possible, but use the 2-tuple when the complete 5-tuple is not available. In this case, unfragmented and fragmented packets belonging to the same transport session would receive different flow label values, altering the effect of subsequent load distribution based on the flow label. </li>
<li>A forwarding node might use the 2-tuple to define a flow in all cases. In this case, subsequent load distribution would be based only on IP addresses. </li>
</ul>
<p> </p>
</li>
<li>The option to set the flow label in a forwarding node, if implemented, would presumably be of value in first-hop or ingress routers. It might place a considerable per-packet processing load on them, even if they adopted a stateless method of flow identification and label assignment.  However, it will not interfere with host-to-router load sharing <a href="#RFC4311">[RFC4311]</a>. It needs to be under the control of network managers, to avoid unwanted processing load and any other undesirable effects. For this reason it MUST be a configurable option, disabled by default.  </li>
</ul>
<p id="rfc.section.3.p.11">The preceding rules taken together allow a given network to include routers that set flow labels on behalf of hosts that do not do so. The complications described explain why the principal recommendation is that the source hosts should set the label. </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#estreq" id="estreq">Flow State Establishment Requirements</a>
</h1>
<p id="rfc.section.4.p.1">A node that sets the flow label MAY also take part in a flow state establishment method that results in assigning specific treatments to specific flows, possibly including signaling.  Any such method MUST NOT disturb nodes taking part in the stateless scenario just described. Thus, any node that sets flow label values according to a stateful scheme MUST choose labels that conform to <a href="#labreq">Section 3</a> of the present specification. Further details are not discussed in this document. </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Essential correction to RFC 2205</h1>
<p><a href="#RFC2460">[RFC2460]</a> reduced the size of the flow label field from 24 to 20 bits.  The references to a 24 bit flow label field on pages 87 and 88 of <a href="#RFC2205">[RFC2205]</a> are updated accordingly. </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security" id="security">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">This section considers security issues raised by the use of the Flow Label, including the potential for denial-of-service attacks, and the related potential for theft of service by unauthorized traffic (<a href="#theft">Section 6.2</a>).  <a href="#ipsec">Section 6.3</a> addresses the use of the Flow Label in the presence of IPsec including its interaction with IPsec tunnel mode and other tunneling protocols.  We also note that inspection of unencrypted Flow Labels may allow some forms of traffic analysis by revealing some structure of the underlying communications.  Even if the flow label were encrypted, its presence as a constant value in a fixed position might assist traffic analysis and cryptoanalysis. </p>
<p id="rfc.section.6.p.2">The flow label is not protected in any way, even if IPsec authentication <a href="#RFC4302">[RFC4302]</a> is in use, so it can be forged by an on-path attacker. Implementers are advised that any en-route change to the flow label value is undetectable. On the other hand, a uniformly distributed pseudo-random flow label cannot be readily guessed by an attacker; see <a href="#I-D.gont-6man-flowlabel-security">[I-D.gont-6man-flowlabel-security]</a> for further discussion.  If a hash algorithm is used, as suggested in <a href="#labreq">Section 3</a>, it SHOULD include a step that makes the flow-label value significantly difficult to predict <a href="#RFC4086">[RFC4086]</a>, even with knowledge of the algorithm being used. </p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#covert" id="covert">Covert Channel Risk</a>
</h1>
<p id="rfc.section.6.1.p.1">The flow label could be used as a covert data channel, since apparently pseudo-random flow label values could in fact consist of covert data <a href="#NSA">[NSA]</a>. This could for example be achieved using a series of otherwise innocuous UDP packets whose flow label values constitute a covert message, or by co-opting a TCP session to carry a covert message in the flow labels of successive packets.  Both of these could be recognised as suspicious - the first because isolated UDP packets would not normally be expected to have non-zero flow labels, and the second because the flow label values in a given TCP session should all be equal. However, other methods, such as co-opting the flow labels of occasional packets, might be rather hard to detect. </p>
<p id="rfc.section.6.1.p.2">In situations where the covert channel risk is considered significant, the only certain defense is for a firewall to rewrite non-zero flow labels. This would be an exceptional violation of the rule that the flow label, once set to a non-zero value, must not be changed.  To preserve load distribution capability, such a firewall SHOULD rewrite labels by following the method described for a forwarding node (see <a href="#labreq">Section 3</a>), as if the incoming label value were zero, and MUST NOT set non-zero flow labels to zero. This behaviour is nevertheless undesirable, since (as discussed in <a href="#labreq">Section 3</a>), only source nodes have straightforward access to the complete 5-tuple.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#theft" id="theft">Theft and Denial of Service</a>
</h1>
<p id="rfc.section.6.2.p.1">Since the mapping of network traffic to flow-specific treatment is triggered by the IP addresses and Flow Label value of the IPv6 header, an adversary may be able to obtain a class of service that the network did not intend to provide by modifying the IPv6 header or by injecting packets with false addresses and/or labels.  A concrete analysis of this threat is only possible for specific stateful methods of signaling and using the flow label, which are out of scope for this document. Clearly, a full analysis will be required when any such method is specified, but in general networks SHOULD NOT make resource allocation decisions based on flow labels without some external means of assurance. </p>
<p id="rfc.section.6.2.p.2">A denial of service attack <a href="#RFC4732">[RFC4732]</a> becomes possible in the stateless model when the modified or injected traffic depletes the resources available to forward it and other traffic streams.  If a DoS attack were undertaken against a given Flow Label (or set of Flow Labels), then traffic containing an affected Flow Label might well experience worse-than-best-effort network performance. </p>
<p id="rfc.section.6.2.p.3">Note that since the treatment of IP headers by nodes is typically unverified, there is no guarantee that flow labels sent by a node are set according to the recommendations in this document.  A man-in-the-middle or injected-traffic denial of service attack specifically directed at flow label handling would involve setting unusual flow labels.  For example, an attacker could set all flow labels reaching a given router to the same arbitrary non-zero value, or could perform rapid cycling of flow label values such that the packets of a given flow will each have a different value. Either of these attacks would cause a stateless load distribution algorithm to perform badly and would cause a stateful classifier to behave incorrectly. For this reason, stateless classifiers should not use the flow label alone to control load distribution, and stateful classifiers should include explicit methods to detect and ignore suspect flow label values. </p>
<p id="rfc.section.6.2.p.4">Since flows are identified by the 3-tuple of the Flow Label and the Source and Destination Address, the risk of denial of service introduced by the Flow Label is closely related to the risk of denial of service by address spoofing.  An adversary who is in a position to forge an address is also likely to be able to forge a label, and vice versa. </p>
<p id="rfc.section.6.2.p.5">There are two issues with different properties: Spoofing of the Flow Label only, and spoofing of the whole 3-tuple, including Source and Destination Address. </p>
<p id="rfc.section.6.2.p.6">The former can be done inside a node which is using or transmitting the correct source address.  The ability to spoof a Flow Label typically implies being in a position to also forge an address, but in many cases, spoofing an address may not be interesting to the spoofer, especially if the spoofer's goal is theft of service, rather than denial of service. </p>
<p id="rfc.section.6.2.p.7">The latter can be done by a host which is not subject to ingress filtering <a href="#RFC2827">[RFC2827]</a> or by an intermediate router. Due to its properties, this is typically useful only for denial of service. In the absence of ingress filtering, almost any third party could instigate such an attack. </p>
<p id="rfc.section.6.2.p.8">In the presence of ingress filtering, forging a non-zero Flow Label on packets that originated with a zero label, or modifying or clearing a label, could only occur if an intermediate system such as a router was compromised, or through some other form of man-in-the- middle attack.  </p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#ipsec" id="ipsec">IPsec and Tunneling Interactions</a>
</h1>
<p id="rfc.section.6.3.p.1">The IPsec protocol, as defined in <a href="#RFC4301">[RFC4301]</a>, <a href="#RFC4302">[RFC4302]</a>, <a href="#RFC4303">[RFC4303]</a> does not include the IPv6 header's Flow Label in any of its cryptographic calculations (in the case of tunnel mode, it is the outer IPv6 header's Flow Label that is not included).  Hence modification of the Flow Label by a network node has no effect on IPsec end-to-end security, because it cannot cause any IPsec integrity check to fail.  As a consequence, IPsec does not provide any defense against an adversary's modification of the Flow Label (i.e., a man-in-the-middle attack). </p>
<p id="rfc.section.6.3.p.2">IPsec tunnel mode provides security for the encapsulated IP header's Flow Label.  A tunnel mode IPsec packet contains two IP headers: an outer header supplied by the tunnel ingress node and an encapsulated inner header supplied by the original source of the packet.  When an IPsec tunnel is passing through nodes performing flow classification, the intermediate network nodes operate on the Flow Label in the outer header.  At the tunnel egress node, IPsec processing includes removing the outer header and forwarding the packet (if required) using the inner header.  The IPsec protocol requires that the inner header's Flow Label not be changed by this decapsulation processing to ensure that modifications to label cannot be used to launch theft- or denial-of-service attacks across an IPsec tunnel endpoint.  This document makes no change to that requirement; indeed it forbids changes to the Flow Label. </p>
<p id="rfc.section.6.3.p.3">When IPsec tunnel egress decapsulation processing includes a sufficiently strong cryptographic integrity check of the encapsulated packet (where sufficiency is determined by local security policy), the tunnel egress node can safely assume that the Flow Label in the inner header has the same value as it had at the tunnel ingress node. </p>
<p id="rfc.section.6.3.p.4">This analysis and its implications apply to any tunneling protocol that performs integrity checks.  Of course, any Flow Label set in an encapsulating IPv6 header is subject to the risks described in the previous section. </p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Security Filtering Interactions</h1>
<p id="rfc.section.6.4.p.1">The Flow Label does nothing to eliminate the need for packet filtering based on headers past the IP header, if such filtering is deemed necessary for security reasons on nodes such as firewalls or filtering routers. </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Differences from RFC 3697</h1>
<p id="rfc.section.7.p.1">The main differences between this specification and its predecessor are as follows:</p>
<p></p>

<ul>
<li>This specification encourages non-zero flow label values to be used, and clearly defines how to set a non-zero value. </li>
<li>It encourages a stateless model with uniformly distributed flow label values. </li>
<li>It does not specify any details of a stateful model. </li>
<li>It retains the rule that the flow label must not be changed en route, but allows routers to set the label on behalf of hosts that do not do so. </li>
<li>It discusses the covert channel risk and its consequences for firewalls. </li>
</ul>
<p id="rfc.section.7.p.3">For further details see <a href="#I-D.ietf-6man-flow-update">[I-D.ietf-6man-flow-update]</a>. </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">This document requests no action by IANA. </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#ack" id="ack">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">Valuable comments and contributions were made by Jari Arkko, Ran Atkinson, Fred Baker, Richard Barnes, Steve Blake, Remi Despres, Alan Ford, Fernando Gont, Brian Haberman, Tony Hain, Joel Halpern, Qinwen Hu, Chris Morrow, Thomas Narten, Mark Smith, Pascal Thubert, Iljitsch van Beijnum, and other participants in the 6man working group.</p>
<p id="rfc.section.9.p.2">Cristian Calude suggested the von Neumann algorithm in <a href="#Appendix1">Appendix Appendix A</a>.  David Malone and Donald Eastlake gave additional input about hash algorithms.</p>
<p id="rfc.section.9.p.3">Steve Deering and Alex Conta were co-authors of RFC 3697, on which this document is based. </p>
<p id="rfc.section.9.p.4">Contributors to the original development of RFC 3697 included Ran Atkinson, Steve Blake, Jim Bound, Francis Dupont, Robert Elz, Tony Hain, Robert Hancock, Bob Hinden, Christian Huitema, Frank Kastenholz, Thomas Narten, Charles Perkins, Pekka Savola, Hesham Soliman, Michael Thomas, Margaret Wasserman, and Alex Zinin. </p>
<p id="rfc.section.9.p.5">This document was produced using the xml2rfc tool <a href="#RFC2629">[RFC2629]</a>.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#changes" id="changes">Change log [RFC Editor: Please remove]</a>
</h1>
<p id="rfc.section.10.p.1">draft-ietf-6man-flow-3697bis-06: resolved IESG comments, 2011-07-29.</p>
<p id="rfc.section.10.p.2">draft-ietf-6man-flow-3697bis-06: resolved IETF Last Call comments, 2011-07-11.</p>
<p id="rfc.section.10.p.3">draft-ietf-6man-flow-3697bis-05: resolved AD comments, improved hash algorithm, 2011-06-29.</p>
<p id="rfc.section.10.p.4">draft-ietf-6man-flow-3697bis-04: update to resolve further WG comments, 2011-05-11:</p>
<p></p>

<ul>
<li>Suggested a specific hash algorithm to generate a flow label. </li>
<li>Removed reference to stateful domain. </li>
<li>Added text about covert channel and tuned text about firewall behavior; removed the confusing word "immutable". </li>
<li>Added that Section 6 of RFC 2460 is replaced. </li>
<li>Editorial fixes. </li>
</ul>
<p id="rfc.section.10.p.6">draft-ietf-6man-flow-3697bis-03: update to resolve WGLC comments, 2011-05-02:</p>
<p></p>

<ul>
<li>Clarified that the network layer view of flows is agnostic about transport sessions. </li>
<li>Honed the definition of stateless v stateful models. </li>
<li>Honed the text about using a pseudo-random function. </li>
<li>Moved material about violation of immutability to Security section, and rephrased accordingly. </li>
<li>Dropped material about setting the flow label at a domain exit router: doesn't belong here now that we have dropped almost all the stateful text. </li>
<li>Removed normative reference to draft-gont-6man-flowlabel-security. </li>
<li>Removed the statement that a node that does not set or use the flow label must ignore it: this statement appears to be a no-op. </li>
<li>Added a summary of changes from RFC 3697. </li>
<li>Miscellaneous editorial fixes. </li>
</ul>
<p id="rfc.section.10.p.8">draft-ietf-6man-flow-3697bis-02: update to remove most text about stateful methods, 2011-03-13</p>
<p id="rfc.section.10.p.9">draft-ietf-6man-flow-3697bis-01: update after resolving 11 initial issues, 2011-02-26</p>
<p id="rfc.section.10.p.10">draft-ietf-6man-flow-3697bis-00: original version, built from RFC3697 and draft-ietf-6man-flow-update-01, 2011-01-31</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2460">[RFC2460]</b></td>
<td class="top">
<a href="mailto:deering@cisco.com" title="Cisco Systems, Inc.">Deering, S.E.</a> and <a href="mailto:hinden@iprg.nokia.com" title="Nokia">R.M. Hinden</a>, "<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>", RFC 2460, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2205">[RFC2205]</b></td>
<td class="top">
<a href="mailto:Braden@ISI.EDU" title="USC Information Sciences Institute">Braden, B.</a>, <a href="mailto:lixia@cs.ucla.edu" title="UCLA Computer Science Department">Zhang, L.</a>, <a href="mailto:Berson@ISI.EDU" title="USC Information Sciences Institute">Berson, S.</a>, <a href="mailto:Herzog@WATSON.IBM.COM" title="IBM T. J. Watson Research Center">Herzog, S.</a> and <a href="mailto:jamin@EECS.UMICH.EDU" title="University of Michigan">S. Jamin</a>, "<a href="http://tools.ietf.org/html/rfc2205">Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</a>", RFC 2205, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4086">[RFC4086]</b></td>
<td class="top">
<a>Eastlake, D.</a>, <a>Schiller, J.</a> and <a>S. Crocker</a>, "<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>", BCP 106, RFC 4086, June 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2629">[RFC2629]</b></td>
<td class="top">
<a href="mailto:mrose@not.invisible.net" title="Invisible Worlds, Inc.">Rose, M.T.</a>, "<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>", RFC 2629, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4311">[RFC4311]</b></td>
<td class="top">
<a>Hinden, R.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc4311">IPv6 Host-to-Router Load Sharing</a>", RFC 4311, November 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2827">[RFC2827]</b></td>
<td class="top">
<a>Ferguson, P.</a> and <a>D. Senie</a>, "<a href="http://tools.ietf.org/html/rfc2827">Network Ingress Filtering: Defeating Denial of Service Attacks which employ IP Source Address Spoofing</a>", BCP 38, RFC 2827, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3697">[RFC3697]</b></td>
<td class="top">
<a>Rajahalme, J.</a>, <a>Conta, A.</a>, <a>Carpenter, B.</a> and <a>S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc3697">IPv6 Flow Label Specification</a>", RFC 3697, March 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a>Kent, S.</a> and <a>K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4302">[RFC4302]</b></td>
<td class="top">
<a>Kent, S.</a>, "<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>", RFC 4302, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4303">[RFC4303]</b></td>
<td class="top">
<a>Kent, S.</a>, "<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>", RFC 4303, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4732">[RFC4732]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Rescorla, E.</a>, <a>IAB</a>, "<a href="http://tools.ietf.org/html/rfc4732">Internet Denial-of-Service Considerations</a>", RFC 4732, December 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5971">[RFC5971]</b></td>
<td class="top">
<a>Schulzrinne, H.</a> and <a>R. Hancock</a>, "<a href="http://tools.ietf.org/html/rfc5971">GIST: General Internet Signalling Transport</a>", RFC 5971, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-6man-flow-update">[I-D.ietf-6man-flow-update]</b></td>
<td class="top">
<a>Amante, S</a>, <a>Carpenter, B</a> and <a>S Jiang</a>, "<a href="http://tools.ietf.org/html/draft-ietf-6man-flow-update-07">Rationale for update to the IPv6 flow label specification</a>", Internet-Draft draft-ietf-6man-flow-update-07, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.gont-6man-flowlabel-security">[I-D.gont-6man-flowlabel-security]</b></td>
<td class="top">
<a>Gont, F</a>, "<a href="http://tools.ietf.org/html/draft-gont-6man-flowlabel-security-01">Security Assessment of the IPv6 Flow Label</a>", Internet-Draft draft-gont-6man-flowlabel-security-01, November 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-6man-flow-ecmp">[I-D.ietf-6man-flow-ecmp]</b></td>
<td class="top">
<a>Carpenter, B</a> and <a>S Amante</a>, "<a href="http://tools.ietf.org/html/draft-ietf-6man-flow-ecmp-05">Using the IPv6 flow label for equal cost multipath routing and link aggregation in tunnels</a>", Internet-Draft draft-ietf-6man-flow-ecmp-05, July 2011.</td>
</tr>
<tr>
<td class="reference"><b id="NSA">[NSA]</b></td>
<td class="top">
<a>Potyraj, C.A.</a>, "<a>Firewall Design Considerations for IPv6</a>", National Security Agency I733-041R-2007, 2007.</td>
</tr>
<tr>
<td class="reference"><b id="vonNeumann">[vonNeumann]</b></td>
<td class="top">
<a>von Neumann, J.</a>, "<a>Various techniques used in connection with random digits</a>", National Bureau of Standards Applied Math Series 12, 36-38, 1951.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#Appendix1" id="Appendix1">Example 20-bit Hash Function</a>
</h1>
<p id="rfc.section.Appendix A.p.1">As mentioned in <a href="#labreq">Section 3</a>, a stateless hash function may be used to generate a flow label value from an IPv6 packet's 5-tuple. It is not trivial to choose a suitable hash function, and it is expected that extensive practical experience will be required to identify the best choices.  An example function, based on an algorithm by von Neumann known to produce an approximately uniform distribution <a href="#vonNeumann">[vonNeumann]</a>, follows.  For each packet for which a flow label must be generated, execute the following steps:</p>
<p></p>

<ol>
<li>Split the destination and source addresses into two 64 bit values each, thus transforming the 5-tuple into a 7-tuple. </li>
<li>Add the following five components together using unsigned 64 bit arithmetic, discarding any carry bits: both parts of the source address, both parts of the destination address, and the protocol number. </li>
<li>Apply the von Neumann algorithm to the resulting string of 64 bits: <ul class="empty">
<li>Starting at the least significant end, select two bits. </li>
<li>If the two bits are 00 or 11, discard them. </li>
<li>If the two bits are 01, output a 0 bit. </li>
<li>If the two bits are 10, output a 1 bit. </li>
<li>Repeat with the next two bits in the input 64 bit string. </li>
<li>Stop when 16 bits have been output (or when the 64 bit string is exhausted). </li>
</ul>
<p> </p>
</li>
<li>Add the two port numbers to the resulting 16 bit number.</li>
<li>Shift the resulting value 4 bits left and mask with 0xfffff.</li>
<li>In the highly unlikely event that the result is exactly zero, set the flow label arbitrarily to the value 1. </li>
</ol>
<p id="rfc.section.Appendix A.p.3">Note that this simple example does not include a step to prevent predictability, as recommended in <a href="#security">Section 6</a>. </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shane Amante</span> 
	  <span class="n hidden">
		<span class="family-name">Amante</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  <span>Level 3 Communications, LLC</span>
<span>1025 Eldorado Blvd</span>

	  <span class="vcardline">
		<span class="locality">Broomfield</span>,  
		<span class="region">CO</span> 
		<span class="code">80021</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shane@level3.net">shane@level3.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Brian Carpenter</span> 
	  <span class="n hidden">
		<span class="family-name">Carpenter</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  <span>Department of Computer Science</span>
<span>University of Auckland</span>
<span>PB 92019</span>

	  <span class="vcardline">
		<span class="locality">Auckland</span>,  
		<span class="region"></span>
		<span class="code">1142</span>
	  </span>
	  <span class="country-name vcardline">New Zealand</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:brian.e.carpenter@gmail.com">brian.e.carpenter@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sheng Jiang</span> 
	  <span class="n hidden">
		<span class="family-name">Jiang</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei Technologies Co., Ltd</span>
	<span class="adr">
	  <span>Huawei Building, No.3 Xinxi Rd.,</span>

	  <span class="vcardline">
		<span class="locality">Shang-Di Information Industry Base, Hai-Dian District, Beijing</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">P.R. China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jiangsheng@huawei.com">jiangsheng@huawei.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jarno Rajahalme</span> 
	  <span class="n hidden">
		<span class="family-name">Rajahalme</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia Siemens Networks</span>
	<span class="adr">
	  <span>Linnoitustie 6</span>

	  <span class="vcardline">
		<span class="locality">02600  Espoo</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Finland</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jarno.rajahalme@nsn.com">jarno.rajahalme@nsn.com</a></span>

  </address>
</div>

</body>
</html>