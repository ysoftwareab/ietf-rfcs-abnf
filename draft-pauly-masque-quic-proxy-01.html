<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>QUIC-Aware Proxying Using CONNECT-UDP</title>
<meta content="Tommy Pauly" name="author">
<meta content="David Schinazi" name="author">
<meta content="
       This document defines an extension to the CONNECT-UDP HTTP method that adds
specific optimizations for QUIC connections that are proxied. This extension
allows a proxy to reuse UDP 4-tuples for multiple connections. It also defines a
mode of proxying in which QUIC short header packets can be forwarded through the
proxy rather than being re-encapsulated and re-encrypted. 
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-pauly-masque-quic-proxy-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.2
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.4.1
    requests 2.25.1
    setuptools 54.0.0
    six 1.15.0
-->
<link href="/tmp/draft-pauly-masque-quic-proxy-01-9n0mrl2a.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">QUIC Proxy</td>
<td class="right">April 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Pauly &amp; Schinazi</td>
<td class="center">Expires 15 October 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">MASQUE</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-pauly-masque-quic-proxy-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-04-13" class="published">13 April 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-10-15">15 October 2021</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">T. Pauly</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">D. Schinazi</div>
<div class="org">Google LLC</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">QUIC-Aware Proxying Using CONNECT-UDP</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines an extension to the CONNECT-UDP HTTP method that adds
specific optimizations for QUIC connections that are proxied. This extension
allows a proxy to reuse UDP 4-tuples for multiple connections. It also defines a
mode of proxying in which QUIC short header packets can be forwarded through the
proxy rather than being re-encapsulated and re-encrypted.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Source for this draft and an issue tracker can be found at
  <a href="https://github.com/tfpauly/quic-proxy">https://github.com/tfpauly/quic-proxy</a>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 15 October 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-conventions-and-definitions" class="xref">Conventions and Definitions</a><a href="#section-toc.1-1.1.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-terminology" class="xref">Terminology</a><a href="#section-toc.1-1.1.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-required-proxy-state" class="xref">Required Proxy State</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-datagram-flow-id-mapping" class="xref">Datagram Flow ID Mapping</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-server-connection-id-mappin" class="xref">Server Connection ID Mapping</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.2.2.3">
                <p id="section-toc.1-1.2.2.3.1"><a href="#section-2.3" class="xref">2.3</a>.  <a href="#name-client-connection-id-mappin" class="xref">Client Connection ID Mappings</a><a href="#section-toc.1-1.2.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.2.2.4">
                <p id="section-toc.1-1.2.2.4.1"><a href="#section-2.4" class="xref">2.4</a>.  <a href="#name-detecting-connection-id-con" class="xref">Detecting Connection ID Conflicts</a><a href="#section-toc.1-1.2.2.4.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-connection-id-headers-for-c" class="xref">Connection ID Headers for CONNECT-UDP</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-client-request-behavior" class="xref">Client Request Behavior</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-new-proxied-connection-setu" class="xref">New Proxied Connection Setup</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-adding-new-client-connectio" class="xref">Adding New Client Connection IDs</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-sending-with-forwarded-mode" class="xref">Sending With Forwarded Mode</a><a href="#section-toc.1-1.4.2.3.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="xref">4.4</a>.  <a href="#name-receiving-with-forwarded-mo" class="xref">Receiving With Forwarded Mode</a><a href="#section-toc.1-1.4.2.4.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.4.2.5">
                <p id="section-toc.1-1.4.2.5.1"><a href="#section-4.5" class="xref">4.5</a>.  <a href="#name-opting-out-of-forwarded-mod" class="xref">Opting Out of Forwarded Mode</a><a href="#section-toc.1-1.4.2.5.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-proxy-response-behavior" class="xref">Proxy Response Behavior</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-removing-mapping-state" class="xref">Removing Mapping State</a><a href="#section-toc.1-1.5.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-handling-connection-migrati" class="xref">Handling Connection Migration</a><a href="#section-toc.1-1.5.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-example" class="xref">Example</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-interactions-with-load-bala" class="xref">Interactions with Load Balancers</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-packet-size-considerations" class="xref">Packet Size Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-http-headers" class="xref">HTTP Headers</a><a href="#section-toc.1-1.10.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty compact toc">
<li class="ulEmpty compact toc" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="xref">11.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.11.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty compact toc" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="xref">11.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.11.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty compact toc" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a><a href="#section-toc.1-1.13.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The CONNECT-UDP HTTP method <span>[<a href="#CONNECT-UDP" class="xref">CONNECT-UDP</a>]</span> defines
a way to send datagrams through an HTTP proxy, where UDP is used to communicate
between the proxy and a target server. This can be used to proxy QUIC
connections <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>, since QUIC runs over UDP
datagrams.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">This document uses the term "target" to refer to the server that a client is
accessing via a proxy. This target may be an origin hosting content, or another
proxy.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document extends the CONNECT-UDP HTTP method to add signalling about QUIC
Connection IDs. QUIC Connection IDs are used to identify QUIC connections in
scenarios where there is not a strict bidirectional mapping between one QUIC
connection and one UDP 4-tuple (pairs of IP addresses and ports). A proxy that
is aware of Connection IDs can reuse UDP 4-tuples between itself and a target
for multiple proxied QUIC connections.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This extension is only defined for HTTP/3 <span>[<a href="#HTTP3" class="xref">HTTP3</a>]</span> and not
any earlier versions.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Awareness of Connection IDs also allows a proxy to avoid re-encapsulation and
re-encryption of proxied QUIC packets once a connection has been established.
When this functionality is present, the proxy can support two modes for handling
QUIC packets:<a href="#section-1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-6">
<li id="section-1-6.1">Tunnelled, in which client &lt;-&gt; target QUIC packets are encapsulated inside
client &lt;-&gt; proxy QUIC packets. These packets use multiple layers of encryption
and congestion control. QUIC long header packets MUST use this mode. QUIC short
header packets MAY use this mode. This is the default mode for CONNECT-UDP.<a href="#section-1-6.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-6.2">Forwarded, in which client &lt;-&gt; target QUIC packets are sent directly over the
client &lt;-&gt; proxy UDP socket. These packets are only encrypted using the
client-target keys, and use the client-target congestion control. This mode MUST
only be used for QUIC short header packets.<a href="#section-1-6.2" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-7">Forwarding is defined as an optimization to reduce CPU processing on clients and
proxies, as well as avoiding MTU overhead for packets on the wire. This makes it
suitable for deployment situations that otherwise relied on cleartext TCP
proxies, which cannot support QUIC and have inferior security and privacy
properties.<a href="#section-1-7" class="pilcrow">¶</a></p>
<p id="section-1-8">The properties provided by the forwarding mode are as follows:<a href="#section-1-8" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-9.1">All packets sent between the client and the target traverse through the proxy
device.<a href="#section-1-9.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-9.2">The target server cannot know the IP address of the client solely based on the
proxied packets the target receives.<a href="#section-1-9.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-9.3">Observers of either or both of the client &lt;-&gt; proxy link and the proxy &lt;-&gt;
target are not able to learn more about the client &lt;-&gt; target communication than
if no proxy was used.<a href="#section-1-9.3" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-10">It is not a goal of forwarding mode to prevent correlation between client &lt;-&gt;
proxy and the proxy &lt;-&gt; target packets from an entity that can observe both
links. See <a href="#security" class="xref">Section 9</a> for further discussion.<a href="#section-1-10" class="pilcrow">¶</a></p>
<p id="section-1-11">Both clients and proxies can unilaterally choose to disable forwarded mode for
any client &lt;-&gt; target connection.<a href="#section-1-11" class="pilcrow">¶</a></p>
<p id="section-1-12">QUIC proxies only need to understand the Header Form bit, and the connection ID
fields from packets in client &lt;-&gt; target QUIC connections. Since these fields
are all in the QUIC invariants header <span>[<a href="#INVARIANTS" class="xref">INVARIANTS</a>]</span>,
QUIC proxies can proxy all versions of QUIC.<a href="#section-1-12" class="pilcrow">¶</a></p>
<div id="conventions">
<section id="section-1.1">
        <h3 id="name-conventions-and-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD",
"SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this
document are to be interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
when, and only when, they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terminology">
<section id="section-1.2">
        <h3 id="name-terminology">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
        </h3>
<p id="section-1.2-1">This document uses the following terms:<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.2-2.1">Client: the client of all QUIC connections discussed in this document.<a href="#section-1.2-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.2">Proxy: the endpoint that responds to the CONNECT-UDP request.<a href="#section-1.2-2.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.3">Target: the server that a client is accessing via a proxy.<a href="#section-1.2-2.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.4">Client &lt;-&gt; Proxy QUIC connection: a single QUIC connection established from
the client to the proxy.<a href="#section-1.2-2.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.5">Datagram flow ID: represents a flow of HTTP/3 DATAGRAMs
<span>[<a href="#H3DGRAM" class="xref">H3DGRAM</a>]</span> specific to a single client &lt;-&gt; proxy
QUIC connection.<a href="#section-1.2-2.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.6">Socket: a UDP 4-tuple (local IP address, local UDP port, remote IP address,
remote UDP port). In some implementations, this is referred to as a "connected"
socket.<a href="#section-1.2-2.6" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.7">Client-facing socket: the socket used to communicate between the client and
the proxy.<a href="#section-1.2-2.7" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.8">Server-facing socket: the socket used to communicate between the proxy and
the target.<a href="#section-1.2-2.8" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.9">Client Connection ID: a QUIC Connection ID that is chosen by the client, and
is used in the Destination Connection ID field of packets from the target to
the client.<a href="#section-1.2-2.9" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.2-2.10">Server Connection ID: a QUIC Connection ID that is chosen by the target, and
is used in the Destination Connection ID field of packets from the client to
the target.<a href="#section-1.2-2.10" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="mappings">
<section id="section-2">
      <h2 id="name-required-proxy-state">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-required-proxy-state" class="section-name selfRef">Required Proxy State</a>
      </h2>
<p id="section-2-1">In the methods defined in this document, the proxy is aware of the QUIC
Connection IDs being used by proxied connections, along with the sockets
used to communicate with the client and the target. Tracking Connection IDs in
this way allows the proxy to reuse server-facing sockets for multiple
connections and support the forwarding mode of proxying.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">QUIC packets can be either tunnelled within an HTTP/3 proxy connection using
QUIC DATAGRAM frames <span>[<a href="#DGRAM" class="xref">DGRAM</a>]</span>, or be forwarded directly
alongside an HTTP/3 proxy connection on the same set of IP addresses and UDP
ports. The use of forwarded mode requires the consent of both the client and the
proxy.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">In order to correctly route QUIC packets in both tunnelled and forwarded modes,
the proxy needs to maintain mappings between several items. There are three
required unidirectional mappings, described below.<a href="#section-2-3" class="pilcrow">¶</a></p>
<div id="datagram-flow-id-mapping">
<section id="section-2.1">
        <h3 id="name-datagram-flow-id-mapping">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-datagram-flow-id-mapping" class="section-name selfRef">Datagram Flow ID Mapping</a>
        </h3>
<p id="section-2.1-1">Each pair of client &lt;-&gt; proxy QUIC connection and datagram flow ID MUST be
mapped to a single server-facing socket.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.1-2">
<pre>
(Client &lt;-&gt; Proxy QUIC connection + Datagram flow ID)
    =&gt; Server-facing socket
</pre><a href="#section-2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-2.1-3">Multiple datagram flow IDs can map to the same server-facing socket, but a
single datagram flow ID cannot be mapped to multiple server-facing sockets.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.1-4">This mapping guarantees that any QUIC packet using the datagram flow ID sent
from the client to the proxy in tunnelled mode can be sent to the correct
target.<a href="#section-2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="server-connection-id-mapping">
<section id="section-2.2">
        <h3 id="name-server-connection-id-mappin">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-server-connection-id-mappin" class="section-name selfRef">Server Connection ID Mapping</a>
        </h3>
<p id="section-2.2-1">Each pair of Server Connection ID and client-facing socket MUST map to a single
server-facing socket.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.2-2">
<pre>
(Client-facing socket + Server Connection ID)
    =&gt; Server-facing socket
</pre><a href="#section-2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-2.2-3">Multiple pairs of Connection IDs and sockets can map to the same server-facing
socket.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">This mapping guarantees that any QUIC packet containing the Server Connection ID
sent from the client to the proxy in forwarded mode can be sent to the correct
target. Thus, a proxy that does not allow forwarded mode does not need to
maintain this mapping.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-connection-id-mappings">
<section id="section-2.3">
        <h3 id="name-client-connection-id-mappin">
<a href="#section-2.3" class="section-number selfRef">2.3. </a><a href="#name-client-connection-id-mappin" class="section-name selfRef">Client Connection ID Mappings</a>
        </h3>
<p id="section-2.3-1">Each pair of Client Connection ID and server-facing socket MUST map to a single
datagram flow ID on a single client &lt;-&gt; proxy QUIC connection. Additionally, the
pair of Client Connection ID and server-facing socket MUST map to a single
client-facing socket.<a href="#section-2.3-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.3-2">
<pre>
(Server-facing socket + Client Connection ID)
    =&gt; (Client &lt;-&gt; Proxy QUIC connection + Datagram flow ID)
(Server-facing socket + Client Connection ID)
    =&gt; Client-facing socket
</pre><a href="#section-2.3-2" class="pilcrow">¶</a>
</div>
<p id="section-2.3-3">Multiple pairs of Connection IDs and sockets can map to the same datagram flow
ID or client-facing socket.<a href="#section-2.3-3" class="pilcrow">¶</a></p>
<p id="section-2.3-4">These mappings guarantee that any QUIC packet sent from a target to the proxy
can be sent to the correct client, in either tunnelled or forwarded mode. Note
that this mapping becomes trivial if the proxy always opens a new server-facing
socket for every client request with a unique datagram flow ID. The mapping is
critical for any case where server-facing sockets are shared or reused.<a href="#section-2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conflicts">
<section id="section-2.4">
        <h3 id="name-detecting-connection-id-con">
<a href="#section-2.4" class="section-number selfRef">2.4. </a><a href="#name-detecting-connection-id-con" class="section-name selfRef">Detecting Connection ID Conflicts</a>
        </h3>
<p id="section-2.4-1">In order to be able to route packets correctly in both tunnelled and forwarded
mode, proxies check for conflicts before creating a new mapping. If a conflict
is detected, the proxy will reject the client's request, as described in
<a href="#response" class="xref">Section 5</a>.<a href="#section-2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.4-2">Two sockets conflict if and only if all members of the 4-tuple (local IP
address, local UDP port, remote IP address, and remote UDP port) are identical.<a href="#section-2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.4-3">Two Connection IDs conflict if and only if one Connection ID is equal to or a
prefix of another. For example, a zero-length Connection ID conflicts with all
connection IDs. This definition of a conflict originates from the fact that
QUIC short headers do not carry the length of the Destination Connection ID
field, and therefore if two short headers with different Destination Connection
IDs are received on a shared socket, one being a prefix of the other prevents
the receiver from identifying which mapping this corresponds to.<a href="#section-2.4-3" class="pilcrow">¶</a></p>
<p id="section-2.4-4">The proxy treats two mappings as being in conflict when a conflict is detected
for all elements on the left side of the mapping diagrams above.<a href="#section-2.4-4" class="pilcrow">¶</a></p>
<p id="section-2.4-5">Since very short Connection IDs are more likely to lead to conflicts,
particularly zero-length Connection IDs, a proxy MAY choose to reject all
requests for very short Connection IDs as conflicts, in anticipation of future
conflicts. Note that a request that doesn't contain any Connection ID is
equivalent to a request for a zero-length Connection ID, and similarly would
cause conflicts when forwarding.<a href="#section-2.4-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="connection-id-headers-for-connect-udp">
<section id="section-3">
      <h2 id="name-connection-id-headers-for-c">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-connection-id-headers-for-c" class="section-name selfRef">Connection ID Headers for CONNECT-UDP</a>
      </h2>
<p id="section-3-1">This document defines two headers that can be used in CONNECT-UDP requests
and responses. All other requirements defined for CONNECT-UDP <span>[<a href="#CONNECT-UDP" class="xref">CONNECT-UDP</a>]</span>
still apply.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">Both "Client-Connection-Id" and "Server-Connection-Id" are Item Structured
Headers <span>[<a href="#STRUCT" class="xref">STRUCT</a>]</span>.  Their value MUST be a
Byte Sequence. The byte sequence MAY be zero-length. The byte sequence length
MUST NOT exceed 255 bytes. The ABNF is:<a href="#section-3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3-3">
<pre>
   Client-Connection-Id = sf-binary
   Server-Connection-Id = sf-binary
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">"Client-Connection-Id" contains the client connection ID, whereas
"Server-Connection-Id" contains the server connection ID.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">Like the Datagram-Flow-Id header <span>[<a href="#CONNECT-UDP" class="xref">CONNECT-UDP</a>]</span>, the Client-Connection-Id and
Server-Connection-Id headers can only be supported by an HTTP/3 proxy. If a
proxy does not support HTTP/3 datagrams <span>[<a href="#H3DGRAM" class="xref">H3DGRAM</a>]</span>, or it does not support the
extension defined in this document, it MUST NOT send the Client-Connection-Id
and Server-Connection-Id headers on any responses. If a proxy does support this
extension, it MUST echo the Client-Connection-Id and Server-Connection-Id
headers on any 2xx (Successful) responses. Clients that do not receive an echoed
Client-Connection-Id or Server-Connection-Id header MUST fall back to using
CONNECT-UDP without the extended behavior defined in this document.<a href="#section-3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="request">
<section id="section-4">
      <h2 id="name-client-request-behavior">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-client-request-behavior" class="section-name selfRef">Client Request Behavior</a>
      </h2>
<p id="section-4-1">A client sends new CONNECT-UDP requests when it wants to start
a new QUIC connection to a target, when it has received a new
Server Connection ID for the target, and before it advertises a new Client
Connection ID to the target.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">Each request MUST contain a Datagram-Flow-Id header and an authority
pseudo-header identifying the target. All requests for the same QUIC
Connection between a client and a target MUST contain the same authority,
and SHOULD contain the same Datagram-Flow-Id. If there is Datagram-Flow-Id
mismatch, the proxy will treat the requests as different proxied connections,
which could appear as a migration or NAT rebinding event to the target.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">Each request MUST also contain exactly one connection ID header, either
Client-Connection-Id or Server-Connection-Id. Client-Connection-Id requests
define paths for receiving packets from the target server to the client, and
Server-Connection-Id requests define paths for sending packets from the client
to target server.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="new-proxied-connection-setup">
<section id="section-4.1">
        <h3 id="name-new-proxied-connection-setu">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-new-proxied-connection-setu" class="section-name selfRef">New Proxied Connection Setup</a>
        </h3>
<p id="section-4.1-1">The first time that a client uses a proxy for a given QUIC connection, it
selects a new datagram flow ID with an even-numbered value <span>[<a href="#H3DGRAM" class="xref">H3DGRAM</a>]</span>.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The first request the clients makes MUST contain the authority pseudo-header,
the Datagram-Flow-Id header, and the Client-Connection-Id header. These
respectively contain the authority of the target, the selected datagram
flow ID and the Client Connection ID that will be used in the initial QUIC
packets sent through the proxy.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The client can start sending packets tunnelled within DATAGRAM frames as soon as
this first CONNECT-UDP request for the datagram flow ID has been sent, even in
the same QUIC packet to the proxy. That is, the QUIC packet sent from the client
to the proxy MAY contain a STREAM frame containing the CONNECT-UDP request, as
well as a DATAGRAM frame that contains a tunnelled QUIC packet to send to the
target. This is particularly useful for reducing round trips on connection
setup.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<p id="section-4.1-4">Since clients are always aware whether or not they are using a QUIC proxy,
clients are expected to cooperate with proxies in selecting Client Connection
IDs. A proxy detects a conflict when it is not able to create a unique mapping
using the Client Connection ID (<a href="#conflicts" class="xref">Section 2.4</a>). It can reject requests that
would cause a conflict and indicate this to the client by replying with a 409
(Conflict) status. In order to avoid conflicts, clients SHOULD select Client
Connection IDs of at least 8 bytes in length with unpredictable values. A client
also SHOULD NOT select a Client Connection ID that matches the ID used for the
QUIC connection to the proxy, as this inherently creates a conflict.<a href="#section-4.1-4" class="pilcrow">¶</a></p>
<p id="section-4.1-5">Note that packets sent in DATAGRAM frames before the proxy has sent its
CONNECT-UDP response might be dropped if the proxy rejects the request.
Specifically, this can occur if the Client Connection ID causes a conflict and
the proxy returns a 409 (Conflict) error. Any DATAGRAM frames that are sent in a
separate QUIC packet from the STREAM frame that contains the CONNECT-UDP request
might also be dropped in the case that the packet arrives at the proxy before
the packet containing the STREAM frame.<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">If the server rejects the first request that uses a specific datagram flow ID,
the client MUST retire that datagram flow ID. If the rejection indicated a
conflict due to the Client Connection ID, the client MUST select a new
Connection ID before sending a new request, and generate a new packet. For
example, if a client is sending a QUIC Initial packet and chooses a Connection
ID that conflicts with an existing mapping to the same target server, it will
need to generate a new QUIC Initial.<a href="#section-4.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="adding-new-client-connection-ids">
<section id="section-4.2">
        <h3 id="name-adding-new-client-connectio">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-adding-new-client-connectio" class="section-name selfRef">Adding New Client Connection IDs</a>
        </h3>
<p id="section-4.2-1">Since QUIC connection IDs are chosen by the receiver, an endpoint needs to
communicate its chosen connection IDs to its peer before the peer can start
using them. In QUICv1, this is performed using the NEW_CONNECTION_ID frame.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Prior to informing the target of a new chosen client connection ID, the client
MUST send a CONNECT-UDP request with the Client-Connection-Id header to the
proxy, and only inform the target of the new client connection ID once a 2xx
(Successful) response is received.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sending-with-forwarded-mode">
<section id="section-4.3">
        <h3 id="name-sending-with-forwarded-mode">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-sending-with-forwarded-mode" class="section-name selfRef">Sending With Forwarded Mode</a>
        </h3>
<p id="section-4.3-1">Once the client has learned the target server's Connection ID, such as in the
response to a QUIC Initial packet, it can send a request containing the
Server-Connection-Id header to request the ability to forward packets. The
client MUST wait for a successful (2xx) response before using forwarded mode.
Prior to receiving the server response, the client MUST send short header
packets tunnelled in DATAGRAM frames. The client MAY also choose to tunnel some
short header packets even after receiving the successful response.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">If the client's request that included the Server-Connection-Id is rejected, for
example with a 409 (Conflict) response, it MUST NOT forward packets to the
requested Server Connection ID, but only use tunnelled mode. The request might
also be rejected if the proxy does not support forwarded mode or has it disabled
by policy. For any response code other than a 2xx success, the client MUST NOT
retry a request for the same Server Connection ID. For errors other than 409
(Conflict), clients SHOULD stop sending requests for other Server Connection IDs
in the future.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">QUIC long header packets MUST NOT be forwarded. These packets can only be
tunnelled within DATAGRAM frames to avoid exposing unnecessary connection
metadata.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">When forwarding, the client sends a QUIC packet with the target server's
Connection ID in the QUIC short header, using the same socket between client and
proxy that was used for the main QUIC connection between client and proxy.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="receiving-with-forwarded-mode">
<section id="section-4.4">
        <h3 id="name-receiving-with-forwarded-mo">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-receiving-with-forwarded-mo" class="section-name selfRef">Receiving With Forwarded Mode</a>
        </h3>
<p id="section-4.4-1">A proxy MUST NOT forward packets from the target to the client until after the
client has sent at least one packet in forwarded mode. Once this occurs, the
proxy MAY use forwarded mode for any Client Connection ID for which it has a
valid mapping.<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<p id="section-4.4-2">If a client has started using forwarding mode, it MUST be prepared to receive
forwarded short header packets on the socket between itself and the proxy for
any Client Connection ID that has been accepted by the proxy. The client uses
the received Connection ID to determine if a packet was originated by the
proxy, or merely forwarded from the target.<a href="#section-4.4-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="opting-out-of-forwarded-mode">
<section id="section-4.5">
        <h3 id="name-opting-out-of-forwarded-mod">
<a href="#section-4.5" class="section-number selfRef">4.5. </a><a href="#name-opting-out-of-forwarded-mod" class="section-name selfRef">Opting Out of Forwarded Mode</a>
        </h3>
<p id="section-4.5-1">The use of forwarded mode is initiated by the client sending a request with the
Server-Connection-Id header and sending at least one forwarded packet to the
proxy. A client that does not wish to accept forwarded packets from the proxy
when communicating with a specific target can simply not start forwarding
packets to the proxy.<a href="#section-4.5-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="response">
<section id="section-5">
      <h2 id="name-proxy-response-behavior">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-proxy-response-behavior" class="section-name selfRef">Proxy Response Behavior</a>
      </h2>
<p id="section-5-1">Upon receipt of a CONNECT-UDP request that contains a Client-Connection-Id or
Server-Connection-Id header, the proxy validates the request, tries to
establish the appropriate mappings as described in <a href="#mappings" class="xref">Section 2</a>, and
establishes a new server-facing socket if necessary.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The proxy MUST validate that the request only contains one of either the
Client-Connection-Id or the Server-Connection-Id header, along with a
Datagram-Flow-Id header and an authority pseudo-header. If any of these
conditions is not met, the proxy MUST reject the request with a 400 (Bad
Request) response. The proxy also MUST reject the request if the requested
datagram flow ID has already been used on that client &lt;-&gt; proxy QUIC connection
with a different requested authority.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3">The proxy then determines the server-facing socket to associate with the
client's datagram flow. This will generally involve performing a DNS lookup for
the hostname in the request authority, or finding an existing server-facing
socket to the authority. The server-facing socket might already be open due to a
previous request from this client, or another. If the socket is not already
created, the proxy creates a new one. Proxies can choose to reuse server-facing
sockets across multiple datagram flows, or have a unique server-facing socket
for every datagram flow.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">If a proxy reuses server-facing sockets, it SHOULD store which authorities
(which could be a domain name or IP address literal) are being accessed over a
particular server-facing socket so it can avoid performing a new DNS query and
potentially choosing a different server IP address which could map to a
different server.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5">Server-facing sockets MUST NOT be reused across QUIC and non-QUIC CONNECT-UDP
requests, since it might not be possible to correctly demultiplex or direct
the traffic. Any packets received on a server-facing socket used for proxying
QUIC that does not correspond to a known Connection ID MUST be dropped.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6">If the request includes a Client-Connection-Id header, the proxy is receiving a
request to be able to route traffic back to the client using that Connection ID.
If the pair of this Client Connection ID and the selected server-facing socket
does not create a conflict, the proxy creates the mapping and responds with a
200 (OK) response. After this point, any packets received by the proxy from the
server-facing socket that match the Client Connection ID can to be sent to the
client. The proxy MUST use tunnelled mode (DATAGRAM frames) on the correct
datagram flow for any long header packets. The proxy SHOULD forward directly to
the client for any matching short header packets, but MAY tunnel them in
DATAGRAM frames. If the pair is not unique, or the proxy chooses not to support
zero-length Client Connection IDs, the proxy responds with a 409 (Conflict)
response. If this occurs on the first request for a given datagram flow, the
proxy removes any mapping for that datagram flow.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7">If the request includes a Server-Connection-Id header, the proxy is receiving a
request to allow the client to forward packets to the target. If the pair of
this Server Connection ID and the client-facing socket on which the request was
received does not create a conflict, the proxy creates the mapping and responds
with a 200 (OK) response. Once the successful response is sent, the proxy will
forward any short header packets received on the client-facing socket that use
the Server Connection ID using the correct server-facing socket. If the pair is
not unique, the server responds with a 409 (Conflict) response. If this occurs,
traffic for that Server Connection ID can only use tunnelled mode, not
forwarded.<a href="#section-5-7" class="pilcrow">¶</a></p>
<p id="section-5-8">If the proxy does not support forwarded mode, or does not allow forwarded mode
for a particular client or authority by policy, it can reject requests that
include the Server-Connection-Id header with a response to indicate the error,
such as 403 (Forbidden).<a href="#section-5-8" class="pilcrow">¶</a></p>
<p id="section-5-9">Any successful (2xx) response MUST also echo any Client-Connection-Id,
Server-Connection-Id, and Datagram-Flow-Id headers included in the request.<a href="#section-5-9" class="pilcrow">¶</a></p>
<p id="section-5-10">The proxy MUST only forward non-tunnelled packets from the client that are QUIC
short header packets (based on the Header Form bit) and have mapped Server
Connection IDs. Packets sent by the client that are forwarded SHOULD be
considered as activity for restarting QUIC's Idle Timeout <span>[<a href="#QUIC" class="xref">QUIC</a>]</span>.<a href="#section-5-10" class="pilcrow">¶</a></p>
<div id="removing-mapping-state">
<section id="section-5.1">
        <h3 id="name-removing-mapping-state">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-removing-mapping-state" class="section-name selfRef">Removing Mapping State</a>
        </h3>
<p id="section-5.1-1">Each CONNECT-UDP request consumes one bidirectional HTTP/3 stream <span>[<a href="#HTTP3" class="xref">HTTP3</a>]</span>.
For any stream on which the proxy has sent a response indicating success, any
mappings for the request last as long as the stream is open.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">A client that no longer wants a given Connection ID to be forwarded by the
proxy, for either direction, MUST cancel its CONNECT-UDP HTTP/3 request by
closing the corresponding stream.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<p id="section-5.1-3">If the proxy rejects a CONNECT-UDP request by sending a status code of 300 or
higher, it MUST close the corresponding stream and remove any associated
mappings.<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1-4">If a client's connection to the proxy is terminated for any reason, all
mappings associated with all requests are removed.<a href="#section-5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1-5">A proxy can close its server-facing socket once all datagram flows mapped to
that socket have been removed.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-connection-migration">
<section id="section-5.2">
        <h3 id="name-handling-connection-migrati">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-handling-connection-migrati" class="section-name selfRef">Handling Connection Migration</a>
        </h3>
<p id="section-5.2-1">If a proxy supports QUIC connection migration, it needs to ensure that a migration
event does not end up sending too many tunnelled or proxied packets on a new
path prior to path validation.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Specifically, the proxy MUST limit the number of packets that it will proxy
to an unvalidated client address to the size of an initial congestion window.
Proxies additionally SHOULD pace the rate at which packets are sent over a new
path to avoid creating unintentional congestion on the new path.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="example">
<section id="section-6">
      <h2 id="name-example">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-example" class="section-name selfRef">Example</a>
      </h2>
<p id="section-6-1">Consider a client that is establishing a new QUIC connection through the proxy.
It has selected a Client Connection ID of 0x31323334. It selects the next open
datagram flow ID (2). In order to inform a proxy of the new QUIC Client
Connection ID, and binds that connection ID to datagram flow ID 2, the client
sends the following CONNECT-UDP request:<a href="#section-6-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6-2">
<pre>
HEADERS
:method = CONNECT-UDP
:authority = target.example.com:443
client-connection-id = :MTIzNA==:
datagram-flow-id = 2
</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
<p id="section-6-3">The client will also send the initial QUIC packet with the Long Header form in
a DATAGRAM frame with flow ID 2.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">Once the proxy sends a 200 response indicating success, packets received by the
proxy that match the Connection ID 0x31323334 will be directly forwarded to the
client. The proxy will also forward the initial QUIC packet received on DATAGRAM
flow ID 2 to target.example.com:443.<a href="#section-6-4" class="pilcrow">¶</a></p>
<p id="section-6-5">When the proxy receives a response from target.example.com:443 that has
0x31323334 as the Destination Connection ID, the proxy will forward that packet
to the client on DATAGRAM flow ID 2.<a href="#section-6-5" class="pilcrow">¶</a></p>
<p id="section-6-6">Once the client learns which Connection ID has been selected by the target
server, it can send a new request to the proxy to establish a mapping. In this
case, that ID is 0x61626364. The client sends the following request:<a href="#section-6-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-6-7">
<pre>
HEADERS
:method = CONNECT-UDP
:authority = target.example.com:443
server-connection-id = :YWJjZA==:
datagram-flow-id = 2
</pre><a href="#section-6-7" class="pilcrow">¶</a>
</div>
<p id="section-6-8">The client also sends its reply to the target server in a DATAGRAM frame on flow
ID 2 after sending the new request.<a href="#section-6-8" class="pilcrow">¶</a></p>
<p id="section-6-9">Once the proxy sends a 200 response indicating success, packets sent by the
client that match the Connection ID 0x61626364 will be forwarded to the target
server, i.e., without proxy decryption.<a href="#section-6-9" class="pilcrow">¶</a></p>
<p id="section-6-10">Upon receiving the response, the client starts sending Short Header packets with
a Destination Connection ID of 0x61626364 directly to the proxy (not tunnelled),
and these are forwarded directly to the target by the proxy. Similarly, Short
Header packets from the target with a Destination Connection ID of 0x31323334
are forwarded directly to the client.<a href="#section-6-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="interactions-with-load-balancers">
<section id="section-7">
      <h2 id="name-interactions-with-load-bala">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-interactions-with-load-bala" class="section-name selfRef">Interactions with Load Balancers</a>
      </h2>
<p id="section-7-1">Some QUIC servers are accessed using load balancers, as described in
<span>[<a href="#QUIC-LB" class="xref">QUIC-LB</a>]</span>. These load balancers route packets to
servers based on the server's Connection ID. These Connection IDs are generated
in a way that can be coordinated between servers and their load balancers.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">If a proxy that supports this extension is itself running behind a load
balancer, extra complexity arises once clients start using forwarding mode and
sending packets to the proxy that have Destination Connection IDs that belong to
the end servers, not the proxy. If the load balancer is not aware of these
Connection IDs, or the Connection IDs conflict with other Connection IDs used by
the load balancer, packets can be routed incorrectly.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">QUIC-aware CONNECT-UDP proxies that use forwarding mode generally SHOULD NOT be
run behind load balancers; and if they are, they MUST coordinate between the
proxy and the load balancer to create mappings for proxied Connection IDs prior
to the proxy sending 2xx (Successful) responses to clients.<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">QUIC-aware CONNECT-UDP proxies that do not allow forwarding mode can function
unmodified behind QUIC load balancers.<a href="#section-7-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="packet-size-considerations">
<section id="section-8">
      <h2 id="name-packet-size-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-packet-size-considerations" class="section-name selfRef">Packet Size Considerations</a>
      </h2>
<p id="section-8-1">Since Initial QUIC packets must be at least 1200 bytes in length, the DATAGRAM
frames that are used for a QUIC-aware CONNECT-UDP proxy MUST be able to carry
at least 1200 bytes.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Additionally, clients that connect to a proxy for purpose of proxying QUIC
SHOULD start their connection with a larger packet size than 1200 bytes, to
account for the overhead of tunnelling an Initial QUIC packet within a
DATAGRAM frame. If the client does not begin with a larger packet size than
1200 bytes, it will need to perform Path MTU (Maximum Transmission Unit)
discovery to discover a larger path size prior to sending any tunnelled Initial
QUIC packets.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">Once a proxied QUIC connections moves into forwarded mode, the client SHOULD
initiate Path MTU discovery to increase its end-to-end MTU.<a href="#section-8-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1">Proxies that support this extension SHOULD provide protections to rate-limit
or restrict clients from opening an excessive number of proxied connections, so
as to limit abuse or use of proxies to launch Denial-of-Service attacks.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Sending QUIC packets by forwarding through a proxy without tunnelling exposes
some QUIC header metadata to onlookers, and can be used to correlate packets
flows if an attacker is able to see traffic on both sides of the proxy.
Tunnelled packets have similar inference problems. An attacker on both sides
of the proxy can use the size of ingress and egress packets to correlate packets
belonging to the same connection. (Absent client-side padding, tunneled packets
will typically have a fixed amount of overhead that is removed before their
DATAGRAM contents are written to the target.)<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">Since proxies that forward QUIC packets do not perform any cryptographic
integrity check, it is possible that these packets are either malformed,
replays, or otherwise malicious. This may result in proxy targets rate limiting
or decreasing the reputation of a given proxy.<a href="#section-9-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="iana-header">
<section id="section-10.1">
        <h3 id="name-http-headers">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-http-headers" class="section-name selfRef">HTTP Headers</a>
        </h3>
<p id="section-10.1-1">This document registers the "Client-Connection-Id" and "Server-Connection-Id"
headers in the "Permanent Message Header Field Names"
&lt;<span><a href="https://www.iana.org/assignments/message-headers">https://www.iana.org/assignments/message-headers</a></span>&gt;.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-10.1-2">
<pre>
  +----------------------+----------+--------+---------------+
  | Header Field Name    | Protocol | Status |   Reference   |
  +----------------------+----------+--------+---------------+
  | Client-Connection-Id |   http   |  exp   | This document |
  +----------------------+----------+--------+---------------+
  | Server-Connection-Id |   http   |  exp   | This document |
  +----------------------+----------+--------+---------------+
</pre><a href="#section-10.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="CONNECT-UDP">[CONNECT-UDP]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"The CONNECT-UDP HTTP Method"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-masque-connect-udp-03</span>, <time datetime="2021-01-05" class="refDate">5 January 2021</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-masque-connect-udp-03.txt">http://www.ietf.org/internet-drafts/draft-ietf-masque-connect-udp-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="DGRAM">[DGRAM]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span><span class="refAuthor">, Kinnear, E.</span><span class="refAuthor">, and D. Schinazi</span>, <span class="refTitle">"An Unreliable Datagram Extension to QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-datagram-01</span>, <time datetime="2020-08-24" class="refDate">24 August 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-quic-datagram-01.txt">http://www.ietf.org/internet-drafts/draft-ietf-quic-datagram-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="H3DGRAM">[H3DGRAM]</dt>
        <dd>
<span class="refAuthor">Schinazi, D.</span>, <span class="refTitle">"Using QUIC Datagrams with HTTP/3"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-schinazi-quic-h3-datagram-05</span>, <time datetime="2020-10-12" class="refDate">12 October 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-schinazi-quic-h3-datagram-05.txt">http://www.ietf.org/internet-drafts/draft-schinazi-quic-h3-datagram-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP3">[HTTP3]</dt>
        <dd>
<span class="refAuthor">Bishop, M.</span>, <span class="refTitle">"Hypertext Transfer Protocol Version 3 (HTTP/3)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-http-33</span>, <time datetime="2020-12-15" class="refDate">15 December 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-quic-http-33.txt">http://www.ietf.org/internet-drafts/draft-ietf-quic-http-33.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="INVARIANTS">[INVARIANTS]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span>, <span class="refTitle">"Version-Independent Properties of QUIC"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-invariants-13</span>, <time datetime="2021-01-14" class="refDate">14 January 2021</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-quic-invariants-13.txt">http://www.ietf.org/internet-drafts/draft-ietf-quic-invariants-13.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="QUIC">[QUIC]</dt>
        <dd>
<span class="refAuthor">Iyengar, J.</span><span class="refAuthor"> and M. Thomson</span>, <span class="refTitle">"QUIC: A UDP-Based Multiplexed and Secure Transport"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-transport-34</span>, <time datetime="2021-01-14" class="refDate">14 January 2021</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-quic-transport-34.txt">http://www.ietf.org/internet-drafts/draft-ietf-quic-transport-34.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="STRUCT">[STRUCT]</dt>
      <dd>
<span class="refAuthor">Nottingham, M.</span><span class="refAuthor"> and P. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-httpbis-header-structure-19</span>, <time datetime="2020-06-03" class="refDate">3 June 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-19.txt">http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-19.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="QUIC-LB">[QUIC-LB]</dt>
      <dd>
<span class="refAuthor">Duke, M.</span><span class="refAuthor"> and N. Banks</span>, <span class="refTitle">"QUIC-LB: Generating Routable QUIC Connection IDs"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-quic-load-balancers-05</span>, <time datetime="2020-10-30" class="refDate">30 October 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-quic-load-balancers-05.txt">http://www.ietf.org/internet-drafts/draft-ietf-quic-load-balancers-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">Thanks to Lucas Pardue, Ryan Hamilton, and Mirja Kuehlewind for their inputs
on this document.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tommy Pauly</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tpauly@apple.com" class="email">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">David Schinazi</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div dir="auto" class="left"><span class="street-address">1600 Amphitheatre Parkway</span></div>
<div dir="auto" class="left">
<span class="locality">Mountain View, California 94043</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:dschinazi.ietf@gmail.com" class="email">dschinazi.ietf@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
