<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Multicast using Multicast Routing Header</title>
<meta content="Huaimo Chen" name="author">
<meta content="Mike McBride" name="author">
<meta content="Yanhe Fan" name="author">
<meta content="Zhenbin Li" name="author">
<meta content="Xuesong Geng" name="author">
<meta content="Mehmet Toy" name="author">
<meta content="Gyan S. Mishra" name="author">
<meta content="Yisong Liu" name="author">
<meta content="Aijun Wang" name="author">
<meta content="Lei Liu" name="author">
<meta content="Xufeng Liu" name="author">
<meta content="
       This document describes an efficient solution for 
         multicast along an explicit P2MP Path/Tree using 
         an IPv6 extension header called
         multicast routing header (MRH). 
         The MRH with the path encoded in link numbers
         is added into a packet to be multicast at the ingress. 
         The packet is delivered to the egresses along the path.
         There is no state stored in the core of the network. 
       
    " name="description">
<meta content="xml2rfc 3.12.3" name="generator">
<meta content="draft-chen-pim-mrh6-01" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.3
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.8.0
    MarkupSafe 2.0.1
    pycountry 22.1.10
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.27.1
    setuptools 59.6.0
    six 1.16.0
    WeasyPrint 52.5
-->
<link href="/tmp/draft-chen-pim-mrh6-nb-01-p1v3b004.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Multicast using MRH</td>
<td class="right">March 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Chen, et al.</td>
<td class="center">Expires 8 September 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-chen-pim-mrh6-01</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-03-07" class="published">7 March 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-09-08">8 September 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">H. Chen</div>
<div class="org">Futurewei</div>
</div>
<div class="author">
      <div class="author-name">M. McBride</div>
<div class="org">Futurewei</div>
</div>
<div class="author">
      <div class="author-name">Y. Fan</div>
<div class="org">Casa Systems</div>
</div>
<div class="author">
      <div class="author-name">Z. Li</div>
<div class="org">Huawei</div>
</div>
<div class="author">
      <div class="author-name">X. Geng</div>
<div class="org">Huawei</div>
</div>
<div class="author">
      <div class="author-name">M. Toy</div>
<div class="org">Verizon</div>
</div>
<div class="author">
      <div class="author-name">G. Mishra</div>
<div class="org">Verizon</div>
</div>
<div class="author">
      <div class="author-name">Y. Liu</div>
<div class="org">China Mobile</div>
</div>
<div class="author">
      <div class="author-name">A. Wang</div>
<div class="org">China Telecom</div>
</div>
<div class="author">
      <div class="author-name">L. Liu</div>
<div class="org">Fujitsu</div>
</div>
<div class="author">
      <div class="author-name">X. Liu</div>
<div class="org">Volta Networks</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Multicast using Multicast Routing Header</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes an efficient solution for 
         multicast along an explicit P2MP Path/Tree using 
         an IPv6 extension header called
         multicast routing header (MRH). 
         The MRH with the path encoded in link numbers
         is added into a packet to be multicast at the ingress. 
         The packet is delivered to the egresses along the path.
         There is no state stored in the core of the network.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2"></p>
</section>
<section class="note" id="section-note.1">
      <h2 id="name-requirements-language-3">
<a href="#name-requirements-language-3" class="section-name selfRef">Requirements Language</a>
      </h2>
<p id="section-note.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span>
      when, and only when, they appear in all
      capitals, as shown here.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-7">
<a href="#name-status-of-this-memo-7" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 8 September 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-7">
<a href="#name-copyright-notice-7" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-7">
<a href="#name-table-of-contents-7" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-6" class="xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-overview-of-multicast-using" class="xref">Overview of Multicast using MRH</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1" class="keepWithNext"><a href="#section-3" class="xref">3</a>.  <a href="#name-encoding-of-p2mp-path-tree" class="xref">Encoding of P2MP Path/Tree</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-multicast-routing-header-mr" class="xref">Multicast Routing Header (MRH)</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-procedures-behaviors" class="xref">Procedures/Behaviors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-procedure-behavior-on-ingre" class="xref">Procedure/Behavior on Ingress Node</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-procedure-behavior-on-trans" class="xref">Procedure/Behavior on Transit Node</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-procedure-behavior-on-egres" class="xref">Procedure/Behavior on Egress Node</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations-7" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-security-considerations-7" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-acknowledgements-5" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references-5" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references-6" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references-6" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses-7" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction-6">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-6" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1"><span>[<a href="#I-D.ietf-pim-sr-p2mp-policy" class="xref">I-D.ietf-pim-sr-p2mp-policy</a>]</span> proposes a 
        solution for a SR P2MP path.       
        A multicast P2MP tree is created for the path and the state 
        of the tree
        is instantiated in the forwarding plane by a controller at
        Root, intermediate Replication nodes and Leaves of the tree.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"><span>[<a href="#I-D.chen-pim-srv6-p2mp-path" class="xref">I-D.chen-pim-srv6-p2mp-path</a>]</span> proposes a 
        stateless solution for a SR P2MP path. 
        The overhead for encoding the P2MP path using SIDs in SRH 
        may be large.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This document describes an efficient solution for 
         multicast along an explicit P2MP Path/Tree using 
         an IPv6 extension header called
         multicast routing header (MRH). 
         The MRH with the path encoded in link numbers
         is added into a packet to be multicast at the ingress. 
         The packet is delivered to the egresses along the path.
         There is no state stored in the core of the network.<a href="#section-1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-2">
      <h2 id="name-overview-of-multicast-using">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-overview-of-multicast-using" class="section-name selfRef">Overview of Multicast using MRH</a>
      </h2>
<p id="section-2-1"><a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
        shows an example network having nodes 
        P1, P2, P3, P4, PE1 to PE10. 
        For each of the links connected to a node, 
        a number called local link number (or link number for short)
        is assigned to it. 
        For example, PE1 has three links: link from PE1 to CE1, 
        link from PE1 to P1, and link from PE1 to PE10. 
        These three links have link numbers 1, 2 and 3 
        respectively on PE1. 
        P1 has five links: P1 to PE1, P1 to P2, P1 to P3, P1 to PE8 
        and P1 to PE9. 
        These five links have link numbers 1, 2, 3, 4 and 5 
        respectively on P1. 
        P3 has two links: P3 to P1 and P3 to P4. 
        These two links have link numbers 1 and 2 respectively 
        on P3.<a href="#section-2-1" class="pilcrow">¶</a></p>
<span id="name-network-with-p2mp-path-from"></span><div id="p2mp-path-R-L14">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-2-2.1">
<pre>
                            [PE2]            PE1: Ingress/Root
                           1/                PEi(i=2,3,..,,9): Egress
                           /                 Pi: Transit Node
                         1/      1
                        [P2]------[PE3]
                       3/    2
                       /
        1      2   1  /2      1
[CE1].....[PE1]------[P1]------[P3]     [PE4]
           3:     5/ 4\   3    2\      1/
            :     /    \         \     /
           1:   1/     1\        1\  2/    1
         [PE10] [PE9]   [PE8]     [P4]------[PE5]
                                 5/ 4\  3
                                 /    \
                               1/     1\
                              [PE7]    [PE6]
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-network-with-p2mp-path-from" class="selfRef">Network with P2MP Path from ingress PE1 to  egresses PE2, PE3, ..., PE9</a>
        </figcaption></figure>
</div>
<p id="section-2-3">P2MP path from ingress PE1 via P1 towards egresses PE2 to PE9
       in <a href="#p2mp-path-R-L14" class="xref">Figure 1</a> is represented 
       by the link numbers along the path: 
       PE1's link number 2; P1's link numbers 2, 3, 4 and 5; 
       P2's link numbers 1 and 2; P3's link number 2; and 
       P4's link numbers 2, 3, 4 and 5.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">After receiving a packet from traffic source CE1, 
       ingress PE1 encapsulates the packet in a MRH with 
       a P2MP path represented by the link numbers along the path. 
       The packet in the MRH is transmitted along the path to 
       the egresses of the path.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">When a node such as P1 receives a packet with the MRH, 
       the node gets/pops each of its link numbers, 
       finds the address of the next hop from a neighbor address table 
       using the link number (i.e., the link number such as 3 of 
       the link from the node to the next hop such as P3), 
       sends the packet to the next hop (such as P3).<a href="#section-2-5" class="pilcrow">¶</a></p>
<p id="section-2-6"><a href="#p1-neighbor-table" class="xref">Figure 2</a> 
       shows the neighbor IPv6 address table of P1. 
       The table comprises five rows of link number, 
       link type and IPv6 address for the five links of P1. 
       The first row comprises link number 1, link type P2P 
       for link from P1 to next hop PE1 and PE1's IPv6 address. 
       The 2nd row comprises link number 2, link type P2P 
       for link from P1 to next hop P2 and P2's IPv6 address. 
       The 3rd row comprises link number 3, link type P2P 
       for link from P1 to next hop P3 and P3's IPv6 address.
       The 4-th row comprises link number 4, link type P2P 
       for link from P1 to next hop PE8 and PE8's IPv6 address.
       The 5-th row comprises link number 5, link type P2P 
       for link from P1 to next hop PE9 and PE9's IPv6 address.<a href="#section-2-6" class="pilcrow">¶</a></p>
<span id="name-neighbor-ipv6-address-table"></span><div id="p1-neighbor-table">
<figure id="figure-2">
        <div class="alignCenter art-text artwork" id="section-2-7.1">
<pre>
+==============+============+======================+
| Link number  | Link type  | Address of next hop  |
+==============+============+======================+
|      1       |    P2P     | IPv6 address of PE1  |
+--------------+------------+----------------------+
|      2       |    P2P     | IPv6 address of P2   |
+--------------+------------+----------------------+
|      3       |    P2P     | IPv6 address of P3   |
+--------------+------------+----------------------+
|      4       |    P2P     | IPv6 address of PE8  |
+--------------+------------+----------------------+
|      5       |    P2P     | IPv6 address of PE9  |
+==============+============+======================+</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-neighbor-ipv6-address-table" class="selfRef">Neighbor IPv6 address table of P1</a>
        </figcaption></figure>
</div>
<p id="section-2-8">Using link number 1, 
      P1 gets PE1's IPv6 address from the table; 
      using link number 2, P1 gets P2's IPv6 address from the table; 
      using link number 3, P1 gets P3's IPv6 address from the table; 
      and so on.<a href="#section-2-8" class="pilcrow">¶</a></p>
</section>
<section id="section-3">
      <h2 id="name-encoding-of-p2mp-path-tree">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-encoding-of-p2mp-path-tree" class="section-name selfRef">Encoding of P2MP Path/Tree</a>
      </h2>
<p id="section-3-1"><a href="#srh-p2mp-p1-2-l1-4" class="xref">Figure 3</a> 
         shows the encoding of the P2MP path/tree in 
         <a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
         from PE1 via P1 to PE2, PE3, ..., PE9. 
         Each link on the tree is encoded or represented by 
         the link number of the link. 

         For example, the link from PE1 to P1 on the tree is 
         encoded by link number 2 of the link on PE1. 
         The link from P1 to P2 on the tree is encoded 
         by link number 2 of the link on P1. 
         The link from P1 to P3 on the tree is encoded 
         by link number 3 of the link on P1.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">For each link from its upstream node to its downstream 
(or say next hop) node on the tree, three fields are used for the 
link: 
1). link number (Link-No for short) field for storing the link number, 
2). number of branches (N-Branches for short) for
storing the number branches/sub-trees of the tree from the next hop 
node, and 3). size of branches+ (S-Branches+ for short) for 
storing the size of branches of the tree from the next hop node and 
the fields following. The size is in bits, bytes, or other units.<a href="#section-3-2" class="pilcrow">¶</a></p>
<span id="name-encoding-of-tree-from-pe1-v"></span><div id="srh-p2mp-p1-2-l1-4">
<figure id="figure-3">
        <div class="alignCenter art-text artwork" id="section-3-3.1">
<pre>
     +=======+==========+===========+
size |Link-No|N-Branches|S-Branches+|  link
     +=======+==========+===========+                     -+
 24  |   2   |    4     |    22     | PE1 to P1            |
     +-------+----------+-----------+                      |sub-tree
 22  |   2   |    2     |    14     | P1 to P2             |from PE1
     +-------+----------+-----------+                      |to P1
 20  |   3   |    1     |    10     | P1 to P3             |to PE2-PE9
     +-------+----------+-----------+                      |
 18  |   4   |    0     |    0      | P1 to PE8            |
     +-------+----------+-----------+                      |
 16  |   5   |    0     |    0      | P1 to PE9            |
     +-------+----------+-----------+          -+          |
 14  |   1   |    0     |    0      | P2 to PE2 |sub-trees |
     +-------+----------+-----------+           |from P2   |
 12  |   2   |    0     |    0      | P2 to PE3 |          |
     +-------+----------+-----------+          -+          |
 10  |   2   |    4     |    8      | P3 to P4  |          |
     +-------+----------+-----------+           |sub-tree  |
  8  |   2   |    0     |    0      | P4 to PE4 |from P3   |
     +-------+----------+-----------+           |          |
  6  |   3   |    0     |    0      | P4 to PE5 |          |
     +-------+----------+-----------+           |          |
  4  |   4   |    0     |    0      | P4 to PE6 |          |
     +-------+----------+-----------+           |          |
  2  |   5   |    0     |    0      | P4 to PE7 |          |
     +-------+----------+-----------+          -+         -+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-encoding-of-tree-from-pe1-v" class="selfRef">Encoding of tree from PE1 via P1         to PE2, PE3, ..., PE9</a>
        </figcaption></figure>
</div>
<p id="section-3-4">For example, for the link from PE1 to P1 on the tree, 
Link-No field has value of 2 since the link number is 2 for the link on PE1;
N-Branches field has value of 4 since there are 4 branches from P1; 
S-Branches+ field has value of 22 (bytes) since 22 bytes are used 
for storing/encoding 4 branches from P1 when the three fields Link-No, 
N-Branches and S-Branches+ for a link 
occupy 2 bytes in total.<a href="#section-3-4" class="pilcrow">¶</a></p>
<p id="section-3-5">For the link from P1 to P2 on the tree, 
Link-No field has value of 2 since the link number is 2 for the link on P1;
N-Branches field has value of 2 since there are two branches from P2; 
S-Branches+ field has value of 14 (bytes) since 14 bytes are used 
for storing/encoding the two branches (i.e., sub-trees) from P2 
and the fields following.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">For the link from P1 to P3 on the tree, 
Link-No field has value of 3 since the link number is 3 for the link on P1;
N-Branches field 
has value of 1 since there is one branch (i.e., sub-tree) from P3; 
S-Branches+ field has value of 10 (bytes) since 10 bytes are used 
for storing/encoding the branch from P3 and no other fields 
following.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">For the link from P2 to egress PE2 on the tree, Link-No 
field has value of 1 since the link number is 1 for the link on P2; 
N-Branches field has value of 0 since there is no branch (i.e., 
sub-tree) from PE2; S-Branches+ field has value of 0 (bytes).<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8"><a href="#p2mp-p1-2-l1-4-L" class="xref">Figure 4</a> 
shows an enhancement of encoding the P2MP path/tree in 
<a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
using L flag. 
The L flag added for a link indicates whether the next hop is a 
leaf node. When L is set to one indicating the next hop is a leaf 
(i.e., egress), the "N-Branches" and "S-Branches+" fields are removed.
There are 8 links to leaves (i.e., egress nodes) on the tree, which
are 2 links from P2 to PE2 and PE3; 4 links from P4 to PE4, PE5, PE6 and 
PE7; and 2 links from P1 to PE8 and PE9.
These 8 links have their L flags set to one. 
The N-Branches and S-Branches+ fields for these 8 links are removed 
from the encoding of the tree. This reduces the space/memory for 
encoding the tree.<a href="#section-3-8" class="pilcrow">¶</a></p>
<span id="name-encoding-of-tree-from-pe1-vi"></span><div id="p2mp-p1-2-l1-4-L">
<figure id="figure-4">
        <div class="alignCenter art-text artwork" id="section-3-9.1">
<pre>
     +=+=======+==========+===========+
size |L|Link-No|N-Branches|S-Branches+|  link
     +=+=======+==========+===========+                     -+
 16  |0|   2   |    4     |    14     | PE1 to P1            |
     +-+-------+----------+-----------+                      |sub-tree
 14  |0|   2   |    2     |    8      | P1 to P2             |from PE1
     +-+-------+----------+-----------+                      |to P1 to
 12  |0|   3   |    1     |    6      | P1 to P3             |PE2-PE9
     +-+-------+----------+-----------+                      |
 10  |1|   4   |                        P1 to PE8            |
     +-+-------+                                             |
  9  |1|   5   |                        P1 to PE9            |
     +-+-------+                                 -+          |
  8  |1|   1   |                       P2 to PE2  |sub-trees |
     +-+-------+                                  |from P2   |
  7  |1|   2   |                       P2 to PE3  |          |
     +-+-------+----------+-----------+          -+          |
  6  |0|   2   |    4     |    4      |P3 to P4   |          |
     +-+-------+----------+-----------+           |sub-tree  |
  4  |1|   2   |                       P4 to PE4  |from P3   |
     +-+-------+                                  |          |
  3  |1|   3   |                       P4 to PE5  |          |
     +-+-------+                                  |          |
  2  |1|   4   |                       P4 to PE6  |          |
     +-+-------+                                  |          |
  1  |1|   5   |                       P4 to PE7  |          |
     +-+-------+----------+-----------+          -+         -+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-encoding-of-tree-from-pe1-vi" class="selfRef">Encoding of tree from PE1 via P1         to PE2, PE3, ..., PE9 with L flag</a>
        </figcaption></figure>
</div>
<p id="section-3-10">For example, suppose that two fields L and Link-No with padding 
(padding is not shown) for a link to leaf occupy 1 byte; 
four fields L, Link-No, N-Branches and S-Branches+ for a link
to a transit node occupy 2 bytes. 
In this case, the S-Branches+ field for link from PE1 to P1 is 14 
(bytes), which is the size of the fields for 11 links (i.e., link from
P1 to P2, link from P1 to P3, ..., link from P4 
to PE7) encoding the sub-trees from P1 to PE2, PE3, ..., PE9. 
The S-Branches+ field for link from P1 to P2 is 8 (bytes), which is 
the size of the fields for 7 links (i.e., link from P2 to PE2, 
link from P2 to PE3, link from P3 to P4, and 4 links from P4 to PE4 - PE7) 
encoding the sub-trees from P1 to PE2 and PE3, and 
the fields following them.<a href="#section-3-10" class="pilcrow">¶</a></p>
<p id="section-3-11">Encoding the tree without L flag occupies 24 bytes in total 
as illustrated in <a href="#srh-p2mp-p1-2-l1-4" class="xref">Figure 3</a>. 
Encoding the tree with L flag occupies 16 bytes in total as 
illustrated in <a href="#p2mp-p1-2-l1-4-L" class="xref">Figure 4</a>. 
8 bytes (or say 33% of space/memory) are saved/reduced.<a href="#section-3-11" class="pilcrow">¶</a></p>
<p id="section-3-12"><a href="#p2mp-p3-2-l4-7-B" class="xref">Figure 5</a> 
shows an enhancement of encoding the branch/sub-tree from P3 to
PE4, PE5, PE6 and PE7 in <a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
using B flag. 
The B flag added for a link indicates whether 
the link bits+ are used to represent the link numbers 
and other link related information such as whether links' 
remote end nodes (i.e., next hops) are leaves. 
When B flag for the link from upstream node such as P3 
to downstream node such as P4 is set to one indicating the link bits+ 
are used, the links from downstream node such as P4 on the tree 
are encoded or represented by link bits+. 
A link bits+ contains a P (short for plus leaf) field, 
S-Bits (short for size of the bits in a unit such as byte) field, 
and Bits field.<a href="#section-3-12" class="pilcrow">¶</a></p>
<p id="section-3-13">P field has a value such as 1 indicating that a bit with value 
of 1 (one) in Bits field means that the corresponding link is 
on the branch and the link's next hop is a leaf. 
There are four links to leaves (i.e., egress nodes) from P4, 
which are link from P4 to PE4 with link number 2, 
link from P4 to PE5 with link number 3, 
link from P4 to PE6 with link number 4,  
and link from P4 to PE7 with link number 5. 
These four links are represented by 
the 2-th bit, 3-th bit, 4-th bit and 5-th bit in the Bits field 
(from left to right) respectively.<a href="#section-3-13" class="pilcrow">¶</a></p>
<p id="section-3-14">S-Bits field has a value such as 1 indicating the size of the 
Bits field in a unit such as byte.<a href="#section-3-14" class="pilcrow">¶</a></p>
<p id="section-3-15">Suppose that the fields 
(i.e., L, B, Link-No, No-Branches and S-Branches+) for the link 
from P3 to P4 occupy 2 bytes; P and S-Bits occupy 1 byte. 
In this case, the link bits+ for the links from P4 occupy 2 bytes, 
encoding the branch from P3 uses 4 bytes in total.<a href="#section-3-15" class="pilcrow">¶</a></p>
<p id="section-3-16">The number of branches from P4 is the number of bits with value of 
one in the Bits field. 
The N-Branches field for the link from P3 to P4 is used 
for other purpose. 
For example, N-Branches field and S-Branches+ field combined to 
represent the size of the branches plus the fields following (i.e., 
S-Branches+).<a href="#section-3-16" class="pilcrow">¶</a></p>
<span id="name-encoding-of-branch-from-p3-"></span><div id="p2mp-p3-2-l4-7-B">
<figure id="figure-5">
        <div class="alignCenter art-text artwork" id="section-3-17.1">
<pre>
     +=+=+=======+==========+===========+
size |L|B|Link-No|N-Branches|S-Branches+|  link
     +=+=+=======+==========+===========+               -+
  4  |0|1|   2   |          |    2      | P3 to P4       |branch
     +-+-+-------+------+---+-----------+                |from P3
  2  |1|        1       |0 1 1 1 1 0 0 0| P4 to PE4-PE7  |to PE4-PE7
     +-+----------------+---------------+               -+
     |P|     S-Bits     |     Bits      |
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-encoding-of-branch-from-p3-" class="selfRef">Encoding of branch from P3 via P4         to PE4, PE5, PE6, PE7 with B flag</a>
        </figcaption></figure>
</div>
<p id="section-3-18"><a href="#p2mp-pe1-2-p1-2-p2-pe9-B" class="xref">Figure 6</a> 
shows an enhancement of encoding the branch part from PE1 via P1 
to P2, P3, PE8 and PE9 on the P2MP tree/path in 
<a href="#p2mp-path-R-L14" class="xref">Figure 1</a>
using B flag. 
B flag for the link from upstream node PE1 to downstream node P1 
is set to one indicating that the link bits+ are used to 
represent the information about the links on the tree from 
downstream node P1.<a href="#section-3-18" class="pilcrow">¶</a></p>
<p id="section-3-19">P field has a value such as 0 indicating that a bit with value 
of 1 (one) in Bits field means that the corresponding link 
from downstream node P1 is on the tree.<a href="#section-3-19" class="pilcrow">¶</a></p>
<p id="section-3-20">S-Bits field has a value such as 1 indicating the size of Bits 
field in a unit such as byte.<a href="#section-3-20" class="pilcrow">¶</a></p>
<p id="section-3-21">Bits field of one byte has the second (2-th) bit, third (3-th) bit, 
4-th bit and 5-th bit set to one (from left to right), 
indicating four links from P1 on the tree: 
the link from P1 to P2 with link number 2, 
link from P1 to P3 with link number 3, 
link from P1 to PE8 with link number 4 and 
link from P1 to PE9 with link number 5.  
The fields for each of these links do not have Link-No field, 
which is called reduced fields.<a href="#section-3-21" class="pilcrow">¶</a></p>
<span id="name-encoding-of-branch-part-fro"></span><div id="p2mp-pe1-2-p1-2-p2-pe9-B">
<figure id="figure-6">
        <div class="alignCenter art-text artwork" id="section-3-22.1">
<pre>
     +=+=+=======+==========+===========+
size |L|B|Link-No|N-Branches|S-Branches+|  link
     +=+=+=======+==========+===========+              -+
 13  |0|1|   2   |          |    11     | PE1 to P1     |branch part
     +-+-+-------+------+---+-----------+               |from PE1
 11  |0|        1       |0 1 1 1 1 0 0 0| P1 to P2,P3,  |to P2,P3,
     +-+----------------+---------------+      PE8,PE9  |  PE8,PE9
     |P|     S-Bits     |     Bits      |               |
                                                        |
             |L|B|N-Branches|S-Branches+|               |
             +=+=+==========+===========+               |
             |0|0|     2    |     6     | P1 to P2      |
             +-+-+----------+-----------+               |
             |0|0|     1    |     4     | P1 to P3      |
             +-+-+----------+-----------+               |
             |1|                          P1 to PE8     |
             +-+                                        |
             |1|                          P1 to PE9     |
             +-+                                       -+
</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-encoding-of-branch-part-fro" class="selfRef">Encoding of branch part from PE1 via P1         to P2, P3, PE8, PE9 with B flag</a>
        </figcaption></figure>
</div>
<p id="section-3-23">The reduced fields (i.e., L = 0, B = 0, No-Branches = 2, S-Branches+ = 6) 
for the link from P1 to P2 indicates that the link's next hop is not leaf, 
link bits+ is not used for the branches from P2, 
the number of branches from P2 is 2 and the size of the branches from P2 
plus the fields following is 6.<a href="#section-3-23" class="pilcrow">¶</a></p>
<p id="section-3-24">The reduced fields (i.e., L = 0, B = 0, No-Branches = 1, S-Branches+ = 4)
for the link from P1 to P3 indicates that the link's next hop is not leaf,
link bits+ is not used for the branches from P3, 
the number of branches from P3 is 1 and 
the size of the branches from P3 plus the fields following is 4.<a href="#section-3-24" class="pilcrow">¶</a></p>
<p id="section-3-25">The reduced fields (i.e., L = 1) for the link from P1 to PE8 
indicates that the link's next hop PE8 is a leaf.<a href="#section-3-25" class="pilcrow">¶</a></p>
<p id="section-3-26">The reduced fields (i.e., L = 1) for the link from P1 to PE9 
indicates that the link's next hop PE9 is a leaf.<a href="#section-3-26" class="pilcrow">¶</a></p>
<p id="section-3-27">Suppose the fields (i.e., L, B, Link-No, No-Branches and S-Branches+) 
for a link to a transit node occupy 2 bytes; 
P and S-Bits occupy 1 byte; 
the reduced fields (i.e., L, B, No-Branches and S-Branches+) 
for a link to a transit node occupy 11 bits, 
the reduced fields (i.e., L) for a link to a leaf occupy 1 bit.  
In this case the reduced fields for four links from P1 to P2, P3, PE8 
and PE9 uses 3 bytes (i.e., 24 bits). 
Encoding the branch part from PE1 via P1 to P2, P3, PE8 and PE9 uses 
7 bytes.<a href="#section-3-27" class="pilcrow">¶</a></p>
<p id="section-3-28"><a href="#p2mp-pe1-2-p1-2-pe2-pe9-B" class="xref">Figure 7</a> 
shows an enhancement of encoding the P2MP path/tree in 
<a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
using both L and B flags.<a href="#section-3-28" class="pilcrow">¶</a></p>
<p id="section-3-29">The branch part from PE1 via P1 to P2, P3, PE8 and PE9 is the same as
the one in <a href="#p2mp-pe1-2-p1-2-p2-pe9-B" class="xref">Figure 6</a> 
and occupies 7 bytes.<a href="#section-3-29" class="pilcrow">¶</a></p>
<p id="section-3-30">The link from P2 to PE2 is represented by L = 1 and Link-No = 1. 
The link from P2 to PE3 is represented by L = 1 and Link-No = 2. 
These two links occupy 2 bytes. 

In an option, when L = 1, the Link-No field and Pad are combined to 
represent link number.<a href="#section-3-30" class="pilcrow">¶</a></p>
<p id="section-3-31">The branch from P3 is the same as the one in 
<a href="#p2mp-p3-2-l4-7-B" class="xref">Figure 5</a>
and occupies 4 bytes. 
Encoding the tree of 13 nodes uses 13 bytes in total.<a href="#section-3-31" class="pilcrow">¶</a></p>
<span id="name-encoding-of-tree-from-pe1-t"></span><div id="p2mp-pe1-2-p1-2-pe2-pe9-B">
<figure id="figure-7">
        <div class="alignCenter art-text artwork" id="section-3-32.1">
<pre>
     +=+=+=======+==========+===========+
size |L|B|Link-No|N-Branches|S-Branches+|  link
     +=+=+=======+==========+===========+                    -+
 13  |0|1|   2   |          |    11     | PE1 to P1           |sub-tree
     +-+-+-------+------+---+-----------+                     |from PE1
 11  |0|        1       |0 1 1 1 1 0 0 0| P1 to P2,P3,        |to P1 to
     +-+----------------+---------------+      PE8,PE9        |PE2-PE9
     |P|     S-Bits     |     Bits      |                     |
                                                              |
             |L|B|N-Branches|S-Branches+|                     |
             +=+=+==========+===========+                     |
  9          |0|0|     2    |     6     | P1 to P2            |
             +-+-+----------+-----------+                     |
             |0|0|     1    |     4     | P1 to P3            |
             +-+-+----------+-----------+                     |
             |1|                          P1 to PE8           |
             +-+                                              |
      L      |1|                          P1 to PE9           |
     +-+-----+-+-+                                 -+         |
  6  |1|  1  |Pad|                        P2 to PE2 |sub-tree |
     +-+-----+-+-+                                  |from P2  |
  5  |1|  2  |Pad|                        P2 to PE3 |         |
     +-+-+---+---+----------+-----------+          -+         |
  4  |0|1|   2   |          |     2     | P3 to P4  |sub-tree |
     +-+-+-------+------+---+-----------+           |from P3  |
  2  |1|        1       |0 1 1 1 1 0 0 0| P4 to PE4 |         |
     +-+----------------+---------------+      -PE7-+        -+
     |P|     S-Bits     |     Bits      |
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-encoding-of-tree-from-pe1-t" class="selfRef">Encoding of tree from PE1         to PE2 - PE9 with L and B</a>
        </figcaption></figure>
</div>
</section>
<section id="section-4">
      <h2 id="name-multicast-routing-header-mr">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-multicast-routing-header-mr" class="section-name selfRef">Multicast Routing Header (MRH)</a>
      </h2>
<p id="section-4-1"><a href="#mrh-in-pkt" class="xref">Figure 8</a> shows 
a Multicast Routing Header (MRH) in an IPv6 packet.  
The IPv6 packet comprises an IPv6 header with a destination address
(DA) and source address (SA) of IPv6, 
a routing header with Routing type (TBD) indicating MRH and 
an IP multicast datagram. 
The routing header is indicated by the Next Header in the IPv6 header.<a href="#section-4-1" class="pilcrow">¶</a></p>
<span id="name-multicast-routing-header-mrh"></span><div id="mrh-in-pkt">
<figure id="figure-8">
        <div class="alignCenter art-text artwork" id="section-4-2.1">
<pre>
+-----------------+------------------+------------------------+
|   IPv6 header:  |  Routing header: | IP multicast datagram  |
|                 |                  | (IP datagram header +  |
|  Next Header =  | Next Header      |  data)                 |
|  Routing header |                  |                        |
|                 | Hdr Ext Len      |                        |
| SA=IPv6 Address | Routing Type =   |                        |
| DA=IPv6 Address |   TBD (MRH)      |                        |
|                 | SL, b, nB        |                        |
|                 | sub-tree         |                        |
+-----------------+------------------+------------------------+
                  |&lt;----   MRH  ----&gt;|
</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-multicast-routing-header-mrh" class="selfRef">Multicast Routing Header (MRH) in IPv6 packet</a>
        </figcaption></figure>
</div>
<p id="section-4-3">The format of the MRH is shown in 
<a href="#mrh-format" class="xref">Figure 9</a>.
The MRH comprises a 8-bit Next Header field with a value 
indicating the IP multicast datagram header in the packet, 
a 8-bit Hdr Ext Len field with a value indicating the length of the 
MRH in a unit of 64 bits (i.e., 8 bytes) excluding the first 8 bytes, 
a 8-bit Routing Type field with a value (to be assigned by IANA) 
indicating that the routing header is a Multicast Routing Header (MRH), 
a 8-bit SL (short for Sub-tree Left) field with a value indicating 
the size of the sub-tree remaining, 
a 1-bit b flag is set to value one indicating the links directly 
from the root of the sub-tree are encoded by link bits+,  
a 3-bit Rsv (Reserved) field with zero, 
a 4-bit nB (short for n-Branches) field with a value indicating
the number of branches from the root of the sub-tree, 
and a sub-tree field which is an encoding of a multicast sub-tree.<a href="#section-4-3" class="pilcrow">¶</a></p>
<span id="name-format-of-multicast-routing"></span><div id="mrh-format">
<figure id="figure-9">
        <div class="alignCenter art-text artwork" id="section-4-4.1">
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Header   |  Hdr Ext Len  |RoutingType=TBD|       SL      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|b| Rsv |   nB  |                                               |
+-+-+-+-+-+-+-+-+       Sub-tree encoded by link numbers        :
:                                                               :
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-format-of-multicast-routing" class="selfRef">Format of Multicast Routing Header (MRH)</a>
        </figcaption></figure>
</div>
<p id="section-4-5">The P2MP path/tree from PE1 via P1 to PE2 - PE9
in <a href="#p2mp-path-R-L14" class="xref">Figure 1</a>
is encoded by the link numbers of the links on the tree as illustrated 
in <a href="#p2mp-pe1-2-p1-2-pe2-pe9-B" class="xref">Figure 7</a>. 
The link from ingress PE1 to P1 is encoded by the link number of 
the link on PE1, which is 2, 
the number of branches from P1 on the tree, 
and the size of the branches+ from P1, which is 11. 
The number of branches from P1 is the number of bits with value 1 
in the Bits field for the links from P1 to P2, P3, PE8 and PE9, 
which is 4 since there are 4 bits with value 1 in the Bits field.<a href="#section-4-5" class="pilcrow">¶</a></p>
<p id="section-4-6">For an IP multicast packet to be transmitted 
by the P2MP path/tree, PE1 constructs an IPv6 packet 
for each sub-tree/branch from PE1 and sends the packet 
containing a MRH and the IP multicast packet to the next hop 
along the sub-tree.<a href="#section-4-6" class="pilcrow">¶</a></p>
<p id="section-4-7">The P2MP path/tree has one sub-tree from PE1 via P1 to PE2 - PE9. 
PE1 finds P1's IPv6 address from PE1's neighbor IPv6 address table 
using the link number 2 and sets DA (destination address) of the 
IPv6 packet to P1's IPv6 address and SA (source address) of 
the IPv6 packet to PE1's IPv6 address. 
PE1 builds the MRH based on the encoding of the tree in 
<a href="#p2mp-pe1-2-p1-2-pe2-pe9-B" class="xref">Figure 7</a>
through setting b flag to 1, 
which is the value of B for the link from PE1 to P1,
SL to 11, which is the value of S-Branches+ 
for the link from PE1 to P1. 
nB is not set since B = 1.
<a href="#pkt-mrh-2p1" class="xref">Figure 10</a> shows the IPv6
packet to be sent to P1, which is received by P1.
Note that some details are not shown.<a href="#section-4-7" class="pilcrow">¶</a></p>
<span id="name-ipv6-packet-with-mrh-receiv"></span><div id="pkt-mrh-2p1">
<figure id="figure-10">
        <div class="alignCenter art-text artwork" id="section-4-8.1">
<pre>
| IPv6 Header | &lt;--------    MRH    --------&gt; |
+-------------+-------------------------------+-------------+
|DA=P1's IPv6 |Routing Type=TBD,SL=11,b=1,nB  |IP multicast |
|SA=PE1's IPv6|sub-tree from P1 to PE2-PE9    |datagram     |
+-------------+-------------------------------+-------------+
size  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5   Link
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                    -+
 11  |0|      1      |0 1 1 1 1 0 0 0| P1 to P2,P3,PE8,PE9 |sub-tree
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                     |from P1
  9   P        |0|0|  2  |     6     |     P1 to P2        |
               +-+-+-+-+-+-+-+-+-+-+-+-+-+                 |
               |0|0|  1  |     4     |1|1| P1 to P3,       |
               +-+-+-+-+-+-+-+-+-+-+-+-+-+   PE8,PE9       |
      L        |L|B|N-Bra|S-Branches+|L|L|                 |
     +-+-+-+-+-+-+-+-+                         -+          |
  6  |1|     1   |Pad|                 P2 to PE2|sub-trees |
     +-+-+-+-+-+-+-+-+                          |from P2   |
  5  |1|     2   |Pad|                 P2 to PE3|          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         -+          |
  4  |0|1|   2   |       |    2      | P3 to P4 |          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+          |sub-tree  |
  2  |1|      1      |0 1 1 1 1 0 0 0|P4 to PE4 |from P3   |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    - PE7-+         -+
     |P|    S-Bits   |      Bits     |
</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-ipv6-packet-with-mrh-receiv" class="selfRef">IPv6 packet with MRH received by P1</a>
        </figcaption></figure>
</div>
<p id="section-4-9">The number of branches from P1 is 4, which is the number of bits 
with value 1 in the Bits field for the links from P1 to P2, P3, 
PE8 and PE9. This is determined by b = 1 and the Bits+ fields 
pointed by SL = 11.<a href="#section-4-9" class="pilcrow">¶</a></p>
<p id="section-4-10">There are 4 links from P1. 
The 2-th bit in the Bits field has value 1 indicating 
the link with link number 2, which is the link from P1 to P2. 
The reduced fields (i.e., L = 0, B = 0, No-Branches = 2, S-Branches+ = 6) 
for the link indicates that the link's next hop P2 is not leaf, 
link bits+ is not used for the branches from P2, 
the number of branches from P2 is 2 and 
the size of the branches from P2 plus the fields following is 6.<a href="#section-4-10" class="pilcrow">¶</a></p>
<p id="section-4-11">The 3-th bit has value 1 indicating the link with link number 3, 
which is the link from P1 to P3. 
The reduced fields (i.e., L = 0, B = 0, No-Branches = 1, S-Branches+ = 4) 
for the link indicates that the link's next hop P3 is not leaf, 
link bits+ is not used for the branches from P3, 
the number of branches from P3 Is 1 and 
the size of the branches from P3 plus the fields following is 4.<a href="#section-4-11" class="pilcrow">¶</a></p>
<p id="section-4-12">The 4-th bit has value 1 indicating the link with link number 4, 
which is the link from P1 to PE8. 
PE8 is a leaf, which is indicated by the first L = 1. 
The 5-th bit has value 1 indicating the link with link number 5, 
which is the link from P1 to PE9. 
PE9 is a leaf indicated by the second L = 1.<a href="#section-4-12" class="pilcrow">¶</a></p>
<p id="section-4-13">The link number of the link from P2 to leaf PE2 is 1 on P2. 
The link number of the link from P2 to leaf PE3 is 2 on P2.
The link number of the link from P3 to P4 is 2 on P3. 
The size of branches from P4 is 2. 
The link numbers of the links from P4 to leaf PE4, PE5, PE6 and PE7 
are 2, 3, 4 and 5 on P4 respectively.<a href="#section-4-13" class="pilcrow">¶</a></p>
<p id="section-4-14">After receiving the IPv6 packet from PE1, P1 determines 
whether the packet's next header is a MRH through checking if the 
next header is routing header and routing type in the routing header 
is TBD for MRH. When the next header is the MRH, P1 duplicates 
the packet for each link/branch/sub-tree from P1 and sends the packet copy 
with an updated MRH (note: only SL, b and nB are updated) 
to the next hop along the branch. 
Since b = 1, the number of bits with value 1 in the Bits field 
of Bits+ pointed by SL = 11 is the number of branches/links 
from P1 according to <a href="#pkt-mrh-2p1" class="xref">Figure 10</a>, which is 4.<a href="#section-4-14" class="pilcrow">¶</a></p>
<p id="section-4-15">The 2-th bit in the Bits field has value 1 indicating 
the link with link number 2, which is the link from P1 to P2. 
The first reduced fields is for link from P1 to P2 and 
indicates the number of branches from P2 is 2 and 
the size of branches from P2 plus the ones following them is 6.<a href="#section-4-15" class="pilcrow">¶</a></p>
<p id="section-4-16">P1 duplicates the packet for the link with link number 2, 
finds P2's IPv6 address from P1's neighbor IPv6 address table using 
the link number 2 of the link from P1 to P2 and 
sets DA of the packet to P2's IPv6 address and 
SA of the packet to P1's IPv6 address. 
P1 updates the MRH based on the encoding of the sub-tree in 
<a href="#pkt-mrh-2p1" class="xref">Figure 10</a>
through setting SL, b and nB to S-Branches+ = 6, B = 0 and 
N-Branches = 2 for the link from P1 to P2 respectively. 
<a href="#pkt-mrh-2p2" class="xref">Figure 11</a> 
shows the packet to be sent to P2, which is received by P2.<a href="#section-4-16" class="pilcrow">¶</a></p>
<span id="name-ipv6-packet-with-mrh-receive"></span><div id="pkt-mrh-2p2">
<figure id="figure-11">
        <div class="alignCenter art-text artwork" id="section-4-17.1">
<pre>
| IPv6 Header | &lt;--------    MRH    --------&gt; |
+-------------+-------------------------------+-------------+
|DA=P2's IPv6 |Routing Type=TBD, SL=6,b=0,nB=2|IP multicast |
|SA=P1's IPv6 |sub-tree from P2 to PE2,PE3    |datagram     |
+-------------+-------------------------------+-------------+
size  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5   Link
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      L| Link-No |
     +-+-+-+-+-+-+-+-+                         -+
  6  |1|     1   |Pad|                 P2 to PE2|sub-trees
     +-+-+-+-+-+-+-+-+                          |from P2
  5  |1|     2   |Pad|                 P2 to PE3|
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         -+
  4  |0|1|   2   |       |    2      | P3 to P4 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+          |sub-tree
  2  |1|      1      |0 1 1 1 1 0 0 0|P4 to PE4 |from P3
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    - PE7-+
     |P|    S-Bits   |      Bits     |
</pre>
</div>
<figcaption><a href="#figure-11" class="selfRef">Figure 11</a>:
<a href="#name-ipv6-packet-with-mrh-receive" class="selfRef">IPv6 packet with MRH received by P2</a>
        </figcaption></figure>
</div>
<p id="section-4-18">The number of branches from P2 is 2. 
The link number of the link from P2 to PE2 is 1 on P2. 
The link number of the link from P2 to PE3 is 2 on P2. 
PE2 and PE3 are leaves (i.e., egresses), 
which are indicated by L = 1.<a href="#section-4-18" class="pilcrow">¶</a></p>
<p id="section-4-19">The fields for encoding the branch/sub-tree from P3 follows 
the branches/sub-trees from P2.<a href="#section-4-19" class="pilcrow">¶</a></p>
<p id="section-4-20">The 3-th bit has value 1 indicating the link with link number 3, 
which is the link from P1 to P3. 
The second reduced fields is for link from P1 to P3 and 
indicates the number of branches from P3 is 1 and 
the size of branches from P3 plus the ones following them is 4.<a href="#section-4-20" class="pilcrow">¶</a></p>
<p id="section-4-21">P1 duplicates the packet for the link with link number 3 
(which is link from P1 to P3) and 
sends the packet copy with an updated MRH to P3.<a href="#section-4-21" class="pilcrow">¶</a></p>
<p id="section-4-22">The 4-th bit has value 1 indicating the link with link number 4, 
which is the link from P1 to PE8. PE8 is a leaf, 
which is indicated by the first L = 1.<a href="#section-4-22" class="pilcrow">¶</a></p>
<p id="section-4-23">P1 duplicates the packet for the link with link number 4 and 
sends the packet copy with an updated MRH to PE8.<a href="#section-4-23" class="pilcrow">¶</a></p>
<p id="section-4-24">The 5-th bit has value 1 indicating the link with link number 5, 
which is the link from P1 to PE9. PE9 is a leaf, 
which is indicated by the second L = 1.<a href="#section-4-24" class="pilcrow">¶</a></p>
<p id="section-4-25">P1 duplicates the packet for the link with link number 5 and 
sends the packet copy with an updated MRH to PE9.<a href="#section-4-25" class="pilcrow">¶</a></p>
<p id="section-4-26">
P1 duplicates the packet for the link with link number 3 
(which is link from P1 to P3), 
finds P3's IPv6 address from P1's neighbor IPv6 address table 
using the link number 3 of the link from P1 to P3 and 
sets DA of the packet to P3's IPv6 address and 
SA of the packet to P1's IPv6 address. 
P1 updates the MRH based on the encoding of the sub-tree in 
<a href="#pkt-mrh-2p1" class="xref">Figure 10</a>

through setting SL, b and nB to S-Branches+ = 4, B = 0 and 
N-Branches = 1 in the reduced fields for the link from P1 to P3 
respectively. 
<a href="#pkt-mrh-2p3" class="xref">Figure 12</a>
shows the packet to be sent to P3, which is received by P3.<a href="#section-4-26" class="pilcrow">¶</a></p>
<span id="name-ipv6-packet-with-mrh-received"></span><div id="pkt-mrh-2p3">
<figure id="figure-12">
        <div class="alignCenter art-text artwork" id="section-4-27.1">
<pre>
| IPv6 Header | &lt;--------    MRH    --------&gt; |
+-------------+-------------------------------+-------------+
|DA=P3's IPv6 |Routing Type=TBD, SL=4,b=0,nB=1|IP multicast |
|SA=P1's IPv6 |sub-tree from P3 to PE4-PE7    |datagram     |
+-------------+-------------------------------+-------------+
size  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5   Link
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

     |L|B|Link-No|N-Branc|S-Branches+|
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         -+
  4  |0|1|   2   |       |    2      | P3 to P4 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+          |sub-tree
  2  |1|      1      |0 1 1 1 1 0 0 0|P4 to PE4 |from P3
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    - PE7-+
     |P|    S-Bits   |      Bits     |
</pre>
</div>
<figcaption><a href="#figure-12" class="selfRef">Figure 12</a>:
<a href="#name-ipv6-packet-with-mrh-received" class="selfRef">IPv6 packet with MRH received by P3</a>
        </figcaption></figure>
</div>
<p id="section-4-28">The number of branches from P3 is 1. 
The link number of the link from P3 to P4 is 2 on P3. 
The size of branches from P4 is 2. 
B = 1 for the link from P3 to P4 indicates that the links from P4 are 
encoded by link bits+. 
The number of branches from P4 is the number of bits with value 1 
in the Bits field for the links from P4 to PE4 - PE7, 
which is 4 since there are 4 bits with value 1 in the Bits field.<a href="#section-4-28" class="pilcrow">¶</a></p>
<p id="section-4-29">After receiving the IPv6 packet from P1, P3 determines whether 
the packet's next header is a MRH. 
When the packet's next header is the MRH, 
P3 duplicates the packet for each link/branch/sub-tree from P3 and 
sends the packet copy with an updated MRH to the next hop 
along the branch. 
There is one branch from P3 according to the sub-tree remaining in 
the MRH in the packet received by P3. 
The branch/sub-tree is from the link from P3 to P4 towards PE4 - PE7.<a href="#section-4-29" class="pilcrow">¶</a></p>
<p id="section-4-30">P3 duplicates the packet for the branch/sub-tree, 
finds P4's IPv6 address from P3's neighbor IPv6 address table using 
the link number 2 of the link from P3 to P4 and 
sets DA of the packet to P4's IPv6 address and 
SA of the packet to P3's IPv6 address. 
P3 updates the MRH based on the encoding of the sub-tree in 
<a href="#pkt-mrh-2p3" class="xref">Figure 12</a>
through setting SL and b to S-Branches+ = 2 and B = 1 for the link 
from P3 to P4 respectively. nB is not set or used since b = 1. 

<a href="#pkt-mrh-2p4" class="xref">Figure 13</a>
shows the packet to be sent to P4, which is received by P4.<a href="#section-4-30" class="pilcrow">¶</a></p>
<span id="name-ipv6-packet-with-mrh-received-"></span><div id="pkt-mrh-2p4">
<figure id="figure-13">
        <div class="alignCenter art-text artwork" id="section-4-31.1">
<pre>
| IPv6 Header | &lt;--------    MRH    --------&gt; |
+-------------+-------------------------------+-------------+
|DA=P4's IPv6 |Routing Type=TBD, SL=2,b=1,nB  |IP multicast |
|SA=P3's IPv6 |sub-tree from P4 to PE4-PE7    |datagram     |
+-------------+-------------------------------+-------------+
size  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5   Link
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+         -+sub-trees
  2  |1|      1      |0 1 1 1 1 0 0 0|P4 to PE4 |from P4
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+    - PE7-+
     |P|    S-Bits   |      Bits     |
</pre>
</div>
<figcaption><a href="#figure-13" class="selfRef">Figure 13</a>:
<a href="#name-ipv6-packet-with-mrh-received-" class="selfRef">IPv6 packet with MRH received by P4</a>
        </figcaption></figure>
</div>
<p id="section-4-32">After receiving the IPv6 packet from P3, 
P4 determines whether the packet's next header is a MRH. 
When the packet's next header is the MRH, 
P4 duplicates the packet for each branch/link from P4 and 
sends the packet copy with an updated MRH to the next hop 
along the branch. 
There are 4 branches/links from P4 according to the sub-tree 
remaining in the MRH in the packet received by P4.<a href="#section-4-32" class="pilcrow">¶</a></p>
<p id="section-4-33">
The 2-th bit in the Bits field has value 1 indicating the link 
with link number 2, which is the link from P4 to leaf PE4.<a href="#section-4-33" class="pilcrow">¶</a></p>
<p id="section-4-34">
The 3-th bit has value 1 indicating the link 
with link number 3, which is the link from P4 to leaf PE5.<a href="#section-4-34" class="pilcrow">¶</a></p>
<p id="section-4-35">
The 4-th bit has value 1 indicating the link 
with link number 4, which is the link from P4 to leaf PE6.<a href="#section-4-35" class="pilcrow">¶</a></p>
<p id="section-4-36">
The 5-th bit has value 1 indicating the link 
with link number 5, which is the link from P4 to leaf PE7.<a href="#section-4-36" class="pilcrow">¶</a></p>
<p id="section-4-37">P4 duplicates the packet for the first branch, finds PE4's 
IPv6 address from P4's neighbor IPv6 address table using the link 
number 2 of the link from P4 to PE4 and sets DA of the packet to 
PE4's IPv6 address and SA of the packet to P4's IPv6 address. 

P4 updates the MRH based on the encoding of the sub-tree in 
<a href="#pkt-mrh-2p4" class="xref">Figure 13</a>

through setting SL to 0 since PE4 is a leaf.
 
<a href="#pkt-mrh-2pe4" class="xref">Figure 14</a> shows 
the packet to be sent to PE4, which is received by PE4.

Similarly, P4 duplicates the packet for each of the other links, 
updates the MRH and sends the packet copy to each of PE5, PE6 and PE7.<a href="#section-4-37" class="pilcrow">¶</a></p>
<span id="name-ipv6-packet-with-mrh-received-b"></span><div id="pkt-mrh-2pe4">
<figure id="figure-14">
        <div class="alignCenter art-text artwork" id="section-4-38.1">
<pre>
| IPv6 Header | &lt;--------    MRH    --------&gt; |
+-------------+-------------------------------+-------------+
|DA=PE4's IPv6|Routing Type=TBD, SL=0, b, nB  |IP multicast |
|SA=P4's IPv6 |sub-tree/leaf PE4              |datagram     |
+-------------+-------------------------------+-------------+
</pre>
</div>
<figcaption><a href="#figure-14" class="selfRef">Figure 14</a>:
<a href="#name-ipv6-packet-with-mrh-received-b" class="selfRef">IPv6 packet with MRH received by PE4</a>
        </figcaption></figure>
</div>
<p id="section-4-39">After receiving the packet from P4, PE4 determines whether 
the packet's next header is a MRH. 
When the packet's next header is the MRH, 
PE4 checks if PE4 itself is a leaf (i.e., egress) 
through checking whether SL is 0. 
When PE4 is a leaf, 
PE4 decapsulates the packet and sends the IP multicast datagram 
to the IP multicast forwarding module.<a href="#section-4-39" class="pilcrow">¶</a></p>
<p id="section-4-40">Alternatively, after receiving the packet from P3 and 
determining that the packet's next header is a MRH, 
P4 checks if each of its next hops is a leaf. 
When the next hop is a leaf, P4 decapsulates the packet and 
sends the IP multicast datagram to the next hop.
Since 4 next hops PE4 - PE7 are leaves, 
P4 sends the IP multicast datagram to PE4 - PE7.<a href="#section-4-40" class="pilcrow">¶</a></p>
</section>
<section id="section-5">
      <h2 id="name-procedures-behaviors">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-procedures-behaviors" class="section-name selfRef">Procedures/Behaviors</a>
      </h2>
<p id="section-5-1">This section describes the procedures or behaviors on 
         the ingress, transit and egress/leaf node of a P2MP path
         to deliver a packet received from the path to its destinations.<a href="#section-5-1" class="pilcrow">¶</a></p>
<section id="section-5.1">
        <h3 id="name-procedure-behavior-on-ingre">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-procedure-behavior-on-ingre" class="section-name selfRef">Procedure/Behavior on Ingress Node</a>
        </h3>
<p id="section-5.1-1">For a packet to be transported by a P2MP Path, 
the ingress of the P2MP path duplicates the packet for each 
sub-tree/branch of the P2MP path branching from the ingress, 
encapsulates the packet copy in a MRH containing the sub-tree and 
sends the encapsulated packet copy to the next hop node along the 
sub-tree.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">For example, there is one sub-tree branching from the 
ingress of the P2MP path/tree in <a href="#p2mp-path-R-L14" class="xref">Figure 1</a>. 
The sub-tree is from ingress PE1 via next hop node P1 towards PE2 
to PE9.

PE1 sends P1 the packet as shown in 
<a href="#pkt-mrh-2p1" class="xref">Figure 10</a>.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
<section id="section-5.2">
        <h3 id="name-procedure-behavior-on-trans">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-procedure-behavior-on-trans" class="section-name selfRef">Procedure/Behavior on Transit Node</a>
        </h3>
<p id="section-5.2-1">When a transit node of a P2MP path/tree receives a packet 
transported by the P2MP path/tree,  
the node determines whether the current routing header is a MRH. 
After determining that it is a MRH, the node executes the 
procedure to duplicate the packet for each of the downstream links 
of the node on the P2MP path/tree and send the packet copy to next hop 
(i.e., downstream node) of the link.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">Suppose that the transit node receives the packet from a 
upstream link from a upstream node to the transit node and there 
are n downstream links from the transit node on the P2MP path/tree 
(i.e., there are n branches/sub-trees from the transit node on 
the P2MP path/tree, where n is greater than zero).<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.2-3">The information about the upstream link is in b and nB field 
of the MRH. When b = 0, nB field contains the number of branches 
from the transit node. 
The information about n downstream links is pointed by SL. 
When b = 1, the number of branches from the transit node is 
the number of bits with value 1 in the Bits field of the Bits+ 
fields pointed by SL. 
The information about n downstream links is encoded by the Bits 
field and the fields following the Bits field.<a href="#section-5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.2-4">For example, when node P1 receives the packet transported 
by the P2MP path/tree in <a href="#p2mp-path-R-L14" class="xref">Figure 1</a> 
from ingress PE1, the MRH is illustrated in 
<a href="#pkt-mrh-2p1" class="xref">Figure 10</a>. 

The b = 1, the Bits field of the Bits+ fields pointed by SL = 11 
has 4 bits with value 1. 
So there are 4 branches from P1. 
The information about 4 downstream links 
(i.e., link from P1 to P2, link from P1 to P3, link from P1 to PE8 
and link from P1 to PE9) is encoded by the Bits field and 
the reduced fields for these 4 links following the Bits field.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.2-5">For each of the downstream links of the transit node, the 
transit node duplicates the packet for the link, sets SL, b and nB 
in the packet copy accordingly. 
If the next hop is a leaf (i.e., egress), the transit node sets SL to 0; 
otherwise, the transit node sets SL, b and nB to the value of 
S-Branches+, B and N-Branches for the link respectively when B is 0. 
When B = 1, the transit node sets SL and b to the value of 
S-Branches+ and B for the link respectively. 
The transit node finds the IPv6 address of the next hop 
(i.e., the downstream node) of the link from the neighbor IPv6 address 
table of the transit node using the link number of the link, 
sets the DA of the packet copy to the IPv6 address of the next hop, 
sets the SA of the packet copy to the IPv6 address of the transit node, 
and sends the packet copy to the next hop of the link.<a href="#section-5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.2-6">For example, for the first downstream link from P1 (i.e., 
link from P1 to P2), P1 duplicates the packet for the link, 
sets SL to 6 (which is the value of the S-Branches+ field for the link), 
b to 0 (which is the value of B for the link) and nB to 2 
(which is the value of the N-Branches field for the link). 
P1 finds the IPv6 address of the next hop P2 of the link from 
the neighbor IPv6 address table of P1 using the link number 2 
of the link, sets the DA of the packet copy to the P2's IPv6 address, 
sets the SA of the packet copy to the P1's IPv6 address, 
and sends the packet copy to P2. 
The packet copy received by P2 is shown in 
<a href="#pkt-mrh-2p2" class="xref">Figure 11</a>.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.2-7">For the second downstream link from P1 
(i.e., link from P1 to P3), P1 duplicates the packet for the link, 
sets SL, b and nB to 4, 0 and 1 respectively, 
which are the values of S-Branches+, B and N-Branches for the link 
from P1 to P3 respectively. 
P1 finds the IPv6 address of the next hop P3 of the link from the 
neighbor IPv6 address table of P1 using the link number 3 of the link, 
sets the DA of the packet copy to the P3's IPv6 address, 
sets the SA of the packet copy to the P1's IPv6 address, and 
sends the packet copy to P3. 
The packet copy received by P3 is illustrated in 
<a href="#pkt-mrh-2p3" class="xref">Figure 12</a>.<a href="#section-5.2-7" class="pilcrow">¶</a></p>
<p id="section-5.2-8">For the 3-th downstream link from P1 
(i.e., link from P1 to PE8), P1 duplicates the packet for the link, 
sets SL to 0 since PE8 is a leaf (i.e., egress). 
P1 finds the IPv6 address of the next hop PE8 of the link from the 
neighbor IPv6 address table of P1 using the link number 4 of the link, 
sets the DA of the packet copy to the PE8's IPv6 address, 
sets the SA of the packet copy to the P1's IPv6 address, 
and sends the packet copy to PE8.<a href="#section-5.2-8" class="pilcrow">¶</a></p>
</section>
<section id="section-5.3">
        <h3 id="name-procedure-behavior-on-egres">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-procedure-behavior-on-egres" class="section-name selfRef">Procedure/Behavior on Egress Node</a>
        </h3>
<p id="section-5.3-1">When an egress node of a P2MP path receives a packet 
transported by the path, the DA of the packet is the IPv6 address of the 
egress node and there is an indication in the MRH for the leaf/egress. 

The egress node proceeds to process the next header 
in the packet.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">For example, after receiving the IPv6 packet from P4, 
PE4 determines whether the packet's next header is a MRH. 
When the packet's next header is the MRH, PE4 checks if PE4 itself 
is a leaf (i.e., egress) through checking whether SL is 0. 
When PE4 is a leaf, PE4 decapsulates the packet and sends the IP 
multicast datagram to the IP multicast forwarding module.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
</section>
</section>
<div id="IANA">
<section id="section-6">
      <h2 id="name-iana-considerations-7">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations-7" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">
This document requests assigning a new Routing Type in the subregistry 
"Routing Types" under registry
"Internet Protocol Version 6 (IPv6) Parameters"
as follows:<a href="#section-6-1" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-6-2">
<pre>
   +===================+==========================+=============+
   | Value             | Description              | Reference   |
   +===================+==========================+=============+
   | TBD (7 suggested) | Multicast Routing Header |This document|
   +===================+==========================+=============+</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Security">
<section id="section-7">
      <h2 id="name-security-considerations-7">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-security-considerations-7" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-7-1">TBD<a href="#section-7-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Acknowledgements">
<section id="section-8">
      <h2 id="name-acknowledgements-5">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-acknowledgements-5" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-8-1">The authors would like to thank Donald Eastlake
         for the valuable comments and suggestions on this draft.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references-5">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references-5" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references-6">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references-6" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8200">[RFC8200]</dt>
      <dd>
<span class="refAuthor">Deering, S.</span> and <span class="refAuthor">R. Hinden</span>, <span class="refTitle">"Internet Protocol, Version 6 (IPv6) Specification"</span>, <span class="seriesInfo">STD 86</span>, <span class="seriesInfo">RFC 8200</span>, <span class="seriesInfo">DOI 10.17487/RFC8200</span>, <time datetime="2017-07" class="refDate">July 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8200">https://www.rfc-editor.org/info/rfc8200</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references-6">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references-6" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.chen-pim-srv6-p2mp-path">[I-D.chen-pim-srv6-p2mp-path]</dt>
        <dd>
<span class="refAuthor">Chen, H.</span>, <span class="refAuthor">McBride, M.</span>, <span class="refAuthor">Fan, Y.</span>, <span class="refAuthor">Li, Z.</span>, <span class="refAuthor">Geng, X.</span>, <span class="refAuthor">Toy, M.</span>, <span class="refAuthor">Mishra, G. S.</span>, <span class="refAuthor">Wang, A.</span>, <span class="refAuthor">Liu, L.</span>, and <span class="refAuthor">X. Liu</span>, <span class="refTitle">"Stateless SRv6 Point-to-Multipoint Path"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-chen-pim-srv6-p2mp-path-05</span>, <time datetime="2021-11-11" class="refDate">11 November 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-chen-pim-srv6-p2mp-path-05.txt">https://www.ietf.org/archive/id/draft-chen-pim-srv6-p2mp-path-05.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-pim-sr-p2mp-policy">[I-D.ietf-pim-sr-p2mp-policy]</dt>
      <dd>
<span class="refAuthor">(editor), D. V.</span>, <span class="refAuthor">Filsfils, C.</span>, <span class="refAuthor">Parekh, R.</span>, <span class="refAuthor">Bidgoli, H.</span>, and <span class="refAuthor">Z. Zhang</span>, <span class="refTitle">"Segment Routing Point-to-Multipoint Policy"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-pim-sr-p2mp-policy-03</span>, <time datetime="2021-08-23" class="refDate">23 August 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-pim-sr-p2mp-policy-03.txt">https://www.ietf.org/archive/id/draft-ietf-pim-sr-p2mp-policy-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses-7">
<a href="#name-authors-addresses-7" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Huaimo Chen</span></div>
<div dir="auto" class="left"><span class="org">Futurewei</span></div>
<div dir="auto" class="left">
<span class="locality">Boston, MA</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:Huaimo.chen@futurewei.com" class="email">Huaimo.chen@futurewei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mike McBride</span></div>
<div dir="auto" class="left"><span class="org">Futurewei</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:michael.mcbride@futurewei.com" class="email">michael.mcbride@futurewei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yanhe Fan</span></div>
<div dir="auto" class="left"><span class="org">Casa Systems</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yfan@casa-systems.com" class="email">yfan@casa-systems.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Zhenbin Li</span></div>
<div dir="auto" class="left"><span class="org">Huawei</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:lizhenbin@huawei.com" class="email">lizhenbin@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Xuesong Geng</span></div>
<div dir="auto" class="left"><span class="org">Huawei</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:gengxuesong@huawei.com" class="email">gengxuesong@huawei.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mehmet Toy</span></div>
<div dir="auto" class="left"><span class="org">Verizon</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mehmet.toy@verizon.com" class="email">mehmet.toy@verizon.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Gyan S. Mishra</span></div>
<div dir="auto" class="left"><span class="org">Verizon</span></div>
<div dir="auto" class="left"><span class="street-address">13101 Columbia Pike</span></div>
<div dir="auto" class="left">
<span class="locality">Silver Spring</span>,  <span class="postal-code">MD 20904</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:301%20502-1347" class="tel">301 502-1347</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:gyan.s.mishra@verizon.com" class="email">gyan.s.mishra@verizon.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yisong Liu</span></div>
<div dir="auto" class="left"><span class="org">China Mobile</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:liuyisong@chinamobile.com" class="email">liuyisong@chinamobile.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Aijun Wang</span></div>
<div dir="auto" class="left"><span class="org">China Telecom</span></div>
<div dir="auto" class="left"><span class="street-address">Beiqijia Town, Changping District</span></div>
<div dir="auto" class="left"><span class="locality">Beijing</span></div>
<div dir="auto" class="left"><span class="postal-code">102209</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:wangaj3@chinatelecom.cn" class="email">wangaj3@chinatelecom.cn</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Lei Liu</span></div>
<div dir="auto" class="left"><span class="org">Fujitsu</span></div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:liulei.kddi@gmail.com" class="email">liulei.kddi@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Xufeng Liu</span></div>
<div dir="auto" class="left"><span class="org">Volta Networks</span></div>
<div dir="auto" class="left">
<span class="locality">McLean</span>, <span class="region">VA</span> </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:xufeng.liu.ietf@gmail.com" class="email">xufeng.liu.ietf@gmail.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
