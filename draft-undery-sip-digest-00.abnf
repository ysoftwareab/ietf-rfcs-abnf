challenge           = "SIPDigest" sipdigest-challenge 
    
sipdigest-challenge = 1# ( realm | [domain] | nonce | [opaque] |  
                         [stale]| [algorithm] | [auth-params] | 
                         header-options ) 
    
realm               = "realm" "=" realm-value 
realm-value         = quoted-string          ; See Appendix C of [2] 
domain              = "domain" "=" domain-value 
  
domain-value        = <"> SIP-URL <"> 
nonce               = "nonce" "=" nonce-value 
nonce-value         = quoted-string 
opaque              = "opaque" "=" quoted-string 
stale               = "stale" "=" ("true" | "false") 
algorithm           = "algorithm" "=" ("MD5" | token ) 
auth-params         = token "=" quoted-string 
header-options      = "header" "=" <"> 1#header-value <"> 
header-value        = "To" | "From" | "Contact" | "Expires" 
                         | "CSeq" | "CallID" | extension-header 
extension-header    = token 
    
nonce-value = time-stamp "-" H(time-stamp ":" request-uri ":" 
                   private-key) 
      
credentials       = "SIPDigest" sipdigest-response 
    
sipdigest-response   = 1# ( username | realm | nonce | digest-uri | 
                       sipresponse | [algorithm] | cnonce |  
                       [opaque] | nonce-count | [auth-param] | 
                       header-options ) 
    
username          = "username" "=" username-value 
username-value    = quoted-string 
digest-uri        = "uri" "=" <"> SIP-URL <"> 
sipresponse       = "response" "=" siprequest-digest 
siprequest-digest = 32LHEX 
cnonce            = "cnonce" "=" cnonce-value 
cnonce-value      = quoted-string 
nonce-count       = "nc" "=" nc-value 
nc-value          = 8LHEX 
    
siprequest-digest = <"> H( unq(nonce-value) 
                       ":" nc-value 
                       ":" unq(cnonce-value) 
                       ":" S1 
                       ":" S2 ) <"> 
    
          [[ Author's note I've reduced the amount of 
            hashing, and as a result had to rearrange the 
            digest to prevent a Man in the Middle attack 
            where a nonce is constructed and HTTP digest used 
            to fool a client into providing SIP Digest 
            credentials unwittingly when it doesn't use a 
            cnonce. ]] 
    
    
S1 = H(unq(username-value) 
        ":" unq(realm-value) 
        ":" passwd ) 
    
S2            = Method ":" digest-uri-value ":" entity-body  
                   ":" header-list 
    
header-list   = *headers 
headers       = (to-addr | from-addr | contact-value 
  
to-addr       = To eol-marker 
from-addr     = From eol-marker 
contact-value = Contact eol-marker 
cseq-value    = CSeq eol-marker 
callid-value  = Call-ID eol-marker 
expires-value = Expires eol-marker 
other-value   = field-name ":" [field-value] eol-marker 
eol-marker    = <CR> <LF> 
    
nonce="9912345-0123456789abcdef0123456789abcdef",  
header="To From Expires Made-Up-Header" 
nonce="9912345-0123456789abcdef0123456789abcdef", 
uri="sip:example.com", response=fedcba9876543210fedcba9876543210, 
cnonce="9912390-12345678123456781234567812345678", nc=00000001, 
header="To From Expires Contact Made-Up-Header" 
