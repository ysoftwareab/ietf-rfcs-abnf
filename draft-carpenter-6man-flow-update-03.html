<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Update to the IPv6 flow label specification</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Update to the IPv6 flow label specification">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">6MAN</td><td class="header">B. Carpenter</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Univ. of Auckland</td></tr>
<tr><td class="header">Intended status: Informational</td><td class="header">S. Jiang</td></tr>
<tr><td class="header">Expires: November 8, 2010</td><td class="header">Huawei Technologies Co., Ltd</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">May 7, 2010</td></tr>
</table></td></tr></table>
<h1><br />Update to the IPv6 flow label specification<br />draft-carpenter-6man-flow-update-03</h1>

<h3>Abstract</h3>

<p>Various published proposals for use of the IPv6 flow label are incompatible with 
its existing specification in RFC 3697. 
This document proposes changes to the specification that permit additional use cases. The concept
of flow label domains is introduced, with the label possibly being rewritten at domain boundaries.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on November 8, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Normative Notation<br />
<a href="#spec">3.</a>&nbsp;
Proposed changes to specification<br />
<a href="#disc">4.</a>&nbsp;
Discussion<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
<a href="#iana">6.</a>&nbsp;
IANA Considerations<br />
<a href="#ack">7.</a>&nbsp;
Acknowledgements<br />
<a href="#changes">8.</a>&nbsp;
Change log<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#Appendix1">Appendix&nbsp;A.</a>&nbsp;
Alternative Approaches<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The flow label field in the IPv6 header is reserved but left experimental by <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> and
is specified by <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a>. We quote three rules
from that RFC:
</p>
<blockquote class="text"><dl>
<dt>a.</dt>
<dd>"The Flow Label value set by the source MUST be delivered unchanged to
   the destination node(s)."
</dd>
<dt>b.</dt>
<dd>"IPv6 nodes MUST NOT assume any mathematical or other properties
of the Flow Label values assigned by source nodes." 
</dd>
<dt>c.</dt>
<dd>"Router performance SHOULD NOT be dependent on the distribution of the Flow Label
values. Especially, the Flow Label bits alone make poor material for a hash key." 
</dd>
</dl></blockquote>
<p>The second rule appears to forbid a usage in which the bits of the flow label are encoded
with a specific semantic meaning. If the word "alone" is overlooked, the third rule has sometimes
been interpreted to forbid the use of the flow label by load balancing mechansims.
However, both before and after these rules were laid down, a considerable number
of proposals for use of the flow label have been published that seem incompatible with
them. An analysis is presented in <a class='info' href='#I-D.hu-flow-label-cases'>[I&#8209;D.hu&#8209;flow&#8209;label&#8209;cases]<span> (</span><span class='info'>Hu, Q. and B. Carpenter, &ldquo;Survey of proposed use cases for the IPv6 flow label,&rdquo; April&nbsp;2010.</span><span>)</span></a>, and examples are

<a class='info' href='#I-D.conta-ipv6-flow-label'>[I&#8209;D.conta&#8209;ipv6&#8209;flow&#8209;label]<span> (</span><span class='info'>Conta, A. and B. Carpenter, &ldquo;A proposal for the IPv6 Flow Label Specification,&rdquo; July&nbsp;2001.</span><span>)</span></a>,
<a class='info' href='#I-D.conta-diffserv-ipv6-fl-classifier'>[I&#8209;D.conta&#8209;diffserv&#8209;ipv6&#8209;fl&#8209;classifier]<span> (</span><span class='info'>Conta, A. and J. Rajahalme, &ldquo;Amodel for Diffserv use of the IPv6 Flow Label Specification,&rdquo; November&nbsp;2001.</span><span>)</span></a>,
<a class='info' href='#I-D.chakravorty-6lsa'>[I&#8209;D.chakravorty&#8209;6lsa]<span> (</span><span class='info'>Chakravorty, S., Bush, J., and J. Bound, &ldquo;IPv6 Label Switching Architecture,&rdquo; July&nbsp;2008.</span><span>)</span></a>,
<a class='info' href='#I-D.banerjee-flowlabel-ipv6-qos'>[I&#8209;D.banerjee&#8209;flowlabel&#8209;ipv6&#8209;qos]<span> (</span><span class='info'>Banerjee, R., &ldquo;A Modified Specification for use of the IPv6 Flow Label for providing An  efficient Quality of Service using hybrid approach,&rdquo; April&nbsp;2002.</span><span>)</span></a>,
<a class='info' href='#I-D.metzler-ipv6-flowlabel'>[I&#8209;D.metzler&#8209;ipv6&#8209;flowlabel]<span> (</span><span class='info'>Metzler, J. and S. Hauth, &ldquo;An end-to-end usage of the IPv6 flow label,&rdquo; November&nbsp;2000.</span><span>)</span></a>, 
<a class='info' href='#LeeKim'>[LeeKim]<span> (</span><span class='info'>Lee, I. and S. Kim, &ldquo;A QoS Improvement Scheme for Real-Time Traffic Using IPv6 Flow Labels,&rdquo; 2004.</span><span>)</span></a>,
<a class='info' href='#LinTseng'>[LinTseng]<span> (</span><span class='info'>Lin, C., Tseng, P., and W. Hwang, &ldquo;End-to-End QoS Provisioning by Flow Label in IPv6,&rdquo; 2006.</span><span>)</span></a>, and
<a class='info' href='#Prakash'>[Prakash]<span> (</span><span class='info'>Prakash, B., &ldquo;Using the 20 bit flow label field in the IPv6 header to indicate desirable quality of service on the internet,&rdquo; 2004.</span><span>)</span></a>.
These authors propose use cases in which some combination of the following
options apply:
</p>
<ul class="text">
<li>The flow label may be changed by intermediate systems. 
</li>
<li>It doesn't matter if the flow label is changed, because the receiver doesn't use it. 
</li>
<li>Some or all bits of the flow label are coded: they have specific meanings
 understood by routers and switches along the path. 
</li>
<li>The coding is related to the required quality of service, as well as identifying a flow. 
</li>
<li>The label is used to control forwarding or switching in some way. 
</li>
</ul>
<p>These proposals all require either some form of encoding of semantics
in the bits of the flow label, or the ability for routers to modify
the flow label, or both. Thus they appear to infringe the rules from RFC 3697 
quoted above.
</p>
<p>Although <a class='info' href='#I-D.roberts-inband-qos-ipv6'>[I&#8209;D.roberts&#8209;inband&#8209;qos&#8209;ipv6]<span> (</span><span class='info'>Roberts, L. and J. Harford, &ldquo;In-Band QoS Signaling for IPv6,&rdquo; July&nbsp;2005.</span><span>)</span></a> does not explicitly consider the flow label,
it requests hop-by-hop functionality in IPv6 packets very similar to what is needed by the
above proposals.
</p>
<p>We can conclude that a considerable number of researchers and designers are
stymied by RFC 3697. On the other hand, proposals such as
<a class='info' href='#I-D.martinbeckman-ietf-ipv6-fls-ipv6flowswitching'>[I&#8209;D.martinbeckman&#8209;ietf&#8209;ipv6&#8209;fls&#8209;ipv6flowswitching]<span> (</span><span class='info'>Beckman, M., &ldquo;IPv6 Dynamic Flow Label Switching (FLS),&rdquo; March&nbsp;2007.</span><span>)</span></a>,
<a class='info' href='#I-D.martinbeckman-ietf-ipv6-amp-ipv6hcamp'>[I&#8209;D.martinbeckman&#8209;ietf&#8209;ipv6&#8209;amp&#8209;ipv6hcamp]<span> (</span><span class='info'>Beckman, M., &ldquo;IPv6 Header Compression via Addressing Mitigation Protocol (IPv6 AMP),&rdquo; March&nbsp;2007.</span><span>)</span></a>,
<a class='info' href='#I-D.blake-ipv6-flow-label-nonce'>[I&#8209;D.blake&#8209;ipv6&#8209;flow&#8209;label&#8209;nonce]<span> (</span><span class='info'>Blake, S., &ldquo;Use of the IPv6 Flow Label as a Transport-Layer Nonce to Defend Against Off-Path Spoofing Attacks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, and
<a class='info' href='#I-D.carpenter-flow-ecmp'>[I&#8209;D.carpenter&#8209;flow&#8209;ecmp]<span> (</span><span class='info'>Carpenter, B. and S. Amante, &ldquo;Using the IPv6 flow label for equal cost multipath routing and link aggregation in tunnels,&rdquo; April&nbsp;2010.</span><span>)</span></a>
appear to be compatible with RFC 3697. The latter two are based on
the originator of a packet choosing a pseudo-random flow label for each flow.
Thus, we can also conclude that there is a useful
role for this approach too.  
</p>
<p>If our goal is for the flow label to be used in practice, the conflict between
these two approaches creates a dilemma. There appear to be two viable approaches: 
</p>
<ol class="text">
<li>Definitively forbid locally defined use of the flow label. 
Strengthen RFC 3697 to say that hosts SHOULD set
a pseudo-random label value, which would clarify and limit its possible uses.
In particular, its use for load balancing and possibly as a nonce would be encouraged. 
</li>
<li>Encourage locally defined use of the flow label. This approach would make the flow
label mutable and would exclude any use case depending on end-to-end immutability. It
would encourage applications of a pseudo-random flow label, such as load balancing,
on a local basis, but it would exclude end-to-end applications such as 
<a class='info' href='#I-D.blake-ipv6-flow-label-nonce'>[I&#8209;D.blake&#8209;ipv6&#8209;flow&#8209;label&#8209;nonce]<span> (</span><span class='info'>Blake, S., &ldquo;Use of the IPv6 Flow Label as a Transport-Layer Nonce to Defend Against Off-Path Spoofing Attacks,&rdquo; October&nbsp;2009.</span><span>)</span></a>. 
</li>
</ol>
<p>This document is in the form of a set of proposed modifications to the standard, 
expressing approach 2 and written in normative form. It is suggested that
if the proposal is generally accepted, a revised version of RFC 3697 should be produced
including these changes.
Alternatively, a much simpler revision to express approach 1 above could be chosen.
 
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Normative Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="spec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Proposed changes to specification</h3>

<p>Although RFC 3697 requires the flow label to be delivered
unchanged, it is not included in any transport layer pseudo-header checksums
nor in IPsec authentication <a class='info' href='#RFC4302'>[RFC4302]<span> (</span><span class='info'>Kent, S., &ldquo;IP Authentication Header,&rdquo; December&nbsp;2005.</span><span>)</span></a>.  
Both RFC 2460 and RFC 3697 define the default flow label to be zero. 
At the time of writing, this is the observed value in an
overwhelming proportion of IPv6 packets; neither operating systems nor
applications currently set it, and routers do not rely on it. Thus there is no reason
to expect operational difficulties if a careful change is made to the rules of RFC 3697. 
</p>
<p>In particular, the facts that the label is not checksummed and not used mean
that the current immutability of the label can be changed without any operational
consequences. 
</p>
<p>The purpose of the proposed change is that the flow label should be
available for domain-specific use, with locally defined semantics, without
preventing a default type of generic usage. The proposed generic usage is to
enourage pseudo-random flow labels that can be used to assist load balancing.
There should be no impact on specifications other than RFC 3697 and no impact on currently
operational software and hardware. 
</p>
<p>Firstly we define a "Flow Label Domain" by direct analogy with a Differentiated
Services Domain <a class='info' href='#RFC2474'>[RFC2474]<span> (</span><span class='info'>Nichols, K., Blake, S., Baker, F., and D. Black, &ldquo;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers,&rdquo; December&nbsp;1998.</span><span>)</span></a>: 
</p>
<blockquote class="text">
<p>Flow Label Domain (also FL domain): a contiguous portion of the Internet
   over which a consistent scheme of flow label mechanisms is
   administered in a coordinated fashion.  A flow label
   domain can represent different administrative domains or autonomous
   systems, different trust regions, different network layer technologies,
   hosts and routers, etc.  
</p>
<p>Flow Label Boundary (also FL boundary): the edge of an FL domain.  A
   flow label boundary can be further sub-divided into
   ingress and egress nodes, where the ingress/egress nodes are the
   downstream/upstream nodes of a boundary link in a given traffic
   direction.  A flow label boundary is typically found at
   the ingress to the first-hop flow label router
   (or network node) that a host's packets traverse, or at the egress of
   the last-hop flow label router (or network node)
   that packets traverse before arriving at a host. A flow
   label boundary may be co-located with a host, subject to local
   policy.  
</p>
<p>Flow Label Router (also FL router): a router that sets or interprets the flow label
   according to the mechanisms used in a given FL domain. 
</p>
</blockquote>
<p>The rules of RFC 3697 are modified as follows: 
</p>
<ol class="text">
<li>An FL domain implements a local scheme of flow label mechanisms. The
RECOMMENDED scheme is that, whether set by the source host according to RFC 3697, 
or by an FL router according to the rules below, the label contains a pseudo-random 
value between 1 and 0xFFFFF. This recommendation constrains the choice of flow label 
value more than RFC 3697. An FL domain MAY define an alternative scheme. 
</li>
<li>If and only if the flow label in an IPv6 packet has the default value of zero, then an FL router MAY
set it to a value between between 1 and 0xFFFFF. This option modifies the rule that the flow label must be
delivered unchanged, by allowing a router in an FL domain to set it if the source host did not
set it. 
</li>
<li>If this is done, all packets in a given flow MUST be given the same flow label value.
A flow is defined in this case as all packets with the same source and destination IPv6
addresses and port numbers and the same transport protocol number, i.e., the same
final Next Header value <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a>. This rule constrains the definition of a flow
in RFC 3697 for the specific case that a router sets the flow label. It should be noted that an
FL router applying this rule will be obliged to inspect the IPv6 header of every packet,
including finding the last "next header" field in the packet, at full line speed. 
</li>
<li>Hosts connected to an FL domain MUST be configured either to set a default (zero) flow 
label in all IPv6 packets, or to apply the locally defined scheme (which, by rule 1,
SHOULD be the pseudo-random scheme). 
</li>
<li>When a locally defined scheme other than the pseudo-random scheme is used, packets entering
the FL domain from outside might contain an invalid label according to that scheme. Therefore,
boundary ingress FL routers MUST treat all packets entering such an FL domain as if they had a 
default (zero) flow label. 
</li>
<li>When a locally defined scheme  other than the pseudo-random scheme is used, packets 
leaving the FL domain might contain
a label that would be misinterpreted elsewhere. Therefore, the boundary egress FL router
SHOULD set the label according to the pseudo-random mechanism defined in rule 1. If not,
it MUST set the label to the default value of zero. 
</li>
</ol>
<p>The following are the consequences of the above rules combined with those in RFC 3697:
</p>
<ul class="text">
<li>Sending hosts that are not updated will in practice continue to send all-zero labels. If there
is no locally defined scheme in use along the path taken by a packet, the label
will be delivered as zero. 
</li>
<li>Sending hosts conforming to this specification will by default choose pseudo-random 
labels between 1 and 0xFFFFF. 
</li>
<li>Locally defined behaviour of the flow label will be limited to consistent
administratively defined domains. 
</li>
<li>Sending hosts wishing to use locally defined behaviour may continue to send
all-zero labels, relying on a router in the local flow label domain to set a value
according to the rules above.
Alternatively, they may set a label according to locally defined rules. 
</li>
<li>Routers wishing to implement a locally defined behaviour will 
set a label according to the rules above, if and only if the incoming
flow label is all-zero, according to rule 1 above. 
</li>
<li>The flow label is no longer immutable if it crosses a FL domain boundary. This will allow
a wide range of uses cases previously forbidden, and will allow the ECMP/LAG usage defined
in <a class='info' href='#I-D.carpenter-flow-ecmp'>[I&#8209;D.carpenter&#8209;flow&#8209;ecmp]<span> (</span><span class='info'>Carpenter, B. and S. Amante, &ldquo;Using the IPv6 flow label for equal cost multipath routing and link aggregation in tunnels,&rdquo; April&nbsp;2010.</span><span>)</span></a>. However, it will break the usage proposed
in <a class='info' href='#I-D.blake-ipv6-flow-label-nonce'>[I&#8209;D.blake&#8209;ipv6&#8209;flow&#8209;label&#8209;nonce]<span> (</span><span class='info'>Blake, S., &ldquo;Use of the IPv6 Flow Label as a Transport-Layer Nonce to Defend Against Off-Path Spoofing Attacks,&rdquo; October&nbsp;2009.</span><span>)</span></a>. 
</li>
</ul>
<a name="disc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Discussion</h3>

<p>Hosts that set a default (zero) flow label and ignore the flow label on receipt will be unaffected 
by implementations of this specification. In general, it is assumed that hosts will ignore the
flow label on receipt; it cannot be safely used as an end-to-end transport or application layer
signal of any kind. 
</p>
<p>Routers that ignore
the flow label will be unaffected by implementations of this specification. 
</p>
<p>Hosts that set a default (zero) flow label and are in an FL domain where routers
adopt a locally defined scheme, or the pseudo-random mechanism in <a class='info' href='#spec'>Section&nbsp;3<span> (</span><span class='info'>Proposed changes to specification</span><span>)</span></a>, will benefit from
whatever flow label handling is used in the local domain. 
Clearly, the rules b and c quoted from RFC 3697 in <a class='info' href='#intro'>Section&nbsp;1<span> (</span><span class='info'>Introduction</span><span>)</span></a>
have no effect within the local domain, where the locally defined rules
(whatever they are) replace them. 
</p>
<p>Hosts and routers that adopt the pseudo-random mechanism
will enhance the performance of any load balancing devices that include the flow label
in the hash used to select a particular path or server, even when
packets leave the local FL domain. Again, rules b and c have no effect. 
</p>
<p>The rules defined in this proposal are intended to allow encourage the adoption
of pseudo-random flow labels in the general case, but also allow a wide variety of locally defined schemes.
Such schemes do not need any global assignments of bits in the flow label,
and should not have noticeable impact on backwards compatibility or
on domains not using them. 
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>The flow label is not protected in any way and can be forged by an on-path
attacker.  On the other hand, a pseudo-random flow label cannot be readily
guessed by an off-path attacker. See RFC 3697 for further discussion. 
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>This document requests no action by IANA. 
</p>
<a name="ack"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>The authors are grateful to Qinwen Hu for general
discussion about the flow label and for his work in searching the literature.
Valuable comments and contributions were made by
Shane Amante,
Fred Baker,
Steve Blake,
Remi Despres,
Joel Halpern,
Chris Morrow,
Mark Smith,
and other participants in the 6man working group.
</p>
<p>This document was produced using the xml2rfc tool
<a class='info' href='#RFC2629'>[RFC2629]<span> (</span><span class='info'>Rose, M., &ldquo;Writing I-Ds and RFCs using XML,&rdquo; June&nbsp;1999.</span><span>)</span></a>.
</p>
<a name="changes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Change log</h3>

<p>draft-carpenter-6man-flow-update-03: futher simplified according to WG discussion, 2010-05-07
</p>
<p>draft-carpenter-6man-flow-update-02: revised and simplified according to WG discussion, 2010-04-13
</p>
<p>draft-carpenter-6man-flow-update-01: revised according to mail list discussion, 2010-03-05
</p>
<p>draft-carpenter-6man-flow-update-00: original version, 2010-02-18
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3697">[RFC3697]</a></td>
<td class="author-text">Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3697">IPv6 Flow Label Specification</a>,&rdquo; RFC&nbsp;3697, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3697.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.banerjee-flowlabel-ipv6-qos">[I-D.banerjee-flowlabel-ipv6-qos]</a></td>
<td class="author-text">Banerjee, R., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-banerjee-flowlabel-ipv6-qos-03.txt">A Modified Specification for use of the IPv6 Flow Label for providing An  efficient Quality of Service using hybrid approach</a>,&rdquo; draft-banerjee-flowlabel-ipv6-qos-03 (work in progress), April&nbsp;2002 (<a href="http://www.ietf.org/internet-drafts/draft-banerjee-flowlabel-ipv6-qos-03.txt">TXT</a>, <a href="http://www.ietf.org/internet-drafts/draft-banerjee-flowlabel-ipv6-qos-03.ps">PS</a>, <a href="http://www.ietf.org/internet-drafts/draft-banerjee-flowlabel-ipv6-qos-03.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.blake-ipv6-flow-label-nonce">[I-D.blake-ipv6-flow-label-nonce]</a></td>
<td class="author-text">Blake, S., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-blake-ipv6-flow-label-nonce-02.txt">Use of the IPv6 Flow Label as a Transport-Layer Nonce to Defend Against Off-Path Spoofing Attacks</a>,&rdquo; draft-blake-ipv6-flow-label-nonce-02 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-blake-ipv6-flow-label-nonce-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.carpenter-flow-ecmp">[I-D.carpenter-flow-ecmp]</a></td>
<td class="author-text">Carpenter, B. and S. Amante, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-carpenter-flow-ecmp-02.txt">Using the IPv6 flow label for equal cost multipath routing and link aggregation in tunnels</a>,&rdquo; draft-carpenter-flow-ecmp-02 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-carpenter-flow-ecmp-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.chakravorty-6lsa">[I-D.chakravorty-6lsa]</a></td>
<td class="author-text">Chakravorty, S., Bush, J., and J. Bound, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-chakravorty-6lsa-03.txt">IPv6 Label Switching Architecture</a>,&rdquo; draft-chakravorty-6lsa-03 (work in progress), July&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-chakravorty-6lsa-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.conta-diffserv-ipv6-fl-classifier">[I-D.conta-diffserv-ipv6-fl-classifier]</a></td>
<td class="author-text">Conta, A. and J. Rajahalme, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-conta-diffserv-ipv6-fl-classifier-01.txt">Amodel for Diffserv use of the IPv6 Flow Label Specification</a>,&rdquo; draft-conta-diffserv-ipv6-fl-classifier-01 (work in progress), November&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.conta-ipv6-flow-label">[I-D.conta-ipv6-flow-label]</a></td>
<td class="author-text">Conta, A. and B. Carpenter, &ldquo;A proposal for the IPv6 Flow Label Specification,&rdquo; draft-conta-ipv6-flow-label-02&nbsp;(work in progress), July&nbsp;2001.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.hu-flow-label-cases">[I-D.hu-flow-label-cases]</a></td>
<td class="author-text">Hu, Q. and B. Carpenter, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-hu-flow-label-cases-00.txt">Survey of proposed use cases for the IPv6 flow label</a>,&rdquo; draft-hu-flow-label-cases-00 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-hu-flow-label-cases-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.martinbeckman-ietf-ipv6-amp-ipv6hcamp">[I-D.martinbeckman-ietf-ipv6-amp-ipv6hcamp]</a></td>
<td class="author-text">Beckman, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-martinbeckman-ietf-ipv6-amp-ipv6hcamp-01.txt">IPv6 Header Compression via Addressing Mitigation Protocol (IPv6 AMP)</a>,&rdquo; draft-martinbeckman-ietf-ipv6-amp-ipv6hcamp-01 (work in progress), March&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-martinbeckman-ietf-ipv6-amp-ipv6hcamp-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.martinbeckman-ietf-ipv6-fls-ipv6flowswitching">[I-D.martinbeckman-ietf-ipv6-fls-ipv6flowswitching]</a></td>
<td class="author-text">Beckman, M., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-martinbeckman-ietf-ipv6-fls-ipv6flowswitching-03.txt">IPv6 Dynamic Flow Label Switching (FLS)</a>,&rdquo; draft-martinbeckman-ietf-ipv6-fls-ipv6flowswitching-03 (work in progress), March&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-martinbeckman-ietf-ipv6-fls-ipv6flowswitching-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.metzler-ipv6-flowlabel">[I-D.metzler-ipv6-flowlabel]</a></td>
<td class="author-text">Metzler, J. and S. Hauth, &ldquo;An end-to-end usage of the IPv6 flow label,&rdquo; draft-metzler-ipv6-flowlabel-00&nbsp;(work in progress), November&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.roberts-inband-qos-ipv6">[I-D.roberts-inband-qos-ipv6]</a></td>
<td class="author-text">Roberts, L. and J. Harford, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-roberts-inband-qos-ipv6-00.txt">In-Band QoS Signaling for IPv6</a>,&rdquo; draft-roberts-inband-qos-ipv6-00 (work in progress), July&nbsp;2005 (<a href="http://www.ietf.org/internet-drafts/draft-roberts-inband-qos-ipv6-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="LeeKim">[LeeKim]</a></td>
<td class="author-text">Lee, I. and S. Kim, &ldquo;A QoS Improvement Scheme for Real-Time Traffic Using IPv6 Flow Labels,&rdquo; Lecture Notes in Computer Science&nbsp;Vol. 3043, 2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="LinTseng">[LinTseng]</a></td>
<td class="author-text">Lin, C., Tseng, P., and W. Hwang, &ldquo;End-to-End QoS Provisioning by Flow Label in IPv6,&rdquo; JCIS&nbsp;, 2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="Prakash">[Prakash]</a></td>
<td class="author-text">Prakash, B., &ldquo;Using the 20 bit flow label field in the IPv6
header to indicate desirable quality of service on the
internet,&rdquo; University of Colorado&nbsp;(M.Sc. Thesis), 2004.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2474">[RFC2474]</a></td>
<td class="author-text"><a href="mailto:kmn@cisco.com">Nichols, K.</a>, <a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:fred@cisco.com">Baker, F.</a>, and <a href="mailto:black_david@emc.com">D. Black</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>,&rdquo; RFC&nbsp;2474, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2474.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2474.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2474.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2629">[RFC2629]</a></td>
<td class="author-text"><a href="mailto:mrose@not.invisible.net">Rose, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2629">Writing I-Ds and RFCs using XML</a>,&rdquo; RFC&nbsp;2629, June&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2629.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2629.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2629.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4302">[RFC4302]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4302">IP Authentication Header</a>,&rdquo; RFC&nbsp;4302, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4302.txt">TXT</a>).</td></tr>
</table>

<a name="Appendix1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Alternative Approaches</h3>

<p>Two more complex alternative approaches were considered and rejected. 
</p>
<p>The first was to distinguish locally significant flow labels from those
conforming to RFC 3697 by setting or clearing the most significant bit (MSB)
of the flow label. This led to quite complicated rules, seems impossible
to make fully self-consistent, and was not considered practical. 
</p>
<p>The second was to use  a specific differentiated
services code point (DSCP)<a class='info' href='#RFC2474'>[RFC2474]<span> (</span><span class='info'>Nichols, K., Blake, S., Baker, F., and D. Black, &ldquo;Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers,&rdquo; December&nbsp;1998.</span><span>)</span></a> in the Traffic Class octet 
instead of the MSB of the flow label itself, to flag a locally defined behaviour.
A more elaborate version of this was proposed
in <a class='info' href='#I-D.martinbeckman-ietf-ipv6-fls-ipv6flowswitching'>[I&#8209;D.martinbeckman&#8209;ietf&#8209;ipv6&#8209;fls&#8209;ipv6flowswitching]<span> (</span><span class='info'>Beckman, M., &ldquo;IPv6 Dynamic Flow Label Switching (FLS),&rdquo; March&nbsp;2007.</span><span>)</span></a>.
There are two issues with this approach. One is that DSCP values
are themselves only locally significant, inconsistent with the end-to-end nature
of the original flow label definition. Secondly, it seems unwise to meld the
semantics of differentiated services, which are currently deployed,
with the unknown future semantics of flow label usage. However, this approach,
while not recommended, does not appear to violate any basic principles if applied
strictly within a single differentiated services domain that is also
a flow label domain. 
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Carpenter</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of Auckland</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PB 92019</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Auckland,   1142</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">New Zealand</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:brian.e.carpenter@gmail.com">brian.e.carpenter@gmail.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sheng Jiang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies Co., Ltd</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">KuiKe Building, No.9 Xinxi Rd.,</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Shang-Di Information Industry Base, Hai-Dian District, Beijing</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R. China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:shengjiang@huawei.com">shengjiang@huawei.com</a></td></tr>
</table>
</body></html>
