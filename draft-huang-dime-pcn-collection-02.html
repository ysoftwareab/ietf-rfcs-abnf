<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The Diameter Precongestion Notification (PCN) Data Collection Application</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The Diameter Precongestion Notification (PCN) Data Collection Application">
<meta name="keywords" content="precongestion, Diameter, AAA, PCN">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">F. Huang</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">T. Taylor</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">Expires: April 29, 2010</td><td class="header">G. Zorn, Ed.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Network Zen</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 26, 2009</td></tr>
</table></td></tr></table>
<h1><br />The Diameter Precongestion Notification (PCN) Data Collection Application<br />draft-huang-dime-pcn-collection-02</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 29, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
			Pre-Congestion notification (PCN) is a technique for maintaining QoS for inelastic flows in a DIFFServ domain.
			The PCN architecture requires that egress nodes send reports of congestion-related events reliably to a policy decision point. 
			The policy decision point might be located in different places of the network.
			In one architectural variant the policy decision point is a central node rather than co-located with the ingress or the egress nodes of the network.
			In this case it needs to have access to certain information from the edge nodes.
			This memo defines a Diameter application to support the ingress and the egress node to interact with the Diameter server acting as a policy decision point.
		
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Language<br />
<a href="#procs">3.</a>&nbsp;
Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#overall_proc">3.1.</a>&nbsp;
Overall Procedures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#egress_proc">3.2.</a>&nbsp;
Egress Node behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#PDP_proc">3.3.</a>&nbsp;
PDP behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ingress_proc">3.4.</a>&nbsp;
Ingress Node behavior<br />
<a href="#dime_app">4.</a>&nbsp;
Diameter PCN Data Collection Application<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#app_sp">4.1.</a>&nbsp;
Advertising Application Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">4.2.</a>&nbsp;
Session Management<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#commands">4.3.</a>&nbsp;
Commands<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#crr_cmd">4.3.1.</a>&nbsp;
Congestion-Report-Request (CRR) Command<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#cra_cmd">4.3.2.</a>&nbsp;
Congestion-Report-Answer (CRA) Command<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mpr_cmd">4.3.3.</a>&nbsp;
Measurement-Poll-Request (MPR) Command<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#mpa_cmd">4.3.4.</a>&nbsp;
Measurement-Poll-Answer (MPA) Command<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#avps">4.4.</a>&nbsp;
Attribute Value Pairs (AVPs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#IEAggId_AVP">4.4.1.</a>&nbsp;
I-E-Aggregate-Id AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ingressAddr_AVP">4.4.2.</a>&nbsp;
PCN-Ingress-Node-Address AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#egressAddr_AVP">4.4.3.</a>&nbsp;
PCN-Egress-Node-Address AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ipAddr_AVP">4.4.4.</a>&nbsp;
Framed-IP-Address AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ipv6Addr_AVP">4.4.5.</a>&nbsp;
Framed-IPv6-prefix AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#vlanid_AVP">4.4.6.</a>&nbsp;
VLAN-ID-Range AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#coninfo_AVP">4.4.7.</a>&nbsp;
PCN-Congestion-Info AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#CLEvalue_AVP">4.4.8.</a>&nbsp;
CLE-Value AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rptreason_AVP">4.4.9.</a>&nbsp;
CLE-Report-Reason AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#excess_AVP">4.4.10.</a>&nbsp;
PCN-Excess-Flow-Info AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rate_AVP">4.4.11.</a>&nbsp;
I-E-Aggregate-Excess-Rate AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#classifier_AVP">4.4.12.</a>&nbsp;
Classifier AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sent_AVP">4.4.13.</a>&nbsp;
PCN-Sent-Info AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sentrate_AVP">4.4.14.</a>&nbsp;
I-E-Aggregate-Sent-Rate AVP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#occurrence_Table">4.5.</a>&nbsp;
AVP Occurrence Tables<br />
<a href="#IANA">5.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.1.</a>&nbsp;
Diameter Application Identifier<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">5.2.</a>&nbsp;
Diameter Command Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">5.3.</a>&nbsp;
Attribute-Value Pairs<br />
<a href="#Security">6.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.1.</a>&nbsp;
Traffic Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.2.</a>&nbsp;
Device Security<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#anchor11">Appendix&nbsp;A.</a>&nbsp;
Related Work in ITU-T<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
			The objective of Pre-Congestion Notification (PCN) is to protect the
			quality of service (QoS) of inelastic flows within a Diffserv domain <a class='info' href='#RFC2475'>[RFC2475]<span> (</span><span class='info'>Blake, S., Black, D., Carlson, M., Davies, E., Wang, Z., and W. Weiss, &ldquo;An Architecture for Differentiated Services,&rdquo; December&nbsp;1998.</span><span>)</span></a> in
			a simple, scalable and robust fashion. 
			Admission control allows to decide whether to admit or reject a new flow request,
			and (in abnormal circumstances, such as router failure) to provide flow termination of already admitted flows.
			These two mechanisms together aim to protect the QoS properties of previously admitted flows.
			To achieve this, the overall rate of the PCN traffic is metered on every link in the PCN domain,
			and PCN packets are appropriately marked when certain configured rates are exceeded.
			These configured rates are below the rate of the link thus providing notification before any congestion occurs ("pre-congestion notification").
			The level of marking allows decisions to be made about whether to admit or terminate.
			A more detailed description of the architecture can be found in <a class='info' href='#RFC5559'>[RFC5559]<span> (</span><span class='info'>Eardley, P., &ldquo;Pre-Congestion Notification (PCN) Architecture,&rdquo; June&nbsp;2009.</span><span>)</span></a>.
		
</p>
<p>
			Marking statistics are gathered by egress nodes on a per-ingress-egress aggregate basis. 
			They are processed to determine whether new flows can be admitted to the aggregate over
			the next measurement interval and whether some flows should be terminated to protect QoS for the remainder (flow termination is expected to be relatively infrequent, typically a result of network failure).
			The admission state is based on a congestion level estimate (CLE), 
			which the egress node reports to a decision point whenever the CLE value passes a set threshold (upward or downward). 
			The decision to terminate flows is made on the basis of a different criterion. 
			When the egress node detects that this criterion has been satisfied, it sends a report to the decision node providing measurement
			values that are used to determine the total volume of traffic that must be terminated. If equal cost multipath (ECMP) routing is in use, it also sends a list of individual flows that were marked at the termination level.
		
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Language</h3>

<p>
			The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
			"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
			document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
	   
</p>
<a name="procs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Procedures</h3>

<p>
			The following subsections discuss the processing requirements placed upon the various participating Diameter nodes by the PCN Data Collection application. 
		
</p>
<a name="overall_proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Overall Procedures</h3>

<p>
			The egress node measures the traffic from a particular ingress node, and calculates the congestion level estimate(CLE) at the ingress-egress aggregate level. 
			The egress node may compare the CLE calculated at the current interval with the CLE calculated at the last interval, 
			if the difference of the two CLEs exceeds a preset range, the egress node sends the feedback information, including at least the current CLE, to the PDP. 
			After receiving the feedback information, the PDP saves the it for admission control and flow termination.
			After receiving a service flow request, the PDP can determine whether to admit the request or not based on the feedback information. 
			Besides, the PDP also decides whether some of the admitted flows need to be terminated. The PDP needs to signal to the ingress node the decision about admission or termination.
			
</p>
<a name="egress_proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Egress Node behavior</h3>

<p>
				For each ingress-egress aggregate flow it serves, the egress node meters received traffic for PCN markings, 
				recomputes its smoothed congestion level estimate, 
				and determines whether there is excess flow in successive measurement periods in accordance with the PCN edge behavior specification                         
                           (e.g. <a class='info' href='#I-D.ietf-pcn-cl-edge-behaviour'>ietf-pcn-cl-edge-behaviour<span> (</span><span class='info'>Charny, A., Huang, F., Karagiannis, G., Menth, M., and T. Taylor, &ldquo;PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation,&rdquo; July&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;pcn&#8209;cl&#8209;edge&#8209;behaviour], 
                           <a class='info' href='#I-D.ietf-pcn-sm-edge-behaviour'>ietf-pcn-sm-edge-behaviour<span> (</span><span class='info'>Charny, A., Karagiannis, G., Menth, M., and T. Taylor, &ldquo;PCN Boundary Node Behaviour for the Single Marking (SM) Mode of Operation,&rdquo; July&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;pcn&#8209;sm&#8209;edge&#8209;behaviour]) deployed in the domain. 
				When a change in the smoothed congestion level estimate causes it to cross a reporting threshold, 
				either upward or downward, the egress node MUST send a Congestion-Report-Request message to the PDP. 
				Similarly, the egress node MUST send a Congestion-Report-Request message to the PDP when excess flow is detected for an ingress-egress aggregate served by that node. 
				<br />
<br />

				The Event-Timestamp AVP MUST be present, 
				and MUST provide the ending time of the measurement period from which the data triggering the generation of the message were derived. 
				At least one instance either of the PCN-Congestion-Info or the PCN-Excess-Flow-Info AVP MUST be present. 
				Both AVPs MAY be present for the same ingress-egress aggregate,
				if both apply according to the edge behavior specification. 
				Multiple instances of either AVP MAY be present, but each instance MUST report on a different ingress-egress aggregate.
			
</p>
<a name="PDP_proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
PDP behavior</h3>

<p>
				If the PDP receives an Congestion-Report-Request (CRR) identified as belonging to the PCN Data Collection application,
				it MUST acknowledge the message with an Congestion-Report-Answer (CRA). 
				The PDP usage of the information provided by PCN-Congestion-Info and PCN-Excess-Flow-Info AVPs is described in the applicable edge behavior specification.
                         	<br />
<br />

				When the PDP receives an CRR containing a PCN-Excess-Flow-Info AVP, it MAY send a
                                Measurement-Poll-Request (MPR) to the ingress node for the aggregate concerned.
                                The PDP will make the decision about sending the MPR depending on the content of the
                                received report. In case the report indicates that a critical threshold has been reached                    
                                then it has to obtain information about which and how many flows to terminate. 
				The I-E-Aggregate-Id MUST identify the ingress-egress aggregate flow for which information is being requested.
				The Event-Timestamp MUST be present if it was present in the CRR that contained the PCN-Excess-Flow-Info AVP, and MUST have the same value.
				<br />
<br />

				If the PDP receives a successful Measurement-Poll-Answer message,
				it uses the information contained in the PCN-Sent-Info AVP as described in the applicable edge behavior specification.
			
</p>
<a name="ingress_proc"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Ingress Node behavior</h3>

<p>
				When an ingress node receives an MPR, it MUST generate a Measurement-Poll-Answer message containing an instance of the PCN-Sent-Info AVP.
				The I-E-Aggregate-Id within the PCN-Sent-Info AVP MUST be the same as received in the MPR, and the I-E-Aggregate-Sent-Rate MUST be a rate measured for that aggregate.
				If Event-Timestamp is present in the MPR,
				the measurement upon which I-E-Aggregate-Sent-Rate is based SHOULD be that for the latest measurement period ending before or at the time given by Event-Timestamp, 
				if available.
				In any case, Event-Timestamp MUST be present in the MPA, and if it is, MUST give the end-time of the measurement period upon which I-E-Aggregate-Sent-Rate is based. 
			
</p>
<a name="dime_app"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Diameter PCN Data Collection Application</h3>

<a name="app_sp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Advertising Application Support</h3>

<p>
				Clients, servers, and proxies supporting the PCN Data Collection application MUST advertise
				support by including the value &lt;AID&gt; in the Auth-Application-Id of Congestion-Report-Request (CRR), Congestion-Report-Answer (CRA), Measurement-Poll-Request (MPR), 
				and Measurement-Poll-Answer (MPA) messages.
			
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Session Management</h3>

<p>
				Diameter sessions are implicitly terminated. An implicitly terminated session is one for which the server does not maintain session state information. 
				The client does not need to send any re-authorization or session termination requests to the server.
				The Diameter base protocol includes the Auth-Session-State AVP as the mechanism for the implementation of implicitly terminated sessions.
				The client (server) SHALL include in its requests (responses) the Auth-Session-State AVP set to the value NO_STATE_MAINTAINED (1), as described in <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588]. 
				As a consequence, the server does not maintain any state information about this session and the client does not need to send any session termination request. 
				Neither the Authorization-Lifetime AVP nor the Session-Timeout AVP SHALL be present in requests or responses.
			
</p>
<a name="commands"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Commands</h3>

<p>
				The PCN Data Collection application defines four new commands, Congestion-Report-Request(CRR), Congestion-Report-Answer(CRA), Measurement-Poll-Request (MPR) and Measurement-Poll-Answer (MPA).
			
</p>
<a name="crr_cmd"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Congestion-Report-Request (CRR) Command</h3>

<p>
					The egress node sends the Congestion-Report-Request (CRR) command, indicated by the Command-Code
					field set to &lt;CC1&gt; and the Command Flags' 'R' bit set, to report when the congestion level estimate (CLE) moves above or drops below the pre-congestion reporting threshold,
					or when an excess flow condition is detected. Multiple reports MAY be included in the same message, as described in <a class='info' href='#egress_proc'>Section&nbsp;3.2<span> (</span><span class='info'>Egress Node behavior</span><span>)</span></a>.
					<br />
<br />

					Message format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;CRR&gt; ::= &lt; Diameter Header: CC1, REQ, PXY &gt;
            &lt; Session-Id &gt;
            { Auth-Application-Id }
            { Auth-Session-State }
            { Origin-Host }
            { Origin-Realm }
            { Destination-Realm }
            [ Destination-Host ]
            [ Event-Timestamp ]
          * [ PCN-Congestion-Info ]
          * [ PCN-Excess-Flow-Info ]
          * [ Proxy-Info ]
          * [ Route-Record ]
          * [ AVP ]
</pre></div><p>

					At least one instance of the PCN-Congestion-Info or the PCN-Excess-Flow-Info AVP MUST be present;
					the value of the Session-Id AVP MUST be unique and SHOULD be set according to the recommendations in Section 8.8 of <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588].
				
</p>
<a name="cra_cmd"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.2"></a><h3>4.3.2.&nbsp;
Congestion-Report-Answer (CRA) Command</h3>

<p>
					The PDP uses the Congestion-Report-Answer (CRA) command, indicated by the Command-Code
					field set to &lt;CC2&gt; and the Command Flags' 'R' bit cleared, to
					acknowledge an Congestion-Report-Request command sent by an egress node. The Congestion-Report-Answer
					command contains the same Session-Id as the corresponding request. 
					<br />
<br />

					Message format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;CRA&gt; ::= &lt; Diameter Header: CC2, PXY &gt;
            &lt; Session-Id &gt;
            { Auth-Application-Id }
            { Auth-Session-State }
            { Result-Code }
            { Origin-Host }
            { Origin-Realm }
            [ Error-Message ]
            [ Error-Reporting-Host ]
            [ Failed-AVP ]
            [ Event-Timestamp ]
          * [ Proxy-Info ]
          * [ AVP ]
</pre></div><p>

				
</p>
<a name="mpr_cmd"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.3"></a><h3>4.3.3.&nbsp;
Measurement-Poll-Request (MPR) Command</h3>

<p>
					The PDP sends the Measurement-Poll-Request (MPR) command, indicated by the Command-Code
					field set to &lt;CC3&gt; and the Command Flags' 'R' bit set, to request that an ingress node report the rate at which 
					PCN-marked traffic has been forwarded to a given ingress-egress aggregate, 
					measured over a given measurement period as described in <a class='info' href='#ingress_proc'>Section&nbsp;3.4<span> (</span><span class='info'>Ingress Node behavior</span><span>)</span></a>. 
					The value of the Session-Id AVP MUST be unique and SHOULD be set according to the recommendations in Section 8.8 of <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588].
					<br />
<br />

					Message format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;MPR&gt; ::= &lt; Diameter Header: CC3, REQ, PXY &gt;
            &lt; Session-Id &gt;
            { Auth-Application-Id }
            { Auth-Session-State }
            { Origin-Host }
            { Origin-Realm }
            { Destination-Realm }
            { I-E-Aggregate-Id }
            [ Destination-Host ]
            [ Event-Timestamp ]
          * [ Proxy-Info ]
          * [ Route-Record ]
          * [ AVP ]
</pre></div><p>

				
</p>
<a name="mpa_cmd"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3.4"></a><h3>4.3.4.&nbsp;
Measurement-Poll-Answer (MPA) Command</h3>

<p>
					The ingress node sends the Measurement-Poll-Answer (MPA) command, indicated by the Command-Code
					field set to &lt;CC4&gt; and the Command Flags' 'R' bit cleared, in response to an MPR sent by the PDP.
					<br />
<br />

					Message format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  &lt;MPA&gt; ::= &lt; Diameter Header: CC4, PXY &gt;
            &lt; Session-Id &gt;
            { Auth-Application-Id }
            { Auth-Session-State }
            { Result-Code }
            { Origin-Host }
            { Origin-Realm }
            { PCN-Sent-Info }
            [ Error-Message ]
            [ Error-Reporting-Host ]
            [ Failed-AVP ]
            [ Event-Timestamp ]
          * [ Proxy-Info ]
          * [ AVP ]
</pre></div><p>

				
</p>
<a name="avps"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Attribute Value Pairs (AVPs)</h3>

<p>
				This section describes the AVPs specific to the PCN Data Collection application. 
				The 'M' bit MUST be set and the 'V' bit MUST NOT be set for all of these AVPs when used in the PCN Data Collection application.
			
</p>
<a name="IEAggId_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.1"></a><h3>4.4.1.&nbsp;
I-E-Aggregate-Id AVP</h3>

<p>
					The I-E-Aggregate-Id AVP (AVP code &lt;AVP1&gt;) is of type Grouped and identifies a specific aggregate.
					<br />
<br />

					The I-E-Aggregate-Id AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  I-E-Aggregate-Id ::= &lt; AVP Header: AVP1 &gt;
                                [ PCN-Ingress-Node-Address ]
                                [ PCN-Egress-Node-Address ]
                                [ VLAN-ID-Range ]
                                * [ AVP ]
</pre></div><p>
				
				
</p>
<a name="ingressAddr_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.2"></a><h3>4.4.2.&nbsp;
PCN-Ingress-Node-Address AVP</h3>

<p>
					The PCN-Ingress-Node-Address AVP (AVP code &lt;AVP2&gt;) is of type Grouped and
					contains the address of a PCN-Ingress-Node.
					<br />
<br />

					The PCN-Ingress-Node-Address AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PCN-Ingress-Node-Address ::= &lt; AVP Header: AVP2 &gt;
                                [ Framed-IP-Address ]
                                [ Framed-IPv6-Prefix ]
</pre></div><p>
				
				
</p>
<a name="egressAddr_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.3"></a><h3>4.4.3.&nbsp;
PCN-Egress-Node-Address AVP</h3>

<p>
					The PCN-Egress-Node-Address AVP (AVP code &lt;AVP3&gt;) is of type Grouped and
					contains the address of a PCN-Egress-Node.
					<br />
<br />

					The PCN-Egress-Node-Address AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PCN-Egress-Node-Address ::= &lt; AVP Header: AVP3 &gt;
                                [ Framed-IP-Address ]
                                [ Framed-IPv6-Prefix ]
</pre></div><p>
				
                               	
</p>
<a name="ipAddr_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.4"></a><h3>4.4.4.&nbsp;
Framed-IP-Address AVP</h3>

<p>
					The Framed-IP-Address AVP is defined in the NASREQ application
					(<a class='info' href='#RFC4005'>RFC 4005<span> (</span><span class='info'>Calhoun, P., Zorn, G., Spence, D., and D. Mitton, &ldquo;Diameter Network Access Server Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4005]).
				
</p>
<a name="ipv6Addr_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.5"></a><h3>4.4.5.&nbsp;
Framed-IPv6-prefix AVP</h3>

<p>
					The Framed-IPv6-prefix AVP is defined in the NASREQ application
					(<a class='info' href='#RFC4005'>RFC 4005<span> (</span><span class='info'>Calhoun, P., Zorn, G., Spence, D., and D. Mitton, &ldquo;Diameter Network Access Server Application,&rdquo; August&nbsp;2005.</span><span>)</span></a> [RFC4005]).
				
</p>
<a name="vlanid_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.6"></a><h3>4.4.6.&nbsp;
VLAN-ID-Range AVP</h3>

<p>
					The VLAN-ID-Range AVP, defined in <a class='info' href='#I-D.ietf-dime-qos-attributes'>ietf-dime-qos-attributes<span> (</span><span class='info'>Korhonen, J., Tschofenig, H., Arumaithurai, M., Jones, M., and A. Lior, &ldquo;Quality of Service Attributes for Diameter,&rdquo; July&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;dime&#8209;qos&#8209;attributes], is of type Grouped and specifies the VLAN range to match.
				
</p>
<a name="coninfo_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.7"></a><h3>4.4.7.&nbsp;
PCN-Congestion-Info AVP</h3>

<p>
					The PCN-Congestion-Info AVP (AVP code &lt;AVP4&gt;) is of type Grouped.
					It identifies an ingress-egress aggregate, reports the current value of the congestion level estimate (CLE), 
					and indicates whether the report is generated because the CLE has risen above the reporting threshold 
					or because it has fallen below the reporting threshold.
					<br />
<br />

					The PCN-Congestion-Info AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PCN-Congestion-Info ::= &lt; AVP Header: AVP4 &gt;
                                { I-E-Aggregate-Id }
                                { CLE-Value }
                                { CLE-Report-Reason }
                              * [ AVP ]
</pre></div><p>

                                
</p>
<a name="CLEvalue_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.8"></a><h3>4.4.8.&nbsp;
CLE-Value AVP</h3>

<p>
					The CLE-Value AVP (AVP code &lt;AVP5&gt;) is of type Float32. 
					It gives the current (smoothed) congestion level estimate as a fraction between 0.0 and 1.0. 
				
</p>
<a name="rptreason_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.9"></a><h3>4.4.9.&nbsp;
CLE-Report-Reason AVP</h3>

<p>
					The CLE-Report-Reason AVP (AVP code &lt;AVP6&gt;) is of type Enumerated. The following values are defined in this document:
					</p>
<blockquote class="text"><dl>
<dt>PRECONGESTION_ONSET (0)</dt>
<dd>
							
							The current CLE (reported in CLE-Value) is above the configured onset reporting threshold. The CLE derived in the previous measurement period was below that threshold.
						
</dd>
<dt>PRECONGESTION_END (1)</dt>
<dd>
							The current CLE (reported in CLE-Value) is below the configured end-of-precongestion reporting threshold, which may have the same value as the onset reporting threshold. 
							The CLE derived in the previous measurement period was above that threshold.
						
</dd>
</dl></blockquote><p>
				
</p>
<a name="excess_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.10"></a><h3>4.4.10.&nbsp;
PCN-Excess-Flow-Info AVP</h3>

<p>
					The PCN-Excess-Flow-Info AVP (AVP code &lt;AVP7&gt;) is of type Grouped.
					It identifies an ingress-egress aggregate, reports a rate of excess traffic for that aggregate, and MAY identify a number of individual flows 
					within that aggregate that experienced the markings that led to the generation of the PCN-Excess-Flow-Info AVP.
					Precise details of the conditions under which this AVP is generated and how the indivdual flows 
					are selected are given in the specification for the PCN edge behaviour deployed in the domain.
					<br />
<br />

					The PCN-Excess-Flow-Info AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PCN-Excess-Flow-Info ::= &lt; AVP Header: AVP7 &gt;
                             { I-E-Aggregate-Id }
                             { I-E-Aggregate-Excess-Rate }
                           * [ Classifier ]
                           * [ AVP ]
</pre></div><p>

				
</p>
<a name="rate_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.11"></a><h3>4.4.11.&nbsp;
I-E-Aggregate-Excess-Rate AVP</h3>

<p>
					The I-E-Aggregate-Excess-Rate AVP (AVP code &lt;AVP8&gt;) is of type Unsigned32. 
					It gives the rate of flow of excess traffic in octets per second that the egress node derived
					for the identified ingress-egress aggregate for the measurement period ending at the time given by the Event-Timestamp AVP (if present). 
				
</p>
<a name="classifier_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.12"></a><h3>4.4.12.&nbsp;
Classifier AVP</h3>

<p>
					The Classifier AVP (AVP Code TBD), defined in <a class='info' href='#I-D.ietf-dime-qos-attributes'>ietf-dime-qos-attributes<span> (</span><span class='info'>Korhonen, J., Tschofenig, H., Arumaithurai, M., Jones, M., and A. Lior, &ldquo;Quality of Service Attributes for Diameter,&rdquo; July&nbsp;2009.</span><span>)</span></a> [I&#8209;D.ietf&#8209;dime&#8209;qos&#8209;attributes],
					is a grouped AVP that consists of a set of attributes that specify how to match a packet.
				
</p>
<a name="sent_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.13"></a><h3>4.4.13.&nbsp;
PCN-Sent-Info AVP</h3>

<p>
					The PCN-Sent-Info AVP (AVP code &lt;AVP9&gt;) is of type Grouped. 
					It provides the rate of flow of PCN-marked traffic in octets per second that the ingress node derived for the identified ingress-egress aggregate for
					the measurement period ending at the time given by the Event-Timestamp AVP (if present).
					<br />
<br />

					The PCN-Sent-Info AVP has the following format:
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  PCN-Sent-Info ::= &lt; AVP Header: AVP9 &gt;
                    { I-E-Aggregate-Id }
                    { I-E-Aggregate-Sent-Rate }
                  * [ AVP ]
</pre></div><p>

				
</p>
<a name="sentrate_AVP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4.14"></a><h3>4.4.14.&nbsp;
I-E-Aggregate-Sent-Rate AVP</h3>

<p>
					The I-E-Aggregate-Sent-Rate AVP (AVP code &lt;AVP10&gt;) is of type Unsigned32. 
					It gives the rate of flow of PCN-marked traffic in octets per second that the ingress node forwarded to the identified ingress-egress aggregate, 
					calculated for the measurement period ending at the time given by the Event-Timestamp AVP (if present). 
				
</p>
<a name="occurrence_Table"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
AVP Occurrence Tables</h3>

<p>
				The following tables present the AVPs defined in this document and
				their occurrences in Diameter messages. Note that AVPs that can only
				be present within a Grouped AVP are not represented in this table. 
				<br />
<br />

				The table uses the following symbols:
				</p>
<blockquote class="text">
<p>0: The AVP MUST NOT be present in the message.
</p>
<p>0+: Zero or more instances of the AVP MAY be present in the message.
</p>
<p>0-1: Zero or one instance of the AVP MAY be present in the message.
</p>
<p>1: One instance of the AVP MUST be present in the message.
</p>
</blockquote><p>
				<br />
<br />

</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                     +-----------------------+
                                     |     Command-Code      |
                                     |-----+-----+-----+-----+
      AVP Name                       | CRR | CRA | MPR | MPA |
      -------------------------------|-----+-----+-----+-----+
      PCN-Congestion-Info            | 0+  |  0  |  0  |  0  |
      PCN-Excess-Flow-Info           | 0+  |  0  |  0  |  0  |
      PCN-Sent-Info                  |  0  |  0  |  0  |  1  |
      I-E-Aggregate-Id               | (*) |  0  |  1  | (*) |
                                     +-----+-----+-----+-----+
</pre></div><p>

				<br />
<br />

				(*): Note that the I-E-Aggregate-Id AVP appears alone in the MPR command and
				within the PCN-Sent-Info grouped AVP (MPA command), the PCN-Excess-Flow-Info AVP,
				and the PCN-Congestion-Info AVP. 
			
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IANA Considerations</h3>

<p>
			Upon publication of this memo as an RFC, IANA is requested to assign values as described in the following sections.
		
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Diameter Application Identifier</h3>

<p>
				An application identifier for Diameter PCN Data Collection (&lt;AID&gt;, <a class='info' href='#app_sp'>Section&nbsp;4.1<span> (</span><span class='info'>Advertising Application Support</span><span>)</span></a>)
				must be assigned according to the policy specified in Section 11.3 of <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588].
			
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Diameter Command Codes</h3>

<p>
				Codes must be assigned for the following commands according to the policy specified in <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588], Section 11.2.1:
				</p>
<ul class="text">
<li>Congestion-Report-Request (CRR) (&lt;CC1&gt;, <a class='info' href='#crr_cmd'>Section&nbsp;4.3.1<span> (</span><span class='info'>Congestion-Report-Request (CRR) Command</span><span>)</span></a>)
</li>
<li>Congestion-Report-Answer (MPA) (&lt;CC2&gt;, <a class='info' href='#cra_cmd'>Section&nbsp;4.3.2<span> (</span><span class='info'>Congestion-Report-Answer (CRA) Command</span><span>)</span></a>)
</li>
<li>Measurement-Poll-Request (MPR) (&lt;CC3&gt;, <a class='info' href='#mpr_cmd'>Section&nbsp;4.3.3<span> (</span><span class='info'>Measurement-Poll-Request (MPR) Command</span><span>)</span></a>)
</li>
<li>Measurement-Poll-Answer (MPA) (&lt;CC4&gt;, <a class='info' href='#mpa_cmd'>Section&nbsp;4.3.4<span> (</span><span class='info'>Measurement-Poll-Answer (MPA) Command</span><span>)</span></a>)
</li>
</ul><p>
			
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Attribute-Value Pairs</h3>

<p>
				Codes must be assigned for the following AVPs using the policy specified in <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588], Section 11.1.1:
				</p>
<ul class="text">
<li>I-E-Aggregate-Id (&lt;AVP1&gt;, <a class='info' href='#IEAggId_AVP'>Section&nbsp;4.4.1<span> (</span><span class='info'>I-E-Aggregate-Id AVP</span><span>)</span></a>) 
</li>
<li>PCN-Ingress-Node-Address (&lt;AVP2&gt;, <a class='info' href='#ingressAddr_AVP'>Section&nbsp;4.4.2<span> (</span><span class='info'>PCN-Ingress-Node-Address AVP</span><span>)</span></a>) 
</li>
<li>PCN-Egress-Node-Address (&lt;AVP3&gt;, <a class='info' href='#egressAddr_AVP'>Section&nbsp;4.4.3<span> (</span><span class='info'>PCN-Egress-Node-Address AVP</span><span>)</span></a>) 
</li>
<li>PCN-Congestion-Info (&lt;AVP4&gt;, <a class='info' href='#coninfo_AVP'>Section&nbsp;4.4.7<span> (</span><span class='info'>PCN-Congestion-Info AVP</span><span>)</span></a>)
</li>
<li>CLE-Value (&lt;AVP5&gt;, <a class='info' href='#CLEvalue_AVP'>Section&nbsp;4.4.8<span> (</span><span class='info'>CLE-Value AVP</span><span>)</span></a>)
</li>
<li>CLE-Report-Reason (&lt;AVP6&gt;, <a class='info' href='#rptreason_AVP'>Section&nbsp;4.4.9<span> (</span><span class='info'>CLE-Report-Reason AVP</span><span>)</span></a>)
</li>
<li>PCN-Excess-Flow-Info (&lt;AVP7&gt;, <a class='info' href='#excess_AVP'>Section&nbsp;4.4.10<span> (</span><span class='info'>PCN-Excess-Flow-Info AVP</span><span>)</span></a>)
</li>
<li>I-E-Aggregate-Excess-Rate (&lt;AVP8&gt;, <a class='info' href='#rate_AVP'>Section&nbsp;4.4.11<span> (</span><span class='info'>I-E-Aggregate-Excess-Rate AVP</span><span>)</span></a>)
</li>
<li>PCN-Sent-Info (&lt;AVP9&gt;, <a class='info' href='#sent_AVP'>Section&nbsp;4.4.13<span> (</span><span class='info'>PCN-Sent-Info AVP</span><span>)</span></a>)
</li>
<li>I-E-Aggregate-Sent-Rate (&lt;AVP10&gt;, <a class='info' href='#sentrate_AVP'>Section&nbsp;4.4.14<span> (</span><span class='info'>I-E-Aggregate-Sent-Rate AVP</span><span>)</span></a>)
</li>
</ul><p>
			
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
			The following sections discuss the security threats against the Diameter PCN Data Collection application and describe some countermeasures.
		
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Traffic Security</h3>

<p>
				Application traffic MUST be secured as specified in <a class='info' href='#RFC3588'>RFC 3588<span> (</span><span class='info'>Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;Diameter Base Protocol,&rdquo; September&nbsp;2003.</span><span>)</span></a> [RFC3588] (i.e., through the use of (preferably) TLS or IPsec).
				In the absence of appropriate protection, all manner (including man-in-the-middle) of attacks are possible, potentially resulting in the inappropriate termination and non-admittance of flows. 
			
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Device Security</h3>

<p>
				Compromise of an ingress node by an attacker could result in the inappropriate refusal of admittance to valid flows,
				while the compromise of an egress node could allow the termination of valid flows.
				<br />
<br />

				Compromise of the PDP could result in both denial of admission to new flows and termination of existing flows, enabling an attacker to essentially control PCN traffic on the affected network.
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-dime-qos-attributes">[I-D.ietf-dime-qos-attributes]</a></td>
<td class="author-text">Korhonen, J., Tschofenig, H., Arumaithurai, M., Jones, M., and A. Lior, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-qos-attributes-13.txt">Quality of Service Attributes for Diameter</a>,&rdquo; draft-ietf-dime-qos-attributes-13 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-dime-qos-attributes-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3588">[RFC3588]</a></td>
<td class="author-text">Calhoun, P., Loughney, J., Guttman, E., Zorn, G., and J. Arkko, &ldquo;<a href="http://tools.ietf.org/html/rfc3588">Diameter Base Protocol</a>,&rdquo; RFC&nbsp;3588, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3588.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4005">[RFC4005]</a></td>
<td class="author-text">Calhoun, P., Zorn, G., Spence, D., and D. Mitton, &ldquo;<a href="http://tools.ietf.org/html/rfc4005">Diameter Network Access Server Application</a>,&rdquo; RFC&nbsp;4005, August&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4005.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-cl-edge-behaviour">[I-D.ietf-pcn-cl-edge-behaviour]</a></td>
<td class="author-text">Charny, A., Huang, F., Karagiannis, G., Menth, M., and T. Taylor, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-cl-edge-behaviour-00.txt">PCN Boundary Node Behaviour for the Controlled Load (CL) Mode of Operation</a>,&rdquo; draft-ietf-pcn-cl-edge-behaviour-00 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-cl-edge-behaviour-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-pcn-sm-edge-behaviour">[I-D.ietf-pcn-sm-edge-behaviour]</a></td>
<td class="author-text">Charny, A., Karagiannis, G., Menth, M., and T. Taylor, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-sm-edge-behaviour-00.txt">PCN Boundary Node Behaviour for the Single Marking (SM) Mode of Operation</a>,&rdquo; draft-ietf-pcn-sm-edge-behaviour-00 (work in progress), July&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-pcn-sm-edge-behaviour-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Q.3303.3">[Q.3303.3]</a></td>
<td class="author-text">ITU-T, &ldquo;<a href="http://www.itu.int/rec/T-REC-Q.3303.3">Resource control protocol No. 3 &mdash; Protocols at the Rw interface between a policy decision physical entity (PD-PE) and a policy enforcement physical entity (PE-PE): Diameter</a>,&rdquo; May&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2475">[RFC2475]</a></td>
<td class="author-text"><a href="mailto:slblake@torrentnet.com">Blake, S.</a>, <a href="mailto:black_david@emc.com">Black, D.</a>, <a href="mailto:mark.carlson@sun.com">Carlson, M.</a>, <a href="mailto:elwynd@nortel.co.uk">Davies, E.</a>, <a href="mailto:zhwang@bell-labs.com">Wang, Z.</a>, and <a href="mailto:wweiss@lucent.com">W. Weiss</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2475">An Architecture for Differentiated Services</a>,&rdquo; RFC&nbsp;2475, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2475.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2475.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2475.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5431">[RFC5431]</a></td>
<td class="author-text">Sun, D., &ldquo;<a href="http://tools.ietf.org/html/rfc5431">Diameter ITU-T Rw Policy Enforcement Interface Application</a>,&rdquo; RFC&nbsp;5431, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5431.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5559">[RFC5559]</a></td>
<td class="author-text">Eardley, P., &ldquo;<a href="http://tools.ietf.org/html/rfc5559">Pre-Congestion Notification (PCN) Architecture</a>,&rdquo; RFC&nbsp;5559, June&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5559.txt">TXT</a>).</td></tr>
</table>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Related Work in ITU-T</h3>

<p>
			The ITU-T is doing work to exploit the PCN technology in an environment 
			where the decisions are made by a central policy decision point (PDP) <a class='info' href='#Q.3303.3'>[Q.3303.3]<span> (</span><span class='info'>ITU-T, &ldquo;Resource control protocol No. 3 &mdash; Protocols at the Rw interface between a policy decision physical entity (PD-PE) and a policy enforcement physical entity (PE-PE): Diameter,&rdquo; May&nbsp;2008.</span><span>)</span></a>,
			which needs the information generated by PCN marking to support per-flow decisions on admission and termination.
			This memo defines a Diameter application to transfer the information from edge nodes to the PDP. 
			Egress node reports are sent by the egress node acting as client to the PDP acting as server. 
			Data generated at the ingress node are needed only when flow termination is required. 
			They are requested by the PDP acting as client and sent in responses by the ingress node acting as server. 
			The PDP thus acts both as client and as server in the same application.
			The Rw application <a class='info' href='#RFC5431'>[RFC5431]<span> (</span><span class='info'>Sun, D., &ldquo;Diameter ITU-T Rw Policy Enforcement Interface Application,&rdquo; March&nbsp;2009.</span><span>)</span></a> provides a precedent for such an application.
			<br />
<br />

			The PCN Data Collection application is related to existing ITU-T applications as follows:
			</p>
<ul class="text">
<li>
					The Rs application allows application-level functions to request flow admission for individual application flows.
				
</li>
<li>
					The Rw application provides the control linkage between a Policy Decision Point and an ingress router, to pass down decisions on flow admission following either the push or the pull model. 
					The Rw application also passes flow termination decisions.
				
</li>
</ul><p>
			As can be seen from this brief description, the PCN Data Collection application defined in this memo is complementary to the Rw application. 
			Within the strict terms of the ITU-T architecture, it is a realization of a different interface, the Rc interface. 
			However, the PCN Data Collection application is intended for use in any of a number of architectures based on a centralized policy decision element.
		
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fortune Huang</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Section F</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Industrial Base</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bantian Longgang, Shenzhen  518129</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.R. China</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fqhuang@huawei.com">fqhuang@huawei.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tom Taylor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1852 Lorraine Ave</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ottawa, Ontario  K1H 6Z8</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 613 680 2675</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:tom.taylor@rogers.com">tom.taylor@rogers.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Glen Zorn (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Network Zen</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1310 East Thomas Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">#306</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Seattle, Washington  98102</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 (206) 377-9035</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:gwz@net-zen.net">gwz@net-zen.net</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Linnoitustie 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Espoo  02600</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 (50) 4871445</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@nsn.com">Hannes.Tschofenig@nsn.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.priv.at">http://www.tschofenig.priv.at</a></td></tr>
</table>
</body></html>
