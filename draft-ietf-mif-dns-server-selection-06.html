<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Improved DNS Server Selection for Multi-Interfaced Nodes</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Private namespaces and problems for multi-interfaced nodes">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Fully qualified domain names with limited scopes">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Network interface specific IP addresses">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 A problem not fully solved by the described solution">
<link href="#rfc.section.3" rel="Chapter" title="3 Deployment scenarios">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 CPE deployment scenario">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Cellular network scenario">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 VPN scenario">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Dual-stack accesses">
<link href="#rfc.section.4" rel="Chapter" title="4 Improved DNS server selection">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Procedure for prioritizing DNS servers and handling responses">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 DNS server selection DHCPv6 option">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 DNS server selection DHCPv4 option">
<link href="#rfc.section.4.4" rel="Chapter" title="4.4 Limitations on use">
<link href="#rfc.section.4.5" rel="Chapter" title="4.5 Coexistence with RFC3646 and RFC1533">
<link href="#rfc.section.4.6" rel="Chapter" title="4.6 Interactions with DNS search lists and pre-DNS hostnames">
<link href="#rfc.section.4.7" rel="Chapter" title="4.7 Considerations on follow-up queries">
<link href="#rfc.section.5" rel="Chapter" title="5 Example of a node behavior">
<link href="#rfc.section.6" rel="Chapter" title="6 Scalability considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Considerations for network administrators">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Attack vectors">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Trust levels of network interfaces">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 Importance of following the algorithm">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Possible alternative practices for DNS server selection">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Sending queries out on multiple interfaces in parallel">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Search list option for DNS forward lookup decisions">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 More specific routes for reverse lookup decision">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Longest matching prefix for reverse lookup decision">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B DNSSEC and multiple answers validating with different trust anchors">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="A multi-interfaced node is connected to multiple networks, some of which may be utilizing private DNS namespaces.  A node commonly receives DNS server configuration information from all connected networks. Some of the DNS servers may have information about namespaces other servers do not have. When a multi-interfaced node needs to utilize DNS, the node has to choose which of the servers to contact to. This document describes DHCPv4 and DHCPv6 options that can be used to configure nodes with information required to perform informed DNS server selection decisions." />
  <meta name="description" content="A multi-interfaced node is connected to multiple networks, some of which may be utilizing private DNS namespaces.  A node commonly receives DNS server configuration information from all connected networks. Some of the DNS servers may have information about namespaces other servers do not have. When a multi-interfaced node needs to utilize DNS, the node has to choose which of the servers to contact to. This document describes DHCPv4 and DHCPv6 options that can be used to configure nodes with information required to perform informed DNS server selection decisions." />
  <meta name="keywords" content="DNS, interface, FQDN, selection" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">T.S. Savolainen</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Nokia</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">J.T. Kato</td>
</tr>
<tr>
<td class="left">Expires: April 21, 2012</td>
<td class="right">NTT</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">T.L. Lemon</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Nominum, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 19, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Improved DNS Server Selection for Multi-Interfaced Nodes<br />
  <span class="filename">draft-ietf-mif-dns-server-selection-06</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>A multi-interfaced node is connected to multiple networks, some of which may be utilizing private DNS namespaces.  A node commonly receives DNS server configuration information from all connected networks. Some of the DNS servers may have information about namespaces other servers do not have. When a multi-interfaced node needs to utilize DNS, the node has to choose which of the servers to contact to. This document describes DHCPv4 and DHCPv6 options that can be used to configure nodes with information required to perform informed DNS server selection decisions.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 21, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Private namespaces and problems for multi-interfaced nodes</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Fully qualified domain names with limited scopes</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Network interface specific IP addresses</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">A problem not fully solved by the described solution</a>
</li>
<li>3.   <a href="#rfc.section.3">Deployment scenarios</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">CPE deployment scenario</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Cellular network scenario</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">VPN scenario</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Dual-stack accesses</a>
</li>
<li>4.   <a href="#rfc.section.4">Improved DNS server selection</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Procedure for prioritizing DNS servers and handling responses</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">DNS server selection DHCPv6 option</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">DNS server selection DHCPv4 option</a>
</li>
<li>4.4.   <a href="#rfc.section.4.4">Limitations on use</a>
</li>
<li>4.5.   <a href="#rfc.section.4.5">Coexistence with RFC3646 and RFC1533</a>
</li>
<li>4.6.   <a href="#rfc.section.4.6">Interactions with DNS search lists and pre-DNS hostnames</a>
</li>
<li>4.7.   <a href="#rfc.section.4.7">Considerations on follow-up queries</a>
</li>
<li>5.   <a href="#rfc.section.5">Example of a node behavior</a>
</li>
<li>6.   <a href="#rfc.section.6">Scalability considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Considerations for network administrators</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Attack vectors</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">Trust levels of network interfaces</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">Importance of following the algorithm</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Possible alternative practices for DNS server selection</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Sending queries out on multiple interfaces in parallel</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Search list option for DNS forward lookup decisions</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">More specific routes for reverse lookup decision</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Longest matching prefix for reverse lookup decision</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">DNSSEC and multiple answers validating with different trust anchors</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">A multi-interfaced node faces several problems a single-homed node does not encounter, as is described in <a href="#I-D.ietf-mif-problem-statement">[I-D.ietf-mif-problem-statement]</a>.  This document studies in detail the problems private namespaces may cause for multi-interfaced nodes and provides a solution. The node may be implemented as a host or as a router.</p>
<p id="rfc.section.1.p.2">We start from the premise that network operators sometimes include private namespaces in the answers they provide from DNS servers, and that those private namespaces are at least as useful to nodes as the answers from the public DNS. When private namespaces are visible for a node, some DNS servers have information other servers do not have. The node ought to be able to ask right server for the information it needs.</p>
<p id="rfc.section.1.p.3">An example of an application that benefits from multi-interfacing is a web browser that commonly accesses many different destinations, each of which is available only on one network.  The browser therefore needs to be able to communicate over different network interfaces, depending on the destination it is trying to reach.</p>
<p id="rfc.section.1.p.4">In deployments where private namespaces are present, selection of correct route and destination and source addresses for the actual IP connection is crucial as well, as the resolved destination's IP addresses may be only usable on the network interface over which the name was resolved on. Hence solution described in this document is assumed to be commonly used in combination with tools for delivering additional routing and source and destination address selection policies.</p>
<p id="rfc.section.1.p.5">This document is organized in the following manner. Background information about problem descriptions and example deployment scenarios are included in <a href="#problems">Section 2</a> and <a href="#scenarios">Section 3</a>. <a href="#dnsselection">Section 4</a> contains all normative descriptions for DHCP options and node behavior. Informative <a href="#examples">Section 5</a> illustrates behavior of a node implementing functionality described in the <a href="#dnsselection">Section 4</a>.  <a href="#scalability">Section 6</a> contains informational considerations about scalability.  <a href="#admins">Section 7</a> contains normative guidelines related to creation of private namespaces.  Informational <a href="#Security">Section 10</a> summarizes identified security considerations.</p>
<p id="rfc.section.1.p.6">The Appendix A describes best current practices possible with tools preceding this document and that may be possibilities on networks not supporting the solution described in this document. </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#problems" id="problems">Private namespaces and problems for multi-interfaced nodes</a>
</h1>
<p id="rfc.section.2.p.1">This section describes two node multi-interfacing related private namespace scenarios for which the procedure described in <a href="#dnsselection">Section 4</a>  provides a solution for. Additionally, <a href="#notsolved">Section 2.3</a> describes a problem for which this document provides only partial solution.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Fully qualified domain names with limited scopes</h1>
<p id="rfc.section.2.1.p.1">A multi-interfaced node may be connected to one or more networks that are using private namespaces. As an example, the node may have simultaneously open a wireless LAN (WLAN) connection to the public Internet, cellular connection to an operator network, and a virtual private network (VPN) connection to a corporate network. When an application initiates a connection establishment to an FQDN, the node needs to be able to choose the right DNS server for making a successful DNS query. This is illustrated in the figure 1. An FQDN for a public name can be resolved with any DNS server, but for an FQDN of corporation's or operator's service's private name the node needs to be able to correctly select the right DNS server for the DNS resolution, i.e. do also network interface selection already before destination's IP address is known.</p>
<div id="#rfc.figure.1"></div>
<div id="#xml_fig1"></div>
<p></p>
<pre>
                         +---------------+    
                         | DNS server w/ |    |   Corporate
+------+                 | public +      |----|   Intranet
|      |                 | corporation's |    |
|      |===== VPN =======| private names |    |	
|      |                 +---------------+  +----+
| MIF  |                                    | FW |
| node |                                    +----+
|      |                 +---------------+    |
|      |----- WLAN ------| DNS server w/ |----|   Public
|      |                 | public names  |    |   Internet
|      |                 +---------------+  +----+
|      |                                    | FW |
|      |                 +---------------+  +----+
|      |---- cellular ---| DNS server w/ |    |
+------+                 | public +      |    |   Operator
                         | operator's    |----|   Intranet  
                         | private names |    |       
                         +---------------+    
              </pre>
<p>Private DNS namespaces illustrated</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Network interface specific IP addresses</h1>
<p id="rfc.section.2.2.p.1">In the second problem an FQDN is valid and resolvable via different network interfaces, but to different and not necessarily globally reachable IP addresses, as is illustrated in the figure 2.  Node's routing and source and destination address selection mechanism must ensure the destination's IP address is only used in combination with source IP addresses of the network interface the name was resolved on.</p>
<div id="#rfc.figure.2"></div>
<div id="#xml_fig2"></div>
<p></p>
<pre>                 
                         +--------------------|      |
+------+   IPv6          | DNS server A       |------| IPv6
|      |-- interface 1 --| saying Peer is     |      |   
|      |                 | at: 2001:0db8:0::1 |      |
| MIF  |                 +--------------------+   +------+
| node |                                          | Peer |                 
|      |                 +--------------------+   +------+
|      |   IPv6          | DNS server B       |      |
|      |-- interface 2 --| saying Peer is     |      |   
+------+                 | at: 2001:0db8:1::1 |------| IPv6
                         +--------------------+      |   
                            
              </pre>
<p>Private DNS namespaces and different IP addresses for an FQDN on interfaces 1 and 2.</p>
<p id="rfc.section.2.2.p.2">Similar situation can happen with IPv6 protocol translation and AAAA record synthesis <a href="#RFC6147">[RFC6147]</a>.  A synthetic AAAA record is guaranteed to be valid only on a network it was synthesized on. Figure 3 illustrates a scenario where the peer's IPv4 address is synthesized into different IPv6 addresses by DNS servers A and B.</p>
<div id="#rfc.figure.3"></div>
<div id="#xml_fig_AAAA"></div>
<p></p>
<pre>                 
                         +-------------------|    +-------+
+------+   IPv6          | DNS server A      |----| NAT64 |
|      |-- interface 1 --| saying Peer is    |    +-------+   
|      |                 | at: A_Pref96:IPv4 |       |
| MIF  |                 +-------------------+       |   +------+
| node |                                        IPv4 +---| Peer |                 
|      |                 +-------------------+       |   +------+
|      |   IPv6          | DNS server B      |       |
|      |-- interface 2 --| saying Peer is    |    +-------+
+------+                 | at: B_Pref96:IPv4 |----| NAT64 |
                         +-------------------+    +-------+
                            
              </pre>
<p>AAAA synthesis results in network interface specific IPv6 addresses.</p>
<p id="rfc.section.2.2.p.3">It is worth noting is that network specific IP addresses can cause problems also for a single-homed node, if the node retains DNS cache during movement from one network to another. After the network change, a node may have entries in its DNS cache that are no longer correct or appropriate for its new network position.</p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#notsolved" id="notsolved">A problem not fully solved by the described solution</a>
</h1>
<p id="rfc.section.2.3.p.1">A more complex scenario is an FQDN, which in addition to possibly resolving into network interface specific IP addresses, identifies on different network interfaces completely different peer entities with potentially different set of service offerings. In even more complex scenario, an FQDN identifies unique peer entity, but one that provides different services on its different network interfaces. The solution described in this document is not able to tackle these higher layer issues. In fact, these problems may be solvable only by manual user intervention.</p>
<p id="rfc.section.2.3.p.2">However, when DNSSEC is used, the DNSSEC validation procedure may provide assistance for selecting correct responses for some, but not all, use cases. A node may prefer to use the DNS answer that validates with the preferred trust anchor.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#scenarios" id="scenarios">Deployment scenarios</a>
</h1>
<p id="rfc.section.3.p.1">This document has been written with three particular deployment scenarios in mind. First being a Consumer Premises Equipment (CPE) with two or more uplink VLAN connections. Second scenario involves a cellular device with two uplink Internet connections: WLAN and cellular.  Third scenario is for VPNs, where use of local DNS server may be preferred for latency reasons, but corporate DNS server must be used to resolve private names used by the corporation.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> CPE deployment scenario</h1>
<p id="rfc.section.3.1.p.1">A home gateway may have two uplink connections leading to different networks, as is described in <a href="#I-D.ietf-v6ops-ipv6-multihoming-without-ipv6nat">[I-D.ietf-v6ops-ipv6-multihoming-without-ipv6nat]</a>. In the two uplinks scenario only one uplink connection leads to the Internet, while another uplink connection leads to a private network utilizing private namespaces.  </p>
<p id="rfc.section.3.1.p.2">It is desirable that the CPE does not have to send DNS queries over both uplink connections, but instead CPE should send default queries to the DNS server of the interface leading to the Internet, and queries related to private namespace to the DNS server of the private network.  </p>
<p id="rfc.section.3.1.p.3">In this scenario the legacy hosts can be supported by deploying DNS proxy on the CPE and configuring hosts in the LAN to talk to the DNS proxy. However, updated hosts would be able to talk directly to the correct DNS servers of each uplink ISP's DNS server. It is deployment decision whether the updated hosts would be pointed to DNS proxy or to actual DNS servers.  </p>
<p id="rfc.section.3.1.p.4">Depending on actual deployments, all VLAN connections might be considered as trusted.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Cellular network scenario</h1>
<p id="rfc.section.3.2.p.1">A cellular device may have both WLAN and cellular network interfaces up. In such a case it is often desirable to use WLAN by default, except for those connections cellular network operator wants to go over cellular interface. The cellular network may utilize private names and hence the cellular device needs to ask for those through the cellular interface.  </p>
<p id="rfc.section.3.2.p.2">In this scenario cellular interface can be considered trusted and WLAN oftentimes untrusted.</p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> VPN scenario</h1>
<p id="rfc.section.3.3.p.1">Depending on a deployment, there may be interest to use VPN only for the traffic destined to a corporate network. The corporation may be using private namespace, and hence related DNS queries should be send over VPN to the corporate DNS server, while by default a DNS server of a local access network may be used.  </p>
<p id="rfc.section.3.3.p.2">In this scenario VPN interface can be considered trusted and local access network untrusted.  </p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Dual-stack accesses</h1>
<p id="rfc.section.3.4.p.1">In all three scenarios one or more of the connected networks may support both IPv4 and IPv6.  In such a case both or either of DHCPv4 and DHCPv6 can be used to learn DNS server selection information.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#dnsselection" id="dnsselection">Improved DNS server selection</a>
</h1>
<p id="rfc.section.4.p.1">This section describes DHCP options and a procedure that a (stub / proxy) resolver may utilize for improved DNS server selection in the face of private namespaces and multiple simultaneously active network interfaces.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Procedure for prioritizing DNS servers and handling responses</h1>
<p id="rfc.section.4.1.p.1">A resolver SHALL build a priority list of DNS servers it will contact to depending on the query. To build the list in an optimal way, a node SHOULD ask with DHCP which DNS servers of each network interface are most likely to be able to successfully serve forward lookup requests matching to specific domain or reverse (PTR record) lookup requests matching to specific network addresses (later referred as "network").  For security reasons the DNS server selection information MUST be used only when it is safe to do so, see <a href="#uselimitations">Section 4.4</a> for details.  </p>
<p id="rfc.section.4.1.p.2">The node SHOULD create a node specific route for the DNS server addresses learned via DHCP. The route must point to the interface DNS server address was learned on. This is required to ensure DNS queries are sent out via the right network interface. </p>
<p id="rfc.section.4.1.p.3">A resolver lacking more specific information shall assume that all information is available from any DNS server of any network interface. The DNS servers learnt by other DNS server address configuration methods MUST be handled as medium priority default servers.  </p>
<p id="rfc.section.4.1.p.4">When a DNS query needs to be made, the resolver SHOULD give highest precedence to the DNS servers explicitly known to serve matching domain or network. The resolver MUST take into account differences in trust levels of pieces of received DNS server selection information.  The resolver MUST prefer DNS servers of trusted interfaces. The DNS servers of untrusted interfaces may be of highest priority only if trusted interfaces specifically configure low priority DNS servers. The non-exhaustive list on figure 4 illustrates how the different trust levels of received DNS server selection information SHOULD influence the DNS server selection logic.  </p>
<p id="rfc.section.4.1.p.5">Trustworthiness of an interface and configuration information received over the interface is implementation and/or node deployment dependent. Trust may be based on, for example, on the nature of an interface. For example, an authenticated and encrypted VPN or layer 2 connections to a trusted home network may be considered as trusted, and an unauthenticated and unencrypted connection to an unknown visited network may be considered as untrusted.</p>
<p id="rfc.section.4.1.p.6">A resolver SHOULD prioritize between equally trusted DNS servers with help of the DHCP option preference field. The resolver MUST NOT prioritize less trusted DNS servers higher than trusted, even in the case of less trusted server would apparently have additional information. In the case of all other things being equal the resolver shall make the prioritization decision based on its internal preferences.</p>
<div id="#rfc.figure.4"></div>
<div id="#Table1"></div>
<pre>
   Information from       | Information from       | Resulting DNS 
   more trusted           | less trusted           | server priority 
   interface A            | interface B            | selection
--------------------------+------------------------+--------------------
1. Medium priority        | Medium priority        | Default:  A, then B
   default                | default                |    
--------------------------+------------------------+--------------------
2. Medium priority        | High priority default  | Default:  A, then B
   default                | High priority specific | Specific: A, then B
--------------------------+------------------------+--------------------
3. Low priority default   | Medium priority        | Default:  B, then A
                          | default                |
--------------------------+------------------------+--------------------
4. Low priority default   | Medium priority        | Default:  B, then A
   High priority specific | default                | Specific: A, then B
--------------------------+------------------------+--------------------
     </pre>
<p id="rfc.section.4.1.p.7">Because DNSSEC provides cryptographic assurance of the integrity of DNS data, data that can be validated under DNSSEC is necessarily to be preferred over data that cannot be.  There are two ways that a node can determine that data is valid under DNSSEC.  The first is to perform DNSSEC validation itself.  The second is to have a secure connection to an authenticated DNS server, and to rely on that DNS server to perform DNSSEC validation (signalling that it has done so using the AD bit).  If a DNS response is not proven to be unmolested using DNSSEC, then a node cannot make a decision to prefer data from any interface with any great assurance: any response could be forged, and there is no way to detect the forgery without DNSSEC.</p>
<p id="rfc.section.4.1.p.8">A node SHALL send requests to DNS servers in the order defined by the priority list until an acceptable reply is received, all replies are received, or a time out occurs. In the case of a requested name matching to a specific domain or network rule accepted from any interface, a DNSSEC-aware resolver MUST NOT proceed with a reply that cannot be validated using DNSSEC until all DNS servers on the priority list have been contacted or timed out. This protects against possible redirection attacks. In the case of the requested name not matching to any specific domain or network, first received response from any DNS server MAY be considered acceptable. A DNSSEC-aware node MAY always contact all DNS server in an attempt to receive a response that can be validated, but contacting all DNS servers is not mandated for the default case as in some deployments that would consume excess resources.</p>
<p id="rfc.section.4.1.p.9">The resolver SHOULD avoid sending queries over different network interfaces in parallel as that wastes resources such as energy. The amount of wasted energy can be significant, for example when radio interfaces has to be started just for the queries.</p>
<p id="rfc.section.4.1.p.10">In the case of validated NXDOMAIN response being received from a DNS server that can provide answers for the queried name a node MUST NOT accept non-validated replies from other DNS servers (see Appendix B for considerations related to multiple trust anchors.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> DNS server selection DHCPv6 option</h1>
<p id="rfc.section.4.2.p.1">DHCPv6 option described below can be used to inform resolvers which DNS server should be contacted when initiating forward or reverse DNS lookup procedures.</p>
<div id="#rfc.figure.5"></div>
<div id="#xml_figDHCPv6new"></div>
<p></p>
<pre> 
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  OPTION_DNS_SERVER_SELECT     |         option-len            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|            DNS-recursive-name-server (IPv6 address)           |
|                                                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Reserved  |prf|                                               |
+-+-+-+-+-+-+-+-+          Domains and networks                 |
|                          (variable length)                    |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

option-code:   OPTION_DNS_SERVER_SELECT (TBD)

option-len:    Length of the option in octets

DNS-recursive-name-server: An IPv6 address of a recursive DNS server

prf:           DNS server preference, for selecting between
               equally trusted DNS servers:
                   01 High
                   00 Medium 
                   11 Low
                   10 Reserved
         
Reserved:      Flags reserved for the future. MUST be set to zero.
                   
Domains and networks:  The list of domains for forward DNS
               lookup and networks for reverse DNS lookup the DNS server
               has special knowledge about. Field MUST be encoded as
               specified in Section "Representation and use of 
               domain names" of [RFC3315].
               Special domain of "." is used to indicate
               capability to resolve global names and act as a
               default name server. Lack of "." 
               domain on the list indicates DNS server only has 
               information related to listed domains and networks. 
               Networks for reverse mapping are encoded as 
               defined for ip6.arpa [RFC3152] or in-addr.arpa [RFC2317]. 
              </pre>
<p>DHCPv6 option for explicit domain configuration</p>
<p id="rfc.section.4.2.p.2">A node SHOULD include an OPTION_ORO option in a DHCPv6 request with the OPTION_DNS_SERVER_SELECT option code to inform the DHCPv6 server about the support for the improved DNS server selection logic. DHCPv6 server receiving this information MAY then choose to provision DNS server addresses only with the OPTION_DNS_SERVER_SELECT.  </p>
<p id="rfc.section.4.2.p.3">The OPTION_DNS_SERVER_SELECT contains one or more domains the related DNS server has particular knowledge of. The option can occur multiple times in a single DHCPv6 message, if multiple DNS servers are to be configured.  </p>
<p id="rfc.section.4.2.p.4">IPv6 networks should cover all the domains configured in this option. Networks should be as long as possible to avoid potential collision with information received on other option instances or with options received from DHCPv6 servers of other network interfaces. Overlapping IPv6 networks are interpreted so that the resolver can use any of the DNS servers for queries matching the networks. </p>
<p id="rfc.section.4.2.p.5">If the OPTION_DNS_SERVER_SELECT contains a DNS server address already learned from other DHCPv6 servers of the same network, and contains new domains or networks, the node SHOULD append the information to the information received earlier. The node MUST NOT remove previously obtained information. However, the node SHOULD NOT extent lifetime of earlier information either. In the case of conflicting DNS server address is learned from less trusted interface, the node MUST ignore the option.</p>
<p id="rfc.section.4.2.p.6">As the DNS options of <a href="#RFC3646">[RFC3646]</a>, the OPTION_DNS_SERVER_SELECT option MUST NOT appear in any other than the following DHCPv6 messages: Solicit, Advertise, Request, Renew, Rebind, Information-Request, and Reply.</p>
<p id="rfc.section.4.2.p.7">The information conveyed in OPTION_DNS_SERVER_SELECT is considered valid until changed or refreshed by general events that trigger DHCPv6 action. In the event that it is desired for the client to request a refresh of the information, use of generic DHCPv6 Information Refresh Time Option, as specified in <a href="#RFC4242">[RFC4242]</a> is RECOMMENDED.</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> DNS server selection DHCPv4 option</h1>
<p id="rfc.section.4.3.p.1">DHCPv4 option described below can be used to inform resolvers which DNS server should be contacted when initiating forward or reverse DNS lookup procedures.</p>
<div id="#rfc.figure.6"></div>
<div id="#xml_figDHCPv4new"></div>
<p></p>
<pre> 
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     CODE      |     Len       |  Payload len  | Reserved  |prf|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Primary DNS-recursive-name-server (IPv4 address)        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       Secondary DNS-recursive-name-server (IPv4 address)      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
+                          Domains and networks                 |
|                          (variable length)                    |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

option-code:   OPTION_DNS_SERVER_SELECT (TBD)

option-len:    Length of the option in octets

Payload len:   Length of the Domains and networks field in octets

prf:           DNS servers preference, for selecting between
               equally trusted DNS servers:
                   01 High
                   00 Medium 
                   11 Low
                   10 Reserved

Primary DNS-recursive-name-server: An IPv4 address of a primary
               recursive DNS server

Secondary DNS-recursive-name-server: An IPv4 address of a secondary
               recursive DNS server or 0.0.0.0 if not configured.
        
Reserved:      Flags reserved for the future. MUST be set to zero.
                   
Domains and networks:  The list of domains for forward DNS lookup
               and networks for reverse DNS lookup the DNS servers
               have special knowledge about. Field MUST be encoded as
               specified in Section "Representation and use of 
               domain names" of [RFC3315].
               Special domain of "." is used to indicate
               capability to resolve global names and act as
               default name servers. Lack of "." 
               domain on the list indicates DNS servers only have
               information related to listed domains and networks. 
               Networks for reverse mapping are encoded as 
               defined for ip6.arpa [RFC3152] or in-addr.arpa [RFC2317]. 
              </pre>
<p>DHCPv4 option for explicit domain configuration</p>
<p id="rfc.section.4.3.p.2">The OPTION_DNS_SERVER_SELECT contains one or more domains the related primary and secondary DNS servers have particular knowledge of. The option can occur only once in a single DHCPv4 message and is limited in length. The maximum length in octets for the domains and networks field is 245 octets.  </p>
<p id="rfc.section.4.3.p.3">If the OPTION_DNS_SERVER_SELECT contains a DNS server address already learned from other DHCPv4 servers of the same network, and contains new domains or networks, the node SHOULD append the information to the information received earlier. The node MUST NOT remove previously obtained information. However, the node SHOULD NOT extent lifetime of earlier information either. In the case of conflicting DNS server address is learned from less trusted interface, the node MUST ignore the option.</p>
<h1 id="rfc.section.4.4">
<a href="#rfc.section.4.4">4.4.</a> <a href="#uselimitations" id="uselimitations">Limitations on use</a>
</h1>
<p id="rfc.section.4.4.p.1">Use of OPTION_DNS_SERVER_SELECT is ideal in the following environments, but SHOULD NOT be enabled by default otherwise:</p>
<p id="rfc.section.4.4.p.2">1. The server selection option is delivered across a secure, trusted channel.</p>
<p id="rfc.section.4.4.p.3">2. The server selection option is not secured, but the client on a node does DNSSEC validation.</p>
<p id="rfc.section.4.4.p.4">3. The server selection option is not secured, the resolver does DNSSEC validation, and the client communicates with the resolver configured with server selection option over a secure, trusted channel.</p>
<p id="rfc.section.4.4.p.5">4. The DNS server IP address that is being recommended in the server selection option is known and trusted by the client; that is, the server selection option serves not to introduce the client to a new server, but rather to inform it that a server it has already been configured to trust is available to it for resolving certain domains.</p>
<h1 id="rfc.section.4.5">
<a href="#rfc.section.4.5">4.5.</a> Coexistence with RFC3646 and RFC1533</h1>
<p id="rfc.section.4.5.p.1">The OPTION_DNS_SERVER_SELECT is designed to coexist with DHCPv6 OPTION_DNS_SERVERS defined in <a href="#RFC3646">[RFC3646]</a> and DHCPv4 Domain Name Server Option defined in <a href="#RFC1533">[RFC1533]</a>.  The DNS servers configured via OPTION_DNS_SERVERS or Domain Name Server Option MUST be considered as default name servers with medium preference. When both options are received from the same network interface and the OPTION_DNS_SERVER_SELECT contains default DNS server address, the resolver MUST make the decision which one to prefer based on DNS preference field value. If OPTION_DNS_SERVER_SELECT defines medium preference then DNS server from OPTION_DNS_SERVER_SELECT SHALL be selected.  </p>
<p id="rfc.section.4.5.p.2">If OPTION_DNS_SERVERS or Domain Name Server Option and OPTION_DNS_SERVER_SELECT contain the same DNS server(s) IP address(es), a node SHALL add the same address of a DNS server to the server list only once.  </p>
<p id="rfc.section.4.5.p.3">If a node had indicated support for OPTION_DNS_SERVER_SELECT in DHCPv6 request, the DHCPv6 server may choose to omit sending of OPTION_DNS_SERVERS. This enables offloading use case where network administrator wishes to only advertise low priority default DNS servers.  </p>
<h1 id="rfc.section.4.6">
<a href="#rfc.section.4.6">4.6.</a> Interactions with DNS search lists and pre-DNS hostnames</h1>
<p id="rfc.section.4.6.p.1">A node may be configured with DNS search list by DHCPv6 OPTION_DOMAIN_LIST <a href="#RFC3646">[RFC3646]</a> or DHCPv4 Domain Search Option <a href="#RFC3397">[RFC3397]</a>.</p>
<p id="rfc.section.4.6.p.2">A bare name (a name without any dots) MUST be first treated as a pre-DNS hostname, and only after that the name SHALL be appended with domain information and described DNS server selection logic be utilized.</p>
<p id="rfc.section.4.6.p.3">Resolution for the name containing any dots SHOULD first be attempted with DNS servers of all interfaces. Only if the resolution fails the node SHOULD append the name with search list domain(s) and then again utilize improved DNS server selection algorithm to decide which DNS server(s) to contact.  </p>
<h1 id="rfc.section.4.7">
<a href="#rfc.section.4.7">4.7.</a> Considerations on follow-up queries</h1>
<p id="rfc.section.4.7.p.1">Any follow-up queries that are performed on the basis of an answer received on an interface MUST continue to use the same interface, irrespective of the DNS server selection settings on any other interface. For example, if a node receives a reply with a canonical name (CNAME) or delegation name (DNAME) the follow-up queries MUST be sent to DNS server(s) of the same interface, or to same DNS server, irrespectively of the FQDN received. Otherwise referrals may fail.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#examples" id="examples">Example of a node behavior</a>
</h1>
<p id="rfc.section.5.p.1">Figure 7 illustrates node behavior when it initializes two network interfaces for parallel usage and learns domain and network information from DHCPv6 servers.</p>
<div id="#rfc.figure.7"></div>
<div id="#xml_fig5"></div>
<p></p>
<pre>                 
 Application	Node      DHCPv6 server   DHCPv6 server 
                          on interface 1  on interface 2 
     |             |                |
     |         +-----------+        |                
(1)  |         | open      |        |                
     |         | interface |        |                
     |         +-----------+        |                
     |             |                |                
(2)  |             |---option REQ--&gt;|                
     |             |&lt;--option RESP--|                
     |             |                |                
     |         +-----------+        |                
(3)  |         | store     |        |                
     |         | domains   |        |                
     |         +-----------+        |                
     |             |                |               
     |         +-----------+        |                
(4)  |         | open      |        |                
     |         | interface |        |                
     |         +-----------+        |                
     |             |                |                |
(5)  |             |---option REQ-------------------&gt;|
     |             |&lt;--option RESP-------------------|
     |             |                |                |
     |         +----------+         |                |
(6)  |         | store    |         |                |
     |         | domains  |         |                |
     |         +----------+         |                |
     |             |                |                |
              </pre>
<p>Illustration of learning domains</p>
<p id="rfc.section.5.p.2">Flow explanations:</p>
<p></p>

<ol>
<li>A node opens its first network interface</li>
<li>The node obtains domain 'domain1.example.com' and IPv6 network '0.8.b.d.0.1.0.0.2.ip6.arpa' for the new interface 1 from DHCPv6 server</li>
<li>The node stores the learned domains and IPv6 networks for later use</li>
<li>The node opens its second network interface 2</li>
<li>The node obtains domain 'domain2.example.com' and IPv6 network information, say '1.8.b.d.0.1.0.0.2.ip6.arpa' for the new interface 2 from DHCPv6 server</li>
<li>The node stores the learned domains and networks for later use</li>
</ol>
<p id="rfc.section.5.p.4">Figure 8 below illustrates how a resolver uses the learned domain information.  Network information use for reverse lookups is not illustrated, but that would go as the figure 7 example.</p>
<div id="#rfc.figure.8"></div>
<div id="#xml_fig6"></div>
<p></p>
<pre> 
 Application     Node     DHCPv6 server     DHCPv6 server 
                          on interface 1    on interface 2
     |             |                |                |
(1)  |--Name REQ--&gt;|                |                |
     |             |                |                |
     |      +----------------+      |                |
(2)  |      | DNS server     |      |                |
     |      | prioritization |      |                |
     |      +----------------+      |                |
     |             |                |                |
(3)  |             |------------DNS resolution------&gt;|
     |             |&lt;--------------------------------|
     |             |                |                |
(4)  |&lt;--Name resp-|                |                |
     |             |                |                |
              </pre>
<p>Example on choosing interface based on domain</p>
<p id="rfc.section.5.p.5">Flow explanations:</p>
<p></p>

<ol>
<li>An application makes a request for resolving an FQDN, e.g. 'private.domain2.example.com'</li>
<li>A node creates list of DNS servers to contact to and uses configured DNS server information and stored domain information on prioritization decisions.</li>
<li>The node has chosen interface 2, as from DHCPv6 it was learned earlier that the interface 2 has domain 'domain2.example.com'. The node then resolves the requested name using interface 2's DNS server to an IPv6 address</li>
<li>The node replies to application with the resolved IPv6 address</li>
</ol>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#scalability" id="scalability">Scalability considerations</a>
</h1>
<p id="rfc.section.6.p.1">The size limitations of DHCP messages limit the number of domains and networks that can be carried in configuration options. Including the domains and networks in a DHCP option is best suited for deployments where relatively few carefully selected domains and networks are adequate. The size limitation is stricter in the case of DHCPv4 where only one option instance is possible with maximum of 245 octets for domains and networks list. In the case of DHCPv6 the restriction is not as strict.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#admins" id="admins">Considerations for network administrators</a>
</h1>
<p id="rfc.section.7.p.1">Network administrators deploying private namespaces should assist advanced nodes in their DNS server selection process by providing information described within this document.</p>
<p id="rfc.section.7.p.2">Private namespaces MUST be globally unique in order to keep DNS unambiguous and henceforth avoiding caching related issues and destination selection problems (see <a href="#notsolved">Section 2.3</a>). Exceptions to this rule are domains utilized for local name resolution (such as .local).</p>
<p id="rfc.section.7.p.3">Private namespaces MUST only consist of subdomains of domains for which the relevant operator provides authoritative name service. Thus, subdomains of example.com are permitted in the private namespace served by an operator's DNS servers only if the same operator provides an SOA record for example.com.</p>
<p id="rfc.section.7.p.4">To counter against attacks against private namespaces, administrators utilizing this tool SHOULD deploy DNSSEC for their zone.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">The author would like to thank following people for their valuable feedback and improvement ideas: Mark Andrews, Jari Arkko, Marcelo Bagnulo, Brian Carpenter, Stuart Cheshire, Lars Eggert, Tomohiro Fujisaki, Peter Koch, Suresh Krishnan, Murray Kucherawy, Edward Lewis, Kurtis Lindqvist, Arifumi Matsumoto, Erik Nordmark, Steve Padgett, Fabien Rapin, Matthew Ryan, Dave Thaler, Margaret Wasserman, Dan Wing, and Dec Wojciech.  Ted Lemon and Julien Laganier receive special thanks for their contributions to security considerations.</p>
<p id="rfc.section.8.p.2">This document was prepared using xml2rfc template and the related web-tool.</p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.9.p.1">This memo requests IANA to assign two new option codes. First option code is requested to be assigned for DHCPv4 DNS Server Selection option (TBD) from the DHCP option code space defined in section "New DHCP option codes" of RFC 2939. Second option code is requested to be assigned to the DHCPv6 DNS Server Selection option (TBD) from the DHCPv6 option code space defined in section "IANA Considerations" of RFC 3315.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Attack vectors</h1>
<p id="rfc.section.10.1.p.1">It is possible that attackers might try to utilize OPTION_DNS_SERVER_SELECT option to redirect some or all DNS queries sent by a resolver to undesired destinations. The purpose of an attack might be denial-of-service, preparation for man-in-the-middle attack, or something akin.  </p>
<p id="rfc.section.10.1.p.2">Attackers might try to lure specific traffic by advertising domains and networks from very small to very large scope or simply by trying to place attacker's DNS server as the highest priority default server.  </p>
<p id="rfc.section.10.1.p.3">The best countermeasure for nodes is to implement validating DNSSEC aware resolvers.  Trusting on validation done by a DNS server is a possibility only if a node trusts the DNS server and can use a secure channel for DNS messages.  </p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> Trust levels of network interfaces</h1>
<p id="rfc.section.10.2.p.1">Decision on trust levels of network interfaces depends very much on deployment scenario and types of network interfaces. For example, unmanaged WLAN may be considered less trustworthy than managed cellular or VPN connections.  </p>
<p id="rfc.section.10.2.p.2">The decision on levels of trust may be made by implementation, by node administrators, or for example by other standards defining organizations as part of system design work.</p>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> Importance of following the algorithm</h1>
<p id="rfc.section.10.3.p.1">The <a href="#dnsselection">Section 4</a> uses normative language for describing node internal behavior in order to ensure nodes would not open up new attack vectors by accidental use of DNS server selection options. During the standards work consensus was that it is safer to not to enable this option always by default, but only when deemed useful and safe.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1533">[RFC1533]</b></td>
<td class="top">
<a href="mailto:stevea@lachman.com" title="Lachman Technology, Inc.">Alexander, S.</a> and <a href="mailto:droms@bucknell.edu" title="Bucknell University, Computer Science Department">R. Droms</a>, "<a href="http://tools.ietf.org/html/rfc1533">DHCP Options and BOOTP Vendor Extensions</a>", RFC 1533, October 1993.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2317">[RFC2317]</b></td>
<td class="top">
<a href="mailto:Havard.Eidnes@runit.sintef.no" title="SINTEF RUNIT">Eidnes, H.</a>, <a title="Software Design, Inc.">de Groot, G.</a> and <a title="Internet Software Consortium">P. Vixie</a>, "<a href="http://tools.ietf.org/html/rfc2317">Classless IN-ADDR.ARPA delegation</a>", BCP 20, RFC 2317, March 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3315">[RFC3315]</b></td>
<td class="top">
<a>Droms, R.</a>, <a>Bound, J.</a>, <a>Volz, B.</a>, <a>Lemon, T.</a>, <a>Perkins, C.</a> and <a>M. Carney</a>, "<a href="http://tools.ietf.org/html/rfc3315">Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3315, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3152">[RFC3152]</b></td>
<td class="top">
<a>Bush, R.</a>, "<a href="http://tools.ietf.org/html/rfc3152">Delegation of IP6.ARPA</a>", BCP 49, RFC 3152, August 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3736">[RFC3736]</b></td>
<td class="top">
<a>Droms, R.</a>, "<a href="http://tools.ietf.org/html/rfc3736">Stateless Dynamic Host Configuration Protocol (DHCP) Service for IPv6</a>", RFC 3736, April 2004.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4242">[RFC4242]</b></td>
<td class="top">
<a>Venaas, S.</a>, <a>Chown, T.</a> and <a>B. Volz</a>, "<a href="http://tools.ietf.org/html/rfc4242">Information Refresh Time Option for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 4242, November 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1918">[RFC1918]</b></td>
<td class="top">
<a href="mailto:yakov@cisco.com" title="Cisco systems">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com" title="Chrysler Corporation">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net" title="RIPE Network Coordination Centre">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net" title="RIPE Network Coordination Centre">Groot, G.</a> and <a href="mailto:lear@sgi.com" title="Silicon Graphics, Inc.">E. Lear</a>, "<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>", BCP 5, RFC 1918, February 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6147">[RFC6147]</b></td>
<td class="top">
<a>Bagnulo, M.</a>, <a>Sullivan, A.</a>, <a>Matthews, P.</a> and <a>I. van Beijnum</a>, "<a href="http://tools.ietf.org/html/rfc6147">DNS64: DNS Extensions for Network Address Translation from IPv6 Clients to IPv4 Servers</a>", RFC 6147, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.wing-behave-dns64-config">[I-D.wing-behave-dns64-config]</b></td>
<td class="top">
<a>Wing, D</a>, "<a href="http://tools.ietf.org/html/draft-wing-behave-dns64-config-03">IPv6-only and Dual Stack Hosts on the Same Network with DNS64</a>", Internet-Draft draft-wing-behave-dns64-config-03, February 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-mif-problem-statement">[I-D.ietf-mif-problem-statement]</b></td>
<td class="top">
<a>Blanchet, M</a> and <a>P Seite</a>, "<a href="http://tools.ietf.org/html/draft-ietf-mif-problem-statement-15">Multiple Interfaces and Provisioning Domains Problem Statement</a>", Internet-Draft draft-ietf-mif-problem-statement-15, May 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-v6ops-ipv6-multihoming-without-ipv6nat">[I-D.ietf-v6ops-ipv6-multihoming-without-ipv6nat]</b></td>
<td class="top">
<a>Troan, O</a>, <a>Miles, D</a>, <a>Matsushima, S</a>, <a>Okimoto, T</a> and <a>D Wing</a>, "<a href="http://tools.ietf.org/html/draft-ietf-v6ops-ipv6-multihoming-without-ipv6nat-03">IPv6 Multihoming without Network Address Translation</a>", Internet-Draft draft-ietf-v6ops-ipv6-multihoming-without-ipv6nat-03, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3397">[RFC3397]</b></td>
<td class="top">
<a>Aboba, B.</a> and <a>S. Cheshire</a>, "<a href="http://tools.ietf.org/html/rfc3397">Dynamic Host Configuration Protocol (DHCP) Domain Search Option</a>", RFC 3397, November 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3646">[RFC3646]</b></td>
<td class="top">
<a>Droms, R.</a>, "<a href="http://tools.ietf.org/html/rfc3646">DNS Configuration options for Dynamic Host Configuration Protocol for IPv6 (DHCPv6)</a>", RFC 3646, December 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4191">[RFC4191]</b></td>
<td class="top">
<a>Draves, R.</a> and <a>D. Thaler</a>, "<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>", RFC 4191, November 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4193">[RFC4193]</b></td>
<td class="top">
<a>Hinden, R.</a> and <a>B. Haberman</a>, "<a href="http://tools.ietf.org/html/rfc4193">Unique Local IPv6 Unicast Addresses</a>", RFC 4193, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6106">[RFC6106]</b></td>
<td class="top">
<a>Jeong, J.</a>, <a>Park, S.</a>, <a>Beloeil, L.</a> and <a>S. Madanapalli</a>, "<a href="http://tools.ietf.org/html/rfc6106">IPv6 Router Advertisement Options for DNS Configuration</a>", RFC 6106, November 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#app-additional" id="app-additional">Possible alternative practices for DNS server selection</a>
</h1>
<p id="rfc.section.Appendix A.p.1">On some private namespace deployments explicit policies for DNS server selection are not available. This section describes ways for nodes to mitigate the problem by sending wide-spread queries and by utilizing possibly existing indirect information elements as hints.</p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Sending queries out on multiple interfaces in parallel</h1>
<p id="rfc.section.Appendix A.1.p.1">A possible current practice is to send DNS queries out of multiple interfaces and pick up the best out of the received responses. A node SHOULD implement DNSSEC in order to be able to reject responses that cannot be validated. Selection between legitimate answers is implementation specific, but replies from trusted servers should be preferred.</p>
<p id="rfc.section.Appendix A.1.p.2">A downside of this approach is increased consumption of resources. Namely power consumption if an interface, e.g. wireless, has to be brought up just for the DNS query that could have been resolved also via cheaper interface. Also load on DNS servers is increased. However, local caching of results mitigates these problems, and a node might also learn interfaces that seem to be able to provide 'better' responses than other and prefer those - without forgetting fallback required for cases when node is connected to more than one network using private namespaces.</p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Search list option for DNS forward lookup decisions</h1>
<p id="rfc.section.Appendix A.2.p.1">A node can learn the special domains of attached network interfaces from IPv6 Router Advertisement DNS Search List Option <a href="#RFC6106">[RFC6106]</a> or DHCP search list options; DHCPv4 Domain Search Option number 119 [RFC3397] and DHCPv6 Domain Search List Option number 24 [RFC3646]. The node behavior is very similar as is illustrated in the example at <a href="#examples">Section 5</a>. While these options are not intended to be used in DNS server selection, they may be used by the nodes as hints for smarter DNS server prioritization purposes in order to increase likelihood of fast and successful DNS query.</p>
<p id="rfc.section.Appendix A.2.p.2">Overloading of existing DNS search list options is not without problems: resolvers would obviously use the domains learned from search lists also for name resolution purposes. This may not be a problem in deployments where DNS search list options contain few domains like 'example.com, private.example.com', but can become a problem if many domains are configured.</p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> More specific routes for reverse lookup decision</h1>
<p><a href="#RFC4191">[RFC4191]</a> defines how more specific routes can be provisioned for nodes.  This information is not intended to be used in DNS server selection, but nevertheless a node can use this information as a hint about which interface would be best to try first for reverse lookup procedures. A DNS server configured via the same interface as more specific routes is more likely capable to answer reverse lookup questions correctly than DNS server of an another interface.  The likelihood of success is possibly higher if DNS server address is received in the same RA <a href="#RFC6106">[RFC6106]</a> as the more specific route information.</p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> Longest matching prefix for reverse lookup decision</h1>
<p id="rfc.section.Appendix A.4.p.1">A node may utilize the longest matching prefix approach when deciding which DNS server to contact for reverse lookup purposes. Namely, the node may send a DNS query to a DNS server learned over an interface having longest matching prefix to the address being queried. This approach can help in cases where ULA <a href="#RFC4193">[RFC4193]</a> addresses are used and when the queried address belongs to a node or server within the same network (for example intranet).</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#app-additional2" id="app-additional2">DNSSEC and multiple answers validating with different trust anchors</a>
</h1>
<p id="rfc.section.Appendix B.p.1">When validating DNS answers with DNSSEC, a validator might order the list of trust anchors it uses to start validation chains, in terms of the node's preferences for those trust anchors.  A node could use this ability in order to select among alternative DNS results from different interfaces.  Suppose that a node has a trust anchor for the public DNS root, and also has a special-purpose trust anchor for example.com.  An answer is received on interface i1 for www.example.com, and the validation for that succeeds by using the public trust anchor.  Also, an answer is received on interface i2 for www.example.com, and the validation for that succeeds by using the trust anchor for example.com.  In this case, the node has evidence for relying on i2 for answers in the example.com zone.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Teemu Savolainen</span> 
	  <span class="n hidden">
		<span class="family-name">Savolainen</span>
	  </span>
	</span>
	<span class="org vcardline">Nokia</span>
	<span class="adr">
	  <span>Hermiankatu 12 D</span>

	  <span class="vcardline">
		<span class="locality">TAMPERE</span>,  
		<span class="region"></span>
		<span class="code">FI-33720</span>
	  </span>
	  <span class="country-name vcardline">FINLAND</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:teemu.savolainen@nokia.com">teemu.savolainen@nokia.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jun-ya Kato</span> 
	  <span class="n hidden">
		<span class="family-name">Kato</span>
	  </span>
	</span>
	<span class="org vcardline">NTT</span>
	<span class="adr">
	  <span>9-11, Midori-Cho 3-Chome Musashino-Shi</span>

	  <span class="vcardline">
		<span class="locality">TOKYO</span>,  
		<span class="region"></span>
		<span class="code">180-8585</span>
	  </span>
	  <span class="country-name vcardline">JAPAN</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:kato@syce.net">kato@syce.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ted Lemon</span> 
	  <span class="n hidden">
		<span class="family-name">Lemon</span>
	  </span>
	</span>
	<span class="org vcardline">Nominum, Inc.</span>
	<span class="adr">
	  <span>2000 Seaport Boulevard</span>

	  <span class="vcardline">
		<span class="locality">Redwood City</span>,  
		<span class="region"></span>
		<span class="code">CA 94063</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">Phone: +1 650 381 6000</span>

<span class="vcardline">EMail: <a href="mailto:Ted.Lemon@nominum.com">Ted.Lemon@nominum.com</a></span>

  </address>
</div>

</body>
</html>