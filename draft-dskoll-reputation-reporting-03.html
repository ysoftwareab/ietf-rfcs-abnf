<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Reputation Reporting Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Requirements notation">
<link href="#rfc.section.2" rel="Chapter" title="2 Introduction">
<link href="#rfc.section.3" rel="Chapter" title="3 Definitions">
<link href="#rfc.section.4" rel="Chapter" title="4 Report Format">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Subreports">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Subreport Formats">
<link href="#rfc.section.5" rel="Chapter" title="5 Subreport Format Definitions">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 IP Address Subreports">
<link href="#rfc.section.5.1.1" rel="Chapter" title="5.1.1 IP Address Event Types">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Repeated IP Address Subreports">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 Vendor Number Subreport">
<link href="#rfc.section.5.4" rel="Chapter" title="5.4 Software Name Subreport">
<link href="#rfc.section.5.5" rel="Chapter" title="5.5 Software Version Subreport">
<link href="#rfc.section.5.6" rel="Chapter" title="5.6 End-User Subreport">
<link href="#rfc.section.5.7" rel="Chapter" title="5.7 Vendor-Specific Subreport">
<link href="#rfc.section.6" rel="Chapter" title="6 Hierarchical Aggregation">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Collector Level Subreport">
<link href="#rfc.section.7" rel="Chapter" title="7 Report Restrictions">
<link href="#rfc.section.8" rel="Chapter" title="8 Report Layout">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Sample Report">
<link href="#rfc.section.9" rel="Chapter" title="9 IANA Considerations">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This draft specifies a protocol for reporting various events associated with IP addresses.  These events can be collected and aggregated to form a database containing information about the reputation of IP addresses." />
  <meta name="description" content="This draft specifies a protocol for reporting various events associated with IP addresses.  These events can be collected and aggregated to form a database containing information about the reputation of IP addresses." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">D.F. Skoll</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Roaring Penguin Software Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">October 21, 2011</td>
</tr>
<tr>
<td class="left">Expires: April 23, 2012</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Reputation Reporting Protocol<br />
  <span class="filename">draft-dskoll-reputation-reporting-03</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This draft specifies a protocol for reporting various events associated with IP addresses.  These events can be collected and aggregated to form a database containing information about the reputation of IP addresses.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 23, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Requirements notation</a>
</li>
<li>2.   <a href="#rfc.section.2">Introduction</a>
</li>
<li>3.   <a href="#rfc.section.3">Definitions</a>
</li>
<li>4.   <a href="#rfc.section.4">Report Format</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Subreports</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Subreport Formats</a>
</li>
<li>5.   <a href="#rfc.section.5">Subreport Format Definitions</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">IP Address Subreports</a>
</li>
<li>5.1.1.   <a href="#rfc.section.5.1.1">IP Address Event Types</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Repeated IP Address Subreports</a>
</li>
<li>5.3.   <a href="#rfc.section.5.3">Vendor Number Subreport</a>
</li>
<li>5.4.   <a href="#rfc.section.5.4">Software Name Subreport</a>
</li>
<li>5.5.   <a href="#rfc.section.5.5">Software Version Subreport</a>
</li>
<li>5.6.   <a href="#rfc.section.5.6">End-User Subreport</a>
</li>
<li>5.7.   <a href="#rfc.section.5.7">Vendor-Specific Subreport</a>
</li>
<li>6.   <a href="#rfc.section.6">Hierarchical Aggregation</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Collector Level Subreport</a>
</li>
<li>7.   <a href="#rfc.section.7">Report Restrictions</a>
</li>
<li>8.   <a href="#rfc.section.8">Report Layout</a>
</li>
<li>8.1.   <a href="#rfc.section.8.1">Sample Report</a>
</li>
<li>9.   <a href="#rfc.section.9">IANA Considerations</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Requirements notation</h1>
<p id="rfc.section.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Introduction</h1>
<p id="rfc.section.2.p.1">Several organizations (Project Honeypot, Spamhaus, RepuScore, etc.) maintain databases detailing the reputation of various IP address.  These organizations use various ad hoc methods to collect the reputation data.  There is no standard for reporting events to reputation-collectors; this makes it hard to instrument a large number of systems to be data gatherers in a standard way.</p>
<p id="rfc.section.2.p.2">This draft proposes a standard for reporting events back to a reputation-collecting system.  A standard way to report events will make it easy to instrument systems to collect data and report it to one or more reputation-collection systems.</p>
<p id="rfc.section.2.p.3">This standard has the following goals:</p>
<p></p>

<ol>
<li>To be bandwidth-efficient.  The overhead for event-reporting should be as small as possible.</li>
<li>To include security mechanisms such as authentication and anti-replay mechanisms.</li>
<li>To handle both IPv4 and IPv6.</li>
<li>To be open to extension in future.</li>
<li>To be scalable.  Sending reports should be as quick and easy as possible.  The hosts receiving reports should be able to receive and process a large volume of reports with as little CPU and network overhead as possible.</li>
</ol>

<p> </p>
<p id="rfc.section.2.p.5">This protocol is currently in use by Roaring Penguin Software Inc's CanIt anti-spam products.  A web page devoted to the protocol is found at http://www.mimedefang.org/reputation; this page includes a link to a mailing list for discussions of the protocol.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Definitions</h1>
<p id="rfc.section.3.p.1">An EVENT is the basic unit of reputation reporting.  An event consists of an IPv4 or IPv6 address and an associated event TYPE.  Examples of event types are "SMTP client at IP address issued an SMTP RCPT command for a nonexistent recipient" or "SMTP client at IP address delivered an email message considered by a human to be spam."</p>
<p id="rfc.section.3.p.2">A SUBREPORT is usually a list of one or more events.  However, a subreport may contain other types of information such as software name, version, etc.</p>
<p id="rfc.section.3.p.3">A SENSOR is a system that reports events.</p>
<p id="rfc.section.3.p.4">An AGGREGATOR is a system that receives events and builds a reputation database.</p>
<p id="rfc.section.3.p.5">A REPORT is a series of subreports sent from a sensor to an aggregator.</p>
<p id="rfc.section.3.p.6">A USER NAME is included in each report.  The user name is a key used by the aggregator to look up a shared secret.</p>
<p id="rfc.section.3.p.7">A SHARED SECRET is used by the sensor and aggregator to authenticate reports.</p>
<p id="rfc.section.3.p.8">A REPUTATION DATABASE is a dictionary indexed by IPv4 or IPv6 address that contains reputation information about a particular IP address.  Note that the exact format of the reputation database as well as what constitutes "reputation" are beyond the scope of this document.  We are concerned only with a standard for reporting events.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> Report Format</h1>
<p id="rfc.section.4.p.1">Reports are transported via UDP.  The aggregator SHOULD listen for UDP packets on port 6568, the IANA-assigned port number for this protocol <a href="#PORTS">[PORTS]</a>.</p>
<p id="rfc.section.4.p.2">A report consists of the following items:</p>
<p></p>

<ul>
<li>A one-byte protocol version number.  The version number is 2.  An aggregator MUST ignore a report with a version number other than 2.</li>
<li>A one-byte number indicating the length of a user name.  A username MUST range from 0 to 63 bytes in length.  An aggregator MUST reject a report with an over-long user name.</li>
<li>A sequence of bytes indicating a user name.  This name is not terminated with a zero byte.  While this document does not specify the form of a user name, it SHOULD be a valid UTF-8 string.</li>
<li>Eight randomly-generated bytes.  These bytes SHOULD be generated with a cryptographically-secure random number generator.</li>
<li>A four-byte timestamp in network byte order.  This is constructed by computing the current time in seconds since midnight, January 1 1970 UTC as an unsigned integer, and taking the low-order 32 bits of the result.</li>
<li>One or more SUBREPORTS.</li>
<li>An End of Reports (EOR) byte.</li>
<li>Finally, ten bytes consisting of the ten most-significant bytes (in network byte order) of the SHA1 HMAC digest <a href="#RFC2104">[RFC2104]</a> of all data from the version number up to and including the EOR byte.  The password used to calculate the HMAC is a shared secret known by the sensor; the aggregator MUST look up the secret based on the user name in the report.  An aggregator MUST reject a report that fails to validate.  It SHOULD log information about invalid reports.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> Subreports</h1>
<p id="rfc.section.4.1.p.1">A subreport consists of either the single byte 0, indicating the end of the subreports, or a three-byte preamble followed by the subreport contents.  The three-byte preamble consists of:</p>
<p></p>

<ul>
<li>One FORMAT byte.</li>
<li>A two-byte LENGTH field.  This is a 16-bit unsigned integer in network byte order indicating the length of the subreport contents, not including the three-byte preamble.</li>
</ul>

<p> </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#formats" id="formats">Subreport Formats</a>
</h1>
<p id="rfc.section.4.2.p.1">The following subreport formats are defined.  The value of the FORMAT byte is given in decimal.</p>
<p></p>

<ul>
<li>0. EOR.  (End of Reports) This signifies the end of the subreports in the report.  It MUST NOT be followed by a LENGTH field.</li>
<li>1. IPv4-EVENTS.  The LENGTH must be a multiple of 5.</li>
<li>2. IPv6-EVENTS.  The LENGTH must be a multiple of 17.</li>
<li>3. REPEATED-IPv4-EVENTS.  The LENGTH must be a multiple of 6.</li>
<li>4. REPEATED-IPv6-EVENTS.  The LENGTH must be a multiple of 18.</li>
<li>5. VENDOR-NUMBER.  The LENGTH MUST be 3.</li>
<li>6. SOFTWARE-NAME.  The LENGTH can range from 1 to 63.</li>
<li>7. SOFTWARE-VERSION.  The LENGTH can range from 1 to 31.</li>
<li>8. END-USER.  The LENGTH can range from 1 to 31.</li>
<li>9 through 126.  RESERVED.  A sensor MUST NOT create a subreport with a RESERVED FORMAT value.  An aggregator MUST ignore such a subreport.</li>
<li>127. COLLECTOR-LEVEL.  The LENGTH MUST be 2.  See the section "Hierarchical Aggregation".</li>
<li>128 through 254. VENDOR-SPECIFIC.  The report MUST contain a VENDOR-NUMBER subreport before any VENDOR-SPECIFIC subreport.</li>
<li>255.  RESERVED.</li>
</ul>

<p> </p>
<p id="rfc.section.4.2.p.3">An aggregator MUST skip over subreports with format values it does not understand.  (It can do this by skipping ahead LENGTH bytes.)</p>
<p id="rfc.section.4.2.p.4">An aggregator MUST ignore the entire report if any subreports have invalid LENGTHs.  For example, it MUST reject a subreport of IPv4-EVENTS if the LENGTH is not a multiple of 5.  The aggregator SHOULD log information about invalid reports.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Subreport Format Definitions</h1>
<p id="rfc.section.5.p.1">The following sections define exactly how various subreports are formatted.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> IP Address Subreports</h1>
<p id="rfc.section.5.1.p.1">FORMAT values 1 and 2 specify IPv4 and IPv6 subreports, respectively.  Each IPv4 and IPv6 subreport contains one or more events.  The length of each IPv4 event is 5, and the length of each IPv6 event is 17.  The events themselves consist of:</p>
<p></p>

<ul>
<li>The 4-byte IPv4 address or the 16-byte IPv6 address in network byte order.</li>
<li>A one-byte EVENT TYPE.</li>
</ul>
<h1 id="rfc.section.5.1.1">
<a href="#rfc.section.5.1.1">5.1.1.</a> <a href="#eventtypes" id="eventtypes">IP Address Event Types</a>
</h1>
<p id="rfc.section.5.1.1.p.1">The following event types are defined for IPv4 and IPv6 events:</p>
<p></p>

<ul>
<li>0. RESERVED: Event type 0 is reserved.  A sensor MUST NOT report events of type 0.</li>
<li>1. GREYLISTED: An SMTP client at the specified IP address was greylisted.  Greylisting is described in <a href="#GREY">[GREY]</a>.</li>
<li>2. UNGREYLISTED: An SMTP client at the specified IP address was previously greylisted, but has now passed the greylisting test.</li>
<li>3. AUTO-SPAM: An SMTP client at the specified IP address sent a message that was considered to be spam by automatic filtering software.</li>
<li>4. HAND-SPAM: An SMTP client at the specified IP address sent a message that was considered to be spam by a human being.</li>
<li>5. AUTO-HAM: An SMTP client at the specified IP address sent a message that was considered to be non-spam by automatic filtering software.</li>
<li>6. HAND-HAM: An SMTP client at the specified IP address sent a message that was considered to be non-spam by a human being.</li>
<li>7. VALID-RECIPIENT: An SMTP client at the specified IP address issued an SMTP RCPT command that specified a valid recipient address.</li>
<li>8. INVALID-RECIPIENT: An SMTP client at the specified IP address issued an SMTP RCPT command that specified an invalid recipient address.</li>
<li>9. VIRUS: An SMTP client at the specified IP address transmitted a message considered to be a virus by virus-scanning software.</li>
<li>10 - 255. FUTURE: Event types ranging from 10 to 255 are reserved for future use.</li>
</ul>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Repeated IP Address Subreports</h1>
<p id="rfc.section.5.2.p.1">FORMAT values 3 and 4 specify REPEATED-IPv4 and REPEATED-IPv6 subreports, respectively.  Each REPEATED-IPv4 and REPEATED-IPv6 subreport contains one or more events.  The length of each REPEATED-IPv4 event is 6, and the length of each REPEATED-IPv6 event is 18.  The events themselves consist of:</p>
<p></p>

<ul>
<li>The 4-byte IPv4 address or the 16-byte IPv6 address in network byte order.</li>
<li>A one-byte EVENT TYPE.</li>
<li>A one-byte REPEAT.  This byte is interpreted as an unsigned number.  It MUST be greater than or equal to two.  A REPEATED event MUST be interpreted exactly as if REPEAT non-repeated events were received.</li>
</ul>
<p id="rfc.section.5.2.p.3">The EVENT TYPE field for a REPEATED-IPv4 or REPEATED-IPv6 event is exactly the same as for IPv4 or IPv6 events.  The extra REPEAT byte allows a sensor to compress up to 255 identical IP address events into a single REPEATED event.</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> Vendor Number Subreport</h1>
<p id="rfc.section.5.3.p.1">FORMAT value 5 specifies the VENDOR-NUMBER subreport.  This subreport MUST have a LENGTH of 3.  The 3-byte content of the subreport is a 24-bit unsigned integer in network byte order specifying an IANA-assigned Private Enterprise Number <a href="#PEN">[PEN]</a>.  The VENDOR-NUMBER subreport is only required if there are subsequent VENDOR-SPECIFIC subreports.</p>
<h1 id="rfc.section.5.4">
<a href="#rfc.section.5.4">5.4.</a> Software Name Subreport</h1>
<p id="rfc.section.5.4.p.1">FORMAT value 6 specifies the SOFTWARE-NAME subreport.  The LENGTH can range from 1 to 63.  The contents MUST be a valid UTF-8 string specifying the name of the software running on the aggregator.  The string MUST NOT be zero-terminated.  An aggregator MAY include a SOFTWARE-NAME subreport in each report, but MUST NOT include more than one SOFTWARE-NAME subreport.</p>
<h1 id="rfc.section.5.5">
<a href="#rfc.section.5.5">5.5.</a> Software Version Subreport</h1>
<p id="rfc.section.5.5.p.1">FORMAT value 7 specifies the SOFTWARE-VERSION subreport.  The LENGTH can range from 1 to 31.  The contents MUST be a valid UTF-8 string (and SHOULD be a valid ASCII string) specifying the version of the software running on the aggregator.  The string MUST NOT be zero-terminated.</p>
<p id="rfc.section.5.5.p.2">An aggregator MAY include a SOFTWARE-VERSION subreport in each report, but MUST NOT include more than one SOFTWARE-VERSION subreport.  If an aggregator includes a SOFTWARE-VERSION subreport, it MUST also include a SOFTWARE-NAME subreport.</p>
<h1 id="rfc.section.5.6">
<a href="#rfc.section.5.6">5.6.</a> End-User Subreport</h1>
<p id="rfc.section.5.6.p.1">FORMAT value 8 specifies an END-USER subreport.  This report, if present, provides additional information about the specific user who generated subsequent subreports.  For example, if an ISP is reporting events, the END-USER subreport may contain enough information for the ISP to determine which of its subscribers reported the events.  The contents of the END-USER subreport are a sequence of bytes ranging in length from 1 to 31 bytes.  The contents are opaque and have meaning only to the organization running the sensor.</p>
<h1 id="rfc.section.5.7">
<a href="#rfc.section.5.7">5.7.</a> Vendor-Specific Subreport</h1>
<p id="rfc.section.5.7.p.1">FORMAT values 128 through 254 specify a VENDOR-SPECIFIC subreport.  A VENDOR-SPECIFIC subreport MUST be preceded by a VENDOR-NUMBER subreport.  A given report MAY contain more than one VENDOR-NUMBER subreport; the interpretation of a VENDOR-SPECIFIC subreport MUST be made according to the VENDOR-NUMBER subreport that most closely preceded the VENDOR-SPECIFIC subreport.</p>
<p id="rfc.section.5.7.p.2">The contents of the subreport are vendor-specific and not defined here.  An aggregator that does not understand a VENDOR-SPECIFIC subreport for a given VENDOR-NUMBER MUST ignore the subreport.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Hierarchical Aggregation</h1>
<p id="rfc.section.6.p.1">Normally, a sensor detects events directly (for example, it communicates with an MTA to detect events) and reports them to an aggregator, which builds the event database.  However, it may be desirable to have an aggregator take all of the events from its sensors and report them to a higher-level "upstream" aggregator.</p>
<p id="rfc.section.6.p.2">Allowing aggregators to report events to other aggregators introduces the possibility of reporting loops.  To break these loops, aggregators MUST include a COLLECTOR-LEVEL subreport.  It MUST be the first subreport in the report.</p>
<p id="rfc.section.6.p.3">A sensor that detects events directly SHOULD NOT include a COLLECTOR-LEVEL subreport.  However, if it does include one, it MUST specify a level of zero.</p>
<p id="rfc.section.6.p.4">An aggregator that will forward reports to another aggregator MUST be configured to have an "intrinsic level" greater than zero.  The aggregator MUST reject reports with a COLLECTOR-LEVEL greater than or equal to its intrinsic level.  When the aggregator forwards reports, it MUST include a COLLECTOR-LEVEL subreport containing its intrinsic level.  (If the original report included a COLLECTOR-LEVEL subreport, the aggregator MUST NOT include the original COLLECTOR-LEVEL report, but MUST replace it with its own COLLECTOR-LEVEL.)  Note that assignment and management of intrinsic levels is beyond the scope of this document; such assignment must be agreed upon by aggregator managers based on the hierarchy of sensors and aggregators.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> Collector Level Subreport</h1>
<p id="rfc.section.6.1.p.1">FORMAT value 127 specifies the COLLECTOR-LEVEL subreport.  The LENGTH MUST be 2, and the contents are an unsigned 16-bit integer in network byte order specifying the intrinsic level of the agent sending the report.  If the COLLECTOR-LEVEL subreport is present, it MUST be the first subreport.  If it is missing, the aggregator MUST assume a COLLECTOR-LEVEL of zero.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Report Restrictions</h1>
<p id="rfc.section.7.p.1">A sensor MUST NOT report GREYLISTED or UNGREYLISTED events unless it implements greylisting.  A sensor MUST NOT report HAND-SPAM or HAND-HAM events unless it has a reliable system for accepting a human's decision about a message and can show beyond a reasonable doubt that a human in fact made the decision about the reported message.  A sensor MUST NOT report VALID-RECIPIENT or INVALID-RECIPIENT events unless it is capable of validating recipient addresses.</p>
<p id="rfc.section.7.p.2">A sensor MUST NOT report events for an IPv4 address that is not a globally-routable unicast address.  In particular, no IPv4 address in the Private Address Space of <a href="#RFC1918">[RFC1918]</a> should appear in a report, nor should any address in 127/8 nor 224/4.  An aggregator MUST ignore such addresses and SHOULD log the fact that they were received.</p>
<p id="rfc.section.7.p.3">A sensor MUST NOT report events for an IPv6 address that is not an Aggregatable Global Unicast Address as defined in <a href="#RFC4291">[RFC4291]</a>.  An IPv4-compatible IPv6 address or an IPv4-mapped IPv6 address MUST be reported as an IPv4 event and not an IPv6 event.  An aggregator MUST ignore events that violate this requirement and SHOULD log the fact that they were received.</p>
<p id="rfc.section.7.p.4">A sensor MUST NOT report a VIRUS event unless a virus was detected using a signature-based virus scanner.</p>
<p id="rfc.section.7.p.5">A sensor SHOULD include as many events in its report as necessary to make the report size at least 400 bytes.  A sensor MAY send out a shorter report, but MUST NOT do so unless failing to do so would result in loss of data OR unless it has not sent a report within the last hour.  For example, if a sensor process is about to exit and has buffered events in memory, it SHOULD report the buffered events before exiting, even if the report size would be less than 400 bytes and even if a report has been sent within the last hour.</p>
<p id="rfc.section.7.p.6">A sensor SHOULD NOT send a report that would exceed 492 bytes unless it has a priori knowledge that such a large UDP datagram will be received intact by the aggregator.  An aggregator MUST be prepared to handle a report as large as the largest possible UDP datagram (65507 bytes of actual data.)</p>
<p id="rfc.section.7.p.7">A sensor MUST NOT send an empty report (that is, a report with no subreports.)</p>
<p id="rfc.section.7.p.8">When an aggregator logs information about a report, it MUST log the originating IP address of the report.  If the report is well-formed, it MUST log the user name associated with the report.  It SHOULD log additional information concerning the disposition of the report and the reason for the disposition.</p>
<p id="rfc.section.7.p.9">If Hierarchical Aggregation is being used, a sensor MUST NOT report events to more than one aggregator.  A lower-level aggregator MUST NOT forward events to more than one higher-level aggregator.  These restrictions are required to avoid the possibility of counting the same event more than once.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> Report Layout</h1>
<div id="#rfc.figure.1"></div>
<pre>
                     1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| VERSION (=2)  | USERNAME LEN  |  USERNAME ...                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       USERNAME continued                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                        EIGHT RANDOM BYTES                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-|
|                    EIGHT RANDOM BYTES continued               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                            TIMESTAMP                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   FORMAT 1    |            LENGTH 1           |    DATA 1     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       DATA 1 CONTINUED ...                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   FORMAT 2    |            LENGTH 2           |    DATA 2     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
~                                                               ~
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         DATA 2 CONTINUED ...                  |   EOR (=0)    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          HMAC DIGEST                          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       HMAC DIGEST continued                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     HMAC DIGEST continued     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	    </pre>
<p id="rfc.section.8.p.1">The following diagram illustrates the layout of a report.  The version byte starts immediately after the UDP header.  </p>
<p id="rfc.section.8.p.2">Note that there are no alignment requirements or padding bytes.  The preceding figure shows some fields aligned to a four-byte boundary purely for ease of drawing.</p>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> Sample Report</h1>
<div id="#rfc.figure.2"></div>
<pre>
02                      -- Version 2 of the protocol
03                      -- Length of user name is 3 bytes
64 66 73                -- "dfs" in UTF-8
2a 9a 82 d6 51 29 64 f7 -- 8 random bytes
4b d9 da eb             -- 32-bit timestamp
01 00 0a                -- Two IPv4 events (Fmt 1, Len 10)
c0 00 02 02 03          -- 192.0.2.2 sent auto-spam (event type 3)
c0 00 02 03 01          -- 192.0.2.3 was greylisted (event type 1)
03 00 06                -- One Repeated-IPv4 event (Fmt 3, Len 6)
c0 00 02 04 08 03       -- 192.0.2.4 sent to invalid recip 3 times.
02 00 11                -- One IPv6 event (Fmt 2, Len 17 decimal)
20 01 0d b8 00 1d 00 e4 -- IPv6 address (first 8 bytes)
02 e0 18 ff fe ab 14 7f -- IPv6 address (last 8 bytes)
07                      -- Event type 7 (Valid Recipient)
00                      -- Subreport Format 0 (End of Reports)
0c 10 51 0f 5d          -- 10-byte truncated SHA1 HMAC
7e a1 e0 aa 20          -- 10-byte truncated SHA1 HMAC cont'd
		</pre>
<p id="rfc.section.8.1.p.1">The following figure shows a sample report.  The report is from the user "dfs" with password "foo".  It contains two IPv4 events: 192.0.2.2 sent mail automatically classified as spam, and 192.0.2.3 was greylisted.  There is a repeated IPv4 event: 192.0.2.4 sent to an invalid recipient 3 times.  Finally, There is one IPv6 event: 2001:db8:1d:e4:2e0:18ff:feab:147f sent mail to a valid recipient.  The bytes are shown in hexadecimal.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> IANA Considerations</h1>
<p id="rfc.section.9.p.1">This document defines a one-byte SUBREPORT FORMAT.  Formats 0 through 8 and 127 are defined in <a href="#formats">Section 4.2</a> of this document.  The IANA should set up the "IP Reputation Reporting Format Numbers" registry for registering formats 9 through 126.  Formats 128 through 254 are available for private use without requiring IANA registration.  Format 255 should not be used.</p>
<p id="rfc.section.9.p.2">This document defines a one-bye EVENT TYPE.  Event types 1 through 9 are described in <a href="#eventtypes">Section 5.1.1</a> of this document.  Event type 0 is reserved.  The IANA should set up the "IP Reputation Reporting Event Types" registry for registering event types 10 through 255.</p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Security Considerations</h1>
<p id="rfc.section.10.p.1">Because reports are transmitted via UDP, aggregators are vulnerable to IP address spoofing.  An aggregator MAY use techniques other than HMAC verification to reject reports.  For example, if it knows that a particular user always sends reports from a restricted set of IP addresses, it MAY discard reports claiming to be from that user if they originate from outside the restricted set of addresses.  The aggregator SHOULD log information about discarded reports.</p>
<p id="rfc.section.10.p.2">Reports are transmitted in the clear.  An eavesdropper can easily sniff user names from the reports.  The eavesdropper can also gain information about SMTP traffic as seen by sensors.  If this is undesirable, the sensor SHOULD arrange to transmit data to the aggregator over a secure channel using IPSec or some other VPN solution.</p>
<p id="rfc.section.10.p.3">The shared secret SHOULD be at least 8 bytes long and SHOULD be generated by a cryptographically-secure random number generator.  The shared secret SHOULD NOT be chosen by a human being because of the risk of picking a weak secret or a secret guessable from the user name.</p>
<p id="rfc.section.10.p.4">An aggregator SHOULD use the time stamp and random-number fields to detect duplicate reports and fend off replay attacks.  An aggregator SHOULD NOT accept a report whose timestamp is more than two minutes away from the current time.  (For this reason, both aggregators and sensors SHOULD synchronize their clocks to a standard time source using NTP <a href="#RFC1305">[RFC1305]</a>.)</p>
<p id="rfc.section.10.p.5">Aggregators implicitly trust sensors.  Therefore, aggregator administrators SHOULD ensure that sensor administrators follow security best-practices.  Both aggregator and sensor administrators MUST take the utmost care to keep their shared secret from leaking out.</p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1305">[RFC1305]</b></td>
<td class="top">
<a href="mailto:mills@udel.edu" title="University of Delaware, Electrical Engineering Department">Mills, D.</a>, "<a href="http://tools.ietf.org/html/rfc1305">Network Time Protocol (Version 3) Specification, Implementation</a>", RFC 1305, March 1992.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1918">[RFC1918]</b></td>
<td class="top">
<a href="mailto:yakov@cisco.com" title="Cisco systems">Rekhter, Y.</a>, <a href="mailto:rgm3@is.chrysler.com" title="Chrysler Corporation">Moskowitz, R.</a>, <a href="mailto:Daniel.Karrenberg@ripe.net" title="RIPE Network Coordination Centre">Karrenberg, D.</a>, <a href="mailto:GeertJan.deGroot@ripe.net" title="RIPE Network Coordination Centre">Groot, G.</a> and <a href="mailto:lear@sgi.com" title="Silicon Graphics, Inc.">E. Lear</a>, "<a href="http://tools.ietf.org/html/rfc1918">Address Allocation for Private Internets</a>", BCP 5, RFC 1918, February 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4291">[RFC4291]</b></td>
<td class="top">
<a>Hinden, R.</a> and <a>S. Deering</a>, "<a href="http://tools.ietf.org/html/rfc4291">IP Version 6 Addressing Architecture</a>", RFC 4291, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2104">[RFC2104]</b></td>
<td class="top">
<a href="mailto:hugo@watson.ibm.com" title="IBM, T.J. Watson Research Center">Krawczyk, H.</a>, <a href="mailto:mihir@cs.ucsd.edu" title="University of California at San Diego, Dept of Computer Science and Engineering">Bellare, M.</a> and <a href="mailto:canetti@watson.ibm.com" title="IBM T.J. Watson Research Center">R. Canetti</a>, "<a href="http://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>", RFC 2104, February 1997.</td>
</tr>
<tr>
<td class="reference"><b id="PEN">[PEN]</b></td>
<td class="top">
<a>IANA, </a>, "<a>Private Enterprise Numbers </a>", 2010.</td>
</tr>
<tr>
<td class="reference"><b id="PORTS">[PORTS]</b></td>
<td class="top">
<a>IANA, </a>, "<a>Port Numbers </a>", 2010.</td>
</tr>
<tr>
<td class="reference"><b id="GREY">[GREY]</b></td>
<td class="top">
<a href="mailto:eharris@puremagic.com">Harris, E.</a>, "<a>The Next Step in the Spam Control War: Greylisting </a>", August 2003.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">David F. Skoll</span> 
	  <span class="n hidden">
		<span class="family-name">Skoll</span>
	  </span>
	</span>
	<span class="org vcardline">Roaring Penguin Software Inc.</span>
	<span class="adr">
	  <span>17 Grenfell Crescent, Suite 209C</span>

	  <span class="vcardline">
		<span class="locality">Ottawa</span>,  
		<span class="region">ON</span> 
		<span class="code">K2G 0G3</span>
	  </span>
	  <span class="country-name vcardline">CA</span>
	</span>
	<span class="vcardline">Phone: +1 613 231-6599</span>

<span class="vcardline">EMail: <a href="mailto:dfs@roaringpenguin.com">dfs@roaringpenguin.com</a></span>

  </address>
</div>

</body>
</html>