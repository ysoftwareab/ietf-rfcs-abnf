<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Transport of Fast Notification Messages</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Acronyms">
<link href="#rfc.section.2" rel="Chapter" title="2 Design Goals">
<link href="#rfc.section.3" rel="Chapter" title="3 Transport Logic - Distribution of the Notifications">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Duplicate Check">
<link href="#rfc.section.4" rel="Chapter" title="4 Message Encoding">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Seamless Encapsulation">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Dedicated FN Message">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Authentication">
<link href="#rfc.section.4.2.1.1" rel="Chapter" title="4.2.1.1 Areas-scoped and Link-scoped Authentication">
<link href="#rfc.section.4.2.1.2" rel="Chapter" title="4.2.1.2 Simple Password Authentication">
<link href="#rfc.section.4.2.1.3" rel="Chapter" title="4.2.1.3 Cryptographic Authentication for FN">
<link href="#rfc.section.4.2.1.4" rel="Chapter" title="4.2.1.4 MD5">
<link href="#rfc.section.4.2.1.5" rel="Chapter" title="4.2.1.5 SHA256">
<link href="#rfc.section.4.2.1.6" rel="Chapter" title="4.2.1.6 Digital Signatures">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 FN Packet Processing Summary">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Further Options for Transport Logic">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Multicast Tree-based Transport">
<link href="#rfc.appendix.Appendix%20A.1.1" rel="Chapter" title="Appendix A.1.1 Fault Tolerance of a Single Distribution Tree">
<link href="#rfc.appendix.Appendix%20A.1.2" rel="Chapter" title="Appendix A.1.2 Pair of Redundant Trees">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Unicast">
<link href="#rfc.appendix.Appendix%20A.2.1" rel="Chapter" title="Appendix A.2.1 Method">
<link href="#rfc.appendix.Appendix%20A.2.2" rel="Chapter" title="Appendix A.2.2 Sample Operation">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 Gated Multicast through RPF Check">
<link href="#rfc.appendix.Appendix%20A.3.1" rel="Chapter" title="Appendix A.3.1 Loop Prevention - RPF Check">
<link href="#rfc.appendix.Appendix%20A.3.2" rel="Chapter" title="Appendix A.3.2 Operation">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Further Multicast Tree based Transport Options">
<link href="#rfc.appendix.Appendix%20A.4.1" rel="Chapter" title="Appendix A.4.1 Source Specific Trees">
<link href="#rfc.appendix.Appendix%20A.4.2" rel="Chapter" title="Appendix A.4.2 A Single Bidirectional Shared Tree">
<link href="#rfc.appendix.Appendix%20A.5" rel="Chapter" title="Appendix A.5 Layer 2 Networks">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies a fast, light-weight event notification protocol, called Fast Notification (FN) protocol. The draft discusses the design goals, the message container and options for delivering the notifications to all routers within a routing area.  " />
  <meta name="description" content="This document specifies a fast, light-weight event notification protocol, called Fast Notification (FN) protocol. The draft discusses the design goals, the message container and options for delivering the notifications to all routers within a routing area.  " />
  <meta name="keywords" content="fast notification, IPFRR, FN, convergence" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">W.L. Lu</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">S.K. Kini</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">A.Cs. Csaszar, Ed.</td>
</tr>
<tr>
<td class="left">Expires: January 12, 2012</td>
<td class="right">G.E. Enyedi</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J.T. Tantsura</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 11, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Transport of Fast Notification Messages<br />
  <span class="filename">draft-lu-fn-transport-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies a fast, light-weight event notification protocol, called Fast Notification (FN) protocol. The draft discusses the design goals, the message container and options for delivering the notifications to all routers within a routing area.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 12, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Acronyms</a>
</li>
<li>2.   <a href="#rfc.section.2">Design Goals</a>
</li>
<li>3.   <a href="#rfc.section.3">Transport Logic - Distribution of the Notifications</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Duplicate Check</a>
</li>
<li>4.   <a href="#rfc.section.4">Message Encoding</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Seamless Encapsulation</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Dedicated FN Message</a>
</li>
<li>4.2.1.   <a href="#rfc.section.4.2.1">Authentication</a>
</li>
<li>4.2.1.1.   <a href="#rfc.section.4.2.1.1">Areas-scoped and Link-scoped Authentication</a>
</li>
<li>4.2.1.2.   <a href="#rfc.section.4.2.1.2">Simple Password Authentication</a>
</li>
<li>4.2.1.3.   <a href="#rfc.section.4.2.1.3">Cryptographic Authentication for FN</a>
</li>
<li>4.2.1.4.   <a href="#rfc.section.4.2.1.4">MD5</a>
</li>
<li>4.2.1.5.   <a href="#rfc.section.4.2.1.5">SHA256</a>
</li>
<li>4.2.1.6.   <a href="#rfc.section.4.2.1.6">Digital Signatures</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">FN Packet Processing Summary</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Further Options for Transport Logic</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Multicast Tree-based Transport</a>
</li>
<li>Appendix A.1.1.   <a href="#rfc.appendix.Appendix%20A.1.1">Fault Tolerance of a Single Distribution Tree</a>
</li>
<li>Appendix A.1.2.   <a href="#rfc.appendix.Appendix%20A.1.2">Pair of Redundant Trees</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Unicast</a>
</li>
<li>Appendix A.2.1.   <a href="#rfc.appendix.Appendix%20A.2.1">Method</a>
</li>
<li>Appendix A.2.2.   <a href="#rfc.appendix.Appendix%20A.2.2">Sample Operation</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">Gated Multicast through RPF Check</a>
</li>
<li>Appendix A.3.1.   <a href="#rfc.appendix.Appendix%20A.3.1">Loop Prevention - RPF Check</a>
</li>
<li>Appendix A.3.2.   <a href="#rfc.appendix.Appendix%20A.3.2">Operation</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Further Multicast Tree based Transport Options</a>
</li>
<li>Appendix A.4.1.   <a href="#rfc.appendix.Appendix%20A.4.1">Source Specific Trees</a>
</li>
<li>Appendix A.4.2.   <a href="#rfc.appendix.Appendix%20A.4.2">A Single Bidirectional Shared Tree</a>
</li>
<li>Appendix A.5.   <a href="#rfc.appendix.Appendix%20A.5">Layer 2 Networks</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">Draft <a href="#I-D.lu-fast-notification-framework">[I-D.lu-fast-notification-framework]</a> describes the architectural framework to enable fast dissemination of a network event to routers in a limited area.  Existing use cases involve new approaches for IP Fast ReRoute such as <a href="#I-D.csaszar-ipfrr-fn">[I-D.csaszar-ipfrr-fn]</a>, and faster dissemination of link state information for routing protocols <a href="#I-D.kini-ospf-fast-notification">[I-D.kini-ospf-fast-notification]</a> in order to speed up convergence.  </p>
<p id="rfc.section.1.p.2">A hop by hop control plane based flooding mechanism is used widely today in link state routing protocols such as OSPF and ISIS to propagate routing information throughout an area. In this mechanism, the information is processed in the control plane at each hop before being forwarded to the next. The extra processing, scheduling, and communications overhead causes unnecessary delays in the dissemination of the information.  </p>
<p id="rfc.section.1.p.3">This draft proposes a generic fast notification (FN) protocol as a separate transport layer, which focuses on delivering notifications quickly in a secure manner. It can be used by many existing applications to enhance the performance of those applications, as well as to enable new services in the network.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Requirements Language</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Acronyms</h1>
<p></p>

<dl>
<dt>FN    &#8211;</dt>
<dd style="margin-left: 7">Fast Notification</dd>
<dt>IGP   &#8211;</dt>
<dd style="margin-left: 7">Interior Gateway Protocol</dd>
<dt>IS-IS &#8211;</dt>
<dd style="margin-left: 7">Intermediate System to Intermediate System</dd>
<dt>MD5   &#8211;</dt>
<dd style="margin-left: 7">Message Digest 5</dd>
<dt>OSPF  &#8211;</dt>
<dd style="margin-left: 7">Open Shortest Path First</dd>
<dt>RPF   &#8211;</dt>
<dd style="margin-left: 7">Reverse Path Forwarding</dd>
<dt>SHA   &#8211;</dt>
<dd style="margin-left: 7">Secure Hash</dd>
<dt>SPT   &#8211;</dt>
<dd style="margin-left: 7">Shortest Path Tree</dd>
<dt>STP   &#8211;</dt>
<dd style="margin-left: 7">Spanning Tree Protocol</dd>
</dl>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#Design_Goals" id="Design_Goals">Design Goals</a>
</h1>
<p id="rfc.section.2.p.1">A light-weight event notification mechanism that could be used to facilitate quick dissemination of information in a limited area should have the following properties.  </p>
<p></p>

<ol>
<li>The mechanism should be fast. It should provide low end to end propagation delay for the notifications.  </li>
<li>The signaling mechanism should offer a high degree of reliability under network failure conditions.  </li>
<li>The mechanism should be secure; that is, it should provide means to verify the authenticity of the notifications.  </li>
<li>The new protocol should not be dependent upon routing protocol flooding procedures.  </li>
<li>The mechanism should have low processing overhead </li>
</ol>
<p id="rfc.section.2.p.3">These design goals present a trade-off. Proper balance needs to be found that offers good authentication and reliability while keeping processing complexity sufficiently low to enable implementation in dataplane.  This draft proposes solutions that take the above goals and trade-offs into considerations.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#Transport_Logic" id="Transport_Logic">Transport Logic - Distribution of the Notifications</a>
</h1>
<p id="rfc.section.3.p.1">The distribution of a notification to multiple receivers can be implemented in many ways.  The main body of this draft describes one such option, a flooding-like approach.  </p>
<p id="rfc.section.3.p.2">In flooding mode, the IGP configures the dataplane cards to replicate each received FN message to each interface with a neighbour router in the same area.  </p>
<p id="rfc.section.3.p.3">This happens by making use of bidirectional multicast forwarding.  In bidir multicast, all interfaces added to the multicast group can be incoming and outgoing interfaces as well.  The principle is that a router replicates the incoming packet to *all* assigned interfaces except the incoming interface.  If the local router is the source of the packet to be forwarded, then the packet is replicated to all interfaces.  That is, the decision about which interfaces should actually be used as outgoing is determined on demand.  </p>
<p id="rfc.section.3.p.4">First, the FN service is assigned a multicast group address, let us call this MC-FN address.  Then, the IGP assigns all interfaces to MC-FN which lead to neighbouring routers.  </p>
<p id="rfc.section.3.p.5">When the FN service is instructed to disseminate a message, it creates an IP packet (as described below in <a href="#Message_Encoding">Section 4</a>) and sets its IP destination address to the MC-FN multicast address.  This IP packet is then multicasted to all IGP neighbours in the area.  </p>
<p id="rfc.section.3.p.6">Recipients of FN multicast-forward the packet according to the rules of bidirectional multicast, i.e. to all interfaces which the local IGP pre-configured except the incoming interface.  As this may cause loops without pre-caution (consider three routers in a triangle).  Before forwarding, therefore, the forwarding engine has to perform duplicate check.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#Dupl_Check" id="Dupl_Check">Duplicate Check</a>
</h1>
<p id="rfc.section.3.1.p.1">Duplicate check can be performed in numeruous ways.  </p>
<p id="rfc.section.3.1.p.2">Duplicate check can be performed by maintaining a short queue of previously forwarded FN messages.  Before forwarding, if the FN message is found in the queue, then it was forwarded beforehand, so it may be dropped.  Otherwise it should be forwarded and it should be added to the queue.  </p>
<p id="rfc.section.3.1.p.3">Alternatively, the queue may contain a signature of the previously forwarded FN messages, such as an MD5 or SHA256 signature or any other hash.  This signature may be carried in the packet, e.g. due to authentication purposes, such as with the authentication mechanisms described in <a href="#Authentication">Section 4.2.1</a>.  </p>
<p id="rfc.section.3.1.p.4">In either of the above queue-based mechanisms, the size of the queue can be set to a value that corresponds to the maximal number of legal FN messages generated by a single event.  For instance, if FN is used to broadcast failure identifiers in case of failures, then it is likely that the failure of the node with the most neighbours will trigger the most FN messages (1 from each neighbour).  </p>
<p id="rfc.section.3.1.p.5">It is also possible to use application-dependent duplicate check: the state machine of the FN-application can be left responsible to decide whether the information carried in the packet contains new information or it is a duplicate. This is only useful in the case if the application can perform the duplicate check faster then the above generic mechanisms.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Message_Encoding" id="Message_Encoding">Message Encoding</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#Seamless_Encapsulation" id="Seamless_Encapsulation">Seamless Encapsulation</a>
</h1>
<p id="rfc.section.4.1.p.1">An application may define its own message for FN to distribute quickly. In this case, only the special destination address (e.g. MC-FN) shows that the message was sent using the FN service.  </p>
<p id="rfc.section.4.1.p.2">In this case, the entire payload of the IP packet is determined by the application including sequence numbering and authentication. The IP packet's protocol field can also be set by the application.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#Dedicated_FN_Message" id="Dedicated_FN_Message">Dedicated FN Message</a>
</h1>
<p id="rfc.section.4.2.p.1">An alternative option is for the FN messages to be distributed in UDP datagrams with well-known port values in the UDP header that need to be allocated by IANA.  </p>
<p id="rfc.section.4.2.p.2">The FN packet format inside a UDP datagram is the following: </p>
<div id="#rfc.figure.1"></div>
<div id="#UDP_datagram"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-                                                             -+
   |                           IP Header                           |
   +-                +-------------+                              -+
   |                 | Protocol=UDP|                               |
   +-                +-------------+                              -+
   |                                                               |
   +-                                                             -+
   |                                                               |
   +---------------------------------------------------------------+
   |     UDP Source Port = FN      |   UDP Destination Port = FN   |
   +---------------------------------------------------------------+
   |                       UDP Header cont'd                       |
   +---------------------------------------------------------------+
   |                           FN Header                           |
   +---------------------------------------------------------------+
   |                              ...                              |
   .                                                               .
   .                          FN Payload                           .
   .                                                               .
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   .                                                               .
   .                     Authentication (optional)                 .
   .                                                               .
   |                              ...                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p></p>
<p id="rfc.section.4.2.p.3">The encoding of the FN Header is as follows: </p>
<div id="#rfc.figure.2"></div>
<div id="#encoding"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           FN Length           |  FN App Type  | AuType|unused |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ 
          </pre>
<p></p>
<p></p>

<dl>
<dt>FN Length (16 bits)</dt>
<dd style="margin-left: 3">
<br> The length of the FN message in bytes including the FN Header and the FN Payload. The authentication data optionally appended to the FN packet is not considered part of the FN message: the authentication data is not included in the FN Length field, although it is included in the length field of the packet's IP header.  </dd>
<dt>FN App Type (8 bits)</dt>
<dd style="margin-left: 3">
<br> Identifies the application which should be the receiver of the notification. A value for each application needs to be assigned by IANA.  </dd>
<dt>AuType</dt>
<dd style="margin-left: 3">
<br> Identifies the authentication procedure to be used for the packet.  Authentication options are discussed in <a href="#Authentication">Section 4.2.1</a> of the specification.  </dd>
</dl>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#Authentication" id="Authentication">Authentication</a>
</h1>
<p id="rfc.section.4.2.1.p.1">Fast Notification intends to provide a trustable service option, so that receivers of FN packets are able to verify that the packet is sent by an authentic source. Simple password authentication and hash based authentication methods (with Md5 or SHA256) are described in the following subsections.  </p>
<p id="rfc.section.4.2.1.p.2">If AuType is set to 0x0, then the FN packet is not carrying an Authentication field at the end of the packet.  If AuType is zero, AuLength must also be zero.  Note that even in this case the FN application in the payload may still use its own authentication mechanism.  </p>
<p id="rfc.section.4.2.1.p.3">If AuType is non null, an Authentication field must be appended after the FN message. The encoding of this field is as described below.  </p>
<div id="#rfc.figure.3"></div>
<div id="#Auth_field"></div>
<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   AuLength    |        ... Authentication Data ...            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                              ...                              |
   
          </pre>
<p></p>
<p></p>

<dl>
<dt>AuLength</dt>
<dd style="margin-left: 3">
<br> Describes the length of the entire Authentication field in bytes.  </dd>
</dl>
<h1 id="rfc.section.4.2.1.1">
<a href="#rfc.section.4.2.1.1">4.2.1.1.</a> <a href="#Auth_scope" id="Auth_scope">Areas-scoped and Link-scoped Authentication</a>
</h1>
<p id="rfc.section.4.2.1.1.p.1">Since FN is a solution to disseminate an event notification from one source to a whole area of nodes, the simplest approach would be to use per-area authentication, for example. a common password, a common pre- shared key among all nodes in the area as described in the following sub-sections, or digital signatures.  </p>
<p id="rfc.section.4.2.1.1.p.2">Carriers may, however, prefer per-link authentication. In order not to lose the speed (simple per-hop processing, fast forwarding property) of FN, link-scoped authentication is suggested only if the forwarding plane supports it, i.e. if there is hardware support to verify and re-generate authentication hop-by-hop. In such cases, the operator may need to configure a common pre-shared key only on routers connected by the same link. It is even possible that there is no authentication on some links considered safe.  </p>
<h1 id="rfc.section.4.2.1.2">
<a href="#rfc.section.4.2.1.2">4.2.1.2.</a> <a href="#Simple_Auth" id="Simple_Auth">Simple Password Authentication</a>
</h1>
<p id="rfc.section.4.2.1.2.p.1">Simple password authentication guards against routers inadvertently joining the routing area; each router must first be configured with a password before it can participate in Fast Notification.  </p>
<p id="rfc.section.4.2.1.2.p.2">The password is stored in the Authentication Data field. AuLength is set to the length of the password in bytes plus 1. Two AuType values for simple password authentication need to be allocated by IANA: one for area-scope and another for link-scoped.  </p>
<p id="rfc.section.4.2.1.2.p.3">With per-link authentication mode, the Authentication field must be stripped and regenerated hop-by-hop.  </p>
<p id="rfc.section.4.2.1.2.p.4">Simple password authentication, however, can be easily compromised as anyone with physical access to the network can read the password.  </p>
<h1 id="rfc.section.4.2.1.3">
<a href="#rfc.section.4.2.1.3">4.2.1.3.</a> <a href="#Crypto_Auth" id="Crypto_Auth">Cryptographic Authentication for FN</a>
</h1>
<p id="rfc.section.4.2.1.3.p.1">Using this authentication type, a secret key is used to generate/verify a "message digest" that is appended to the end of the FN packet. The message digest is a one-way function of the FN packet and the secret key. This authentication mechanism resembles the cryptographic authentication mechanism of <a href="#RFC2328">[RFC2328]</a>.  </p>
<h1 id="rfc.section.4.2.1.4">
<a href="#rfc.section.4.2.1.4">4.2.1.4.</a> <a href="#MD5" id="MD5">MD5</a>
</h1>
<p id="rfc.section.4.2.1.4.p.1">The packet signature is created by an MD5 hash performed on an object which is the concatenation of the FN message, including the FN header, and the pre-shared secret key. The resulting 16 byte MD5 message digest is appended to the FN message into the Authentication field as shown below.  </p>
<p id="rfc.section.4.2.1.4.p.2">The AuType in the FN header is set to indicate cryptographic authentication, the specific value is to be assigned by IANA both for area-scoped and for link-scoped versions.  </p>
<div id="#rfc.figure.4"></div>
<div id="#MD5_auth"></div>
<p></p>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   AuLength    |    Key ID     |             Unused            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Message Digest (bytes 1-4)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Message Digest (bytes 5-8)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Message Digest (bytes 9-12)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Message Digest (bytes 13-16)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </pre>
<p></p>
<p></p>

<dl>
<dt>AuLength</dt>
<dd style="margin-left: 3">
<br> AuLength is set to 20 bytes.  </dd>
<dt>Key ID</dt>
<dd style="margin-left: 3">
<br> This field identifies the algorithm and secret key used to create the message digest appended to the FN packet. This field allows that multiple pre-shared keys may exist in parallel.  </dd>
<dt>Message Digest</dt>
<dd style="margin-left: 3">
<br> The 16 byte long MD5 hash performed on an object which is the concatenation of the FN message, including the FN header, and the pre-shared secret key identified by Key ID.  </dd>
</dl>
<p id="rfc.section.4.2.1.4.p.4">When receiving an FN message, if the FN header indicates MD5 authentication, then the last 20 bytes of the FN message are set aside. The recipient forwarding plane element calculates a new MD5 digest of the remainder of the FN message to which it appends its own known secret key identified by Key ID. The calculated and received digests are compared. In case of mismatch, the FN message is discarded.  </p>
<p id="rfc.section.4.2.1.4.p.5">In per-link authentication mode, the Authentication field must be regenerated hop-by-hop using the key of the outgoing link.  </p>
<h1 id="rfc.section.4.2.1.5">
<a href="#rfc.section.4.2.1.5">4.2.1.5.</a> <a href="#SHA256" id="SHA256">SHA256</a>
</h1>
<p id="rfc.section.4.2.1.5.p.1">Similarly to how MD5 authentication works, it is possible to use Secure Hash 256 hash.  Currently this is a more secure hash function than MD5.  The Authentication field would look like this: </p>
<div id="#rfc.figure.5"></div>
<div id="#SHA256_auth"></div>
<p></p>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   AuLength    |    Key ID     |             Unused            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Message Digest (bytes 1-4)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Message Digest (bytes 5-8)               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                              . . .                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Message Digest (bytes 25-28)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Message Digest (bytes 29-32)              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
	      </pre>
<p></p>
<p></p>

<dl>
<dt>AuLength</dt>
<dd style="margin-left: 3">
<br> AuLength is set to 36 bytes.  </dd>
<dt>Key ID</dt>
<dd style="margin-left: 3">
<br> This field identifies the algorithm and secret key used to create the message digest appended to the FN packet. This field allows that multiple pre-shared keys may exist in parallel.  </dd>
<dt>Message Digest</dt>
<dd style="margin-left: 3">
<br> The 32 bytes long SHA256 value calculated on an object which is the concatenation of the FN message, including the FN header, and the pre-shared secret key identified by Key ID.  </dd>
</dl>
<p id="rfc.section.4.2.1.5.p.3">When receiving an FN message, if the FN header indicates SHA256 authentication, then the last 68 bytes of the FN message are set aside. The recipient forwarding plane element calculates a new SHA256 digest of the remainder of the FN message to which it appends its own known secret key identified by Key ID. The calculated and received digests are compared. In case of mismatch, the FN message is discarded.  </p>
<p id="rfc.section.4.2.1.5.p.4">In per-link authentication mode, the Authentication field must be regenerated hop-by-hop using the key of the outgoing link.  </p>
<h1 id="rfc.section.4.2.1.6">
<a href="#rfc.section.4.2.1.6">4.2.1.6.</a> <a href="#Digital_Signatures" id="Digital_Signatures">Digital Signatures</a>
</h1>
<p id="rfc.section.4.2.1.6.p.1">A router may choose to use public key cryptography to digitally sign the notification to provide certification of authenticity. This mechanism can avoid shared secret that is required for other authentication mechanisms described in this document. This authentication mechanism resembles the authentication mechanism of OSPF with digital signatures as defined in <a href="#RFC2154">[RFC2154]</a>.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Security_Considerations" id="Security_Considerations">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This draft has described basic optional procedures for authentication. The mechanism, however, does not protect against replay attacks.  </p>
<p id="rfc.section.5.p.2">If an application of FN require protection against replay attacks, then these applications should provide their own specific sequence numbering within the FN payload. Recipient applications should accept FN messages only if the included sequence number is valid.  </p>
<p id="rfc.section.5.p.3">Since the message digest of cryptographic authentication also covers the payload, even if an attacker knew how to construct the new sequence number, it would not be able to generate a correct message digest without the pre shared key. This way, a sequence number in the payload combined with FN's cryptographic authentication offers sufficient protection against replay attacks.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Packet_Proc" id="Packet_Proc">FN Packet Processing Summary</a>
</h1>
<p id="rfc.section.6.p.1">When receiving an FN packet, a node has to perform the following steps.  </p>
<p id="rfc.section.6.p.2">It has to identify that the packet is an FN packet. This can be done utilising the destination IP address (MC-FN) or by inspecting the UDP port field.  </p>
<p id="rfc.section.6.p.3">If the flooding like transport logic described in <a href="#Transport_Logic">Section 3</a> is used the node has to perform duplicate check following the teachings in <a href="#Dupl_Check">Section 3.1</a>.  </p>
<p id="rfc.section.6.p.4">If AuType is non-null, the node has to perform authentication check as discussed in <a href="#Authentication">Section 4.2.1</a>.  </p>
<p id="rfc.section.6.p.5">To protect against replay attacks, the node shall perform verification of the sequence number provided by the application.  </p>
<p id="rfc.section.6.p.6">Punt and forward.  The notification may need to be multicasted but it also needs to be punted to the local application on the linecard to start processing.  </p>
<p id="rfc.section.6.p.7">Authentication check, sequence number check and punting/forwarding may commence in any order deemed necessary by the operator.  If the operator prefers highest level of security, then both checks should be performed before forwarding.  If, however, the operator prefers per-hop performance but still wants to ensure that malice packets cannot harm the network, then authentication and sequence number checks may also happen after punting the packet, i.e. before processing the information contained inside the FN payload.  In this case, malicious packets may get propagated to every node but they still do not cause any change in the configuration.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#IANA_Considerations" id="IANA_Considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.7.p.1">A UDP port value needs to be assigned by IANA for FN. IANA also needs to maintain values for FN App Type as applications are being proposed.  </p>
<p id="rfc.section.7.p.2">Multicast addresses used for the distribution trees are either allocated by IANA or they can be a configuration parameter within the local domain.  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">The authors owe thanks to Acee Lindem, Joel Halpern and Jakob Heitz for their review and comments.  Also thanks to Alia Atlas for constructive feedback.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5015">[RFC5015]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Kouvelas, I.</a>, <a>Speakman, T.</a> and <a>L. Vicisano</a>, "<a href="http://tools.ietf.org/html/rfc5015">Bidirectional Protocol Independent Multicast (BIDIR-PIM)</a>", RFC 5015, October 2007.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="Eny2009">[Eny2009]</b></td>
<td class="top">
<a>Enyedi, G.</a>, <a>Retvari, G.</a> and <a>A. Csaszar</a>, "<a>On Finding Maximally Redundant Trees in Strictly Linear Time, IEEE Symposium on Computers and Communications (ISCC)</a>", 2009.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.lu-fast-notification-framework">[I-D.lu-fast-notification-framework]</b></td>
<td class="top">
<a>Lu, W</a>, <a>Tian, A</a> and <a>S Kini</a>, "<a href="http://tools.ietf.org/html/draft-lu-fast-notification-framework-00">Fast Notification Framework</a>", Internet-Draft draft-lu-fast-notification-framework-00, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.csaszar-ipfrr-fn">[I-D.csaszar-ipfrr-fn]</b></td>
<td class="top">
<a>Csaszar, A</a>, <a>Envedi, G</a>, <a>Tantsura, J</a>, <a>Kini, S</a>, <a>Sucec, J</a> and <a>S Das</a>, "<a href="http://tools.ietf.org/html/draft-csaszar-ipfrr-fn-02">IP Fast Re-Route with Fast Notification</a>", Internet-Draft draft-csaszar-ipfrr-fn-02, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2328">[RFC2328]</b></td>
<td class="top">
<a href="mailto:jmoy@casc.com" title="Ascend Communications, Inc.">Moy, J.</a>, "<a href="http://tools.ietf.org/html/rfc2328">OSPF Version 2</a>", STD 54, RFC 2328, April 1998.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.kini-ospf-fast-notification">[I-D.kini-ospf-fast-notification]</b></td>
<td class="top">
<a>Kini, S</a>, <a>Lu, W</a> and <a>A Tian</a>, "<a href="http://tools.ietf.org/html/draft-kini-ospf-fast-notification-01">OSPF Fast Notification</a>", Internet-Draft draft-kini-ospf-fast-notification-01, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2154">[RFC2154]</b></td>
<td class="top">
<a href="mailto:murphy@tis.com" title="Trusted Information Systems">Murphy, S.</a>, <a href="mailto:mrb@tis.com" title="Trusted Information Systems">Badger, M.</a> and <a href="mailto:bwelling@tis.com" title="Trusted Information Systems">B. Wellington</a>, "<a href="http://tools.ietf.org/html/rfc2154">OSPF with Digital Signatures</a>", RFC 2154, June 1997.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#Further_Options" id="Further_Options">Further Options for Transport Logic</a>
</h1>
<p id="rfc.section.Appendix A.p.1">The options described in this appendix represent alternative solutions to the flooding based approach described in Section <a href="#Transport_Logic">Section 3</a>.  </p>
<p id="rfc.section.Appendix A.p.2">It is left for WG discussion and further evaluation to decide whether any of these options should potentially be preferred instead of redundant trees.  </p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> <a href="#MTree" id="MTree">Multicast Tree-based Transport</a>
</h1>
<p id="rfc.section.Appendix A.1.p.1">One way of transporting an identical piece of information to several receivers at the same time is to use multicast distribution trees. A tree based transport solution is beneficial since multicast support is already implemented in all forwarding entities, so it is possible to use existing implementations.  </p>
<p id="rfc.section.Appendix A.1.p.2">With multicast or tree based transport, the Fast Notification (FN) packet can be recognized by a pre-configured or well known destination IP address, denoted by MC-FN in the following, which is the group address of the FN service.  </p>
<p id="rfc.section.Appendix A.1.p.3">If the FN service is triggered to send out a notification, the notification will be encapsulated in a new IP packet, where the destination IP address is set to MC-FN.  </p>
<h1 id="rfc.appendix.Appendix A.1.1">
<a href="#rfc.appendix.Appendix%20A.1.1">Appendix A.1.1.</a> <a href="#FTree" id="FTree">Fault Tolerance of a Single Distribution Tree</a>
</h1>
<p id="rfc.section.Appendix A.1.1.p.1">Several solutions described in this draft use a single tree to disseminate a notification from one given source.  </p>
<p id="rfc.section.Appendix A.1.1.p.2">The single tree solution is simple, however it is not redundant: a single failure may partition the tree, which will prevent notifications from reaching some nodes in the area.  </p>
<p id="rfc.section.Appendix A.1.1.p.3">Different applications may have different needs for reliability. For example, when we use fast notification to disseminate network failure information, all nodes surrounding the failure can detect and originate the failure notifications independently. Any one of these notifications (or a subset of them) may be sufficient for the application to make the right decision. This draft provides several different transport options from which an applications can choose.  </p>
<h1 id="rfc.appendix.Appendix A.1.2">
<a href="#rfc.appendix.Appendix%20A.1.2">Appendix A.1.2.</a> <a href="#Pair_Trees" id="Pair_Trees">Pair of Redundant Trees</a>
</h1>
<p id="rfc.section.Appendix A.1.2.p.1">If an FN application needs the exact same data to be distributed in the case of any single node or any single link failure, the FN service could opt to run in "redundant tree mode".  </p>
<p id="rfc.section.Appendix A.1.2.p.2">A pair of "redundant trees" ensures that at each single node or link failure each node still reaches the common root of the trees through at least one of the trees. A redundant tree pair is a known prior-art graph-theoretical object that is possible to find on any 2-node connected network. Even better, it is even possible to find maximally redundant trees in networks where the 2-node connected criterion does not "fully" hold (e.g. there are a few cut vertices) [Eny2009].  </p>
<p id="rfc.section.Appendix A.1.2.p.3">Note that the referenced algorithm(s) build a pair of trees considering a specific root. The root can be selected in different ways, the only thing that is important that each node makes the same selection, consistently. For instance, the node with the highest or lowest router ID can be used.  </p>
<div id="#rfc.figure.6"></div>
<div id="#Common_Root"></div>
<p></p>
<pre>
      #1 tree                              #2 tree
      +---+       +---+                    +---+       +---+
      | B |=======|   |                    | B |=======|   |
      +---+       +---+                    +---+       +---+
      //               \\                 //                 \
      //                 \\               //                   \
 +---+                     +---+      +---+                     +---+
 | A |---------------------| R |      | A |=====================| R |
 +---+                     +---+      +---+                     +---+
      \                  //               \\                   /
      \                //                 \\                 /
      +---+       +---+                    +---+       +---+
      |   |=======|   |                    |   |=======|   |
      +---+       +---+                    +---+       +---+
	    </pre>
<p></p>
<p id="rfc.section.Appendix A.1.2.p.4">There is one special constraint in building the redundant trees. A (maximally) redundant tree pair is needed, where in one of the trees the root has only one child in order to protect against the failure of the root itself. Algorithms presented in [Eny2009] produce such trees.  </p>
<p id="rfc.section.Appendix A.1.2.p.5">In redundant-tree mode, each node multicasts the requested notification on both trees, if it is possible, but at least along one of the trees. Redundant trees require two multicast group addresses.  MC-FN identifies one of the trees, and MC-FN-2 identifies the other tree.  </p>
<p id="rfc.section.Appendix A.1.2.p.6">Each node multicast forwards the received notification packet (on the same tree). The root node performs as every other node but in addition it also multicast the notification on the other tree! I.e.  it forwards a replica of the incoming notification in which it replaces the destination address identifying the other multicast distribution tree.  </p>
<p id="rfc.section.Appendix A.1.2.p.7">When the network remains connected and the root remains operable after a single failure, the root will be reached on at least one of the trees. Thus, since the root can reach every node along at least one of the trees, all the notifications will reach each node.  However, when the root or the link to the root fails, that tree, in which the root has only one child, remains connected (the root is a leaf there), thus, all the nodes can be reached along that tree.  </p>
<p id="rfc.section.Appendix A.1.2.p.8">For example, let us consider that in <a href="#Common_Root">Figure 6</a> FN is used to disseminate failure information. If link A-B fails, the notifications originating from node B (e.g. reporting that the connectivity from B to A is lost) will reach R on tree #1. Notifications originating from A (e.g. reporting that the connectivity from A to B is lost) will reach R on tree #2. From R, each node is reachable through one of the trees, so each node will be notified about both events.  </p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> <a href="#Unicast" id="Unicast">Unicast</a>
</h1>
<p id="rfc.section.Appendix A.2.p.1">This method addresses the need in a unique way. It has the following properties: </p>
<p></p>

<ul class="empty">
<li>Plain simple, without the need of any forwarding plane change or cooperation; </li>
<li>Short turnaround time (i.e. ready for next hit); </li>
<li>100% link break coverage (may not work in certain node failure cases); </li>
<li>Little change to OSPF (need encapsulation for IS-IS).  </li>
</ul>
<h1 id="rfc.appendix.Appendix A.2.1">
<a href="#rfc.appendix.Appendix%20A.2.1">Appendix A.2.1.</a> <a href="#Method" id="Method">Method</a>
</h1>
<p id="rfc.section.Appendix A.2.1.p.1">The method is simple in design, easy to implement and quick to deploy. It requires no topology changes or specific configurations.  It adds little overhead to the overall system.  </p>
<p id="rfc.section.Appendix A.2.1.p.2">The method sends the event message to every router in the area in an IP packet. This appears burdensome to the sending router which has to duplicate the packet sending effort many times. Practical experience has shown, however, that the amount of effort is not a big concern in reasonable sized networks.  </p>
<p id="rfc.section.Appendix A.2.1.p.3">Normal flooding (regular or fast) process requires a router to duplicate the packet to all flooding eligible interfaces. All routers have to be fast-flooding-aware. This implies new code to every router in control plane and/or forwarding plane.  </p>
<p id="rfc.section.Appendix A.2.1.p.4">The method uses a different approach. It takes advantage of the given routing/forwarding table in each router in the IP domain. The originating router of the flooding information simply sends multiple copies of the packet to each and every router in the domain. These packets are forwarded to the destination routers at forwarding plane speed, </p>
<p id="rfc.section.Appendix A.2.1.p.5">just like the way the regular IP data traffic is handled. No special handling in any other routers is needed.  </p>
<p id="rfc.section.Appendix A.2.1.p.6">This small delay on the sender can be minimized by pre-downloading the link-broken message packets to the forwarding plane. Since the forwarding plane already has the list of all routers which are part of the IGP routing table, the forwarding plane can dispatch the packet directly.  </p>
<p id="rfc.section.Appendix A.2.1.p.7">In essence, the flooding in this method is tree based, just like a multicast tree. The key is that no special tree is generated for this purpose; the normal routing table which is an SPF tree (SPT) plays a role of the flooding tree. This logic guarantees that the flooding follows the shortest path and no flooding loop is created.  </p>
<h1 id="rfc.appendix.Appendix A.2.2">
<a href="#rfc.appendix.Appendix%20A.2.2">Appendix A.2.2.</a> <a href="#Sample_Operation" id="Sample_Operation">Sample Operation</a>
</h1>
<p><a href="#Multiple_Unicast">Figure 7</a> depicts a scenario where router A wants to flood its message to all other routers in the domain using the unicast flooding method.  </p>
<p id="rfc.section.Appendix A.2.2.p.2">Instead of sending one packet to each of its neighbor, and letting the neighbor flood the packet further, router A directly send the same packet to each router in the domain, one at a time. In this sample network, router A sends out 5 packets.  </p>
<div id="#rfc.figure.7"></div>
<div id="#Multiple_Unicast"></div>
<p></p>
<pre>
	      A---B---C---D
	      \
	      --E---F

	      1. Packet(A-&gt;B);
	      2. Packet(A-&gt;C);
	      3. Packet(A-&gt;D);
	      4. Packet(A-&gt;E);
	      5. Packet(A-&gt;F).
	    </pre>
<p></p>
<p id="rfc.section.Appendix A.2.2.p.3">The unicast flooding procedure is solely controlled by the sending router. No action is needed from other routers other than their normal forwarding functionalities. This method is extremely simple and useful for quick prototyping and deployment.  </p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> <a href="#Gated" id="Gated">Gated Multicast through RPF Check</a>
</h1>
<p id="rfc.section.Appendix A.3.p.1">This method fulfills the purpose with the following characters: </p>
<p></p>

<ol>
<li>No need to build the multicast tree. It is the same as the SPT computed by the IGP routing process; </li>
<li>Flooding loops are prevented by RPF Check.  </li>
</ol>
<p id="rfc.section.Appendix A.3.p.3">The method has all the benefits of multicast flooding. It, however, does not require running multicast protocol to setup the multicast tree. The unicast shortest path tree is used as a multicast tree.  </p>
<h1 id="rfc.appendix.Appendix A.3.1">
<a href="#rfc.appendix.Appendix%20A.3.1">Appendix A.3.1.</a> <a href="#RPF_Check" id="RPF_Check">Loop Prevention - RPF Check</a>
</h1>
<p id="rfc.section.Appendix A.3.1.p.1">In this mechanism, the distribution tree is not explicitly built.  Rather, each node will first do a Reverse Path Forwarding (RPF) check before it floods the notification to other links.  </p>
<p id="rfc.section.Appendix A.3.1.p.2">A special multicast address is defined and is subject to IANA approval. This address is used to qualify the notification packet for fast flooding. When a notification packet arrives, the receiving node will perform an IP unicast routing table lookup for the originator IP address of the notification and find the outgoing interface. Only when the arriving interface of the notification is the same as the outgoing interface leading towards the originator IP address, will the notification be flooded to other interfaces.  </p>
<p id="rfc.section.Appendix A.3.1.p.3">IP Multicast forwarding with RPF check is available on most of the routing/switching platforms. To support flooding with RPF check, a special IP multicast group must be used. A bi-directional IP multicast forwarding entry is created that consists of all interfaces within the flooding scope, typically an IGP area.  </p>
<h1 id="rfc.appendix.Appendix A.3.2">
<a href="#rfc.appendix.Appendix%20A.3.2">Appendix A.3.2.</a> <a href="#Operation" id="Operation">Operation</a>
</h1>
<p id="rfc.section.Appendix A.3.2.p.1">The Gated flooding operation is illustrated in <a href="#Gated_flooding">Figure 8</a>.  </p>
<div id="#rfc.figure.8"></div>
<div id="#Gated_flooding"></div>
<p></p>
<pre>
      All Routers, IGP Process:
      if (SPT ready) {
       duplicate the SPT as Bidir_Multicast_tree;
       download the multicast_tree to forwarding plane;
      }
      add FNF_multicast_group_addr;

	      Sender of the FNF notification:
      if (breakage detected) {
       pack the notification in a packet;
       send the packet to the FNF_multicast_group_addr;
      }

      Receiver of the FNF notification:
       if (notification received) {
       if (RPC_interface == incoming_interface) {
        multicast the notification to all other interfaces;
       }
       forward the notification to IGP for processing;
      }
	    </pre>
<p></p>
<p><a href="#Loop_Prevention">Figure 9</a> shows a sample operation on a four-router mesh network. The left figure is the topology. The right figure is the shortest path tree rooted at A.  </p>
<p id="rfc.section.Appendix A.3.2.p.3">Router A initiates the flooding. But the downstream routers B, C, and D will drop all messages except the ones that come from their shortest path parent node. For example, A's message to C via B is dropped by C, because C knows that its reverse path forwarding (RPF) nexthop is A.  </p>
<div id="#rfc.figure.9"></div>
<div id="#Loop_Prevention"></div>
<p></p>
<pre>
	      A       A
	      /|\     / \
	      B---C   B   C
	      \|/     \
	      D       D
	    </pre>
<p></p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> <a href="#Further_Multicast" id="Further_Multicast">Further Multicast Tree based Transport Options</a>
</h1>
<h1 id="rfc.appendix.Appendix A.4.1">
<a href="#rfc.appendix.Appendix%20A.4.1">Appendix A.4.1.</a> <a href="#Source_Specific" id="Source_Specific">Source Specific Trees</a>
</h1>
<p id="rfc.section.Appendix A.4.1.p.1">One implementation option is to rely on source specific multicast.  This means that even though there is only a single multicast group address (MC-FN) allocated to the FN service, the FIB of each router is configured with forwarding information for as many trees as many FN sources (nodes) there are in the routing area, i.e. to each (S_i,MC-FN) pair.  </p>
<h1 id="rfc.appendix.Appendix A.4.2">
<a href="#rfc.appendix.Appendix%20A.4.2">Appendix A.4.2.</a> <a href="#A_Single" id="A_Single">A Single Bidirectional Shared Tree</a>
</h1>
<p id="rfc.section.Appendix A.4.2.p.1">In the previous solution each source specific tree is a spanning tree. It is possible to reduce the complexity of managing and configuring n spanning trees in the area by using bidirectional shared trees. By building a bidirectional shared tree, all nodes on the tree can send and receive traffic using that single tree. Each sent packet from any source is multicasted on the tree to all other receivers.  </p>
<p id="rfc.section.Appendix A.4.2.p.2">The tree must be consistently computed at all routers. For this, the following rules may be given: </p>
<p id="rfc.section.Appendix A.4.2.p.3">The tree can be computed as a shortest path tree rooted at e.g. the highest router-id. When multiple paths are available, the neighbouring node in the graph e.g. with highest router-id can be picked. When multiple paths are available through multiple interfaces to a neighbouring node, e.g. a numbered interface may be preferred over an unnumbered interface. A higher IP address may be preferred among numbered interfaces and a higher ifIndex may be preferred among unnumbered interfaces.  </p>
<p id="rfc.section.Appendix A.4.2.p.4">Note, however, that the important point is that the rules are consistent among nodes. That is, a router may pick the lower router IDs if it is ensured that ALL routers will do the same to ensure consistency.  </p>
<p id="rfc.section.Appendix A.4.2.p.5">Multicast forwarding state is installed using such a tree as a bi- directional tree. Each router on the tree can send packets to all other routers on that tree.  </p>
<p id="rfc.section.Appendix A.4.2.p.6">Note that the multicast spanning tree can be built using <a href="#RFC5015">[RFC5015]</a> so that each router within an area subscribes to the same multicast group address. Using BIDIR-PIM in such a way will eventually build a multicast spanning tree among all routers within the area. (BIDIR-PIM is normally used to build a shared, bidirectional multicast tree among multiple sources and receivers.) </p>
<h1 id="rfc.appendix.Appendix A.5">
<a href="#rfc.appendix.Appendix%20A.5">Appendix A.5.</a> <a href="#Layer_2" id="Layer_2">Layer 2 Networks</a>
</h1>
<p id="rfc.section.Appendix A.5.p.1">Layer 2 (e.g. Ethernet) networks offer further options for distributing the notification (e.g. using spanning trees offered by STP). Definition of these is being considered and will be included in a future revision of this draft.  </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Wenhu Lu</span> 
	  <span class="n hidden">
		<span class="family-name">Lu</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>300 Holger Way</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">California</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Wenhu.Lu@ericsson.com">Wenhu.Lu@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sriganesh Kini</span> 
	  <span class="n hidden">
		<span class="family-name">Kini</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>300 Holger Way</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">California</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Sriganesh.Kini@ericsson.com">Sriganesh.Kini@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Andras Csaszar</span> editor
	  <span class="n hidden">
		<span class="family-name">Csaszar</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Irinyi J utca 4-10</span>

	  <span class="vcardline">
		<span class="locality">Budapest</span>,  
		<span class="region"></span>
		<span class="code">1117</span>
	  </span>
	  <span class="country-name vcardline">Hungary</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Andras.Csaszar@ericsson.com">Andras.Csaszar@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Gabor Sandor Enyedi</span> 
	  <span class="n hidden">
		<span class="family-name">Enyedi</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>Irinyi J utca 4-10</span>

	  <span class="vcardline">
		<span class="locality">Budapest</span>,  
		<span class="region"></span>
		<span class="code">1117</span>
	  </span>
	  <span class="country-name vcardline">Hungary</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Gabor.Sandor.Enyedi@ericsson.com">Gabor.Sandor.Enyedi@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jeff Tantsura</span> 
	  <span class="n hidden">
		<span class="family-name">Tantsura</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span>300 Holger Way</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">California</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Jeff.Tantsura@ericsson.com">Jeff.Tantsura@ericsson.com</a></span>

  </address>
</div>

</body>
</html>