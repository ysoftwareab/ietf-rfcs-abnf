<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>DTN Bundle Age Block for Expiration without UTC</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="DTN Bundle Age Block for Expiration without UTC">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">D. Brown</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Raytheon BBN Technologies</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">S. Farrell</td></tr>
<tr><td class="header">Expires: October 30, 2010</td><td class="header">Trinity College Dublin</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">S. Burleigh</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Jet Propulsion Laboratory</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">April 28, 2010</td></tr>
</table></td></tr></table>
<h1><br />DTN Bundle Age Block for Expiration without UTC<br />draft-irtf-dtnrg-bundle-age-block-00</h1>

<h3>Abstract</h3>

<p>
    As originally specified, <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> presumes that any DTN
    node will have access to accurate real world time.
    Experience has shown that there are devices and networks
    where accurate real world time is difficult or impossible
    to consistently obtain.
    
</p>
<p>
    This draft proposes an extension
    block that contains the current age of a bundle in order
    to support bundle expiration for nodes and networks that
    have faulty, intermittent, or no notion of the real world
    time.  Bundle age may be used to expire bundles by a
    Bundle Protocol Agent which does not have access to
    accurate real world time.  The Age must be updated at each
    hop in order to maintain accuracy.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on October 30, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Requirements Terminology<br />
<a href="#anchor2">2.</a>&nbsp;
Other Terminology<br />
<a href="#anchor3">3.</a>&nbsp;
Introduction<br />
<a href="#anchor4">4.</a>&nbsp;
Age Extension Block<br />
<a href="#anchor5">5.</a>&nbsp;
Applicability<br />
<a href="#anchor6">6.</a>&nbsp;
Age Block Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#no_aeb_support">6.1.</a>&nbsp;
At Nodes without AEB Support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.2.</a>&nbsp;
At nodes with AEB support<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.3.</a>&nbsp;
Expiration<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.4.</a>&nbsp;
Upon Bundle Creation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.4.1.</a>&nbsp;
At nodes with UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.4.2.</a>&nbsp;
At nodes without UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.5.</a>&nbsp;
Upon BPA Enqueuing to CLA<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.5.1.</a>&nbsp;
At nodes with UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.5.2.</a>&nbsp;
At nodes without UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#upon_access_from_storage">6.6.</a>&nbsp;
Upon Retrieval from Persistent Storage<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.7.</a>&nbsp;
At CLA Transmission and Reception<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.8.</a>&nbsp;
Upon Reception by BPA<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.9.</a>&nbsp;
While Bundle Resident at BPA<br />
<a href="#anchor18">7.</a>&nbsp;
Interoperability<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.1.</a>&nbsp;
Bundle Forwarding Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.1.1.</a>&nbsp;
UTC to non-UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">7.1.2.</a>&nbsp;
Non-UTC to UTC<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">7.2.</a>&nbsp;
Interaction with Fragmentation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">7.3.</a>&nbsp;
Security<br />
<a href="#anchor24">8.</a>&nbsp;
Future Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">8.1.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#age_in_primary_block">8.2.</a>&nbsp;
Incorporation of Age into Bundle Primary Block<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.3.</a>&nbsp;
Margin of Error for Time Values<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Requirements Terminology</h3>

<p>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in
      RFC 2119.
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Other Terminology</h3>

<p> This document distinguishes between devices which are only able to
    measure elapsed time and those which have access to global time.  Access
    to global time will be referred to as Coordinated Universal Time (UTC)
    whether the node stores UTC directly or can infer it based on the
    local wall clock time and current time zone.  Devices which do
    not have access to UTC will be referred to as having "node local" or
    just "local" time. 
</p>
<p> Accuracy refers to the ability of a node to maintain correct elapsed
    or UTC time since the last synchronization information received.  Lack
    of accuracy is also referred to as clock drift. 
</p>
<p> Precision refers to the granularity of the time representation.  For example,
    microseconds is higher precision than milliseconds. 
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Introduction</h3>

<p> Experience has shown that clock drift in DTN nodes is sometimes unavoidable and
    has detrimental effects on the protocol.  The detrimental effects are
    magnified for bundles sourced with short lifetimes. 
</p>
<p> Additionally, <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> compliance is not possible when devices
    do not have access to accurate UTC via either synchronization or an accurate, persistent
    battery-backed UTC clock.  An <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a>-compliant DTN implementation currently
    requires either an accurate UTC clock or a battery-backed RTC and the
    consistent availability of synchronization signals. 
</p>
<p> There is a variety of scenarios where neither of these requirements can
    be met.  Many COTS devices such as cell phones, smartphones, and military
    radios contain no internal battery suitable for a persistent RTC,
    and so provide no time when powered on outside the reach of provider infrastructure. 
</p>
<p> In the case of smartphones, these devices
    are generally tamper-resistent and as such offer no reasonable means for
    changing an internal battery.  Military devices tend to eschew internal
    consumer oriented batteries which may leak, preferring instead external
    hardened battery packs which may be disconnected frequently,
    making a persistent clock impractical. 
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Age Extension Block</h3>

<p> This document proposes an Age Extension Block (AEB),
    which denotes the time since the bundle has been created, with microsecond
    precision. 
</p>
<p> The Age Extension Block format below includes the <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> required
    block header fields. 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+----------------+----------------+-------------------+------------+
|  Block type    | Proc. Flags (*)|  Block length(*)  |   Age(*)   |
+----------------+----------------+-------------------+------------+

(*) Self-Delimiting Numeric Values (SDNVs).  See RFC 5050 Sec. 4.1
</pre></div>
<p> Support for the AEB by BPA implementations is RECOMMENDED for
    interoperability but not required. 
</p>
<p> The Age field is defined to represent the approximate elapsed number of
    microseconds since the creation of the bundle. 
</p>
<p> The "Block must be replicated in every fragment" bit must be set
    for the AEB.  This also dictates that the AEB must occur before the
    payload block per <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> Sec. 4.3. 
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Applicability</h3>

<p> Tracking bundle age solely via the AEB
    is insufficient for applications where a bundle spends an
    indeterminate amount of time in suspension.  When a bundle with
    a zero-valued CreationTimestamp is stored to persistent media, for example,
    and the time of its storage is unknown or inaccurate, its age cannot
    in general be determined with any reasonable accuracy upon later
    being accessed. 
</p>
<p> An example of this situation is when a bundle with a zero-valued
    CreationTime is stored on a USB mass storage device regardless of whether
    it is treated as a DTN link or node.  Unless the
    time of storage is tracked separately or known to be accurately stored
    on the filesystem, then the Age is unknown upon access. 
</p>
<p> See also <a class='info' href='#upon_access_from_storage'>Section&nbsp;6.6<span> (</span><span class='info'>Upon Retrieval from Persistent Storage</span><span>)</span></a>. 
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Age Block Processing</h3>

<a name="no_aeb_support"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
At Nodes without AEB Support</h3>

<p> Nodes which do not support the AEB must have access to UTC time and
      therefore can only expire bundles on the basis described in <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a>.
</p>
<p> To improve interoperability with BPAs
      that implement the support for the AEB, whenever a BPA that does not
      support processing the AEB receives a bundle with creation time
      zero the BPA MAY use zero as 'the current time' for the purposes of
      section 5.5 of RFC5050 with respect to treatment of that bundle.
      When implemented, this mechanism prevents deletion of the bundle due to an
      incorrectly computed expiration time. 
</p>
<p> All further specification of AEB treatment applies only to nodes
      which support the AEB unless stated otherwise. 
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
At nodes with AEB support</h3>

<p> It is expected that implementations which support the AEB will have a means
      of tracking the elapsed time a bundle is resident at a node in order to
      appropriately update the AEB age field upon delivery to a local endpoint or
      forwarding to another node, or to determine the time a bundle should
      be expired.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Expiration</h3>

<p> If the AEB is supported by a receiving node, the bundle MUST be treated
      as expired if Age > Lifetime. 
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Upon Bundle Creation</h3>

<p> Since a zero-valued Creation Time field is used to signal that the sender
      does not have access to accurate UTC, then a BPA MUST NOT create a bundle with
      both a zero-valued Creation Time and no AEB. 
</p>
<p> For the sake of interoperability it is RECOMMENDED that an AEB be
      provided whenever it is not impractical to do so. 
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.1"></a><h3>6.4.1.&nbsp;
At nodes with UTC</h3>

<p> There may be DTNs where all nodes have accurate realtime clocks, and bundles
        are not expected to travel to other networks.  In these cases, A BPA MAY
        add a bundle age extension block when creating a bundle. In all other cases,
        where it is possible that bundles may be received by nodes without
        accurate realtime clocks, the AEB SHOULD be added at creation time. 
</p>
<p> If the BPA has access to UTC upon creation of a bundle, it SHOULD
        place the current UTC into the Creation Timestamp field when creating
        a bundle. 
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4.2"></a><h3>6.4.2.&nbsp;
At nodes without UTC</h3>

<p> If a BPA does not have access to UTC or chooses not to set the Creation
        Timestamp on UTC, a BPA MUST create an AEB with value 0 and set the Lifetime
        field to the desired time to live for the bundle. 
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Upon BPA Enqueuing to CLA</h3>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5.1"></a><h3>6.5.1.&nbsp;
At nodes with UTC</h3>

<p> Any time a bundle is enqueued at a CLA for transmission by
        a BPA with access to UTC, the BPA SHOULD first update the AEB age field as
        UTC - CreationTimestamp.  This applies whether the bundle originated
        at the node or this node is forwarding a bundle originating at
        another node. 
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5.2"></a><h3>6.5.2.&nbsp;
At nodes without UTC</h3>

<p> If UTC is unavailable, the AEB age field should be increased
        by the time which has elapsed since the age field was last updated or
        if the age field was not updated, by the elapsed time since the bundle
        was received.  This applies whether the bundle originated
        at the node or this node is forwarding a bundle originating at
        another node. 
</p>
<a name="upon_access_from_storage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Upon Retrieval from Persistent Storage</h3>

<p> A bundle with a zero-valued CreationTime and with an
      indeterminate age SHOULD be treated as expired upon being read from
      persistent storage.  This situation arises, for example, when a node
      without access to UTC accesses bundles from persistent storage after
      power cycling.  Such a node cannot determine the elapsed time that
      a bundle has spent in persistent storage across power cycles. 
</p>
<p> Bundles with a non-zero CreationTime MAY be forwarded since it
      may be possible for some node with UTC to accurately update the AEB age
      field. 
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7"></a><h3>6.7.&nbsp;
At CLA Transmission and Reception</h3>

<p> In some networks a convergence layer and/or the CLA may impose
      non-negligible delays.  In deep space networks, propagation delay can
      be significant.  Other CLAs may impose other delays, for example
      CLAs which provide some notion of reliable delivery to multiple
      neighbors. 
</p>
<p> A CLA SHOULD convey additional delays imposed either by non-neglible
      propagation delay or non-negligible queuing delay at the CLA.  The
      CLA implementation should make provisions for either the sender or
      receiver or some combination of sender and receiver to provide this
      information.
</p>
<p> This representation SHOULD be made available to the receiving BPA 
      as an elapsed value conveyed by the CLA to the BPA with the bundle. 
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.8"></a><h3>6.8.&nbsp;
Upon Reception by BPA</h3>

<p> In general, a DTN node should maintain an accurate representation of
        a bundle's age so that the bundle can be accurately expired and the
        AEB field can be accurately maintained across transmissions.  Each
        time the bundle is delivered to a local endpoint or forwarded to another
        node, the AEB should be made to reflect the
        age of the bundle as accurately as possible.  This implies that nodes
        without UTC will need to store the UTC or node-local time associated
        with the reception of a bundle in order to later determine the elapsed
        resident time and accurately update the AEB age field upon transmission
        or delivery, or to determine the UTC or node-local time at which the bundle
        should expire.  The age field is updated as
        Age = Age + ElapsedTime, where ElapsedTime = NodeLocalTime - RecordedNodeLocalTime or
        ElapsedTime = UTC - RecordedUTC. 
</p>
<p> The BPA SHOULD take into account elapsed time spent at a CLA if the
        CLA provides this information.  The age field should be updated upon
        reception by the BPA in this case by Age = Age + ElapsedTimeAtCLA.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.9"></a><h3>6.9.&nbsp;
While Bundle Resident at BPA</h3>

<p> A resident bundle whose age exceeds its lifetime while residing at a node
      should be expired.  Note that age in this context needs to include the bundle's
      AEB age field and any elapsed time while resident at the node which is not
      presently accounted for in the age field. 
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Interoperability</h3>

<p> Interoperability can be achieved between nodes which support AEB or between nodes
    which have access to UTC.  Since the AEB provides the necessary time
    information for a node without UTC to process the bundle, the only circumstance
    in which interoperability cannot be achieved is between an implementation which
    does not support the AEB (and which therefore must have access to UTC), and
    another node which does not have access to UTC.
</p>
<p> If a bundle is sourced by a UTC node without an AEB, nodes without UTC
    cannot reasonably process the bundle.  If a bundle is sourced by a node
    without UTC (and must therefore have an AEB), this bundle cannot be
    reasonably processed by a UTC node which has no AEB support (with the 
    possible exception of being allowed to forward the bundle without delay, see
    <a class='info' href='#no_aeb_support'>Section&nbsp;6.1<span> (</span><span class='info'>At Nodes without AEB Support</span><span>)</span></a>).
</p>
<p> This interoperability issue may be partly mitigated by the provision
    of a gateway node which adds AEB extension blocks to bundles which are
    sourced without one.  This allows nodes without UTC to process bundles sourced
    by UTC nodes that do not support the AEB. 
</p>
<p> For the time being, interoperability can only be fully realized in
    networks which contain only nodes with UTC or in networks where all nodes
    implement the AEB.  See <a class='info' href='#age_in_primary_block'>Section&nbsp;8.2<span> (</span><span class='info'>Incorporation of Age into Bundle Primary Block</span><span>)</span></a>. 
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Bundle Forwarding Examples</h3>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
UTC to non-UTC</h3>

<p> A UTC node which supports the age extension block creates a bundle which
        has a UTC timestamp for the creation field, and presumably a small or zero-valued
        AEB age field.  The bundle is forwarded to a non-UTC node.  The non-UTC node
        examines the age field, compares Age to Lifetime and determines that the bundle
        is still valid.  The node also associates the node-local time with the bundle
        as soon as it arrives.  Upon retransmitting the bundle or delivering the bundle
        to an application, presuming it has not expired, the node calculates the
        AEB age field as:  Age = Age + UTC - RecordedUTC. 
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.2"></a><h3>7.1.2.&nbsp;
Non-UTC to UTC</h3>

<p> A Non-UTC node can only process bundles which have an AEB and so we can presume
        that a bundle forwarded from a Non-UTC node has an AEB.  We will also presume
        for this example that the bundle originated like it did in the previous example
        at a UTC node and therefore has a non-zero CreationTimestamp.  In this case the
        bundle arrives at the receiving UTC node which, seeing the non-zero CreationTimestamp
        ignores the AEB and processes the bundle as described in RFC 5050.  Upon forwarding
        the bundle to a next hop, the UTC node updates the Age field as:
        Age = UTC - CreationTimestamp. 
</p>
<p> If the bundle was instead sourced at a Non-UTC node, then the bundle has a
        zero-valued CreationTimestamp.  Upon receiving this bundle, the UTC node records
        the bundle's UTC time of arrival.  Upon transmitting or delivering this bundle,
        the node updates the AEB age field based on UTC - RecordedBundleUTC. 
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Interaction with Fragmentation</h3>

<p> A BPA needs to fragment a bundle which is larger than the MTU imposed by the
      CLA over which the bundle will be forwarded.  In that case, the BPA creates bundle
      fragments which are themselves bundles.  These bundles may be forwarded at different
      times and therefore must carry different age values.  Because of this, the
      "Block must be replicated in every fragment" bit must be set for the AEB, and each
      bundle fragment must have its AEB age field appropriately set according to the
      specifications contained here. 
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Security</h3>

<p> When security is a concern and since the AEB age field can change at each hop,
      the AEB MAY be encrypted on a hop-by-hop basis via the Bundle Security Protocol
      provided by <a class='info' href='#I-D.irtf-dtnrg-bundle-security'>[I&#8209;D.irtf&#8209;dtnrg&#8209;bundle&#8209;security]<span> (</span><span class='info'>Symington, S., Farrell, S., Weiss, H., and P. Lovell, &ldquo;Bundle Security Protocol Specification,&rdquo; February&nbsp;2010.</span><span>)</span></a> Section 2.5.
      In that case, the Security-destination MUST be present and MUST specify
      the EID of the next forwarding hop. 
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Future Considerations</h3>

<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
IANA Considerations</h3>

<p> An IANA block type registration for the AEB will need eventually be created. 
</p>
<a name="age_in_primary_block"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Incorporation of Age into Bundle Primary Block</h3>

<p> It is strongly recommended that specification of Age at bundle inception
      and the processing of Age values become mandated by moving the Age value
      in some form into the Bundle primary block at some future time.
      This will improve interoperability and precision of bundle expiration
      without detrimental effect on expiration semantics for current <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> 
      implementations. 
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Margin of Error for Time Values</h3>

<p> As previously shown, the AEB's age may contain some error.  Propagation
      delay that is difficult or impossible to account for is one potential source
      of error.  This type of error may accumulate at each hop.  Another potential
      source of error is an inaccurate RTC.  Nodes which have a somewhat
      synchronized but potentially inaccurate clock require some means for
      expressing the potential inaccuracy of Creation timestamps for sourced bundles. 
</p>
<p> In the former case, a Margin Of Error (MOE) field associated with the Age value
      seems like a reasonable mechanism for extending bundle lifetime in the face
      of accumulated Age error.  The MOE field represents plus-or-minus uncertainty.
      For example, a 5 second MOE indicates that the Age is expected to be accurate
      to within +/- 5 seconds. 
</p>
<p> A bundle SHOULD NOT be considered expired unless Age - AgeMOE - CreationMOE > Lifetime. 
</p>
<p> In the latter case, a node with a somewhat synchronized RTC might create
      bundles with a non-zero Creation timestamp.  In this case, the Age value can
      be considered a more accurate representation of the bundle's age than
      CurrentTime - CreationTime.  However, without being able to represent this
      state of affairs, a node with an accurate RTC may incorrectly adjust the Age
      value since it may only presume that the CreationTime is accurate. 
</p>
<p> Considering MOE values for Age, Creation, RTC, the bundle SHOULD be expired
      if and only if Age - CreationMOE - AgeMOE > Lifetime or RTC - RTCMOE > Lifetime. 
</p>
<p> Here is a graphical depiction of MOE for Age, Creation time and RTC: 
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 ================== Lifetime ====================
                       |
                   ____|
                       |\
             + RTCMOE  | \
                   ----|  } &lt;-- RTC
             - RTCMOE  | /
                   ____|/
                       |
                       |____
                      /|
                     / |   + AgeMOE
            Age --&gt; {  |----
                     \ |   - AgeMOE
                      \|____
                       |
                       |
                       |____
                      /|
                     / |   + CreationMOE
       Creation --&gt; {  |--
                     \ |   - CreationMOE
                      \|____
                       |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Margin of Error&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p> This would seem to argue for an eventual specification of margin of error
      for some or all time fields specified in the bundle.  Since these
      considerations involve additional complexity and potential changes to
      <a class='info' href='#RFC5050'>[RFC5050]<span> (</span><span class='info'>Scott, K. and S. Burleigh, &ldquo;Bundle Protocol Specification,&rdquo; November&nbsp;2007.</span><span>)</span></a> itself, they are only noted in this document as future considerations
      and not treated normatively for the protocol. 
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.irtf-dtnrg-bundle-security">[I-D.irtf-dtnrg-bundle-security]</a></td>
<td class="author-text">Symington, S., Farrell, S., Weiss, H., and P. Lovell, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-irtf-dtnrg-bundle-security-15.txt">Bundle Security Protocol Specification</a>,&rdquo; draft-irtf-dtnrg-bundle-security-15 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-irtf-dtnrg-bundle-security-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4838">[RFC4838]</a></td>
<td class="author-text">Cerf, V., Burleigh, S., Hooke, A., Torgerson, L., Durst, R., Scott, K., Fall, K., and H. Weiss, &ldquo;<a href="http://tools.ietf.org/html/rfc4838">Delay-Tolerant Networking Architecture</a>,&rdquo; RFC&nbsp;4838, April&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4838.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5050">[RFC5050]</a></td>
<td class="author-text">Scott, K. and S. Burleigh, &ldquo;<a href="http://tools.ietf.org/html/rfc5050">Bundle Protocol Specification</a>,&rdquo; RFC&nbsp;5050, November&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc5050.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Daniel W. Brown</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Raytheon BBN Technologies</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">10 Moulton St.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cambridge, MA  02138</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dbrown@bbn.com">dbrown@bbn.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephen Farrell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Trinity College Dublin</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Distributed Systems Group</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Department of Computer Science</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Trinity College</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Dublin  2</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ireland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+353-1-896-2354</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:stephen.farrell@cs.tcd.ie">stephen.farrell@cs.tcd.ie</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scott Burleigh</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jet Propulsion Laboratory</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4800 Oak Grove Drive, m/s 301-490</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pasadena, California  91109</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-818-393-3353</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:scott.c.burleigh@jpl.nasa.gov">scott.c.burleigh@jpl.nasa.gov</a></td></tr>
</table>
</body></html>
