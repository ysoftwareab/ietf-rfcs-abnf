SIP-URL            =    short-sip-url | full-sip-url
full-sip-url       =    "sip://" ( user | phone ) [ ":" password ]
                                "@" [ host | nhost ]
                                url-parameters [ headers ]
short-sip-url      =    ( user | phone) [ ":" password ]
                                "@" [ host | nhost ] : port
user               =    ;  defined in RFC 1738 [20]
phone              =    "+" DIGIT *( DIGIT | "-" | "." )
host               =    ;  defined in RFC 1738
nhost              =    "[" hostnumber "]" | hostnumber
hostnumber         =    digits "." digits "." digits "." digits
port               =    *digit
url-parameters     =    *( ";" url-parameter)
url-parameter      =    transport-param |
                                ttl-param | maddr-param
transport-param    =    "transport=" ( "udp" | "tcp" )
ttl-param          =    "ttl=" ttl
ttl                =    1*3DIGIT                                        ; 0 to 255
maddr-param        =    "maddr=" maddr
maddr              =    ;  dotted decimal multicast address
headers            =    "?" header *( "                               " header )
header             =    hname "=" hvalue
hname              =    *urlc
hvalue             =    *urlc
urlc               =    ;  defined in [19]
digits             =    1*digit


generic-message    =    start-line
                                *message-header
                                CRLF
                                [ message-body ]

start-line         =    Request-Line |       Section 4.1
                                Status-Line          Section 5.1




message-header    =    *( general-header
                               | request-header
                               | entity-header )



Request    =    Request-Line         ;  Section 4.1
                        *( general-header
                        | request-header
                        | entity-header )
                        CRLF
                        [ message-body ]     ;  Section 8


general-header     =     Call-ID                ; Section 6.12
                           |     CSeq                   ; Section 6.26
                           |     Date                   ; Section 6.15
                           |     Expires                ; Section 6.16
                           |     From                   ; Section 6.17
                           |     Via                    ; Section 6.33
entity-header      =     Content-Length         ; Section 6.13
                           |     Content-Type           ; Section 6.14
request-header     =     Accept                 ; Section 6.6
                           |     Accept-Language        ; Section 6.7
                           |     Authorization          ; Section 6.10
                           |     Call-Disposition       ; Section 6.11
                           |     Organization           ; Section 6.19
                           |     Priority               ; Section 6.20
                           |     Proxy-Authorization    ; Section 6.22
                           |     Require                ; Section 6.24
                           |     Subject                ; Section 6.28
                           |     To                     ; Section 6.31
                           |     User-Agent             ; Section 6.32
response-header    =     Location               ; Section 6.18
                           |     Proxy-Authenticate     ; Section 6.21
                           |     Public                 ; Section 6.23
                           |     Retry-After            ; Section 6.25
                           |     Server                 ; Section 6.27
                           |     Unsupported            ; Section 6.29
                           |     Warning                ; Section 6.34
                           |     WWW-Authenticate       ; Section 6.35


method    =    "INVITE" | "ACK" | "OPTIONS"
                 |     "BYE" | "REGISTER" | "UNREGISTER"


Response    =    Status-Line          ;  Section 5.1
                         *( general-header
                         | response-header
                         | entity-header )
                         CRLF
                         [ message-body ]     ;  Section 8


Status-Code       =    Informational                  Fig. 3
                         |     Success                        Fig. 3
                         |     Redirection                    Fig. 4
                         |     Client-Error                   Fig. 5
                         |     Server-Error                   Fig. 6
                         |     Global-Failure                 Fig. 7
                         |     extension-code
extension-code    =    3DIGIT
Reason-Phrase     =    *<TEXT,  excluding CR, LF>
Informational    =    "100"    ;  Trying
                        |     "180"    ;  Ringing
                        |     "181"    ;  Queued




Success    =    "200"    ;  OK


Redirection    =    "300"    ;  Multiple Choices
                      |     "301"    ;  Moved Permanently
                      |     "302"    ;  Moved Temporarily
                      |     "303"    ;  See Other
                      |     "305"    ;  Use Proxy
                      |     "380"    ;  Alternative Service


Client-Error    =    "400"    ;  Bad Request
                       |     "401"    ;  Unauthorized
                       |     "402"    ;  Payment Required
                       |     "403"    ;  Forbidden
                       |     "404"    ;  Not Found
                       |     "405"    ;  Method Not Allowed
                       |     "407"    ;  Proxy Authentication Required
                       |     "408"    ;  Request Timeout
                       |     "409"    ;  Conflict
                       |     "410"    ;  Gone
                       |     "411"    ;  Length Required
                       |     "412"    ;  Precondition Failed
                       |     "413"    ;  Request Message Body Too Large
                       |     "414"    ;  Request-URI Too Large
                       |     "415"    ;  Unsupported Media Type
                       |     "420"    ;  Bad Extension
                       |     "480"    ;  Temporarily not available
                       |     "481"    ;  Invalid Call-ID
                       |     "482"    ;  Loop Detected


Server-Error    =    "500"    ;  Internal Server Error
                       |     "501"    ;  Not Implemented
                       |     "502"    ;  Bad Gateway
                       |     "503"    ;  Service Unavailable
                       |     "504"    ;  Gateway Timeout
                       |     "505"    ;  SIP Version not supported


message-header    =    field-name ":" [ field-value ] CRLF
field-name        =    token
field-value       =    *( field-content | LWS )
field-content     =    < the OCTETs  making up the field-value
                                and consisting of either *TEXT or combinations
                                of token, tspecials, and quoted-string>


Content-Length = "Content-Length" ":" 1*DIGIT


Location              =    ( "Location" | "m" ) ( SIP-URL | URL )
                                   *( ";" location-params )
extension-name       =     token
extension-value      =     *( token | quoted-string | LWS | extension-specials)
extension-specials   =      < any element of  tspecials except <"> >
language-tag         =     <  see [H3.10] >
priority-tag         =     "urgent" | "normal" | "non-urgent"
service-tag          =     "fax" | "IP" | "PSTN" | "ISDN" | "pager"
media-tag            =      < see SDP: "audio" | "video" | "email" ...
feature-list         =     "voice-mail" | "attendant"




location-params       =    "q"                     "="    qvalue
                              |    "class"                 "="    ( "personal" | "business" )
                              |    "description"           "="    quoted-string
                              |    "duplex"                "="    ( "full" | "half" |
                                                                  "receive-only" | "send-only" )
                              |    "features"              "="    1# feature-list
                              |    "language"              "="    1# language-tag
                              |    "media"                 "="    1# media-tag
                              |    "mobility"              "="    ( "fixed" | "mobile" )
                              |    "priority"              "="    1# priority-tag
                              |    "service"               "="    1# service-tag
                              |    extension-attributes
extension-attribute   =    extension-name          "="    extension-value


language=en,es,iw ;q=0.5
duplex=send-only;media=text; q=0.1; priority=urgent;
description="For emergencies only"
Priority          =    "Priority" ":" priority-value
priority-value    =    "urgent" | "normal" | "non-urgent"


CSeq = "CSeq" ":" 1*DIGIT


To = ( "To" | "t" ) ":" ( SIP-URL | URL ) [ comment ]


Via                   =    ( "Via" | "v") ":" 1#( sent-protocol sent-by
                                   *( ";" via-params ) [ comment ] )
via-params            =    "ttl" "=" ttl
sent-protocol         =    [ protocol-name "/" ] protocol-version
protocol-name         =    "SIP" | token
protocol-version      =    token
transport             =    "UDP" | "TCP"
sent-by               =    host [ ":" port ]
ttl                   =    1*3DIGIT                                         ; 0 to 255


Warning          =    "Warning" ":" 1#warning-value
warning-value    =    warn-code SP warn-agent SP warn-text
warn-code        =    2DIGIT
warn-agent       =    ( host [ ":" port ] ) | pseudonym
                              ;  the name or pseudonym of the server adding
                              ;  the Warning header, for use in debugging
warn-text        =    quoted-string


v=0
o=user1 53655765 2353687637 IN IP4 128.3.4.5
s=Mbone Audio
i=Discussion of Mbone Engineering Issues
e=mbone@somewhere.com
c=IN IP4 224.2.0.1/127
t=0 0
m=audio 3456 RTP/AVP 0



v=0
o=bell 53655765 2353687637 IN IP4 128.3.4.5
c=IN IP4 135.180.144.94
m=audio 3456 RTP/AVP 0 3 4 5

v=0
o=watson 4858949 4858949 IN IP4 192.1.2.3
c=IN IP4 135.180.161.25
m=audio 5004 RTP/AVP 0 3



v=0
o=mm-server 2523535 0 IN IP4 131.215.131.131
s=Answering Machine
i=Leave an audio message
c=IN IP4 131.215.131.131
t=0 0
m=audio 12345 RTP/AVP 0



v=0
o=mm-server 2523535 0 IN IP4 131.215.131.131
s=Answering Machine
i=Leave an audio message
c=IN IP4 128.16.64.19
t=0 0
m=audio 26472 RTP/AVP 0



v=0
s=Lets talk
b=CT:128
c=IN IP4 131.215.131.131
m=audio 3456 RTP/AVP 7 0 13
m=video 2232 RTP/AVP 31



language=en,es,iw ;q=0.5
duplex=send-only;media=text; q=0.1



v=0
m=audio 0 RTP/AVP 0 1 3 99
m=video 0 RTP/AVP 29 30
v=0
o=user1 53655765 2353687637 IN IP4 128.3.4.5
s=Mbone Audio
i=Discussion of Mbone Engineering Issues
e=mbone@somewhere.com
c=IN IP4 224.2.0.1/127
t=0 0
m=audio 3456 RTP/AVP 0



N = /* number of addresses to try */
r = await_response();
class = r.status / 100;

best = r.status;
multicast = 0;
best = r.status;
best = r.status;
best = 404;
CR       =    %d13            ;  carriage return character
LF       =    %d10            ;  line feed character
CRLF     =    CR LF           ;  typically the end of a line
SP       =    %d32            ;  space character
TAB      =    %d09            ;  tab character
LWS      =    *( SP | TAB)    ;  linear whitespace
DIGIT    =    "0" .. "9"      ;  a single decimal digit



