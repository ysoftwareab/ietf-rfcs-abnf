<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Congestion Control for the Constrained Application Protocol (CoAP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Congestion Control for the Constrained Application Protocol (CoAP)">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">L. Eggert</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nokia</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">June 23, 2010</td></tr>
<tr><td class="header">Expires: December 25, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Congestion Control for the Constrained Application Protocol (CoAP)<br />draft-eggert-core-congestion-control-00</h1>

<h3>Abstract</h3>

<p>
The Constrained Application Protocol (CoAP) is a simple, low-overhead, UDP-based protocol for use with resource-constrained IP networks and nodes. CoAP defines a simple technique to individually retransmit lost messages, but has no other congestion control mechanisms.

This document motivates the need for additional congestion control mechanisms, and defines some simple strawman proposals. The goal is to encourage experimentation with these and other proposals, in order to determine which mechanisms are feasible to implement on resource-constrained nodes and are effective real deployments.
	
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may not be modified, and derivative works of it may
not be created, except to format it for publication as an RFC or
to translate it into languages other than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on December 25, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>

<a name="intro"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
The Constrained Application Protocol (CoAP) <a class='info' href='#I-D.ietf-core-coap'>[I&#8209;D.ietf&#8209;core&#8209;coap]<span> (</span><span class='info'>Shelby, Z., Frank, B., and D. Sturek, &ldquo;Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a> is a simple, low-overhead, UDP-based protocol for use with resource-constrained IP networks and nodes. 
	
</p>
<p>
CoAP defines two kinds of interactions between end-points:
	</p>
<ol class="text">
<li>a client/server interaction model, where request or notify messages initiate a transaction with a server, which may send a response to the client with a matching transaction ID
</li>
<li>an asynchronous subscribe/notify interaction model, where a server can send notify messages to a client about a resource which the client has subscribed to
	
</li>
</ol><p>

CoAP uses the User Datagram Protocol (UDP) <a class='info' href='#RFC0768'>[RFC0768]<span> (</span><span class='info'>Postel, J., &ldquo;User Datagram Protocol,&rdquo; August&nbsp;1980.</span><span>)</span></a> to transmit these messages and defines a simple mechanism to individually retransmit lost messages using an exponentially backed-off timer.
	
</p>
<p>
This document argues that although this retransmission mechanism is a required first step to implement congestion control for CoAP, it alone is not sufficient to alleviate network overload in all conditions. <a class='info' href='#background'>Section&nbsp;2<span> (</span><span class='info'>Discussion of Internet Congestion Control Principles</span><span>)</span></a> gives a short summary of Internet congestion control principles, and <a class='info' href='#proposal'>Section&nbsp;3<span> (</span><span class='info'>CoAP Congestion Control</span><span>)</span></a> presents some simple strawman proposals that attempt to complement the current message retransmission mechanism in CoAP.
	
</p>
<a name="background"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Discussion of Internet Congestion Control Principles</h3>

<p>
<a class='info' href='#RFC2914'>[RFC2914]<span> (</span><span class='info'>Floyd, S., &ldquo;Congestion Control Principles,&rdquo; September&nbsp;2000.</span><span>)</span></a> describes the best current practices for congestion control in the Internet, and requires that Internet communication employ congestion control mechanisms. Because UDP itself provides no congestion control mechanisms, it is up to the applications and application-layer protocols that use UDP for Internet communication to employ suitable mechanisms to prevent congestion collapse and establish a degree of fairness. CoAP is one such application-layer protocol.
	
</p>
<p>
<a class='info' href='#RFC2914'>[RFC2914]<span> (</span><span class='info'>Floyd, S., &ldquo;Congestion Control Principles,&rdquo; September&nbsp;2000.</span><span>)</span></a> identifies two major reasons why congestion control mechanisms are critical for the stable operation of the Internet:

	</p>
<ol class="text">
<li>
The prevention of congestion collapse, i.e., a state where an increase in network load results in a decrease in useful work done by the network. 
		
</li>
<li>
The establishment of a degree of fairness, i.e., allowing multiple flows to share the capacity of a path reasonably equitably. 
		
</li>
</ol><p>
	
</p>
<p>
The overwhelming majority of the bytes on the Internet are caused by bulk transfers, and the traditional congestion control mechanisms are engineered to saturate the network without driving it into congestive collapse. Fairness between flows is an important consideration when the network operates around the saturation point, so that new flows are not disadvantaged compared to established flows, and can obtain a reasonable share of the capacity quickly.
	
</p>
<p>
The environments that CoAP targets are IP networks, although more resource-constrained ones than the "big-I" Internet. This does not eliminate the need for end-point-based congestion control. If anything, the environments that CoAP will be deployed in have fewer capabilities for network provisioning, traffic engineering and capacity allocation, which are among the techniques that can sometimes offset the need for end-to-end congestion control to some degree. 
	
</p>
<p>
However, the environments that CoAP targets are sufficiently different from the "big-I" Internet so that the motivations for congestion control from <a class='info' href='#RFC2914'>[RFC2914]<span> (</span><span class='info'>Floyd, S., &ldquo;Congestion Control Principles,&rdquo; September&nbsp;2000.</span><span>)</span></a> should probably be weighted differently. CoAP networks will not be used for bulk data transfers and CoAP nodes will not need to use a significant fraction of the capacity of a path to provide a useful service. (In fact, they are often too resource-constrained to do so in the first place.) Under normal operation, a CoAP network will be mostly idle, which means that fairness between the transmissions of different CoAP nodes is not a large issue. A CoAP congestion control mechanism can hence focus on preventing congestion collapse, which is a much more tractable problem given the specific conditions of CoAP environments.
	
</p>
<p>
The current IETF congestion control mechanisms, such as TCP <a class='info' href='#RFC5681'>[RFC5681]<span> (</span><span class='info'>Allman, M., Paxson, V., and E. Blanton, &ldquo;TCP Congestion Control,&rdquo; September&nbsp;2009.</span><span>)</span></a> or TFRC <a class='info' href='#RFC5348'>[RFC5348]<span> (</span><span class='info'>Floyd, S., Handley, M., Padhye, J., and J. Widmer, &ldquo;TCP Friendly Rate Control (TFRC): Protocol Specification,&rdquo; September&nbsp;2008.</span><span>)</span></a>, all focus on determining a "safe" sending rate for a bulk transfer, i.e., for a single flow of many packets between a sender and destination where many packets are in flight at any given time. They measure the path characteristics, such as round-trip time (RTT) and packet loss rate, by monitoring the ongoing transfer and use this information to adjust the sending rate of the flow during the transmission.
	
</p>
<p>
This approach is not feasible for CoAP. The infrequent request/response interaction that CoAP supports does not generate sufficient data about the path characteristics to drive a traditional congestion control loop, even if the notion of "a flow" to a destination is extended from "one CoAP transaction" to "a sequence of CoAP transactions". This approach is also not applicable to multicast transmissions, which CoAP offers.
	
</p>
<p>
<a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> documents the IETF's current best practices for using UDP for unicast communication in the Internet. It provides guidance on topics such as message sizes, reliability, checksums, middlebox traversal and congestion control. Section 3.1.2 of <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a>, which focuses on congestion control for low data-volume applications, is especially relevant to CoAP. 
	
</p>
<p>
Section 3.1.2 of <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> acknowledges that the traditional IETF congestion control mechanisms are not applicable for low data-volume application protocols such as CoAP. Instead, it recommends that such application protocols:

	</p>
<ul class="text">
<li>maintain an estimate of the RTT for any destination with which they communicate, or assume a conservative fixed value of 3 seconds when no RTT estimate can be obtained (e.g., unidirectional communication)
</li>
<li>control their transmission behavior by not sending on average more than one UDP datagram per RTT to a destination
</li>
<li>detect packet loss and exponentially back their retransmission timer off when a loss event occurs
</li>
<li>employ congestion control for both directions of a bi-directional communication
</li>
</ul><p>
	
</p>
<p>
CoAP follows some of these guidelines already. It uses a fixed value of 1 second for its retransmission timer for both requests and responses, which although shorter than the recommended value in <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> is likely appropriate for many of its deployment scenarios. CoAP also uses exponential back-off for its retransmission timer.
	
</p>
<p>
This alone, however, does not result in a complete congestion control mechanism for CoAP. <a class='info' href='#proposal'>Section&nbsp;3<span> (</span><span class='info'>CoAP Congestion Control</span><span>)</span></a> defines an experimental complement to the current CoAP mechanism described in <a class='info' href='#I-D.ietf-core-coap'>[I&#8209;D.ietf&#8209;core&#8209;coap]<span> (</span><span class='info'>Shelby, Z., Frank, B., and D. Sturek, &ldquo;Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a>.
	
</p>
<a name="proposal"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
CoAP Congestion Control</h3>

<p>
This section proposes several congestion control techniques for CoAP that are intended to improve its ability to prevent congestion collapse. At the moment, these techniques are described with the intent of encouraging experimentation with such proposals in CoAP simulations and testbed deployments. Of particular interest are mechanism requiring little computation and state, i.e., mechanisms that can be implemented in resource-constrained nodes without much overhead. 
	
</p>
<a name="timers"></a><br /><hr />
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Retransmissions</h3>

<p>
	CoAP already defines a simple retransmission scheme with exponential back-off, where messages that have not been responded to in RESPONSE_TIMEOUT are retransmitted, followed by doubling RESPONSE_TIMEOUT. Up to MAX_RETRANSMIT retransmission attempts are made. (At the moment, <a class='info' href='#I-D.ietf-core-coap'>[I&#8209;D.ietf&#8209;core&#8209;coap]<span> (</span><span class='info'>Shelby, Z., Frank, B., and D. Sturek, &ldquo;Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a> defines RESPONSE_TIMEOUT to be 1 second and MAX_RETRANSMIT to be five attempts.) As stated above, although RESPONSE_TIMEOUT is shorter than what <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> recommends, the shorter value is likely to not cause large issues in many deployments that CoAP targets. 	
	
</p>
<p>
However, using a fixed value for RESPONSE_TIMEOUT instead of basing it on the measured RTT to a destination has some minor drawbacks. CoAP may be used in deployments where the path RTTs can approach the currently defined RESPONSE_TIMEOUT of 1 second, such as Internet deployments involving GSM or 3G links, or cases where preparing a response can involve significant computation or where it otherwise incurs delays, such as long sleep cycles at the receiver. Fixed timeouts that are too short can cause spurious retransmissions, i.e., unnecessary retransmissions in cases where either the request or the response are still in transit. Spurious retransmissions, especially persistent ones, waste resources.
	
</p>
<p>
This section therefore proposes that CoAP deployments experiment with maintaining an estimate of the RTT for any destination with which they communicate. Specifically, it is suggested that deployments experiment with the algorithm specified in <a class='info' href='#RFC2988'>[RFC2988]<span> (</span><span class='info'>Paxson, V. and M. Allman, &ldquo;Computing TCP's Retransmission Timer,&rdquo; November&nbsp;2000.</span><span>)</span></a> to compute a smoothed RTT (SRTT) estimate, and compute RESPONSE_TIMEOUT in the same way <a class='info' href='#RFC2988'>[RFC2988]<span> (</span><span class='info'>Paxson, V. and M. Allman, &ldquo;Computing TCP's Retransmission Timer,&rdquo; November&nbsp;2000.</span><span>)</span></a> computes RTO.
	
</p>
<p>
A second suggestion is to experiment with a longer RESPONSE_TIMEOUT, such as 3 seconds, which is what <a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> recommends, in order to determine if there are significant drawbacks or whether this value could be lengthened.
	
</p>
<a name="aggregate"></a><br /><hr />
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Aggregate Congestion Control</h3>

<p>
Traditional Internet congestion control algorithms control the sending rate of a single flow. When a node establishes multiple, parallel flows, their congestion control loops run (mostly) independently of one another. Interactions between the control loops of parallel flows is (mostly) indirect, e.g., a rate increase of one flow may cause packet loss and a rate decrease to another.
	
</p>
<p>
CoAP "flows", i.e., sequences of infrequent CoAP transactions between the same two nodes, do not require much more per-flow congestion control than a retransmission scheme that reduces the rate (increases the back-off) of a flow under loss, and a (low) cap on the number of allowed outstanding requests to a destination. (<a class='info' href='#RFC5405'>[RFC5405]<span> (</span><span class='info'>Eggert, L. and G. Fairhurst, &ldquo;Unicast UDP Usage Guidelines for Application Designers,&rdquo; November&nbsp;2008.</span><span>)</span></a> recommends "on average not more than one" outstanding transaction to a given destination.)
	
</p>
<p>
On the other hand, CoAP applications may potentially want to initiate many transactions with different nodes at the same time. Allowing CoAP applications to initiate an unlimited number of parallel transactions gives them the means for causing overload, and depends on application-level measures to detect and correctly mitigate this failure. Because each transaction only consumes a very limited amount of resources, it is arguably more important to control the total outstanding number of transactions, compared to controlling the rate at which each individual one is being (re)transmitted. The CoAP spec <a class='info' href='#I-D.ietf-core-coap'>[I&#8209;D.ietf&#8209;core&#8209;coap]<span> (</span><span class='info'>Shelby, Z., Frank, B., and D. Sturek, &ldquo;Constrained Application Protocol (CoAP),&rdquo; June&nbsp;2010.</span><span>)</span></a> does currently not impose any limit on how many parallel transactions to different nodes an end-point may have outstanding.
	
</p>
<p>
Given the importance of preventing congestion collapse, this document argues that the CoAP protocol should specify a common mechanism for congestion controlling the aggregate traffic a CoAP node sends into the network. In other words, the CoAP stack should locally drop application-generated messages under overload situations, rather than attempting to send them into the network, irrespective of the destination.
	
</p>
<p>
One proposal is to implement a simple windowing algorithm. In this mechanism, a CoAP node has a certain number of "transmission credits" available during a time interval. Sending one CoAP message consumes one transmission credit, independent of which destination it is being sent to. If all transmission credits have been used up during a time interval, the CoAP node drops any additional messages that the applications attempt to send during the remainder of the time interval. At the end of a time interval, the CoAP node determines whether responses have been received for all requests it has issued within the time interval. If this is the case, the CoAP node increases the number of send credits by one for the following time interval. If responses fail to arrive for some of the requests issued during the time interval, the number of permitted CoAP requests is cut in half for the next interval.
	
</p>
<p>
The description above leaves several questions unanswered. These include the length of the time interval and whether it is fixed or adapted over time, whether an increase by one and a reduction by half are the correct parameters for the proposed AIMD (additive increase, multiplicative decrease) scheme, whether the decrease should be proportional to the loss rate, and others.
	
</p>
<p>
This document does at the moment not attempt to answer these questions. Instead, it encourages simulations and implementations to explore the design space, and also consider other non-windowing approaches.
	
</p>
<a name="ecn"></a><br /><hr />
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Explicit Congestion Notification</h3>

<p>
Explicit Congestion Notification (ECN) <a class='info' href='#RFC3168'>[RFC3168]<span> (</span><span class='info'>Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;The Addition of Explicit Congestion Notification (ECN) to IP,&rdquo; September&nbsp;2001.</span><span>)</span></a> is an extension to IP that allows routers to inform end nodes when they approach congestion by setting a bit in the IP header. The receiver of a message echoes this bit to the sender, which reacts as if a packet loss had occurred for the flow.
	
</p>
<p>
Deployment of ECN can reduce overall packet loss, because senders can react to congestion early, i.e., before packet loss occurs. This is especially attractive  in resource-constrained environments, because retransmissions can be avoided.
	
</p>
<p>
If CoAP uses an aggregate congestion control mechanism such as described in Section <a class='info' href='#aggregate'>Section&nbsp;3.2<span> (</span><span class='info'>Aggregate Congestion Control</span><span>)</span></a>, it will reduce the amount of transmission credits for the next time interval when some of the responses received had the ECN bit set. (Other reactions to ECN markings may be possible.)
	
</p>
<p>
Whether ECN support is possible in CoAP deployments remains to be investigated, because ECN usage requires a negotiation handshake (can potentially be avoided if support is made mandatory for CoAP deployments) and because routers need to support ECN marking. At this point, simulations attempting to quantify the benefits may therefore be easiest to obtain.
	
</p>
<a name="multicast"></a><br /><hr />
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Multicast Considerations</h3>

<p>
CoAP requests may be multicast, and result in several replies from different end-points, potentially consuming much more resource capacity for the request and response transmissions than a single unicast transaction. It can therefore be argued that sending multicast requests should be more conservatively controlled than the sending of unicast requests.
	
</p>
<p>
CoAP already acknowledges this to some degree by not retransmitting multicast requests at the CoAP-level. Unfortunately, CoAP currently has no means for preventing an application from doing application-level retransmissions of multicast requests. Given that the prevention of congestion collapse is important, such a mechanism should be added.
	
</p>
<p>
The aggregate congestion control proposal in Section <a class='info' href='#aggregate'>Section&nbsp;3.2<span> (</span><span class='info'>Aggregate Congestion Control</span><span>)</span></a> puts a cap on the number of transmissions allowed during a time interval, including multicast requests. It is currently unclear whether additional means are required for CoAP deployments that make heavy use of multicast. As before, experimentation is encouraged to understand the problem space. 
</p>
<a name="ianacons"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
IANA Considerations</h3>

<p>
This document requests no actions from IANA.
	
</p>
<p>
[Note to the RFC Editor: Please remove this section upon publication.]
	
</p>
<a name="seccons"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
This document has no known security implications.
	
</p>
<p>
[Note to the RFC Editor: Please remove this section upon publication.]
	
</p>
<a name="ack"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
Acknowledgments</h3>

<p>
Lars Eggert is partly funded by <a class='info' href='#TRILOGY'>[TRILOGY]<span> (</span><span class='info'>, &ldquo;Trilogy Project,&rdquo; .</span><span>)</span></a>, a research project supported by the European Commission under its Seventh Framework Program.
	
</p>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-core-coap">[I-D.ietf-core-coap]</a></td>
<td class="author-text">Shelby, Z., Frank, B., and D. Sturek, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-coap-00.txt">Constrained Application Protocol (CoAP)</a>,&rdquo; draft-ietf-core-coap-00 (work in progress), June&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-coap-00.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC0768">[RFC0768]</a></td>
<td class="author-text">Postel, J., &ldquo;<a href="http://tools.ietf.org/html/rfc768">User Datagram Protocol</a>,&rdquo; STD&nbsp;6, RFC&nbsp;768, August&nbsp;1980 (<a href="http://www.rfc-editor.org/rfc/rfc768.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2914">[RFC2914]</a></td>
<td class="author-text">Floyd, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2914">Congestion Control Principles</a>,&rdquo; BCP&nbsp;41, RFC&nbsp;2914, September&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2914.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2988">[RFC2988]</a></td>
<td class="author-text">Paxson, V. and M. Allman, &ldquo;<a href="http://tools.ietf.org/html/rfc2988">Computing TCP's Retransmission Timer</a>,&rdquo; RFC&nbsp;2988, November&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2988.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3168">[RFC3168]</a></td>
<td class="author-text">Ramakrishnan, K., Floyd, S., and D. Black, &ldquo;<a href="http://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>,&rdquo; RFC&nbsp;3168, September&nbsp;2001 (<a href="http://www.rfc-editor.org/rfc/rfc3168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5405">[RFC5405]</a></td>
<td class="author-text">Eggert, L. and G. Fairhurst, &ldquo;<a href="http://tools.ietf.org/html/rfc5405">Unicast UDP Usage Guidelines for Application Designers</a>,&rdquo; BCP&nbsp;145, RFC&nbsp;5405, November&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5405.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5348">[RFC5348]</a></td>
<td class="author-text">Floyd, S., Handley, M., Padhye, J., and J. Widmer, &ldquo;<a href="http://tools.ietf.org/html/rfc5348">TCP Friendly Rate Control (TFRC): Protocol Specification</a>,&rdquo; RFC&nbsp;5348, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5348.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5681">[RFC5681]</a></td>
<td class="author-text">Allman, M., Paxson, V., and E. Blanton, &ldquo;<a href="http://tools.ietf.org/html/rfc5681">TCP Congestion Control</a>,&rdquo; RFC&nbsp;5681, September&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5681.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="TRILOGY">[TRILOGY]</a></td>
<td class="author-text">&ldquo;Trilogy Project,&rdquo; &nbsp;http://www.trilogy-project.org/.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Lars Eggert</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Research Center</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">P.O. Box 407</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Group  00045</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+358 50 48 24461</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:lars.eggert@nokia.com">lars.eggert@nokia.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://research.nokia.com/people/lars_eggert">http://research.nokia.com/people/lars_eggert</a></td></tr>
</table>
</body></html>
