<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Transport Layer Security (TLS) Renegotiation Indication Extension</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Transport Layer Security (TLS) Renegotiation Indication Extension">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Rescorla</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">RTFM, Inc.</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">M. Ray</td></tr>
<tr><td class="header">Expires:  May 24, 2010</td><td class="header">S. Dispensa</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">PhoneFactor</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">N. Oskov</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Microsoft</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 20, 2009</td></tr>
</table></td></tr></table>
<h1><br />Transport Layer Security (TLS) Renegotiation Indication Extension<br />draft-ietf-tls-renegotiation-00.txt</h1>

<h3>Abstract</h3>

<p>SSL and TLS renegotiation are vulnerable to an attack in
      which the attacker forms a TLS connection with the target
      server, injects content of his choice, and then splices
      in a new TLS connection from a client. The server treats
      the client's initial TLS handshake as a renegotiation and
      thus believes that the initial data transmitted by the
      attacker is from the same entity as the subsequent client
      data. This draft defines a TLS extension to cryptographically
      tie renegotiations to the TLS connections they are being
      performed over, thus preventing this attack.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Conventions Used In This Document<br />
<a href="#sec.ext-def">3.</a>&nbsp;
Extension Definition<br />
<a href="#anchor3">4.</a>&nbsp;
Backward Compatibility<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.1.</a>&nbsp;
Client Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.1.</a>&nbsp;
Renegotiation Info Support Cipher Suite<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.2.</a>&nbsp;
Server Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.3.</a>&nbsp;
Broken Servers<br />
<a href="#sec.sec-cons">5.</a>&nbsp;
Security Considerations<br />
<a href="#anchor8">6.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor9">7.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">8.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">8.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">8.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	TLS <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a>
	allows either the client or the server to initiate renegotiation--a
	new handshake which establishes new cryptographic parameters. Unfortunately,
	although the new handshake is carried out over the protected channel
	established by the original handshake, there is no cryptographic
	connection between the two. This creates the opportunity for an
	attack in which the attacker who can intercept a client's transport
	layer connection can inject traffic of his own as a prefix to the
	client's interaction with the server. The attack proceeds as shown 
	below:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Client                        Attacker                        Server
------                        -------                         ------
                                  &lt;----------- Handshake ----------&gt;
                                  &lt;======= Initial Traffic ========&gt;
&lt;--------------------------  Handshake ============================&gt;
&lt;======================== Client Traffic ==========================&gt;
</pre></div>
<p>
      To start the attack, the attacker forms a TLS connection to the server
      (perhaps in response to an initial intercepted connection from the
      client). He then sends any traffic of his choice to the server. 
      This may involve multiple requests and responses at the application
      layer, or may simply be a partial application layer request intended
      to prefix the client's data. This traffic is shown with == to indicate
      it is encrypted. He then allows the client's TLS handshake to proceed
      with the server. The handshake is in the clear to the attacker but encrypted
      over the attacker's channel to the server. Once the handshake has completed,
      the client communicates with the server over the new channel. The attacker
      cannot read this traffic, but the server believes that the initial traffic
      to and from the attacker is the same as that to and from the client.
    
</p>
<p>
      If certificate-based client authentication is used, the server will 
      believe that the initial traffic corresponds to the authenticated
      client identity. Even without certificate-based authentication, 
      a variety of attacks may be possible in which the attacker convinces
      the server to accept data from it as data from the client. For instance,
      if HTTPS <a class='info' href='#RFC2818'>[RFC2818]<span> (</span><span class='info'>Rescorla, E., &ldquo;HTTP Over TLS,&rdquo; May&nbsp;2000.</span><span>)</span></a> is in use with HTTP cookies [REF],
      the attacker may be able to generate a request of his choice validated
      by the client's cookie.
    
</p>
<p>
      This attack can be prevented by cryptographically binding renegotiation
      handshakes to the enclosing TLS channel, thus allowing the server to
      differentiate renegotiation from initial negotiation, as well as 
      preventing renegotiations from being spliced in between connections.
      An attempt by an attacker to inject himself as described above
      will result in a mismatch of the extension and can thus be 
      detected
      This document defines an extension that performs that cryptographic
      binding. The extension described here is similar to that used for 
      TLS Channel Bindings <a class='info' href='#I-D.altman-tls-channel-bindings'>[I&#8209;D.altman&#8209;tls&#8209;channel&#8209;bindings]<span> (</span><span class='info'>Altman, J., Williams, N., and L. Zhu, &ldquo;Channel Bindings for TLS,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions Used In This Document</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="sec.ext-def"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Extension Definition</h3>

<p>
	This document defines a new TLS extension: "renegotiation_info",
	which contains a cryptographic binding to the enclosing TLS connection
	(if any) for which the renegotiation is being performed. The 
	"extension data" field of this extension contains a 
	"Renegotiation_Info" structure:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
	  struct {
            opaque renegotiated_connection&lt;0..255&gt;;
	  } Renegotiation_Info;
</pre></div>
<p>
	All TLS implementations SHOULD support this extension. TLS clients
	SHOULD generate it with every handshake and TLS servers SHOULD
	generate it in response to any client which offers it.
      
</p>
<p>
	The contents of this extension are specified as follows.
      
</p>
<p>
	</p>
<ul class="text">
<li>If this is the initial handshake for a connection, then 
	  the "renegotiated_connection" field is of zero length in both the ClientHello and the
	  ServerHello. Thus, the entire encoding of the extension is:
	  ff 01 00 01 00. The first two octets represent the extension
	  type, the third and fourth octet the length of the extension
	  itself, and the final octet the zero length byte for
	  the "renegotiated_connection" field.
	  
</li>
<li>For ClientHellos which are renegotiating, this field
	  contains the verify_data from the 
	  Finished message sent by the client on the immediately
	  previous handshake. For current versions of TLS, this
	  will be a 12-byte value. Note that this value is 
	  the "tls-unique" channel binding from
	  <a class='info' href='#I-D.altman-tls-channel-bindings'>[I&#8209;D.altman&#8209;tls&#8209;channel&#8209;bindings]<span> (</span><span class='info'>Altman, J., Williams, N., and L. Zhu, &ldquo;Channel Bindings for TLS,&rdquo; March&nbsp;2010.</span><span>)</span></a>
</li>
<li>For ServerHellos which are renegotiating, this field
	  contains the concatenation of the verify_data values
	  sent by the client and the server (in that order) on the immediately
	  previous handshake. For current versions of TLS, this
	  will be a 24-byte value.
</li>
</ul><p>
      
</p>
<p>
	The above rules apply even when TLS resumption is used.
      
</p>
<p>
	Upon receipt of the "renegotiation_info" extension, 
	implementations which support the extension
	MUST verify that it contains the correct	
	contents as specified above. If the contents are incorrect,
	then it MUST generate a fatal "handshake_failure" alert
	and terminate the connection. This allows two implementations
	both of which support the extension to safely renegotiate
	without fear of the above attack.
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Backward Compatibility</h3>

<p>
	Existing implementations which do not support this extension
	are widely deployed and in general must interoperate with
	newer implementations which do support it. This section 
	describes considerations for backward compatible interoperation.
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Client Considerations</h3>

<p>
	  If a client offers the "renegotiation_info" extension and the
	  server does not respond, then this indicates that the server
	  either does not support the extension or is unwilling to
	  use it. Because the above attack looks like a single handshake
	  to the client, the client cannot determine whether the
	  connection is under attack or not. Note, however, that merely
	  because the server does not acknowledge the extension 
	  does not mean that it is vulnerable; it might choose to 
	  reject all rehandshakes. However, it is not possible
	  for the client to determine purely via TLS mechanisms
	  whether this is the case or not.
	
</p>
<p>
	  If clients wish to ensure that such attacks are impossible,
	  they MUST terminate the connection immediately upon failure to receive
	  the extension without completing the handshake. 
	  However,
	  it is expected that many TLS servers that do not support
	  renegotiation (and thus are not vulnerable) will not support this
	  extension either, so in general, such behavior would not work
	  well.

	
</p>
<p>
	  While this specification does not require the client to
	  send RI on initial handshakes, clients which choose not to
	  do so have no mechanism for determining whether the
	  server is operating in a vulnerable mode (and provide no
	  such indication to the server) and are therefore
	  relying entirely on the server refusing to renegotiate
	  in the absence of the extension as opposed to explicitly
	  indicating to the server that the initial handshake
	  is in fact the first one on the connection.
	
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Renegotiation Info Support Cipher Suite</h3>

<p>
	    [[OPEN ISSUE: Should this feature be added?]]
	  
</p>
<p>
	    This document defines a special TLS cipher suite
	    "RENEGOTIATE_WITH_RI", with code point 0xNN, 0xMM.  Clients
	    which support this extension MUST include this cipher suite in every
	    handshake. When the server receives a Client Hello message 
	    which 
	    (1) contains this cipher suite 
	    (2) does not include RI and 
	    (3) the server thinks is doing renegotiation
	    it MUST reject it with a fatal "handshake_failure" alert.
	    Because servers ordinarily ignore unknown cipher suites, this 
	    cipher suite can be added safely on any handshake,
	    thus allowing detection and prevention of the MITM attack described above. 
	    Servers MUST NOT select
	    this cipher suite in any handshake, as it does not
	    correspond to any valid cipher suite. 
	  
</p>
<p>
	    Note that a minimal client which does not support
	    renegotiation at all can simply use this cipher suite in all
	    initial handshakes.  Any compliant
	    server will reject any (apparent) 
	    attempt at renegotiation by such a client.
	    Clients which do support renegotiation MUST implement
	    <a class='info' href='#sec.ext-def'>Section&nbsp;3<span> (</span><span class='info'>Extension Definition</span><span>)</span></a> as well.
	  
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Server Considerations</h3>

<p>
	  If the client does not offer the "renegotiation_info" extension,
	  then this indicates that the client does not support the extension
	  or is unwilling to use it. Note that TLS does not permit servers to
	  offer unsolicited extensions. However, because the above attack
	  looks like two handshakes to the server, the server can safely
	  continue the connection as long as it does not allow the client
	  to rehandshake. If servers wish to ensure that such attacks are
	  impossible they MUST NOT allow clients who do not
	  offer the "renegotiation_info" extension to renegotiate with
	  them and SHOULD respond to such requests with a 
	  "no_renegotiation" alert [RFC 5246 requires this alert to be
	  at the "warning" level.] Servers SHOULD follow this behavior.
	
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Broken Servers</h3>

<p>
	  SSLv3 does not support extensions and thus it is not possible to
	  Both SSLv3 (at least later drafts) and TLS 1.0/1.1 require
	  implementations to ignore data following the ClientHello (i.e.,
	  extensions) if they do not understand it. However, some SSLv3 and
	  TLS 1.0 implementations incorrectly fail the handshake in such
	  case.
	  Client implementations which offer extensions sometimes will
	  respond to such failures by falling back to an extensionless
	  mode. This practice can be exploited by a MITM to cause
	  a client which would ordinarily offer the renegotiation extension
	  not to do so. Note that this consideration does not apply to
	  implementations which ignore extensions since the ordinarily
	  TLS Finished messages protect that negotiation.
	
</p>
<p>
	  When combined with a server which allows renegotiation without
	  the extension (which, per <a class='info' href='#sec.sec-cons'>Section&nbsp;5<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>, is NOT RECOMMENDED)
	  this allows a downgrade attack. Accordingly, clients which offer this
	  extension SHOULD NOT fall back to extensionless modes upon 
	  handshake errors. Any SSLv3 or TLS implementation which chooses 
	  to address this issue by refusing to renegotiate at all
	  MUST at minimum ensure
	  that the extension is ignored (this is simply a restatement of
	  existing requirements). Thus, any such handshake failure
	  can be assumed to represent either an attack or a vulnerable
	  server; in either case the best practice is not to continue the
	  connection. Even servers which refuse to renegotiate
	  SHOULD reply with an empty RI extension because this
	  signals that they have been upgraded.
	
</p>
<a name="sec.sec-cons"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
	The extension described in this document prevents an attack on
	TLS. If this extension is not used, TLS renegotiation is subject
	to an attack in which the attacker can inject their own conversation
	with the TLS server as a prefix of the client's conversation.
	This attack is invisible to the client and looks like an ordinary
	renegotiation to the server. The extension defined in this
	document allows renegotiation to be performed safely. 
	Servers SHOULD NOT allow clients to renegotiate without
	using this extension. 
      
</p>
<p>
	While this extension mitigates the man-in-the-middle attack
	described in the overview, it does not resolve all possible
	problems an application may face if it is unaware of renegotiation.
	It is possible that the authenticated identity of the server or
	client may change as a result of renegotiation.
      
</p>
<p>
	By default, TLS implementations conforming to this document MUST
	verify that once an identity has been authenticated within the TLS
	handshake, it does not change on subsequent renegotiations. For
	certificate based cipher suites, this means bitwise equality of the
	end-entity certificate.  If the other end attempts to authenticate
	with a different identity, the renegotiation MUST fail.  If the
	server_name extension is used, it MUST NOT change when doing
	renegotiation.
      
</p>
<p>
	A TLS library MAY provide a means for the application to allow
	identity and/or server_name changes across renegotiations, in which
	case the application is responsible for tracking the identity
	associated with data it is processing.  This may require additional
	API facilities in the TLS library.
      
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
	IANA [shall add/has added] the extension code point
	XXX [We request 0xff01, which has been used for
	prototype implementations] for the "renegotiation_info" extension
	to the TLS ExtensionType values registry.
      
</p>
<p>
        IANA [shall add/has added] TLS cipher suite number 0xNN,0xMM
	with name RENEGOTIATE_WITH_RI  to the TLS Cipher Suite registry.
      
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Acknowledgements</h3>

<p>
	This vulnerability was originally discovered by Marsh Ray.
	The general concept behind the 
	extension described here was independently invented by
	Steve Dispensa, Nasko Oskov, and Eric Rescorla.
	Comments and refinements were received from Jesse Walker,
	the Project Mogul team as well as Pasio Eronen.
      
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.altman-tls-channel-bindings">[I-D.altman-tls-channel-bindings]</a></td>
<td class="author-text">Altman, J., Williams, N., and L. Zhu, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-altman-tls-channel-bindings-10.txt">Channel Bindings for TLS</a>,&rdquo; draft-altman-tls-channel-bindings-10 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-altman-tls-channel-bindings-10.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2818">[RFC2818]</a></td>
<td class="author-text">Rescorla, E., &ldquo;<a href="http://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>,&rdquo; RFC&nbsp;2818, May&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2818.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Rescorla</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RTFM, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2064 Edgewood Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94303</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ekr@rtfm.com">ekr@rtfm.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Marsh Ray</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PhoneFactor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">7301 W 129th Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Overland Park, KS  66213</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:marsh@extendedsubset.com">marsh@extendedsubset.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Steve Dispensa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">PhoneFactor</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">7301 W 129th Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Overland Park, KS  66213</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:dispensa@phonefactor.com">dispensa@phonefactor.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nasko</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Microsoft</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">One Microsoft Way</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Redmond, WA  98052</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:nasko.oskov@microsoft.com">nasko.oskov@microsoft.com</a></td></tr>
</table>
</body></html>
