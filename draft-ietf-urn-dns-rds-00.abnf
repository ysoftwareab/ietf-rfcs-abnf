rewrite_flag = false;
terminal = false;
records = lookup(type=NAPTR, key); // get all NAPTR RRs for 'key'

n_naptrs = number of NAPTR records in response.
curr_order = records[0].order;
max_order = records[n_naptrs-1].order;

newkey = rewrite(URN, naptr[j].replacement, naptr[j].regexp);
max_order = naptr[j].order;
terminal = true;
services = naptr[j].services;
addnl = any SRV and/or A records returned as additional
                     info for naptr[j].
key = newkey;
rewriteflag = true;
srvs = lookup(type=SRV, key);
