<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>BGP Persistence </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Requirements Language">
<link href="#rfc.section.2" rel="Chapter" title="2 Communities">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 PERSIST">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 DO_NOT_PERSIST">
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 STALE">
<link href="#rfc.section.3" rel="Chapter" title="3 Configuration (Persistence Timer, PERSIST and DO_NOT_PERSIST Community)">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Settings for Different Applications">
<link href="#rfc.section.4" rel="Chapter" title="4 Operation">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Attaching the STALE Community Value and Propagation of Paths">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Forwarding">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Example Behaviour">
<link href="#rfc.section.5" rel="Chapter" title="5 Deployment Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Applications">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Persistence in L2VPN (VPLS/VPWS)">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Persistence in L3VPN">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="10 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="For certain AFI/SAFI combinations it is desirable that a BGP speaker be able to retain routing state learned over a session that has terminated. By maintaining routing state forwarding may be preserved.  This technique works effectively as long as the AFI/SAFI is primarily used to realize services that do not depend on exchanging BGP routing state with peers or customers. There may be exceptions based upon the amount and frequency of route exchange that allow for this technique. Generally the BGP protocol tightly couples the viability of a session and the routing state that is learned over it. This is driven by the history of the protocol and it's application in the internet space as a vehicle to exchange routing state between administrative authorities. This document addresses new services whose requirements for persistence diverge from the Internet routing point of view.  " />
  <meta name="description" content="For certain AFI/SAFI combinations it is desirable that a BGP speaker be able to retain routing state learned over a session that has terminated. By maintaining routing state forwarding may be preserved.  This technique works effectively as long as the AFI/SAFI is primarily used to realize services that do not depend on exchanging BGP routing state with peers or customers. There may be exceptions based upon the amount and frequency of route exchange that allow for this technique. Generally the BGP protocol tightly couples the viability of a session and the routing state that is learned over it. This is driven by the history of the protocol and it's application in the internet space as a vehicle to exchange routing state between administrative authorities. This document addresses new services whose requirements for persistence diverge from the Internet routing point of view.  " />
  <meta name="keywords" content="BGP-4, Persistence" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">J. Uttaro</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">AT&amp;T</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">A. Simpson</td>
</tr>
<tr>
<td class="left">Expires: April 22, 2012</td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">R. Shakir</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">C&amp;W</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">C. Filsfils</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">P. Mohapatra</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Cisco Systems</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">B. Decraene</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">France Telecom</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Scudder</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Y. Rekhter</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Juniper Networks</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 20, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">BGP Persistence <br />
  <span class="filename">draft-uttaro-idr-bgp-persistence-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>For certain AFI/SAFI combinations it is desirable that a BGP speaker be able to retain routing state learned over a session that has terminated. By maintaining routing state forwarding may be preserved.  This technique works effectively as long as the AFI/SAFI is primarily used to realize services that do not depend on exchanging BGP routing state with peers or customers. There may be exceptions based upon the amount and frequency of route exchange that allow for this technique. Generally the BGP protocol tightly couples the viability of a session and the routing state that is learned over it. This is driven by the history of the protocol and it's application in the internet space as a vehicle to exchange routing state between administrative authorities. This document addresses new services whose requirements for persistence diverge from the Internet routing point of view.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 22, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Requirements Language</a>
</li>
<li>2.   <a href="#rfc.section.2">Communities</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">PERSIST</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">DO_NOT_PERSIST</a>
</li>
<li>2.3.   <a href="#rfc.section.2.3">STALE</a>
</li>
<li>3.   <a href="#rfc.section.3">Configuration (Persistence Timer, PERSIST and DO_NOT_PERSIST Community)</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Settings for Different Applications</a>
</li>
<li>4.   <a href="#rfc.section.4">Operation</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Attaching the STALE Community Value and Propagation of Paths</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Forwarding</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Example Behaviour</a>
</li>
<li>5.   <a href="#rfc.section.5">Deployment Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Applications</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">Persistence in L2VPN (VPLS/VPWS)</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Persistence in L3VPN</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgements</a>
</li>
<li>10.   <a href="#rfc.references">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">In certain scenarios, a BGP speaker may maintain forwarding in spite of BGP session termination. Currently all routing state learned between two speakers is flushed upon either normal or abnormal session termination.  There are techniques that are useful for maintaining routing when a session abnormally terminates i.e BGR Graceful RestartR  ( RFC 4724 ) or normal termination such as increasing timers but they do not change the fundamental problem.  The technique of BGP persistence works effectively as long as the expectation is that there is a decoupling of session viability and the correct service delivery, and the delivery uses the routing state learned over that session.  This document proposes a modification to BGP's behavior by enabling persistence of BGP learned routing state in spite of normal or abnormal session termination.  </p>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> <a href="#requirements-language" id="requirements-language">Requirements Language</a>
</h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119 <a href="#RFC2119">[RFC2119]</a>.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#communities" id="communities">Communities</a>
</h1>
<p id="rfc.section.2.p.1">This memo defines three new communities that are used to identify the capability of a path to persist and whether or not that path is live or stale.  </p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> <a href="#communities-persist" id="communities-persist">PERSIST</a>
</h1>
<p id="rfc.section.2.1.p.1">This memo defines a new transitive BGP community, PERSIST, with value TBD (to be assigned by IANA).  Attaching of the PERSIST community SHOULD be controlled by configuration. Attaching the PERSIST community indicates that the peer should maintain forwarding in the case of a session failure. The functionality SHOULD default to being disabled.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> <a href="#communities-do-not-persist" id="communities-do-not-persist">DO_NOT_PERSIST</a>
</h1>
<p id="rfc.section.2.2.p.1">This memo defines a new transitive BGP community, DO_NOT_PERSIST, with value TBD (to be assigned by IANA). Attaching of the DO_NOT_PERSIST community SHOULD be controlled by configuration. The functionality SHOULD default to being disabled.  </p>
<h1 id="rfc.section.2.3">
<a href="#rfc.section.2.3">2.3.</a> <a href="#communities-stale" id="communities-stale">STALE</a>
</h1>
<p id="rfc.section.2.3.p.1">This memo defines a new transitive BGP community, STALE, with value TBD (to be assigned by IANA).  Attaching of the STALE community is limited to a path that currently has the PERSIST community attached </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#configuration" id="configuration">Configuration (Persistence Timer, PERSIST and DO_NOT_PERSIST Community)</a>
</h1>
<p id="rfc.section.3.p.1">Persistence must be configured on a per session basis. A speaker configures the ability to persist independently of it's peer. There is no negotiation between the peers.  A timer must be configured indicating the time to persist stale state from a peer where the session is no longer viable.  This timer is designated as the persist-timer. A speaker must also attach persistence community value indicating if a path to a route should persist.  </p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#configuration-settings-for-different-applications" id="configuration-settings-for-different-applications">Settings for Different Applications</a>
</h1>
<p id="rfc.section.3.1.p.1">The setting of the persist-timer should be based upon the field of use. BGP is used in a many different applications that each bring a unique requirement for retaining state. The following is not meant as a comprehensive listing but to suggest timer settings for a subset of AFI/SAFIs.  </p>

<dl>
<dt>L2VPN</dt>
<dd style="margin-left: 8">This AFI/SAFI requires the exchange of routing state in order to establish PWs to realize a VPLS VPN, or a VPWS PW. This AFI/SAFI does not require exchange of routing state with a customer and there is no eBGP session established. The persist-timer should be set to a large value on the order of days to infinity.  </dd>
<dt>L3VPN</dt>
<dd style="margin-left: 8">This AFI/SAFI requires the exchange of routing state to create a private VPN. This AFI/SAFI requires exchange of state with customers via eBGP and is dynamic. The SP needs to consider the possibility that stale state may not reflect the latest route updates and therefore may be incorrect from the customer perspective. The persist-timer should be set to a large value on the order of hours to a few days. this is built upon the notion some incorrectness is preferable to a large outage.  </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#operation" id="operation">Operation</a>
</h1>
<p id="rfc.section.4.p.1">Assuming a session failure has occurred a BGP persistent router must retain local forwarding state for those paths that are Persistent/Stale and propagate paths to downstream speakers that indicate that a given path is now stale.  </p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#operation-stale-propagation" id="operation-stale-propagation">Attaching the STALE Community Value and Propagation of Paths</a>
</h1>
<p id="rfc.section.4.1.p.1">The following rules must be followed.  </p>

<ul>
<li>Identify paths learned over a failed session that have the PERSIST capable community value attached.  </li>
<li>For those paths attach the STALE community value and propagate to all peers.  </li>
<li>For those paths learned over the failed session that do not have PERSIST capable community value or are marked with the DO_NOT_PERSIST community follow BGP rules and generate withdrawals to all peers for those paths.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#operation-forwarding" id="operation-forwarding">Forwarding</a>
</h1>
<p id="rfc.section.4.2.p.1">The following rules must be followed to ensure valid forwarding: </p>

<ul>
<li>All forwarding state must be retained i.e labels for BGP labeled unicast.  </li>
<li>Forwarding must ensure that the Next Hop to a "stale" route is viable.  </li>
<li>Forwarding to a "stale" route is only used if there are no other paths available to that route. In other words an active path always wins regardless of path selection. "Stale" state is always considered to be less preferred when compared with an active path.  </li>
<li>Forwarding should be retained through an advertisement. When the session is re-established forwarding should only change if the new state is either different or better in terms of path selection. A make before break strategy should be employed.  </li>
<li>Stale state may be retained indefinitely or may be programmed to expire via configuration.  </li>
<li>The Receiving Speaker MUST replace the stale routes by the routing updates received from the peer.  Once the End-of-RIB marker for an address family is received from the peer, it MUST immediately remove any paths from the peer that are still marked as stale for that address family.  </li>
<li>There is no restriction on whether the session is internal or external.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#operation-example-behaviour" id="operation-example-behaviour">Example Behaviour</a>
</h1>
<p id="rfc.section.4.3.p.1">Upon session establishment a speaker S2 may receive paths from S1 that are marked with PERSIST, DO_NOT_PERSIST or neither. Assume S2 is also peered with a downstream speaker S3.. Implementations MUST follow the specifications outlined below for.  </p>
<p id="rfc.section.4.3.p.2">Upon recognition of the failure to S1, S2 will identify paths that had been marked with PERSIST, DO_NOT_PERSIST or neither learned from S1. S2 MUST implement the following behavior: </p>
<div id="#rfc.figure.1"></div>
<pre>
if ( P1 is tagged with PERSIST ) {

Retain Forwarding 
  Attach the STALE Community to all paths that were marked with PERSIST
  Advertise STALE paths to all peers including S3 
}
else ( P1 is marked with DO_NOT_PERSIST || not marked )

Tear down the forwarding structure for P1
Follow normal BGP rules i.e Best path, withdrawal etc.

fi    
                       </pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#deployment-considerations" id="deployment-considerations">Deployment Considerations</a>
</h1>
<p id="rfc.section.5.p.1">BGP Persistence as described in this document is useful within a single autonomous system or across autonomous systems.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#applications" id="applications">Applications</a>
</h1>
<p id="rfc.section.6.p.1">This technique may be useful in a wide array of applications where routing state is either fairly static or, the state is localized within a routing context. Some applications that come immediately to mind are L2 and L3 VPN.  </p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#applications-l2vpn" id="applications-l2vpn">Persistence in L2VPN (VPLS/VPWS)</a>
</h1>
<p id="rfc.section.6.1.p.1">VPLS/VPWS VPNs use BGP to exchange routing state between two PEs.  This exchange allows for the creation of a PW within a VPN context between those PEs. By definition, L2VPN does not exchange any routing state with customers via BGP. BGP persistence is very useful here as the state is quite constant. The only time state is exchanged is when a PW endpoint is provisioned, deleted or when a speaker reboots.  </p>
<p id="rfc.section.6.1.p.2">Referring to <a href="#l2vpn-topology">Figure 2</a>, PE1 and PE2 have advertised BGP routing state in order to create PWs between PE1 and PE2. The RRs are only responsible to reflect this state between the PEs. The use of a unique RD makes every path unique from the RRs perspective.  </p>
<p id="rfc.section.6.1.p.3">Assume that the both RR experience catastrophic failure.  </p>
<p id="rfc.section.6.1.p.4">Case 1 - All BGP speakers are persistent capable.  </p>
<p id="rfc.section.6.1.p.5">The PWs created between PE1 and PE2 persist. Forwarding uninterrupted.  </p>
<p id="rfc.section.6.1.p.6">Case 2 - PE1 and the RRs are persistent capable, PE2 is not.  </p>
<p id="rfc.section.6.1.p.7">In this case the path advertised from PE2 via the RRs is persistent at PE1, the PW from PE1 to PE2 is not torn down. PE2 will remove the path from PE1 and tear down the PW from PE2 to PE1. THe effect is that MAC state learned at PE2 is valid as the PW is still valid. MAC state learned at PE1 is removed as the PW is no longer valid. Eventually MAC destinations recursed to the PW at PE1 destined for PE2 over the valid PW will time out.  </p>
<p id="rfc.section.6.1.p.8">Assume that the RRs are valid but the iBGP sessions are torn down..  </p>
<p id="rfc.section.6.1.p.9">Case 3 - All BGP speakers are persistent capable.  </p>
<p id="rfc.section.6.1.p.10">The PWs created between PE1 and PE2 persist. Forwarding uninterrupted.  </p>
<div id="#rfc.figure.2"></div>
<div id="#l2vpn-topology"></div>
<pre>
VPNA                 VPNA
 PW+++++++++++++++++++PW 

CE1-------PE1--------RR1-------PE2------CE2
  |                    |
  |                    |
  ----------RR2---------

  &lt;--iBGP---&gt;&lt;---iBGP--&gt;     
                          </pre>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#applications-l3vpn" id="applications-l3vpn">Persistence in L3VPN</a>
</h1>
<div id="#rfc.figure.3"></div>
<div id="#l3vpn-topology"></div>
<pre>
             --------RR1-------
            / A              C \
CE1 ----- PE1 --Forwarding Path-- PE2 ---- CE2
            \ B              D /
             ------- RR2 ------     
                              </pre>
<p id="rfc.section.6.2.p.1">In the case of a Layer 3 VPN topology, during the failure of a route reflector device at the current time, all routing information propagated via BGP is purged from the routing database. In this case, forwarding is interrupted within such a topology due to the lack of signalling information, rather than an outage to the forwarding path between the PE devices. With the addition of BGP persistence, a complete service outage can be avoided.  </p>
<p id="rfc.section.6.2.p.2">The topology shown in <a href="#l3vpn-topology">Figure 3</a> is a simple L3VPN topology consisting of two customer edge (CE) devices, along with two provider edge (PE), and route reflector (RR) devices. In this case, where an RFC4364 VPN topology is utilised a BGP session exists between PE1 to both RR1 and RR2, and from PE2 to RR1 and RR2, in order to propagate the VPN topology.  </p>
<p id="rfc.section.6.2.p.3">Case 1: No BGP speakers are persistence capable: </p>

<ul>
<li>In this scenario, during a simultaneous failure of RR1 and RR2 (which are extremely likely to share route reflector clients) both PE1 and PE2 remove all routing information from the VPN from their RIB, and hence a complete service outage is experienced.  </li>
<li>Where either sessions A and B, or C and D fail simultaneously, routing information from either PE1 (in the case of A and B), or PE2 (in the case of C and D) are withdrawn, and a partial service topology exists.  </li>
<li>Both of the states described reflect a service outage where the forwarding path between the PE devices is not interrupted.  </li>
</ul>

<p> </p>
<p id="rfc.section.6.2.p.4">Case 2: All BGP speakers are persistence capable: </p>

<ul>
<li>PE1 continues to forward utilising the label information received from PE2 via the working forwarding path for the duration of the persistence timer (and vice versa).  </li>
<li>This condition occurs regardless of the session(s) that fail. In the worst case where sessions A, B, C and D fail simultaneously, the network continues to operate in the state in which it was at the time of the failure.  </li>
</ul>

<p> </p>
<p id="rfc.section.6.2.p.5">Case 3: PE1 and RR[12] are persistence capable - PE2 is not.  </p>

<ul>
<li>During a failure of BGP session A or B, PE1 will continue to forward utilising the routing information received from the RRs for PE2 for the duration of the persistence timer. PE2 will continue to forward utilising the routing information received from the RRs, again for the duration of the persistence timer.  </li>
<li>In the case that either BGP session C or D fails, all routes will be withdrawn by RR[12] towards PE1 since these routes are not valid to be persisted by the RRs. The end result of this will be that the routes advertised by CE2 into the VPN will be withdrawn.  </li>
<li>Where the worst case failure occurs (i.e. sessions A, B, C and D fail) the routes advertised by CE1 into the VPN will be persistently advertised by the RR devices, whereas those advertised by CE2 will be withdrawn.  Clearly in the example shown in the figure this results in a service outage, but where multiple PE devices exist within a topology, service is maintained for the subset of CEs attached to PE devices supporting the persistence capability.  </li>
</ul>

<p> Within the Layer 3 VPN deployment it should be noted that routing information is less static than that of the many Layer 2 VPNs since typically multiple routes exist within the topology rather than an individual MAC address or egress interface per CE device on the PE device. As such, the L3VPN operates with the routing databases in the 'core' of the network reflecting those at the time of failure. Should there be re-convergence for any path between the PE and CE devices, this will result in invalid routing information, should the egress PE device not hold alternate routing information for the prefixes undergoing such re-convergence. It is expected that where each PE maintains multiple paths to each egress prefix (where an alternate path is available), it is expected that the egress PE will forward packets towards an alternative egress PE for the prefix in question where the topology is no longer valid.  </p>
<p id="rfc.section.6.2.p.6">The lack of convergence within a Layer 3 topology during the persistent state SHOULD be considered since it may adversely affect services, however, an assumption is made that a degraded service is preferable to a complete service outage during a large-scale BGP control plane failure.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.7.p.1">The security implications of the persistence mechanism defined within in this document are akin to those incurred by the maintenance of stale routing information within a network. This is particularly relevant when considering the maintenance of routing information that is utilised for service segregation - such as MPLS label entries.  </p>
<p id="rfc.section.7.p.2">For MPLS VPN services, the effectiveness of the traffic isolation between VPNs relies on the correctness of the MPLS labels between ingress and egress PEs. In particular, when an egress PE withdraws a label L1 allocated to a VPN1 route, this label MUST not be assigned to a VPN route of a different VPN until all ingress PEs stop using the old VPN1 route using L1.  </p>
<p id="rfc.section.7.p.3">Such a corner case may happen today, if the propagation of VPN routes by BGP messages between PEs takes more time than the label re-allocation delay on a PE. Given that we can generally bound worst case BGP propagation time to a few minutes (e.g. 2-5), the security breach will not occur if PEs are designed to not reallocate a previous used and withdrawn label before a few minutes.  </p>
<p id="rfc.section.7.p.4">The problem is made worse with BGP GR between PEs as VPN routes can be stalled for a longer period of time (e.g. 20 minutes).  </p>
<p id="rfc.section.7.p.5">This is further aggravated by the BGP persistent extension proposed in this document as VPN routes can be stalled for a much longer period of time (e.g. 2 hours, 1 day).  </p>
<p id="rfc.section.7.p.6">Therefore, to avoid VPN breach, before enabling BGP persistence, SPs needs to check how fast a given label can be reused by a PE, taking into account: </p>

<ul>
<li>The load of the BGP route churn on a PE (in term of number of VPN label advertised and churn rate).  </li>
<li>The label allocation policy on the PE (possibly depending upon the size of pool of the VPN labels (which can be restricted by hardware consideration or others MPLS usages), the label allocation scheme (e.g.  per route or per VRF/CE), the re-allocation policy (e.g. least recently used label...) </li>
</ul>

<p> </p>
<p id="rfc.section.7.p.7">In addition to these considerations, the persistence mechanism described within this document is considered to be complex to exploit maliciously - in order to inject packets into a topology, there is a requirement to engineer a specific persistence state between two PE devices, whilst engineering label reallocation to occur in a manner that results in the two topologies overlapping. Such allocation is particularly difficult to engineer (since it is typically an internal mechanism of an LSR).  </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA Considerations</a>
</h1>
<p id="rfc.section.8.p.1">IANA shall assigned community values from BGP well-known communities registry for the PERSIST, DO-NOT-PERSIST and STALE communities.  No additional IANA action is required.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#acknowledgements" id="acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.9.p.1">We would like to acknowledge Roberto Fragassi (Alcatel-Lucent), John Medamana, (AT&amp;T) Han Nguyen (AT&amp;T), Jeffrey Haas (Juniper), Nabil Bitar (Verizon), Nicolai Leymann (DT) for their contributions to this document.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">10.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1997">[RFC1997]</b></td>
<td class="top">
<a href="mailto:rchandra@cisco.com" title="cisco Systems, Inc.">Chandrasekeran, R.</a>, <a href="mailto:pst@cisco.com" title="cisco Systems, Inc.">Traina, P.</a> and <a href="mailto:tli@skat.usc.edu">T. Li</a>, "<a href="http://tools.ietf.org/html/rfc1997">BGP Communities Attribute</a>", RFC 1997, August 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4271">[RFC4271]</b></td>
<td class="top">
<a>Rekhter, Y.</a>, <a>Li, T.</a> and <a>S. Hares</a>, "<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>", RFC 4271, January 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4364">[RFC4364]</b></td>
<td class="top">
<a>Rosen, E.</a> and <a>Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>", RFC 4364, February 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">James Uttaro</span> 
	  <span class="n hidden">
		<span class="family-name">Uttaro</span>
	  </span>
	</span>
	<span class="org vcardline">AT&T </span>
	<span class="adr">
	  <span>200 S. Laurel Avenue</span>

	  <span class="vcardline">
		<span class="locality">Middletown</span>,  
		<span class="region">NJ</span> 
		<span class="code">07748</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ju1738@att.com">ju1738@att.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Adam Simpson</span> 
	  <span class="n hidden">
		<span class="family-name">Simpson</span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent </span>
	<span class="adr">
	  <span>600 March Road</span>

	  <span class="vcardline">
		<span class="locality">Ottawa</span>,  
		<span class="region">Ontario</span> 
		<span class="code">K2K 2E6</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:adam.simpson@alcatel-lucent.com">adam.simpson@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Rob Shakir</span> 
	  <span class="n hidden">
		<span class="family-name">Shakir</span>
	  </span>
	</span>
	<span class="org vcardline">Cable&Wireless Worldwide </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">London</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">UK</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:rjs@cw.net">rjs@cw.net</a></span>

<span class="vcardline">URI: <a href="http://www.cw.com/">http://www.cw.com/</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Clarence Filsfils</span> 
	  <span class="n hidden">
		<span class="family-name">Filsfils</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Brussels</span>,  
		<span class="region"></span>
		<span class="code">1000</span>
	  </span>
	  <span class="country-name vcardline">BE</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:cf@cisco.com">cf@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Pradosh Mohapatra</span> 
	  <span class="n hidden">
		<span class="family-name">Mohapatra</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems </span>
	<span class="adr">
	  <span>170 W. Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:pmohapat@cisco.com">pmohapat@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bruno Decraene</span> 
	  <span class="n hidden">
		<span class="family-name">Decraene</span>
	  </span>
	</span>
	<span class="org vcardline">France Telecom </span>
	<span class="adr">
	  <span>38-40 Rue de General Leclerc</span>

	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region">92794 Issy Moulineaux</span> 
		<span class="code">cedex 9</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:bruno.decraene@orange.com">bruno.decraene@orange.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">John Scudder</span> 
	  <span class="n hidden">
		<span class="family-name">Scudder</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks </span>
	<span class="adr">
	  <span>1194 N. Mathilda Ave</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jgs@juniper.net">jgs@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yakov Rekhter</span> 
	  <span class="n hidden">
		<span class="family-name">Rekhter</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks </span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:yakov@juniper.net">yakov@juniper.net</a></span>

  </address>
</div>

</body>
</html>