<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Generic Fault-Avoidance Routing Protocol for Data Center Networks</title>
<meta content="Bin Liu" name="author">
<meta content="Yantao Sun" name="author">
<meta content="Jing Cheng" name="author">
<meta content="Yichen Zhang" name="author">
<meta content="Bhumip Khasnabish" name="author">
<meta content="
       
      This document describes a generic routing method and protocol for a regular data center network, named the Fault-Avoidance Routing (FAR) protocol. The FAR protocol provides a generic routing method for all types of regular topology network architectures that have been proposed for large-scale cloud-based data centers over the past few years. The FAR protocol is designed to leverage any regularity in the topology and compute its routing table in a concise manner. Fat-tree is taken as an example architecture to illustrate how the FAR protocol can be applied in real operational scenarios.
       
    " name="description">
<meta content="xml2rfc 3.11.1" name="generator">
<meta content="Request for Comments" name="keyword">
<meta content="draft-sl-rtgwg-far-dcn-17" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.11.1
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.4
    pycountry 20.7.3
    pyflakes 2.4.0
    PyYAML 6.0
    requests 2.26.0
    setuptools 59.1.1
    six 1.16.0
-->
<link href="/tmp/draft-sl-rtgwg-far-dcn-17-wqhmz3fr.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">FAR for DCN</td>
<td class="right">November 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Liu, et al.</td>
<td class="center">Expires 3 June 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Routing Area Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-sl-rtgwg-far-dcn-17</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-11-30" class="published">30 November 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-06-03">3 June 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">B. Liu</div>
<div class="org">ZTE Inc., ZTE Plaza</div>
</div>
<div class="author">
      <div class="author-name">Y. Sun</div>
<div class="org">Beijing Jiaotong University</div>
</div>
<div class="author">
      <div class="author-name">J. Cheng</div>
<div class="org">Beijing Jiaotong University</div>
</div>
<div class="author">
      <div class="author-name">Y. Zhang</div>
<div class="org">Beijing Jiaotong University</div>
</div>
<div class="author">
      <div class="author-name">B. Khasnabish</div>
<div class="org">Individual contributor</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Generic Fault-Avoidance Routing Protocol for Data Center Networks</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">
      This document describes a generic routing method and protocol for a regular data center network, named the Fault-Avoidance Routing (FAR) protocol. The FAR protocol provides a generic routing method for all types of regular topology network architectures that have been proposed for large-scale cloud-based data centers over the past few years. The FAR protocol is designed to leverage any regularity in the topology and compute its routing table in a concise manner. Fat-tree is taken as an example architecture to illustrate how the FAR protocol can be applied in real operational scenarios.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 3 June 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-acronyms-definitions" class="xref">Acronyms &amp; Definitions</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-conventions-used-in-this-do" class="xref">Conventions used in this document</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-problem-statement" class="xref">Problem Statement</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-the-impact-of-large-scale-n" class="xref">The Impact of Large-scale Networks on Route Calculation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-issues-of-conventional-rout" class="xref">Issues of Conventional Routing Methods in a Large-scale Network with Giant Number Nodes of Routers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-network-addressing-issues" class="xref">Network Addressing Issues</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-big-routing-table-issues" class="xref">Big Routing Table Issues</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-adaptivity-issues-for-routi" class="xref">Adaptivity Issues for Routing Algorithms</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-virtual-machine-migration-i" class="xref">Virtual Machine Migration Issues</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-the-far-framework" class="xref">The FAR Framework</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-data-format" class="xref">Data Format</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-data-tables" class="xref">Data Tables</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-messages" class="xref">Messages</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-far-modules" class="xref">FAR Modules</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-neighbor-and-link-detection" class="xref">Neighbor and Link Detection Module(M1)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-device-learning-modulem2" class="xref">Device Learning Module(M2)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="xref">6.3</a>.  <a href="#name-invisible-neighbor-and-link" class="xref">Invisible Neighbor and Link Failure Inferring Module(M3)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.4">
                <p id="section-toc.1-1.6.2.4.1"><a href="#section-6.4" class="xref">6.4</a>.  <a href="#name-link-failure-learning-modul" class="xref">Link Failure Learning Module(M4)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.5">
                <p id="section-toc.1-1.6.2.5.1"><a href="#section-6.5" class="xref">6.5</a>.  <a href="#name-brt-building-modulem5" class="xref">BRT Building Module(M5)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.6">
                <p id="section-toc.1-1.6.2.6.1"><a href="#section-6.6" class="xref">6.6</a>.  <a href="#name-nrt-building-modulem6" class="xref">NRT Building Module(M6)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.7">
                <p id="section-toc.1-1.6.2.7.1"><a href="#section-6.7" class="xref">6.7</a>.  <a href="#name-routing-table-lookupm7" class="xref">Routing Table Lookup(M7)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-how-a-far-router-works" class="xref">How a FAR Router Works</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-compatible-architecture" class="xref">Compatible Architecture</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-topology-identification-and" class="xref">Topology identification and broadcast storm suppression</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-application-example" class="xref">Application Example</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-brt-building-procedure" class="xref">BRT Building Procedure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-nrt-building-procedure" class="xref">NRT Building Procedure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2.2.1">
                    <p id="section-toc.1-1.10.2.2.2.1.1"><a href="#section-10.2.1" class="xref">10.2.1</a>.  <a href="#name-single-link-failure" class="xref">Single Link Failure</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2.2.2">
                    <p id="section-toc.1-1.10.2.2.2.2.1"><a href="#section-10.2.2" class="xref">10.2.2</a>.  <a href="#name-a-group-of-link-failures" class="xref">A Group of Link Failures</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2.2.3">
                    <p id="section-toc.1-1.10.2.2.2.3.1"><a href="#section-10.2.3" class="xref">10.2.3</a>.  <a href="#name-node-failures" class="xref">Node Failures</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-routing-procedure" class="xref">Routing Procedure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4">
                <p id="section-toc.1-1.10.2.4.1"><a href="#section-10.4" class="xref">10.4</a>.  <a href="#name-fars-performance-in-large-s" class="xref">FAR's Performance in Large-scale Networks</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4.2.1">
                    <p id="section-toc.1-1.10.2.4.2.1.1"><a href="#section-10.4.1" class="xref">10.4.1</a>.  <a href="#name-the-number-of-control-messa" class="xref">The number of control messages required by FAR</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4.2.2">
                    <p id="section-toc.1-1.10.2.4.2.2.1"><a href="#section-10.4.2" class="xref">10.4.2</a>.  <a href="#name-the-calculating-time-of-rou" class="xref">The Calculating Time of Routing Tables</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.4.2.3">
                    <p id="section-toc.1-1.10.2.4.2.3.1"><a href="#section-10.4.3" class="xref">10.4.3</a>.  <a href="#name-the-size-of-routing-tables" class="xref">The Size of Routing Tables</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-implementations-examples" class="xref">Implementations Examples</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#section-13" class="xref">13</a>. <a href="#name-conclusions" class="xref">Conclusions</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#section-14" class="xref">14</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#section-15" class="xref">15</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.1">
                <p id="section-toc.1-1.15.2.1.1"><a href="#section-15.1" class="xref">15.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15.2.2">
                <p id="section-toc.1-1.15.2.2.1"><a href="#section-15.2" class="xref">15.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16">
            <p id="section-toc.1-1.16.1"><a href="#section-16" class="xref">16</a>. <a href="#name-appendix" class="xref">Appendix</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.1">
                <p id="section-toc.1-1.16.2.1.1"><a href="#section-16.1" class="xref">16.1</a>.  <a href="#name-application-area-of-the-sol" class="xref">Application Area of the Solution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.2">
                <p id="section-toc.1-1.16.2.2.1"><a href="#section-16.2" class="xref">16.2</a>.  <a href="#name-technical-evolution-roadmap" class="xref">Technical evolution roadmap</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.16.2.3">
                <p id="section-toc.1-1.16.2.3.1"><a href="#section-16.3" class="xref">16.3</a>.  <a href="#name-updating-roadmap" class="xref">Updating roadmap</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.17">
            <p id="section-toc.1-1.17.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">
      In recent years, with the rapid development of cloud computing technologies, the widely deployed cloud services, such as Amazon EC2 and Google search, bring about huge challenges to data center networking (DCN). Today's cloud-based data centers (DCs) require large-scale networks with larger internal bandwidth and smaller transfer delay. However, conventional networks cannot meet such requirements due to limitations in their network architecture. In order to satisfy the requirements of cloud computing services, many new network architectures have been proposed for data centers, such as Fat-tree, MatrixDCN[MatrixDCN], and BCube[BCube]. These new architectures can support non-blocking large-scale datacenter networks with more than tens of thousands of physical servers. 

All of these architectures have regular topologies, which are common features. The regular topology refers to the network topology structure with obvious regularity and symmetry, which is conducive to automatic configuration of the network, such as the Fat-tree network. In a regular topology, each network node such as a switch or router can be addressed by its location and through a node's address, the node's connections to its neighbors in a network can be determined, and furthermore, the route to the node from other nodes in the network can be determined. So nodes can compute route entries without learning topology.
   
  This document describes a generic routing method and protocol, the Fault-Avoidance Routing (FAR) protocol, for DCNs. This method leverages the regularity in the topologies of data center networks to simplify routing learning and accelerate the query of routing tables. This routing method has a better fault tolerance and can be applied to any DCN with a regular topology.
     
  FAR is not a routing protocol to replace generic routing protocols such as OSPF(Open Shortest Path First)[RFC2328] and IS-IS(Intermediate System-to-Intermediate System). It cannot be used in general local networks whose topological structures are arbitrary, and whose scales are also not very large. OSPF and IS-IS work very well in such a network. But in a large-scale network with regular topology, FAR has better performance. Compared with OSPF and IS-IS, FAR has shorter time of network convergence and lower PDU(Protocol Data Unit) overhead. Furthermore, FAR requires less computing and storage resources, which lets FAR routers to run at a lower cost of production than the generic routers.
       
  In addition, for each type of network architecture, researchers designed a routing algorithm according to the features of its topology. Because these routing algorithms are different and lack compatibility with each other, it is very difficult to develop a routing protocol for network routers supporting multiple routing algorithms. FAR has better adaptability than these specified routing methods.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
FAR consists of three components, i.e., link state learning unit, routing table building unit and routing table querying unit. In the link state learning unit, FAR exchanges link failures among routers to establish a consistent knowledge of the entire network. In this stage, the regularity in topology is exploited to infer failed links and routers. In the routing table building unit, FAR builds up two routing tables, i.e., a basic routing table (BRT) and a negative routing table (NRT), for each router according to the network topology and link states. In the last component, routers forward incoming packets by looking up the two routing tables. The matched entries in BRT minus the matched entries in NRT are the final route entries to be used to forward an incoming packet.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
      This document describes a protocol developed by ZTE and Beijing Jiaotong University. It is just presented here to record the work and to make it available for use in later IETF work if desirable.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">
The remainder of this draft is organized as follows. The problem to be addressed by FAR is described in Section 3.  The framework of FAR routing protocol is described in Section 4. Section 5 and 6 introduce FAR's data format FAR and modules in detail.  Section 7 describe how FAR works by finite state machine (FSM). In Section 8, we discussed how FAR works with variable network architectures. Section 9 takes Fat-tree network as an example to illuminate how FAR works.<a href="#section-1-4" class="pilcrow">¶</a></p>
<section id="section-1.1">
        <h3 id="name-acronyms-definitions">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-acronyms-definitions" class="section-name selfRef">Acronyms &amp; Definitions</a>
        </h3>
<p id="section-1.1-1">
          DCN - Data Center Network<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">
           FAR - Fault-Avoidance Routing<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">
           BRT - Basic Routing Table<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">
           NRT - Negative Routing Table<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">
           NDT - Neighbor Devices Table<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">
           ADT - All Devices Table<a href="#section-1.1-6" class="pilcrow">¶</a></p>
<p id="section-1.1-7">
           LFT - Link Failure Table<a href="#section-1.1-7" class="pilcrow">¶</a></p>
<p id="section-1.1-8">
           DA - Device Announcement<a href="#section-1.1-8" class="pilcrow">¶</a></p>
<p id="section-1.1-9">
           LFA - Link Failure Announcement<a href="#section-1.1-9" class="pilcrow">¶</a></p>
<p id="section-1.1-10">
           DLR - Device and Link Request<a href="#section-1.1-10" class="pilcrow">¶</a></p>
<p id="section-1.1-11">
           IP - Internet Protocol<a href="#section-1.1-11" class="pilcrow">¶</a></p>
<p id="section-1.1-12">
           VM - Virtual Machine<a href="#section-1.1-12" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-2">
      <h2 id="name-conventions-used-in-this-do">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-used-in-this-do" class="section-name selfRef">Conventions used in this document</a>
      </h2>
<p id="section-2-1">
   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.  In this document, these words will appear with that interpretation only when in ALL CAPS.  Lower case uses of these words are not to be interpreted as carrying special significance.<a href="#section-2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3">
      <h2 id="name-problem-statement">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-problem-statement" class="section-name selfRef">Problem Statement</a>
      </h2>
<p id="section-3-1">
     The problem to be addressed by FAR as proposed in this draft is described in this section. The expansion of Cloud data center networks has brought significant challenges to the existing routing technologies. FAR mainly solves a series of routing problems faced by large-scale data center networks.<a href="#section-3-1" class="pilcrow">¶</a></p>
<section id="section-3.1">
        <h3 id="name-the-impact-of-large-scale-n">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-the-impact-of-large-scale-n" class="section-name selfRef">The Impact of Large-scale Networks on Route Calculation</a>
        </h3>
<p id="section-3.1-1">
          In a large-scale cloud data center network, there may be thousands of routers. Running OSPF or IS-IS in such network will encounter these two challenges: 
          
          (1) Network convergence time would be too long, which will cause a longer time to elapse for creating and updating the routes. The response time to network failures may be excessively long; 
          
          (2) High resource consumption. Since a large number of routing protocol packets need to be sent, it causes the routing information consuming too much network bandwidth and CPU(central processing unit) resources, and easily leads to packet loss and makes the challenge (1) more prominent.
          
          In order to solve these two challenges, a common practice is to partition a large network into some small areas, where the route calculation runs independently within different areas. However, nowadays the cloud data centers typically require very large internal bandwidth. To meet this requirement, a large number of parallel equivalent links are deployed in a network, such as a Fat-tree network. Partitioning such a network will affect the utilization of routing algorithm on equivalent multi-path and reduce internal network bandwidth requirements.
          
          In the FAR routing calculation process, a Basic Routing Table (BRT) is built on local network topology leveraging the regularity of the network topologies. In addition to BRT, FAR also builds a Negative Routing Table (NRT). FAR gradually builds NRT in the process of learning network link failure information, which does not require learning a complete network fault information. FAR does not need to wait for the completion of the network convergence in the process of building these two tables. Therefore, it avoids the problem of excessive network convergence overheads in the route calculation process. In addition, FAR only needs to exchange a small amount of link change information between routers, and hence consumes less network bandwidth.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-issues-of-conventional-rout">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-issues-of-conventional-rout" class="section-name selfRef">Issues of Conventional Routing Methods in a Large-scale Network with Giant Number Nodes of Routers</a>
        </h3>
<p id="section-3.2-1">
There are many real world scenario where tens of thousands of nodes(or much more nodes) need to be deployed in a flat area, such as  infiniband routing and switching system, high-performance computer network, and many IDC(Internet Data Center) networks in China. The similar problems have been existed long ago. People have solved the problems through similar solutions, such as the traditional regular topology-based RFC3619[RFC3619] protocol, the routing protocols of infiniband routing and switching system, and high-performance computer network routing protocol.
           
Infiniband defines a switch-based network to interconnect processing nodes and the I/O nodes. Infiniband  can support very large scale networks, use the regularity in topology to simplify its routing algorithm, which is just the same to what we do in FAR.
           
Why OSPF and IS-IS do not work well in a large-scale network with giant number nodes of routers?
           
As we know, the OSPF protocol uses multiple databases, more topological exchange information (as seen in the following example) and complicated algorithm. It requires routers to consume more memory and CPU processing capability. But the processing rate of CPU on the protocol message per second is very limited. When the network expands, CPU will quickly approach its processing limits, and at this time OSPF can not continue to expand the scale of the management. The SPF(Shortest Path First) algorithm itself does not thoroughly solve these problems.  
           
On the contrary, the FAR protocol does not need to calculate SPF, which saves calculation time and resources, so FAR does not have the convergence time delay and the additional CPU overheads, which SPF requires. Because in the initial stage, FAR already knows the regular information of the whole network topology and does not need to periodically do SPF operation.
           
One of the examples of "more topological exchange information": 
           
In the OSPF protocol, LSA(Link-State Advertisement) floods every 1800 seconds. Especially in the larger network, the occupation of CPU and band bandwidth will soon reach the router's performance bottleneck. 
In order to reduce these adverse effects, OSPF introduced the concept of Area, which still has not solved the problem thoroughly. By dividing the OSPF Area into several areas, the routers in the same area do not need to know the topological details outside their area. (In comparison with FAR, after  OSPF introducing the concept of Area, the equivalent paths cannot be selected in the whole network scope)  
           
OSPF can achieve the following results by Area : 
1) Routers only need to maintain the same link state databases as other routers within the same Area, without the necessity of maintaining the same link state database as all routers in the whole OSPF domain.  
2) The reduction of the link state databases means dealing with relatively fewer LSA, which reduces the CPU consumption of routers; 
3) The large number of LSAs flood only within the same Area. 
But, its negative effect is that the smaller number of routers which can be managed in each OSPF area. 
On the contrary, because FAR does not have the above disadvantages, FAR can also manage large-scale network even without dividing Areas. 
           
The aging time of OSPF is set in order to adapt to routing transformation and protocol message exchange happened frequently in the irregular topology. Its negative effect is:  
when the network does not change, the LSA needs to be refreshed every 1800 seconds to reset the aging time. In the regular topology, as the routings are fixed, it does not need the complex protocol message exchange and aging rules to reflect the routing changes, as long as LFA mechanism in the FAR is enough. 
           
Compared with the LSVR(Link State Vector Routing) protocol, the LSVR protocol has no special requirements for the network topology structure, however, the FAR draft is applicable to the regular topology network architecture and simplifies unnecessary processing. It is a solution proposed to greatly improve the routing efficiency of the regular network topology. The FAR solution is more efficient than the general methods such as LSVR in regular topology.
           
Therefore, in FAR, we can omit many unnecessary processing and the packet exchange. The benefits are fast convergence speed and much larger network scale than other dynamic routing protocol. 
Now there are some successful implementations of simplified routings in the regular topology in the HPC(High Performance Computing) environment. 
Conclusion: As FAR needs few routing entries and the topology is regular, the database does not need to be updated regularly. Without the need for aging, there is no need for CPU and bandwidth overhead brought by LSA flood every 30 minutes, so the expansion of the network has no obvious effect on the performance of FAR, which is contrary to OSPF. 
           
Comparison of convergence time: 
The settings of OSPF spf_delay and spf_hold_time can affect the change of convergence time. The convergence time of the network with 2480 nodes is about 15-20 seconds; while the FAR does not need to calculate the SPF, so there is no such convergence time. 
           
These issues still exist in rapid convergence technology of OSPF ,ISIS (such as I-SPF, Incremental SPF) and LSVR. The convergence speed and network scale constraint each other. FAR does not have the above problems, and the convergence time is almost negligible.
           
Can FRR(Fast Reroute) solve these problems? IP FRR has some limitations. The establishment of IP FRR backup scheme will not affect the original topology and traffic forwarding which are established by protocol, however, we can not get the information of whereabouts and status when the traffic is switched to an alternate next hop.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.3">
        <h3 id="name-network-addressing-issues">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-network-addressing-issues" class="section-name selfRef">Network Addressing Issues</a>
        </h3>
<p id="section-3.3-1">
          Routers are typically configured with multiple network interfaces, each connected to a subnet. OSPF and other routing algorithms require that each interface of a router must be configured with an IP address. A large-scale data center network may contain thousands of routers and each router has dozens of network interfaces, thus, there are tens of thousands of IP addresses needed to be configured in a data center. It will be very complex to configure and manage a large number of network interfaces and will be difficult to troubleshoot network problems, then network maintenance will be costly and error-prone.
           
          In FAR, the device position information is encoded in the IP address of the router. Each router only needs to be assigned a unique IP address according its location, which greatly solves complex network addressing issues in large-scale networks.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.4">
        <h3 id="name-big-routing-table-issues">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-big-routing-table-issues" class="section-name selfRef">Big Routing Table Issues</a>
        </h3>
<p id="section-3.4-1">
           There are a large number of subnets in the large-scale data center network. A router may build a routing entry for each subnet, and therefore the size of routing tables on each router may be very large. It will increase a router's cost and reduce the querying speed of the routing table.
          
          FAR uses two measures to reduce the size of its routing tables: a)It builds a BRT on the regularity of the network topologies; b)It introduces a new routing table, i.e., a NRT. In this way FAR can reduce the size of routing tables to only a few dozen routing entries.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.5">
        <h3 id="name-adaptivity-issues-for-routi">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-adaptivity-issues-for-routi" class="section-name selfRef">Adaptivity Issues for Routing Algorithms</a>
        </h3>
<p id="section-3.5-1">
         To implement efficient routing in large-scale datacenters, besides FAR, some other routing methods are proposed for some specific network architectures, such as Fat-tree and BCube. These routing methods are different(from both design and implementation viewpoints) and not compatible with the conventional routing methods, which brings big troubles to network equipment providers to develop new routers supporting various new routing methods. 
         
         FAR is a generic routing method. With slight modification, FAR method can be applied to most of regular datacenter networks. Furthermore, the structure of routing tables and querying a routing table in FAR are the same as conventional routing method. If FAR is adopted, the workload of developing a new type of router will be significantly decreased.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.6">
        <h3 id="name-virtual-machine-migration-i">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-virtual-machine-migration-i" class="section-name selfRef">Virtual Machine Migration Issues</a>
        </h3>
<p id="section-3.6-1">
          Supporting VM migration is very important for cloud-based datacenter networks. However, in order to support layer-3 routing, routing methods including OSPF and FAR require limiting VM migration within a subnet. For this paradox, the mainstream methods still utilize layer-3 routing on routers or switches, transmit packets encapsulated by IPinIP or MACinIP between hosts by tunnels passing through network to the destination access switch, and then extract original packet out and send it to the destination host.
           
 By utilizing the aforementioned methods, FAR can be applied to Fat-tree, MatrixDCN or BCube networks for supporting VM migration in entire network.<a href="#section-3.6-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-4">
      <h2 id="name-the-far-framework">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-the-far-framework" class="section-name selfRef">The FAR Framework</a>
      </h2>
<p id="section-4-1">
      FAR requires that a DCN has a regular topology, and network devices, including routers, switches, and servers, are assigned IP addresses according to their locations in the network. In other word, we can locate a device in the network according to its IP address.
        
        FAR is a distributed routing method. In order to support FAR, each router needs to have a routing module that implements the FAR algorithm. FAR algorithm is composed of three parts, i.e., link-state learning, routing table building and routing table querying, as shown in Fig. 1.
       

        1:Neighbor and Link Detection Module(M1)
        
        2:Device Learning Module(M2)
        
        3:Invisible Neighbor and Link Failure Inferring Module(M3)
        
        4:Link Failure Learning Module(M4)
        
        5:BRT Building Module(M5)
        
        6:NRT Building Module(M6)
        
        7:Routing Table Lookup(M7)
        
        The meanings of M1-M7 are explained in detail in section 6.
        
       Link-state learning is responsible for a router to detect the states of its connected links and learn the states of all the other links in the entire network. The second part builds two routing tables, a basic routing table (BRT) and an negative routing table (NRT), according to the learned link states in the first part. The third part queries the BRT and the NRT to decide a next forwarding hop for the received (ingress) packets.<a href="#section-4-1" class="pilcrow">¶</a></p>
<span id="name-the-far-framework-2"></span><div id="figure1">
<figure id="figure-1">
        <div class="alignCenter art-text artwork" id="section-4-2.1">
<pre>

           Link-state Learning    |Routing Table  | Routing Table
                                  |  Building     |   Querying
                                  |               |
+--------+   /---------------\    | +--------+    |
|2 Device|&lt;--| 1 Neighbor &amp;  |-----&gt;| 5 BRT  \    |    Packets
|Learning|   | Link Detection|    | |Building|\   |       |
+--------+   \---------------/    | +--------+ \  |      \|/
         |           |            |             \ |+--------------+
         |           |            |              /||  7 Querying  |
        \|/         \|/           |             / || Routing Table|
         +-----------------------+|            /  |+--------------+
         |3 Invisible Neighbor &amp; ||           /   |
         |Link Failure Inferring || +---------    |
         +-----------------------+|/| 6 NRT  |    |
                     |            / |Building|    |
                    \|/          /| +--------+    |
              +--------------+  / |               |
              |4 Link Failure| /  |               |
              |  Learning    |    |               |
              +--------------+    |               |
                                  |               |
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-the-far-framework-2" class="selfRef">The FAR framework</a>
        </figcaption></figure>
</div>
</section>
<section id="section-5">
      <h2 id="name-data-format">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-data-format" class="section-name selfRef">Data Format</a>
      </h2>
<section id="section-5.1">
        <h3 id="name-data-tables">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-data-tables" class="section-name selfRef">Data Tables</a>
        </h3>
<p id="section-5.1-1">
        Some data tables are maintained on each router in FAR. They are:

Neighbor Device Table (NDT): To store neighbor routers and related links.

All Devices Table (ADT): To store all routers in the entire network.

Link Failures Table (LFT): To store all link failures in the entire network.

Basic Routing Table (BRT): To store the candidate routes.

Negative Routing Table(NRT): To store the avoiding routes.


Device ID: The ID of a neighbor router.

Device IP: The IP address of a neighbor router.

Port ID: The port ID that a neighbor router is attached to.

Link State: The state of the link between a router and its neighbor router. There are two states: Up and Down.

Update Time: The time of updating the entry.


        Device ID: The ID of a neighbor router.
        
        Device IP: The IP address of a neighbor router.
        
        Type: The type of a neighbor router.
        
        State: The state of a neighbor router. There are two states: Up and Down.
        
        Update Time: The time of updating the entry.
       
        
        No: The entry number.
        
        Router 1 IP: The IP address of one router that a failed link connects to.
        
        Router 2 IP: The IP address of another router that a failed link connects to.
        
        Timestamp: It identifies when the entry is created.
         
         
        Destination: A destination network
        
        Mask: The subnet mask of a destination network.
        
        Next Hop: The IP address of a next hop for a destination.
        
        Interface: The interface related to a next hop.
        
        Update Time: The time of updating the entry.
        
         
        Destination: A destination network.
        
        Mask: The subnet mask of a destination network.
        
        Next Hop: The IP address of a next hop that should be avoided for a destination.
        
        Interface: The interface related to a next hop that should be avoided.
        
        Failed Link No: A group of failed link numbers divided by "/", for example 1/2/3.
        
        Timestamp: The time of updating the entry.
         
The format of NDT<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-2">
<pre>
 ----------------------------------------------------------
 Device ID | Device IP | Port ID | Link State | Update Time
 ----------------------------------------------------------

</pre><a href="#section-5.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1-3">
        
The format of ADT<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-4">
<pre>
 --------------------------------------------------
 Device ID | Device IP | Type | State | Update Time
 --------------------------------------------------

</pre><a href="#section-5.1-4" class="pilcrow">¶</a>
</div>
<p id="section-5.1-5">
        
The format of LFT<a href="#section-5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-6">
<pre>
 --------------------------------------------
 No | Router 1 IP | Router 2 IP | Timestamp
 --------------------------------------------

</pre><a href="#section-5.1-6" class="pilcrow">¶</a>
</div>
<p id="section-5.1-7">
        
The format of BRT<a href="#section-5.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-8">
<pre>
 -------------------------------------------------------
 Destination | Mask | Next Hop | Interface | Update Time
 -------------------------------------------------------

</pre><a href="#section-5.1-8" class="pilcrow">¶</a>
</div>
<p id="section-5.1-9">
        
The format of  NRT<a href="#section-5.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1-10">
<pre>
 -------------------------------------------------------------------
 Destination| Mask| Next Hop| Interface| Failed Link No| Timestamp
 -------------------------------------------------------------------

</pre><a href="#section-5.1-10" class="pilcrow">¶</a>
</div>
</section>
<section id="section-5.2">
        <h3 id="name-messages">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-messages" class="section-name selfRef">Messages</a>
        </h3>
<p id="section-5.2-1">
 Some protocol messages are exchanged between routers in FAR. 

Hello Message: This message is exchanged between neighbor routers to learn adjacency.

Device Announcement (DA): Synchronize the knowledge of routers between routers.

Link Failure Announcement (LFA): Synchronize link failures between routers.

Device and Link Request (DLR): When a router starts, it requests the knowledge of routers and links from its neighbors by a DLR message.

A FAR Message is directly encapsulated in an IP packet. The protocol field of IP header indicates an IP packet is an FAR message.

The four types of FAR messages have same format of packet header, called FAR header (as shown in Figure 2). 
        

        Version: FAR version
        
        Message Type: The type of FAR message.
        
        Packet Length: The packet length of the total FAR message.
        
        Checksum: The checksum of an entire FAR message.
        
        AuType:Authentication type. 0: no authentication, 1: Plaintext Authentication, 2: MD5 Authentication.
        
        Authentication: Authentication information. 0: undefined, 1: Key, 2: key ID, MD5 data length and packet number.  MD5 data is appended to the backend of the packet.
        
        AuType and Authentication can refer to the definition of OSPF packet.
        
        

        For Hello messages, the Message Type in FAR header is set to 1.Besides FAR header, a Hello message(Fig. 3) requires the following fields:
        
        Router IP: The router IP address.
        
        HelloInterval: The interval of sending Hello messages to neighbor routers.
        
        RouterDeadInterval: The interval to set a neighbor router dead(out-of-service). If in the interval time, a router doesn't receive a Hello message from its neighbor router, the neighbor router is treated as dead.
        
        Neighbor Router IP: The IP address of a neighbor router. All the neighbor router's addresses should be included in a Hello message.
        
        

        For DA messages(Fig. 4), the Message Type in FAR header is set to 2. Besides FAR header, a DA message includes IP addresses of all the announced routers.
        
        

        For LFA messages(Fig. 5), the Message Type in FAR header is set to 3. Besides FAR header, a LFA message includes all the announced link failures.
        
        Left IP: The IP address of the left endpoint router of a link.
        
        Right IP: The IP address of the right endpoint router of a link.
        
        State: Link state. 0: Up, 1: down
        
        

         For DLR messages(Fig. 6), the Message Type in FAR header is set to 1.Except for FAR header, DLR has no additional fields.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<span id="name-the-format-of-far-header"></span><div id="figure2">
<figure id="figure-2">
          <div class="alignCenter art-text artwork" id="section-5.2-2.1">
<pre>

 |&lt;--- 1 ---&gt;| &lt;--- 1 ---&gt;|&lt;--------- 2 ----------&gt;|
 +-----------+------------+------------------------+
 |  Version  |Message Type|    Message Length      |
 +-----------+------------+------------------------+
 |        Checksum        |       AuType           |
 +------------------------+------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                   Timestamp                     |
 +-------------------------------------------------+

</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-the-format-of-far-header" class="selfRef">The format of FAR header</a>
          </figcaption></figure>
</div>
<p id="section-5.2-3"></p>
<span id="name-the-format-of-hello-message"></span><div id="figure3">
<figure id="figure-3">
          <div class="alignCenter art-text artwork" id="section-5.2-4.1">
<pre>

 |&lt;--- 1 ---&gt;| &lt;--- 1 ---&gt;|&lt;--------- 2 ----------&gt;|
 +-----------+------------+------------------------+
 |  Version  |Message Type|    Message Length      |
 +-----------+------------+------------------------+
 |        Checksum        |       AuType           |
 +------------------------+------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                   Timestamp                     |
 +-------------------------------------------------+
 |                    Router IP                    |
 +------------------------+------------------------+
 |     HelloInterval      |     HelloDeadInterval  |
 +------------------------+------------------------+
 |                Neighbor Router IP               |
 +-------------------------------------------------+
 |                       ...                       |
 +-------------------------------------------------+

</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-the-format-of-hello-message" class="selfRef">The Format of Hello Messages</a>
          </figcaption></figure>
</div>
<p id="section-5.2-5"></p>
<span id="name-the-format-of-da-messages"></span><div id="figure4">
<figure id="figure-4">
          <div class="alignCenter art-text artwork" id="section-5.2-6.1">
<pre>

 |&lt;----1----&gt;| &lt;----1----&gt;|&lt;----------2-----------&gt;|
 +-----------+------------+------------------------+
 |  Version  |Message Type|    Message Length      |
 +-----------+------------+------------------------+
 |        Checksum        |       AuType           |
 +------------------------+------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                   Timestamp                     |
 +------------------------+------------------------+
 |                   Router1 IP                    |
 +-------------------------------------------------+
 |                       ...                       |
 +-------------------------------------------------+

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-the-format-of-da-messages" class="selfRef">The Format of DA Messages</a>
          </figcaption></figure>
</div>
<p id="section-5.2-7"></p>
<span id="name-the-format-of-lfa-messages"></span><div id="figure5">
<figure id="figure-5">
          <div class="alignCenter art-text artwork" id="section-5.2-8.1">
<pre>

 |&lt;----1----&gt;| &lt;----1----&gt;|&lt;----------2-----------&gt;|
 +-----------+------------+------------------------+
 |  Version  |Message Type|    Message Length      |
 +-----------+------------+------------------------+
 |        Checksum        |       AuType           |
 +------------------------+------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                   Timestamp                     |
 +------------------------+------------------------+
 |                     Left IP                     |
 +-------------------------------------------------+
 |                    Right IP                     |
 +------------------------+------------------------+
 |                      State                      |
 +-------------------------------------------------+
 |                       ...                       |
 +-------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a>:
<a href="#name-the-format-of-lfa-messages" class="selfRef">The Format of LFA Messages</a>
          </figcaption></figure>
</div>
<p id="section-5.2-9"></p>
<span id="name-the-format-of-dlr-messages"></span><div id="figure6">
<figure id="figure-6">
          <div class="alignCenter art-text artwork" id="section-5.2-10.1">
<pre>

 |&lt;----1----&gt;| &lt;----1----&gt;|&lt;----------2-----------&gt;|
 +-----------+------------+------------------------+
 |  Version  |Message Type|    Message Length      |
 +-----------+------------+------------------------+
 |        Checksum        |       AuType           |
 +------------------------+------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                  Authentication                 |
 +-------------------------------------------------+
 |                   Timestamp                     |
 +-------------------------------------------------+

</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a>:
<a href="#name-the-format-of-dlr-messages" class="selfRef">The Format of DLR Messages</a>
          </figcaption></figure>
</div>
</section>
</section>
<section id="section-6">
      <h2 id="name-far-modules">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-far-modules" class="section-name selfRef">FAR Modules</a>
      </h2>
<section id="section-6.1">
        <h3 id="name-neighbor-and-link-detection">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-neighbor-and-link-detection" class="section-name selfRef">Neighbor and Link Detection Module(M1)</a>
        </h3>
<p id="section-6.1-1">
          M1 is responsible for sending and receiving Hello messages, and detecting directly-connected links and neighbor routers. Each Hello message is encapsulated in an IP packet. M1 sends Hello messages periodically to all the active router ports and receives Hello messages from its neighbor routers. M1 detects neighbor routers and directly-connected links according to received Hello Messages and stores these neighbors and links into a Neighbor Devices Table (NDT). Additionally, M1 also stores neighbor routers into an All Devices Table (ADT).<a href="#section-6.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.2">
        <h3 id="name-device-learning-modulem2">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-device-learning-modulem2" class="section-name selfRef">Device Learning Module(M2)</a>
        </h3>
<p id="section-6.2-1">
          M2 is responsible for sending, receiving, and forwarding device announcement (DA) messages, learning all the routers in the whole network, and deducing faulted routers. When a router starts, it sends a DA message announcing itself to its neighbors and a DLR message requesting the knowledge of routers and links from its neighbors. If M2 module of a router receives a DA message, it checks whether the router encapsulated in the message is in an ADT. If the router is not in the ADT, M2 puts this router into the ADT and forwards this DA message to all the active ports except for the incoming one, otherwise, M2 discards this message directly. If M2 module of a router receives a DLR message, it replies a DA message that encapsulates all of the learned routers.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.3">
        <h3 id="name-invisible-neighbor-and-link">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-invisible-neighbor-and-link" class="section-name selfRef">Invisible Neighbor and Link Failure Inferring Module(M3)</a>
        </h3>
<p id="section-6.3-1">
          M3 is responsible for inferring invisible neighbors of the current router by means of the ADT. If the link between a router A and its neighbor B breaks, which results in that M1 module of A cannot detect the existence of B, then B is an invisible neighbor of A. Since a device's location is coded into its IP address, it can be judged whether two routers are adjacent, according to their IP addresses. Based on this idea, M3 infers all of the invisible neighbors of the current router and the related link failures. The results are stored into an NDT. Moreover, link failures also are added into a link-failure table (LFT). LFT stores all of the failed links in the entire network.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.4">
        <h3 id="name-link-failure-learning-modul">
<a href="#section-6.4" class="section-number selfRef">6.4. </a><a href="#name-link-failure-learning-modul" class="section-name selfRef">Link Failure Learning Module(M4)</a>
        </h3>
<p id="section-6.4-1">
          M4 is responsible for sending, receiving and forwarding link failure announcement (LFA) and learning all the link failures in the whole network. M4 broadcasts each newly inferred link failure to all the routers in the network. Each link failure is encapsulated in a LFA message and one link failure is broadcasted only once.  If a router receives a DLR request from its neighbor, it will reply a LFA message that encapsulates all the learned link failures through M4 module. If M4 receives a LFA message, it checks whether the link failure encapsulated in the message is in a LFT by comparing two link ends and timestamp. If the link failure is not in the LFT or timestamp is different, M4 puts this link failure into the LFT (or update timestamp only) and forwards this LFA message to all the active ports except for the incoming one, otherwise, M4 discards this message directly.
         
There is a special case a router will rebroadcast a link failure. If a router receives a data packet and must forward the packet going ahead to destination through a failed link, it means some previous router should avoid this failed link according to its NRT but it doesn't. In this case, maybe the previous router missed the LFA message of the link failure due to some uncertain reasons. So the forwarding router rebroadcasts the LFA message.<a href="#section-6.4-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.5">
        <h3 id="name-brt-building-modulem5">
<a href="#section-6.5" class="section-number selfRef">6.5. </a><a href="#name-brt-building-modulem5" class="section-name selfRef">BRT Building Module(M5)</a>
        </h3>
<p id="section-6.5-1">
          M5 is responsible for building a BRT for the current router. By leveraging the regularity in topology, M5 can calculate the routing paths for any destination without the knowledge of the topology of whole network, and then build the BRT based on an NDT. Since the IP addresses of network devices are continuous, M5 only creates one route entry for a group of destination addresses that have the same network prefix by means of route aggregation technology. Usually, the size of a BRT is very small. The detail of how to build a BRT is described in section 5.<a href="#section-6.5-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.6">
        <h3 id="name-nrt-building-modulem6">
<a href="#section-6.6" class="section-number selfRef">6.6. </a><a href="#name-nrt-building-modulem6" class="section-name selfRef">NRT Building Module(M6)</a>
        </h3>
<p id="section-6.6-1">
          M6 is responsible for building a NRT for the current router. Because M5 builds a BRT without considering link failures in network, the routing paths calculated by the BRT cannot avoid failed links. To solve this problem, a NRT is used to exclude the routing paths that include some failed links from the paths calculated by a BRT. M6 calculate the routing paths that include failed links and stored them into the NRT. The details of how to build a NRT is described in section 5.<a href="#section-6.6-1" class="pilcrow">¶</a></p>
</section>
<section id="section-6.7">
        <h3 id="name-routing-table-lookupm7">
<a href="#section-6.7" class="section-number selfRef">6.7. </a><a href="#name-routing-table-lookupm7" class="section-name selfRef">Routing Table Lookup(M7)</a>
        </h3>
<p id="section-6.7-1">
          M7 is responsible for querying routing tables and selecting the next hop for forwarding the packets. Firstly, M7 takes the destination address of a forwarding packet as a criterion to look up route entries in a BRT based on longest prefix match. All of the matched entries are composed of a candidate hops list. Secondly, M7 look up negative route entries in a NRT taking the destination address of the forwarding packet as criteria. This lookup is not limited to the longest prefix match, any entry that matches the criteria would be selected and composed of an avoiding hops list. Thirdly, the candidate hops minus avoiding hops are composed of an applicable hops list. At last, M7 sends the forwarding packet to any one of the applicable hops. If the applicable list is empty, the forwarding packet will be dropped.<a href="#section-6.7-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-7">
      <h2 id="name-how-a-far-router-works">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-how-a-far-router-works" class="section-name selfRef">How a FAR Router Works</a>
      </h2>
<p id="section-7-1">
        Figure 7 shows how a FAR router works by its FSM.
        

       1)When a router starts up, it starts a Hello thread and then starts ND (neighbor detection) timer (3 seconds). Next the router goes into ND (neighbor detection) state.
       
       2)In the ND state, if a router received a Hello message, then it performs a Hello-message processing and goes back to the ND state.
       
       3)When the ND timer is over, a router goes into ND-FIN (neighbor detection finished) state.
       
       4)A router starts the LFD (link failure detection) thread and DFD (device failure detection) state, and sends DA message and DLR message to all of its active ports. Then the router goes into Listen state.
       
       5) If a router receives a Hello message, then goes into HELLO-RECV state.
       
6) If a router receives a DLR message, then goes into DLR-RECV state.
       
7) If a router receives a DA message, then goes into DA-RECV state.
       
8) If a router receives a LFA message, then goes into LFA-RECV state.
       
9) A router performs the Hello-message processing. After that, it goes back to Listen state.
       
10) A router performs the DLR-message processing. After that, it goes back to Listen state.
       
11) A router performs the DA-message processing. After that, it goes back to Listen state.
       
12) A router performs the LFA-message processing. After that, it goes back to Listen state.
       
13) Hello thread produces and sends Hello messages to all its ports periodically.
       
14) LFD thread calls link-failure-detection processing to check link failures in all links periodically
       
15) DA thread produces and sends DA messages periodically (30 minutes).
       
16) When DFD thread starts up, it sleep a short time (30 seconds) to wait for a router learning all the active routers in the network. Then the thread calls the device-failure-detection processing to check device failures periodically (30 minutes).<a href="#section-7-1" class="pilcrow">¶</a></p>
<span id="name-the-finite-state-machine-of"></span><div id="figure7">
<figure id="figure-7">
        <div class="alignCenter art-text artwork" id="section-7-2.1">
<pre>


                 /---------------\
                 |     Start     |
                 |               |
                 \---------------/
                         |
          +--------+     |1
          |        |     |
          |       \|/   \|/
          |    +--------------------+
          |2   |         ND         |
          |    |                    |
          |    +--------------------+
          |        |      |
          |        |      |3
          +--------+      |
                         \|/
                   +--------------+
                   |    ND-FIN    |
                   |              |
                   +--------------+
                          |
                          |4
                          |
                         \|/
 ________10_______\+--------------+/_______11________
|                 /|              |\                |
|                  |    Listen    |                 |
|     ____9_______\|              |/_______12___    |
|    |            /|              |\            |   |
|    |             +--------------+             |   |
|    |               5/  |  |    \8             |   |
|    |              |/_  |  |    _\|            |   |
|    |  +------------+  6|  |7   +------------+ |   |
|     --| HELLO-RECV |   |  |    | LFA-RECV   |--   |
|       +------------+   |  |    +------------+     |
|                  ______|  |______                 |
|                 |                |                |
|                \|/              \|/               |
|           +------------+  +------------+          |
|___________|  DLR-RECV  |  |  DA-RECV   |__________|
            +------------+  +------------+


                       _________
                      |         |
                      |         |
                     \|/        |
              +--------------+  |13
              | Hello Thread |  |
              +--------------+  |
                      |         |
                      |_________|

                       _________
                      |         |
                      |         |
                     \|/        |
              +--------------+  |14
              |  LFD Thread  |  |
              +--------------+  |
                      |         |
                      |_________|

                       _________
                      |         |
                      |         |
                     \|/        |
              +--------------+  |15
              |  DA Thread   |  |
              +--------------+  |
                      |         |
                      |_________|

                       _________
                      |         |
                      |         |
                     \|/        |
              +--------------+  |16
              |  DFD Thread  |  |
              +--------------+  |
                      |         |
                      |_________|
</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a>:
<a href="#name-the-finite-state-machine-of" class="selfRef">The Finite State Machine of FAR Router</a>
        </figcaption></figure>
</div>
</section>
<section id="section-8">
      <h2 id="name-compatible-architecture">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-compatible-architecture" class="section-name selfRef">Compatible Architecture</a>
      </h2>
<p id="section-8-1"> 
As a generic routing protocol, FAR can be run in various DCNs with regular topology. Up to now, we have implemented the FAR protocol for 4 types of DCN, including Fat-tree, BCube, MatrixDCN and Diamond.

For different network architectures, most processing of FAR is same besides calculation of routing tables. BRT routing tables are calculated based on Hello messages and NRT routing tables are calculated based on LFA messages in FAR. To extend FAR to support a new network architecture, only processing of Hello and LFA messages need providing to build BRT and NRT routing tables.

In this protocol, FAR can support maximally 12 network architectures and at least support 1 built-in network architecture, such as Fat-tree, BCube and MatrixDCN,etc. Each network architecture is assigned a unique number from 1 to 12. For example, if the 1 built-in architectures are assigned 1, and other customized architectures are assigned 2 to 12.
 
 1: Fat-tree
 
 2: BCube
 
 3: MatrixDCN.
 
 4: xxx.
 
  ......
 
 12: xxx.<a href="#section-8-1" class="pilcrow">¶</a></p>
</section>
<section id="section-9">
      <h2 id="name-topology-identification-and">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-topology-identification-and" class="section-name selfRef">Topology identification and broadcast storm suppression</a>
      </h2>
<p id="section-9-1"> 
In this design, the initial topology discovery process is not a mandatory option for a FAR routing protocol. The recommended solution here is to use a pre-configured configuration file, which contains topology parameters of the current system, each node device as long as according to these configuration parameters will be able to know the topology information. In this way, we do not have to deal with complex topology discovery processes, nor do we need to calculate the shortest path, because the optimal path can be calculated from the parameters. This protocol also allows the formation of configuration files to be submitted to the topology discovery protocol, allowing for a variety of different implementation options.

Regarding the flood suppression processing of broadcast packets, it has been considered in the previous content. Since the hello packets is only transmitted between the two nodes, it cannot be spread out. The link error message is only sent to the CPU, and are not forwarded to the nodes in layer 2 broadcasting. Moreover,  each node will discard the repeated error messages when the node receives them. In this way, the broadcast storm can be suppressed. If a link is unstable and repeatedly up or down, the system will not send new messages after sending notifications, and the system will not oscillate repeatedly. The topology is updated only when the link is later detected to be stable for a long time.<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10">
      <h2 id="name-application-example">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-application-example" class="section-name selfRef">Application Example</a>
      </h2>
<p id="section-10-1"> 
      In this section, we take a Fat-tree network(Fig. 7) as an example to describe how to apply FAR routing. Since M1 to M4 are very simple, we only introduce how the modules M5, M6, and M7 work in a Fat-tree network. 
      
      A Fat-tree network is composed of 4 layers. The top layer is core layer, and the other layers are aggregation layer, edge layer and server layer. There are k pods, each one containing two layers of k/2 switches. Each k-port switch in the edge layer is directly connected to k/2 hosts. The remaining k/2 ports are connected to k/2 of the k-port switches in the aggregation layer. There are (k/2)2 k-port core switches. Each core switch has one port connected to each of the k pods.
      
      
         Aggregation switches are given addresses of the form 10.pod.0.switch, where pod denotes the pod number, and switch denotes the position of that switch in the upper pod (in [1, k/2]). Edge switches are given addresses of the form 10.pod.switch.1, where pod denotes the pod number, and switch denotes the position of that switch in the lower pod (in [1, k/2]). The core switches are given addresses of the form 10.0.j.i, where j and i denote that switch's coordinates in the (k/2)2 core switch grid (each in[1, (k/2)], starting from top-left). The address of a host follows the pod switch to which it is connected to; hosts have addresses of the form: 10.pod.switch.ID, where ID is the host's position in that subnet (in [2, k/2+1], starting from left to the right).<a href="#section-10-1" class="pilcrow">¶</a></p>
<span id="name-fat-tree-network"></span><div id="figure8">
<figure id="figure-8">
        <div class="alignCenter art-text artwork" id="section-10-2.1">
<pre>
   10.0.1.1          10.0.1.2            10.0.2.1         10.0.2.2
     +--+              +--+                +--+               +--+
     |  |              |  |                |  |               |  |
     +--+,_            +--+',              +--+             ,,+--+
     |`,`',`-.,       / | \  `.           .'` -        .-'``.` /|
     |  .  `', `'.,  /  |  '   '       ,-`,'  |`.         .`  ' |
     |   \    `',  `-.,              .`  /    |  `,     .`  ,'  |
     |    `,     `'.   `'-,_      .'`  ,'     |    ',      /    |
     |      .       `'.     `-.,-`    /       |      \
     |       \         `'.,  .` `'., `        |       `.
     |        `,          .'`,     ,`'.,      |         ',
     |          .      ,-`    '., -     `'-,_ |           `.
     |           \   .`         ,'.,         `|.,           .
     |            .'`          /    `-,       |  `'.,        `.
 10.1.0.1      ,-`  .        .'    10.3.0.1  10.3.0.2`'.,      ',
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
     |  |  |  |      |  |  |  |        |  |  |  |        |  |  |  |
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      |  \/ |         |  \/ |           |  \/ |           |  \/ |
     +--+/\+--+      +--+/\+--+        +--+/\+--+        +--+/\+--+
     |  |  |  |      |  |  |  |        |  |  |  |        |  |  |  |
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      /|   10.1.2.1   /|    |\     10 3.1.3   |\          /|   |  |
     / |    | \      / |    | \        / |    | \        / |   |  |
    /  |    |  \    /  |    |  \      /  |    |  \      /  |   |  |
   /   |    |   \  /   |    |   \    /   |    |   \    /   |   |  |
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++
        10.1.2.2                           10.3.1.3

</pre>
</div>
<figcaption><a href="#figure-8" class="selfRef">Figure 8</a>:
<a href="#name-fat-tree-network" class="selfRef">Fat-tree Network</a>
        </figcaption></figure>
</div>
<section id="section-10.1">
        <h3 id="name-brt-building-procedure">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-brt-building-procedure" class="section-name selfRef">BRT Building Procedure</a>
        </h3>
<p id="section-10.1-1">
          By leveraging the topology's regularity, every switch clearly knows how it forwards a packet. When a packet arrives at an edge switch, if the destination of the packet lies in the same subnet with the switch, then the switch directly forwards the packet to the destination server through layer-2 switching. Otherwise, the switch forwards the packet to any of aggregation switches in the same pod. When a packet arrives at an aggregation switch, if the destination of the packet lies in the same pod, the switch forwards the packet to the corresponding edge switch. Otherwise, the switch forwards the packet to any of core switches that it is connected to. If a core switch receives a packet, it forwards the packet to the corresponding aggregation switch that lies in the destination pod.
          
          The forwarding policy discussed above is easily expressed through a BRT. The BRT of an edge switch, such as 10.1.1.1, is composed of the following entries:
          
         

          The BRT of an aggregation switch, such as 10.1.0.1, is composed of the following entries:
          
          
          The BRT of a core switch, such as 10.0.1.1, is composed of the following entries:<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.1-2">
<pre>
Destination/Mask       Next hop
10.0.0.0/255.0.0.0     10.1.0.1
10.0.0.0/255.0.0.0     10.1.0.2
</pre><a href="#section-10.1-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.1-3">
<pre>
Destination/Mask            Next hop
10.1.1.0/255 255.255.0      10.1.1.1
10.1.2.0/255.255.255.0      10.1.2.1
10.0.0.0/255.0.0.0          10.0.1.1
10.0.0.0/255.0.0.0          10.0.1.2
</pre><a href="#section-10.1-3" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.1-4">
<pre>
Destination/Mask            Next hop
10.1.0.0/255 255.0.0        10.1.0.1
10.2.0.0/255.255.0.0        10.2.0.1
10.3.0.0/255.255.0.0        10.3.0.1
10.4.0.0/255.255.0.0        10.4.0.1
</pre><a href="#section-10.1-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-10.2">
        <h3 id="name-nrt-building-procedure">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-nrt-building-procedure" class="section-name selfRef">NRT Building Procedure</a>
        </h3>
<p id="section-10.2-1">
         The route entries in an NRT are related with link and node failures. We summarize all types of cases into three (3) catalogs.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<section id="section-10.2.1">
          <h4 id="name-single-link-failure">
<a href="#section-10.2.1" class="section-number selfRef">10.2.1. </a><a href="#name-single-link-failure" class="section-name selfRef">Single Link Failure</a>
          </h4>
<p id="section-10.2.1-1">
          In Fat-tree, Links can be classified as 3 types by their locations: 1) servers to edge switches; 2) edge to aggregation switches; 3) aggregation to core switches. Link failures between servers to edge switches only affect the communication of the corresponding servers and don't affect the routing tables of any switch, so we only discuss the second and third type of links failures.
          
          Edge to Aggregation Switches
          
Suppose that the link between an edge switch, such as 10.1.2.1 (A), and an aggregation switch, such as 10.1.0.1(B),fails. This link failure may affect 3 types of communications.
          
o Sources lie in the same subnet with A, and destinations do not. In this case, the link failure will only affect the routing tables of A. As this link is attached to A directly, A only needs to delete the route entries whose next hop is B in its BRT and add no entries to its NRT when A's M6 module detect the link failure.
          
o Destinations lie in the same subnet with A, and sources lie in another subnet of the same pod. In this case, the link failure will affect the routing tables of all the edge switches in the same pod except for A. When an edge switch, such as 10.1.1.1, learns the link failure, it will add a route entry to its NRT:
          
          
o Destinations lie in the same subnet with A, sources lie in another pod. In this case, the link failure will affect the routing tables of all the edge switches in the other pods. When an edge switch in one other pod, such as 10.3.1.1, learns the link failure, because all the routings that pass through 10.3.0.1 to A will certainly pass through the link between A and B, 10.3.1.1 need add a route entry to its NRT:
     
          
Aggregation to Core Switches

Suppose that the link between an aggregation switch, such as 10.1.0.1 (A), and a core switch, such as 10.0.1.2(B), fails. This link failure may affect 2 types of communications.

o Sources lie in the same pod (pod 1) with A, and destinations lie in the other pods. In this case, the link failure will only affect the routing tables of A. As this link is attached to A directly, A only need to delete the route entries whose next hop is B in its BRT and add no entries to its NRT when A's M6 module detect the link failure.

o Destinations lie in the same pod (pod 1) with A, and sources lie in another pod. In this case, the link failure will affect the routing tables of all the aggregation switches in other pods except for pod 1. When an aggregation switch in one other pod, such as 10.3.0.1, learns the link failure, because all the routings that pass through 10.0.1.2 to the pod 1 where A lies will certainly pass through the link between A and B, 10.3.0.1 need add a route entry to its NRT:<a href="#section-10.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2.1-2">
<pre>
Destination/Mask            Next hop
10.1.2.0/255.255.255.0      10.1.0.1
</pre><a href="#section-10.2.1-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.2.1-3">
<pre>
Destination/Mask            Next hop
10.1.2.0/255.255.255.0      10.3.0.1
</pre><a href="#section-10.2.1-3" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.2.1-4">
<pre>
Destination/Mask            Next hop
10.1.0.0/255.255.0.0        10.0.1.2
</pre><a href="#section-10.2.1-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-10.2.2">
          <h4 id="name-a-group-of-link-failures">
<a href="#section-10.2.2" class="section-number selfRef">10.2.2. </a><a href="#name-a-group-of-link-failures" class="section-name selfRef">A Group of Link Failures</a>
          </h4>
<p id="section-10.2.2-1">
If all the uplinks of an aggregation switch fail, then this switch cannot forward packets, which will affect the routing of every edge switches. Suppose that all the uplinks of the node A (10.1.0.1) fail, it will affect two types of communications.

o Sources lie in the same pod (pod 1) with A, and destinations lie in the other pods. In this case, the link failures will affect the routing of the edge switches in the Pod of A. To avoid the node A, each edge switch should remove the route entry "10.0.0.0/255.0.0.0 10.1.0.1" in which the next hop is the node A.

o Destinations lie in the same pod (pod 1) with A, and sources lie in other pods. In this case, the link failures will affect the routing of edge switches in other pods. For example, if the edge switch 10.3.1.1 communicates with some node in the pod of A, it should avoid the node 10.3.0.1, because any communication through 10.3.0.1 to the pod of A will pass through the node A. So a route entry should be added to 10.3.1.1:<a href="#section-10.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.2.2-2">
<pre>
Destination/Mask            Next hop
10.1.0.0/255.255.0.0        10.3.0.1
</pre><a href="#section-10.2.2-2" class="pilcrow">¶</a>
</div>
</section>
<section id="section-10.2.3">
          <h4 id="name-node-failures">
<a href="#section-10.2.3" class="section-number selfRef">10.2.3. </a><a href="#name-node-failures" class="section-name selfRef">Node Failures</a>
          </h4>
<p id="section-10.2.3-1">
At last, we discuss the effect of node failures to a NRT. There are 3 types of node failures: the failure of edge, aggregation and core switches.

o An edge switch fails. The failure doesn't affect the routing table of any switch.

o A core switch fails. Only when all the core switches connected to the same aggregation switch fail, they will affect the routing of other switches. This case is equal to the case that all the uplinks of an aggregation switch fail, so the process of link failures can cover it.


o An aggregation switch fails. This case is similar to the case that all the uplinks of an aggregation switch fail. It affects the routing of edge switches in other pods, but doesn't affect the routing of edge switches in pod of the failed switch. The process of this failure is same to the second case in section 6.2.2.<a href="#section-10.2.3-1" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-10.3">
        <h3 id="name-routing-procedure">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-routing-procedure" class="section-name selfRef">Routing Procedure</a>
        </h3>
<p id="section-10.3-1">
        FAR decides a routing by looking up its BRT and NRT. We illuminate the routing procedure by an example. In this example, we suppose that the link between 10.3.1.1 and 10.3.0.2 and the link between 10.1.2.1 and 10.1.0.2 have failed. Then we look into the routing procedure of a communication from 10.3.1.3 (source) to 10.1.2.2 (destination).
          
          Step 1: The source 10.3.1.3 sends packets to its default router 10.3.1.1
          
          Step 2: The routing of 10.3.1.1.
          
          1) Calculate candidate hops
          
          10.3.1.1 looks up its BRT and gets the following matched entries:
          
           
          So the candidate hops = {10.3.0.1}
          
          2) Calculate avoiding hops
          
          Its NRT is empty, so the set of avoiding hop is empty too.
          
         3) Calculate applicable hops 
          
            The applicable hops are candidate hops minus avoiding hops, so:
           
               The applicable hops = {10.3.0.1}
           
                  4) Forward packets to 10.3.0.1
           
                   Step 3: The routing of 10.3.0.1  
           
           1) Calculate candidate hops.
           
           10.3. 0.1 looks up its BRT and gets the following matched entries:
           
           
           So the candidate hops = {10.0.1.1, 10.0.1.2}
           
           2) Calculate avoiding hops
           
              
           So the avoiding hops = {10.0.1.2}
           
           3) Calculate applicable hops
           
           The applicable hops are candidate hops minus avoiding hops, so:
           
           The applicable hops = {10.0.1.1}
           
           4) Forward packets to 10.0.1.1
           
           Step 4: 10.0.1.1 forwards packets to 10.1.0.1 by looking up its routing tables.
           
           Step 5: 10.1.0.1 forwards packets to 10.1.2.1 by looking up its routing tables.
           
           Step 6:10.1.2.1 forwards packets to the destination 10.1.2.2 by layer-2 switching.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-10.3-2">
<pre>
Destination/Mask            Next hop
10.0.0.0/255.0.0.0          10.3.0.1
</pre><a href="#section-10.3-2" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.3-3">
<pre>
Destination/Mask           Next hop
10.1.0.0/255.255.0.0       10.0.1.1
10.1.0.0/255.255.0.0       10.0.1.2

</pre><a href="#section-10.3-3" class="pilcrow">¶</a>
</div>
<div class="alignLeft art-text artwork" id="section-10.3-4">
<pre>
Destination/Mask           Next hop
10.1.0.0/255.255.0.0       10.0.1.2

</pre><a href="#section-10.3-4" class="pilcrow">¶</a>
</div>
</section>
<section id="section-10.4">
        <h3 id="name-fars-performance-in-large-s">
<a href="#section-10.4" class="section-number selfRef">10.4. </a><a href="#name-fars-performance-in-large-s" class="section-name selfRef">FAR's Performance in Large-scale Networks</a>
        </h3>
<p id="section-10.4-1">
FAR has good performance to support large-scale networks. In this section, we take a Fat-tree network composed of 2,880 48-port switches and 27,648 servers as an example to show FAR's performance.<a href="#section-10.4-1" class="pilcrow">¶</a></p>
<section id="section-10.4.1">
          <h4 id="name-the-number-of-control-messa">
<a href="#section-10.4.1" class="section-number selfRef">10.4.1. </a><a href="#name-the-number-of-control-messa" class="section-name selfRef">The number of control messages required by FAR</a>
          </h4>
<p id="section-10.4.1-1">
        FAR exchanges a few messages between routers and only consumes a little network bandwidth. Tab. 1 shows the required messages in the example Fat-tree network.
           
        Table 1:Required messages in a Fat-tree network.
           
        _____________________________________________________________________
        
         Message Type|      Scope     | size(bytes)  |      Rate       |   Bandwidth
        
        ---------------------------------------------------------------------
        
            Hello     |adjacent switches|less than 48|10 messages/sec|less than 4 kbps
        
        ---------------------------------------------------------------------
        
            DLR     |adjacent switches| less than 48 | (1)             |48bytes
        
        ---------------------------------------------------------------------
        
            DA      |entire network| less than 48    | (2)             |1.106M
        
        ---------------------------------------------------------------------
        
            LFA      |entire network| less than 48   | (3)             |48 bytes
        
        _____________________________________________________________________
        
        (1)Produce one when a router starts
        
        (2)The number of switches(2,880) in a period
        
        (3)Produce one when a link fails or recovers<a href="#section-10.4.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10.4.2">
          <h4 id="name-the-calculating-time-of-rou">
<a href="#section-10.4.2" class="section-number selfRef">10.4.2. </a><a href="#name-the-calculating-time-of-rou" class="section-name selfRef">The Calculating Time of Routing Tables</a>
          </h4>
<p id="section-10.4.2-1">
 A BRT is calculated according to the states of its neighbor routers and attached links. An NRT is calculated according to device and link failures in the entire network. So FAR does not calculate network topology and has no problem of network convergence, which greatly reduces the calculating time of routing tables. The detection and spread time of link failures is very short in FAR. Detection time is up to the interval of sending Hello message. In FAR, the interval is set to 100ms, and a link failure will be detected in 200ms. The spread time between any pair of routers is less than 200ms.If a link fails in a data center network, FAR can detect it, spread it to all the routers, and calculate routing tables in no more than 500ms.<a href="#section-10.4.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-10.4.3">
          <h4 id="name-the-size-of-routing-tables">
<a href="#section-10.4.3" class="section-number selfRef">10.4.3. </a><a href="#name-the-size-of-routing-tables" class="section-name selfRef">The Size of Routing Tables</a>
          </h4>
<p id="section-10.4.3-1">
For the test Fat-tree network, the sizes of BRTs and NRTs are shown in Tab. 2.
        
Table 2: The size of routing tables in FAR
        
        _____________________________________________________________________
        
         Routing Table|  Core Switch  | Aggregation Switch  |      Edge Switch       |
        
        ---------------------------------------------------------------------
        
                  BRT         |      48      |     48     |     24
        
        ---------------------------------------------------------------------
        
                  NRT         |      0       |     14     |     333
        
        _____________________________________________________________________

        
The BRT's size at a switch is determined by the number of its neighbor switches. In the example network, a core switch has 48 neighbor switches (aggregation switch), so it has 48 entries in its BRT.Only aggregation and edge switches have NRTs. The NRT size at a switch is related to the number of link failures in the network. Suppose that there are 1000 link failures in the example network, the number of failed links is 1.2% of total links, which is a very high failure ratio. We suppose that link failures are uniformly distributed in the entire network. The NRT size at an edge switch is about 333 and the NRT size of an aggregation switch is about 14in average.<a href="#section-10.4.3-1" class="pilcrow">¶</a></p>
</section>
</section>
</section>
<section id="section-11">
      <h2 id="name-implementations-examples">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-implementations-examples" class="section-name selfRef">Implementations Examples</a>
      </h2>
<p id="section-11-1">
      In the FAR draft scenario, Fat-Tree topology has only three layers of routers. To expand the network scale is achieved through horizontal expansion: increase the number of core switches, and increase the number of aggregation switches and edge switches in pod.<a href="#section-11-1" class="pilcrow">¶</a></p>
<p id="section-11-2">
      For example, the following two scenarios.<a href="#section-11-2" class="pilcrow">¶</a></p>
<span id="name-48-pods-each-of-which-has-2"></span><div id="figure9">
<figure id="figure-9">
        <div class="alignCenter art-text artwork" id="section-11-3.1">
<pre>
   10.0.1.1          10.0.2.1            10.0.3.1         10.0.24.1
     +--+              +--+                +--+               +--+
     |  |24devices     |  |24devices       |  |24devices      |  | 24devices
     +--+,_            +--+',              +--+             ,,+--+
     |`,`',`-.,       / | \  `.           .'` -        .-'``.` /|
     |  .  `', `'.,  /  |  '   '       ,-`,'  |`.         .`  ' |
     |   \    `',  `-.,              .`  /    |  `,     .`  ,'  |
     |    `,     `'.   `'-,_      .'`  ,'     |    ',      /    |
     |      .       `'.     `-.,-`    /       |      \
     |       \         `'.,  .` `'., `        |       `.
     |        `,          .'`,     ,`'.,      |         ',
     |          .      ,-`    '., -     `'-,_ |           `.
     |           \   .`         ,'.,         `|.,           .
     |            .'`          /    `-,       |  `'.,        `.
 10.1.0.1      ,-`  .        .'                      `'.,      ',
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
     |  |..|  |      |  |..|  |        |  |..|  |        |  |..|  |A total of 1152 aggregation switches
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      |  \/ |         |  \/ |           |  \/ |           |  \/ |
     +--+/\+--+      +--+/\+--+        +--+/\+--+        +--+/\+--+
     |  |..|  |      |  |..|  |        |  |..|  |        |  |..|  |A total of 1152 access switches
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      /|   10.1.24.1  /|    |\                |\          /|   |  |
     / |    | \      / |    | \        / |    | \        / |   |  |
    /  |    |  \    /  |    |  \      /  |    |  \      /  |   |  |
   /   |    |   \  /   |    |   \    /   |    |   \    /   |   |  |
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++


</pre>
</div>
<figcaption><a href="#figure-9" class="selfRef">Figure 9</a>:
<a href="#name-48-pods-each-of-which-has-2" class="selfRef">48 pods, each of which has 24 aggregation switches and 24 access switches</a>
        </figcaption></figure>
</div>
<p id="section-11-4">
      In the Fat-tree network of Figure 9, there are a total of 48 pods, each of which has 24 aggregation switches and 24 access switches, and each access switch is connected to 24 servers. 576 core switches, 1152 aggregation switches, and 1152 access switches are required, for a total of 2880 switches, which can accommodate 27,648 servers.<a href="#section-11-4" class="pilcrow">¶</a></p>
<span id="name-48-pods-each-pod-has-4-10g-"></span><div id="figure10">
<figure id="figure-10">
        <div class="alignCenter art-text artwork" id="section-11-5.1">
<pre>
                         96 10 gigabit core switches
     +--+              +--+                +--+               +--+
     |  |4devices      |  |4devices        |  |4devices       |  |4devices
     +--+,_            +--+',              +--+             ,,+--+
     |`,`',`-.,       / | \  `.           .'` -        .-'``.` /|
     |  .  `', `'.,  /  |  '   '       ,-`,'  |`.         .`  ' |
     |   \    `',  `-.,              .`  /    |  `,     .`  ,'  |
     |    `,     `'.   `'-,_      .'`  ,'     |    ',      /    |
     |      .       `'.     `-.,-`    /       |      \
     |       \         `'.,  .` `'., `        |       `.
     |        `,          .'`,     ,`'.,      |         ',
     |          .      ,-`    '., -     `'-,_ |           `.
     |           \   .`         ,'.,         `|.,           .
     |            .'`          /    `-,       |  `'.,        `.
 10.1.0.1      ,-`  .        .'                      `'.,      ',
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
     |  |..|  |      |  |..|  |        |  |..|  |        |  |..|  |A total of 192 10 gigabit aggregation switches
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      |  \/ |         |  \/ |           |  \/ |           |  \/ |
     +--+/\+--+      +--+/\+--+        +--+/\+--+        +--+/\+--+
     |  |..|  |      |  |..|  |        |  |..|  |        |  |..|  |A total of 1152 access switches
     +--+  +--+      +--+  +--+        +--+  +--+        +--+  +--+
      /|   10.1.4.1   /|    |\                |\          /|   |  |
     / |    | \      / |    | \        / |    | \        / |   |  |
    /  |    |  \    /  |    |  \      /  |    |  \      /  |   |  |
   /   |    |   \  /   |    |   \    /   |    |   \    /   |   |  |
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++
   ++  ++  ++  ++ ++  ++    ++  ++  ++  ++    ++  ++   ++  ++ ++ ++


</pre>
</div>
<figcaption><a href="#figure-10" class="selfRef">Figure 10</a>:
<a href="#name-48-pods-each-pod-has-4-10g-" class="selfRef">48 pods. Each pod has 4 10G aggregation switches and 24 Gigabit access switches</a>
        </figcaption></figure>
</div>
<p id="section-11-6">
      In the Fat-Tree network of Figure 10, there are a total of 48 pods. Each pod has 4 10G aggregation switches and 24 Gigabit access switches. Each access switch is connected to 40 servers. Requires 96 core switches, 192 aggregation switches, and 1152 access switches, for a total of 1,440 switches, which can accommodate 46,080 servers.<a href="#section-11-6" class="pilcrow">¶</a></p>
</section>
<section id="section-12">
      <h2 id="name-security-considerations">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-12-1">
      The security considerations will be discussed in a future version of this document.<a href="#section-12-1" class="pilcrow">¶</a></p>
</section>
<section id="section-13">
      <h2 id="name-conclusions">
<a href="#section-13" class="section-number selfRef">13. </a><a href="#name-conclusions" class="section-name selfRef">Conclusions</a>
      </h2>
<p id="section-13-1">
       This draft introduces FAR protocol, a generic routing method and protocol, for data centers that have a regular topology. It uses two routing tables, a BRT and an NRT, to store the normal routing paths and the forbidden (to-be-avoided) routing paths, respectively. This makes the FAR protocol very simple and efficient. The sizes of these two tables are very small. Usually, a BRT has only several tens of entries and an NRT has only several or about a dozen entries.<a href="#section-13-1" class="pilcrow">¶</a></p>
</section>
<section id="section-14">
      <h2 id="name-acknowledgments">
<a href="#section-14" class="section-number selfRef">14. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-14-1">
      This document is supported by ZTE Enterprise-University-Research Joint Project.<a href="#section-14-1" class="pilcrow">¶</a></p>
</section>
<section id="section-15">
      <h2 id="name-references">
<a href="#section-15" class="section-number selfRef">15. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-15.1">
        <h3 id="name-normative-references">
<a href="#section-15.1" class="section-number selfRef">15.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<p id="section-15.1-1">
[RFC2119] Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.<a href="#section-15.1-1" class="pilcrow">¶</a></p>
<p id="section-15.1-2">
[RFC2328] J. Moy, "OSPF Version 2", BCP 14, RFC2328, April 1998.<a href="#section-15.1-2" class="pilcrow">¶</a></p>
<p id="section-15.1-3">
[RFC3619] SHAH, S.; YIP, M. RFC3619: Extreme Networks' Ethernet Automatic Protection Switching (EAPS) Version 1. 2003.<a href="#section-15.1-3" class="pilcrow">¶</a></p>
</section>
<section id="section-15.2">
        <h3 id="name-informative-references">
<a href="#section-15.2" class="section-number selfRef">15.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<p id="section-15.2-1">
[FAT-TREE] M. Al-Fares, A. Loukissas, and A. Vahdat."A Scalable,Commodity, Data Center Network Architecture",In ACM SIGCOMM 2008.<a href="#section-15.2-1" class="pilcrow">¶</a></p>
<p id="section-15.2-2">
[BCube] Guo, C., Lu, G., Li, D., Wu, H., Zhang, X., Shi, Y., ...  Lu, S. (2009, August). BCube: a high performance, server-centric network architecture for modular data centers. In Proceedings of the ACM SIGCOMM 2009 conference on Data communication (pp. 63-74).<a href="#section-15.2-2" class="pilcrow">¶</a></p>
<p id="section-15.2-3">
[MatrixDCN] Sun, Y., Chen, M., Peng, L., Hassan, M. M.,  Alelaiwi, A. (2016). MatrixDCN: a high performance network architecture for large-scale cloud data centers. Wireless Communications and Mobile Computing, 16(8), 942-959.<a href="#section-15.2-3" class="pilcrow">¶</a></p>
</section>
</section>
<section id="section-16">
      <h2 id="name-appendix">
<a href="#section-16" class="section-number selfRef">16. </a><a href="#name-appendix" class="section-name selfRef">Appendix</a>
      </h2>
<section id="section-16.1">
        <h3 id="name-application-area-of-the-sol">
<a href="#section-16.1" class="section-number selfRef">16.1. </a><a href="#name-application-area-of-the-sol" class="section-name selfRef">Application Area of the Solution</a>
        </h3>
<p id="section-16.1-1">
According to the horizontal expansion mode of the above scenarios, the whole Fat-Tree network does not need to be expanded to 4 layers (4 order Fat-Tree) even if it is expanded. Using a standard three-tier Fat-tree network, we can scale the network to meet all the problems of commercial network applications. This scheme is suitable for non-SDN distributed Fat-Tree network architecture.<a href="#section-16.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-16.2">
        <h3 id="name-technical-evolution-roadmap">
<a href="#section-16.2" class="section-number selfRef">16.2. </a><a href="#name-technical-evolution-roadmap" class="section-name selfRef">Technical evolution roadmap</a>
        </h3>
<p id="section-16.2-1">
In this draft, we should design different rules for FAR switches in different regular networks to calculate routing tables, which limits FAR's extensibility. Fortunately, the latest SDN technology make it is easy to update the control plane of switches, since all the function of control plane are centralized to a controller in SDN. We are designing the next generation routing scheme for regular networks based on SDN. In the new scheme, we design a regular ToPology Description Language (TPDL) to descript a regular network. In TPDL, the distance between different type of node groups is defined by a group of distance formulas and the number of formulas is finite and fixed without increasing by the scale of a network. And then, switches learn the topology of a network by taking advantage of TPDL and generate flow table entries to forward packets without help of the SDN controller. If no entry is found for a forwarding packet, switches transport the packet to the SDN controller, and the controller recalculates a new routing path using A* algorithm by taking TPDL's distance formulas as a heuristic function and dispatch flow table entries down to related switches on the path.<a href="#section-16.2-1" class="pilcrow">¶</a></p>
</section>
<section id="section-16.3">
        <h3 id="name-updating-roadmap">
<a href="#section-16.3" class="section-number selfRef">16.3. </a><a href="#name-updating-roadmap" class="section-name selfRef">Updating roadmap</a>
        </h3>
<p id="section-16.3-1">    
In the next version, we will continue to advance the remaining issues such as protocol fields, section 3.2 simplification, etc.<a href="#section-16.3-1" class="pilcrow">¶</a></p>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bin Liu</span></div>
<div dir="auto" class="left"><span class="org">ZTE Inc., ZTE Plaza</span></div>
<div dir="auto" class="left"><span class="street-address">No.19 East Huayuan Road,Hai Dian District</span></div>
<div dir="auto" class="left"><span class="locality">Beijing</span></div>
<div dir="auto" class="left"><span class="postal-code">100191</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+86%20-010-59932039" class="tel">+86 -010-59932039</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:13683610386@139.com" class="email">13683610386@139.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yantao Sun</span></div>
<div dir="auto" class="left"><span class="org">Beijing Jiaotong University</span></div>
<div dir="auto" class="left"><span class="street-address">No.3 Shang Yuan Cun, Hai Dian District</span></div>
<div dir="auto" class="left"><span class="locality">Beijing</span></div>
<div dir="auto" class="left"><span class="postal-code">100044</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ytsun@bjtu.edu.cn" class="email">ytsun@bjtu.edu.cn</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jing Cheng</span></div>
<div dir="auto" class="left"><span class="org">Beijing Jiaotong University</span></div>
<div dir="auto" class="left"><span class="street-address">No.3 Shang Yuan Cun, Hai Dian District</span></div>
<div dir="auto" class="left"><span class="locality">Beijing</span></div>
<div dir="auto" class="left"><span class="postal-code">100044</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:yourney.j@gmail.com" class="email">yourney.j@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Yichen Zhang</span></div>
<div dir="auto" class="left"><span class="org">Beijing Jiaotong University</span></div>
<div dir="auto" class="left"><span class="street-address">No.3 Shang Yuan Cun, Hai Dian District</span></div>
<div dir="auto" class="left"><span class="locality">Beijing</span></div>
<div dir="auto" class="left"><span class="postal-code">100044</span></div>
<div dir="auto" class="left"><span class="country-name">China</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:snowfall_dan@sina.com" class="email">snowfall_dan@sina.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Bhumip Khasnabish</span></div>
<div dir="auto" class="left"><span class="org">Individual contributor</span></div>
<div dir="auto" class="left"><span class="street-address">55 Madison Avenue, Suite 160</span></div>
<div dir="auto" class="left">
<span class="locality">Morristown, New Jersey  </span>,  <span class="postal-code">07960</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+001-781-752-8003" class="tel">+001-781-752-8003</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:vumip1@gmail.com" class="email">vumip1@gmail.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="http://tinyurl.com/bhumip/" class="url">http://tinyurl.com/bhumip/</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
