<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>RPL: IPv6 Routing Protocol for Low
    power and Lossy Networks</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="RPL: IPv6 Routing Protocol for Low
    power and Lossy Networks">
<meta name="keywords" content="Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Networking Working Group</td><td class="header">T. Winter, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">P. Thubert, Ed.</td></tr>
<tr><td class="header">Expires: August 7, 2010</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header"> ROLL Design Team</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">IETF ROLL WG</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">February 03, 2010</td></tr>
</table></td></tr></table>
<h1><br />RPL: IPv6 Routing Protocol for Low
    power and Lossy Networks<br />draft-ietf-roll-rpl-06</h1>

<h3>Abstract</h3>

<p>Low power and Lossy Networks (LLNs) are a class of network in which
      both the routers and their interconnect are constrained: LLN routers
      typically operate with constraints on (any subset of) processing power,
      memory and energy (battery), and their interconnects are characterized
      by (any subset of) high loss rates, low data rates and instability. LLNs
      are comprised of anything from a few dozen and up to thousands of LLN
      routers, and support point-to-point traffic (between devices inside the
      LLN), point-to-multipoint traffic (from a central control point to a
      subset of devices inside the LLN) and multipoint-to-point traffic (from
      devices inside the LLN towards a central control point). This document
      specifies the IPv6 Routing Protocol for LLNs (RPL), which provides a
      mechanism whereby multipoint-to-point traffic from devices inside the
      LLN towards a central control point, as well as point-to-multipoint
      traffic from the central control point to the devices inside the LLN, is
      supported. Support for point-to-point traffic is also available.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 7, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Design Principles<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Expectations of Link Layer Type<br />
<a href="#Terminology">2.</a>&nbsp;
Terminology<br />
<a href="#ProtocolModel">3.</a>&nbsp;
Protocol Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#UpwardTopology">3.1.</a>&nbsp;
Topology<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TopologyIdentifiers">3.1.1.</a>&nbsp;
Topology Identifiers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.2.</a>&nbsp;
DODAG Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.2.</a>&nbsp;
Instances, DODAGs, and DODAG Iterations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.3.</a>&nbsp;
Traffic Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">3.3.1.</a>&nbsp;
Multipoint-to-Point Traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">3.3.2.</a>&nbsp;
Point-to-Multipoint Traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.3.3.</a>&nbsp;
Point-to-Point Traffic<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.4.</a>&nbsp;
Upward Routes and DODAG Construction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.4.1.</a>&nbsp;
DAG Information Object (DIO)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.4.2.</a>&nbsp;
DAG Repair<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">3.4.3.</a>&nbsp;
Grounded and Floating DODAGs<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">3.4.4.</a>&nbsp;
Administrative Preference<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">3.4.5.</a>&nbsp;
Objective Function (OF)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">3.4.6.</a>&nbsp;
Distributed Algorithm Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">3.5.</a>&nbsp;
Downward Routes and Destination Advertisement<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">3.5.1.</a>&nbsp;
Destination Advertisement Object (DAO)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ConstrainedLLNs">3.6.</a>&nbsp;
Routing Metrics and Constraints Used By RPL<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">3.6.1.</a>&nbsp;
Loop Avoidance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGRank">3.6.2.</a>&nbsp;
Rank Properties<br />
<a href="#RPLControlMessage">4.</a>&nbsp;
ICMPv6 RPL Control Message<br />
<a href="#UpwardRoutes">5.</a>&nbsp;
Upward Routes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGInformationObject">5.1.</a>&nbsp;
DODAG Information Object (DIO)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DIOBase">5.1.1.</a>&nbsp;
DIO Base Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DIOBaseRules">5.1.2.</a>&nbsp;
DIO Base Rules<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DIOSuboptions">5.1.3.</a>&nbsp;
DIO Suboptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGInformationSolicitation">5.2.</a>&nbsp;
DODAG Information Solicitation (DIS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGDiscovery">5.3.</a>&nbsp;
Upward Route Discovery and Maintenance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#RPLInstance">5.3.1.</a>&nbsp;
RPL Instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#parentset">5.3.2.</a>&nbsp;
Neighbors and Parents within a DODAG Iteration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGDiscoveryRules">5.3.3.</a>&nbsp;
Neighbors and Parents across DODAG Iterations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">5.3.4.</a>&nbsp;
DIO Message Communication<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DIOTransmission">5.3.5.</a>&nbsp;
DIO Transmission<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">5.3.6.</a>&nbsp;
DODAG Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">5.4.</a>&nbsp;
Operation as a Leaf Node<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">5.5.</a>&nbsp;
Administrative Rank<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAGCollision">5.6.</a>&nbsp;
Collision<br />
<a href="#DownwardRoutes">6.</a>&nbsp;
Downward Routes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DestinationAdvertisementObject">6.1.</a>&nbsp;
Destination Advertisement Object (DAO)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAOSuboptions">6.1.1.</a>&nbsp;
DAO Suboptions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DownwardDiscovery">6.2.</a>&nbsp;
Downward Route Discovery and Maintenance<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">6.2.1.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">6.2.2.</a>&nbsp;
Mode of Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">6.2.3.</a>&nbsp;
Destination Advertisement Parents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">6.2.4.</a>&nbsp;
Operation of DAO Storing Nodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DAONonStoring">6.2.5.</a>&nbsp;
Operation of DAO Non-storing Nodes<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ScheduleDAO">6.2.6.</a>&nbsp;
Scheduling to Send DAO (or no-DAO)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor47">6.2.7.</a>&nbsp;
Triggering DAO Message from the Sub-DODAG<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor48">6.2.8.</a>&nbsp;
Sending DAO Messages to DAO Parents<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#MulticastDAO">6.2.9.</a>&nbsp;
Multicast Destination Advertisement Messages<br />
<a href="#forwarding">7.</a>&nbsp;
Packet Forwarding and Loop Avoidance/Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#PacketForwarding">7.1.</a>&nbsp;
Suggestions for Packet Forwarding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#loopdetect">7.2.</a>&nbsp;
Loop Avoidance and Detection<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor49">7.2.1.</a>&nbsp;
Source Node Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor50">7.2.2.</a>&nbsp;
Router Operation<br />
<a href="#anchor57">8.</a>&nbsp;
Multicast Operation<br />
<a href="#MaintenanceRoutingAdjacency">9.</a>&nbsp;
Maintenance of Routing Adjacency<br />
<a href="#anchor58">10.</a>&nbsp;
Guidelines for Objective Functions<br />
<a href="#anchor59">11.</a>&nbsp;
RPL Constants and Variables<br />
<a href="#Manageability">12.</a>&nbsp;
Manageability Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor60">12.1.</a>&nbsp;
Control of Function and Policy<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor61">12.1.1.</a>&nbsp;
Initialization Mode<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor62">12.1.2.</a>&nbsp;
DIO Base option<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor63">12.1.3.</a>&nbsp;
Trickle Timers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor64">12.1.4.</a>&nbsp;
DAG Sequence Number Increment<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor65">12.1.5.</a>&nbsp;
Destination Advertisement Timers<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor66">12.1.6.</a>&nbsp;
Policy Control<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor67">12.1.7.</a>&nbsp;
Data Structures<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor68">12.2.</a>&nbsp;
Information and Data Models<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor69">12.3.</a>&nbsp;
Liveness Detection and Monitoring<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor70">12.3.1.</a>&nbsp;
Candidate Neighbor Data Structure<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor71">12.3.2.</a>&nbsp;
Directed Acyclic Graph (DAG) Table<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor72">12.3.3.</a>&nbsp;
Routing Table<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor73">12.3.4.</a>&nbsp;
Other RPL Monitoring Parameters<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor74">12.3.5.</a>&nbsp;
RPL Trickle Timers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor75">12.4.</a>&nbsp;
Verifying Correct Operation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor76">12.5.</a>&nbsp;
Requirements on Other Protocols and Functional Components<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor77">12.6.</a>&nbsp;
Impact on Network Operation<br />
<a href="#Security">13.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">14.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor78">14.1.</a>&nbsp;
RPL Control Message<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor79">14.2.</a>&nbsp;
New Registry for RPL Control Codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor80">14.3.</a>&nbsp;
New Registry for the Control Field of the DIO Base<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor81">14.4.</a>&nbsp;
DAG Information Object (DIO) Suboption<br />
<a href="#Acknowledgements">15.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor82">16.</a>&nbsp;
Contributors<br />
<a href="#rfc.references1">17.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">17.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">17.2.</a>&nbsp;
Informative References<br />
<a href="#Requirements">Appendix&nbsp;A.</a>&nbsp;
Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor85">A.1.</a>&nbsp;
Protocol Properties Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor86">A.1.1.</a>&nbsp;
IPv6 Architecture<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor87">A.1.2.</a>&nbsp;
Typical LLN Traffic Patterns<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor88">A.1.3.</a>&nbsp;
Constraint Based Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor89">A.2.</a>&nbsp;
Deferred Requirements<br />
<a href="#Examples">Appendix&nbsp;B.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DestinationAdvertisementExample">B.1.</a>&nbsp;
Destination Advertisement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ExDAGParentSelection">B.2.</a>&nbsp;
Example: DODAG Parent Selection<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ExDAGMaintenance">B.3.</a>&nbsp;
Example: DODAG Maintenance<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ExGreedyExample">B.4.</a>&nbsp;
Example: Greedy Parent Selection and Instability<br />
<a href="#TODO">Appendix&nbsp;C.</a>&nbsp;
Outstanding Issues<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor90">C.1.</a>&nbsp;
Additional Support for P2P Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor91">C.2.</a>&nbsp;
Destination Advertisement / DAO Fan-out<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor92">C.3.</a>&nbsp;
Source Routing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor93">C.4.</a>&nbsp;
Address / Header Compression<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor94">C.5.</a>&nbsp;
Managing Multiple Instances<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>Low power and Lossy Networks (LLNs) consist of largely of constrained
      nodes (with limited processing power, memory, and sometimes energy when
      they are battery operated). These routers are interconnected by lossy
      links, typically supporting only low data rates, that are usually
      unstable with relatively low packet delivery rates. Another
      characteristic of such networks is that the traffic patterns are not
      simply unicast, but in many cases point-to-multipoint or
      multipoint-to-point. Furthermore such networks may potentially comprise
      up to thousands of nodes. These characteristics offer unique challenges
      to a routing solution: the IETF ROLL Working Group has defined
      application-specific routing requirements for a Low power and Lossy
      Network (LLN) routing protocol, specified in <a class='info' href='#I-D.ietf-roll-building-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;building&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Martocci, J., Riou, N., Mil, P., and W. Vermeylen, &ldquo;Building Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-roll-home-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;home&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Brandt, A. and J. Buron, &ldquo;Home Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#RFC5673'>[RFC5673]<span> (</span><span class='info'>Pister, K., Thubert, P., Dwars, S., and T. Phinney, &ldquo;Industrial Routing Requirements in Low-Power and Lossy Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, and <a class='info' href='#RFC5548'>[RFC5548]<span> (</span><span class='info'>Dohler, M., Watteyne, T., Winter, T., and D. Barthel, &ldquo;Routing Requirements for Urban Low-Power and Lossy Networks,&rdquo; May&nbsp;2009.</span><span>)</span></a>. This
      document specifies the IPv6 Routing Protocol for Low power and lossy
      networks (RPL).
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Design Principles</h3>

<p>RPL was designed with the objective to meet the requirements
        spelled out in <a class='info' href='#I-D.ietf-roll-building-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;building&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Martocci, J., Riou, N., Mil, P., and W. Vermeylen, &ldquo;Building Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-roll-home-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;home&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Brandt, A. and J. Buron, &ldquo;Home Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#RFC5673'>[RFC5673]<span> (</span><span class='info'>Pister, K., Thubert, P., Dwars, S., and T. Phinney, &ldquo;Industrial Routing Requirements in Low-Power and Lossy Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, and <a class='info' href='#RFC5548'>[RFC5548]<span> (</span><span class='info'>Dohler, M., Watteyne, T., Winter, T., and D. Barthel, &ldquo;Routing Requirements for Urban Low-Power and Lossy Networks,&rdquo; May&nbsp;2009.</span><span>)</span></a>. Because
        those requirements are heterogeneous and sometimes incompatible in
        nature, the approach is first taken to design a protocol capable of
        supporting a core set of functionalities corresponding to the
        intersection of the requirements. As the RPL design evolves optional
        features may be added to address some application specific
        requirements. This is a key protocol design decision providing a
        granular approach in order to restrict the core of the protocol to a
        minimal set of functionalities, and to allow each implementation of
        the protocol to be optimized differently. All "MUST" application
        requirements that cannot be satisfied by RPL will be specifically
        listed in the Appendix A, accompanied by a justification.
</p>
<p>A network may run multiple instances of RPL concurrently. Each such
        instance may serve different and potentially antagonistic constraints
        or performance criteria. This document defines how a single instance
        operates.
</p>
<p>RPL is a generic protocol that is to be deployed by instantiating
        the generic operation described in this document with a specific
        objective function (OF) (which ties together metrics, constraints, and
        an optimization objective) to realize a desired objective in a given
        environment.
</p>
<p>A set of companion documents to this specification will provide
        further guidance in the form of applicability statements specifying a
        set of operating points appropriate to the Building Automation, Home
        Automation, Industrial, and Urban application scenarios.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Expectations of Link Layer Type</h3>

<p>RPL does not rely on any particular features of a specific link
        layer technology. RPL is designed to be able to operate over a variety
        of different link layers, including but not limited to, low power
        wireless or PLC (Power Line Communication) technologies.
</p>
<p>Implementers may find <a class='info' href='#RFC3819'>RFC 3819<span> (</span><span class='info'>Karn, P., Bormann, C., Fairhurst, G., Grossman, D., Ludwig, R., Mahdavi, J., Montenegro, G., Touch, J., and L. Wood, &ldquo;Advice for Internet Subnetwork Designers,&rdquo; July&nbsp;2004.</span><span>)</span></a> [RFC3819] a
        useful reference when designing a link layer interface between RPL and
        a particular link layer technology.
</p>
<a name="Terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>Additionally, this document uses terminology from <a class='info' href='#I-D.ietf-roll-terminology'>[I&#8209;D.ietf&#8209;roll&#8209;terminology]<span> (</span><span class='info'>Vasseur, J., &ldquo;Terminology in Low power And Lossy Networks,&rdquo; March&nbsp;2010.</span><span>)</span></a>, and introduces the following
      terminology: </p>
<blockquote class="text"><dl>
<dt>DAG:</dt>
<dd>Directed Acyclic Graph. A directed graph having
          the property that all edges are oriented in such a way that no
          cycles exist. All edges are contained in paths oriented toward and
          terminating at one or more root nodes.
</dd>
<dt>DAG root:</dt>
<dd>A DAG root is a node within the DAG that has
          no outgoing edges. Because the graph is acyclic, by definition all
          DAGs must have at least one DAG root and all paths terminate at a
          DAG root.
</dd>
<dt>Destination Oriented DAG (DODAG):</dt>
<dd>A DAG rooted at a
          single destination, i.e. at a single DAG root (the DODAG root) with
          no outgoing edges.
</dd>
<dt>DODAG root:</dt>
<dd>A DODAG root is the DAG root of a
          DODAG.
</dd>
<dt>Rank:</dt>
<dd>The rank of a node in a DAG identifies the nodes
          position with respect to a DODAG root. The farther away a node is
          from a DODAG root, the higher is the rank of that node. The rank of
          a node may be a simple topological distance, or may more commonly be
          calculated as a function of other properties as described later.
</dd>
<dt>DODAG parent:</dt>
<dd>A parent of a node within a DODAG is one
          of the immediate successors of the node on a path towards the DODAG
          root. The DODAG parent of a node will have a lower rank than the
          node itself. (See <a class='info' href='#RankComparison'>Section&nbsp;3.6.2.1<span> (</span><span class='info'>Rank Comparison</span><span>)</span></a>).
</dd>
<dt>DODAG sibling:</dt>
<dd>A sibling of a node within a DODAG is
          defined in this specification to be any neighboring node which is
          located at the same rank within a DODAG. Note that siblings defined
          in this manner do not necessarily share a common DODAG parent. (See
          <a class='info' href='#RankComparison'>Section&nbsp;3.6.2.1<span> (</span><span class='info'>Rank Comparison</span><span>)</span></a>).
</dd>
<dt>Sub-DODAG</dt>
<dd>The sub-DODAG of a node is the set of other
          nodes in the DODAG that might use a path towards the DODAG root that
          contains that node. Nodes in the sub-DODAG of a node have a greater
          rank than that node itself (although not all nodes of greater rank
          are necessarily in the sub-DODAG of that node). (See <a class='info' href='#RankComparison'>Section&nbsp;3.6.2.1<span> (</span><span class='info'>Rank Comparison</span><span>)</span></a>).
</dd>
<dt>DODAGID:</dt>
<dd>The identifier of a DODAG root. The DODAGID
          must be unique within the scope of a RPL Instance in the LLN.
</dd>
<dt>DODAG Iteration:</dt>
<dd>A specific sequence number iteration
          ("version") of a DODAG with a given DODAGID.
</dd>
<dt>RPL Instance:</dt>
<dd>A set of possibly multiple DODAGs. A
          network may have more than one RPL Instance, and a RPL node can
          participate in multiple RPL Instances. Each RPL Instance operates
          independently of other RPL Instances. This document describes
          operation within a single RPL Instance. In RPL, a node can belong to
          at most one DODAG per RPL Instance. The tuple (RPLInstanceID,
          DODAGID) uniquely identifies a DODAG.
</dd>
<dt>RPLInstanceID:</dt>
<dd>Unique identifier of a RPL
          Instance.
</dd>
<dt>DODAGSequenceNumber:</dt>
<dd>A sequential counter that is
          incremented by the root to form a new Iteration of a DODAG. A DODAG
          Iteration is identified uniquely by the (RPLInstanceID, DODAGID,
          DODAGSequenceNumber) tuple.
</dd>
<dt>Up:</dt>
<dd>Up refers to the direction from leaf nodes towards
          DODAG roots, following the orientation of the edges within the
          DODAG.
</dd>
<dt>Down:</dt>
<dd>Down refers to the direction from DODAG roots
          towards leaf nodes, going against the orientation of the edges
          within the DODAG.
</dd>
<dt>Objective Code Point (OCP):</dt>
<dd>An identifier, used to
          indicate which Objective Function is in use for forming a DODAG. The
          Objective Code Point is further described in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>.
</dd>
<dt>Objective Function (OF):</dt>
<dd>Defines which routing
          metrics, optimization objectives, and related functions are in use
          in a DODAG. The Objective Function is further described in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>.
</dd>
<dt>Goal:</dt>
<dd>The Goal is a host or set of hosts that satisfy
          a particular application objective / OF. Whether or not a DODAG can
          provide connectivity to a goal is a property of the DODAG. For
          example, a goal might be a host serving as a data collection point,
          or a gateway providing connectivity to an external
          infrastructure.
</dd>
<dt>Grounded:</dt>
<dd>A DODAG is said to be grounded, when the
          root can reach the Goal of the objective function.
</dd>
<dt>Floating:</dt>
<dd>A DODAG is floating if is not Grounded. A
          floating DODAG is not expected to reach the Goal defined for the
          OF.
</dd>
</dl></blockquote>

<p>As they form networks, LLN devices often mix the roles of 'host' and
      'router' when compared to traditional IP networks. In this document,
      'host' refers to an LLN device that can generate but does not forward
      RPL traffic, 'router' refers to an LLN device that can forward as well
      as generate RPL traffic, and 'node' refers to any RPL device, either a
      host or a router.
</p>
<a name="ProtocolModel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol Overview</h3>

<p>The aim of this section is to describe RPL in the spirit of <a class='info' href='#RFC4101'>[RFC4101]<span> (</span><span class='info'>Rescorla, E. and IAB, &ldquo;Writing Protocol Models,&rdquo; June&nbsp;2005.</span><span>)</span></a>. Protocol details can be found in further
      sections.
</p>
<a name="UpwardTopology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Topology</h3>

<p>This section describes how the basic RPL topologies, and the rules
        by which these are constructed, i.e. the rules governing DODAG
        formation.
</p>
<a name="TopologyIdentifiers"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Topology Identifiers</h3>

<p>RPL uses four identifiers to track and control the topology:
          </p>
<ul class="text">
<li>The first is a RPLInstanceID. A RPLInstanceID identifies a
              set of one or more DODAGs. All DODAGs in the same RPL Instance
              use the same OF. A network may have multiple RPLInstanceIDs,
              each of which defines an independent set of DODAGs, which may be
              optimized for different OFs and/or applications. The set of
              DODAGs identified by a RPLInstanceID is called a RPL
              Instance.
</li>
<li>The second is a DODAGID. The scope of a DODAGID is a RPL
              Instance. The combination of RPLInstanceID and DODAGID uniquely
              identifies a single DODAG in the network. A RPL Instance may
              have multiple DODAGs, each of which has an unique DODAGID.
</li>
<li>The third is a DODAGSequenceNumber. The scope of a
              DODAGSequenceNumber is a DODAG. A DODAG is sometimes
              reconstructed from the DODAG root, by incrementing the
              DODAGSequenceNumber. The combination of RPLInstanceID, DODAGID,
              and DODAGSequenceNumber uniquely identifies a DODAG
              Iteration.
</li>
<li>The fourth is rank. The scope of rank is a DODAG Iteration.
              Rank establishes a partial order over a DODAG Iteration,
              defining individual node positions with respect to the DODAG
              root.
</li>
</ul>

<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
DODAG Information</h3>

<p>For each DODAG that a node is, or may become, a member of, the
          implementation should conceptually keep track of the following
          information for each DODAG. The data structures described in this
          section are intended to illustrate a possible implementation to aid
          in the description of the protocol, but are not intended to be
          normative.
</p>
<p></p>
<ul class="text">
<li>RPLInstanceID
</li>
<li>DODAGID
</li>
<li>DODAGSequenceNumber
</li>
<li>DAG Metric Container, including DAGObjectiveCodePoint
</li>
<li>A set of Destination Prefixes offered by the DODAG root and
              available via paths upwards along the DODAG
</li>
<li>A set of DODAG parents
</li>
<li>A set of DODAG siblings
</li>
<li>A timer to govern the sending of DIO messages
</li>
</ul>

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Instances, DODAGs, and DODAG Iterations</h3>

<p>Each RPL Instance constructs a routing topology optimized for a
        certain Objective Function (OF). A RPL Instance may provide routes to
        certain destination prefixes, reachable via the DODAG roots. A single
        RPL Instance contains one or more Destination Oriented DAG (DODAG)
        roots. These roots may operate independently, or may coordinate over a
        non-LLN backchannel.
</p>
<p>Each root has a unique identifier, the DODAGID.
</p>
<p>A RPL Instance may comprise:
</p>
<p></p>
<ul class="text">
<li>a single DODAG with a single root 
<ul class="text">
<li>For example, a DODAG optimized to minimize latency rooted
                at a single centralized lighting controller in a home
                automation application.
</li>
</ul>
</li>
<li>multiple uncoordinated DODAGs with independent roots (differing
            DODAGIDs) 
<ul class="text">
<li>For example, multiple data collection points in an urban
                data collection application that do not have an always-on
                backbone suitable to coordinate to form a single DODAG, and
                further use the formation of multiple DODAGs as a means to
                dynamically and autonomously partition the network.
</li>
</ul>
</li>
<li>a single DODAG with a single virtual root coordinating LLN
            sinks (with the same DODAGID) over some non-LLN backbone
<ul class="text">
<li>For example, multiple border routers operating with a
                reliable backbone, e.g. in support of a 6LowPAN application,
                that are capable to act as logically equivalent sinks to the
                same DODAG.
</li>
</ul>
</li>
<li>a combination of one of the above as suited to some application
            scenario.
</li>
</ul>

<p>Traffic is bound to a specific RPL Instance by a marking in the
        flow label of the IPv6 header. Traffic originating in support of a
        particular application may be tagged to follow an appropriate RPL
        instance which enables certain (path) properties, for example to
        follow paths optimized for low latency or low energy. The provisioning
        or automated discovery of a mapping between a RPLInstanceID and a type
        or service of application traffic is beyond the scope of this
        specification.
</p>
<p>An example of a RPL Instance comprising a number of DODAGs is
        depicted in <a class='info' href='#figInstance'>Figure&nbsp;1<span> (</span><span class='info'>RPL Instance</span><span>)</span></a>. A DODAG Iteration (two
        "versions" of the same DODAG) is depicted in <a class='info' href='#figDODAGIteration'>Figure&nbsp;2<span> (</span><span class='info'>DODAG Iteration</span><span>)</span></a>.
</p><br /><hr class="insert" />
<a name="figInstance"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

  +----------------------------------------------------------------+
  |                                                                |
  | +--------------+                                               |
  | |              |                                               |
  | |     (R1)     |            (R2)                   (Rn)        |
  | |     /  \     |            /| \                  / |  \       |
  | |    /    \    |           / |  \                /  |   \      |
  | |  (A)    (B)  |         (C) |  (D)     ...    (F) (G)  (H)    |
  | |  /|\     |\  |         /   |   |\             |   |    |     |
  | | : : :    : : |        :   (E)  : :            :   :    :     |
  | |              |            / \                                |
  | +--------------+           :   :                               |
  |      DODAG                                                     |
  |                                                                |
  +----------------------------------------------------------------+
                             RPL Instance
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: RPL Instance&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="figDODAGIteration"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

         +----------------+                +----------------+
         |                |                |                |
         |      (R1)      |                |      (R1)      |
         |      /  \      |                |      /         |
         |     /    \     |                |     /          |
         |   (A)    (B)   |         \      |   (A)          |
         |   /|\     |\   |    ------\     |   /|\          |
         |  : : (C)  : :  |           \    |  : : (C)       |
         |                |           /    |        \       |
         |                |    ------/     |         \      |
         |                |         /      |         (B)    |
         |                |                |          |\    |
         |                |                |          : :   |
         |                |                |                |
         +----------------+                +----------------+
             Sequence N                       Sequence N+1

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: DODAG Iteration&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Traffic Flows</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.1"></a><h3>3.3.1.&nbsp;
Multipoint-to-Point Traffic</h3>

<p>Multipoint-to-Point (MP2P) is a dominant traffic flow in many LLN
          applications (<a class='info' href='#I-D.ietf-roll-building-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;building&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Martocci, J., Riou, N., Mil, P., and W. Vermeylen, &ldquo;Building Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-roll-home-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;home&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Brandt, A. and J. Buron, &ldquo;Home Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#RFC5673'>[RFC5673]<span> (</span><span class='info'>Pister, K., Thubert, P., Dwars, S., and T. Phinney, &ldquo;Industrial Routing Requirements in Low-Power and Lossy Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, <a class='info' href='#RFC5548'>[RFC5548]<span> (</span><span class='info'>Dohler, M., Watteyne, T., Winter, T., and D. Barthel, &ldquo;Routing Requirements for Urban Low-Power and Lossy Networks,&rdquo; May&nbsp;2009.</span><span>)</span></a>). The
          destinations of MP2P flows are designated nodes that have some
          application significance, such as providing connectivity to the
          larger Internet or core private IP network. RPL supports MP2P
          traffic by allowing MP2P destinations to be reached via DODAG
          roots.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.2"></a><h3>3.3.2.&nbsp;
Point-to-Multipoint Traffic</h3>

<p>Point-to-multipoint (P2MP) is a traffic pattern required by
          several LLN applications (<a class='info' href='#I-D.ietf-roll-building-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;building&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Martocci, J., Riou, N., Mil, P., and W. Vermeylen, &ldquo;Building Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-roll-home-routing-reqs'>[I&#8209;D.ietf&#8209;roll&#8209;home&#8209;routing&#8209;reqs]<span> (</span><span class='info'>Brandt, A. and J. Buron, &ldquo;Home Automation Routing Requirements in Low Power and Lossy Networks,&rdquo; January&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#RFC5673'>[RFC5673]<span> (</span><span class='info'>Pister, K., Thubert, P., Dwars, S., and T. Phinney, &ldquo;Industrial Routing Requirements in Low-Power and Lossy Networks,&rdquo; October&nbsp;2009.</span><span>)</span></a>, <a class='info' href='#RFC5548'>[RFC5548]<span> (</span><span class='info'>Dohler, M., Watteyne, T., Winter, T., and D. Barthel, &ldquo;Routing Requirements for Urban Low-Power and Lossy Networks,&rdquo; May&nbsp;2009.</span><span>)</span></a>). RPL
          supports P2MP traffic by using a destination advertisement mechanism
          that provisions routes toward destination prefixes and away from
          roots. Destination advertisements can update routing tables as the
          underlying DODAG topology changes.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3.3"></a><h3>3.3.3.&nbsp;
Point-to-Point Traffic</h3>

<p>RPL DODAGs provide a basic structure for point-to-point (P2P)
          traffic. For a RPL network to support P2P traffic, a root must be
          able to route packets to a destination. Nodes within the network may
          also have routing tables to destinations. A packet flows towards a
          root until it reaches an ancestor that has a known route to the
          destination.
</p>
<p>RPL also supports the case where a P2P destination is a 'one-hop'
          neighbor.
</p>
<p>RPL neither specifies nor precludes additional mechanisms for
          computing and installing more optimal routes to support arbitrary
          P2P traffic.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Upward Routes and DODAG Construction</h3>

<p>RPL provisions routes up towards DODAG roots, forming a DODAG
        optimized according to the Objective Function (OF) in use. RPL nodes
        construct and maintain these DODAGs through exchange of DODAG
        Information Object (DIO) messages. Undirected links between siblings
        are also identified during this process, which can be used to provide
        additional diversity.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.1"></a><h3>3.4.1.&nbsp;
DAG Information Object (DIO)</h3>

<p>A DIO identifies the RPL Instance, the DODAGID, the values used
          to compute the RPL Instance's objective function, and the present
          DODAG Sequence Number. It can also include additional routing and
          configuration information. The DIO includes a measure derived from
          the position of the node within the DODAG, the rank, which is used
          for nodes to determine their positions relative to each other and to
          inform loop avoidance/detection procedures. RPL exchanges DIO
          messages to establish and maintain routes.
</p>
<p>RPL adapts the rate at which nodes send DIO messages. When a
          DODAG is detected to be inconsistent or needs repair, RPL sends DIO
          messages more frequently. As the DODAG stabilizes, the DIO message
          rate tapers off, reducing the maintenance cost of a steady and
          well-working DODAG.
</p>
<p>This document defines an ICMPv6 Message Type "RPL Control
          Message", which is capable of carrying a DIO.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.2"></a><h3>3.4.2.&nbsp;
DAG Repair</h3>

<p>RPL supports global repair over the DODAG. A DODAG Root may
          increment the DODAG Sequence Number, thereby initiating a new DODAG
          iteration. This institutes a global repair operation, revising the
          DODAG and allowing nodes to choose an arbitrary new position within
          the new DODAG iteration.
</p>
<p>RPL supports mechanisms which may be used for local repair within
          the DODAG iteration. The DIO message specifies the necessary
          parameters as configured from the DODAG root. Local repair options
          include the allowing a node, upon detecting a loss of connectivity
          to a DODAG it is a member of, to:
</p>
<p></p>
<ul class="text">
<li>Poison its sub-DODAG by advertising an effective rank of
              INFINITY to its sub-DODAG, OR detach and form a floating DODAG
              in order to preserve inner connectivity within its
              sub-DODAG.
</li>
<li>Move down within the DODAG iteration (i.e. increase its rank)
              in a limited manner, no further than a bound configured by the
              DODAG root via the DIO so as not to count all the way to
              infinity. Such a move may be undertaken after waiting an
              appropriate poisoning interval, and should allow the node to
              restore connectivity to the DODAG Iteration, if at all
              possible.
</li>
</ul>

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.3"></a><h3>3.4.3.&nbsp;
Grounded and Floating DODAGs</h3>

<p>DODAGs can be grounded or floating. A grounded DODAG offers
          connectivity to to a goal. A floating DODAG offers no such
          connectivity, and provides routes only to nodes within the DODAG.
          Floating DODAGs may be used, for example, to preserve inner
          connectivity during repair.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.4"></a><h3>3.4.4.&nbsp;
Administrative Preference</h3>

<p>An implementation/deployment may specify that some DODAG roots
          should be used over others through an administrative preference.
          Administrative preference offers a way to control traffic and
          engineer DODAG formation in order to better support application
          requirements or needs.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.5"></a><h3>3.4.5.&nbsp;
Objective Function (OF)</h3>

<p>The Objective Function (OF) implements the optimization
          objectives of route selection within the RPL Instance. The OF is
          identified by an Objective Code Point (OCP) within the DIO, and its
          specification also indicates the metrics and constraints in use. The
          OF also specifies the procedure used to compute rank within a DODAG
          iteration. Further details may be found in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>, <a class='info' href='#I-D.ietf-roll-of0'>[I&#8209;D.ietf&#8209;roll&#8209;of0]<span> (</span><span class='info'>Thubert, P., &ldquo;RPL Objective Function 0,&rdquo; February&nbsp;2010.</span><span>)</span></a>, and related companion
          specifications.
</p>
<p>By using defined OFs that are understood by all nodes in a
          particular deployment, and by referencing these in the DIO message,
          RPL nodes may work to build optimized LLN routes using a variety of
          application and implementation specific metrics and goals.
</p>
<p>In the case where a node is unable to encounter a suitable RPL
          Instance using a known Objective Function, it may be configured to
          join a RPL Instance using an unknown Objective Function - but in
          that case only acting as a leaf node.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4.6"></a><h3>3.4.6.&nbsp;
Distributed Algorithm Operation</h3>

<p>A high level overview of the distributed algorithm which
          constructs the DODAG is as follows:
</p>
<p></p>
<ul class="text">
<li>Some nodes are configured to be DODAG roots, with associated
              DODAG configuration.
</li>
<li>Nodes advertise their presence, affiliation with a DODAG,
              routing cost, and related metrics by sending link-local
              multicast DIO messages.
</li>
<li>Nodes may adjust the rate at which DIO messages are sent in
              response to stability or detection of routing
              inconsistencies.
</li>
<li>Nodes listen for DIOs and use their information to join a new
              DODAG, or to maintain an existing DODAG, as according to the
              specified Objective Function and rank-based loop avoidance
              rules.
</li>
<li>Nodes provision routing table entries, for the destinations
              specified by the DIO, via their DODAG parents in the DODAG
              iteration. Nodes may provision a DODAG parent as a default
              gateway.
</li>
<li>Nodes may identify DODAG siblings within the DODAG iteration
              to increase path diversity.
</li>
<li>Using DIOs, and possibly information in data packets, RPL
              nodes detect possible routing loops. When a RPL node detects a
              possible routing loop, it may adapt its DIO transmission rate to
              apply a local repair to the topology.
</li>
</ul>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5"></a><h3>3.5.&nbsp;
Downward Routes and Destination Advertisement</h3>

<p>RPL constructs and maintains DODAGs with DIO messages to establish
        upward routes: it uses Destination Advertisement Object (DAO) messages
        to establish downward routes along the DODAG as well as other routes.
        DAO messages are an optional feature for applications that require
        P2MP or P2P traffic. DIO messages advertise whether destination
        advertisements are enabled within a given DODAG.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1"></a><h3>3.5.1.&nbsp;
Destination Advertisement Object (DAO)</h3>

<p>A Destination Advertisement Object (DAO) conveys destination
          information upwards along the DODAG so that a DODAG root (an other
          intermediate nodes) can provision downward routes. A DAO message
          includes prefix information to identify destinations, a capability
          to record routes in support of source routing, and information to
          determine the freshness of a particular advertisement.
</p>
<p>Nodes that are capable of maintaining routing state may aggregate
          routes from DAO messages that they receive before transmitting a DAO
          message. Nodes that are not capable of maintaining routing state may
          attach a next-hop address to the Reverse Route Stack contained
          within the DAO message. The Reverse Route Stack is subsequently used
          to generate piecewise source routes over regions of the LLN that are
          incapable of storing downward routing state.
</p>
<p>A special case of the DAO message, termed a no-DAO, is used to
          clear downward routing state that has been provisioned through DAO
          operation.
</p>
<p>This document defines an ICMPv6 Message Type "RPL Control
          Message", which is capable of carrying a DAO.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.5.1.1"></a><h3>3.5.1.1.&nbsp;
'One-Hop' Neighbors</h3>

<p>In addition to sending DAOs toward DODAG roots, RPL nodes may
            occasionally emit a link-local multicast DAO message advertising
            available destination prefixes. This mechanism allow provisioning
            a trivial 'one-hop' route to local neighbors.
</p>
<a name="ConstrainedLLNs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6"></a><h3>3.6.&nbsp;
Routing Metrics and Constraints Used By RPL</h3>

<p>Routing metrics are used by routing protocols to compute shortest
        paths. Interior Gateway Protocols (IGPs) such as IS-IS (<a class='info' href='#RFC5120'>[RFC5120]<span> (</span><span class='info'>Przygienda, T., Shen, N., and N. Sheth, &ldquo;M-ISIS: Multi Topology (MT) Routing in Intermediate System to Intermediate Systems (IS-ISs),&rdquo; February&nbsp;2008.</span><span>)</span></a>) and OSPF (<a class='info' href='#RFC4915'>[RFC4915]<span> (</span><span class='info'>Psenak, P., Mirtorabi, S., Roy, A., Nguyen, L., and P. Pillay-Esnault, &ldquo;Multi-Topology (MT) Routing in OSPF,&rdquo; June&nbsp;2007.</span><span>)</span></a>)
        use static link metrics. Such link metrics can simply reflect the
        bandwidth or can also be computed according to a polynomial function
        of several metrics defining different link characteristics; in all
        cases they are static metrics. Some routing protocols support more
        than one metric: in the vast majority of the cases, one metric is used
        per (sub)topology. Less often, a second metric may be used as a
        tie-breaker in the presence of Equal Cost Multiple Paths (ECMP). The
        optimization of multiple metrics is known as an NP complete problem
        and is sometimes supported by some centralized path computation
        engine.
</p>
<p>In contrast, LLNs do require the support of both static and dynamic
        metrics. Furthermore, both link and node metrics are required. In the
        case of RPL, it is virtually impossible to define one metric, or even
        a composite metric, that will satisfy all use cases.
</p>
<p>In addition, RPL supports constrained-based routing where
        constraints may be applied to both link and nodes. If a link or a node
        does not satisfy a required constraint, it is 'pruned' from the
        candidate list, thus leading to a constrained shortest path.
</p>
<p>The set of supported link/node constraints and metrics is specified
        in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>.
</p>
<p>The role of the Objective Function is to specify which routing
        metrics and constraints are in use, and how these are used, in
        addition to the objectives used to compute the (constrained) shortest
        path.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>Example 1:</dt>
<dd>Shortest path: path offering the shortest
            end-to-end delay
</dd>
<dt>Example 2:</dt>
<dd>Constrained shortest path: the path that
            does not traverse any battery-operated node and that optimizes the
            path reliability
</dd>
</dl></blockquote>

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1"></a><h3>3.6.1.&nbsp;
Loop Avoidance</h3>

<p>RPL guarantees neither loop free path selection nor strong global
          convergence. In order to reduce control overhead, however, such as
          the cost of the count-to-infinity problem, RPL avoids creating loops
          when undergoing topology changes. Furthermore, RPL includes
          rank-based mechanisms for detecting loops when they do occur. RPL
          uses this loop detection to ensure that packets make forward
          progress within the DODAG iteration and trigger repairs when
          necessary.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1.1"></a><h3>3.6.1.1.&nbsp;
Greediness and Rank-based Instabilities</h3>

<p>Once a node has joined a DODAG iteration, RPL disallows certain
            behaviors, including greediness, in order to prevent resulting
            instabilities in the DODAG iteration.
</p>
<p>If a node is allowed to be greedy and attempts to move deeper
            in the DODAG iteration, beyond its most preferred parent, in order
            to increase the size of the parent set, then an instability can
            result. This is illustrated in <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>.
</p>
<p>Suppose a node is willing to receive and process a DIO messages
            from a node in its own sub-DODAG, and in general a node deeper
            than itself. In this case, a possibility exists that a feedback
            loop is created, wherein two or more nodes continue to try and
            move in the DODAG iteration while attempting to optimize against
            each other. In some cases, this will result in instability. It is
            for this reason that RPL limits the cases where a node may process
            DIO messages from deeper nodes to some forms of local repair. This
            approach creates an 'event horizon', whereby a node cannot be
            influenced beyond some limit into an instability by the action of
            nodes that may be in its own sub-DODAG.
</p>
<p>A further example of the consequences of greedy operation, and
            instability related to processing DIO messages from nodes of
            greater rank, may be found in <a class='info' href='#ExGreedyExample'>Appendix&nbsp;B.4<span> (</span><span class='info'>Example: Greedy Parent Selection and Instability</span><span>)</span></a>
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1.2"></a><h3>3.6.1.2.&nbsp;
DODAG Loops</h3>

<p>A DODAG loop may occur when a node detaches from the DODAG and
            reattaches to a device in its prior sub-DODAG. This may happen in
            particular when DIO messages are missed. Strict use of the DAG
            sequence number can eliminate this type of loop, but this type of
            loop may possibly be encountered when using some local repair
            mechanisms.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1.3"></a><h3>3.6.1.3.&nbsp;
DAO Loops</h3>

<p>A DAO loop may occur when the parent has a route installed upon
            receiving and processing a DAO message from a child, but the child
            has subsequently cleaned up the state. This loop happens when a
            no-DAO was missed and persists until all state has been cleaned
            up. RPL includes loop detection mechanisms that may mitigate the
            impact of DAO loops and trigger their repair.
</p>
<p>In the case where stateless DAO operation is used, i.e. source
            routing specifies the down routes, then DAO Loops should not occur
            on the stateless portions of the path.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.1.4"></a><h3>3.6.1.4.&nbsp;
Sibling Loops</h3>

<p>Sibling loops could occur if a group of siblings kept choosing
            amongst themselves as successors such that a packet does not make
            forward progress. This specification limits the number of times
            that sibling forwarding may be used at a given rank, in order to
            prevent sibling loops.
</p>
<a name="DAGRank"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.2"></a><h3>3.6.2.&nbsp;
Rank Properties</h3>

<p>The rank of a node is a scalar representation of the location of
          that node within a DODAG iteration. The rank is used to avoid and
          detect loops, and as such must demonstrate certain properties. The
          exact calculation of the rank is left to the Objective Function, and
          may depend on parents, link metrics, and the node configuration and
          policies.
</p>
<p>The rank is not a cost metric, although its value can be derived
          from and influenced by metrics. The rank has properties of its own
          that are not necessarily those of all metrics: </p>
<blockquote class="text"><dl>
<dt>Type:</dt>
<dd>Rank is an abstract scalar. Some metrics are
              boolean (e.g. grounded), others are statistical and better
              expressed as a tuple like an expected value and a variance. Some
              OCPs use not one but a set of metrics bound by a piece of
              logic.
</dd>
<dt>Function:</dt>
<dd>Rank is the expression of a relative
              position within a DODAG iteration with regard to neighbors and
              is not necessarily a good indication or a proper expression of a
              distance or a cost to the root.
</dd>
<dt>Stability:</dt>
<dd>The stability of the rank determines
              the stability of the routing topology. Some dampening or
              filtering might be applied to keep the topology stable, and thus
              the rank does not necessarily change as fast as some physical
              metrics would. A new DODAG iteration would be a good opportunity
              to reconcile the discrepancies that might form over time between
              metrics and ranks within a DODAG iteration.
</dd>
<dt>Granularity:</dt>
<dd>Rank is coarse grained. A fine
              granularity would prevent the selection of siblings.
</dd>
<dt>Properties:</dt>
<dd>Rank is strictly monotonic, and can be
              used to validate a progression from or towards the root. A
              metric, like bandwidth or jitter, does not necessarily exhibit
              this property.
</dd>
<dt>Abstract:</dt>
<dd>Rank does not have a physical unit, but
              rather a range of increment per hop that varies from 1 (best) to
              16 (worst), where the assignment of each value is to be
              determined by the implementation.
</dd>
</dl></blockquote>

<p>The rank value feeds into DODAG parent selection, according to
          the RPL loop-avoidance strategy. Once a parent has been added, and a
          rank value for the node within the DODAG has been advertised, the
          nodes further options with regard to DODAG parent selection and
          movement within the DODAG are restricted in favor of loop
          avoidance.
</p>
<a name="RankComparison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.2.1"></a><h3>3.6.2.1.&nbsp;
Rank Comparison</h3>

<p>Rank may be thought of as a fixed point number, where the
            position of the decimal point is determined by MinHopRankIncrease.
            The integer portion of the Rank is determined by
            floor(Rank/MinHopRankIncrease).
</p>
<p>MinHopRankIncrease is provisioned at the DODAG Root and
            propagated in the DIO message. For efficient implementation the
            MinHopRankIncrease SHOULD be a power of 2. An implementation may
            configure a value MinHopRankIncrease as appropriate to balance
            between the loop avoidance logic of RPL (i.e. selection of
            eligible parents and siblings) and the metrics in use.
</p>
<p>A node A has a rank less than the rank of a node B if
            floor(Rank(A) / MinHopRankIncrease) is less than floor (Rank(B) /
            MinHopRankIncrease).
</p>
<p>A node A has a rank equal to the rank of a node B if
            floor(Rank(A) / MinHopRankIncrease) is equal to floor (Rank(B) /
            MinHopRankIncrease).
</p>
<p>A node A has a rank greater than the rank of a node B if
            floor(Rank(A) / MinHopRankIncrease) is greater than floor (Rank(B)
            / MinHopRankIncrease).
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.6.2.2"></a><h3>3.6.2.2.&nbsp;
Rank Relationships</h3>

<p>The computation of the rank MUST be done in such a way so as to
            maintain the following properties for any nodes M and N that are
            neighbors in the LLN:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>DAGRank(M) is less than DAGRank(N):</dt>
<dd>In this
                case, the position of M is closer to the DODAG root than the
                position of N. Node M may safely be a DODAG parent for Node N
                without risk of creating a loop. Further, for a node N, all
                parents in the DODAG parent set must be of rank less than
                DAGRank(N). In other words, the rank presented by a node N
                MUST be greater than that presented by any of its parents.
</dd>
<dt>DAGRank(M) equals DAGRank(N):</dt>
<dd>In this case the
                positions of M and N within the DODAG and with respect to the
                DODAG root are similar (identical). In some cases, Node M may
                be used as a successor by Node N, which however entails the
                probability of creating a loop (which must be detected and
                resolved by some other means).
</dd>
<dt>DAGRank(M) is greater than DAGRank(N):</dt>
<dd>In this
                case, the position of M is farther from the DODAG root than
                the position of N. Further, Node M may in fact be in the
                sub-DODAG of Node N. If node N selects node M as DODAG parent
                there is a risk to create a loop.
</dd>
</dl></blockquote>

<p>As an example, the rank could be computed in such a way so as
            to closely track ETX when the objective function is to minimize
            ETX, or latency when the objective function is to minimize
            latency, or in a more complicated way as appropriate to the
            objective code point being used within the DODAG.
</p>
<a name="RPLControlMessage"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
ICMPv6 RPL Control Message</h3>

<p>This document defines the RPL Control Message, a new ICMPv6 message.
      In accordance with <a class='info' href='#RFC4443'>[RFC4443]<span> (</span><span class='info'>Conta, A., Deering, S., and M. Gupta, &ldquo;Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification,&rdquo; March&nbsp;2006.</span><span>)</span></a>, the RPL Control
      Message has the following format:
</p>
<p><br /><hr class="insert" />
<a name="ICMPFormat"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |     Type      |     Code      |          Checksum             |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                         Message Body                          +
    |                                                               |
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: RPL Control Message&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The RPL Control message is an ICMPv6 information message with a
      requested Type of 155.
</p>
<p>The Code field identifies the type of RPL Control Message. This
      document defines three types:
</p>
<p></p>
<ul class="text">
<li>0x01: DAG Information Solicitation (<a class='info' href='#DAGInformationSolicitation'>Section&nbsp;5.2<span> (</span><span class='info'>DODAG Information Solicitation (DIS)</span><span>)</span></a>)
</li>
<li>0x02: DAG Information Object (<a class='info' href='#DAGInformationObject'>Section&nbsp;5.1<span> (</span><span class='info'>DODAG Information Object (DIO)</span><span>)</span></a>)
</li>
<li>0x04: Destination Advertisement Object (<a class='info' href='#DestinationAdvertisementObject'>Section&nbsp;6.1<span> (</span><span class='info'>Destination Advertisement Object (DAO)</span><span>)</span></a>)
</li>
</ul>

<a name="UpwardRoutes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Upward Routes</h3>

<p>This section describes how RPL discovers and maintains upward routes.
      It describes DODAG Information Objects (DIOs), the messages used to
      discover and maintain these routes. It specifies how RPL generates and
      responds to DIOs. It also describes DAG Information Solicitation (DIS)
      messages, which are used to trigger DIO transmissions.
</p>
<a name="DAGInformationObject"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
DODAG Information Object (DIO)</h3>

<p>The DODAG Information Object carries information that allows a node
        to discover a RPL Instance, learn its configuration parameters, select
        a DODAG parent set, and maintain the upward routing topology.
</p>
<a name="DIOBase"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
DIO Base Format</h3>

<p>DIO Base is an always-present container option in a DIO message.
          Every DIO MUST include a DIO Base.
</p>
<p><br /><hr class="insert" />
<a name="DIObase"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |G|A|T|S|0| Prf |   Sequence    |             Rank              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | RPLInstanceID |     DTSN      |                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
    |                                                               |
    +                                                               +
    |                            DODAGID                            |
    +                                                               +
    |                                                               |
    +                               +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                               |   sub-option(s)...
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: DIO Base&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt>Control Field:</dt>
<dd>The DAG Control Field has three
              flags and one field: 
<blockquote class="text"><dl>
<dt>Grounded (G):</dt>
<dd>The Grounded (G) flag indicates
                  whether the upward routes this node advertises provide
                  connectivity to the set of addresses which are
                  application-defined goals. If the flag is set, the DODAG is
                  grounded and provides such connectivity. If the flag is
                  cleared, the DODAG is floating and may not provide such
                  connectivity.
</dd>
<dt>Destination Advertisement Supported (A):</dt>
<dd>The
                  Destination Advertisement Supported (A) bit indicates
                  whether the root of this DODAG can collect and use downward
                  route state. The flag is set when nodes in the network are
                  to exchange destination advertisements messages to build
                  downward routes (<a class='info' href='#DownwardRoutes'>Section&nbsp;6<span> (</span><span class='info'>Downward Routes</span><span>)</span></a>).
                  The flag is cleared when the DODAG maintains only upward
                  routes.
</dd>
<dt>Destination Advertisement Trigger (T):</dt>
<dd>The
                  Destination Advertisement Trigger (T) flag is used to
                  trigger a complete refresh of downward routes. The details
                  of this process are described in <a class='info' href='#DownwardRoutes'>Section&nbsp;6<span> (</span><span class='info'>Downward Routes</span><span>)</span></a>.
</dd>
<dt>Destination Advertisements Stored (S):</dt>
<dd>The
                  Destination Advertisements Stored (S) flag is used to
                  indicate that a non-root ancestor is storing routing table
                  entries learned from DAO messaging. The meaning and further
                  use of this flag is described in <a class='info' href='#DownwardRoutes'>Section&nbsp;6<span> (</span><span class='info'>Downward Routes</span><span>)</span></a>.
</dd>
<dt>DODAGPreference (Prf):</dt>
<dd>A 3-bit unsigned
                  integer that defines how preferable the root of this DODAG
                  is compared to other DODAG roots within the DODAG.
                  DAGPreference ranges from 0x00 (least preferred) to 0x07
                  (most preferred). The default is 0 (least preferred). <a class='info' href='#DAGDiscovery'>Section&nbsp;5.3<span> (</span><span class='info'>Upward Route Discovery and Maintenance</span><span>)</span></a> describes how DAGPreference
                  affects DIO processing.
</dd>
</dl></blockquote>
</dd>
<dt></dt>
<dd>Unassigned bits of the Control Field are reserved. They MUST
              be set to zero on transmission and MUST be ignored on
              reception.
</dd>
<dt>Sequence Number:</dt>
<dd>8-bit unsigned integer set by the
              DODAG root. <a class='info' href='#DAGDiscovery'>Section&nbsp;5.3<span> (</span><span class='info'>Upward Route Discovery and Maintenance</span><span>)</span></a> describes the
              rules for sequence numbers and how they affect DIO
              processing.
</dd>
<dt>Rank:</dt>
<dd>8-bit unsigned integer indicating the DODAG
              rank of the node sending the DIO message. <a class='info' href='#DAGDiscovery'>Section&nbsp;5.3<span> (</span><span class='info'>Upward Route Discovery and Maintenance</span><span>)</span></a> describes how Rank is set and how
              it affects DIO processing.
</dd>
<dt>RPLInstanceID:</dt>
<dd>8-bit field set by the DODAG root
              that indicates which RPL Instance the DODAG is part of.
</dd>
<dt>Destination Advertisement Trigger Sequence Number (DTSN):</dt>
<dd>8-bit
              unsigned integer set by the node issuing the DIO message. The
              Destination Advertisement Trigger Sequence Number (DTSN) flag is
              used as part of the procedure to maintain downward routes. The
              details of this process are described in <a class='info' href='#DownwardRoutes'>Section&nbsp;6<span> (</span><span class='info'>Downward Routes</span><span>)</span></a>.
</dd>
<dt>DODAGID:</dt>
<dd>128-bit unsigned integer set by a DODAG
              root which uniquely identifies a DODAG. Possibly derived from
              the IPv6 address of the DODAG root.
</dd>
</dl></blockquote>

<a name="DIOBaseRules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
DIO Base Rules</h3>

<p></p>
<ol class="text">
<li>If the 'A' flag of a DIO Base is cleared, the 'T' flag MUST
              also be cleared.
</li>
<li>For the following DIO Base fields, a node that is not a DODAG
              root MUST advertise the same values as its preferred DODAG
              parent (defined in <a class='info' href='#parentset'>Section&nbsp;5.3.2<span> (</span><span class='info'>Neighbors and Parents within a DODAG Iteration</span><span>)</span></a>). Therefore,
              if a DODAG root does not change these values, every node in a
              route to that DODAG root eventually advertises the same values
              for these fields. These fields are: 
<ol class="text">
<li>Grounded (G)
</li>
<li>Destination Advertisement Supported (A)
</li>
<li>Destination Advertisement Trigger (T)
</li>
<li>DAGPreference (Prf)
</li>
<li>Sequence
</li>
<li>RPLInstanceID
</li>
<li>DODAGID
</li>
</ol>
</li>
<li>A node MAY update the following fields at each hop: 
<ol class="text">
<li>DAGRank
</li>
<li>DTSN
</li>
</ol>
</li>
<li>The DODAGID field each root sets MUST be unique within the
              RPL Instance.
</li>
</ol>

<a name="DIOSuboptions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
DIO Suboptions</h3>

<p>This section describes the format of DIO suboptions and the five
          suboptions this document defines: Pad 1, Pad N, DAG Metric
          Container, DAG Destination Prefix, and DAG Configuration.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.1"></a><h3>5.1.3.1.&nbsp;
DIO Suboption Format</h3>

<p>The Pad N, DAG Metric Container, DAG Destination Prefix, and
            DAG Configuration suboptions all follow this format: <br /><hr class="insert" />
<a name="DIOsub"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
    |  Subopt. Type |         Subopt Length         | Subopt Data
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: DIO Suboption Generic Format&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt>Suboption Type:</dt>
<dd>8-bit identifier of the type of
                suboption.
</dd>
<dt>Suboption Length:</dt>
<dd>16-bit unsigned integer,
                representing the length in octets of the suboption, not
                including the suboption Type and Length fields.
</dd>
<dt>Suboption Data:</dt>
<dd>A variable length field that
                contains data specific to the option.
</dd>
</dl></blockquote>

<p>The following subsections specify the DIO message suboptions
            which are currently defined for use in the DAG Information
            Object.
</p>
<p>When processing a DIO message containing a suboption for which
            the Suboption Type value is not recognized by the receiver, the
            receiver MUST silently ignore the unrecognized option and continue
            to process the following suboption, correctly handling any
            remaining options in the message.
</p>
<p>DIO message suboptions may have alignment requirements.
            Following the convention in IPv6, these options are aligned in a
            packet such that multi-octet values within the Option Data field
            of each option fall on natural boundaries (i.e., fields of width n
            octets are placed at an integer multiple of n octets from the
            start of the header, for n = 1, 2, 4, or 8).
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.2"></a><h3>5.1.3.2.&nbsp;
Pad1</h3>

<p>The Pad1 suboption does not have any alignment requirements.
            Its format is as follows:
</p>
<p><br /><hr class="insert" />
<a name="DIOsubPad1"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0
     0 1 2 3 4 5 6 7
    +-+-+-+-+-+-+-+-+
    |   Type = 0    |
    +-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Pad 1&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>NOTE! the format of the Pad1 option is a special case - it has
            neither Option Length nor Option Data fields.
</p>
<p>The Pad1 option is used to insert one or two octets of padding
            in the DIO message to enable suboptions alignment. If more than
            two octets of padding is required, the PadN option, described
            next, should be used rather than multiple Pad1 options.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.3"></a><h3>5.1.3.3.&nbsp;
PadN</h3>

<p>The PadN option does not have any alignment requirements. Its
            format is as follows:
</p>
<p><br /><hr class="insert" />
<a name="DIOsubPadN"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
    |   Type = 1    |         Subopt Length         | Subopt Data
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: Pad N&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The PadN option is used to insert three or more octets of
            padding in the DIO message to enable suboptions alignment. For N
            (N &gt; 2) octets of padding, the Option Length field contains the
            value N-3, and the Option Data consists of N-3 zero-valued octets.
            PadN Option data MUST be ignored by the receiver.
</p>
<a name="DIOMetricContainer"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.4"></a><h3>5.1.3.4.&nbsp;
Metric Container</h3>

<p>The Metric Container suboption may be aligned as necessary to
            support its contents. Its format is as follows:
</p>
<p><br /><hr class="insert" />
<a name="DIOsubLLNMetric"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
    |   Type = 2    |         Subopt Length         | Metric Data
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+- - - - - - - -
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Metric Container&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The Metric Container is used to report aggregated path metrics
            along the DODAG. The Metric Container may contain a number of
            discrete node, link, and aggregate path metrics as chosen by the
            implementer. The Suboption Length field contains the length in
            octets of the Metric Data. The order, content, and coding of the
            Metric Container data is as specified in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>.
</p>
<p>The processing and propagation of the Metric Container is
            governed by implementation specific policy functions.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.5"></a><h3>5.1.3.5.&nbsp;
Destination Prefix</h3>

<p>The Destination Prefix suboption does not have any alignment
            requirements. Its format is as follows:
</p>
<p><br /><hr class="insert" />
<a name="DIOsubDestinationPrefix"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Type = 3    |        Subopt Length          |Resvd|Prf|Resvd|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Prefix Lifetime                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | Prefix Length |                                               |
    +-+-+-+-+-+-+-+-+                                               |
    |             Destination Prefix (Variable Length)              |
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;9: DAG Destination Prefix&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The Destination Prefix suboption is used when the DODAG root,
            or another node located upwards along the DODAG on the path to the
            DODAG root, needs to indicate that it offers connectivity to
            destination prefixes other than the default. This may be useful in
            cases where more than one LBR is operating within the LLN and
            offering connectivity to different administrative domains, e.g. a
            home network and a utility network. In such cases, upon observing
            the Destination Prefixes offered by a particular DODAG, a node MAY
            decide to join multiple DODAGs in support of a particular
            application.
</p>
<p>The Suboption Length is coded as the length of the suboption in
            octets, excluding the Type and Length fields.
</p>
<p>Prf is the Route Preference as in <a class='info' href='#RFC4191'>[RFC4191]<span> (</span><span class='info'>Draves, R. and D. Thaler, &ldquo;Default Router Preferences and More-Specific Routes,&rdquo; November&nbsp;2005.</span><span>)</span></a>. The reserved fields MUST be set to zero
            on transmission and MUST be ignored on receipt.
</p>
<p>The Prefix Lifetime is a 32-bit unsigned integer representing
            the length of time in seconds (relative to the time the packet is
            sent) that the Destination Prefix is valid for route
            determination. The lifetime is initially set by the node that owns
            the prefix and denotes the valid lifetime for that prefix (similar
            to AdvValidLifetime <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>). The value
            might be reduced by the originator and/or en-route nodes that will
            not provide connectivity for the whole valid lifetime. A value of
            all one bits (0xFFFFFFFF) represents infinity. A value of all zero
            bits (0x00000000) indicates a loss of reachability.
</p>
<p>The Prefix Length is an 8-bit unsigned integer that indicates
            the number of leading bits in the destination prefix.
</p>
<p>The Destination Prefix contains Prefix Length significant bits
            of the destination prefix. The remaining bits of the Destination
            Prefix, as required to complete the trailing octet, are set to
            0.
</p>
<p>In the event that a DIO message may need to specify
            connectivity to more than one destination, the Destination Prefix
            suboption may be repeated.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3.6"></a><h3>5.1.3.6.&nbsp;
DODAG Configuration</h3>

<p>The DODAG Configuration suboption does not have any alignment
            requirements. Its format is as follows:
</p>
<p><br /><hr class="insert" />
<a name="DIOsubDAGConfig"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Type = 4    |            Length             | DIOIntDoubl.  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  DIOIntMin.   |   DIORedun.   |  MaxRankInc   | MinHopRankInc |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;10: DODAG Configuration&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p>The DODAG Configuration suboption is used to distribute
            configuration information for DODAG Operation through the DODAG.
            The information communicated in this suboption is generally static
            and unchanging within the DODAG, therefore it is not necessary to
            include in every DIO. This suboption MAY be included occasionally
            by the DODAG Root, and MUST be included in response to a unicast
            request, e.g. a DODAG Information Solicitation (DIS) message.
</p>
<p>The Length is coded as 5.
</p>
<p>DIOIntervalDoublings is an 8-bit unsigned integer, configured
            on the DODAG root and used to configure the trickle timer (see
            <a class='info' href='#TrickleImplementation'>Section&nbsp;5.3.5.1<span> (</span><span class='info'>Trickle Timer for DIO Transmission</span><span>)</span></a> for details on
            trickle timers) governing when DIO message should be sent within
            the DODAG. DIOIntervalDoublings is the number of times that the
            DIOIntervalMin is allowed to be doubled during the trickle timer
            operation.
</p>
<p>DIOIntervalMin is an 8-bit unsigned integer, configured on the
            DODAG root and used to configure the trickle timer governing when
            DIO message should be sent within the DODAG. The minimum
            configured interval for the DIO trickle timer in units of ms is
            2^DIOIntervalMin. For example, a DIOIntervalMin value of 16ms is
            expressed as 4.
</p>
<p>DIORedundancyConstant is an 8-bit unsigned integer used to
            configure suppression of DIO transmissions. DIORedundancyConstant
            is the minimum number of relevant incoming DIOs required to
            suppress a DIO transmission. If the value is 0xFF then the
            suppression mechanism is disabled.
</p>
<p>MaxRankInc, 8-bit unsigned integer, is the DAGMaxRankIncrease.
            This is the allowable increase in rank in support of local repair.
            If DAGMaxRankIncrease is 0 then this mechanism is disabled.
</p>
<p>MinHopRankInc, 8-bit unsigned integer, is the
            MinHopRankIncrease as described in <a class='info' href='#RankComparison'>Section&nbsp;3.6.2.1<span> (</span><span class='info'>Rank Comparison</span><span>)</span></a>.
</p>
<a name="DAGInformationSolicitation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
DODAG Information Solicitation (DIS)</h3>

<p>The DODAG Information Solicitation (DIS) message may be used to
        solicit a DODAG Information Object from a RPL node. Its use is
        analogous to that of a Router Solicitation; a node may use DIS to
        probe its neighborhood for nearby DODAGs. The DODAG Information
        Solicitation carries no additional message body. <a class='info' href='#DIOTransmission'>Section&nbsp;5.3.5<span> (</span><span class='info'>DIO Transmission</span><span>)</span></a> describes how nodes respond to a
        DIS.
</p>
<a name="DAGDiscovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Upward Route Discovery and Maintenance</h3>

<p>Upward route discovery allows a node to join a DODAG by discovering
        neighbors that are members of the DODAG and identifying a set of
        parents. The exact policies for selecting neighbors and parents is
        implementation-dependent. This section specifies the set of rules
        those policies must follow for interoperability.
</p>
<a name="RPLInstance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
RPL Instance</h3>

<p></p>
<blockquote class="text">
<p>A RPLInstanceID MUST be unique across an LLN.
</p>
<p>A node MAY belong to multiple RPL Instances.
</p>
</blockquote>

<p>Within a given LLN, there may be multiple, logically independent
          RPL instances. This document describes how a single instance
          behaves.
</p>
<a name="parentset"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
Neighbors and Parents within a DODAG Iteration</h3>

<p>RPL's upward route discovery algorithms and processing are in
          terms of three logical sets of link-local nodes. First, the
          candidate neighbor set is a subset of the nodes that can be reached
          via link-local multicast. The selection of this set is
          implementation-dependent and OF-dependent. Second, the parent set is
          a restricted subset of the candidate neighbor set. Finally, the
          preferred parent, a set of size one, is an element of the parent set
          that is the preferred next hop in upward routes.
</p>
<p>More precisely: </p>
<ol class="text">
<li>The DODAG parent set MUST be a subset of the candidate
              neighbor set.
</li>
<li>A DODAG root MUST have a DODAG parent set of size zero.
</li>
<li>A node that is not a DODAG root MAY maintain a DODAG parent
              set of size greater than or equal to one.
</li>
<li>A node's preferred DODAG parent MUST be a member of its DODAG
              parent set.
</li>
<li>A node's rank MUST be greater than all elements of its DODAG
              parent set.
</li>
<li>When Neighbor Unreachability Detection (NUD), or an
              equivalent mechanism, determines that a neighbor is no longer
              reachable, a RPL node MUST NOT consider this node in the
              candidate neighbor set when calculating and advertising routes
              until it determines that it is again reachable. Routes through
              an unreachable neighbor MUST be eliminated from the routing
              table.
</li>
</ol>

<p>These rules ensure that there is a consistent partial order on
          nodes within the DODAG. As long as node ranks do not change,
          following the above rules ensures that every node's route to a DODAG
          root is loop-free, as rank decreases on each hop to the root. The OF
          can guide candidate neighbor set and parent set selection, as
          discussed in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="DAGDiscoveryRules"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3"></a><h3>5.3.3.&nbsp;
Neighbors and Parents across DODAG Iterations</h3>

<p>The above rules govern a single DODAG iteration. The rules in
          this section define how RPL operates when there are multiple DODAG
          iterations:
</p>
<a name="DAGDiscoveryRulesSeq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.1"></a><h3>5.3.3.1.&nbsp;
DODAG Iteration</h3>

<p></p>
<ol class="text">
<li>The tuple (RPLInstanceID, DODAGID, DODAGSequenceNumber)
                uniquely defines a DODAG Iteration. Every element of a node's
                DODAG parent set, as conveyed by the last heard DIO from each
                DODAG parent, MUST belong to the same DODAG iteration.
                Elements of a node's candidate neighbor set MAY belong to
                different DODAG Iterations.
</li>
<li>A node is a member of a DODAG iteration if every element of
                its DODAG parent set belongs to that DODAG iteration, or if
                that node is the root of the corresponding DODAG.
</li>
<li>A node MUST NOT send DIOs for DODAG iterations of which it
                is not a member.
</li>
<li>DODAG roots MAY increment the DODAGSequenceNumber that they
                advertise and thus move to a new DODAG iteration. When a DODAG
                root increments its DODAGSequenceNumber, it MUST follow the
                conventions of Serial Number Arithmetic as described in <a class='info' href='#RFC1982'>[RFC1982]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Serial Number Arithmetic,&rdquo; August&nbsp;1996.</span><span>)</span></a>.
</li>
<li>Within a given DODAG, a node that is a not a root MUST NOT
                advertise a DODAGSequenceNumber higher than the highest
                DODAGSequenceNumber it has heard. Higher is defined as the
                greater-than operator in <a class='info' href='#RFC1982'>[RFC1982]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Serial Number Arithmetic,&rdquo; August&nbsp;1996.</span><span>)</span></a>.
</li>
<li>Once a node has advertised a DODAG iteration by sending a
                DIO, it MUST NOT be member of a previous DODAG iteration of
                the same DODAG (i.e. with the same DODAGID and a lower
                DODAGSequenceNumber). Lower is defined as the less-than
                operator in <a class='info' href='#RFC1982'>[RFC1982]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Serial Number Arithmetic,&rdquo; August&nbsp;1996.</span><span>)</span></a>.
</li>
</ol>

<p>Within a particular implementation, a DODAG root may increment
            the DODAGSequenceNumber periodically, at a rate that depends on
            the deployment. In other implementations, loop detection may be
            considered sufficient to solve routing issues, and the DODAG root
            may increment the DODAGSequenceNumber only upon administrative
            intervention. Another possibility is that nodes within the LLN
            have some means by which they can signal detected routing
            inconsistencies or suboptimalities to the DODAG root, in order to
            request an on-demand DODAGSequenceNumber increment (i.e. request a
            global repair of the DODAG).
</p>
<p>When the DODAG parent set is depleted on a node that is not a
            root, (i.e. the last parent is removed), then the DODAG
            information should not be suppressed until after the expiration of
            an implementation-specific local timer in order to observe if the
            DODAGSequenceNumber has been incremented, should any new parents
            appear for the DODAG.
</p>
<p>As the DODAGSequenceNumber is incremented, a new DODAG
            Iteration spreads outward from the DODAG root. Thus a parent that
            advertises the new DODAGSequenceNumber can not possibly belong to
            the sub-DODAG of a node that still advertises an older
            DODAGSequenceNumber. A node may safely add such a parent, without
            risk of forming a loop, without regard to its relative rank in the
            prior DODAG Iteration. This is equivalent to jumping to a
            different DODAG.
</p>
<p>As a node transitions to new DODAG Iterations as a consequence
            of following these rules, the node will be unable to advertise the
            previous DODAG Iteration (prior DODAGSequenceNumber) once it has
            committed to advertising the new DODAG Iteration.
</p>
<p>During transition to a new DODAG Iteration, a node may decide
            to forward packets via 'future parents' that belong to the same
            DODAG (same RPLInstanceID and DODAGID), but are observed to
            advertise a more recent (incremented) DODAGSequenceNumber.
</p>
<a name="DAGDiscoveryRulesRoot"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.2"></a><h3>5.3.3.2.&nbsp;
DODAG Roots</h3>

<p></p>
<ol class="text">
<li>A DODAG root that does not have connectivity to the set of
                addresses described as application-level goals, MUST NOT set
                the Grounded bit.
</li>
<li>A DODAG root MUST advertise a rank of ROOT_RANK.
</li>
<li>A node whose DODAG parent set is empty MAY become the DODAG
                root of a floating DODAG. It MAY also set its DAGPreference
                such that it is less preferred.
</li>
</ol>

<p>An LLN node that is a goal for the Objective Function is the
            root of its own grounded DODAG, at rank ROOT_RANK.
</p>
<p>In a deployment that uses a backbone link to federate a number
            of LLN roots, it is possible to run RPL over that backbone and use
            one router as a "backbone root". The backbone root is the virtual
            root of the DODAG, and exposes a rank of BASE_RANK over the
            backbone. All the LLN roots that are parented to that backbone
            root, including the backbone root if it also serves as LLN root
            itself, expose a rank of ROOT_RANK to the LLN, and are part of the
            same DODAG, coordinating DODAGSequenceNumber and other DODAG root
            determined parameters with the virtual root over the backbone.
</p>
<a name="DAGSelection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.3"></a><h3>5.3.3.3.&nbsp;
DODAG Selection</h3>

<p>The DODAGPreference (Prf) provides an administrative mechanism
            to engineer the self-organization of the LLN, for example
            indicating the most preferred LBR. If a node has the option to
            join a more preferred DODAG while still meeting other optimization
            objectives, then the node will generally seek to join the more
            preferred DODAG as determined by the OF.
</p>
<a name="DAGDiscoveryRulesMove"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.4"></a><h3>5.3.3.4.&nbsp;
Rank and Movement within a DODAG Iteration</h3>

<p></p>
<ol class="text">
<li>A node MUST NOT advertise a rank less than or equal to any
                member of its parent set within the DODAG Iteration.
</li>
<li>A node MAY advertise a rank lower than its prior
                advertisement within the DODAG Iteration.
</li>
<li>Let L be the lowest rank within a DODAG iteration that a
                given node has advertised. Within the same DODAG Iteration,
                that node MUST NOT advertise an effective rank higher than L +
                DAGMaxRankIncrease. INFINITE_RANK is an exception to this
                rule: a node MAY advertise an INFINITE_RANK at any time. (This
                corresponds to a limited rank increase for the purpose of
                local repair within the DODAG Iteration.)
</li>
<li>A node MAY, at any time, choose to join a different DODAG
                within a RPL Instance. Such a join has no rank restrictions,
                unless that different DODAG is a DODAG Iteration of which that
                node has previously been a member, in which case the rule of
                the previous bullet (3) must be observed. Until a node
                transmits a DIO indicating its new DODAG membership, it MUST
                forward packets along the previous DODAG.
</li>
<li>A node MAY, at any time after hearing the next
                DODAGSequenceNumber Iteration advertised from suitable DODAG
                parents, choose to migrate to the next DODAG Iteration within
                the DODAG.
</li>
</ol>

<p>Conceptually, an implementation is maintaining a DODAG parent
            set within the DODAG Iteration. Movement entails changes to the
            DODAG parent set. Moving up does not present the risk to create a
            loop but moving down might, so that operation is subject to
            additional constraints.
</p>
<p>When a node migrates to the next DODAG Iteration, the DODAG
            parent and sibling sets need to be rebuilt for the new iteration.
            An implementation could defer to migrate for some reasonable
            amount of time, to see if some other neighbors with potentially
            better metrics but higher rank announce themselves. Similarly,
            when a node jumps into a new DODAG it needs to construct new DODAG
            parent/sibling sets for this new DODAG.
</p>
<p>When a node moves to improve its position, it must conceptually
            abandon all DODAG parents and siblings with a rank larger than
            itself. As a consequence of the movement it may also add new
            siblings. Such a movement may occur at any time to decrease the
            rank, as per the calculation indicated by the OF. Maintenance of
            the parent and sibling sets occurs as the rank of candidate
            neighbors is observed as reported in their DIOs.
</p>
<p>If a node needs to move down a DODAG that it is attached to,
            causing the rank to increase, then it MAY poison its routes and
            delay before moving as described in <a class='info' href='#DAGDiscoveryRulesPoison'>Section&nbsp;5.3.3.5<span> (</span><span class='info'>Poisoning a Broken Path</span><span>)</span></a>.
</p>
<a name="DAGDiscoveryRulesPoison"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.5"></a><h3>5.3.3.5.&nbsp;
Poisoning a Broken Path</h3>

<p></p>
<ol class="text">
<li>A node MAY poison, in order to avoid being used as an
                ancestor by the nodes in its sub-DODAG, by advertising an
                effective rank of INFINITE_RANK and resetting the associated
                DIO trickle timer to cause this INFINITE_RANK to be announced
                promptly.
</li>
<li>The node MAY advertise an effective rank of INFINITE_RANK
                for an arbitrary number of DIO timer events, before announcing
                a new rank.
</li>
<li>As per <a class='info' href='#DAGDiscoveryRulesMove'>Section&nbsp;5.3.3.4<span> (</span><span class='info'>Rank and Movement within a DODAG Iteration</span><span>)</span></a>, the
                node MUST advertise INFINITE_RANK within the DODAG iteration
                in which it participates, if its revised rank would exceed the
                maximum rank increase.
</li>
</ol>

<p>An implementation may choose to employ this poisoning mechanism
            when a node loses all of its current parents, i.e. the set of
            DODAG parents becomes depleted, and it can not jump to an
            alternate DODAG. An alternate mechanism is to form a floating
            DODAG.
</p>
<p>The motivation for delaying announcement of the revised route
            through multiple DIO events is to (i) increase tolerance to DIO
            loss, (ii) allow time for the poisoning action to propagate, and
            (iii) to develop an accurate assessment of its new rank. Such
            gains are obtained at the expense of potentially increasing the
            delay before portions of the network are able to re-establish
            upwards routes. Path redundancy in the DODAG reduces the
            significance of either effect, since children with alternate
            parents should be able to utilize those alternates and retain
            their rank while the detached parent re-establishes its rank.
</p>
<p>Although an implementation may advertise INFINITE_RANK for the
            purposes of poisoning, it is not expected to be equivalent to
            setting the rank to INFINITE_RANK, and an implementation would
            likely retain its rank value prior to the poisoning in some form,
            for purpose of maintaining its effective position within (L +
            DAGMaxRankIncrease).
</p>
<a name="DAGDiscoveryRulesdetach"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.6"></a><h3>5.3.3.6.&nbsp;
Detaching</h3>

<p></p>
<ol class="text">
<li>A node unable to stay connected to a DODAG within a given
                DODAG iteration MAY detach from this DODAG iteration. A node
                that detaches becomes root of its own floating DODAG and
                SHOULD immediately advertise this new situation in a DIO as an
                alternate to poisoning.
</li>
</ol>

<a name="DAGDiscoveryRulesfollow"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.3.7"></a><h3>5.3.3.7.&nbsp;
Following a Parent</h3>

<p></p>
<ol class="text">
<li>If a node receives a DIO from one of its DODAG parents,
                indicating that the parent has left the DODAG, that node
                SHOULD stay in its current DODAG through an alternative DODAG
                parent, if possible. It MAY follow the leaving parent.
</li>
</ol>

<p>A DODAG parent may have moved, migrated to the next DODAG
            Iteration, or jumped to a different DODAG. A node should give some
            preference to remaining in the current DODAG, if possible, but
            ought to follow the parent if there are no other options.
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4"></a><h3>5.3.4.&nbsp;
DIO Message Communication</h3>

<p>When an DIO message is received, the receiving node must first
          determine whether or not the DIO message should be accepted for
          further processing, and subsequently present the DIO message for
          further processing if eligible.
</p>
<p></p>
<ol class="text">
<li>If the DIO message is malformed, then the DIO message is not
              eligible for further processing and is silently discarded. A RPL
              implementation MAY log the reception of a malformed DIO
              message.
</li>
<li>If the sender of the DIO message is a member of the candidate
              neighbor set, then the DIO is eligible for further
              processing.
</li>
</ol>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.4.1"></a><h3>5.3.4.1.&nbsp;
DIO Message Processing</h3>

<p>As DIO messages are received from candidate neighbors, the
            neighbors may be promoted to DODAG parents by following the rules
            of DODAG discovery as described in <a class='info' href='#DAGDiscovery'>Section&nbsp;5.3<span> (</span><span class='info'>Upward Route Discovery and Maintenance</span><span>)</span></a>. When a node places a neighbor into
            the DODAG parent set, the node becomes attached to the DODAG
            through the new DODAG parent node.
</p>
<p>The most preferred parent should be used to restrict which
            other nodes may become DODAG parents. Some nodes in the DODAG
            parent set may be of a rank less than or equal to the most
            preferred DODAG parent. (This case may occur, for example, if an
            energy constrained device is at a lesser rank but should be
            avoided as per an optimization objective, resulting in a more
            preferred parent at a greater rank).
</p>
<a name="DIOTransmission"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5"></a><h3>5.3.5.&nbsp;
DIO Transmission</h3>

<p>Each node maintains a timer, that governs when to multicast DIO
          messages. This timer is a trickle timer, as detailed in <a class='info' href='#TrickleImplementation'>Section&nbsp;5.3.5.1<span> (</span><span class='info'>Trickle Timer for DIO Transmission</span><span>)</span></a>. The DIO Configuration Option
          includes the configuration of a RPL Instance's trickle timer.
</p>
<p></p>
<ul class="text">
<li>When a node detects or causes an inconsistency, it MUST reset
              the interval of the trickle timer to its minimum value.
</li>
<li>When a node migrates to a new DODAG Iteration it MUST reset
              the trickle timer to its minimum value
</li>
<li>When a node detects an inconsistency when forwarding a
              packet, as detailed in <a class='info' href='#loopdetect'>Section&nbsp;7.2<span> (</span><span class='info'>Loop Avoidance and Detection</span><span>)</span></a>, the
              node MUST reset the trickle timer to its minimum value.
</li>
<li>When a node receives a multicast DIS message, it MUST reset
              the trickle timer to its minimum value.
</li>
<li>When a node receives a unicast DIS message, it MUST unicast a
              DIO message in response, and MUST include the DODAG
              Configuration Object. In this case the node SHOULD NOT reset the
              trickle timer.
</li>
<li>If a node is not a member of a DODAG, it MUST suppress
              transmission of DIO messages.
</li>
<li>When a node is initialized, it MAY be configured to remain
              silent and not multicast any DIO messages until it has
              encountered and joined a DODAG (perhaps initially probing for a
              nearby DODAG with an DIS message). Alternately, it MAY choose to
              root its own floating DODAG and begin multicasting DIO messages
              using a default trickle configuration. The second case may be
              advantageous if it is desired for independent nodes to begin
              aggregating into scattered floating DODAGs, in the absence of a
              grounded node, for example in support of LLN installation and
              commissioning.
</li>
</ul>

<a name="TrickleImplementation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5.1"></a><h3>5.3.5.1.&nbsp;
Trickle Timer for DIO Transmission</h3>

<p>RPL treats the construction of a DODAG as a consistency
            problem, and uses a trickle timer <a class='info' href='#Levis08'>[Levis08]<span> (</span><span class='info'>Levis, P., Brewer, E., Culler, D., Gay, D., Madden, S., Patel, N., Polastre, J., Shenker, S., Szewczyk, R., and A. Woo, &ldquo;The Emergence of a Networking Primitive in           Wireless Sensor Networks,&rdquo; July&nbsp;2008.</span><span>)</span></a>
            to control the rate of control broadcasts.
</p>
<p>For each DODAG that a node is part of (i.e. one DODAG per RPL
            Instance), the node must maintain a single trickle timer. The
            required state contains the following conceptual items:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>I:</dt>
<dd>The current length of the communication
                interval
</dd>
<dt>T:</dt>
<dd>A timer with a duration set to a random value
                in the range [I/2, I]
</dd>
<dt>C:</dt>
<dd>Redundancy Counter
</dd>
<dt>I_min:</dt>
<dd>The smallest communication interval in
                milliseconds. This value is learned from the DIO message as
                (2^DIOIntervalMin)ms. The default value is
                DEFAULT_DIO_INTERVAL_MIN.
</dd>
<dt>I_doublings:</dt>
<dd>The number of times I_min should be
                doubled before maintaining a constant rate, i.e. I_max = I_min
                * 2^I_doublings. This value is learned from the DIO message as
                DIOIntervalDoublings. The default value is
                DEFAULT_DIO_INTERVAL_DOUBLINGS.
</dd>
</dl></blockquote>

<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5.1.1"></a><h3>5.3.5.1.1.&nbsp;
Resetting the Trickle Timer</h3>

<p>The trickle timer for a DODAG is reset by:
</p>
<p></p>
<ol class="text">
<li>Setting I_min and I_doublings to the values learned from
                  the DODAG root via a received DIO message.
</li>
<li>Setting C to zero.
</li>
<li>Setting I to I_min.
</li>
<li>Setting T to a random value as described above.
</li>
<li>Restarting the trickle timer to expire after a duration
                  T
</li>
</ol>

<p>When a node learns about a DODAG through a DIO message, and
              makes the decision to join this DODAG, it initializes the state
              of the trickle timer by resetting the trickle timer and
              listening. Each time it hears a redundant DIO message for this
              DODAG, it MAY increment C. The exact determination of what
              constitutes a redundant DIO message is left to an
              implementation; it could for example include DIOs that advertise
              the same rank.
</p>
<p>When the timer fires at time T, the node compares C to the
              redundancy constant, DIORedundancyConstant. If C is less than
              that value, or if the DIORedundancyConstant value is 0xFF, the
              node generates a new DIO message and multicasts it. When the
              communication interval I expires, the node doubles the interval
              I so long as it has previously doubled it fewer than I_doubling
              times, resets C, and chooses a new T value.
</p>
<a name="TrickleInconsistencies"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.5.1.2"></a><h3>5.3.5.1.2.&nbsp;
Determination of Inconsistency</h3>

<p>The trickle timer is reset whenever an inconsistency is
              detected within the DODAG, for example:
</p>
<p></p>
<ul class="text">
<li>The node joins a new DODAG
</li>
<li>The node moves within a DODAG
</li>
<li>The node receives a modified DIO message from a DODAG
                  parent
</li>
<li>A DODAG parent forwards a packet intended to move up,
                  indicating an inconsistency and possible loop.
</li>
<li>A metric communicated in the DIO message is determined to
                  be inconsistent, as according to a implementation specific
                  path metric selection engine.
</li>
<li>The rank of a DODAG parent has changed.
</li>
</ul>

<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.6"></a><h3>5.3.6.&nbsp;
DODAG Selection</h3>

<p>The DODAG selection is implementation and algorithm dependent.
          Nodes SHOULD prefer to join DODAGs for RPLInstanceIDs advertising
          OCPs and destinations compatible with their implementation specific
          objectives. In order to limit erratic movements, and all metrics
          being equal, nodes SHOULD keep their previous selection. Also, nodes
          SHOULD provide a means to filter out a parent whose availability is
          detected as fluctuating, at least when more stable choices are
          available.
</p>
<p>When connection to a fixed network is not possible or preferable
          for security or other reasons, scattered DODAGs MAY aggregate as
          much as possible into larger DODAGs in order to allow connectivity
          within the LLN.
</p>
<p>A node SHOULD verify that bidirectional connectivity and adequate
          link quality is available with a candidate neighbor before it
          considers that candidate as a DODAG parent.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Operation as a Leaf Node</h3>

<p>In some cases a RPL node may attach to a DODAG as a leaf node only.
        One example of such a case is when a node does not understand the RPL
        Instance's OF. A leaf node does not extend DODAG connectivity but
        still needs to advertise its presence using DIOs. A node operating as
        a leaf node must obey the following rules:
</p>
<p></p>
<ol class="text">
<li>It MUST NOT transmit DIOs containing the DAG Metric
            Container.
</li>
<li>Its DIOs must advertise a DAGRank of INFINITE_RANK.
</li>
<li>It MAY transmit unicast DAOs as described in <a class='info' href='#DownwardDiscovery'>Section&nbsp;6.2<span> (</span><span class='info'>Downward Route Discovery and Maintenance</span><span>)</span></a>.
</li>
<li>It MAY transmit multicast DAOs to the '1 hop' neighborhood as
            described in <a class='info' href='#MulticastDAO'>Section&nbsp;6.2.9<span> (</span><span class='info'>Multicast Destination Advertisement Messages</span><span>)</span></a>.
</li>
</ol>

<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Administrative Rank</h3>

<p>In some cases it might be beneficial to adjust the rank advertised
        by a node beyond that computed by the OF based on some implementation
        specific policy and properties of the node. For example, a node that
        has limited battery should be a leaf unless there is no other choice,
        and may then augment the rank computation specified by the OF in order
        to expose an exaggerated rank.
</p>
<a name="DAGCollision"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Collision</h3>

<p>A race condition occurs if 2 nodes send DIO messages at the same
        time and then attempt to join each other. This might happen, for
        example, between nodes which act as DODAG root of their own DODAGs. In
        order to detect the situation, LLN Nodes time stamp the sending of DIO
        message. Any DIO message received within a short link-layer-dependent
        period introduces a risk. It left to the implementation to define the
        duration of the risk window.
</p>
<p>There is risk of a collision when a node receives and processes a
        DIO within the risk window. For example, it may occur that two nodes
        are associated with different DODAGs and near-simultaneously send DIO
        messages, which are received and processed by both, and possibly
        result in both nodes simultaneously deciding to attach to each other.
        As a remedy, in the face of a potential collision, as determined by
        receiving a DIO within the risk window, the DIO message is not
        processed. It is expected that subsequent DIOs would not cross.
</p>
<a name="DownwardRoutes"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Downward Routes</h3>

<p>This section describes how RPL discovers and maintains downward
      routes. Messages containing the Destination Advertisement Object (DAO),
      used to construct downward routes, are described. The downward routes
      are necessary in support of P2MP flows, from the DODAG roots toward the
      leaves. It specifies non-storing and storing behavior of nodes with
      respect to DAO messaging and DAO routing table entries. Nodes, as
      according to their resources and the implementation, may selectively
      store routing table entries learned from DAO messages, or may instead
      propagate the DAO information upwards while adding source routing
      information. A further optimization is described whereby DAO messages
      may be used to populate routing table entries for the '1-hop' neighbors,
      which may be useful in some cases as a shortcut for P2P flows.
</p>
<a name="DestinationAdvertisementObject"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Destination Advertisement Object (DAO)</h3>

<p>The Destination Advertisement Object (DAO) is used to propagate
        destination information upwards along the DODAG.
</p>
<p><br /><hr class="insert" />
<a name="DAObject"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |         DAO Sequence          |           DAO Rank            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    | RPLInstanceID |   Route Tag   | Prefix Length |    RRCount    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                          DAO Lifetime                         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             Destination Prefix (Variable Length)              |
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |             Reverse Route Stack (Variable Length)             |
    .                                                               .
    .                                                               .
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   sub-option(s)...
    +-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;11: The Destination Advertisement Object (DAO)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt>DAO Sequence:</dt>
<dd>16-bit unsigned integer. Incremented
            by the node that owns the prefix for each new DAO message for that
            prefix.
</dd>
<dt>DAO Rank:</dt>
<dd>16-bit unsigned integer indicating the DAO
            Rank associated with the advertised Destination Prefix. The DAO
            Rank is analogous to the Rank in the DIO message in that it may be
            used to convey a relative distance to the Destination Prefix as
            computed by the Objective Function in use over the DODAG. It
            serves as a mechanism by which an ancestor node may order
            alternate DAO paths.
</dd>
<dt>RPLInstanceID:</dt>
<dd>8-bit field indicating the topology
            instance associated with the DODAG, as learned from the DIO.
</dd>
<dt>Route Tag:</dt>
<dd>8-bit unsigned integer. The Route Tag may
            be used to give a priority to prefixes that should be stored. This
            may be useful in cases where intermediate nodes are capable of
            storing a limited amount of routing state. The further
            specification of this field and its use is under
            investigation.
</dd>
<dt>Prefix Length:</dt>
<dd>8-bit unsigned integer. Number of
            valid leading bits in the IPv6 Prefix.
</dd>
<dt>RRCount:</dt>
<dd>8-bit unsigned integer. This counter is
            used to count the number of entries in the Reverse Route Stack. A
            value of '0' indicates that no Reverse Route Stack is present.
</dd>
<dt>DAO Lifetime:</dt>
<dd>32-bit unsigned integer. The length of
            time in seconds (relative to the time the packet is sent) that the
            prefix is valid for route determination. A value of all one bits
            (0xFFFFFFFF) represents infinity. A value of all zero bits
            (0x00000000) indicates a loss of reachability.
</dd>
<dt>Destination Prefix:</dt>
<dd>Variable-length field
            identifying an IPv6 destination address, prefix, or multicast
            group. The Prefix Length field contains the number of valid
            leading bits in the prefix. The bits in the prefix after the
            prefix length (if any) are reserved and MUST be set to zero on
            transmission and MUST be ignored on receipt.
</dd>
<dt>Reverse Route Stack:</dt>
<dd>Variable-length field
            containing a sequence of RRCount (possibly compressed) IPv6
            addresses. A node that adds on to the Reverse Route Stack will
            append to the list and increment the RRCount.
</dd>
</dl></blockquote>

<a name="DAOSuboptions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
DAO Suboptions</h3>

<p>The DAO message may optionally include a number of
          suboptions.
</p>
<p>The DAO suboptions are in the same format as the DIO Suboptions
          described in <a class='info' href='#DAOSuboptions'>Section&nbsp;6.1.1<span> (</span><span class='info'>DAO Suboptions</span><span>)</span></a>.
</p>
<p>In particular, a DAO message may include a DAG Metric Container
          suboption as described in <a class='info' href='#DIOMetricContainer'>Section&nbsp;5.1.3.4<span> (</span><span class='info'>Metric Container</span><span>)</span></a>.
          This suboption may be present in implementations where the DAO Rank
          is insufficient to optimize a path to the DAO Destination
          Prefix.
</p>
<a name="DownwardDiscovery"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Downward Route Discovery and Maintenance</h3>

<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.1"></a><h3>6.2.1.&nbsp;
Overview</h3>

<p>Destination Advertisement operation produces DAO messages that
          flow up the DODAG, provisioning downward routing state for
          destination prefixes available in the sub-DODAG of the DODAG root,
          and possibly other nodes. The routing state provisioned with this
          mechanism is in the form of soft-state routing table entries. DAO
          messages are able to record loose source routing information as by
          propagate up the DODAG. This mechanism is flexible to support the
          provisioning of paths which consist of fully specified source
          routes, piecewise source routes, or hop-by-hop routes as according
          to the implementation and the capabilities of the nodes.
</p>
<p>Destination Advertisement may or may not be enabled over a DODAG
          rooted at a DODAG root. This is an a priori configuration determined
          by the implementation/deployment and not generally changed during
          the operation of the RPL LLN.
</p>
<p>When Destination Advertisement is enabled:
</p>
<p></p>
<ol class="text">
<li>Some nodes in the LLN MAY store at least one routing table
              entry for a particular destination learned from a DAO. Such a
              node is termed a 'storing node', with respect to that particular
              destination.
</li>
<li>Some nodes are capable to store at least one routing table
              entry for every unique destination observed from all DAOs that
              pass through. Such a node is termed a 'fully storing node'.
</li>
<li>DODAG roots nodes SHOULD be fully-storing nodes.
</li>
<li>Other nodes in the DODAG are not required to store routing
              table entries for any particular destinations observed in DAOs.
              Nodes that do not store routing table entries from DAOs are
              termed 'non-storing nodes', with respect to a particular
              destination.
</li>
<li>Non-storing nodes MUST participate in the construction of
              piecewise source routes as they propagate the DAO message, as
              described in <a class='info' href='#DAONonStoring'>Section&nbsp;6.2.5<span> (</span><span class='info'>Operation of DAO Non-storing Nodes</span><span>)</span></a>.
</li>
<li>Storing nodes MUST store any source route information
              received from the DAO (RRStack) in the routing table entry
              entry. If a node is not capable to do this then it must act as a
              non-storing node with respect to that particular
              destination.
</li>
<li>Storing nodes MUST use piecewise source routes in order to
              forward data across a non-storing region of the LLN. The source
              routing mechanism is to be described in a companion
              specification. (If a node is not capable to do this, then that
              node MUST NOT operate as a storing node).
</li>
</ol>

<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.2"></a><h3>6.2.2.&nbsp;
Mode of Operation</h3>

<p></p>
<ul class="text">
<li>DAO Operation may not be required for all use cases.
</li>
<li>Some applications may only need support for
              collection/upward/MP2P flow with no acknowledgement/reciprocal
              traffic.
</li>
<li>Some DODAGs may not support DAO Operation, which could mean
              that DAO Operation is wasteful overhead.
</li>
<li>As a special case, multicast DAO operation may be used to
              populate 'one-hop' neighborhood routing table entries, and is
              distinct from the unicast DAO operation used to establish
              downward routes along the DODAG.
</li>
</ul>

<p></p>
<ol class="text">
<li>The 'A' flag in the DIO as conveyed from the DODAG root
              serves to enable/disable DAO operation over the entire DODAG.
              This flag should be administratively provisioned a priori at the
              DODAG root as a function of the implementation/deployment and
              not tend to change.
</li>
<li>When DAO Operation is disabled, a node SHOULD NOT emit
              DAOs.
</li>
<li>When DAO Operation is disabled, a node MAY ignore received
              DAOs.
</li>
</ol>

<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.3"></a><h3>6.2.3.&nbsp;
Destination Advertisement Parents</h3>

<p></p>
<ul class="text">
<li>Nodes will select a subset of their DODAG Parents to whom
              DAOs will be sent
<ul class="text">
<li>This subset is the set of 'DAO Parents'
</li>
<li>Each DAO parent MUST be a DODAG Parent. (Not all DODAG
                  parents need to be DAO parents).
</li>
<li>Operation with more than DAO Parent requires
                  consideration of such issues as DAO fan-out and path
                  diversity, to be elaborated in a future version of this
                  specification.
</li>
</ul>
</li>
<li>The selection of DAO parents is implementation specific and
              may be based on selecting the DODAG Parents that offer the best
              upwards cost (as opposed to downwards or mixed), as determined
              by the metrics in use and the Objective Function.
</li>
<li>When DAO messages are unicast to the DAO Parent, the identity
              of the DAO Parent (DODAGID x DAGSequenceNumber) combined with
              the RPLInstanceID in the DAO message unambiguously associates
              the DAO message, and thus the particular destination prefix,
              with a DODAG Iteration.
</li>
<li>When DAO messages are unicast to the DAO Parent, the DAO Rank
              may be updated as according to the implementation and Objective
              Function in use to reflect the relative (aggregated) cost of
              reaching the Destination Prefix through that DAO parent. As a
              further extension, a DAO Suboption for the Metric Container may
              be included.
</li>
</ul>

<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4"></a><h3>6.2.4.&nbsp;
Operation of DAO Storing Nodes</h3>

<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1"></a><h3>6.2.4.1.&nbsp;
DAO Routing Table Entry</h3>

<p>A DAO Routing Table Entry conceptually contains the following
            elements:
</p>
<p></p>
<ul class="text">
<li>Advertising Neighbor Information 
<ul class="text">
<li>IPv6 Addr
</li>
<li>Interface ID
</li>
</ul>
</li>
<li>To which DAO Parents has this entry been reported
</li>
<li>Retry Counter
</li>
<li>Logical equivalent of DAO Content: 
<ul class="text">
<li>DAO Sequence
</li>
<li>DAO Rank
</li>
<li>DAO Lifetime
</li>
<li>Route tag (used to prioritize which destination entries
                    should be stored)
</li>
<li>Destination Prefix (or Address or Mcast Group)
</li>
<li>RR Stack*
</li>
</ul>
</li>
</ul>

<p>The DAO Routing Table Entry is logically associated with the
            following states:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>CONNECTED</dt>
<dd>This entry is 'owned' by the node - it
                is manually configured and is considered as a 'self' entry for
                DAO Operation
</dd>
<dt>REACHABLE</dt>
<dd>This entry has been reported from a
                neighbor of the node. This state includes the following
                substates: 
<blockquote class="text"><dl>
<dt>CONFIRMED</dt>
<dd>This entry is active, newly
                    validated, and usable
</dd>
<dt>PENDING</dt>
<dd>This entry is active, awaiting
                    validation, and usable. A Retry Counter is associated with
                    this substate
</dd>
</dl></blockquote>
</dd>
<dt>UNREACHABLE</dt>
<dd>This entry is being cleaned up. This
                entry may be suppressed when the cleanup process is
                complete.
</dd>
</dl></blockquote>

<p>When an attempt is to be made to report the DAO entry to DAO
            Parents, the DAO Entry record is logically marked to indicate that
            an attempt has not yet been made for parent. As the unicast
            attempts are completed for each parent, this mark may be cleared.
            This mechanism may serve to limit DAO entry updates for each
            parent to a subset that needs to be reported.
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1"></a><h3>6.2.4.1.1.&nbsp;
DAO Routing Table Entry Management</h3>
<br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

        +---------------------------------+
        |                                 |
        |            REACHABLE            |    +-------------+
        |                                 |    |             |
        |        +-----------+            |    |  CONNECTED  |
  (*)-----------&gt;|           |-------+    |    |             |
        |        | Confirmed |       |    |    +-------------+
        |    +--&gt;|           |---+   |    |
        |    |   +-----------+   |   |    |
        |    |                   |   |    |
        |    |                   |   |    |
        |    |                   |   |    |
        |    |   +-----------+   |   |    |    +-------------+
        |    |   |           |&lt;--+   +--------&gt;|             |
        |    +---|  Pending  |            |    | UNREACHABLE |
        |        |           |----------------&gt;|             |---&gt;(*)
        |        +-----------+            |    +-------------+
        |                                 |
        +---------------------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;DAO Routing Table Entry FSM&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1.1"></a><h3>6.2.4.1.1.1.&nbsp;
Operation in the CONNECTED state</h3>

<p></p>
<ol class="text">
<li>CONNECTED DAO entries are to be provisioned outside of
                    the context of RPL, e.g. through a management API. An
                    implementation SHOULD provide a means to provision/manage
                    CONNECTED DAO entries, including whether they are to be
                    redistributed in RPL.
</li>
</ol>

<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1.2"></a><h3>6.2.4.1.1.2.&nbsp;
Operation in the REACHABLE state</h3>

<p></p>
<ol class="text">
<li>When a REACHABLE(*) entry times out, the entry MUST be
                    placed into the UNREACHABLE state and no-DAO SHOULD be
                    scheduled to send to the node's DAO Parents. (TBD
                    MUST?)
</li>
<li>When a no-DAO for a REACHABLE(*) entry is received with
                    a newer DAO Sequence Number, the entry MUST be placed into
                    the UNREACHABLE state and no-DAO SHOULD be scheduled to
                    send to the node's DAO Parents.
</li>
<li>When a REACHABLE(*) entry is to be removed because NUD
                    or equivalent has determined that the next-hop neighbor is
                    no longer reachable, the entry MUST be placed into the
                    UNREACHABLE state and no-DAO SHOULD be scheduled to send
                    to the node's DAO Parents.
</li>
<li>When a REACHABLE(*) entry is to be removed because an
                    associated Forwarding Error has been returned by the
                    next-hop neighbor, the entry MUST be placed into the
                    UNREACHABLE state and no-DAO SHOULD be scheduled to send
                    to the node's DAO Parents.
</li>
<li>When a DAO (or no-DAO) for a REACHABLE(*) entry is
                    received with an older or unchanged DAO Sequence Number,
                    then the DAO (or no-DAO) SHOULD be ignored and the
                    associated entry MUST NOT be updated with the stale
                    information.
</li>
</ol>

<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1.2.1"></a><h3>6.2.4.1.1.2.1.&nbsp;
REACHABLE(Confirmed)</h3>

<p></p>
<ol class="text">
<li>When a DAO for a previously unknown (or UNREACHABLE)
                      destination is received and is to be stored, it MUST be
                      entered into the routing table in the
                      REACHABLE(Confirmed) state. Alternately the node may
                      behave as a non-storing node with respect to this
                      destination.
</li>
<li>When a DAO for a REACHABLE(Confirmed) entry is
                      received with a newer DAO Sequence Number the entry MUST
                      be updated with the logical equivalent of the DAO
                      contents.
</li>
<li>When a DAO for a REACHABLE(Confirmed) entry is
                      expected, e.g. because a DIO to request a DAO refresh is
                      sent, then the DAO entry MUST be placed in the
                      REACHABLE(Pending) state and the associated Retry
                      Counter MUST be set to 0.
</li>
</ol>

<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1.2.2"></a><h3>6.2.4.1.1.2.2.&nbsp;
REACHABLE(Pending)</h3>

<p></p>
<ol class="text">
<li>When a DAO for a REACHABLE(Pending) entry is received
                      with a newer DAO Sequence Number, the entry MUST be
                      updated with the logical equivalent of the DAO contents
                      and the entry MUST be placed in the REACHABLE(Confirmed)
                      state.
</li>
<li>When a DAO for a REACHABLE(Pending) entry is
                      expected, e.g. because DAO has (again) been triggered
                      with respect to that neighbor, then the associated Retry
                      Counter MUST be incremented.
</li>
<li>When a the associated Retry Counter for a
                      REACHABLE(Pending) entry reaches a maximum threshold,
                      the entry MUST be placed into the UNREACHABLE state and
                      no-DAO SHOULD be scheduled to send to the node's DAO
                      Parents.
</li>
</ol>

<a name="DAOUnreachable"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.4.1.1.3"></a><h3>6.2.4.1.1.3.&nbsp;
Operation in the UNREACHABLE state</h3>

<p></p>
<ol class="text">
<li>An implementation SHOULD bound the time that the entry
                    is allocated in the UNREACHABLE state. Upon the equivalent
                    expiry of the related timer (RemoveTimer), the entry
                    SHOULD be suppressed.
</li>
<li>While the entry is in the UNREACHABLE state a node
                    SHOULD make a reasonable attempt to report a no-DAO to
                    each of the DAO parents.
</li>
<li>When the node has completed an attempt to report a
                    no-DAO to each of the DAO parents, the entry SHOULD be
                    suppressed.
</li>
</ol>

<a name="DAONonStoring"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.5"></a><h3>6.2.5.&nbsp;
Operation of DAO Non-storing Nodes</h3>

<p></p>
<ol class="text">
<li>When a DAO is received from a child by a node who will not
              store a routing table entry for the DAO, the node MUST schedule
              to pass the DAO contents along to its DAO parents. Prior to
              passing the DAO along, the node MUST process the DAO as follows,
              in order that information necessary to construct a loose source
              route may be accumulated within the DAO payload as it moves up
              the DODAG:
<ol class="text">
<li>The most recent addition to the RRStack (the 'next
                  waypoint') is investigated to determine if the node already
                  has a route provisioned to the waypoint. If the node already
                  has such a route, then it is not necessary to add additional
                  information to the RRStack. The node SHOULD NOT modify the
                  RRStack further.
</li>
<li>If the node does not have a route provisioned to the next
                  waypoint, then the node MUST append the address of the child
                  to the RRStack, and increment RRCount.
</li>
</ol>
</li>
</ol>

<a name="ScheduleDAO"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.6"></a><h3>6.2.6.&nbsp;
Scheduling to Send DAO (or no-DAO)</h3>

<p></p>
<ol class="text">
<li>An implementation SHOULD arrange to rate-limit the sending of
              DAOs.
</li>
<li>When scheduling to send a DAO, an implementation SHOULD
              equivalently start a timer (DelayDAO) to delay sending the DAO.
              If the timer has already been armed then the DAO may be
              considered as already scheduled, and implementation SHOULD leave
              the timer running at its present duration.
</li>
</ol>

<p></p>
<ul class="text">
<li>In order to increase the effectiveness of aggregation, an
              implementation MAY allow time to receive no-DAOs from its
              sub-DODAG prior to emitting DAOs to its DAO Parents. 
<ul class="text">
<li>The scheduled delay in such cases may be, for example,
                  such that DAO_LATENCY/f(self_rank) &lt;= delay &lt;
                  DAO_LATENCY/f(parent_rank), where f(rank) is
                  floor(rank/MinHopRankIncrease), such that nodes deeper in
                  the DODAG may tend to report DAO messages first before their
                  parent nodes will report DAO messages. Note that this
                  suggestion is intended as an optimization to allow efficient
                  aggregation -- it is not required for correct operation in
                  the general case.
</li>
</ul>
</li>
</ul>

<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.7"></a><h3>6.2.7.&nbsp;
Triggering DAO Message from the Sub-DODAG</h3>

<p>Note: The DIO is modified to add a 'S' flag, which is used to
          indicate if a non-root ancestor storing routing table entries
          learned from DAOs. This allows an optimization in the case where
          ONLY the root node is storing such routing table entries, then it is
          not necessary for an intermediate node to trigger DAO messages from
          its sub-DODAG when it changes its DAO Parent.
</p>
<p></p>
<ol class="text">
<li>The DODAG root MUST clear the 'S' flag when it emits DIO
              messages.
</li>
<li>Non-root nodes that store routing table entries learned from
              DAOs MUST set the 'S' flag when they emit DIO messages.
</li>
<li>A node that has any DAO Parent with the 'S' flag set MUST
              also set the 'S' flag when it emits DIO messages.
</li>
<li>A node that has all DAO Parents with cleared 'S' flags MUST
              clear the 'S' flag when it emits DIO messages.
</li>
<li>A DAO Trigger Sequence Number (DTSN) MUST be maintained by
              each node per RPL Instance. The DTSN, in conjunction with the
              'T' flag from the DIO message, provides a means by which DAO
              messages may be reliably triggered in the event of topology
              change.
</li>
<li>The DTSN MUST be advertised by the node in the DIO
              message.
</li>
<li>A node keeps track of the DTSN that it has heard from the
              last DIO from each of its DAO Parents. Note that there is one
              DTSN maintained per DAO Parent-- each DAO Parent may
              independently increment it at will. (TBD A change to DTSN does
              not indicate DAG inconsistency?).
</li>
<li>A node that is not a fully-storing node SHOULD increment its
              own DTSN when it adds a new parent, that parent having the 'S'
              flag set, to its DAO Parent set. It MAY defer advertising the
              increment as long as it has a DAO parent that already provides
              adequate connectivity.
</li>
<li>A node that is not a fully-storing node MUST increment its
              own DTSN when it receives a DIO from a DAO Parent that contains
              a newly incremented DTSN. (The newly incremented DTSN is
              detected by comparing the value received in the DIO with the
              value last recorded for that DAO parent).
</li>
<li>A fully-storing node MUST increment its own DTSN when it
              receives a DIO from a DAO Parent that contains a newly
              incremented DTSN and a set 'T' flag.
</li>
<li>When a storing or non-storing node joins a new DODAG
              iteration, it SHOULD increment its DTSN as if the 'T' flag has
              been set.
</li>
<li>DAO Transmission SHOULD be scheduled when a new parent is
              added to the DAO Parent set.
</li>
<li>A node that receives a newly incremented DTSN from a DAO
              Parent MUST schedule a DAO transmission.
</li>
</ol>

<p></p>
<ul class="text">
<li>When a node that is not fully-storing sees a DTSN increment,
              it will increment its own DTSN. This will cause the DTSN
              increment to extend down the DODAG to the first fully-storing
              node, which will send its DAOs back up, rebuilding source routes
              information along the way to the first node that incremented the
              DTSN, who then may report the new DAO information to its new
              parent.
</li>
<li>When a fully-storing node sees a DTSN increment, it is caused
              to reissue its entire set of routing table entries learned from
              DAOs (or an aggregated subset thereof), but will not need to
              increment its own DTSN. The 'DTSN increment wave' stops when it
              encounters fully-storing nodes.
</li>
<li>When a fully-storing node sees a DTSN increment AND the 'T'
              flag is set, it does increment its own DTSN as well. The 'T'
              flag 'punches through' all nodes, causing all routing tables in
              the entire sub-DODAG to be refreshed.
</li>
</ul>

<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.8"></a><h3>6.2.8.&nbsp;
Sending DAO Messages to DAO Parents</h3>

<p></p>
<ol class="text">
<li>When storing nodes send DAO messages for stored entries the
              RRStack SHOULD be cleared in the DAO message.
</li>
<li>DAO Messages sent to DAO Parents MUST be unicast.
<ul class="text">
<li>The IPv6 Source Address is the node sending the DAO
                  message.
</li>
<li>The IPv6 Destination Address is DAO parent.
</li>
</ul>
</li>
<li>When the appointed time arrives (DelayDAO) for the
              transmission of DAO messages (with jitter as appropriate) for
              the requested entries, the implementation MAY aggregate the the
              entries into a reduced numbers of DAOs to be reported to each
              parent, and perform compression if possible.
</li>
<li>Note: it is NOT RECOMMENDED that a DAO Transmission (No-DAO)
              be scheduled when a DAO Parent is removed from the DAO Parent
              set.
</li>
</ol>

<a name="MulticastDAO"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2.9"></a><h3>6.2.9.&nbsp;
Multicast Destination Advertisement Messages</h3>

<p>A special case of DAO operation, distinct from unicast DAO
          operation, is multicast DAO operation which may be used to populate
          '1-hop' routing table entries.
</p>
<p></p>
<ol class="text">
<li>A node MAY multicast a DAO message to the link-local scope
              all-nodes multicast address FF02::1.
</li>
<li>A multicast DAO message MUST be used only to advertise
              information about self, i.e. prefixes directly connected to or
              owned by this node, such as a multicast group that the node is
              subscribed to or a global address owned by the node.
</li>
<li>A multicast DAO message MUST NOT be used to relay
              connectivity information learned (e.g. through unicast DAO) from
              another node.
</li>
<li>Information obtained from a multicast DAO MAY be installed in
              the routing table and MAY be propagated by a node in unicast
              DAOs.
</li>
<li>A node MUST NOT perform any other DAO related processing on a
              received multicast DAO, in particular a node MUST NOT perform
              the actions of a DAO parent upon receipt of a multicast DAO.
</li>
</ol>

<p></p>
<ul class="text">
<li>The multicast DAO may be used to enable direct P2P
              communication, without needing the RPL routing structure to
              relay the packets.
</li>
<li>The multicast DAO does not presume any DODAG relationship
              between the emitter and the receiver.
</li>
</ul>

<a name="forwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Packet Forwarding and Loop Avoidance/Detection</h3>

<a name="PacketForwarding"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Suggestions for Packet Forwarding</h3>

<p>When forwarding a packet to a destination, precedence is given to
        selection of a next-hop successor as follows:
</p>
<p></p>
<ol class="text">
<li>In the scope of this specification, it is preferred to select a
            successor from a DODAG iteration that matches the RPLInstanceID
            marked in the IPv6 header of the packet being forwarded.
</li>
<li>If a local administrative preference favors a route that has
            been learned from a different routing protocol than RPL, then use
            that successor.
</li>
<li>If there is an entry in the routing table matching the
            destination that has been learned from a multicast destination
            advertisement (e.g. the destination is a one-hop neighbor), then
            use that successor.
</li>
<li>If there is an entry in the routing table matching the
            destination that has been learned from a unicast destination
            advertisement (e.g. the destination is located down the
            sub-DODAG), then use that successor.
</li>
<li>If there is a DODAG iteration offering a route to a prefix
            matching the destination, then select one of those DODAG parents
            as a successor.
</li>
<li>If there is a DODAG parent offering a default route then select
            that DODAG parent as a successor.
</li>
<li>If there is a DODAG iteration offering a route to a prefix
            matching the destination, but all DODAG parents have been tried
            and are temporarily unavailable (as determined by the forwarding
            procedure), then select a DODAG sibling as a successor.
</li>
<li>Finally, if no DODAG siblings are available, the packet is
            dropped. ICMP Destination Unreachable may be invoked. An
            inconsistency is detected.
</li>
</ol>

<p>TTL MUST be decremented when forwarding. If the packet is being
        forwarded via a sibling, then the TTL MAY be decremented more
        aggressively (by more than one) to limit the impact of possible
        loops.
</p>
<p>Note that the chosen successor MUST NOT be the neighbor that was
        the predecessor of the packet (split horizon), except in the case
        where it is intended for the packet to change from an up to an down
        flow, such as switching from DIO routes to DAO routes as the
        destination is neared.
</p>
<a name="loopdetect"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Loop Avoidance and Detection</h3>

<p>RPL loop avoidance mechanisms are kept simple and designed to
        minimize churn and states. Loops may form for a number of reasons,
        from control packet loss to sibling forwarding. RPL includes a
        reactive loop detection technique that protects from meltdown and
        triggers repair of broken paths.
</p>
<p>RPL loop detection uses information that is placed into the packet
        in the IPv6 flow label. The IPv6 flow label is defined in <a class='info' href='#RFC2460'>[RFC2460]<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> and its operation is further specified in
        <a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a>. For the purpose of RPL operations, the
        flow label is constructed as follows:
</p>
<p><br /><hr class="insert" />
<a name="flowlabel"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
     0                   1                   2
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            |O|S|R|F|  SenderRank   | RPLInstanceID |
            +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;12: RPL Flow Label&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

</p>
<p></p>
<blockquote class="text"><dl>
<dt>Down 'O' bit:</dt>
<dd>1-bit flag indicating whether the
            packet is expected to progress up or down. A router sets the 'O'
            bit when the packet is expect to progress down (using DAO routes),
            and resets it when forwarding towards the root of the DODAG
            iteration. A host MUST set the bit to 0.
</dd>
<dt>Sibling 'S' bit:</dt>
<dd>1-bit flag indicating whether the
            packet has been forwarded via a sibling at the present rank, and
            denotes a risk of a sibling loop. A host sets the bit to 0.
</dd>
<dt>Rank-Error 'R' bit:</dt>
<dd>1-bit flag indicating whether a
            rank error was detected. A rank error is detected when there is a
            mismatch in the relative ranks and the direction as indicated in
            the 'O' bit. A host MUST set the bit to 0.
</dd>
<dt>Forwarding-Error 'F' bit:</dt>
<dd>1-bit flag indicating that
            this node can not forward the packet further towards the
            destination. The 'F' bit might be set by sibling that can not
            forward to a parent a packet with the Sibling 'S' bit set, or by a
            child node that does not have a route to destination for a packet
            with the down 'O' bit set. A host MUST set the bit to 0.
</dd>
<dt>SenderRank:</dt>
<dd>8-bit field set to zero by the source
            and to its rank by a router that forwards inside the RPL
            network.
</dd>
<dt>RPLInstanceID:</dt>
<dd>8-bit field indicating the DODAG
            instance along which the packet is sent.
</dd>
</dl></blockquote>

<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.1"></a><h3>7.2.1.&nbsp;
Source Node Operation</h3>

<p>A packet that is sourced at a node connected to a RPL network or
          destined to a node connected to a RPL network MUST be issued with
          the flow label zeroed out, but for the RPLInstanceID field.
</p>
<p>If the source is aware of the RPLInstanceID that is preferred for
          the flow, then it MUST set the RPLInstanceID field in the flow label
          accordingly, otherwise it MUST set it to the
          RPL_DEFAULT_INSTANCE.
</p>
<p>If a compression mechanism such as 6LoWPAN is applied to the
          packet, the flow label MUST NOT be compressed even if it is set to
          all zeroes.
</p>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2"></a><h3>7.2.2.&nbsp;
Router Operation</h3>

<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.1"></a><h3>7.2.2.1.&nbsp;
Conformance to RFC 3697</h3>

<p><a class='info' href='#RFC3697'>[RFC3697]<span> (</span><span class='info'>Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;IPv6 Flow Label Specification,&rdquo; March&nbsp;2004.</span><span>)</span></a> mandates that the Flow Label
            value set by the source MUST be delivered unchanged to the
            destination node(s).
</p>
<p>In order to restore the flow label to its original value, an
            RPL router that delivers a packet to a destination connected to a
            RPL network or that routes a packet outside the RPL network MUST
            zero out all the fields but the RPLInstanceID field that must be
            delivered without a change.
</p>
<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.2"></a><h3>7.2.2.2.&nbsp;
Instance Forwarding</h3>

<p>Instance IDs are used to avoid loops between DODAGs from
            different origins. DODAGs that constructed for antagonistic
            constraints might contain paths that, if mixed together, would
            yield loops. Those loops are avoided by forwarding a packet along
            the DODAG that is associated to a given instance.
</p>
<p>The RPLInstanceID is placed by the source in the flow label.
            This RPLInstanceID MUST match the RPL Instance onto which the
            packet is placed by any node, be it a host or router.
</p>
<p>When a router receives a packet that is flagged with a given
            RPLInstanceID and the node can forward the packet along the DODAG
            associated to that instance, then the router MUST do so and leave
            the RPLInstanceID flag unchanged.
</p>
<p>If any node can not forward a packet along the DODAG associated
            to the RPLInstanceID in the flow label, then the node SHOULD
            discard the packet.
</p>
<a name="anchor53"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.3"></a><h3>7.2.2.3.&nbsp;
DAG Inconsistency Loop Detection</h3>

<p>The DODAG is inconsistent if the direction of a packet does not
            match the rank relationship. A receiver detects an inconsistency
            if it receives a packet with either: </p>
<blockquote class="text">
<p>the 'O' bit set (to down) from a node of a higher rank.
</p>
<p>the 'O' bit reset (for up) from a node of a lesser
                rank.
</p>
<p>the 'S' bit set (to sibling) from a node of a different
                rank.
</p>
</blockquote>

<p>When the DODAG root increments the DODAGSequenceNumber a
            temporary rank discontinuity may form between the next iteration
            and the prior iteration, in particular if nodes are adjusting
            their rank in the next iteration and deferring their migration
            into the next iteration. A router that is still a member of the
            prior iteration may choose to forward a packet to a (future)
            parent that is in the next iteration. In some cases this could
            cause the parent to detect an inconsistency because the
            rank-ordering in the prior iteration is not necessarily the same
            as in the next iteration and the packet may be judged to not be
            making forward progress. If the sending router is aware that the
            chosen successor has already joined the next iteration, then the
            sending router MUST update the SenderRank to INFINITE_RANK as it
            forwards the packets across the discontinuity into the next DODAG
            iteration in order to avoid a false detection of rank
            inconsistency.
</p>
<p>One inconsistency along the path is not considered as a
            critical error and the packet may continue. But a second detection
            along the path of a same packet should not occur and the packet is
            dropped.
</p>
<p>This process is controlled by the Rank-Error bit in the Flow
            Label. When an inconsistency, is detected on a packet, if the
            Rank-Error bit was not set then the Rank-Error bit is set. If it
            was set the packet is discarded and the trickle timer is
            reset.
</p>
<a name="anchor54"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.4"></a><h3>7.2.2.4.&nbsp;
Sibling Loop Avoidance</h3>

<p>When a packet is forwarded along siblings, it cannot be checked
            for forward progress and may loop between siblings. Experimental
            evidence has shown that one sibling hop can be very useful but is
            generally sufficient to avoid loops. Based on that evidence, this
            specification enforces the simple rule that a packet may not make
            2 sibling hops in a row.
</p>
<p>When a host issues a packet or when a router forwards a packet
            to a non-sibling, the Sibling bit in the packet must be reset.
            When a router forwards to a sibling: if the Sibling bit was not
            set then the Sibling bit is set. If the Sibling bit was set then
            then the router SHOULD return the packet to the sibling that that
            passed it with the Forwarding-Error 'F' bit set.
</p>
<a name="anchor55"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.5"></a><h3>7.2.2.5.&nbsp;
DAO Inconsistency Loop Detection and Recovery</h3>

<p>A DAO inconsistency happens when router that has an down DAO
            route via a child that is a remnant from an obsolete state that is
            not matched in the child. With DAO inconsistency loop recovery, a
            packet can be used to recursively explore and cleanup the obsolete
            DAO states along a sub-DODAG.
</p>
<p>In a general manner, a packet that goes down should never go up
            again. So rather than routing up a packet with the down bit set,
            the router MUST discard the packet. If DAO inconsistency loop
            recovery is applied, then the router SHOULD send the packet to the
            parent that passed it with the Forwarding-Error 'F' bit set.
</p>
<a name="anchor56"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2.2.6"></a><h3>7.2.2.6.&nbsp;
Forward Path Recovery</h3>

<p>Upon receiving a packet with a Forwarding-Error bit set, the
            node MUST remove the routing states that caused forwarding to that
            neighbor, clear the Forwarding-Error bit and attempt to send the
            packet again. The packet may its way to an alternate neighbor. If
            that alternate neighbor still has an inconsistent DAO state via
            this node, the process will recurse, this node will set the
            Forwarding-Error 'F' bit and the routing state in the alternate
            neighbor will be cleaned up as well.
</p>
<a name="anchor57"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Multicast Operation</h3>

<p>This section describes further the multicast routing operations over
      an IPv6 RPL network, and specifically how unicast DAOs can be used to
      relay group registrations up. Wherever the following text mentions MLD,
      one can read MLDv2 or v3.
</p>
<p>As is traditional, a listener uses a protocol such as MLD with a
      router to register to a multicast group.
</p>
<p>Along the path between the router and the DODAG root, MLD requests
      are mapped and transported as DAO messages within the RPL protocol; each
      hop coalesces the multiple requests for a same group as a single DAO
      message to the parent(s), in a fashion similar to proxy IGMP, but
      recursively between child router and parent up to the root.
</p>
<p>A router might select to pass a listener registration DAO message to
      its preferred parent only, in which case multicast packets coming back
      might be lost for all of its sub-DODAG if the transmission fails over
      that link. Alternatively the router might select to copy additional
      parents as it would do for DAO messages advertising unicast
      destinations, in which case there might be duplicates that the router
      will need to prune.
</p>
<p>As a result, multicast routing states are installed in each router on
      the way from the listeners to the root, enabling the root to copy a
      multicast packet to all its children routers that had issued a DAO
      message including a DAO for that multicast group, as well as all the
      attached nodes that registered over MLD.
</p>
<p>For unicast traffic, it is expected that the grounded root of an
      DODAG terminates RPL and MAY redistribute the RPL routes over the
      external infrastructure using whatever routing protocol is used there.
      For multicast traffic, the root MAY proxy MLD for all the nodes attached
      to the RPL routers (this would be needed if the multicast source is
      located in the external infrastructure). For such a source, the packet
      will be replicated as it flows down the DODAG based on the multicast
      routing table entries installed from the DAO message.
</p>
<p>For a source inside the DODAG, the packet is passed to the preferred
      parents, and if that fails then to the alternates in the DODAG. The
      packet is also copied to all the registered children, except for the one
      that passed the packet. Finally, if there is a listener in the external
      infrastructure then the DODAG root has to further propagate the packet
      into the external infrastructure.
</p>
<p>As a result, the DODAG Root acts as an automatic proxy Rendezvous
      Point for the RPL network, and as source towards the Internet for all
      multicast flows started in the RPL LLN. So regardless of whether the
      root is actually attached to the Internet, and regardless of whether the
      DODAG is grounded or floating, the root can serve inner multicast
      streams at all times.
</p>
<a name="MaintenanceRoutingAdjacency"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Maintenance of Routing Adjacency</h3>

<p>The selection of successors, along the default paths up along the
      DODAG, or along the paths learned from destination advertisements down
      along the DODAG, leads to the formation of routing adjacencies that
      require maintenance.
</p>
<p>In IGPs such as OSPF <a class='info' href='#RFC4915'>[RFC4915]<span> (</span><span class='info'>Psenak, P., Mirtorabi, S., Roy, A., Nguyen, L., and P. Pillay-Esnault, &ldquo;Multi-Topology (MT) Routing in OSPF,&rdquo; June&nbsp;2007.</span><span>)</span></a> or IS-IS <a class='info' href='#RFC5120'>[RFC5120]<span> (</span><span class='info'>Przygienda, T., Shen, N., and N. Sheth, &ldquo;M-ISIS: Multi Topology (MT) Routing in Intermediate System to Intermediate Systems (IS-ISs),&rdquo; February&nbsp;2008.</span><span>)</span></a>, the maintenance of a routing adjacency
      involves the use of Keepalive mechanisms (Hellos) or other protocols
      such as BFD (<a class='info' href='#I-D.ietf-bfd-base'>[I&#8209;D.ietf&#8209;bfd&#8209;base]<span> (</span><span class='info'>Katz, D. and D. Ward, &ldquo;Bidirectional Forwarding Detection,&rdquo; January&nbsp;2010.</span><span>)</span></a>) and MANET
      Neighborhood Discovery Protocol (NHDP <a class='info' href='#I-D.ietf-manet-nhdp'>[I&#8209;D.ietf&#8209;manet&#8209;nhdp]<span> (</span><span class='info'>Clausen, T., Dearlove, C., and J. Dean, &ldquo;Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP),&rdquo; March&nbsp;2010.</span><span>)</span></a>). Unfortunately, such an approach
      is not desirable in constrained environments such as LLN and would lead
      to excessive control traffic in light of the data traffic with a
      negative impact on both link loads and nodes resources. Overhead to
      maintain the routing adjacency should be minimized. Furthermore, it is
      not always possible to rely on the link or transport layer to provide
      information of the associated link state. The network layer needs to
      fall back on its own mechanism.
</p>
<p>Thus RPL makes use of a different approach consisting of probing the
      neighbor using a Neighbor Solicitation message (see <a class='info' href='#RFC4861'>[RFC4861]<span> (</span><span class='info'>Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;Neighbor Discovery for IP version 6 (IPv6),&rdquo; September&nbsp;2007.</span><span>)</span></a>). The reception of a Neighbor Advertisement
      (NA) message with the "Solicited Flag" set is used to verify the
      validity of the routing adjacency. Such mechanism MAY be used prior to
      sending a data packet. This allows for detecting whether or not the
      routing adjacency is still valid, and should it not be the case, select
      another feasible successor to forward the packet.
</p>
<a name="anchor58"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Guidelines for Objective Functions</h3>

<p>An Objective Function (OF) allows for the selection of a DODAG to
      join, and a number of peers in that DODAG as parents. The OF is used to
      compute an ordered list of parents. The OF is also responsible to
      compute the rank of the device within the DODAG iteration.
</p>
<p>The Objective Function is indicated in the DIO message using an
      Objective Code Point (OCP), as specified in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>, and indicates the method
      that must be used to compute the DODAG (e.g. "minimize the path cost
      using the ETX metric and avoid 'Blue' links"). The Objective Code Points
      are specified in <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>,
      <a class='info' href='#I-D.ietf-roll-of0'>[I&#8209;D.ietf&#8209;roll&#8209;of0]<span> (</span><span class='info'>Thubert, P., &ldquo;RPL Objective Function 0,&rdquo; February&nbsp;2010.</span><span>)</span></a>, and related companion
      specifications.
</p>
<p>Most Objective Functions are expected to follow the same abstract
      behavior: </p>
<ul class="text">
<li>The parent selection is triggered each time an event indicates
          that a potential next hop information is updated. This might happen
          upon the reception of a DIO message, a timer elapse, or a trigger
          indicating that the state of a candidate neighbor has changed.
</li>
<li>An OF scans all the interfaces on the device. Although there may
          typically be only one interface in most application scenarios, there
          might be multiple of them and an interface might be configured to be
          usable or not for RPL operation. An interface can also be configured
          with a preference or dynamically learned to be better than another
          by some heuristics that might be link-layer dependent and are out of
          scope. Finally an interface might or not match a required criterion
          for an Objective Function, for instance a degree of security. As a
          result some interfaces might be completely excluded from the
          computation, while others might be more or less preferred.
</li>
<li>An OF scans all the candidate neighbors on the possible
          interfaces to check whether they can act as a router for a DODAG.
          There might be multiple of them and a candidate neighbor might need
          to pass some validation tests before it can be used. In particular,
          some link layers require experience on the activity with a router to
          enable the router as a next hop.
</li>
<li>An OF computes self's rank by adding to the rank of the candidate
          a value representing the relative locations of self and the
          candidate in the DODAG iteration.
<ul class="text">
<li>The increase in rank must be at least MinHopRankIncrease.
              (This prevents the creation of a path of sibling links
              connecting a child with its parent.)
</li>
<li>To keep loop avoidance and metric optimization in alignment,
              the increase in rank should reflect any increase in the metric
              value. For example, with a purely additive metric such as ETX,
              the increase in rank can be made proportional to the increase in
              the metric.
</li>
<li>Candidate neighbors that would cause self's rank to increase
              are ignored
</li>
</ul>
</li>
<li>Candidate neighbors that advertise an OF incompatible with the
          set of OF specified by the policy functions are ignored.
</li>
<li>As it scans all the candidate neighbors, the OF keeps the current
          best parent and compares its capabilities with the current candidate
          neighbor. The OF defines a number of tests that are critical to
          reach the objective. A test between the routers determines an order
          relation. 
<ul class="text">
<li>If the routers are roughly equal for that relation then the
              next test is attempted between the routers,
</li>
<li>Else the best of the 2 becomes the current best parent and
              the scan continues with the next candidate neighbor
</li>
<li>Some OFs may include a test to compare the ranks that would
              result if the node joined either router
</li>
</ul>
</li>
<li>When the scan is complete, the preferred parent is elected and
          self's rank is computed as the preferred parent rank plus the step
          in rank with that parent.
</li>
<li>Other rounds of scans might be necessary to elect alternate
          parents and siblings. In the next rounds: 
<ul class="text">
<li>Candidate neighbors that are not in the same DODAG are
              ignored
</li>
<li>Candidate neighbors that are of greater rank than self are
              ignored
</li>
<li>Candidate neighbors of an equal rank to self (siblings) are
              ignored
</li>
<li>Candidate neighbors of a lesser rank than self (non-siblings)
              are preferred
</li>
</ul>
</li>
</ul>

<a name="anchor59"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
RPL Constants and Variables</h3>

<p>Following is a summary of RPL constants and variables. Some default
      values are to be determined in companion applicability statements.
</p>
<p></p>
<blockquote class="text"><dl>
<dt>ZERO_LIFETIME</dt>
<dd>This is the special value of a lifetime
          that indicates immediate death and removal. ZERO_LIFETIME has a
          value of 0.
</dd>
<dt>BASE_RANK</dt>
<dd>This is the rank for a virtual root that
          might be used to coordinate multiple roots. BASE_RANK has a value of
          0.
</dd>
<dt>ROOT_RANK</dt>
<dd>This is the rank for a DODAG root. ROOT_RANK
          has a value of 1.
</dd>
<dt>INFINITE_RANK</dt>
<dd>This is the constant maximum for the
          rank. INFINITE_RANK has a value of 0xFF.
</dd>
<dt>RPL_DEFAULT_INSTANCE</dt>
<dd>This is the RPLInstanceID that is
          used by this protocol by a node without any overriding policy.
          RPL_DEFAULT_INSTANCE has a value of 0.
</dd>
<dt>DEFAULT_DIO_INTERVAL_MIN</dt>
<dd>To be determined
</dd>
<dt>DEFAULT_DIO_INTERVAL_DOUBLINGS</dt>
<dd>To be determined
</dd>
<dt>DEFAULT_DIO_REDUNDANCY_CONSTANT</dt>
<dd>To be determined
</dd>
<dt>DEF_DAO_LATENCY</dt>
<dd>To be determined
</dd>
<dt>MAX_DESTROY_INTERVAL</dt>
<dd>To be determined
</dd>
<dt>DIO Timer</dt>
<dd>One instance per DODAG that a node is a
          member of. Expiry triggers DIO message transmission. Trickle timer
          with variable interval in [0,
          DIOIntervalMin..2^DIOIntervalDoublings]. See <a class='info' href='#TrickleImplementation'>Section&nbsp;5.3.5.1<span> (</span><span class='info'>Trickle Timer for DIO Transmission</span><span>)</span></a>
</dd>
<dt>DAG Sequence Number Increment Timer</dt>
<dd>Up to one instance
          per DODAG that the node is acting as DODAG root of. May not be
          supported in all implementations. Expiry triggers revision of
          DODAGSequenceNumber, causing a new series of updated DIO message to
          be sent. Interval should be chosen appropriate to propagation time
          of DODAG and as appropriate to application requirements (e.g.
          response time vs. overhead).
</dd>
<dt>DelayDAO Timer</dt>
<dd>Up to one instance per DAO parent (the
          subset of DODAG parents chosen to receive destination
          advertisements) per DODAG. Expiry triggers sending of DAO message to
          the DAO parent. See <a class='info' href='#ScheduleDAO'>Section&nbsp;6.2.6<span> (</span><span class='info'>Scheduling to Send DAO (or no-DAO)</span><span>)</span></a>
</dd>
<dt>RemoveTimer</dt>
<dd>Up to one instance per DAO entry per
          neighbor (i.e. those neighbors that have given DAO messages to this
          node as a DODAG parent) Expiry triggers a change in state for the
          DAO entry, setting up to do unreachable (No-DAO) advertisements or
          immediately deallocating the DAO entry if there are no DAO parents.
          See <a class='info' href='#DAOUnreachable'>Section&nbsp;6.2.4.1.1.3<span> (</span><span class='info'>Operation in the UNREACHABLE state</span><span>)</span></a>
</dd>
</dl></blockquote>

<a name="Manageability"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Manageability Considerations</h3>

<p>The aim of this section is to give consideration to the manageability
      of RPL, and how RPL will be operated in LLN beyond the use of a MIB
      module. The scope of this section is to consider the following aspects
      of manageability: fault management, configuration, accounting and
      performance.
</p>
<a name="anchor60"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Control of Function and Policy</h3>

<a name="anchor61"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.1"></a><h3>12.1.1.&nbsp;
Initialization Mode</h3>

<p>When a node is first powered up, it may either choose to stay
          silent and not send any multicast DIO message until it has joined a
          DODAG, or to immediately root a transient DODAG and start sending
          multicast DIO messages. A RPL implementation SHOULD allow
          configuring whether the node should stay silent or should start
          advertising DIO messages.
</p>
<p>Furthermore, the implementation SHOULD to allow configuring
          whether or not the node should start sending an DIS message as an
          initial probe for nearby DODAGs, or should simply wait until it
          received DIO messages from other nodes that are part of existing
          DODAGs.
</p>
<a name="anchor62"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.2"></a><h3>12.1.2.&nbsp;
DIO Base option</h3>

<p>RPL specifies a number of protocol parameters.
</p>
<p>A RPL implementation SHOULD allow configuring the following
          routing protocol parameters, which are further described in <a class='info' href='#DIOBase'>Section&nbsp;5.1.1<span> (</span><span class='info'>DIO Base Format</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>DAGPreference</dt>
<dd>
</dd>
<dt>RPLInstanceID</dt>
<dd>
</dd>
<dt>DAGObjectiveCodePoint</dt>
<dd>
</dd>
<dt>DODAGID</dt>
<dd>
</dd>
<dt>Destination Prefixes</dt>
<dd>
</dd>
<dt>DIOIntervalDoublings</dt>
<dd>
</dd>
<dt>DIOIntervalMin</dt>
<dd>
</dd>
<dt>DIORedundancyConstant</dt>
<dd>
</dd>
<dt></dt>
<dd>
</dd>
<dt>DAG Root behavior:</dt>
<dd>In some cases, a node may not
              want to permanently act as a DODAG root if it cannot join a
              grounded DODAG. For example a battery-operated node may not want
              to act as a DODAG root for a long period of time. Thus a RPL
              implementation MAY support the ability to configure whether or
              not a node could act as a DODAG root for a configured period of
              time.
</dd>
<dt></dt>
<dd>
</dd>
<dt>DODAG Table Entry Suppression</dt>
<dd>A RPL implementation
              SHOULD provide the ability to configure a timer after the
              expiration of which logical equivalent of the DODAG table that
              contains all the records about a DODAG is suppressed, to be
              invoked if the DODAG parent set becomes empty.
</dd>
</dl></blockquote>

<a name="anchor63"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.3"></a><h3>12.1.3.&nbsp;
Trickle Timers</h3>

<p>A RPL implementation makes use of trickle timer to govern the
          sending of DIO message. Such an algorithm is determined a by a set
          of configurable parameters that are then advertised by the DODAG
          root along the DODAG in DIO messages.
</p>
<p>For each DODAG, a RPL implementation MUST allow for the
          monitoring of the following parameters, further described in <a class='info' href='#TrickleImplementation'>Section&nbsp;5.3.5.1<span> (</span><span class='info'>Trickle Timer for DIO Transmission</span><span>)</span></a>:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>I</dt>
<dd>
</dd>
<dt>T</dt>
<dd>
</dd>
<dt>C</dt>
<dd>
</dd>
<dt>I_min</dt>
<dd>
</dd>
<dt>I_doublings</dt>
<dd>
</dd>
</dl></blockquote>

<p>A RPL implementation SHOULD provide a command (for example via
          API, CLI, or SNMP MIB) whereby any procedure that detects an
          inconsistency may cause the trickle timer to reset.
</p>
<a name="anchor64"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.4"></a><h3>12.1.4.&nbsp;
DAG Sequence Number Increment</h3>

<p>A RPL implementation may allow by configuration at the DODAG root
          to refresh the DODAG states by updating the DODAGSequenceNumber. A
          RPL implementation SHOULD allow configuring whether or not periodic
          or event triggered mechanism are used by the DODAG root to control
          DODAGSequenceNumber change.
</p>
<a name="anchor65"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.5"></a><h3>12.1.5.&nbsp;
Destination Advertisement Timers</h3>

<p>The following set of parameters of the DAO messages SHOULD be
          configurable:
</p>
<p></p>
<ul class="text">
<li>The DelayDAO timer
</li>
<li>The Remove timer
</li>
</ul>

<a name="anchor66"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.6"></a><h3>12.1.6.&nbsp;
Policy Control</h3>

<p>DAG discovery enables nodes to implement different policies for
          selecting their DODAG parents.
</p>
<p>A RPL implementation SHOULD allow configuring the set of
          acceptable or preferred Objective Functions (OF) referenced by their
          Objective Codepoints (OCPs) for a node to join a DODAG, and what
          action should be taken if none of a node's candidate neighbors
          advertise one of the configured allowable Objective Functions.
</p>
<p>A node in an LLN may learn routing information from different
          routing protocols including RPL. It is in this case desirable to
          control via administrative preference which route should be favored.
          An implementation SHOULD allow for specifying an administrative
          preference for the routing protocol from which the route was
          learned.
</p>
<p>A RPL implementation SHOULD allow for the configuration of the
          "Route Tag" field of the DAO messages according to a set of rules
          defined by policy.
</p>
<a name="anchor67"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1.7"></a><h3>12.1.7.&nbsp;
Data Structures</h3>

<p>Some RPL implementation may limit the size of the candidate
          neighbor list in order to bound the memory usage, in which case some
          otherwise viable candidate neighbors may not be considered and
          simply dropped from the candidate neighbor list.
</p>
<p>A RPL implementation MAY provide an indicator on the size of the
          candidate neighbor list.
</p>
<a name="anchor68"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Information and Data Models</h3>

<p>The information and data models necessary for the operation of RPL
        will be defined in a separate document specifying the RPL SNMP
        MIB.
</p>
<a name="anchor69"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Liveness Detection and Monitoring</h3>

<p>The aim of this section is to describe the various RPL mechanisms
        specified to monitor the protocol.
</p>
<p>As specified in <a class='info' href='#UpwardTopology'>Section&nbsp;3.1<span> (</span><span class='info'>Topology</span><span>)</span></a>, an
        implementation is expected to maintain a set of data structures in
        support of DODAG discovery:
</p>
<p></p>
<ul class="text">
<li>The candidate neighbors data structure
</li>
<li>For each DODAG: 
<ul class="text">
<li>A set of DODAG parents
</li>
</ul>
</li>
</ul>

<a name="anchor70"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3.1"></a><h3>12.3.1.&nbsp;
Candidate Neighbor Data Structure</h3>

<p>A node in the candidate neighbor list is a node discovered by the
          some means and qualified to potentially become of neighbor or a
          sibling (with high enough local confidence). A RPL implementation
          SHOULD provide a way monitor the candidate neighbors list with some
          metric reflecting local confidence (the degree of stability of the
          neighbors) measured by some metrics.
</p>
<p>A RPL implementation MAY provide a counter reporting the number
          of times a candidate neighbor has been ignored, should the number of
          candidate neighbors exceeds the maximum authorized value.
</p>
<a name="anchor71"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3.2"></a><h3>12.3.2.&nbsp;
Directed Acyclic Graph (DAG) Table</h3>

<p>For each DAG, a RPL implementation is expected to keep track of
          the following DODAG table values:
</p>
<p></p>
<ul class="text">
<li>DODAGID
</li>
<li>DAGObjectiveCodePoint
</li>
<li>A set of Destination Prefixes offered upwards along the
              DODAG
</li>
<li>A set of DODAG Parents
</li>
<li>timer to govern the sending of DIO messages for the DODAG
</li>
<li>DODAGSequenceNumber
</li>
</ul>

<p>The set of DODAG parents structure is itself a table with the
          following entries:
</p>
<p></p>
<ul class="text">
<li>A reference to the neighboring device which is the DAG
              parent
</li>
<li>A record of most recent information taken from the DAG
              Information Object last processed from the DODAG Parent
</li>
<li>A flag reporting if the Parent is a DAO Parent as described
              in <a class='info' href='#DownwardRoutes'>Section&nbsp;6<span> (</span><span class='info'>Downward Routes</span><span>)</span></a>
</li>
</ul>

<a name="anchor72"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3.3"></a><h3>12.3.3.&nbsp;
Routing Table</h3>

<p>For each route provisioned by RPL operation, a RPL implementation
          MUST keep track of the following:
</p>
<p></p>
<ul class="text">
<li>Destination Prefix
</li>
<li>Destination Prefix Length
</li>
<li>Lifetime Timer
</li>
<li>Next Hop
</li>
<li>Next Hop Interface
</li>
<li>Flag indicating that the route was provisioned from one
              of:
<ul class="text">
<li>Unicast DAO message
</li>
<li>DIO message
</li>
<li>Multicast DAO message
</li>
</ul>
</li>
</ul>

<a name="anchor73"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3.4"></a><h3>12.3.4.&nbsp;
Other RPL Monitoring Parameters</h3>

<p>A RPL implementation SHOULD provide a counter reporting the
          number of a times the node has detected an inconsistency with
          respect to a DODAG parent, e.g. if the DODAGID has changed.
</p>
<p>A RPL implementation MAY log the reception of a malformed DIO
          message along with the neighbor identification if avialable.
</p>
<a name="anchor74"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3.5"></a><h3>12.3.5.&nbsp;
RPL Trickle Timers</h3>

<p>A RPL implementation operating on a DODAG root MUST allow for the
          configuration of the following trickle parameters:
</p>
<p></p>
<ul class="text">
<li>The DIOIntervalMin expressed in ms
</li>
<li>The DIOIntervalDoublings
</li>
<li>The DIORedundancyConstant
</li>
</ul>

<p>A RPL implementation MAY provide a counter reporting the number
          of times an inconsistency (and thus the trickle timer has been
          reset).
</p>
<a name="anchor75"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.4"></a><h3>12.4.&nbsp;
Verifying Correct Operation</h3>

<p>This section has to be completed in further revision of this
        document to list potential Operations and Management (OAM) tools that
        could be used for verifying the correct operation of RPL.
</p>
<a name="anchor76"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.5"></a><h3>12.5.&nbsp;
Requirements on Other Protocols and Functional Components</h3>

<p>RPL does not have any impact on the operation of existing
        protocols.
</p>
<a name="anchor77"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.6"></a><h3>12.6.&nbsp;
Impact on Network Operation</h3>

<p>To be completed.
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Security Considerations</h3>

<p>Security Considerations for RPL are to be developed in accordance
      with recommendations laid out in, for example, <a class='info' href='#I-D.tsao-roll-security-framework'>[I&#8209;D.tsao&#8209;roll&#8209;security&#8209;framework]<span> (</span><span class='info'>Tsao, T., Alexander, R., Daza, V., and A. Lozano, &ldquo;A Security Framework for Routing over Low Power and Lossy Networks,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
IANA Considerations</h3>

<a name="anchor78"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.1"></a><h3>14.1.&nbsp;
RPL Control Message</h3>

<p>The RPL Control Message is an ICMP information message type that is
        to be used carry DAG Information Objects, DAG Information
        Solicitations, and Destination Advertisement Objects in support of RPL
        operation.
</p>
<p>IANA has defined a ICMPv6 Type Number Registry. The suggested type
        value for the RPL Control Message is 155, to be confirmed by IANA.
</p>
<a name="anchor79"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.2"></a><h3>14.2.&nbsp;
New Registry for RPL Control Codes</h3>

<p>IANA is requested to create a registry, RPL Control Codes, for the
        Code field of the ICMPv6 RPL Control Message.
</p>
<p>New codes may be allocated only by an IETF Consensus action. Each
        code should be tracked with the following qualities:
</p>
<p></p>
<ul class="text">
<li>Code
</li>
<li>Description
</li>
<li>Defining RFC
</li>
</ul>

<p>Three codes are currently defined:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left"><col align="left">
<tr><th align="center">Code</th><th align="left">Description</th><th align="left">Reference</th></tr>
<tr>
<td align="center">0x01</td>
<td align="left">DAG Information Solicitation</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">0x02</td>
<td align="left">DAG Information Object</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">0x04</td>
<td align="left">Destination Advertisement Object</td>
<td align="left">This document</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;RPL Control Codes&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor80"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.3"></a><h3>14.3.&nbsp;
New Registry for the Control Field of the DIO Base</h3>

<p>IANA is requested to create a registry for the Control field of the
        DIO Base.
</p>
<p>New fields may be allocated only by an IETF Consensus action. Each
        field should be tracked with the following qualities:
</p>
<p></p>
<ul class="text">
<li>Bit number (counting from bit 0 as the most significant
            bit)
</li>
<li>Capability description
</li>
<li>Defining RFC
</li>
</ul>

<p>Four groups are currently defined:
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left"><col align="left">
<tr><th align="center">Bit</th><th align="left">Description</th><th align="left">Reference</th></tr>
<tr>
<td align="center">0</td>
<td align="left">Grounded DODAG (G)</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">1</td>
<td align="left">Destination Advertisement Supported (A)</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left">Destination Advertisement Trigger (T)</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">3</td>
<td align="left">Destination Advertisements Stored (S)</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">5,6,7</td>
<td align="left">DODAG Preference (Prf)</td>
<td align="left">This document</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;DIO Base Flags&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor81"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14.4"></a><h3>14.4.&nbsp;
DAG Information Object (DIO) Suboption</h3>

<p>IANA is requested to create a registry for the DIO Base
        Suboptions
</p><br /><hr class="insert" />
<table class="full" align="center" border="0" cellpadding="2" cellspacing="2">
<col align="center"><col align="left"><col align="left">
<tr><th align="center">Value</th><th align="left">Meaning</th><th align="left">Reference</th></tr>
<tr>
<td align="center">0</td>
<td align="left">Pad1 - DIO Padding</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">1</td>
<td align="left">PadN - DIO suboption padding</td>
<td align="left">This document</td>
</tr>
<tr>
<td align="center">2</td>
<td align="left">DAG Metric Container</td>
<td align="left">This Document</td>
</tr>
<tr>
<td align="center">3</td>
<td align="left">Destination Prefix</td>
<td align="left">This Document</td>
</tr>
<tr>
<td align="center">4</td>
<td align="left">DAG Timer Configuration</td>
<td align="left">This Document</td>
</tr>
</table>
<br clear="all" />
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;DAG Information Option (DIO) Base Suboptions&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.15"></a><h3>15.&nbsp;
Acknowledgements</h3>

<p>The authors would like to acknowledge the review, feedback, and
      comments from Emmanuel Baccelli, Dominique Barthel, Yusuf Bashir,
      Mathilde Durvy, Manhar Goindi, Mukul Goyal, Anders Jagd, Quentin Lampin,
      Jerry Martocci, Alexandru Petrescu, and Don Sturek.
</p>
<p>The authors would like to acknowledge the guidance and input provided
      by the ROLL Chairs, David Culler and JP Vasseur.
</p>
<p>The authors would like to acknowledge prior contributions of Robert
      Assimiti, Mischa Dohler, Julien Abeille, Ryuji Wakikawa, Teco Boot,
      Patrick Wetterwald, Bryan Mclaughlin, Carlos J. Bernardos, Thomas
      Watteyne, Zach Shelby, Caroline Bontoux, Marco Molteni, Billy Moon, and
      Arsalan Tavakoli, which have provided useful design considerations to
      RPL.
</p>
<a name="anchor82"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.16"></a><h3>16.&nbsp;
Contributors</h3>

<p>RPL is the result of the contribution of the following members of the
      ROLL Design Team, including the editors, and additional contributors as
      listed below:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
JP Vasseur
Cisco Systems, Inc
11, Rue Camille Desmoulins
Issy Les Moulineaux,   92782
France

Email: jpv@cisco.com


Thomas Heide Clausen
LIX, Ecole Polytechnique, France

Phone: +33 6 6058 9349
EMail: T.Clausen@computer.org
URI:   http://www.ThomasClausen.org/


Philip Levis
Stanford University
358 Gates Hall, Stanford University
Stanford, CA  94305-9030
USA

Email: pal@cs.stanford.edu


Richard Kelsey
Ember Corporation
Boston, MA
USA

Phone: +1 617 951 1225
Email: kelsey@ember.com


Jonathan W. Hui
Arch Rock Corporation
501 2nd St. Ste. 410
San Francisco, CA  94107
USA

Email: jhui@archrock.com


Kris Pister
Dust Networks
30695 Huntwood Ave.
Hayward,   94544
USA

Email: kpister@dustnetworks.com


Anders Brandt
Zensys, Inc.
Emdrupvej 26
Copenhagen, DK-2100
Denmark

Email: abr@zen-sys.com


Stephen Dawson-Haggerty
UC Berkeley
Soda Hall, UC Berkeley
Berkeley, CA  94720
USA

Email: stevedh@cs.berkeley.edu


</pre></div>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.17"></a><h3>17.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2460">[RFC2460]</a></td>
<td class="author-text"><a href="mailto:deering@cisco.com">Deering, S.</a> and <a href="mailto:hinden@iprg.nokia.com">R. Hinden</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2460.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2460.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2460.xml">XML</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>17.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-bfd-base">[I-D.ietf-bfd-base]</a></td>
<td class="author-text">Katz, D. and D. Ward, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-bfd-base-11.txt">Bidirectional Forwarding Detection</a>,&rdquo; draft-ietf-bfd-base-11 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-bfd-base-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-manet-nhdp">[I-D.ietf-manet-nhdp]</a></td>
<td class="author-text">Clausen, T., Dearlove, C., and J. Dean, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-manet-nhdp-12.txt">Mobile Ad Hoc Network (MANET) Neighborhood Discovery Protocol (NHDP)</a>,&rdquo; draft-ietf-manet-nhdp-12 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-manet-nhdp-12.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-roll-building-routing-reqs">[I-D.ietf-roll-building-routing-reqs]</a></td>
<td class="author-text">Martocci, J., Riou, N., Mil, P., and W. Vermeylen, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-building-routing-reqs-09.txt">Building Automation Routing Requirements in Low Power and Lossy Networks</a>,&rdquo; draft-ietf-roll-building-routing-reqs-09 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-building-routing-reqs-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-roll-home-routing-reqs">[I-D.ietf-roll-home-routing-reqs]</a></td>
<td class="author-text">Brandt, A. and J. Buron, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-home-routing-reqs-11.txt">Home Automation Routing Requirements in Low Power and Lossy Networks</a>,&rdquo; draft-ietf-roll-home-routing-reqs-11 (work in progress), January&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-home-routing-reqs-11.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-roll-of0">[I-D.ietf-roll-of0]</a></td>
<td class="author-text">Thubert, P., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-of0-01.txt">RPL Objective Function 0</a>,&rdquo; draft-ietf-roll-of0-01 (work in progress), February&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-of0-01.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-roll-routing-metrics">[I-D.ietf-roll-routing-metrics]</a></td>
<td class="author-text">Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-routing-metrics-06.txt">Routing Metrics used for Path Calculation in Low Power and Lossy Networks</a>,&rdquo; draft-ietf-roll-routing-metrics-06 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-routing-metrics-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-roll-terminology">[I-D.ietf-roll-terminology]</a></td>
<td class="author-text">Vasseur, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-terminology-03.txt">Terminology in Low power And Lossy Networks</a>,&rdquo; draft-ietf-roll-terminology-03 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-roll-terminology-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.tsao-roll-security-framework">[I-D.tsao-roll-security-framework]</a></td>
<td class="author-text">Tsao, T., Alexander, R., Daza, V., and A. Lozano, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-tsao-roll-security-framework-02.txt">A Security Framework for Routing over Low Power and Lossy Networks</a>,&rdquo; draft-tsao-roll-security-framework-02 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-tsao-roll-security-framework-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="Levis08">[Levis08]</a></td>
<td class="author-text">Levis, P., Brewer, E., Culler, D., Gay, D., Madden, S., Patel, N., Polastre, J., Shenker, S., Szewczyk, R., and A. Woo, &ldquo;<a href="http://portal.acm.org/citation.cfm?id=1364804">The Emergence of a Networking Primitive in
          Wireless Sensor Networks</a>,&rdquo; Communications of the ACM,&nbsp;v.51 n.7, July&nbsp;2008 (<a href="http://portal.acm.org/citation.cfm?id=1364804">HTML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1982">[RFC1982]</a></td>
<td class="author-text"><a href="mailto:kre@munnari.OZ.AU">Elz, R.</a> and <a href="mailto:randy@psg.com">R. Bush</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1982">Serial Number Arithmetic</a>,&rdquo; RFC&nbsp;1982, August&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1982.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3697">[RFC3697]</a></td>
<td class="author-text">Rajahalme, J., Conta, A., Carpenter, B., and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc3697">IPv6 Flow Label Specification</a>,&rdquo; RFC&nbsp;3697, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3697.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3819">[RFC3819]</a></td>
<td class="author-text">Karn, P., Bormann, C., Fairhurst, G., Grossman, D., Ludwig, R., Mahdavi, J., Montenegro, G., Touch, J., and L. Wood, &ldquo;<a href="http://tools.ietf.org/html/rfc3819">Advice for Internet Subnetwork Designers</a>,&rdquo; BCP&nbsp;89, RFC&nbsp;3819, July&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3819.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4101">[RFC4101]</a></td>
<td class="author-text">Rescorla, E. and IAB, &ldquo;<a href="http://tools.ietf.org/html/rfc4101">Writing Protocol Models</a>,&rdquo; RFC&nbsp;4101, June&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4101.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4191">[RFC4191]</a></td>
<td class="author-text">Draves, R. and D. Thaler, &ldquo;<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>,&rdquo; RFC&nbsp;4191, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4191.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4443">[RFC4443]</a></td>
<td class="author-text">Conta, A., Deering, S., and M. Gupta, &ldquo;<a href="http://tools.ietf.org/html/rfc4443">Internet Control Message Protocol (ICMPv6) for the Internet Protocol Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;4443, March&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4443.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4861">[RFC4861]</a></td>
<td class="author-text">Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>,&rdquo; RFC&nbsp;4861, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4915">[RFC4915]</a></td>
<td class="author-text">Psenak, P., Mirtorabi, S., Roy, A., Nguyen, L., and P. Pillay-Esnault, &ldquo;<a href="http://tools.ietf.org/html/rfc4915">Multi-Topology (MT) Routing in OSPF</a>,&rdquo; RFC&nbsp;4915, June&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4915.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5120">[RFC5120]</a></td>
<td class="author-text">Przygienda, T., Shen, N., and N. Sheth, &ldquo;<a href="http://tools.ietf.org/html/rfc5120">M-ISIS: Multi Topology (MT) Routing in Intermediate System to Intermediate Systems (IS-ISs)</a>,&rdquo; RFC&nbsp;5120, February&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5120.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5548">[RFC5548]</a></td>
<td class="author-text">Dohler, M., Watteyne, T., Winter, T., and D. Barthel, &ldquo;<a href="http://tools.ietf.org/html/rfc5548">Routing Requirements for Urban Low-Power and Lossy Networks</a>,&rdquo; RFC&nbsp;5548, May&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5548.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5673">[RFC5673]</a></td>
<td class="author-text">Pister, K., Thubert, P., Dwars, S., and T. Phinney, &ldquo;<a href="http://tools.ietf.org/html/rfc5673">Industrial Routing Requirements in Low-Power and Lossy Networks</a>,&rdquo; RFC&nbsp;5673, October&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5673.txt">TXT</a>).</td></tr>
</table>

<a name="Requirements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Requirements</h3>

<a name="anchor85"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Protocol Properties Overview</h3>

<p>RPL demonstrates the following properties, consistent with the
        requirements specified by the application-specific requirements
        documents.
</p>
<a name="anchor86"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1.1"></a><h3>A.1.1.&nbsp;
IPv6 Architecture</h3>

<p>RPL is strictly compliant with layered IPv6 architecture.
</p>
<p>Further, RPL is designed with consideration to the practical
          support and implementation of IPv6 architecture on devices which may
          operate under severe resource constraints, including but not limited
          to memory, processing power, energy, and communication. The RPL
          design does not presume high quality reliable links, and operates
          over lossy links (usually low bandwidth with low packet delivery
          success rate).
</p>
<a name="anchor87"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1.2"></a><h3>A.1.2.&nbsp;
Typical LLN Traffic Patterns</h3>

<p>Multipoint-to-Point (MP2P) and Point-to-multipoint (P2MP) traffic
          flows from nodes within the LLN from and to egress points are very
          common in LLNs. Low power and lossy network Border Router (LBR)
          nodes may typically be at the root of such flows, although such
          flows are not exclusively rooted at LBRs as determined on an
          application-specific basis. In particular, several applications such
          as building or home automation do require P2P (Point-to-Point)
          communication.
</p>
<p>As required by the aforementioned routing requirements documents,
          RPL supports the installation of multiple paths. The use of multiple
          paths include sending duplicated traffic along diverse paths, as
          well as to support advanced features such as Class of Service (CoS)
          based routing, or simple load balancing among a set of paths (which
          could be useful for the LLN to spread traffic load and avoid fast
          energy depletion on some, e.g. battery powered, nodes).
          Conceptually, multiple instances of RPL can be used to send traffic
          along different topology instances, the construction of which is
          governed by different Objective Functions (OF). Details of RPL
          operation in support of multiple instances are beyond the scope of
          the present specification.
</p>
<a name="anchor88"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1.3"></a><h3>A.1.3.&nbsp;
Constraint Based Routing</h3>

<p>The RPL design supports constraint based routing, based on a set
          of routing metrics and constraints. The routing metrics and
          constraints for links and nodes with capabilities supported by RPL
          are specified in a companion document to this specification, <a class='info' href='#I-D.ietf-roll-routing-metrics'>[I&#8209;D.ietf&#8209;roll&#8209;routing&#8209;metrics]<span> (</span><span class='info'>Vasseur, J., Kim, M., Networks, D., and H. Chong, &ldquo;Routing Metrics used for Path Calculation in Low Power and Lossy Networks,&rdquo; April&nbsp;2010.</span><span>)</span></a>. RPL signals the
          metrics, constraints, and related Objective Functions (OFs) in use
          in a particular implementation by means of an Objective Code Point
          (OCP). Both the routing metrics, constraints, and the OF help
          determine the construction of the Directed Acyclic Graphs (DAG)
          using a distributed path computation algorithm.
</p>
<a name="anchor89"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Deferred Requirements</h3>

<p>NOTE: RPL is still a work in progress. At this time there remain
        several unsatisfied application requirements, but these are to be
        addressed as RPL is further specified.
</p>
<a name="Examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Examples</h3>

<p>Consider the example LLN physical topology in <a class='info' href='#LLNExample'>Figure&nbsp;13<span> (</span><span class='info'>Example LLN Topology</span><span>)</span></a>. In this example the links depicted are all
      usable L2 links. Suppose that all links are equally usable, and that the
      implementation specific policy function is simply to minimize hops. This
      LLN physical topology then yields the DODAG depicted in <a class='info' href='#DAGExample'>Figure&nbsp;14<span> (</span><span class='info'>Example DAG</span><span>)</span></a>, where the links depicted are the edges
      toward DODAG parents. This topology includes one DAG, rooted by an LBR
      node (LBR) at rank 1. The LBR node will issue DIO messages, as governed
      by a trickle timer. Nodes (11), (12), (13), have selected (LBR) as their
      only parent, attached to the DODAG at rank 2, and periodically multicast
      DIOs. Node (22) has selected (11) and (12) in its DODAG parent set, and
      advertises itself at rank 3. Node (22) thus has a set of DODAG parents
      {(11), (12)} and siblings {((21), (23)}.
</p><br /><hr class="insert" />
<a name="LLNExample"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                                  (LBR)
                                  / | \
                             .---'  |  `----.
                            /       |        \
                         (11)------(12)------(13)
                          | \       | \       | \
                          |  `----. |  `----. |  `----.
                          |        \|        \|        \
                         (21)------(22)------(23)      (24)
                          |        /|        /|         |
                          |  .----' |  .----' |         |
                          | /       | /       |         |
                         (31)------(32)------(33)------(34)
                          |        /| \       | \       | \
                          |  .----' |  `----. |  `----. |  `----.
                          | /       |        \|        \|        \
                .--------(41)      (42)      (43)------(44)------(45)
               /         /         /| \       | \
         .----'    .----'    .----' |  `----. |  `----.
        /         /         /       |        \|        \
     (51)------(52)------(53)------(54)------(55)------(56)

</pre></div>
<p>Note that the links depicted represent the usable L2
        connectivity available in the LLN. For example, Node (31) can
        communicate directly with its neighbors, Nodes (21), (22), (32), and
        (41). Node (31) cannot communicate directly with any other nodes, e.g.
        (33), (23), (42). In this example these links offer bidirectional
        communication, and 'bad' links are not depicted.
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;13: Example LLN Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="DAGExample"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                                  (LBR)
                                  / | \
                             .---'  |  `----.
                            /       |        \
                         (11)      (12)      (13)
                          | \       | \       | \
                          |  `----. |  `----. |  `----.
                          |        \|        \|        \
                         (21)      (22)      (23)      (24)
                          |        /|        /|         |
                          |  .----' |  .----' |         |
                          | /       | /       |         |
                         (31)      (32)      (33)      (34)
                          |        /| \       | \       | \
                          |  .----' |  `----. |  `----. |  `----.
                          | /       |        \|        \|        \
                .--------(41)      (42)      (43)      (44)      (45)
               /         /         /| \       | \
         .----'    .----'    .----' |  `----. |  `----.
        /         /         /       |        \|        \
     (51)      (52)      (53)      (54)      (55)      (56)

</pre></div>
<p>Note that the links depicted represent directed links in
        the DODAG overlaid on top of the physical topology depicted in <a class='info' href='#LLNExample'>Figure&nbsp;13<span> (</span><span class='info'>Example LLN Topology</span><span>)</span></a>. As such, the depicted edges represent the
        relationship between nodes and their DODAG parents, wherein all
        depicted edges are directed and oriented 'up' on the page toward the
        DODAG root (LBR). The DODAG may provide default routes within the LLN,
        and serves as the foundation on which RPL builds further routing
        structure, e.g. through the destination advertisement
        mechanism.
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;14: Example DAG&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="DestinationAdvertisementExample"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
Destination Advertisement</h3>

<p>Consider the example DODAG depicted in <a class='info' href='#DAGExample'>Figure&nbsp;14<span> (</span><span class='info'>Example DAG</span><span>)</span></a>. Suppose that Nodes (22) and (32) are
        unable to record routing state. Suppose that Node (42) is able to
        perform prefix aggregation on behalf of Nodes (53), (54), and
        (55).
</p>
<p></p>
<ul class="text">
<li>Node (53) would send a DAO message to Node (42), indicating the
            availability of destination (53).
</li>
<li>Node (54) and Node (55) would similarly send DAO messages to
            Node (42) indicating their own destinations.
</li>
<li>Node (42) would collect and store the routing state for
            destinations (53), (54), and (55).
</li>
<li>In this example, Node (42) may then be capable of representing
            destinations (42), (53), (54), and (55) in the aggregation
            (42').
</li>
<li>Node (42) sends a DAO message advertising destination (42') to
            Node 32.
</li>
<li>Node (32) does not want to maintain any routing state, so it
            adds onto to the Reverse Route Stack in the DAO message and passes
            it on to Node (22) as (42'):[(42)]. It may send a separate DAO
            message to indicate destination (32).
</li>
<li>Node (22) does not want to maintain any routing state, so it
            adds on to the Reverse Route Stack in the DAO message and passes
            it on to Node (12) as (42'):[(42), (32)]. It also relays the DAO
            message containing destination (32) to Node 12 as (32):[(32)], and
            finally may send a DAO message for itself indicating destination
            (22).
</li>
<li>Node (12) is capable to maintain routing state again, and
            receives the DAO messages from Node (22). Node (12) then
            learns:
</li>
<ul class="text">
<li>Destination (22) is available via Node (22)
</li>
<li>Destination (32) is available via Node (22) and the piecewise
              source route to (32)
</li>
<li>Destination (42') is available via Node (22) and the
              piecewise source route to (32), (42').
</li>
</ul>
<li>Node (12) sends DAO messages to (LBR), allowing (LBR) to learn
            routes to the destinations (12), (22), (32), and (42'). (42),
            (53), (54), and (55) are available via the aggregation (42'). It
            is not necessary for Node (12) to propagate the piecewise source
            routes to (LBR).
</li>
</ul>

<a name="ExDAGParentSelection"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
Example: DODAG Parent Selection</h3>

<p>For example, suppose that a node (N) is not attached to any DAG,
        and that it is in range of nodes (A), (B), (C), (D), and (E). Let all
        nodes be configured to use an OCP which defines a policy such that ETX
        is to be minimized and paths with the attribute 'Blue' should be
        avoided. Let the rank computation indicated by the OCP simply reflect
        the ETX aggregated along the path. Let the links between node (N) and
        its neighbors (A-E) all have an ETX of 1 (which is learned by node (N)
        through some implementation specific method). Let node (N) be
        configured to send RPL DIS messages to probe for nearby DAGs.
</p>
<p></p>
<ul class="text">
<li>Node (N) transmits a RPL DIS message.
</li>
<li>Node (B) responds. Node (N) investigates the DIO message, and
            learns that Node (B) is a member of DODAGID 1 at rank 4, and not
            'Blue'. Node (N) takes note of this, but is not yet confident.
</li>
<li>Similarly, Node (N) hears from Node (A) at rank 9, Node (C) at
            rank 5, and Node (E) at rank 4.
</li>
<li>Node (D) responds. Node (D) has a DIO message that indicates
            that it is a member of DODAGID 1 at rank 2, but it carries the
            attribute 'Blue'. Node (N)'s policy function rejects Node (D), and
            no further consideration is given.
</li>
<li>This process continues until Node (N), based on implementation
            specific policy, builds enough confidence to trigger a decision to
            join DODAGID 1. Let Node (N) determine its most preferred parent
            to be Node (E).
</li>
<li>Node (N) adds Node (E) (rank 4) to its set of DODAG parents for
            DODAGID 1. Following the mechanisms specified by the OCP, and
            given that the ETX is 1 for the link between (N) and (E), Node (N)
            is now at rank 5 in DODAGID 1.
</li>
<li>Node (N) adds Node (B) (rank 4) to its set of DODAG parents for
            DODAGID 1.
</li>
<li>Node (N) is a sibling of Node (C), both are at rank 5.
</li>
<li>Node (N) may now forward traffic intended for the default
            destination upwards along DODAGID 1 via nodes (B) and (E). In some
            cases, e.g. if nodes (B) and (E) are tried and fail, node (N) may
            also choose to forward traffic to its sibling node (C), without
            making upwards progress but with the intention that node (C) or a
            following successor can make upwards progress. Should Node (C) not
            have a viable parent, it should never send the packet back to Node
            (N) (to avoid a 2-node loop).
</li>
</ul>

<a name="ExDAGMaintenance"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
Example: DODAG Maintenance</h3>
<br /><hr class="insert" />
<a name="DAGMaintenance"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

       :                      :                      :
       :                      :                      :
      (A)                    (A)                    (A)
       |\                     |                      |
       | `-----.              |                      |
       |        \             |                      |
      (B)       (C)          (B)       (C)          (B)
                 |                      |             \
                 |                      |              `-----.
                 |                      |                     \
                (D)                    (D)                    (C)
                                                               |
                                                               |
                                                               |
                                                              (D)

           -1-                    -2-                    -3-

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;15: DAG Maintenance&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Consider the example depicted in <a class='info' href='#DAGMaintenance'>Figure&nbsp;15<span> (</span><span class='info'>DAG Maintenance</span><span>)</span></a>-1. In this example, Node (A) is
        attached to a DODAG at some rank d. Node (A) is a DODAG parent of
        Nodes (B) and (C). Node (C) is a DODAG parent of Node (D). There is
        also an undirected sibling link between Nodes (B) and (C).
</p>
<p>In this example, Node (C) may safely forward to Node (A) without
        creating a loop. Node (C) may not safely forward to Node (D),
        contained within it's own sub-DODAG, without creating a loop. Node (C)
        may forward to Node (B) in some cases, e.g. the link (C)-&gt;(A) is
        temporarily unavailable, but with some chance of creating a loop (e.g.
        if multiple nodes in a set of siblings start forwarding 'sideways' in
        a cycle) and requiring the intervention of additional mechanisms to
        detect and break the loop.
</p>
<p>Consider the case where Node (C) hears a DIO message from a Node
        (Z) at a lesser rank and superior position in the DODAG than node (A).
        Node (C) may safely undergo the process to evict node (A) from its DAG
        parent set and attach directly to Node (Z) without creating a loop,
        because its rank will decrease.
</p>
<p>Now consider the case where the link (C)-&gt;(A) becomes nonviable,
        and node (C) must move to a deeper rank within the DAG:
</p>
<p></p>
<ul class="text">
<li>Node (C) must first detach from the DODAG by removing Node (A)
            from its DODAG parent set, leaving an empty DODAG parent set. Node
            (C) may become the root of its own floating, less preferred,
            DAG.
</li>
<li>Node (D), hearing a modified DIO message from Node (C), follows
            Node (C) into the floating DAG. This is depicted in <a class='info' href='#DAGMaintenance'>Figure&nbsp;15<span> (</span><span class='info'>DAG Maintenance</span><span>)</span></a>-2. In general, any node with no
            other options in the sub-DODAG of Node (C) will follow Node (C)
            into the floating DAG, maintaining the structure of the
            sub-DODAG.
</li>
<li>Node (C) hears a DIO message with an incremented
            DODAGSequenceNumber from Node (B) and determines it is able to
            rejoin the grounded DODAG by reattaching at a deeper rank to Node
            (B). Node (C) adds Node (B) to its DODAG parent set. Node (C) has
            now safely moved deeper within the grounded DODAG without creating
            any loops.
</li>
<li>Node (D), and any other sub-DODAG of Node (C), will hear the
            modified DIO message sourced from Node (C) and follow Node (C) in
            a coordinated manner to reattach to the grounded DAG. The final
            DODAG is depicted in <a class='info' href='#DAGMaintenance'>Figure&nbsp;15<span> (</span><span class='info'>DAG Maintenance</span><span>)</span></a>-3
</li>
</ul>

<a name="ExGreedyExample"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.4"></a><h3>B.4.&nbsp;
Example: Greedy Parent Selection and Instability</h3>
<br /><hr class="insert" />
<a name="Greedy"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

      (A)                    (A)                    (A)
       |\                     |\                     |\
       | `-----.              | `-----.              | `-----.
       |        \             |        \             |        \
      (B)       (C)          (B)        \            |        (C)
                               \        |            |        /
                                `-----. |            | .-----'
                                       \|            |/
                                       (C)          (B)

           -1-                    -2-                    -3-

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;16: Greedy DODAG Parent Selection&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Consider the example depicted in <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>. A
        DODAG is depicted in 3 different configurations. A usable link between
        (B) and (C) exists in all 3 configurations. In <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-1, Node (A) is a DODAG parent for Nodes (B)
        and (C), and (B)--(C) is a sibling link. In <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-2, Node (A) is a DODAG parent for Nodes (B)
        and (C), and Node (B) is also a DODAG parent for Node (C). In <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-3, Node (A) is a DODAG parent for Nodes (B)
        and (C), and Node (C) is also a DODAG parent for Node (B).
</p>
<p>If a RPL node is too greedy, in that it attempts to optimize for an
        additional number of parents beyond its preferred parent, then an
        instability can result. Consider the DODAG illustrated in <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-1. In this example, Nodes (B) and (C) may most
        prefer Node (A) as a DODAG parent, but are operating under the greedy
        condition that will try to optimize for 2 parents.
</p>
<p>When the preferred parent selection causes a node to have only one
        parent and no siblings, the node may decide to insert itself at a
        slightly higher rank in order to have at least one sibling and thus an
        alternate forwarding solution. This does not deprive other nodes of a
        forwarding solution and this is considered acceptable greediness.
</p>
<p></p>
<ul class="text">
<li>Let <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-1 be the initial
            condition.
</li>
<li>Suppose Node (C) first is able to leave the DODAG and rejoin at
            a lower rank, taking both Nodes (A) and (B) as DODAG parents as
            depicted in <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-2. Now Node (C) is
            deeper than both Nodes (A) and (B), and Node (C) is satisfied to
            have 2 DODAG parents.
</li>
<li>Suppose Node (B), in its greediness, is willing to receive and
            process a DIO message from Node (C) (against the rules of RPL),
            and then Node (B) leaves the DODAG and rejoins at a lower rank,
            taking both Nodes (A) and (C) as DODAG parents. Now Node (B) is
            deeper than both Nodes (A) and (C) and is satisfied with 2 DAG
            parents.
</li>
<li>Then Node (C), because it is also greedy, will leave and rejoin
            deeper, to again get 2 parents and have a lower rank then both of
            them.
</li>
<li>Next Node (B) will again leave and rejoin deeper, to again get
            2 parents
</li>
<li>And again Node (C) leaves and rejoins deeper...
</li>
<li>The process will repeat, and the DODAG will oscillate between
            <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-2 and <a class='info' href='#Greedy'>Figure&nbsp;16<span> (</span><span class='info'>Greedy DODAG Parent Selection</span><span>)</span></a>-3 until the nodes count to infinity and
            restart the cycle again.
</li>
<li>This cycle can be averted through mechanisms in RPL: 
<ul class="text">
<li>Nodes (B) and (C) stay at a rank sufficient to attach to
                their most preferred parent (A) and don't go for any deeper
                (worse) alternate parents (Nodes are not greedy)
</li>
<li>Nodes (B) and (C) do not process DIO messages from nodes
                deeper than themselves (because such nodes are possibly in
                their own sub-DODAGs)
</li>
</ul>
</li>
</ul>

<a name="TODO"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Outstanding Issues</h3>

<p>This section enumerates some outstanding issues that are to be
      addressed in future revisions of the RPL specification.
</p>
<a name="anchor90"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.1"></a><h3>C.1.&nbsp;
Additional Support for P2P Routing</h3>

<p>In some situations the baseline mechanism to support arbitrary P2P
        traffic, by flowing upwards along the DODAG until a common ancestor is
        reached and then flowing down, may not be suitable for all application
        scenarios. A related scenario may occur when the down paths setup
        along the DODAG by the destination advertisement mechanism are not be
        the most desirable downward paths for the specific application
        scenario (in part because the DODAG links may not be symmetric). It
        may be desired to support within RPL the discovery and installation of
        more direct routes 'across' the DAG. Such mechanisms need to be
        investigated.
</p>
<a name="anchor91"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.2"></a><h3>C.2.&nbsp;
Destination Advertisement / DAO Fan-out</h3>

<p>When DAO messages are relayed to more than one DODAG parent, in
        some cases a situation may be created where a large number of DAO
        messages conveying information about the same destination flow upwards
        along the DAG. It is desirable to bound/limit the
        multiplication/fan-out of DAO messages in this manner. Some aspects of
        the Destination Advertisement mechanism remain under investigation,
        such as behavior in the face of links that may not be symmetric.
</p>
<p>In general, the utility of providing redundancy along downwards
        routes by sending DAO messages to more than one parent is under
        investigation.
</p>
<p>The use of suitable triggers, such as the 'T' flag, to trigger DA
        operation within an affected sub-DODAG, is under investigation.
        Further, the ability to limit scope of the affected depth within the
        sub-DODAG is under investigation (e.g. if a stateful node can proxy
        for all nodes 'behind' it, then there may be no need to propagate the
        triggered 'T' flag further).
</p>
<a name="anchor92"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.3"></a><h3>C.3.&nbsp;
Source Routing</h3>

<p>In support of nodes that maintain minimal routing state, and to
        make use of the collection of piecewise source routes from the
        destination advertisement mechanism, there needs to be some
        investigation of a mechanism to specify, attach, and follow source
        routes for packets traversing the LLN.
</p>
<a name="anchor93"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.4"></a><h3>C.4.&nbsp;
Address / Header Compression</h3>

<p>In order to minimize overhead within the LLN it is desirable to
        perform some sort of address and/or header compression, perhaps via
        labels, addresses aggregation, or some other means. This is still
        under investigation.
</p>
<a name="anchor94"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C.5"></a><h3>C.5.&nbsp;
Managing Multiple Instances</h3>

<p>A network may run multiple instances of RPL concurrently. Such a
        network will require methods for assigning and otherwise managing
        RPLInstanceIDs. This will likely be addressed in a separate
        document.
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tim Winter (editor)</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:wintert@acm.org">wintert@acm.org</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Pascal Thubert (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Village d'Entreprises Green Side</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">400, Avenue de Roumanille</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Batiment T3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Biot - Sophia Antipolis  06410</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">FRANCE</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+33 497 23 26 34</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:pthubert@cisco.com">pthubert@cisco.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">ROLL Design Team</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">IETF ROLL WG</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:rpl-authors@external.cisco.com">rpl-authors@external.cisco.com</a></td></tr>
</table>
</body></html>
