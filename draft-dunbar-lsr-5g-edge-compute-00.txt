Network Working Group                                L. Dunbar
Internet Draft                                         H. Chen
Intended status: Standard                            Futurewei
Expires: January 12, 2022                         Aijun Wang
                                                 China Telecom
                                                 July 12, 2021

      IS-IS & OSPF extension for 5G Edge Computing Service
               draft-dunbar-lsr-5g-edge-compute-00

Abstract
   This draft describes an IS-IS and OSPF extension for
   routers to advertise the running status and environment
   (Site-Cost) for the directly attached 5G Edge Computing
   servers. Routers in the 5G Local Data Network can use the
   Site-Cost and the network condition to optimize forwarding
   flows from UEs. The goal is to improve latency and
   performance for 5G Edge Computing services.

Status of this Memo
   This Internet-Draft is submitted in full conformance with
   the provisions of BCP 78 and BCP 79.

   This Internet-Draft is submitted in full conformance with
   the provisions of BCP 78 and BCP 79. This document may not
   be modified, and derivative works of it may not be created,
   except to publish it as an RFC and to translate it into
   languages other than English.

   Internet-Drafts are working documents of the Internet
   Engineering Task Force (IETF), its areas, and its working
   groups.  Note that other groups may also distribute working
   documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of
   six months and may be updated, replaced, or obsoleted by
   other documents at any time.  It is inappropriate to use
   Internet-Drafts as reference material or to cite them other
   than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt




xxx, et al.            Expires January 12, 2022       [Page 1]

Internet-Draft     OSPF Extension for 5G EC Service

   The list of Internet-Draft Shadow Directories can be
   accessed at http://www.ietf.org/shadow.html

   This Internet-Draft will expire on April 7, 2021.

Copyright Notice

   Copyright (c) 2021 IETF Trust and the persons identified as
   the document authors. All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's
   Legal Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the
   date of publication of this document. Please review these
   documents carefully, as they describe your rights and
   restrictions with respect to this document. Code Components
   extracted from this document must include Simplified BSD
   License text as described in Section 4.e of the Trust Legal
   Provisions and are provided without warranty as described
   in the Simplified BSD License.

Table of Contents


   1. Introduction........................................... 3
      1.1. 5G Edge Computing Background...................... 3
      1.2. Problem#1: ANYCAST in 5G EC Environment........... 5
      1.3. Problem #2: Unbalanced Anycast Distribution due to
      UE Mobility............................................ 6
      1.4. Problem 3: Application Server Relocation.......... 6
   2. Conventions used in this document...................... 6
   3. Solution Overview...................................... 8
      3.1. Flow Affinity to an ANYCAST server................ 8
      3.2. IP Layer Metrics to Gauge App Server Running Status
      ....................................................... 9
      3.3. To Equalize traffic among Multiple ANYCAST
      Locations............................................. 10
      3.4. Reason for using IGP Based Solution.............. 11
   4. IS-IS Extension....................................... 11
      4.1. IS-IS extension for the Aggregated cost.......... 12
      4.2. IS-IS extension for IP Layer App-Metrics
      Advertisements........................................ 13
      4.3. IS-IS App-Metrics SubTLVs for IPv6 attachment.... 13
      4.4. IS-IS IP Layer App-Metrics for IPv4.............. 14


Dunbar, et al.         Expires January 12, 2022       [Page 2]

Internet-Draft     OSPF Extension for 5G EC Service

   5. Aggregated Cost Advertisement in OSPF................. 14
      5.1. OSPFv3 LSA to carry the Aggregated Cost.......... 15
      5.2. OSPFv2 LSA to carry the Aggregated Cost.......... 15
   6. IP Layer App-Metrics Advertisements by OSPF........... 15
      6.1. OSPFv3 Extension to carry the App-Metrics........ 16
      6.2. OSPFv2 Extension to advertise the IP Layer App-
      Metrics............................................... 17
      6.3. IP Layer App-Metrics Sub-TLVs.................... 18
   7. Manageability Considerations.......................... 20
   8. Security Considerations............................... 20
   9. IANA Considerations................................... 20
   10. References........................................... 20
      10.1. Normative References............................ 21
      10.2. Informative References.......................... 21
   11. Acknowledgments...................................... 22

1. Introduction

   This document describes an IS-IS and OSPF extension to
   advertise the indexes of the running environment, a.k.a.
   Site-Cost, for the directly attached 5G Edge Computing
   servers. The goal is for other routers in the 5G Local Data
   Network (LDN) to optimize the forwarding of flows from UEs
   and to improve latency and performance for 5G Edge
   Computing services.

   In a nutshell, one application can be instantiated on
   multiple servers close in proximity. Those multiple server
   instances can share one IP address (ANYCAST) so that
   traffic can be forwarded in consideration of transient
   network and load conditions.


 1.1. 5G Edge Computing Background

   As described in [3GPP-EdgeComputing], it is desirable for a
   mission-critical application to be hosted on multiple
   servers attached to different edge routers to minimize
   latency and optimize the user experience. Those App Servers
   are usually hosted very close to or co-located with 5G base
   stations.

   When a UE (User Equipment) initiates application packets
   using the destination address from a DNS reply or its



Dunbar, et al.         Expires January 12, 2022       [Page 3]

Internet-Draft     OSPF Extension for 5G EC Service

   cache, the packets from the UE are carried in a PDU session
   through 5G Core [5GC] to the 5G UPF-PSA (User Plan Function
   - PDU Session Anchor). The UPF-PSA decapsulates the 5G GTP
   outer header and forwards the packets from the UEs to the
   Ingress router of the Edge Computing (EC) Local Data
   Network (LDN), which is responsible for forwarding the
   packets to the intended destinations.

   When the UE moves out of coverage of its current gNB (next-
   generation Node B) (gNB1), the handover procedure is
   initiated, which includes the 5G SMF (Session Management
   Function) selecting a new UPF-PSA [3GPP TS 23.501 and TS
   23.502]. When the handover process is complete, the UE has
   a new IP address, and the IP point of attachment is to the
   new UPF-PSA. 5GC may maintain a path from the old UPF to
   the new UPF for a short time for SSC [Session and Service
   Continuity] mode 3 to make the handover process more
   seamless.





























Dunbar, et al.         Expires January 12, 2022       [Page 4]

Internet-Draft     OSPF Extension for 5G EC Service

   +--+
   |UE|---\+---------+                 +------------------+
   +--+    |  5G     |    +---------+  |   S1: aa08::4450 |
   +--+    | Site +--++---+         +----+                |
   |UE|----|  A   |PSA| Ra|         | R1 | S2: aa08::4460 |
   +--+    |      +---+---+         +----+                |
  +---+    |         |  |           |  |   S3: aa08::4470 |
  |UE1|---/+---------+  |           |  +------------------+
  +---+                 |IP Network |       L-DN1
                        |(3GPP N6)  |
     |                  |           |  +------------------+
     | UE1              |           |  |  S1: aa08::4450  |
     | moves to         |          +----+                 |
     | Site B           |          | R3 | S2: aa08::4460  |
     v                  |          +----+                 |
                        |           |  |  S3: aa08::4470  |
                        |           |  +------------------+
                        |           |      L-DN3
   +--+                 |           |
   |UE|---\+---------+  |           |  +------------------+
   +--+    |  5G     |  |           |  |  S1: aa08::4450  |
   +--+    | Site +--++-+--+        +----+                |
   |UE|----|  B   |PSA| Rb |        | R2 | S2: aa08::4460 |
   +--+    |      +--++----+        +----+                |
   +--+    |         |  +-----------+  |  S3: aa08::4470  |
   |UE|---/+---------+                 +------------------+
   +--+                                     L-DN2
           Figure 1: App Servers in different edge DCs


 1.2. Problem#1: ANYCAST in 5G EC Environment

   ANYCAST makes it possible to load balance across server
   locations based on network conditions dynamically. With
   multiple servers having the same ANYCAST address, it
   eliminates the single point of failure and bottleneck at
   the application layer load balancers. Another benefit of
   using ANYCAST address is removing the dependency on how UEs
   get the IP addresses for their Applications. Some UEs (or
   clients) might use stale cached IP addresses for an
   extended period.

   But, having multiple locations of the same ANYCAST address
   in the 5G Edge Computing environment can be problematic


Dunbar, et al.         Expires January 12, 2022       [Page 5]

Internet-Draft     OSPF Extension for 5G EC Service

   because all those edge computing Data Centers can be close
   in proximity. There might be very little difference in the
   routing distance to reach the Application Servers attached
   to a different edge router, which can cause packets from
   one flow to be forwarded to different locations, resulting
   in service glitches.

 1.3. Problem #2: Unbalanced Anycast Distribution due to UE
   Mobility

   UEs' frequent moving from one 5G site to another can make
   it difficult to plan where the App Servers should be
   hosted. When one App server is heavily utilized, other App
   servers of the same address close by can be under-utilized.
   The difference in the routing distance to reach multiple
   Application Servers might be relatively small. The network
   cost, the traffic load at the router where the App Server
   is attached, and the site capacity, when combined, are more
   significant from the latency and performance perspective.

   Since the condition can be short-lived, it is difficult for
   the application controller to anticipate the moving and
   adjusting.

 1.4. Problem 3: Application Server Relocation

   When an Application Server is added to, moved, or deleted
   from a 5G Edge Computing server site (mini-DC), not only
   the reachability changes but also the utilization and
   capacity for the site might change.

   Note: for the ease of description, the Edge Computing
   server, Application server, App server are used
   interchangeably throughout this document.



2. Conventions used in this document


   A-ER:       Egress Edge Router to an Application Server,
               [A-ER] is used to describe the last router that
               the Application Server is attached. For 5G EC
               environment, the A-ER can be the gateway router
               to a (mini) Edge Computing Data Center.



Dunbar, et al.         Expires January 12, 2022       [Page 6]

Internet-Draft     OSPF Extension for 5G EC Service

   Application Server: An application server is a physical or
               virtual server that hosts the software system
               for the application.

   Application Server Location: Represent a cluster of servers
               at one location serving the same Application.
               One application may have a Layer 7 Load
               balancer, whose address(es) are reachable from
               an external IP network, in front of a set of
               application servers. From IP network
               perspective, this whole group of servers is
               considered as the Application server at the
               location.

   Edge Application Server: used interchangeably with
               Application Server throughout this document.

   EC:         Edge Computing

   Edge Hosting Environment: An environment providing the
               support required for Edge Application Server's
               execution.

               NOTE: The above terminologies are the same as
               those used in 3GPP TR 23.758

   Edge DC:    Edge Data Center, which provides the Edge
               Computing Hosting Environment. It might be co-
               located with 5G Base Station and not only host
               5G core functions, but also host frequently
               used Edge server instances.

   gNB         next generation Node B

   LDN:        Local Data Network

   PSA:        PDU Session Anchor (UPF)

   SSC:        Session and Service Continuity

   UE:         User Equipment



Dunbar, et al.         Expires January 12, 2022       [Page 7]

Internet-Draft     OSPF Extension for 5G EC Service

   UPF:        User Plane Function


   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
   "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT
   RECOMMENDED", "MAY", and "OPTIONAL" in this document are to
   be interpreted as described in BCP 14 [RFC2119] [RFC8174]
   when, and only when, they appear in all capitals, as shown
   here.


3. Solution Overview

   From IP Layer, the Application Servers are identified by
   their IP (ANYCAST) addresses. To a router, having multiple
   servers with the same (ANYCAST) address attached to
   different egress edge routers (A-ER) is the same as having
   multiple paths to reach the (ANYCAST) address.

   The proposed solution is for the egress edge router (A-ER)
   to which the Application Servers are attached to advertise
   the "Site-Cost" [Section 3.2] to other routers in 5G EC
   LDN. The routers in LDN can consider the "Site-Cost" in
   computing the optimal path to the App Server directly
   attached to the A-ER.

   The solution assumes that the 5G Edge Computing controller
   or management system is aware of the ANYCAST addresses that
   need optimized forwarding. To minimize the processing, only
   the applications that match with the ACLs configured by the
   5G Edge Computing controller will have their Site-Cost
   collected and advertised.



 3.1. Flow Affinity to an ANYCAST server

   In an environment where multiple servers with the same
   (ANYCAST) address are attached to different A-ERs, Flow
   Affinity means routers sending the packets of the same flow
   to the same A-ER even if the cost towards the A-ER is no
   longer optimal.

   Today, many commercial routers support some forms of flow
   affinity to ensure packets belonging to one flow be
   forwarded along the same path.



Dunbar, et al.         Expires January 12, 2022       [Page 8]

Internet-Draft     OSPF Extension for 5G EC Service

   Editor's note: for IPv6 traffic, Flow Affinity can be
   supported by the routers forwarding the packets with the
   same Flow Label in the packets' IPv6 Header along the same
   path towards the same egress edge router.

 3.2. IP Layer Metrics to Gauge App Server Running Status

   Most applications do not expose their internal logic to the
   network. Their communications are generally encrypted. Most
   of them do not even respond to PING or ICMP messages
   initiated by routers or network gears.

   [5G-EC-Metrics] describes the IP Layer Metrics that can
   gauge the application servers running status and
   environment:

     - IP-Layer Metric for App Server Load Measurement:
       The Load Measurement to an App Server is a weighted
       combination of the number of packets/bytes to the App
       Server and the number of packets/bytes from the App
       Server which are collected by the A-ER that has the
       direct connection to the App Server.
       The A-ER is configured with an ACL that can filter out
       the packets for the Application Server.
     - Capacity Index:
       Capacity Index is used to differentiate the running
       environment of the attached application server. Some
       data centers can have hundreds, or thousands, of
       servers behind an application server's App Layer Load
       Balancer. Other data centers can have a very small
       number of servers for the application. "Capacity
       Index", which is a numeric number, is used to
       represent the capacity of the application server
       attached to an A-ER.
     - Site preference index:
       [IPv6-StickyService] describes a scenario that some
       sites are more preferred for handling an application
       than others for flows from a specific UE.

   For ease of description, those metrics with more to be
   added later are called IP Layer Site-Cost throughout the
   document.


Dunbar, et al.         Expires January 12, 2022       [Page 9]

Internet-Draft     OSPF Extension for 5G EC Service


 3.3. To Equalize traffic among Multiple ANYCAST Locations

   The main benefit of using ANYCAST is to leverage the
   network layer information to balance the traffic among
   multiple Application Server locations.

   For the 5G Edge Computing environment, the routers in the
   LDN need to be notified of various measurements of the App
   Servers attached to each A-ER to make the intelligent
   decision on where to forward the traffic for the
   application from UEs.

   [5G-EC-Metrics] describes the algorithms that the routers
   in LDN can use to compare the cost to reach the App Servers
   between the Site-i or Site-j:

               Load-i * CP-j               Pref-j * Network-Delay-i
Cost-i=min(w *(----------------) + (1-w) *(-------------------------))
              Load-j * CP-i               Pref-i * Network-Delay-j


      Load-i: Load Index at Site-i, it is the weighted
      combination of the total packets or/and bytes sent to
      and received from the Application Server at Site-i
      during a fixed time period.

      CP-i: capacity index at site I, a higher value means
      higher capacity.

      Network Delay-i: Network latency measurement (RTT) to
      the A-ER that has the Application Server attached at the
      site-i.
      Noted: Ingress nodes can easily measure RTT to all the
      egress edge nodes by existing IPPM metrics. But it is
      not so easy for ingress nodes to measure RTT to all the
      App Servers. Therefore, "Network-Delay-i", a.k.a.
      Network latency measurement (RTT), is between the
      Ingress and egress edge nodes. The link cost between the
      egress edge nodes to their attached servers is embedded
      in the "capacity index".

      Pref-i: Preference index for site-i, a higher value
      means higher preference.

      w: Weight for load and site information, which is a
      value between 0 and 1. If smaller than 0.5, Network
      latency and the site Preference have more influence;


Dunbar, et al.         Expires January 12, 2022      [Page 10]

Internet-Draft     OSPF Extension for 5G EC Service

      otherwise, Server load and its capacity have more
      influence.

 3.4. Reason for using IGP Based Solution

    Here are some benefits of using IGP to propagate the IP
    Layer App-Metrics:
    - Intermediate routers can derive the aggregated cost to
      reach the Application Servers attached to different
      egress edge nodes, especially:
        - The path to the optimal egress edge node can be
           more accurate or shorter.
        - Convergence is shorter when there is any failure
           along the way towards the optimal ANYCAST server.
        - When there is any failure at the intended ANYCAST
           server, all the packets in transit can be optimally
           forwarded to another App Server attached to a
           different egress edge router.
    - Doesn't need the ingress nodes to establish tunnels with
      egress edge nodes.

    There are limitations of using IGP too, such as:

    - The IGP approach might not suit well to 5G EC LDN
      operated by multiple ISPs.
      For LDN operated by multiple IPSs, BGP should be used.
      AppMetaData NLRI Path Attribute [5G-AppMetaData]
      describes the BGP UPDATE message to propagate IP Layer
      App-Metrics crossing multiple ISPs.

4. IS-IS Extension

   The Application-Specific Link Attribute sub-TLV described
   in [RFC8919] can be used to carry the "Site-Cost" for the
   App server directly attached to the router.

   When carrying the "Site-Cost" sub-sub TLVs, the App
   specific Link Attribute sub-TLV can be included in TLV 22
   (extended IS reachability), 23 (IS Neighbor Attribute), or
   25(L2 bundle Member Attribute).

   The Site-Cost bit is added to the Standard Applications Bit
   Mask (SABM).

   0 1 2 3 4 5 6 7 ...
   +-+-+-+-+-+-+-+-+...


Dunbar, et al.         Expires January 12, 2022      [Page 11]

Internet-Draft     OSPF Extension for 5G EC Service

   |R|S|F|C| ...
   +-+-+-+-+-+-+-+-+...
   Figure 2: Extended Application Identifier Bit Mask


   C-bit: set to specify the Site Cost related sub-sub TLVs,
   described in the Section 3.2, are included in the App-
   Specific Sub-TLV.

   The R-bit, S-bit, F-bit are specified by the RFC8919.

   The Extended App Specific Link Attributes Sub-TLV is as
   following:

     Type: 16
     Length: (1 octet)
     Value:
          Extended Application Identifier Bit Mask [Figure 2]
          Site-Cost sub-sub-TLVs - described in the following
          sections.


 4.1. IS-IS extension for the Aggregated cost

   If egress edge routers to which the App Servers are
   directly attached can get the aggregated cost, the
   Aggregated cost sub-sub-TLV can be directly appended to the
   App Specific Bit Mask.

   The aggregated cost can be from App controller or from a
   consistent algorithm that considers the Load Measurement,
   Capacity value, and Preference value across all A-ERs.

















Dunbar, et al.         Expires January 12, 2022      [Page 12]

Internet-Draft     OSPF Extension for 5G EC Service

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |AggCostSubTLV  | Length        | AggCost to the App Server     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | PrefixLength  | PrefixOptions |             0                 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           Address Prefix                      |
     |                               ...                             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                Figure 3: Aggregated Cost to App Server


 4.2. IS-IS extension for IP Layer App-Metrics Advertisements

   This section describes the sub-sub TLVs that carry the
   detailed IP Layer Metrics when the A-ERs in the domain do
   not have a consistent algorithm to compute the aggregated
   cost or the detailed IP Layer metrics for the App Servers
   are needed for other purposes.

   It worth noting that not all hosts (prefix) attached to an
   A-ER are ANYCAST servers that need network optimization.
   An A-ER only needs to advertise the site-Cost Metrics for
   the ANYCAST addresses requested by the Controller.

   Draft [draft-wang-lsr-passive-interface-attribute]
   introduces the Stub-Link TLV for OSPFv2/v3 and ISIS
   protocol respectively. Considering the interfaces on an
   edge router that connects to the App servers are normally
   configured as passive interfaces, these IP-layer App-
   metrics can also be advertised as the attributes of the
   passive/stub link. The associated prefixes can then be
   advertised in the "Stub-Link Prefix Sub-TLV" that is
   defined in [draft-wang-lsr-passive-interface-attribute].
   All the associated prefixes share the same characteristic
   of the link. Other link related sub-TLVs defined in
   [RFC8920] can also be attached and applied to the
   calculation of path to the associated prefixes.


 4.3. IS-IS App-Metrics SubTLVs for IPv6 attachment

   For App Servers using IPv6, the App-Metrics subTLV is
   encoded as below:



Dunbar, et al.         Expires January 12, 2022      [Page 13]

Internet-Draft     OSPF Extension for 5G EC Service

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      | App-Metrics IPv6 subTLV Type  |               Length          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            IPv6 AppServer (ANYCAST) address                   |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            Load measurement sub-TLV                           |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            Capability sub-TLV                                 |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |             Preference sub-TLV                                |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          Figure 3: IPv6 App Server App-Metrics Encoding



 4.4. IS-IS IP Layer App-Metrics for IPv4

   Here is the proposed encoding for App Servers using IPv4
   addresses:

      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | App-Metrics IPv4 subTLV Type  | Length                        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Address Prefix (variable)                                     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Load Measurement Sub-TLV                                      |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | capacity Index Sub-TLV                                        |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Site Preference Sub-TLV                                       |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Figure 4: App-Metrix Sub-TLVs for IPv4



5. Aggregated Cost Advertisement in OSPF

   If all egress edge routers that have a direct connection to
   the App Servers can get a periodic update of the aggregated


Dunbar, et al.         Expires January 12, 2022      [Page 14]

Internet-Draft     OSPF Extension for 5G EC Service

   cost to the App Servers or can be configured with a
   consistent algorithm to compute an aggregated cost that
   takes into consideration the Load Measurement, Capacity
   value, and Preference value, this aggregated cost can be
   considered as the Metric of the link to the App Server.

   In this scenario, there is no protocol extension needed.

 5.1. OSPFv3 LSA to carry the Aggregated Cost

   If the App Servers use IPv6 ANYCAST address, the aggregated
   cost computed by the egress edge routers can be encoded in
   the Metric field [the interface cost] of Intra-Area-Prefix-
   LSA specified by Section 3.7 of the [ RFC5340].

      0                   1                   2                   3
      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |     6 (Intra-Area Prefix)     |         TLV Length            |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |          0    | Aggregated Cost to the App Server             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | PrefixLength  | PrefixOptions |             0                 |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                           Address Prefix                      |
     |                               ...                             |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                Figure 5: Aggregated Cost to App Server


 5.2. OSPFv2 LSA to carry the Aggregated Cost

   For App Servers in IPv4 address, the Aggregated Cost can be
   encoded in the "Metric" field of the Stub Link LSA [Link
   type =3] specified by Section 12.4 of the [RFC2328].

6. IP Layer App-Metrics Advertisements by OSPF

   This section describes the OSPF extension that can carry
   the detailed IP Layer Metrics when it is not possible for
   all the egress edge routers to have a consistent algorithm
   to compute the aggregated cost or some routers need all the
   detailed IP Layer metrics for the App Servers for other
   purposes.

   Since only a subset of routers within an IGP domain need to
   know those detailed metrics, it makes sense to use the
   OSPFv2 Extended Prefix Opaque LSA for IPv4 and OSPFv3



Dunbar, et al.         Expires January 12, 2022      [Page 15]

Internet-Draft     OSPF Extension for 5G EC Service

   Extended LSA with Intra-Area-Prefix TLV to carry the
   detailed sub-TLVs.  For routers that don't care about those
   metrics, they can ignore them very easily.

   It worth noting that not all hosts (prefix) attached to an
   A-ER are ANYCAST servers that need network optimization.
   An A-ER only needs to advertise the App-Metrics for the
   ANYCAST addresses that match with the configured ACLs.

   Draft [draft-wang-lsr-passive-interface-attribute]
   introduces the Stub-Link TLV for OSPFv2/v3 and ISIS
   protocol respectively. Considering the interfaces on an
   edge router that connects to the App servers are normally
   configured as passive interfaces, these IP-layer App-
   metrics can also be advertised as the attributes of the
   passive/stub link. The associated prefixes can then be
   advertised in the "Stub-Link Prefix Sub-TLV" that is
   defined in [draft-wang-lsr-passive-interface-attribute].
   All the associated prefixes share the same characteristic
   of the link. Other link related sub-TLVs defined in
   [RFC8920] can also be attached and applied to the
   calculation of path to the associated prefixes.


 6.1. OSPFv3 Extension to carry the App-Metrics

   For App Servers using IPv6, the OSPFv3 Extended LSA with
   the Intra-Area-Prefix Address TLV specified by the Section
   3.7 of RFC8362 can be used to carry the App-Metrics for the
   attached App Servers.

















Dunbar, et al.         Expires January 12, 2022      [Page 16]

Internet-Draft     OSPF Extension for 5G EC Service

       0                   1                   2                   3
       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |7 (IPv6 Local-Local Address)   |               Length          |
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            IPv6 AppServer (ANYCAST) address                   |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            Load measurement sub-TLV                           |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |            Capability sub-TLV                                 |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
      |             Preference sub-TLV                                |
      ~                                                               ~
      +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          Figure 6: IPv6 App Server App-Metrics Encoding



 6.2. OSPFv2 Extension to advertise the IP Layer App-Metrics

   For App Servers using IPv4 addresses, the OSPFv2 Extended
   Prefix Opaque LSA with the extended Prefix TLV can be used
   to carry the App Metrics sub-TLVs, as specified by the
   Section 2.1 [RFC7684].























Dunbar, et al.         Expires January 12, 2022      [Page 17]

Internet-Draft     OSPF Extension for 5G EC Service

   Here is the proposed encoding:

      0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Type                          | Length                        |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Route Type    | Prefix Length | AF            | Flags         |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Address Prefix (variable)                                     |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Load Measurement Sub-TLV                                      |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | capacity Index Sub-TLV                                        |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     | Site Preference Sub-TLV                                       |
     ~                                                               ~
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   Figure 7: App-Metrix Sub-TLVs in OSPFv2 Extended Prefix TLV


 6.3. IP Layer App-Metrics Sub-TLVs

   Two types of Load Measurement Sub-TLVs are specified:

   a) The Aggregated Load Index based on a weighted
     combination of the collected measurements;
   b) The raw measurements of packets/bytes to/from the App
     Server address. The raw measurement is useful when the
     egress edge routers cannot be configured with a
     consistent algorithm to compute the aggregated load
     index or the raw measurements are needed by a central
     analytic system.


   The Aggregated Load Index Sub-TLV has the following format:

     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |         Type (TBD2)           |               Length          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |                   Measurement Period                          |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
     |           Aggregated Load Index to reach the App Server       |
     +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
            Figure 8: Aggregated Load Index Sub-TLV



Dunbar, et al.         Expires January 12, 2022      [Page 18]

Internet-Draft     OSPF Extension for 5G EC Service

     Type=TBD2 (to be assigned by IANA) indicates that the
     sub-TLV carries the Aggregated Load Measurement Index
     derived from the Weighted combination of bytes/packets
     sent to/received from the App server:

     Index=w1*ToPackets+w2*FromPackes+w3*ToBytes+w4*FromBytes

     Where wi is a value between 0 and 1; w1+ w2+ w3+ w4 = 1.

   The Raw Load Measurement sub-TLV has the following format:

       0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Type (TBD3)         |               Length          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Measurement Period                          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           total number of packets to the AppServer            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           total number of packets from the AppServer          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           total number of bytes to the AppServer              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           total number of bytes from the AppServer            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
             Figure 9: Raw Load Measurement Sub-TLV



     Type= TBD3 (to be assigned by IANA) indicates that the
     sub-TLV carries the Raw measurements of packets/bytes
     to/from the App Server ANYCAST address.

     Measurement Period: A user-specified period in seconds,
     default is 3600 seconds.



   The Capacity Index sub-TLV has the following format:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Type (TBD3)         |               Length          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Capacity Index                              |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
               Figure 10: Capacity Index Sub-TLV




Dunbar, et al.         Expires January 12, 2022      [Page 19]

Internet-Draft     OSPF Extension for 5G EC Service

   The Preference Index sub-TLV has the following format:

        0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |           Type (TBD4)         |               Length          |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
       |                   Preference Index                            |
       +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
               Figure 11: Preference Index Sub-TLV


   Note: "Capacity Index" and "Site preference" can be more
   stable for each site. If those values are configured to
   nodes, they might not need to be included in every OSPF
   LSA.



7. Manageability Considerations

     To be added.

8. Security Considerations


   To be added.

9. IANA Considerations

       The following Sub-TLV types need to be added by IANA
       to OSPFv4 Extended-LSA Sub-TLVs and OSPFv2 Extended
       Link Opaque LSA TLVs Registry.

          - Aggregated Load Index Sub-TLV type
          - Raw Load Measurement Sub-TLV type
          - Capacity Index Sub-TLV type
          - Preference Index Sub-TLV type



10. References






Dunbar, et al.         Expires January 12, 2022      [Page 20]

Internet-Draft     OSPF Extension for 5G EC Service

 10.1. Normative References

   [RFC2119] Bradner, S., "Key words for use in RFCs to
             Indicate Requirement Levels", BCP 14, RFC 2119,
             March 1997.

   [RFC2328] J. Moy, "OSPF Version 2", RFC 2328, April 1998.

   [RFC7684] P. Psenak, et al, "OSPFv2 Prefix/Link Attribute
             Advertisement", RFC 7684, Nov. 2015.

   [RFC8200] S. Deering R. Hinden, "Internet Protocol, Version
             6 (IPv6) Specification", July 2017.

   [RFC8326] A. Lindem, et al, "OSPFv3 Link State
             advertisement (LSA0 Extensibility", RFC 8362,
             April 2018.


 10.2. Informative References

   [3GPP-EdgeComputing] 3GPP TR 23.748, "3rd Generation
             Partnership Project; Technical Specification
             Group Services and System Aspects; Study on
             enhancement of support for Edge Computing in 5G
             Core network (5GC)", Release 17 work in progress,
             Aug 2020.

   [5G-AppMetaData] L. Dunbar, K. Majumdar, H. Wang, "BGP NLRI
             App Meta Data for 5G Edge Computing Service",
             draft-dunbar-idr-5g-edge-compute-app-meta-data-
             01, work-in-progress, Nov 2020.

   [5G-EC-Metrics] L. Dunbar, H. Song, J. Kaippallimalil, "IP
             Layer Metrics for 5G Edge Computing Service",
             draft-dunbar-ippm-5g-edge-compute-ip-layer-
             metrics-01, work-in-progress, Nov 2020.

   [5G-StickyService] L. Dunbar, J. Kaippallimalil, "IPv6
             Solution for 5G Edge Computing Sticky Service",
             draft-dunbar-6man-5g-ec-sticky-service-00, work-
             in-progress, Oct 2020.


Dunbar, et al.         Expires January 12, 2022      [Page 21]

Internet-Draft     OSPF Extension for 5G EC Service

   [RFC5521] P. Mohapatra, E. Rosen, "The BGP Encapsulation
             Subsequent Address Family Identifier (SAFI) and
             the BGP Tunnel Encapsulation Attribute", April
             2009.

   [BGP-SDWAN-Port] L. Dunbar, H. Wang, W. Hao, "BGP Extension
             for SDWAN Overlay Networks", draft-dunbar-idr-
             bgp-sdwan-overlay-ext-03, work-in-progress, Nov
             2018.

   [SDWAN-EDGE-Discovery] L. Dunbar, S. Hares, R. Raszuk, K.
             Majumdar, "BGP UPDATE for SDWAN Edge Discovery",
             draft-dunbar-idr-sdwan-edge-discovery-00, work-
             in-progress, July 2020.

   [Tunnel-Encap] E. Rosen, et al "The BGP Tunnel
             Encapsulation Attribute", draft-ietf-idr-tunnel-
             encaps-10, Aug 2018.



11. Acknowledgments

   Acknowledgements to Acee Lindem, Gyan Mishra, Jeff
   Tantsura, and Donald Eastlake for their review and
   suggestions.

   This document was prepared using 2-Word-v2.0.template.dot.


















Dunbar, et al.         Expires January 12, 2022      [Page 22]

Internet-Draft     OSPF Extension for 5G EC Service



Authors' Addresses

   Linda Dunbar
   Futurewei
   Email: ldunbar@futurewei.com

   Huaimo Chen
   Futurewei
   Email: huaimo.chen@futurewei.com

   Aijun Wang
   China Telecom
   Email: wangaj3@chinatelecom.cn

































Dunbar, et al.         Expires January 12, 2022      [Page 23]

