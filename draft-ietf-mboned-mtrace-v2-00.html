<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Mtrace Version 2: Traceroute Facility for IP Multicast</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Mtrace Version 2: Traceroute Facility for IP Multicast">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">MBONED Working Group</td><td class="header">H. Asaeda</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Keio University</td></tr>
<tr><td class="header">Expires: May 15, 2008</td><td class="header">T. Jinmei</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Toshiba Corporation</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">W. Fenner</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">AT&T Research</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">S. Casner</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Packet Design, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 12, 2007</td></tr>
</table></td></tr></table>
<h1><br />Mtrace Version 2: Traceroute Facility for IP Multicast<br />draft-ietf-mboned-mtrace-v2-00</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 15, 2008.</p>

<h3>Abstract</h3>

<p>This document describes the IP multicast traceroute facility. Unlike unicast traceroute, multicast traceroute requires special implementations on the part of routers. This specification describes the required functionality in multicast routers, as well as how management applications can use the new router functionality.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#sec.intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
Overview<br />
<a href="#anchor3">4.</a>&nbsp;
IPv4 Multicast Traceroute Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.1.</a>&nbsp;
Type: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.hops">4.2.</a>&nbsp;
# hops: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.3.</a>&nbsp;
Checksum: 16 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.multi">4.4.</a>&nbsp;
Multicast Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.5.</a>&nbsp;
Source Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.dest">4.6.</a>&nbsp;
Destination Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.resp">4.7.</a>&nbsp;
Response Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.8.</a>&nbsp;
Resp TTL: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.QID">4.9.</a>&nbsp;
Query ID: 24 bits<br />
<a href="#anchor8">5.</a>&nbsp;
IPv4 Multicast Traceroute Response Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.QAT">5.1.</a>&nbsp;
Query Arrival Time: 32 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">5.2.</a>&nbsp;
Incoming Interface Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.3.</a>&nbsp;
Outgoing Interface Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.4.</a>&nbsp;
Previous-Hop Router Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">5.5.</a>&nbsp;
Packet counts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.iif">5.6.</a>&nbsp;
Input packet count on incoming interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.oif">5.7.</a>&nbsp;
Output packet count on incoming interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">5.8.</a>&nbsp;
Total number of packets for this source-group pair<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.rtproto">5.9.</a>&nbsp;
Rtg Protocol: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">5.10.</a>&nbsp;
Fwd TTL: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.11.</a>&nbsp;
MBZ: 1 bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.12.</a>&nbsp;
S: 1 bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.13.</a>&nbsp;
Src Mask: 6 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.fwcode">5.14.</a>&nbsp;
Forwarding Code: 8 bits<br />
<a href="#anchor18">6.</a>&nbsp;
IPv6 Multicast Traceroute Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">6.1.</a>&nbsp;
Type: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">6.2.</a>&nbsp;
# hops: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">6.3.</a>&nbsp;
Checksum: 16 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">6.4.</a>&nbsp;
Reserved: 32 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">6.5.</a>&nbsp;
Multicast Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">6.6.</a>&nbsp;
Source Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">6.7.</a>&nbsp;
Destination Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">6.8.</a>&nbsp;
Response Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">6.9.</a>&nbsp;
Resp Hop Limit: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">6.10.</a>&nbsp;
Query ID: 24 bits<br />
<a href="#anchor29">7.</a>&nbsp;
IPv6 Multicast Traceroute Response Data<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor30">7.1.</a>&nbsp;
Query Arrival Time: 32 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">7.2.</a>&nbsp;
Incoming Interface ID: 32 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">7.3.</a>&nbsp;
Outgoing Interface ID: 32 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">7.4.</a>&nbsp;
Local Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">7.5.</a>&nbsp;
Remote Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">7.6.</a>&nbsp;
Input packet count on incoming interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">7.7.</a>&nbsp;
Output packet count on incoming interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">7.8.</a>&nbsp;
Total number of packets for this source-group pair<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">7.9.</a>&nbsp;
Rtg Protocol: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">7.10.</a>&nbsp;
Fwd Hop Limit: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">7.11.</a>&nbsp;
MBZ: 7 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">7.12.</a>&nbsp;
S: 1 bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor42">7.13.</a>&nbsp;
Src Prefix Len: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">7.14.</a>&nbsp;
Forwarding Code: 8 bits<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">7.15.</a>&nbsp;
Reserved: 24 bit<br />
<a href="#anchor45">8.</a>&nbsp;
Router Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor46">8.1.</a>&nbsp;
Traceroute Query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor47">8.1.1.</a>&nbsp;
Packet Verification<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor48">8.1.2.</a>&nbsp;
Normal Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.Trace.Req">8.2.</a>&nbsp;
Traceroute Request<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor49">8.2.1.</a>&nbsp;
Packet Verification<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor50">8.2.2.</a>&nbsp;
Normal Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor51">8.3.</a>&nbsp;
Traceroute Response<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.Forward">8.4.</a>&nbsp;
Forwarding Traceroute Requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.response">8.5.</a>&nbsp;
Sending Traceroute Responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor52">8.5.1.</a>&nbsp;
Destination Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor53">8.5.2.</a>&nbsp;
TTL and Hop Limit<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor54">8.5.3.</a>&nbsp;
Source Address<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor55">8.5.4.</a>&nbsp;
Sourcing multicast responses<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor56">8.6.</a>&nbsp;
Hiding information<br />
<a href="#sec.use">9.</a>&nbsp;
Using multicast traceroute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor57">9.1.</a>&nbsp;
Sample client<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor58">9.1.1.</a>&nbsp;
Sending initial query<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor59">9.1.2.</a>&nbsp;
Determining the Path<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor60">9.1.3.</a>&nbsp;
Collecting statistics<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.Lasthop">9.2.</a>&nbsp;
Last hop router<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.first">9.3.</a>&nbsp;
First hop router<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.broken">9.4.</a>&nbsp;
Broken intermediate router<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.terminate">9.5.</a>&nbsp;
Mtrace2 termination<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor61">9.5.1.</a>&nbsp;
Arriving at source<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor62">9.5.2.</a>&nbsp;
Fatal error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor63">9.5.3.</a>&nbsp;
No previous hop<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor64">9.5.4.</a>&nbsp;
Traceroute shorter than requested<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor65">9.6.</a>&nbsp;
Continuing after an error<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor66">9.7.</a>&nbsp;
Multicast Traceroute and shared tree routing protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor67">9.7.1.</a>&nbsp;
PIM-SM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor68">9.7.2.</a>&nbsp;
Bi-directional PIM<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor69">9.7.3.</a>&nbsp;
CBT<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor72">9.8.</a>&nbsp;
Protocol-specific considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor73">9.8.1.</a>&nbsp;
DVMRP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor74">9.8.2.</a>&nbsp;
PIM-DM<br />
<a href="#anchor75">10.</a>&nbsp;
Problem Diagnosis<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor76">10.1.</a>&nbsp;
Forwarding Inconsistencies<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor77">10.2.</a>&nbsp;
TTL or hop limit problems<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.loss">10.3.</a>&nbsp;
Packet loss<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.util">10.4.</a>&nbsp;
Link Utilization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor78">10.5.</a>&nbsp;
Time delay<br />
<a href="#sec.iana">11.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor79">11.1.</a>&nbsp;
Routing protocols<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor80">11.2.</a>&nbsp;
Forwarding codes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor81">11.3.</a>&nbsp;
UDP destination port and IPv6 address<br />
<a href="#anchor82">12.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor83">12.1.</a>&nbsp;
Topology Discovery<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor84">12.2.</a>&nbsp;
Traffic Rates<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor85">12.3.</a>&nbsp;
Unicast Replies<br />
<a href="#anchor86">13.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">14.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">14.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">14.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="sec.intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The unicast "traceroute" program allows the tracing of a path from one machine to another. The key mechanism for unicast traceroute is the ICMP TTL exceeded message, which is specifically precluded as a response to multicast packets. On the other hand, the multicast traceroute facility allows the tracing of an IP multicast routing paths. In this document, we specify the new multicast "traceroute" facility to be implemented in multicast routers and accessed by diagnostic programs. The new multicast traceroute, mtrace version 2 or mtrace2, can provide additional information about packet rates and losses that the unicast traceroute cannot, and generally requires fewer packets to be sent.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
o.  To be able to trace the path that a packet would take from some
    source to some destination.

o.  To be able to isolate packet loss problems (e.g., congestion).

o.  To be able to isolate configuration problems (e.g., TTL
    threshold).

o.  To minimize packets sent (e.g. no flooding, no implosion).
</pre></div>
<p>This document supports both IPv4 and IPv6 multicast traceroute facility. The protocol design, concept, and program behavior are same between IPv4 and IPv6 mtrace2. Regarding the previous IPv4 multicast traceroute, mtrace, the query and response messages for IPv4 mtrace are implemented as <a class='info' href='#refs.IGMPv3'>IGMP messages<span> (</span><span class='info'>Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A. Thyagarajan, &ldquo;Internet Group Management Protocol, Version 3,&rdquo; October&nbsp;2002.</span><span>)</span></a> [refs.IGMPv3]. On the other hand, mtrace2 messages are carried on UDP, whereas the packet formats of IPv4 and IPv6 mtrace2 are different (but similar) because of the different address family.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT","SHOULD", "SHOULD NOT", "RECOMMENDED","MAY", and "OPTIONAL" in this document are to be interpreted as described in <a class='info' href='#refs.KEYWORDS'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to indicate requirement levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [refs.KEYWORDS].
</p>
<p>Since multicast traceroutes flow in the opposite direction to the data flow, we refer to "upstream" and "downstream" with respect to data, unless explicitly specified.
</p>
<p>Incoming interface:
	  <br />

	  The interface on which traffic is expected from the specified source and group.
</p>
<p>Outgoing interface:
	  <br />

	  The interface on which traffic is forwarded from the specified source and group toward the destination. It is the interface on which the multicast traceroute Request was received.
</p>
<p>Previous-hop router:
	  <br />

	  The router that is on the link attached to the Incoming Interface and is responsible for forwarding traffic for the specified source and group.
</p>
<p>Group state:
	  <br />

	  It is the state in which a shared-tree protocol (e.g., <a class='info' href='#refs.PIMSM'>PIM-SM<span> (</span><span class='info'>Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised),&rdquo; August&nbsp;2006.</span><span>)</span></a> [refs.PIMSM]) running on a router chooses the previous-hop router toward the core router (or RP) as its parent router. In this state, source-specific state is not available for the corresponding multicast address on the router.
</p>
<p>Source-specific state:
	  <br />

	  It is the state in which a routing protocol running on a router chooses the path that would be followed for a source-specific join.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>Given a multicast distribution tree, tracing from a source to a multicast destination is hard, since you don't know down which branch of the multicast tree the destination lies. This means that you have to flood the whole tree to find the path from one source to one destination. However, walking up the tree from destination to source is easy, as most existing multicast routing protocols know the previous hop for each source. Tracing from destination to source can involve only routers on the direct path.
</p>
<p>The party requesting the traceroute (which need be neither the source nor the destination) sends a traceroute Query packet to the last-hop multicast router for the given destination. The last-hop router turns the Query into a Request packet by adding a response data block containing its interface addresses and packet statistics, and then forwards the Request packet via unicast to the router that it believes is the proper previous hop for the given source and group. Each hop adds its response data to the end of the Request packet, then unicast forwards it to the previous hop. The first hop router (the router that believes that packets from the source originate on one of its directly connected networks) changes the packet type to indicate a Response packet and sends the completed response to the response destination address. The response may be returned before reaching the first hop router if a fatal error condition such as "no route" is encountered along the path.
</p>
<p>Multicast traceroute uses any information available to it in the router to attempt to determine a previous hop to forward the trace towards. Multicast routing protocols vary in the type and amount of state they keep; multicast traceroute endeavors to work with all of them by using whatever is available. For example, if a DVMRP router has no active state for a particular source but does have a DVMRP route, it chooses the parent of the DVMRP route as the previous hop. If a PIM-SM router is on the (*,G) tree, it chooses the parent towards the RP as the previous hop. In these cases, no source/group-specific state is available, but the path may still be traced.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
IPv4 Multicast Traceroute Header</h3>

<p>The mtrace2 message is carried as a UDP packet. The UDP source port is uniquely selected by the local host operating system. The UDP destination port is the IANA reserved mtrace2 port number (see <a class='info' href='#sec.iana'>Section&nbsp;11<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>). The UDP checksum MUST be valid in mtrace2 control messages.
</p>
<p>The IPv4 mtrace2 includes the common packet header as follows. The header is only filled in by the originator of the traceroute Query; intermediate routers MUST NOT modify any of the fields.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |                  Reserved                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Multicast Address                        |
+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
|                        Source Address                         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Destination Address                      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Response Address                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Resp TTL/HopLim|                  Query ID                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Type: 8 bits</h3>

<p>The UDP type field is defined to be "0x1" for traceroute queries and requests. The UDP type field is changed to "0x2" when the packet is completed and sent as a response from the first hop router to the querier. Two codes are required so that multicast routers won't attempt to process a completed response in those cases where the initial query was issued from a router or the response is sent via multicast.
</p>
<a name="sec.hops"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
# hops: 8 bits</h3>

<p>This field specifies the maximum number of hops that the requester wants to trace. If there is some error condition in the middle of the path that keeps the traceroute request from reaching the first-hop router, this field can be used to perform an expanding-ring search to trace the path to just before the problem.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Checksum: 16 bits</h3>

<p>The checksum is the 16-bit one's complement of the one's complement sum of the whole UDP message <a class='info' href='#refs.Cksum'>(the entire IP payload)<span> (</span><span class='info'>Braden, B., Borman, D., and C. Partridge, &ldquo;Computing the Internet Checksum,&rdquo; September&nbsp;1988.</span><span>)</span></a> [refs.Cksum]. When computing the checksum, the checksum field is set to zero. When transmitting packets, the checksum MUST be computed and inserted into this field. When receiving packets, the checksum MUST be verified before processing a packet.
</p>
<a name="sec.multi"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Multicast Address</h3>

<p>This field specifies the multicast address to be traced, or zero if no group-specific information is desired. Note that non-group-specific traceroutes may not be possible with certain multicast routing protocols.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.5"></a><h3>4.5.&nbsp;
Source Address</h3>

<p>This field specifies the IP address of the multicast source for the path being traced, or 0xffffffff if no source-specific information is desired. Note that non-source-specific traceroutes may not be possible with certain multicast routing protocols.
</p>
<a name="sec.dest"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.6"></a><h3>4.6.&nbsp;
Destination Address</h3>

<p>This field specifies the IP address of the multicast receiver for the path being traced. The trace starts at this destination and proceeds toward the traffic source.
</p>
<a name="sec.resp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.7"></a><h3>4.7.&nbsp;
Response Address</h3>

<p>This field specifies IP address to which the completed traceroute response packet gets sent. It can be a unicast address or a multicast address, as explained in <a class='info' href='#sec.Trace.Req'>Section&nbsp;8.2<span> (</span><span class='info'>Traceroute Request</span><span>)</span></a>
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.8"></a><h3>4.8.&nbsp;
Resp TTL: 8 bits</h3>

<p>This field specifies the TTL at which to multicast the response, if the response address is a multicast address.
</p>
<a name="sec.QID"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.9"></a><h3>4.9.&nbsp;
Query ID: 24 bits</h3>

<p>This field is used as a unique identifier for this traceroute request so that duplicate or delayed responses may be detected and to minimize collisions when a multicast response address is used.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
IPv4 Multicast Traceroute Response Data</h3>

<p>Each intermediate router in a trace path appends "response data" to the forwarded trace packet. The response data looks as follows.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Query Arrival Time                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Incoming Interface Address                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Outgoing Interface Address                   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Previous-Hop Router Address                  |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|           Input packet count on incoming interface            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|           Output packet count on outgoing interface           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|      Total number of packets for this source-group pair       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|               |               |M| |           |               |
| Rtg Protocol  |    Fwd TTL    |B|S| Src Mask  |Forwarding Code|
|               |               |Z| |           |               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
</p>
<a name="sec.QAT"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Query Arrival Time: 32 bits</h3>

<p>The Query Arrival Time is a 32-bit NTP timestamp specifying the arrival time of the traceroute request packet at this router. The 32-bit form of an NTP timestamp consists of the middle 32 bits of the full 64-bit form; that is, the low 16 bits of the integer part and the high 16 bits of the fractional part.
</p>
<p>The following formula converts from a UNIX timeval to a 32-bit NTP timestamp:
</p>
<blockquote class="text">
<p>query_arrival_time
	    <br />

	    = (tv.tv_sec + 32384) &lt;&lt; 16 + ((tv.tv_usec &lt;&lt; 10) / 15625)
	    
</p>
</blockquote>
<p>The constant 32384 is the number of seconds from Jan 1, 1900 to Jan 1, 1970 truncated to 16 bits.  ((tv.tv_usec &lt;&lt; 10) / 15625) is a reduction of ((tv.tv_usec / 100000000) &lt;&lt; 16).
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Incoming Interface Address</h3>

<p>This field specifies the address of the interface on which packets from this source and group are expected to arrive, or 0 if unknown.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Outgoing Interface Address</h3>

<p>This field specifies the address of the interface on which packets from this source and group flow to the specified destination, or 0 if unknown.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Previous-Hop Router Address</h3>

<p>This field specifies the router from which this router expects packets from this source. This may be a multicast group (e.g. ALL-[protocol]-ROUTERS.MCAST.NET) if the previous hop is not known because of the workings of the multicast routing protocol. However, it should be 0 if the incoming interface address is unknown.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.5"></a><h3>5.5.&nbsp;
Packet counts</h3>

<p>Note that these packet counts SHOULD be as up to date as possible. If packet counts are not being maintained on the processor that handles the traceroute request in a multi-processor router architecture, the packet SHOULD be delayed while the counters are gathered from the remote processor(s). If this occurs, the Query Arrival Time should be updated to reflect the time at which the packet counts were learned.
</p>
<a name="sec.iif"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.6"></a><h3>5.6.&nbsp;
Input packet count on incoming interface</h3>

<p>This field contains the number of multicast packets received for all groups and sources on the incoming interface, or 0xffffffffffffffff if no count can be reported. This counter should have the same value as ifInMulticastPkts from the <a class='info' href='#refs.IFMIB'>IF-MIB<span> (</span><span class='info'>McCloghrie, K. and F. Kastenholz, &ldquo;The Interfaces Group MIB,&rdquo; June&nbsp;2000.</span><span>)</span></a> [refs.IFMIB] for this interface.
</p>
<a name="sec.oif"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.7"></a><h3>5.7.&nbsp;
Output packet count on incoming interface</h3>

<p>This field contains the number of multicast packets that have been transmitted or queued for transmission for all groups and sources on the outgoing interface, or 0xffffffffffffffff if no count can be reported. This counter should have the same value as ifOutMulticastPkts from the IF-MIB for this interface.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.8"></a><h3>5.8.&nbsp;
Total number of packets for this source-group pair</h3>

<p>This field counts the number of packets from the specified source forwarded by this router to the specified group, or 0xffffffffffffffff if no count can be reported. If the S bit is set, the count is for the source network, as specified by the Src Mask field. If the S bit is set and the Src Mask field is 63, indicating no source-specific state, the count is for all sources sending to this group. This counter should have the same value as ipMcastRoutePkts from the <a class='info' href='#refs.MROUTEMIB'>IPMROUTE-STD-MIB<span> (</span><span class='info'>McWalter, D., Thaler, D., and A. Kessler, &ldquo;IP Multicast MIB,&rdquo; March&nbsp;2007.</span><span>)</span></a> [refs.MROUTEMIB] for this forwarding entry.
</p>
<a name="sec.rtproto"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.9"></a><h3>5.9.&nbsp;
Rtg Protocol: 8 bits</h3>

<p>This field describes the routing protocol in use between this router and the previous-hop router. Specified values include:
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
1    DVMRP
2    MOSPF
3    PIM
4    CBT
5    PIM using special routing table
6    PIM using a static route
7    DVMRP using a static route
8    PIM using MBGP route
9    CBT using special routing table
10   CBT using a static route
11   PIM using state created by Assert processing
12   Bi-directional PIM
</pre></div>
<p>
</p>
<p>Note that some of the routing protocols or functions are not supported or not used in either of IPv4 multicast nor IPv6 multicast.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.10"></a><h3>5.10.&nbsp;
Fwd TTL: 8 bits</h3>

<p>This field contains the TTL that a packet is required to have before it will be forwarded over the outgoing interface.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.11"></a><h3>5.11.&nbsp;
MBZ: 1 bit</h3>

<p>Must be zeroed on transmission and ignored on reception.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.12"></a><h3>5.12.&nbsp;
S: 1 bit</h3>

<p>This S bit indicates that the packet count for the source-group pair is for the source network, as determined by masking the source address with the Src Mask field.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.13"></a><h3>5.13.&nbsp;
Src Mask: 6 bits</h3>

<p>This field contains the number of 1's in the netmask this router has for the source (i.e. a value of 24 means the netmask is 0xffffff00). If the router is forwarding solely on group state, this field is set to 63 (0x3f).
</p>
<a name="sec.fwcode"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.14"></a><h3>5.14.&nbsp;
Forwarding Code: 8 bits</h3>

<p>This field contains a forwarding information/error code. Defined values are as follows;
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
Value   Name            Description

-----  --------------  -------------------------------------------

0x00   NO_ERROR        No error

0x01   WRONG_IF        Traceroute request arrived on an interface
                       to which this router would not forward for
                       this source,group,destination.

0x02   PRUNE_SENT      This router has sent a prune upstream which
                       applies to the source and group in the
                       traceroute request.

0x03   PRUNE_RCVD      This router has stopped forwarding for this
                       source and group in response to a request
                       from the next hop router.

0x04   SCOPED          The group is subject to administrative
                       scoping at this hop.

0x05   NO_ROUTE        This router has no route for the source or
                       group and no way to determine a potential
                       route.

0x06   WRONG_LAST_HOP  This router is not the proper last-hop
                       router.

0x07   NOT_FORWARDING  This router is not forwarding this source,
                       group out the outgoing interface for an
                       unspecified reason.

0x08   REACHED_RP      Reached Rendez-vous Point or Core

0x09   RPF_IF          Traceroute request arrived on the expected
                       RPF interface for this source, group.

0x0A   NO_MULTICAST    Traceroute request arrived on an interface
                       which is not enabled for multicast.

0x0B   INFO_HIDDEN     One or more hops have been hidden from this
                       trace.

0x81   NO_SPACE        There was not enough room to insert another
                       response data block in the packet.

0x82   OLD_ROUTER      The previous-hop router does not understand
                       traceroute requests.

0x83   ADMIN_PROHIB    Traceroute is administratively prohibited.
</pre></div>
<p>
</p>
<p>Note that if a router discovers there is not enough room in a packet to insert its response, it puts the 0x81 error code in the previous router's Forwarding Code field, overwriting any error the previous router placed there. A multicast traceroute client, upon receiving this error, MAY restart the trace at the last hop listed in the packet.
</p>
<p>The 0x80 bit of the Forwarding Code is used to indicate a fatal error. A fatal error is one where the router may know the previous hop but cannot forward the message to it.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IPv6 Multicast Traceroute Header</h3>

<p>IPv6 mtrace2 includes the common packet header as follows. Because of the specification of the IPv6 address, all IPv6 addresses used in each field consume 128 bits length.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|      Type     |    # hops     |           Checksum            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          Reserved                             |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
*                                                               *
|                                                               |
*                      Multicast Address                        *
|                                                               |
*                                                               *
|                                                               |
+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
|                                                               |
*                                                               *
|                                                               |
*                        Source Address                         *
|                                                               |
*                                                               *
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
*                                                               *
|                                                               |
*                      Destination Address                      *
|                                                               |
*                                                               *
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
*                                                               *
|                                                               |
*                       Response Address                        *
|                                                               |
*                                                               *
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Resp Hop Limit |                  Query ID                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Type: 8 bits</h3>

<p>The UDP type field is defined to be "0x1" for traceroute queries and requests. The UDP type field is changed to "0x2" when the packet is completed and sent as a response from the first hop router to the querier. Two codes are required so that multicast routers won't attempt to process a completed response in those cases where the initial query was issued from a router or the response is sent via multicast.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
# hops: 8 bits</h3>

<p>Same definition described in <a class='info' href='#sec.hops'>Section&nbsp;4.2<span> (</span><span class='info'># hops: 8 bits</span><span>)</span></a>
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Checksum: 16 bits</h3>

<p>As defined <a class='info' href='#refs.IPv6'>in<span> (</span><span class='info'>Deering, S. and R. Hinden, &ldquo;Internet Protocol, Version 6 (IPv6) Specification,&rdquo; December&nbsp;1998.</span><span>)</span></a> [refs.IPv6], the checksum is the 16-bit one's complement of the one's complement sum of the entire UDP message, starting with the UDP message type field, and prepended with a "pseudo-header" of IPv6 header fields.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Reserved: 32 bits</h3>

<p>Initialized to zero by the sender; ignored by receivers.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Multicast Address</h3>

<p>Same definition described in <a class='info' href='#sec.multi'>Section&nbsp;4.4<span> (</span><span class='info'>Multicast Address</span><span>)</span></a>
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Source Address</h3>

<p>This field specifies the IPv6 address of the multicast source for the path being traced, or is filled with the unspecified address (::) if no source-specific information is desired. Note that non-source-specific traceroutes may not be possible with certain multicast routing protocols.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7"></a><h3>6.7.&nbsp;
Destination Address</h3>

<p>Same definition described in <a class='info' href='#sec.dest'>Section&nbsp;4.6<span> (</span><span class='info'>Destination Address</span><span>)</span></a>
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.8"></a><h3>6.8.&nbsp;
Response Address</h3>

<p>Same definition described in <a class='info' href='#sec.resp'>Section&nbsp;4.7<span> (</span><span class='info'>Response Address</span><span>)</span></a>
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.9"></a><h3>6.9.&nbsp;
Resp Hop Limit: 8 bits</h3>

<p>This field specifies the hop limit at which to multicast the response, if the response address is a multicast address.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.10"></a><h3>6.10.&nbsp;
Query ID: 24 bits</h3>

<p>Same definition described in <a class='info' href='#sec.QID'>Section&nbsp;4.9<span> (</span><span class='info'>Query ID: 24 bits</span><span>)</span></a>
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IPv6 Multicast Traceroute Response Data</h3>

<p>Each intermediate router in a trace path appends "response data" to the forwarded trace packet. The response data looks as follows.
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                      Query Arrival Time                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Incoming Interface ID                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                     Outgoing Interface ID                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
*                                                               *
|                                                               |
*                         Local Address                         *
|                                                               |
*                                                               *
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
*                                                               *
|                                                               |
*                         Remote Address                        *
|                                                               |
*                                                               *
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|           Input packet count on incoming interface            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|           Output packet count on outgoing interface           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|      Total number of packets for this source-group pair       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Rtg Protocol  | Fwd Hop Limit |     MBZ     |S|Src Prefix Len |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|Forwarding Code|                   Reserved                    |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre></div>
<p>
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Query Arrival Time: 32 bits</h3>

<p>Same definition described in <a class='info' href='#sec.QAT'>Section&nbsp;5.1<span> (</span><span class='info'>Query Arrival Time: 32 bits</span><span>)</span></a>
</p>
<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Incoming Interface ID: 32 bits</h3>

<p>This field specifies the interface ID on which packets from this source and group are expected to arrive, or 0 if unknown. This ID should be the value taken from InterfaceIndex of the IF-MIB for this interface. This field is carried in network byte order.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Outgoing Interface ID: 32 bits</h3>

<p>This field specifies the interface ID on which packets from this source and group flow to the specified destination, or 0 if unknown. This ID should be the value taken from InterfaceIndex of the IF-MIB for this interface. This field is carried in network byte order.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Local Address</h3>

<p>This field specifies a global IPv6 address that uniquely identifies the router. A <a class='info' href='#refs.DefRtr'>unique local unicast address<span> (</span><span class='info'>Draves, R. and D. Thaler, &ldquo;Default Router Preferences and More-Specific Routes,&rdquo; November&nbsp;2005.</span><span>)</span></a> [refs.DefRtr] SHOULD NOT be used unless the node is only assigned link-local and unique local addresses. [TBD: What if the node is only assigned link-local addresses? It should be very unlikely case, but is possible even for a properly working router.]
</p>
<p>Note that since interface indices used in the Incoming and Outgoing Interface ID fields are node-local information, a global identifier is needed to specify the router.
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.5"></a><h3>7.5.&nbsp;
Remote Address</h3>

<p>This field specifies the address of the previous-hop router, which, in most cases, is a link-local unicast address for the queried source and destination addresses.
</p>
<p>Although a link-local address does not have enough information to identify a node, it is possible to detect the previous-hop router with the assistance of Incoming Interface ID and the current router address (i.e., Local Address).
</p>
<p>This may be a multicast group (e.g., ALL-[protocol]-ROUTERS.MCAST.NET) if the previous hop is not known because of the workings of the multicast routing protocol. However, it should be the unspecified address (::) if the incoming interface address is unknown.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.6"></a><h3>7.6.&nbsp;
Input packet count on incoming interface</h3>

<p>Same definition described in <a class='info' href='#sec.iif'>Section&nbsp;5.6<span> (</span><span class='info'>Input packet count on incoming interface</span><span>)</span></a>
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.7"></a><h3>7.7.&nbsp;
Output packet count on incoming interface</h3>

<p>Same definition described in <a class='info' href='#sec.oif'>Section&nbsp;5.7<span> (</span><span class='info'>Output packet count on incoming interface</span><span>)</span></a>
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.8"></a><h3>7.8.&nbsp;
Total number of packets for this source-group pair</h3>

<p>This field counts the number of packets from the specified source forwarded by this router to the specified group, or 0xffffffffffffffff if no count can be reported. If the S bit is set, the count is for the source network, as specified by the Src Prefix Len field. If the S bit is set and the Src Prefix Len field is 255, indicating no source-specific state, the count is for all sources sending to this group. This counter should have the same value as ipMcastRoutePkts from the IPMROUTE-STD-MIB for this forwarding entry.
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.9"></a><h3>7.9.&nbsp;
Rtg Protocol: 8 bits</h3>

<p>Same definition described in <a class='info' href='#sec.rtproto'>Section&nbsp;5.9<span> (</span><span class='info'>Rtg Protocol: 8 bits</span><span>)</span></a>
</p>
<p>Note that some of the routing protocols or functions are not supported or not used in IPv6 multicast.
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.10"></a><h3>7.10.&nbsp;
Fwd Hop Limit: 8 bits</h3>

<p>This field contains the hop limit that a packet is required to have before it will be forwarded over the outgoing interface.
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.11"></a><h3>7.11.&nbsp;
MBZ: 7 bits</h3>

<p>Must be zeroed on transmission and ignored on reception.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.12"></a><h3>7.12.&nbsp;
S: 1 bit</h3>

<p>This S bit indicates that the packet count for the source-group pair is for the source network, as determined by masking the source address with the Src Prefix Len field.
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.13"></a><h3>7.13.&nbsp;
Src Prefix Len: 8 bits</h3>

<p>This field contains the decimal number of the prefix length this router has for the source. If the router is forwarding solely on group state, this field is set to 255 (0xff)
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.14"></a><h3>7.14.&nbsp;
Forwarding Code: 8 bits</h3>

<p>Same definition described in <a class='info' href='#sec.fwcode'>Section&nbsp;5.14<span> (</span><span class='info'>Forwarding Code: 8 bits</span><span>)</span></a>
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.15"></a><h3>7.15.&nbsp;
Reserved: 24 bit</h3>

<p>Initialized to zero by the sender; ignored by receivers.
</p>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Router Behavior</h3>

<p>All of these actions are performed in addition to (NOT instead of) forwarding the packet, if applicable. E.g. a multicast packet that has TTL or the hop limit remaining MUST be forwarded normally, as MUST a unicast packet that has TTL or the hop limit remaining and is not addressed to this router.
</p>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Traceroute Query</h3>

<p>A traceroute Query message is a traceroute message with no response blocks filled in, and uses UDP type 0x1 for IPv4 and IPv6 mtrace2.
</p>
<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.1"></a><h3>8.1.1.&nbsp;
Packet Verification</h3>

<p>Upon receiving a traceroute Query message, a router must examine the Query to see if it is the proper last-hop router for the destination address in the packet. It is the proper last-hop router if it has a multicast-capable interface on the same subnet as the Destination Address and is the router that would forward traffic from the given source onto that subnet.
</p>
<p>If the router determines that it is not the proper last-hop router, or it cannot make that determination, it does one of two things depending if the Query was received via multicast or unicast. If the Query was received via multicast, then it MUST be silently dropped. If it was received via unicast, a forwarding code of WRONG_LAST_HOP is noted and processing continues as in <a class='info' href='#sec.Trace.Req'>Section&nbsp;8.2<span> (</span><span class='info'>Traceroute Request</span><span>)</span></a>
</p>
<p>Duplicate Query messages as identified by the tuple (IP Source, Query ID) SHOULD be ignored. This MAY be implemented using a simple 1-back cache (i.e. remembering the IP source and Query ID of the previous Query message that was processed, and ignoring future messages with the same IP Source and Query ID). Duplicate Request messages MUST NOT be ignored in this manner.
</p>
<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1.2"></a><h3>8.1.2.&nbsp;
Normal Processing</h3>

<p>When a router receives a traceroute Query and it determines that it is the proper last-hop router, it treats it like a traceroute Request and performs the steps listed in <a class='info' href='#sec.Trace.Req'>Section&nbsp;8.2<span> (</span><span class='info'>Traceroute Request</span><span>)</span></a>
</p>
<a name="sec.Trace.Req"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Traceroute Request</h3>

<p>A traceroute Request is a traceroute message with some number of response blocks filled in, and uses UDP type 0x1 for IPv4 and IPv6 mtrace2. Routers can tell the difference between Queries and Requests by checking the length of the packet.
</p>
<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.1"></a><h3>8.2.1.&nbsp;
Packet Verification</h3>

<p>If the traceroute Request is not addressed to this router, or if the Request is addressed to a multicast group which is not a link-scoped group (i.e. 224/24 for IPv4, <a class='info' href='#refs.IPv6Addr'>FFx2::/16<span> (</span><span class='info'>Hinden, R. and S. Deering, &ldquo;IP Version 6 Addressing Architecture,&rdquo; July&nbsp;1998.</span><span>)</span></a> [refs.IPv6Addr] for IPv6), it MUST be silently ignored.
</p>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2.2"></a><h3>8.2.2.&nbsp;
Normal Processing</h3>

<p>When a router receives a traceroute Request, it performs the following steps. Note that it is possible to have multiple situations covered by the Forwarding Codes. The first one encountered is the one that is reported, i.e. all "note forwarding code N" should be interpreted as "if forwarding code is not already set, set forwarding code to N".
</p>
<ol class="text">
<li>If there is room in the current buffer (or the router can efficiently allocate more space to use), insert a new response block into the packet and fill in the Query Arrival Time, Outgoing Interface Address (for IPv4 mtrace2) or Outgoing Interface ID (for IPv6 mtrace2), Output Packet Count, and Fwd TTL or Fwd Hop Limit. If there was no room, fill in the response code "NO_SPACE" in the <strong>previous</strong> hop's response block, and forward the packet to the requester as described in "Forwarding Traceroute Requests".
</li>
<li>Attempt to determine the forwarding information for the source and group specified, using the same mechanisms as would be used when a packet is received from the source destined for the group. State need not be instantiated, it can be "phantom" state created only for the purpose of the trace.
		<br />
<br />

		If using a shared-tree protocol and there is no source-specific state, or if the source is specified as 0xFFFFFFFF, group state should be used. If there is no group state or the group is specified as 0, potential source state (i.e. the path that would be followed for a source-specific Join) should be used. If this router is the Core or RP and no source-specific information is available, note an error code of REACHED_RP.
</li>
<li>If no forwarding information can be determined, the router notes an error code of NO_ROUTE, sets the remaining fields that have not yet been filled in to zero, and then forwards the packet to the requester as described in "Forwarding Traceroute Requests".
</li>
<li>Fill in the Incoming Interface Address, Previous-Hop Router Address, Input Packet Count, Total Number of Packets, Routing Protocol, S, and Src Mask from the forwarding information that was determined.
</li>
<li>If traceroute is administratively prohibited or the previous hop router does not understand traceroute requests, note the appropriate forwarding code (ADMIN_PROHIB or OLD_ROUTER). If traceroute is administratively prohibited and any of the fields as filled in step 4 are considered private information, zero out the applicable fields. Then the packet is forwarded to the requester as described in "Forwarding Traceroute Requests".
</li>
<li>If the reception interface is not enabled for multicast, note forwarding code NO_MULTICAST. If the reception interface is the interface from which the router would expect data to arrive from the source, note forwarding code RPF_IF. Otherwise, if the reception interface is not one to which the router would forward data from the source to the group, a forwarding code of WRONG_IF is noted.
</li>
<li>If the group is subject to administrative scoping on either the Outgoing or Incoming interfaces, a forwarding code of SCOPED is noted.
</li>
<li>If this router is the Rendez-vous Point or Core for the group, a forwarding code of REACHED_RP is noted.
</li>
<li>If this router has sent a prune upstream which applies to the source and group in the traceroute Request, it notes forwarding code PRUNE_SENT. If the router has stopped forwarding downstream in response to a prune sent by the next hop router, it notes forwarding code PRUNE_RCVD. If the router should normally forward traffic for this source and group downstream but is not, it notes forwarding code NOT_FORWARDING.
</li>
<li>The packet is then sent on to the previous hop or the requester as described in <a class='info' href='#sec.Forward'>Section&nbsp;8.4<span> (</span><span class='info'>Forwarding Traceroute Requests</span><span>)</span></a>.
</li>
</ol>
<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
Traceroute Response</h3>

<p>A router must forward all traceroute response packets normally, with no special processing. If a router has initiated a traceroute with a Query or Request message, it may listen for Responses to that traceroute but MUST still forward them as well.
</p>
<a name="sec.Forward"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Forwarding Traceroute Requests</h3>

<p>If the Previous-hop router is known for this request and the number of response blocks is less than the number requested, the packet is sent to that router. If the Incoming Interface is known but the Previous-hop router is not known, the packet is sent to an appropriate multicast address on the Incoming Interface. The appropriate multicast address may depend on the routing protocol in use, MUST be a link-scoped group (i.e. 224/24 for IPv4, FF02::/16 for IPv6), MUST NOT be ALL-SYSTEMS.MCAST.NET (224.0.0.1) for IPv4 and All Nodes Address (FF02::1) for IPv6, and MAY be ALL-ROUTERS.MCAST.NET (224.0.0.2) for IPv4 or All Routers Address (FF02::2) for IPv6 if the routing protocol in use does not define a more appropriate group. Otherwise, it is sent to the Response Address in the header, as described in <a class='info' href='#sec.response'>Section&nbsp;8.5<span> (</span><span class='info'>Sending Traceroute Responses</span><span>)</span></a>.
</p>
<p>Note that it is not an error for the number of response blocks to be greater than the number requested; such a packet should simply be forwarded to the requester as described in <a class='info' href='#sec.response'>Section&nbsp;8.5<span> (</span><span class='info'>Sending Traceroute Responses</span><span>)</span></a>.
</p>
<a name="sec.response"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Sending Traceroute Responses</h3>

<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.1"></a><h3>8.5.1.&nbsp;
Destination Address</h3>

<p>A traceroute response must be sent to the Response Address in the traceroute header.
</p>
<a name="anchor53"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.2"></a><h3>8.5.2.&nbsp;
TTL and Hop Limit</h3>

<p>If the Response Address is unicast, the router inserts its normal unicast TTL or hop limit in the IP header, and may use any of its interface addresses as the source address. If the Response Address is multicast, the router copies the Response TTL or hop limit from the traceroute header into the IP header.
</p>
<a name="anchor54"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.3"></a><h3>8.5.3.&nbsp;
Source Address</h3>

<p>If the Response Address is unicast, the router may use any of its interface addresses as the source address. Since some multicast routing protocols forward based on source address, if the Response Address is multicast, the router MUST use an address that is known in the multicast routing topology if it can make that determination.
</p>
<a name="anchor55"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5.4"></a><h3>8.5.4.&nbsp;
Sourcing multicast responses</h3>

<p>When a router sources a multicast response, the response packet MUST be sent on a single interface, then forwarded as if it were received on that interface.  It MUST NOT source the response packet individually on each interface, in order to avoid duplicate packets.
</p>
<a name="anchor56"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Hiding information</h3>

<p>Information about a domain's topology and connectivity may be hidden from multicast traceroute requests. The exact mechanism is not specified here; however, the INFO_HIDDEN forwarding code may be used to note that, for example, the incoming interface address and packet count are for the entrance to the domain and the outgoing interface address and packet count are the exit from the domain. The source-group packet count may be from either router or not specified (0xffffffff).
</p>
<a name="sec.use"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Using multicast traceroute</h3>

<a name="anchor57"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
Sample client</h3>

<p>This section describes the behavior of an example multicast traceroute client.
</p>
<a name="anchor58"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.1"></a><h3>9.1.1.&nbsp;
Sending initial query</h3>

<p>When the destination of the mtrace2 is the machine running the client, the mtrace2 Query packet can be sent to the ALL-ROUTERS.MCAST.NET (224.0.0.2) for IPv4 or All Routers Address (FF02::2) for IPv6. This will ensure that the packet is received by the last-hop router on the subnet. Otherwise, if the proper last-hop router is known for the mtrace2 destination, the Query could be unicasted to that router. Otherwise, the Query packet should be multicasted to the group being queried; if the destination of the mtrace2 is a member of the group, this will get the Query to the proper last-hop router. In this final case, the packet should contain the <a class='info' href='#refs.RA'>Router Alert option<span> (</span><span class='info'>Katz, D., &ldquo;IP Router Alert Option,&rdquo; February&nbsp;1997.</span><span>)</span></a> [refs.RA], to make sure that routers that are not members of the multicast group notice the packet.
</p>
<p>See also <a class='info' href='#sec.Lasthop'>Section&nbsp;9.2<span> (</span><span class='info'>Last hop router</span><span>)</span></a> on determining the last-hop router.
</p>
<a name="anchor59"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.2"></a><h3>9.1.2.&nbsp;
Determining the Path</h3>

<p>The client could send a small number of initial query messages with a large "# hops" field, in order to try to trace the full path. If this attempt fails, one strategy is to perform a linear search (as the traditional unicast traceroute program does); set the "# hops" field to 1 and try to get a response, then 2, and so on. If no response is received at a certain hop, the hop count can continue past the non-responding hop, in the hopes that further hops may respond. These attempts should continue until a user-defined timeout has occurred.
</p>
<p>See also <a class='info' href='#sec.first'>Section&nbsp;9.3<span> (</span><span class='info'>First hop router</span><span>)</span></a> and <a class='info' href='#sec.broken'>Section&nbsp;9.4<span> (</span><span class='info'>Broken intermediate router</span><span>)</span></a> on receiving the results of a trace.
</p>
<a name="anchor60"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1.3"></a><h3>9.1.3.&nbsp;
Collecting statistics</h3>

<p>After a client has determined that it has traced the whole path or as much as it can expect to (see <a class='info' href='#sec.terminate'>Section&nbsp;9.5<span> (</span><span class='info'>Mtrace2 termination</span><span>)</span></a>), it might collect statistics by waiting a short time and performing a second trace. If the path is the same in the two traces, statistics can be displayed as described in <a class='info' href='#sec.loss'>Section&nbsp;10.3<span> (</span><span class='info'>Packet loss</span><span>)</span></a> and <a class='info' href='#sec.util'>Section&nbsp;10.4<span> (</span><span class='info'>Link Utilization</span><span>)</span></a>.
</p>
<a name="sec.Lasthop"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.2"></a><h3>9.2.&nbsp;
Last hop router</h3>

<p>The mtrace2 querier may not know which is the last hop router, or that router may be behind a firewall that blocks unicast packets but passes multicast packets. In these cases, the mtrace2 request should be multicasted to the group being traced (since the last hop router listens to that group). All routers except the correct last hop router should ignore any mtrace2 request received via multicast. Mtrace2 requests which are multicasted to the group being traced must include the <a class='info' href='#refs.RA'>Router Alert option<span> (</span><span class='info'>Katz, D., &ldquo;IP Router Alert Option,&rdquo; February&nbsp;1997.</span><span>)</span></a> [refs.RA].
</p>
<p>Another alternative is to unicast to the trace destination. Traceroute requests which are unicasted to the trace destination must include the Router Alert option, in order that the last-hop router is aware of the packet.
</p>
<p>If the traceroute querier is attached to the same router as the destination of the request, the traceroute request may be multicasted to ALL-ROUTERS.MCAST.NET (224.0.0.2) for IPv4 or All Routers Address (FF02::2) for IPv6 if the last-hop router is not known.
</p>
<a name="sec.first"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.3"></a><h3>9.3.&nbsp;
First hop router</h3>

<p>The mtrace2 querier may not be unicast reachable from the first hop router. In this case, the querier should set the traceroute response address to a multicast address, and should set the response TTL (or hop limit) to a value sufficient for the response from the first hop router to reach the querier. It may be appropriate to start with a small TTL and increase in subsequent attempts until a sufficient TTL is reached, up to an appropriate maximum (such as 192).
</p>
<p>The IANA has assigned 224.0.1.32, MTRACE.MCAST.NET as the default multicast group for IPv4 mtrace2 responses, and will assign MTRACE2_IPV6RESPADDR (TBD (see <a class='info' href='#sec.iana'>Section&nbsp;11<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>)) for IPv6 mtrace2 responses. Other groups may be used if needed, e.g. when using mtrace2 to diagnose problems with the IANA-assigned group.
</p>
<a name="sec.broken"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.4"></a><h3>9.4.&nbsp;
Broken intermediate router</h3>

<p>A broken intermediate router might simply not understand traceroute packets, and drop them. The querier would then get no response at all from its traceroute requests. It should then perform a hop-by-hop search by setting the number of responses field until it gets a response (both linear and binary search are options, but binary is likely to be slower because a failure requires waiting for a timeout).
</p>
<a name="sec.terminate"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5"></a><h3>9.5.&nbsp;
Mtrace2 termination</h3>

<p>When performing an expanding hop-by-hop trace, it is necessary to determine when to stop expanding.
</p>
<a name="anchor61"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5.1"></a><h3>9.5.1.&nbsp;
Arriving at source</h3>

<p>A trace can be determined to have arrived at the source if the Incoming Interface of the last router in the trace is non-zero, but the Previous Hop router is zero.
</p>
<a name="anchor62"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5.2"></a><h3>9.5.2.&nbsp;
Fatal error</h3>

<p>A trace has encountered a fatal error if the last Forwarding Error in the trace has the 0x80 bit set.
</p>
<a name="anchor63"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5.3"></a><h3>9.5.3.&nbsp;
No previous hop</h3>

<p>A trace can not continue if the last Previous Hop in the trace is set to 0.
</p>
<a name="anchor64"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.5.4"></a><h3>9.5.4.&nbsp;
Traceroute shorter than requested</h3>

<p>If the trace that is returned is shorter than requested (i.e. the number of Response blocks is smaller than the "# hops" field), the trace encountered an error and could not continue.
</p>
<a name="anchor65"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.6"></a><h3>9.6.&nbsp;
Continuing after an error</h3>

<p>When the NO_SPACE error occurs, the client might try to continue the trace by starting it at the last hop in the trace. It can do this by unicasting to this router's outgoing interface address, keeping all fields the same. If this results in a single hop and a "WRONG_IF" error, the client may try setting the trace destination to the same outgoing interface address.
</p>
<p>If a trace times out, it is likely to be because a router in the middle of the path does not support multicast traceroute. That router's address will be in the Previous Hop field of the last entry in the last reply packet received. A client may be able to determine (via mrinfo or SNMP <a class='info' href='#refs.DefRtr'>[refs.DefRtr]<span> (</span><span class='info'>Draves, R. and D. Thaler, &ldquo;Default Router Preferences and More-Specific Routes,&rdquo; November&nbsp;2005.</span><span>)</span></a><a class='info' href='#refs.MROUTEMIB'>[refs.MROUTEMIB]<span> (</span><span class='info'>McWalter, D., Thaler, D., and A. Kessler, &ldquo;IP Multicast MIB,&rdquo; March&nbsp;2007.</span><span>)</span></a>) a list of neighbors of the non-responding router. If desired, each of those neighbors could be probed to determine the remainder of the path. Unfortunately, this heuristic may end up with multiple paths, since there is no way of knowing what the non-responding router's algorithm for choosing a previous-hop router is. However, if all paths but one flow back towards the non-responding router, it is possible to be sure that this is the correct path.
</p>
<a name="anchor66"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7"></a><h3>9.7.&nbsp;
Multicast Traceroute and shared tree routing protocols</h3>

<p>When using shared-tree routing protocols like PIM-SM and CBT, a more advanced client may use multicast traceroute to determine paths or potential paths.
</p>
<a name="anchor67"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7.1"></a><h3>9.7.1.&nbsp;
PIM-SM</h3>

<p>When a multicast traceroute reaches a PIM-SM RP and the RP does not forward the trace on, it means that the RP has not performed a source-specific join so there is no more state to trace. However, the path that traffic would use if the RP did perform a source-specific join can be traced by setting the trace destination to the RP, the trace source to the traffic source, and the trace group to 0. This trace Query may be unicasted to the RP.
</p>
<a name="anchor68"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7.2"></a><h3>9.7.2.&nbsp;
Bi-directional PIM</h3>

<p><a class='info' href='#refs.Bidir'>Bi-directional PIM<span> (</span><span class='info'>Handley, M., Kouvelas, I., and T. Speakman, &ldquo;Bi-directional Protocol Independent Multicast (BIDIR-PIM),&rdquo; February&nbsp;2007.</span><span>)</span></a> [refs.Bidir] is a variant of PIM-SM that builds bi-directional shared trees connecting multicast sources and receivers. Along the bi-directional shared trees, multicast data is natively forwarded from sources to the RPA (Rendezvous Point Address) and from the RPA to receivers without requiring source-specific state. In contrast to PIM-SM, RP always has the state to trace.
</p>
<p>A Designated Forwarder (DF) for a given RPA is in charge of forwarding downstream traffic onto its link, and forwarding upstream traffic from its link towards the RPL (Rendezvous Point Link) that the RPA belongs to. Hence mtrace2 reports DF addresses or RPA along the path.
</p>
<a name="anchor69"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7.3"></a><h3>9.7.3.&nbsp;
CBT</h3>

<p>When a multicast traceroute reaches a <a class='info' href='#refs.CBT'>CBT<span> (</span><span class='info'>Ballardie, T., &ldquo;Core Based Trees (CBT version 2) Multicast Routing -- Protocol Specification --,&rdquo; September&nbsp;1997.</span><span>)</span></a> [refs.CBT] Core, it must simply stop since CBT does not have source-specific state. However, a second trace can be performed, setting the trace destination to the traffic source, the trace group to the group being traced, and the trace source to the Core (or to 0, since CBT does not have source-specific state). This trace Query may be unicasted to the Core. There are two possibilities when combining the two traces:
</p>
<a name="anchor70"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7.3.1"></a><h3>9.7.3.1.&nbsp;
No overlap</h3>

<p>If there is no overlap between the two traces, the second trace can be reversed and appended to the first trace. This composite trace shows the full path from the source to the destination.
</p>
<a name="anchor71"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.7.3.2"></a><h3>9.7.3.2.&nbsp;
Overlapping paths</h3>

<p>If there is a portion of the path that is common to the ends of the two traces, that portion is removed from both traces. Then, as in the no overlap case, the second trace is reversed and appended to the first trace, and the composite trace again contains the full path.
</p>
<p>This algorithm works whether the source has joined the CBT tree or not.
</p>
<a name="anchor72"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.8"></a><h3>9.8.&nbsp;
Protocol-specific considerations</h3>

<a name="anchor73"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.8.1"></a><h3>9.8.1.&nbsp;
DVMRP</h3>

<p>DVMRP's dominant router election and route exchange guarantees that DVMRP routers know whether or not they are the last-hop forwarder for the link and who the previous hop is.
</p>
<a name="anchor74"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.8.2"></a><h3>9.8.2.&nbsp;
PIM-DM</h3>

<p>Routers running PIM Dense Mode do not know the path packets would take unless traffic is flowing. Without some extra protocol mechanism, this means that in an environment with multiple possible paths with branch points on shared media, multicast traceroute can only trace existing paths, not potential paths. When there are multiple possible paths but the branch points are not on shared media, the previous hop router is known, but the last hop router may not know that it is the appropriate last hop.
</p>
<p>When traffic is flowing, PIM Dense Mode routers know whether or not they are the last-hop forwarder for the link (because they won or lost an Assert battle) and know who the previous hop is (because it won an Assert battle). Therefore, multicast traceroute is always able to follow the proper path when traffic is flowing.
</p>
<a name="anchor75"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Problem Diagnosis</h3>

<a name="anchor76"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.1"></a><h3>10.1.&nbsp;
Forwarding Inconsistencies</h3>

<p>The forwarding error code can tell if a group is unexpectedly pruned or administratively scoped.
</p>
<a name="anchor77"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.2"></a><h3>10.2.&nbsp;
TTL or hop limit problems</h3>

<p>By taking the maximum of (hops from source + forwarding TTL (or hop limit) threshold) over all hops, you can discover the TTL required for the source to reach the destination.
</p>
<a name="sec.loss"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.3"></a><h3>10.3.&nbsp;
Packet loss</h3>

<p>By taking two traces, you can find packet loss information by comparing the difference in input packet counts to the difference in output packet counts at the previous hop.  On a point-to-point link, any difference in these numbers implies packet loss.  Since the packet counts may be changing as the trace query is propagating, there may be small errors (off by 1 or 2) in these statistics. However, these errors will not accumulate if multiple traces are taken to expand the measurement period.  On a shared link, the count of input packets can be larger than the number of output packets at the previous hop, due to other routers or hosts on the link injecting packets.  This appears as "negative loss" which may mask real packet loss.
</p>
<p>In addition to the counts of input and output packets for all multicast traffic on the interfaces, the response data includes a count of the packets forwarded by a node for the specified source-group pair.  Taking the difference in this count between two traces and then comparing those differences between two hops gives a measure of packet loss just for traffic from the specified source to the specified receiver via the specified group.  This measure is not affected by shared links.
</p>
<p>On a point-to-point link that is a multicast tunnel, packet loss is usually due to congestion in unicast routers along the path of that tunnel.  On native multicast links, loss is more likely in the output queue of one hop, perhaps due to priority dropping, or in the input queue at the next hop.  The counters in the response data do not allow these cases to be distinguished.  Differences in packet counts between the incoming and outgoing interfaces on one node cannot generally be used to measure queue overflow in the node.
</p>
<a name="sec.util"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.4"></a><h3>10.4.&nbsp;
Link Utilization</h3>

<p>Again, with two traces, you can divide the difference in the input or output packet counts at some hop by the difference in time stamps from the same hop to obtain the packet rate over the link. If the average packet size is known, then the link utilization can also be estimated to see whether packet loss may be due to the rate limit or the physical capacity on a particular link being exceeded.
</p>
<a name="anchor78"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10.5"></a><h3>10.5.&nbsp;
Time delay</h3>

<p>If the routers have synchronized clocks, it is possible to estimate propagation and queuing delay from the differences between the timestamps at successive hops.  However, this delay includes control processing overhead, so is not necessarily indicative of the delay that data traffic would experience.
</p>
<a name="sec.iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
IANA Considerations</h3>

<p>The following new assignments can only be made via a Standards Action as specified <a class='info' href='#refs.IANA'>in<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; October&nbsp;1998.</span><span>)</span></a> [refs.IANA].
</p>
<a name="anchor79"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
Routing protocols</h3>

<p>The IANA is responsible for allocating new Routing Protocol codes. The Routing Protocol code is somewhat problematic, since in the case of protocols like CBT and PIM it must encode both a unicast routing algorithm and a multicast tree-building protocol. The space was not divided into two fields because it was already small and some combinations (e.g. DVMRP) would be wasted.
</p>
<a name="anchor80"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
Forwarding codes</h3>

<p>New Forwarding codes must only be created by an RFC that modifies this document's <a class='info' href='#sec.use'>Section&nbsp;9<span> (</span><span class='info'>Using multicast traceroute</span><span>)</span></a>, fully describing the conditions under which the new forwarding code is used.  The IANA may act as a central repository so that there is a single place to look up forwarding codes and the document in which they are defined.
</p>
<a name="anchor81"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
UDP destination port and IPv6 address</h3>

<p>The IANA should allocate UDP destination port for multicast traceroute version 2 upon publication of the first RFC. Additionally, the well-known multicast address (MTRACE2_IPV6RESPADDR) intended for default use by IPv6 multicast traceroute should be registered and defined by the first RFC published.
</p>
<a name="anchor82"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Security Considerations</h3>

<a name="anchor83"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.1"></a><h3>12.1.&nbsp;
Topology Discovery</h3>

<p>Mtrace2 can be used to discover any actively-used topology. If your network topology is a secret, mtrace2 may be restricted at the border of your domain, using the ADMIN_PROHIB forwarding code.
</p>
<a name="anchor84"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.2"></a><h3>12.2.&nbsp;
Traffic Rates</h3>

<p>Mtrace2 can be used to discover what sources are sending to what groups and at what rates. If this information is a secret, mtrace2 may be restricted at the border of your domain, using the ADMIN_PROHIB forwarding code.
</p>
<a name="anchor85"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12.3"></a><h3>12.3.&nbsp;
Unicast Replies</h3>

<p>The "Response address" field may be used to send a single packet (the traceroute Reply packet) to an arbitrary unicast address. It is possible to use this facility as a packet amplifier, as a small multicast traceroute Query may turn into a large Reply packet.
</p>
<a name="anchor86"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
Acknowledgements</h3>

<p>This specification started largely as a transcription of Van Jacobson's slides from the 30th IETF, and the implementation in mrouted 3.3 by Ajit Thyagarajan. Van's original slides credit Steve Casner, Steve Deering, Dino Farinacci and Deb Agrawal. The original multicast traceroute client, mtrace (version 1), has been implemented by Ajit Thyagarajan, Steve Casner and Bill Fenner.
</p>
<p>The idea of unicasting a multicast traceroute Query to the destination of the trace with Router Alert set is due to Tony Ballardie. The idea of the "S" bit to allow statistics for a source subnet is due to Tom Pusateri.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.14"></a><h3>14.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="refs.KEYWORDS">[refs.KEYWORDS]</a></td>
<td class="author-text">Bradner, S., &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to indicate requirement levels</a>,&rdquo; RFC&nbsp;2119, March&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.IPv6">[refs.IPv6]</a></td>
<td class="author-text">Deering, S. and R. Hinden, &ldquo;<a href="http://tools.ietf.org/html/rfc2460">Internet Protocol, Version 6 (IPv6) Specification</a>,&rdquo; RFC&nbsp;2460, December&nbsp;1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.IPv6Addr">[refs.IPv6Addr]</a></td>
<td class="author-text">Hinden, R. and S. Deering, &ldquo;<a href="http://tools.ietf.org/html/rfc2373">IP Version 6 Addressing Architecture</a>,&rdquo; RFC&nbsp;2373, July&nbsp;1998.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.IGMPv3">[refs.IGMPv3]</a></td>
<td class="author-text">Cain, B., Deering, S., Kouvelas, I., Fenner, B., and A. Thyagarajan, &ldquo;<a href="http://tools.ietf.org/html/rfc3376">Internet Group Management Protocol, Version 3</a>,&rdquo; RFC&nbsp;3376, October&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.IANA">[refs.IANA]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc2434">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; RFC&nbsp;2434, October&nbsp;1998.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>14.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="refs.DefRtr">[refs.DefRtr]</a></td>
<td class="author-text">Draves, R. and D. Thaler, &ldquo;<a href="http://tools.ietf.org/html/rfc4191">Default Router Preferences and More-Specific Routes</a>,&rdquo; RFC&nbsp;4191, November&nbsp;2005.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.Cksum">[refs.Cksum]</a></td>
<td class="author-text">Braden, B., Borman, D., and C. Partridge, &ldquo;<a href="http://tools.ietf.org/html/rfc1071">Computing the Internet Checksum</a>,&rdquo; RFC&nbsp;1071, September&nbsp;1988.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.RA">[refs.RA]</a></td>
<td class="author-text">Katz, D., &ldquo;<a href="http://tools.ietf.org/html/rfc2113">IP Router Alert Option</a>,&rdquo; RFC&nbsp;2113, February&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.IFMIB">[refs.IFMIB]</a></td>
<td class="author-text">McCloghrie, K. and F. Kastenholz, &ldquo;<a href="http://tools.ietf.org/html/rfc2863">The Interfaces Group MIB</a>,&rdquo; RFC&nbsp;2863, June&nbsp;2000.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.MROUTEMIB">[refs.MROUTEMIB]</a></td>
<td class="author-text">McWalter, D., Thaler, D., and A. Kessler, &ldquo;IP Multicast MIB,&rdquo; draft-ietf-mboned-ip-mcast-mib-05.txt&nbsp;(work in progress), March&nbsp;2007.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.PIMSM">[refs.PIMSM]</a></td>
<td class="author-text">Fenner, B., Handley, M., Holbrook, H., and I. Kouvelas, &ldquo;<a href="http://tools.ietf.org/html/rfc4601">Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)</a>,&rdquo; RFC&nbsp;4601, August&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.CBT">[refs.CBT]</a></td>
<td class="author-text">Ballardie, T., &ldquo;<a href="http://tools.ietf.org/html/rfc2189">Core Based Trees (CBT version 2) Multicast Routing -- Protocol Specification --</a>,&rdquo; RFC&nbsp;2189, September&nbsp;1997.</td></tr>
<tr><td class="author-text" valign="top"><a name="refs.Bidir">[refs.Bidir]</a></td>
<td class="author-text">Handley, M., Kouvelas, I., and T. Speakman, &ldquo;Bi-directional Protocol Independent Multicast (BIDIR-PIM),&rdquo; draft-ietf-pim-bidir-09.txt&nbsp;(work in progress), February&nbsp;2007.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hitoshi Asaeda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Keio University</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Graduate School of Media and Governance</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Fujisawa, Kanagawa  252-8520</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:asaeda@wide.ad.jp">asaeda@wide.ad.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Tatsuya Jinmei</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Toshiba Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Corporate Research & Development Center</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kawasaki, Kanagawa  212-8582</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jinmei@isl.rdc.toshiba.co.jp">jinmei@isl.rdc.toshiba.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">William C. Fenner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">AT&T Research</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Menlo Park, CA  94025</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fenner@research.att.com">fenner@research.att.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Stephen L. Casner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Packet Design, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94304</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:casner@packetdesign.com">casner@packetdesign.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2007).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
