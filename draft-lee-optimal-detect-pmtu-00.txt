

   INTERNET-DRAFT                            	HAK GOO LEE
   Expires: March 2003                       	PYUNG SOO KIM
                                             	YOUNG KEUN KIM
                                             	CHU KYO SHIN
                                             	SAMSUNG ELECTRONICS 

                                      

                     Optimal Detecting Increases in PMTU
                   <draft-lee-optimal-detect-pmtu-00.txt>

    Status of This Memo

    This document is an Internet-Draft and is in full conformance with
    all provisions of Section 10 of RFC2026 [RFC2026].

    Internet-Drafts are working documents of the Internet Engineering
    Task Force (IETF), its areas, and its working groups.  Note that
    other groups may also distribute working documents as Internet-
    Drafts.

    Internet-Drafts are draft documents valid for a maximum of six
    months and may be updated, replaced, or obsoleted by other
    documents at any time.  It is inappropriate to use Internet-Drafts
    as reference material or to cite them other than as "work in
    progress."

    The list of current Internet-Drafts can be accessed at
    http://www.ietf.org/ietf/1id-abstracts.txt 
    The list of Internet-Draft Shadow Directories can be accessed at
    http://www.ietf.org/shadow.html. 


Abstract   

  
    This document presents a new method for the detection of increases
    in PMTU using the newly defined Hop-by-Hop option header.
    To detect increases in a path's PMTU, a node does not increase its 
    assumed PMTU unconditionally without considering network status, 
    but measures its real PMTU, and then replaces the previous PMTU with 
    new one. To measure node's real PMTU, the node sends the IP packet
    with the newly defined Hop-by-Hop option header to the destination 
    node right before a timer expires. This can eliminate the chance of 
    occurrence of packets being discarded and Packet Too Big messages 
    being generated.


Table of Contents    
 Abstract ............................................................1
 1 Introduction.......................................................2
 2 Proposed Method : Overview.........................................2
     2.1 Measurement DIP Option Format................................4
     2.2 Response DIP Option Format...................................4     
 3 Node Requirements for Proposed Method..............................5
     3.1. Source Node and Destination Node............................5
     3.2. Nodes on Routing Path.......................................5
 4 Operation Procedure................................................6
 5 References ........................................................6
 6 Authors' Addresses ................................................6
  
LEE et al.                  Expires March 2003                 [Page 1]

Internet Draft       Optimal Detecting Increases in PMTU       Oct 2002 
    
1. Introduction

    Due to changes in the routing topology, the Path MTU (PMTU) of a 
    path may change over time. Therefore, in Path MTU Discovery 
    [RFC1981], to detect increases in a path's PMTU, a node 
    periodically increases its assumed PMTU although this is done 
    infrequently. However, in this method, the assumed PMTU is 
    increased by the node's link MTU unconditionally. This may 
    result in packets being discarded and Packet Too Big messages 
    being generated.
    
    Therefore, this document presents a new method for the detection of 
    increases in PMTU using the newly defined Hop-by-Hop Option header.
    In this new method, to detect increases in a path's PMTU, a node 
    does not increase its assumed PMTU unconditionally without 
    considering network status, but measures its real PMTU, and then 
    replaces the previous PMTU with new one. 
    To measure node's real PMTU, the node sends the IP packet with the 
    newly defined Hop-by-Hop option header to the destination node
    right before a timer expires. In this document, this timer will be
    called the detection timer. The recommended setting for this
    detection timer is also 10 minutes as [RFC1981].   
    Note that the newly obtained PMTU is always greater than or equal 
    to the previous one. After then, the new PMTU is used to send 
    packets. This can eliminate the chance of occurrence of packets 
    being discarded and Packet Too Big messages being generated, which
    might occur when the assumed PMTU is increased unconditionally by 
    the detection timer in PMTU Discovery [RFC1981]. 
    
    The proposed method in this document can provide the best-conditioned 
    network environment because the optimized PMTU is obtained for 
    changes in the routing topology.


2. Proposed Method : Overview

    This section gives a brief overview of the new method for the 
    detection of increases in PMTU.
    
    A router on routing path examines only IP header, Hop-by-Hop option
    header and routing header in extension header. Other extension 
    headers and data are examined only by a source node and destination 
    node. In the new method, Hop-by-Hop option header is used to 
    measure increases in a path's PMTU

    The Hop-by-Hop option header and option is defined as below.

    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Next Header  |  Hdr Ext Len  |                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+                               +
    |                                                               |
    .                                                               .
    .                            Options                            .
    .                                                               .
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    		Figure 1 Hop-by-Hop Option Header


LEE et al.                  Expires March 2003                 [Page 2]

Internet Draft       Optimal Detecting Increases in PMTU       Oct 2002 
  
             
    Currently, Hop-by-Hop option headers are Pad1, PadN, Jumbo Payload, 
    and Router Alert options.  This document defines a new option. It is
    called 'Detection of Increasing  PMTU option (DIP option)'. 
    Then, the IP packet including Hop-by-Hop option header with DIP 
    option has the following format.


    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |Version| Traffic Class |            Flow Label                 |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |        Payload Length         |  Next Header  |   Hop Limint  |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                        Source Address                         +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                                                               |
    +                                                               +
    |                                                               |
    +                      Destination Address                      +
    |                                                               |
    +                                                               +
    |                                                               |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |  Next Header  |       0       |  Option Type  |  Opt Data Len |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                      Option Data(PMTU)                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Dummy Data                          |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |
    | ....
    +-+

    Option Type          8-bit identifier of the type of option.

    Opt Data Len         8-bit unsigned integer.  Length of the Option
                         Data field of this option, in octets.

    Option Data(PMTU)    Measured PMTU value with 4 bytes

                     Figure 2 IP Packet with DIP option


    The Option Type identifiers are internally encoded such that their
    highest-order two bits specify the action that must be taken when 
    the router does not recognize the Option Type. The third highest 
    order bit of the Option Type specifies whether or not the Option 
    Data (PMTU) of that option can change en-route to the packet's 
    final destination. The other five bits are defined arbitrarily. 
    The DIP option has two Option Types. The one is Measurement DIP 
    Option and the other is Response DIP Option, which will be shown
    in following subsections. If any of the routers en-route cannot 
    recognize the Option Types, it discards the packet silently.    


LEE et al.                  Expires March 2003                 [Page 3]

Internet Draft       Optimal Detecting Increases in PMTU       Oct 2002 
                

    2.1 Measurement DIP Option Format

    The measurement DIP option format is defined to measure real 
    PMTU as shown in Figure 2. The source node sends the IP packet 
    with this measurement DIP option format to the destination node.
    
     
                                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    |0 1 1|0 0 1 1 1|0 0 0 0 0 1 0 0| 
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            P M T U                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  

    01 - Discard the packet                   
    1  - Option Data may change en-route          
    00111 - Option Type                          
           
    Option Type - 103
    Option Length - 4
    PMTU - 4 Octets
		
		 Figure 3 Measurement DIP Option Format
		              
	
    2.2 Response DIP Option Format

    The response DIP option format is defined to response measured 
    real PMTU as shown in Figure 3. The destination node sends the IP 
    packet with this response DIP option format to the source node.


                                    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                                    |0 1 0|0 0 1 1 1|0 0 0 0 0 1 0 0| 
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                            P M T U                            |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+  


    01 - Discard the packet                   
    0  - Option Data does not change en-route          
    00111 - Option Type                          
           
    Option Type - 71
    Option Length - 4
    PMTU - 4 Octets

		Figure 4 Measurement DIP Option Format

     
    As described on Path MTU Discovery [RFC 1981], a source node sends 
    IP packet with Measurement DIP Option to a destination node before 
    the detection timer expires so that it wants to increase PMTU 
    value. Default MTU value is link MTU of the source node. While the
    packet is passing through nodes en-route, the following action 
    occurs.

     - Compare PMTU in Measurement DIP Option and Link MTU of next hop. 
     - Store the smaller value between them on MTU field of the packet.

LEE et al.                  Expires March 2003                 [Page 4]

Internet Draft       Optimal Detecting Increases in PMTU       Oct 2002 

       
    By doing the same action on routers en-route, PMTU field of the IP
    packet with Measurement DIP Option is updated to have minimum PMTU.
    This is the optimal PMTU value. The destination node that 
    receives the IP packet returns back this value to the source node
    using Response DIP Option. The source node that receives the 
    optimal PMTU value determines the transmission length of a packet.
    This method can reduce the number of ICMP-Packet Too  Big Error 
    message, otherwise happens more frequently. This also reduce waste
    of network resource


3. Node Requirements for Proposed Method

  3.1. Source Node and Destination Node

    A source node does not change the PMTU value for some amount of 
    time after it comes to know PMTU based on PMTU Discovery [RFC1981].
    When the source node wants to increase PMTU by the detection timer,
    it sends the IP packet with Measurement DIP Option to a 
    destination. The PMTU field of Measurement DIP Option of the packet
    contains the value of link MTU of the source node and the data 
    field contains dummy data. If the packet is discarded by a router 
    that does not understand the packet format on routing, no response 
    returns to the source node. For this reason, the source node uses 
    a timer while transmitting the packet. This timer will be called 
    the response timer. If there is no response until the response timer
    expires, the source node increase the PMTU as described in Path MTU 
    Discovery [RFC1981]. 

    Whenever a destination node receives the IP packet with Measurement 
    DIP Option, it must response the IP packet with Response DIP Option
    immediately. By the Option Type, this packet cannot be modified by 
    routers on routing path. 
      
 
  3.2. Nodes on Routing Path

    Nodes on a routing path are routers. When the IP packet with 
    Measurement DIP Option arrives on these routers, they compare the 
    PMTU in Measurement DIP Option and link MTU of the next hop. They 
    select a smaller value between them and forward the packet with 
    a PMTU value. After doing the same procedure, the final 
    destination node comes to know minimum PMTU. If the IP packet with
    Response DIP Option arrives on theses routers, they forward the 
    packet without any modification. If routers can not recognize two 
    DIP Options, it discard the packet silently without any error 
    message such as ICMP-Parameter Problem since the first two bits of 
    the DIP Option is 01. 
    






LEE et al.                  Expires March 2003                 [Page 5]

Internet Draft       Optimal Detecting Increases in PMTU       Oct 2002 

    
4. Operation Procedure

    When the source node wants to increase PMTU by the detection timer,
    it sends the IP packet with Measurement DIP Option to a destination.
    In this case, the Option Type in Measurement DIP Option is 103. 
    While the packet is en-route, intermediate routers compare the PMTU 
    in Measurement DIP Option and link MTU of the next hop. They select 
    a smaller value between them, store the value to PMTU field of 
    Measurement DIP Option and forward the packet with the updated PMTU. 
    PMTU of the packet arrived at the destination node becomes  minimum 
    PMTU. The destination node sends the IP packet Response DIP Option 
    to inform the source node. In this case, the Option Type in 
    Measurement DIP Option is 71. After then, the source node sends 
    packets using new PMTU. If there are routers that this feature 
    is not implemented during transitional period, that is, if routers 
    implements only previous PMTU Discovery [RFC 1981] on 
    routing path, the DIP Options defined newly in this document is 
    unknown parameter. Thus, in this case the router can silently 
    discard the packet without ICMP-Parameter problem by the 
    highest-order two bits, 01, in Option Type field. Additionally, the 
    source node operates the response timer when transmitting the packet 
    with DIP option. If the source node does not receive the IP packet 
    with Response DIP Option until the response timer expires, the 
    source node increase PMTU as described in Path MTU Discovery 
    [RFC1981].     
   

5 References
    
    [RFC1981]  Path MTU Discovery for IP version 6 (RFC 1981)

 
6 Authors' Addresses

       HAK GOO LEE
       Digital Media R&D Center, SAMSUNG ELECTRONICS 
       Tel : +82 31 200 9309
       Fax : +82 31 200 3147
       E-mail : solited@samsung.co.kr

       PYUNG SOO KIM
       Digital Media R&D Center, SAMSUNG ELECTRONICS 
       Tel : +82 31 200 4635
       Fax : +82 31 200 3147
       E-mail : kimps@samsung.com

       YOUNG KEUN KIM
       Digital Media R&D Center, SAMSUNG ELECTRONICS 
       Tel : +82 31 200 3772
       Fax : +82 31 200 3147
       E-mail : ykksam@samsung.com

       CHU KYO SHIN
       Digital Media R&D Center, SAMSUNG ELECTRONICS 
       Tel : +82 31 200 8318
       Fax : +82 31 200 3147
       E-mail : kyoshin@samsung.com


LEE et al.                  Expires March 2003                 [Page 6]
