

Network Working Group                                             D. New
Internet-Draft                                                 M.T. Rose
Expires: May 14, 2001                             Invisible Worlds, Inc.
                                                       November 13, 2000


                      Reliable Delivery for syslog
                     draft-ietf-syslog-reliable-02

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six
   months and may be updated, replaced, or obsoleted by other documents
   at any time. It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on May 14, 2001.

Copyright Notice

   Copyright (C) The Internet Society (2000). All Rights Reserved.

Abstract

   The syslog protocol[1] describes a number of service options related
   to propagating event messages. This memo describes two mappings of
   the syslog protocol to TCP connections, both useful for reliable
   delivery of event messages. The first provides a trivial mapping
   maximizing backward compatibility. The second provides a more
   complete mapping. Both provide a degree of robustness and security
   in message delivery that is unavailable to the usual UDP-based
   syslog protocol, by providing encryption and authentication over a
   connection-oriented protocol. 





New & Rose                Expires May 14, 2001                  [Page 1]

Internet-Draft        Reliable Delivery for syslog         November 2000


Table of Contents

   1.    Introduction . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.    The Model  . . . . . . . . . . . . . . . . . . . . . . . . .  4
   3.    The RAW Profile  . . . . . . . . . . . . . . . . . . . . . .  6
   3.1   RAW Profile Overview . . . . . . . . . . . . . . . . . . . .  6
   3.2   RAW Profile Identification and Initialization  . . . . . . .  8
   3.3   RAW Profile Message Syntax . . . . . . . . . . . . . . . . .  8
   3.4   RAW Profile Semantics  . . . . . . . . . . . . . . . . . . .  9
   4.    The COOKED Profile . . . . . . . . . . . . . . . . . . . . . 10
   4.1   COOKED Profile Overview  . . . . . . . . . . . . . . . . . . 10
   4.2   COOKED Profile Identification and Initialization . . . . . . 10
   4.3   COOKED Profile Message Syntax  . . . . . . . . . . . . . . . 10
   4.4   COOKED Profile Message Semantics . . . . . . . . . . . . . . 11
   4.4.1 The IAM Element  . . . . . . . . . . . . . . . . . . . . . . 11
   4.4.2 The ENTRY Element  . . . . . . . . . . . . . . . . . . . . . 13
   4.4.3 The RECEIVED Element . . . . . . . . . . . . . . . . . . . . 14
   5.    Additional Provisioning  . . . . . . . . . . . . . . . . . . 17
   5.1   Message Authenticity . . . . . . . . . . . . . . . . . . . . 17
   5.2   Message Replay . . . . . . . . . . . . . . . . . . . . . . . 17
   5.3   Message Integrity  . . . . . . . . . . . . . . . . . . . . . 17
   5.4   Message Observation  . . . . . . . . . . . . . . . . . . . . 18
   5.5   Summary of Recommended Practices . . . . . . . . . . . . . . 18
   6.    Initial Registrations  . . . . . . . . . . . . . . . . . . . 19
   6.1   Registration: The RAW Profile  . . . . . . . . . . . . . . . 19
   6.2   Registration: The COOKED Profile . . . . . . . . . . . . . . 19
   7.    The syslog DTD . . . . . . . . . . . . . . . . . . . . . . . 20
   8.    Reply Codes  . . . . . . . . . . . . . . . . . . . . . . . . 23
   9.    Security Considerations  . . . . . . . . . . . . . . . . . . 24
         References . . . . . . . . . . . . . . . . . . . . . . . . . 25
         Authors' Addresses . . . . . . . . . . . . . . . . . . . . . 25
   A.    History of Significant Changes . . . . . . . . . . . . . . . 27
   A.1   Significant Changes Since syslog-reliable-00 . . . . . . . . 27
   A.2   Significant Changes Since syslog-reliable-01 . . . . . . . . 27
   B.    Acknowledgements . . . . . . . . . . . . . . . . . . . . . . 28
         Full Copyright Statement . . . . . . . . . . . . . . . . . . 29















New & Rose                Expires May 14, 2001                  [Page 2]

Internet-Draft        Reliable Delivery for syslog         November 2000


1. Introduction

   The syslog protocol[1] presents a spectrum of service options for
   provisioning an event-based logging service over a network. Each
   option has associated benefits and costs. Accordingly, the choice as
   to what combination of options is provisioned is both an engineering
   and administrative decision. This memo describes how to realize the
   syslog protocol when reliable delivery is selected as a required
   service. It is beyond the scope of this memo to argue for, or
   against, the use of reliable delivery for the syslog protocol. 









































New & Rose                Expires May 14, 2001                  [Page 3]

Internet-Draft        Reliable Delivery for syslog         November 2000


2. The Model

   The syslog service supports three roles of operation: device, relay,
   and collector.

   Devices and collectors act as sources and sinks, respectively, of
   syslog entries. In the simplest case, only a device and collector
   are present. E.g.,

     +--------+        +-----------+
     | Device | -----> | Collector |
     +--------+        +-----------+

   The relationship between devices and collectors is potentially
   many-to-many. I.e., a device might communicate with many collectors;
   similarly, a collector might communicate with many devices. 

   A relay operates in both modes, accepting syslog entries from
   devices and other relays and forwarding those entries to collectors
   and other relays. 

   For example,

     +--------+      +-------+        +-------+      +-----------+
     | Device | ---> | Relay | -...-> | Relay | ---> | Collector |
     +--------+      +-------+        +-------+      +-----------+

   As shown, more than one relay may be present between any particular
   device and collector.

   A relay may be necessary for administrative reasons. For example, a
   relay might run as an application proxy on a firewall. Also, there
   might be one relay per company department, which authenticates all
   the devices in the department, and which in turn authenticates
   itself to a company-wide collector. 

   A relay can also serve to filter messages. For example, one relay
   may collect the syslog information from an entire web server farm,
   summarizing hit counts for report generation, forwarding "page not
   found" messages (indicating a possible broken link) to a collector
   that presents it to the webmaster, and sending more urgent messages
   (such as hardware failure reports) to a collector that gateways them
   to a pager. A relay may also be used to convert formats from a
   device's output to a collector's input. 

   It should be noted that a role of device, relay, or collector is
   relevant only to a particular BEEP channel (q.v., below). A single
   server can serve as a device, a relay, and a collector, all at once,
   if so configured. It can even serve as a relay and a collector to


New & Rose                Expires May 14, 2001                  [Page 4]

Internet-Draft        Reliable Delivery for syslog         November 2000


   the same device at the same time using different BEEP channels over
   the same connection-oriented session; this might be useful to
   collect status yet relay urgent error messages. 

   To provide reliable delivery when realizing the syslog protocol,
   this memo defines two BEEP profiles. BEEP[2] is a generic
   application protocol framework for connection-oriented, asynchronous
   interactions. Within BEEP, features such as authentication, privacy,
   and reliability through retransmission are provided. There are two
   profiles defined in this memo: 

   o  The RAW profile is designed to provide a high-performance,
      low-impact footprint, using essentially the same format as the
      existing UDP-based syslog service.

   o  The COOKED profile is designed to provide a structured entry
      format, in which individual entries are acknowledged (either
      positively or negatively).

   The choice of profile is independent of the operational roles
   discussed above. 

    For example, in 

     +--------+        +-------+        +-----------+
     | Device | -----> | Relay | -----> | Collector |
     +--------+        +-------+        +-----------+

   the device-to-relay link could be configured to use the RAW profile,
   while the relay-to-collector link could be configured to use the
   COOKED profile. (For example, the relay may be parsing the RAW
   syslog messages from the device, knowing the details of their
   formats, before passing them to a more generic collector.) Indeed,
   the same device may use different profiles, depending on the
   collector to which it is sending entries. 

   Devices and relays SHOULD discover relays and collectors via the DNS
   SRV algorithm[6]. The service used is "syslog" and the protocol used
   is "tcp". This allows for central administration of addressing,
   fallback for failed relays and collectors, and static load
   balancing. 










New & Rose                Expires May 14, 2001                  [Page 5]

Internet-Draft        Reliable Delivery for syslog         November 2000


3. The RAW Profile

3.1 RAW Profile Overview

   The RAW profile is designed for minimal implementation effort, high
   efficiency, and backwards compatibility. It is appropriate
   especially in cases where legacy syslog processing will be applied.

   When the profile is started, no piggyback data is supplied. All BEEP
   messages in the RAW profile are specified as having a MIME
   Content-Type[5] of application/octet-stream. Once the channel is
   open, the listener (not the initiator) sends a MSG message
   indicating it is ready to act as a syslog sink. (Refer to [2]'s
   Section 2.1 for a discussion of roles that a BEEP peer may perform,
   including definitions of the terms "listener", "initiator",
   "client", and "server".) 

   The initiator uses ANS replies to supply one or more syslog entries
   in the current UDP format, as specified in [1]'s Section 3. When the
   initiator has no more entries to send, it finishes with a NUL reply
   and closes the channel. 

   An example might appear as follows: 

      L: <wait for incoming connection>
      I: <establish connection>
      L: RPY 0 0 . 0 165
      L:
      L: <greeting>
      L:   <profile
      L:     uri='http://xml.resource.org/profiles/syslog/COOKED' />
      L:   <profile uri='http://xml.resource.org/profiles/syslog/RAW' />
      L: </greeting>
      L: END
      I: RPY 0 0 . 0 16
      I:
      I: <greeting />
      I: END
      I: MSG 0 1 . 16 121
      I: Content-type: text/xml
      I:
      I: <start number='1'>
      I:   <profile uri='http://xml.resource.org/profiles/syslog/RAW' />
      I: </start>
      I: END
      L: RPY 0 1 . 165 88
      L: Content-type: text/xml
      L:
      L: <profile uri='http://xml.resource.org/profiles/syslog/RAW' />


New & Rose                Expires May 14, 2001                  [Page 6]

Internet-Draft        Reliable Delivery for syslog         November 2000


      L: END
      L: MSG 1 0 . 0 50
      L:
      L: Central Services. This has not been a recording.
      L: END
      I: ANS 1 0 . 0 61 0
      I:
      I: <29>Oct 27 13:21:08 ductwork imxpd[141]: Heating emergency.END
      I: ANS 1 0 . 61 58 1
      I:
      I: <29>Oct 27 13:22:15 ductwork imxpd[141]: Contact Tuttle.END
      I: NUL 1 0 . 119 0
      I: END
      L: MSG 0 3 . 253 58
      L: Content-Type: text/xml
      L:
      L: <close number='1' code='200' />
      L: END
      I: RPY 0 3 . 137 34
      I: Content-Type: text/xml
      I:
      I: <ok />
      I: END
      I: MSG 0 4 . 171 59
      I: Content-Type: text/xml
      I:
      I: <close number='0' code='200' />
      I: END
      L: RPY 0 4 . 311 34
      L: Content-type: text/xml
      L:
      L: <ok />
      L: END
      L: <closes connection>
      I: <closes connection>
      L: <awaits next connection>


   Here we see a BEEP session established, followed by the use of the
   RAW profile. The initiator is a device, while the listener is a
   collector. The initiator opens the channel, but the listener sends
   the first MSG. This allows the initiator to send any number of ANS
   replies carrying syslog event messages. The initiator sends a NUL
   reply to indicate it is finished. Upon receiving the NUL, the
   listener closes the RAW channel. The initiator has the choice of
   closing the entire BEEP session or opening a new syslog channel (RAW
   or COOKED) for more transfers. In this example, the initiator
   chooses to close the entire BEEP session. 



New & Rose                Expires May 14, 2001                  [Page 7]

Internet-Draft        Reliable Delivery for syslog         November 2000


   The overhead for one ANS frame is about thirty octets, once the
   initial handshakes have been exchanged. If this overhead is too
   high, then messages are likely being generated at a high rate. In
   this case, multiple syslog messages can be aggregated into a single
   ANS frame, each separated by a CRLF sequence from the preceding. The
   final message still MUST NOT end with a CRLF.

   For example,

      L: MSG 1 0 . 0 50
      L:
      L: Central Services. This has not been a recording.
      L: END
      I: ANS 1 0 . 0 119 0
      I:
      I: <29>Oct 27 13:21:08 ductwork imxpd[141]: Heating emergency.
      I: <29>Oct 27 13:21:09 ductwork imxpd[141]: Contact Tuttle.END
      I: NUL 1 0 . 119 0
      I: END

3.2 RAW Profile Identification and Initialization

   The RAW syslog profile is identified as 
           http://xml.resource.org/profiles/syslog/RAW
   in the BEEP "profile" element during channel creation.

   No data is piggybacked during channel creation. 

3.3 RAW Profile Message Syntax

   All BEEP messages in this profile have a MIME content-type of
   application/octet-stream. The listener's first BEEP message is
   ignored and indeed may be empty except for headers; hence, any
   syntax is acceptable. 

   The ANS replies the initiator sends in response MUST be formatted
   according to Section 3 of [1]. In particular, the syslog message
   starts with a leading "<" ('less-than' character), followed by a
   number, which is followed by a ">" ('greater-than' character). This
   is optionally followed by a single space.  The remainder of the
   syslog message follows this. The syslog event message MUST be
   transmitted as visible (printing) characters. 

   If multiple syslog messages are included in a single ANS reply, each
   is separated from the preceding with a CRLF. There is no ending
   delimiter, but each syslog event message body length MUST be 1024
   bytes or less, excluding BEEP framing overhead. Note that there MUST
   NOT be a CRLF between the text of the final syslog event message and
   the "END" marking the trailer of the BEEP frame. 


New & Rose                Expires May 14, 2001                  [Page 8]

Internet-Draft        Reliable Delivery for syslog         November 2000


3.4 RAW Profile Semantics

   The listener's opening BEEP MSG message has no semantics. (It is a
   good place to put in an identifying greeting.) The initiator's ANS
   replies MUST specify a facility, severity, and textual message, as
   described in [1]. 













































New & Rose                Expires May 14, 2001                  [Page 9]

Internet-Draft        Reliable Delivery for syslog         November 2000


4. The COOKED Profile

4.1 COOKED Profile Overview

   The COOKED profile is designed for new implementations of syslog
   protocol handlers. It provides a much finer grain of information
   tagging, allowing a better degree of automation in processing.
   Naturally, it includes more overhead as well in support of this. 

   The COOKED profile supports three elements of interest: 

   o  The "iam" element identifies the sender to the receiver, allowing
      each peer to name itself for the other, and specifying the roles
      (device, relay, or collector) each is taking on.

   o  The "entry" element provides a parsed version of the syslog
      entry, with the various fields of interest broken out.

   o  The "received" element contains an embedded "entry" or "received"
      element, identifying a list of relays through which that "entry"
      has passed.

4.2 COOKED Profile Identification and Initialization

   The COOKED syslog profile is identified as 
           http://xml.resource.org/profiles/syslog/COOKED
   in the BEEP "profile" element during channel creation.

   During channel creation, the corresponding "profile" element in the
   BEEP "start" element may contain an "iam" element. If channel
   creation is successful, then before sending the corresponding reply,
   the BEEP peer processes the "iam" element and includes the resulting
   response in the reply. This response will be an "ok" element or an
   "error" element. The choice of which element is returned is
   dependant on local provisioning of the recipient. Including an "iam"
   in the initial "start" element has exactly the same semantics as
   passing it as the first MSG message on the channel. 

4.3 COOKED Profile Message Syntax

   All BEEP messages in this profile have a MIME Content-Type[5] of
   text/xml. The syntax of the individual elements is specified in
   Section 7. 








New & Rose                Expires May 14, 2001                 [Page 10]

Internet-Draft        Reliable Delivery for syslog         November 2000


4.4 COOKED Profile Message Semantics

   Initiators issue two elements: "iam" and "entry", each using a "MSG"
   message. The listener issues "ok" in "RPY" messages and "error" in
   "ERR" messages. (See [2]'s Section 2.3.1 for the definitions of the
   "error" and "ok" elements.) 

4.4.1 The IAM Element

   The "iam" element serves to identify a device, relay, or collector
   at one end of the BEEP channel to the device, relay, or collector at
   the other end of the channel. The "iam" element includes the type of
   peer (device, relay, or collector), the fully qualified domain name
   of the peer, and the IP address of the peer. The character data of
   the element is free-form human-readable text. It may be used to
   further identify the peer, such as by describing the physical
   location of the machine. 

   An "iam" element may be sent by the initiator of the channel at any
   time. The listener responds to an "iam" element with an "ok"
   (indicating acceptance), or an "error" (indicating rejection). The
   identity and role in effect is specified by the most recent "iam"
   not answered with an "error". 

   An "iam" could be rejected (with an "error" element) by the listener
   if the privacy or authentication that has been negotiated is
   inadequate or if the authenticated user does not have authorization
   to serve in the specified role. It is expected that most
   installations will require an "iam" from the peer before accepting
   any "entry" messages. 






















New & Rose                Expires May 14, 2001                 [Page 11]

Internet-Draft        Reliable Delivery for syslog         November 2000


   For example, a successful creation might look like this:

      I: MSG 0 10 . 1832 247
      I: Content-type: text/xml
      I:
      I: <start number='1'>
      I:   <profile
      I:       uri='http://xml.resource.org/profiles/syslog/COOKED'>
      I:     <![CDATA[ <iam fqdn='lowry.example.com' ip='10.0.0.27'
      I:       type='device'/> ]]>
      I:   </profile>
      I: </start>
      L: END
      L: RPY 0 10 . 704 126
      L: Content-type: text/xml
      L:
      L: <profile uri='http://xml.resource.org/profiles/syslog/COOKED'>
      L:   <![CDATA[ <ok /> ]]>
      L: </profile>
      L: END

   A creation with an embedded "iam" that fails might look like this:

      C: MSG 0 12 . 1832 247
      C: Content-type: text/xml
      C:
      C: <start number='1'>
      C:   <profile
      C:       uri='http://xml.resource.org/profiles/syslog/COOKED'>
      C:     <![CDATA[ <iam fqdn='tuttle.example.com' ip='10.0.0.29'
      C:       type='relay'/> ]]>
      C:   </profile>
      C: </start>
      C: END
      S: RPY 0 12 . 704 229
      S: Content-type: text/xml
      S:
      S: <profile uri='http://xml.resource.org/profiles/syslog/COOKED'>
      S:   <![CDATA[
      S:     <error code='535'>User 'buttle.example.com' not allowed
      S:       to "iam" for 'tuttle.example.com'</error> ]]>
      S: </profile>
      S: END








New & Rose                Expires May 14, 2001                 [Page 12]

Internet-Draft        Reliable Delivery for syslog         November 2000


4.4.2 The ENTRY Element

   The "entry" element carries the details of a single syslog entry.
   The attributes of an "entry" element include "facility", "severity",
   "timestamp", "processName", and "processID". "Facility" and
   "severity" have the semantics defined in [1]'s 3.2. The other
   attributes have the semantics as in Section 4 of [1]. "Timestamp" is
   represented according to [8].

   If the client is a relay, the "entry" SHOULD also contain the
   attributes "deviceFQDN" and "deviceIP", specifying the FQDN and IP
   address of the device that originally created the entry. These
   attributes may be added by either the relay or the originating
   device.

   The character data for the element is the unstructured syslog event
   message being logged. In this case, "processName" and "processID"
   SHOULD be those of the original device generating the entry (unless
   the device cannot supply a processName and processID). The
   "timestamp" SHOULD be that of the original entry generation time,
   rather than the time the entry was passed outward from the relay.
   The original contents of the syslog message MUST be preserved in the
   CDATA of the "entry" element; this includes preservation of exact
   content during translation from the UDP or RAW formats. In
   particular, the timestamps MUST NOT be rewritten in the CDATA of the
   "entry" element, the process name and ID MUST NOT be removed from
   the CDATA even if presented in the "entry" attributes as well, and
   so on. 

   The "entry" element may also contain an "xml:lang" attribute,
   indicating the language in which the CDATA content of the tag is
   presented, as described in [4]. 

   The "entry" element is answered with either an empty "ok" element if
   everything was successful, or a standard "error" element if there
   was a problem. An "entry" element can be rejected if no "iam"
   element has been accepted by the listener. It can also be rejected
   if the user authenticated on the BEEP session (if any) does not have
   the authority to generate (as a device) or relay that entry. 












New & Rose                Expires May 14, 2001                 [Page 13]

Internet-Draft        Reliable Delivery for syslog         November 2000


   A successful exchange of an "entry" element may look like this:

      C: MSG 1 0 . 2058 162
      C: Content-Type: text/xml
      C:
      C: <entry facility='24' severity='5' timestamp='20001027T132108Z'
      C:   processName='imxpd' processID='141'>
      C:     No 27B/6 available</entry>
      C: END
      S: RPY 1 0 . 933 33
      S: Content-Type: text/xml
      S:
      S: <ok/>
      S: END

   Here, the device IP address and FQDN are taken from the "iam"
   element, if any, or from the underlying connection information. 

   An example where an "entry" element is rejected with an "error"
   element:

      C: MSG 1 2 . 2220 238
      C: Content-Type: text/xml
      C:
      C: <entry facility='24' severity='5' timestamp='20001027T132215Z'
      C:   deviceFQDN='jack.invisible.net' deviceIP='10.0.0.83'
      C:   processName='imxpd' processID='141'>
      C:     Replacement device found in nostril.
      C: </entry>
      C: END
      S: ERR 1 2 . 966 101
      S: Content-Type: text/xml
      S:
      S: <error code='554'>Not allowed to relay for
      S:    jack.invisible.net</error>
      S: END

   Here, the client attempts to relay an entry on behalf of
   jack.example.com, but the entry is refused by the collector for
   administrative reasons. This may occur, for example, if
   lowry.example.com is in a different department than jack.example.com.

4.4.3 The RECEIVED Element

   The "received" element serves to deliver a single "entry" element,
   along with a list of the relays through which that element has
   passed. Each "received" element contains either another "received"
   element or an "entry" element. Each "received" element names a FQDN
   and IP address of the relay or collector that received the element.


New & Rose                Expires May 14, 2001                 [Page 14]

Internet-Draft        Reliable Delivery for syslog         November 2000


   Each relay, before passing on the message, wraps the entire received
   element in a new "received" element listing the IP address and the
   FQDN (if any) of the interface over which the "trace" element was
   received. The final collector may or may not wrap the "received"
   element itself, depending on provisioning by the administrator. 

   The rationale for nesting "received" elements is to allow tagging of
   the enclosed element without modification thereof. That is, the
   relay wrapping the element can do so without disturbing any
   cryptographic signatures that may already be on the embedded
   elements. 

   Each "received" element has a "FQDN" attribute and an "IP"
   attribute. The FQDN attribute SHOULD be the fully qualified domain
   name of the interface over which the "trace" element was received.
   (The FQDN can be omitted if that interface has no DNS entry.) The
   element also MAY include a "timestamp" attribute indicating the time
   at which the element was received. 

































New & Rose                Expires May 14, 2001                 [Page 15]

Internet-Draft        Reliable Delivery for syslog         November 2000


   For example:

      C: MSG 1 0 . 2458 672
      C: Content-Type: text/xml
      C:
      C: <received FQDN='jack.inforet.example.com' IP='10.0.0.204'>
      C: <received FQDN='f-wall.inforet.example.com' IP='10.0.0.200'>
      C: <received FQDN='f-wall.records.example.com' IP='10.0.0.100'>
      C: <received FQDN='kurtzman.records.example.com'
      C:           IP='10.0.0.107'>
      C: <received FQDN='lowry.records.example.com' IP='10.0.0.103'/>
      C: <entry facility='24' severity='5'
      C:        timestamp='20001027T132215Z'
      C:        deviceFQDN='screen.lowry.records.example.com'
      C:        deviceIP='10.0.0.105' processID='185'
      C:        processName='tuner'>
      C: &lt;29>12:22 tuner[185]: Casablanca initiated
      C: </entry>
      C: </received>
      C: </received>
      C: </received>
      C: </received>
      C: </received>
      C: END
      S: RPY 1 0 . 1067 33
      S: Content-Type: text/xml
      S:
      S: <ok/>
      S: END

   Here we see Lowry's screen announce the beginning of today's movie.
   This information is passed out of Lowry's department and into Jack's
   department for logging. 

   The choice of whether to generate an "entry" element or a "received"
   element at the first relay is controlled by local provisioning. When
   a relay receives a "received" element, it MUST add a "received"
   element describing itself before passing it on. When a collector
   receives a "received" element, it MUST act upon the enclosed "entry"
   element as it would had the collector received it without trace
   information. What the collector does with the "received" elements is
   left to local configuration. 









New & Rose                Expires May 14, 2001                 [Page 16]

Internet-Draft        Reliable Delivery for syslog         November 2000


5. Additional Provisioning

   In more advanced configurations, syslog devices, relays, and
   collectors can be configured to support various delivery priorities.
   Multiple channels running the same profile can be opened between two
   peers, with higher priority syslog messages routed to a channel that
   is given more bandwidth. Such provisioning is a local matter. 

   syslog[1] discusses a number of reasons why privacy and
   authentication of syslog entry messages may be important in a
   networked computing environment. The nature of BEEP allows for
   convenient layering of authentication and privacy over any BEEP
   channel. 

5.1 Message Authenticity

   Section 5.2 of [1] discusses the dangers of unauthenticated syslog
   entries. To prevent inauthentic syslog event messages from being
   accepted, configure syslog peers to require the use of a strong
   authentication technology for the BEEP session. 

   If provisioned for message authentication, implementations SHOULD
   use SASL mechanism DIGEST-MD5[7] to provision this service.

5.2 Message Replay

   Section 5.3.4 of [1] discusses the dangers of syslog message replay.
   To prevent syslog event messages from being replayed, configure
   syslog peers to require the use of a strong authentication
   technology for the BEEP session.  

   If provisioned to detect message replay, implementations SHOULD use
   SASL mechanism DIGEST-MD5[7] to provision this service.

5.3 Message Integrity

   Section 5.5 of [1] discusses the dangers of syslog event messages
   being maliciously altered by an attacker. To prevent messages from
   being altered, configure syslog peers to require the use of a strong
   authentication technology for the BEEP session. 

   If provisioned to protect message integrity, implementations SHOULD
   use SASL mechanism DIGEST-MD5[7] to provision this service.








New & Rose                Expires May 14, 2001                 [Page 17]

Internet-Draft        Reliable Delivery for syslog         November 2000


5.4 Message Observation

   Section 5.6 of [1] discusses the dangers (and benefits) of syslog
   messages being visible at intermediate points along the transmission
   path between device and collector. To prevent messages from being
   viewed by an attacker, configure syslog peers to require the use of
   a transport security profile for the BEEP session. (However, other
   traffic characteristics, e.g., volume and timing of transmissions,
   remain observable.) 

   If provisioned to secure messages against unauthorized observation,
   implementations SHOULD use the TLS profile[2] to provision this
   service. The cipher algorithm used SHOULD be
   TLS_RSA_WITH_3DES_EDE_CBC_SHA.

5.5 Summary of Recommended Practices

   For the indicated protections, implementations SHOULD be configured
   to use the indicated mechanisms:

    Desired Protection  SHOULD tune using
    ------------------  -----------------
    Authentication      http://xml.resource.org/profiles/sasl/DIGEST-MD5
      + Replay          http://xml.resource.org/profiles/sasl/DIGEST-MD5
        + Integrity     http://xml.resource.org/profiles/sasl/DIGEST-MD5
          + Observation http://xml.resource.org/profiles/TLS


   BEEP peer identities used for authentication SHOULD correspond to
   the FQDN of the initiating peer. That is, a relay running on
   relay.example.com should use a "user ID" of "relay.example.com"
   within the SASL authentication profiles, as well as in the FQDN of
   the "iam" element. 


















New & Rose                Expires May 14, 2001                 [Page 18]

Internet-Draft        Reliable Delivery for syslog         November 2000


6. Initial Registrations

6.1 Registration: The RAW Profile

   Profile Identification: http://xml.resource.org/profiles/syslog/RAW

   Messages exchanged during Channel Creation: None

   Messages starting one-to-one exchanges: Anything

   Messages in positive replies: None

   Messages in negative replies: None

   Messages in one-to-many exchanges: Anything

   Message Syntax: See Section 3.3

   Message Semantics: See Section 3.4

   Contact Information: See the "Authors' Addresses" section of this
      memo

6.2 Registration: The COOKED Profile

   Profile Identification: http://xml.resource.org/profiles/syslog/RAW

   Messages exchanged during Channel Creation: iam

   Messages starting one-to-one exchanges: iam, entry, trace

   Messages in positive replies: ok

   Messages in negative replies: error

   Messages in one-to-many exchanges: None

   Message Syntax: See Section 4.3

   Message Semantics: See Section 4.4

   Contact Information: See the "Authors' Addresses" section of this
      memo








New & Rose                Expires May 14, 2001                 [Page 19]

Internet-Draft        Reliable Delivery for syslog         November 2000


7. The syslog DTD

   The following is the DTD defining the valid elements for the syslog
   over BEEP mapping. 


   <!--
     DTD for syslog over BEEP, as of 2000-10-10

     Refer to this DTD as:

       <!ENTITY % SYSLOG PUBLIC "-//Blocks//DTD SYSLOGRELIABLE//EN"
                  "http://xml.resource.org/syslog/syslog.dtd">
       %SYSLOG;
     -->


   <!--
     Contents

       Overview

       Includes
       Profile Summaries
       Entity Definitions

       Operations
           iam
           entry
     -->


   <!--
     Overview

       Syslog packets delivered via BEEP

     -->

   <!-- Includes -->

          <!ENTITY % BEEP PUBLIC "-//Blocks//DTD BEEP//EN"
                     "http://xml.resource.org/profiles/BEEP/beep.dtd">
          %BEEP;







New & Rose                Expires May 14, 2001                 [Page 20]

Internet-Draft        Reliable Delivery for syslog         November 2000


   <!--
     Profile summaries

       BEEP profile http://xml.resource.org/profiles/syslog/RAW

       role        MSG        ANS        ERR
       ====        ===        ===        ===
        L          text       text       text

       BEEP profile http://xml.resource.org/profiles/syslog/COOKED

       role        MSG        RPY        ERR
       ====        ===        ===        ===
       I or L      iam        ok         error
       I or L      entry      ok         error
       I or L      trace      ok         error

   -->


   <!--
     Entity Definitions

           entity        syntax/reference     example
           ======        ================     =======
       a fully qualified domain name
           FQDN          See [RFC-1034]       www.example.com

       a dotted-quad IP address
           IP            1*3DIGIT "." 1*3DIGIT "."
                          1*3DIGIT "." 1*3DIGIT
                                              10.0.0.27
       a syslog facility
           FACILITY      See [1]
                         1*3DIGIT             80

       a syslog severity
           SEVERITY      See [1]
                         DIGIT                 4

       a timestamp       See ISO 8601          20001007T135834Z
           TIMESTAMP
   -->

   <!ENTITY % FQDN         "CDATA">
   <!ENTITY % IP           "CDATA">
   <!ENTITY % FACILITY     "CDATA">
   <!ENTITY % SEVERITY     "CDATA">
   <!ENTITY % TIMESTAMP    "CDATA">


New & Rose                Expires May 14, 2001                 [Page 21]

Internet-Draft        Reliable Delivery for syslog         November 2000


   <!--
     The iam element declares the role and identity of the peer
     issuing it. The contents of the element may include human-readable
     informative text, such as the physical location of the computer
     issuing the "iam".

     -->

   <!ELEMENT iam         (#PCDATA)>
   <!ATTLIST iam
             fqdn        %FQDN;                   #REQUIRED
             ip          %IP;                     #REQUIRED
             type        (device|relay|collector) #REQUIRED>


   <!--
     The entry element conveys a single syslog message.
     -->

   <!ELEMENT entry       (#PCDATA)>
   <!ATTLIST entry
             xml:lang    %LANG;                   "i-default"
             facility    %FACILITY;                #REQUIRED
             severity    %SEVERITY;                #REQUIRED
             timestamp   %TIMESTAMP;               #IMPLIED
             processName %ATEXT;                   #IMPLIED
             processID   %ATEXT;                   #IMPLIED
             deviceFQDN  %FQDN;                    #IMPLIED
             deviceIP    %IP;                      #IMPLIED>

   <!--
     The relay element conveys a single syslog message,
     along with a list of relays through which it has passed.
     -->

   <!ELEMENT received    (received|empty)>
   <!ATTLIST received
             FQDN        %FQDN;                    #IMPLIED
             IP          %IP;                      #REQUIRED>

   <!-- End of DTD -->










New & Rose                Expires May 14, 2001                 [Page 22]

Internet-Draft        Reliable Delivery for syslog         November 2000


8. Reply Codes

   The following error codes are used in the protocol: 

   code    meaning
   ====    =======
   421     service not available

   451     requested action aborted
           (e.g., local error in processing)

   454     temporary authentication failure

   500     general syntax error
           (e.g., poorly-formed XML)

   501     syntax error in parameters
           (e.g., non-valid XML)

   504     parameter not implemented

   530     authentication required

   534     authentication mechanism insufficient
           (e.g., too weak, sequence exhausted, etc.)

   535     authentication failure

   537     action not authorized for user

   538     authentication mechanism requires encryption

   550     requested action not taken
           (e.g., no requested profiles are acceptable)

   553     parameter invalid

   554     transaction failed
           (e.g., policy violation)












New & Rose                Expires May 14, 2001                 [Page 23]

Internet-Draft        Reliable Delivery for syslog         November 2000


9. Security Considerations

   Consult Section 5 of [1] for a discussion of security issues for the
   syslog service. In addition, since the RAW and COOKED profiles are
   defined using the BEEP framework, consult [2]'s Section 8 for a
   discussion of BEEP-specific security issues. 













































New & Rose                Expires May 14, 2001                 [Page 24]

Internet-Draft        Reliable Delivery for syslog         November 2000


References

   [1]  Lonvick, C., "syslog Protocol", draft-ietf-syslog-syslog-02
        (work in progress), November 2000.

   [2]  Rose, M.T., "The Blocks Extensible Exchange Protocol
        Framework", draft-ietf-beep-framework-04 (work in progress),
        October 2000.

   [3]  Mockapetris, P.V., "Domain names - concepts and facilities",
        RFC 1034, STD 13, Nov 1987.

   [4]  Alvestrand, H., "Tags for the Identification of Languages", RFC
        1766, March 1995.

   [5]  Freed, N. and N. Borenstein, "Multipurpose Internet Mail
        Extensions (MIME) Part Two: Media Types", RFC 2046, November
        1996.

   [6]  Gulbrandsen, A., Vixie, P. and L. Esibov, "A DNS RR for
        specifying the location of services (DNS SRV)", RFC 2782,
        February 2000.

   [7]  Leach, P. and C. Newman, "Using Digest Authentication as a SASL
        Mechanism", RFC 2831, May 2000.

   [8]  International Organization for Standardization, "Data elements
        and interchange formats - Information exchange - 
        Representation of dates and times", International Standard
        8601, June 1988.

   [9]   mailto:calabrese@merck.com

   [10]  mailto:kzm@cisco.com

   [11]  mailto:bazsi@balabit.hu

   [12]  mailto:djw@bbn.com













New & Rose                Expires May 14, 2001                 [Page 25]

Internet-Draft        Reliable Delivery for syslog         November 2000


Authors' Addresses

   Darren New
   Invisible Worlds, Inc.
   1179 North McDowell Boulevard
   Petaluma, CA  94954-6559
   US

   Phone: +1 707 789 3700
   EMail: dnew@invisible.net
   URI:   http://invisible.net/


   Marshall T. Rose
   Invisible Worlds, Inc.
   1179 North McDowell Boulevard
   Petaluma, CA  94954-6559
   US

   Phone: +1 707 789 3700
   EMail: mrose@invisible.net
   URI:   http://invisible.net/





























New & Rose                Expires May 14, 2001                 [Page 26]

Internet-Draft        Reliable Delivery for syslog         November 2000


Appendix A. History of Significant Changes

A.1 Significant Changes Since syslog-reliable-00

   Multiple consecutive relays have been clarified. 

   Multiple syslog entries may appear in a single ANS reply in the RAW
   profile, to reduce overhead. 

   The "iam" element is no longer answered by an "iam" element. A
   separate exchange is necessary, allowing either peer to reject the
   other's "iam". 

   The "timestamp" attribute is compatible with ISO 8601 now. 

   The "trace" element is added. 

A.2 Significant Changes Since syslog-reliable-01

   Additional wording about retaining the content of "entry"'s CDATA is
   added. 

   The "trace" element is removed, with the "received" element being
   substituted and made nestable. 



























New & Rose                Expires May 14, 2001                 [Page 27]

Internet-Draft        Reliable Delivery for syslog         November 2000


Appendix B. Acknowledgements

   The author gratefully acknowledges the contributions of Christopher
   Calabrese[9], Keith McCloghrie[10], Balazs Scheidler[11], and David
   Waitzman[12].














































New & Rose                Expires May 14, 2001                 [Page 28]

Internet-Draft        Reliable Delivery for syslog         November 2000


Full Copyright Statement

   Copyright (C) The Internet Society (2000). All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph
   are included on all such copies and derivative works. However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

   Invisible Worlds expressly disclaims any and all warranties
   regarding this contribution including any warranty that (a) this
   contribution does not violate the rights of others, (b) the owners,
   if any, of other rights in this contribution have been informed of
   the rights and permissions granted to IETF herein, and (c) any
   required authorizations from such owners have been obtained. This
   document and the information contained herein is provided on an "AS
   IS" basis and INVISIBLE WORLDS DISCLAIMS ALL WARRANTIES, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

   IN NO EVENT WILL INVISIBLE WORLDS BE LIABLE TO ANY OTHER PARTY
   INCLUDING THE IETF AND ITS MEMBERS FOR THE COST OF PROCURING
   SUBSTITUTE GOODS OR SERVICES, LOST PROFITS, LOSS OF USE, LOSS OF
   DATA, OR ANY INCIDENTAL, CONSEQUENTIAL, INDIRECT, OR SPECIAL DAMAGES
   WHETHER UNDER CONTRACT, TORT, WARRANTY, OR OTHERWISE, ARISING IN ANY
   WAY OUT OF THIS OR ANY OTHER AGREEMENT RELATING TO THIS DOCUMENT,
   WHETHER OR NOT SUCH PARTY HAD ADVANCE NOTICE OF THE POSSIBILITY OF
   SUCH DAMAGES.



New & Rose                Expires May 14, 2001                 [Page 29]

Internet-Draft        Reliable Delivery for syslog         November 2000


Acknowledgement

   Funding for the RFC editor function is currently provided by the
   Internet Society.















































New & Rose                Expires May 14, 2001                 [Page 30]

