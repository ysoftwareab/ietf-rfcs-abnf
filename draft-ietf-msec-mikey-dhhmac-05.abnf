I_message = HDR, T, RAND, [IDi], 
                  {SP}, DHi, KEMAC 
                              I_message 
                       ----------------------->   R_message = HDR, T, 
                                                   [IDr], IDi, DHr, 
                                                   DHi, KEMAC 
                                R_message 
                       <---------------------- 
 
TGK = g^(xi * yi)                        TGK = g^(xi * yi) 
 
 
I_message = HDR, T, [IDi], 
                  {SP}, [DHi], KEMAC 
                              I_message 
                       ----------------------->   R_message = HDR, T, 
                                                   [IDr], IDi, 
                                                   [DHr, DHi], KEMAC 
                                R_message 
                       <---------------------- 
 
