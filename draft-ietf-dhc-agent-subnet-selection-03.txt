





Network Working Group                                        Kim Kinnear
INTERNET DRAFT                                                Mark Stapp
                                                         Richard Johnson
                                                          Jay Kumarasamy
                                                           Cisco Systems

                                                              April 2002
                                                    Expires October 2002


                       Link Selection sub-option
                 for the Relay Agent Information Option
             <draft-ietf-dhc-agent-subnet-selection-03.txt>

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

Copyright Notice

   Copyright (C) The Internet Society (2002). All Rights Reserved.

Abstract

   In RFC 2131, the giaddr specifies an IP address which determines both
   a subnet and thereby a link on which a DHCP client resides as well as
   an IP address which can be used to communicate with the relay agent.
   The subnet-selection option [RFC 3011] allows these functions of the
   giaddr to be split so that when one entity is performing as a DHCP
   proxy, it can specify the subnet/link from which to allocate an IP
   address which is different from the IP address with which it desires



Kinnear, et. al.          Expires October 2002                  [Page 1]

Internet Draft        Subnet Selection sub-option             April 2002


   to communicate with the DHCP server.  Analgous situations exist where
   the relay agent needs to specify the subnet/link on which a DHCP
   client resides which is different from an IP address which can be
   used to communicate with the relay agent.  The link-selection sub-
   option (specified here) of the relay-agent-information option allows
   a relay agent to do this.


1.  Introduction

   In RFC 2131, the giaddr specifies and IP address which determines a
   subnet (and from there a link) on which a DHCP client resides as well
   as an IP address which can be used to communicate with the relay
   agent.  The subnet-selection option [RFC 3011] allows these functions
   of the giaddr to be split so that when one entity is performing as a
   DHCP proxy, it can specify the subnet/link from which to allocate an
   IP address which is different from the IP address with which it
   desires to communicate with the DHCP server.

   Analgous situations exist where the relay agent needs to specify the
   subnet/link on which a DHCP client resides which is different from an
   IP address which can be used to communicate with the relay agent.
   Consider the following architecture:


          +--------+         +---------------+
          |  DHCP  |     IP x|               |IP y
          | Server |-.......-|  Relay Agent  |----+------------+
          +--------+         |               |    |            |
                             +---------------+    |         +------+
                                                  |         |Modem |
                                                  |         +------+
                                                  |          |    |
                                               +-----+  +-----+ +-----+
                                               |Host1|  |Host2| |Host3|
                                               +-----+  +-----+ +-----+




   In the usual approach, the relay agent would put IP address Y into
   the giaddr of any packets that it forwarded to the DHCP server.  How-
   ever, if for any reason IP address Y is not accessible from the DHCP
   server, then this usual approach will fail.  There are several rea-
   sons why IP y might be inaccessible from the DHCP server:

      1. IP y might not be unique for this subnet, but might instead be
         shared as a gateway address by multiple subnets.



Kinnear, et. al.          Expires October 2002                  [Page 2]

Internet Draft        Subnet Selection sub-option             April 2002


      2. There might be some firewall capability in the network element
         in which the relay agent resides that does not allow the DHCP
         server to access the relay agent via IP y.

      3. There might not be an IP y.  An example would be the case where
         there was only one host and this was a point to point link.

   In any of these or other cases, the relay agent needs to be able to
   communicate to the DHCP server the subnet/link from which to allocate
   an IP address.  The IP address which will communicate to the DHCP
   server the subnet/link information cannot be used as a way to commun-
   icate between the DHCP server and the relay agent.

   Since the relay agent can modify the client's DHCP DHCPREQUEST in
   only two ways: the giaddr and the relay-agent-info option, there is
   thus a need to extend the relay-agent-info option with a new sub-
   option, the link-selection sub-option, to allow separation of the
   specification of the subnet/link from the IP address to use when com-
   municating with the relay agent.


2.  Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC 2119].

   This document uses the following terms:

      o "DHCP client"

        A DHCP client is an Internet host using DHCP to obtain confi-
        guration parameters such as a network address.

      o "DHCP relay agent"

        A DHCP relay agent is a third-party agent that transfers BOOTP
        and DHCP messages between clients and servers residing on dif-
        ferent subnets, per [RFC 951] and [RFC 1542].

      o "DHCP server"

        A DHCP server is an Internet host that returns configuration
        parameters to DHCP clients.

      o "link"

        A link is a collection of subnets that all coexist on the same



Kinnear, et. al.          Expires October 2002                  [Page 3]

Internet Draft        Subnet Selection sub-option             April 2002


        physical medium. Sometimes called a lan segment or network seg-
        ment in other contexts.

      o "subnet"

        A subnet (for the purposes of this document) consists on a rout-
        able address range.  It may be one of several that exist on a
        link at the same time.


3.  Link selection sub-option definition

   The link-selection sub-option is used by any DHCP relay agent which
   desires to specify a subnet/link for a DHCP client request that it is
   relaying but needs the subnet/link specification to be different from
   the IP address the DHCP server should use when communicating with the
   relay agent.

   The sub-option contains a single IP address that is an address con-
   tained in a subnet. The value for the subnet address is determined by
   taking any IP address on the subnet and ANDing that address with the
   subnet mask (i.e.: the network and subnet bits are left alone and the
   remaining (address) bits are set to zero).  This determines a single
   subnet, and when allocating an IP address, all of the other related
   subnets on the same link will also be considered in the same way as
   currently specified for the processing of the giaddr in [RFC 2131].

   When the DHCP server is allocating an address and this sub-option is
   present then the DHCP server MUST allocate the address on either:

      o the subnet specified in the link-selection sub-option, or;

      o a subnet on the same link (also known as a network segment) as
        the subnet specified by the link-selection sub-option.

   The format of the sub-option is:



           SubOpt   Len     subnet IP address
          +------+------+------+------+------+------+
          | TBD  |   4  |  a1  |  a2  |  a3  |  a4  |
          +------+------+------+------+------+------+



   A relay agent which uses this sub-option MUST assume that the server
   receiving the sub-option supports the sub-option and used the



Kinnear, et. al.          Expires October 2002                  [Page 4]

Internet Draft        Subnet Selection sub-option             April 2002


   information available in the sub-option to correctly allocate an IP
   address.  A relay agent which uses this sub-option MUST NOT take dif-
   ferent actions based on whether this sub-option appears or does not
   appear in the response packet from the server.

   It is important to ensure using administrative techniques that any
   relay agent employing this sub-option is directed to only send pack-
   ets to a server which supports this sub-option.

   Support for this sub-option does not require changes to operations or
   features of the DHCP server other than to select the subnet (and
   link) on which to allocate an address. For example, the handling of
   DHCPDISCOVER for an unknown subnet should continue to operate
   unchanged.

   In the event that a DHCP server receives a packet which contains both
   a subnet-selection option [RFC 3011] as well as a link-selection
   sub-option, the information contained in the link-selection sub-
   option MUST be used to control the allocation of an IP address in
   preference to the information contained in the subnet-selection
   option.

   When this sub-option is present and the server supports this sub-
   option, the server MUST NOT offer an address that is not on the
   requested subnet or the link (network segment) with which that subnet
   is associated.

   The IP address to which a DHCP server sends a reply MUST be the same
   as it would choose when this sub-option is not present.

4.  Security Considerations

   Potential attacks on DHCP are discussed in section 7 of the DHCP pro-
   tocol specification [RFC 2131], as well as in the DHCP authentication
   specification [RFC 3118].

   The link-selection sub-option allows a relay agent to specify the
   subnet/link on which to allocate an address for a DHCP client.  Given
   that the subnet-selection option already exists [RFC 3011], no funda-
   mental new security issues are raised by the existance of the link-
   selection sub-option specified in this document beyond those implied
   by the subnet-selection option [RFC 3011].

   The existance of either the subnet-selection option or link-selection
   sub-option documented here would allow a malicious DHCP client to
   perform a more complete address-pool exhaustion attack than could be
   performed without the use of these options, since the client would no
   longer be restricted to attacking address-pools on just its local



Kinnear, et. al.          Expires October 2002                  [Page 5]

Internet Draft        Subnet Selection sub-option             April 2002


   subnet.

   There is some minor protection against this form of attack using this
   sub-option that is not present for the subnet-selection option, in
   that a trusted relay agent which supports the relay-agent-info option
   MUST discard a packet it receives with a zero giaddr and a relay-
   agent-info option when that packet arrives on an "untrusted" circuit
   [RFC 3046, section 2.1].

5.  IANA Considerations

   IANA has assigned a value of TBD from the DHCP Relay Agent Sub-
   options space [RFC 3046] for the link-selection sub-option defined in
   Section 3.

6.  Acknowledgments

   Eric Rosen contributed to helping the authors to understand the need
   for this sub-option.  Much of the text of this document was borrowed
   with only minimal modifications from the document describing the
   subnet-selection option [RFC 3011].


7.  References


   [RFC 951] Croft, B., Gilmore, J., "Bootstrap Protocol (BOOTP)", RFC
      951, September 1985.

   [RFC 1542] Wimer, W., "Clarifications and Extensions for the
      Bootstrap Protocol", RFC 1542, October 1993.

   [RFC 2119] Bradner, S., "Key words for use in RFCs to Indicate
      Requirement Levels", RFC 2119, March 1997.

   [RFC 2131] Droms, R., "Dynamic Host Configuration Protocol", RFC
      2131, March 1997.

   [RFC 2132] Alexander, S.,  Droms, R., "DHCP Options and BOOTP Vendor
      Extensions", Internet RFC 2132, March 1997.

   [RFC 3011] Waters, G. "The IPv4 Subnet Selection Option for DHCP",
      Internet RFC 3011, November 2000.

   [RFC 3046] Patrick, M., "DHCP Relay Agent Information Option", RFC
      3046, January 2001.





Kinnear, et. al.          Expires October 2002                  [Page 6]

Internet Draft        Subnet Selection sub-option             April 2002


8.  Author's information


      Kim Kinnear
      Mark Stapp
      Cisco Systems
      250 Apollo Drive
      Chelmsford, MA  01824

      Phone: (978) 244-8000

      EMail: kkinnear@cisco.com
             mjs@cisco.com


      Jay Kumarasamy
      Richard Johnson
      Cisco Systems
      170 W. Tasman Dr.
      San Jose, CA 95134

      Phone: (408) 526-4000

      EMail: jayk@cisco.com
             raj@cisco.com



9.  Intellectual Property Statement

The IETF takes no position regarding the validity or scope of any intel-
lectual property or other rights that might be claimed to  pertain to
the implementation or use of the technology described in this document
or the extent to which any license under such rights might or might not
be available; neither does it represent that it has made any effort to
identify any such rights.  Information on the IETF's procedures with
respect to rights in standards-track and standards-related documentation
can be found in BCP-11.  Copies of claims of rights made available for
publication and any assurances of licenses to be made available, or the
result of an attempt made to obtain a general license or permission for
the use of such proprietary rights by implementors or users of this
specification can be obtained from the IETF Secretariat.

The IETF invites any interested party to bring to its attention any
copyrights, patents or patent applications, or other proprietary rights
which may cover technology that may be required to practice this stan-
dard.  Please address the information to the IETF Executive Director.




Kinnear, et. al.          Expires October 2002                  [Page 7]

Internet Draft        Subnet Selection sub-option             April 2002


10.  Full Copyright Statement

Copyright (C) The Internet Society (2002). All Rights Reserved.

This document and translations of it may be copied and furnished to oth-
ers, and derivative works that comment on or otherwise explain it or
assist in its implementation may be prepared, copied, published and dis-
tributed, in whole or in part, without restriction of any kind, provided
that the above copyright notice and this paragraph are included on all
such copies and derivative works.  However, this document itself may not
be modified in any way, such as by removing the copyright notice or
references to the Internet Society or other Internet organizations,
except as needed for the  purpose of developing Internet standards in
which case the procedures for copyrights defined in the Internet Stan-
dards process must be followed, or as required to translate it into
languages other than English.

The limited permissions granted above are perpetual and will not be
revoked by the Internet Society or its successors or assigns.

This document and the information contained herein is provided on an "AS
IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING TASK
FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT
LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT
INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY OR FIT-
NESS FOR A PARTICULAR PURPOSE.

























Kinnear, et. al.          Expires October 2002                  [Page 8]
