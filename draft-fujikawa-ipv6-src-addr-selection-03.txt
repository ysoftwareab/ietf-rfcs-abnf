




Source Address Selection for IPv6                           FUJIKAWA Kenji
Internet-Draft                                                   ROOT Inc.
Expires: August 25, 2008                                    February 2007


    Source Address Selection Using Just Routing Information for IPv6
             draft-fujikawa-ipv6-src-addr-selection-03.txt



Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on May 19, 2008.

Copyright Notice

   Copyright (C) The IETF Trust (2008).

Abstract

   This document describes a problem of source address selection Rule 8.
   stated in RFC3484[RFC3484], and shows one solution, which is based
   just on the destination based address routing and does not require
   policy routing such as source address based routing.






FUJIKAWA                 Expires August 25, 2008                [Page 1]





Internet-Draft      Source Address Selection for IPv6          July 2007


1. A Problem of at Source Address Selection Rule 8. in RFC3484

   In RFC3484[RFC3404], the source address selection guidelines are
   shown in the case of multihoming.  However, according to them, a
   problem occurs that a host cannot select the best path.

   Rule 8 in 5. Source Address Selection in RFC3484 says:

      Rule 8: Use longest matching prefix.  If CommonPrefixLen(SA, D) >
      CommonPrefixLen(SB, D), then prefer SA. Similarly, if
      CommonPrefixLen(SB, D) > CommonPrefixLen(SA,D), then prefer SB.

   Here, consider a network shown in Fig. 1.

                         +---+
                         |CN |
                         +-+-+
                           | 2001:db8:2001::CN
                           |
                       +---+---+2001:db8:2000:/36
                       |       |
             +---------+ ISP2  |
             |         |       |
             |         +-------+
             |
         +---+---+2001:db8:1000:/36  +-------+2001:db8:3000::/36
         |       |                   |       |
         | ISP1  +-------------------+ ISP3  |
         |       |                   |       |
         +---+---+                   +---+---+
             |                           |
             |                           |
             +----------+       +---------+
        2001:db8:1000:R |       |2001:db8:3000:R
                      +-+-+   +-+-+
    2001:db8:1001::/48|R1 |   |R3 |2001:db8:3001::/48
                      +-+-+   +-+-+
                fe80::R1|       |fe80:R3
                        |       |
                      --+---+---+--
         2001:db8:1001:1:EN | 2001:db8:3001:1:EN
                          +-+-+
                          |EN |
                          +---+

                          Fig. 1

   In Fig. 1,



FUJIKAWA                 Expires August 25, 2008                [Page 2]





Internet-Draft      Source Address Selection for IPv6          July 2007


      - Each of ISP1, ISP2, and ISP3 is assigned an address space,
        2001:db8:1000::/36, 2001:db8:2000::/36, and 2001:db8:3000::/36,
        respectively.

      - Correspondent node CN belongs to ISP2, and is assigned an
        address 2001:db8:2001::CN.

      - The site is multihomed to ISP1 and ISP3, and the routers R1 and
        R2 distributes address spaces to downstream nodes such as
        2001:db8:1001::/48 and 2001:db8:3001::/48.

      - End node EN is assigned two addresses, 2001:db8:1001:1:EN and
        2001:db8:3001:1:EN.

   Here, in the above IPv6 address notation, CN, R1, R2, and EN
   indicates 64bit Interface ID's.

   According to Rule 8, by means of the longest match method,
   2001:db8:3001:EN is selected as the source address of a packet
   directed from CN to EN.  Therefore,

   - For the purpose of avoiding the source address filtering,
     policy routing or etc. is required in order to direct a packet to
     ISP3.

   - The route becomes roundabout passing through ISP3.


2. A Solution Using Just the Information of the Destination Address of
   Packets

   Here, one of the solutions of the above problem is shown, which is
   based on the traditional destination address based routing, that is,
   does not require policy routing such as source address based routing.
   This approach is separated into two issues, an management issue and
   implementation issue.















FUJIKAWA                 Expires August 25, 2008                [Page 3]





Internet-Draft      Source Address Selection for IPv6          July 2007


2.1 Management Issue

                         +---+
                         |CN |
                         +-+-+
                           | 2001:db8:2001::CN
                           |
                       +---+---+2001:db8:2000:/36
                       |       |
             +---------+ ISP2  |
             |         |       |
             |         +-------+
             |
         +---+---+2001:db8:1000:/36  +-------+2001:db8:3000::/36
         |       |                   |       |
         | ISP1  +-------------------+ ISP3  |
         |       |                   |       |
         +---+---+                   +---+---+
             |                           |
             |                           |
             +----------+       +---------+
        2001:db8:1000:R |       |2001:db8:3000:R
                      +-+-+   +-+-+
    2001:db8:1001::/48|R1 |   |R3 |2001:db8:3001::/48
                      +-+-+   +-+-+
      2001:db8:1001:1:R1|       |2001:db8:3001:1:R3 <- Change from Fig.1
                        |       |
                      --+---+---+--
         2001:db8:1001:1:EN | 2001:db8:3001:1:EN
                          +-+-+
                          |EN |
                          +---+

     Routing Tables:
       R1:
       Destination         Next Hop
       2001:db8:1000::/36  address_of_ISP1's_router
       2001:db8:2000::/36  address_of_ISP1's_router
       R3:
       2001:db8:3000::/36  address_of_ISP3's_router
       EN:
       Destination         Next Hop
       2001:db8:1000::/36  2001:db8:1001:1:R1
       2001:db8:2000::/36  2001:db8:1001:1:R1
       2001:db8:3000::/36  2001:db8:3001:1:R3

                            Fig.2




FUJIKAWA                 Expires August 25, 2008                [Page 4]





Internet-Draft      Source Address Selection for IPv6          July 2007


   First, mange a network such as shown in Fig. 2. Here:

      - The global addresses 2001:db8:1001:R1 and 2001:db8:3001:R3 is
        respectively assigned to the downstream interfaces of R1 and R3,
        in addition to the link local addresses.

      - Each of R1, R3 and EN keeps the traditional routing table
        shown in Fig.2, respectively.


2.2 Implementation Issue

   When an entry of a routing table is hit, a source address is selected
   which longest-matches the next hop in the entry.

   In the above example, on end node EN, when the entry
   "2001:db8:2000::/36  2001:db8:1001:1:R" is hit for the destination
   "2001:db8:2001::CN", the next hop becomes "2001:db8:1001::R", as a
   result, the address "2001:db8:1001:1:EN" is selected, because it
   longest-matches the next hop.


3. Modification to RFC3484

   Before Rule 8 (Use longest matching prefix) in section 5.  (Source
   Address Selection) in RFC3484, the rule using longest-matching prefix
   to the next hop is to be added.


4. How to distribute the routing information

   Any intra-domain routing protocol can be adaptable.  In order to
   deliver the routing information to be used with this rule, employing
   ND may not be suitable.  Delivering destination and next-hop pairs
   with routing protocols such as RIPng is the way to go.


5. Relations to [I-D.ietf-6man-addr-select-sol]

   This method is categorized into the most proactive approach in [I-
   D.ietf-6man-addr-select-sol].

   In order to select a precise source address for any destination at
   any time, the full routing table is required to the host.  This is an
   unavoidable issue for all the most proactive approaches, if one of
   those approaches is solely adopted.  It is also the same to the issue
   that in order to select the best path for any destination at any
   time, the full routing table is required.



FUJIKAWA                 Expires August 25, 2008                [Page 5]





Internet-Draft      Source Address Selection for IPv6          July 2007


6. Adaptation to a Single Router Multihomed Site.

                        +---+
                        |CN |
                        +-+-+
                          | 2001:db8:2001::CN
                          |
                      +---+---+2001:db8:2000:/36
                      |       |
            +---------+ ISP2  |
            |         |       |
            |         +-------+
            |
        +---+---+2001:db8:1000:/36  +-------+2001:db8:3000::/36
        |       |                   |       |
        | ISP1  +-------------------+ ISP3  |
        |       |                   |       |
        +---+---+                   +---+---+
            |                           |
            |                           |
            +------------+ +------------+
          2001:db8:1000:R| |2001:db8:3000:R
                        ++-++
      2001:db8:1001::/48| R |2001:db8:3001::/48
                        +-+-+
        2001:db8:1001:1:R | 2001:db8:3001:1:R
                          |
       2001:db8:1001:1:EN | 2001:db8:3001:1:EN
                        +-+-+
                        |EN |
                        +---+

     Routing Tables:
       R:
       Destination         Next Hop
       2001:db8:1000::/36  address_of_ISP1's_router
       2001:db8:2000::/36  address_of_ISP1's_router
       2001:db8:3000::/36  address_of_ISP3's_router
       EN:
       Destination         Next Hop
       2001:db8:1000::/36  2001:db8:1001:1:R
       2001:db8:2000::/36  2001:db8:1001:1:R
       2001:db8:3000::/36  2001:db8:3001:1:R


                          Fig.3

   This method is also adaptable to a single router multihomed site.  In



FUJIKAWA                 Expires August 25, 2008                [Page 6]





Internet-Draft      Source Address Selection for IPv6          July 2007


   the site, the single router should be assigned multiple address
   spaces, and it assigns multiple addresses to the downstream
   interfaces.  This is required when it has only a single downstream
   interface.  (see Fig. 3)


Author's Address

    FUJIKAWA Kenji
    ROOT Inc., Kyoto Information Laboratory
    59 Minami-yonnotsubo-cho, Iwakura, Sakyo-ku, Kyoto 606-0033, Japan
    Phone: +81-3-5436-8380 (Ext. 1593)
    Email: fujikawa@root-hq.com

References

   [RFC3484]  Draves, R., "Default Address Selection for Internet
              Protocol version 6 (IPv6)", RFC 3484, February 2003.

   [I-D.ietf-6man-addr-select-sol]
              Matsumoto, A., at el., Solution approaches for
              address-selection problems,
              draft-ietf-6man-addr-select-sol-00.txt (work in progress),
              January 2007.



























FUJIKAWA                 Expires August 25, 2008                [Page 7]





Internet-Draft      Source Address Selection for IPv6          July 2007


Full Copyright Statement

   Copyright (C) The IETF Trust (2007).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at ietf-
   ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).






FUJIKAWA                 Expires August 25, 2008                [Page 8]


