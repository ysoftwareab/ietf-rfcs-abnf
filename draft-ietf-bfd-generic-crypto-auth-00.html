<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>BFD Generic Cryptographic Authentication</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 BFD Security Association  ">
<link href="#rfc.section.3" rel="Chapter" title="3 Authentication Procedures  ">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Authentication Types">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Authentication Section Format">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Procedures at the Sending Side  ">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Procedure at the Receiving Side  ">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Key Selection for BFD Packet Transmission ">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Replay Protection using Extended Sequence Numbers  ">
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="7.2 References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document proposes an extension to Bidirectional Forwarding Detection (BFD) to allow the use of any cryptographic authentication algorithm in addition to the already-documented authentication schemes described in the base specification. This document adds the basic infrastructure thats required for supporting algorithm and key agility for BFD." />
  <meta name="description" content="This document proposes an extension to Bidirectional Forwarding Detection (BFD) to allow the use of any cryptographic authentication algorithm in addition to the already-documented authentication schemes described in the base specification. This document adds the basic infrastructure thats required for supporting algorithm and key agility for BFD." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">M. Bhatia</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Alcatel-Lucent</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">V. . Manral</td>
</tr>
<tr>
<td class="left">Expires: April 10, 2012</td>
<td class="right">Hewlett-Packard Co.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">D. Zhang</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Huawei</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 08, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">BFD Generic Cryptographic Authentication<br />
  <span class="filename">draft-ietf-bfd-generic-crypto-auth-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document proposes an extension to Bidirectional Forwarding Detection (BFD) to allow the use of any cryptographic authentication algorithm in addition to the already-documented authentication schemes described in the base specification. This document adds the basic infrastructure thats required for supporting algorithm and key agility for BFD.</p>
<h1><a>Requirements Language</a></h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 10, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">BFD Security Association  </a>
</li>
<li>3.   <a href="#rfc.section.3">Authentication Procedures  </a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Authentication Types</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Authentication Section Format</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Procedures at the Sending Side  </a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Procedure at the Receiving Side  </a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Key Selection for BFD Packet Transmission </a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Replay Protection using Extended Sequence Numbers  </a>
</li>
<li>4.   <a href="#rfc.section.4">IANA Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgements</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>7.2.   <a href="#rfc.references.2">References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The base specification of bidirectional Forwarding Detection (BFD) [RFC5880] defines five authentication schemes: Simple Password, Keyed MD5 , Meticulous Keyed MD5, Keyed SHA-1 and Meticulous SHA-1. In Simple Password, passwords are transferred in plaintext. An attacker with physical access to the network can easily eavesdrop on the password and compromise the security of the BFD packet exchanges. In Keyed MD5 and Meticulous Keyed MD5, the BFD devices on the both sides of a BFD session share a secret key which is used to generate a keyed MD5 digest for each packet, and a monotonically increasing sequence number scheme is used to prevent replay attacks. Keyed SHA-1 and Meticulous SHA-1 modes are similar to MD5, and it uses SHA-1 instead of an MD5 digest for each packet.</p>
<p id="rfc.section.1.p.2">A concern with existing authentication schemes of BFD is that the security strength of the cryptographic algorithms adopted in the schemes is relatively weak. Both the MD5 algorithm and the SHA-1 algorithm are known to be vulnerable to collision attacks. In [MD5-attack] and [Dobb96a, Dobb96b], several methods of generating hash collisions for some applications of MD5 are proposed. Similar security vulnerabilities of SHA-1 are introduced in [SHA-1-attack1] and [SHA-1-attack2]. It is therefore desired that BFD must support newer algorithms that have not yet been broken. Additionally, the transition mechanism from one algorithm to the other must be seamless.</p>
<p id="rfc.section.1.p.3">The other issue with the existing authentication schemes is that those are subject to replay attacks. In non-meticulous authentication schemes, sequence numbers are only increased occasionally. This behavior can be taken advantage of by an attacker to perform intra-session replay attacks. In meticulous authentication schemes, sequence numbers are required to monotonically increase with each successive packet, which eliminates the possibility of intra-session replay attacks. </p>
<p id="rfc.section.1.p.4">BFD session timers are often defined with the granularity of microseconds. Although in practice BFD devices send packets at millisecond intervals, they can potentially, send packets at a much higher rate. Since the cryptographic sequence number space is only 32 bits, when using Meticulous Authentication, a sequence number used in a BFD session can reach its maximum value and roll over within a short period. For instance, if the value of a sequence number is increased by one every millisecond, then it will reach its maximum in less than 8 weeks. This can potentially be exploited to launch inter-session replay attacks.</p>
<p id="rfc.section.1.p.5">In order to address the issues mentioned above, this document proposes two new authentication types that can be used to secure the BFD packets. The two authentication types are - Cryptographic Authentication (CRYPTO_AUTH) and Meticulous Cryptographic Authentication (MET_ CRYPTO_AUTH). Unlike earlier authentication types that were defined in BFD, the proposed authentication types are not tied to any particular authentication algorithm or a construct. These can use different authentication algorithms and constructs like MD5, SHA-1, SHA-2, HMAC-SHA1, HMAC-SHA2, etc. to provide authentication and data integrity protection for BFD control packets. </p>
<p id="rfc.section.1.p.6">The packet replay mechanism has also been modified to improve its capability in handling inter and intra-session replay attacks.</p>
<p id="rfc.section.1.p.7">It should be noted that this document attempts to fix the manual key management procedure that currently exists within BFD, as part of the Phase One described in KARP-design-guide [add a reference here]. We therefore only consider pre-shared keys being used. However, the solution described in this document is generic and does not preclude the possibility of supporting keys derived from an automated key management protocol.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> BFD Security Association  </h1>
<p id="rfc.section.2.p.1">The BFD protocol does not include an in-band mechanism to create or manage BFD Security Associations (BFD SA). A BFD SA contains a set of shared parameters between any two legitimate BFD devices.</p>
<p id="rfc.section.2.p.2">Parameters associated with a BFD SA:</p>
<p id="rfc.section.2.p.3">o Authentication Algorithm : This indicates the authentication algorithm to be used with the BFD SA. This information SHOULD never be sent in plaintext over the wire.</p>
<p id="rfc.section.2.p.4">o Authentication Key : This indicates the cryptographic key associated with this BFD SA. The length of this key is variable and depends upon the authentication algorithm specified by the BFD SA.  Operators MUST ensure that this is never sent over the network in clear-text via any protocol. Care should also be taken to ensure that the selected key is unpredictable, avoiding any keys known to be weak for the algorithm in use. <a href="#RFC4086">[RFC4086]</a> contains helpful information on both key generation techniques and cryptographic randomness. </p>
<p id="rfc.section.2.p.5">o Authentication Key Identifier (Key ID) : This is a two octet unsigned integer used to uniquely identify the BFD SA, as manually configured by the network operator (or, in the future, possibly by some key management protocol specified by the IETF). The receiver determines the active SA by looking at this field in the incoming packet. The sender puts this Key ID in the BFD packet based on the active configuration. Using Key IDs makes changing keys while maintaining protocol operation convenient. Normally, an implementation would allow the network operator to configure a set of keys in a key chain, with each key in the chain having fixed lifetime. The actual operation of these mechanisms is outside the scope of this document.</p>
<p id="rfc.section.2.p.6">A key ID indicates a tuple of an authentication key and an associated authentication algorithm. If a key is expected to be applied with different algorithms, different Key IDs must be used to identify the associations of the key with its authentication algorithms respectively.  However, the application of a key for different purposes must be very careful, since it may make an adversary easier to collect more material to compromise the key.</p>
<p id="rfc.section.2.p.7">o Not Before Time : The time point before which the key should not be used.</p>
<p id="rfc.section.2.p.8">o Not After Time : The time point after which the key should not be used.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Authentication Procedures  </h1>
<p id="rfc.section.3.p.1">In the proposed authentication extension, an optional authentication section (Generic Authentication Section) and two authentication types (Generic Cryptographic Authentication and Generic Meticulous Cryptographic Authentication) are specified.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Authentication Types</h1>
<p id="rfc.section.3.1.p.1">The Authentication section is only present in a BFD packet if the Authentication Present (A) bit is set in the packet header. The Auth Type in the Authentication section is set to 6 when Generic Cryptographic Authentication is in use, while it is set to 7 when Generic Meticulous Cryptographic Authentication is in use.</p>
<p id="rfc.section.3.1.p.2">Both the authentication types use a monotonically increasing sequence number to protect the BFD session against reply attacks. The only difference between the two types is that the sequence number is occasionally incremented in the Cryptographic Authentication mode, as against the Meticulous Cryptographic Authentication mode, where it is incremented on every packet.</p>
<p id="rfc.section.3.1.p.3">As a result of this, in the Cryptographic Authentication scheme, a replay attack is possible till the next sequence number is sent out.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Authentication Section Format</h1>
<p id="rfc.section.3.2.p.1">A new authentication type, 6 or 7, indicating the generic cryptographic authentication mechanism in use, is inserted in the first octet of Authentication Section of the BFD control packet.</p>
<div id="#rfc.figure.1"></div>
<pre> 0                 1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Auth Type   |   Auth Len    |         Auth Key ID           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Sequence Number (High Order 32 Bits)                |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Sequence Number (Low Order 32 Bits)                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                  Authentication Data (Variable)               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre>
<p id="rfc.section.3.2.p.2">For a BFD packet, if the Authentication Present (A) bit is set in the header, and the Authentication Type field if 6 (Generic Cryptographic Authentication) or 7 (Generic Meticulous Cryptographic Authentication), the Authentication Section has the following format: </p>

<ul>
<li>Auth Type: The Authentication Type, which in this case is 6 (Cryptographic Authentication) or 7 (Meticulous Cryptographic Authentication).</li>
<li>Auth Len: Length of the Authentication Section.</li>
<li>Auth Key ID: The Key ID of the authentication key used for this packet, enabling multiple keys to be active simultaneously.</li>
<li>Sequence Number: A 64-bit sequence number that is used to prevent replay attacks. For Cryptographic Authentication this value is incremented occasionally. For Meticulous Cryptographic Authentication, this value is incremented for each successive packet transmitted for a session.</li>
<li>Authentication Data: This field carries the digest computed by whatever Cryptographic Authentication algorithm is being used to authenticate the BFD control packet.</li>
</ul>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Procedures at the Sending Side  </h1>
<p id="rfc.section.3.3.p.1">Before a BFD device sends a BFD packet out, the device needs to select an appropriate BFD SA from its local key table if a keyed digest for the packet is required. If no appropriate SA is available, the BFD packet MUST be discarded.</p>
<p id="rfc.section.3.3.p.2">If an appropriate SA is available, the device then derives the key and the associated authentication algorithm from the SA.</p>
<p id="rfc.section.3.3.p.3">The device sets the Authentication Present (A) bit in the packet header.</p>
<p id="rfc.section.3.3.p.4">The device MUST fill the Auth Type and the Auth length before the authentication data is computed. The Sequence Number field MUST be set to bfd.XmitAuthSeq.</p>
<p id="rfc.section.3.3.p.5">The Auth length in the Authentication section is set as per the authentication algorithm that is being used.</p>
<p id="rfc.section.3.3.p.6">The Key ID is filled.</p>
<p id="rfc.section.3.3.p.7">The computation of the digest is performed. The computing process can be various when different algorithms are adopted and is out of the scope of this document.</p>
<p id="rfc.section.3.3.p.8">The generated digest is placed in the Authentication data, following the Key ID.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Procedure at the Receiving Side  </h1>
<p id="rfc.section.3.4.p.1">When a BFD Control packet is received, the following procedure MUST be followed, in the order specified.</p>
<p id="rfc.section.3.4.p.2">If the Authentication Present (A) bit is set in the packet header and the receiver will try to find a appropriate BFD SA in its local key table to process the packet. The BFD SA is identified by the Key ID in the Authentication Section of the incoming BFD packet.</p>
<p id="rfc.section.3.4.p.3">If the Auth Key ID field does not match the ID of any configured authentication key or the associated key is not in its valid period, the received packet MUST be discarded.</p>
<p id="rfc.section.3.4.p.4">If bfd.AuthSeqKnown is 1, examine the Sequence Number field. For Cryptographic Authentication, if the Sequence Number lies outside of the range of bfd.RcvAuthSeq to bfd.RcvAuthSeq+(3*Detect Mult) inclusive (when treated as an unsigned 32 bit circular number space), the received packet MUST be discarded. For Meticulous Cryptographic Authentication, if the Sequence Number lies outside of the range of bfd.RcvAuthSeq+1 to bfd.RcvAuthSeq+(3*Detect Mult) inclusive (when treated as an unsigned 32 bit circular number space, the received packet MUST be discarded.</p>
<p id="rfc.section.3.4.p.5">The device then prepares for generating a digest of the packet.  First of all, the authentication data in the Authentication Value field needs to be saved somewhere else. Then the Authentication Value field is set with a certain value (which may be various in different security algorithms) according the authentication algorithm indicated in the SA. After this, the device starts performing the digest generating operations. The work of defining actual digest generating operations is out of the scope of this document.</p>
<p id="rfc.section.3.4.p.6">The calculated data is compared with the received authentication data in the packet and the packet MUST be discarded if the two do not match. In such a case, an error event SHOULD be logged.</p>
<p id="rfc.section.3.4.p.7">An implementation MAY have a transition mode where it includes CRYPTO_AUTH or the MET_CRYPTO_AUTH information in the packets but does not verify this information. This is provided as a transition aid for networks in the process of migrating to the new CRYPTO_AUTH and MET_CRYPTO_AUTH based authentication schemes.</p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> Key Selection for BFD Packet Transmission </h1>
<p id="rfc.section.3.5.p.1">This section describes how the proposed security solution selects long-lived keys from key tables <a href="#I-D.ietf-karp-crypto-key-table">[I-D.ietf-karp-crypto-key-table]</a>. Generally, a key used for BFD packet authentication should satisfy the following requirements: </p>

<ul>
<li>The key time period as defined by Not Before Time and Not After Time must include the current time.</li>
<li>The key can be used for the desired security algorithm.</li>
</ul>
<p id="rfc.section.3.5.p.2">In the remainder of this section, additional requirements for keys are enumerated. Assume that a device R1 tries to send a unicast BFD packet from its interface I1 to the interface R2 of a remote device R2 at time T. Because the key should be shared by the by both R1 and R2 to protect the communication between I1 and I2, the key should satisfy the following requirements:</p>
<p></p>

<ul>
<li>The Peer field includes the device ID of R2.</li>
<li>The PeerKeyID field is not "unknown".</li>
<li>The Interfaces field includes I1.</li>
<li>The Direction field is either "out" or "both".</li>
</ul>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> Replay Protection using Extended Sequence Numbers  </h1>
<p id="rfc.section.3.6.p.1">As described in Section 1, if the BFD packets in a session are transferred with a high frequency, a 32-bit sequence number may reach its maximum and have to roll back before the session finishes. A attacker thus can replay the packets intercepted before the sequence number wrapped without being detected. To address this problem, the length of the sequence number in the proposed authentication section has been extended to 64 bits. After the extension, the sequence number space of a device will not be exhausted within half of a million years even if the device sends out a BFD packet in every micro-second.  Therefore, the replay attack risks caused by the limited sequence number space can be largely addressed. However, in Generic Cryptographic Authentication, the sequence number is only required to increase occasionally. Therefore, a replayed packet may be regarded as a legal one until the packet with a larger sequence number is received. This type of intra-session replay attack cannot be addressed only by extending the length of sequence numbers.</p>
<p id="rfc.section.3.6.p.2">An anti-replay solution for BFD also needs to consider the scenarios where a BFD device loses its prior sequence number state (e.g., system crash, loss of power). In such cases, a BFD device has to re-initialize its sequence number. Taking this opportunity, an attacker may be able to replay the antique packets intercepted in previous sessions without being detected.</p>
<p id="rfc.section.3.6.p.3">To address this problem, in the proposed solution, the most significant 32-bit value of the sequence number is used to contain a boot count, and the remainder 32-bit value is used as an ordinary 32-bit monotonically increasing sequence number. In Generic Cryptographic Authentication, the remainder 32-bit value is required to increase occasionally, while in Generic Meticulous Cryptographic Authentication, the lower order 32-bit sequence number MUST be incremented for every BFD packet sent by a BFD device. The BFD implementations are required to retain the boot count in non-volatile storage for the deployment life the BFD device. The boot count increases each time when the BFD device loses its prior sequence number state. The SNMPv3 snmpEngineBoots variable <a href="#RFC4222">[RFC4222]</a> MAY be used for this purpose. However, maintaining a separate boot count solely for BFD sequence numbers has the advantage of decoupling SNMP re-initialization and BFD re-initialization. Also, in the rare event that the lower order 32- bit sequence number wraps, the boot count can be incremented to preserve the strictly increasing property of the aggregate sequence number. Hence, a separate BFD boot count is RECOMMENDED.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.4.p.1">This document currently defines a value of 6 to be used to denote Cryptographic Authentication mechanism for authenticating BFD control packets and 7 for Meticulous Cryptographic Authentication.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">The proposed sequence number extension offers most of the benefits of of more complicated mechanisms involving challenges. There are, however, a couple drawbacks to this approach. First, it requires the BFD implementation to be able to save its boot count in non-volatile storage. If the non-volatile storage is ever repaired or upgraded such that the contents are lost or the BFD device is replaced with a model, the keys MUST be changed to prevent replay attacks. Second, if a device is taken out of service completely (either intentionally or due to a persistent failure), the potential exists for reestablishment of a BFD adjacency by replaying the entire BFD session establishment. This scenario is however, extremely unlikely and can be easily avoided. For instance, after recovering from a system failure, a BFD device has to re-establish BFD sessions. At this stage, if the device randomly selects its discriminators to identify new BFD sessions, the possibility of reestablishing a BFD session by replaying the entire BFD session establishment will be eliminated. For the implementations in which discriminators are not randomly selected, this issue can be addressed by integrating the boot count of the remote BFD router in the generation of the authentication data for outgoing BFD packets. Of course, this attack could also be thwarted by changing the relevant manual keys.</p>
<p id="rfc.section.5.p.2">There is a transition mode suggested where devices can ignore the CRYPTO_AUTH or the MET_CRYPTO_AUTH information carried in the packets.  The operator must ensure that this mode is only used when migrating to the new CRYPTO_AUTH/MET_CRYPTO_AUTH based authentication scheme as this leaves the device vulnerable to an attack.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p></p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr></tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="MD5-attack">[MD5-attack]</b></td>
<td class="top">
<a>Wang, X</a>, <a>Feng, D.</a>, <a>Lai, X.</a> and <a>H. Yu</a>, "<a>Collisions for Hash Functions MD4, MD5, HAVAL-128 and RIPEMD</a>", August 2004.</td>
</tr>
<tr>
<td class="reference"><b id="Dobb96a">[Dobb96a]</b></td>
<td class="top">
<a>Dobbertin, H.</a>, "<a>Cryptanalysis of MD5 Compress</a>", May 1996.</td>
</tr>
<tr>
<td class="reference"><b id="Dobb96b">[Dobb96b]</b></td>
<td class="top">
<a>Dobbertin, H.</a>, "<a>The Status of MD5 After a Recent Attack", CryptoBytes</a>", 1996.</td>
</tr>
<tr>
<td class="reference"><b id="SHA-1-attack1">[SHA-1-attack1]</b></td>
<td class="top">
<a>Wang, X.</a>, <a>Yin, Y.</a> and <a>H. Yu</a>, "<a>Finding Collisions in the Full SHA-1</a>", 2005.</td>
</tr>
<tr>
<td class="reference"><b id="SHA-1-attack2">[SHA-1-attack2]</b></td>
<td class="top">
<a>Wang, X.</a>, <a>Yao, A.</a> and <a>F. Yao</a>, "<a>New Collision Search for SHA-1</a>", 2005.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-karp-crypto-key-table">[I-D.ietf-karp-crypto-key-table]</b></td>
<td class="top">
<a>Housley, R</a> and <a>T Polk</a>, "<a href="http://tools.ietf.org/html/draft-ietf-karp-crypto-key-table-02">Database of Long-Lived Symmetric Cryptographic Keys</a>", Internet-Draft draft-ietf-karp-crypto-key-table-02, October 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5880">[RFC5880]</b></td>
<td class="top">
<a>Katz, D.</a> and <a>D. Ward</a>, "<a href="http://tools.ietf.org/html/rfc5880">Bidirectional Forwarding Detection (BFD)</a>", RFC 5880, June 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1321">[RFC1321]</b></td>
<td class="top">
<a href="mailto:rivest@theory.lcs.mit.edu" title="Massachusetts Institute of Technology, (MIT) Laboratory for Computer Science">Rivest, R.</a>, "<a href="http://tools.ietf.org/html/rfc1321">The MD5 Message-Digest Algorithm</a>", RFC 1321, April 1992.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4086">[RFC4086]</b></td>
<td class="top">
<a>Eastlake, D.</a>, <a>Schiller, J.</a> and <a>S. Crocker</a>, "<a href="http://tools.ietf.org/html/rfc4086">Randomness Requirements for Security</a>", BCP 106, RFC 4086, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4222">[RFC4222]</b></td>
<td class="top">
<a>Choudhury, G.</a>, "<a href="http://tools.ietf.org/html/rfc4222">Prioritized Treatment of Specific OSPF Version 2 Packets and Congestion Avoidance</a>", BCP 112, RFC 4222, October 2005.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Manav Bhatia </span> 
	  <span class="n hidden">
		<span class="family-name">Bhatia </span>
	  </span>
	</span>
	<span class="org vcardline">Alcatel-Lucent</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:manav.bhatia@alcatel-lucent.com">manav.bhatia@alcatel-lucent.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Vishwas Manral </span> 
	  <span class="n hidden">
		<span class="family-name">Manral </span>
	  </span>
	</span>
	<span class="org vcardline">Hewlett-Packard Co.</span>
	<span class="adr">
	  <span>19111 Pruneridge Ave.</span>

	  <span class="vcardline">
		<span class="locality">Cupertino</span>,  
		<span class="region">CA</span> 
		<span class="code">95014</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vishwas.manral@hp.com">vishwas.manral@hp.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Dacheng Zhang</span> 
	  <span class="n hidden">
		<span class="family-name">Zhang</span>
	  </span>
	</span>
	<span class="org vcardline">Huawei</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Beijing</span>,  
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">China</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:zhangdacheng@huawei.com">zhangdacheng@huawei.com</a></span>

  </address>
</div>

</body>
</html>