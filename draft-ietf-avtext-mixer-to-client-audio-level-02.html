<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>A Real-Time Transport Protocol (RTP) Header Extension for Mixer-to-Client Audio Level Indication </title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Operation">
<link href="#rfc.section.4" rel="Chapter" title="4 Header Format">
<link href="#rfc.section.5" rel="Chapter" title="5 Audio level encoding">
<link href="#rfc.section.6" rel="Chapter" title="6 Signaling Information">
<link href="#rfc.section.7" rel="Chapter" title="7 Security Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations">
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgments">
<link href="#rfc.section.10" rel="Chapter" title="10 Changes From Earlier Versions">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Changes From Draft -01">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 Changes From Draft -00">
<link href="#rfc.references" rel="Chapter" title="11 References">
<link href="#rfc.references.1" rel="Chapter" title="11.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="11.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Reference Implementation">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 AudioLevelCalculator.java">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes a mechanism for RTP-level mixers in audio conferences to deliver information about the audio level of individual participants. Such audio level indicators are transported in the same RTP packets as the audio data they pertain to.  " />
  <meta name="description" content="This document describes a mechanism for RTP-level mixers in audio conferences to deliver information about the audio level of individual participants. Such audio level indicators are transported in the same RTP packets as the audio data they pertain to.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">E. Ivov, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Jitsi</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">E. Marocco, Ed.</td>
</tr>
<tr>
<td class="left">Expires: November 10, 2011</td>
<td class="right">Telecom Italia</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Lennox</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Vidyo, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">May 09, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">A Real-Time Transport Protocol (RTP) Header Extension for Mixer-to-Client Audio Level Indication <br />
  <span class="filename">draft-ietf-avtext-mixer-to-client-audio-level-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes a mechanism for RTP-level mixers in audio conferences to deliver information about the audio level of individual participants. Such audio level indicators are transported in the same RTP packets as the audio data they pertain to.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on November 10, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Operation</a>
</li>
<li>4.   <a href="#rfc.section.4">Header Format</a>
</li>
<li>5.   <a href="#rfc.section.5">Audio level encoding</a>
</li>
<li>6.   <a href="#rfc.section.6">Signaling Information</a>
</li>
<li>7.   <a href="#rfc.section.7">Security Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a>
</li>
<li>9.   <a href="#rfc.section.9">Acknowledgments</a>
</li>
<li>10.   <a href="#rfc.section.10">Changes From Earlier Versions</a>
</li>
<li>10.1.   <a href="#rfc.section.10.1">Changes From Draft -01</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">Changes From Draft -00</a>
</li>
<li>11.   <a href="#rfc.references">References</a>
</li>
<li>11.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>11.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Reference Implementation</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">AudioLevelCalculator.java</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">The Framework for Conferencing with the Session Initiation Protocol (SIP) defined in <a href="#RFC4353">RFC 4353</a> <cite title="NONE">[RFC4353]</cite> presents an overall architecture for multi-party conferencing.  Among others, the framework borrows from <a href="#RFC3550">RTP</a> <cite title="NONE">[RFC3550]</cite> and extends the concept of a mixer entity "responsible for combining the media streams that make up a conference, and generating one or more output streams that are delivered to recipients". Every participant would hence receive, in a flat single stream, media originating from all the others.  </p>
<p id="rfc.section.1.p.2">Using such centralized mixer-based architectures simplifies support for conference calls on the client side since they would hardly differ from one-to-one conversations. However, the method also introduces a few limitations. The flat nature of the streams that a mixer would output and send to participants makes it difficult for users to identify the original source of what they are hearing.  </p>
<p id="rfc.section.1.p.3">Mechanisms that allow the mixer to send to participants cues on current speakers  (e.g. the CSRC fields in <a href="#RFC3550">RTP</a> <cite title="NONE">[RFC3550]</cite>) only work for speaking/silent binary indications. There are, however, a number of use cases where one would require more detailed information. Possible examples include the presence of background chat/noise/music/typing, someone breathing noisily in their microphone, or other cases where identifying the source of the disturbance would make it easy to remove it (e.g. by sending a private IM to the concerned party asking them to mute their microphone). A more advanced scenario could involve an intense discussion between multiple participants that the user does not personally know. Audio level information would help better recognize the speakers by associating with them complex (but still human readable) characteristics like loudness and speed for example.  </p>
<p id="rfc.section.1.p.4">One way of presenting such information in a user friendly manner would be for a conferencing client to attach audio level indicators to the corresponding participant related components in the user interface as displayed in <a href="#figure-conference-ui">Figure 1</a>.  </p>
<div id="#rfc.figure.1"></div>
<div id="#figure-conference-ui"></div>
<pre>

                      ________________________
                     |                        |
                     |  00:42 |  Weekly Call  |
                     |________________________|
                     |                        |
                     |                        |
                     | Alice |======    | (S) |
                     |                        |
                     | Bob   |=         |     |
                     |                        |
                     | Carol |          | (M) |
                     |                        |
                     | Dave  |===       |     |
                     |                        |
                     |________________________|

        </pre>
<p></p>
<p id="rfc.section.1.p.5">Implementing a user interface like the above requires analysis of the media sent from other participants. In a conventional audio conference this is only possible for the mixer since all other conference participants are generally receiving a single, flat audio stream and have therefore no immediate way of determining individual audio levels.  </p>
<p id="rfc.section.1.p.6">This document specifies an RTP extension header that allows such mixers to deliver audio level information to conference participants by including it directly in the RTP packets transporting the corresponding audio data.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.  </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Protocol Operation</h1>
<p id="rfc.section.3.p.1">According to <a href="#RFC3550">RFC 3550</a> <cite title="NONE">[RFC3550]</cite> a mixer is expected to include in outgoing RTP packets a list of identifiers (CSRC IDs) indicating the sources that contributed to the resulting stream. The presence of such CSRC IDs allows RTP clients to determine, in a binary way, the active speaker(s) in any given moment. RTCP also provides a basic mechanism to map the CSRC IDs to user identities through the CNAME field. More advanced mechanisms, may exist depending on the signaling protocol used to establish and control a conference. In the case of the <a href="#RFC3261">Session Initiation Protocol</a> <cite title="NONE">[RFC3261]</cite> for example, the <a href="#RFC4575">Event Package for Conference State</a> <cite title="NONE">[RFC4575]</cite> defines a &lt;src-id&gt; tag which binds CSRC IDs to media streams and SIP URIs.  </p>
<p id="rfc.section.3.p.2">This document describes an RTP header extension that allows mixers to indicate the audio-level of every conference participant (CSRC) in addition to simply indicating their on/off status. This new header extension uses "General Mechanism for RTP Header Extensions" described in <a href="#RFC5285">[RFC5285]</a>.  </p>
<p id="rfc.section.3.p.3">Each instance of this header contains a list of one-octet audio levels expressed in -dBov, with values from 0 to 127 representing 0 to -127 dBov(see <a href="#hdr-fmt">Section 4</a> and <a href="#level-enc">Section 5</a>). <a href="#ri">Appendix Appendix A</a> provides a reference implementation indicating one way of obtaining such values from raw audio samples.  </p>
<p id="rfc.section.3.p.4">Every audio level value pertains to the CSRC identifier located at the corresponding position in the CSRC list. In other words, the first value would indicate the audio level of the conference participant represented by the first CSRC identifier in that packet and so forth. The number and order of these values MUST therefore match the number and order of the CSRC IDs present in the same packet.  </p>
<p id="rfc.section.3.p.5">When encoding audio level information, a mixer SHOULD include in a packet information that corresponds to the audio data being transported in that same packet. It is important that these values follow the actual stream as closely as possible.  Therefore a mixer SHOULD also calculate the values after the original contributing stream has undergone possible processing such as level normalization, and noise reduction for example.  </p>
<p id="rfc.section.3.p.6">Note that in some cases a mixer may be sending an RTP audio stream that only contains audio level information and no actual audio. Updating a (web) interface conference module may be one reason for this to happen.  </p>
<p id="rfc.section.3.p.7">It may sometimes happen that a conference involves more than a single mixer. In such cases each of the mixers MAY choose to relay the CSRC list and audio-level information they receive from peer mixers (as long as the total CSRC count remains below 16). Given that the maximum audio level is not precisely defined by this specification, it is likely that in such situations average audio levels would be perceptibly different for the participants located behind the different mixers.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#hdr-fmt" id="hdr-fmt">Header Format</a>
</h1>
<div id="#rfc.figure.2"></div>
<div id="#figure-hdr-fmt"></div>
<p id="rfc.section.4.p.1">The audio level indicators are delivered to the receivers in-band using the <a href="#RFC5285">"General Mechanism for RTP Header Extensions"</a> <cite title="NONE">[RFC5285]</cite>.  The payload of this extension is an ordered sequence of 8-bit audio level indicators encoded as per <a href="#level-enc">Section 5</a>.  </p>

<p></p>
<pre>
    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  ID   |  len  |0|  level 1    |0|  level 2    |0|  level 3   ...
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
          </pre>
<p id="rfc.section.4.p.2">Note that use of the two-byte header defined in <a href="#RFC5285">RFC 5285</a> <cite title="NONE">[RFC5285]</cite> follows the same rules the only change being the length of the ID and len fields.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#level-enc" id="level-enc">Audio level encoding</a>
</h1>
<p id="rfc.section.5.p.1">The audio level header extension only carries the level of the audio in the RTP payload of the packet it is associated with. This information is carried in an RTP header extension element as defined by <a href="#RFC5285">[RFC5285]</a>.  </p>
<p id="rfc.section.5.p.2">The audio level is defined in the same manner as is audio noise level in the <a href="#RFC3389">RTP Payload Comfort Noise specification</a> <cite title="NONE">[RFC3389]</cite>. The overall magnitude of the noise level is encoded into the first byte of the payload, with spectral information about the noise in subsequent bytes.  This specification's audio level parameter is defined so as to be identical to the comfort noise payload's noise-level byte.  </p>
<div id="#rfc.figure.3"></div>
<div id="#figure-level-enc"></div>
<pre>

                        0 1 2 3 4 5 6 7
                       +-+-+-+-+-+-+-+-+
                       |0|   level     |
                       +-+-+-+-+-+-+-+-+

        </pre>
<p id="rfc.section.5.p.3">The magnitude of the audio level is packed into the seven least significant bits of the single byte of the header extension, shown in <a href="#figure-level-enc">Figure 3</a>. The least significant bit of  the audio level magnitude is packed into the least significant bit of the byte. The most significant bit of the byte is unused and always set to 0 as shown below in <a href="#figure-level-enc">Figure 3</a>.  </p>

<p></p>
<p id="rfc.section.5.p.4">The two-byte header defined in <a href="#RFC5285">RFC 5285</a> <cite title="NONE">[RFC5285]</cite> may also be used.</p>
<p id="rfc.section.5.p.5">The audio level is expressed in -dBov, with values from 0 to 127 representing 0 to -127 dBov.  dBov is the level, in decibels, relative to the overload point of the system, i.e. the maximum-amplitude signal that can be handled by the system without clipping.(Note: Representation relative to the overload point of a system is particularly useful for digital implementations, since one does not need to know the relative calibration of the analog circuitry.) For example, in the case of <a href="#ITU.G.711">u-law (audio/pcmu) audio</a> <cite title="NONE">[ITU.G.711]</cite>, the 0 dBov reference would be a square wave with values +/- 8031. (This translates to 6.18 dBm0, relative to u-law's dBm0 definition in Table 6 of G.711.) </p>
<p id="rfc.section.5.p.6">The audio level for digital silence, for example for a muted audio source, MAY be represented as 127 (-127 dBov), regardless of the dynamic range of the encoded audio format.  </p>
<p id="rfc.section.5.p.7">Implementations MAY choose to measure audio levels prior to encoding them in the payload carried in the RTP payload, e.g. on raw linear PCM input.  </p>
<p id="rfc.section.5.p.8">The audio level header extension only carries the level of the audio in the RTP payload of the packet it is associated with, with no long-term averaging or smoothing applied.  </p>
<p id="rfc.section.5.p.9">To simplify implementation of the encoding procedures described here, this specification provides a sample Java <a href="#ri">implementation</a> <cite title="NONE">[ri]</cite> of an audio level calculator that helps obtain such values from raw linear PCM audio samples.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#sig-info" id="sig-info">Signaling Information</a>
</h1>
<p id="rfc.section.6.p.1">The URI for declaring the audio level header extension in an SDP extmap attribute and mapping it to a local extension header identifier is "urn:ietf:params:rtp-hdrext:csrc-audio-level".  There is no additional setup information needed for this extension (i.e. no extensionattributes).  </p>
<p id="rfc.section.6.p.2">An example attribute line in the SDP, for a conference might be: </p>
<div id="#rfc.figure.4"></div>
<pre>
        a=extmap:7 urn:ietf:params:rtp-hdrext:csrc-audio-level
        </pre>
<p id="rfc.section.6.p.3">The above mapping will most often be provided per media stream (in the media-level section(s) of SDP, i.e., after an "m=" line) or globally if there is more than one stream containing audio level indicators in a session.  </p>
<p id="rfc.section.6.p.4">Presence of the above attribute in the SDP description of a media stream indicates that some or all RTP packets in that stream would contain the audio level information RTP extension header.  </p>
<p id="rfc.section.6.p.5">Conferencing clients that support audio level indicators and have no mixing capabilities would not be able to content for this audio level extension and would hence have to always include the direction parameter in the "extmap" attribute with a value of "recvonly".  Conference focus entities with mixing capabilities can omit the direction or set it to "sendrecv" in SDP offers. Such entities would need to set it to "sendonly" in SDP answers to offers with a "recvonly" parameter and to "sendrecv" when answering other "sendrecv" offers.  </p>
<p id="rfc.section.6.p.6">This speicification does not define use of the audio level extensions in video streams. Therefore, the extension defined in this document SHOULD NOT be advertised in anything but audio streams.  </p>
<p id="rfc.section.6.p.7">The following <a href="#client-focus">Figure 5</a> and <a href="#focus-focus">Figure 6</a> show two example offer/answer exchanges between a conferencing client and a focus, and between two conference focus entities.  </p>
<div id="#rfc.figure.5"></div>
<div id="#client-focus"></div>
<pre>
  v=0
  o=alice 2890844526 2890844526 IN IP6 host.example.com
  c=IN IP6 host.example.com
  t=0 0
  m=audio 49170 RTP/AVP 0 4
  a=rtpmap:0 PCMU/8000
  a=rtpmap:4 G723/8000
  a=extmap:1/recvonly urn:ietf:params:rtp-hdrext:csrc-audio-level

  v=0
  i=A Seminar on the session description protocol
  o=conf-focus 2890844730 2890844730 IN IP6 focus.example.net
  c=IN IP6 focus.example.net
  t=0 0
  m=audio 52543 RTP/AVP 0
  a=rtpmap:0 PCMU/8000
  a=extmap:1/sendonly urn:ietf:params:rtp-hdrext:csrc-audio-level
        </pre>
<p>A client-initiated example SDP offer/answer exchange negotiating an audio stream with one-way flow of of audio level information.  </p>
<div id="#rfc.figure.6"></div>
<div id="#focus-focus"></div>
<pre>
  v=0
  i=Un seminaire sur le protocole de description des sessions
  o=fr-focus 2890844730 2890844730 IN IP6 focus.fr.example.net
  c=IN IP6 focus.fr.example.net
  t=0 0
  m=audio 49170 RTP/AVP 0
  a=rtpmap:0 PCMU/8000
  a=extmap:1/sendrecv urn:ietf:params:rtp-hdrext:csrc-audio-level

  v=0
  i=A Seminar on the session description protocol
  o=us-focus 2890844526 2890844526 IN IP6 focus.us.example.net
  c=IN IP6 focus.us.example.net
  t=0 0
  m=audio 52543 RTP/AVP 0
  a=rtpmap:0 PCMU/8000
  a=extmap:1/sendrecv urn:ietf:params:rtp-hdrext:csrc-audio-level
        </pre>
<p>An example SDP offer/answer exchange between two conference focus entities with mixing capabilities negotiating an audio stream with bidirectional flow of audio level information.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Security Considerations</h1>
<p></p>

<ol>
<li>This document defines a means of attributing audio level to a particular participant in a conference. An attacker may try to modify the content of RTP packets in a way that would make audio activity from one participant appear as coming from another.  </li>
<li>Furthermore, the fact that audio level values would not be protected even in an SRTP session might be of concern in some cases where the activity of a particular participant in a conference is confidential.  </li>
<li>Both of the above are concerns that stem from the design of the RTP protocol itself and they would probably also apply when using CSRC identifiers the way they were specified in <a href="#RFC3550">RFC 3550</a> <cite title="NONE">[RFC3550]</cite>. It is therefore important that according to the needs of a particular scenario, implementors and deployers consider use of <a href="#I-D.lennox-avtcore-srtp-encrypted-header-ext">header extension encryption</a> <cite title="NONE">[I-D.lennox-avtcore-srtp-encrypted-header-ext]</cite> or a lower level security and authentication mechanism.  </li>
</ol>

<p> </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> IANA Considerations</h1>
<p id="rfc.section.8.p.1">This document defines a new extension URI that, if approved, would need to be added to the RTP Compact Header Extensions sub-registry of the Real-Time Transport Protocol (RTP) Parameters registry, according to the following data: </p>
<div id="#rfc.figure.7"></div>
<pre>
        Extension URI: urn:ietf:params:rtp-hdrext:csrc-audio-level
        Description:   Mixer-to-client audio level indicators
        Contact:       emcho@jitsi.org
        Reference:     RFC XXXX
        </pre>
<p id="rfc.section.8.p.2">Note to the RFC-Editor: please replace "RFC XXXX" by the number of this RFC.  </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> Acknowledgments</h1>
<p id="rfc.section.9.p.1">Lyubomir Marinov contributed level measurement and rendering code.  </p>
<p id="rfc.section.9.p.2">Roni Even, Keith Drage, Ingemar Johansson, Michael Ramalho and several others provided helpful feedback over the dispatch mailing list.  </p>
<p id="rfc.section.9.p.3">Jitsi's participation in this specification is funded by the NLnet Foundation.  </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> Changes From Earlier Versions</h1>
<p id="rfc.section.10.p.1">Note to the RFC-Editor: please remove this section prior to publication as an RFC.  </p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Changes From Draft -01</h1>
<p></p>

<ul>
<li>Removed code related the AudioLevelRenderer from "APPENDIX A. Reference Implementation" as it was considered an implementation matter by the working group.  </li>
<li>Modified the AudioLevelCalculator in "APPENDIX A.  Reference Implementation" to take overload as a parameter.  </li>
<li>Clarified non-use of audio levels in video streams </li>
<li>Closed the P.56 open issue. It was agreed on IETF 80 that P.56 is mostly about speech levels and the levels transported by the extension defined here should also be able to serve as an indication for noise.  </li>
<li>The Open Issues section has been removed as all issues that were in there are now resolved or clarified.  </li>
<li>Editorial changes for consistency with <a href="#I-D.ietf-avtext-client-to-mixer-audio-level">[I-D.ietf-avtext-client-to-mixer-audio-level]</a>.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> Changes From Draft -00</h1>
<p></p>

<ul>
<li>Added code for sound pressure calculation and measurement in "APPENDIX A. Reference Implementation".</li>
<li>Changed affiliation for Emil Ivov.</li>
<li>Removed "Appendix: Design choices".</li>
</ul>

<p> </p>
<h1 id="rfc.references">
<a href="#rfc.references">11.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">11.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3550">[RFC3550]</b></td>
<td class="top">
<a>Schulzrinne, H.</a>, <a>Casner, S.</a>, <a>Frederick, R.</a> and <a>V. Jacobson</a>, "<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>", STD 64, RFC 3550, July 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5285">[RFC5285]</b></td>
<td class="top">
<a>Singer, D.</a> and <a>H. Desineni</a>, "<a href="http://tools.ietf.org/html/rfc5285">A General Mechanism for RTP Header Extensions</a>", RFC 5285, July 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">11.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-avtext-client-to-mixer-audio-level">[I-D.ietf-avtext-client-to-mixer-audio-level]</b></td>
<td class="top">
<a>Lennox, J</a>, <a>Ivov, E</a> and <a>E Marocco</a>, "<a href="http://tools.ietf.org/html/draft-ietf-avtext-client-to-mixer-audio-level-06">A Real-Time Transport Protocol (RTP) Header Extension for Client-to- Mixer Audio Level Indication</a>", Internet-Draft draft-ietf-avtext-client-to-mixer-audio-level-06, November 2011.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.lennox-avtcore-srtp-encrypted-header-ext">[I-D.lennox-avtcore-srtp-encrypted-header-ext]</b></td>
<td class="top">
<a>Lennox, J</a>, "<a href="http://tools.ietf.org/html/draft-lennox-avtcore-srtp-encrypted-header-ext-00">Encryption of Header Extensions in the Secure Real-Time Transport Protocol (SRTP)</a>", Internet-Draft draft-lennox-avtcore-srtp-encrypted-header-ext-00, March 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4353">[RFC4353]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, "<a href="http://tools.ietf.org/html/rfc4353">A Framework for Conferencing with the Session Initiation Protocol (SIP)</a>", RFC 4353, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4575">[RFC4575]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>O. Levin</a>, "<a href="http://tools.ietf.org/html/rfc4575">A Session Initiation Protocol (SIP) Event Package for Conference State</a>", RFC 4575, August 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3389">[RFC3389]</b></td>
<td class="top">
<a>Zopf, R.</a>, "<a href="http://tools.ietf.org/html/rfc3389">Real-time Transport Protocol (RTP) Payload for Comfort Noise (CN)</a>", RFC 3389, September 2002.</td>
</tr>
<tr>
<td class="reference"><b id="ITU.G.711">[ITU.G.711]</b></td>
<td class="top">
<a>International Telecommunications Union </a>, "<a>Pulse Code Modulation (PCM) of Voice Frequencies</a>", ITU-T Recommendation G.711, November 1988.</td>
</tr>
<tr>
<td class="reference"><b id="ITU.P56.1993">[ITU.P56.1993]</b></td>
<td class="top">
<a>International Telecommunications Union </a>, "<a>Objective Measurement of Active Speech Level</a>", ITU-T Recommendation P.56, March 1988.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#ri" id="ri">Reference Implementation</a>
</h1>
<p id="rfc.section.Appendix A.p.1">This appendix contains Java code for a reference implementation of the level calculation and rendering methods.The code is not normative and by no means the only possible implementation. Its purpose is to help implementors add audio level support to mixers and clients.  </p>
<p id="rfc.section.Appendix A.p.2">The Java code contains an AudioLevelCalculator class that calculates the sound pressure level of a signal with specific samples. It can be used in mixers to generate values suitable for the level extension headers.  </p>
<p id="rfc.section.Appendix A.p.3">The implementation is provided in Java but does not rely on any of the language specific and can be easily ported to another.  </p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> AudioLevelCalculator.java</h1>
<div id="#rfc.figure.8"></div>
<pre>

/**
 * Calculates the audio level of specific samples of a singal based on
 * sound pressure level.
 */
public class AudioLevelCalculator
{

    /**
     * Calculates the sound pressure level of a signal with specific
     * &lt;tt&gt;samples&lt;/tt&gt;.
     *
     * @param samples the samples of the signal to calculate the sound
     * pressure level of. The samples are specified as an &lt;tt&gt;int&lt;/tt&gt;
     * array starting at &lt;tt&gt;offset&lt;/tt&gt;, extending &lt;tt&gt;length&lt;/tt&gt;
     * number of elements and each &lt;tt&gt;int&lt;/tt&gt; element in the specified
     * range representing a sample of the signal to calculate the sound
     * pressure level of. Though a sample is provided in the form of an
     * &lt;tt&gt;int&lt;/tt&gt; value, the sample size in bits is determined by the
     * caller via &lt;tt&gt;overload&lt;/tt&gt;.
     *
     * @param offset the offset in &lt;tt&gt;samples&lt;/tt&gt; at which the samples
     * start
     *
     * @param length the length of the signal specified in
     * &lt;tt&gt;samples&lt;tt&gt; starting at &lt;tt&gt;offset&lt;/tt&gt;
     *
     * @param overload the overload (point) of &lt;tt&gt;signal&lt;/tt&gt;.
     * For example, &lt;tt&gt;overload&lt;/tt&gt; may be {@link Byte#MAX_VALUE}
     * for 8-bit signed samples or {@link Short#MAX_VALUE} for
     * 16-bit signed samples.
     *
     * @return the sound pressure level of the specified signal
     */
    public static int calculateSoundPressureLevel(
        int[] samples, int offset, int length,
        int overload)
    {
        /*
         * Calcuate the root mean square of the signal i.e. the
         * effective sound pressure.
         */
        double rms = 0;

        for (; offset &lt; length; offset++)
        {
            double sample = samples[offset];

            sample /= overload;
            rms += sample * sample;
        }
        rms = (length == 0) ? 0 : Math.sqrt(rms / length);

        /*
         * The sound pressure level is a logarithmic measure of the
         * effectivesound pressure of a sound relative to a reference
         * value and is measured in decibels.
         */
        double db;

        /*
         * The minimum sound pressure level which matches the maximum
         * of the sound meter.
         */
        final double MIN_SOUND_PRESSURE_LEVEL = 0;
        /*
         * The maximum sound pressure level which matches the maximum
         * of the sound meter.
         */
        final double MAX_SOUND_PRESSURE_LEVEL
            = 127 /* HUMAN TINNITUS (RINGING IN THE EARS) BEGINS */;

        if (rms &gt; 0)
        {
            /*
             * The commonly used "zero" reference sound pressure in air
             * is 20 uPa RMS, which is usually considered the threshold
             * of human hearing.
             */
            final double REF_SOUND_PRESSURE = 0.00002;

            db = 20 * Math.log10(rms / REF_SOUND_PRESSURE);

            /*
             * Ensure that the calculated level is within the minimum
             * and maximum sound pressure level.
             */
            if (db &lt; MIN_SOUND_PRESSURE_LEVEL)
                db = MIN_SOUND_PRESSURE_LEVEL;
            else if (db &gt; MAX_SOUND_PRESSURE_LEVEL)
                db = MAX_SOUND_PRESSURE_LEVEL;
        }
        else
        {
            db = MIN_SOUND_PRESSURE_LEVEL;
        }

        return (int) db;
    }
}

          </pre>
<p>AudioLevelCalculator.java </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Emil Ivov</span> editor
	  <span class="n hidden">
		<span class="family-name">Ivov</span>
	  </span>
	</span>
	<span class="org vcardline">Jitsi</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Strasbourg</span>,  
		<span class="region"></span>
		<span class="code">67000</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:emcho@jitsi.org">emcho@jitsi.org</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Enrico Marocco</span> editor
	  <span class="n hidden">
		<span class="family-name">Marocco</span>
	  </span>
	</span>
	<span class="org vcardline">Telecom Italia</span>
	<span class="adr">
	  <span>Via G. Reiss Romoli, 274</span>

	  <span class="vcardline">
		<span class="locality">Turin</span>,  
		<span class="region"></span>
		<span class="code">10148</span>
	  </span>
	  <span class="country-name vcardline">Italy</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:enrico.marocco@telecomitalia.it">enrico.marocco@telecomitalia.it</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jonathan Lennox</span> 
	  <span class="n hidden">
		<span class="family-name">Lennox</span>
	  </span>
	</span>
	<span class="org vcardline">Vidyo, Inc.</span>
	<span class="adr">
	  <span>433 Hackensack Avenue</span>
<span>Seventh Floor</span>

	  <span class="vcardline">
		<span class="locality">Hackensack,</span>,  
		<span class="region"></span>
		<span class="code">NJ  07601</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jonathan@vidyo.com">jonathan@vidyo.com</a></span>

  </address>
</div>

</body>
</html>