<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Exporting Aggregated Flow Data using the IP Flow Information Export (IPFIX) Protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Exporting Aggregated Flow Data using the IP Flow Information Export (IPFIX) Protocol">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">IPFIX Working Group</td><td class="header">B. Trammell</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">E. Boschi</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">ETH Zurich</td></tr>
<tr><td class="header">Expires: January 6, 2011</td><td class="header">A. Wagner</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">Consecom AG</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">July 5, 2010</td></tr>
</table></td></tr></table>
<h1><br />Exporting Aggregated Flow Data using the IP Flow Information Export (IPFIX) Protocol<br />draft-trammell-ipfix-a8n-00.txt</h1>

<h3>Abstract</h3>

<p>This document describes the export of aggregated Flow information using
    IPFIX. An aggregated Flow is essentially an IPFIX Flow with an externally
    imposed time interval, generally representing packets from one or more
    original Flows. The document describes aggregated Flow export within the
    framework of IPFIX Mediators, defines an interoperable,
    implementation-independent method for aggregated Flow export, covering
    time interval export, counter distribution and export, and counting of
    original Flows.
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted  in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on January 6, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#sec-terminology">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
Requirements for Aggregation Support in IPFIX<br />
<a href="#anchor3">4.</a>&nbsp;
Aggregation of IP Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">4.1.</a>&nbsp;
A general model for IP Flow Aggregation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-distro">4.2.</a>&nbsp;
Aggregating and Distributing Counters<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-flowcount">4.3.</a>&nbsp;
Counting Original Flows<br />
<a href="#sec-arch">5.</a>&nbsp;
Aggregation in the IPFIX Architecture<br />
<a href="#anchor5">6.</a>&nbsp;
Export of Aggregated IP Flows using IPFIX<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-flowcount">6.1.</a>&nbsp;
Flow Count Export<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-noncon-flowcount">6.1.1.</a>&nbsp;
originalFlowsPresent Information Element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-con-flowstartcount">6.1.2.</a>&nbsp;
originalFlowsInitiated InformationElement<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-con-flowendcount">6.1.3.</a>&nbsp;
originalFlowsCompleted InformationElement<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ie-con-flowcount">6.1.4.</a>&nbsp;
originalFlows InformationElement<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-ex-distro">6.2.</a>&nbsp;
Aggregate Counter Distibution Export<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">6.3.</a>&nbsp;
Time Interval Export<br />
<a href="#anchor7">7.</a>&nbsp;
Examples<br />
<a href="#anchor8">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor9">9.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">10.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">10.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">10.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The aggregation of packet data into flows serves a variety of
        different purposes, as noted in <a class='info' href='#RFC3917'>[RFC3917]<span> (</span><span class='info'>Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;Requirements for IP Flow Information Export (IPFIX),&rdquo; October&nbsp;2004.</span><span>)</span></a> and <a class='info' href='#RFC5472'>[RFC5472]<span> (</span><span class='info'>Zseby, T., Boschi, E., Brownlee, N., and B. Claise, &ldquo;IP Flow Information Export (IPFIX) Applicability,&rdquo; March&nbsp;2009.</span><span>)</span></a>. Aggregation beyond the flow level, into records
        representing multiple flows, is a common analysis and data reduction
        technique as well. Often these aggregation operations result in a time
        series of keys and counters, which is useful for gaining insight into
        trends and anomalies. Aggregation may also has added benefits for
        privacy: when data about specific transactions and hosts are
        aggregated together, it has an anonymising effect on the data.
</p>
<p>Aggregation can be applied in parallel with storage of original
        packet and flow data. In certain situations, aggregation can be
        performed at mediator, with aggregated data can be used for initial
        analysis (e.g., to provide a reduced data stream for analysis at a
        central point, with original flow data stored in a
        higher-access-latency manner (e.g. tape storage at the mediator at a
        remote site). Other applications may benefit from a reverse
        application: online analysis of original flows, with long-term storage
        of aggregated data. Aggregation can also be used to provide a
        lower-volume, lower-privacy-risk source of data for reporting or data
        exchange across organizational boundaries.
</p>
<p>While IPFIX can be used to export <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> and
        store <a class='info' href='#RFC5655'>[RFC5655]<span> (</span><span class='info'>Trammell, B., Boschi, E., Mark, L., Zseby, T., and A. Wagner, &ldquo;Specification of the IP Flow Information Export (IPFIX) File Format,&rdquo; October&nbsp;2009.</span><span>)</span></a> aggregated data, there exists as yet no
        common terminology or aggregation metadata representation for this
        purpose, no set of requirements to define what is meant by
        aggregation, and no facility for counting original Flows from which
        Aggregated Flows are derived. This document seeks to remedy this
        situation, defining a common basis for the application of IPFIX to the
        handling of aggregated data, with applicability to large-scale network
        data processing, archiving, and inter-organization exchange.
</p>
<a name="sec-terminology"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>Terms used in this document that are defined in the Terminology
        section of the <a class='info' href='#RFC5101'>IPFIX Protocol<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a> [RFC5101] document
        are to be interpreted as defined there.
</p>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
        "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
        document are to be interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
</p>
<p>In addition, this document defines the following terms
</p>
<blockquote class="text"><dl>
<dt>Aggregated Flow: </dt>
<dd>A Flow, as defined by <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, derived from a set of zero or more original
            Flows within a defined time interval. The two primary differences
            between a Flow and an Aggregated Flow are (1) that the time
            interval of a Flow is generally derived from information about the
            timing of the packets comprising the Flow, while the time interval
            of an Aggregated Flow are generally externally imposed; and (2)
            that an Aggregated Flow may represent zero packets (i.e., an
            assertion that no packets were seen for a given Flow Key in a
            given time interval).
</dd>
<dt>(Intermediate) Aggregation Function: </dt>
<dd>A mapping from
            a set of zero or more original Flows into a set of aggregated
            Flow, that separates the original Flows into a set of one or more
            given time intervals.
</dd>
<dt>(Intermediate) Aggregation Process: </dt>
<dd>An Intermediate
            Process, as in <a class='info' href='#I-D.ietf-ipfix-mediators-framework'>[I&#8209;D.ietf&#8209;ipfix&#8209;mediators&#8209;framework]<span> (</span><span class='info'>Kobayashi, A., Claise, B., Muenz, G., and K. Ishibashi, &ldquo;IPFIX Mediation: Framework,&rdquo; April&nbsp;2010.</span><span>)</span></a>, hosting an
            Intermediate Aggregation Function.
</dd>
</dl></blockquote>
<p>[TODO: may want to define a more precise terminology for aggregated flow time interval, "contribution"/"presence" of an original Flow within an aggregated Flow...]
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Requirements for Aggregation Support in IPFIX</h3>

<p>In defining a terminology, additional information elements, and
    metadata export methods for Aggregated Flow export using IPFIX, we have
    sought to meet the following requirements.
</p>
<p>First, a specification of Aggregated Flow export must seek to be as
    interoperable as possible. Export of Aggregated Flows using the techniques
    described in this document will result in Flow data which can be collected
    by Collecting Processes and read by File Readers which do not provide any
    special support for Aggregated Flow export.
</p>
<p>Second, a specification of Aggregated Flow export must seek to be as
    implementation-independent as the IPFIX protocol itself. In <a class='info' href='#sec-arch'>Section&nbsp;5<span> (</span><span class='info'>Aggregation in the IPFIX Architecture</span><span>)</span></a>, we specify the flow aggregation process as an
    intermediate process within the <a class='info' href='#I-D.ietf-ipfix-mediators-framework'>IPFIX Mediator framework<span> (</span><span class='info'>Kobayashi, A., Claise, B., Muenz, G., and K. Ishibashi, &ldquo;IPFIX Mediation: Framework,&rdquo; April&nbsp;2010.</span><span>)</span></a> [I&#8209;D.ietf&#8209;ipfix&#8209;mediators&#8209;framework],
    and specify a variety of different architectural arrangements for flow
    aggregation; these are meant to be descriptive as opposed to proscriptive.
    In metadata export, we seek to define properties of the set of exported
    Aggregated Flows, as opposed to the properties of the specific algorithms
    used to aggregate these Flows. Specifically out of scope for this effort
    are any definition of a language for proscribing aggregation records, or
    the configuration parameters of Aggregation Processes.
</p>
<p>From the definition of presented in <a class='info' href='#sec-terminology'>Section&nbsp;2<span> (</span><span class='info'>Terminology</span><span>)</span></a>,
    an Aggregated Flow is a Flow as in <a class='info' href='#RFC5101'>[RFC5101]<span> (</span><span class='info'>Claise, B., &ldquo;Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information,&rdquo; January&nbsp;2008.</span><span>)</span></a>, with a
    restricted defintion as to the packets making up the Flow. Practically
    speaking, Aggregated Flows are derived from original Flows, as opposed to
    a raw packet stream. Key to this definition of Aggregated Flow is how
    timing affects the process of aggregation, as for the most part flow
    aggregation takes place within some set of (usually regular) time
    intervals. Any specification for Aggregated Flow export must account for
    the special role time intervals play in aggregation, and the many-to-many
    relationship between Aggregated Flows and original Flows which this
    implies.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Aggregation of IP Flows</h3>

<p>[TODO: frontmatter: restate definition: a flow is just a flow. Here
        we talk about Aggregation Process actions.]
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
A general model for IP Flow Aggregation</h3>

<p>[TODO: introduce as little of an Aggregation Process as
            necessary to be able to talk about things practically. Define
            in simple terms the role of externally imposed time intervals on
            aggregation. ]
</p>
<a name="sec-distro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Aggregating and Distributing Counters</h3>

<p>In general, counters in Aggregated Flows are treated the same
            as in any Flow: on a per-Information Element basis, the counters
            are calculated as if they were derived from the set of packets in
            the original flow. For the most part, when aggregating original
            Flows into Aggregated Flows, this is simply done by summation.
</p>
<p>However, this raises a complication when aggregating original
            Flows for which original packet data is not available: often, when
            imposing an external time interval on an original Flow, the
            original Flow will incompletely cover one or more time intervals,
            and apply to one or more Aggregated Flows; in this case, the
            Aggregation Process must distribute the counters in the original
            Flows across the multiple Aggregated Flows. There are several
            methods for doing this, listed here in increasing order of
            complexity and accuracy:
</p>
<blockquote class="text"><dl>
<dt>End Interval: </dt>
<dd>The counters for an original Flow
                are added to the counters of the appropriate Aggregated Flow
                containing the end time of the original Flow.
</dd>
<dt>Start Interval: </dt>
<dd>The counters for an original
                Flow are added to the counters of the appropriate Aggregated
                Flow containing the start time of the original Flow.
</dd>
<dt>Mid Interval: </dt>
<dd>The counters for an original Flow
                are added to the counters of a single appropriate Aggregated
                Flow containing some timestamp between start and end time of
                the original Flow.
</dd>
<dt>Simple Uniform Distribution: </dt>
<dd>Each counter for
                an original Flow is divided by the number of time intervals
                the original Flow covers (i.e., of appropriate Aggregated
                Flows sharing the same Flow Key), and this number is added to
                each corresponding counter in each Aggregated Flow.
</dd>
<dt>Proportional Uniform Distribution: </dt>
<dd>Each counter
                for an original Flow is divided by the number of time _units_
                the original Flow covers, to derive a mean count rate. This
                mean count rate is then multiplied by the number of time units
                in the intersection of the duration of the original Flow and
                the time interval of each Aggregated Flow. This is like simple
                uniform distribtion, but accounts for the fractional portions
                of a time interval covered by an original Flow in the first
                and last time interval.
</dd>
<dt>Simulated Process: </dt>
<dd>Each counter of the original
                Flow is distributed among the intervals of the Aggregated
                Flows according to some function the Aggregation Process uses
                based upon properties of Flows presumed to be like the
                original Flow. For example, bulk transfer flows might follow a
                more or less proportional uniform distribtion, while
                interactive processes are far more bursty.
</dd>
<dt>Direct: </dt>
<dd>The Aggregating Process has access to
                the original packet timings from the packets making up the
                original Flow, and uses these to distribute or recalculate the
                counters.
</dd>
</dl></blockquote>
<p>A method for exporting the distribution of counters across
            multiple Aggregated Flows is detailed in <a class='info' href='#sec-ex-distro'>Section&nbsp;6.2<span> (</span><span class='info'>Aggregate Counter Distibution Export</span><span>)</span></a>. In any case, counters MUST be
            distributed across the multiple Aggregated Flows in such a way
            that the total count is preserved; this property allows data to be
            aggregated and re-aggregated without any loss of original count
            information. To avoid confusion in interpretation of the
            aggregated data, all the counters for a set of given original
            Flows SHOULD be distributed via the same method.
</p>
<a name="sec-flowcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Counting Original Flows</h3>

<p>When aggregating multiple original Flows into an Aggregated
            Flow, it is often useful to know how many original Flows are
            present in the Aggregated Flow. This document introduces four new
            information elements in <a class='info' href='#sec-ex-flowcount'>Section&nbsp;6.1<span> (</span><span class='info'>Flow Count Export</span><span>)</span></a> to
            export these counters.
</p>
<p>There are two possible ways to count original Flows, which we
            call here conservative and non-conservative. Conservative flow
            counting has the property that each original Flow contributes
            exactly one to the total flow count within a set of aggregated
            Flows. In other words, conservative flow counters are distributed
            just as any other counter, except each original Flow is assumed to
            have a flow count of one. When a count for an original Flow must
            be distributed across a set of Aggregated Flows, and a
            distribution method is used which does not account for that
            original Flow completely within a single Aggregated Flow,
            conservative flow counting requires a fractional
            representation.
</p>
<p>By contrast, non-conservative flow counting is used to count
            how many flows are represented in an Aggregated Flow. Flow
            counters are not distributed in this case. An original Flow which
            is present within N Aggregated Flows would add N to the total
            non-conservative flow count, one to each Aggregated Flow.
</p>
<a name="sec-arch"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Aggregation in the IPFIX Architecture</h3>

<p>[TODO: describe these diagrams]
</p><br /><hr class="insert" />
<a name="loc-fig"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
+==========================================+
| Exporting Process                        |
+==========================================+
  |                                      |
  |             (Aggregated Flow Export) |
  V                                      |
+=============================+          |
| Mediator                    |          |
+=============================+          |
  |                                      |
  | (Aggregating Mediator)               |
  V                                      V
+==========================================+
| Collecting Process                       |
+==========================================+
        |
        | (Aggregation for Storage)
        V
+--------------------+
| IPFIX File Storage |
+--------------------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Potential Aggregation Locations&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="iap-dataflows"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
packets --+                     +- IPFIX Messages -+
          |                     |                  |
          V                     V                  V
+==================+ +====================+ +=============+
| Metering Process | | Collecting Process | | File Reader |
+==================+ +====================+ +=============+
          |            original | Flows            |
          V                     V                  V
+=========================================================+
|           Intermediate Aggregation Process (IAP)        |
+=========================================================+
          | Aggregated                  Aggregated |
          | Flows                            Flows |
          V                                        V
+===================+                       +=============+
| Exporting Process |                       | File Writer |
+===================+                       +=============+
          |                                        |
          +------------&gt; IPFIX Messages &lt;----------+
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Data flows through the aggregation process&nbsp;</b></font><br /></td></tr></table><hr class="insert" />
<br /><hr class="insert" />
<a name="iap-arrangements"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
         +----+  +-----+  +----+
 pkts -&gt; | MP |-&gt;| IAP |-&gt;| EP |-&gt; Export of Aggregated Flows
         +----+  +-----+  +----+
         +----+  +-----+  +----+
IPFIX -&gt; | CP |-&gt;| IAP |-&gt;| EP |-&gt; Aggregating Mediator
         +----+  +-----+  +----+
         +----+  +-----+  +----+
IPFIX -&gt; | CP |-&gt;| IAP |-&gt;| FW |-&gt; Aggregation for storage in IPFIX Files
         +----+  +-----+  +----+
         +----+  +-----+  +----+
IPFIX -&gt; | FR |-&gt;| IAP |-&gt;| FW |-&gt; Aggregation for analysis
 File    +----+  +-----+  +----+   (aggregating File manipulator)
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Possible aggregation arrangements in the IPFIX architecture&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Export of Aggregated IP Flows using IPFIX</h3>

<p>[TODO: frontmatter: here we talk about export specifics.]
</p>
<a name="sec-ex-flowcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Flow Count Export</h3>

<p>[TODO: describe these four IEs. for now, see <a class='info' href='#sec-flowcount'>Section&nbsp;4.3<span> (</span><span class='info'>Counting Original Flows</span><span>)</span></a>]
</p>
<a name="ie-noncon-flowcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.1"></a><h3>6.1.1.&nbsp;
originalFlowsPresent Information Element</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>
                The non-conservative count of original Flows containing packets from which a this Aggregated Flow was aggregated.
</dd>
<dt>Abstract Data Type: </dt>
<dd>unsigned64
</dd>
<dt>ElementId: </dt>
<dd>TBD1
</dd>
<dt>Status: </dt>
<dd>Proposed
</dd>
</dl></blockquote>
<a name="ie-con-flowstartcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.2"></a><h3>6.1.2.&nbsp;
originalFlowsInitiated InformationElement</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>
                The conservative count of original Flows whose first packet is represented within this Aggregated Flow.
</dd>
<dt>Abstract Data Type: </dt>
<dd>unsigned64
</dd>
<dt>ElementId: </dt>
<dd>TBD2
</dd>
<dt>Status: </dt>
<dd>Proposed
</dd>
</dl></blockquote>
<a name="ie-con-flowendcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.3"></a><h3>6.1.3.&nbsp;
originalFlowsCompleted InformationElement</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>
                The conservative count of original Flows whose last packet is represented within this Aggregated Flow.
</dd>
<dt>Abstract Data Type: </dt>
<dd>unsigned64
</dd>
<dt>ElementId: </dt>
<dd>TBD3
</dd>
<dt>Status: </dt>
<dd>Proposed
</dd>
</dl></blockquote>
<a name="ie-con-flowcount"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1.4"></a><h3>6.1.4.&nbsp;
originalFlows InformationElement</h3>

<blockquote class="text"><dl>
<dt>Description: </dt>
<dd>
                The conservative count of original Flows represented within this Aggregated Flow; may be distributed via any of the methods described in <a class='info' href='#sec-distro'>Section&nbsp;4.2<span> (</span><span class='info'>Aggregating and Distributing Counters</span><span>)</span></a>
</dd>
<dt>Abstract Data Type: </dt>
<dd>float64
</dd>
<dt>ElementId: </dt>
<dd>TBD4
</dd>
<dt>Status: </dt>
<dd>Proposed
</dd>
</dl></blockquote>
<a name="sec-ex-distro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Aggregate Counter Distibution Export</h3>

<p>[TODO: options template and IE for representing the
            distribution methods in <a class='info' href='#sec-distro'>Section&nbsp;4.2<span> (</span><span class='info'>Aggregating and Distributing Counters</span><span>)</span></a>]
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Time Interval Export</h3>

<p>Since an Aggregated Flow is simply a Flow, the existing
            timestamp Information Elements in the IPFIX Information Model
            (e.g., flowStartMilliseconds, flowEndNanoseconds) are sufficient
            to specify the time interval for aggregation. Therefore, this
            document specifies no new aggregation-specific Information
            Elements for exporting time interval information.
</p>
<p>Each Aggregated Flow SHOULD contain both an interval start and
            interval end timestamp. If an exporter of Aggregated Flows omits
            the interval end timestamp from each Aggregated Flow, the time
            interval for Aggregated Flows within an Observation Domain and
            Transport Session MUST be regular and constant, and SHOULD be
            exported using the Options Record described in this section.
            However, note that this approach might lead to interoperability
            problems when exporting Aggregated Flows to non-aggregation-aware
            Collecting Processes and downstream analysis tasks; therefore, an
            Exporting Process capable of exporting only interval start
            timestamps MUST provide a configuration option to export interval
            end timestamps as well.
</p>
<p>[TODO: options template and IE for binding a time interval to a
            session.]
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Examples</h3>

<p>[TODO]
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>[TODO]
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>[TODO: add all IEs defined in Section 6.]
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5101">[RFC5101]</a></td>
<td class="author-text">Claise, B., &ldquo;<a href="http://tools.ietf.org/html/rfc5101">Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of IP Traffic Flow Information</a>,&rdquo; RFC&nbsp;5101, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5101.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5102">[RFC5102]</a></td>
<td class="author-text">Quittek, J., Bryant, S., Claise, B., Aitken, P., and J. Meyer, &ldquo;<a href="http://tools.ietf.org/html/rfc5102">Information Model for IP Flow Information Export</a>,&rdquo; RFC&nbsp;5102, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5102.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5610">[RFC5610]</a></td>
<td class="author-text">Boschi, E., Trammell, B., Mark, L., and T. Zseby, &ldquo;<a href="http://tools.ietf.org/html/rfc5610">Exporting Type Information for IP Flow Information Export (IPFIX) Information Elements</a>,&rdquo; RFC&nbsp;5610, July&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5610.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5655">[RFC5655]</a></td>
<td class="author-text">Trammell, B., Boschi, E., Mark, L., Zseby, T., and A. Wagner, &ldquo;<a href="http://tools.ietf.org/html/rfc5655">Specification of the IP Flow Information Export (IPFIX) File Format</a>,&rdquo; RFC&nbsp;5655, October&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5655.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3330">[RFC3330]</a></td>
<td class="author-text">IANA, &ldquo;<a href="http://tools.ietf.org/html/rfc3330">Special-Use IPv4 Addresses</a>,&rdquo; RFC&nbsp;3330, September&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3330.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>10.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC5103">[RFC5103]</a></td>
<td class="author-text">Trammell, B. and E. Boschi, &ldquo;<a href="http://tools.ietf.org/html/rfc5103">Bidirectional Flow Export Using IP Flow Information Export (IPFIX)</a>,&rdquo; RFC&nbsp;5103, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5103.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5472">[RFC5472]</a></td>
<td class="author-text">Zseby, T., Boschi, E., Brownlee, N., and B. Claise, &ldquo;<a href="http://tools.ietf.org/html/rfc5472">IP Flow Information Export (IPFIX) Applicability</a>,&rdquo; RFC&nbsp;5472, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5472.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5470">[RFC5470]</a></td>
<td class="author-text">Sadasivan, G., Brownlee, N., Claise, B., and J. Quittek, &ldquo;<a href="http://tools.ietf.org/html/rfc5470">Architecture for IP Flow Information Export</a>,&rdquo; RFC&nbsp;5470, March&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5470.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-mediators-framework">[I-D.ietf-ipfix-mediators-framework]</a></td>
<td class="author-text">Kobayashi, A., Claise, B., Muenz, G., and K. Ishibashi, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-mediators-framework-06.txt">IPFIX Mediation: Framework</a>,&rdquo; draft-ietf-ipfix-mediators-framework-06 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-mediators-framework-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-ipfix-mediators-problem-statement">[I-D.ietf-ipfix-mediators-problem-statement]</a></td>
<td class="author-text">Kobayashi, A., Claise, B., Nishida, H., Sommer, C., Dressler, F., and E. Stephan, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-mediators-problem-statement-09.txt">IPFIX Mediation: Problem Statement</a>,&rdquo; draft-ietf-ipfix-mediators-problem-statement-09 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-ipfix-mediators-problem-statement-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5153">[RFC5153]</a></td>
<td class="author-text">Boschi, E., Mark, L., Quittek, J., Stiemerling, M., and P. Aitken, &ldquo;<a href="http://tools.ietf.org/html/rfc5153">IP Flow Information Export (IPFIX) Implementation Guidelines</a>,&rdquo; RFC&nbsp;5153, April&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5153.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3917">[RFC3917]</a></td>
<td class="author-text">Quittek, J., Zseby, T., Claise, B., and S. Zander, &ldquo;<a href="http://tools.ietf.org/html/rfc3917">Requirements for IP Flow Information Export (IPFIX)</a>,&rdquo; RFC&nbsp;3917, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3917.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Brian Trammell</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Swiss Federal Institute of Technology Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gloriastrasse 35</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+41 44 632 70 13</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:trammell@tik.ee.ethz.ch">trammell@tik.ee.ethz.ch</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Elisa Boschi</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Swiss Federal Institute of Technology Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gloriastrasse 35</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8092 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:boschie@tik.ee.ethz.ch">boschie@tik.ee.ethz.ch</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Arno Wagner</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Consecom AG</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Bellariastrasse 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">8002 Zurich</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Switzerland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:arno@wagner.name">arno@wagner.name</a></td></tr>
</table>
</body></html>
