capcmd       =  [ ":" servername SP ] "CAP" SP subcmd

subcmd       =  lscmd / listcmd / reqcmd / ackcmd /
                              nakcmd / clearcmd / endcmd

capcmderr    =  ":" servername SP "410" SP nick SP badcmd
                              SP ":Invalid CAP subcommand"
                           ; badcmd is the unrecognized subcommand

caplist      =  [ ":" ] *( capmod ) capab
caplist      =/ ":" *( capmod ) capab 1*( SP *( capmod ) capab )

lscmd        =  "LS"
lscmd        =/ "LS" SP [ "*" SP ] caplist

listcmd      =  "LIST"
listcmd      =/ "LIST" SP ":"
listcmd      =/ "LIST" SP [ "*" SP ] caplist
reqcmd       =  "REQ" SP caplist

ackcmd       =  "ACK" SP [ "*" SP ] caplist

nakcmd       =  "NAK" SP ":" acklist
                           ; acklist is at least 100 characters of the
                           ; capability list from the REQ

clearcmd     =  "CLEAR"

endcmd       =  "END"
elem         =  ALPHA *( ALPHA / DIGIT / "-" )

netname      =  elem 1*( "." elem )

netDeleg     =  netname 1*( "/" elem )

standardized =  elem

capab        =  netDeleg / standardized

dismod       =  "-"
stickymod    =  "="
ackmod       =  "~"

capmod       =  dismod / stickymod / ackmod
capcmd       =  [ ":" servername SP ] "CAP" SP subcmd

subcmd       =  lscmd / listcmd / reqcmd / ackcmd /
                              nakcmd / clearcmd / endcmd

capcmderr    =  ":" servername SP "410" SP nick SP badcmd
                              SP ":Invalid CAP subcommand"
                           ; badcmd is the unrecognized subcommand

caplist      =  [ ":" ] *( capmod ) capab
caplist      =/ ":" *( capmod ) capab 1*( SP *( capmod ) capab )

lscmd        =  "LS"
lscmd        =/ "LS" SP [ "*" SP ] caplist

listcmd      =  "LIST"
listcmd      =/ "LIST" SP ":"
listcmd      =/ "LIST" SP [ "*" SP ] caplist

reqcmd       =  "REQ" SP caplist

ackcmd       =  "ACK" SP [ "*" SP ] caplist

nakcmd       =  "NAK" SP ":" acklist
                           ; acklist is at least 100 characters of the
                           ; capability list from the REQ

clearcmd     =  "CLEAR"

endcmd       =  "END"

elem         =  ALPHA *( ALPHA / DIGIT / "-" )

netname      =  elem 1*( "." elem )

netDeleg     =  netname 1*( "/" elem )

standardized =  elem

capab        =  netDeleg / standardized

dismod       =  "-"
stickymod    =  "="
ackmod       =  "~"

capmod       =  dismod / stickymod / ackmod
