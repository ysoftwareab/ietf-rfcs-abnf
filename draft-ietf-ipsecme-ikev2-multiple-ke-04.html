<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Multiple Key Exchanges in IKEv2</title>
<meta content="C. Tjhai" name="author">
<meta content="M. Tomlinson" name="author">
<meta content="G. Bartlett" name="author">
<meta content="S. Fluhrer" name="author">
<meta content="D. Van Geest" name="author">
<meta content="O. Garcia-Morchon" name="author">
<meta content="Valery Smyslov" name="author">
<meta content='
        This document describes how to extend the Internet Key Exchange Protocol
 Version 2 (IKEv2) to allow multiple key exchanges to take place 
        while computing a shared secret during a Security Association (SA) setup.
        The primary application of this feature in IKEv2 is the ability to perform one or more 
        post-quantum key exchanges in conjunction with the classical (Elliptic Curve) Diffie-Hellman key exchange,
        so that the resulting shared key is resistant against quantum computer attacks.
        Another possible application is the ability to combine several key exchanges 
        in situations when no single key exchange algorithm is trusted by both initiator and responder.
       
        This document updates RFC7296 by renaming a transform type 4 from "Diffie-Hellman Group (D-H)"
        to "Key Exchange Method (KE)" and renaming a field in the Key Exchange Payload from "Diffie-Hellman Group Num"
        to "Key Exchange Method". It also renames an IANA registry for this transform type 
        from "Transform Type 4 - Diffie-Hellman Group Transform IDs" to 
        "Transform Type 4 - Key Exchange Method Transform IDs". These changes generalize 
        key exchange algorithms that can be used in IKEv2.
       
    ' name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="draft-ietf-ipsecme-ikev2-multiple-ke-04" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.2
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.0.4
    six 1.16.0
-->
<link href="/tmp/draft-ietf-ipsecme-ikev2-multiple-ke-00-2hzsw98t.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Multiple Key Exchanges in IKEv2</td>
<td class="right">September 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Tjhai, et al.</td>
<td class="center">Expires 3 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Internet Engineering Task Force (IETF)</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-ipsecme-ikev2-multiple-ke-04</dd>
<dt class="label-updates">Updates:</dt>
<dd class="updates">
<a href="https://www.rfc-editor.org/rfc/rfc7296" class="eref">7296</a> (if approved)</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-09-30" class="published">30 September 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-03">3 April 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Tjhai</div>
<div class="org">Post-Quantum</div>
</div>
<div class="author">
      <div class="author-name">M. Tomlinson</div>
<div class="org">Post-Quantum</div>
</div>
<div class="author">
      <div class="author-name">G. Bartlett</div>
<div class="org">Quantum Secret</div>
</div>
<div class="author">
      <div class="author-name">S. Fluhrer</div>
<div class="org">Cisco Systems</div>
</div>
<div class="author">
      <div class="author-name">D. Van Geest</div>
<div class="org">ISARA Corporation</div>
</div>
<div class="author">
      <div class="author-name">O. Garcia-Morchon</div>
<div class="org">Philips</div>
</div>
<div class="author">
      <div class="author-name">V. Smyslov</div>
<div class="org">ELVIS-PLUS</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Multiple Key Exchanges in IKEv2</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1"> This document describes how to extend the Internet Key Exchange Protocol
 Version 2 (IKEv2) to allow multiple key exchanges to take place 
        while computing a shared secret during a Security Association (SA) setup.
        The primary application of this feature in IKEv2 is the ability to perform one or more 
        post-quantum key exchanges in conjunction with the classical (Elliptic Curve) Diffie-Hellman key exchange,
        so that the resulting shared key is resistant against quantum computer attacks.
        Another possible application is the ability to combine several key exchanges 
        in situations when no single key exchange algorithm is trusted by both initiator and responder.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
<p id="section-abstract-2"> This document updates RFC7296 by renaming a transform type 4 from "Diffie-Hellman Group (D-H)"
        to "Key Exchange Method (KE)" and renaming a field in the Key Exchange Payload from "Diffie-Hellman Group Num"
        to "Key Exchange Method". It also renames an IANA registry for this transform type 
        from "Transform Type 4 - Diffie-Hellman Group Transform IDs" to 
        "Transform Type 4 - Key Exchange Method Transform IDs". These changes generalize 
        key exchange algorithms that can be used in IKEv2.<a href="#section-abstract-2" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 3 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-problem-description" class="xref">Problem Description</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="xref">1.2</a>.  <a href="#name-proposed-extension" class="xref">Proposed Extension</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="xref">1.3</a>.  <a href="#name-changes" class="xref">Changes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.4">
                <p id="section-toc.1-1.1.2.4.1"><a href="#section-1.4" class="xref">1.4</a>.  <a href="#name-document-organization" class="xref">Document Organization</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-design-criteria" class="xref">Design Criteria</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-multiple-key-exchanges" class="xref">Multiple Key Exchanges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-design-overview" class="xref">Design Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-protocol-details" class="xref">Protocol Details</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.1">
                    <p id="section-toc.1-1.3.2.2.2.1.1"><a href="#section-3.2.1" class="xref">3.2.1</a>.  <a href="#name-ike_sa_init-round-negotiati" class="xref">IKE_SA_INIT Round: Negotiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.2">
                    <p id="section-toc.1-1.3.2.2.2.2.1"><a href="#section-3.2.2" class="xref">3.2.2</a>.  <a href="#name-ike_intermediate-round-addi" class="xref">IKE_INTERMEDIATE Round: Additional Key Exchanges</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.3">
                    <p id="section-toc.1-1.3.2.2.2.3.1"><a href="#section-3.2.3" class="xref">3.2.3</a>.  <a href="#name-ike_auth-exchange" class="xref">IKE_AUTH Exchange</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.4">
                    <p id="section-toc.1-1.3.2.2.2.4.1"><a href="#section-3.2.4" class="xref">3.2.4</a>.  <a href="#name-create_child_sa-exchange" class="xref">CREATE_CHILD_SA Exchange</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2.2.5">
                    <p id="section-toc.1-1.3.2.2.2.5.1"><a href="#section-3.2.5" class="xref">3.2.5</a>.  <a href="#name-interaction-with-childless-" class="xref">Interaction with Childless IKE SA</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="xref">Appendix A</a>.  <a href="#name-sample-multiple-key-exchang" class="xref">Sample Multiple Key Exchanges</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#appendix-A.1" class="xref">A.1</a>.  <a href="#name-no-additional-key-exchange-" class="xref">No Additional Key Exchange Used</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#appendix-A.2" class="xref">A.2</a>.  <a href="#name-additional-key-exchange-in-" class="xref">Additional Key Exchange in the CREATE_CHILD_SA Exchange only</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#appendix-A.3" class="xref">A.3</a>.  <a href="#name-not-matching-proposal-for-a" class="xref">Not Matching Proposal for Additional Key Exchanges</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#appendix-B" class="xref">Appendix B</a>.  <a href="#name-alternative-design" class="xref">Alternative Design</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#appendix-C" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<section id="section-1.1">
        <h3 id="name-problem-description">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-problem-description" class="section-name selfRef">Problem Description</a>
        </h3>
<p id="section-1.1-1">
 Internet Key Exchange Protocol (IKEv2) as specified in <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span> 
            uses the Diffie-Hellman (DH) or Elliptic Curve
 Diffie-Hellman (ECDH) algorithm to establish a shared secret
 between an initiator and a responder.  The security of the DH and
 ECDH algorithms relies on the difficulty to solve a discrete logarithm
 problem in multiplicative and elliptic curve groups respectively when
 the order of the group parameter is large enough.  While solving such
 a problem remains difficult with current computing power, it is
 believed that general purpose quantum computers will be able to solve
 this problem, implying that the security of IKEv2 is compromised.
 There are, however, a number of cryptosystems that are conjectured to
 be resistant against quantum computer attack.  This family of
 cryptosystems is known as post-quantum cryptography (PQC).  It is
 sometimes also referred to as quantum-safe cryptography (QSC) or
 quantum-resistant cryptography (QRC).<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-1.2">
        <h3 id="name-proposed-extension">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-proposed-extension" class="section-name selfRef">Proposed Extension</a>
        </h3>
<p id="section-1.2-1">
 This document describes a method to perform multiple successive key 
            exchanges in IKEv2. It allows integration of QSC in IKEv2, while
 maintaining backwards compatibility, to derive a set of IKE keys that
 is resistant to quantum computer attacks.  This extension allows the
 negotiation of one or more QSC algorithm to exchange data, in addition
 to the existing DH or ECDH key exchange data.  We believe that the
 feature of using more than one post-quantum algorithms is important as
 many of these algorithms are relatively new and there may be a need to
 hedge the security risk with multiple key exchange data from several
 distinct QSC algorithms.<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2">
 The secrets established from each key exchange are combined in a way
 such that should the post-quantum secrets not be present, the derived
 shared secret is equivalent to that of the standard IKEv2; on the
 other hand, a post-quantum shared secret is obtained if both classical
 and post-quantum key exchange data are present.  This extension also
 applies to key exchanges in IKE Security Associations (SAs) for
 Encapsulating Security Payload (ESP) <span>[<a href="#RFC4303" class="xref">RFC4303</a>]</span> or
 Authentication Header (AH) <span>[<a href="#RFC4302" class="xref">RFC4302</a>]</span>, i.e. Child SAs,
 in order to provide a stronger guarantee of forward security.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<p id="section-1.2-3">
 Some post-quantum key exchange payloads may have sizes larger than
 the standard maximum transmission unit (MTU) size, and therefore there could be issues with
 fragmentation at the IP layer.  IKE does allow transmission over TCP
 where fragmentation is not an issue <span>[<a href="#RFC8229" class="xref">RFC8229</a>]</span>;
 however, we believe that a UDP-based solution will be required
 too.  IKE does have a mechanism to handle fragmentation within
 UDP <span>[<a href="#RFC7383" class="xref">RFC7383</a>]</span>, however that is only applicable to
 messages exchanged after the IKE_SA_INIT exchange.  To use this mechanism,
 this specification relies on the IKE_INTERMEDIATE exchange as outlined in
 <span>[<a href="#I-D.ietf-ipsecme-ikev2-intermediate" class="xref">I-D.ietf-ipsecme-ikev2-intermediate</a>]</span>.  With this
 mechanism, we do an initial key exchange, using a smaller, possibly
 non-quantum resistant primitive, such as ECDH.  Then, before we do
 the IKE_AUTH exchange, we perform one or more IKE_INTERMEDIATE exchanges,
 each of which contains an additional key exchange.  As the IKE_INTERMEDIATE
 exchange is encrypted, the IKE fragmentation protocol <span>[<a href="#RFC7383" class="xref">RFC7383</a>]</span>
 can be used. The IKE SK_* values are updated after each exchange,
 and so the final IKE SA keys depend on all the key exchanges,
 hence they are secure if any of the key exchanges are secure.<a href="#section-1.2-3" class="pilcrow">¶</a></p>
<p id="section-1.2-4">
 Note that readers should consider the approach defined in this document as
 providing a long term solution in upgrading the IKEv2 protocol to
 support post-quantum algorithms.  A short term solution to make IKEv2
 key exchange quantum secure is to use post-quantum pre-shared keys as
 discussed in <span>[<a href="#RFC8784" class="xref">RFC8784</a>]</span>.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<p id="section-1.2-5"> Note also, that the proposed approach of performing multiple successive key exchanges
      in such a way that resulting session keys depend on all of them is not limited
      to achieving quantum resistance only. It can also be used when all 
      the performed key exchanges are classical (EC)DH ones, where for some reasons
      (e.g. policy requirements) it is essential to perform multiple of them.<a href="#section-1.2-5" class="pilcrow">¶</a></p>
<p id="section-1.2-6">This draft does not attempt to address key exchanges with KE payloads
        longer than 64k; the current IKE payload format does not allow that as
        a possibility.  At the current time, it appears likely that there
        are a number of key exchanges available that would not require such
        a requirement.  However, if such a requirement is needed,
        <span>[<a href="#I-D.tjhai-ikev2-beyond-64k-limit" class="xref">I-D.tjhai-ikev2-beyond-64k-limit</a>]</span> discusses approaches
        that should be taken to exchange huge payloads.<a href="#section-1.2-6" class="pilcrow">¶</a></p>
</section>
<section id="section-1.3">
        <h3 id="name-changes">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-changes" class="section-name selfRef">Changes</a>
        </h3>
<p id="section-1.3-1">RFC EDITOR PLEASE DELETE THIS SECTION.<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<p id="section-1.3-2"> Changes in this draft in each version iterations.<a href="#section-1.3-2" class="pilcrow">¶</a></p>
<p id="section-1.3-3">draft-ietf-ipsecme-ikev2-multiple-ke-04<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-4.1">Introduction and initial sections are reorganized.<a href="#section-1.3-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-4.2">More clarifications for error handling added.<a href="#section-1.3-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-4.3">ASCII arts displaying SA payload are added.<a href="#section-1.3-4.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-4.4">Clarification for handling multiple round trips key exchange methods added.<a href="#section-1.3-4.4" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-4.5">DoS concerns added into Security Considerations section.<a href="#section-1.3-4.5" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-4.6">Explicitly allow scenario when additional key exchanges are performed only after peers are authenticated.<a href="#section-1.3-4.6" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-5">draft-ietf-ipsecme-ikev2-multiple-ke-03<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-6.1">More clarifications added.<a href="#section-1.3-6.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-6.2">Figure illustrating initial exchange added.<a href="#section-1.3-6.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-6.3">Minor editorial changes.<a href="#section-1.3-6.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-7">draft-ietf-ipsecme-ikev2-multiple-ke-02<a href="#section-1.3-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-8.1">Added a reference on the handling of KE payloads larger than 64KB.<a href="#section-1.3-8.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-9">draft-ietf-ipsecme-ikev2-multiple-ke-01<a href="#section-1.3-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-10.1">References are updated.<a href="#section-1.3-10.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-11">draft-ietf-ipsecme-ikev2-multiple-ke-00<a href="#section-1.3-11" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-12.1">Draft name changed as result of WG adoption and generalization of the approach.<a href="#section-1.3-12.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-12.2">New exchange IKE_FOLLOWUP_KE is defined for additional key exchanges performed after CREATE_CHILD_SA.<a href="#section-1.3-12.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-12.3">Nonces are removed from all additional key exchanges.<a href="#section-1.3-12.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-12.4">Clarification that IKE_INTERMEDIATE must be negotiated is added.<a href="#section-1.3-12.4" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-13">draft-tjhai-ipsecme-hybrid-qske-ikev2-04<a href="#section-1.3-13" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-14.1">Clarification about key derivation in case of multiple key exchanges in CREATE_CHILD_SA is added.<a href="#section-1.3-14.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-14.2">Resolving rekey collisions in case of multiple key exchanges is clarified.<a href="#section-1.3-14.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-15">draft-tjhai-ipsecme-hybrid-qske-ikev2-03<a href="#section-1.3-15" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-16.1">Using multiple key exchanges CREATE_CHILD_SA is defined.<a href="#section-1.3-16.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-17">draft-tjhai-ipsecme-hybrid-qske-ikev2-02<a href="#section-1.3-17" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-18.1">Use new transform types to negotiate additional key exchanges,
         rather than using the KE payloads of IKE SA.<a href="#section-1.3-18.1" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-19">draft-tjhai-ipsecme-hybrid-qske-ikev2-01<a href="#section-1.3-19" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-20.1">Use IKE_INTERMEDIATE to perform multiple key exchanges in succession.<a href="#section-1.3-20.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-20.2">Handle fragmentation by keeping the first key exchange (a standard
      IKE_SA_INIT with a few extra notifies) small, and encrypting the rest
      of the key exchanges.<a href="#section-1.3-20.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-20.3">Simplify the negotiation of the 'extra' key exchanges.<a href="#section-1.3-20.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-1.3-21">draft-tjhai-ipsecme-hybrid-qske-ikev2-00<a href="#section-1.3-21" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-22.1">We added a feature to allow more than one post-quantum key
            exchange algorithms to be negotiated and used to exchange a post-
            quantum shared secret.<a href="#section-1.3-22.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-1.3-22.2">Instead of relying on TCP encapsulation to deal with IP level
     fragmentation, we introduced a new key exchange payload that can
     be sent as multiple fragments within IKE_SA_INIT message.<a href="#section-1.3-22.2" class="pilcrow">¶</a>
</li>
        </ul>
</section>
<section id="section-1.4">
        <h3 id="name-document-organization">
<a href="#section-1.4" class="section-number selfRef">1.4. </a><a href="#name-document-organization" class="section-name selfRef">Document Organization</a>
        </h3>
<p id="section-1.4-1">
            The remainder of this document is organized as follows.  <a href="#design" class="xref">Section 2</a>
            summarizes design criteria.  <a href="#framework" class="xref">Section 3</a> describes how
         multiple key exchanges are performed between two IKE peers and how
         keying materials are derived for both SAs and Child SAs.  A summary of alternative
         approaches that have been considered, but later discarded, are described
         in <a href="#altdesign" class="xref">Appendix B</a>.  <a href="#IANA" class="xref">Section 4</a>
            discusses IANA considerations for the namespaces introduced in this
         document, and lastly <a href="#security" class="xref">Section 5</a> discusses security considerations.<a href="#section-1.4-1" class="pilcrow">¶</a></p>
<p id="section-1.4-2"> The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", 
            "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted 
            as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, 
            they appear in all capitals, as shown here.<a href="#section-1.4-2" class="pilcrow">¶</a></p>
</section>
</section>
<div id="design">
<section id="section-2">
      <h2 id="name-design-criteria">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-design-criteria" class="section-name selfRef">Design Criteria</a>
      </h2>
<p id="section-2-1">
        The design of the proposed extension is driven by the
        following criteria:<a href="#section-2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-2">
        <dt id="section-2-2.1">1)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.2">
     Need for post-quantum cryptography in IPsec.  Quantum computers
     might become feasible in the near future.  If current
        Internet communications are monitored and recorded today (D),
        the communications could be decrypted as soon as a quantum-
        computer is available (e.g., year Q) if key negotiation only
        relies on non post-quantum primitives.  This is a high threat
        for any information that must remain confidential for a long
        period of time T &gt; Q-D.  The need is obvious if we assume that Q
        is 2040, D is 2020, and T is 30 years.  Such a value of T is
        typical in classified or healthcare data.<a href="#section-2-2.2" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.3">2)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.4">
     Hybrid.  Currently, there does not exist a post-quantum key
     exchange that is trusted at the level that ECDH is trusted
        against conventional (non-quantum) adversaries.  A hybrid
        post-quantum algorithm to be introduced
        next to well-established primitives, since the overall security
        is at least as strong as each individual primitive.<a href="#section-2-2.4" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.5">3)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.6">
     Focus on quantum-resistant confidentiality.  A passive attacker
     can eavesdrop on IPsec communication today and decrypt it once a
        quantum computer is available in the future.  This is a very
        serious attack for which we do not have a solution.  An attacker
        can only perform active attacks such as impersonation of the
        communicating peers once a quantum computer is available,
        sometime in the future.  Thus, our design focuses on quantum-resistant
        confidentiality due to the urgency of this problem.
        This document does not address quantum-resistant authentication
        since it is less urgent at this stage.<a href="#section-2-2.6" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.7">4)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.8">
     Limit amount of exchanged data.  The protocol design should be
     such that the amount of exchanged data, such as public-keys, is
        kept as small as possible even if initiator and responder need
        to agree on a hybrid group or multiple public-keys need to be
        exchanged.<a href="#section-2-2.8" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.9">5)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.10">
     Future proof.  Any cryptographic algorithm could be potentially
     broken in the future by currently unknown or impractical
        attacks: quantum computers are merely the most concrete example
        of this.  The design does not categorize algorithms as "post-quantum"
     or "non post-quantum" nor does it create assumptions
        about the properties of the algorithms, meaning that if
        algorithms with different properties become necessary in the future,
        this extension can be used unchanged to facilitate migration to
        those algorithms.<a href="#section-2-2.10" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.11">6)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.12">
     Limited amount of changes.  A key goal is to limit the number of
     changes required when enabling a post-quantum handshake.  This
        ensures easier and quicker adoption in existing implementations.<a href="#section-2-2.12" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.13">7)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.14">
     Localized changes.  Another key requirement is that changes to
     the protocol are limited in scope, in particular, limiting
        changes in the exchanged messages and in the state machine, so
        that they can be easily implemented.<a href="#section-2-2.14" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.15">8)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.16">
     Deterministic operation.  This requirement means that the hybrid
     post-quantum exchange, and thus, the computed keys, will be based
        on algorithms that both client and server wish to support.<a href="#section-2-2.16" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.17">9)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.18">
     Fragmentation support.  Some PQC algorithms could be relatively
     bulky and they might require fragmentation.  Thus, a design goal
        is the adaptation and adoption of an existing fragmentation
        method or the design of a new method that allows for the
        fragmentation of the key shares.<a href="#section-2-2.18" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.19">10)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.20">
     Backwards compatibility and interoperability.  This is a
     fundamental requirement to ensure that hybrid post-quantum IKEv2
        and non-post-quantum IKEv2 implementations are interoperable.<a href="#section-2-2.20" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.21">11)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.22">
     Federal Information Processing Standards (FIPS) compliance.  IPsec is widely used in Federal Information
     Systems and FIPS certification is an important requirement.
        However, algorithms that are believed to be post-quantum are not
        FIPS compliant yet.  Still, the goal is that the overall hybrid
        post-quantum IKEv2 design can be FIPS compliant.<a href="#section-2-2.22" class="pilcrow">¶</a>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.23">12)</dt>
        <dd style="margin-left: 2.5em" id="section-2-2.24">
        Ability to use this method with multiple classical (EC)DH key exchanges.
        In some situations peers have no single mutually trusted key exchange
        algorithm (e.g., due to local policy restrictions).
        The ability to combine two (or more) key exchange methods
        in such a way that the resulting shared key depends on all of them
        allows peers to communicate in this situation.<a href="#section-2-2.24" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="framework">
<section id="section-3">
      <h2 id="name-multiple-key-exchanges">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-multiple-key-exchanges" class="section-name selfRef">Multiple Key Exchanges</a>
      </h2>
<section id="section-3.1">
        <h3 id="name-design-overview">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-design-overview" class="section-name selfRef">Design Overview</a>
        </h3>
<p id="section-3.1-1"> Most post-quantum key agreement algorithms are relatively new, and
            thus are not fully trusted.  There are also many proposed algorithms,
            with different trade-offs and relying on different hard problems.  The
            concern is that some of these hard problems may turn out to be easier
            to solve than anticipated and thus the key agreement algorithm may not be
            as secure as expected.  A hybrid solution, when multiple key exchanges are performed
            and the calculated shared key depends on all of them, allows us to deal with this
            uncertainty by combining a classical key exchange with a post-quantum
            one, as well as leaving open the possibility of multiple post-quantum
            key exchanges.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2"> In order to be able to use IKE fragmentation <span>[<a href="#RFC7383" class="xref">RFC7383</a>]</span> for those key exchanges
            that may have long public keys, the proposed framework utilizes the IKE_INTERMEDIATE exchange 
            defined in <span>[<a href="#I-D.ietf-ipsecme-ikev2-intermediate" class="xref">I-D.ietf-ipsecme-ikev2-intermediate</a>]</span>.
            The initial IKE_INIT messages do not have any inherent fragmentation support within IKE; however that can include a
            relatively short KE payload.  The additional key exchanges are performed 
            using IKE_INTERMEDIATE messages; because these messages are encrypted, the standard IKE fragmentation 
            mechanism is available.<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1-3"> In order to minimize communication overhead, only the key shares that are agreed to be used
            are actually exchanged.  To negotiate additional key exchanges seven new Transform Types are defined.
            These transforms share allowed Transform IDs with Transform Type 4.<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1-4"> We assume that new Transform Type 4 identifiers will be assigned later to the
 various post-quantum key exchanges.  We specifically do not make a distinction between classical (DH and ECDH)
 and post-quantum key exchanges, nor post-quantum algorithms which are
 true key exchanges versus post-quantum algorithms that act as key
 transport mechanisms; all are treated equivalently by the
 protocol.  To be more specific, this document
            renames Transform Type 4 from "Diffie-Hellman Group (D-H)"
            to "Key Exchange Method (KE)" and renames a field in the Key Exchange Payload from "Diffie-Hellman Group Num"
            to "Key Exchange Method".  The corresponding IANA registry is also renamed
            from "Diffie-Hellman Group Transform IDs" to "Key Exchange Method Transform IDs".<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5"> The fact, that newly defined transforms share
            the same registry for possible Transform IDs with Transform Type 4, allows additional key exchanges
            to be of any type - either post-quantum or classical (EC)DH
            one.  This approach allows any combination of defined key exchange methods
            to take place.  This also allows performing a single post-quantum 
            key exchange in the IKE_SA_INIT without additional key exchanges, 
            provided that IP fragmentation is not an issue and that hybrid key exchange is not needed.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6"> The SA payload in the IKE_SA_INIT message 
            includes one or more newly defined transforms which represent the extra key exchange policy required by the
            initiator. The responder follows the usual IKEv2 negotiation rules: it selects a single transform of each type, and
            returns all of them in the IKE_SA_INIT response message.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">
            Then, provided that additional key exchanges are negotiated, the initiator and the responder 
            perform one or more IKE_INTERMEDIATE exchanges. Then the IKE_AUTH exchange authenticates peers
            and completes IKE SA establishment.<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.1-8">
<pre>
Initiator                             Responder
---------------------------------------------------------------------
&lt;-- IKE_SA_INIT (additional key exchanges negotiation) --&gt;

&lt;-- {IKE_INTERMEDIATE (additional key exchange)} --&gt;

                         ...

&lt;-- {IKE_INTERMEDIATE (additional key exchange)} --&gt;

&lt;-- {IKE_AUTH} --&gt;
</pre><a href="#section-3.1-8" class="pilcrow">¶</a>
</div>
<p id="section-3.1-9"> Note, that this document assumes, that each key exchange method requires one round trip and consumes exactly one IKE_INTERMEDIATE exchange.
            This assumption is valid for all classic key exchange methods defined so far and for all post-quantum methods currently known.
            For hypothetical future key exchange methods requiring multiple round trips to complete, a separate document should define how such
            methods are splitted into several IKE_INTERMEDIATE exchanges.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-protocol-details">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-protocol-details" class="section-name selfRef">Protocol Details</a>
        </h3>
<p id="section-3.2-1"> In the simplest case, the initiator is happy with a single key exchange
     (and has no interest in supporting multiple), and it is not concerned
     with possible fragmentation of the IKE_SA_INIT messages (either because
     the key exchange it selects is small enough not to fragment, or the initiator is
     confident that fragmentation will be handled either by IP fragmentation,
     or transport via TCP).<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2"> In this case, the initiator performs the IKE_SA_INIT as usual,
     inserting a preferred key exchange (which is possibly a post-quantum
     algorithm) as the listed Transform Type 4, and including the initiator
     KE payload.  If the responder accepts the policy, it responds with an
     IKE_SA_INIT response, and IKE continues as usual.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3"> If the initiator desires to negotiate multiple key exchanges, then the initiator uses the protocol
     listed below.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<div id="negotiation">
<section id="section-3.2.1">
          <h4 id="name-ike_sa_init-round-negotiati">
<a href="#section-3.2.1" class="section-number selfRef">3.2.1. </a><a href="#name-ike_sa_init-round-negotiati" class="section-name selfRef">IKE_SA_INIT Round: Negotiation</a>
          </h4>
<p id="section-3.2.1-1"> Multiple key exchanges are negotiated using the standard IKEv2 mechanism, via SA payload.
                For this purpose seven new transform types, 
                namely Additional Key Exchange 1 (&lt;TBA by IANA&gt;), Additional Key Exchange 2 (&lt;TBA by IANA&gt;), 
                Additional Key Exchange 3 (&lt;TBA by IANA&gt;), Additional Key Exchange 4 (&lt;TBA by IANA&gt;), 
                Additional Key Exchange 5 (&lt;TBA by IANA&gt;), Additional Key Exchange 6 (&lt;TBA by IANA&gt;) and Additional Key Exchange 7 (&lt;TBA by IANA&gt;)
                are defined. They are collectively called Additional Key Exchange transforms in this document 
                and have slightly different semantics than existing IKEv2 transform types.
                They are interpreted as an indication of additional key exchanges methods that peers agreed to perform
                in a series of IKE_INTERMEDIATE exchanges following the IKE_SA_INIT exchange.  The allowed transform IDs for these transform types 
                are the same as IDs for the Transform Type 4, so they all share a single IANA registry for transform IDs.<a href="#section-3.2.1-1" class="pilcrow">¶</a></p>
<p id="section-3.2.1-2"> Key exchange method negotiated via Transform Type 4 always takes place
                in the IKE_SA_INIT exchange, as defined in <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>.  Additional key exchanges negotiated via newly
                defined transforms MUST take place in a series of IKE_INTERMEDIATE exchanges following the IKE_SA_INIT exchange, 
                performed in an order of the values of their transform types, so that key exchange negotiated using Transform Type n always precedes that of
                Transform Type n + 1. Each additional key exchange method MUST be fully completed before the next one is started.<a href="#section-3.2.1-2" class="pilcrow">¶</a></p>
<p id="section-3.2.1-3"> Note that with this semantics, Additional Key Exchanges transforms are not associated
                with any particular type of key exchange and do not have any specific per transform type transform IDs IANA registry. 
                Instead they all share a single registry for transform IDs - "Key Exchange Method Transform IDs", as well as Transform Type 4. 
                All new key exchange algorithms (both classical or post-quantum) should be added to this registry.
                This approach gives peers flexibility in defining the ways they want 
                to combine different key exchange methods.<a href="#section-3.2.1-3" class="pilcrow">¶</a></p>
<p id="section-3.2.1-4"> When forming a proposal the initiator adds transforms for the IKE_SA_INIT exchange
                using Transform Type 4.  In most cases they will contain classical key exchange methods (DH or ECDH), 
                however it is not a requirement.  Additional key exchange methods are proposed using Additional Key Exchanges 
                transform types.  All these transform types are optional, the initiator is free 
                to select any of them for proposing additional key exchange methods.  Consequently, 
                if none of Additional Key Exchange transforms are included in the proposal, then this proposal
                indicates performing standard IKEv2, as defined in <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>.
                If the initiator includes any Additional Key Exchanges transform in the proposal, 
                the responder MUST select one of the algorithms proposed using this type.  A transform ID NONE 
                MAY be added to those transform types which contain key exchange methods that the initiator believes are optional
                according to its local policy.<a href="#section-3.2.1-4" class="pilcrow">¶</a></p>
<p id="section-3.2.1-5"> The responder performs negotiation using standard IKEv2 procedure described in Section 3.3 of <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>.
                However, for the Additional Key Exchange types the responder's choice MUST NOT contain equal algorithms,
                except for transform ID of NONE. An algorithm is represented as a transform, in some cases the transform
                could include a set of associated attributes that define details of the algorithm. In this case two 
                ransforms can be the same, but the attributes must be different. Additionally, the order of the attributes
                does not affect the equality of the algorithm, so two transforms (ID=alg1,ATTR1=attr1,ATTR2=attr2) and
                (ID=alg1,ATTR2=attr2,ATTR1=attr1) define the same algorithm.<a href="#section-3.2.1-5" class="pilcrow">¶</a></p>
<p id="section-3.2.1-6"> If the responder selected NONE for some Additional Key Exchange types (provided they were proposed by the initiator), 
                then the corresponding IKE_INTERMEDIATE exchanges should not take place. The IKE_INTERMEDIATE exchanges
                MUST only be performed for Additional Key Exchange types containing non-NONE responders choices.
                It means that if the initiator includes NONE in all Additional Key Exchange transforms and the
                responder selects this value for all of them, then no IKE_INTERMEDIATE exchanges will take place between the peers.
                perform additional key exchanges will take place (note that they still may take place for other purposes).<a href="#section-3.2.1-6" class="pilcrow">¶</a></p>
<p id="section-3.2.1-7"> Below is an example of the SA payload in the initiator's IKE_SA_INIT request message.
                Here we use an abbreviation AKE1, AKE 2 etc. to denote Additional Key Exchange 1, 
                Additional Key Exchange 2 etc. transforms, that this document defines, 
                and an abbreviation KE for the Key Exchange transform,
                that this document renames from the Diffie-Hellman Group transform.
                We also use not yet defined Transform IDs PQ_KEM_1, PQ_KEM_2
                and PQ_KEM_3 to denote some of popular post-quantum key exchange methods.<a href="#section-3.2.1-7" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.1-8">
<pre>
SA Payload
   |
   +--- Proposal #1 ( Proto ID = IKE(1), SPI size = 8,
         |            9 transforms,      SPI = 0x35a1d6f22564f89d )
         |
         +-- Transform ENCR ( ID = ENCR_AES_GCM_16 )
         |     +-- Attribute ( Key Length = 256 )
         |
         +-- Transform KE ( ID = 4096-bit MODP Group )
         |
         +-- Transform PRF ( ID = PRF_HMAC_SHA2_256 )
         |
         +-- Transform AKE2 ( ID = PQ_KEM_1 )
         |
         +-- Transform AKE2 ( ID = PQ_KEM_2 )
         |
         +-- Transform AKE3 ( ID = PQ_KEM_1 )
         |
         +-- Transform AKE3 ( ID = PQ_KEM_2 )
         |
         +-- Transform AKE5 ( ID = PQ_KEM_3 )
         |
         +-- Transform AKE5 ( ID = NONE )
</pre><a href="#section-3.2.1-8" class="pilcrow">¶</a>
</div>
<p id="section-3.2.1-9"> In this example the initiator proposes to perform initial key exchange using 4096-bit MODP group
                following by two mandatory additional key exchanges using PQ_KEM_1 and PQ_KEM_2 methods in any order,
                following by additional key exchange using PQ_KEM_3 method that may be omitted.<a href="#section-3.2.1-9" class="pilcrow">¶</a></p>
<p id="section-3.2.1-10"> The responder might return the following SA payload, indicating that it agrees to 
                perform two additional key exchanges PQ_KEM_2 followed by PQ_KEM_1 and doesn't
                want to perform PQ_KEM_3 additionally.<a href="#section-3.2.1-10" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.1-11">
<pre>
SA Payload
   |
   +--- Proposal #1 ( Proto ID = IKE(1), SPI size = 8,
         |            6 transforms,      SPI = 0x8df52b331a196e7b )
         |
         +-- Transform ENCR ( ID = ENCR_AES_GCM_16 )
         |     +-- Attribute ( Key Length = 256 )
         |
         +-- Transform KE ( ID = 4096-bit MODP Group )
         |
         +-- Transform PRF ( ID = PRF_HMAC_SHA2_256 )
         |
         +-- Transform AKE2 ( ID = PQ_KEM_2 )
         |
         +-- Transform AKE3 ( ID = PQ_KEM_1 )
         |
         +-- Transform AKE5 ( ID = NONE )
</pre><a href="#section-3.2.1-11" class="pilcrow">¶</a>
</div>
<p id="section-3.2.1-12"> If the initiator includes any Additional Key Exchanges transform types into SA payload in the IKE_SA_INIT exchange request message,
                it MUST also negotiate using IKE_INTERMEDIATE exchange as described in <span>[<a href="#I-D.ietf-ipsecme-ikev2-intermediate" class="xref">I-D.ietf-ipsecme-ikev2-intermediate</a>]</span>,
                by including INTERMEDIATE_EXCHANGE_SUPPORTED notification in the same message.
                If the responder agrees to use additional key exchanges while establishing initial IKE SA, 
                it MUST also return this notification in the IKE_SA_INIT response message,
                thus confirming that IKE_INTERMEDIATE exchange is supported and will be used for transferring additional key exchange data.
                If the IKE_INTERMEDIATE exchange is not negotiated, then the peers MUST treat any Additional Key Exchange transforms
                in the IKE_SA_INIT exchange messages as unknown transform types and skip the proposals they appear in.
                If no other proposals are present in the SA payload, the peers will proceed as when no proposal is chosen
                (i.e. the responder will send NO_PROPOSAL_CHOSEN notification).<a href="#section-3.2.1-12" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.1-13">
<pre>
Initiator                          Responder
---------------------------------------------------------------------
HDR, SAi1(.. AKE*...), KEi1, Ni,
N(INTERMEDIATE_EXCHANGE_SUPPORTED)    ---&gt;
                                   HDR, SAr1(.. AKE*...), KEr1, Nr,
                                   [CERTREQ],
                           &lt;---    N(INTERMEDIATE_EXCHANGE_SUPPORTED)
</pre><a href="#section-3.2.1-13" class="pilcrow">¶</a>
</div>
</section>
</div>
<section id="section-3.2.2">
          <h4 id="name-ike_intermediate-round-addi">
<a href="#section-3.2.2" class="section-number selfRef">3.2.2. </a><a href="#name-ike_intermediate-round-addi" class="section-name selfRef">IKE_INTERMEDIATE Round: Additional Key Exchanges</a>
          </h4>
<p id="section-3.2.2-1"> For each additional key exchange agreed to in the IKE_SA_INIT exchange,
         the initiator and the responder perform IKE_INTERMEDIATE exchange, 
                as described in <span>[<a href="#I-D.ietf-ipsecme-ikev2-intermediate" class="xref">I-D.ietf-ipsecme-ikev2-intermediate</a>]</span>.<a href="#section-3.2.2-1" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.2-2">
<pre>
Initiator                          Responder
---------------------------------------------------------------------
HDR, SK {KEi(n)}    --&gt;
                            &lt;--    HDR, SK {KEr(n)}
</pre><a href="#section-3.2.2-2" class="pilcrow">¶</a>
</div>
<p id="section-3.2.2-3"> The initiator sends key exchange data in the KEi(n) payload. 
                This packet is protected with the current SK_ei/SK_ai keys.<a href="#section-3.2.2-3" class="pilcrow">¶</a></p>
<p id="section-3.2.2-4"> On receiving this, the responder sends back key exchange payload KEr(n); 
                again, this packet is protected with the current SK_er/SK_ar keys.<a href="#section-3.2.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2.2-5"> The former "Diffie-Hellman Group Num" (now called "Key Exchange Method") field in the KEi(n) and KEr(n) payloads MUST match the
                n-th negotiated additional key exchange.<a href="#section-3.2.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2.2-6"> Once this exchange is done, both sides compute an updated keying material:<a href="#section-3.2.2-6" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.2-7">
<pre>
SKEYSEED(n) = prf(SK_d(n-1), SK(n) | Ni | Nr)
</pre><a href="#section-3.2.2-7" class="pilcrow">¶</a>
</div>
<p id="section-3.2.2-8"> where SK(n) is the resulting shared secret of this key exchange,
                Ni and Nr are nonces from the IKE_SA_INIT exchange and SK_d(n-1) is the 
                last generated SK_d, (derived from the previous IKE_INTERMEDIATE exchange, 
                or the IKE_SA_INIT if there have not already been any IKE_INTERMEDIATE exchanges).
                Then, SK_d, SK_ai, SK_ar, SK_ei, SK_er, SK_pi, SK_pr are updated as:<a href="#section-3.2.2-8" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.2-9">
<pre>
{SK_d(n) | SK_ai(n) | SK_ar(n) | SK_ei(n) | SK_er(n) | SK_pi(n) |
 SK_pr(n)} = prf+ (SKEYSEED(n), Ni | Nr | SPIi | SPIr)
</pre><a href="#section-3.2.2-9" class="pilcrow">¶</a>
</div>
<p id="section-3.2.2-10"> Both the initiator and the responder use these updated key
         values in the next exchange (IKE_INTERMEDIATE or IKE_AUTH).<a href="#section-3.2.2-10" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2.3">
          <h4 id="name-ike_auth-exchange">
<a href="#section-3.2.3" class="section-number selfRef">3.2.3. </a><a href="#name-ike_auth-exchange" class="section-name selfRef">IKE_AUTH Exchange</a>
          </h4>
<p id="section-3.2.3-1"> After all IKE_INTERMEDIATE exchanges have completed, the initiator and
         the responder perform an IKE_AUTH exchange.  This exchange is
         the standard IKE exchange, except that the initiator and responder
         signed octets are modified as described in
         <span>[<a href="#I-D.ietf-ipsecme-ikev2-intermediate" class="xref">I-D.ietf-ipsecme-ikev2-intermediate</a>]</span>.<a href="#section-3.2.3-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2.4">
          <h4 id="name-create_child_sa-exchange">
<a href="#section-3.2.4" class="section-number selfRef">3.2.4. </a><a href="#name-create_child_sa-exchange" class="section-name selfRef">CREATE_CHILD_SA Exchange</a>
          </h4>
<p id="section-3.2.4-1"> The CREATE_CHILD_SA exchange is used in IKEv2 for the purposes 
                of creating additional Child SAs, rekeying them and rekeying IKE SA itself.
                When creating or rekeying Child SAs, the peers may optionally 
                perform a Diffie-Hellman key exchange to add a fresh entropy into the session keys. 
                In case of IKE SA rekey, the key exchange is mandatory.
                Peers supporting this specification may want to use multiple key exchanges
                in these situations.<a href="#section-3.2.4-1" class="pilcrow">¶</a></p>
<p id="section-3.2.4-2"> Using multiple key exchanges with CREATE_CHILD_SA exchange is negotiated 
                similarly as in initial exchange, see <a href="#negotiation" class="xref">Section 3.2.1</a>.
                If the initiator includes any Additional Key Exchanges transform in the SA payload
                (along with Transform Type 4) and the responder agrees to perform additional
                key exchanges, then the additional key exchanges are performed in a series 
                of new IKE_FOLLOWUP_KE exchanges that follows the CREATE_CHILD_SA exchange.
                The IKE_FOLLOWUP_KE exchange is introduced as a dedicated exchange for transferring data of additional key exchanges 
                following the key exchange performed in the CREATE_CHILD_SA. Its Exchange Type is &lt;TBA by IANA&gt;.<a href="#section-3.2.4-2" class="pilcrow">¶</a></p>
<p id="section-3.2.4-3"> Key exchange negotiated via Transform Type 4 always takes place in the CREATE_CHILD_SA exchange, as per IKEv2 specification. 
                Additional key exchanges are performed in an order of the values of their transform types, so that 
                key exchange negotiated using Transform Type n always precedes key exchange negotiated using
                Transform Type n + 1. Each additional key exchange method MUST be fully completed before the next one is started.
                Note, that this document assumes, that each key exchange method consumes exactly one IKE_FOLLOWUP_KE exchange.
                For the methods requiring multiple round trips, a separate document should define how such
                methods are splitted into several IKE_FOLLOWUP_KE exchanges.<a href="#section-3.2.4-3" class="pilcrow">¶</a></p>
<p id="section-3.2.4-4"> Since after IKE SA is created the window size may be greater than one and multiple
                concurrent exchanges may be in progress, it is essential to link the IKE_FOLLOWUP_KE exchanges together and 
                with the corresponding CREATE_CHILD_SA exchange.  A new status type notification ADDITIONAL_KEY_EXCHANGE
                is used for this purpose.  Its Notify Message Type is &lt;TBA by IANA&gt;, Protocol ID and SPI Size 
                are both set to 0.  The data associated with this notification is a blob meaningful 
                only to the responder, so that the responder can correctly link successive
                exchanges.  For the initiator the content of this notification is an opaque blob.<a href="#section-3.2.4-4" class="pilcrow">¶</a></p>
<p id="section-3.2.4-5"> The responder MUST include this notification in a CREATE_CHILD_SA or 
                IKE_FOLLOWUP_KE response message in case the next IKE_FOLLOWUP_KE exchange is expected, filling it with
                some data that would allow linking current exchange to the next one.  The initiator 
                MUST send back this notification intact in the request message of the next IKE_FOLLOWUP_KE exchange.<a href="#section-3.2.4-5" class="pilcrow">¶</a></p>
<p id="section-3.2.4-6"> Below is an example of CREATE_CHILD_SA exchange followed by three additional key exchanges.<a href="#section-3.2.4-6" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.4-7">
<pre>
Initiator                             Responder
---------------------------------------------------------------------
HDR(CREATE_CHILD_SA), SK {SA, Ni, KEi} --&gt;
                          &lt;--  HDR(CREATE_CHILD_SA), SK {SA, Nr, KEr,
                                   N(ADDITIONAL_KEY_EXCHANGE)(link1)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(1),
 N(ADDITIONAL_KEY_EXCHANGE)(link1)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(1),
                                   N(ADDITIONAL_KEY_EXCHANGE)(link2)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(2),
 N(ADDITIONAL_KEY_EXCHANGE)(link2)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(2),
                                   N(ADDITIONAL_KEY_EXCHANGE)(link3)}

HDR(IKE_FOLLOWUP_KE), SK {KEi(3),
 N(ADDITIONAL_KEY_EXCHANGE)(link3)} --&gt;
                               &lt;--  HDR(IKE_FOLLOWUP_KE), SK {KEr(3)}
</pre><a href="#section-3.2.4-7" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4-8"> The former "Diffie-Hellman Group Num" (now called "Key Exchange Method") field in the KEi(n) and KEr(n) payloads MUST match the
                n-th negotiated additional key exchange.<a href="#section-3.2.4-8" class="pilcrow">¶</a></p>
<p id="section-3.2.4-9"> It is possible that due to some unexpected events (e.g. reboot)
                the initiator may lose its state and forget that it is in the process of performing
                additional key exchanges and thus never start the remaining IKE_FOLLOWUP_KE exchanges.
                The responder MUST handle this situation gracefully and delete
                the associated state if it does not receive the next expected 
                IKE_FOLLOWUP_KE request after some reasonable period of time.<a href="#section-3.2.4-9" class="pilcrow">¶</a></p>
<p id="section-3.2.4-10"> If responder receives IKE_FOLLOWUP_KE request containing ADDITIONAL_KEY_EXCHANGE
                notification and the content of this notify does not correspond to any active key exchange
                state the responder has, it MUST send back a new error type notification
                STATE_NOT_FOUND.  This is a non-fatal error notification, its Notify Message Type is &lt;TBA by IANA&gt;, 
                Protocol ID and SPI Size are both set to 0 and the data is empty.  If the initiator receives
                this notification in response to IKE_FOLLOWUP_KE exchange performing additional
                key exchange, it MUST cancel this exchange and MUST treat the whole series 
                of exchanges started from the CREATE_CHILD_SA exchange as failed.
                In most cases, the receipt of this notification is caused by premature deletion
                of the corresponding state on the responder (the time period between
                IKE_FOLLOWUP_KE exchanges appeared too long from the responder's point of view, e.g. due
                to a temporary network failure).  After receiving this notification the initiator MAY 
                start a new CREATE_CHILD_SA exchange (eventually followed by the IKE_FOLLOWUP_KE exchanges)
                to retry the failed attempt.  If the initiator continues to receive
                STATE_NOT_FOUND notifications after several retries, it MUST treat this situation 
                as a fatal error and delete IKE SA by sending a DELETE payload.<a href="#section-3.2.4-10" class="pilcrow">¶</a></p>
<p id="section-3.2.4-11"> When rekeying IKE SA or Child SA, it is possible that the peers start doing this
                at the same time, which is called simultaneous rekeying.  Sections 2.8.1 and 2.8.2 of 
                <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span> describe how IKEv2 handles this situation.  In a nutshell
                IKEv2 follows the rule that if in case of simultaneous rekeying two identical new
                IKE SAs (or two pairs of Child SAs) are created, then one of them should be deleted. 
                Which one is to be deleted is determined by comparing the values of four nonces, 
                that were used in the colliding CREATE_CHILD_SA exchanges - the IKE SA (or pair of Child SAs) 
                that was created by the exchange in which the smallest nonce was used should be deleted by 
                the initiator of this exchange.<a href="#section-3.2.4-11" class="pilcrow">¶</a></p>
<p id="section-3.2.4-12"> With multiple key exchanges the SAs are not yet created when the CREATE_CHILD_SA is completed,
                they would be created only after the series of IKE_FOLLOWUP_KE exchanges is finished.
                For this reason if additional key exchanges were negotiated in the CREATE_CHILD_SA initiated by the losing side, 
                there is nothing to delete and this side just stops the rekeying process - this side MUST NOT initiate 
                IKE_FOLLOWUP_KE exchange with next key exchange.<a href="#section-3.2.4-12" class="pilcrow">¶</a></p>
<p id="section-3.2.4-13"> In most cases, rekey collisions are resolved in the CREATE_CHILD_SA exchange.
                However, a situation may occur when due to packet loss, one of the peers receives the CREATE_CHILD_SA message
                requesting rekey of SA  that is already being rekeyed by this peer (i.e. the CREATE_CHILD_SA
                exchange initiated by this peer has been already completed and the series of IKE_FOLLOWUP_KE exchanges is in progress).
                In this case, TEMPORARY_FAILURE notification MUST be sent in response to such a request.<a href="#section-3.2.4-13" class="pilcrow">¶</a></p>
<p id="section-3.2.4-14"> If multiple key exchanges were negotiated in the CREATE_CHILD_SA exchange, then the resulting keys are 
                computed as follows. In case of IKE SA rekey:<a href="#section-3.2.4-14" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.4-15">
<pre>
SKEYSEED = prf(SK_d, SK(0) | Ni | Nr | SK(1) | ... SK(n))
</pre><a href="#section-3.2.4-15" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4-16"> In case of Child SA creation or rekey:<a href="#section-3.2.4-16" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="section-3.2.4-17">
<pre>
KEYMAT = prf+ (SK_d, SK(0) | Ni | Nr | SK(1) |  ... SK(n))
</pre><a href="#section-3.2.4-17" class="pilcrow">¶</a>
</div>
<p id="section-3.2.4-18"> In both cases SK_d is from existing IKE SA; SK(0), Ni, Nr are the shared key and nonces
                from the CREATE_CHILD_SA respectively; SK(1)...SK(n) are the shared keys from additional key exchanges.<a href="#section-3.2.4-18" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2.5">
          <h4 id="name-interaction-with-childless-">
<a href="#section-3.2.5" class="section-number selfRef">3.2.5. </a><a href="#name-interaction-with-childless-" class="section-name selfRef">Interaction with Childless IKE SA</a>
          </h4>
<p id="section-3.2.5-1">It is also possible to establish a fully quantum-resistant IKE SAs from additional key exchanges
            without using IKE_INTERMEDIATE exchanges.  In this case, the IKE SA created from IKE_SA_INIT exchange
            can be immediately rekeyed with CREATE_CHILD_SA using additional key exchanges and IKE_FOLLOWUP_KE
            message to carry the key exchange payload.  If only classical key exchange method is used in
            the IKE_SA_INIT message, the very first Child SA created in IKE_AUTH will not be quantum resistant.
            Consequently, if the peers' local policy requires that all Child SAs should be fully-protected, then
            the peers can avoid creating the very first Child SA by adopting <span>[<a href="#RFC6023" class="xref">RFC6023</a>]</span>.  In this
            case, the peers exchange CHILDLESS_IKEV2_SUPPORTED notification in the IKE_SA_INIT exchange and a
            fully-protected Child SA can be created with CREATE_CHILD_SA using additional key exchanges.<a href="#section-3.2.5-1" class="pilcrow">¶</a></p>
<p id="section-3.2.5-2">Note that if the initial IKE SA is used to transfer sensitive information, then this information
            will not be protected using the additional (e.g. quantum safe) key exchanges, so this scenario
            may be inappropriate.  One such example is in G-IKEv2 protocol <span>[<a href="#I-D.ietf-ipsecme-g-ikev2" class="xref">I-D.ietf-ipsecme-g-ikev2</a>]</span>
            where cryptographic materials are exchanged in IKE_SA_INIT messages between group member and the group
            controller.<a href="#section-3.2.5-2" class="pilcrow">¶</a></p>
</section>
</section>
</section>
</div>
<div id="IANA">
<section id="section-4">
      <h2 id="name-iana-considerations">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-4-1">This document adds new exchange type into the "IKEv2 Exchange Types" registry:<a href="#section-4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-2">
<pre>
&lt;TBA&gt;       IKE_FOLLOWUP_KE
</pre><a href="#section-4-2" class="pilcrow">¶</a>
</div>
<p id="section-4-3">This document renames Transform Type 4 defined in "Transform Type Values" registry
        from "Diffie-Hellman Group (D-H)" to "Key Exchange Method (KE)".<a href="#section-4-3" class="pilcrow">¶</a></p>
<p id="section-4-4">This document renames IKEv2 registry "Transform Type 4 - Diffie-Hellman Group Transform IDs" to 
        "Transform Type 4 - Key Exchange Method Transform IDs".<a href="#section-4-4" class="pilcrow">¶</a></p>
<p id="section-4-5">This document adds the following Transform Types to the "Transform Type Values" registry:<a href="#section-4-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-6">
<pre>
Type     Description                   Used In
-----------------------------------------------------------------
&lt;TBA&gt;    Additional Key Exchange 1     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 2     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 3     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 4     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 5     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 6     (optional in IKE, AH, ESP)
&lt;TBA&gt;    Additional Key Exchange 7     (optional in IKE, AH, ESP)
</pre><a href="#section-4-6" class="pilcrow">¶</a>
</div>
<p id="section-4-7">This document defines a new Notify Message Type in the "Notify Message Types - Status Types" registry:<a href="#section-4-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-8">
<pre>
&lt;TBA&gt;       ADDITIONAL_KEY_EXCHANGE
</pre><a href="#section-4-8" class="pilcrow">¶</a>
</div>
<p id="section-4-9">and a new Notify Message Type in the "Notify Message Types - Error Types" registry:<a href="#section-4-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-4-10">
<pre>
&lt;TBA&gt;       STATE_NOT_FOUND
</pre><a href="#section-4-10" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="security">
<section id="section-5">
      <h2 id="name-security-considerations">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-5-1">
     The key length of the Encryption Algorithm (Transform Type 1), the
     Pseudorandom Function (Transform Type 2) and the Integrity Algorithm
     (Transform Type 3), all have to be of sufficient length to prevent
     attacks using Grover's algorithm <span>[<a href="#GROVER" class="xref">GROVER</a>]</span>.  In order to use the
     extension proposed in this document, the key lengths of these
     transforms MUST be at least 256 bits long in order to provide
     sufficient resistance to  quantum attacks.  Accordingly the
     post-quantum security level achieved is at least 128 bits.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">SKEYSEED is calculated from shared SK(x) using an algorithm defined
     in Transform Type 2.  While a quantum attacker may learn the value
     of SK(x), if this value is obtained by means of a classical key exchange,
     other SK(x) values generated by means of a quantum-resistant algorithm
     ensure that the final SKEYSEED is not compromised.  This assumes that
     the algorithm defined in the Transform Type 2 is post-quantum.<a href="#section-5-2" class="pilcrow">¶</a></p>
<p id="section-5-3"> The main focus of this document is to prevent a passive attacker
        performing a "harvest and decrypt" attack.  In other words, an attacker
        that records messages exchanged today and proceeds to decrypt them once
        he owns a quantum computer.  This attack is prevented due to the hybrid
        nature of the key exchange.  Other attacks involving an active attacker
        using a quantum-computer are not completely solved by this
        document.  This is for two reasons.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4"> The first reason is because the authentication step remains
        classical.  In particular, the authenticity of the SAs established
        under IKEv2 is protected using a pre-shared key, RSA, DSA, or ECDSA
        algorithms.  Whilst the pre-shared key option, provided the key is
        long enough, is post-quantum, the other algorithms are not.   Moreover,
        in implementations where scalability is a requirement, the pre-shared
        key method may not be suitable.  Quantum-safe authenticity may be
        provided by using a quantum-safe digital signature and several
        quantum-safe digital signature methods are being explored by
        IETF.  For example, if the implementation is able to reliably
        track state, the hash based method, XMSS has the status of an RFC,
        see <span>[<a href="#RFC8391" class="xref">RFC8391</a>]</span>.  Currently, quantum-safe authentication
        methods are not specified in this document, but are planned to be
        incorporated in due course.<a href="#section-5-4" class="pilcrow">¶</a></p>
<p id="section-5-5"> It should be noted that the purpose of post-quantum algorithms is
        to provide resistance to attacks mounted in the future.  The current
        threat is that encrypted sessions are subject to eavesdropping and
        archived with decryption by quantum computers taking place at some
        point in the future.  Until quantum computers become available there
        is no point in attacking the authenticity of a connection because
        there are no possibilities for exploitation.  These only occur at
        the time of the connection, for example by mounting a man-in-the-middle (MitM)
        attack.  Consequently there is not such a pressing need for
        quantum-safe authenticity.<a href="#section-5-5" class="pilcrow">¶</a></p>
<p id="section-5-6"> Performing multiple key exchanges while establishing IKEv2 SA 
        increases the responder's susceptibility to DoS attacks, because 
        of an increased amount of resources needed to spend before the initiator
        is authenticated. This is especially true for post-quantum
        key exchange methods, where many of them are more memory and/or CPU intensive than the classical counterparts.<a href="#section-5-6" class="pilcrow">¶</a></p>
<p id="section-5-7"> Responders may consider recommendations from <span>[<a href="#RFC8019" class="xref">RFC8019</a>]</span>
        to deal with increased DoS attack susceptibility. It is also possible that 
        the responder only agrees to create initial IKE SA without performing 
        additional key exchanges, provided the initiator includes such an option in its proposals. Then peers immediately rekey 
        initial IKE SA  with the CREATE_CHILD_SA exchange and additional key exchanges performed via the IKE_FOLLOWUP_KE exchanges.
        In this case at the point when resource-intensive operations are required,
        peers have already authenticated each other.
        However, in the context of hybrid post-quantum key exchange this scenario would leave
        initial IKE SA (and initial Child SA if it is created) unprotected
        against quantum computers. Nevertheless the rekeyed IKE SA (and Child
        SAs that will be created over it) will have full protection.
        This is similar to the scenario described in <span>[<a href="#RFC8784" class="xref">RFC8784</a>]</span>.
        Depending on peers' policy, this scenario may or may not be appropriate.<a href="#section-5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="acknowledgements">
<section id="section-6">
      <h2 id="name-acknowledgements">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-6-1"> The authors would like to thank Frederic Detienne and Olivier
        Pelerin for their comments and suggestions, including the idea to
        negotiate the post-quantum algorithms using the existing KE payload.
        The authors are also grateful to Tobias Heider and Tobias Guggemos for valuable comments.
        Thanks to Paul Wouters for reviewing the document.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-ipsecme-ikev2-intermediate">[I-D.ietf-ipsecme-ikev2-intermediate]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Intermediate Exchange in the IKEv2 Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ipsecme-ikev2-intermediate-07</span>, <time datetime="2021-08-03" class="refDate">3 August 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-ipsecme-ikev2-intermediate-07.txt">https://www.ietf.org/archive/id/draft-ietf-ipsecme-ikev2-intermediate-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7296">[RFC7296]</dt>
        <dd>
<span class="refAuthor">Kaufman, C.</span>, <span class="refAuthor">Hoffman, P.</span>, <span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Eronen, P.</span>, and <span class="refAuthor">T. Kivinen</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2)"</span>, <span class="seriesInfo">STD 79</span>, <span class="seriesInfo">RFC 7296</span>, <span class="seriesInfo">DOI 10.17487/RFC7296</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7296">https://www.rfc-editor.org/info/rfc7296</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="GROVER">[GROVER]</dt>
        <dd>
<span class="refAuthor">Grover, L.</span>, <span class="refTitle">"A Fast Quantum Mechanical Algorithm for Database Search"</span>, <span class="seriesInfo">Proc. of the Twenty-Eighth Annual ACM Symposium on the Theory of Computing (STOC 1996)</span>, <time datetime="1996" class="refDate">1996</time>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-ipsecme-g-ikev2">[I-D.ietf-ipsecme-g-ikev2]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span> and <span class="refAuthor">B. Weis</span>, <span class="refTitle">"Group Key Management using IKEv2"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-ipsecme-g-ikev2-03</span>, <time datetime="2021-07-11" class="refDate">11 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/internet-drafts/draft-ietf-ipsecme-g-ikev2-03.txt">https://www.ietf.org/internet-drafts/draft-ietf-ipsecme-g-ikev2-03.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.tjhai-ikev2-beyond-64k-limit">[I-D.tjhai-ikev2-beyond-64k-limit]</dt>
        <dd>
<span class="refAuthor">Tjhai, C.</span>, <span class="refAuthor">Heider, T.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Beyond 64KB Limit of IKEv2 Payloads"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-tjhai-ikev2-beyond-64k-limit-01</span>, <time datetime="2021-07-09" class="refDate">9 July 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-tjhai-ikev2-beyond-64k-limit-01.txt">https://www.ietf.org/archive/id/draft-tjhai-ikev2-beyond-64k-limit-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4302">[RFC4302]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span>, <span class="refTitle">"IP Authentication Header"</span>, <span class="seriesInfo">RFC 4302</span>, <span class="seriesInfo">DOI 10.17487/RFC4302</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4302">https://www.rfc-editor.org/info/rfc4302</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4303">[RFC4303]</dt>
        <dd>
<span class="refAuthor">Kent, S.</span>, <span class="refTitle">"IP Encapsulating Security Payload (ESP)"</span>, <span class="seriesInfo">RFC 4303</span>, <span class="seriesInfo">DOI 10.17487/RFC4303</span>, <time datetime="2005-12" class="refDate">December 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4303">https://www.rfc-editor.org/info/rfc4303</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6023">[RFC6023]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span>, <span class="refAuthor">Tschofenig, H.</span>, <span class="refAuthor">Deng, H.</span>, and <span class="refAuthor">R. Singh</span>, <span class="refTitle">"A Childless Initiation of the Internet Key Exchange Version 2 (IKEv2) Security Association (SA)"</span>, <span class="seriesInfo">RFC 6023</span>, <span class="seriesInfo">DOI 10.17487/RFC6023</span>, <time datetime="2010-10" class="refDate">October 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6023">https://www.rfc-editor.org/info/rfc6023</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7383">[RFC7383]</dt>
        <dd>
<span class="refAuthor">Smyslov, V.</span>, <span class="refTitle">"Internet Key Exchange Protocol Version 2 (IKEv2) Message Fragmentation"</span>, <span class="seriesInfo">RFC 7383</span>, <span class="seriesInfo">DOI 10.17487/RFC7383</span>, <time datetime="2014-11" class="refDate">November 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7383">https://www.rfc-editor.org/info/rfc7383</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8019">[RFC8019]</dt>
        <dd>
<span class="refAuthor">Nir, Y.</span> and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Protecting Internet Key Exchange Protocol Version 2 (IKEv2) Implementations from Distributed Denial-of-Service Attacks"</span>, <span class="seriesInfo">RFC 8019</span>, <span class="seriesInfo">DOI 10.17487/RFC8019</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8019">https://www.rfc-editor.org/info/rfc8019</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8229">[RFC8229]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Touati, S.</span>, and <span class="refAuthor">R. Mantha</span>, <span class="refTitle">"TCP Encapsulation of IKE and IPsec Packets"</span>, <span class="seriesInfo">RFC 8229</span>, <span class="seriesInfo">DOI 10.17487/RFC8229</span>, <time datetime="2017-08" class="refDate">August 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8229">https://www.rfc-editor.org/info/rfc8229</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8391">[RFC8391]</dt>
        <dd>
<span class="refAuthor">Huelsing, A.</span>, <span class="refAuthor">Butin, D.</span>, <span class="refAuthor">Gazdag, S.</span>, <span class="refAuthor">Rijneveld, J.</span>, and <span class="refAuthor">A. Mohaisen</span>, <span class="refTitle">"XMSS: eXtended Merkle Signature Scheme"</span>, <span class="seriesInfo">RFC 8391</span>, <span class="seriesInfo">DOI 10.17487/RFC8391</span>, <time datetime="2018-05" class="refDate">May 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8391">https://www.rfc-editor.org/info/rfc8391</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8784">[RFC8784]</dt>
      <dd>
<span class="refAuthor">Fluhrer, S.</span>, <span class="refAuthor">Kampanakis, P.</span>, <span class="refAuthor">McGrew, D.</span>, and <span class="refAuthor">V. Smyslov</span>, <span class="refTitle">"Mixing Preshared Keys in the Internet Key Exchange Protocol Version 2 (IKEv2) for Post-quantum Security"</span>, <span class="seriesInfo">RFC 8784</span>, <span class="seriesInfo">DOI 10.17487/RFC8784</span>, <time datetime="2020-06" class="refDate">June 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8784">https://www.rfc-editor.org/info/rfc8784</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="sample-exchanges">
<section id="appendix-A">
      <h2 id="name-sample-multiple-key-exchang">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-sample-multiple-key-exchang" class="section-name selfRef">Sample Multiple Key Exchanges</a>
      </h2>
<p id="appendix-A-1">This appendix shows some examples of multiple key exchanges.  These examples are purely for information
    purposes and they describe some message flow scenarios that may occur in establishing an IKE or CHILD SA.  Note
    that some payloads that are not relevant to multiple key exchanges may be omitted for brevity.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="sample-exchanges-none-selected">
<section id="appendix-A.1">
        <h3 id="name-no-additional-key-exchange-">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-no-additional-key-exchange-" class="section-name selfRef">No Additional Key Exchange Used</a>
        </h3>
<p id="appendix-A.1-1">The initiator proposes two sets of optional additional key exchanges, but the responder does not
      support any of them.  The responder chooses NONE for each set and consequently, IKE_INTERMEDIATE
      exchange does not takes place and the exchange proceeds to IKE_AUTH phase.  The resulting keying
      materials are the same as those derived with <span>[<a href="#RFC7296" class="xref">RFC7296</a>]</span>.<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.1-2">
<pre>
Initiator                     Responder
------------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1(.. AKE*...), ---&gt;
KEi1, Ni, N(IKEV2_FRAG_SUPPORTED),
N(INTERMEDIATE_EXCHANGE_SUPPORTED)
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform AKE1 (ID = PQ_KEM_1)
    Transform AKE1 (ID = PQ_KEM_2)
    Transform AKE1 (ID = NONE)
    Transform AKE2 (ID = PQ_KEM_3)
    Transform AKE2 (ID = PQ_KEM_4)
    Transform AKE2 (ID = NONE)
                         &lt;--- HDR(IKE_SA_INIT), SAr1(.. AKE*...),
                              KEr1, Nr, N(IKEV2_FRAG_SUPPORTED),
                              N(INTERMEDIATE_EXCHANGE_SUPPORTED)
                                Proposal #1
                                  Transform ECR (ID = ENCR_AES_GCM_16,
                                                 256-bit key)
                                  Transform PRF (ID = PRF_HMAC_SHA2_512)
                                  Transform KE (ID = Curve25519)
                                  Transform AKE1 (ID = NONE)
                                  Transform AKE2 (ID = NONE)

HDR(IKE_AUTH), SK{ IDi, AUTH, SAi2, TSi, TSr } ---&gt;
                         &lt;--- HDR(IKE_AUTH), SK{ IDr, AUTH, SAr2,
                              TSi, TSr }
</pre><a href="#appendix-A.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sample-exchanges-ake-child-sas">
<section id="appendix-A.2">
        <h3 id="name-additional-key-exchange-in-">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-additional-key-exchange-in-" class="section-name selfRef">Additional Key Exchange in the CREATE_CHILD_SA Exchange only</a>
        </h3>
<p id="appendix-A.2-1">The exchanges below show that the initiator does not propose the use of additional key exchanges
      to establish an IKE SA, but they are required in order to establish a Child SA.  In order
      to establish a fully quantum-resistant IPsec SA, both peers include CHILDLESS_IKEV2_SUPPORTED
      notification in their exchange so that the first Child SA is not created in IKE_AUTH, but instead
      the IKE SA is immediately rekeyed using CREATED_CHILD_SA. Any Child SA will have to be created via
      subsequent CREATED_CHILD_SA exchange.<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.2-2">
<pre>
Initiator                     Responder
------------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1, ---&gt;
KEi1, Ni, N(IKEV2_FRAG_SUPPORTED),
N(CHILDLESS_IKEV2_SUPPORTED)
                         &lt;--- HDR(IKE_SA_INIT), SAr1,
                              KEr1, Nr, N(IKEV2_FRAG_SUPPORTED),
                              N(CHILDLESS_IKEV2_SUPPORTED)
HDR(IKE_AUTH), SK{ IDi, AUTH  } ---&gt;
                         &lt;--- HDR(IKE_AUTH), SK{ IDr, AUTH }
HDR(CREATE_CHILD_SA), SK{ SAi(.. AKE*...), Ni, KEi } ---&gt;
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform AKE1 (ID = PQ_KEM_1)
    Transform AKE1 (ID = PQ_KEM_2)
    Transform AKE2 (ID = PQ_KEM_5)
    Transform AKE2 (ID = PQ_KEM_6)
    Transform AKE2 (ID = NONE)
                         &lt;--- HDR(CREATE_CHILD_SA), SK{ SAr(.. AKE*...),
                              Nr, KEr,
                              N(ADDITIONAL_KEY_EXCHANGE)(link1) }
                                Proposal #1
                                  Transform ECR (ID = ENCR_AES_GCM_16,
                                                 256-bit key)
                                  Transform PRF (ID = PRF_HMAC_SHA2_512)
                                  Transform KE (ID = Curve25519)
                                  Transform AKE1 (ID = PQ_KEM_2)
                                  Transform AKE2 (ID = PQ_KEM_5)

HDR(IKE_FOLLOWUP_KE), SK{ KEi(1), ---&gt;
N(ADDITIONAL_KEY_EXCHANGE)(link1) }
                         &lt;--- HDR(IKE_FOLLOWUP_KE), SK{ KEr(1),
                              N(ADDITIONAL_KEY_EXCHANGE)(link2) }
HDR(IKE_FOLLOWUP_KE), SK{ KEi(2), ---&gt;
N(ADDITIONAL_KEY_EXCHANGE)(link2) }
                         &lt;--- HDR(IKE_FOLLOWUP_KE), SK{ KEr(2) }
</pre><a href="#appendix-A.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="sample-exchanges-no-proposal-chosen">
<section id="appendix-A.3">
        <h3 id="name-not-matching-proposal-for-a">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-not-matching-proposal-for-a" class="section-name selfRef">Not Matching Proposal for Additional Key Exchanges</a>
        </h3>
<p id="appendix-A.3-1">The initiator proposes the combination of PQ_KEM_1, PQ_KEM_2, PQ_KEM_3, and PQ_KEM_4 as
      the additional key exchanges.  The initiator indicates, using the key exchange method NONE,
      that either PQ_KEM_1 or PQ_KEM_2 must be used to establish a security association.  The responder,
      although supports the optional PQ_KEM_3 and PQ_KEM_4 method, does not support either PQ_KEM_1 or
      PQ_KEM_2 mandatory method and therefore responds with NO_PROPOSAL_CHOSEN notification.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
<div class="alignCenter art-text artwork" id="appendix-A.3-2">
<pre>
Initiator                     Responder
------------------------------------------------------------------------
HDR(IKE_SA_INIT), SAi1(.. AKE*...), ---&gt;
KEi1, Ni, N(IKEV2_FRAG_SUPPORTED),
N(INTERMEDIATE_EXCHANGE_SUPPORTED)
  Proposal #1
    Transform ECR (ID = ENCR_AES_GCM_16,
                   256-bit key)
    Transform PRF (ID = PRF_HMAC_SHA2_512)
    Transform KE (ID = Curve25519)
    Transform AKE1 (ID = PQ_KEM_1)
    Transform AKE1 (ID = PQ_KEM_2)
    Transform AKE2 (ID = PQ_KEM_3)
    Transform AKE2 (ID = PQ_KEM_4)
    Transform AKE2 (ID = NONE)
                         &lt;--- HDR(IKE_SA_INIT), N(NO_PROPOSAL_CHOSEN)
</pre><a href="#appendix-A.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="altdesign">
<section id="appendix-B">
      <h2 id="name-alternative-design">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-alternative-design" class="section-name selfRef">Alternative Design</a>
      </h2>
<p id="appendix-B-1">
        This section gives an overview on a number of alternative approaches
        that we have considered, but later discarded.  These approaches are:<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B-2.1">
          <p id="appendix-B-2.1.1">Sending the classical and post-quantum key
        exchanges as a single transform<a href="#appendix-B-2.1.1" class="pilcrow">¶</a></p>
<p id="appendix-B-2.1.2">
        We considered combining the various key exchanges into a single large
        KE payload; this effort is documented in a previous version of this
        draft (draft-tjhai-ipsecme-hybrid-qske-ikev2-01).  This does allow us
        to cleanly apply hybrid key exchanges during the child SA; however it
        does add considerable complexity, and requires an independent
        fragmentation solution.<a href="#appendix-B-2.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.2">
          <p id="appendix-B-2.2.1">Sending post-quantum proposals and policies in KE payload
        only<a href="#appendix-B-2.2.1" class="pilcrow">¶</a></p>
<p id="appendix-B-2.2.2">
        With the objective of not introducing unnecessary notify
        payloads, we considered communicating the hybrid post-quantum proposal
        in the KE payload during the first pass of the protocol
        exchange.   Unfortunately, this design is susceptible to the following
        downgrade attack.  Consider the scenario where there is an MitM attacker
        sitting between an initiator and a responder.  The initiator proposes,
        through SAi payload, to use a hybrid post-quantum group and as a backup
        a Diffie-Hellman group, and through KEi payload, the initiator proposes
        a list of hybrid post-quantum proposals and policies.  The MitM attacker
        intercepts this traffic and replies with N(INVALID_KE_PAYLOAD) suggesting
        to downgrade to the backup Diffie-Hellman group instead.  The initiator
        then resends the same SAi payload and the KEi payload containing the
        public value of the backup Diffie-Hellman group.  Note that the attacker
        may forward the second IKE_SA_INIT message only to the responder, and
        therefore at this point in time, the responder will not have the
        information that the initiator prefers the hybrid group.  Of course,
        it is possible for the responder to have a policy to reject an
        IKE_SA_INIT message that (a) offers a hybrid group but not offering
        the corresponding public value in the KEi payload; and (b) the
        responder has not specifically acknowledged that it does not
        supported the requested hybrid group.  However, the checking of this
        policy introduces unnecessary protocol complexity.  Therefore, in
        order to fully prevent any downgrade attacks, using KE payload alone
        is not sufficient and that the initiator MUST always indicate its
        preferred post-quantum proposals and policies in a notify payload
        in the subsequent IKE_SA_INIT messages following a
        N(INVALID_KE_PAYLOAD) response.<a href="#appendix-B-2.2.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.3">
          <p id="appendix-B-2.3.1">New payload types to negotiate hybrid proposal and to carry post-
        quantum public values<a href="#appendix-B-2.3.1" class="pilcrow">¶</a></p>
<p id="appendix-B-2.3.2">
        Semantically, it makes sense to use a new payload type, which
        mimics the SA payload, to carry a hybrid proposal.  Likewise, another new
        payload type that mimics the KE payload, could be used to transport hybrid
        public value.  Although, in theory a new payload type could be made
        backwards compatible by not setting its critical flag as per Section 2.5
        of RFC7296, we believe that it may not be that simple in practice.  Since
        the original release of IKEv2 in RFC4306, no new payload type has ever
        been proposed and therefore, this creates a potential risk of having a
        backward compatibility issue from non-conforming RFC IKEv2
        implementations.  Since we could not see any other compelling advantages
        apart from a semantic one, we use the existing transform type and
        notify payloads instead.  In fact, as described above, we use the KE
        payload in the first IKE_SA_INIT request round and the notify payload
        to carry the post-quantum proposals and policies. We use one or more
        of the existing KE payloads to carry the hybrid public values.<a href="#appendix-B-2.3.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.4">
          <p id="appendix-B-2.4.1">Hybrid public value payload<a href="#appendix-B-2.4.1" class="pilcrow">¶</a></p>
<p id="appendix-B-2.4.2">
        One way to transport the negotiated hybrid public payload, which contains
        one classical Diffie-Hellman public value and one or more post-quantum
        public values, is to bundle these into a single KE payload.  Alternatively,
        these could also be transported in a single new hybrid public value
        payload, but following the same reasoning as above, this may not be
        a good idea from a backward compatibility perspective.  Using a single
        KE payload would require an encoding or formatting to be defined so
        that both peers are able to compose and extract the individual public
        values.  However, we believe that it is cleaner to send the hybrid
        public values in multiple KE payloads--one for each group or
        algorithm.  Furthermore, at this point in the protocol exchange, both
        peers should have indicated support of handling multiple KE payloads.<a href="#appendix-B-2.4.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="appendix-B-2.5">
          <p id="appendix-B-2.5.1">Fragmentation<a href="#appendix-B-2.5.1" class="pilcrow">¶</a></p>
<p id="appendix-B-2.5.2">
        Handling of large IKE_SA_INIT messages has been one of the most
        challenging tasks.  A number of approaches have been considered
        and the two prominent ones that we have discarded are outlined as
        follows.<a href="#appendix-B-2.5.2" class="pilcrow">¶</a></p>
<p id="appendix-B-2.5.3">
        The first approach was to treat the entire IKE_SA_INIT message as
        a stream of bytes, which we then split it into a number of
        fragments, each of which is wrapped onto a payload that would fit
        into the size of the network MTU.  The payload that wraps each
        fragment is a new payload type and it was envisaged that this new
        payload type will not cause a backward compatibility issue because
        at this stage of the protocol, both peers should have indicated
        support of fragmentation in the first pass of the IKE_SA_INIT
        exchange.  The negotiation of fragmentation is performed using  a
        notify payload, which also defines supporting parameters such as
        the size of fragment in octets and the fragment identifier.  The
        new payload that wraps each fragment of the messages in this
        exchange is assigned the same fragment identifier. Furthermore, it
        also has other parameters such as a fragment index and total
        number of fragments.  We decided to discard this approach due to
        its blanket approach to fragmentation.  In cases where only a few
        payloads need to be fragmented, we felt that this approach is
        overly complicated.<a href="#appendix-B-2.5.3" class="pilcrow">¶</a></p>
<p id="appendix-B-2.5.4">
        Another idea that was discarded was fragmenting an individual
        payload without introducing a new payload type.  The idea was to
        use the 9-th bit (the bit after the critical flag in the RESERVED
        field) in the generic payload header as a flag to mark that this
        payload is fragmented.  As an example, if a KE payload is to be
        fragmented, it may look as follows.<a href="#appendix-B-2.5.4" class="pilcrow">¶</a></p>
</li>
      </ul>
<div class="alignCenter art-text artwork" id="appendix-B-3">
<pre>
                 1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
| Next Payload  |C|F| RESERVED  |         Payload Length        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  Diffie-Hellman Group Number  |     Fragment Identifier       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|         Fragment Index        |        Total Fragments        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                  Total KE Payload Data Length                 |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
~                       Fragmented KE Payload                   ~
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</pre><a href="#appendix-B-3" class="pilcrow">¶</a>
</div>
<span class="break"></span><dl class="dlParallel" id="appendix-B-4">
        <dt id="appendix-B-4.1"></dt>
        <dd style="margin-left: 1.5em" id="appendix-B-4.2">
        When the flag F is set, this means the current KE payload is a
        fragment of a larger KE payload.  The Payload Length field denotes
        the size of this payload fragment in octets--including the size of
        the generic payload header.  The two-octet RESERVED field
        following Diffie-Hellman Group Number was to be used as a fragment
        identifier to help assembly and disassembly of fragments.  The
        Fragment Index and Total Fragments fields are self-explanatory.
        The Total KE Payload Data Length indicates the size of the
        assembled KE payload data in octets.  Finally, the actual fragment
        is carried in Fragment KE Payload field.<a href="#appendix-B-4.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<span class="break"></span><dl class="dlParallel" id="appendix-B-5">
        <dt id="appendix-B-5.1"></dt>
        <dd style="margin-left: 1.5em" id="appendix-B-5.2">
        We discarded this approach because we believe that the working
        group may not be happy using the RESERVED field to change the
        format of a packet and that implementers may not like the
        complexity added from checking the fragmentation flag in each
        received payload.  More importantly, fragmenting the messages
        in this way may leave the system to be more prone to denial of
        service (DoS) attacks.  By using IKE_INTERMEDIATE to transport the large
        post-quantum key exchange payloads, there is no longer any issue
        with fragmentation.<a href="#appendix-B-5.2" class="pilcrow">¶</a>
</dd>
      <dd class="break"></dd>
</dl>
<ul class="normal">
<li class="normal" id="appendix-B-6.1">
          <p id="appendix-B-6.1.1">Group sub-identifier<a href="#appendix-B-6.1.1" class="pilcrow">¶</a></p>
<p id="appendix-B-6.1.2">
        As discussed before, each group identifier
        is used to
        distinguish a post-quantum algorithm.  Further classification
        could be made on a particular post-quantum algorithm by assigning
        additional value alongside the group identifier.  This sub-
        identifier value may be used to assign different security
        parameter sets to a given post-quantum algorithm.  However, this
        level of details does not fit the principles of the document where
        it should deal with generic hybrid key exchange protocol, not a
        specific ciphersuite.  Furthermore, there are enough Diffie-
        Hellman group identifiers should this be required in the future.<a href="#appendix-B-6.1.2" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">C. Tjhai</span></div>
<div dir="auto" class="left"><span class="org">Post-Quantum</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cjt@post-quantum.com" class="email">cjt@post-quantum.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">M. Tomlinson</span></div>
<div dir="auto" class="left"><span class="org">Post-Quantum</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mt@post-quantum.com" class="email">mt@post-quantum.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">G. Bartlett</span></div>
<div dir="auto" class="left"><span class="org">Quantum Secret</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:graham.ietf@gmail.com" class="email">graham.ietf@gmail.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">S. Fluhrer</span></div>
<div dir="auto" class="left"><span class="org">Cisco Systems</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sfluhrer@cisco.com" class="email">sfluhrer@cisco.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">D. Van Geest</span></div>
<div dir="auto" class="left"><span class="org">ISARA Corporation</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:daniel.vangeest@isara.com" class="email">daniel.vangeest@isara.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">O. Garcia-Morchon</span></div>
<div dir="auto" class="left"><span class="org">Philips</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:oscar.garcia-morchon@philips.com" class="email">oscar.garcia-morchon@philips.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Valery Smyslov</span></div>
<div dir="auto" class="left"><span class="org">ELVIS-PLUS</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:svan@elvis.ru" class="email">svan@elvis.ru</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
