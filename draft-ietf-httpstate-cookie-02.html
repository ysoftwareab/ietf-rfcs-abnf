<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>HTTP State Management Mechanism</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="HTTP State Management Mechanism">
<meta name="keywords" content="Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">httpstate</td><td class="header">A. Barth</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">U.C. Berkeley</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2109'>2109</a> (if&nbsp;approved)</td><td class="header">January 22, 2010</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: July 26, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />HTTP State Management Mechanism<br />draft-ietf-httpstate-cookie-02</h1>

<h3>Abstract</h3>

<p>This document defines the HTTP Cookie and Set-Cookie headers.
      These headers can be used by HTTP servers to store state on HTTP user
      agents, letting the servers maintain a stateful session over the
      mostly stateless HTTP protocol.  The cookie protocol has many
      historical infelicities and should be avoided for new applications of
      HTTP.
      </p>
<blockquote class="text">
<p>NOTE: If you have suggestions for improving the draft, please send
        email to http-state@ietf.org.  Suggestions with test cases are
        especially appreciated.
</p>
</blockquote><p>
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 26, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#syntax-notation">1.1.</a>&nbsp;
Syntax Notation<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Examples<br />
<a href="#anchor4">4.</a>&nbsp;
A Well-Behaved Profile<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">4.1.</a>&nbsp;
Set-Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.1.1.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.1.2.</a>&nbsp;
Semantics (Non-Normative)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">4.2.</a>&nbsp;
Cookie<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">4.2.1.</a>&nbsp;
Syntax<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">4.2.2.</a>&nbsp;
Semantics<br />
<a href="#cookie-protocol">5.</a>&nbsp;
The Cookie Protocol<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.1.</a>&nbsp;
Algorithms<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.1.1.</a>&nbsp;
Dates<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.1.2.</a>&nbsp;
Domains<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.1.3.</a>&nbsp;
Paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.2.</a>&nbsp;
The Set-Cookie Header<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">5.2.1.</a>&nbsp;
The Max-Age Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">5.2.2.</a>&nbsp;
The Expires Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">5.2.3.</a>&nbsp;
The Domain Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">5.2.4.</a>&nbsp;
The Path Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">5.2.5.</a>&nbsp;
The Secure Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">5.2.6.</a>&nbsp;
The HttpOnly Attribute<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">5.3.</a>&nbsp;
Storage Model<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">5.4.</a>&nbsp;
The Cookie Header<br />
<a href="#anchor29">6.</a>&nbsp;
Implementation Limits<br />
<a href="#anchor30">7.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor31">7.1.</a>&nbsp;
Clear Text<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor32">7.2.</a>&nbsp;
Weak Confidentiality<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">7.3.</a>&nbsp;
Weak Integrity<br />
<a href="#rfc.references1">8.</a>&nbsp;
Normative References<br />
<a href="#anchor35">Appendix&nbsp;A.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>This document defines the HTTP Cookie and Set-Cookie header. Using
      the Set-Cookie header, an HTTP server can store name/value pairs and
      associated metadata (called cookies) at the user agent. When the user
      agent makes subsequent requests to the server, the user agent uses the
      metadata to determine whether to return the name/value pairs in the
      Cookie header.
</p>
<p>Although simple on its surface, the cookie protocol has a number of
      complexities.  For example, the server indicates a scope for each
      cookie when sending them to the user agent.  The scope indicates the
      maximum amount of time the user agent should retain the cookie, to
      which servers the user agent should return the cookie, and for which
      protocols the cookie is applicable.
</p>
<p>For historical reasons, the cookie protocol contains a number of
      security and privacy infelicities.  For example, a server can indicate
      that a given cookie is intended for "secure" connections, but the
      Secure attribute provides only confidentiality (not integrity) from
      active network attackers.  Similarly, cookies for a given host are
      shared across all the ports on that host, even though the usual
      "same-origin policy" used by web browsers isolates content retrieved
      from different ports.
</p>
<a name="syntax-notation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Syntax Notation</h3>

<p>This specification uses the Augmented Backus-Naur Form (ABNF)
        notation of <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
</p>
<p>The following core rules are included by reference, as defined in
        <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>, Appendix B.1: ALPHA (letters), CR (carriage
        return), CRLF (CR LF), CTL (controls), DIGIT (decimal 0-9), DQUOTE
        (double quote), HEXDIG (hexadecimal 0-9/A-F/a-f), LF (line feed),
        OCTET (any 8-bit sequence of data), SP (space), HTAB (horizontal tab),
        VCHAR (any visible [USASCII] character), and WSP (whitespace).
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The terms user agent, client, server, proxy, and origin server have
      the same meaning as in the HTTP/1.1 specification.
</p>
<p>The terms request-host and request-URI refer to the values the user
      agent would send to the server as, respectively, the host (but not port)
      and abs_path portions of the absoluteURI (http_URL) of the HTTP
      Request-Line.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Overview</h3>

<p>We outline here a way for an origin server to send state
      information to a user agent, and for the user agent to return the
      state information to the origin server.
</p>
<p>To initiate a session, the origin server includes a Set-Cookie header
      in an HTTP response. (Note that "session" here does not refer to a
      persistent network connection but to a logical session created from HTTP
      requests and responses. The presence or absence of a persistent
      connection should have no effect on the use of cookie-derived
      sessions).
</p>
<p>The user agent returns a Cookie request header to the origin server
      if it chooses to continue a session. The Cookie header contains a number
      of cookies the user agent received in previous Set-Cookie headers. The
      origin server MAY ignore the Cookie header or use the header to
      determine the current state of the session. The origin server MAY send
      the user agent a Set-Cookie response header with the same or different
      information, or it MAY send no Set-Cookie header at all.
</p>
<p>Servers MAY return a Set-Cookie response header with any response.
      User agents SHOULD send a Cookie request header, subject to other rules
      detailed below, with every request.
</p>
<p>An origin server MAY include multiple Set-Cookie header fields in a
      single response. Note that an intervening gateway MUST NOT fold multiple
      Set-Cookie header fields into a single header field.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Examples</h3>

<p>[TODO: Put some examples here.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
A Well-Behaved Profile</h3>

<p>This section describes the syntax and semantics of a well-behaved
      profile of the protocol.  Servers SHOULD use the profile described in
      this section, both to maximize interoperability with existing user
      agents and because a future version of the cookie protocol could remove
      support for some of the most esoteric aspects of the protocol.  User
      agents, however, MUST implement the full protocol to ensure
      interoperability with servers making use of the full protocol.
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Set-Cookie</h3>

<p>The Set-Cookie header is used to send cookies from the server to
        the user agent.
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.1"></a><h3>4.1.1.&nbsp;
Syntax</h3>

<p>Informally, the Set-Cookie response header comprises the token
          Set-Cookie:, followed by a cookie. Each cookie begins with a
          name-value-pair, followed by zero or more attribute-value pairs.
          Servers SHOULD NOT send Set-Cookie headers that fail to conform to
          the following grammar:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

<dfn>set-cookie-header</dfn> = "<span class='str'>Set-Cookie:</span>" <cite class='id'>OWS</cite> <cite class='id'>set-cookie-string</cite> <cite class='id'>OWS</cite>
<dfn>set-cookie-string</dfn> = <cite class='id'>cookie-pair</cite> <span class='rep'>*</span>( "<span class='str'>;</span>" <cite class='id'>cookie-av</cite> )
<dfn>cookie-pair</dfn>       = <cite class='id'>cookie-name</cite> "<span class='str'>=</span>" <cite class='id'>cookie-value</cite>
<dfn>cookie-name</dfn>       = <cite class='id'>token</cite>
<dfn>cookie-value</dfn>      = <cite class='id'>token</cite>
<dfn>token</dfn>             = &lt;<span class='str'>token, as defined in RFC 2616</span>&gt;

<dfn>cookie-av</dfn>         = <cite class='id'>expires-av</cite> / <cite class='id'>domain-av</cite> / <cite class='id'>path-av</cite> /
                    <cite class='id'>secure-av</cite> / <cite class='id'>httponly-av</cite>
<dfn>expires-av</dfn>        = "<span class='str'>Expires</span>" "<span class='str'>=</span>" <cite class='id'>cookie-date</cite>
<dfn>cookie-date</dfn>       = &lt;<span class='str'>rfc1123-date, as defined in RFC 2616</span>&gt;
<dfn>domain-av</dfn>         = "<span class='str'>Domain</span>" "<span class='str'>=</span>" <cite class='id'>domain-value</cite>
<dfn>domain-value</dfn>      = <cite class='id'>token</cite>
<dfn>path-av</dfn>           = "<span class='str'>Path</span>" "<span class='str'>=</span>" <cite class='id'>path-value</cite>
<dfn>path-value</dfn>        = &lt;<span class='str'>abs_path, as defined in RFC 2616</span>&gt;
<dfn>secure-av</dfn>         = "<span class='str'>Secure</span>"
<dfn>httponly-av</dfn>       = "<span class='str'>HttpOnly</span>"

</pre></div>
<p>Servers SHOULD NOT include two attributes with the same name.
</p>
<p>The cookie-value is opaque to the user agent and MAY be
          anything the origin server chooses to send, possibly in a
          server-selected printable ASCII encoding.  "Opaque" implies that
          the content is of interest and relevance only to the origin
          server.  The content is, in fact, readable by anyone who
          examines the Set-Cookie header.
</p>
<p>NOTE: The syntax above allows whitespace between the attribute
          and the U+003D ("=") character.  Servers wishing to interoperate
          with some legacy user agents might wish to elide this
          whitespace.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2"></a><h3>4.1.2.&nbsp;
Semantics (Non-Normative)</h3>

<p>This section describes a simplified semantics of the Set-Cookie
          header. These semantics are detailed enough to be useful for
          understanding the most common uses of the cookie protocol. The full
          semantics are described in <a class='info' href='#cookie-protocol'>Section&nbsp;5<span> (</span><span class='info'>The Cookie Protocol</span><span>)</span></a>.
</p>
<p>When the user agent receives a Set-Cookie header, the user agent
          stores the cookie in its cookie store.  When the user agent
          subsequently makes an HTTP request, the user agent consults its
          cookie store and includes the applicable, non-expired cookies in the
          Cookie header.
</p>
<p>If the cookie store already contains a cookie with the same
          cookie-name, domain-value, and path-value, the existing cookie is
          evicted from the cookie store and replaced with the new value.
          Notice that servers can delete cookies by including an Expires
          attribute with a value in the past.
</p>
<p>Unless the cookie's attributes indicate otherwise, the cookie is
          returned only to the origin server, and it expires at the end of the
          current session (as defined by the user agent). User agents ignore
          unrecognized cookie attributes.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.1"></a><h3>4.1.2.1.&nbsp;
Expires</h3>

<p>The Expires attribute indicates the maximum lifetime of the
            cookie, represented as the date and time at which the cookie
            expires. The user agent is not required to retain the cookie
            until the specified date has passed. In fact, user agents often
            evict cookies from the cookie store due to memory pressure or
            privacy concerns.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.2"></a><h3>4.1.2.2.&nbsp;
Domain</h3>

<p>The Domain attribute specifies those hosts for which the cookie
            will be sent. For example, if the Domain attribute contains the
            value ".example.com", the user agent will include the cookie in
            the Cookie header when making HTTP requests to example.com,
            www.example.com, and www.corp.example.com. (Note that a leading
            U+002E ("."), if present, is ignored.) If the server omits the
            Domain attribute, the user agent will return the cookie only to
            the origin server.
</p>
<p>The user agent will reject cookies (refuse to store them in the
            cookie store) unless the Domain attribute specifies a scope for
            the cookie that would include the origin server. For example, the
            user agent will accept a Domain attribute of ".example.com" or of
            ".foo.example.com" from foo.example.com, but the user agent will
            not accept a Domain attribute of ".bar.example.com" or of
            ".baz.foo.example.com".
</p>
<p>NOTE: For security reasons, some user agents are configured to
            reject Domain attributes that do not correspond to a "registry
            controlled" domain (or a subdomain of a registry controlled
            domain). For example, some user agents will reject Domain
            attributes of ".com".
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.3"></a><h3>4.1.2.3.&nbsp;
Path</h3>

<p>The Path attribute limits the scope of the cookie to a set of
            paths. When a cookie has a Path attribute, the user agent will
            include the cookie in an HTTP request only if the path portion of
            the Request-URI matches (or is a subdirectory of) the cookie's
            Path attribute, where the U+002F ("/") character is interpreted as a
            directory separator. If the server omits the Path attribute, the
            user agent will use the directory of the Request-URI's path
            component as the default value.
</p>
<p>Although seemingly useful for isolating cookies between
            different paths within a given domain, the Path attribute cannot
            be relied upon for security for two reasons: First, user agents do
            not prevent one path from overwriting the cookies for another
            path. For example, if a response to a request for /foo/bar.html
            attempts to set a cookie with a Path attribute of "/baz" the user
            agent will store that cookie in the cookie store. Second, the
            "same-origin" policy implemented by many user agents does not
            isolate different paths within an origin. For example,
            /foo/bar.html can read cookies with a Path attribute of "/baz"
            because they are within the "same origin".
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.4"></a><h3>4.1.2.4.&nbsp;
Secure</h3>

<p>The Secure attribute limits the scope of the cookie to "secure"
            channels (where "secure" is defined by the user agent). When a
            cookie has the Secure attribute, the user agent will include the
            cookie in an HTTP request only if the request is transmitted over
            a secure channel (typically TLS <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D., Ed. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>).
</p>
<p>Although seemingly useful for protecting cookies from active
            network attackers, the Secure attribute protects only the cookie's
            confidentiality. An active network attacker can overwrite Secure
            cookies from an insecure channel, disrupting the integrity of the
            cookies.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1.2.5"></a><h3>4.1.2.5.&nbsp;
HttpOnly</h3>

<p>The HttpOnly attribute limits the scope of the cookie to HTTP
            requests. In particular, the attribute instructs the user agent to
            elide the cookie when providing access to its cookie store via
            "non-HTTP" APIs (as defined by the user agent).
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Cookie</h3>

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
Syntax</h3>

<p>The user agent returns stored cookies to the origin server in
          the Cookie header.  If the server conforms to the requirements in
          this section, the requirements in the next section will cause the
          user agent to return a Cookie header that conforms to the following
          grammar:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

<dfn>cookie-header</dfn> = "<span class='str'>Cookie:</span>" <cite class='id'>OWS</cite> <cite class='id'>cookie-string</cite> <cite class='id'>OWS</cite>
<dfn>cookie-string</dfn> = <cite class='id'>cookie-pair</cite> <span class='rep'>*</span>( "<span class='str'>;</span>" <cite class='id'>cookie-pair</cite> )
<dfn>cookie-pair</dfn>   = <cite class='id'>cookie-name</cite> "<span class='str'>=</span>" <cite class='id'>cookie-value</cite>
<dfn>cookie-name</dfn>   = <cite class='id'>token</cite>
<dfn>cookie-value</dfn>  = <cite class='id'>token</cite>
<dfn>token</dfn>         = &lt;<span class='str'>token, as defined in Section 2.2 of RFC 2616</span>&gt;

</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Semantics</h3>

<p>Each cookie-pair represents a cookie stored by the user
          agent. The cookie-name and the cookie-value are returned verbatim
          from the corresponding parts of the Set-Cookie header.
</p>
<p>Notice that the cookie attributes are not returned. In
          particular, the server cannot determine from the Cookie header alone
          when a cookie will expire, for which domains the cookie is valid,
          for which paths the cookie is valid, or whether the cookie was set
          with the Secure or HttpOnly attributes.
</p>
<p>The semantics of individual cookies in the Cookie header is not
          defined by this document. Servers are expected to imbue these
          cookies with server-specific semantics.
</p>
<a name="cookie-protocol"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
The Cookie Protocol</h3>

<p>For historical reasons, the full cookie protocol contains a number of
      exotic quirks. This section is intended to specify the cookie protocol
      in enough detail to enable a user agent that implements the protocol
      precisely as specified to interoperate with existing servers.
</p>
<p>Conformance requirements phrased as algorithms or specific steps
      may be implemented in any manner, so long as the end result is
      equivalent. (In particular, the algorithms defined in this
      specification are intended to be easy to follow, and not intended to
      be performant.)
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Algorithms</h3>

<p>This section defines a number of algorithms used by the cookie
        protocol.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
Dates</h3>

<p>The user agent MUST use the following algorithm to *parse a
          cookie-date*:
          </p>
<ol class="text">
<li>Using the grammar below, divide the cookie-date into
            date-tokens.
            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

<dfn>cookie-date</dfn>     = <span class='rep'>*</span><cite class='id'>delimiter</cite> <cite class='id'>date-token-list</cite> <span class='rep'>*</span><cite class='id'>delimiter</cite>
<dfn>date-token-list</dfn> = <cite class='id'>date-token</cite> <span class='rep'>*</span>( <span class='rep'>1*</span><cite class='id'>delimiter</cite> <cite class='id'>date-token</cite> )
<dfn>delimiter</dfn>       = <span class='val'>%x09</span> / <span class='val'>%x20</span> / <span class='val'>%x21</span> / <span class='val'>%x22</span> / <span class='val'>%x23</span> / <span class='val'>%x24</span> /
                  <span class='val'>%x25</span> / <span class='val'>%x26</span> / <span class='val'>%x27</span> / <span class='val'>%x28</span> / <span class='val'>%x29</span> / <span class='val'>%x2A</span> /
                  <span class='val'>%x2B</span> / <span class='val'>%x2C</span> / <span class='val'>%x2D</span> / <span class='val'>%x2E</span> / <span class='val'>%x2F</span> / <span class='val'>%x3B</span> /
                  <span class='val'>%x3C</span> / <span class='val'>%x3D</span> / <span class='val'>%x3E</span> / <span class='val'>%x3F</span> / <span class='val'>%x40</span> / <span class='val'>%x5B</span> /
                  <span class='val'>%x5C</span> / <span class='val'>%x5D</span> / <span class='val'>%x5E</span> / <span class='val'>%x5F</span> / <span class='val'>%x60</span> / <span class='val'>%x7B</span> /
                  <span class='val'>%x7C</span> / <span class='val'>%x7D</span> / <span class='val'>%x7E</span>
<dfn>date-token</dfn>      = <cite class='id'>day-of-month</cite> / <cite class='id'>month</cite> / <cite class='id'>year</cite> / <cite class='id'>time</cite> / <cite class='id'>mystery</cite>
<dfn>day-of-month</dfn>    = <span class='rep'>2</span><cite class='key'>DIGIT</cite> / <cite class='key'>DIGIT</cite>
<dfn>month</dfn>           = "<span class='str'>jan</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>feb</span>" [ <cite class='id'>mystery</cite> ] /
                  "<span class='str'>mar</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>apr</span>" [ <cite class='id'>mystery</cite> ] /
                  "<span class='str'>may</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>jun</span>" [ <cite class='id'>mystery</cite> ] /
                  "<span class='str'>jul</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>aug</span>" [ <cite class='id'>mystery</cite> ] /
                  "<span class='str'>sep</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>oct</span>" [ <cite class='id'>mystery</cite> ] /
                  "<span class='str'>nov</span>" [ <cite class='id'>mystery</cite> ] / "<span class='str'>dec</span>" [ <cite class='id'>mystery</cite> ]
<dfn>year</dfn>            = <span class='rep'>5</span><cite class='key'>DIGIT</cite> / <span class='rep'>4</span><cite class='key'>DIGIT</cite> / <span class='rep'>3</span><cite class='key'>DIGIT</cite> / <span class='rep'>2</span><cite class='key'>DIGIT</cite> / <cite class='key'>DIGIT</cite>
<dfn>time</dfn>            = <span class='rep'>2</span><cite class='key'>DIGIT</cite> "<span class='str'>:</span>" <span class='rep'>2</span><cite class='key'>DIGIT</cite> "<span class='str'>:</span>" <span class='rep'>2</span><cite class='key'>DIGIT</cite>
<dfn>mystery</dfn>         = &lt;<span class='str'>anything except a delimiter</span>&gt;

</pre></div>
            
</li>
<li>Process each date-token sequentially in the order the
            date-tokens appear in the cookie-date:
            
<ol class="text">
<li>If the found-day-of-month flag is not set and the date-token
              matches the day-of-month production, set the found-day-of-month
              flag and set the day-of-month-value to the number denoted by the
              date-token. Skip the remaining sub-steps and continue to the
              next date-token.
</li>
<li>If the found-month flag is not set and the date-token matches
              the month production, set the found-month flag and set the
              month-value to the month denoted by the date-token. Skip the
              remaining sub-steps and continue to the next date-token.
</li>
<li>If the found-year flag is not set and the date-token matches
              the year production, set the found-year flag and set the
              year-value to the number denoted by the date-token. Skip the
              remaining sub-steps and continue to the next date-token.
</li>
<li>If the found-time flag is not set and the token matches the
              time production, set the found-time flag and set the hour-value,
              minute-value, and second-value to the numbers denoted by the
              digits in the date-token, respectively. Skip the remaining
              sub-steps and continue to the next date-token.
</li>
</ol>
            
</li>
<li>Abort these steps and *fail to parse* if
            
<ul class="text">
<li>at least one of the found-day-of-month, found-month,
              found-year, or found-time flags is not set,
</li>
<li>the day-of-month-value is less than 1 or greater than 31,
</li>
<li>the year-value is less than 1601 or greater than 30827,
</li>
<li>the hour-value is greater than 23,
</li>
<li>the minute-value is greater than 59, or
</li>
<li>the second-value is greater than 59.
</li>
</ul>
            
</li>
<li>If the year-value is greater than 68 and less than 100,
            increment the year-value by 1900.
</li>
<li>If the year-value is greater than or equal to 0 and less than
            69, increment the year-value by 2000.
</li>
<li>Let the parsed-cookie-date be the date whose day-of-month,
            month, year, hour, minute, and second (in GMT) are the
            day-of-month-value, the month-value, the year-value, the
            hour-value, the minute-value, and the second-value,
            respectively.
</li>
<li>Return the parsed-cookie-date as the result of this
            algorithm.
</li>
</ol><p>
          
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
Domains</h3>

<p>A *canonicalized* host-name is the host-name converted to
          lower case.
</p>
<p>A request-host *domain-matches* a cookie-domain if at least one
          of the following conditions hold:
          </p>
<ul class="text">
<li>The cookie-domain and the canonicalized request-host are
            identical.
</li>
<li>The cookie-domain is a suffix of the canonicalized
            request-host, the last character of the canonicalized
            request-host that is not included in the cookie-domain is a U+002E
            (".") character, and request-host is a host name (i.e., not an
            IP address). [TODO: Is this the right way to spec this???]
</li>
</ul><p>
          
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
Paths</h3>

<p>The user agent MUST use the following algorithm to compute the
          *default-path* of a cookie:
          </p>
<ol class="text">
<li>Let uri-path be the path portion of the Request-URI.
</li>
<li>If the first character of the uri-path is not a U+002F ("/")
            character, output U+002F ("/") and skip the remaining steps.
</li>
<li>If the uri-path contains only a single U+002F ("/") character,
            output U+002F ("/") and skip the remaining steps.
</li>
<li>Output the characters of the uri-path from the first character
            up to, but not including, the right-most U+002F ("/").
</li>
</ol><p>
          
</p>
<p>A request-path *path-matches* a cookie-path if at least one of
          the following conditions hold: [TODO: This isn't exactly what IE
          or Firefox does.]
          </p>
<ul class="text">
<li>The cookie-path and the request-path are identical.
</li>
<li>The cookie-path is a prefix of the request-path and the last
            character of the cookie-path is U+002F ("/").
</li>
<li>The cookie-path is a prefix of the request-path and the first
            character of the request-path that is not included in the
            cookie-path is a U+002F ("/") character.
</li>
</ul><p>
          
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
The Set-Cookie Header</h3>

<p>When a user agent receives a Set-Cookie header in an HTTP
        response, the user agent *receives a set-cookie-string*
        consisting of the value of the header.
</p>
<p>A user agent MUST use the following algorithm to parse
        set-cookie-strings:
        </p>
<ol class="text">
<li>If the set-cookie-string is empty or consists entirely of WSP
          characters, the user agent MAY ignore the set-cookie-string
          entirely.
</li>
<li>If the set-cookie-string contains a U+003B (";") character:
          
<blockquote class="text">
<p>The name-value-pair string consists of the characters up to,
            but not including, the first U+003B (";"), and the
            unparsed-attributes consist of the remainder of the
            set-cookie-string (including the U+003B (";") in question).
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>The name-value-pair string consists of all the characters
            contained in the set-cookie-string, and the unparsed-attributes
            is the empty string.
</p>
</blockquote>
          
</li>
<li>If the name-value-pair string contains a U+003D ("=") character:
          
<blockquote class="text">
<p>The (possibly empty) name string consists of the characters
            up to, but not including, the first U+003D ("=") character, and
            the (possibly empty) value string consists of the characters
            after the first U+003D ("=") character.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>The name string is empty, and the value string consists of
            the entire name-value-pair string.
</p>
</blockquote>
          
</li>
<li>Remove any leading or trailing WSP characters from the name
          string and the value string.
</li>
<li>The cookie-name is the name string, and the cookie-value is the
          value string.
</li>
</ol><p>
        
</p>
<p>The user agent MUST use the following algorithm to parse the
        unparsed-attributes:
        </p>
<ol class="text">
<li>If the unparsed-attributes string is empty, skip the rest of
          these steps.
</li>
<li>Consume the first character of the unparsed-attributes (which
          will be a U+003B (";") character).
</li>
<li>If the remaining unparsed-attributes contains a U+003B (";")
          character:
          
<blockquote class="text">
<p>Consume the characters of the unparsed-attributes up to, but
            not including, the first U+003B (";") character.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Consume the remainder of the unparsed-attributes.
</p>
</blockquote>
          Let the cookie-av string be the characters consumed in this
          step.
</li>
<li>If the cookie-av string contains a U+003D ("=") character:
          
<blockquote class="text">
<p>The (possibly empty) attribute-name string consists of the
            characters up to, but not including, the first U+003D ("=")
            character, and the (possibly empty) attribute-value string
            consists of the characters after the first U+003D ("=")
            character.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>The attribute-name string consists of the entire cookie-av
            string, and the attribute-value string is empty. (Note that this
            step differs from the analogous step when parsing the
            name-value-pair string.)
</p>
</blockquote>
          
</li>
<li>Remove any leading or trailing WSP characters from the
          attribute-name string and the attribute-value string.
</li>
<li>Process the attribute-name and attribute-value according to the
          requirements in the following subsections.
</li>
<li>Return to Step 1.
</li>
</ol><p>
        
</p>
<p>When the user agent finishes parsing the set-cookie-string,
        the user agent *receives a cookie* from the Request-URI with name
        cookie-name, value cookie-value, and attributes
        cookie-attribute-list.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
The Max-Age Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Max-Age", the user agent MUST process the cookie-av as follows.
</p>
<p>If the first character of the attribute-value is not a DIGIT or a
          "-" character, ignore the cookie-av.
</p>
<p>If the remainder of attribute-value contains a non-DIGIT
          character, ignore the cookie-av.
</p>
<p>Let delta-seconds be the attribute-value converted to an
          integer.
</p>
<p>If delta-seconds is less than or equal to zero (0), let
          expiry-time be the current date and time. Otherwise, let the
          expiry-time be the current date and time plus delta-seconds
          seconds.
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Expires (note the name conversion) and an
          attribute-value of expiry-time.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
The Expires Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Expires", the user agent MUST process the cookie-av as follows.
</p>
<p>Let the parsed-cookie-date be the result of parsing the
          attribute-value as cookie-date.
</p>
<p>If the attribute-value failed to parse as a cookie date, ignore
          the cookie-av.
</p>
<p>If the user agent received the set-cookie-string from an HTTP
          response that contains a Date header field and the contents of the
          last Date header field successfully parse as a cookie-date:
          </p>
<blockquote class="text">
<p>Let server-date be the date obtained by parsing the contents of
            the last Date header field as a cookie-date.
</p>
<p>Let delta-seconds be the number of seconds between the
            server-date and the parsed-cookie-date (i.e., parsed-cookie-date
            - server-date).
</p>
<p>Let the expiry-time be the current date and time plus
            delta-seconds seconds.
</p>
</blockquote><p>
          Otherwise:
          </p>
<blockquote class="text">
<p>Let the expiry-time be the parsed-cookie-date.
</p>
</blockquote><p>
          
</p>
<p>If the expiry-time is later than the last date the user agent
          can represent, the user agent MAY replace the expiry-time with the
          last representable date.
</p>
<p>If the expiry-time is earlier than the first date the user agent
          can represent, the user agent MAY replace the expiry-time with the
          first representable date.
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Expires and an attribute-value of expiry-time.
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
The Domain Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Domain", the user agent MUST process the cookie-av as follows.
</p>
<p>If the attribute-value is empty, the behavior is undefined.
          However, user agent SHOULD ignore the cookie-av entirely.
</p>
<p>If the first character of the attribute-value string is U+002E
          ("."):
          </p>
<blockquote class="text">
<p>Let cookie-domain be the attribute-value without the leading
            U+002E (".") character.
</p>
</blockquote><p>
          Otherwise:
          </p>
<blockquote class="text">
<p>Let cookie-domain be the entire attribute-value.
</p>
</blockquote><p>
          
</p>
<p>Convert the cookie-domain to lower case.
</p>
<p>[TODO: Test ".127.0.0.1" and "127.0.0.1"]
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Domain and an attribute-value of
          cookie-domain.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
The Path Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Path", the user agent MUST process the cookie-av as follows.
</p>
<p>If the attribute-value is empty or if the first character of the
          attribute-value is not U+002F ("/"):
          </p>
<blockquote class="text">
<p>Let cookie-path be the default-path. [TODO: We need more tests
            for this, including with " characters and with multiple Path
            attributes.]
</p>
</blockquote><p>
          Otherwise:
          </p>
<blockquote class="text">
<p>Let cookie-path be the attribute-value.
</p>
</blockquote><p>
          
</p>
<p>Append an attribute to the cookie-attribute-list with an
          attribute-name of Path and an attribute-value of cookie-path.
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
The Secure Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "Secure", the user agent MUST append an attribute to the
          cookie-attribute-list with an attribute-name of Secure and an empty
          attribute-value.
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
The HttpOnly Attribute</h3>

<p>If the attribute-name case-insensitively matches the string
          "HttpOnly", the user agent MUST append an attribute to the
          cookie-attribute-list with an attribute-name of Secure and an empty
          attribute-value.
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Storage Model</h3>

<p>When the user agent receives a cookie, the user agent SHOULD
        record the cookie in its cookie store as follows.
</p>
<p>A user agent MAY ignore a received cookie in its entirety if the
        user agent is configured to block receiving cookies. For example, the
        user agent might wish to block receiving cookies from "third-party"
        responses.
</p>
<p>The user agent stores the following fields about each cookie: name,
        value, expiry-time, domain, path, creation-time, last-access-time,
        persistent-flag, host-only-flag, secure-only-flag, and
        http-only-flag.
</p>
<p>When the user agent receives a cookie from a Request-URI with name
        cookie-name, value cookie-value, and attributes cookie-attribute-list,
        the user agent MUST process the cookie as follows:
        </p>
<ol class="text">
<li>Create a new cookie with name cookie-name, value cookie-value.
          Set the creation-time and the last-access-time to the current date
          and time.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Expires":
          
<blockquote class="text">
<p>Set the cookie's persistent-flag to true.
</p>
<p>Set the cookie's expiry-time to attribute-value of the last
            attribute in the cookie-attribute-list with an attribute-name of
            "Expires". [TODO: Test that this really works when mixing
            Max-Age and Expires.]
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Set the cookie's persistent-flag to false.
</p>
<p>Set the cookie's expiry-time to the latest representable
            date.
</p>
</blockquote>
          
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Domain":
          
<blockquote class="text">
<p>Let the domain-attribute be the attribute-value of the last
            attribute in the cookie-attribute-list with an attribute-name of
            "Domain".
</p>
<p>If the Request-URI's host does not domain-match the
            domain-attribute, ignore the cookie entirely and abort these
            steps.
</p>
<p>If the user agent is configured to use a "public suffix" list
            and the domain-attribute is a public suffix, ignore the cookie
            entirely and abort these steps.
            </p>
<blockquote class="text">
<p>NOTE: A "public suffix" is a domain that is controlled by a
              public registry, such as "com", "co.uk", and "pvt.k12.wy.us".
              This step is essential for preventing attacker.com from
              disrupting the integrity of example.com by setting a cookie with
              a Domain attribute of "com". Unfortunately, the set of public
              suffixes (also known as "registry controlled domains") changes
              over time. If feasible, user agents SHOULD use an up-to-date
              public suffix list, such as the one maintained by the Mozilla
              project at http://publicsuffix.org/.
</p>
</blockquote>
            

<p>Set the cookie's host-only-flag to false.
</p>
<p>Set the cookie's domain to the domain-attribute.
</p>
</blockquote>
          Otherwise:
          
<blockquote class="text">
<p>Set the cookie's host-only-flag to true.
</p>
<p>Set the cookie's domain to the host of the Request-URI.
</p>
</blockquote>
          
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Path", set the cookie's path to attribute-value
          of the last attribute in the cookie-attribute-list with an
          attribute-name of "Path". Otherwise, set cookie's path to the
          default-path of the Request-URI.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "Secure", set the cookie's secure-only-flag to
          true.  Otherwise, set cookie's secure-only-flag to false.
</li>
<li>If the cookie-attribute-list contains an attribute with an
          attribute-name of "HttpOnly", set the cookie's http-only-flag to
          true.  Otherwise, set cookie's http-only-flag to false.
</li>
<li>Remove from the cookie store all cookies that share the
          same name, domain, path, and host-only-flag as the newly created
          cookie. [TODO: Validate this list!] [TODO: There's some funny
          business around http-only here.]
</li>
<li>If the cookie's name and value are both empty, abort these
          steps.
</li>
<li>If the cookie's expiry-time is not in the future, abort these
          steps.
</li>
<li>Insert the newly created cookie into the cookie store.
</li>
</ol><p>
        
</p>
<p>The user agent MUST evict a cookie from the cookie store if, at any
        time, a cookie exists in the cookie store with an expiry date in the
        past.
</p>
<p>The user agent MAY evict a cookie from the cookie store if the
        number of cookies sharing a domain field exceeds some predetermined
        upper bound (such as 50 cookies).
</p>
<p>The user agent MAY evict a cookie from the cookie store if the
        cookie store exceeds some predetermined upper bound (such as 3000
        cookies).
</p>
<p>When the user agent evicts a cookie from the cookie store, the
        user agent MUST evict cookies in the following priority order:
        </p>
<ol class="text">
<li>Cookies with an expiry date in the past.
</li>
<li>Cookies that share a domain field with more than a predetermined
          number of other cookies.
</li>
<li>All cookies.
</li>
</ol><p>
        
</p>
<p>If two cookies have the same removal priority, the user agent
        MUST evict the cookie with the least recent last-access date
        first.
</p>
<p>When "the current session is over" (as defined by the user agent),
        the user agent MUST remove from the cookie store all cookies with the
        persistent-flag set to false.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
The Cookie Header</h3>

<p>When the user agent generates an HTTP request, the user agent
        SHOULD attach exactly one HTTP header named Cookie if the
        cookie-string (defined below) for the Request-URI is non-empty.
</p>
<p>A user agent MAY elide the Cookie header in its entirety if the
        user agent is configured to block sending cookies. For example, the
        user agent might wish to block sending cookies during "third-party"
        requests.
</p>
<p>The user agent MUST use the following algorithm to compute the
        cookie-string from a cookie store and a Request-URI:
        </p>
<ol class="text">
<li>Let cookie-list be the set of cookies from the cookie store
          that meet all of the following requirements:
          
<ul class="text">
<li>Let request-host be the Request-URI's host. Either:
            
<blockquote class="text">
<p>The cookie's host-only-flag is true and the canonicalized
               request-host is identical to the cookie's domain.
</p>
</blockquote>
            Or:
            
<blockquote class="text">
<p>The cookie's host-only-flag is false and the request-host
              domain-matches cookie's domain.
</p>
</blockquote>
            
</li>
<li>The Request-URI's path patch-matches cookie's path.
</li>
<li>If the cookie's secure-only field is true, then the
            Request-URI's scheme must denote a "secure" protocol (as defined
            by the user agent).
            
<blockquote class="text">
<p>NOTE: The notion of a "secure" protocol is not defined by
              this document.  Typically, user agents consider a protocol
              secure if the protocol makes use of transport-layer security,
              such as TLS.  For example, most user agents consider "https"
              to be a scheme that denotes a secure protocol.
</p>
</blockquote>
            
</li>
<li>If the cookie's http-only field is true, then exclude the
            cookie unless the cookie-string is being generated for an
            "HTTP" API (as defined by the user agent).
</li>
</ul>
          
</li>
<li>Sort the cookie-list in the following order:
          
<ul class="text">
<li>Cookies with longer paths are listed before cookies
            with shorter paths.
</li>
<li>Among cookies that have equal length path fields, cookies
            with earlier creation-times are listed before cookies with later
            creation-times.
</li>
</ul>
          
</li>
<li>Update the last-access-time of each cookie in the cookie-list
          to the current date and time.
</li>
<li>Serialize the cookie-list into a cookie-string by processing each
          cookie in the cookie-list in order:
          
<ol class="text">
<li>If the cookie's name is non-empty, output the cookie's
            name followed by the U+003D ("=") character.
</li>
<li>Output the cookie's value.
</li>
<li>If there is an unprocessed cookie in the cookie-list, output
            the characters U+003B and U+0020 ("; ").
</li>
</ol>
          
</li>
</ol><p>
        
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Implementation Limits</h3>

<p>Practical user agent implementations have limits on the number
      and size of cookies that they can store.  General-use user agents
      SHOULD provide each of the following minimum capabilities:
      </p>
<ul class="text">
<li>At least 4096 bytes per cookie (as measured by the sum of the
        length of the cookie's name, value, and attributes).
</li>
<li>At least 50 cookies per domain.
</li>
<li>At least 3000 cookies total.
</li>
</ul><p>
      
</p>
<p>Servers SHOULD use as few and as small cookies as possible to avoid
      reaching these implementation limits and to avoid network latency due to
      the Cookie header being included in every request.
</p>
<p>Servers should gracefully degrade if the user agent fails to return
      one or more cookies in the Cookie header because the user agent might
      evict any cookie at any time on orders from the user.
</p>
<a name="anchor30"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<a name="anchor31"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Clear Text</h3>

<p>The information in the Set-Cookie and Cookie headers is
        transmitted in the clear.
        </p>
<ol class="text">
<li>All sensitive information conveyed in these headers is exposed to
          an eavesdropper.
</li>
<li>A malicious intermediary could alter the headers as they travel
          in either direction, with unpredictable results.
</li>
<li>A malicious client could alter the Cookie header before
          transmission, with unpredictable results.
</li>
</ol><p>
        
</p>
<p>Servers SHOULD encrypt and sign their cookies. However, encrypting
        and signing cookies does not prevent an attacker from transplanting a
        cookie from one user agent to another.
</p>
<p>In addition to encrypting and signing the contents of every
        cookie, servers that require a higher level of security SHOULD use the
        cookie protocol only over a secure channel.
</p>
<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Weak Confidentiality</h3>

<p>Cookies do not provide isolation by port. If a cookie is readable
        by a service running on one port, the cookie is also readable by a
        service running on another port of the same server. If a cookie is
        writable by a service on one port, the cookie is also writable by a
        service running on another port of the same server. For this reason,
        servers SHOULD NOT both run mutually distrusting services on different
        ports of the same machine and use cookies to store security-sensitive
        information.
</p>
<p>Cookies do not provide isolation by scheme. Although most commonly
        used with the http and https schemes, the cookies for a given host are
        also available to other schemes, such as ftp and gopher. This lack of
        isolation is most easily seen when a user agent retrieves a URI with a
        gopher scheme via HTTP, but the lack of isolation by scheme is also
        apparent via non-HTTP APIs that permit access to cookies, such as
        HTML's document.cookie API.
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Weak Integrity</h3>

<p>Cookies do not provide integrity guarantees for sibling domains
        (and their subdomains). For example, consider foo.example.com and
        bar.example.com. The foo.example.com server can set a cookie with a
        Domain attribute of ".example.com", and the user agent will include
        that cookie in HTTP requests to bar.example.com. In the worst case,
        bar.example.com will be unable to distinguish this cookie from a
        cookie it set itself. The foo.example.com server might be able to
        leverage this ability to mount an attack against bar.example.com.
</p>
<p>Similarly, an active network attacker can inject cookies into the
        Cookie header sent to https://example.com/ by impersonating a response
        from http://example.com/ and injecting a Set-Cookie header. The HTTPS
        server at example.com will be unable to distinguish these cookies from
        cookies that it set itself in an HTTPS response. An active network
        attacker might be able to leverage this ability to mount an attack
        against example.com even if example.com uses HTTPS exclusively.
</p>
<p>Servers can partially mitigate these attacks by encrypting and
        signing their cookies. However, using cryptography does not mitigate
        the issue completely because an attacker can replay a cookie he or she
        received from the authentic example.com server in the user's session,
        with unpredictable results.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>8.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2616">[RFC2616]</a></td>
<td class="author-text"><a href="mailto:fielding@ics.uci.edu">Fielding, R.</a>, <a href="mailto:jg@w3.org">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com">Mogul, J.</a>, <a href="mailto:frystyk@w3.org">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com">Leach, P.</a>, and <a href="mailto:timbl@w3.org">T. Berners-Lee</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>,&rdquo; RFC&nbsp;2616, June&nbsp;1999.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text"><a href="mailto:dcrocker@bbiw.net">Crocker, D., Ed.</a> and <a href="mailto:paul.overell@thus.net">P. Overell</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008.</td></tr>
</table>

<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Acknowledgements</h3>

<p>This document borrows heavily from RFC 2109.  [TODO: Figure out the
      proper way to credit the authors of RFC 2109.]
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Adam Barth</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">University of California, Berkeley</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:abarth@eecs.berkeley.edu">abarth@eecs.berkeley.edu</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.adambarth.com/">http://www.adambarth.com/</a></td></tr>
</table>
</body></html>
