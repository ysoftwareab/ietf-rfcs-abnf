





Network Working Group                                         T. Howes
Request for Comments: DRAFT                            Loudcloud, Inc.
Obsoletes: RFC 2254                                           M. Smith
Expires: May 2001                        Netscape Communications Corp.
                                                      22 November 2000


            The String Representation of LDAP Search Filters
               <draft-smith-ldapv3-filter-update-01.txt>



1.  Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.  Internet-Drafts are working
   documents of the Internet Engineering Task Force (IETF), its areas,
   and its working groups.  Note that other groups may also distribute
   working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet- Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   Discussion of this document should take place on the LDAP Extensions
   Working Group mailing list <ietf-ldapext@netscape.com>.  After
   appropriate review and discussion, this document will be submitted as
   a Standards Track replacement for RFC 2254.

Copyright Notice

   Copyright (C) The Internet Society (2000).  All Rights Reserved.

2.  Abstract

   The Lightweight Directory Access Protocol (LDAP) [1] defines a
   network representation of a search filter transmitted to an LDAP
   server.  Some applications may find it useful to have a common way of
   representing these search filters in a human-readable form.  This
   document defines a human-readable string format for representing the
   full range of possible LDAP version 3 search filters, including



Howes & Smith      Intended Category: Standards Track           [Page 1]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


   extended match filters.

   This document replaces RFC 2254.  See Appendix A for a list of
   changes relative to RFC 2254.

3.  LDAP Search Filter Definition

   An LDAPv3 search filter is defined in Section 4.5.1 of [1] as
   follows:

        Filter ::= CHOICE {
                and                [0] SET OF Filter,
                or                 [1] SET OF Filter,
                not                [2] Filter,
                equalityMatch      [3] AttributeValueAssertion,
                substrings         [4] SubstringFilter,
                greaterOrEqual     [5] AttributeValueAssertion,
                lessOrEqual        [6] AttributeValueAssertion,
                present            [7] AttributeDescription,
                approxMatch        [8] AttributeValueAssertion,
                extensibleMatch    [9] MatchingRuleAssertion
        }

        SubstringFilter ::= SEQUENCE {
                type    AttributeDescription,
                SEQUENCE OF CHOICE {
                        initial        [0] LDAPString,
                        any            [1] LDAPString,
                        final          [2] LDAPString
                }
        }

        AttributeValueAssertion ::= SEQUENCE {
                attributeDesc   AttributeDescription,
                attributeValue  AttributeValue
        }

        MatchingRuleAssertion ::= SEQUENCE {
                matchingRule    [1] MatchingRuleID OPTIONAL,
                type            [2] AttributeDescription OPTIONAL,
                matchValue      [3] AssertionValue,
                dnAttributes    [4] BOOLEAN DEFAULT FALSE
        }

        AttributeDescription ::= LDAPString

        AttributeValue ::= OCTET STRING




Howes & Smith      Intended Category: Standards Track           [Page 2]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


        MatchingRuleID ::= LDAPString

        AssertionValue ::= OCTET STRING

        LDAPString ::= OCTET STRING

   where the LDAPString above is limited to the UTF-8 encoding of the
   ISO 10646 character set [4].  The AttributeDescription is a string
   representation of the attribute description and is defined in [1].
   The AttributeValue and AssertionValue OCTET STRING have the form
   defined in [2].  The Filter is encoded for transmission over a
   network using the Basic Encoding Rules defined in [3], with
   simplifications described in [1].

4.  String Search Filter Definition

   The string representation of an LDAP search filter is defined by the
   following grammar, following the ABNF notation defined in [5].  The
   filter format uses a prefix notation.

        filter     = "(" filtercomp ")"
        filtercomp = and / or / not / item
        and        = "&" filterlist
        or         = "|" filterlist
        not        = "!" filter
        filterlist = 1*filter
        item       = simple / present / substring / extensible
        simple     = attr filtertype value
        filtertype = equal / approx / greater / less
        equal      = "="
        approx     = "~="
        greater    = ">="
        less       = "<="
        extensible = attr [":dn"] [":" matchingrule] ":=" value
                     / [":dn"] ":" matchingrule ":=" value
        present    = attr "=*"
        substring  = attr "=" [initial] any [final]
        initial    = value
        any        = "*" *(value "*")
        final      = value
        attr       = AttributeDescription from Section 4.1.5 of [1]
        matchingrule = MatchingRuleId from Section 4.1.9 of [1]
        value      = AttributeValue from Section 4.1.6 of [1] with some characters
                escaped (see below).

   The attr and matchingrule constructs are as described in the
   corresponding section of [1] given above.




Howes & Smith      Intended Category: Standards Track           [Page 3]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


   The value construct is as described in the corresponding section of
   [1] given above, except that if an AttributeValue contains any of the
   following characters

        Character       ASCII value
        ---------------------------
        *               0x2a
        (               0x28
        )               0x29
        \               0x5c
        NUL             0x00

   the character must be encoded as the backslash '\' character (ASCII
   0x5c) followed by the two hexadecimal digits representing the ASCII
   value of the encoded character. The case of the two hexadecimal
   digits is not significant.

   This simple escaping mechanism eliminates filter-parsing ambiguities
   and allows any filter that can be represented in LDAP to be
   represented as a NUL-terminated string. Other characters besides the
   ones listed above may be escaped using this mechanism, for example,
   non-printing characters.

   For example, the filter checking whether the "cn" attribute contained
   a value with the character "*" anywhere in it would be represented as
   "(cn=*\2a*)".

   Note that although both the substring and present productions in the
   grammar above can produce the "attr=*" construct, this construct is
   used only to denote a presence filter.

5.  Examples

   This section gives a few examples of search filters written using
   this notation.

        (cn=Babs Jensen)
        (!(cn=Tim Howes))
        (&(objectClass=Person)(|(sn=Jensen)(cn=Babs J*)))
        (o=univ*of*mich*)

   The following examples illustrate the use of extensible matching.

        (cn:1.2.3.4.5:=Fred Flintstone)
        (cn:=Betty Rubble)
        (sn:dn:2.4.6.8.10:=Barney Rubble)
        (o:dn:=Ace Industry)
        (:1.2.3:=Wilma Flintstone)



Howes & Smith      Intended Category: Standards Track           [Page 4]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


        (:dn:2.4.6.8.10:=Dino)

   The first example shows use of the matching rule "1.2.3.4.5".

   The second example demonstrates use of a MatchingRuleAssertion form
   without a matchingRule.

   The third example illustrates the use of the ":dn" notation to
   indicate that matching rule "2.4.6.8.10" should be used when making
   comparisons, and that the attributes of an entry's distinguished name
   should be considered part of the entry when evaluating the match.

   The fourth example denotes an equality match, except that DN
   components should be considered part of the entry when doing the
   match.

   The fifth example is a filter that should be applied to any attribute
   supporting the matching rule given (since the attr has been omitted).

   The sixth and final example is also a filter that should be applied
   to any attribute supporting the matching rule given.  Attributes
   supporting the matching rule contained in the DN should also be
   considered.

   The following examples illustrate the use of the escaping mechanism.

        (o=Parens R Us \28for all your parenthetical needs\29)
        (cn=*\2A*)
        (filename=C:\5cMyFile)
        (bin=\00\00\00\04)
        (sn=Lu\c4\8di\c4\87)
        (1.3.6.1.4.1.1466.0;binary=\04\02\48\69)

   The first example shows the use of the escaping mechanism to
   represent parenthesis characters. The second shows how to represent a
   "*" in a value, preventing it from being interpreted as a substring
   indicator. The third illustrates the escaping of the backslash
   character.

   The fourth example shows a filter searching for the four-byte value
   0x00000004, illustrating the use of the escaping mechanism to
   represent arbitrary data, including NUL characters.

   The fifth example illustrates the use of the escaping mechanism to
   represent various non-ASCII UTF-8 characters.

   The sixth and final example demonstrates assertion of a BER encoded
   value.



Howes & Smith      Intended Category: Standards Track           [Page 5]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


6.  Security Considerations

   This memo describes a string representation of LDAP search filters.
   While the representation itself has no known security implications,
   LDAP search filters do. They are interpreted by LDAP servers to
   select entries from which data is retrieved.  LDAP servers should
   take care to protect the data they maintain from unauthorized access.

   Please refer to the Security Considerations sections of RFC 2251 [1],
   RFC 2829 [6], and RFC 2830 [7] for more information.

7.  References

   [1] Wahl, M., Howes, T., and S. Kille, "Lightweight Directory Access
   Protocol (v3)", RFC 2251, December 1997.

   [2] Wahl, M., Coulbeck, A., Howes, T., and S. Kille, "Lightweight
   Directory Access Protocol (v3): Attribute Syntax Definitions", RFC
   2252, December 1997.

   [3] Specification of ASN.1 encoding rules: Basic, Canonical, and
   Distinguished Encoding Rules, ITU-T Recommendation X.690, 1994.

   [4] Yergeau, F., "UTF-8, a transformation format of ISO 10646", RFC
   2279, January 1998.

   [5] Crocker, D., "Standard for the Format of ARPA Internet Text
   Messages", STD 11, RFC 822, August 1982.

   [6] Wahl, M., Alvestrand, H., Hodges, J. and R. Morgan,
   "Authentication Methods for LDAP", RFC 2829, May 2000.

   [7] Hodges, J., Morgan, R., Wahl, M., "Lightweight Directory Access
   Protocol (v3): Extension for Transport Layer Security", RFC 2830, May
   2000.

8.  Authors' Address

   Tim Howes
   Loudcloud, Inc.
   599 N. Mathilda Ave.
   Sunnyvale, CA 94086
   USA
   +1 408 744-7509
   howes@loudcloud.com

   Mark Smith
   Netscape Communications Corp.



Howes & Smith      Intended Category: Standards Track           [Page 6]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


   Mailstop USCA17-201
   4170 Network Circle
   Santa Clara, CA 95054
   USA
   +1 650 937-3477
   mcs@netscape.com


9.  Full Copyright Statement

   Copyright (C) The Internet Society (2000).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


10.  Appendix A: Changes Since RFC 2254

10.1.  Technical Changes

   None.

10.2.  Editorial Changes

   IESG Note: removed note about lack of satisfactory mandatory
   authentication mechanisms.




Howes & Smith      Intended Category: Standards Track           [Page 7]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


   "Abstract" section: updated second paragraph to indicate that RFC
   2254 is replaced by this document (instead of RFC 1960).

   "Search Filter Definition" section:  clarified the definition of
   AttributeValue from RFC 2251 section 4.1.6 (special handling is
   required for some characters).

   "Examples" section: added three examples: (cn:=Betty Rubble),
   (:1.2.3:=Wilma Flintstone), and
   (1.3.6.1.4.1.1466.0;binary=\04\02\48\69).

   "Security Considerations" section: added references to RFC 2251, RFC
   2829, and RFC 2830.

   "References" section: added entries for RFC 2829 and RFC 2830 and
   updated UTF-8 reference to RFC 2279.

   Authors: added Mark Smith as an author and updated Tim's affiliation
   and contact information.

   "Appendix C: Loose Ends" section: added.

   "Table of Contents" section: added.


11.  Appendix B: Changes since draft-smith-ldapv3-filter-update-00.txt

Note that these changes are also listed in Appendix A, but are included
here for those who have already reviewed draft-smith-ldapv3-filter-
update-00.txt.


11.1.  Technical Changes

   "Search Filter Definition" section: removed the change made in -00
   that changed the ABNF definition of 'filterlist' from 1*filter to
   0*filter.  RFC 2251 in fact DOES NOT allow an empty filter set.
   Section 4.5.1 of 2251 says in part: "At least one filter element MUST
   be present in an


11.2.  Editorial Changes

   "Examples" section: added three examples: (cn:=Betty Rubble),
   (:1.2.3:=Wilma Flintstone), and
   (1.3.6.1.4.1.1466.0;binary=\04\02\48\69).

   "Security Considerations" section: Added references to RFC 2251 and



Howes & Smith      Intended Category: Standards Track           [Page 8]

INTERNET-DRAFT   String Representation of LDAP Filters  22 November 2000


   RFC 2830.

   "References" section: added an entry for RFC 2830.

   "Appendix C: Loose Ends" section: added.

   "Table of Contents" section: added.


12.  Appendix C: Loose Ends


   The BNF needs to be updated to use the ABNF specified in RFC 2234,
   and a reference to 2234 needs to be added.


This Internet Draft expires in May 2001.


































Howes & Smith      Intended Category: Standards Track           [Page 9]



1.     Status of this Memo............................................1
2.     Abstract.......................................................1
3.     LDAP Search Filter Definition..................................2
4.     String Search Filter Definition................................3
5.     Examples.......................................................4
6.     Security Considerations........................................6
7.     References.....................................................6
8.     Authors' Address...............................................6
9.     Full Copyright Statement.......................................7
10.    Appendix A: Changes Since RFC 2254.............................7
10.1.     Technical Changes...........................................7
10.2.     Editorial Changes...........................................7
11.    Appendix B: Changes since draft-smith-ldapv3-filter-update-00.txt8
11.1.     Technical Changes...........................................8
11.2.     Editorial Changes...........................................8
12.    Appendix C: Loose Ends.........................................9
