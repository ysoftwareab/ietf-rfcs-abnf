<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>TOTP: Time-based One-time Password Algorithm</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Scope">
<link href="#rfc.section.1.2" rel="Chapter" title="1.2 Background">
<link href="#rfc.section.2" rel="Chapter" title="2 Notation and Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Algorithm Requirements">
<link href="#rfc.section.4" rel="Chapter" title="4 TOTP Algorithm">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Notations">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Description">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 General">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Validation and Time-step Size">
<link href="#rfc.section.6" rel="Chapter" title="6 Resynchronization">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative references">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A TOTP Algorithm: Reference Implementation">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Test Vectors">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document describes an extension of one-time password (OTP) algorithm, namely the HMAC-Based One-Time Password (HOTP) Algorithm as defined in RFC 4226, to support time-based moving factor. The HOTP algorithm specifies an event based OTP algorithm where the moving factor is an event counter. The present work bases the moving factor on a time value.  A time-based variant of the OTP algorithm provides short-lived OTP values, which are desirable for enhanced security." />
  <meta name="description" content="This document describes an extension of one-time password (OTP) algorithm, namely the HMAC-Based One-Time Password (HOTP) Algorithm as defined in RFC 4226, to support time-based moving factor. The HOTP algorithm specifies an event based OTP algorithm where the moving factor is an event counter. The present work bases the moving factor on a time value.  A time-based variant of the OTP algorithm provides short-lived OTP values, which are desirable for enhanced security." />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Internet Engineering Task Force</td>
<td class="right">D. M'Raihi</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Verisign, Inc.</td>
</tr>
<tr>
<td class="left">Intended status: Informational</td>
<td class="right">S. Machani</td>
</tr>
<tr>
<td class="left">Expires: August 29, 2011</td>
<td class="right">Diversinet Corp.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">M. Pei</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Symantec</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">J. Rydell</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Portwise, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">February 25, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">TOTP: Time-based One-time Password Algorithm<br />
  <span class="filename">draft-mraihi-totp-timebased-08.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document describes an extension of one-time password (OTP) algorithm, namely the HMAC-Based One-Time Password (HOTP) Algorithm as defined in RFC 4226, to support time-based moving factor. The HOTP algorithm specifies an event based OTP algorithm where the moving factor is an event counter. The present work bases the moving factor on a time value.  A time-based variant of the OTP algorithm provides short-lived OTP values, which are desirable for enhanced security.</p>
<p>The proposed algorithm can be used across a wide range of network applications ranging from remote Virtual Private Network (VPN) access, Wi-Fi network logon to transaction-oriented Web applications. The authors believe that a common and shared algorithm will facilitate adoption of two-factor authentication on the Internet by enabling interoperability across commercial and open-source implementations.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 29, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>1.1.   <a href="#rfc.section.1.1">Scope</a>
</li>
<li>1.2.   <a href="#rfc.section.1.2">Background</a>
</li>
<li>2.   <a href="#rfc.section.2">Notation and Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Algorithm Requirements</a>
</li>
<li>4.   <a href="#rfc.section.4">TOTP Algorithm</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Notations</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">Description</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>5.1.   <a href="#rfc.section.5.1">General</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Validation and Time-step Size</a>
</li>
<li>6.   <a href="#rfc.section.6">Resynchronization</a>
</li>
<li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">Acknowledgements</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<li>9.1.   <a href="#rfc.references.1">Normative references</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">TOTP Algorithm: Reference Implementation</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Test Vectors</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#Section-Introduction" id="Section-Introduction">Introduction</a>
</h1>
<h1 id="rfc.section.1.1">
<a href="#rfc.section.1.1">1.1.</a> Scope</h1>
<p id="rfc.section.1.1.p.1">This document describes an extension of one-time password (OTP) algorithm HMAC-Based One-Time Password (HOTP) as defined in <a href="#RFC4226">[RFC4226]</a> to support time based moving factor.  </p>
<h1 id="rfc.section.1.2">
<a href="#rfc.section.1.2">1.2.</a> Background</h1>
<p id="rfc.section.1.2.p.1">As defined in <a href="#RFC4226">[RFC4226]</a> the HOTP algorithm is based on the HMAC-SHA-1 algorithm, as specified in <a href="#RFC2104">[RFC2104]</a> applied to an increasing counter value representing the message in the HMAC computation.</p>
<p id="rfc.section.1.2.p.2">Basically, the output of the HMAC-SHA-1 calculation is truncated to obtain user-friendly values:</p>
<p id="rfc.section.1.2.p.3">HOTP(K,C) = Truncate(HMAC-SHA-1(K,C))</p>
<p id="rfc.section.1.2.p.4">where Truncate represents the function that can convert an HMAC-SHA-1 value into an HOTP value.  K and C reprensent the shared secret and counter value, see <a href="#RFC4226">[RFC4226]</a> for their detail definition. <br><br></p>
<p id="rfc.section.1.2.p.5">TOTP is the time-based variant of this algorithm where a value T derived from a time reference and a time step replaces the counter C in the HOTP computation.</p>
<p id="rfc.section.1.2.p.6">TOTP implementations MAY use HMAC-SHA-256 or HMAC-SHA-512 functions, based on SHA-256 or SHA-512 [SHA2] hash functions, instead of HMAC-SHA-1 function that has been specified for HOTP computation in <a href="#RFC4226">[RFC4226]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terms" id="terms">Notation and Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a></p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#AlgorithmRequirements" id="AlgorithmRequirements">Algorithm Requirements</a>
</h1>
<p id="rfc.section.3.p.1">This section summarizes the requirements taken into account for designing the TOTP algorithm. </p>
<p id="rfc.section.3.p.2">R1 - The prover (e.g. token, soft token) and verifier (authentication or validation server) MUST know or be able to derive the current Unix time (i.e. the number of seconds elapsed since midnight UTC of January 1, 1970) for OTP generation. See [UT] for more detail definition of the commonly known "Unix time". The precision of the time used by the prover affects how often the clock synchronization should be done, see Section 6.</p>
<p id="rfc.section.3.p.3">R2 - The prover and verifier MUST either share a same secret or the knowledge of a secret transformation to generate a shared secret </p>
<p id="rfc.section.3.p.4">R3 - The algorithm MUST use HOTP [RFC4226] as a key building block. </p>
<p id="rfc.section.3.p.5">R4 - The prover and verifier MUST use the same time step value X. </p>
<p id="rfc.section.3.p.6">R5 - There MUST be a unique secret (key) for each prover. </p>
<p id="rfc.section.3.p.7">R6 - The keys SHOULD be randomly generated or derived using a key derivation algorithms. </p>
<p id="rfc.section.3.p.8">R7 - The keys MAY be stored in a tamper-resistant device and SHOULD be protected against unauthorized access and usage. </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Section-Time-based-Variant" id="Section-Time-based-Variant">TOTP Algorithm</a>
</h1>
<p id="rfc.section.4.p.1">This variant of the HOTP algorithm specifies the calculation of a one-time password value, based on a representation of the counter as a time factor.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#Notations" id="Notations">Notations</a>
</h1>
<p id="rfc.section.4.1.p.1">- X represents the time step in seconds (default value X = 30 seconds) and is a system parameter;</p>
<p id="rfc.section.4.1.p.2">- T0 is the Unix time to start counting time steps (default value is 0, Unix epoch) and is also a system parameter.</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> Description</h1>
<p id="rfc.section.4.2.p.1">Basically, we define TOTP as TOTP = HOTP(K, T) where T is an integer and represents the number of time steps between the initial counter time T0 and the current Unix time.</p>
<p id="rfc.section.4.2.p.2">More specifically T = (Current Unix time - T0) / X where:</p>
<p id="rfc.section.4.2.p.3">- X represents the time step in seconds (default value X = 30 seconds) and is a system parameter.</p>
<p id="rfc.section.4.2.p.4">- T0 is the Unix time to start counting time steps (default value is 0, Unix epoch) and is also a system parameter;</p>
<p id="rfc.section.4.2.p.5">- The default floor function is used in the computation. For example, with T0 = 0 and time step X = 30, T = 1 if the current Unix time is 59 seconds and T = 2 if the current Unix time is 60 seconds.</p>
<p id="rfc.section.4.2.p.6">The implementation of this algorithm MUST support the time value T larger than 32-bit integer when it is beyond year 2038.  The value of the system parameters X and T0 are pre-established during the provisioning process and communicated between a prover and verifier as part of the provisioning step. The provisioning flow is out of scope of this document, refer to [RFC6030] for such provisioning container specification.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#Section-Security" id="Section-Security">Security Considerations</a>
</h1>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> General</h1>
<p id="rfc.section.5.1.p.1">The security and strength of this algorithm depends on the properties of the underlying building block HOTP, which is a construction based on HMAC <a href="#RFC2104">[RFC2104]</a> using SHA-1 as the hash function. </p>
<p id="rfc.section.5.1.p.2">The conclusion of the security analysis detailed in <a href="#RFC4226">[RFC4226]</a> is that, for all practical purposes, the outputs of the dynamic truncation on distinct inputs are uniformly and independently distributed strings. </p>
<p id="rfc.section.5.1.p.3">The analysis demonstrates that the best possible attack against the HOTP function is the brute force attack. </p>
<p id="rfc.section.5.1.p.4">As indicated in the algorithm requirement section, keys SHOULD be chosen at random or using a cryptographically strong pseudo-random generator properly seeded with a random value. </p>
<p id="rfc.section.5.1.p.5">Keys SHOULD be of the length of the HMAC output to facilitate interoperability. </p>
<p id="rfc.section.5.1.p.6">We RECOMMEND following the recommendations in <a href="#RFC4086">[RFC4086]</a> for all pseudo-random and random generations. The pseudo-random numbers used for generating the keys SHOULD successfully pass the randomness test specified in <a href="#CN">[CN]</a> or a similar well-recognized test. </p>
<p id="rfc.section.5.1.p.7">All the communications SHOULD take place over a secure channel e.g. SSL/TLS [RFC5246], IPsec connections [RFC4301]. </p>
<p id="rfc.section.5.1.p.8">We also RECOMMEND storing the keys securely in the validation system, and more specifically encrypting them using tamper-resistant hardware encryption and exposing them only when required: for example, the key is decrypted when needed to verify an OTP value, and re-encrypted immediately to limit exposure in the RAM for a short period of time. </p>
<p id="rfc.section.5.1.p.9">The key store MUST be in a secure area, to avoid as much as possible direct attack on the validation system and secrets database.  Particularly, access to the key material should be limited to programs and processes required by the validation system only. </p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> Validation and Time-step Size</h1>
<p id="rfc.section.5.2.p.1">An OTP generated within the same Time-step will be the same.  When an OTP is received at a validation system, it doesn't know a client's exact timestamp when an OTP was generated. The validation system may typically use the timestamp when an OTP is received for OTP comparison. Due to the network latency for an OTP to transmit from a requesting application to a validation system and user's actual input time of an OTP to a receiving system, such timestamp gap between the actual OTP generation time and server's receiving time may be large. The receiving time at the validation system and the actual OTP generation may not fall within the same Time-step window that produce the same OTP. When an OTP is generated at the end of a Time-step window, the receiving time most likely falls into the next Time-step window.  A validation system SHOULD typically set a policy for an acceptable OTP transmission delay window for validation.  The validation system should compare OTPs not only with the receiving timestamp but also the past timesteps that are within the transmission delay. A larger acceptable delay window would introduce some OTP attack window. We RECOMMEND that at most one time step is allowed as the network delay. </p>
<p id="rfc.section.5.2.p.2">The Time-step size has impact on both security and usability.  A larger Time-step size means larger validity window for an OTP to be accepted by a validation system. There are the following implications with a larger Time-step size.</p>
<p id="rfc.section.5.2.p.3">At first, a larger Time-step size exposes larger window for attack. When an OTP is generated and exposed to a third party before it is consumed, the third party can consume the OTP within the Time-step window.</p>
<p id="rfc.section.5.2.p.4">We RECOMMEND default Time-step size for 30 seconds. This default value of 30 seconds is selected to balance between security and usability.</p>
<p id="rfc.section.5.2.p.5">Secondly, the next different OTP must be generated in the next Time-step window. A user must wait till the clock moves to the next Time-step window from the last submission. The waiting time may not be exactly the length of Time-step depending on when the last OTP was generated. For example, if the last OTP was generated at the half way in a Time-step window, the waiting time for the next OTP is half of length of Time-step. In general, a larger Time-step window means larger waiting time for a user to get the next valid OTP after the last successfully OTP validation. A too large window, for example 10 minutes, most probably won't be suitable for typical internet login use cases; a user may not be able to get the next OTP within 10 minutes and therefore re-login back to the same site in 10 minutes.</p>
<p id="rfc.section.5.2.p.6">Note that a prover may send the same OTP inside a given time window multiple times to a verifier.  The verifier MUST not accept the second attempt of the OTP after the successful validation has been issued for the first OTP, which ensures one-time only use of an OTP.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Resynchronization</h1>
<p id="rfc.section.6.p.1">Because of possible clock drifts between a client and a validation server, we RECOMMEND that the validator be set with a specific limit to the number of time steps a prover can be 'out of synch' before being rejected.</p>
<p id="rfc.section.6.p.2">This limit can be set both forward and backwards from the calculated time step on receipt of the OTP value. If the time step is 30 seconds as recommended, and the validator is set to only accept 2 time step backwards then the maximum elapsed time drift would be around 89 seconds, i.e. 29 seconds in the calculated time step and 60 for two backward time steps. </p>
<p id="rfc.section.6.p.3">This would mean the validator could perform a validation against the current time and then further two validations for each backward step (for a total of 3 validations). Upon successful validation, the validation server can record the detected clock drift for the token in terms of number of Time-step. When a new OTP is received after this step, the validator can validate the OTP with current timestamp adjusted with recorded number of Time-step clock drifts for the token.</p>
<p id="rfc.section.6.p.4">Also, it is important to note that the longer a prover has not sent an OTP to a validation system, the longer (potentially) the accumulated clock drift between the prover and the verifier. In such cases, the automatic resynchronization described above may not work if the drift exceeds the allowed threshold. Additional authentication measures should be used to safely authenticate the prover and explicitly resynchronize the clock drift between the prover and the validator.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> IANA Considerations</h1>
<p id="rfc.section.7.p.1">This document has no actions for IANA.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#Section-Acknowledgements" id="Section-Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.8.p.1">The authors of this draft would like to thank the following people for their contributions and support to make this a better specification: Hannes Tschofenig, Jonathan Tuliani, David Dix, Siddharth Bajaj, Stu Veath, Shuh Chang, Oanh Hoang, John Huang, and Siddhartha Mohapatra.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative references</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC4226">[RFC4226]</b></td>
<td class="top">
<a title="VeriSign">M'Raihi, D.</a>, <a title="UCSD">Bellare, M.</a>, <a title="Vasco">Hoornaert, F.</a>, <a title="Gemplus">Naccache, D.</a> and <a title="Aladdin">O. Ranen</a>, "<a href="http://tools.ietf.org/html/rfc4226">HOTP: An HMAC-Based One-Time Password Algorithm</a>", RFC 4226, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4086">[RFC4086]</b></td>
<td class="top">
<a title="Motorola Lab">Eastlake, D.</a>, <a title="MIT">Schiller, J.</a> and <a>S. Crocker</a>, "<a href="http://tools.ietf.org/html/rfc4086">Randomness Recommendations for Security</a>", RFC 4086, June 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>, "</tr>
<tr>
<td class="reference"><b id="RFC2104">[RFC2104]</b></td>
<td class="top">
<a title="IBM">Krawczyk, H.</a>, <a title="UCSD">Bellare, M.</a> and <a title="IBM">R. Canetti</a>, "<a href="http://tools.ietf.org/html/rfc2104">HMAC: Keyed-Hashing for Message Authentication</a>", RFC 2104, February 1997.</td>
</tr>
<tr>
<td class="reference"><b id="SHA2">[SHA2]</b></td>
<td class="top">
<a title="IBM">NIST, </a>, "<a>FIPS PUB 180-3: Secure Hash Standard (SHS)</a>", October 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="CN">[CN]</b></td>
<td class="top">
<a title="University of Luxembourg">Coron, J.S.</a> and <a title="ENS">D. Naccache</a>, "<a>An accurate evaluation of Maurer's universal test</a>", LNCS 1556, February 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4301">[RFC4301]</b></td>
<td class="top">
<a title="BBN Technologies">Kent, S.</a> and <a title="BBN Technologies">K. Seo</a>, "<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>", RFC 4301, December 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a title="Independent">Dierks, T.</a> and <a title="ETFM">E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6030">[RFC6030]</b></td>
<td class="top">
<a title="ActivIdentity">Hoyer, P.</a>, <a title="VeriSign">Pei, M.</a> and <a title="Diversinet">S. Machani</a>, "<a href="http://tools.ietf.org/html/rfc6030">Portable Symmetric Key Container (PSKC)</a>", RFC 6030, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="UT">[UT]</b></td>
<td class="top">
<a title="Wikipedia">, </a>, "<a>Unix time</a>", February 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> <a href="#Section-Reference-Impl" id="Section-Reference-Impl">TOTP Algorithm: Reference Implementation</a>
</h1>
<div id="#rfc.figure.1"></div>
<p></p>
<pre>
&lt;CODE BEGINS&gt;

/**    
Copyright (c) 2011 IETF Trust and the persons identified as authors of 
the code. All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT 
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR 
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT 
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, 
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY 
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE 
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/

import java.lang.reflect.UndeclaredThrowableException;
import java.security.GeneralSecurityException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.math.BigInteger;
import java.util.TimeZone;

/**
 * This an example implementation of the OATH TOTP algorithm. 
 * Visit www.openauthentication.org for more information.
 * 
 * @author Johan Rydell, PortWise, Inc.
 */
public class TOTP {

    private TOTP() {}

    /**
     * This method uses the JCE to provide the crypto
     * algorithm.
     * HMAC computes a Hashed Message Authentication Code with the
     * crypto hash algorithm as a parameter.
     *
     * @param crypto the crypto algorithm (HmacSHA1, HmacSHA256,
     *                            HmacSHA512)
     * @param keyBytes the bytes to use for the HMAC key
     * @param text the message or text to be authenticated.
     */
    private static byte[] hmac_sha(String crypto, byte[] keyBytes, 
            byte[] text){
        try {
            Mac hmac;
            hmac = Mac.getInstance(crypto);
            SecretKeySpec macKey =
                new SecretKeySpec(keyBytes, "RAW");
            hmac.init(macKey);
            return hmac.doFinal(text);
        } catch (GeneralSecurityException gse) {
            throw new UndeclaredThrowableException(gse);
        }
    }

    /**
     * This method converts HEX string to Byte[]
     *
     * @param hex the HEX string
     * 
     * @return A byte array  
     */
    private static byte[] hexStr2Bytes(String hex){
        // Adding one byte to get the right conversion
        // values starting with "0" can be converted
        byte[] bArray = new BigInteger("10" + hex,16).toByteArray();    

        // Copy all the REAL bytes, not the "first"
        byte[] ret = new byte[bArray.length - 1];
        for (int i = 0; i &lt; ret.length ; i++) 
            ret[i] = bArray[i+1];
        return ret;
    }


    private static final int[] DIGITS_POWER
    // 0 1  2   3    4     5      6       7        8                 
    = {1,10,100,1000,10000,100000,1000000,10000000,100000000 };


    /**
     * This method generates an TOTP value for the given
     * set of parameters.
     *
     * @param key the shared secret, HEX encoded
     * @param time a value that reflects a time 
     * @param returnDigits number of digits to return 
     * 
     * @return A numeric String in base 10 that includes
     *              {@link truncationDigits} digits 
     */
    public static String generateTOTP(String key,
            String time,
            String returnDigits){
        return generateTOTP(key, time, returnDigits, "HmacSHA1");
    }


    /**
     * This method generates an TOTP value for the given
     * set of parameters.
     *
     * @param key the shared secret, HEX encoded
     * @param time a value that reflects a time 
     * @param returnDigits number of digits to return 
     * 
     * @return A numeric String in base 10 that includes
     *              {@link truncationDigits} digits 
     */
    public static String generateTOTP256(String key,
            String time,
            String returnDigits){
        return generateTOTP(key, time, returnDigits, "HmacSHA256");
    }


    /**
     * This method generates an TOTP value for the given
     * set of parameters.
     *
     * @param key the shared secret, HEX encoded
     * @param time a value that reflects a time 
     * @param returnDigits number of digits to return 
     * 
     * @return A numeric String in base 10 that includes
     *              {@link truncationDigits} digits 
     */
    public static String generateTOTP512(String key,
            String time,
            String returnDigits){
        return generateTOTP(key, time, returnDigits, "HmacSHA512");
    }


    /**
     * This method generates an TOTP value for the given
     * set of parameters.
     *
     * @param key the shared secret, HEX encoded
     * @param time a value that reflects a time 
     * @param returnDigits number of digits to return 
     * @param crypto the crypto function to use 
     * 
     * @return A numeric String in base 10 that includes
     *              {@link truncationDigits} digits 
     */
    public static String generateTOTP(String key,
            String time,
            String returnDigits,
            String crypto){
        int codeDigits = Integer.decode(returnDigits).intValue();
        String result = null;

        // Using the counter
        // First 8 bytes are for the movingFactor
        // Complaint with base RFC 4226 (HOTP)
        while(time.length() &lt; 16 )
            time = "0" + time;

        // Get the HEX in a Byte[]
        byte[] msg = hexStr2Bytes(time);
        byte[] k = hexStr2Bytes(key);

        byte[] hash = hmac_sha(crypto, k, msg);

        // put selected bytes into result int
        int offset = hash[hash.length - 1] &amp; 0xf;

        int binary =
            ((hash[offset] &amp; 0x7f) &lt;&lt; 24) | 
            ((hash[offset + 1] &amp; 0xff) &lt;&lt; 16) | 
            ((hash[offset + 2] &amp; 0xff) &lt;&lt; 8) | 
            (hash[offset + 3] &amp; 0xff);

        int otp = binary % DIGITS_POWER[codeDigits];

        result = Integer.toString(otp);
        while (result.length() &lt; codeDigits) {
            result = "0" + result;
        }
        return result;
    }


    public static void main(String[] args) {
        // Seed for HMAC-SHA1 - 20 bytes
        String seed = "3132333435363738393031323334353637383930";
        // Seed for HMAC-SHA256 - 32 bytes
        String seed32 = "3132333435363738393031323334353637383930" +
        "313233343536373839303132"; 
        // Seed for HMAC-SHA512 - 64 bytes
        String seed64 = "3132333435363738393031323334353637383930" +
        "3132333435363738393031323334353637383930" +
        "3132333435363738393031323334353637383930" +
        "31323334";
        long T0 = 0;
        long X = 30;
        long testTime[] = {59L, 1111111109L, 1111111111L, 
                1234567890L, 2000000000L, 20000000000L};

        String steps = "0";
        DateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        df.setTimeZone(TimeZone.getTimeZone("UTC"));

        try{
            System.out.println(
                    "+---------------+-----------------------+" +
            "------------------+--------+--------+");
            System.out.println(
                    "|  Time(sec)    |   Time (UTC format)   " +
            "| Value of T(Hex)  |  TOTP  | Mode   |");
            System.out.println(
                    "+---------------+-----------------------+" +
            "------------------+--------+--------+");

            for(int i=0; i&lt;testTime.length; i++) {       
                long T = (testTime[i] - T0)/X;
                steps = Long.toHexString(T).toUpperCase();
                while(steps.length() &lt; 16) steps = "0" + steps;
                String fmtTime = String.format("%1$-11s", testTime[i]);
                String utcTime = df.format(new Date(testTime[i]*1000));
                System.out.print("|  " + fmtTime + "  |  " + utcTime +  
                        "  | " + steps + " |");
                System.out.println(generateTOTP(seed, steps, "8", 
                "HmacSHA1") + "| SHA1   |");
                System.out.print("|  " + fmtTime + "  |  " + utcTime +  
                        "  | " + steps + " |");
                System.out.println(generateTOTP(seed32, steps, "8", 
                "HmacSHA256") + "| SHA256 |");
                System.out.print("|  " + fmtTime + "  |  " + utcTime +  
                        "  | " + steps + " |");
                System.out.println(generateTOTP(seed64, steps, "8", 
                "HmacSHA512") + "| SHA512 |");

                System.out.println(
                        "+---------------+-----------------------+" +
                "------------------+--------+--------+");
            }
        }catch (final Exception e){
            System.out.println("Error : " + e);
        }
    }
}

&lt;CODE ENDS&gt;
</pre>
<p></p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#Section-Test-Vectors" id="Section-Test-Vectors">Test Vectors</a>
</h1>
<p id="rfc.section.Appendix B.p.1">This section provides test values that can be used for HOTP time-based variant algorithm interoperability test.</p>
<p id="rfc.section.Appendix B.p.2">The test token shared secret uses the ASCII string value "12345678901234567890".  With Time Step X = 30, and Unix epoch as initial value to count time steps where T0 = 0, the TOTP algorithm will display the following  values for specified modes and timestamps.</p>
<div id="#rfc.table.1"></div>
<div id="#TOTPTable"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<caption>TOTP Table</caption>
<thead><tr>
<th class="center">Time (sec)</th>
<th class="center">UTC Time</th>
<th class="center">Value of T (hex)</th>
<th class="center">TOTP</th>
<th class="center">Mode</th>
</tr></thead>
<tbody>
<tr>
<td class="center">59</td>
<td class="center">1970-01-01 00:00:59</td>
<td class="center">0000000000000001</td>
<td class="center">94287082</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">59</td>
<td class="center">1970-01-01 00:00:59</td>
<td class="center">0000000000000001</td>
<td class="center">46119246</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">59</td>
<td class="center">1970-01-01 00:00:59</td>
<td class="center">0000000000000001</td>
<td class="center">90693936</td>
<td class="center">SHA512</td>
</tr>
<tr>
<td class="center">1111111109</td>
<td class="center">2005-03-18 01:58:29</td>
<td class="center">00000000023523EC</td>
<td class="center">07081804</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">1111111109</td>
<td class="center">2005-03-18 01:58:29</td>
<td class="center">00000000023523EC</td>
<td class="center">68084774</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">1111111109</td>
<td class="center">2005-03-18 01:58:29</td>
<td class="center">00000000023523EC</td>
<td class="center">25091201</td>
<td class="center">SHA512</td>
</tr>
<tr>
<td class="center">1111111111</td>
<td class="center">2005-03-18 01:58:31</td>
<td class="center">00000000023523ED</td>
<td class="center">14050471</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">1111111111</td>
<td class="center">2005-03-18 01:58:31</td>
<td class="center">00000000023523ED</td>
<td class="center">67062674</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">1111111111</td>
<td class="center">2005-03-18 01:58:31</td>
<td class="center">00000000023523ED</td>
<td class="center">99943326</td>
<td class="center">SHA512</td>
</tr>
<tr>
<td class="center">1234567890</td>
<td class="center">2009-02-13 23:31:30</td>
<td class="center">000000000273EF07</td>
<td class="center">89005924</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">1234567890</td>
<td class="center">2009-02-13 23:31:30</td>
<td class="center">000000000273EF07</td>
<td class="center">91819424</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">1234567890</td>
<td class="center">2009-02-13 23:31:30</td>
<td class="center">000000000273EF07</td>
<td class="center">93441116</td>
<td class="center">SHA512</td>
</tr>
<tr>
<td class="center">2000000000</td>
<td class="center">2033-05-18 03:33:20</td>
<td class="center">0000000003F940AA</td>
<td class="center">69279037</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">2000000000</td>
<td class="center">2033-05-18 03:33:20</td>
<td class="center">0000000003F940AA</td>
<td class="center">90698825</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">2000000000</td>
<td class="center">2033-05-18 03:33:20</td>
<td class="center">0000000003F940AA</td>
<td class="center">38618901</td>
<td class="center">SHA512</td>
</tr>
<tr>
<td class="center">20000000000</td>
<td class="center">2603-10-11 11:33:20</td>
<td class="center">0000000027BC86AA</td>
<td class="center">65353130</td>
<td class="center">SHA1</td>
</tr>
<tr>
<td class="center">20000000000</td>
<td class="center">2603-10-11 11:33:20</td>
<td class="center">0000000027BC86AA</td>
<td class="center">77737706</td>
<td class="center">SHA256</td>
</tr>
<tr>
<td class="center">20000000000</td>
<td class="center">2603-10-11 11:33:20</td>
<td class="center">0000000027BC86AA</td>
<td class="center">47863826</td>
<td class="center">SHA512</td>
</tr>
</tbody>
</table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">David M'Raihi</span> 
	  <span class="n hidden">
		<span class="family-name">M'Raihi</span>
	  </span>
	</span>
	<span class="org vcardline">Verisign, Inc.</span>
	<span class="adr">
	  <span>685 E. Middlefield Road</span>

	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code">94043</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:davidietf@gmail.com">davidietf@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Salah Machani</span> 
	  <span class="n hidden">
		<span class="family-name">Machani</span>
	  </span>
	</span>
	<span class="org vcardline">Diversinet Corp.</span>
	<span class="adr">
	  <span>2225 Sheppard Avenue East, Suite 1801</span>

	  <span class="vcardline">
		<span class="locality">Toronto</span>,  
		<span class="region">Ontario</span> 
		<span class="code">M2J 5C2</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:smachani@diversinet.com">smachani@diversinet.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Mingliang Pei</span> 
	  <span class="n hidden">
		<span class="family-name">Pei</span>
	  </span>
	</span>
	<span class="org vcardline">Symantec</span>
	<span class="adr">
	  <span>510 E. Middlefield Road</span>

	  <span class="vcardline">
		<span class="locality">Mountain View</span>,  
		<span class="region">CA</span> 
		<span class="code">94043</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:Mingliang_Pei@symantec.com">Mingliang_Pei@symantec.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Johan Rydell</span> 
	  <span class="n hidden">
		<span class="family-name">Rydell</span>
	  </span>
	</span>
	<span class="org vcardline">Portwise, Inc.</span>
	<span class="adr">
	  <span>275 Hawthorne Ave, Suite 119</span>

	  <span class="vcardline">
		<span class="locality">Palo Alto</span>,  
		<span class="region">CA</span> 
		<span class="code">94301</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:johan.rydell@portwise.com">johan.rydell@portwise.com</a></span>

  </address>
</div>

</body>
</html>