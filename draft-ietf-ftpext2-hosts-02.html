<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>File Transfer Protocol HOST Command for Virtual Hosts</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Document Conventions">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Basic Tokens">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Server Replies">
<link href="#rfc.section.3" rel="Chapter" title="3 The HOST command">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 Syntax of the HOST command">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 HOST command semantics">
<link href="#rfc.section.3.2.1" rel="Chapter" title="3.2.1 REIN command semantics">
<link href="#rfc.section.3.2.2" rel="Chapter" title="3.2.2 User-PI usage of HOST">
<link href="#rfc.section.3.2.3" rel="Chapter" title="3.2.3 State Diagrams">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 HOST command errors">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 FEAT response for HOST command">
<link href="#rfc.section.4" rel="Chapter" title="4 Security Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 IANA Considerations">
<link href="#rfc.references" rel="Chapter" title="6 References">
<link href="#rfc.references.1" rel="Chapter" title="6.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="6.2 Informative References">
<link href="#rfc.appendix.Appendix%20A" rel="Chapter" title="Appendix A Unworkable Alternatives">
<link href="#rfc.appendix.Appendix%20A.1" rel="Chapter" title="Appendix A.1 Overloading the CWD command">
<link href="#rfc.appendix.Appendix%20A.2" rel="Chapter" title="Appendix A.2 Overloading the ACCT command">
<link href="#rfc.appendix.Appendix%20A.3" rel="Chapter" title="Appendix A.3 Overloading the USER command">
<link href="#rfc.appendix.Appendix%20A.4" rel="Chapter" title="Appendix A.4 Conclusion">
<link href="#rfc.appendix.Appendix%20B" rel="Chapter" title="Appendix B Acknowledgements">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="The File Transfer Protocol, as defined in RFC 959 [RFC0959], does not provide a way for FTP clients and servers to differentiate between multiple DNS names that are registered for a single IP address.  This document defines a new FTP command that provides a mechanism for FTP clients and servers to identify individual virtual hosts on an FTP server." />
  <meta name="description" content="The File Transfer Protocol, as defined in RFC 959 [RFC0959], does not provide a way for FTP clients and servers to differentiate between multiple DNS names that are registered for a single IP address.  This document defines a new FTP command that provides a mechanism for FTP clients and servers to identify individual virtual hosts on an FTP server." />
  <meta name="keywords" content="FTP, HOST" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">FTPEXT2 Working Group</td>
<td class="right">P. Hethmon</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Hethmon Brothers</td>
</tr>
<tr>
<td class="left">Updates: 959 (if approved)</td>
<td class="right">R. McMurray</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Microsoft Corporation</td>
</tr>
<tr>
<td class="left">Expires: August 05, 2011</td>
<td class="right">February 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">File Transfer Protocol HOST Command for Virtual Hosts<br />
  <span class="filename">draft-ietf-ftpext2-hosts-02</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>The File Transfer Protocol, as defined in RFC 959 [RFC0959], does not provide a way for FTP clients and servers to differentiate between multiple DNS names that are registered for a single IP address.  This document defines a new FTP command that provides a mechanism for FTP clients and servers to identify individual virtual hosts on an FTP server.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on August 05, 2011.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Document Conventions</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Basic Tokens</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Server Replies</a>
</li>
<li>3.   <a href="#rfc.section.3">The HOST command</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">Syntax of the HOST command</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">HOST command semantics</a>
</li>
<li>3.2.1.   <a href="#rfc.section.3.2.1">REIN command semantics</a>
</li>
<li>3.2.2.   <a href="#rfc.section.3.2.2">User-PI usage of HOST</a>
</li>
<li>3.2.3.   <a href="#rfc.section.3.2.3">State Diagrams</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">HOST command errors</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">FEAT response for HOST command</a>
</li>
<li>4.   <a href="#rfc.section.4">Security Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">IANA Considerations</a>
</li>
<li>6.   <a href="#rfc.references">References</a>
</li>
<li>6.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>6.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li>Appendix A.   <a href="#rfc.appendix.Appendix%20A">Unworkable Alternatives</a>
</li>
<li>Appendix A.1.   <a href="#rfc.appendix.Appendix%20A.1">Overloading the CWD command</a>
</li>
<li>Appendix A.2.   <a href="#rfc.appendix.Appendix%20A.2">Overloading the ACCT command</a>
</li>
<li>Appendix A.3.   <a href="#rfc.appendix.Appendix%20A.3">Overloading the USER command</a>
</li>
<li>Appendix A.4.   <a href="#rfc.appendix.Appendix%20A.4">Conclusion</a>
</li>
<li>Appendix B.   <a href="#rfc.appendix.Appendix%20B">Acknowledgements</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">It is common on the Internet for many DNS names to resolve to a single IP address.  This practice has introduced the concept of a "virtual host", where a host appears to exist as an independent entity, but in reality shares its physical resources with one or more similar hosts.</p>
<p id="rfc.section.1.p.2">Such an arrangement presents some problems for FTP servers, as an FTP server distinguishes incoming FTP connections by their IP addresses, not their DNS names, because hosts are uniquely identified by their address rather than name.  That is, all DNS names that share an IP address are handled by the same FTP server and share the same Network Virtual File System (NVFS).</p>
<p id="rfc.section.1.p.3">This means that different virtual hosts cannot offer different virtual file systems to clients, nor can they offer different authentication systems.  Any scheme to overcome this issue needs to indicate not only the destination IP address, but also the virtual host name that is associated with the desired virtual FTP server.  Typical user-FTP processes currently use hostnames to perform hostname to IP address resolution and then ignore hostnames for the rest of the FTP session, therefore any mechanism to overcome this issue would require modifications to the user-PI and server-PI.</p>
<p id="rfc.section.1.p.4">It should be noted that this same problem existed for HTTP/1.0 as defined in <a href="#RFC1945">[RFC1945]</a>, and was resolved in HTTP/1.1 as defined in <a href="#RFC2616">[RFC2616]</a> through the addition of the Host request header.  The goal of this document is to bring a similar level of feature parity to FTP by introducing a new HOST command that allows user-FTP processes to specify which virtual host to connect to for a server-FTP process that is handling requests for multiple virtual hosts on a single IP address.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Document Conventions</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<p id="rfc.section.2.p.2">In examples, "C&gt;" and "S&gt;" indicate lines sent by the client and server, respectively.</p>
<p id="rfc.section.2.p.3">This document also uses notation defined in <a href="#RFC0959">[RFC0959]</a> and <a href="#RFC1123">[RFC1123]</a>.  In particular, the terms "reply", "user", "NVFS", "NVT", "file", "pathname", "FTP commands", "DTP", "user-FTP process", "user-PI", "user-DTP", "server-FTP process", "server-PI", "server-DTP", "mode", "type", "control connection", "data connection", and "ASCII", are all used here as defined there.</p>
<p id="rfc.section.2.p.4">Syntax required is defined using the Augmented BNF defined in <a href="#RFC5234">[RFC5234]</a>.  Some general ABNF definitions are required throughout the document; those will be defined later in this section.  At first reading, it may be wise to simply recall that these definitions exist here, and skip to the next section.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Basic Tokens</h1>
<p id="rfc.section.2.1.p.1">This document imports the core definitions given in Appendix B of <a href="#RFC5234">[RFC5234]</a>.  There definitions will be found for basic ABNF elements like ALPHA, DIGIT, SP, etc.  To that, the following term is added for use in this document.</p>
<div id="#rfc.figure.1"></div>
<pre>     TCHAR = VCHAR / SP / HTAB    ; visible plus white space</pre>
<p></p>
<p id="rfc.section.2.1.p.3">The VCHAR (from <a href="#RFC5234">[RFC5234]</a>) and TCHAR rules give basic character types from varying sub-sets of the ASCII character set for use in various commands and responses.</p>
<p id="rfc.section.2.1.p.4">Note that in ABNF, string literals are case insensitive.  That convention is preserved in this document, and implies that FTP commands and parameters that are added by this specification have values that can be represented in any case.  That is, "HOST" is the same as "host", "Host", "HoSt", etc., and "ftp.example.com" is the same as "Ftp.Example.Com", "fTp.eXample.cOm", etc.</p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Server Replies</h1>
<p id="rfc.section.2.2.p.1">Section 4.2 of <a href="#RFC0959">[RFC0959]</a> defines the format and meaning of replies by the server-PI to FTP commands from the user-PI.  Those reply conventions are used here without change.</p>
<div id="#rfc.figure.2"></div>
<pre>     error-response = error-code SP *TCHAR CRLF
     error-code     = ("4" / "5") 2DIGIT</pre>
<p></p>
<p id="rfc.section.2.2.p.3">Implementers should note that the ABNF syntax (which was not used in <a href="#RFC0959">[RFC0959]</a>) used in this document, and other FTP related documents, sometimes shows replies using the one line format.  Unless otherwise explicitly stated, that is not intended to imply that multi-line responses are not permitted.  Implementers should assume that, unless stated to the contrary, any reply to any FTP command (including QUIT) can be of the multi-line format described in <a href="#RFC0959">[RFC0959]</a>.</p>
<p id="rfc.section.2.2.p.4">Throughout this document, replies will be identified by the three digit code that is their first element.  Thus the term "500 reply" means a reply from the server-PI using the three digit code "500".</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> The HOST command</h1>
<p id="rfc.section.3.p.1">A new command "HOST" is added to the FTP command set to allow the server-FTP process to determine to which of possibly many virtual hosts the client wishes to connect.  This command SHOULD be issued before the user is authenticated, allowing the authentication scheme, and set of legal users, to be dependent upon the virtual host chosen.  Server-FTP processes SHOULD treat a situation where the HOST command is issued after the user has been authenticated using one of the following two behaviors:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Treat the late HOST command as an erroneous sequence of commands and return a 503 reply.</li>
<li>Treat the late HOST command as though a REIN command was sent before the HOST command and reset the user-PI to the state that existed after the TCP connection was first established and before the initial user authentication and then return the appropriate reply for the HOST command.</li>
</ol>

<p> </p>
<p id="rfc.section.3.p.3">Servers should note that the response to the HOST command is a sensible time to send their "welcome" message.  This allows the message to be personalized for any virtual hosts that are supported, and also allows the client to determine the supported languages, or representations, for the message, and other messages, via the FEAT response, and select an appropriate one via the LANG command.  See <a href="#RFC2640">[RFC2640]</a> for more information.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> Syntax of the HOST command</h1>
<p id="rfc.section.3.1.p.1">The HOST command is defined as follows.</p>
<div id="#rfc.figure.3"></div>
<pre>  host-command  = "HOST" SP hostname CRLF
  hostname      = domain / IP-literal

  domain        = sub-domain *("." sub-domain)
  sub-domain    = let-dig [ldh-str]
  let-dig       = ALPHA / DIGIT
  ldh-str       = *( ALPHA / DIGIT / "-" ) let-dig

  IP-literal    = ( "[" IPv6address "]" ) / IPv4address

  IPv6address   =                              6( h16 ":" ) ls32
                  /                       "::" 5( h16 ":" ) ls32
                  / [               h16 ] "::" 4( h16 ":" ) ls32
                  / [ *1( h16 ":" ) h16 ] "::" 3( h16 ":" ) ls32
                  / [ *2( h16 ":" ) h16 ] "::" 2( h16 ":" ) ls32
                  / [ *3( h16 ":" ) h16 ] "::"    h16 ":"   ls32
                  / [ *4( h16 ":" ) h16 ] "::"              ls32
                  / [ *5( h16 ":" ) h16 ] "::"              h16
                  / [ *6( h16 ":" ) h16 ] "::"

  ls32          = ( h16 ":" h16 ) / IPv4address
                  ; least-significant 32 bits of address

  h16           = 1*4HEXDIG
                  ; 16 bits of address represented in hexadecimal

  IPv4address   = dec-octet "." dec-octet "." dec-octet "." dec-octet

  dec-octet     = DIGIT                 ; 0-9
                  / %x31-39 DIGIT       ; 10-99
                  / "1" 2DIGIT          ; 100-199
                  / "2" %x30-34 DIGIT   ; 200-249
                  / "25" %x30-35        ; 250-255

  host-response = host-ok / error-response
  host-ok       = "220" [ SP *TCHAR ] CRLF</pre>
<p></p>
<p id="rfc.section.3.1.p.3">As with all FTP commands, the "HOST" command word is case independent, and MAY be specified in any character case desired.</p>
<p id="rfc.section.3.1.p.4">The "hostname" (given as a parameter) specifies the virtual host to which access is desired.  This SHOULD be the same host name that was used to obtain the IP address to which the FTP control connection was made, after any client conversions have been completed that convert an abbreviated or local alias to a complete (fully qualified) domain name, but before resolving a DNS alias (owner of a CNAME resource record) to its canonical name.</p>
<p id="rfc.section.3.1.p.5">Internationalization of domain names is only supported through the use of Punycode as described in <a href="#RFC3492">[RFC3492]</a>.</p>
<p id="rfc.section.3.1.p.6">If the user was given an IPv4 or IPv6 literal address, and consequently was not required to derive the literal address from a hostname, the client MAY send the HOST command with the IPv4 or IPv6 literal address as specified to it.  While it may seem counter-intuitive to specify a literal address by using the HOST command after the client has already connected to the server using a literal address, this should be expected behavior because a user-FTP process should not be required to differentiate between a fully qualified domain name and an IPv4 or IPv6 network literal address.  That being said, if the IPv4 or IPv6 literal address specified by the client does not match the literal address for the server, the server MUST respond with a 504 reply to indicate that the IPv4 or IPv6 literal address is not valid.</p>
<p id="rfc.section.3.1.p.7">When the hostname parameter contains a literal address, square brackets are expected to disambiguate IPv6 address syntax from port numbers syntax.  Therefore, if the literal address is an IPv6 address, the IPv6 address is required to be enclosed in square brackets (after eliminating any syntax that might also - but is not required to - be enclosed in brackets, and from which the server deduced that a literal address had been specified.) For example, the following examples MAY be sent if the client had been instructed to respectively connect to "192.0.2.1", "FE80::c000:0201", or "192.0.2.1" and IPv6 syntax is preferred:</p>
<div id="#rfc.figure.4"></div>
<pre>     HOST 192.0.2.1
     HOST [FE80::c000:0201]
     HOST [::192.0.2.1]</pre>
<p></p>
<p id="rfc.section.3.1.p.9">The client MUST NOT send the port number as part of the HOST command, even when the client has been instructed to connect to a non-standard port.  The reason for this requirement is that the user-PI will have established a connection to the server-PI before the HOST command is sent, therefore specifying a different port with the HOST command has no meaning.  For example, the server-PI MUST respond with a 501 reply if the client sends a HOST command with syntax like either of the following examples:</p>
<div id="#rfc.figure.5"></div>
<pre>     HOST 192.0.2.1:2112
     HOST [FE80::c000:0201]:2112</pre>
<p></p>
<p id="rfc.section.3.1.p.11">The hostname parameter is otherwise to be treated as a fully qualified domain name or relative name as those terms are defined in section 3.1 of <a href="#RFC1034">[RFC1034]</a>.  This implies that the name is to be treated as a case-independent string, meaning that uppercase ASCII characters are to be treated as equivalent to their corresponding lowercase ASCII characters, but otherwise preserved as given.  It also implies some limits on the length of the parameter and of the components that create its internal structure.  Those limits are not altered in any way here.</p>
<p id="rfc.section.3.1.p.12">Neither <a href="#RFC1034">[RFC1034]</a> nor <a href="#RFC1035">[RFC1035]</a> impose any other restrictions upon what kinds of names can be stored in the DNS.  This specification, however, only allows the use of names that can be inferred from the ABNF grammar given for the "hostname".</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> HOST command semantics</h1>
<p id="rfc.section.3.2.p.1">Upon receiving the HOST command, before authenticating the user-PI, a server-FTP process SHOULD validate that the hostname given represents a valid virtual host for that server, and, if it is valid, establish the appropriate environment for that virtual host.  The resultant actions needed to create that environment are not specified here, and may range from doing nothing at all, to performing a simple change of working directory, to changing authentication schemes and/or username and password lists, to making much more elaborate state changes, as necessary.</p>
<p id="rfc.section.3.2.p.2">The "220" reply code for the HOST command is the same as the code that is used in the initial "welcome" message that is sent after the connection is established.  This reply code is used deliberately in order to allow the implementation of a front-end FTP server as a wrapper, which simply waits for the HOST command, and then invokes a server that is compliant with <a href="#RFC0959">[RFC0959]</a> in the appropriate environment for the particular hostname received.</p>
<p id="rfc.section.3.2.p.3">If the hostname specified would normally be acceptable, but for any reason is temporarily unavailable, the server-FTP process SHOULD reply to the HOST command with a 421 reply and close the connection.  In this particular situation, the server-FTP process MAY choose to keep the connection open in order to allow the user-PI an opportunity to choose another virtual host with a subsequent HOST command.</p>
<p id="rfc.section.3.2.p.4">If the hostname specified is unknown at the server, or if the server is otherwise unwilling to treat the particular connection as a connection to the hostname specified, the server SHOULD respond with a 504 reply.</p>
<h1 id="rfc.section.3.2.1">
<a href="#rfc.section.3.2.1">3.2.1.</a> REIN command semantics</h1>
<p id="rfc.section.3.2.1.p.1">As specified in <a href="#RFC0959">[RFC0959]</a>, the REIN command returns the state of the connection to what it was immediately after the transport connection was opened.  This specification makes no changes to that behavior.  The effect of a HOST command MUST be reset if a REIN command is performed, and a new HOST command MUST be issued in order to connect to a virtual host.</p>
<h1 id="rfc.section.3.2.2">
<a href="#rfc.section.3.2.2">3.2.2.</a> User-PI usage of HOST</h1>
<p id="rfc.section.3.2.2.p.1">A user-PI that conforms to this specification MUST send the HOST command after opening the transport connection, or after any REIN command, before attempting to authenticate the user with the USER command.  The following example illustrates what a typical login sequence might look like when the HOST command is used:</p>
<div id="#rfc.figure.6"></div>
<pre>     C&gt; HOST ftp.example.com
     S&gt; 220 Host accepted
     C&gt; USER foo
     S&gt; 331 Password required
     C&gt; PASS bar
     S&gt; 230 User logged in</pre>
<p></p>
<p id="rfc.section.3.2.2.p.3">The HOST command can be used in combination with the ACCT command to differentiate between a user's various accounts on a specific virtual host.  In this scenario, the user-PI sends a HOST command which the server-PI uses to route activity to the correct virtual host; the user-PI sends credentials using the USER and PASS commands which the server-PI validates; then, the user-PI sends an ACCT command to specify any additional account information for the server-PI implementation.  The following example illustrates a sequential series of client commands that specify both a HOST and ACCT, with the server responses omitted for brevity:</p>
<div id="#rfc.figure.7"></div>
<pre>     C&gt; HOST ftp.example.com
     C&gt; USER foo
     C&gt; PASS bar
     C&gt; ACCT project1</pre>
<p></p>
<p id="rfc.section.3.2.2.p.5">This is also true when the HOST command is used with the AUTH and ADAT commands that are discussed in <a href="#RFC2228">[RFC2228]</a> and <a href="#RFC4217">[RFC4217]</a>.  In this scenario, the user-PI sends a HOST command which the server-PI uses to route activity to the correct virtual host, then the user-PI uses the AUTH and ADAT commands to negotiate the security mechanism and certificate with the server-PI, then the user-PI sends user credentials using the USER and PASS commands which the server-PI validates.  After which the user-PI MAY send an ACCT command to specify any additional account information for the server-PI implementation.  The following example illustrates a sequential series of client commands that specify both a HOST and ACCT when used in conjunction with the security commands that are discussed in <a href="#RFC2228">[RFC2228]</a> and <a href="#RFC4217">[RFC4217]</a>, with the server responses omitted for brevity:</p>
<div id="#rfc.figure.8"></div>
<pre>     C&gt; HOST ftp.example.com
     C&gt; AUTH &lt;mechanism-name&gt;
     C&gt; ADAT &lt;base64data&gt;
     C&gt; USER foo
     C&gt; PASS bar
     C&gt; ACCT project1</pre>
<p></p>
<h1 id="rfc.section.3.2.3">
<a href="#rfc.section.3.2.3">3.2.3.</a> State Diagrams</h1>
<p id="rfc.section.3.2.3.p.1">The state diagrams in this section illustrate typical sequences for command and reply interchange between the user-PI and server-PI.  These diagrams are modeled on the similar diagrams in section 6 of <a href="#RFC0959">[RFC0959]</a>.</p>
<p id="rfc.section.3.2.3.p.2">In each diagram, the (B) "begin" state is assumed to occur after the transport connection has opened, or after a REIN command has succeeded.  Other commands (such as FEAT <a href="#RFC2389">[RFC2389]</a>) that require no authentication may have intervened.</p>
<p id="rfc.section.3.2.3.p.3">Additionally, a three-digit reply indicates a precise server reply code.  A single digit on a reply path indicates any server reply that begins with that digit, except where a precise server reply code is defined on another path.  For example, a single digit "5" will apply to "500", "501", "502", etc., when those reply codes are not expressly defined in the diagram.  For each command there are three possible outcomes: success (S), failure (F), and error (E).  In the state diagrams below we use the symbol B for "begin", and the symbol W for "wait for reply".</p>
<p id="rfc.section.3.2.3.p.4">In each of these diagrams, a REIN command will return the diagram to the (B) "begin" state.</p>
<div id="#rfc.figure.9"></div>
<p></p>

<p>The state diagram in Figure 1 shows a typical sequence of flow of control when HOST is used with USER and PASS to log in to a particular FTP virtual host.</p>
<pre>
           +---+   HOST    +---+ 1,3,5
           | B |----------&gt;| W |-----------------
           +---+           +---+                 |
                            | |                  |
                  2,500,502 | | 4,501,503,504    |
              --------------   ------------      |
             |                             |     |
             V                   1         |     V
           +---+   USER    +---+--------------&gt;+---+
           |   |----------&gt;| W | 2         |   | E |
           +---+           +---+------   -----&gt;+---+
                            | |       | |  |
                          3 | | 4,5   | |  |
              --------------   -----  | |  |
             |                      | | |  |
             |                ----------   |
             |              1|      | |    |
             V               |      |  -------&gt;+---+
           +---+   PASS    +---+ 2  |      |   | S |
           |   |----------&gt;| W |--------------&gt;+---+
           +---+           +---+    |      |
                             |      |      |
                             |4,5   |      |
                             |      |       --&gt;+---+
                             |       ---------&gt;| F |
                              ----------------&gt;+---+</pre>
<div id="#rfc.figure.10"></div>
<p></p>

<p>The state diagram in Figure 2 shows the flow of control when a HOST command is sent after a user has already successfully logged in to a virtual host with USER and PASS.</p>
<pre>
                              ------------------------------
                             |                              |
                             |                              |
                             V                              |
           +---+   HOST    +---+ 1,3,5                      |
           | B |----------&gt;| W |-----------------           |
           +---+           +---+                 |          |
                            | |                  |          |
                  2,500,502 | | 4,501,503,504    |          |
              --------------   ------------      |          |
             |                             |     |          |
             V                   1         |     V          |
           +---+   USER    +---+--------------&gt;+---+        |
           |   |----------&gt;| W | 2         |   | E |        |
           +---+           +---+------   -----&gt;+---+        |
                            | |       | |  |                |
                          3 | | 4,5   | |  |                |
              --------------   -----  | |  |                |
             |                      | | |  |                |
             |                ----------   |                |
             |               |      | |    |                |
             |              1|      | |    |                |
             V               |      |  -------&gt;+---+  HOST  |
           +---+   PASS    +---+ 2  |      |   | S |--------
           |   |----------&gt;| W |--------------&gt;+---+
           +---+           +---+    |      |
                             |      |      |
                             |4,5   |      |
                             |      |      |
                             |      |       --&gt;+---+
                             |       ---------&gt;| F |
                              ----------------&gt;+---+
</pre>
<div id="#rfc.figure.11"></div>
<p></p>

<p>After a user has logged in, an additional account may be required by the server and specified by the client by using ACCT command.  With this in mind, the state diagram in Figure 3 shows a typical sequence of flow of control when HOST is used with USER and PASS to log in to an FTP virtual host and ACCT is used to specify an account.</p>
<pre>
           +---+   HOST    +---+ 1,3,5
           | B |----------&gt;| W |-----------------
           +---+           +---+                 |
                            | |                  |
                  2,500,502 | | 4,501,503,504    |
              --------------   -------------     |
             |                              |    |
             V                   1          |    V
           +---+   USER    +---+--------------&gt;+---+
           |   |----------&gt;| W | 2       -----&gt;| E |
           +---+           +---+------  |  ---&gt;+---+
                            | |       | | | |
                          3 | | 4,5   | | | |
              --------------   -----  | | | |
             |                      | | | | |
             |                      | | | | |
             |                ----------  | |
             |              1|      | |   | |
             V               |      | |   | |
           +---+   PASS    +---+ 2  |  -------&gt;+---+
           |   |----------&gt;| W |--------------&gt;| S |
           +---+           +---+   -----------&gt;+---+
                            | |   | |     | |
                          3 | |4,5| |     | |
              --------------   --------   |  ----
             |                    | |  |  |      |
             |                    | |  |  |      |
             |                ------------       |
             |            1,3|    | |  |         |
             V               |   2| |  |         V
           +---+   ACCT    +---+--  |   ------&gt;+---+
           |   |----------&gt;| W | 4,5 ---------&gt;| F |
           +---+           +---+--------------&gt;+---+</pre>
<div id="#rfc.figure.12"></div>
<p></p>

<p>When the HOST command is used in combination with the FTP security extensions that were introduced in <a href="#RFC2228">[RFC2228]</a>, it SHOULD precede the security handshake.  This allows both user-PI and server-FTP processes to map an FTP HOST to security data appropriately.  The state diagram in Figure 4 shows a typical sequence of flow of control when HOST is used with the AUTH and ADAT commands that are discussed in <a href="#RFC2228">[RFC2228]</a>.</p>
<pre>
           +---+   HOST    +---+ 1,3,5
           | B |----------&gt;| W |------------------ 
           +---+           +---+                  |
                            | |                   |
                  2,500,502 | | 4,501,503,504     |
             +--------------   -------------      |
             |                              |     |
             V                              |     |
           +---+   AUTH    +---+ 4,5        |     |
           |   |----------&gt;| W |-----------&gt;|     |
           +---+           +---+            |     |
                       234 | |              |     |
                  ---------  | 334          |     |
                 |           |              |     |
              ---------------|-------       |     |
             |   |           |       |      |     |
             V   |           V  335  |      |     |
           +---+ | ADAT    +---+-----       |     |
           |   |----------&gt;| W | 4,5        |     |
           +---+ |         +---+-----------&gt;|     |
                 |           |              |     |
             ----         235|              |     |
            |  --------------               |     |
            | |                             |     |
            V V                  1          |     V
           +---+   USER    +---+---------------&gt;+---+
           |   |----------&gt;| W | 2          |   | E |
           +---+           +---+-------   -----&gt;+---+
                            | |        | |  |
                          3 | | 4,5    | |  |
              --------------   ------  | |  |
             |                       | | |  |
             |                -----------   |
             |              1|       | |    |
             V               |       |  -------&gt;+---+
           +---+   PASS    +---+ 2   |      |   | S |
           |   |----------&gt;| W |---------------&gt;+---+
           +---+           +---+     |      |  
                              |      |      |
                              |4,5   |      |
                              |      |       --&gt;+---+
                              |       ---------&gt;| F |
                               ----------------&gt;+---+</pre>
<div id="#rfc.figure.13"></div>
<p></p>

<p>After a user has logged in with the security commands that are discussed in <a href="#RFC2228">[RFC2228]</a>, an additional account may be required by the server and specified by the client by using ACCT command.  The state diagram in Figure 5 shows a typical sequence of flow of control when HOST is used with the AUTH and ADAT commands to log in to an FTP virtual host and ACCT is used to specify an account.</p>
<pre>
           +---+   HOST    +---+ 1,3,5
           | B |----------&gt;| W |------------------ 
           +---+           +---+                  |
                            | |                   |
                  2,500,502 | | 4,501,503,504     |
             +--------------   --------------     |
             |                               |    |
             V                               |    |
           +---+   AUTH    +---+ 4,5         |    |
           |   |----------&gt;| W |------------&gt;|    |
           +---+           +---+             |    |
                       234 | |               |    |
                  ---------  | 334           |    |
                 |           |               |    |
              ---------------|-------        |    |
             |   |           |       |       |    |
             V   |           V  335  |       |    |
           +---+ | ADAT    +---+-----        |    |
           |   |----------&gt;| W | 4,5         |    |
           +---+ |         +---+------------&gt;|    |
                 |           |               |    |
             ----         235|               |    |
            |  --------------                |    |
            | |                              |    |
            V V                  1           |    V
           +---+   USER    +---+---------------&gt;+---+
           |   |----------&gt;| W | 2        -----&gt;| E |
           +---+           +---+-------  |  ---&gt;+---+
                            | |        | | | |
                          3 | | 4,5    | | | |
              --------------   ------  | | | |
             |                       | | | | |
             |                -----------  | |
             |              1|       | |   | |
             V               |       | |   | |
           +---+   PASS    +---+ 2   |  -------&gt;+---+
           |   |----------&gt;| W |---------------&gt;| S |
           +---+           +---+   ------------&gt;+---+
                            | |   |  |     | |
                          3 | |4,5|  |     | |
              --------------   ---------   |  ----
             |                    |  |  |  |      |
             |                -------------       |
             |            1,3|    |  |  |         |
             V               |   2|  |  |         V
           +---+   ACCT    +---+--   |   ------&gt;+---+
           |   |----------&gt;| W | 4,5  ---------&gt;| F |
           +---+           +---+---------------&gt;+---+</pre>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> HOST command errors</h1>
<p id="rfc.section.3.3.p.1">The server-PI SHOULD reply with a 500 or 502 reply if the HOST command is unrecognized or unimplemented.</p>
<p id="rfc.section.3.3.p.2">As discussed in section 3 of this document, if a HOST command is sent after a user has been authenticated the server SHOULD do one of the following:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Send a 503 reply for an invalid sequence of commands.</li>
<li>Treat the HOST command as though a REIN command was sent and reset the user-PI to the state that existed after the previous HOST command was sent and before the user had been authenticated, and then return the appropriate reply for the HOST command.</li>
</ol>

<p> </p>
<p id="rfc.section.3.3.p.4">A 501 reply SHOULD be sent if the hostname given is syntactically invalid, and a 504 reply SHOULD be sent if a syntactically valid hostname is not a valid virtual host name for the server.  In all such cases, the server-FTP process MUST do one of the following:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Ignore the HOST command and act as if a HOST command had not been sent.  A user-FTP process MAY then send a subsequent HOST command with a different hostname.</li>
<li>Close the connection.</li>
</ol>

<p> </p>
<p id="rfc.section.3.3.p.6">A user-PI receiving a 500 or 502 reply to a HOST command SHOULD assume that the server-PI does not implement virtual servers by using the HOST command.  The user-PI MAY then proceed to login as if the HOST command had not been sent.</p>
<p id="rfc.section.3.3.p.7">A user-PI receiving an error reply that is different from the errors that have been described here SHOULD assume that the virtual HOST is unavailable, and terminate communications.</p>
<p id="rfc.section.3.3.p.8">A server-PI that receives a USER command to begin the authentication sequence without having received a HOST command SHOULD NOT reject the USER command.  Clients conforming to earlier FTP specifications do not send HOST commands.  In this case the server MAY act as if some default virtual host had been explicitly selected, or MAY enter an environment that is different from that of any supported virtual hosts, perhaps one in which a union of all available accounts exists and which presents an NVFS that appears to contain subdirectories that contain the NVFS for all supported virtual hosts.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> FEAT response for HOST command</h1>
<p id="rfc.section.3.4.p.1">When replying to the FEAT command <a href="#RFC2389">[RFC2389]</a>, a server-FTP process that supports the HOST command MUST include a line containing the single word "HOST".  This word is case insensitive, and MAY be sent in any mixture of upper or lower case, however it SHOULD be sent in upper case.  That is, the response SHOULD be:</p>
<div id="#rfc.figure.14"></div>
<pre>     C&gt; FEAT
     S&gt; 211- &lt;any descriptive text&gt;
     S&gt;  ...
     S&gt;  HOST
     S&gt;  ...
     S&gt; 211 End</pre>
<p></p>
<p id="rfc.section.3.4.p.3">The ellipses indicate place holders where other features may be included, and are not required.  The one-space indentation of the feature lines is mandatory <a href="#RFC2389">[RFC2389]</a>.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#Security" id="Security">Security Considerations</a>
</h1>
<p id="rfc.section.4.p.1">With the introduction of virtual hosts to FTP, server implementers will need to take some care to ensure that the integrity of potentially sensitive information is maintained.  For example, while hostnames may generally be assumed to be publicly available DNS names, this may not always be the situation.  Some organizations may use private hostnames, and that information SHOULD be protected when transmitted between the client and server by using a strong method of encryption.</p>
<p id="rfc.section.4.p.2">Server implementations SHOULD reset the security environment when a HOST command is sent after a user has logged in.  This allows for individual authentication environments for each virtual host on an FTP server.  For example, a virtual host "foo.example.com" on an FTP server might use a specific username and password list, while the virtual host "bar.example.com" on the same FTP server might use a different username and password list.  In such a scenario, resetting the security environment is necessary for virtual servers to appear to behave independently.</p>
<p id="rfc.section.4.p.3">A general discussion of issues related to the security of FTP can be found in <a href="#RFC2577">[RFC2577]</a>.</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#IANA" id="IANA">IANA Considerations</a>
</h1>
<p id="rfc.section.5.p.1">IANA is requested to register the following FTP extension according to the procedure established by <a href="#RFC5797">[RFC5797]</a>:</p>
<div id="#rfc.table.1"></div>
<table cellpadding="3" cellspacing="0" class="tt full center">
<thead><tr>
<th class="left">cmd</th>
<th class="left">FEAT Code</th>
<th class="left">description</th>
<th class="left">type</th>
<th class="left">conf</th>
<th class="left">RFC#s/References and Notes</th>
</tr></thead>
<tbody><tr>
<td class="left">HOST</td>
<td class="left">HOST</td>
<td class="left">Hostname</td>
<td class="left">a</td>
<td class="left">o</td>
<td class="left">TBD</td>
</tr></tbody>
</table>
<p>NOTE TO RFC EDITOR: Please update TBD in the above table with the number of this document.</p>
<h1 id="rfc.references">
<a href="#rfc.references">6.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">6.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC0959">[RFC0959]</b></td>
<td class="top">
<a>Postel, J.</a> and <a>J. Reynolds</a>, "<a href="http://tools.ietf.org/html/rfc959">File Transfer Protocol (FTP)</a>", STD 9, RFC 959, October 1985.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1034">[RFC1034]</b></td>
<td class="top">
<a>Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1034">Domain Names - Concepts and Facilities</a>", STD 13, RFC 1034, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1035">[RFC1035]</b></td>
<td class="top">
<a>Mockapetris, P.</a>, "<a href="http://tools.ietf.org/html/rfc1035">Domain Names - Implementation and Specification</a>", STD 13, RFC 1035, November 1987.</td>
</tr>
<tr>
<td class="reference"><b id="RFC1123">[RFC1123]</b></td>
<td class="top">
<a>Braden, R.</a>, "<a href="http://tools.ietf.org/html/rfc1123">Requirements for Internet Hosts -- Application and Support</a>", STD 3, RFC 1123, October 1989.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2228">[RFC2228]</b></td>
<td class="top">
<a>Horowitz, M.</a> and <a>S. Lunt</a>, "<a href="http://tools.ietf.org/html/rfc2228">FTP Security Extensions</a>", RFC 2228, October 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2389">[RFC2389]</b></td>
<td class="top">
<a>Hethmon, P.</a> and <a>R. Elz</a>, "<a href="http://tools.ietf.org/html/rfc2389">Feature negotiation mechanism for the File Transfer Protocol</a>", RFC 2389, August 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2640">[RFC2640]</b></td>
<td class="top">
<a>Curtin, W.</a>, "<a href="http://tools.ietf.org/html/rfc2640">Internationalization of the File Transfer Protocol</a>", RFC 2640, July 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3492">[RFC3492]</b></td>
<td class="top">
<a>Costello, A.</a>, "<a href="http://tools.ietf.org/html/rfc3492">Punycode: A Bootstring encoding of Unicode for Internationalized Domain Names in Applications (IDNA)</a>", RFC 3492, March 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4217">[RFC4217]</b></td>
<td class="top">
<a>Ford-Hutchinson, P.</a>, "<a href="http://tools.ietf.org/html/rfc4217">Securing FTP with TLS</a>", RFC 4217, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", RFC 5234, January 2008.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">6.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC1945">[RFC1945]</b></td>
<td class="top">
<a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>H. Frystyk</a>, "<a href="http://tools.ietf.org/html/rfc1945">Hypertext Transfer Protocol -- HTTP/1.0</a>", RFC 1945, May 1996.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2577">[RFC2577]</b></td>
<td class="top">
<a>Allman, M.</a> and <a>S. Ostermann</a>, "<a href="http://tools.ietf.org/html/rfc2577">FTP Security Considerations</a>", RFC 2577, May 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a>Fielding, R.</a>, <a>Gettys, J.</a>, <a>Mogul, J.</a>, <a>Frystyk, H.</a>, <a>Masinter, L.</a>, <a>Leach, P.</a> and <a>T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5797">[RFC5797]</b></td>
<td class="top">
<a>Klensin, J.</a> and <a>A. Hoenes</a>, "<a href="http://tools.ietf.org/html/rfc5797">FTP Command and Extension Registry</a>", RFC 5797, March 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.Appendix A">
<a href="#rfc.appendix.Appendix%20A">Appendix A.</a> Unworkable Alternatives</h1>
<p id="rfc.section.Appendix A.p.1">Due to the level of scope for adding a new command to FTP, a brief discussion of suggested alternatives to a HOST command and their respective limitations is warranted.  The suggested alternatives that are discussed in this appendix have been proposed in the past, but each of these ideas was deemed insufficient for the reasons that are listed within each section of the appendix.</p>
<h1 id="rfc.appendix.Appendix A.1">
<a href="#rfc.appendix.Appendix%20A.1">Appendix A.1.</a> Overloading the CWD command</h1>
<p id="rfc.section.Appendix A.1.p.1">One suggested method to emulate a form of virtual hosts would be for the client to simply send a "CWD" command after connecting, using the virtual host name as the argument to the CWD command.  This would allow the server-FTP process to implement the file stores of the virtual hosts as sub-directories in its NVFS.  This suggestion is simple in concept, and most server-FTP implementations support this without requiring any code changes.  While this method is simple to describe, and to implement, it suffers from several drawbacks:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>The "CWD" command is available only after the user-PI has authenticated itself to the server-FTP process.  Thus, all virtual hosts would be required to share a common authentication scheme if they used this method.</li>
<li>To make the virtual host truly transparent, either the server-FTP process needs to be modified to include information that shows the special nature of this first CWD command (negating most of the advantage of this scheme), or all users must see the same identical NVFS view upon connecting (they must connect in the same initial directory), or the NVFS must implement the full set of virtual host directories at each possible initial directory for any possible user.</li>
<li>Unless the server is specially modified, a user connecting this way to a virtual host would be able to easily move to any other virtual host supported at the same server-FTP process, exposing the nature of the virtual host.</li>
</ol>

<p> </p>
<h1 id="rfc.appendix.Appendix A.2">
<a href="#rfc.appendix.Appendix%20A.2">Appendix A.2.</a> Overloading the ACCT command</h1>
<p id="rfc.section.Appendix A.2.p.1">Another suggested method would be to simply overload the "ACCT" for FTP virtual hosts, but this proposal is unacceptable for several reasons with regard to when the ACCT command is sent during the request flow.  Sections 5.4 and 6 of <a href="#RFC0959">[RFC0959]</a> document the request flow for a login sequence as USER -&gt; PASS -&gt; ACCT.  This flow of commands may be acceptable when you are considering a single user having multiple accounts on an FTP server, but fails to differentiate between virtual hosts when you consider the following two issues:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>The first problem with overloading the ACCT command is certificate negotiation when using the FTP security extensions that are documented in <a href="#RFC2228">[RFC2228]</a> and <a href="#RFC4217">[RFC4217]</a>.  In order to safeguard user credentials, security mechanism and certificate negotiation must occur before login credentials are sent by the client.  The problem with using the ACCT command in this scenario is that there is no way of ensuring that the certificate matches the correct virtual host before the user credentials are sent.</li>
<li>The second problem with overloading the ACCT command is how user credentials are implemented for FTP virtual hosts.  FTP server implementations may allow the use of custom user credentials on a per-virtual-host basis.  For example, in one particular implementation the virtual host negotiation occurs, and then the user credentials are looked up using the account mechanism that is specific to that virtual host.  So once again the virtual host negotiation must take place before the user credentials are sent.</li>
</ol>

<p> </p>
<h1 id="rfc.appendix.Appendix A.3">
<a href="#rfc.appendix.Appendix%20A.3">Appendix A.3.</a> Overloading the USER command</h1>
<p id="rfc.section.Appendix A.3.p.1">An additional suggestion would be to overload well-known syntax through the existing USER command, as illustrated in the following example:</p>
<div id="#rfc.figure.15"></div>
<pre>     C&gt; USER foo@example.com
     S&gt; 331 Password required
     C&gt; PASS bar
     S&gt; 230 User logged in</pre>
<p></p>
<p id="rfc.section.Appendix A.3.p.3">In this example, the user "foo" might be attempting to log on to the virtual host "example.com" on an FTP server.  This suggestion may seem plausible at first, but introduces several implementation problems.  For example:</p>
<p></p>

<ol style="list-style-type: lower-alpha">
<li>Some network environments already use the "username@hostname" syntax for network credentials, where the "hostname" portion refers to the location of the user's credentials within the network hierarchy.  Using the "foo@example.com" syntax it becomes difficult to differentiate between the user "foo" logging into a virtual host named "example.com" on an FTP server versus the user "foo@example.com" logging into an FTP server with no specified virtual host.</li>
<li>When using the FTP security extensions that are documented in <a href="#RFC2228">[RFC2228]</a> and <a href="#RFC4217">[RFC4217]</a>, security mechanism and certificate negotiation must occur before login credentials are sent by the client.  More specifically, the AUTH/ADAT commands must be sent before the USER command in order to safeguard user credentials.  If you overload the USER command, there is no way of ensuring that the certificate matches the correct virtual host before the user credentials are sent by the client.</li>
</ol>

<p> </p>
<h1 id="rfc.appendix.Appendix A.4">
<a href="#rfc.appendix.Appendix%20A.4">Appendix A.4.</a> Conclusion</h1>
<p id="rfc.section.Appendix A.4.p.1">The conclusion from the examination of the existing possibilities seems to be that in order to obtain an adequate emulation of "real" FTP servers, client and server modifications to support virtual hosts are necessary.  Therefore a new FTP command seems the most likely solution to provide the required level of support.</p>
<h1 id="rfc.appendix.Appendix B">
<a href="#rfc.appendix.Appendix%20B">Appendix B.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a>
</h1>
<p id="rfc.section.Appendix B.p.1">Robert Elz and Paul Hethmon provided a detailed discussion of the HOST command in their Internet draft titled "Extensions to FTP" as part of their work with the FTPEXT Working Group at the IETF.  Their work formed the basis for much of this document, and their help has been greatly appreciated.  They would also like to credit Bernhard Rosenkraenzer for having first suggested and described the HOST command.</p>
<p id="rfc.section.Appendix B.p.2">Alexey Melnikov, Alfred Hoenes, John Klensin, and Joe Touch have made several suggestions about earlier versions of this document; many of their suggestions have been incorporated, and their contributions are gratefully acknowledged.  In addition, Alec Rowell's assistance in making sections of this document more readable was invaluable.</p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Paul Hethmon</span> 
	  <span class="n hidden">
		<span class="family-name">Hethmon</span>
	  </span>
	</span>
	<span class="org vcardline">Hethmon Brothers</span>
	<span class="adr">
	  <span>2305 Chukar Road</span>

	  <span class="vcardline">
		<span class="locality">Knoxville</span>,  
		<span class="region">TN</span> 
		<span class="code">37923</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:phethmon@hethmon.com">phethmon@hethmon.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Robert McMurray</span> 
	  <span class="n hidden">
		<span class="family-name">McMurray</span>
	  </span>
	</span>
	<span class="org vcardline">Microsoft Corporation</span>
	<span class="adr">
	  <span>One Microsoft Way</span>

	  <span class="vcardline">
		<span class="locality">Redmond</span>,  
		<span class="region">WA</span> 
		<span class="code">98052</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:robmcm@microsoft.com">robmcm@microsoft.com</a></span>

  </address>
</div>

</body>
</html>