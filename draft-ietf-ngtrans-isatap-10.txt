


NGTRANS Working Group                                         F. Templin
Internet-Draft                                                     Nokia
Expires: July 4, 2002                                         T. Gleeson
                                                      Cisco Systems K.K.
                                                               M. Talwar
                                                               D. Thaler
                                                   Microsoft Corporation
                                                        January 03, 2002


        Intra-Site Automatic Tunnel Addressing Protocol (ISATAP)
                    draft-ietf-ngtrans-isatap-10.txt

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as
   Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on July 4, 2002.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

Abstract

   This document specifies an Intra-Site Automatic Tunnel Addressing
   Protocol (ISATAP) that connects IPv6 hosts and routers within IPv4
   sites.  ISATAP treats the site's IPv4 infrastructure as a link layer
   for IPv6 with no requirement for IPv4 multicast.  ISATAP enables
   intra-site automatic IPv6-in-IPv4 tunneling whether globally assigned
   or private IPv4 addresses are used.




Templin, et al.           Expires July 4, 2002                  [Page 1]

Internet-Draft                   ISATAP                     January 2002


Table of Contents

   1.    Introduction . . . . . . . . . . . . . . . . . . . . . . . .  3
   2.    Applicability Statement  . . . . . . . . . . . . . . . . . .  3
   3.    Requirements . . . . . . . . . . . . . . . . . . . . . . . .  3
   4.    Terminology  . . . . . . . . . . . . . . . . . . . . . . . .  4
   5.    Non-Broadcast, Multiple Access (NBMA) Operation  . . . . . .  4
   5.1   Multicast  . . . . . . . . . . . . . . . . . . . . . . . . .  5
   5.2   Interface Identifiers and Address Construction . . . . . . .  5
   5.3   ISATAP Link/Interface Configuration  . . . . . . . . . . . .  5
   5.4   Link Layer Address Options . . . . . . . . . . . . . . . . .  6
   6.    Automatic Tunneling  . . . . . . . . . . . . . . . . . . . .  6
   6.1   Dual IP Layer Operation  . . . . . . . . . . . . . . . . . .  6
   6.2   Encapsulation  . . . . . . . . . . . . . . . . . . . . . . .  6
   6.3   Tunnel MTU and Fragmentation . . . . . . . . . . . . . . . .  7
   6.4   Handling IPv4 ICMP Errors  . . . . . . . . . . . . . . . . .  8
   6.5   Local-Use IPv6 Unicast Addresses . . . . . . . . . . . . . .  8
   6.6   Ingress Filtering  . . . . . . . . . . . . . . . . . . . . .  8
   7.    Neighbor Discovery for ISATAP Links  . . . . . . . . . . . .  8
   7.1   Address Resolution . . . . . . . . . . . . . . . . . . . . .  9
   7.2   Router and Prefix Discovery  . . . . . . . . . . . . . . . .  9
   7.2.1 Conceptual Data Structures . . . . . . . . . . . . . . . . .  9
   7.2.2 Validity Checks for Router Advertisements  . . . . . . . . . 10
   7.2.3 Router Specification . . . . . . . . . . . . . . . . . . . . 11
   7.2.4 Host Specification . . . . . . . . . . . . . . . . . . . . . 11
   8.    ISATAP Deployment Considerations . . . . . . . . . . . . . . 12
   8.1   Host And Router Deployment Considerations  . . . . . . . . . 12
   8.2   Site Administration Considerations . . . . . . . . . . . . . 12
   9.    IANA Considerations  . . . . . . . . . . . . . . . . . . . . 13
   10.   Security considerations  . . . . . . . . . . . . . . . . . . 13
   11.   Acknowledgements . . . . . . . . . . . . . . . . . . . . . . 14
         Normative References . . . . . . . . . . . . . . . . . . . . 14
         Informative References . . . . . . . . . . . . . . . . . . . 15
         Authors' Addresses . . . . . . . . . . . . . . . . . . . . . 16
   A.    Major Changes  . . . . . . . . . . . . . . . . . . . . . . . 17
   B.    Rationale for Interface Identifier Construction  . . . . . . 18
   C.    Dynamic Per-neighbor MTU Discovery . . . . . . . . . . . . . 19
         Intellectual Property and Copyright Statements . . . . . . . 21













Templin, et al.           Expires July 4, 2002                  [Page 2]

Internet-Draft                   ISATAP                     January 2002


1. Introduction

   This document presents a simple approach that enables incremental
   deployment of IPv6 [1] within IPv4-based [2] sites.  We refer to this
   approach as the Intra-Site Automatic Tunnel Addressing Protocol
   (ISATAP).  ISATAP allows dual-stack nodes that do not share a
   physical link with an IPv6 router to automatically tunnel packets to
   the IPv6 next-hop address through IPv4, i.e., the site's IPv4
   infrastructure is treated as a link layer for IPv6.

   This document specifies details for the operation of IPv6 over ISATAP
   links (i.e., automatic IPv6-in-IPv4 tunneling), including an
   interface identifier format that embeds an IPv4 address.  This format
   supports IPv6 protocol mechanisms for address configuration as well
   as simple link-layer address mapping.  Also specified in this
   document is the operation of IPv6 Neighbor Discovery for ISATAP.  The
   document finally presents deployment and security considerations.

2. Applicability Statement

   ISATAP provides the following features:

   o  treats site's IPv4 infrastructure as a link layer for IPv6 using
      automatic IPv6-in-IPv4 tunneling (i.e., no configured tunnel
      state)

   o  enables incremental deployment of IPv6 hosts within IPv4 sites
      with no aggregation scaling issues at border gateways

   o  requires no special IPv4 services within the site (e.g.,
      multicast)

   o  supports both stateless address autoconfiguration and manual
      configuration

   o  supports networks that use non-globally unique IPv4 addresses
      (e.g., when private address allocations [3] are used), but does
      not allow the virtual ISATAP link to span a Network Address
      Translator [4]

   o  compatible with other NGTRANS mechanisms (e.g., 6to4 [19])


3. Requirements

   The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD,
   SHOULD NOT, RECOMMENDED, MAY, and OPTIONAL, when they appear in this
   document, are to be interpreted as described in [5].



Templin, et al.           Expires July 4, 2002                  [Page 3]

Internet-Draft                   ISATAP                     January 2002


   This document also makes use of internal conceptual variables to
   describe protocol behavior and external variables that an
   implementation must allow system administrators to change.  The
   specific variable names, how their values change, and how their
   settings influence protocol behavior are provided to demonstrate
   protocol behavior.  An implementation is not required to have them in
   the exact form described here, so long as its external behavior is
   consistent with that described in this document.

4. Terminology

   The terminology of RFC 2460 [1] applies to this document.  The
   following additional terms are defined:

   link, on-link, off-link:
      same definitions as ([6], section 2.1).

   underlying link:
      a link layer that supports IPv4 (for ISATAP), and MAY also support
      IPv6 natively.

   ISATAP link:
      one or more underlying links used for tunneling.  The IPv4 network
      layer addresses of the underlying links are used as link-layer
      addresses on the ISATAP link.

   ISATAP interface:
      a node's attachment to an ISATAP link.

   ISATAP address:
      an on-link address on an ISATAP interface and with an interface
      identifier constructed as specified in Section 5.2

   ISATAP router:
      an IPv6 node that has an ISATAP interface over which it forwards
      packets not explicitly addressed to itself.

   ISATAP host:
      any node that has an ISATAP interface and is not an ISATAP router.


5. Non-Broadcast, Multiple Access (NBMA) Operation

   ISATAP links transmit IPv6 packets via automatic tunnels using the
   site's IPv4 infrastructure as a link layer for IPv6, i.e., IPv6
   treats the site's IPv4 infrastructure as a Non-Broadcast, Multiple
   Access (NBMA) link layer.  RFC 2491 [7] provides a general
   architecture for IPv6 over NBMA networks that forms the basis for



Templin, et al.           Expires July 4, 2002                  [Page 4]

Internet-Draft                   ISATAP                     January 2002


   companion documents such as the present.  The following subsections
   present NBMA considerations for IPv6 on ISATAP links:

5.1 Multicast

   ISATAP links most closely meet the description for connectionless
   service found in the last paragraph of ([7], section 1), i.e., ISATAP
   addresses provide the sender with an NBMA destination address to
   which it can transmit packets whenever it desires.  Thus, multicast
   emulation mechanisms are not required to support host-side operation
   of the IPv6 neighbor discovery protocol.

5.2 Interface Identifiers and Address Construction

   ([7], section 5.1) requires companion documents to specify the exact
   mechanism for generating interface tokens (i.e., identifiers).
   Interface identifiers for ISATAP are compatible with the EUI-64
   identifier format ([8], section 2.5.1), and are constructed by
   appending an IPv4 address on the ISATAP link to the 32-bit string
   '00-00-5E-FE'.  (Appendix B includes non-normative text explaining
   the rationale for this construction rule.)

   Global and Local-use ISATAP addresses are constructed as follows:

    |           64 bits            |     32 bits   |    32 bits     |
    +------------------------------+---------------+----------------+
    | global or local-use unicast  |   0000:5EFE   |  IPv4 Address  |
    |            prefix            |               | of ISATAP link |
    +------------------------------+---------------+----------------+

                                Figure 1

   For example, the global unicast address:

      3FFE:1A05:510:1111:0:5EFE:8CAD:8108

   has a prefix of '3FFE:1A05:510:1111::/64' and an ISATAP interface
   identifier with embedded IPv4 address: '140.173.129.8'.  The address
   is alternately written as:

      3FFE:1A05:510:1111:0:5EFE:140.173.129.8

   Examples for local-use addresses are obvious from the above and with
   reference to ([8], section 2.5.6).

5.3 ISATAP Link/Interface Configuration

   ISATAP Link/Interface configuration is consistent with ([7], sections



Templin, et al.           Expires July 4, 2002                  [Page 5]

Internet-Draft                   ISATAP                     January 2002


   5.1.1 and 5.1.2).

   An ISATAP link consists of one or more underlying links that support
   IPv4 for tunneling within a site.  ISATAP interfaces are configured
   over ISATAP links; each IPv4 address assigned to an underlying link
   is seen as a link-layer address for ISATAP.

5.4 Link Layer Address Options

   ([7], section 5.2) requires companion documents to specify the
   contents of the [NTL], [STL], [NBMA Number] and [NBMA Subaddress]
   fields for link layer address options.  For ISATAP links:

   o  the [NTL] and [STL] fields MUST be zero

   o  the [NBMA Number] encodes a 4-octet IPv4 address

   o  the [NBMA Subaddress] field is omitted

   ([7], section 5.2) does NOT require companion documents to specify
   the value for [Length], i.e., the total length of the option in 8
   octets.  Senders may therefore set [Length] to any value between 1
   and 255; when [Length] is greater than 1, receivers treat any bytes
   that follow the [NBMA Number] as null-padding.

6. Automatic Tunneling

   The common tunneling mechanisms specified in ([9], sections 2 and 3)
   are used, with the following noted specific considerations for
   ISATAP:

6.1 Dual IP Layer Operation

   ISATAP uses the same specification found in ([9], section 2).  That
   is, ISATAP nodes provide complete IPv4 and IPv6 implementations and
   are able to send and receive both IPv4 and IPv6 packets.  ISATAP
   nodes operate with both their IPv4 and IPv6 stacks enabled.

   Address configuration considerations are the same as for ([9],
   section 2.1).  Additionally, ISATAP nodes require that IPv4 address
   configuration take place on at least one underlying link prior to
   IPv6 address configuration on an ISATAP link.

   DNS considerations are the same as ([9], sections 2.2 and 2.3).

6.2 Encapsulation

   The specification in ([9], section 3.1) is used.  Additionally, the



Templin, et al.           Expires July 4, 2002                  [Page 6]

Internet-Draft                   ISATAP                     January 2002


   IPv6 next-hop address for packets sent on an ISATAP link MUST be an
   ISATAP address; other packets are discarded and an ICMPv6 destination
   unreachable indication with code 3 (Address Unreachable) [10] is
   returned to the source.

6.3 Tunnel MTU and Fragmentation

   The specification in ([9], section 3.2) is NOT used; the
   specification in this section is used instead.

   ISATAP uses automatic tunnel interfaces that may be configured over
   multiple underlying links with diverse maximum transmission units
   (MTUs).  The minimum MTU for IPv6 interfaces is 1280 bytes ([1],
   Section 5), but the following considerations for the MTU of ISATAP
   interfaces apply:

   o  Nearly all IPv4 nodes connect to physical links with MTUs of 1500
      bytes or larger (e.g., Ethernet)

   o  Sub-IPv4 layer encapsulations (e.g., VPN) may occur on some paths

   o  Commonly-deployed VPNs use an MTU of 1400 bytes

   Unless a dynamic per-neighbor MTU discovery mechanism is implemented,
   ISATAP interfaces MUST use an MTU (ISATAP_MTU) of no more than 1380
   bytes (1400 minus 20 bytes for IPv4 encapsulation) to maximize
   efficiency and minimize IPv4 fragmentation for the predominant
   deployment case.  ISATAP_MTU MAY be set to a larger value when the
   encapsulator implements a dynamic per-neighbor MTU discovery
   mechanism, but this value SHOULD NOT exceed the largest MTU of all
   underlying links (minus 20 bytes for IPv4 encapsulation).  Appendix C
   provides non-normative considerations for dynamic per-neighbor MTU
   discovery.

   The network layer (IPv6) forwards packets of size ISATAP_MTU or
   smaller to the ISATAP interface.  All other packets are dropped, and
   an ICMPv6 "packet too big" message with MTU = ISATAP_MTU is returned
   to the source [11].  The ISATAP link layer encapsulates packets of
   size 1380 bytes or smaller with the Don't Fragment (DF) bit NOT set
   in the encapsualting IPv4 header.

   Nodes that configure ISATAP interfaces MUST have IPv4 reassembly
   buffers large enough to receive packets with the DF bit not set in
   the encapsulating IPv4 header.  RFC 1122 [12], section 3.3.2
   specifies that the Effective MTU to Receive (EMTU_R) for IPv4 nodes:

      "...MUST be greater than or equal to 576, SHOULD be either
      configurable or indefinite, and SHOULD be greater than or equal to



Templin, et al.           Expires July 4, 2002                  [Page 7]

Internet-Draft                   ISATAP                     January 2002


      the MTU of the connected network(s)".

   With reference to this specification, the EMTU_R for nodes that
   configure ISATAP interfaces MUST be greater than or equal to 1500
   bytes (i.e., the predominant deployment case for connected IPv4
   networks) and SHOULD be either configurable or indefinite.

6.4 Handling IPv4 ICMP Errors

   The specification in ([9], section 3.4) MAY be used.  IPv4 ICMP
   errors and ARP failures are otherwise processed as link error
   notifications.

6.5 Local-Use IPv6 Unicast Addresses

   The specification in ([9], section 3.7) is NOT used.  Instead, local
   use IPv6 unicast addresses are formed exactly as specified in ([8],
   section 2.5.6).

6.6 Ingress Filtering

   The specification in ([9], section 3.9) is used on ISATAP router
   interfaces.  (ISATAP host interfaces silently discard any packets
   received with a foreign IPv6 destination address, i.e., an address
   not configured on the local IPv6 stack.)

   Additionally, packets received on ISATAP host and router interfaces
   MUST satisfy at least one (i.e., one or both) of the following
   validity checks:

   o  the network-layer (IPv6) source address is an on-link ISATAP
      address with an interface identifier that embeds the link-layer
      (IPv4) source address

   o  the link-layer (IPv4) source address is in the Potential Routers
      List (see Section 7.2.1)

   Packets that do not satisfy the above conditions are silently
   discarded.

7. Neighbor Discovery for ISATAP Links

   RFC 2461 [6] provides the following guidelines for non-broadcast
   multiple access (NBMA) link support:

      "Redirect, Neighbor Unreachability Detection and next-hop
      determination should be implemented as described in this document.
      Address resolution and the mechanism for delivering Router



Templin, et al.           Expires July 4, 2002                  [Page 8]

Internet-Draft                   ISATAP                     January 2002


      Solicitations and Advertisements on NBMA links is not specified in
      this document."

   ISATAP links SHOULD implement Redirect, Neighbor Unreachability
   Detection, and next-hop determination exactly as specified in [6].
   Address resolution and the mechanisms for delivering Router
   Solicitations and Advertisements for ISATAP links are not specified
   by [6]; instead, they are specified in this document.  (Note that
   these mechanisms MAY potentially apply to other types of NBMA links
   in the future.)

7.1 Address Resolution

   ISATAP addresses are resolved to link-layer addresses (IPv4) by a
   static computation, i.e., the last four octets are treated as an IPv4
   address.

   Following static address resolution, ISATAP hosts SHOULD perform an
   initial reachability confirmation by sending unicast Neighbor
   Solicitations (NSs) and receiving a Neighbor Advertisement using the
   mechanisms specified in ([6], sections 7.2.2-7.2.8).  (Note that
   implementations MAY omit the source/target link layer options in NS/
   NA messages when unicast is used.)

   ISATAP hosts SHOULD additionally perform Neighbor Unreachability
   Detection (NUD) as specified in ([6], section 7.3).  ISATAP routers
   MAY perform the above-specified reachability detection and NUD
   procedures, but this might not scale in all environments.

   All ISATAP nodes MUST send solicited neighbor advertisements ([6],
   section 7.2.4).

7.2 Router and Prefix Discovery

   Since NBMA multicast emulation mechanisms are not used, ISATAP nodes
   will not receive unsolicited multicast Router Advertisements.  Thus,
   alternate mechanisms are required and specified below:

7.2.1 Conceptual Data Structures

   ISATAP nodes use the conceptual data structures Prefix List and
   Default Router List exactly as in ([6], section 5.1).  ISATAP links
   add a new conceptual data structures "Potential Router List" and the
   following new configuration variable:

   ResolveInterval
      Time between name service resolutions.  Default and suggested
      minimum: 1hr



Templin, et al.           Expires July 4, 2002                  [Page 9]

Internet-Draft                   ISATAP                     January 2002


   A Potential Router List (PRL) is associated with every ISATAP link.
   The PRL provides a trust basis for router validation (see security
   considerations).  Each entry in the PRL has an IPv4 address and an
   associated timer.  The IPv4 address represents a router's ISATAP
   interface (likely to be an "advertising interface"), and is used to
   construct the ISATAP link-local address for that interface.  The
   following sections specify the process for initializing the PRL:

   When a node enables an ISATAP link, it first discovers IPv4 addresses
   for the PRL.  The addresses SHOULD be established by a DHCPv4 [13]
   option for ISATAP (option code TBD), by manual configuration, or by
   an unspecified alternate method (e.g., DHCPv4 vendor-specific
   option).

   When no other mechanisms are available, a DNS fully-qualified domain
   name (FQDN) [20] MAY be used.  In this case, the FQDN is resolved
   into IPv4 addresses for the PRL through a static host file, a
   site-specific name service, or by querying an IPv4-based DNS server.
   Unspecified alternate methods for domain name resolution may also be
   used.  The following notes apply:

   1.  Site administrators maintain a list of IPv4 addresses
       representing ISATAP router interfaces and make them available via
       one or more of the mechanisms described above.

   2.  There are no mandatory rules for the selection of a FQDN, but
       administrators are encouraged to use the convention
       "isatap.domainname" (e.g., isatap.example.com).

   3.  After initialization, nodes periodically re-initialize the PRL
       (after ResolveInterval).  When DNS is used, client DNS resolvers
       use the IPv4 transport to resolve the names and follow the cache
       invalidation procedures in [20] when the DNS time-to-live
       expires.


7.2.2 Validity Checks for Router Advertisements

   A node MUST silently discard any Router Advertisement messages it
   receives that do not satisfy both the validity checks in ([6],
   section 6.1.2) and the following additional validity check for
   ISATAP:

   o  the network-layer (IPv6) source address is an ISATAP address and
      embeds an IPv4 address from the PRL






Templin, et al.           Expires July 4, 2002                 [Page 10]

Internet-Draft                   ISATAP                     January 2002


7.2.3 Router Specification

   Advertising ISATAP interfaces of routers behave the same as
   advertising interfaces described in ([6], section 6.2).  However,
   periodic unsolicited multicast Router Advertisements are not used,
   thus the "interval timer" associated with advertising interfaces is
   not used for that purpose.

   When an ISATAP router receives a valid Router Solicitation on an
   advertising ISATAP interface, it replies with a unicast Router
   Advertisement to the address of the node which sent the Router
   Solicitation.  The source address of the Router Advertisement is a
   link-local unicast address associated with the interface.  This MAY
   be the same as the destination address of the Router Solicitation.
   ISATAP routers MAY engage in the solicitation process described under
   Host Specification below, e.g., if Router Advertisement consistency
   verification ([6], section 6.2.7) is desired.

7.2.4 Host Specification

   All entries in the PRL are assumed to represent active ISATAP routers
   within the site, i.e., the PRL provides trust basis only; not
   reachability detection.  ISATAP nodes SHOULD use stateful
   configuration to assign IPv6 prefixes and default router information.
   When stateful configuration is not available, hosts MAY periodically
   solicit information from one or more entries in the PRL ("PRL(i)") by
   sending unicast Router Solicitation messages using the IPv4 address
   ("V4ADDR_PRL(i)") and associated timer in the entry.  Hosts add the
   following variable to support the solicitation process:

   MinRouterSolicitInterval
      Minimum time between sending Router Solicitations to any router.
      Default and suggested minimum: 15min.

   When a PRL(i) is selected, the host sets its associated timer to
   MinRouterSolicitInterval and initiates solicitation following a short
   delay as in ([6], section 6.3.7).  The manner of choosing particular
   routers in the PRL for solicitation is outside the scope of this
   specification.  The solicitation process repeats when the associated
   timer expires.

   Solicitation consists of sending Router Solicitations to the ISATAP
   link-local address constructed from the entry's IPv4 address, i.e.,
   they are sent to 'FE80::0:5EFE:V4ADDR_PRL(i)' instead of 'All-Routers
   multicast'.  They are otherwise sent exactly as in ([6], section
   6.3.7).

   Hosts process received Router Advertisements exactly as in ([6],



Templin, et al.           Expires July 4, 2002                 [Page 11]

Internet-Draft                   ISATAP                     January 2002


   section 6.3.4).  Hosts additionally reset the timer associated with
   the V4ADDR_PRL(i) embedded in the network-layer source address in
   each solicited Router Advertisement received.  The timer is reset to
   either 0.5 * (the minimum value in the router lifetime or valid
   lifetime of any on-link prefixes received in the advertisement) or
   MinRouterSolicitInterval; whichever is longer.

8. ISATAP Deployment Considerations

8.1 Host And Router Deployment Considerations

   For hosts, if an underlying link supports both IPv4 (over which
   ISATAP is implemented) and also supports IPv6 natively, then ISATAP
   MAY be enabled if the native IPv6 layer does not receive Router
   Advertisements (i.e., does not have connection with an IPv6 router).
   After a non-link-local address has been configured and a default
   router acquired on the native link, the host SHOULD discontinue the
   router solicitation process described in the host specification and
   allow existing ISATAP address configurations to expire as specified
   in ([6], section 5.3) and ([14], section 5.5.4).  Any ISATAP
   addresses added to the DNS for this host should also be removed.  In
   this way, ISATAP use will gradually diminish as IPv6 routers are
   widely deployed throughout the site.

   Routers MAY configure an interface to simultaneously support both
   native IPv6, and also ISATAP (over IPv4).  Routing will operate as
   usual between these two domains.  Note that the prefixes used on the
   ISATAP and native IPv6 interfaces will be distinct.  The IPv4
   address(es) configured on a router's ISATAP interface(s) SHOULD be
   added (either automatically or manually) to the site's address
   records for ISATAP router interfaces.

8.2 Site Administration Considerations

   The following considerations are noted for sites that deploy ISATAP:

   o  ISATAP links are administratively defined by a set of router
      interfaces and set of nodes which discover those interface and
      server addresses Thus, ISATAP links are defined by administrative
      (not physical) boundaries.

   o  ISATAP hosts and routers can be deployed in an ad-hoc and
      independent fashion.  In particular, ISATAP hosts can be deployed
      with little/no advanced knowledge of existing ISATAP routers, and
      ISATAP routers can deployed with no reconfiguration requirements
      for hosts.

   o  When stateful autoconfiguration is not available, ISATAP nodes MAY



Templin, et al.           Expires July 4, 2002                 [Page 12]

Internet-Draft                   ISATAP                     January 2002


      periodically send unicast Router Solicitations to and receive
      unicast Router Advertisements from to one or more members of the
      potential router list.  A well-deployed stateful autoconfiguration
      service within the site can minimize and/or eliminate the need for
      periodic solicitation.

   o  ISATAP nodes periodically refresh the entries on the PRL.
      Responsible site administration can reduce the control traffic.
      At a minimum, administrators SHOULD ensure that dynamically
      advertised information for the site's PRL is well maintained.


9. IANA Considerations

   A DHCPv4 option code for ISATAP (TBD) [21] is requested in the event
   that the IESG recommends this document for standards track.

10. Security considerations

   Site administrators are advised that, in addition to possible attacks
   against IPv6, security attacks against IPv4 MUST also be considered.

   Responsible IPv4 site security management is strongly encouraged.  In
   particular, border gateways SHOULD implement filtering to detect
   spoofed IPv4 source addresses at a minimum; ip-protocol-41 filtering
   SHOULD also be implemented.

   If IPv4 source address filtering is not correctly implemented, the
   ISATAP validity checks will not be effective in preventing IPv6
   source address spoofing.

   If filtering for ip-protocol-41 is not correctly implemented, IPv6
   source address spoofing is clearly possible, but this can be
   eliminated if both IPv4 source address filtering, and the ISATAP
   validity checks are implemented.

   (RFC 2461 [6]), section 6.1.2 implies that nodes trust Router
   Advertisements they receive from on-link routers, as indicated by a
   value of 255 in the IPv6 'hop-limit' field.  Since this field is not
   decremented when ip-protocol-41 packets traverse multiple IPv4 hops
   ([9], section 3), ISATAP links require a different trust model.  In
   particular, ONLY those Router Advertisements received from a member
   of the Potential Routers List are trusted; all others are silently
   discarded.  This trust model is predicated on IPv4 source address
   filtering, as described above.

   The ISATAP address format does not support privacy extensions for
   stateless address autoconfiguration [22].  However, since the ISATAP



Templin, et al.           Expires July 4, 2002                 [Page 13]

Internet-Draft                   ISATAP                     January 2002


   interface identifier is derived from the node's IPv4 address, ISATAP
   addresses do not have the same level of privacy concerns as IPv6
   addresses that use an interface identifier derived from the MAC
   address.  (This issue is the same for NAT'd addresses.)

11. Acknowledgements

   Some of the ideas presented in this draft were derived from work at
   SRI with internal funds and contractual support.  Government sponsors
   who supported the work include Monica Farah-Stapleton and Russell
   Langan from U.S.  Army CECOM ASEO, and Dr.  Allen Moshfegh from U.S.
   Office of Naval Research.  Within SRI, Dr.  Mike Frankel, J.  Peter
   Marcotullio, Lou Rodriguez, and Dr.  Ambatipudi Sastry supported the
   work and helped foster early interest.

   The following peer reviewers are acknowledged for taking the time to
   review a pre-release of this document and provide input: Jim Bound,
   Rich Draves, Cyndi Jung, Ambatipudi Sastry, Aaron Schrader, Ole
   Troan, Vlad Yasevich.

   The authors acknowledge members of the NGTRANS community who have
   made significant contributions to this effort, including Rich Draves,
   Alain Durand, Nathan Lutchansky, Karen Nielsen, Art Shelest, Margaret
   Wasserman, and Brian Zill.

   The authors also wish to acknowledge the work of Quang Nguyen [23]
   under the guidance of Dr.  Lixia Zhang that proposed very similar
   ideas to those that appear in this document.  This work was first
   brought to the authors' attention on September 20, 2002.

Normative References

   [1]   Deering, S. and R. Hinden, "Internet Protocol, Version 6 (IPv6)
         Specification", RFC 2460, December 1998.

   [2]   Postel, J., "Internet Protocol", STD 5, RFC 791, September
         1981.

   [3]   Rekhter, Y., Moskowitz, R., Karrenberg, D., Groot, G. and E.
         Lear, "Address Allocation for Private Internets", BCP 5, RFC
         1918, February 1996.

   [4]   Egevang, K. and P. Francis, "The IP Network Address Translator
         (NAT)", RFC 1631, May 1994.

   [5]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", BCP 14, RFC 2119, March 1997.




Templin, et al.           Expires July 4, 2002                 [Page 14]

Internet-Draft                   ISATAP                     January 2002


   [6]   Narten, T., Nordmark, E. and W. Simpson, "Neighbor Discovery
         for IP Version 6 (IPv6)", RFC 2461, December 1998.

   [7]   Armitage, G., Schulter, P., Jork, M. and G. Harter, "IPv6 over
         Non-Broadcast Multiple Access (NBMA) networks", RFC 2491,
         January 1999.

   [8]   Hinden, R. and S. Deering, "IP Version 6 Addressing
         Architecture", draft-ietf-ipngwg-addr-arch-v3-11 (work in
         progress), October 2002.

   [9]   Gilligan, R. and E. Nordmark, "Basic Transition Mechanisms for
         IPv6 Hosts and Routers", draft-ietf-ngtrans-mech-v2-01 (work in
         progress), November 2002.

   [10]  Conta, A. and S. Deering, "Internet Control Message Protocol
         (ICMPv6) for the Internet Protocol Version 6 (IPv6)
         Specification", RFC 2463, December 1998.

   [11]  McCann, J., Deering, S. and J. Mogul, "Path MTU Discovery for
         IP version 6", RFC 1981, August 1996.

   [12]  Braden, R., "Requirements for Internet Hosts - Communication
         Layers", STD 3, RFC 1122, October 1989.

   [13]  Droms, R., "Dynamic Host Configuration Protocol", RFC 2131,
         March 1997.

   [14]  Thomson, S. and T. Narten, "IPv6 Stateless Address
         Autoconfiguration", RFC 2462, December 1998.

   [15]  Mogul, J. and S. Deering, "Path MTU discovery", RFC 1191,
         November 1990.

   [16]  Postel, J., "Internet Control Message Protocol", STD 5, RFC
         792, September 1981.

   [17]  Baker, F., "Requirements for IP Version 4 Routers", RFC 1812,
         June 1995.

   [18]  Droms, R., "Dynamic Host Configuration Protocol for IPv6
         (DHCPv6)", draft-ietf-dhc-dhcpv6-28 (work in progress),
         November 2002.

Informative References

   [19]  Carpenter, B. and K. Moore, "Connection of IPv6 Domains via
         IPv4 Clouds", RFC 3056, February 2001.



Templin, et al.           Expires July 4, 2002                 [Page 15]

Internet-Draft                   ISATAP                     January 2002


   [20]  Mockapetris, P., "Domain names - implementation and
         specification", STD 13, RFC 1035, November 1987.

   [21]  Droms, R., "Procedures and IANA Guidelines for Definition of
         New DHCP Options and Message Types", BCP 43, RFC 2939,
         September 2000.

   [22]  Narten, T. and R. Draves, "Privacy Extensions for Stateless
         Address Autoconfiguration in IPv6", RFC 3041, January 2001.

   [23]  Nguyen, Q., "http://irl.cs.ucla.edu/vet/report.ps", spring
         1998.

   [24]  Lahey, K., "TCP Problems with Path MTU Discovery", RFC 2923,
         September 2000.


Authors' Addresses

   Fred L. Templin
   Nokia
   313 Fairchild Drive
   Mountain View, CA  94110
   US

   Phone: +1 650 625 2331
   EMail: ftemplin@iprg.nokia.com


   Tim Gleeson
   Cisco Systems K.K.
   Shinjuku Mitsu Building
   2-1-1 Nishishinjuku, Shinjuku-ku
   Tokyo  163-0409
   Japan

   EMail: tgleeson@cisco.com


   Mohit Talwar
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA>  98052-6399
   US

   Phone: +1 425 705 3131
   EMail: mohitt@microsoft.com




Templin, et al.           Expires July 4, 2002                 [Page 16]

Internet-Draft                   ISATAP                     January 2002


   Dave Thaler
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA  98052-6399
   US

   Phone: +1 425 703 8835
   EMail: dthaler@microsoft.com

Appendix A. Major Changes

   changes from version 09 to version 10:

   o  Rearranged/revised sections 5, 6, 7

   o  updated MTU section

   changes from version 08 to version 09:

   o  Added stateful autoconfiguration mechanism

   o  Normative references to RFC 2491, RFC 2462

   o  Moved non-normative MTU text to appendix C

   changes from version 07 to version 08:

   o  updated MTU section

   changes from version 06 to version 07:

   o  clarified address resolution, Neighbor Unreachability Detection

   o  specified MTU/MRU requirements

   changes from earlier versions to version 06:

   o  Addressed operational issues identified in 05 based on discussion
      between co-authors

   o  Clarified ambiguous text per comments from Hannu Flinck; Jason
      Goldschmidt

   o  Moved historical text in section 4.1 to Appendix B in response to
      comments from Pekka Savola

   o  Identified operational issues for anticipated deployment scenarios




Templin, et al.           Expires July 4, 2002                 [Page 17]

Internet-Draft                   ISATAP                     January 2002


   o  Included reference to Quang Nguyen work


Appendix B. Rationale for Interface Identifier Construction

   ISATAP specifies an EUI64-format address construction for the
   Organizationally-Unique Identifier (OUI) owned by the Internet
   Assigned Numbers Authority (IANA).  This format (given below) is used
   to construct both native EUI64 addresses for general use and modified
   EUI-64 format interface identifiers for IPv6 unicast addresses:

   |0                      2|2      3|3      3|4                      6|
   |0                      3|4      1|2      9|0                      3|
   +------------------------+--------+--------+------------------------+
   |  OUI ("00-00-5E"+u+g)  |  TYPE  |  TSE   |          TSD           |
   +------------------------+--------+--------+------------------------+

   Where the fields are:

      OUI     IANA's OUI: 00-00-5E with 'u' and 'g' bits (3 octets)

      TYPE    Type field; specifies use of (TSE, TSD) (1 octet)

      TSE     Type-Specific Extension (1 octet)

      TSD     Type-Specific Data (3 octets)

   And the following interpretations are specified based on TYPE:

      TYPE         (TSE, TSD) Interpretation
      ----         -------------------------
      0x00-0xFD    RESERVED for future IANA use
      0xFE         (TSE, TSD) together contain an embedded IPv4 address
      0xFF         TSD is interpreted based on TSE as follows:

                   TSE          TSD Interpretation
                   ---          ------------------
                   0x00-0xFD    RESERVED for future IANA use
                   0xFE         TSD contains 24-bit EUI-48 intf id
                   0xFF         RESERVED by IEEE/RAC

                                Figure 2

   Thus, if TYPE=0xFE, TSE is an extension of TSD.  If TYPE=0xFF, TSE is
   an extension of TYPE.  Other values for TYPE (thus, other
   interpretations of TSE, TSD) are reserved for future IANA use.

   The above specification is compatible with all aspects of EUI64,



Templin, et al.           Expires July 4, 2002                 [Page 18]

Internet-Draft                   ISATAP                     January 2002


   including support for encapsulating legacy EUI-48 interface
   identifiers (e.g., an IANA EUI-48 format multicast address such as:
   '01-00-5E-01-02-03' is encapsulated as: '01-00-5E-FF-FE-01-02-03').
   But, the specification also provides a special TYPE (0xFE) to
   indicate an IPv4 address is embedded.  Thus, when the first four
   octets of an IPv6 interface identifier are: '00-00-5E-FE' (note: the
   'u/l' bit MUST be 0) the interface identifier is said to be in
   "ISATAP format" and the next four octets embed an IPv4 address
   encoded in network byte order.

Appendix C. Dynamic Per-neighbor MTU Discovery

   ISATAP encapsulators and decapsulators are IPv6 neighbors that may be
   separated by multiple link layer (IPv4) forwarding hops.  When
   ISATAP_MTU is larger than 1380 bytes, the encapsulator must implement
   a dynamic link layer mechanism to discover per-neighbor MTUs.

   IPv4 path MTU discovery [15] relies on ICMPv4 "fragmentation needed"
   messages, but these do not provide enough information for stateless
   translation into ICMPv6 "packet too big" messages (see: RFC 792 [16]
   and RFC 1812 [17], section 4.3.2.3).  Additionally, ICMPv4
   "fragmentation needed" messages can be spoofed, filtered, or not sent
   at all by some forwarding nodes.  Thus, IPv4 Path MTU discovery used
   alone is inadequate and can result in black holes that are difficult
   to diagnose [24].

   The ISATAP encapsulator may implement an alternate per-neighbor MTU
   discovery mechanism, e.g., periodic and/or on-demand probing of the
   IPv4 path to the decapsulator.  Probing consists of sending packets
   larger than 1380 bytes to the neighbor and receiving positive
   confirmation of receipt.  Two methods are possible:

   In the first method, the encapsulator does NOT set the DF bit in the
   IPv4 header of probe packets.  In this case, the encapsulator must
   have a priori knowledge of the decapsulator's reassembly buffer size
   and should have a priori knowledge of the decapsulator's link MTU.
   This method has the advantage that probe packets will be delivered
   even if the network performs fragmentation, thus ordinary data
   packets may be used for probing resulting in greater efficiency.
   Disadvantages for this method include:

   o  special mechanisms required on both encapsulator and decapsulator

   o  extra state required on both encapsulator and decapsulator

   o  complex protocol signalling between encapsulator and decapsulator

   o  possible extended periods of network fragmentation



Templin, et al.           Expires July 4, 2002                 [Page 19]

Internet-Draft                   ISATAP                     January 2002


   In the second (and preferred) method, the encapsulator sets the DF
   bit in the IPv4 header of probe packets.  Neighbor Solicitation (NS)
   packets with padding bytes added should be used for this purpose,
   since successful delivery results in a positive acknowledgement that
   the probe succeeded, i.e., in the form of a Neighbor Advertisement
   (NA) from the decapsulator.  Setting the DF bit prevents the network
   from fragmenting the packets and protects decapsulators from
   receiving packets that might overrun the IPv4 reassembly buffer.
   Additionally, special mechanisms and state are needed only on the
   encapsulator, and no complex protocol signalling between the
   encapsulator and decapsulator is required.

   In either method, implementations may choose to couple the probing
   process with neighbor cache management procedures ([6], section 7),
   e.g.  to maintain timers, state variables and/or a queue of packets
   waiting for probes to complete.  Packets retained on the queue are
   forwarded when probes succeed, and provide state for sending ICMPv6
   "packet too big" messages to the source when probes fail.
   Implementations may choose to store per-neighbor MTU information in
   the IPv4 path MTU discovery cache, in the ISATAP link layer's private
   data structures, etc.

   Additional notes:

   1.  Per-neighbor MTUs may vary dynamically due to fluctuations in the
       IPv4 forwarding path and/or multipath routing (e.g., when QoS
       routing is used in the IPv4 network).  For such neighbors,
       encapsulators should detect a "losing battle" and reduce the
       per-neighbor MTU size to no more than 1380 bytes.

   2.  When not probing, encapsulators may send packets to a neighbor
       with MTU greater than 1380 bytes either with the DF bit set or
       not set.  When the DF bit is set, undetected packet loss may
       occur in the network if the neighbor's MTU decreases.  When the
       DF bit is NOT set, undetected packet loss is less likely but may
       occur either in the network or at the neighbor's reassembly
       buffer.

   3.  ICMPv4 "fragmentation needed" messages may result when a link
       restriction is encountered but may also come from denial of
       service attacks.  Implementations should treat ICMPv4
       "fragmentation needed" messages as "tentative" negative
       acknowledgments and apply heuristics to determine when to suspect
       an actual link restriction and when to ignore the messages.  IPv6
       packets lost due actual link restrictions are perceived as lost
       due to congestion by the original source, but robust
       implementations minimize instances of such packet loss without
       ICMPv6 "packet too big" messages returned to the sender.



Templin, et al.           Expires July 4, 2002                 [Page 20]

Internet-Draft                   ISATAP                     January 2002


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights.  Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11.  Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard.  Please address the information to the IETF Executive
   Director.

   The IETF has been notified of intellectual property rights claimed in
   regard to some or all of the specification contained in this
   document.  For more information consult the online list of claimed
   rights.


Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.



Templin, et al.           Expires July 4, 2002                 [Page 21]

Internet-Draft                   ISATAP                     January 2002


   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.







































Templin, et al.           Expires July 4, 2002                 [Page 22]


