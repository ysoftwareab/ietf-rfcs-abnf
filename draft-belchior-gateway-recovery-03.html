<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>DLT Gateway Crash Recovery Mechanism</title>
<meta content="Rafael Belchior" name="author">
<meta content="Miguel Correia" name="author">
<meta content="Thomas Hardjono" name="author">
<meta content="
       This memo describes the crash recovery mechanism for the Open Digital Asset Protocol (ODAP), called ODAP-2PC.
The goal is to assure gateways running ODAP to be able to recover from crashes, and thus preserve the consistency of an asset across ledgers 
(i.e., double spend does not occur). This draft includes the description of the messaging and logging flow necessary for the correct functioning of  ODAP-2PC.
 
    " name="description">
<meta content="xml2rfc 3.10.0" name="generator">
<meta content="template" name="keyword">
<meta content="draft-belchior-gateway-recovery-03" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.10.0
    Python 3.6.12
    appdirs 1.4.4
    ConfigArgParse 1.5.2
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.3
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 58.0.4
    six 1.16.0
-->
<link href="/tmp/draft-belchior-gateway-recover-03-4qx2ie5i.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.ulBare, li.ulBare {
  margin-left: 0em !important;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
/* Fix PDF info block run off issue */
@media print {
  #identifiers dd {
    float: none;
  }
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: auto;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
/* Make paragraph spacing inside <li> smaller than in body text, to fit better within the list */
li > p {
  margin-bottom: 0.5em
}
/* Don't let p margin spill out from inside list items */
li > p:last-of-type {
  margin-bottom: 0;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Gateway Crash Recovery</td>
<td class="right">October 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">Belchior, et al.</td>
<td class="center">Expires 6 April 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Internet Engineering Task Force</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-belchior-gateway-recovery-03</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-10-03" class="published">3 October 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-04-06">6 April 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">R. Belchior</div>
<div class="org">INESC-ID, Instituto Superior Técnico</div>
</div>
<div class="author">
      <div class="author-name">M. Correia</div>
<div class="org">INESC-ID, Instituto Superior Técnico</div>
</div>
<div class="author">
      <div class="author-name">T. Hardjono</div>
<div class="org">MIT</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">DLT Gateway Crash Recovery Mechanism</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This memo describes the crash recovery mechanism for the Open Digital Asset Protocol (ODAP), called ODAP-2PC.
The goal is to assure gateways running ODAP to be able to recover from crashes, and thus preserve the consistency of an asset across ledgers 
(i.e., double spend does not occur). This draft includes the description of the messaging and logging flow necessary for the correct functioning of  ODAP-2PC.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-2">
<a href="#name-status-of-this-memo-2" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 April 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-2">
<a href="#name-copyright-notice-2" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-2">
<a href="#name-table-of-contents-2" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-2" class="xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology-2" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-logging-model-2" class="xref">Logging Model</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-example-2" class="xref">Example</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-log-storage-modes-2" class="xref">Log Storage Modes</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-log-storage-api-2" class="xref">Log Storage API:</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3.2.1">
                    <p id="section-toc.1-1.3.2.3.2.1.1"><a href="#section-3.3.1" class="xref">3.3.1</a>.  <a href="#name-response-codes-2" class="xref">Response Codes</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-format-of-log-entries-2" class="xref">Format of log entries</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-odap-2pc-2" class="xref">ODAP-2PC</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-crash-recovery-model-2" class="xref">Crash Recovery Model</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-recovery-procedure-2" class="xref">Recovery Procedure</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="xref">5.2.1</a>.  <a href="#name-transfer-initiation-flow-2" class="xref">Transfer Initiation Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="xref">5.2.2</a>.  <a href="#name-lock-evidence-flow-2" class="xref">Lock-Evidence Flow</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="xref">5.2.3</a>.  <a href="#name-commitment-establishment-flo" class="xref">Commitment Establishment  Flow</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-odap-2pc-messages-2" class="xref">ODAP-2PC Messages</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="xref">5.3.1</a>.  <a href="#name-recover-2" class="xref">RECOVER</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="xref">5.3.2</a>.  <a href="#name-recover-udpdate-2" class="xref">RECOVER-UDPDATE</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.3">
                    <p id="section-toc.1-1.5.2.3.2.3.1"><a href="#section-5.3.3" class="xref">5.3.3</a>.  <a href="#name-recover-update-ack-2" class="xref">RECOVER-UPDATE ACK</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.4">
                    <p id="section-toc.1-1.5.2.3.2.4.1"><a href="#section-5.3.4" class="xref">5.3.4</a>.  <a href="#name-recover-success-2" class="xref">RECOVER-SUCCESS</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.5">
                    <p id="section-toc.1-1.5.2.3.2.5.1"><a href="#section-5.3.5" class="xref">5.3.5</a>.  <a href="#name-rollback-2" class="xref">ROLLBACK</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="xref">5.4</a>.  <a href="#name-examples-2" class="xref">Examples</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="xref">5.4.1</a>.  <a href="#name-crashing-before-issuing-a-co" class="xref">Crashing before issuing a command to the counterparty gateway</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="xref">5.4.2</a>.  <a href="#name-crashing-after-issuing-a-com" class="xref">Crashing after issuing a command to the counterparty gateway</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-security-considerations-2" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-references-2" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-normative-references-2" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-informative-references-2" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses-2" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction-2">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Gateway systems that perform virtual asset transfers among DLTs must possess a degree of resiliency and fault tolerance in the face of possible crashes. Accounting for the possibility of crashes is
particularly important to guarantee asset consistency across DLTs.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2"> ODAP-2PC [HERMES] uses 2PC, an atomic commitment protocol (ACP).
2PC considers two roles: a coordinator who manages the protocol's execution and participants who manage the resources that must be kept consistent. The source gateway plays the ACP role of Coordinator, and the recipient gateway plays the Participant role in relay mode. Gateways exchange messages corresponding to the protocol execution, generating log entries for each one.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">
Log entries are organized into logs. Logs enable either the same or other backup gateways to resume any phase of ODAP. This log can also serve as an accountability tool in case of disputes.
Another key component is an atomic commit protocol (ACP) that guarantees that the source and target DLTs are modified consistently (atomicity) and permanently (durability), e.g., that assets that are taken from the source DLT are persisted into the recipient DLT.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4"> 
Log entries are then the basis satisfying one of the key deployment requirements of gateways for asset transfers:
a high degree of availability. In this document, we consider two common strategies to increase availability: (1) to support the recovery of the gateways (self-healing model) and (2) to employ backup gateways with the ability to resume a stalled transfer (primary-backup model) [HERMES].<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This memo proposes:
(i) the logging model of ODAP-2PC;
(ii) the log storage types;
(iii) the log storage API;
(iv)  the log entry format;
(v) the recovery and rollback procedures.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="terms">
<section id="section-2">
      <h2 id="name-terminology-2">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology-2" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">There following are some terminology used in the current document:<a href="#section-2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-2.1">Gateway: The nodes of a DLT system that are functionally capable of handling an asset transfer with another DLT. Gateway nodes implement the gateway-to-gateway asset transfer protocol.<a href="#section-2-2.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.2">
Primary Gateway: The node of a DLT system that has been selected or elected to act as a gateway in an asset transfer.<a href="#section-2-2.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.3">
Backup Gateway: The node of a DLT system that has been selected or elected to act as a backup gateway to a primary gateway.<a href="#section-2-2.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.4">
Message Flow Parameters: The parameters and payload employed in a message flow between a sending gateway and receiving gateway.<a href="#section-2-2.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.5">
Source Gateway (or G1): The gateway that initiates the transfer protocol. Acts as a coordinator of the ACP and mediates the message flow.<a href="#section-2-2.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.6">
Recipient Gateway (or G2): The gateway that is the target of an asset transfer. It follows instructions from the source gateway.<a href="#section-2-2.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.7">
Source DLT: The DLT of the source gateway.<a href="#section-2-2.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.8">
Recipient DLT: The DLT of the recipient gateway.<a href="#section-2-2.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.9">
Log: Set of log entries such that those are ordered by the time of its creation.<a href="#section-2-2.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.10">
Public (or Shared) Log: log where several nodes can read and write from it.<a href="#section-2-2.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.11">
Private Log: log where only one node can read and write from it.<a href="#section-2-2.11" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.12">
Log data: The log information is retained by a gateway connected to an exchanged message within an asset transfer protocol.<a href="#section-2-2.12" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.13">
Log entry: The log information generated and persisted by a gateway regarding one specific message flow step.<a href="#section-2-2.13" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.14">
Log format: The format of log-data generated by a gateway.<a href="#section-2-2.14" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.15">
Atomic commit protocol (ACP): A protocol that guarantees that assets that are taken from a DLT are persisted into the other DLT. Examples are two and three-phase commit protocols (2PC, 3PC, respectively) and non-blocking atomic commit protocols.<a href="#section-2-2.15" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.16">
Fault: A fault is an event that alters the expected behavior of a system.<a href="#section-2-2.16" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.17">
Crash-fault tolerant models: models allowing a system to keep operating correctly despite having a set of faulty components.<a href="#section-2-2.17" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-2-2.18">
Digital asset: a form of digital medium record used as a digital representation of a tangible or intangible asset.<a href="#section-2-2.18" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="lm">
<section id="section-3">
      <h2 id="name-logging-model-2">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-logging-model-2" class="section-name selfRef">Logging Model</a>
      </h2>
<p id="section-3-1">
We consider the log file to be a stack of log entries. Each time a log entry is added, it goes to the top of the stack (the highest index).
For each protocol step a gateway performs, a log entry is created immediately before executing and immediately after executing a given operation.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">
To manipulate the log, we define a set of log primitives that translate log entry requests from a process into log entries, realized by the log storage API (for the context of ODAP, Section 3.5):<a href="#section-3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-3.1">
  writeLogEntry(e,L) (WRITE) - appends a log entry e in the log L (held by the corresponding Log Storage Support).<a href="#section-3-3.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-3.2">
 getLogEntry(i,L) (READ) - retrieves a log entry with index i from log L.<a href="#section-3-3.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-4">
From these primitives, other functions can be built:<a href="#section-3-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3-5.1">
  getLogLength (L) (READ) - obtains the number of log entries from log L.<a href="#section-3-5.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-5.2">
 getLogDiff(l1,l2) (READ) - obtains the difference between two logs.<a href="#section-3-5.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-5.3">
 getLastEntry(L): obtains the last log entry from log L.<a href="#section-3-5.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-5.4">
 getLog(L): retrieves the whole log L.<a href="#section-3-5.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-3-5.5">
 updateLog(l1,l2): updates l1 based on l2 (uses getLogDiff and writeLogEntry).<a href="#section-3-5.5" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-3-6">
Example 3.1 shows a simplified version log referring to the transfer initiation flow ODAP phase. Each log entry
(simplified, see the definition in Section 3) is composed of metadata (phase, sequence number) and one attribute from the payload (operation).
Operations map behavior to state (see Section 3).<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">
The following table illustrates the log storage API. The Function describes the primitive supported by the log storage API.
The Parameters column specifies the parameters given to the endpoint as query parameters. Endpoint specifies the endpoint mapping a specific log primitive.
The column Returns specifies what the contents of "response_data" mean. The column Response Example illustrates this last field.<a href="#section-3-7" class="pilcrow">¶</a></p>
<div id="exlm">
<section id="section-3.1">
        <h3 id="name-example-2">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-example-2" class="section-name selfRef">Example</a>
        </h3>
<div id="fig3.1">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-3.1-1.1">
<pre>

     ,--.                     ,--.                                 ,-------.
     |G1|                     |G2|                                 |Log API|
     `--'                     `--'                                 `-------'
      |             [1]: writeLogEntry &lt;1,1,init-validate&gt;             |
      | ---------------------------------------------------------------&gt;
      |                        |                                       |
      | initiate ODAP's phase 1|                                       |
      | -----------------------&gt;                                       |
      |                        |                                       |
      |                        | [2]: writeLogEntry &lt;1,2,exec-validate&gt;|
      |                        | --------------------------------------&gt;
      |                        |                                       |
      |                        |----.                                  |
      |                        |    | execute validate from p1         |
      |                        |&lt;---'                                  |
      |                        |                                       |
      |                        | [3]: writeLogEntry &lt;1,3,done-validate&gt;|
      |                        | --------------------------------------&gt;
      |                        |                                       |
      |                        | [4]: writeLogEntry &lt;1,4,ack-validate&gt; |
      |                        | --------------------------------------&gt;
      |                        |                                       |
      |   validation complete  |                                       |
      | &lt;-----------------------                                       |
     ,--.                     ,--.                                 ,-------.
     |G1|                     |G2|                                 |Log API|
     `--'                     `--'                                 `-------'


</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a></figcaption></figure>
</div>
<p id="section-3.1-2"> Example 2.1 shows the sequence of logging operations over part of the first phase of ODAP (simplified):<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.1">
 1. At step 1, G1 writes an init-validate operation, meaning it will require G2 to initiate the validate function:
   This step generates a log entry (p1, 1, init-validate).<a href="#section-3.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.2">
 2. At step 2, G2 writes an exec-validate operation, meaning it will try to execute the validate function:
   This step generates a log entry (p1, 2, exec-validate).<a href="#section-3.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.3">3. At step 3, G2 writes a done-validate operation, meaning it successfully executed the validate function:
   This step generates a log entry (p1, 3, done-validate).<a href="#section-3.1-3.3" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.4">
  4. At step 4, G2 writes an ack-validate operation, meaning it will send an acknowledgment to G1 regarding the done-validate:
   This step generates a log entry (p1, 4, ack-validate).<a href="#section-3.1-3.4" class="pilcrow">¶</a>
</li>
        </ul>
</section>
</div>
<div id="lst">
<section id="section-3.2">
        <h3 id="name-log-storage-modes-2">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-log-storage-modes-2" class="section-name selfRef">Log Storage Modes</a>
        </h3>
<p id="section-3.2-1">
Gateways store state mapped by logs. Gateways have private logs recording enterprise-sensitive data that can be used, for instance, for analytics (enterprise log).
Entries can include end-to-end cross-jurisdiction transaction latency and throughput.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">
Apart from the enterprise log, a state log can be public or private, centralized or decentralized. This log is meant to be shared with everyone with an Internet connection (public) or only within the gateway consortium (private).
Logs can be stored locally or in a cloud service, per gateway (centralized), or in a decentralized infrastructure (i.e., decentralized ledger, decentralized database). We call the latter option decentralized log storage.
The type of the state log depends on the trust assumptions among gateways and the access mode [ODAP].<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3"> In greater detail:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.2-4.1">1. Public decentralized log: log entries are stored on a decentralized public log (e.g., Ethereum blockchain, IPFS). Each gateway writes non-encrypted log entries to a decentralized log storage.
   Although this is the best option for providing accountability of gateways, availability, and integrity of the logs, leading to shorter dispute resolution, this can lead to privacy issues.
   The integrity of the log can be asserted by hashing the entries and comparing it to each stored hash on the decentralized log storage.
   A solution to the privacy problems could be given by gateways publishing a hash of the log entry plus metadata to the decentralized log storage instead of the log entries. Although this is a first step towards resolving privacy issues, a tradeoff with data availability is done.
   In particular, this choice leads to lower availability guarantees since a gateway needs to wait for the counter-party gateway to deliver the logs in case logs need to be shared. In this case, the decentralized log storage acts as a notarizing service.
   This mode is recommended when gateways operate in the  Relay Mode: Client-initiated Gateway to Gateway. This mode can also be used by the Direct Mode: Client to Multiple Gateway access mode because gateways may need to share state between themselves.
   Note: the difference between the mentioned modes is that in Direct Mode: Client to Multiple Gateway, a single client/organization controls all the gateways, whereas, in the Relay Mode, gateways are controlled by different organizations.<a href="#section-3.2-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-4.2">2. Public centralized log: log entries are published in a bulletin that more organizations control. That bulletin can be updated or removed at any time. Accountability is only guaranteed provided that there are multiple copies of such bulletin by conflicting parties.
   Availability and integrity can be obtained via redundancy.<a href="#section-3.2-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.2-4.3">3. Private centralized log. Each gateway stores logs locally or in a cloud in the private log storage mode but does not share them by default with other gateways. If needed, logs are requested from the counter-party gateway.
   Saving logs locally is faster than saving them on the respective ledger since issuing a transaction is several orders of magnitude slower than writing on a disk or accessing a cloud service.
   Nonetheless, this model delivers weaker integrity and availability guarantees.<a href="#section-3.2-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.2-5"> Each log storage mode provides a different process to recover the state from crashes. In the private log, a gateway requires the most recent log from the counter-party gateway. This mode is the one where the most trust is needed.
The gateway publishes hashes of log entries and metadata on a decentralized log storage in the centralized public log. Gateways who need the logs request them from other gateways and perform integrity checks of the received logs.
In the public decentralized mode, the gateways publish the plain log entries on decentralized log storage. This is the most trustless and decentralized mode of operation.<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6"> By default, if there are gateways from different institutions involved in an asset transfer, the storage mode should be a decentralized log storage. The decentralized log storage can provide a common source of truth to solve disputes and maintain a shared state, alleviating trust assumptions between gateways.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lsapi">
<section id="section-3.3">
        <h3 id="name-log-storage-api-2">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-log-storage-api-2" class="section-name selfRef">Log Storage API:</a>
        </h3>
<p id="section-3.3-1">
The log storage API allows developers to be abstracted from the log storage support, providing a standardized way
to interact with logs (e.g., relational vs. non-relational, local vs. on-chain). It also handles access control if needed.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<div id="logstorageapi_1">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-3.3-2.1">
<pre>
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Function                              | Parameters                       | Endpoint                                                               |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Append log entry                      | logId - log entry to be appended | POST / writeLogEntry/:logId Host: example.org Accept: application/json |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Obtains a log entry                   | id - log entry id                | GET getLogEntry/:id Host: example.org                                  |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Obtains the length of the log         | None                             | GET getLogLength Host: example.org                                     |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Obtains the difference                | log - log to be compared         |  POST /getLogDiff/:log Host: example.org                                     |
| between a given log and a current log |                                  |                                                                        |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Obtains the last log entry            | None                             | GET getLastEntry Host: example.org                                     |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
| Obtains the whole log                 | None                             | GET getLog Host: example.org                                           |
+---------------------------------------+----------------------------------+------------------------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a></figcaption></figure>
</div>
<p id="section-3.3-3">
The following table maps the respecetive return values and response examples:<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<div id="logstorageapi_2">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-3.3-4.1">
<pre>
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| Returns                         | Response Example                                                                                                                                      |
+=================================+=======================================================================================================================================================+
| The entry index of the last log | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data":"2" }    |
| (string)                        |                                                                                                                                                       |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| A log entry                     | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data": {...} } |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| The length of the log           | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data":"2" }    |
| (string)                        |                                                                                                                                                       |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| The difference between two logs | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data": {...} } |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| A log entry                     | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data": {...} } |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
| The log                         | HTTP/1.1 200 OK Cache-Control: private Date: Mon, 02 Mar 2020 05:07:35 GMT Content-Type: application/json { "success": true, "response_data": {...} } |
+---------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------+
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a></figcaption></figure>
</div>
<div id="lsapi_rc">
<section id="section-3.3.1">
          <h4 id="name-response-codes-2">
<a href="#section-3.3.1" class="section-number selfRef">3.3.1. </a><a href="#name-response-codes-2" class="section-name selfRef">Response Codes</a>
          </h4>
<p id="section-3.3.1-1">
 The log storage API  MUST respond with return codes indicating the failure (error 5XX)
or success of the operation (200).  The application may carry out a further operation in the future
to determine the ultimate status of the operation.<a href="#section-3.3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.3.1-2">
 
The log storage API response is in JSON format and contains two fields: 1) success: true if the operation was successful,
and 2) response_data: contains the payload of the response generated by the log storage API.<a href="#section-3.3.1-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="fle">
<section id="section-4">
      <h2 id="name-format-of-log-entries-2">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-format-of-log-entries-2" class="section-name selfRef">Format of log entries</a>
      </h2>
<p id="section-4-1">
A gateway stores the log entries in its log, and they capture gateways operations. Entries account for the current status of one of the three ODAP flows: Transfer Initiation flow, Lock-Evidence flow, and Commitment Establishment flow.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">
The recommended format for log entries is JSON, with protocol-specific mandatory fields supporting a free format field for plaintext or encrypted payloads directed at the DLT gateway or an underlying DLT. Although the recommended format is JSON, other formats can be used (e.g., XML).<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">
The mandatory fields of a log entry, that are generated by ODAP, are:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
 Version: ODAP protocol Version (major, minor).<a href="#section-4-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.2">
 Session ID: unique identifier (UUIDv2) representing a session.<a href="#section-4-4.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.3">
Sequence Number: monotonically increasing counter that uniquely represents a message from a session.<a href="#section-4-4.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.4">
 ODAP Phase: current ODAP phase.<a href="#section-4-4.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.5">
 Resource URL: Location of Resource to be accessed.<a href="#section-4-4.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.6">
 Developer URN: Assertion of developer / application identity.<a href="#section-4-4.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.7">
 Action/Response: GET/POST and arguments (or Response Code).<a href="#section-4-4.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.8">
 Credential Profile: Specify type of auth (e.g. SAML, OAuth, X.509).<a href="#section-4-4.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.9">
 Credential Block: Credential token, certificate, string.<a href="#section-4-4.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.10">
 Payload Profile: Asset Profile provenance and capabilities.<a href="#section-4-4.10" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.11">
 Application Profile: Vendor or Application specific profile.<a href="#section-4-4.11" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.12">
 Payload: Payload for POST, responses, and native DLT txns. The payload is specific to the current ODAP phase.<a href="#section-4-4.12" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-4.13">
 Payload Hash: hash of the current message payload.<a href="#section-4-4.13" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-5">
In addition to the attributes that belong to ODAP s schema, each log entry REQUIRES the following attributes:<a href="#section-4-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-6.1">
 timestamp REQUIRED: timestamp referring to when the log entry was generated (UNIX format).<a href="#section-4-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.2">
 source_gateway_pubkey REQUIRED: the public key of the gateway initiating a transfer.<a href="#section-4-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.3">
source_gateway_dlt_system REQUIRED: the ID of the source DLT.<a href="#section-4-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.4">
 recipient_gateway_pubkey REQUIRED: the public key of the gateway involved in a transfer.<a href="#section-4-6.4" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.5">
 recipient_gateway_dlt_system REQUIRED: the ID of the recipient gatewayinvolved in a transfer.<a href="#section-4-6.5" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.6">
 logging_profile REQUIRED: contains the profile regarding the logging procedure. Default is local store.<a href="#section-4-6.6" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.7">
 Message_signature REQUIRED: Gateway EDCSA signature over the log entry.<a href="#section-4-6.7" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.8">
 Last_entry_hash REQUIRED: Hash of previous log entry.<a href="#section-4-6.8" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.9">
 Access_control_profile REQUIRED: the profile regarding the confidentiality of the log entries being stored. Default is only the gateway that created the logs can access them.<a href="#section-4-6.9" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-6.10">
 Operation: the high level operation being executed by the gateway on that step.
  There are five types of operations: Operation init- states the intention of a node to execute a particular operation; Operation exec- expresses that the node is executing the operation; Operation done- states when a node successfully executed a step of the protocol;
  Operation ack- refers to when a node acknowledges a message received from another (e.g., command executed); Operation fail- occurs when an agent fails to execute a specific step.<a href="#section-4-6.10" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-7">
Optional field entries are:<a href="#section-4-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-8.1">
 source_gateway_uid OPTIONAL: the uid of the source gateway involved in a transfer.<a href="#section-4-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-8.2">
 recipient_gateway_uid : the uid of the recipient gateway involved in a transfer.<a href="#section-4-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-8.3">
recovery message: the type of recovery message, if gateway is involved in a recovery procedure.<a href="#section-4-8.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-4-8.4">
 recovery payload: the payload associated with the recovery message.<a href="#section-4-8.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-4-9"> 
 Example of a log entry created by G1, corresponding to locking an asset (phase 2.3 of the ODAP protocol) :<a href="#section-4-9" class="pilcrow">¶</a></p>
<div id="example_log_entry_1">
<figure id="figure-4">
        <div class="alignLeft art-text artwork" id="section-4-10.1">
<pre>

{
"sessionId": "4eb424c8-aead-4e9e-a321-a160ac3909ac",
"seqNumber": 6,
"phaseId": "lock",
"sourceGatewayId": "5.47.165.186",
"sourceDltId": "Hyperledger-Fabric-JusticeChain",
"targetGatewayId": "192.47.113.116",
"targetDltId": "Ethereum",
"timestamp": "1606157330",
"payload": {
"messageType": "2pc-log",
"message": "LOCK_ASSET",
"votes": "none"
},
"payloadHash": "80BCF1C7421E98B097264D1C6F1A514576D6C9F4EF04955FA3AEF1C0664B34E3",
"logEntryHash": "[...]"
}

</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a></figcaption></figure>
</div>
<p id="section-4-11"> 
 Example of a log entry created by G2, acknowledging G1 locking an asset (phase 2.4 of the ODAP protocol) :<a href="#section-4-11" class="pilcrow">¶</a></p>
<div id="example_log_entry_2">
<figure id="figure-5">
        <div class="alignLeft art-text artwork" id="section-4-12.1">
<pre>
                {
"sessionId": "4eb424c8-aead-4e9e-a321-a160ac3909ac",
"seqNumber": 7,
"phaseId": "lock",
"sourceGatewayId": "5.47.165.186",
"sourceDltId": "Hyperledger-Fabric-JusticeChain",
"targetGatewayId": "192.47.113.116",
"targetDltId": "Ethereum",
"timestamp": "1606157333",
"payload": {
"messageType": "2pc-log",
"message": "LOCK_ASSET_ACK",
"votes": "none"
}

</pre>
</div>
<figcaption><a href="#figure-5" class="selfRef">Figure 5</a></figcaption></figure>
</div>
</section>
</div>
<div id="odap-2pc">
<section id="section-5">
      <h2 id="name-odap-2pc-2">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-odap-2pc-2" class="section-name selfRef">ODAP-2PC</a>
      </h2>
<p id="section-5-1">
This section defines general considerations about crash recovery.
ODAP-2PC is the application of the gateway crash recovery mechanism to asset transfers across all ODAP phases.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="crm">
<section id="section-5.1">
        <h3 id="name-crash-recovery-model-2">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-crash-recovery-model-2" class="section-name selfRef">Crash Recovery Model</a>
        </h3>
<p id="section-5.1-1">
 Gateways can fail by crashing (i.e., becoming silent). In order to be able to recover from these crashes, gateways store log entries in a persistent data storage. Thus, gateways can recover by obtaining the latest successful operation and continuing from there. We consider two recovery models:<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-2.1">
 1. Self-healing mode: assumes that after a crash, a gateway eventually recovers. The gateway does not lose its long-term keys (public-private key pair) and can reestablish all TLS connections.<a href="#section-5.1-2.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-2.2">
 2. Primary-backup mode assumes that a gateway may never recover after a crash but that this failure can be detected by timeout [AD76]. If the timeout is exceeded, a backup gateway detects that failure unequivocally and takes the role of the primary gateway. The failure is detected using heartbeat messages and a conservative period.<a href="#section-5.1-2.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-3">
 In both modes, after a gateway recovers, the gateways follow a general recovery procedure (in Section 6.2 explained in detail for each phase):<a href="#section-5.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1-4.1">
 1. Crash communication: using the self-healing or primary-backup modes, a node recovers. After that, it sends a message RECOVER to the counterparty gateways.<a href="#section-5.1-4.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-4.2">
 2. State update: The gateway syncs its state with the latest state, either by requesting it from the decentralized log storage or other gateways (depending on the log storage mode).
   If a decentralized log storage is available, the crashed gateway attempts to update its local log, using getLogDiff from the shared log.
   If there is no shared log, the crashed gateway needs to synchronize itself with the counterparty gateway by querying the counterparty gateway with a recovery message RECOVER containing the latest log before the crash.
   The counterparty gateway sends back a RECOVER-UPDATE message with its log. The recovered gateway can now reconstruct the updated log via getLogDiff, and derive the current state of the asset transfer.
   The gateways now share the same state and can proceed with its operation.<a href="#section-5.1-4.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.1-4.3"> 3. Recovery communication: The gateway and informs other gateways of the recovery with a recovery confirmation message is sent (RECOVERY-CONFIRM), and the respective acknowledgment is sent by the counterparty gateway (RECOVERY-ACK).<a href="#section-5.1-4.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.1-5"> Finally, the gateway resumes the normal execution of ODAP.<a href="#section-5.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rp">
<section id="section-5.2">
        <h3 id="name-recovery-procedure-2">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-recovery-procedure-2" class="section-name selfRef">Recovery Procedure</a>
        </h3>
<p id="section-5.2-1">
 The previous section explained the general procedure that gateways follow upon crashing. In more detail, for each ODAP phase, we define the recovery procedure called ODAP-2PC:<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<div id="tif">
<section id="section-5.2.1">
          <h4 id="name-transfer-initiation-flow-2">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-transfer-initiation-flow-2" class="section-name selfRef">Transfer Initiation Flow</a>
          </h4>
<p id="section-5.2.1-1">
 This phase of ODAP follows the Crash Recovery Model from Section 6.1.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="lef">
<section id="section-5.2.2">
          <h4 id="name-lock-evidence-flow-2">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-lock-evidence-flow-2" class="section-name selfRef">Lock-Evidence Flow</a>
          </h4>
<p id="section-5.2.2-1">
 This phase of ODAP follows the Crash Recovery Model from Section 6.1.
Note that, in this phase, distributed ledgers were changed by gateways. The crash gateways' recovery should take place in less than the timeout specified for the asset transfer. Otherwise, the rollback protocol present in the next section is applied.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="cef">
<section id="section-5.2.3">
          <h4 id="name-commitment-establishment-flo">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-commitment-establishment-flo" class="section-name selfRef">Commitment Establishment  Flow</a>
          </h4>
<p id="section-5.2.3-1">
 This phase of ODAP follows the Crash Recovery Model from Section 6.1 and extra steps because in the third phase, distributed gateways changed ledgers.

As transactions cannot be undone on blockchains, reverting a transaction includes issuing new transactions (with the contrary effect of the ones to be reverted). We use a rollback list [HERMES] to keep track of which transaction may be rolled back.
The crash recovery protocol for the Commitment Establishment Flow is as follows (steps according to Figure 4 [HERMES]):<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2.3-2.1">
 1. Rollback lists for all the gateways involved are initialized.<a href="#section-5.2.3-2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.2">

2. On step 2.3, add a pre-lock transaction to the source gateway rollback list.<a href="#section-5.2.3-2.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.3">
3. On step 3.2, if the request is denied, abort the transaction and apply rollbacks on the source gateway.<a href="#section-5.2.3-2.3" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.4">
4. On step 3.3, add a lock transaction to the source gateway rollback list.<a href="#section-5.2.3-2.4" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.5">
5. On step 3.4, if the commit fails, abort the transaction and apply rollbacks on the source gateway.<a href="#section-5.2.3-2.5" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.6">
6. On step 3.5,  add a create asset transaction to the rollback list of the recipient gateway.<a href="#section-5.2.3-2.6" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.7">
7. On step 3.8, if the commit is successful, ODAP terminates.<a href="#section-5.2.3-2.7" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.2.3-2.8">
8: Otherwise, if the last commit is unsuccessful, then abort the transaction and apply rollbacks to both gateways.<a href="#section-5.2.3-2.8" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="odap-2pcm">
<section id="section-5.3">
        <h3 id="name-odap-2pc-messages-2">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-odap-2pc-messages-2" class="section-name selfRef">ODAP-2PC Messages</a>
        </h3>
<p id="section-5.3-1">
ODAP-2PC messages are used to recover from crashes at the several ODAP phases.
These messages inform gateways of the current state of a recovery procedure.
ODAP-2PC messages follow the log format from Section 4.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div id="odap-2pcm-r">
<section id="section-5.3.1">
          <h4 id="name-recover-2">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-recover-2" class="section-name selfRef">RECOVER</a>
          </h4>
<p id="section-5.3.1-1">
 A recover message is sent from the crashed gateway to the counterparty gateway, sending its most recent state.
This message type is encoded on the recovery message field of an ODAP log.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2">
 The parameters of the recovery message payload consists of the following:<a href="#section-5.3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-3.1">
 ODAP phase: latest ODAP phase registered.<a href="#section-5.3.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-3.2">
 Sequence number: latest sequence number registered.<a href="#section-5.3.1-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.1-3.3">
 Last_entry_hash REQUIRED: Hash of previous log entry.<a href="#section-5.3.1-3.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="odap-2pcm-ru">
<section id="section-5.3.2">
          <h4 id="name-recover-udpdate-2">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-recover-udpdate-2" class="section-name selfRef">RECOVER-UDPDATE</a>
          </h4>
<p id="section-5.3.2-1">The recover update message is sent by the counterparty gateway after receiving a recover message from a recovered gateway.
 The recovered gateway informs of its current state (via the current state of the log).
 The counterparty gateway now calculates the difference between the log entry corresponding to the received sequence number from the recovered gateway and
 the latest sequence number (corresponding to the latest log entry).
 This state is sent to the recovered gateway.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">
 The parameters of the recover update payload consists of the following:<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.2-3.1">
 recovered logs: the list of log messages that the recovered gateway needs to update.<a href="#section-5.3.2-3.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="odap-2pcm-rua">
<section id="section-5.3.3">
          <h4 id="name-recover-update-ack-2">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-recover-update-ack-2" class="section-name selfRef">RECOVER-UPDATE ACK</a>
          </h4>
<p id="section-5.3.3-1">
 The recover-update ack message (response to RECOVER-UPDATE) states if the recovered gateway's logs has been successfully updated.
 If inconsistencies are detected, the recovered gateway answers with  initiates a dispute (RECOVER-DISPUTE message).<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3.3-2">
 The parameters of this message consists of the following:<a href="#section-5.3.3-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.3-3.1">
 success: true/false.<a href="#section-5.3.3-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.3-3.2">
 entries changed: list of hashes of log entries that were appeded to the recovered gateway log.<a href="#section-5.3.3-3.2" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="odap-2pcm-rs">
<section id="section-5.3.4">
          <h4 id="name-recover-success-2">
<a href="#section-5.3.4" class="section-number selfRef">5.3.4. </a><a href="#name-recover-success-2" class="section-name selfRef">RECOVER-SUCCESS</a>
          </h4>
<p id="section-5.3.4-1">
 The recover-ack message is sent by the counterparty gateway to the recovered gateway acknowledging that the state is synchronized.<a href="#section-5.3.4-1" class="pilcrow">¶</a></p>
<p id="section-5.3.4-2">
 The parameters of this message consists of the following:<a href="#section-5.3.4-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.4-3.1">
 success: true/false.<a href="#section-5.3.4-3.1" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
<div id="odap-2pcm-roll">
<section id="section-5.3.5">
          <h4 id="name-rollback-2">
<a href="#section-5.3.5" class="section-number selfRef">5.3.5. </a><a href="#name-rollback-2" class="section-name selfRef">ROLLBACK</a>
          </h4>
<p id="section-5.3.5-1">
 A rollback message is sent by a gateway that initiated a rollback as defined by ODAP-2PC.<a href="#section-5.3.5-1" class="pilcrow">¶</a></p>
<p id="section-5.3.5-2">
 The parameters of this message consists of the following:<a href="#section-5.3.5-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.5-3.1">
 success: true/false.<a href="#section-5.3.5-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.5-3.2">
 actions performed: actions performed to rollback a state (e.g., UNLOCK; BURN).<a href="#section-5.3.5-3.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-5.3.5-3.3">
 proofs: TBD.<a href="#section-5.3.5-3.3" class="pilcrow">¶</a>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="odap-2pcm-examples">
<section id="section-5.4">
        <h3 id="name-examples-2">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-examples-2" class="section-name selfRef">Examples</a>
        </h3>
<p id="section-5.4-1">
 There are several situations when a crash may occur.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="odap-2pcm-examples_1">
<section id="section-5.4.1">
          <h4 id="name-crashing-before-issuing-a-co">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-crashing-before-issuing-a-co" class="section-name selfRef">Crashing before issuing a command to the counterparty gateway</a>
          </h4>
<p id="section-5.4.1-1">
 The following figure represents the source gateway (G1) crashing before it issued an init command to the recipient gateway (G2).<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<div id="odap-2pcm-examples_1_fig">
<figure id="figure-6">
            <div class="alignLeft art-text artwork" id="section-5.4.1-2.1">
<pre>
     ,--.                           ,--.             ,-------.
     |G1|                           |G2|             |Log API|
     `--'                           `--'             `-------'
      |     [1]: writeLogEntry &lt;1, 1, init-validate&gt;     |
      | -------------------------------------------------&gt;
      |                              |                   |
      |----.                         |                   |
      |    | [2]  Crash              |                   |
      |&lt;---'  ...                    |                   |
      |      [3]recover              |                   |
      |                              |                   |
      |                              |                   |
      |      [4] &lt;1, 2, RECOVER&gt;     |                   |
      | -----------------------------&gt;                   |
      |                              |                   |
      |                              | [5] getLogEntry(i)|
      |                              | ------------------&gt;
      |                              |                   |
      |                              |   [6] logEntries  |
      |                              | &lt;- - - - - - - - -
      |                              |                   |
      |   [7] &lt;1,3,RECOVER-UPDATE&gt;   |                   |
      | &lt;-----------------------------                   |
      |                              |                   |
      |----.                         |                   |
      |    | [8] process log         |                   |
      |&lt;---'                         |                   |
      |                              |                   |
      |              [9] &lt;1,4,writeLogEntry&gt;             |
      | -------------------------------------------------&gt;
      |                              |                   |
      | [10] &lt;1,5,RECOVER-UPDATE-ACK&gt;|                   |
      | -----------------------------&gt;                   |
      |                              |                   |
      |   [11] &lt;1,6,RECOVER-SUCESS&gt;  |                   |
      | &lt;-----------------------------                   |
      |                              |                   |
      |           [12]: &lt;1,7,init-validateNext&gt;          |
      | -------------------------------------------------&gt;
     ,--.                           ,--.             ,-------.
     |G1|                           |G2|             |Log API|
     `--'                           `--'             `-------'


</pre>
</div>
<figcaption><a href="#figure-6" class="selfRef">Figure 6</a></figcaption></figure>
</div>
</section>
</div>
<div id="odap-2pcm-examples_2">
<section id="section-5.4.2">
          <h4 id="name-crashing-after-issuing-a-com">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-crashing-after-issuing-a-com" class="section-name selfRef">Crashing after issuing a command to the counterparty gateway</a>
          </h4>
<p id="section-5.4.2-1">
 The second scenario requires further synchronization (figure below). At the retrieval of the latest log entry, G1 notices its log is outdated. It updates it upon necessary validation and then communicates its recovery to G2. The process then continues as defined.<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<div id="odap-2pcm-examples_2_fig">
<figure id="figure-7">
            <div class="alignLeft art-text artwork" id="section-5.4.2-2.1">
<pre>

     ,--.                           ,--.                             ,-------.
     |G1|                           |G2|                             |Log API|
     `--'                           `--'                             `-------'
      |              [1]: writeLogEntry &lt;1,1,init-validate&gt;              |
      | -----------------------------------------------------------------&gt;
      |                              |                                   |
      |   [2]: &lt;1,1,init-validate&gt;   |                                   |
      | -----------------------------&gt;                                   |
      |                              |                                   |
      |----.                         |                                   |
      |    | [3] Crash               |                                   |
      |&lt;---'                         |                                   |
      |                              |                                   |
      |                              | [4]: writeLogEntry &lt;exec-validate&gt;|
      |                              | ----------------------------------&gt;
      |                              |                                   |
      |                              |----.                              |
      |                              |    | [5]: execute init            |
      |                              |&lt;---'                              |
      |                              |                                   |
      |                              |   [6]: writeLogEntry &lt;done-init&gt;  |
      |                              | ----------------------------------&gt;
      |                              |                                   |
      |                              |   [7]: writeLogEntry &lt;ack-init&gt;   |
      |                              | ----------------------------------&gt;
      |                              |                                   |
      | [8] &lt;1,2,init-validate-ack&gt;  |                                   |
      |  discovers that G1 crashed   |                                   |
      |  via timeout                 |                                   |
      | &lt;-----------------------------                                   |
      |                              |                                   |
      |----.                         |                                   |
      |    | [9] Recover             |                                   |
      |&lt;---'                         |                                   |
      |                              |                                   |
      |     [10] &lt;1, 2, RECOVER&gt;     |                                   |
      | -----------------------------&gt;                                   |
      |                              |                                   |
      |                              |        [11] getLogEntry(i)        |
      |                              | ----------------------------------&gt;
      |                              |                                   |
      |                              |          [12] logEntries          |
      |                              | &lt;- - - - - - - - - - - - - - - - -
      |                              |                                   |
      |   [13] &lt;1,3,RECOVER-UPDATE&gt;  |                                   |
      | &lt;-----------------------------                                   |
      |                              |                                   |
      |----.                         |                                   |
      |    | [14] process log        |                                   |
      |&lt;---'                         |                                   |
      |                              |                                   |
      |                     [15] &lt;1,4,writeLogEntry&gt;                     |
      | -----------------------------------------------------------------&gt;
      |                              |                                   |
      | [16] &lt;1,5,RECOVER-UPDATE-ACK&gt;|                                   |
      | -----------------------------&gt;                                   |
      |                              |                                   |
      |   [17] &lt;1,6,RECOVER-SUCESS&gt;  |                                   |
      | &lt;-----------------------------                                   |
      |                              |                                   |
      |                   [18]: &lt;1,7,init-validateNext&gt;                  |
      | -----------------------------------------------------------------&gt;
     ,--.                           ,--.                             ,-------.
     |G1|                           |G2|                             |Log API|
     `--'                           `--'                             `-------'



</pre>
</div>
<figcaption><a href="#figure-7" class="selfRef">Figure 7</a></figcaption></figure>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="s">
<section id="section-6">
      <h2 id="name-security-considerations-2">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-6-1">
We assume a trusted, authenticated, secure, reliable communication channel between gateways (i.e., messages cannot be spoofed and/or altered by an adversary) using TLS/HTTPS [TLS]. Clients support acceptable credential schemes such as OAuth2.0.
We assume the storage service used provides the means necessary to assure the logs' confidentiality and integrity, stored and in transit. The service must provide an authentication and authorization scheme, e.g., based on OAuth and OIDC [OIDC], and use secure channels based on TLS/HTTPS [TLS].
The present protocol is crash fault-tolerant, meaning that it handles gateways that crash for several reasons (e.g., power outage). The present protocol does not support Byzantine faults, where gateways can behave arbitrarily (including being malicious). This implies that both gateways are considered trusted. We assume logs are not tampered with or lost.

Log entries need integrity, availability, and confidentiality guarantees, as they are an attractive point of attack [BVC19]. Every log entry contains a hash of its payload for guaranteeing integrity.  If extra guarantees are needed (e.g., non-repudiation),  a log entry might be signed by its creator. Availability is guaranteed by the usage of the log storage API that connects a gateway to a dependable storage (local, external, or DLT-based). Each underlying storage provides different guarantees. Access control can be enforced via the access control profile that each log can have associated with, i.e., the profile can be resolved, indicating who can access the log entry in which condition. Access control profiles can be implemented with access control lists for simple authorization. The authentication of the entities accessing the logs is done at the Log Storage API level (e.g., username+password authentication in local storage vs. blockchain-based access control in a DLT).

For extra guarantees, the nodes running the log storage API (or the gateway nodes themselves) can be protected by hardening technologies such as Intel SGX [CD16].<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-references-2">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references-2" class="section-name selfRef">References</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-normative-references-2">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references-2" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="ODAP">[ODAP]</dt>
        <dd>
<span class="refAuthor">Hargreaves, M.</span> and <span class="refAuthor">T. Hardjono</span>, <span class="refTitle">"Open Digital Asset Protocol, October 2020, IETF, draft-hargreaves-odap-00."</span>, <time datetime="2020-10" class="refDate">October 2020</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/draft-hargreaves-odap/">https://datatracker.ietf.org/doc/draft-hargreaves-odap/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS">[TLS]</dt>
      <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3?, RFC 8446."</span>, <time datetime="2018" class="refDate">2018</time>, <span>&lt;<a href="https://tools.ietf.org/rfc/rfc8446">https://tools.ietf.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-informative-references-2">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references-2" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="AD76">[AD76]</dt>
        <dd>
<span class="refAuthor">Alsberg, P.</span> and <span class="refAuthor">D. Day</span>, <span class="refTitle">"A principle for resilient sharing of distributed resources. In Proc. of the 2nd Int. Conf. on Software Engineering"</span>, <time datetime="1976" class="refDate">1976</time>, <span>&lt;<a href="978-0-201-10715-9">978-0-201-10715-9</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BHG87">[BHG87]</dt>
        <dd>
<span class="refAuthor">Bernstein, P.</span>, <span class="refAuthor">Hadzilacos, V.</span>, and <span class="refAuthor">N. Goodman</span>, <span class="refTitle">"Concurrency Control and Recovery in Database Systems, Chapter 7. Addison Wesley Publishing Company"</span>, <time datetime="1987" class="refDate">1987</time>, <span>&lt;<a href="https://doi.org/10.3389/fbloc.2019.00024">https://doi.org/10.3389/fbloc.2019.00024</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BVC19">[BVC19]</dt>
        <dd>
<span class="refAuthor">Belchior, R.</span>, <span class="refAuthor">Vasconcelos, A.</span>, and <span class="refAuthor">M. Correia</span>, <span class="refTitle">"Towards Secure, Decentralized, and Automatic Audits with Blockchain. European Conference on Information Systems"</span>, <time datetime="2019" class="refDate">2019</time>, <span>&lt;<a href="https://aisel.aisnet.org/ecis2020_rp/68/">https://aisel.aisnet.org/ecis2020_rp/68/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="Clar88">[Clar88]</dt>
        <dd>
<span class="refAuthor">Clark, D.</span>, <span class="refTitle">"The Design Philosophy of the DARPA Internet Protocols, ACM Computer Communication Review, Proc SIGCOMM 88, vol. 18, no. 4, pp. 106-114"</span>, <time datetime="1988-08" class="refDate">August 1988</time>. </dd>
<dd class="break"></dd>
<dt id="HERMES">[HERMES]</dt>
        <dd>
<span class="refAuthor">Belchior, R.</span>, <span class="refAuthor">Vasconcelos, A.</span>, <span class="refAuthor">Correia, M.</span>, and <span class="refAuthor">T. Hardjono</span>, <span class="refTitle">"HERMES: Fault-Tolerant Middleware for Blockchain Interoperability"</span>, <time datetime="2021" class="refDate">2021</time>, <span>&lt;<a href="https://www.techrxiv.org/articles/preprint/HERMES_Fault-Tolerant_Middleware_for_Blockchain_Interoperability/14120291">https://www.techrxiv.org/articles/preprint/HERMES_Fault-Tolerant_Middleware_for_Blockchain_Interoperability/14120291</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HS2019">[HS2019]</dt>
        <dd>
<span class="refAuthor">Hardjono, T.</span> and <span class="refAuthor">N. Smith</span>, <span class="refTitle">"Decentralized Trusted Computing Base for Blockchain Infrastructure Security, Frontiers Journal, Special Issue on Blockchain Technology, Vol. 2, No. 24"</span>, <time datetime="2019-12" class="refDate">December 2019</time>, <span>&lt;<a href="https://doi.org/10.3389/fbloc.2019.00024">https://doi.org/10.3389/fbloc.2019.00024</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OIDC">[OIDC]</dt>
        <dd>
<span class="refAuthor">Sakimura, N.</span>, <span class="refAuthor">Bradley, J.</span>, <span class="refAuthor">Jones, M.</span>, <span class="refAuthor">de Medeiros, B.</span>, and <span class="refAuthor">C. Mortimore</span>, <span class="refTitle">"OpenID Connect Core 1.0"</span>, <time datetime="2014" class="refDate">2014</time>, <span>&lt;<a href="http://openid.net/specs/openid-connect-core-1_0.html">http://openid.net/specs/openid-connect-core-1_0.html</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SRC84">[SRC84]</dt>
      <dd>
<span class="refAuthor">Saltzer, J.</span>, <span class="refAuthor">Reed, D.</span>, and <span class="refAuthor">D. Clark</span>, <span class="refTitle">"End-to-End Arguments in System Design, ACM Transactions on Computer Systems, vol. 2, no. 4, pp. 277-288"</span>, <time datetime="1984-11" class="refDate">November 1984</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses-2">
<a href="#name-authors-addresses-2" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Rafael Belchior</span></div>
<div dir="auto" class="left"><span class="org">INESC-ID, Instituto Superior Técnico</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:rafael.belchior@tecnico.ulisboa.pt" class="email">rafael.belchior@tecnico.ulisboa.pt</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Miguel Correia</span></div>
<div dir="auto" class="left"><span class="org">INESC-ID, Instituto Superior Técnico</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:miguel.p.correia@tecnico.ulisboa.pt" class="email">miguel.p.correia@tecnico.ulisboa.pt</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Thomas Hardjono</span></div>
<div dir="auto" class="left"><span class="org">MIT</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:hardjono@mit.edu" class="email">hardjono@mit.edu</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
