<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>IMAP4 Multimailbox SEARCH Extension</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="IMAP4 Multimailbox SEARCH Extension">
<meta name="keywords" content="IMAP, email, search, multiple mailboxes, imapext">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Message ORGanization Working Group</td><td class="header">B. Leiba</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Huawei Technologies</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc4466'>4466</a> (if&nbsp;approved)</td><td class="header">A. Melnikov</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">Isode Limited</td></tr>
<tr><td class="header">Expires: August 9, 2010</td><td class="header">February 05, 2010</td></tr>
</table></td></tr></table>
<h1><br />IMAP4 Multimailbox SEARCH Extension<br />draft-ietf-morg-multimailbox-search-02</h1>

<h3>Abstract</h3>

<p>
        The IMAP4 specification allows the searching only of the selected
        mailbox.  A user often wants to search multiple mailboxes, and a
        client that wishes to support this must issue a series of SELECT and
        SEARCH commands, waiting for each to complete before moving on to the
        next.  This extension allows a client to search multiple mailboxes
        with one command, limiting the round-trips and waiting for various
        searches to complete, and not requiring disruption of the currently
        selected mailbox.  This also uses MAILBOX and TAG fields in
        ESEARCH responses, allowing a client to pipeline the searches if it chooses.
      
</p>
<h3>Note</h3>

<p>
        A revised version of this draft document will be submitted to the RFC
        editor as a Proposed Standard for the Internet Community.
        Discussion and suggestions for improvement are requested, and should
        be sent to morg@ietf.org.
      
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">1.1.</a>&nbsp;
Conventions used in this document<br />
<br />
<a href="#anchor3">2.</a>&nbsp;
Extensions to SEARCH/UID SEARCH command<br />
<a href="#anchor4">2.1.</a>&nbsp;
The ESEARCH response<br />
<a href="#anchor5">2.2.</a>&nbsp;
Source options -- specifying mailboxes to search<br />
<br />
<a href="#anchor6">3.</a>&nbsp;
Open Issues<br />
<br />
<a href="#examples">4.</a>&nbsp;
Examples<br />
<br />
<a href="#syntax">5.</a>&nbsp;
Formal Syntax<br />
<br />
<a href="#security">6.</a>&nbsp;
Security Considerations<br />
<br />
<a href="#iana">7.</a>&nbsp;
IANA Considerations<br />
<br />
<a href="#anchor7">8.</a>&nbsp;
Acknowledgements<br />
<br />
<a href="#rfc.references1">9.</a>&nbsp;
Normative References<br />
<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
        The IMAP4 specification allows the searching only of the selected
        mailbox.  A user often wants to search multiple mailboxes, and a
        client that wishes to support this must issue a series of SELECT and
        SEARCH commands, waiting for each to complete before moving on to the
        next.  The commands can't be pipelined, because the server might run
        them in parallel, and the untagged SEARCH responses could not then
        be distinguished from each other.
      
</p>
<p>
        This extension allows a client to search multiple mailboxes
        with one command, and includes MAILBOX and TAG fields in the ESEARCH response,
        yielding the following advantages:
        </p>
<ul class="text">
<li>
            A single command limits the number of round-trips needed to search
            a set of mailboxes.
          
</li>
<li>
            A single command eliminates the need to wait for one search to complete
            before starting the next.
          
</li>
<li>
            A single command allows the server to optimize the search, if it can.
          
</li>
<li>
            A command that is not dependent upon the selected mailbox eliminates the
            need to disrupt the selection state, or to open another IMAP connection.
          
</li>
<li>
            The MAILBOX and TAG fields in the responses allow a client to distinguish
            which responses go with which search (and which mailbox).
            A client can safely pipeline these search commands without danger of confusion.
          
</li>
</ul><p>
      
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Conventions used in this document</h3>

<p>
          In examples, "C:" indicates lines sent by a client that is connected
          to a server.  "S:" indicates lines sent by the server to the client.
        
</p>
<p>
          The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
          "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document
          are to be interpreted as described in RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
        
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Extensions to SEARCH/UID SEARCH command</h3>

<p>
        </p>
<blockquote class="text"><dl>
<dt>Arguments:</dt>
<dd>OPTIONAL source options
          OPTIONAL result options<br />

          OPTIONAL charset specification (see <a class='info' href='#RFC2978'>[RFC2978]<span> (</span><span class='info'>Freed, N. and J. Postel, &ldquo;IANA Charset Registration Procedures,&rdquo; October&nbsp;2000.</span><span>)</span></a>)<br />

          searching criteria (one or more)
        
</dd>
<dt>Responses:</dt>
<dd>REQUIRED untagged response: SEARCH or ESEARCH
        
</dd>
<dt>Result:</dt>
<dd>OK - search completed
          NO - error: cannot search that charset or criteria<br />

          BAD - command unknown or arguments invalid
        
</dd>
</dl></blockquote><p>
      
</p>
<p>
        This section further updates definition of the SEARCH command described in
        section 2.6.1 of <a class='info' href='#RFC4466'>[RFC4466]<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a>
        (initially described in section 6.4.4 of <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>
        and extended by <a class='info' href='#RFC4731'>[RFC4731]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>).
      
</p>
<p>
        The SEARCH command is extended to allow for optional source and result options.
        This document does not define any new result options
        (see Section 3.1 of <a class='info' href='#RFC4731'>[RFC4731]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>).
        A server that supports this extension includes
        <a class='info' href='#comment.fix-for-pub-1'>[fix-for-pub-1]<span> (</span><span class='info'>&quot;X-DRAFT-I03-MMBX&quot; (changes for publication)</span><span>)</span></a><a name='fix-for-pub-1'></a>
        in its IMAP capability string.        
      
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
The ESEARCH response</h3>

<p>
          Unless specified otherwise by a description of a result option, in the presence of
          a search source option the server MUST return ESEARCH responses <a class='info' href='#RFC4731'>[RFC4731]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>
          instead of the corresponding SEARCH responses.
          Because message numbers are not useful for mailboxes that are not selected,
          each ESEARCH response MUST return information about UIDs, not message numbers,
          regardless of whether it is in response to a SEARCH or a UID SEARCH command.
          In particular, the responses MUST contain the UID indicator.
          This is true even if the source options specify that only the selected mailbox
          be searched.
        
</p>
<p>
          Presence of a source option in absence of a result option implies the "ALL" result
          option (see Section 3.1 of <a class='info' href='#RFC4731'>[RFC4731]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>).  Note that this is not the same
          as the result from the SEARCH command described in the IMAP base protocol.
        
</p>
<p>
          Source options describe which mailboxes must be searched for messages.
          A SEARCH/UID SEARCH command with source options does not affect which
          mailbox, if any, is currently selected, regardless of which mailboxes are searched.
        
</p>
<p>
          For each mailbox satisfying the source options, a single ESEARCH response MUST be returned
          if any messages in that mailbox match the search criteria.  An ESEARCH respoonse
          SHOULD NOT <a class='info' href='#comment.Barry'>[Barry]<span> (</span><span class='info'>Why not MUST NOT ?</span><span>)</span></a><a name='Barry'></a>
          be returned for mailboxes that contain no matching messages.
          This is true even when result options such as MIN, MAX, and COUNT are specified
          (see section 3.1 of <a class='info' href='#RFC4731'>[RFC4731]<span> (</span><span class='info'>Melnikov, A. and D. Cridland, &ldquo;IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned,&rdquo; November&nbsp;2006.</span><span>)</span></a>), and the values returned
          (lowest UID matched, highest UID matched, and number of messages matched,
          respectively) apply to the mailbox reported in that ESEARCH response.
        
</p>
<p>
          Note that it is now possible for a SEARCH command to return NO untagged responses
          (no SEARCH nor ESEARCH responses), in the case that there are no matches to the search
          in any of the mailboxes that satisfy the source options.
          Clients can detect this situation by finding the tagged OK response without having
          received any matching untagged ESEARCH responses.
        
</p>
<p>
          Each ESEARCH response MUST contain the MAILBOX, TAG, and UIDVALIDITY correlators.
          Correlators allow clients to issue several SEARCH/UID SEARCH commands at once (pipelined).
          The server MAY perform pipelined searches in parallel; or it MAY instead serialize them.
        
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Source options -- specifying mailboxes to search</h3>

<p>
          The source options, if present, MUST contain a mailbox specifier as defined in the
          IMAP NOTIFY extension <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a>, section 6 (using the "filter-mailboxes"
          ABNF item), with the following changes:
          </p>
<ol class="text">
<li>
              The "selected-delayed" specifier is not valid here.
            
</li>
<li>
              A "subtree-one" specifier is added.  The "subtree" specifier results in a search of
              the specified mailbox and all selectable mailboxes that are subordinate to it, through
              an indefinitely deep hierarchy.  The "subtree-one" specifier results in a search of
              the specified mailbox and all selectable child mailboxes, one hierarchy level down.
            
</li>
</ol><p>
        
</p>
<p>
          If "subtree" is specified, the server MUST defend against loops in the hierarchy
          (for example, those caused by recursive file-system links within the message store).
          The server SHOULD do this by keeping track of the mailboxes that have been searched,
          and terminating the hierarchy traversal when a repeat is found.  If it can not do
          that, it MAY do it by limiting the hierarchy depth.
        
</p>
<p>
          If the source options are not present, the value "selected" is assumed -- that is,
          only the currently selected mailbox is searched.
        
</p>
<p>
          The "personal" source option is a particularly convenient way to search all of
          the current user's mailboxes.
          Note that there is no way to use wildcard characters to search all mailboxes;
          the "mailboxes" source option does not do wildcard expansion.
        
</p>
<p>
          If the source options include (or default to) "selected", the IMAP session MUST be in
          "selected" state.
          If the source options specify other mailboxes and NOT "selected", then the IMAP session
          MUST be in either "selected" or "authenticated" state.
          If the session is not in a correct state, the SEARCH command returns a "BAD" result.
        
</p>
<p>
          If the server supports the ACL <a class='info' href='#RFC4314'>[RFC4314]<span> (</span><span class='info'>Melnikov, A., &ldquo;IMAP4 Access Control List (ACL) Extension,&rdquo; December&nbsp;2005.</span><span>)</span></a> extension, then
          the logged in user is required to have the 'r' right for each mailbox
          she wants to search. Mailboxes matching the source options for which
          the logged in user has no 'r' right MUST be ignored by a multimailbox search.
          In particular, ESEARCH responses MUST NOT be returned for those mailboxes.
        
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Open Issues</h3>

<p>
        <a class='info' href='#comment.Issues'>[Issues]<span> (</span><span class='info'>This is a section of To-Do items and considerations before this draft is done. This section will be worked through, emptied, and removed before we send this on.</span><span>)</span></a><a name='Issues'></a>
      
</p>
<p>
        The Security Considerations section needs to be written.
      
</p>
<p>
        Interaction with IMAP Contexts <a class='info' href='#RFC5267'>[RFC5267]<span> (</span><span class='info'>Cridland, D. and C. King, &ldquo;Contexts for IMAP4,&rdquo; July&nbsp;2008.</span><span>)</span></a> needs to be defined.
      
</p>
<p>
        Suggestion: UPDATE option of IMAP Notify <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a>
        might have to be prohibited when both Context and this extension are used.
        [Barry: But why?  Isn't this then the equivalent of doing many SEARCH commands
        with the UPDATE option?]
      
</p>
<p>
        There's a suggestion to add an EXCLUDE clause (with a nested search criteria).
        For example, one might want to search "personal" but exclude "mailboxes (Trash Spam)".
      
</p>
<p>
        Cyrus suggests you can use metadata to tag mailboxes that you do or don't want to
        search, and use search criteria to exclude them (good for mailboxes that you
        NEVER want searched (as Trash and Spam, above)).
      
</p>
<a name="examples"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Examples</h3>

<p>
        C: tag1 SEARCH IN ((mailboxes "folder1" subtree "folder2")) unseen<br />

        C: tag2 SEARCH IN ((mailboxes "folder1" subtree-one "folder2")) subject "chad"<br />

        S: * ESEARCH (TAG "tag1" MAILBOX "folder1" UIDVALIDITY 1) UID ALL 4001,4003,4005,4007,4009<br />

        S: * ESEARCH (TAG "tag2" MAILBOX "folder1" UIDVALIDITY 6789023554) UID ALL 195001:195004,169788<br />

        S: * ESEARCH (TAG "tag1" MAILBOX "folder2/banana" UIDVALIDITY 503) UID ALL 3002,4004<br />

        S: * ESEARCH (TAG "tag1" MAILBOX "folder2/peach" UIDVALIDITY 3) UID ALL 921691<br />

        S: tag1 OK done<br />

        S: * ESEARCH (TAG "tag2" MAILBOX "folder2/salmon" UIDVALIDITY 1111111) UID ALL 50003,50006,50009,50012<br />

        S: tag2 OK done
      
</p>
<a name="syntax"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Formal Syntax</h3>

<p>
        The following syntax specification uses the Augmented Backus-Naur Form (ABNF)
        as described in <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
        Terms not defined here are taken from <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>, <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a>,
        or <a class='info' href='#RFC4466'>[RFC4466]<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a>.
      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>filter-mailboxes-other =/</dt>
<dd>("subtree-one" SP one-or-more-mailbox)
            ; Update definition from IMAP Notify <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a><br />

            ; Add new "subtree-one" selector.
        
</dd>
<dt>filter-mailboxes-selected =</dt>
<dd>"selected"
            ; Update definition from IMAP Notify <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a><br />

            ; We forbid the use of "selected-delayed".
        
</dd>
<dt>one-correlator =</dt>
<dd>("TAG" SP tag-string) /
            ("MAILBOX" SP astring) / ("UIDVALIDITY" SP nz-number)
            ; Each correlator MUST appear exactly once
        
</dd>
<dt>scope-option =</dt>
<dd>scope-option-name [SP scope-option-value]
            ; No options defined here.  Syntax for future extensions.
        
</dd>
<dt>scope-option-name =</dt>
<dd>tagged-ext-label
            ; No options defined here.  Syntax for future extensions.
        
</dd>
<dt>scope-option-value =</dt>
<dd>tagged-ext-val
            ; No options defined here.  Syntax for future extensions.
        
</dd>
<dt>scope-options =</dt>
<dd>scope-option *(SP scope-option)
            ; A given option may only appear once<br />

            ; No options defined here.  Syntax for future extensions.
        
</dd>
<dt>search =</dt>
<dd>"SEARCH" [SP search-source-opts] [SP search-return-opts]
            SP search-program<br />

            ; Updates definition in IMAP4 ABNF <a class='info' href='#RFC4466'>[RFC4466]<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a>
        
</dd>
<dt>search-correlator =</dt>
<dd>SP "(" one-correlator *(SP one-correlator) ")"
            ; Updates definition in IMAP4 ABNF <a class='info' href='#RFC4466'>[RFC4466]<span> (</span><span class='info'>Melnikov, A. and C. Daboo, &ldquo;Collected Extensions to IMAP4 ABNF,&rdquo; April&nbsp;2006.</span><span>)</span></a>
        
</dd>
<dt>search-source-opts =</dt>
<dd>"IN" SP "(" source-mbox [SP
            "(" scope-options ")"] ")"
        
</dd>
<dt>source-mbox =</dt>
<dd>filter-mailboxes *(SP filter-mailboxes)
            ; filter-mailboxes is defined in IMAP Notify <a class='info' href='#RFC5465'>[RFC5465]<span> (</span><span class='info'>Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;The IMAP NOTIFY Extension,&rdquo; February&nbsp;2009.</span><span>)</span></a><br />

            ; See updated definition of filter-mailboxes-other, above.<br />

            ; See updated definition of filter-mailboxes-selected, above.
        
</dd>
</dl></blockquote><p>
      
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Security Considerations</h3>

<p>
        <a class='info' href='#comment.Security'>[Security]<span> (</span><span class='info'>This needs to be filled in.</span><span>)</span></a><a name='Security'></a>
      
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
IANA Considerations</h3>

<p>
        IMAP4 capabilities are registered by publishing a standards track or
        IESG approved experimental RFC.  The registry is currently located here:
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

   http://www.iana.org/assignments/imap4-capabilities

</pre></div><p>

        This document defines the IMAP capability
        <a class='info' href='#comment.fix-for-pub-2'>[fix-for-pub-2]<span> (</span><span class='info'>X-DRAFT-I03-MMBX (changes for publication)</span><span>)</span></a><a name='fix-for-pub-2'></a>,
        and IANA is asked to add it to the registry.
      
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>
        The authors gratefully acknowledge feedback provided by Timo Sirainen, Peter Coates
        and Arnt Gulbrandsen.
      
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2978">[RFC2978]</a></td>
<td class="author-text">Freed, N. and J. Postel, &ldquo;<a href="http://tools.ietf.org/html/rfc2978">IANA Charset Registration Procedures</a>,&rdquo; BCP&nbsp;19, RFC&nbsp;2978, October&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2978.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4314">[RFC4314]</a></td>
<td class="author-text">Melnikov, A., &ldquo;<a href="http://tools.ietf.org/html/rfc4314">IMAP4 Access Control List (ACL) Extension</a>,&rdquo; RFC&nbsp;4314, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4314.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4466">[RFC4466]</a></td>
<td class="author-text">Melnikov, A. and C. Daboo, &ldquo;<a href="http://tools.ietf.org/html/rfc4466">Collected Extensions to IMAP4 ABNF</a>,&rdquo; RFC&nbsp;4466, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4466.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4731">[RFC4731]</a></td>
<td class="author-text">Melnikov, A. and D. Cridland, &ldquo;<a href="http://tools.ietf.org/html/rfc4731">IMAP4 Extension to SEARCH Command for Controlling What Kind of Information Is Returned</a>,&rdquo; RFC&nbsp;4731, November&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4731.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5267">[RFC5267]</a></td>
<td class="author-text">Cridland, D. and C. King, &ldquo;<a href="http://tools.ietf.org/html/rfc5267">Contexts for IMAP4</a>,&rdquo; RFC&nbsp;5267, July&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5267.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5465">[RFC5465]</a></td>
<td class="author-text">Gulbrandsen, A., King, C., and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5465">The IMAP NOTIFY Extension</a>,&rdquo; RFC&nbsp;5465, February&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5465.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Barry Leiba</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Huawei Technologies</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 646 827 0648</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:barryleiba@computer.org">barryleiba@computer.org</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://internetmessagingtechnology.org/">http://internetmessagingtechnology.org/</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Alexey Melnikov</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Isode Limited</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">5 Castle Business Village</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">36 Station Road</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hampton, Middlesex  TW12 2BX</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">UK</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Alexey.Melnikov@isode.com">Alexey.Melnikov@isode.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.melnikov.ca/">http://www.melnikov.ca/</a></td></tr>
</table>
</body></html>
