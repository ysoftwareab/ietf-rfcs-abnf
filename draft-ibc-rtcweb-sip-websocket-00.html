<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>WebSocket Transport for Session Initiation Protocol (SIP)</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Conventions">
<link href="#rfc.section.3" rel="Chapter" title="3 Scope">
<link href="#rfc.section.4" rel="Chapter" title="4 SIP WebSocket Transport">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Via Transport Parameter">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 SIP URI Transport Parameter">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Sending Responses">
<link href="#rfc.section.5" rel="Chapter" title="5 The WebSocket SIP Subprotocol">
<link href="#rfc.section.6" rel="Chapter" title="6 WebSocket Client Usage">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 WebSocket Disconnection">
<link href="#rfc.section.7" rel="Chapter" title="7 WebSocket Server Usage">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 SIP Proxy Considerations">
<link href="#rfc.section.8" rel="Chapter" title="8 WebSocket Connection Keep Alive">
<link href="#rfc.section.9" rel="Chapter" title="9 Examples">
<link href="#rfc.section.9.1" rel="Chapter" title="9.1 Registration">
<link href="#rfc.section.9.2" rel="Chapter" title="9.2 INVITE dialog through a proxy">
<link href="#rfc.section.9.3" rel="Chapter" title="9.3 INVITE dialog through two proxies">
<link href="#rfc.section.10" rel="Chapter" title="10 Security Considerations">
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations">
<link href="#rfc.section.11.1" rel="Chapter" title="11.1 Registration of new Via transports">
<link href="#rfc.section.11.2" rel="Chapter" title="11.2 Registration of new SIP URI transport">
<link href="#rfc.section.11.3" rel="Chapter" title="11.3 Registration of the WebSocket SIP subprotocol">
<link href="#rfc.references" rel="Chapter" title="12 References">
<link href="#rfc.references.1" rel="Chapter" title="12.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="12.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="This document specifies a WebSocket subprotocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients (typically web-based applications) and servers. The main goal of this specification is to integrate the SIP protocol within web applications." />
  <meta name="description" content="This document specifies a WebSocket subprotocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients (typically web-based applications) and servers. The main goal of this specification is to integrate the SIP protocol within web applications." />
  <meta name="keywords" content="SIP, WebSocket" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">I.B.C. Baz Castillo</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">J.L.M. Luis Millan</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">XtraTelecom S.A.</td>
</tr>
<tr>
<td class="left">Expires: March 16, 2012</td>
<td class="right">V.P. Pascual</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Acme Packet</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">September 13, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">WebSocket Transport for Session Initiation Protocol (SIP)<br />
  <span class="filename">draft-ibc-rtcweb-sip-websocket-00</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies a WebSocket subprotocol for a new transport in SIP (Session Initiation Protocol). The WebSocket protocol enables two-way realtime communication between clients (typically web-based applications) and servers. The main goal of this specification is to integrate the SIP protocol within web applications.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on March 16, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Conventions</a>
</li>
<li>3.   <a href="#rfc.section.3">Scope</a>
</li>
<li>4.   <a href="#rfc.section.4">SIP WebSocket Transport</a>
</li>
<li>4.1.   <a href="#rfc.section.4.1">Via Transport Parameter</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">SIP URI Transport Parameter</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Sending Responses</a>
</li>
<li>5.   <a href="#rfc.section.5">The WebSocket SIP Subprotocol</a>
</li>
<li>6.   <a href="#rfc.section.6">WebSocket Client Usage</a>
</li>
<li>6.1.   <a href="#rfc.section.6.1">WebSocket Disconnection</a>
</li>
<li>7.   <a href="#rfc.section.7">WebSocket Server Usage</a>
</li>
<li>7.1.   <a href="#rfc.section.7.1">SIP Proxy Considerations</a>
</li>
<li>8.   <a href="#rfc.section.8">WebSocket Connection Keep Alive</a>
</li>
<li>9.   <a href="#rfc.section.9">Examples</a>
</li>
<li>9.1.   <a href="#rfc.section.9.1">Registration</a>
</li>
<li>9.2.   <a href="#rfc.section.9.2">INVITE dialog through a proxy</a>
</li>
<li>9.3.   <a href="#rfc.section.9.3">INVITE dialog through two proxies</a>
</li>
<li>10.   <a href="#rfc.section.10">Security Considerations</a>
</li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a>
</li>
<li>11.1.   <a href="#rfc.section.11.1">Registration of new Via transports</a>
</li>
<li>11.2.   <a href="#rfc.section.11.2">Registration of new SIP URI transport</a>
</li>
<li>11.3.   <a href="#rfc.section.11.3">Registration of the WebSocket SIP subprotocol</a>
</li>
<li>12.   <a href="#rfc.references">References</a>
</li>
<li>12.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>12.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Integrating the SIP protocol <a href="#RFC3261">[RFC3261]</a> within modern web-based applications has been a hard task historically due to the specification complexity and inherent limitations in web browsers and HTTP protocol <a href="#RFC2616">[RFC2616]</a>. The arrival of WebSocket <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> and <a href="#RTC-Web">[RTC-Web]</a> (Real Time Collaboration on the World Wide Web) provides a two-way communication technology for web-based applications along with multimedia capabilities for audio and video sessions in web browsers, making feasible the requeriments of the SIP protocol.</p>
<p id="rfc.section.1.p.2">This specification defines a new WebSocket subprotocol for transporting SIP messages between a WebSocket client and server, a new transport for the SIP protocol and procedures for SIP proxies when behaving as a bridge between WebSocket and other SIP transports. No changes have been made to the SIP protocol <a href="#RFC3261">[RFC3261]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#conventions" id="conventions">Conventions</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#scope" id="scope">Scope</a>
</h1>
<p id="rfc.section.3.p.1">The WebSocket protocol is mostly suitable for web-based applications running in a web browser. Other applications running out of web browsers do not have the constraints of web applications since typically they can directly access to the transport layer.</p>
<p id="rfc.section.3.p.2">In the same manner, the WebSocket protocol adds a network overhead since it works as an intermediary layer between the transport and application layers. There is no benefit on using SIP over WebSocket transport between two SIP nodes when none of them runs within a web browser. Even more, the WebSocket protocol is not symmetric since just a WebSocket client can open a connection to a WebSocket server (a WebSocket client does not listen for incoming connections).</p>
<p id="rfc.section.3.p.3">Given these arguments, this specification is mostly focused on integrating the SIP protocol within web-based applications or any client application using the WebSocket protocol. Other aspects such as DNS NAPTR/SRV resolution for SIP over WebSocket transport are not covered by this specification since they are mainly useless given the WebSocket protocol nature.</p>
<p id="rfc.section.3.p.4">This document just covers SIP as a signalling protocol, leaving multimedia capabilities integration for a separate document once <a href="#RTC-Web">[RTC-Web]</a> (Real Time Collaboration on the World Wide Web) becomes a standard.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sip_websocket_transport" id="sip_websocket_transport">SIP WebSocket Transport</a>
</h1>
<p id="rfc.section.4.p.1">WebSocket <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> is a reliable protocol and therefore the WebSocket subprotocol for a SIP transport defined by this document is also a reliable transport. Thus, client and server transactions using WebSocket transport MUST follow the procedures and timer values for a reliable transport as defined in <a href="#RFC3261">[RFC3261]</a>.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#via_transport_parameter" id="via_transport_parameter">Via Transport Parameter</a>
</h1>
<p id="rfc.section.4.1.p.1">Via header fields carry the transport protocol identifier. This document defines the value "WS" to be used for requests over plain WebSocket protocol and "WSS" for requests over secure WebSocket protocol (in which the WebSocket session is established on top of TLS <a href="#RFC5246">[RFC5246]</a> over TCP transport).</p>
<div id="#rfc.figure.1"></div>
<pre>
  transport         =  "UDP" / "TCP" / "TLS" / "WS" / "WSS"
                       / other-transport
</pre>
<p id="rfc.section.4.1.p.2">The updated augmented BNF (Backus-Naur Form) <a href="#RFC5234">[RFC5234]</a> for this parameter is the following (the original BNF for this parameter can be found in <a href="#RFC3261">[RFC3261]</a>):</p>
<div id="#rfc.figure.2"></div>
<pre>
  Via: SIP/2.0/WS 1.2.3.4:28456
  Via: SIP/2.0/WSS [2001:0:63ba:74c:1806:7ea2:9aab:f892]:32802
</pre>
<p id="rfc.section.4.1.p.3">The following are examples of Via header fields using "WS" and "WSS":</p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#sip_uri_transport_parameter" id="sip_uri_transport_parameter">SIP URI Transport Parameter</a>
</h1>
<p id="rfc.section.4.2.p.1">This document defines the value "ws" as the transport parameter value for a SIP URI <a href="#RFC3986">[RFC3986]</a> to be contacted using WebSocket protocol. Whether to select a plain or secure WebSocket connection depends on the SIP URI schema ("sip" schema means plain WebSocket connection while "sips" schema requires secure WebSocket connection).</p>
<div id="#rfc.figure.3"></div>
<pre>
  transport-param   =  "transport="
                       ( "udp" / "tcp" / "sctp" / "tls" / "ws"
                       / other-transport )
</pre>
<p id="rfc.section.4.2.p.2">The updated augmented BNF (Backus-Naur Form) <a href="#RFC5234">[RFC5234]</a> for this parameter is the following (the original BNF for this parameter can be found in <a href="#RFC3261">[RFC3261]</a>):</p>
<div id="#rfc.figure.4"></div>
<pre>
  sip:alice@1.2.3.4:28456;transport=ws
  sips:bob@[2001:0:63ba:74c:1806:7ea2:9aab:f892]:32802;transport=ws
</pre>
<p id="rfc.section.4.2.p.3">The following are examples of SIP URI's containing a "ws" transport parameter:</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> <a href="#sending_responses" id="sending_responses">Sending Responses</a>
</h1>
<p id="rfc.section.4.3.p.1">The SIP server transport uses the value of the top Via header field in order to determine where to send a response. If the "sent-protocol" is "WS" or "WSS" the response MUST be sent using the existing WebSocket connection to the source of the original request, if that connection is still open. This requires the server transport to maintain an association between server transactions and transport connections. If that connection is no longer open, the server MUST NOT attempt to open a WebSocket connection to the Via "sent-by"/"received"/"rport".  </p>

<ul class="empty"><li>This is due the nature of the WebSocket protocol in which just the WebSocket client can establish a connection with the WebSocket server. A WebSocket client does not listen for incoming connections.</li></ul>

<p> </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#the_websocket_sip_subprotocol" id="the_websocket_sip_subprotocol">The WebSocket SIP Subprotocol</a>
</h1>
<p id="rfc.section.5.p.1">The term WebSocket subprotocol refers to the application-level protocol layered over a WebSocket connection. This document specifies the WebSocket SIP subprotocol for carrying SIP requests and responses through a WebSocket connection.</p>
<p id="rfc.section.5.p.2">WebSocket <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> defines message units as application data exchange for communication endpoints, becoming a message boundary protocol. These messages can contain UTF-8 text or binary data. The WebSocket SIP subprotocol specified in this document mandates messages of type UTF-8 text.</p>
<p id="rfc.section.5.p.3">The WebSocket client and WebSocket server send SIP messages to each other. Each SIP message MUST be carried within a single WebSocket message and MUST be a complete SIP message, so a Content-Length header field is not mandatory. Sending more than one SIP message within a single WebSocket message is not allowed, neither sending an incomplete SIP message.  </p>

<ul class="empty"><li>This makes parsing of SIP messages easier on client side (typically web-based applications with an strict and simple API for receiving WebSocket messages). There is no need to establish boundaries (typically using Content-Length headers) between different messages. Same advantage is present in other message-based SIP transports as UDP or <a href="#RFC4168">SCTP</a> <cite title="NONE">[RFC4168]</cite>.</li></ul>

<p> </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#websocket_client_usage" id="websocket_client_usage">WebSocket Client Usage</a>
</h1>
<p id="rfc.section.6.p.1">As stated in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a>, a WebSocket URI <a href="#RFC3986">[RFC3986]</a> is given to the WebSocket client (typically within a web-based application) who resolves the URI destination and establishes a WebSocket connection with the corresponding server (by performing the handshake and negotiation procedures described in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a>).</p>
<p id="rfc.section.6.p.2">The client application is supposed to be provided with SIP account configuration values (as an AoR, outbound proxy and so on). Such values are used by the client application when generating SIP messages.</p>
<p id="rfc.section.6.p.3">After establishing the WebSocket connection, the client SHOULD discover the source IP and port from which the server has received the TCP connection. Such IP and port are required for constructing the client's SIP local URI (to be used in Contact header during SIP registration and SIP dialogs).  </p>

<ul class="empty"><li>The mechanism used by the client application in order to discover its source IP and port is currently out of the scope of this specification, although it might be defined in future revisions of this document.</li></ul>

<p> </p>
<p id="rfc.section.6.p.4">The client's SIP local URI MUST be constructed as follows: </p>

<ul>
<li>If the WebSocket connection is secure (given WebSocket URI has "wss" schema) the URI MUST have "sips" schema, "sip" otherwise.</li>
<li>The URI username is up to the application.</li>
<li>The URI hostport is determined by the local IP and port previously retrieved.</li>
<li>A "transport" parameter with value "ws" MUST be added to the URI.</li>
</ul>

<p> </p>
<p id="rfc.section.6.p.5">This SIP local URI MUST be used by the client as a registration binding (Contact URI in a REGISTER) and as a local target for SIP dialogs (Contact URI in a request or response) since this URI is the only adddress in which the client can be contacted, and just through the WebSocket server.</p>
<p id="rfc.section.6.p.6">Any new request sent by the client MUST contain the discovered local IP and port in the Via "sent-by" field. Via "sent-transport" field MUST be set to "WSS" if the WebSocket connection is secure, to "WS" otherwise.</p>
<p id="rfc.section.6.p.7">Due to the nature of the WebSocket protocol, the client sends all the SIP requests to the WebSocket server it is connected to, so the WebSocket server behaves as a de facto outbound SIP proxy.</p>
<p id="rfc.section.6.p.8">In case the client application decides to close the WebSocket connection (for example when performing "logout" in a web application) it is recommended to remove the existing SIP registration binding (if present) by specifying an expiration interval of "0" for that contact address in a REGISTER request as described in section 10.2.2 of <a href="#RFC3261">[RFC3261]</a>.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#websocket_disconnection" id="websocket_disconnection">WebSocket Disconnection</a>
</h1>
<p id="rfc.section.6.1.p.1">In some circumstances the WebSocket connection could be terminated by the WebSocket server (for example when the server is restarted). If the client application wants to become reachable again it SHOULD reconnect to the WebSocket server and perform the SIP local URI discovery process again followed by a new SIP registration.</p>
<p id="rfc.section.6.1.p.2">The client MAY also remove the previous registration binding in the registrar server, as such address is no longer reachable.  </p>

<ul class="empty"><li>When the WebSocket server is also the SIP registrar server, it MAY remove the SIP registration bindings associated to a WebSocket connection after such connection has been closed. Such a decision is out of the scope of this specification and depends on the SIP network topology.</li></ul>

<p> </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#websocket_server_usage" id="websocket_server_usage">WebSocket Server Usage</a>
</h1>
<p id="rfc.section.7.p.1">Here we assume that a SIP proxy or UAS (User Agent Server) is also acting as a WebSocket server implementing the WebSocket subprotocol described in this document. The server receives WebSocket connection attempts from clients. How the server authorizes or not those connections is out of the scope of this specification. Once the WebSocket subprotocol defined in this document has been negotiated, both client and server can send SIP messages to each other.</p>
<p id="rfc.section.7.p.2">The server can only contact a SIP URI with the parameter "transport=ws" in case the destination address belongs to an existing WebSocket connection established from a WebSocket client. If not, a local transport error MUST be generated (which involves a 500 or 503 SIP response code).  </p>

<ul class="empty"><li>Such a case could happen when an existing SIP registration binding points to an already closed WebSocket connection which was not removed.</li></ul>

<p> </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#sip_proxy_considerations" id="sip_proxy_considerations">SIP Proxy Considerations</a>
</h1>
<p id="rfc.section.7.1.p.1">A SIP proxy implementing WebSocket transport can intercommunicate clients using SIP over WebSocket with other SIP clients or nodes using any other transport.</p>
<p id="rfc.section.7.1.p.2">When the proxy bridges between WebSocket transport and any other SIP transport (including WebSocket transport) it MUST perform Loose Routing as specified in <a href="#RFC3261">[RFC3261]</a>. Otherwise in-dialog requests would fail since WebSocket clients cannot contact destinations other than their WebSocket server, and non-WebSocket SIP nodes cannot establish a connection to WebSocket clients. It is also recommended that the proxy follows recommendations in <a href="#RFC5658">[RFC5658]</a> and uses double Record-Route technique in these cases.</p>
<p id="rfc.section.7.1.p.3">In the same way, if the SIP proxy implementing the WebSocket server behaves as an outbound proxy for REGISTER requests, it MUST add a Path header as described in <a href="#RFC3327">[RFC3327]</a>. Otherwise the WebSocket client would never receive incoming requests from the SIP registrar server after the lookup procedures in the SIP location service.</p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#websocket_connection_keep_alive" id="websocket_connection_keep_alive">WebSocket Connection Keep Alive</a>
</h1>
<p id="rfc.section.8.p.1">It is recommended that the WebSocket client or server keeps the WebSocket connection open by sending periodic Ping frames as described in <a href="#I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</a> section 5.5.2. The mechanisms of decision for a WebSocket endpoint to maintain, or not, the connection over time is out of scope of this document.</p>
<p id="rfc.section.8.p.2">In some cases due to transient network errors, the connection with the WebSocket server could be lost without the WebSocket client being aware of it. The WebSocket client would only realize of the network failure when attempting to send new data over the WebSocket connection.  </p>

<ul class="empty"><li>The authors of this specification have requested the W3C (World Wide Web Consortium) to include a mechanism in the <a href="#WS-API">WebSocket API</a> <cite title="NONE">[WS-API]</cite> for instructing the WebSocket client to supervise the connection by sending periodical Ping frames at the interval requested by the API user.</li></ul>

<p> </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#examples" id="examples">Examples</a>
</h1>
<p id="rfc.section.9.p.1">The flows depicted in this section describe the behavior of an initial prototype which is currently under development.</p>
<h1 id="rfc.section.9.1">
<a href="#rfc.section.9.1">9.1.</a> <a href="#registration" id="registration">Registration</a>
</h1>
<div id="#rfc.figure.5"></div>
<pre>
Alice    (SIP WS)     WebSocket SIP Server
|                             |
|OPTIONS F1                   |
|----------------------------&gt;|
|200 OK F2                    |
|&lt;----------------------------|
|                             |
|REGISTER F3                  |
|----------------------------&gt;|
|200 OK F4                    |
|&lt;----------------------------|
|                             |
</pre>
<p></p>
<p id="rfc.section.9.1.p.2">Alice is a WebSocket client running on a web browser. Alice establishes a plain WebSocket connection with a WebSocket server (also a SIP proxy/registrar) implementing the SIP subprotocol. Upon connection, Alice sends a SIP OPTIONS request including an empty "rport" parameter <a href="#RFC3581">[RFC3581]</a> in the Via header and obtains its source IP and port from the Via "received" and "rport" parameters in the response. Alice then forms its SIP local URI and constructs a REGISTER request.</p>
<p id="rfc.section.9.1.p.3">Message details (authentication and SDP bodies are omitted for simplicity):</p>
<div id="#rfc.figure.6"></div>
<pre>
F1 OPTIONS Alice -&gt; WebSocket SIP Server

OPTIONS sip:ws-server.atlanta.com SIP/2.0
Via: SIP/2.0/WS 1.2.3.4;branch=z9hG4bKasudf;rport
From: sip:alice@atlanta.com;tag=ux8asodj
To: sip:ws-server.atlanta.com
Call-ID: 87djahs72kjsd
CSeq: 1 OPTIONS
Max-Forwards: 1
Accept: application/sdp


F2 200 OK WebSocket SIP Server -&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/WS 1.2.3.4;branch=z9hG4bKasudf;received=93.12.40.105;
  rport=19465
From: sip:alice@atlanta.com;tag=ux8asodj
To: sip:ws-server.atlanta.com;tag=jcx67hjm
Call-ID: 87djahs72kjsd
CSeq: 1 OPTIONS
Content-Type: application/sdp

 
F3 REGISTER Alice -&gt; WebSocket SIP Server

REGISTER sip:proxy.atlanta.com SIP/2.0
Via: SIP/2.0/WS 93.12.40.105:19465;branch=z9hG4bKasudf
From: sip:alice@atlanta.com;tag=65bnmj.34asd
To: sip:ws-server.atlanta.com
Call-ID: aiuy7k9njasd
CSeq: 1 REGISTER
Max-Forwards: 70
Contact: &lt;sip:alice@93.12.40.105:19465;transport=ws&gt;


F4 200 OK WebSocket SIP Server -&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/WS 93.12.40.105:19465;branch=z9hG4bKasudf
From: sip:alice@atlanta.com;tag=65bnmj.34asd
To: sip:ws-server.atlanta.com;tag=12isjljn8
Call-ID: aiuy7k9njasd
CSeq: 1 REGISTER
Contact: &lt;sip:alice@93.12.40.105:19465;transport=ws&gt;
</pre>
<p></p>
<h1 id="rfc.section.9.2">
<a href="#rfc.section.9.2">9.2.</a> <a href="#invite_dialog_through_a_proxy" id="invite_dialog_through_a_proxy">INVITE dialog through a proxy</a>
</h1>
<div id="#rfc.figure.7"></div>
<pre>
Alice      (SIP WSS)      SIP Proxy       (SIP UDP)       Carol
|                             |                             |
|INVITE F1                    |                             |
|----------------------------&gt;|                             |
|100 Trying F2                |                             |
|&lt;----------------------------|                             |
|                             |INVITE F3                    |
|                             |----------------------------&gt;|
|                             |200 OK F4                    |
|                             |&lt;----------------------------|
|200 OK F5                    |                             |
|&lt;----------------------------|                             |
|                             |                             |
|ACK F6                       |                             |
|----------------------------&gt;|                             |
|                             |ACK F7                       |
|                             |----------------------------&gt;|
|                             |                             |
|                    Both Way RTP Media                     |
|&lt;=========================================================&gt;|
|                             |                             |
|                             |BYE F8                       |
|                             |&lt;----------------------------|
|BYE F9                       |                             |
|&lt;----------------------------|                             |
|200 OK F10                   |                             |
|----------------------------&gt;|                             |
|                             |200 OK F11                   |
|                             |----------------------------&gt;|
|                             |                             |
</pre>
<p></p>
<p id="rfc.section.9.2.p.2">Here the WebSocket server is also a SIP proxy and registrar for the domain atlanta.com. Alice, a WebSocket SIP client, calls Carol's AoR through a secure WebSocket connection. The WebSocket SIP server acts as a SIP proxy routing the INVITE to the UDP location of Carol. The proxy does Loose-Routing. Carol answers the call and terminates it later.</p>
<p id="rfc.section.9.2.p.3">Message details (authentication and SDP bodies are omitted for simplicity):</p>
<div id="#rfc.figure.8"></div>
<pre>
F1 INVITE Alice -&gt; SIP Proxy (transport WSS)

INVITE sip:carol@atlanta.com SIP/2.0
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bK56sdasks
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 70
Contact: &lt;sips:alice@93.12.40.105:20565;transport=ws&gt;
Content-Type: application/sdp


F2 100 Trying SIP Proxy -&gt; Alice (transport WSS)

SIP/2.0 100 Trying
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bK56sdasks
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE


F3 INVITE SIP Proxy -&gt; Carol (transport UDP)

INVITE sip:carol@77.123.45.23:5060 SIP/2.0
Via: SIP/2.0/UDP 100.100.100.100;branch=z9hG4bKhjhjqw32c
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:100.100.100.100;transport=udp&gt;,
  &lt;sips:100.100.100.100:9090;transport=ws&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sips:alice@93.12.40.105:20565;transport=ws&gt;
Content-Type: application/sdp


F4 200 OK Carol -&gt; SIP Proxy (transport UDP)

SIP/2.0 200 OK
Via: SIP/2.0/UDP 100.100.100.100;branch=z9hG4bKhjhjqw32c
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:100.100.100.100;transport=udp&gt;,
  &lt;sips:100.100.100.100:9090;transport=ws&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sip:carol@77.123.45.23:5060;transport=udp&gt;
Content-Type: application/sdp


F5 200 OK SIP Proxy -&gt; Alice (transport WSS)

SIP/2.0 200 OK
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bK56sdasks
Record-Route: &lt;sip:100.100.100.100;transport=udp&gt;,
  &lt;sips:100.100.100.100:9090;transport=ws&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sip:carol@77.123.45.23:5060;transport=udp&gt;
Content-Type: application/sdp
           

F6 ACK Alice -&gt; SIP Proxy (transport WSS)

ACK sip:carol@77.123.45.23:5060;transport=udp SIP/2.0
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bKhgqqp090
Route: &lt;sips:100.100.100.100:9090;transport=ws&gt;,
  &lt;sip:100.100.100.100;transport=udp&gt;
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 ACK
Max-Forwards: 70


F7 ACK SIP Proxy -&gt; Carol (transport UDP)

ACK sip:carol@77.123.45.23:5060;transport=udp SIP/2.0
Via: SIP/2.0/UDP 100.100.100.100;branch=z9hG4bKhwpoc80zzx
Via: SIP/2.0/WSS 93.12.40.105:20565;branch=z9hG4bKhgqqp090
From: sip:alice@atlanta.com;tag=asdyka899
To: sip:carol@atlanta.com;tag=bmqkjhsd
Call-ID: asidkj3ss
CSeq: 1 ACK
Max-Forwards: 69


F8 BYE Carol -&gt; SIP Proxy (transport UDP)

BYE sips:alice@93.12.40.105:20565;transport=ws SIP/2.0
Via: SIP/2.0/UDP 77.123.45.23;branch=z9hG4bKbiuiansd001
Route: &lt;sip:100.100.100.100;transport=udp&gt;,
  &lt;sips:100.100.100.100:9090;transport=ws&gt;
From: sip:carol@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
Max-Forwards: 70


F9 BYE SIP Proxy -&gt; Alice (transport WSS)

BYE sips:alice@93.12.40.105:20565;transport=ws SIP/2.0
Via: SIP/2.0/WSS 100.100.100.100:9090;branch=z9hG4bKmma01m3r5
Via: SIP/2.0/UDP 77.123.45.23;branch=z9hG4bKbiuiansd001
From: sip:carol@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
Max-Forwards: 69


F10 200 OK Alice -&gt; SIP Proxy (transport WSS)

SIP/2.0 200 OK
Via: SIP/2.0/WSS 100.100.100.100:9090;branch=z9hG4bKmma01m3r5
Via: SIP/2.0/UDP 77.123.45.23;branch=z9hG4bKbiuiansd001
From: sip:carol@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE


F11 200 OK SIP Proxy -&gt; Carol (transport UDP)

SIP/2.0 200 OK
Via: SIP/2.0/UDP 77.123.45.23;branch=z9hG4bKbiuiansd001
From: sip:carol@atlanta.com;tag=bmqkjhsd
To: sip:alice@atlanta.com;tag=asdyka899
Call-ID: asidkj3ss
CSeq: 1201 BYE
</pre>
<p></p>
<h1 id="rfc.section.9.3">
<a href="#rfc.section.9.3">9.3.</a> <a href="#invite_dialog_through_two_proxies" id="invite_dialog_through_two_proxies">INVITE dialog through two proxies</a>
</h1>
<div id="#rfc.figure.9"></div>
<pre>
Alice   (SIP WS)   Proxy 1   (SIP UDP)   Proxy 2    (SIP WSS)    Bob
|                     |                     |                     |
|INVITE F1            |                     |                     |
|--------------------&gt;|                     |                     |
|100 Trying F2        |                     |                     |
|&lt;--------------------|                     |                     |
|                     |INVITE F3            |                     |
|                     |--------------------&gt;|                     |
|                     |100 Trying F4        |                     |
|                     |&lt;--------------------|                     |
|                     |                     |INVITE F5            |
|                     |                     |--------------------&gt;|
|                     |                     |486 Busy Here F6     |
|                     |                     |&lt;--------------------|
|                     |                     |ACK F7               |
|                     |                     |--------------------&gt;|
|                     |486 Busy Here F8     |                     |
|                     |&lt;--------------------|                     |
|                     |ACK F9               |                     |
|                     |--------------------&gt;|                     |
|486 Busy Here F10    |                     |                     |
|&lt;--------------------|                     |                     |
|ACK F11              |                     |                     |
|--------------------&gt;|                     |                     |
|                     |                     |                     |

</pre>
<p></p>
<p id="rfc.section.9.3.p.2">Alice and Bob are WebSocket clients running on web browsers. Alice belongs to atlanta.com SIP domain while Bob does to biloxi.com. Each domain has its own SIP proxy. Both proxies are also WebSocket servers. Alice calls Bob's AoR through a WebSocket connection. Bob responds the INVITE with a 486 Busy Here. Communication through proxies is made via UDP transport protocol.</p>
<p id="rfc.section.9.3.p.3">Message details (authentication and SDP bodies are omitted for simplicity):</p>
<div id="#rfc.figure.10"></div>
<pre>
F1 INVITE Alice -&gt; Proxy 1 (transport WS)

INVITE sip:bob@biloxi.com SIP/2.0
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;
Call-ID: aslke3dkj
CSeq: 1 INVITE
Max-Forwards: 70
Contact: &lt;sip:alice@93.12.40.105:21324;transport=ws&gt;
Content-Type: application/sdp


F2 100 Trying Proxy 1 -&gt; Alice (transport WS)

SIP/2.0 100 Trying
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;
Call-ID: aslke3dkj
CSeq: 1 INVITE


F3 INVITE Proxy 1 -&gt; Proxy 2 (transport UDP)

INVITE sip:bob@biloxi.com SIP/2.0
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
Record-Route: &lt;sip:101.101.101.101;transport=udp&gt;
Record-Route: &lt;sip:101.101.101.101:80;transport=ws&gt;
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;
Call-ID: aslke3dkj
CSeq: 1 INVITE
Max-Forwards: 69
Contact: &lt;sip:alice@93.12.40.105:21324;transport=ws&gt;
Content-Type: application/sdp


F4 100 Trying Proxy 2 -&gt; Proxy 1 (transport UDP)

SIP/2.0 100 Trying
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;
Call-ID: aslke3dkj
CSeq: 1 INVITE


F5 INVITE Proxy 2 -&gt; Bob (transport WSS)

INVITE sips:bob@85.84.123.222:30142;transport=ws SIP/2.0
Via: SIP/2.0/WSS 102.102.102.102:443;branch=z9hG4bKqowin
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
Record-Route: &lt;sips:102.102.102.102:443;transport=ws&gt;
Record-Route: &lt;sip:102.102.102.102;transport=udp&gt;
Record-Route: &lt;sip:101.101.101.101;transport=udp&gt;
Record-Route: &lt;sip:101.101.101.101:9090;transport=ws&gt;
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;
Call-ID: aslke3dkj
CSeq: 1 INVITE
Max-Forwards: 68
Contact: &lt;sip:alice@93.12.40.105:21324;transport=ws&gt;
Content-Type: application/sdp


F6 486 Busy Here Bob -&gt; Proxy 2 (transport WSS)

SIP/2.0 486 Busy Here
Via: SIP/2.0/WSS 102.102.102.102:443;branch=z9hG4bKqowin
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 INVITE


F7 ACK Proxy 2 -&gt; Bob (transport WSS)

ACK sips:bob@85.84.123.222:30142;transport=ws SIP/2.0
Via: SIP/2.0/WSS 102.102.102.102:443;branch=z9hG4bKqowin
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 ACK


F8 486 Busy Here Proxy 2 -&gt; Proxy 1 (transport UDP)

SIP/2.0 486 Busy Here
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 INVITE


F9 ACK Proxy 1 -&gt; Proxy 2 (transport UDP)

ACK sip:bob@biloxi.com SIP/2.0
Via: SIP/2.0/UDP 101.101.101.101;branch=z9hG4bKdkej
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 ACK


F10 486 Busy Here Proxy 1 -&gt; Alice (transport WS)

SIP/2.0 486 Busy Here
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 INVITE


F11 ACK Alice -&gt; Proxy 1 (transport WS) 

ACK sip:bob@biloxi.com SIP/2.0
Via: SIP/2.0/WS 93.12.40.105:21324;branch=z9hG4bKmmuuq
From: Alice &lt;sip:alice@atlanta.com&gt;;tag=lxtyr
To: Bob &lt;sip:bob@biloxi.com&gt;;tag=dskfjd
Call-ID: aslke3dkj
CSeq: 1 ACK
</pre>
<p></p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#security_considerations" id="security_considerations">Security Considerations</a>
</h1>
<p id="rfc.section.10.p.1">If the client (typically a web-based application) needs to protect the privacy of the SIP traffic through the WebSocket connection, it is encouraged to use a secure WebSocket connection.</p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#iana_considerations" id="iana_considerations">IANA Considerations</a>
</h1>
<h1 id="rfc.section.11.1">
<a href="#rfc.section.11.1">11.1.</a> Registration of new Via transports</h1>
<p id="rfc.section.11.1.p.1">This specification registers two new transport identifiers for Via headers: </p>

<dl>
<dt>WS:</dt>
<dd style="margin-left: 6">MUST be used when constructing a SIP request to be sent over a plain WebSocket connection.</dd>
<dt>WSS:</dt>
<dd style="margin-left: 6">MUST be used when constructing a SIP request to be sent over a secure WebSocket connection (tunneled over TLS <a href="#RFC5246">[RFC5246]</a>).</dd>
</dl>

<p> </p>
<h1 id="rfc.section.11.2">
<a href="#rfc.section.11.2">11.2.</a> Registration of new SIP URI transport</h1>
<p id="rfc.section.11.2.p.1">This specification registers a new value for the "transport" parameter in a SIP URI: </p>

<dl>
<dt>ws:</dt>
<dd style="margin-left: 6">Identifies a SIP URI to be contacted using a WebSocket (plain or secure) connection.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.11.3">
<a href="#rfc.section.11.3">11.3.</a> Registration of the WebSocket SIP subprotocol</h1>
<p id="rfc.section.11.3.p.1">If a registry is created for WebSocket subprotocols, the SIP subprotocol defined in this specification will be registered.</p>
<h1 id="rfc.references">
<a href="#rfc.references">12.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">12.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5234">[RFC5234]</b></td>
<td class="top">
<a>Crocker, D.</a> and <a>P. Overell</a>, "<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>", STD 68, RFC 5234, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3261">[RFC3261]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a>, <a>Camarillo, G.</a>, <a>Johnston, A.</a>, <a>Peterson, J.</a>, <a>Sparks, R.</a>, <a>Handley, M.</a> and <a>E. Schooler</a>, "<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>", RFC 3261, June 2002.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-hybi-thewebsocketprotocol">[I-D.ietf-hybi-thewebsocketprotocol]</b></td>
<td class="top">
<a>Fette, I</a> and <a>A Melnikov</a>, "<a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-14">The WebSocket protocol</a>", Internet-Draft draft-ietf-hybi-thewebsocketprotocol-14, September 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">12.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2616">[RFC2616]</b></td>
<td class="top">
<a href="mailto:fielding@ics.uci.edu" title="Department of Information and Computer Science">Fielding, R.</a>, <a href="mailto:jg@w3.org" title="World Wide Web Consortium">Gettys, J.</a>, <a href="mailto:mogul@wrl.dec.com" title="Compaq Computer Corporation">Mogul, J.</a>, <a href="mailto:frystyk@w3.org" title="World Wide Web Consortium">Frystyk, H.</a>, <a href="mailto:masinter@parc.xerox.com" title="Xerox Corporation">Masinter, L.</a>, <a href="mailto:paulle@microsoft.com" title="Microsoft Corporation">Leach, P.</a> and <a href="mailto:timbl@w3.org" title="World Wide Web Consortium">T. Berners-Lee</a>, "<a href="http://tools.ietf.org/html/rfc2616">Hypertext Transfer Protocol -- HTTP/1.1</a>", RFC 2616, June 1999.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a href="mailto:timbl@w3.org" title="World Wide Web Consortium">Berners-Lee, T.</a>, <a href="mailto:fielding@gbiv.com" title="Day Software">Fielding, R.</a> and <a href="mailto:LMM@acm.org" title="Adobe Systems Incorporated">L. Masinter</a>, "<a href="http://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4168">[RFC4168]</b></td>
<td class="top">
<a>Rosenberg, J.</a>, <a>Schulzrinne, H.</a> and <a>G. Camarillo</a>, "<a href="http://tools.ietf.org/html/rfc4168">The Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP)</a>", RFC 4168, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5246">[RFC5246]</b></td>
<td class="top">
<a>Dierks, T.</a> and <a>E. Rescorla</a>, "<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>", RFC 5246, August 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3327">[RFC3327]</b></td>
<td class="top">
<a>Willis, D.</a> and <a>B. Hoeneisen</a>, "<a href="http://tools.ietf.org/html/rfc3327">Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts</a>", RFC 3327, December 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3581">[RFC3581]</b></td>
<td class="top">
<a>Rosenberg, J.</a> and <a>H. Schulzrinne</a>, "<a href="http://tools.ietf.org/html/rfc3581">An Extension to the Session Initiation Protocol (SIP) for Symmetric Response Routing</a>", RFC 3581, August 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5658">[RFC5658]</b></td>
<td class="top">
<a>Froment, T.</a>, <a>Lebel, C.</a> and <a>B. Bonnaerens</a>, "<a href="http://tools.ietf.org/html/rfc5658">Addressing Record-Route Issues in the Session Initiation Protocol (SIP)</a>", RFC 5658, October 2009.</td>
</tr>
<tr>
<td class="reference"><b id="WS-API">[WS-API]</b></td>
<td class="top">
<a title="Google, Inc.">Hickson, I.</a>, "<a>The Web Sockets API</a>", September 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RTC-Web">[RTC-Web]</b></td>
<td class="top">
<a>IETF</a><a>W3C</a>, "<a>Real Time Collaboration on the World Wide Web</a>", October 2010.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Inaki Baz Castillo</span> 
	  <span class="n hidden">
		<span class="family-name">Baz Castillo</span>
	  </span>
	</span>
	<span class="org vcardline">XtraTelecom S.A.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Barakaldo</span>,  
		<span class="region">Basque Country</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ibc@aliax.net">ibc@aliax.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jose Luis Millan</span> 
	  <span class="n hidden">
		<span class="family-name">Luis Millan</span>
	  </span>
	</span>
	<span class="org vcardline">XtraTelecom S.A.</span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality">Bilbao</span>,  
		<span class="region">Basque Country</span> 
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jmillan@aliax.net">jmillan@aliax.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Victor Pascual</span> 
	  <span class="n hidden">
		<span class="family-name">Pascual</span>
	  </span>
	</span>
	<span class="org vcardline">Acme Packet</span>
	<span class="adr">
	  <span>Anabel Segura 10</span>

	  <span class="vcardline">
		<span class="locality">Madrid</span>,  
		<span class="region">Madrid</span> 
		<span class="code">28108</span>
	  </span>
	  <span class="country-name vcardline">Spain</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:vpascual@acmepacket.com">vpascual@acmepacket.com</a></span>

  </address>
</div>

</body>
</html>