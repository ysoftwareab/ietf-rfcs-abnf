<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Update to DNAME Redirection in the DNS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Update to DNAME Redirection in the DNS">
<meta name="keywords" content="DNS, DNAME">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">DNS Extensions Working Group</td><td class="header">S. Rose</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">NIST</td></tr>
<tr><td class="header">Obsoletes: <a href='http://tools.ietf.org/html/rfc2672'>2672</a> (if&nbsp;approved)</td><td class="header">W. Wijngaards</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc3363'>3363</a>, <a href='http://tools.ietf.org/html/rfc4294'>4294</a></td><td class="header">NLnet Labs</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">April 21, 2008</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: October 23, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Update to DNAME Redirection in the DNS<br />draft-ietf-dnsext-rfc2672bis-dname-12</h1>

<h3>Status of This Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on October 23, 2008.</p>

<h3>Abstract</h3>

<p>
	The DNAME record provides redirection for a sub-tree of the domain
	name tree in the DNS system. That is, all names that 
	end with a particular suffix are redirected to another part of 
	the DNS. 
	This is an update to the original specification in RFC 2672,
	also aligning RFC 3363 and RFC 4294 with this revision.
	
</p>
<h3>Requirements Language</h3>

<p>The key words &quot;MUST&quot;, &quot;MUST NOT&quot;,
&quot;REQUIRED&quot;, &quot;SHALL&quot;, &quot;SHALL NOT&quot;,
&quot;SHOULD&quot;, &quot;SHOULD NOT&quot;, &quot;RECOMMENDED&quot;,
&quot;MAY&quot;, and &quot;OPTIONAL&quot; in this document are to be
interpreted as described in <a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].
	
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<br />
<a href="#anchor2">2.</a>&nbsp;
The DNAME Resource Record<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">2.1.</a>&nbsp;
Format<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">2.2.</a>&nbsp;
The DNAME Substitution<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">2.3.</a>&nbsp;
DNAME Apex not Redirected itself<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">2.4.</a>&nbsp;
Names Next to and Below a DNAME Record<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">2.5.</a>&nbsp;
Compression of the DNAME record.<br />
<br />
<a href="#anchor8">3.</a>&nbsp;
Processing<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">3.1.</a>&nbsp;
Server algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">3.2.</a>&nbsp;
Wildcards<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">3.3.</a>&nbsp;
CNAME synthesis and UD bit<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">3.4.</a>&nbsp;
Acceptance and Intermediate Storage<br />
<br />
<a href="#anchor13">4.</a>&nbsp;
DNAME Discussions in Other Documents<br />
<br />
<a href="#anchor14">5.</a>&nbsp;
Other Issues with DNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">5.1.</a>&nbsp;
Canonical hostnames cannot be below DNAME owners<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#dynamic">5.2.</a>&nbsp;
Dynamic Update and DNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.3.</a>&nbsp;
DNSSEC and DNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.3.1.</a>&nbsp;
DNAME bit in NSEC type map<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#validname">5.3.2.</a>&nbsp;
Validators Must Understand DNAME<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.3.2.1.</a>&nbsp;
DNAME in Bitmap Causes Invalid Name Error<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.3.2.2.</a>&nbsp;
Valid Name Error Response Involving DNAME in Bitmap<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">5.3.2.3.</a>&nbsp;
Response With Synthesized CNAME<br />
<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<br />
<a href="#Security">7.</a>&nbsp;
Security Considerations<br />
<br />
<a href="#Acknowledgments">8.</a>&nbsp;
Acknowledgments<br />
<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p> 
	DNAME is a DNS Resource Record type defined in 
	RFC 2672 <a class='info' href='#RFC2672'>[RFC2672]<span> (</span><span class='info'>Crawford, M., &ldquo;Non-Terminal DNS Name Redirection,&rdquo; August&nbsp;1999.</span><span>)</span></a>. DNAME provides redirection from
	a part of the DNS name tree to another part of the DNS name tree. 
	
</p>
<p>
	The DNAME RR and the CNAME RR <a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> cause a 
	lookup to (potentially) return data corresponding to a domain name 
	different from the queried domain name.  The difference between 
	the two resource records is that the CNAME RR directs the lookup 
	of data at its owner to another single name, a DNAME RR directs 
	lookups for data at descendents of its owner's name to
	corresponding names under a different (single) node of the tree. 
	
</p>
<p>
	Take for example, looking through a zone (see 
	<a class='info' href='#RFC1034'>RFC 1034<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> [RFC1034], section 4.3.2, step 3) for 
	the domain name "foo.example.com" and a DNAME resource record
	is found at "example.com" indicating that all queries under 
	"example.com" be directed to "example.net".  The lookup process 
	will return to step 1 with the new query name of "foo.example.net".  
	Had the query name been "www.foo.example.com" the new query name 
	would be "www.foo.example.net".
	
</p>
<p>
	This document is an update to the original specification of DNAME
	in <a class='info' href='#RFC2672'>RFC 2672<span> (</span><span class='info'>Crawford, M., &ldquo;Non-Terminal DNS Name Redirection,&rdquo; August&nbsp;1999.</span><span>)</span></a> [RFC2672].  
	DNAME was conceived to help with the problem of maintaining 
	address-to-name mappings in a context of network renumbering.  
	With a careful set-up, a renumbering event in the network 
	causes no change to the authoritative server that has the 
	address-to-name mappings. Examples in practice are classless reverse 
	address space delegations and punycode alternates for domain spaces.
	
</p>
<p>
	Another usage of DNAME lies in redirection of name spaces. For 
	example, a zone administrator may want sub-trees of the DNS to 
	contain the same information.  DNAME is also used
	for the redirection of ENUM domains to another maintaining party.  
	
</p>
<p>
	This update to DNAME does not change the wire format or the 
	handling of DNAME Resource Records by existing software.
	A new UD (Understand Dname) bit in the EDNS flags field can be 
	used to signal that CNAME synthesis is not needed.
	Discussion is added on problems that may be encountered 
	when using DNAME.
	
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
The DNAME Resource Record</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Format</h3>

<p>
	The DNAME RR has mnemonic DNAME and type code 39 (decimal).
	It is not class-sensitive.
	
</p>
<p>
	
<p>
	Its RDATA is comprised of a single field, &lt;target>, which 
	contains a fully qualified domain name that must be sent in 
	uncompressed form <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>, <a class='info' href='#RFC3597'>[RFC3597]<span> (</span><span class='info'>Gustafsson, A., &ldquo;Handling of Unknown DNS Resource Record (RR) Types,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
	The &lt;target> field MUST be present.
	The presentation format of &lt;target> is that of a domain 
	name <a class='info' href='#RFC1035'>[RFC1035]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - implementation and specification,&rdquo; November&nbsp;1987.</span><span>)</span></a>.
  	
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        &lt;owner&gt; &lt;ttl&gt; &lt;class&gt; DNAME &lt;target&gt;
</pre></div>
<p>The effect of the DNAME RR is the substitution of the record's
	&lt;target> for its owner name, as a suffix of a domain name.
	This substitution has to be applied for every DNAME RR found in the
	resolution process, which allows fairly lengthy valid chains of DNAME
	RRs.
  	
</p>
	

<p>
	Details of the substitution process, methods to avoid conflicting
	resource records, and rules for specific corner cases are given in
	the following subsections.
	
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
The DNAME Substitution</h3>

<p>
	When following RFC 1034 <a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a>, section 4.3.2's 
	algorithm's third step, "start matching down, label by label, in 
	the zone" and a node is found to own a DNAME resource record 
	a DNAME substitution occurs.  The name being sought may be the 
	original query name or a name that is the result of a CNAME 
	resource record being followed or a previously encountered DNAME.  
	As is the case of finding a CNAME resource record or NS resource 
	record set, the processing of a DNAME will happen prior to 
	finding the desired domain name.
	
</p>
<p>
	A DNAME substitution is performed by replacing the suffix labels 
	of the name being sought matching the owner name of the DNAME 
	resource record with the string of labels in the RDATA field.  
	The matching labels end with the root label in all cases. 
	Only whole labels are replaced. See the table of examples for 
	common cases and corner cases.
	
</p>
<p>
	<br /><hr class="insert" />

<p>
	In the table below, the QNAME refers to the query name. The 
	owner is the DNAME owner domain name, and the target refers to 
	the target of the DNAME record. The result is the resulting name
	after performing the DNAME substitution on the query name.
	"no match" means that the query did not match the DNAME and thus
	no substitution is performed and a possible error message is returned
	(if no other result is possible).
	In the examples below, 'cyc' and 'shortloop' contain loops.
  	
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 QNAME            owner  DNAME   target         result
 ---------------- -------------- -------------- -----------------
 com.             example.com.   example.net.   &lt;no match&gt;
 example.com.     example.com.   example.net.   &lt;no match&gt;
 a.example.com.   example.com.   example.net.   a.example.net.
 a.b.example.com. example.com.   example.net.   a.b.example.net.
 ab.example.com.  b.example.com. example.net.   &lt;no match&gt;
 foo.example.com. example.com.   example.net.   foo.example.net.
 a.x.example.com. x.example.com. example.net.   a.example.net.
 a.example.com.   example.com.   y.example.net. a.y.example.net.
 cyc.example.com. example.com.   example.com.   cyc.example.com.
 cyc.example.com. example.com.   c.example.com. cyc.c.example.com.
 shortloop.x.x.   x.             .              shortloop.x.
 shortloop.x.     x.             .              shortloop.
</pre></div>
<p>
  	
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Table 1. DNAME Substitution Examples.&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	

<p>
	It is possible for DNAMEs to form loops, just as
	CNAMEs can form loops. DNAMEs and CNAMEs can chain together to
	form loops. A single corner case DNAME can form a loop. Resolvers
	and servers should be cautious in devoting resources to a query,
	but be aware that fairly long chains of DNAMEs may be valid.  
	Zone content administrators should take care to insure that there
	are no loops that could occur when using DNAME or DNAME/CNAME 
	redirection.
	
</p>
<p>
	The domain name can get too long during substitution. For example, suppose the
	target name of the DNAME RR is 250 octets in length (multiple labels), if 
	an incoming QNAME that has a first label over 5 octets in length, the result 
	of the result would be a name over 255 octets.  If this occurs the 
	server returns an RCODE of YXDOMAIN <a class='info' href='#RFC2136'>[RFC2136]<span> (</span><span class='info'>Vixie, P., Thomson, S., Rekhter, Y., and J. Bound, &ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; April&nbsp;1997.</span><span>)</span></a>. The DNAME
	record and its signature (if the zone is signed) are included in the answer as proof 
	for the YXDOMAIN (value 6) RCODE.
	
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.3"></a><h3>2.3.&nbsp;
DNAME Apex not Redirected itself</h3>

<p>
	Unlike a CNAME RR, a DNAME RR redirects DNS names subordinate to its
	owner name; the owner name of a DNAME is not redirected itself.
	The domain name that owns a DNAME record is allowed to have other
	resource record types at that domain name, except DNAMEs or CNAMEs.
	This means that DNAME RRs are not allowed at the parent side of a
	delegation point but are allowed at a zone apex.

</p>
<p>
	The reason for this decision was that one can have a DNAME at the
	zone apex.  There still is a need to have the customary SOA and NS
	resource records at the zone apex.  This means that DNAME does not
	mirror a zone completely, as it does not mirror the zone apex.

</p>
<p>
	These rules also allow DNAME records to be queried through RFC 1034
	<a class='info' href='#RFC1034'>[RFC1034]<span> (</span><span class='info'>Mockapetris, P., &ldquo;Domain names - concepts and facilities,&rdquo; November&nbsp;1987.</span><span>)</span></a> compliant, DNAME-unaware caches.

</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.4"></a><h3>2.4.&nbsp;
Names Next to and Below a DNAME Record</h3>

<p>
	Resource records MUST NOT exist at any domain name subordinate 
	to the owner of a DNAME RR.  To get the contents for names 
	subordinate to that owner, the DNAME redirection must be invoked 
	and the resulting target queried.  A server MAY refuse to load 
	a zone that has data at a domain name subordinate to a domain name 
	owning a DNAME RR.  If the server does load the zone, those names
	below the DNAME RR will be occluded, 
	RFC 2136 <a class='info' href='#RFC2136'>[RFC2136]<span> (</span><span class='info'>Vixie, P., Thomson, S., Rekhter, Y., and J. Bound, &ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; April&nbsp;1997.</span><span>)</span></a>, section 7.18.  
	Also a server SHOULD refuse to load
	a zone subordinate to the owner of a DNAME record in the ancestor zone.
	See <a class='info' href='#dynamic'>Section&nbsp;5.2<span> (</span><span class='info'>Dynamic Update and DNAME</span><span>)</span></a> for further discussion 
	related to dynamic update.
	
</p>
<p>
	DNAME is a singleton type, meaning only one DNAME is allowed per 
	name.  The owner name of a DNAME can only have one DNAME RR, and 
	no CNAME RRs can exist at that name. 
	These rules make sure that for a single domain name only one 
	redirection exists, and thus no confusion which one to follow.
	A server SHOULD refuse to load a zone that violates these rules.
	
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.5"></a><h3>2.5.&nbsp;
Compression of the DNAME record.</h3>

<p>
	The DNAME owner name can be compressed like any other owner name. 
	The DNAME RDATA target name MUST NOT be sent out in 
	compressed form, so that a DNAME RR can be treated as an unknown type
	<a class='info' href='#RFC3597'>[RFC3597]<span> (</span><span class='info'>Gustafsson, A., &ldquo;Handling of Unknown DNS Resource Record (RR) Types,&rdquo; September&nbsp;2003.</span><span>)</span></a>.
	
</p>
<p>
	Although the previous DNAME specification <a class='info' href='#RFC2672'>[RFC2672]<span> (</span><span class='info'>Crawford, M., &ldquo;Non-Terminal DNS Name Redirection,&rdquo; August&nbsp;1999.</span><span>)</span></a> 
	(that is obsoleted by this specification) talked about signaling 
	to allow compression of the target name, such signaling is 
	not specified.
	
</p>
<p> 
	RFC 2672 stated that the EDNS version had a meaning for understanding
	of DNAME and DNAME target name compression. This document updates 
	RFC 2672, in that there is no EDNS version signaling for DNAME as 
	of yet.  However, the flags section of EDNS(0) is updated with a 
	Understand-DNAME flag by this document (See Section 3.3).
	
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Processing</h3>

<p>
	The DNAME RR causes type NS additional section processing.
	
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Server algorithm</h3>

<p>
	Below the server algorithm, which appeared in RFC 2672 Section 4.1, 
	is expanded to handle the UD (Understand Dname) bit. 
	
</p>
<p>
</p>
<ol class="text">
<li> 
   Set or clear the value of recursion available in the response
      depending on whether the name server is willing to provide
      recursive service.  If recursive service is available and
      requested via the RD bit in the query, go to step 5, otherwise
      step 2.
<br />
<br />


</li>
<li> 
   Search the available zones for the zone which is the nearest
      ancestor to QNAME.  If such a zone is found, go to step 3,
      otherwise step 4.
<br />
<br />


</li>
<li> 
   Start matching down, label by label, in the zone.  The matching
      process can terminate several ways:
<br />
<br />


<blockquote class="text"><dl>
<dt>A.</dt>
<dd>
      If the whole of QNAME is matched, we have found the node.
      <br />


         If the data at the node is a CNAME, and QTYPE does not match
         CNAME, copy the CNAME RR into the answer section of the
         response, change QNAME to the canonical name in the CNAME RR,
         and go back to step 1.
      <br />
<br />


         Otherwise, copy all RRs which match QTYPE into the answer
         section and go to step 6.
<br />
<br />


</dd>
<dt>B.</dt>
<dd>
      If a match would take us out of the authoritative data, we have
         a referral.  This happens when we encounter a node with NS RRs
         marking cuts along the bottom of a zone.
      <br />


         Copy the NS RRs for the sub-zone into the authority section of
         the reply.  Put whatever addresses are available into the
         additional section, using glue RRs if the addresses are not
         available from authoritative data or the cache.  Go to step 4.
<br />
<br />


</dd>
<dt>C.</dt>
<dd>
      If at some label, a match is impossible (i.e., the
         corresponding label does not exist), look to see whether the
         last label matched has a DNAME record.
      <br />


         If a DNAME record exists at that point, copy that record into
         the answer section.  If substitution of its &lt;target> for its
         &lt;owner> in QNAME would overflow the legal size for a &lt;domain-
         name>, set RCODE to YXDOMAIN <a class='info' href='#RFC2136'>[RFC2136]<span> (</span><span class='info'>Vixie, P., Thomson, S., Rekhter, Y., and J. Bound, &ldquo;Dynamic Updates in the Domain Name System (DNS UPDATE),&rdquo; April&nbsp;1997.</span><span>)</span></a> and exit; 
	 otherwise
         perform the substitution and continue.  
	 If the EDNS OPT record is present in the query and the UD bit is set, 
	 the server MAY copy the UD bit to the answer EDNS OPT record, and 
	 omit CNAME synthesis. Else the server MUST synthesize a CNAME 
	 record as described above and include it in the answer section.
	 Go back to step 1.
      <br />
<br />


         If there was no DNAME record, look to see if the "*" label
         exists.
      <br />
<br />


         If the "*" label does not exist, check whether the name we are
         looking for is the original QNAME in the query or a name we
         have followed due to a CNAME or DNAME.  If the name is original, set an
         authoritative name error in the response and exit.  Otherwise
         just exit.
      <br />
<br />


      If the "*" label does exist, match RRs at that node against
      QTYPE.  If any match, copy them into the answer section, but
      set the owner of the RR to be QNAME, and not the node with
      the "*" label.  If the data at the node with the "*" label is a CNAME,
      and QTYPE doesn't match CNAME, copy the CNAME RR into the answer
      section of the response changing the owner name to the QNAME,
      change QNAME to the canonical name in the CNAME RR, and go back to
      step 1. Otherwise, Go to step 6.
<br />
<br />


</dd>
</dl></blockquote>

</li>
<li> 
   Start matching down in the cache.  If QNAME is found in the cache,
      copy all RRs attached to it that match QTYPE into the answer
      section.  If QNAME is not found in the cache but a DNAME record is
      present at an ancestor of QNAME, copy that DNAME record into the
      answer section.  If there was no delegation from authoritative
      data, look for the best one from the cache, and put it in the
      authority section.  Go to step 6.
<br />
<br />


</li>
<li> 
   Use the local resolver or a copy of its algorithm 
   to answer the query.  Store the results,
      including any intermediate CNAMEs and DNAMEs, in the answer
      section of the response.
<br />
<br />


</li>
<li> 
   Using local data only, attempt to add other RRs which may be
      useful to the additional section of the query.  Exit.

</li>
</ol>

<p>
   Note that there will be at most one ancestor with a DNAME as
   described in step 4 unless some zone's data is in violation of the
   no-descendants limitation in section 3.  An implementation might take
   advantage of this limitation by stopping the search of step 3c or
   step 4 when a DNAME record is encountered.

</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Wildcards</h3>

<p>
	The use of DNAME in conjunction with wildcards is discouraged
	<a class='info' href='#RFC4592'>[RFC4592]<span> (</span><span class='info'>Lewis, E., &ldquo;The Role of Wildcards in the Domain Name System,&rdquo; July&nbsp;2006.</span><span>)</span></a>.  Thus records of the form
	"*.example.com DNAME example.net" SHOULD NOT be used. 
	
</p>
<p>
	The interaction between the expansion of the wildcard and the 
	redirection of the DNAME is non-deterministic.
	Because the processing is non-deterministic, DNSSEC validating 
	resolvers may not be able to validate a wildcarded DNAME.
	
</p>
<p>
	A server MAY give a warning that the behavior is unspecified
	if such a wildcarded DNAME is loaded.  The server MAY refuse it,
	refuse to load or refuse dynamic update.
	
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
CNAME synthesis and UD bit</h3>

<p>
	When preparing an response, a server upon performing a DNAME 
	substitution will in all cases include the DNAME RR used in the 
	answer section. 
	A CNAME RR record with TTL equal to the corresponding DNAME RR 
	is synthesized and included in the answer section for old resolvers.
	The owner name of the CNAME is the QNAME of the query. DNSSEC 
	<a class='info' href='#RFC4033'>[RFC4033]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;DNS Security Introduction and Requirements,&rdquo; March&nbsp;2005.</span><span>)</span></a>, <a class='info' href='#RFC4034'>[RFC4034]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Resource Records for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a>, 
	<a class='info' href='#RFC4035'>[RFC4035]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Protocol Modifications for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a> says that the 
	synthesized CNAME does not have to be signed.  The DNAME has an RRSIG 
	and a validating resolver can check the CNAME against the DNAME 
	record and validate the DNAME record. 
	
</p>
<p>
	Resolvers MUST be able to handle a synthesized CNAME TTL of zero or
	equal to the TTL of the corresponding DNAME record. A TTL of zero
	means that the CNAME can be discarded immediately after processing
	the answer.  DNAME aware resolvers can set the Understand-DNAME
	(UD bit) to receive a response with only the DNAME RR and no 
	synthesized CNAMEs.
	
</p>
<p>
	The UD bit is part of the EDNS <a class='info' href='#RFC2671'>[RFC2671]<span> (</span><span class='info'>Vixie, P., &ldquo;Extension Mechanisms for DNS (EDNS0),&rdquo; August&nbsp;1999.</span><span>)</span></a>
	extended RCODE and Flags field. 
	It is used to omit server processing, transmission and 
	resolver processing of unsigned synthesized CNAMEs.
	Resolvers can set this in a query to request omission of the
	synthesized CNAMEs. Servers copy the UD bit to the response, and can 
	omit synthesized CNAMEs from the answer.
	Older resolvers do not set the UD bit, and older servers do not
	copy the UD bit to the answer, and will not omit synthesized CNAMEs.
	
</p>
<p>
<p>Updated EDNS extended RCODE and Flags field.
	
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
            +0 (MSB)                +1 (LSB)
   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
0: |   EXTENDED-RCODE      |       VERSION         |
   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
2: |DO|UD|                 Z                       |
   +--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+--+
</pre></div>
<p>
</p>
	

<p>
	Servers MUST be able to answer a query for a synthesized CNAME. Like
	other query types this invokes the DNAME, and synthesizes the CNAME 
	into the answer.
	
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.4"></a><h3>3.4.&nbsp;
Acceptance and Intermediate Storage</h3>

<p>
	DNS caches can encounter data at names below the owner name of a
	DNAME RR, due to a change at the authoritative server where data from
	before and after the change resides in the cache. This conflict 
	situation is a transitional phase, that ends when the old data 
	times out. The cache can opt to store both old and new data and 
	treat each as if the other did not exist, or drop the old data, or 
	drop the longer domain name. In any approach, consistency returns 
	after the older data TTL times out.
	
</p>
<p>
	DNS caches MUST perform CNAME synthesis on behalf of DNAME-ignorant 
	clients. A DNS cache that understands DNAMEs can send out queries
	on behalf of clients with the UD bit set. After receiving the answers
	the DNS cache sends replies to DNAME ignorant clients that include
	DNAMEs and synthesized CNAMEs.
	
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
DNAME Discussions in Other Documents</h3>

<p>In <a class='info' href='#RFC2181'>[RFC2181]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Clarifications to the DNS Specification,&rdquo; July&nbsp;1997.</span><span>)</span></a>, in Section 10.3., the discussion
	on MX and NS records touches on redirection by CNAMEs, but this
	also holds for DNAMEs.
	
</p>
<p>
	
<p> Excerpt from 10.3. MX and NS records 
	(in RFC 2181). 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
        The domain name used as the value of a NS resource record,
        or part of the value of a MX resource record must not be
        an alias.  Not only is the specification clear on this
        point, but using an alias in either of these positions
        neither works as well as might be hoped, nor well fulfills
        the ambition that may have led to this approach.  This
        domain name must have as its value one or more address
        records.  Currently those will be A records, however in
        the future other record types giving addressing
        information may be acceptable.  It can also have other
        RRs, but never a CNAME RR.</pre></div>
<p>
</p>
	

<p> 
	The DNAME RR is discussed in RFC 3363, section 4, on A6 and DNAME.
	The opening premise of this section is demonstrably wrong, and so 
	the conclusion based on that premise is wrong.  In particular, 
	<a class='info' href='#RFC3363'>[RFC3363]<span> (</span><span class='info'>Bush, R., Durand, A., Fink, B., Gudmundsson, O., and T. Hain, &ldquo;Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS),&rdquo; August&nbsp;2002.</span><span>)</span></a> deprecates the use of DNAME in the IPv6 
	reverse tree, which is then carried forward as a recommendation in 
	<a class='info' href='#RFC4294'>[RFC4294]<span> (</span><span class='info'>Loughney, J., &ldquo;IPv6 Node Requirements,&rdquo; April&nbsp;2006.</span><span>)</span></a>.  Based on the experience gained in the 
	meantime, <a class='info' href='#RFC3363'>[RFC3363]<span> (</span><span class='info'>Bush, R., Durand, A., Fink, B., Gudmundsson, O., and T. Hain, &ldquo;Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS),&rdquo; August&nbsp;2002.</span><span>)</span></a> should be revised, dropping all 
	constraints on having DNAME RRs in these zones.  This would greatly 
	improve the manageability of the IPv6 reverse tree.  These changes 
	are made explicit below.
	
</p>
<p>
	
<p>In <a class='info' href='#RFC3363'>[RFC3363]<span> (</span><span class='info'>Bush, R., Durand, A., Fink, B., Gudmundsson, O., and T. Hain, &ldquo;Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS),&rdquo; August&nbsp;2002.</span><span>)</span></a>, the paragraph
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   "The issues for DNAME in the reverse mapping tree appears to be
   closely tied to the need to use fragmented A6 in the main tree: if
   one is necessary, so is the other, and if one isn't necessary, the
   other isn't either.  Therefore, in moving RFC 2874 to experimental,
   the intent of this document is that use of DNAME RRs in the reverse
   tree be deprecated."
</pre></div>
<p>is to be replaced with the word "DELETED".
</p>
	

<p>
	
<p>
        In <a class='info' href='#RFC4294'>[RFC4294]<span> (</span><span class='info'>Loughney, J., &ldquo;IPv6 Node Requirements,&rdquo; April&nbsp;2006.</span><span>)</span></a>, the reference to DNAME was left in as an
        editorial oversight.  The paragraph 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  "Those nodes are NOT RECOMMENDED to support the experimental A6 and
  DNAME Resource Records [RFC3363]."</pre></div>
<p>
</p>
	
	
<p>
	is to be replaced by
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  "Those nodes are NOT RECOMMENDED to support the experimental
  A6 Resource Record [RFC3363]."</pre></div>
<p>
</p>
	

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Other Issues with DNAME</h3>

<p>
	There are several issues to be aware of about the use of DNAME.
	
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Canonical hostnames cannot be below DNAME owners</h3>

<p>
	The names listed as target names of MX, NS, PTR and SRV
	<a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> records must
	be canonical hostnames. This means no CNAME or DNAME redirection
	may be present during DNS lookup of the address records for the host.
	This is discussed in RFC 2181 <a class='info' href='#RFC2181'>[RFC2181]<span> (</span><span class='info'>Elz, R. and R. Bush, &ldquo;Clarifications to the DNS Specification,&rdquo; July&nbsp;1997.</span><span>)</span></a>, 
	section 10.3, and RFC 1912 <a class='info' href='#RFC1912'>[RFC1912]<span> (</span><span class='info'>Barr, D., &ldquo;Common DNS Operational and Configuration Errors,&rdquo; February&nbsp;1996.</span><span>)</span></a>, section 2.4.
	For SRV see RFC 2782 <a class='info' href='#RFC2782'>[RFC2782]<span> (</span><span class='info'>Gulbrandsen, A., Vixie, P., and L. Esibov, &ldquo;A DNS RR for specifying the location of services (DNS SRV),&rdquo; February&nbsp;2000.</span><span>)</span></a> page 4.
	
</p>
<p>
	The upshot of this is that although the lookup of a PTR record can
	involve DNAMEs, the name listed in the PTR record can not fall under
	a DNAME.  The same holds for NS, SRV and MX records.  For example, 
	when punycode alternates for a zone use DNAME then the 
	NS, MX, SRV and PTR records that point to that zone must use names 
	without punycode in their RDATA.
	What must be done then is to have the domain names with DNAME 
	substitution already applied to it as the MX, NS, PTR, SRV data.
	These are valid canonical hostnames.
	
</p>
<a name="dynamic"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Dynamic Update and DNAME</h3>

<p>
	DNAME records can be added, changed and removed in a zone using
	dynamic update transactions.  Adding a DNAME RR to a zone occludes
	any domain names that may exist under the added DNAME.  
	
</p>
<p>
	A server MUST ignore a dynamic update message that attempts to 
	add a DNAME RR at a name that already has a CNAME RR or another DNAME
	RR associated with that name.  
	
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
DNSSEC and DNAME</h3>

<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.1"></a><h3>5.3.1.&nbsp;
DNAME bit in NSEC type map</h3>

<p>
	When a validator checks the NSEC RRs returned on a name error response,
	it SHOULD check that the DNAME bit is not set. If the DNAME bit is
	set then the DNAME substitution should have been done, but has not.
	
</p>
<a name="validname"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2"></a><h3>5.3.2.&nbsp;
Validators Must Understand DNAME</h3>

<p>
	Examples of why DNSSEC validators MUST understand DNAME.
	
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.1"></a><h3>5.3.2.1.&nbsp;
DNAME in Bitmap Causes Invalid Name Error</h3>

<p>
	
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>;; Header: QR AA DO RCODE=3(NXDOMAIN)
;; Question
foo.bar.example.com. IN A
;; Answer
bar.example.com. NSEC dub.example.com. A DNAME
bar.example.com. RRSIG NSEC [valid signature]
</pre></div>
<p>
</p>
	

<p>
	If this is the response, then only by understanding that the 
	DNAME bit means that foo.bar.example.com needed to have been
	redirected by the DNAME, the validator can see that it is a BOGUS reply
	from an attacker that collated existing records from the DNS
	to create a confusing reply. 
	
</p>
<p>
	If the DNAME bit had not been set in the NSEC record above then
	the answer would have validated as a correct name error response.
	
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.2"></a><h3>5.3.2.2.&nbsp;
Valid Name Error Response Involving DNAME in Bitmap</h3>

<p>
	
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>;; Header: QR AA DO RCODE=3(NXDOMAIN)
;; Question
cee.example.com. IN A
;; Answer
bar.example.com. NSEC dub.example.com. A DNAME
bar.example.com. RRSIG NSEC [valid signature]
</pre></div>
<p>
</p>
	This reply has the same NSEC records as the example above,
	but with this query name (cee.example.com), 
	the answer is validated, because 'cee' does 
	not get redirected by the DNAME at 'bar'.
	

<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3.2.3"></a><h3>5.3.2.3.&nbsp;
Response With Synthesized CNAME</h3>

<p>
	
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>;; Header: QR AA DO RCODE=0(NOERROR)
;; Question
foo.bar.example.com. IN A
;; Answer
bar.example.com. DNAME bar.example.net.
bar.example.com. RRSIG DNAME [valid signature]
foo.bar.example.com. CNAME foo.bar.example.net.
</pre></div>
<p>
</p>
	The answer shown above has the synthesized CNAME included.
	However, the CNAME has no signature, since the server does not
	sign online. So it cannot be trusted. It could be altered by
	an attacker to be foo.bar.example.com CNAME bla.bla.example.
	The DNAME record does have its signature included, since it
	does not change for every query name. The validator must verify
	the DNAME signature and then recursively resolve further to 
	query for the foo.bar.example.net A record.
	

<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>The DNAME Resource Record type code 39 (decimal) originally has been
	registered by [RFC2672].  IANA should update the DNS resource record
	registry to point to this document for RR type 39.
	
</p>
<p>
	This draft requests the second highest bit in the EDNS flags
	field for the Understand-DNAME (UD) flag.
	
</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
	DNAME redirects queries elsewhere, which may impact security based 
	on policy and the security status of the zone with the DNAME and 
	the redirection zone's security status. 
	
</p>
<p>
	If a validating resolver accepts wildcarded DNAMEs, this creates
	security issues.  Since the processing of a wildcarded DNAME is 
	non-deterministic and the CNAME that was substituted by the 
	server has no signature, the resolver may choose a different 
	result than what the server meant, and consequently end up at 
	the wrong destination. Use of wildcarded DNAMEs is discouraged in 
	any case <a class='info' href='#RFC4592'>[RFC4592]<span> (</span><span class='info'>Lewis, E., &ldquo;The Role of Wildcards in the Domain Name System,&rdquo; July&nbsp;2006.</span><span>)</span></a>.
	
</p>
<p>
	A validating resolver MUST understand DNAME, according to 
	<a class='info' href='#RFC4034'>[RFC4034]<span> (</span><span class='info'>Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;Resource Records for the DNS Security Extensions,&rdquo; March&nbsp;2005.</span><span>)</span></a>. In <a class='info' href='#validname'>Section&nbsp;5.3.2<span> (</span><span class='info'>Validators Must Understand DNAME</span><span>)</span></a> 
	examples are given that illustrate this need. 
	
</p>
<a name="Acknowledgments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgments</h3>

<p>The authors of this draft would like to acknowledge Matt Larson 
	for beginning this effort to address the issues related to the 
	DNAME RR type. The authors would also like to acknowledge Paul Vixie,
	Ed Lewis, Mark Andrews, Mike StJohns, Niall O'Reilly, Sam Weiler,
	Alfred Hoenes and Kevin Darcy
	for their review and comments on this document.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1034">[RFC1034]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1034">Domain names - concepts and facilities</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1034, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC1035">[RFC1035]</a></td>
<td class="author-text">Mockapetris, P., &ldquo;<a href="http://tools.ietf.org/html/rfc1035">Domain names - implementation and specification</a>,&rdquo; STD&nbsp;13, RFC&nbsp;1035, November&nbsp;1987 (<a href="http://www.rfc-editor.org/rfc/rfc1035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2136">[RFC2136]</a></td>
<td class="author-text"><a href="mailto:paul@vix.com">Vixie, P.</a>, <a href="mailto:set@thumper.bellcore.com">Thomson, S.</a>, <a href="mailto:yakov@cisco.com">Rekhter, Y.</a>, and <a href="mailto:bound@zk3.dec.com">J. Bound</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2136">Dynamic Updates in the Domain Name System (DNS UPDATE)</a>,&rdquo; RFC&nbsp;2136, April&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2136.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2136.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2136.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2181">[RFC2181]</a></td>
<td class="author-text"><a href="mailto:kre@munnari.OZ.AU">Elz, R.</a> and <a href="mailto:randy@psg.com">R. Bush</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2181">Clarifications to the DNS Specification</a>,&rdquo; RFC&nbsp;2181, July&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2181.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2181.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2181.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2671">[RFC2671]</a></td>
<td class="author-text"><a href="mailto:vixie@isc.org">Vixie, P.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2671">Extension Mechanisms for DNS (EDNS0)</a>,&rdquo; RFC&nbsp;2671, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2671.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2672">[RFC2672]</a></td>
<td class="author-text"><a href="mailto:crawdad@fnal.gov">Crawford, M.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2672">Non-Terminal DNS Name Redirection</a>,&rdquo; RFC&nbsp;2672, August&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2672.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2782">[RFC2782]</a></td>
<td class="author-text"><a href="mailto:arnt@troll.no">Gulbrandsen, A.</a>, Vixie, P., and <a href="mailto:levone@microsoft.com">L. Esibov</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2782">A DNS RR for specifying the location of services (DNS SRV)</a>,&rdquo; RFC&nbsp;2782, February&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2782.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3597">[RFC3597]</a></td>
<td class="author-text">Gustafsson, A., &ldquo;<a href="http://tools.ietf.org/html/rfc3597">Handling of Unknown DNS Resource Record (RR) Types</a>,&rdquo; RFC&nbsp;3597, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3597.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4033">[RFC4033]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4033">DNS Security Introduction and Requirements</a>,&rdquo; RFC&nbsp;4033, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4033.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4034">[RFC4034]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4034">Resource Records for the DNS Security Extensions</a>,&rdquo; RFC&nbsp;4034, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4034.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4035">[RFC4035]</a></td>
<td class="author-text">Arends, R., Austein, R., Larson, M., Massey, D., and S. Rose, &ldquo;<a href="http://tools.ietf.org/html/rfc4035">Protocol Modifications for the DNS Security Extensions</a>,&rdquo; RFC&nbsp;4035, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4035.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4592">[RFC4592]</a></td>
<td class="author-text">Lewis, E., &ldquo;<a href="http://tools.ietf.org/html/rfc4592">The Role of Wildcards in the Domain Name System</a>,&rdquo; RFC&nbsp;4592, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4592.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1912">[RFC1912]</a></td>
<td class="author-text"><a href="mailto:barr@math.psu.edu">Barr, D.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1912">Common DNS Operational and Configuration Errors</a>,&rdquo; RFC&nbsp;1912, February&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc1912.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3363">[RFC3363]</a></td>
<td class="author-text">Bush, R., Durand, A., Fink, B., Gudmundsson, O., and T. Hain, &ldquo;<a href="http://tools.ietf.org/html/rfc3363">Representing Internet Protocol version 6 (IPv6) Addresses in the Domain Name System (DNS)</a>,&rdquo; RFC&nbsp;3363, August&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3363.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4294">[RFC4294]</a></td>
<td class="author-text">Loughney, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4294">IPv6 Node Requirements</a>,&rdquo; RFC&nbsp;4294, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4294.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Scott Rose</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NIST</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">100 Bureau Dr.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Gaithersburg, MD  20899</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1-301-975-8439</td></tr>
<tr><td class="author" align="right">Fax:&nbsp;</td>
<td class="author-text">+1-301-975-6238</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:scottr@nist.gov">scottr@nist.gov</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Wouter Wijngaards</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NLnet Labs</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kruislaan 419</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Amsterdam  1098 VA</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">The Netherlands</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+31-20-888-4551</td></tr>
<tr><td class="author" align="right">EMail:&nbsp;</td>
<td class="author-text"><a href="mailto:wouter@nlnetlabs.nl">wouter@nlnetlabs.nl</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>
