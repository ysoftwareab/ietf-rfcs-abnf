<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard%20http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Protocol Independent Multicast ECMP Assert</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";3
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Requirements Notation">
<link href="#rfc.section.2" rel="Chapter" title="2 Introduction">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Overview">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Applicability">
<link href="#rfc.section.3" rel="Chapter" title="3 Protocol Specification">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 ECMP Bundle">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 Sending ECMP Assert">
<link href="#rfc.section.3.3" rel="Chapter" title="3.3 Receiving ECMP Assert">
<link href="#rfc.section.3.4" rel="Chapter" title="3.4 Transient State">
<link href="#rfc.section.3.5" rel="Chapter" title="3.5 Interoperability">
<link href="#rfc.section.3.6" rel="Chapter" title="3.6 Packet Format">
<link href="#rfc.section.3.6.1" rel="Chapter" title="3.6.1 PIM ECMP Assert Hello Option">
<link href="#rfc.section.3.6.2" rel="Chapter" title="3.6.2 PIM ECMP Assert Format">
<link href="#rfc.section.4" rel="Chapter" title="4 IANA Considerations">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 Acknowledgement">
<link href="#rfc.references" rel="Chapter" title="7 References">
<link href="#rfc.references.1" rel="Chapter" title="7.1 Normative Reference">
<link href="#rfc.references.2" rel="Chapter" title="7.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content=
  "http://greenbytes.de/tech/webdav/rfc2629.xslt, Revision 1.539, 2011-01-02 17:13:00, XSLT vendor: SAXON 6.5.5 from Michael Kay http://saxon.sf.net/" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />
  <meta name="dct.creator" content="Doe, J." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-sample-input-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2010-12" />
  
  <meta name="dct.abstract" content="A PIM router uses RPF procedure to select an upstream interface and router to build forwarding state.  When there are equal cost multiple paths (ECMP), existing implementations often use hash algorithms to select a path. Such algorithms do not allow the spread of traffic among the ECMPs according to administrative metrics.  This usually leads to inefficient or ineffective use of network resources.  This document introduces the ECMP Assert, a mechanism to improve the RPF procedure over ECMPs. It allows ECMP path selection to be based on administratively selected metrics, such as data transmission delays, path preferences and routing metrics.  " />
  <meta name="description" content="A PIM router uses RPF procedure to select an upstream interface and router to build forwarding state.  When there are equal cost multiple paths (ECMP), existing implementations often use hash algorithms to select a path. Such algorithms do not allow the spread of traffic among the ECMPs according to administrative metrics.  This usually leads to inefficient or ineffective use of network resources.  This document introduces the ECMP Assert, a mechanism to improve the RPF procedure over ECMPs. It allows ECMP path selection to be based on administratively selected metrics, such as data transmission delays, path preferences and routing metrics.  " />
  <meta name="keywords" content="" />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">Yiqun Cai</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Liming Wei</td>
</tr>
<tr>
<td class="left">Intended status: Experimental Protocol</td>
<td class="right">Heidi Ou</td>
</tr>
<tr>
<td class="left">Expires: January 09, 2012</td>
<td class="right">Cisco Systems, Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Vishal Arya</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">Sunil Jethwani</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">DIRECTV Inc.</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">July 08, 2011</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Protocol Independent Multicast ECMP Assert<br />
  <span class="filename">draft-hou-pim-ecmp-01.txt</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>A PIM router uses RPF procedure to select an upstream interface and router to build forwarding state.  When there are equal cost multiple paths (ECMP), existing implementations often use hash algorithms to select a path. Such algorithms do not allow the spread of traffic among the ECMPs according to administrative metrics.  This usually leads to inefficient or ineffective use of network resources.  This document introduces the ECMP Assert, a mechanism to improve the RPF procedure over ECMPs. It allows ECMP path selection to be based on administratively selected metrics, such as data transmission delays, path preferences and routing metrics.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of this Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet- Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 09, 2012.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2011 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Requirements Notation</a>
</li>
<li>2.   <a href="#rfc.section.2">Introduction</a>
</li>
<li>2.1.   <a href="#rfc.section.2.1">Overview</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Applicability</a>
</li>
<li>3.   <a href="#rfc.section.3">Protocol Specification</a>
</li>
<li>3.1.   <a href="#rfc.section.3.1">ECMP Bundle</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">Sending ECMP Assert</a>
</li>
<li>3.3.   <a href="#rfc.section.3.3">Receiving ECMP Assert</a>
</li>
<li>3.4.   <a href="#rfc.section.3.4">Transient State</a>
</li>
<li>3.5.   <a href="#rfc.section.3.5">Interoperability</a>
</li>
<li>3.6.   <a href="#rfc.section.3.6">Packet Format</a>
</li>
<li>3.6.1.   <a href="#rfc.section.3.6.1">PIM ECMP Assert Hello Option</a>
</li>
<li>3.6.2.   <a href="#rfc.section.3.6.2">PIM ECMP Assert Format</a>
</li>
<li>4.   <a href="#rfc.section.4">IANA Considerations</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<li>6.   <a href="#rfc.section.6">Acknowledgement</a>
</li>
<li>7.   <a href="#rfc.references">References</a>
</li>
<li>7.1.   <a href="#rfc.references.1">Normative Reference</a>
</li>
<li>7.2.   <a href="#rfc.references.2">Informative References</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> Requirements Notation</h1>
<p id="rfc.section.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Introduction</h1>
<p id="rfc.section.2.p.1">A PIM [RFC4601] router uses RPF procedure to select an upstream interface and a PIM neighbor on that interface to build forwarding state.  When there are equal cost multiple paths (ECMP) upstream, existing implementations often use hash algorithms to select a path. Such algorithms do not allow the spread of traffic among the ECMP according to administrative metrics.  This usually leads to inefficient or ineffective use of network resources.  This document introduces the ECMP Assert, a mechanism to improve the RPF procedure over ECMP. It allows ECMP path selection to be based on administratively selected metrics, such as data transmission delays, path preferences and routing metrics, or a combination of metrics.</p>
<p id="rfc.section.2.p.2">ECMPs are frequently used in networks to provide redundancy and to increase available bandwidth. A PIM router selects a path in the ECMP based on its own implementation specific choice. The selection is a local decision. One way is to choose the PIM neighbor with the highest IP address, another is to pick the PIM neighbor with the best hash value over the destination and source addresses. </p>
<p id="rfc.section.2.p.3">While implementations supporting ECMP have been deployed widely, the existing RPF selection methods have weaknesses. The lack of administratively effective ways to allocate traffic over alternative paths is a major issue. For example, there is no straightforward way to tell two downstream routers to select either the same or different RPF neighbor routers for the same traffic flows.</p>
<p id="rfc.section.2.p.4">With the ECMP Assert mechanism introduced here, the upstream routers use a new PIM ECMP Assert message to instruct the downstream routers on how to tie-break among the upstream neighbors.  The PIM ECMP Assert message conveys the tie-break information based on metrics selected administratively.</p>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Overview</h1>
<p id="rfc.section.2.1.p.1">The existing PIM Assert mechanism allows the upstream router to detect the existence of multiple forwarders for the same multicast flow onto the same downstream interface. The upstream router sends a PIM Assert message containing a routing metric for the downstream routers to use for tie-breaking among the multiple upstream forwarders on the same RPF interface.</p>
<p id="rfc.section.2.1.p.2">With ECMP interfaces between the downstream and upstream routers, the PIM ECMP Assert mechanism works in a similar way, but extends the ability to resolve the selection of forwarders among different interfaces in the ECMP.</p>
<p id="rfc.section.2.1.p.3">When a PIM router downstream of the ECMP interfaces creates a new (*,G) or (S,G) entry, it will populate the RPF interface and RPF neighbor information according to the rules specified by [RFC4601].  This router will send its initial joins to that RPF neighbor.</p>
<p id="rfc.section.2.1.p.4">When the RPF neighbor router receives the join message and finds that the receiving interface is one of the ECMP interfaces, it will check if the same flow is already being forwarded out of another ECMP interface.  If so, this RPF neighbor router will send a PIM ECMP Assert message onto the interface the join was received on. The PIM ECMP Assert message contains the address of the desired RPF neighbor, an interface ID <a href="#INTID">[INTID]</a>, along with other parameters used as tie breakers.  In essence, a PIM ECMP Assert message is sent by an upstream router to notify downstream routers to redirect PIM Joins to the new RPF neighbor via a different interface.  When the downstream routers receive this message, they should trigger PIM Joins toward the new RPF neighbor specified in the packet.</p>
<p id="rfc.section.2.1.p.5">This new message is named PIM ECMP Assert for the following reasons,</p>
<p></p>

<ol>
<li>It is sent by an upstream router; </li>
<li>It is used to influence the RPF selection by downstream routers; And </li>
<li>A tie breaker metric is used. </li>
</ol>

<p> </p>
<p id="rfc.section.2.1.p.7">This new message functions in similar ways to the existing PIM Assert message, with the exception that the existing Assert message is used to select an upstream router within the same multi-access network (such as a LAN) while the new message is used to select both a network and an upstream router.  </p>
<p id="rfc.section.2.1.p.8">One advantage of this design is that the control messages are only sent when there is need to "re-balance" the traffic.  This reduces the amount of control traffic.  </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Applicability</h1>
<p id="rfc.section.2.2.p.1">The use of ECMP Assert applies to shared trees or source trees built with procedures described in <a href="#RFC4601">[RFC4601]</a>.  The use of ECMP Assert in "Protocol Independent Multicast - Dense Mode" <a href="#RFC3973">[RFC3973]</a> or in "Bidirectional Protocol Independent Multicast" <a href="#RFC5015">[RFC5015]</a> is not considered.</p>
<p id="rfc.section.2.2.p.2">The enhancement described in this document can be applicable to a number of scenarios. For example, it allows a network operator to use ECMP paths and have the ability to perform load splitting based on bandwidth.  To do this, the downstream routers perform RPF selection with bandwidth instead of IP addresses as a tie breaker. The ECMP Assert mechanism assures that all downstream routers select the desired network link and upstream router whenever possible.  Another example is for a network operator to impose a transmission delay limit on certain links. The ECMP Assert mechanism provides a mean for an upstream router to instruct a downstream router to choose a different RPF path. </p>
<p id="rfc.section.2.2.p.3">This specification does not dictate the scope of applications of this mechanism.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Protocol Specification</h1>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> ECMP Bundle</h1>
<p id="rfc.section.3.1.p.1">An ECMP bundle is a set of PIM enabled interfaces on a router, where all interfaces belonging to the same bundle share the same routing metric. The ECMP paths reside between the upstream and downstream routers over the ECMP bundle.</p>
<p id="rfc.section.3.1.p.2">There can be one or more ECMP bundles on any router, while one individual interface can only belong to a single bundle.</p>
<p id="rfc.section.3.1.p.3">ECMP bundles are created on a router via configuration.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> Sending ECMP Assert</h1>
<p id="rfc.section.3.2.p.1">ECMP Asserts are sent by an upstream router in a rate limited fashion, under the following conditions,</p>
<p></p>

<ul>
<li>It detects a PIM Join on a non-desired outgoing interface; or</li>
<li>It detects multicast traffic on a non-desired outgoing interface.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.3">In both cases, an ECMP Assert is sent to the non-desired interface. An outgoing interface is considered "non-desired"  when, </p>
<p></p>

<ul>
<li>The upstream router is already forwarding the same flow out of another interface belonging to the same ECMP bundle; </li>
<li>The upstream router is not forwarding the flow yet out any interfaces of the ECMP bundle, but there is another interface with more desired attributes.</li>
</ul>

<p> </p>
<p id="rfc.section.3.2.p.5">An upstream router may choose not to send ECMP Asserts if it becomes aware that some of the downstream routers do not support the new message, or unreachable via some links in ECMP bundle. </p>
<h1 id="rfc.section.3.3">
<a href="#rfc.section.3.3">3.3.</a> Receiving ECMP Assert</h1>
<p id="rfc.section.3.3.p.1">When a downstream router receives an ECMP Assert, and detects the desired RPF path from its upstream router's point of view is different from its current one, it should choose to prune from the current path and join to the new path.  The exact order of such actions is implementation specific.</p>
<p id="rfc.section.3.3.p.2">If a downstream router receives multiple ECMP Asserts sent by different upstream routers, it SHOULD use the Preference, Metric, or other fields as specified below, as the tie breakers to choose the most preferred RPF interface and neighbor.</p>
<p id="rfc.section.3.3.p.3">If an upstream router receives an ECMP Assert from another upstream router, it SHOULD NOT change its forwarding behavior even if the ECMP Assert makes it a less preferred RPF neighbor on the receiving interface.</p>
<h1 id="rfc.section.3.4">
<a href="#rfc.section.3.4">3.4.</a> Transient State</h1>
<p id="rfc.section.3.4.p.1">During a transient network outage with a single link cut in an ECMP bundle, a downstream router may lose connection to its RPF neighbor and the normal ECMP Assert operation may be interrupted temporarily. In such an event, the following actions are recommended.</p>
<p id="rfc.section.3.4.p.2">The down stream router may re-select a new RPF neighbor. Among all ECMP upstream routers, the one on the same LAN as the previous RPF neighbor is preferred. </p>
<p id="rfc.section.3.4.p.3">If there is no upstream router reachable on the same LAN, the down stream router will select a RPF neighbor on a different LAN.  Among all ECMP upstream routers, the one served as RPF neighbor before the link failure is preferred.  Such a router can be identified by the Router ID which is part of the Interface ID in the PIM ECMP Assert Hello option.</p>
<p id="rfc.section.3.4.p.4">During normal ECMP Assert operations, when PIM Joins for the same (*,G) or (S,G) are received on a different LAN, an upstream router will send ECMP Assert to prune the non-preferred LAN.  Such ECMP Asserts during partial network outage can be supressed if the upstream router decides that the non-preferred PIM Join is from a router that is not reachable via the preferred LAN.  This check can be performed by retrieving the downstream's Router ID, using the source address in the PIM join, and searching neighbors on the preferred LAN for one with the same router ID.  </p>
<h1 id="rfc.section.3.5">
<a href="#rfc.section.3.5">3.5.</a> Interoperability</h1>
<p id="rfc.section.3.5.p.1">If a PIM router supports this draft, it MUST send the new Hello option ECMP-Assert-Supported TLV in its PIM Hello messages.  A PIM router sends ECMP Asserts on an interface only when it detects that all neighbors have sent this Hello option. If a PIM router detects that any of its neighbor does not support this Hello option, it MUST not send ECMP Asserts, however, it SHOULD still process any ECMP Asserts received.</p>
<h1 id="rfc.section.3.6">
<a href="#rfc.section.3.6">3.6.</a> Packet Format</h1>
<h1 id="rfc.section.3.6.1">
<a href="#rfc.section.3.6.1">3.6.1.</a> PIM ECMP Assert Hello Option</h1>
<div id="#rfc.figure.1"></div>
<div id="#ECMP Assert Hello"></div>
<p></p>
<pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Type = TBD          |         Length = 0            | 
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

  
                </pre>
<p></p>
<p></p>

<dl>
<dt>Type: </dt>
<dd style="margin-left: 8">TBD. </dd>
<dt>Length: </dt>
<dd style="margin-left: 8">0 </dd>
</dl>

<p> </p>
<h1 id="rfc.section.3.6.2">
<a href="#rfc.section.3.6.2">3.6.2.</a> PIM ECMP Assert Format</h1>
<div id="#rfc.figure.2"></div>
<div id="#ECMP Assert"></div>
<p></p>
<pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |PIM Ver| Type  |   Reserved    |           Checksum            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |              Group Address (Encoded-Group format)             |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |            Source Address (Encoded-Unicast format)            |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Neighbor Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                                                               |
   +-+-+-+-+-+- ............ Interface ID ........... -+-+-+-+-+-+-+
   |                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |   Preference  |                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+--  ... Metric ...  -+-+-+-+-+-+-+-+-+
   |                                                               |
   +- .. Metric .. +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |               |                                         
   +-+-+-+-+-+-+-+-+
  
                </pre>
<p></p>
<p></p>

<dl>
<dt>Type: </dt>
<dd style="margin-left: 8">TBD </dd>
<dt>Neighbor Address (32/128 bits): </dt>
<dd style="margin-left: 8">Address of desired upstream neighbor where the downstream receiver should redirect PIM Joins to.  This address MUST be associated with an interface in the same ECMP bundle as the ECMP Assert message's outgoing interface. If the "Interface ID" field (see below) is ignored, this "Neighbor Address" field uniquely identifies a LAN and an upstream router to which a downstream router should redirect its Join messages to, and an ECMP Assert message MUST be discarded if the "Neighbor Address" field in the message does not match cached neighbor address. </dd>
<dt>Interface ID (64 bits): </dt>
<dd style="margin-left: 8">This field is used in IPv4 when one or more RPF neighbors in the ECMP bundle are unnumbered, or in IPv6 where link local addresses are in use.  For other IPv4 usage, this field is zero'ed when sent, and ignored when received. If the "Router ID" part of the "Interface ID" is zero, the field must be ignored. See <a href="#INTID">[INTID]</a> for details of its assignment and usage in PIM Hellos. If the "Interface ID" is not ignored, the receiving router of this message MUST use the "Interface ID", instead of "Neighbor Address", to identify the new RPF neighbor, and an ECMP Assert message MUST be discarded if the "Interface ID" field in the message does not match cached interface ID. </dd>
<dt>Preference (8 bits): </dt>
<dd style="margin-left: 8">The first tie breaker when ECMP Asserts from multiple upstream routers are compared against each other. Numerically smaller value is preferred. A reserved (15) value is used to indicate the metric value following the "Preference" field is a timestamp, taken at the moment the sending router started to forward out of this interface.</dd>
<dt>Metric (64 bits): </dt>
<dd style="margin-left: 8">The second tie breaker if the the "Preference" values are the same. Numerically smaller metric is preferred. This "Metric" can contain path parameters defined by users. When both "Preference" and "Metric" values are the same, "Neighbor Address" or "Interface ID" field is used as the third tie-breaker, depends on which field is used to identify the RPF neighbor, and the bigger value wins. </dd>
</dl>

<p> </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> IANA Considerations</h1>
<p id="rfc.section.4.p.1">A new PIM Type is required to be assigned to the ECMP Assert messages. According to <a href="#PIMREG">[PIMREG]</a>, this document recommends 11 (0xB) as the new "PIM ECMP Assert Type".</p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> Security Considerations</h1>
<p id="rfc.section.5.p.1">Security of the ECMP Assert is only guaranteed by the security of the PIM packet, so the security considerations for PIM Assert packets as described in [RFC4601] apply here.  Spoofed ECMP Assert packets may cause the downstream routers to send PIM Joins to an undesired upstream router, and trigger more ECMP Assert messages.  </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> Acknowledgement</h1>
<p id="rfc.section.6.p.1">The authors would like to thank Apoorva Karan for helping with the original idea, Eric Rosen, Isidor Kouvelas, Toerless Eckert and Stig Venaas for their review comments. </p>
<h1 id="rfc.references">
<a href="#rfc.references">7.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">7.1.</a> Normative Reference</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a href="mailto:sob@harvard.edu" title="Harvard University">Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4601">[RFC4601]</b></td>
<td class="top">
<a>Fenner, B.</a>, <a>Handley, M.</a>, <a>Holbrook, H.</a> and <a>I. Kouvelas</a>, "<a href="http://tools.ietf.org/html/rfc4601">Protocol Independent Multicast - Sparse Mode (PIM-SM): Protocol Specification (Revised)</a>", RFC 4601, August 2006.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">7.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC3973">[RFC3973]</b></td>
<td class="top">
<a>Adams, A.</a>, <a>Nicholas, J.</a> and <a>W. Siadak</a>, "<a href="http://tools.ietf.org/html/rfc3973">Protocol Independent Multicast - Dense Mode (PIM-DM): Protocol Specification (Revised)</a>", RFC 3973, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5015">[RFC5015]</b></td>
<td class="top">
<a>Handley, M.</a>, <a>Kouvelas, I.</a>, <a>Speakman, T.</a> and <a>L. Vicisano</a>, "<a href="http://tools.ietf.org/html/rfc5015">Bidirectional Protocol Independent Multicast (BIDIR-PIM)</a>", RFC 5015, October 2007.</td>
</tr>
<tr>
<td class="reference"><b id="INTID">[INTID]</b></td>
<td class="top">
<a>Gulrajani, S.</a> and <a>S. Venaas</a>, "<a href="http://tools.ietf.org/html/draft-gulrajani-pim-hello-intid-01.txt">An Interface ID Hello Option for PIM</a>", Internet-Draft draft-gulrajani-pim-hello-intid-01.txt, .</td>
</tr>
<tr>
<td class="reference"><b id="PIMREG">[PIMREG]</b></td>
<td class="top">
<a>Venaas, S.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-pim-registry-04.txt">A Registry for PIM Message Types</a>", Internet-Draft draft-ietf-pim-registry-04.txt, .</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Yiqun Cai</span> 
	  <span class="n hidden">
		<span class="family-name">Yiqun Cai</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:ycai@cisco.com">ycai@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Liming Wei</span> 
	  <span class="n hidden">
		<span class="family-name">Liming Wei</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:lwei@cisco.com">lwei@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Heidi Ou</span> 
	  <span class="n hidden">
		<span class="family-name">Heidi Ou</span>
	  </span>
	</span>
	<span class="org vcardline">Cisco Systems, Inc.</span>
	<span class="adr">
	  <span>Tasman Drive</span>

	  <span class="vcardline">
		<span class="locality">San Jose</span>,  
		<span class="region">CA</span> 
		<span class="code">95134</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:hou@cisco.com">hou@cisco.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Vishal Arya</span> 
	  <span class="n hidden">
		<span class="family-name">Vishal Arya</span>
	  </span>
	</span>
	<span class="org vcardline">DIRECTV Inc.</span>
	<span class="adr">
	  <span>2230 E Imperial Hwy</span>

	  <span class="vcardline">
		<span class="locality">El Segundo</span>,  
		<span class="region">CA</span> 
		<span class="code">90245</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:varya@directv.com">varya@directv.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Sunil Jethwani</span> 
	  <span class="n hidden">
		<span class="family-name">Sunil Jethwani</span>
	  </span>
	</span>
	<span class="org vcardline">DIRECTV Inc.</span>
	<span class="adr">
	  <span>2230 E Imperial Hwy</span>

	  <span class="vcardline">
		<span class="locality">El Segundo</span>,  
		<span class="region">CA</span> 
		<span class="code">90245</span>
	  </span>
	  <span class="country-name vcardline">USA</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:sjethwani@directv.com">sjethwani@directv.com</a></span>

  </address>
</div>

</body>
</html>